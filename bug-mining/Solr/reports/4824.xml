<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:50:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-16072] Metrics: solr.jetty disappeared in 9</title>
                <link>https://issues.apache.org/jira/browse/SOLR-16072</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The &quot;solr.jetty&quot; metrics is totally gone in 9.; it&apos;s still there in 8.  I see at least some of the code related to this; it&apos;s unclear what broke it.  There is no test &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/warning.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; but the Prometheus exporter default config solr-exporter-config.xml references it, and spits out errors due to its absence.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13431595">SOLR-16072</key>
            <summary>Metrics: solr.jetty disappeared in 9</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cpoerschke">Christine Poerschke</assignee>
                                    <reporter username="dsmiley">David Smiley</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Mar 2022 22:46:14 +0000</created>
                <updated>Thu, 12 May 2022 00:35:21 +0000</updated>
                            <resolved>Mon, 7 Mar 2022 13:11:19 +0000</resolved>
                                    <version>9.0</version>
                                    <fixVersion>9.0</fixVersion>
                                    <component>metrics</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="11400">3h 10m</timespent>
                                <comments>
                            <comment id="17501332" author="cpoerschke" created="Fri, 4 Mar 2022 13:45:35 +0000"  >&lt;p&gt;Based on&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
curl &lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8983/solr/admin/metrics?group=jetty&quot;&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;returning or not returning metrics, the &lt;tt&gt;4d13cbd8170&lt;/tt&gt; commit is when the metrics stop being returned for me locally.&lt;/p&gt;</comment>
                            <comment id="17501407" author="risdenk" created="Fri, 4 Mar 2022 16:05:53 +0000"  >&lt;p&gt;Hmmm that is not good....&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
commit 4d13cbd8170921e458083e62371f15fb0b483f65
Author: Kevin Risden &amp;lt;krisden@apache.org&amp;gt;
Date:   Mon Feb 7 09:59:28 2022 -0500

    SOLR-15984: Ensure all used dependencies are declared

    * Add missing dependencies that are used in compile and test
    * LTR module - remove jetty-servlet dependency since it wasn&apos;t used
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17501411" author="risdenk" created="Fri, 4 Mar 2022 16:08:46 +0000"  >&lt;p&gt;As far as I&apos;m aware, &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15984&quot; title=&quot;Ensure all used dependencies are declared&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15984&quot;&gt;&lt;del&gt;SOLR-15984&lt;/del&gt;&lt;/a&gt; didn&apos;t change any library versions and only added dependencies to modules where they were already being pulled into the classpath. So I&apos;m not entirely sure how &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15984&quot; title=&quot;Ensure all used dependencies are declared&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15984&quot;&gt;&lt;del&gt;SOLR-15984&lt;/del&gt;&lt;/a&gt; could have caused this &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;</comment>
                            <comment id="17501417" author="risdenk" created="Fri, 4 Mar 2022 16:14:19 +0000"  >&lt;p&gt;My only guess right now is that metrics-jetty9 is only used at runtime and isn&apos;t on the classpath for running Solr server. At least based on main, it looks like it is there in the right spot though.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
# find solr/packaging/build/solr-10.0.0-SNAPSHOT/ -name &lt;span class=&quot;code-quote&quot;&gt;&apos;*metrics-jetty9*.jar&apos;&lt;/span&gt;
solr/packaging/build/solr-10.0.0-SNAPSHOT/server/lib/metrics-jetty9-4.1.5.jar
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Based on &lt;a href=&quot;https://metrics.dropwizard.io/4.2.0/manual/jetty.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://metrics.dropwizard.io/4.2.0/manual/jetty.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Does metrics-jetty9 need to be in WEB-INF/lib???&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
# find solr/packaging/build/solr-10.0.0-SNAPSHOT/ -name &lt;span class=&quot;code-quote&quot;&gt;&apos;*metrics-*.jar&apos;&lt;/span&gt;
solr/packaging/build/solr-10.0.0-SNAPSHOT/server/lib/metrics-core-4.1.5.jar
solr/packaging/build/solr-10.0.0-SNAPSHOT/server/lib/metrics-jmx-4.1.5.jar
solr/packaging/build/solr-10.0.0-SNAPSHOT/server/lib/metrics-jetty9-4.1.5.jar
solr/packaging/build/solr-10.0.0-SNAPSHOT/server/lib/metrics-jvm-4.1.5.jar
solr/packaging/build/solr-10.0.0-SNAPSHOT/server/lib/metrics-graphite-4.1.5.jar
solr/packaging/build/solr-10.0.0-SNAPSHOT/server/solr-webapp/webapp/WEB-INF/lib/metrics-core-4.1.5.jar
solr/packaging/build/solr-10.0.0-SNAPSHOT/server/solr-webapp/webapp/WEB-INF/lib/metrics-jmx-4.1.5.jar
solr/packaging/build/solr-10.0.0-SNAPSHOT/server/solr-webapp/webapp/WEB-INF/lib/metrics-jvm-4.1.5.jar
solr/packaging/build/solr-10.0.0-SNAPSHOT/server/solr-webapp/webapp/WEB-INF/lib/metrics-graphite-4.1.5.jar
solr/packaging/build/solr-10.0.0-SNAPSHOT/modules/s3-repository/lib/metrics-spi-2.17.63.jar
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;it looks like all the metrics-*.jar files are in WEB-INF/lib but not metrics-jetty9&lt;/p&gt;

&lt;p&gt;It looks like metrics-jetty9 isn&apos;t listed in core/build.gradle, but is in server/build.grade:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/solr/blob/main/solr/core/build.gradle#L142&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/solr/blob/main/solr/core/build.gradle#L142&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/solr/blob/main/solr/server/build.gradle#L42&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/solr/blob/main/solr/server/build.gradle#L42&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17501501" author="cpoerschke" created="Fri, 4 Mar 2022 19:38:07 +0000"  >&lt;p&gt;Continuing with my earlier bisect approach and with the leads above w.r.t. the &lt;tt&gt;metrics-jetty9&lt;/tt&gt; jars etc. and experimenting ... &lt;a href=&quot;https://github.com/apache/solr/pull/726&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/solr/pull/726&lt;/a&gt; makes the metrics re-appear again for me locally.&lt;/p&gt;</comment>
                            <comment id="17501503" author="dsmiley" created="Fri, 4 Mar 2022 19:39:46 +0000"  >&lt;blockquote&gt;&lt;p&gt;Does metrics-jetty9 need to be in WEB-INF/lib&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes. &#160;&lt;/p&gt;

&lt;p&gt;I strongly suspect it&apos;s no longer in the distribution (i.e. not in tar.gz and thus not in docker either). &#160;I wish changes to our dependency tree could be reviewed (during PR stage) &lt;em&gt;somehow&lt;/em&gt; in terms of this (changes to the distribution).&lt;/p&gt;</comment>
                            <comment id="17501508" author="dsmiley" created="Fri, 4 Mar 2022 19:50:01 +0000"  >&lt;p&gt;I&apos;m imagining a machine generated text file listing every file name in the distribution, and then a validation check during the build that it didn&apos;t change. &#160;We could X-out the version numbers to avoid annoyances in maintaining this when we bump versions. &#160;We don&apos;t have this today but I think a manual check of this nature would be good to compare the upcoming 9.0 release with 8.11&lt;/p&gt;</comment>
                            <comment id="17501515" author="risdenk" created="Fri, 4 Mar 2022 19:55:00 +0000"  >&lt;blockquote&gt;&lt;p&gt;I strongly suspect it&apos;s no longer in the distribution (i.e. not in tar.gz and thus not in docker either).  I wish changes to our dependency tree could be reviewed (during PR stage) somehow in terms of this (changes to the distribution).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt; See my comment above. metrics-jetty9 is there in server/lib.&lt;/p&gt;</comment>
                            <comment id="17501631" author="dsmiley" created="Sat, 5 Mar 2022 02:08:24 +0000"  >&lt;p&gt;Got it but my recommendation (a text file of file names in the distro) is still valid nonetheless. &#160;It would have revealed in your other PR that you had added a bunch of JARs to WEB-INF/lib that were not previously there, which would have garnered further examination.&lt;/p&gt;</comment>
                            <comment id="17502238" author="jira-bot" created="Mon, 7 Mar 2022 12:43:22 +0000"  >&lt;p&gt;Commit 75d997077bf02b184bdd1649a1b11a1920d8c3f4 in solr&apos;s branch refs/heads/main from Christine Poerschke&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=75d9970&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=75d9970&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16072&quot; title=&quot;Metrics: solr.jetty disappeared in 9&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16072&quot;&gt;&lt;del&gt;SOLR-16072&lt;/del&gt;&lt;/a&gt;: make solr.jetty metrics reappear again (#726)&lt;/p&gt;

&lt;p&gt;Co-authored-by: Kevin Risden &amp;lt;krisden@apache.org&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17502253" author="jira-bot" created="Mon, 7 Mar 2022 13:04:50 +0000"  >&lt;p&gt;Commit 8517ccbfc0013c33d3abf9d386bf9027d07dcb4e in solr&apos;s branch refs/heads/branch_9x from Christine Poerschke&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=8517ccb&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=8517ccb&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16072&quot; title=&quot;Metrics: solr.jetty disappeared in 9&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16072&quot;&gt;&lt;del&gt;SOLR-16072&lt;/del&gt;&lt;/a&gt;: make solr.jetty metrics reappear again (#726)&lt;/p&gt;

&lt;p&gt;Co-authored-by: Kevin Risden &amp;lt;krisden@apache.org&amp;gt;&lt;br/&gt;
(cherry picked from commit 75d997077bf02b184bdd1649a1b11a1920d8c3f4)&lt;/p&gt;</comment>
                            <comment id="17502257" author="jira-bot" created="Mon, 7 Mar 2022 13:09:17 +0000"  >&lt;p&gt;Commit ba60da9843b2582a5c19678a95d4d3b91ffcc252 in solr&apos;s branch refs/heads/branch_9_0 from Christine Poerschke&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=ba60da9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=ba60da9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16072&quot; title=&quot;Metrics: solr.jetty disappeared in 9&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16072&quot;&gt;&lt;del&gt;SOLR-16072&lt;/del&gt;&lt;/a&gt;: make solr.jetty metrics reappear again (#726)&lt;/p&gt;

&lt;p&gt;Co-authored-by: Kevin Risden &amp;lt;krisden@apache.org&amp;gt;&lt;br/&gt;
(cherry picked from commit 75d997077bf02b184bdd1649a1b11a1920d8c3f4)&lt;br/&gt;
(cherry picked from commit 8517ccbfc0013c33d3abf9d386bf9027d07dcb4e)&lt;/p&gt;</comment>
                            <comment id="17535459" author="janhoy" created="Thu, 12 May 2022 00:26:31 +0000"  >&lt;p&gt;Closing after the 9.0.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13426944">SOLR-15984</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                                                <inwardlinks description="is superceded by">
                                        <issuelink>
            <issuekey id="13440482">SOLR-16157</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 26 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z103w0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>