<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:25:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-10983] Fix DOWNNODE -&gt; queue-work explosion</title>
                <link>https://issues.apache.org/jira/browse/SOLR-10983</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Every DOWNNODE command enqueues N copies of itself into queue-work, where N is number of collections affected by the DOWNNODE.&lt;/p&gt;

&lt;p&gt;This rarely matters in practice, because queue-work gets immediately dumped-- however, if anything throws an exception (such as ZK bad version), we don&apos;t clear queue-work.  Then the next time through the loop we run the expensive DOWNNODE command potentially hundreds of times.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13083672">SOLR-10983</key>
            <summary>Fix DOWNNODE -&gt; queue-work explosion</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dragonsinth">Scott Blum</assignee>
                                    <reporter username="dragonsinth">Scott Blum</reporter>
                        <labels>
                    </labels>
                <created>Fri, 30 Jun 2017 05:24:13 +0000</created>
                <updated>Wed, 2 Oct 2019 17:24:42 +0000</updated>
                            <resolved>Mon, 21 Aug 2017 09:43:31 +0000</resolved>
                                                    <fixVersion>6.6.1</fixVersion>
                    <fixVersion>7.0</fixVersion>
                    <fixVersion>8.0</fixVersion>
                                    <component>SolrCloud</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16069503" author="dragonsinth" created="Fri, 30 Jun 2017 05:30:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jhump&quot; class=&quot;user-hover&quot; rel=&quot;jhump&quot;&gt;jhump&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16074173" author="shalinmangar" created="Wed, 5 Jul 2017 02:11:32 +0000"  >&lt;p&gt;Nice catch!&lt;/p&gt;

&lt;p&gt;Your patch solves another problem &amp;#8211; today if an exception happens, we run through items in the work-queue and the last item from state-update-queue (the one during which the exception happened) so we run the same item twice.&lt;/p&gt;

&lt;p&gt;Considering that DOWNNODE is the only command that enqueues multiple ZkWriteCommands, I think we should add a method to ZkStateWriter which calls enqueue only once for the entire batch. That and your patch solve all problems nicely i.e. &lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;DOWNNODE creating multiple work queue items&lt;/li&gt;
	&lt;li&gt;Exceptions not clearing work queue&lt;/li&gt;
	&lt;li&gt;Overseer executing same item twice from work queue and state update queue on an exception&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="16074176" author="shalinmangar" created="Wed, 5 Jul 2017 02:31:52 +0000"  >&lt;p&gt;On second thought, creating a batch enqueue command is not so straightforward and the callback is called once per enqueue as per the contract of ZkWriteCallback so it is technically not a bug. So I am fine with your solution as it exists. +1 to commit. Please make sure it is backported to the branch_7x and branch_7_0 so that it makes it into the 7.0 release.&lt;/p&gt;</comment>
                            <comment id="16074225" author="dragonsinth" created="Wed, 5 Jul 2017 04:11:26 +0000"  >&lt;p&gt;Thanks!  Will do&lt;/p&gt;</comment>
                            <comment id="16075662" author="jira-bot" created="Thu, 6 Jul 2017 00:02:45 +0000"  >&lt;p&gt;Commit 380eed838d6646ec02592a9d2e6649e6aa1b5d9b in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dragonsinth&quot; class=&quot;user-hover&quot; rel=&quot;dragonsinth&quot;&gt;dragonsinth&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=380eed8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=380eed8&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10983&quot; title=&quot;Fix DOWNNODE -&amp;gt; queue-work explosion&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10983&quot;&gt;&lt;del&gt;SOLR-10983&lt;/del&gt;&lt;/a&gt;: Fix DOWNNODE -&amp;gt; queue-work explosion&lt;/p&gt;</comment>
                            <comment id="16075663" author="jira-bot" created="Thu, 6 Jul 2017 00:03:15 +0000"  >&lt;p&gt;Commit 17245c2e5a93bca59572c09af78a6ad6045e75eb in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dragonsinth&quot; class=&quot;user-hover&quot; rel=&quot;dragonsinth&quot;&gt;dragonsinth&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=17245c2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=17245c2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10983&quot; title=&quot;Fix DOWNNODE -&amp;gt; queue-work explosion&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10983&quot;&gt;&lt;del&gt;SOLR-10983&lt;/del&gt;&lt;/a&gt;: Fix DOWNNODE -&amp;gt; queue-work explosion&lt;/p&gt;</comment>
                            <comment id="16075664" author="jira-bot" created="Thu, 6 Jul 2017 00:03:29 +0000"  >&lt;p&gt;Commit 51638c09bf4f5457650ab40c60b5f98512f9ca1d in lucene-solr&apos;s branch refs/heads/branch_7_0 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dragonsinth&quot; class=&quot;user-hover&quot; rel=&quot;dragonsinth&quot;&gt;dragonsinth&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=51638c0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=51638c0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10983&quot; title=&quot;Fix DOWNNODE -&amp;gt; queue-work explosion&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10983&quot;&gt;&lt;del&gt;SOLR-10983&lt;/del&gt;&lt;/a&gt;: Fix DOWNNODE -&amp;gt; queue-work explosion&lt;/p&gt;</comment>
                            <comment id="16075666" author="dragonsinth" created="Thu, 6 Jul 2017 00:05:33 +0000"  >&lt;p&gt;BTW: this issue most likely affects all 6.x releases (and even some late 5.x), so it should be considered if we do any 6.x point releases later.&lt;/p&gt;</comment>
                            <comment id="16117560" author="jira-bot" created="Mon, 7 Aug 2017 23:35:19 +0000"  >&lt;p&gt;Commit d704796a785aa0d8e455661e519bb2f0c67b7311 in lucene-solr&apos;s branch refs/heads/branch_6x from Erick&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d704796&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d704796&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10983&quot; title=&quot;Fix DOWNNODE -&amp;gt; queue-work explosion&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10983&quot;&gt;&lt;del&gt;SOLR-10983&lt;/del&gt;&lt;/a&gt;: Fix DOWNNODE -&amp;gt; queue-work explosion, backporting to 6x as per the comments in the JIRA&lt;/p&gt;</comment>
                            <comment id="16117562" author="erickerickson" created="Mon, 7 Aug 2017 23:36:43 +0000"  >&lt;p&gt;I backported this to 6x (future 6.7) as I really expect there to be a final release of the 6x code line and didn&apos;t want this to be omitted. No harm if there&apos;s &lt;em&gt;not&lt;/em&gt; a 6.7.&lt;/p&gt;</comment>
                            <comment id="16134881" author="varunthacker" created="Mon, 21 Aug 2017 08:32:00 +0000"  >&lt;p&gt;Re-opening to backport to 6.6.1&lt;/p&gt;</comment>
                            <comment id="16134957" author="jira-bot" created="Mon, 21 Aug 2017 09:42:18 +0000"  >&lt;p&gt;Commit f031a85f50902cfc0b54422b35f60effb7353b05 in lucene-solr&apos;s branch refs/heads/branch_6_6 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dragonsinth&quot; class=&quot;user-hover&quot; rel=&quot;dragonsinth&quot;&gt;dragonsinth&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f031a85&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f031a85&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10983&quot; title=&quot;Fix DOWNNODE -&amp;gt; queue-work explosion&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10983&quot;&gt;&lt;del&gt;SOLR-10983&lt;/del&gt;&lt;/a&gt;: Fix DOWNNODE -&amp;gt; queue-work explosion&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12875183" name="SOLR-10983.patch" size="3572" author="dragonsinth" created="Fri, 30 Jun 2017 05:29:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 13 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3gxj3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>