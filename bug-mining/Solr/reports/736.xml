<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:24:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-2813] TrieTokenizerFactory should catch NumberFormatException, return 400 (not 500)</title>
                <link>https://issues.apache.org/jira/browse/SOLR-2813</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;TrieTokenizerFactory is allowing bad user input to result in a 500 error rather than a 400.  For a long-valued field, for example, this code in TrieTokenizerFactory.reset() will throw a NumberFormatException:&lt;/p&gt;

&lt;p&gt;&amp;gt; case LONG:&lt;br/&gt;
&amp;gt;          ts.setLongValue(Long.parseLong(v));&lt;br/&gt;
&amp;gt;          break;&lt;/p&gt;

&lt;p&gt;The NFE gets all the way out to RequestHandlerBase.handleRequest():&lt;/p&gt;

&lt;p&gt;&amp;gt; catch (Exception e) {&lt;br/&gt;
&amp;gt;      SolrException.log(SolrCore.log,e);&lt;br/&gt;
&amp;gt;      if (e instanceof ParseException) &lt;/p&gt;
{
&amp;gt;        e = new SolrException(SolrException.ErrorCode.BAD_REQUEST, e);
&amp;gt;      }

&lt;p&gt;but is not caught here, and ends up coming out of SolrDispatchFilter.sendError as a 500.&lt;/p&gt;

&lt;p&gt;Simply catching NFE and turning it into a SolrException does the trick:&lt;/p&gt;

&lt;p&gt;==== solr/core/src/java/org/apache/solr/analysis/TrieTokenizerFactory.java#1 - /4.0-trunk-09082011/solr/core/src/java/org/apache/solr/analysis/TrieTokenizerFactory.java ====&lt;br/&gt;
110a111,112&lt;br/&gt;
&amp;gt;     } catch (NumberFormatException e) {&lt;br/&gt;
&amp;gt;         throw new SolrException(SolrException.ErrorCode.BAD_REQUEST, &quot;Unable to parse input&quot;, e);&lt;/p&gt;</description>
                <environment>&lt;p&gt;4.0 trunk, snapshot taken 09/08/2011.&lt;/p&gt;</environment>
        <key id="12526053">SOLR-2813</key>
            <summary>TrieTokenizerFactory should catch NumberFormatException, return 400 (not 500)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="jeffrey.crump@gmail.com">Jeff Crump</reporter>
                        <labels>
                    </labels>
                <created>Thu, 6 Oct 2011 14:38:32 +0000</created>
                <updated>Fri, 10 May 2013 10:38:39 +0000</updated>
                            <resolved>Thu, 17 Nov 2011 00:22:37 +0000</resolved>
                                    <version>3.4</version>
                    <version>4.0-ALPHA</version>
                                    <fixVersion>4.0-ALPHA</fixVersion>
                                    <component>Schema and Analysis</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="3600">1h</timeoriginalestimate>
                            <timeestimate seconds="3600">1h</timeestimate>
                                        <comments>
                            <comment id="13150953" author="hossman" created="Wed, 16 Nov 2011 01:32:12 +0000"  >&lt;p&gt;Jeff: thanks for reporting this.&lt;/p&gt;

&lt;p&gt;I&apos;ve committed a match similar to what you proposed (except with slightly different scoping so we can include the value in the error message) to trunk...&lt;/p&gt;

&lt;p&gt;Committed revision 1202499.&lt;/p&gt;

&lt;p&gt;...and i&apos;m currently testing the backport to 3x&lt;/p&gt;</comment>
                            <comment id="13150982" author="hossman" created="Wed, 16 Nov 2011 02:51:56 +0000"  >&lt;p&gt;Ok .. backporting has lead me into some confusion.&lt;/p&gt;

&lt;p&gt;The new tests were failing, which lead me to an investigation where i discovered that TrieTokenizerFactory isn&apos;t used as much as I thought &amp;#8211; some of the things I was testing for were actually dependent on &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2402&quot; title=&quot;Add more debug info for DocumentBuilder errors&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2402&quot;&gt;&lt;del&gt;SOLR-2402&lt;/del&gt;&lt;/a&gt;, so I backported that to 3x.&lt;/p&gt;

&lt;p&gt;Once that was done, backporting this patch caused queries and updates with malformed numbers to both return 400 errors instead of 500 errors in ad-hoc testing, but it still didn&apos;t fix the failures in BasicFunctionalityTest.  Digging in a little more the problem seems to be that on trunk, the TestHarness.update method uses DirectSolrConnection which propgates any errors into the test framework, while on the 3x branch it&apos;s still using XmlUpdateRequestHandler.doLegacyUpdate so the exception is hidden from the test.&lt;/p&gt;

&lt;p&gt;I need to look at this again tomorrow when i have some more time &amp;#8211; the functionality of this patch is good to go on 3x, it&apos;s just the damn test case that is anoying.&lt;/p&gt;

&lt;p&gt;(Looks like the TestHarness changes are from r1054124 as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1930&quot; title=&quot;remove solr deprecations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1930&quot;&gt;&lt;del&gt;SOLR-1930&lt;/del&gt;&lt;/a&gt; ... maybe just backport the test changes from that commit w/o removing the deprecated method?)&lt;/p&gt;</comment>
                            <comment id="13151674" author="hossman" created="Thu, 17 Nov 2011 00:22:37 +0000"  >&lt;p&gt;Sorry ... I&apos;ve given up on trying to backport this to 3x.&lt;/p&gt;

&lt;p&gt;After beating my head against a wall trying to merge r1054124, I just manually hacked the cahnges in, got all existing tests to pass, and then backported r1202499 only to discover that on the 3x branch TrieTokenizerFactory evidently isn&apos;t used in all the same places, so the NFE was propagating all the way up.&lt;/p&gt;

&lt;p&gt;I&apos;m moving on to other things, so resolving this for now.  Can be re-opened as needed if someone decides to tackle the backport.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>49619</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 1 week, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03if3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>18417</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>