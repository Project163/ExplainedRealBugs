<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:18:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-1953] It may be possible for temporary files to accumulator until the Solr process is shut down</title>
                <link>https://issues.apache.org/jira/browse/SOLR-1953</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;While researching &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1951&quot; title=&quot;extractingUpdateHandler doesn&amp;#39;t close socket handles promptly, and indexing load tests eventually run out of resources&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1951&quot;&gt;&lt;del&gt;SOLR-1951&lt;/del&gt;&lt;/a&gt;, the behavior of commons-fileupload in handling multipart form posts came into question.  commons-fileupload creates a temporary file for the main content area of such posts, and purportedly has a background thread which cleans up these files.  However, Mark Miller discovered that the javadoc in this matter may be incorrect, and that commons-fileupload may in fact just be adding files to the JVM&apos;s list of files needing cleanup on exit.&lt;/p&gt;

&lt;p&gt;If so, this will show up in two ways: first, temporary files will accumulate in the java.io.tmpdir area.  Second, non-heap memory for the JVM will slowly increase over time (since the file pointers the JVM tracks in this way are not kept in the java heap).&lt;/p&gt;

&lt;p&gt;I will attach a potential fix; however, this ticket should be viewed as a workitem for the need for further research in this area.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12466982">SOLR-1953</key>
            <summary>It may be possible for temporary files to accumulator until the Solr process is shut down</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="markrmiller@gmail.com">Mark Miller</assignee>
                                    <reporter username="kwright@metacarta.com">Karl Wright</reporter>
                        <labels>
                            <label>file_leak</label>
                            <label>memory_leak</label>
                    </labels>
                <created>Tue, 15 Jun 2010 10:59:45 +0000</created>
                <updated>Thu, 13 Apr 2017 10:50:26 +0000</updated>
                            <resolved>Mon, 19 Dec 2016 18:28:23 +0000</resolved>
                                    <version>1.4.1</version>
                    <version>1.5</version>
                                    <fixVersion>6.4</fixVersion>
                    <fixVersion>7.0</fixVersion>
                                    <component>update</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="12878929" author="kwright@metacarta.com" created="Tue, 15 Jun 2010 11:09:31 +0000"  >&lt;p&gt;Patch that Mark Miller proposed, if it turns out that his analysis is correct.&lt;/p&gt;</comment>
                            <comment id="12878950" author="markrmiller@gmail.com" created="Tue, 15 Jun 2010 12:06:34 +0000"  >&lt;p&gt;I&apos;ve got to look at the code - but I wonder if this should be a shared instance that is reused - the cleaner uses a thread that has a special call related to shutting it down. I don&apos;t remember all of the specifics, and I have to look at the commons code, but it may not make sense to use a new cleaner on every object creation. Will post back.&lt;/p&gt;</comment>
                            <comment id="12879214" author="markrmiller@gmail.com" created="Wed, 16 Jun 2010 01:04:10 +0000"  >&lt;p&gt;Yup - def looks to me like we only want one Tracker instance rather than a new one everytime - and we also want to call exitWhenFinished in some clean up code - perhaps in SolrDispatchFilter#destroy()&lt;/p&gt;</comment>
                            <comment id="12886470" author="markrmiller@gmail.com" created="Thu, 8 Jul 2010 20:53:41 +0000"  >&lt;p&gt;I think we want something more like this - though it deserves some more thought.&lt;/p&gt;</comment>
                            <comment id="12886479" author="kwright@metacarta.com" created="Thu, 8 Jul 2010 21:18:01 +0000"  >&lt;p&gt;Looks good to me...&lt;/p&gt;</comment>
                            <comment id="15552541" author="arafalov" created="Thu, 6 Oct 2016 17:10:47 +0000"  >&lt;p&gt;Looking at the code, we may &lt;em&gt;still&lt;/em&gt; have this type of memory leaks discussed in 1.4. At least I don&apos;t see any registrations with setFileCleaningTracker() as suggested in the patch.&lt;/p&gt;</comment>
                            <comment id="15739469" author="moscovig" created="Sun, 11 Dec 2016 09:52:49 +0000"  >&lt;p&gt;Hey. Do you think it is somehow related to the next issue (using solr 6.2.1): &lt;/p&gt;

&lt;p&gt;An increasing &apos;slab&apos; memory consumption. &lt;/p&gt;

&lt;p&gt;When running `slabtop` we get a 14g under &apos;dentry&apos; and counting.&lt;/p&gt;</comment>
                            <comment id="15740677" author="markrmiller@gmail.com" created="Mon, 12 Dec 2016 01:25:28 +0000"  >&lt;p&gt;Wow this is old. Lost it I guess.&lt;/p&gt;</comment>
                            <comment id="15742604" author="markrmiller@gmail.com" created="Mon, 12 Dec 2016 17:57:04 +0000"  >&lt;blockquote&gt;&lt;p&gt;Hey. Do you think it is somehow related ...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Unless you are multi-part posting lots of files to Solr (with the tika integration for example), not very likely.&lt;/p&gt;</comment>
                            <comment id="15746982" author="markrmiller@gmail.com" created="Wed, 14 Dec 2016 02:23:11 +0000"  >&lt;p&gt;I&apos;ll commit this soon.&lt;/p&gt;</comment>
                            <comment id="15749084" author="jira-bot" created="Wed, 14 Dec 2016 18:38:03 +0000"  >&lt;p&gt;Commit e82399d0677651ad4be1d8d2bdc4777b5d90b0fa in lucene-solr&apos;s branch refs/heads/master from markrmiller&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e82399d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e82399d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1953&quot; title=&quot;It may be possible for temporary files to accumulator until the Solr process is shut down&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1953&quot;&gt;&lt;del&gt;SOLR-1953&lt;/del&gt;&lt;/a&gt;: It may be possible for temporary files to accumulate until the Solr process is shut down.&lt;/p&gt;</comment>
                            <comment id="15750089" author="jira-bot" created="Thu, 15 Dec 2016 01:56:23 +0000"  >&lt;p&gt;Commit 96b492c05e9384b8dfb9d62823af17cf012fddbb in lucene-solr&apos;s branch refs/heads/branch_6x from markrmiller&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=96b492c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=96b492c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1953&quot; title=&quot;It may be possible for temporary files to accumulator until the Solr process is shut down&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1953&quot;&gt;&lt;del&gt;SOLR-1953&lt;/del&gt;&lt;/a&gt;: It may be possible for temporary files to accumulate until the Solr process is shut down.&lt;/p&gt;</comment>
                            <comment id="15761913" author="markrmiller@gmail.com" created="Mon, 19 Dec 2016 18:28:24 +0000"  >&lt;p&gt;Thanks Karl! Long lived issue.&lt;/p&gt;</comment>
                            <comment id="15967235" author="schuchm" created="Thu, 13 Apr 2017 07:29:25 +0000"  >&lt;p&gt;We ran into this Issue with an Solr 4.x System and before finding this ticket i found &lt;a href=&quot;https://issues.apache.org/jira/browse/FILEUPLOAD-189&quot; title=&quot;DiskFileItemFactory use of FileCleaningTracker is documented or coded wrong&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FILEUPLOAD-189&quot;&gt;&lt;del&gt;FILEUPLOAD-189&lt;/del&gt;&lt;/a&gt;. So when someone wants to port the patch to older solr versions, you need also have to look at the commons-fileupload version.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12466902">SOLR-1951</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12503607">FILEUPLOAD-189</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12842831" name="SOLR-1953.patch" size="11370" author="markrmiller@gmail.com" created="Mon, 12 Dec 2016 17:54:44 +0000"/>
                            <attachment id="12449004" name="SOLR-1953.patch" size="1902" author="markrmiller@gmail.com" created="Thu, 8 Jul 2010 20:53:41 +0000"/>
                            <attachment id="12447124" name="SOLR-1953.patch" size="722" author="kwright@metacarta.com" created="Tue, 15 Jun 2010 11:09:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>430</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 31 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03npb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19273</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>