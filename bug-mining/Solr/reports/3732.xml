<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:29:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-11740] bin/solr stop command always throws Connection refused</title>
                <link>https://issues.apache.org/jira/browse/SOLR-11740</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Start solr using &lt;tt&gt;./bin/solr start -e cloud -noprompt&lt;/tt&gt; and then try stopping it. I ran into this problem every time I stopping solr on master. I&apos;m using Java9 and it works fine on Solr 7.1 ( haven&apos;t checked on the 7_2 branch yet )&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;master&amp;#93;&lt;/span&gt; ~/apache-work/lucene-solr/solr$ ./bin/solr  stop -all&lt;br/&gt;
Sending stop command to Solr running on port 7574 ... waiting up to 180 seconds to allow Jetty process 40360 to stop gracefully.&lt;br/&gt;
Sending stop command to Solr running on port 8983 ... waiting up to 180 seconds to allow Jetty process 40263 to stop gracefully.&lt;br/&gt;
java.net.ConnectException: Connection refused (Connection refused)&lt;br/&gt;
	at java.net.PlainSocketImpl.socketConnect(Native Method)&lt;br/&gt;
	at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:350)&lt;br/&gt;
	at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:206)&lt;br/&gt;
	at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:188)&lt;br/&gt;
	at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)&lt;br/&gt;
	at java.net.Socket.connect(Socket.java:589)&lt;br/&gt;
	at java.net.Socket.connect(Socket.java:538)&lt;br/&gt;
	at java.net.Socket.&amp;lt;init&amp;gt;(Socket.java:434)&lt;br/&gt;
	at java.net.Socket.&amp;lt;init&amp;gt;(Socket.java:244)&lt;br/&gt;
	at org.eclipse.jetty.start.Main.stop(Main.java:535)&lt;br/&gt;
	at org.eclipse.jetty.start.Main.stop(Main.java:511)&lt;br/&gt;
	at org.eclipse.jetty.start.Main.doStop(Main.java:499)&lt;br/&gt;
	at org.eclipse.jetty.start.Main.start(Main.java:404)&lt;br/&gt;
	at org.eclipse.jetty.start.Main.main(Main.java:76)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13123884">SOLR-11740</key>
            <summary>bin/solr stop command always throws Connection refused</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cpoerschke">Christine Poerschke</assignee>
                                    <reporter username="varun">Varun Thacker</reporter>
                        <labels>
                    </labels>
                <created>Sat, 9 Dec 2017 07:46:05 +0000</created>
                <updated>Wed, 2 Oct 2019 17:23:14 +0000</updated>
                            <resolved>Wed, 13 Dec 2017 11:28:35 +0000</resolved>
                                    <version>7.2</version>
                    <version>8.0</version>
                                    <fixVersion>7.2</fixVersion>
                    <fixVersion>8.0</fixVersion>
                                    <component>scripts and tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16284654" author="varunthacker" created="Sat, 9 Dec 2017 07:52:42 +0000"  >&lt;p&gt;This reproduced on branch_7_2 as well unfortunately! &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[branch_7_2] ~/apache-work/lucene-solr/solr$ ./bin/solr  stop -all
Sending stop command to Solr running on port 7574 ... waiting up to 180 seconds to allow Jetty process 42384 to stop gracefully.
Sending stop command to Solr running on port 8983 ... waiting up to 180 seconds to allow Jetty process 42285 to stop gracefully.
java.net.ConnectException: Connection refused (Connection refused)
	at java.base/java.net.PlainSocketImpl.socketConnect(Native Method)
	at java.base/java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:400)
	at java.base/java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:243)
	at java.base/java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:225)
	at java.base/java.net.SocksSocketImpl.connect(SocksSocketImpl.java:402)
	at java.base/java.net.Socket.connect(Socket.java:591)
	at java.base/java.net.Socket.connect(Socket.java:540)
	at java.base/java.net.Socket.&amp;lt;init&amp;gt;(Socket.java:436)
	at java.base/java.net.Socket.&amp;lt;init&amp;gt;(Socket.java:246)
	at org.eclipse.jetty.start.Main.stop(Main.java:535)
	at org.eclipse.jetty.start.Main.stop(Main.java:511)
	at org.eclipse.jetty.start.Main.doStop(Main.java:499)
	at org.eclipse.jetty.start.Main.start(Main.java:404)
	at org.eclipse.jetty.start.Main.main(Main.java:76)

Usage: java -jar start.jar [options] [properties] [configs]
       java -jar start.jar --help  # &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; more information
 [\]  

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The spinner keeps moving for minutes and nothing happens. &lt;/p&gt;

&lt;p&gt;I can reproduce it 100% of the time with both Java8 and Java9&lt;/p&gt;</comment>
                            <comment id="16284655" author="varunthacker" created="Sat, 9 Dec 2017 07:55:57 +0000"  >&lt;p&gt;This works:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[branch_7_2] ~/apache-work/lucene-solr/solr$ ./bin/solr  start -c
Waiting up to 180 seconds to see Solr running on port 8983 [\]  
Started Solr server on port 8983 (pid=43788). Happy searching!

[branch_7_2] ~/apache-work/lucene-solr/solr$ ./bin/solr  stop -all
Sending stop command to Solr running on port 8983 ... waiting up to 180 seconds to allow Jetty process 43788 to stop gracefully.

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16286087" author="erickerickson" created="Mon, 11 Dec 2017 16:03:32 +0000"  >&lt;p&gt;FWIW, the -noprompt is unnecessary, I see the same thing with:&lt;/p&gt;

&lt;p&gt;./bin/solr start -e cloud&lt;/p&gt;

&lt;p&gt;And the server stack trace looks like this (7x) OS X Java 1.8.0_121:&lt;/p&gt;

&lt;p&gt;INFO  - 2017-12-11 15:58:13.281; [   ] org.apache.solr.common.cloud.ZkStateReader$StateWatcher; A cluster state change: &lt;span class=&quot;error&quot;&gt;&amp;#91;WatchedEvent state:SyncConnected type:NodeDataChanged path:/collections/gettingstarted/state.json&amp;#93;&lt;/span&gt; for collection &lt;span class=&quot;error&quot;&gt;&amp;#91;gettingstarted&amp;#93;&lt;/span&gt; has occurred - updating... (live nodes size: &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;)&lt;br/&gt;
INFO  - 2017-12-11 15:58:13.282; &lt;span class=&quot;error&quot;&gt;&amp;#91;c:gettingstarted s:shard1 r:core_node3 x:gettingstarted_shard1_replica_n1&amp;#93;&lt;/span&gt; org.apache.solr.core.SolrCore; &lt;span class=&quot;error&quot;&gt;&amp;#91;gettingstarted_shard1_replica_n1&amp;#93;&lt;/span&gt;  CLOSING SolrCore org.apache.solr.core.SolrCore@34804f5b&lt;br/&gt;
INFO  - 2017-12-11 15:58:13.282; &lt;span class=&quot;error&quot;&gt;&amp;#91;c:gettingstarted s:shard2 r:core_node7 x:gettingstarted_shard2_replica_n4&amp;#93;&lt;/span&gt; org.apache.solr.core.SolrCore; &lt;span class=&quot;error&quot;&gt;&amp;#91;gettingstarted_shard2_replica_n4&amp;#93;&lt;/span&gt;  CLOSING SolrCore org.apache.solr.core.SolrCore@21c3203d&lt;br/&gt;
INFO  - 2017-12-11 15:58:13.282; &lt;span class=&quot;error&quot;&gt;&amp;#91;c:gettingstarted s:shard1 r:core_node3 x:gettingstarted_shard1_replica_n1&amp;#93;&lt;/span&gt; org.apache.solr.metrics.SolrMetricManager; Closing metric reporters for registry=solr.core.gettingstarted.shard1.replica_n1, tag=880824155&lt;br/&gt;
INFO  - 2017-12-11 15:58:13.283; &lt;span class=&quot;error&quot;&gt;&amp;#91;c:gettingstarted s:shard1 r:core_node3 x:gettingstarted_shard1_replica_n1&amp;#93;&lt;/span&gt; org.apache.solr.metrics.SolrMetricManager; Closing metric reporters for registry=solr.collection.gettingstarted.shard1.leader, tag=880824155&lt;br/&gt;
INFO  - 2017-12-11 15:58:13.283; &lt;span class=&quot;error&quot;&gt;&amp;#91;c:gettingstarted s:shard2 r:core_node7 x:gettingstarted_shard2_replica_n4&amp;#93;&lt;/span&gt; org.apache.solr.metrics.SolrMetricManager; Closing metric reporters for registry=solr.core.gettingstarted.shard2.replica_n4, tag=566435901&lt;br/&gt;
INFO  - 2017-12-11 15:58:13.283; &lt;span class=&quot;error&quot;&gt;&amp;#91;c:gettingstarted s:shard2 r:core_node7 x:gettingstarted_shard2_replica_n4&amp;#93;&lt;/span&gt; org.apache.solr.metrics.SolrMetricManager; Closing metric reporters for registry=solr.collection.gettingstarted.shard2.leader, tag=566435901&lt;br/&gt;
INFO  - 2017-12-11 15:58:13.291; [   ] org.apache.solr.cloud.Overseer; Overseer (id=99156481766129664-192.168.1.222:8983_solr-n_0000000000) closing&lt;br/&gt;
INFO  - 2017-12-11 15:58:13.292; [   ] org.apache.solr.cloud.Overseer$ClusterStateUpdater; Overseer Loop exiting : 192.168.1.222:8983_solr&lt;br/&gt;
WARN  - 2017-12-11 15:58:13.292; [   ] org.apache.solr.cloud.autoscaling.OverseerTriggerThread; OverseerTriggerThread woken up but we are closed, exiting.&lt;br/&gt;
WARN  - 2017-12-11 15:58:13.295; [   ] org.apache.zookeeper.server.ZooKeeperServerMain; Server interrupted&lt;br/&gt;
java.lang.InterruptedException&lt;br/&gt;
	at java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireSharedInterruptibly(AbstractQueuedSynchronizer.java:998)&lt;br/&gt;
	at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireSharedInterruptibly(AbstractQueuedSynchronizer.java:1304)&lt;br/&gt;
	at java.util.concurrent.CountDownLatch.await(CountDownLatch.java:231)&lt;br/&gt;
	at org.apache.zookeeper.server.ZooKeeperServerMain.runFromConfig(ZooKeeperServerMain.java:122)&lt;br/&gt;
	at org.apache.solr.cloud.SolrZkServer$1.run(SolrZkServer.java:116)&lt;br/&gt;
INFO  - 2017-12-11 15:58:13.298; [   ] org.apache.solr.cloud.SolrZkServer$1; ZooKeeper Server exited.&lt;br/&gt;
ERROR - 2017-12-11 15:58:13.298; [   ] org.apache.zookeeper.server.ZooKeeperCriticalThread; Severe unrecoverable error, from thread : SyncThread:0&lt;br/&gt;
java.nio.channels.ClosedChannelException&lt;br/&gt;
	at sun.nio.ch.FileChannelImpl.ensureOpen(FileChannelImpl.java:110)&lt;br/&gt;
	at sun.nio.ch.FileChannelImpl.position(FileChannelImpl.java:253)&lt;br/&gt;
	at org.apache.zookeeper.server.persistence.Util.padLogFile(Util.java:215)&lt;br/&gt;
	at org.apache.zookeeper.server.persistence.FileTxnLog.padFile(FileTxnLog.java:241)&lt;br/&gt;
	at org.apache.zookeeper.server.persistence.FileTxnLog.append(FileTxnLog.java:219)&lt;br/&gt;
	at org.apache.zookeeper.server.persistence.FileTxnSnapLog.append(FileTxnSnapLog.java:324)&lt;br/&gt;
	at org.apache.zookeeper.server.ZKDatabase.append(ZKDatabase.java:470)&lt;br/&gt;
	at org.apache.zookeeper.server.SyncRequestProcessor.run(SyncRequestProcessor.java:140)&lt;br/&gt;
INFO  - 2017-12-11 15:58:13.300; [   ] org.eclipse.jetty.server.handler.ContextHandler; Stopped o.e.j.w.WebAppContext@7a1ebcd8&lt;/p&gt;
{/solr,null,UNAVAILABLE}
{/Users/Erick/apache/solrJiras/branch_7x/solr/server/solr-webapp/webapp}

&lt;p&gt;I can&apos;t pursue it ATM I&apos;m afraid.&lt;/p&gt;</comment>
                            <comment id="16286088" author="ctargett" created="Mon, 11 Dec 2017 16:03:35 +0000"  >&lt;p&gt;It&apos;s also possible to duplicate this with &lt;tt&gt;bin/solr start -c&lt;/tt&gt; if you then start another node on another port (7574) and create a collection with &lt;tt&gt;bin/solr create&lt;/tt&gt; (I did the create with &lt;tt&gt;-s 2 -rf 2&lt;/tt&gt; options). It&apos;s always the port 8983 instance that fails to stop &amp;amp; that&apos;s the one that launches ZK &amp;amp; is the leader.&lt;/p&gt;

&lt;p&gt;My suspicion is that it&apos;s somehow related to autoAddReplicas and autoscaling features - during the stop shutdown, the shutdown of port 7574 registers as a &quot;nodeLost&quot; event, which you can see in logs. I wonder if there is something blocking the shutdown of port 8983? I can&apos;t really tell from the logs if it&apos;s just registering the event or if it&apos;s actually trying to do something:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2017-12-11 15:53:24.737 INFO  (zkCallback-3-thread-7-processing-n:192.168.0.28:8983_solr) [   ] o.a.s.c.c.ZkStateReader A cluster state change: [WatchedEvent state:SyncConnected type:NodeDataChanged path:/collections/test/state.json] &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; collection [test] has occurred - updating... (live nodes size: [1])
2017-12-11 15:53:24.745 INFO  (zkCallback-3-thread-5-processing-n:192.168.0.28:8983_solr) [c:test s:shard2 r:core_node8 x:test_shard2_replica_n6] o.a.s.c.ShardLeaderElectionContext I may be the &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; leader - &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; and sync
2017-12-11 15:53:24.850 INFO  (zkCallback-3-thread-8-processing-n:192.168.0.28:8983_solr) [   ] o.a.s.c.c.ZkStateReader A cluster state change: [WatchedEvent state:SyncConnected type:NodeDataChanged path:/collections/test/state.json] &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; collection [test] has occurred - updating... (live nodes size: [1])
2017-12-11 15:53:24.850 INFO  (zkCallback-3-thread-6-processing-n:192.168.0.28:8983_solr) [   ] o.a.s.c.c.ZkStateReader A cluster state change: [WatchedEvent state:SyncConnected type:NodeDataChanged path:/collections/test/state.json] &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; collection [test] has occurred - updating... (live nodes size: [1])
2017-12-11 15:53:27.248 INFO  (zkCallback-3-thread-5-processing-n:192.168.0.28:8983_solr) [c:test s:shard2 r:core_node8 x:test_shard2_replica_n6] o.a.s.c.SyncStrategy Sync replicas to http:&lt;span class=&quot;code-comment&quot;&gt;//192.168.0.28:8983/solr/test_shard2_replica_n6/
&lt;/span&gt;2017-12-11 15:53:27.249 INFO  (zkCallback-3-thread-5-processing-n:192.168.0.28:8983_solr) [c:test s:shard2 r:core_node8 x:test_shard2_replica_n6] o.a.s.c.SyncStrategy Sync Success - now sync replicas to me
2017-12-11 15:53:27.249 INFO  (zkCallback-3-thread-5-processing-n:192.168.0.28:8983_solr) [c:test s:shard2 r:core_node8 x:test_shard2_replica_n6] o.a.s.c.SyncStrategy http:&lt;span class=&quot;code-comment&quot;&gt;//192.168.0.28:8983/solr/test_shard2_replica_n6/ has no replicas
&lt;/span&gt;2017-12-11 15:53:27.254 INFO  (zkCallback-3-thread-5-processing-n:192.168.0.28:8983_solr) [c:test s:shard2 r:core_node8 x:test_shard2_replica_n6] o.a.s.c.ShardLeaderElectionContext I am the &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; leader: http:&lt;span class=&quot;code-comment&quot;&gt;//192.168.0.28:8983/solr/test_shard2_replica_n6/ shard2
&lt;/span&gt;2017-12-11 15:53:27.255 INFO  (zkCallback-3-thread-5-processing-n:192.168.0.28:8983_solr) [   ] o.a.s.c.c.ZkStateReader A cluster state change: [WatchedEvent state:SyncConnected type:NodeDataChanged path:/collections/test/state.json] &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; collection [test] has occurred - updating... (live nodes size: [1])
2017-12-11 15:53:27.255 INFO  (zkCallback-3-thread-6-processing-n:192.168.0.28:8983_solr) [   ] o.a.s.c.c.ZkStateReader A cluster state change: [WatchedEvent state:SyncConnected type:NodeDataChanged path:/collections/test/state.json] &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; collection [test] has occurred - updating... (live nodes size: [1])
2017-12-11 15:53:55.582 INFO  (ScheduledTrigger-6-thread-2) [   ] o.a.s.c.a.SystemLogListener Collection .system does not exist, disabling logging.
2017-12-11 15:53:55.601 INFO  (qtp575335780-14) [   ] o.a.s.s.HttpSolrCall [admin] webapp=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; path=/admin/metrics params={prefix=CORE.coreName&amp;amp;wt=javabin&amp;amp;version=2&amp;amp;group=solr.core} status=0 QTime=6
2017-12-11 15:53:55.606 INFO  (AutoscalingActionExecutor-7-thread-1-processing-n:192.168.0.28:8983_solr) [   ] o.a.s.c.a.ExecutePlanAction No operations to execute &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; event: {
  &lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;14ff48669eb06380Tbkths0f4h9k570n1nrsqrq81v&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;source&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;.auto_add_replicas&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;eventTime&quot;&lt;/span&gt;:1513007605406000000,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;eventType&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;NODELOST&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;properties&quot;&lt;/span&gt;:{
    &lt;span class=&quot;code-quote&quot;&gt;&quot;eventTimes&quot;&lt;/span&gt;:[1513007605406000000],
    &lt;span class=&quot;code-quote&quot;&gt;&quot;_enqueue_time_&quot;&lt;/span&gt;:1513007635493000000,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;nodeNames&quot;&lt;/span&gt;:[&lt;span class=&quot;code-quote&quot;&gt;&quot;192.168.0.28:7574_solr&quot;&lt;/span&gt;]}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think it&apos;s just registering the event, but doesn&apos;t or can&apos;t actually do anything since it&apos;s a single node (IOW, there isn&apos;t anywhere for it to do anything in this scenario). I saw it eventually time out and forcefully kill the process, but it seems Varun didn&apos;t see that (it was ~5 minutes before it did that, I think).&lt;/p&gt;

&lt;p&gt;Probably need &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat&quot; class=&quot;user-hover&quot; rel=&quot;caomanhdat&quot;&gt;caomanhdat&lt;/a&gt; to take a look to see if my hunch is correct.&lt;/p&gt;

&lt;p&gt;If that&apos;s not it, &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9137&quot; title=&quot;solr-script ignores custom STOP_PORT on shutdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9137&quot;&gt;&lt;del&gt;SOLR-9137&lt;/del&gt;&lt;/a&gt; made some change to the stop behavior and IMO would be the 2nd place to look.&lt;/p&gt;</comment>
                            <comment id="16287545" author="cpoerschke" created="Tue, 12 Dec 2017 12:47:41 +0000"  >&lt;p&gt;Thanks everyone for noticing and looking into this! Yes, looks like &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9137&quot; title=&quot;solr-script ignores custom STOP_PORT on shutdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9137&quot;&gt;&lt;del&gt;SOLR-9137&lt;/del&gt;&lt;/a&gt; broke this i.e. the first instance is stopped successfully and then the &apos;local&apos; STOP_PORT variable carries over to the stopping of subsequent instances which naturally won&apos;t work.&lt;/p&gt;

&lt;p&gt;Attached patch for &lt;tt&gt;bin/solr&lt;/tt&gt; avoids this by giving the local variable another name, perhaps there is a different way to achieve the equivalent? Will try and figure out the &lt;tt&gt;bin/solr.cmd&lt;/tt&gt; equivalent next.&lt;/p&gt;</comment>
                            <comment id="16287747" author="cpoerschke" created="Tue, 12 Dec 2017 15:29:00 +0000"  >&lt;p&gt;Looks like &lt;tt&gt;bin/solr.cmd&lt;/tt&gt; is unaffected i.e. no changes needed for that.&lt;/p&gt;</comment>
                            <comment id="16289122" author="jira-bot" created="Wed, 13 Dec 2017 11:24:50 +0000"  >&lt;p&gt;Commit 7974aa033c7985b4d0dde92776b12ee50aa9ee5c in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke&quot; class=&quot;user-hover&quot; rel=&quot;cpoerschke&quot;&gt;cpoerschke&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7974aa0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7974aa0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11740&quot; title=&quot;bin/solr stop command always throws Connection refused&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11740&quot;&gt;&lt;del&gt;SOLR-11740&lt;/del&gt;&lt;/a&gt;: fix stop port variable scope issue in stop_solr function (&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9137&quot; title=&quot;solr-script ignores custom STOP_PORT on shutdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9137&quot;&gt;&lt;del&gt;SOLR-9137&lt;/del&gt;&lt;/a&gt; follow-on)&lt;/p&gt;</comment>
                            <comment id="16289125" author="jira-bot" created="Wed, 13 Dec 2017 11:25:54 +0000"  >&lt;p&gt;Commit b2049d4ad2b53dd9d5370e7ba6b406976bc5a71a in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke&quot; class=&quot;user-hover&quot; rel=&quot;cpoerschke&quot;&gt;cpoerschke&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b2049d4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b2049d4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11740&quot; title=&quot;bin/solr stop command always throws Connection refused&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11740&quot;&gt;&lt;del&gt;SOLR-11740&lt;/del&gt;&lt;/a&gt;: fix stop port variable scope issue in stop_solr function (&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9137&quot; title=&quot;solr-script ignores custom STOP_PORT on shutdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9137&quot;&gt;&lt;del&gt;SOLR-9137&lt;/del&gt;&lt;/a&gt; follow-on)&lt;/p&gt;</comment>
                            <comment id="16289127" author="jira-bot" created="Wed, 13 Dec 2017 11:26:47 +0000"  >&lt;p&gt;Commit 127ee7457f358059ef1cb242033a14381d0a0cdf in lucene-solr&apos;s branch refs/heads/branch_7_2 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke&quot; class=&quot;user-hover&quot; rel=&quot;cpoerschke&quot;&gt;cpoerschke&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=127ee74&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=127ee74&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11740&quot; title=&quot;bin/solr stop command always throws Connection refused&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11740&quot;&gt;&lt;del&gt;SOLR-11740&lt;/del&gt;&lt;/a&gt;: fix stop port variable scope issue in stop_solr function (&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9137&quot; title=&quot;solr-script ignores custom STOP_PORT on shutdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9137&quot;&gt;&lt;del&gt;SOLR-9137&lt;/del&gt;&lt;/a&gt; follow-on)&lt;/p&gt;</comment>
                            <comment id="16289132" author="cpoerschke" created="Wed, 13 Dec 2017 11:28:35 +0000"  >&lt;p&gt;Thanks everyone!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13124384">SOLR-11749</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12971505">SOLR-9137</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12901672" name="SOLR-11740.patch" size="838" author="cpoerschke" created="Tue, 12 Dec 2017 12:43:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 48 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3nq0f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>