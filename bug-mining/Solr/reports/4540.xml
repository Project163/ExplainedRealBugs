<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:45:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-12847] Cut over implementation of maxShardsPerNode to a collection policy</title>
                <link>https://issues.apache.org/jira/browse/SOLR-12847</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;We&apos;ve back and forth over handling maxShardsPerNode with autoscaling policies (see &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11005&quot; title=&quot;inconsistency when maxShardsPerNode used along with policies&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11005&quot;&gt;&lt;del&gt;SOLR-11005&lt;/del&gt;&lt;/a&gt; for history). Now that we&apos;ve reimplemented support for creating collections with maxShardsPerNode when autoscaling policy is enabled, we should re-look at how it is implemented.&lt;/p&gt;

&lt;p&gt;I propose that we fold maxShardsPerNode (if specified) to a collection level policy that overrides the corresponding default in cluster policy (see &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12845&quot; title=&quot;Add a default cluster policy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12845&quot;&gt;&lt;del&gt;SOLR-12845&lt;/del&gt;&lt;/a&gt;). We&apos;ll need to ensure that if maxShardsPerNode is specified then the user sees neither violations nor corresponding suggestions because of the default cluster policy.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13190310">SOLR-12847</key>
            <summary>Cut over implementation of maxShardsPerNode to a collection policy</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="ab">Andrzej Bialecki</assignee>
                                    <reporter username="shalin">Shalin Shekhar Mangar</reporter>
                        <labels>
                    </labels>
                <created>Tue, 9 Oct 2018 08:12:21 +0000</created>
                <updated>Thu, 12 May 2022 00:26:15 +0000</updated>
                            <resolved>Mon, 27 Jul 2020 11:01:42 +0000</resolved>
                                                    <fixVersion>9.0</fixVersion>
                                    <component>AutoScaling</component>
                    <component>SolrCloud</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3600">1h</timespent>
                                <comments>
                            <comment id="17083310" author="ab" created="Tue, 14 Apr 2020 14:55:41 +0000"  >&lt;p&gt;I started working on this (see the PR) but quite a few tests started failing when this automatically-created policy has been added instead of &lt;tt&gt;maxShardsPerNode&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;It turns out that in many cases the auto-created policy overrode the cluster policy, specifically the non-strict rule that specifies the max number of replicas per node. It seems that using just the autoscaling rules it&apos;s not possible in general case to both preserve the existing semantics of &lt;tt&gt;maxShardsPerNode&lt;/tt&gt; and also preserve the cluster policy rules - because the auto-created policy will override the cluster policy.&lt;/p&gt;

&lt;p&gt;In any case, in branch_8x the only thing that &lt;tt&gt;maxShardsPerNode&lt;/tt&gt; does is to simply compare this value with an average number of collection replicas per node, completely ignoring rules, so it&apos;s useful only as a crude safety guard anyway.&lt;/p&gt;

&lt;p&gt;For this reason, in order to preserve back-compat I&apos;d like to leave the code as-is on branch 8x and instead completely remove &lt;tt&gt;maxShardsPerNode&lt;/tt&gt; from master (9.0).&lt;/p&gt;</comment>
                            <comment id="17153715" author="jira-bot" created="Wed, 8 Jul 2020 15:58:00 +0000"  >&lt;p&gt;Commit cf742f45963f4747e7041e8131248bc3a2b44864 in lucene-solr&apos;s branch refs/heads/master from Andrzej Bialecki&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=cf742f4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=cf742f4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12847&quot; title=&quot;Cut over implementation of maxShardsPerNode to a collection policy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12847&quot;&gt;&lt;del&gt;SOLR-12847&lt;/del&gt;&lt;/a&gt;: Remove support for maxShardsPerNode.&lt;/p&gt;</comment>
                            <comment id="17157368" author="noble.paul" created="Tue, 14 Jul 2020 13:32:55 +0000"  >&lt;p&gt;I&apos;m not sure we should have this. The policy calculations are slow and screwed up. Until we fix that , this should be a bad decision&lt;/p&gt;</comment>
                            <comment id="17157484" author="ab" created="Tue, 14 Jul 2020 16:15:48 +0000"  >&lt;p&gt;This is for 9.0 only. And &lt;tt&gt;maxShardsPerNode&lt;/tt&gt;&#160;was already broken anyway - it didn&apos;t have any impact on the placements, it was just artificially limiting the average number of replicas / nodes.&lt;/p&gt;</comment>
                            <comment id="17157771" author="noble.paul" created="Wed, 15 Jul 2020 00:04:21 +0000"  >&lt;p&gt;Until we have a cleaner interface for replica placement we should avoid using it. If maxShardsPerNode is broken please remove it. Do not use the current placement startegies.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17159578" author="ichattopadhyaya" created="Fri, 17 Jul 2020 00:36:46 +0000"  >&lt;p&gt;We need to keep in mind that, &lt;b&gt;on master (9x)&lt;/b&gt;, with the removal of this and also the autoscaling framework in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14656&quot; title=&quot;Deprecate current autoscaling framework, remove from master&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14656&quot;&gt;&lt;del&gt;SOLR-14656&lt;/del&gt;&lt;/a&gt;, we have no support to restrict maximum replicas placed on a node. This is something that the &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14613&quot; title=&quot;Provide a clean API for pluggable replica assignment implementations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14613&quot;&gt;&lt;del&gt;SOLR-14613&lt;/del&gt;&lt;/a&gt; should address.&lt;/p&gt;</comment>
                            <comment id="17161571" author="gus_heck" created="Mon, 20 Jul 2020 22:02:49 +0000"  >&lt;p&gt;FWIW when I was investigating and fixing the MOVEREPLICA docs I found that maxShardsPerNode is advisory only once the collection is created and in not a hard limit. If destination node is specified in ADDREPLICA it will force placement above the limit and move replica always issues its add with a specified value for the node. Thus, MOVEREPLICA entirely ignores maxShardsPerNode. &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13169&quot; title=&quot;Move Replica Docs need improvement (V1 and V2 introspect)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13169&quot;&gt;&lt;del&gt;SOLR-13169&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17165245" author="erickerickson" created="Sun, 26 Jul 2020 15:08:05 +0000"  >&lt;p&gt;If we put support back in for maxShardsPerNode (and, BTW, can we rename that? It&apos;s always been confusing &apos;cause it&apos;s not about shards really) then at least a new test I&apos;m putting in will break (RouteFieldTest, coming soon).&lt;/p&gt;</comment>
                            <comment id="17165618" author="ab" created="Mon, 27 Jul 2020 11:00:33 +0000"  >&lt;p&gt;With the removal of autoscaling in 9.0 this issue is no longer applicable - closing. If we want a similar functionality in the new framework we should specify and implement it there.&lt;/p&gt;</comment>
                            <comment id="17535305" author="janhoy" created="Thu, 12 May 2022 00:26:15 +0000"  >&lt;p&gt;Closing after the 9.0.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="13298753">SOLR-14409</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13137778">SOLR-11970</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13215730">SOLR-13248</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 26 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3yzan:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>