<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:09:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-17148] Config API lies about setting cache enabled=false</title>
                <link>https://issues.apache.org/jira/browse/SOLR-17148</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Using the stock solr &lt;tt&gt;gettingstarted&lt;/tt&gt; example, you can run the command below and it will give all evidence that it has disabled the document cache:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;curl -X POST &apos;http://localhost:8983/solr/gettingstarted/config/&apos; -H&apos;Content-type: application/json&apos; -d &apos;{&quot;set-property&quot;:{&quot;query.documentCache.enabled&quot;:false}}&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;ul&gt;
	&lt;li&gt;Api command succeeds&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;configoverlay.json&lt;/tt&gt; is updated in ZK&lt;/li&gt;
	&lt;li&gt;SolrCore reloads happen for all of the replicas of this collection&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;...but doesn&apos;t actually disable the cache. It&apos;s still there and in use (easy to verify by executing queries and looking at metrics)&lt;/p&gt;

&lt;p&gt;Explicitly stopping &amp;amp; restarting the solr nodes doesn&apos;t fix the problem either.&lt;/p&gt;

&lt;p&gt;They &lt;tt&gt;enabled&lt;/tt&gt; property name appears to be explicitly allowed by the Config API, because trying to set other arbitrary properties fails (even when supported by the &lt;tt&gt;CaffieneCache&lt;/tt&gt; impl)...&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ curl -X POST &apos;http://localhost:8983/solr/gettingstarted/config/&apos; -H&apos;Content-type: application/json&apos; -d &apos;{&quot;set-property&quot;:{&quot;query.documentCache.async&quot;:false}}&apos;
{
  &quot;responseHeader&quot;:{
    &quot;status&quot;:400,
    &quot;QTime&quot;:8},
  &quot;errorMessages&quot;:[&quot;error processing commands, errors: [{errorMessages=[&apos;query.documentCache.async&apos; is not an editable property], set-property={query.documentCache.async=false}}], \n&quot;],
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;...suggesting that modifying the &lt;tt&gt;enabled&lt;/tt&gt; property is intentionally supported &#8211; but doesn&apos;t work.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;A quick &amp;amp; dirty workaround is setting the size=-1 and ignoring the ERROR in the logs on every newSearcher...&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;curl -X POST &apos;http://localhost:8983/solr/gettingstarted/config/&apos; -H&apos;Content-type: application/json&apos; -d &apos;{&quot;set-property&quot;:{&quot;query.documentCache.size&quot;:-1}}&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;(Which seems to indicate that whatever the problem is, it&apos;s specific to &lt;tt&gt;enabled&lt;/tt&gt; &#8211; and not a general problem with modifying cache configuration via the Config API)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13567229">SOLR-17148</key>
            <summary>Config API lies about setting cache enabled=false</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="epugh">Eric Pugh</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Fri, 2 Feb 2024 18:39:43 +0000</created>
                <updated>Wed, 5 Jun 2024 12:41:34 +0000</updated>
                            <resolved>Tue, 13 Feb 2024 13:50:25 +0000</resolved>
                                                    <fixVersion>9.6</fixVersion>
                                    <component>config-api</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="6000">1h 40m</timespent>
                                <comments>
                            <comment id="17813912" author="JIRAUSER305513" created="Sat, 3 Feb 2024 11:19:09 +0000"  >&lt;p&gt;Thank you for sharing all the info &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman&quot; class=&quot;user-hover&quot; rel=&quot;hossman&quot;&gt;hossman&lt;/a&gt; !&lt;/p&gt;

&lt;p&gt;I looked into this issue and below is the method that being called to initialized the cache objects (documentCache, queryResultCache e.t.c)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#160;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; CacheConfig getConfig(SolrConfig solrConfig, ConfigNode node, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; xpath) {
&#160; &#160;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!node.exists() || !&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;.equals(node.attributes().get(&lt;span class=&quot;code-quote&quot;&gt;&quot;enabled&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;))) {
&#160; &#160; &#160; Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; m = solrConfig.getOverlay().getEditableSubProperties(xpath);
&#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (m == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
&#160; &#160; &#160; List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; parts = StrUtils.splitSmart(xpath, &lt;span class=&quot;code-quote&quot;&gt;&apos;/&apos;&lt;/span&gt;);
&#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; getConfig(solrConfig, parts.get(parts.size() - 1), Collections.emptyMap(), xpath);
&#160; &#160; }
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; getConfig(solrConfig, node.name(), node.attributes().asMap(), xpath);
&#160; }&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Now we disable the cache using below command and configoverlay.json file gets updated as you mentioned.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
curl -X POST &lt;span class=&quot;code-quote&quot;&gt;&apos;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8983/solr/gettingstarted/config/&apos;&lt;/span&gt; -H&lt;span class=&quot;code-quote&quot;&gt;&apos;Content-type: application/json&apos;&lt;/span&gt; -d &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;set-property&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;query.documentCache.enabled&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;}}&apos;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As per the investigation, the issue present in the &quot;IF&quot; condition,&#160;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!node.exists() || !&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;.equals(node.attributes().get(&lt;span class=&quot;code-quote&quot;&gt;&quot;enabled&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;))) {&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The node object passing to getConfig is an instance of OverlaidConfigNode (extends ConfigNode), a special object containing parent properties(from SolrConfig.xml) and new properties(from overlay), Only If there are new properties present in overlay file.&lt;/p&gt;

&lt;p&gt;But even after disabling the cache, &lt;b&gt;node.attributes().get(&quot;enabled&quot;, &quot;true&quot;)&lt;/b&gt;&#160;is always returning the default value &quot;true&quot; because &lt;b&gt;node.attributes()&lt;/b&gt;&#160;searching for property only in parent properties (from Solrconfig.xml) and not in overlay properties and therefore it is not able to disable the cache. Because to do that, they have to see the enabled flag with a false value.&lt;/p&gt;

&lt;p&gt;Now we can change above If condition to below updated code where we are calling &lt;b&gt;node.attr&lt;/b&gt; method which would first look for enabled flag in overlay and then delegate to the parent properties.&lt;br/&gt;
&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; enabled = node.attr(&lt;span class=&quot;code-quote&quot;&gt;&quot;enabled&quot;&lt;/span&gt;) == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;: node.attr(&lt;span class=&quot;code-quote&quot;&gt;&quot;enabled&quot;&lt;/span&gt;);
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!node.exists() || !&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;.equals(enabled)) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;But I believe there is one more issue,If we look at the getConfig method again. Then once the code entered into the IF block, It will fetch properties from the overlay file and If it&apos;s not null then they would initialize Cache object with overlay properties and some default properties, even if the cache is disabled.&lt;/p&gt;

&lt;p&gt;IMO, The fix would be to look for enabled flag in overlay and If it&apos;s false then return null.&#160;&lt;/p&gt;</comment>
                            <comment id="17813921" author="JIRAUSER305513" created="Sat, 3 Feb 2024 11:32:36 +0000"  >&lt;p&gt;The reason that It worked when updating size to &quot;-1&quot; because in that case CaffeineCache failed because of invalid argument.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2024-02-03 11:26:19.665 ERROR (coreZkRegister-1-thread-1) [c: s: r: x: t:] o.a.s.s.CacheConfig Error instantiating cache =&amp;gt; java.lang.IllegalArgumentException
&#160; &#160; &#160; &#160; at com.github.benmanes.caffeine.cache.Caffeine.requireArgument(Caffeine.java:188)
java.lang.IllegalArgumentException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&#160; &#160; &#160; &#160; at com.github.benmanes.caffeine.cache.Caffeine.requireArgument(Caffeine.java:188) ~[?:?]
&#160; &#160; &#160; &#160; at com.github.benmanes.caffeine.cache.Caffeine.initialCapacity(Caffeine.java:299) ~[?:?]
&#160; &#160; &#160; &#160; at org.apache.solr.search.CaffeineCache.buildCache(CaffeineCache.java:157) ~[?:?]
&#160; &#160; &#160; &#160; at org.apache.solr.search.CaffeineCache.init(CaffeineCache.java:141) ~[?:?]
&#160; &#160; &#160; &#160; at org.apache.solr.search.CacheConfig.newInstance(CacheConfig.java:194) ~[?:?]
&#160; &#160; &#160; &#160; at org.apache.solr.search.SolrDocumentFetcher.&amp;lt;init&amp;gt;(SolrDocumentFetcher.java:130) ~[?:?]&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@CanIgnoreReturnValue
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Caffeine&amp;lt;K, V&amp;gt; initialCapacity(@NonNegative &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; initialCapacity) {
requireState(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.initialCapacity == UNSET_INT,
&lt;span class=&quot;code-quote&quot;&gt;&quot;initial capacity was already set to %s&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.initialCapacity);
requireArgument(initialCapacity &amp;gt;= 0);
&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.initialCapacity = initialCapacity;
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;;
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Due to the exception, It returns null when requesting for cache object, and in this case null for documentCache.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; SolrCache newInstance() {
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {

SolrCache&amp;lt;?, ?&amp;gt; cache = clazz.get().getConstructor().newInstance();
persistence[0] = cache.init(args, persistence[0], regenerator);
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; cache;
} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
log.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Error instantiating cache&quot;&lt;/span&gt;, e);
&lt;span class=&quot;code-comment&quot;&gt;// we can carry on without a cache... but should we?
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// in some cases (like an OOM) we probably should &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; to &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;.
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
}
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17815430" author="hossman" created="Wed, 7 Feb 2024 21:12:04 +0000"  >&lt;p&gt;I&apos;ve only skimmed the PR patch, but it looks like it really only tests the fix in terms of the mocking the &lt;tt&gt;CacheConfig&lt;/tt&gt; ?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I&apos;ve appreciate the value of mock testing, but I&apos;d feel a lot more confident about the fix if there was an &quot;integration&quot; test that did introspection to confirm whether there actually &lt;b&gt;&lt;em&gt;is or is not&lt;/em&gt;&lt;/b&gt; a documentCache.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;We&apos;ve already got &lt;tt&gt;TestSolrConfigHandler&lt;/tt&gt; &#8211; so why not add a method to it that uses the config handler to toggle enabled/disabled and then asserts the corresponding results via (IIRC ... untested &amp;amp; writing this mostly from memory) ....&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
getJetty().getCoreContainer().getSolrCore(collection).withSearcher( s -&amp;gt; assertNull(s.getDocFetcher().getDocumentCache() )&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;?&lt;/p&gt;</comment>
                            <comment id="17815753" author="epugh" created="Thu, 8 Feb 2024 16:33:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=duttsanjay&quot; class=&quot;user-hover&quot; rel=&quot;duttsanjay&quot;&gt;duttsanjay&lt;/a&gt; to give you some context, I don&apos;t know if it&apos;s a Solr project specific thing, but we tend to be skeptical of Mocks...  There is a feeling that without having robust integration tests, all the components may work individually (i.e in a heavily mocked sense) but totally fall apart when you connect them up!&lt;/p&gt;

&lt;p&gt;In someways our /src/tests is really a big mix of both traditional unit tests AND integration tests....    &lt;/p&gt;</comment>
                            <comment id="17815755" author="JIRAUSER305513" created="Thu, 8 Feb 2024 16:37:50 +0000"  >&lt;p&gt;Added few test cases. Getting searcher object was tricky as one has to manage the life cycle of core and searcher such as closing them properly, and after updating overlay then ask for new core and again a searcher object which makes the test case bit complex. I search in the codebase as well for other examples but did not find any in test cases.&lt;/p&gt;

&lt;p&gt;Instead, made a rest call to &quot;admin/metrics&quot; which returns all the cache objects (documentCache, queryResultCache) registered through SolrIndexSearcher, only if they are enabled.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17815757" author="JIRAUSER305513" created="Thu, 8 Feb 2024 16:45:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=epugh&quot; class=&quot;user-hover&quot; rel=&quot;epugh&quot;&gt;epugh&lt;/a&gt;&#160; Totally agree on robust integration test cases. Moving forward, will add combination of both Unit and integration.&#160;&lt;/p&gt;</comment>
                            <comment id="17815761" author="JIRAUSER305513" created="Thu, 8 Feb 2024 16:53:18 +0000"  >&lt;p&gt;Also one more point, earlier If cache disabled in SolrConfig then running set-property to update size of disabled cache would enable the cache.&#160;&lt;/p&gt;

&lt;p&gt;However, as per new changes that will not happen, it will stay disabled.&#160;&lt;/p&gt;</comment>
                            <comment id="17815831" author="hossman" created="Thu, 8 Feb 2024 21:03:15 +0000"  >&lt;blockquote&gt;&lt;p&gt;...we tend to be skeptical of Mocks... There is a feeling that without having robust integration tests, all the components may work individually (i.e in a heavily mocked sense) but totally fall apart when you connect them up!&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;To be clear, i&apos;m not skeptical of the mock testing&#160; &#8211; they are great at their job which is unit testing the contracts of things that interact with the mocked object(s) &#8211;&#160; but they are no substitute for a good integration test.&lt;/p&gt;

&lt;p&gt;In this particular jira, the underlying bug (IIUC) was in how the config + overlay was modeled &quot;in memory&quot;; and the mock test added by the patch (had it existed in the past) may have caught this particular bug.&#160; But if at some point in a the future a person makes a change that breaks where/how that &quot;in memory&quot; model of the config is &lt;em&gt;used&lt;/em&gt; to construct the documentCache, the mock test probably won&apos;t catch that ... but an integration test that introspects the searcher definitely will.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Getting searcher object was tricky ... I search in the codebase as well for other examples but did not find any in test cases.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Fair point &#8211; it&apos;s because most tests only need to worry about the current searcher, usually in the context of a &lt;tt&gt;req(...)&lt;/tt&gt; lifecycle &#8211; you&apos;re in less common territory of wanting to be able to assert things about a searcher, then change config in a way that will reload (a new instance of) the SolrCore, then assert different things about the newsearcher. it&apos;s a less common pattern so it has less test helper code available&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Instead, made a rest call to &quot;admin/metrics&quot; which returns all the cache objects (documentCache, queryResultCache) registered through SolrIndexSearcher, only if they are enabled.&#160;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;that also sounds like a perfectly good way to write an integration test of this.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Also one more point, earlier If cache disabled in SolrConfig then running set-property to update size of disabled cache would enable the cache.&lt;/p&gt;

&lt;p&gt;However, as per new changes that will not happen, it will stay disabled.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="17816624" author="epugh" created="Mon, 12 Feb 2024 14:40:05 +0000"  >&lt;p&gt;Are we good with the patch then?   I&apos;m happy to go through and merge it if you think the reworked version meets the needs &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman&quot; class=&quot;user-hover&quot; rel=&quot;hossman&quot;&gt;hossman&lt;/a&gt;!   &lt;/p&gt;

&lt;p&gt;This is a great fix for an annoying type bug...&lt;/p&gt;</comment>
                            <comment id="17816828" author="hossman" created="Tue, 13 Feb 2024 00:12:36 +0000"  >&lt;p&gt;I&apos;m not really familiar enough with either the CacheConfig class or existing TestSolrConfigHandler plumbing to give meaningful feedback on the actual patch, but i do appreciate the new test.&lt;/p&gt;

&lt;p&gt;I&apos;m happy if you&apos;re happy Eric.&lt;/p&gt;</comment>
                            <comment id="17817005" author="jira-bot" created="Tue, 13 Feb 2024 13:47:39 +0000"  >&lt;p&gt;Commit a88305d253ca7fbad444a905b652ff781d3ab41a in solr&apos;s branch refs/heads/main from Sanjay Dutt&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=a88305d253c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=a88305d253c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17148&quot; title=&quot;Config API lies about setting cache enabled=false&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17148&quot;&gt;&lt;del&gt;SOLR-17148&lt;/del&gt;&lt;/a&gt;: Fixing Config API overlay property enabling or disabling cache (#2247)&lt;/p&gt;

&lt;p&gt;---------&lt;/p&gt;

&lt;p&gt;Co-authored-by: iamsanjay &amp;lt;sanjaydutt.india@yahoo.com&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17817006" author="jira-bot" created="Tue, 13 Feb 2024 13:49:11 +0000"  >&lt;p&gt;Commit 3f9fcf818066267ff5ad82a53f359660ee4dea5e in solr&apos;s branch refs/heads/branch_9x from Sanjay Dutt&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=3f9fcf81806&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=3f9fcf81806&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17148&quot; title=&quot;Config API lies about setting cache enabled=false&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17148&quot;&gt;&lt;del&gt;SOLR-17148&lt;/del&gt;&lt;/a&gt;: Fixing Config API overlay property enabling or disabling cache (#2247)&lt;/p&gt;

&lt;p&gt;---------&lt;/p&gt;

&lt;p&gt;Co-authored-by: iamsanjay &amp;lt;sanjaydutt.india@yahoo.com&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17817007" author="epugh" created="Tue, 13 Feb 2024 13:50:25 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=duttsanjay&quot; class=&quot;user-hover&quot; rel=&quot;duttsanjay&quot;&gt;duttsanjay&lt;/a&gt; for this nice fix!&lt;/p&gt;</comment>
                            <comment id="17841731" author="gus_heck" created="Sun, 28 Apr 2024 19:22:41 +0000"  >&lt;p&gt;Closing after the 9.6.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 28 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1n6oo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>