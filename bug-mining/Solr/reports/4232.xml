<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:38:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-12013] collections API CUSTERSTATUS command fails when configset missing</title>
                <link>https://issues.apache.org/jira/browse/SOLR-12013</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;CLUSTERSTATUS command can be given independent of a given collection.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://localhost:8983/solr/admin/collections?action=CLUSTERSTATUS&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8983/solr/admin/collections?action=CLUSTERSTATUS&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I would expect that you can still inspect the status of a cluster even if a single collection has failed, or is missing its configuration.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Expected behavior&lt;/b&gt;: all healthy collections status is returned, unhealthy collections are either reported with a stacktrace in the response, reported in a failure state, or are not present from the response.&lt;/p&gt;

&lt;p&gt;For example, CLUSTERSTATUS fails when a collection config-set is missing from ZooKeeper with:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;&lt;b&gt;org.apache.solr.common.cloud.ZooKeeperException: Specified config does not exist in ZooKeeper: config-set-name&lt;/b&gt;&lt;/tt&gt;&lt;br/&gt;
{{ &lt;b&gt;at org.apache.solr.common.cloud.ZkStateReader.readConfigName(ZkStateReader.java:189)&lt;/b&gt;}}&lt;br/&gt;
{{ at org.apache.solr.handler.admin.ClusterStatus.getClusterStatus(ClusterStatus.java:141)}}&lt;br/&gt;
{{ at org.apache.solr.handler.admin.CollectionsHandler$CollectionOperation.lambda$static$19(CollectionsHandler.java:649)}}&lt;br/&gt;
{{ at org.apache.solr.handler.admin.CollectionsHandler$CollectionOperation.execute(CollectionsHandler.java:888)}}&lt;br/&gt;
{{ at org.apache.solr.handler.admin.CollectionsHandler.invokeAction(CollectionsHandler.java:226)}}&lt;br/&gt;
{{ at org.apache.solr.handler.admin.CollectionsHandler.handleRequestBody(CollectionsHandler.java:213)}}&lt;br/&gt;
{{ at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:173)}}&lt;br/&gt;
{{ at org.apache.solr.servlet.HttpSolrCall.handleAdmin(HttpSolrCall.java:748)}}&lt;br/&gt;
{{ at org.apache.solr.servlet.HttpSolrCall.handleAdminRequest(HttpSolrCall.java:729)}}&lt;br/&gt;
{{ at org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:510)}}&lt;br/&gt;
{{ at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:347)}}&lt;br/&gt;
{{ at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:298)}}&lt;br/&gt;
{{ at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1691)}}&lt;br/&gt;
{{ at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:582)}}&lt;br/&gt;
{{ at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143)}}&lt;br/&gt;
{{ at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:548)}}&lt;br/&gt;
{{ at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:226)}}&lt;br/&gt;
{{ at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1180)}}&lt;br/&gt;
{{ at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:512)}}&lt;br/&gt;
{{ at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185)}}&lt;br/&gt;
{{ at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1112)}}&lt;br/&gt;
{{ at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)}}&lt;br/&gt;
{{ at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:213)}}&lt;br/&gt;
{{ at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:119)}}&lt;br/&gt;
{{ at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134)}}&lt;br/&gt;
{{ at org.eclipse.jetty.rewrite.handler.RewriteHandler.handle(RewriteHandler.java:335)}}&lt;br/&gt;
{{ at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134)}}&lt;br/&gt;
{{ at org.eclipse.jetty.server.Server.handle(Server.java:534)}}&lt;br/&gt;
{{ at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:320)}}&lt;br/&gt;
{{ at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:251)}}&lt;br/&gt;
{{ at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:273)}}&lt;br/&gt;
{{ at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:95)}}&lt;br/&gt;
{{ at org.eclipse.jetty.io.SelectChannelEndPoint$2.run(SelectChannelEndPoint.java:93)}}&lt;br/&gt;
{{ at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.executeProduceConsume(ExecuteProduceConsume.java:303)}}&lt;br/&gt;
{{ at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceConsume(ExecuteProduceConsume.java:148)}}&lt;br/&gt;
{{ at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:136)}}&lt;br/&gt;
{{ at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:671)}}&lt;br/&gt;
{{ at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:589)}}&lt;br/&gt;
{{ at java.lang.Thread.run(Thread.java:745)}}&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13140013">SOLR-12013</key>
            <summary>collections API CUSTERSTATUS command fails when configset missing</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="erickerickson">Erick Erickson</assignee>
                                    <reporter username="ben.demott">Ben DeMott</reporter>
                        <labels>
                    </labels>
                <created>Wed, 21 Feb 2018 20:55:42 +0000</created>
                <updated>Fri, 26 Jul 2019 08:56:26 +0000</updated>
                            <resolved>Thu, 13 Jun 2019 22:46:36 +0000</resolved>
                                    <version>6.0</version>
                    <version>7.0</version>
                    <version>7.1</version>
                    <version>7.2</version>
                                    <fixVersion>8.2</fixVersion>
                    <fixVersion>9.0</fixVersion>
                                    <component>SolrCloud</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1800">0.5h</timespent>
                                <comments>
                            <comment id="16860497" author="erickerickson" created="Tue, 11 Jun 2019 02:59:29 +0000"  >&lt;p&gt;&lt;b&gt;ZkStateReader.readConfigName&lt;/b&gt;&#160;throws a really bogus error, which is causing &lt;b&gt;ClusterStatus.getClusterStatus&lt;/b&gt; to throw an error rather than skip a collection that doesn&apos;t have an associated configset.&lt;/p&gt;

&lt;p&gt;&#160;ZkStateReader.readConfigName has this code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; configPath = CONFIGS_ZKNODE + &lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt; + configName;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!zkClient.exists(configPath, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)) {
          log.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Specified config=[{}] does not exist in ZooKeeper at location=[{}]&quot;&lt;/span&gt;, configName, configPath);
          &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ZooKeeperException(ErrorCode.SERVER_ERROR, &lt;span class=&quot;code-quote&quot;&gt;&quot;Specified config does not exist in ZooKeeper: &quot;&lt;/span&gt; + configName);
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
          log.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;path=[{}] [{}]=[{}] specified config exists in ZooKeeper&quot;&lt;/span&gt;, configPath, CONFIGNAME_PROP, configName);
        }
   
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;But Clusterstatus.GetClusterStatus has this code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; configName = zkStateReader.readConfigName(name);
            .
            .
            .
      } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (SolrException e) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (e.getCause() &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; KeeperException.NoNodeException)  {
          &lt;span class=&quot;code-comment&quot;&gt;// skip &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; collection because the collection&apos;s znode has been deleted
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// which can happen during aggressive collection removal, see SOLR-10720
&lt;/span&gt;        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; e;
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which can never be true since ZooKeeperException has nothing to do with NoNodeException. It makes no sense to me that when a znode is not present, we throw any kind of SolrException (the superclass of ZookeeperException) so I&apos;ll change &lt;b&gt;zkStateReader.readConfigName&lt;/b&gt; to throw a NoNodeException&lt;/p&gt;

&lt;p&gt;I&apos;ll run the full test suite and correct any tests that rely on this behavior.&lt;/p&gt;

&lt;p&gt;It&apos;s vaguely possible this is responsible for some&#160; test failures given this comment:&lt;/p&gt;

&lt;p&gt;// skip this collection because the configset&apos;s znode has been deleted&lt;br/&gt;
// which can happen during aggressive collection removal, see &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10720&quot; title=&quot;Aggressive removal of a collection breaks cluster state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10720&quot;&gt;&lt;del&gt;SOLR-10720&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Throwing an NoNodeException does propagate to some other code, we&apos;ll see if it breaks other tests.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16861624" author="jira-bot" created="Wed, 12 Jun 2019 00:11:40 +0000"  >&lt;p&gt;Commit bfb5b41144f13e4d10d64a9c1bd53f3f498d7e4e in lucene-solr&apos;s branch refs/heads/master from Erick Erickson&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=bfb5b41&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=bfb5b41&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12013&quot; title=&quot;collections API CUSTERSTATUS command fails when configset missing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12013&quot;&gt;&lt;del&gt;SOLR-12013&lt;/del&gt;&lt;/a&gt;: collections API CUSTERSTATUS command fails when configset missing&lt;/p&gt;</comment>
                            <comment id="16861625" author="jira-bot" created="Wed, 12 Jun 2019 00:12:02 +0000"  >&lt;p&gt;Commit cd809ef7673c6f28306061e9349d34243715c5e4 in lucene-solr&apos;s branch refs/heads/branch_8x from erick&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=cd809ef&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=cd809ef&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12013&quot; title=&quot;collections API CUSTERSTATUS command fails when configset missing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12013&quot;&gt;&lt;del&gt;SOLR-12013&lt;/del&gt;&lt;/a&gt;: collections API CUSTERSTATUS command fails when configset missing&lt;/p&gt;</comment>
                            <comment id="16863284" author="erickerickson" created="Thu, 13 Jun 2019 17:02:40 +0000"  >&lt;p&gt;Looking more carefully at the code, the current patch fixes the specific situation where the configset is missing. It does &lt;em&gt;not&lt;/em&gt; fix the issue where, for some reason, the entire collection is not found. We need to throw the NoNodeException in&#160; that case too.&lt;/p&gt;</comment>
                            <comment id="16863516" author="jira-bot" created="Thu, 13 Jun 2019 22:40:19 +0000"  >&lt;p&gt;Commit 81e8b385a4cac5268c2cd920240d0e717f55713a in lucene-solr&apos;s branch refs/heads/master from Erick Erickson&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=81e8b38&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=81e8b38&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12013&quot; title=&quot;collections API CUSTERSTATUS command fails when configset missing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12013&quot;&gt;&lt;del&gt;SOLR-12013&lt;/del&gt;&lt;/a&gt;: collections API CUSTERSTATUS command fails when configset missing&lt;/p&gt;</comment>
                            <comment id="16863518" author="erickerickson" created="Thu, 13 Jun 2019 22:41:40 +0000"  >&lt;p&gt;covered a case I missed earlier&lt;/p&gt;</comment>
                            <comment id="16863520" author="jira-bot" created="Thu, 13 Jun 2019 22:46:09 +0000"  >&lt;p&gt;Commit 47e67be775659d5e58d750edbde2e7fa0a90cd2f in lucene-solr&apos;s branch refs/heads/branch_8x from Erick Erickson&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=47e67be&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=47e67be&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12013&quot; title=&quot;collections API CUSTERSTATUS command fails when configset missing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12013&quot;&gt;&lt;del&gt;SOLR-12013&lt;/del&gt;&lt;/a&gt;: collections API CUSTERSTATUS command fails when configset missing&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 81e8b385a4cac5268c2cd920240d0e717f55713a)&lt;/p&gt;</comment>
                            <comment id="16863522" author="erickerickson" created="Thu, 13 Jun 2019 22:46:36 +0000"  >&lt;p&gt;Fixed up a missed failure path.&lt;/p&gt;</comment>
                            <comment id="16893595" author="ivera" created="Fri, 26 Jul 2019 08:56:26 +0000"  >&lt;p&gt;Closing after the 8.2.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12971738" name="SOLR-12013.supplemental.patch" size="2968" author="erickerickson" created="Thu, 13 Jun 2019 22:41:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 16 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3qfu7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>