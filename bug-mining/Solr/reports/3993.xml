<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:34:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-11881] Retry update requests from leaders to replicas</title>
                <link>https://issues.apache.org/jira/browse/SOLR-11881</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;We can see that a connection reset is causing LIR.&lt;/p&gt;

&lt;p&gt;If a leader -&amp;gt; replica update get&apos;s a connection like this the leader will initiate LIR&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2018-01-08 17:39:16.980 ERROR (qtp1010030701-468988) [c:collection s:shardX r:core_node56 collection_shardX_replicaY] o.a.s.u.p.DistributedUpdateProcessor Setting up to &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; to start recovery on replica https:&lt;span class=&quot;code-comment&quot;&gt;//host08.domain:8985/solr/collection_shardX_replicaY/
&lt;/span&gt;java.net.SocketException: Connection reset
        at java.net.SocketInputStream.read(SocketInputStream.java:210)
        at java.net.SocketInputStream.read(SocketInputStream.java:141)
        at sun.security.ssl.InputRecord.readFully(InputRecord.java:465)
        at sun.security.ssl.InputRecord.read(InputRecord.java:503)
        at sun.security.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.java:973)
        at sun.security.ssl.SSLSocketImpl.performInitialHandshake(SSLSocketImpl.java:1375)
        at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1403)
        at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1387)
        at org.apache.http.conn.ssl.SSLSocketFactory.connectSocket(SSLSocketFactory.java:543)
        at org.apache.http.conn.ssl.SSLSocketFactory.connectSocket(SSLSocketFactory.java:409)
        at org.apache.http.impl.conn.DefaultClientConnectionOperator.openConnection(DefaultClientConnectionOperator.java:177)
        at org.apache.http.impl.conn.ManagedClientConnectionImpl.open(ManagedClientConnectionImpl.java:304)
        at org.apache.http.impl.client.DefaultRequestDirector.tryConnect(DefaultRequestDirector.java:611)
        at org.apache.http.impl.client.DefaultRequestDirector.execute(DefaultRequestDirector.java:446)
        at org.apache.http.impl.client.AbstractHttpClient.doExecute(AbstractHttpClient.java:882)
        at org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:82)
        at org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:55)
        at org.apache.solr.client.solrj.impl.ConcurrentUpdateSolrClient$Runner.sendUpdateStream(ConcurrentUpdateSolrClient.java:312)
        at org.apache.solr.client.solrj.impl.ConcurrentUpdateSolrClient$Runner.run(ConcurrentUpdateSolrClient.java:185)
        at org.apache.solr.common.util.ExecutorUtil$MDCAwareThreadPoolExecutor.lambda$execute$0(ExecutorUtil.java:229)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;From &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6931&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SOLR-6931&lt;/a&gt; Mark says &quot;On a heavy working SolrCloud cluster, even a rare response like this from a replica can cause a recovery and heavy cluster disruption&quot; .&lt;/p&gt;

&lt;p&gt;Looking at &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6931&quot; title=&quot;We should do a limited retry when using HttpClient.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6931&quot;&gt;&lt;del&gt;SOLR-6931&lt;/del&gt;&lt;/a&gt; we added a http retry handler but we only retry on GET requests. Updates are POST requests &lt;tt&gt;ConcurrentUpdateSolrClient#sendUpdateStream&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Update requests between the leader and replica should be retry-able since they have been versioned.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13132557">SOLR-11881</key>
            <summary>Retry update requests from leaders to replicas</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tflobbe">Tomas Eduardo Fernandez Lobbe</assignee>
                                    <reporter username="varun">Varun Thacker</reporter>
                        <labels>
                    </labels>
                <created>Mon, 22 Jan 2018 01:52:02 +0000</created>
                <updated>Thu, 21 Nov 2019 00:42:21 +0000</updated>
                            <resolved>Thu, 9 Aug 2018 21:39:13 +0000</resolved>
                                                    <fixVersion>7.5</fixVersion>
                    <fixVersion>8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16334040" author="emaijala" created="Mon, 22 Jan 2018 08:45:45 +0000"  >&lt;p&gt;Does this also fix &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9826&quot; title=&quot;Shutting down leader when it&amp;#39;s sending updates makes another active node go into recovery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9826&quot;&gt;SOLR-9826&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="16340481" author="varunthacker" created="Fri, 26 Jan 2018 02:32:38 +0000"  >&lt;p&gt;Hi Ere,&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;No these are different issues. We should fix both but this one&apos;s separate.&lt;/p&gt;</comment>
                            <comment id="16452907" author="varunthacker" created="Wed, 25 Apr 2018 19:13:09 +0000"  >&lt;p&gt;We ran into another such scenario where a SocketTimeoutException caused LIR.&lt;/p&gt;

&lt;p&gt;The replica had this in it&apos;s logs&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
date time WARN [qtp768306356-580185] ? (:) - 
java.nio.channels.ReadPendingException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
at org.eclipse.jetty.io.FillInterest.register(FillInterest.java:58) ~[jetty-io-9.4.8.v20171121.jar:9.4.8.v20171121]
at org.eclipse.jetty.io.AbstractEndPoint.fillInterested(AbstractEndPoint.java:353) ~[jetty-io-9.4.8.v20171121.jar:9.4.8.v20171121]
at org.eclipse.jetty.io.AbstractConnection.fillInterested(AbstractConnection.java:134) ~[jetty-io-9.4.8.v20171121.jar:9.4.8.v20171121]
at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:267) ~[jetty-server-9.4.8.v20171121.jar:9.4.8.v20171121]
at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:279) ~[jetty-io-9.4.8.v20171121.jar:9.4.8.v20171121]
at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:102) ~[jetty-io-9.4.8.v20171121.jar:9.4.8.v20171121]
at org.eclipse.jetty.io.ssl.SslConnection.onFillable(SslConnection.java:289) ~[jetty-io-9.4.8.v20171121.jar:9.4.8.v20171121]
at org.eclipse.jetty.io.ssl.SslConnection$3.succeeded(SslConnection.java:149) ~[jetty-io-9.4.8.v20171121.jar:9.4.8.v20171121]
at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:102) ~[jetty-io-9.4.8.v20171121.jar:9.4.8.v20171121]
at org.eclipse.jetty.io.ChannelEndPoint$2.run(ChannelEndPoint.java:124) ~[jetty-io-9.4.8.v20171121.jar:9.4.8.v20171121]
at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:247) ~[jetty-util-9.4.8.v20171121.jar:9.4.8.v20171121]
at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.produce(EatWhatYouKill.java:140) ~[jetty-util-9.4.8.v20171121.jar:9.4.8.v20171121]
at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:131) ~[jetty-util-9.4.8.v20171121.jar:9.4.8.v20171121]
at org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:382) ~[jetty-util-9.4.8.v20171121.jar:9.4.8.v20171121]
at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:708) ~[jetty-util-9.4.8.v20171121.jar:9.4.8.v20171121]
at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:626) ~[jetty-util-9.4.8.v20171121.jar:9.4.8.v20171121]
at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748) [?:1.8.0-zing_17.11.0.0]

date time WARN [qtp768306356-580185] ? (:) - Read pending &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; org.eclipse.jetty.server.HttpConnection$BlockingReadCallback@2e98df28 prevented AC.ReadCB@424271f8{HttpConnection@424271f8[p=HttpParser{s=START,0 of -1},g=HttpGenerator@424273ae{s=START}]=&amp;gt;HttpChannelOverHttp@4242713d{r=141,c=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,a=IDLE,uri=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}&amp;lt;-DecryptedEndPoint@4242708d{/host:52824&amp;lt;-&amp;gt;/host:port,OPEN,fill=FI,flush=-,to=1/86400}-&amp;gt;HttpConnection@424271f8[p=HttpParser{s=START,0 of -1},g=HttpGenerator@&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And the leader waited exactly the socket timeout period after this error and threw a socket-timeout-exception . At that point the leader put the replica into recovery&#160;&lt;/p&gt;</comment>
                            <comment id="16456691" author="tomasflobbe" created="Fri, 27 Apr 2018 16:17:35 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="16456702" author="markrmiller@gmail.com" created="Fri, 27 Apr 2018 16:32:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;Update requests between the leader and replica should be retry-able since they have been versioned.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, nice, this was a big miss. It&apos;s the user client that can&apos;t easily auto retry.&lt;/p&gt;</comment>
                            <comment id="16456742" author="markrmiller@gmail.com" created="Fri, 27 Apr 2018 16:56:08 +0000"  >&lt;p&gt;We should also consider turning retry on for the read side as well. It&apos;s only done on IOException and you might not have another replica to retry to.&lt;/p&gt;

&lt;p&gt;For the updates side I&apos;m wondering if we should not just turn it on in general. We explicitly disable admin request from retry, is there anything that uses the update client where a retry would be a problem?&lt;/p&gt;</comment>
                            <comment id="16456743" author="markrmiller@gmail.com" created="Fri, 27 Apr 2018 16:57:00 +0000"  >&lt;blockquote&gt;&lt;p&gt;is there anything that uses the update client where a retry would be a problem?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hmm, perhaps when a replica forwards an update to the leader.&lt;/p&gt;</comment>
                            <comment id="16456842" author="markrmiller@gmail.com" created="Fri, 27 Apr 2018 17:58:21 +0000"  >&lt;p&gt;It&apos;s been a while since I&apos;ve thought about this, mind is begining to churn again.&lt;/p&gt;

&lt;p&gt;Does this even help? We stream updates from leader to the replica, and streaming cannot be retried, you&apos;d have to buffer the stream or something. It gets a can&apos;t retry exception.&lt;/p&gt;</comment>
                            <comment id="16456848" author="markrmiller@gmail.com" created="Fri, 27 Apr 2018 18:03:00 +0000"  >&lt;p&gt;Maybe we need to implement our own retry in distrib update handler.&lt;/p&gt;</comment>
                            <comment id="16457076" author="varunthacker" created="Fri, 27 Apr 2018 21:14:22 +0000"  >&lt;p&gt;Hi Mark,&lt;/p&gt;

&lt;p&gt;ConcurrentUpdateSolrClient#sendUpdateStream is the relevant code sending the update from leader-&amp;gt;replica right?&#160;&lt;/p&gt;

&lt;p&gt;I don&apos;t know this piece of code very&#160;closely but do we only stream for xml ?&#160;&#160;&lt;/p&gt;</comment>
                            <comment id="16457124" author="markrmiller@gmail.com" created="Fri, 27 Apr 2018 21:51:39 +0000"  >&lt;blockquote&gt;&lt;p&gt;&#160;ConcurrentUpdateSolrClient#sendUpdateStream&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sounds right.&lt;/p&gt;

&lt;p&gt;It should be using JavaBin and we only stream. It&apos;s the only way to do efficient high volume indexing. The only case you can really get away with no doing it is if you know the request is single document per request. That&apos;s how things used to work (even if you batch or streamed to the leader, it was split up into document per request), but it only works well with low load.&lt;/p&gt;</comment>
                            <comment id="16457273" author="tomasflobbe" created="Sat, 28 Apr 2018 01:08:07 +0000"  >&lt;p&gt;If I&#8217;m reading the code correctly, this RetryHandler is called in two cases, after an exception trying to establish the connection, and after an exception executing the request. Retrying in the first case should be fine, in the second, not so easy.&lt;br/&gt;
The way we do streaming is by keeping the connection and having an &lt;tt&gt;EntityTemplate&lt;/tt&gt; that reads updates from a queue and writes each one and flushes. If I understand correctly, if we want to retry the request instead of throwing an error we need to retry the update too, by putting it back in the queue. Even then, I&#8217;m not sure we can know that updates before the failure were consumed (even if we call flush for each one)&lt;/p&gt;</comment>
                            <comment id="16457345" author="markrmiller@gmail.com" created="Sat, 28 Apr 2018 04:06:25 +0000"  >&lt;p&gt;I think we may be able to use the RetryNode stuff that update forwarding to the leader does or something similar. I&#8217;d have to refresh, but I believe if we send an update, even streaming, we get a response for that update. If it&#8217;s success we are good. I don&#8217;t think we want to retry with the ConcurrentUpdateClient, but instead like forwards do with SolrCmdDistributor.&lt;/p&gt;</comment>
                            <comment id="16458316" author="markrmiller@gmail.com" created="Mon, 30 Apr 2018 05:17:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12290&quot; title=&quot;Do not close any servlet streams and improve our servlet stream closing prevention code for users and devs.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12290&quot;&gt;&lt;del&gt;SOLR-12290&lt;/del&gt;&lt;/a&gt; may help with the cause of the connection reset. Hard to say though, SSL has different connection semantics I believe and we have not looked into how fully reusable they are.&lt;/p&gt;</comment>
                            <comment id="16458319" author="markrmiller@gmail.com" created="Mon, 30 Apr 2018 05:20:42 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&#8217;m not sure we can know that updates before the failure were consumed (even if we call flush for each one)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, so we are sending individual requests on a single connection - each request is good if you get a good response and requests are fully serial per connection. So the information is there, it&apos;s just how hard is it to use as we need given the current code.&lt;/p&gt;</comment>
                            <comment id="16458322" author="markrmiller@gmail.com" created="Mon, 30 Apr 2018 05:27:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt;, look at the exception in the summary, you can almost be sure this is &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12290&quot; title=&quot;Do not close any servlet streams and improve our servlet stream closing prevention code for users and devs.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12290&quot;&gt;&lt;del&gt;SOLR-12290&lt;/del&gt;&lt;/a&gt;. It&apos;s trying to just start the connection and on the first read finds out it&apos;s closed. This is the normal signature for when a server connection gets improperly closed.&lt;/p&gt;</comment>
                            <comment id="16458334" author="markrmiller@gmail.com" created="Mon, 30 Apr 2018 05:58:32 +0000"  >&lt;p&gt;For the second exception here is something similiar: &lt;a href=&quot;https://github.com/eclipse/jetty.project/issues/1047&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/eclipse/jetty.project/issues/1047&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thats fixed in jetty-9.3.17.v20170317 it looks though.&lt;/p&gt;</comment>
                            <comment id="16458338" author="markrmiller@gmail.com" created="Mon, 30 Apr 2018 06:04:52 +0000"  >&lt;p&gt;Another possibility (beyond some different bug) for the second one is that it&apos;s reusing connections and there is a case we don&apos;t fully clear the connection streams. Normally, Jetty will just not reuse that connection if that happens, perhaps SSL with this new async stuff can hit this if that happens though. Just a guess and reminder that I should review our code that ensures everyone is fully reading streams.&lt;/p&gt;</comment>
                            <comment id="16458341" author="varunthacker" created="Mon, 30 Apr 2018 06:09:59 +0000"  >&lt;p&gt;&amp;gt;&#160;For the second exception here is something similiar:&#160;&lt;a href=&quot;https://github.com/eclipse/jetty.project/issues/1047&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/eclipse/jetty.project/issues/1047&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Yeah&#160;that issue&#160;seems to have been fixed but here&apos;s the mailing list thread that the jetty folks pointed me to a bug with ssl/async :&#160;&lt;a href=&quot;https://dev.eclipse.org/mhonarc/lists/jetty-dev/msg03165.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.eclipse.org/mhonarc/lists/jetty-dev/msg03165.html&lt;/a&gt;&lt;br/&gt;
&#160;&lt;/p&gt;</comment>
                            <comment id="16460289" author="tomasflobbe" created="Tue, 1 May 2018 23:17:58 +0000"  >&lt;p&gt;Attached a rough patch that handles the retry in SolrCmdDistributor:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;I only added retry to requests from leader to it&apos;s replicas.&lt;/li&gt;
	&lt;li&gt;Didn&apos;t add any tests yet, I&apos;ve been running the ChaosMonkey to see how the retries behave&lt;/li&gt;
	&lt;li&gt;I change the retry exception from only &lt;tt&gt;ConnectException&lt;/tt&gt; to &lt;tt&gt;SocketException&lt;/tt&gt; or &lt;tt&gt;NoHttpResponseException&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;I plan to reduce the number of retries for this case (25 sounds like a lot, I was thinking of 5 or 10 max, but I&apos;m open to suggestions)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; let me know what you think&lt;/p&gt;</comment>
                            <comment id="16461353" author="markrmiller@gmail.com" created="Wed, 2 May 2018 17:32:38 +0000"  >&lt;p&gt;Cool, looks like the right approach.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;ConnectException&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;What&apos;s the logic for removing the retry on that?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I plan to reduce the number of retries&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think something like 3 is good, I think that is what we use at the HttpClient level.&lt;/p&gt;</comment>
                            <comment id="16461455" author="tomasflobbe" created="Wed, 2 May 2018 18:20:46 +0000"  >&lt;blockquote&gt;&lt;p&gt;What&apos;s the logic for removing the retry on that?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Not removing, &lt;tt&gt;ConnectException&lt;/tt&gt; is a &lt;tt&gt;SocketException&lt;/tt&gt; so it should be retried. Things like &quot;broken pipe&quot; are SocketExceptions and I think it should be fine to retry too. One thing though, I noticed that in &lt;tt&gt;SolrCmdDistributorTest&lt;/tt&gt; there is a test case to explicitly validate that we don&apos;t retry on &lt;tt&gt;SocketException&lt;/tt&gt;. I&apos;m not sure if this was done with SocketException intentionally (because there is something I&apos;m missing about this error case) or if this is just an example of exception was was not retried on. &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;I think something like 3 is good&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;That was my original plan too. But then I was looking at the ChaosMonkey logs and the amount of success after retries increased a lot in retries 5 to 10. I know this is just a synthetic situation but it&apos;s the best I have now. I&apos;m thinking also in terms of time spent in retries, we wait 500 ms between retries, and 2.5 secs doesn&apos;t sound too bad if the consequence is saving Solr from a recovery. The impact on the other hand is slower updates in cases of single replicas being slow/faulty. Maybe this should be made configurable?&lt;/p&gt;</comment>
                            <comment id="16461487" author="markrmiller@gmail.com" created="Wed, 2 May 2018 18:48:07 +0000"  >&lt;blockquote&gt;&lt;p&gt;But then I was looking at the ChaosMonkey logs and the amount of success after retries increased a lot in retries 5 to 10.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, okay, it&apos;s probably waiting for failover. I guess that is fine. That is probably how it went so high to begin with - allowing the forward to leader requests to wait for a new leader.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;m not sure if this was done with SocketException intentionally&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes it was, because it can happen mid request and we don&apos;t know if the request failed or succeeded. Given we are counting on versions for retry though, this actually shouldnt matter, so that should be fine.&lt;/p&gt;</comment>
                            <comment id="16461499" author="tomasflobbe" created="Wed, 2 May 2018 19:00:58 +0000"  >&lt;blockquote&gt;&lt;p&gt;Yes it was, because it can happen mid request &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Ah! Good point. So we probably still don&apos;t to retry on those for the forwards, but we are OK with retrying on the FROMLEADER requests...&lt;/p&gt;</comment>
                            <comment id="16461629" author="markrmiller@gmail.com" created="Wed, 2 May 2018 21:15:24 +0000"  >&lt;p&gt;Yeah, good catch - we are not versioned yet on forward.&lt;/p&gt;</comment>
                            <comment id="16461686" author="markrmiller@gmail.com" created="Wed, 2 May 2018 22:26:45 +0000"  >&lt;p&gt;Yeah, now I remember why forward has a retry and why it was so high - same issue, to survive chaos monkey tests, even when you run them longer and if you run them over and over. So at least for the forwarding, I wouldn&apos;t lower it much without good confidence with beasting chaos monkey tests running a good amount of time (default test run times are somewhat low).&lt;/p&gt;

&lt;p&gt;Basically, update forwarding to the leader allows the cloud client to fall back to sending to non leaders and get held up rather than having those updates fail and forcing the user to resolve it. Perhaps the client should just block updates itself for a while waiting to see a leader - but then it has to have kind of special logic - right now even a php client could take advantage of this by just falling back to sending updates to non leaders while failover happens.&lt;/p&gt;

&lt;p&gt;I have no problem with updates from leader to replica retrying less.&lt;/p&gt;
</comment>
                            <comment id="16464325" author="tomasflobbe" created="Fri, 4 May 2018 19:50:07 +0000"  >&lt;p&gt;Uploaded a new patch to &lt;a href=&quot;https://reviews.apache.org/r/66967/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/66967/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16464502" author="varunthacker" created="Fri, 4 May 2018 23:33:37 +0000"  >&lt;p&gt;So recently I&apos;ve been seeing this problem in this form:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The replica get&apos;s a ReadPendingException from Jetty&#160;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
date time WARN [qtp768306356-580185] ? (:) - 
java.nio.channels.ReadPendingException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
at org.eclipse.jetty.io.FillInterest.register(FillInterest.java:58) ~[jetty-io-9.4.8.v20171121.jar:9.4.8.v20171121]
at org.eclipse.jetty.io.AbstractEndPoint.fillInterested(AbstractEndPoint.java:353) ~[jetty-io-9.4.8.v20171121.jar:9.4.8.v20171121]&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;The leader keeps waiting till socket timeout and then get&apos;s a socket timeout exception and put&apos;s the replica into recovery&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So I took&#160;Tom&#225;s latest patch and added SocketTimeoutException to the &lt;tt&gt;isRetriableException&lt;/tt&gt; check.&#160;&lt;/p&gt;

&lt;p&gt;Q: What all exceptions should we retry on? Currently in the patch we have&#160;SocketException /&#160;NoHttpResponseException&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Once I added SocketTimeoutException as a&#160;retriable exception , I then set the socket timeout to 100ms and sent updates to manually test if Solr&apos;s retrying correctly . To my surprise I was never able to hit a socket timeout exception . After some debugging here&apos;s why&lt;/p&gt;

&lt;p&gt;In ConcurrentUpdateSolrClient we do this&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.http.client.config.RequestConfig.Builder requestConfigBuilder = HttpClientUtil.createDefaultRequestConfigBuilder();
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (soTimeout != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
  requestConfigBuilder.setSocketTimeout(soTimeout);
}
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (connectionTimeout != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
  requestConfigBuilder.setConnectTimeout(connectionTimeout);
}

method.setConfig(requestConfigBuilder.build());&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So&#160;createDefaultRequestConfigBuilder doesn&apos;t respect the timeout set in solr.xml and uses a default of 60 seconds.&lt;/p&gt;

&lt;p&gt;I debugged the code and if we simply remove these lines then the http-client will use the default requestConfig which Solr creates with the settings specified from the solr.xml file.&#160;&lt;/p&gt;

&lt;p&gt;Mark : Do you&#160;remember the motivation for overriding the defaults from update shard handlers httpclient and explicitly specifying a&#160;RequestConfig in CUSC? Happy to track this in a separate Jira&#160;&lt;/p&gt;</comment>
                            <comment id="16464533" author="tomasflobbe" created="Sat, 5 May 2018 00:33:10 +0000"  >&lt;p&gt;I believe my current patch breaks the &quot;minRf&quot; behavior. I&apos;ll take a look and add a test for that&lt;/p&gt;</comment>
                            <comment id="16464539" author="markrmiller@gmail.com" created="Sat, 5 May 2018 00:47:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt;, when we update the httpclient we could no longer set things we did after construction - but our client api let you change these settings on the fly (I see those methods are deprecated now - good). So this was to not break that. I think if timeouts are null, we need to try and pull them from the httpclient?&lt;/p&gt;</comment>
                            <comment id="16464557" author="varunthacker" created="Sat, 5 May 2018 01:35:25 +0000"  >&lt;blockquote&gt;&lt;p&gt;&#160;I think if timeouts are null, we need to try and pull them from the httpclient?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I followed the code and if we don&apos;t set the timeout on the HttpPost request by setting a request config , it will use the default request config. In our case we set the default request config while creating the httpclient in HttpClientUtil#setupBuilder so it will use the values defined in the solr.xml file . I&apos;ll file a separate Jira right now&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
RequestConfig requestConfig = requestConfigBuilder.build();

HttpClientBuilder retBuilder = builder.setDefaultRequestConfig(requestConfig);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16464563" author="markrmiller@gmail.com" created="Sat, 5 May 2018 01:53:40 +0000"  >&lt;blockquote&gt;&lt;p&gt;if we don&apos;t set the timeout on the HttpPost request by setting a request config&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Cool - the tricky part is, if only one of the properties of the two is overridden on the client itself on the fly, we still want to pick up the default for the other one.&lt;/p&gt;</comment>
                            <comment id="16466833" author="tomasflobbe" created="Tue, 8 May 2018 04:09:07 +0000"  >&lt;p&gt;I updated the CR with a new patch. Added a test for minRf, but this is more deeply tested in ReplicationFactorTest (that test now takes longer because of the retries. I&apos;m thinking in either making the wait time configurable or modify it for test purposes only). ReplicationFactorTest is marked as &lt;tt&gt;@BadApple&lt;/tt&gt; pointing to &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6944&quot; title=&quot;ReplicationFactorTest and HttpPartitionTest both fail with org.apache.http.NoHttpResponseException: The target server failed to respond&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6944&quot;&gt;SOLR-6944&lt;/a&gt;, this retry logic will probably fix that one. I haven&apos;t seen failures of that test so far.&lt;br/&gt;
There is one nocommit in the code, I&apos;m wondering if we want to keep the retries for DBQs. I&apos;m thinking in setting the retry count for DBQs to 0, since those are not versioned AFAIK.&lt;br/&gt;
Another thing I noticed is that we sleep after each error retried (so if we need to retry two requests to two hosts, we sleep before the first request, and sleep before the second one). This seems odd, I think we want to sleep before retrying a batch of errors. I won&apos;t be changing this here though, I&apos;ll create a new Jira for that.&lt;br/&gt;
I&apos;ll be running some tests with the current patch, feel free to review and let me know if you have any thoughts&lt;/p&gt;</comment>
                            <comment id="16466841" author="markrmiller@gmail.com" created="Tue, 8 May 2018 04:25:28 +0000"  >&lt;p&gt;Yeah, I&apos;d be hesitant to add retries to DBQ without input from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yseeley%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;yseeley@gmail.com&quot;&gt;yseeley@gmail.com&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16466856" author="markrmiller@gmail.com" created="Tue, 8 May 2018 04:46:34 +0000"  >&lt;p&gt;Patch looks nice &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tflobbe&quot; class=&quot;user-hover&quot; rel=&quot;tflobbe&quot;&gt;tflobbe&lt;/a&gt; - very clean.&lt;/p&gt;</comment>
                            <comment id="16472495" author="tomasflobbe" created="Fri, 11 May 2018 19:08:08 +0000"  >&lt;p&gt;I was looking into DBQ a bit more. It is actually versioned (which I didn&#8217;t know) so in theory we could retry too.  But there is another issue with them. In the &lt;tt&gt;doDeleteByQuery&lt;/tt&gt; method we have this comment:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    // NONE: we are the first to receive this deleteByQuery
    //       - it must be forwarded to the leader of every shard
    // TO:   we are a leader receiving a forwarded deleteByQuery... we must:
    //       - block all updates (use VersionInfo)
    //       - flush *all* updates going to our replicas
    //       - forward the DBQ to our replicas and wait for the response
    //       - log + execute the local DBQ
    // FROM: we are a replica receiving a DBQ from our leader
    //       - log + execute the local DBQ
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;However, that&#8217;s not what the code is doing now, not in the leader at least. We block, run locally (like we do with other operations), unblock, then we send the DBQ to followers by calling &lt;tt&gt;cmdDistrib.distribDelete(cmd, replicas, params, &lt;b&gt;false&lt;/b&gt;, rollupReplicationTracker, leaderReplicationTracker);&lt;/tt&gt;, and then call the &lt;tt&gt;cmdDistrib.blockAndDoRetries();&lt;/tt&gt;.  The problem with that is that inside the cmdDistrib things can be reordered (and even more now since we are adding retries to updates), the DBQ needs to be the last request to be executed otherwise it can miss docs.&lt;/p&gt;

&lt;p&gt;I think that call to &lt;tt&gt;cmdDistrib.distribDelete&lt;/tt&gt; needs to be &lt;tt&gt;synchronous=true&lt;/tt&gt;, that way we&#8217;ll flush (and retry) all updates before sending the DBQ, then send the DBQ and flush, and then continue. I&#8217;ll try to work on a test for that, but some feedback would be great. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yseeley%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;yseeley@gmail.com&quot;&gt;yseeley@gmail.com&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16472501" author="markrmiller@gmail.com" created="Fri, 11 May 2018 19:15:33 +0000"  >&lt;p&gt;Yeah, it&apos;s versioned,&#160;that is being counted on in&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12305&quot; title=&quot;When a replica is applying updates, some kind of updates can skip buffering for faster recovery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12305&quot;&gt;&lt;del&gt;SOLR-12305&lt;/del&gt;&lt;/a&gt; as well. My bigger concern with retires would be stuff we didn&apos;t think - I know it&apos;s much tricker than the other distributed commands in terms of what ramifications changes have.&lt;/p&gt;

&lt;p&gt;&#160;bq.&#160;and then call the&#160;&lt;tt&gt;cmdDistrib.blockAndDoRetries();&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Why don&apos;t we call that first? Isn&apos;t this just the same case as a commit? Commit has to blockAndDoRetries first, to make sure it applies to all previous updates.&lt;/p&gt;</comment>
                            <comment id="16569247" author="tomasflobbe" created="Sat, 4 Aug 2018 17:22:05 +0000"  >&lt;p&gt;Uploaded a new patch. In the latest patch I&apos;m calling &lt;tt&gt;blockAndDoRetries&lt;/tt&gt; before distributing the DBQ. I Also reduced the number of retries on standard requests from 5 to 3 (I did some experimentation I saw that the majority of requests either succeed or fail after the first couple requests). I&apos;ll do another check at the ChaosMonkey tests and commit this if I see no errors.&lt;/p&gt;</comment>
                            <comment id="16569309" author="lucenesolrqa" created="Sat, 4 Aug 2018 22:34:01 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/check.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;b&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;&lt;/b&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Vote &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Runtime &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Comment &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Prechecks &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; test4tests &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  0m  0s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; The patch appears to include 3 new or modified test files. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; master Compile Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; compile &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m  9s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; master passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Patch Compile Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; compile &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m  2s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; javac &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m  2s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Release audit (RAT) &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m  2s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Check forbidden APIs &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m  2s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Validate source patterns &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m  2s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Other Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; unit &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; 37m 51s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; core in the patch passed. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt;&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt; &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt; 41m 59s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt; &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Report/Notes &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Issue &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11881&quot; title=&quot;Retry update requests from leaders to replicas&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11881&quot;&gt;&lt;del&gt;SOLR-11881&lt;/del&gt;&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Patch URL &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12934388/SOLR-11881.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12934388/SOLR-11881.patch&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Optional Tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  compile  javac  unit  ratsources  checkforbiddenapis  validatesourcepatterns  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; uname &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Linux lucene1-us-west 4.4.0-130-generic #156~14.04.1-Ubuntu SMP Thu Jun 14 13:51:47 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Build tool &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; ant &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Personality &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; /home/jenkins/jenkins-slave/workspace/PreCommit-SOLR-Build/sourcedir/dev-tools/test-patch/lucene-solr-yetus-personality.sh &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; git revision &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; master / b33df4e &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; ant &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; version: Apache Ant(TM) version 1.9.3 compiled on July 24 2018 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Default Java &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 1.8.0_172 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  Test Results &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/159/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/159/testReport/&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; modules &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; C: solr/core U: solr/core &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Console output &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/159/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/159/console&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Powered by &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Apache Yetus 0.7.0   &lt;a href=&quot;http://yetus.apache.org&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://yetus.apache.org&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;p&gt;This message was automatically generated.&lt;/p&gt;
</comment>
                            <comment id="16570421" author="tomasflobbe" created="Mon, 6 Aug 2018 16:17:18 +0000"  >&lt;p&gt;I&apos;ve been running the &lt;tt&gt;ChaosMonkeyNothingIsSafeTest&lt;/tt&gt; over the weekend and saw no failures (after applying the patch to &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12626&quot; title=&quot;TestInjection.waitForInSyncWithLeader should keep retrying after connection issues&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12626&quot;&gt;&lt;del&gt;SOLR-12626&lt;/del&gt;&lt;/a&gt;). I&apos;ll commit this later today&lt;/p&gt;</comment>
                            <comment id="16570893" author="jira-bot" created="Mon, 6 Aug 2018 22:57:24 +0000"  >&lt;p&gt;Commit c338cf61e7baba4908c31e02beda47ae3e201752 in lucene-solr&apos;s branch refs/heads/master from Tomas Fernandez Lobbe&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c338cf6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c338cf6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11881&quot; title=&quot;Retry update requests from leaders to replicas&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11881&quot;&gt;&lt;del&gt;SOLR-11881&lt;/del&gt;&lt;/a&gt;: Retry update requests from leaders to followers&lt;/p&gt;</comment>
                            <comment id="16570894" author="jira-bot" created="Mon, 6 Aug 2018 22:58:59 +0000"  >&lt;p&gt;Commit 7519e172ce3a3d44dd5b55ce7c74bdf74614f0a8 in lucene-solr&apos;s branch refs/heads/branch_7x from Tomas Fernandez Lobbe&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7519e17&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7519e17&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11881&quot; title=&quot;Retry update requests from leaders to replicas&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11881&quot;&gt;&lt;del&gt;SOLR-11881&lt;/del&gt;&lt;/a&gt;: Retry update requests from leaders to followers&lt;/p&gt;</comment>
                            <comment id="16575418" author="varunthacker" created="Thu, 9 Aug 2018 21:39:13 +0000"  >&lt;p&gt;Closing out this issue&lt;/p&gt;</comment>
                            <comment id="16576003" author="jira-bot" created="Fri, 10 Aug 2018 09:14:00 +0000"  >&lt;p&gt;Commit 9f554f6de0420e39128ce366e6e8e028c2ff66e7 in lucene-solr&apos;s branch refs/heads/jira/http2 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat&quot; class=&quot;user-hover&quot; rel=&quot;caomanhdat&quot;&gt;caomanhdat&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9f554f6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9f554f6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Resolved merge conflict caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11881&quot; title=&quot;Retry update requests from leaders to replicas&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11881&quot;&gt;&lt;del&gt;SOLR-11881&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16576037" author="caomanhdat" created="Fri, 10 Aug 2018 09:54:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tflobbe&quot; class=&quot;user-hover&quot; rel=&quot;tflobbe&quot;&gt;tflobbe&lt;/a&gt; It will be a great help if you can take a look at jira/http2 branch and validate my merge.&lt;/p&gt;</comment>
                            <comment id="16576928" author="tomasflobbe" created="Fri, 10 Aug 2018 22:26:49 +0000"  >&lt;p&gt;LGTM &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat&quot; class=&quot;user-hover&quot; rel=&quot;caomanhdat&quot;&gt;caomanhdat&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13184715">SOLR-12766</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12921495" name="SOLR-11881-SolrCmdDistributor.patch" size="17231" author="tflobbe" created="Tue, 1 May 2018 23:10:24 +0000"/>
                            <attachment id="12934388" name="SOLR-11881.patch" size="48364" author="tflobbe" created="Sat, 4 Aug 2018 17:17:51 +0000"/>
                            <attachment id="12920668" name="SOLR-11881.patch" size="2274" author="varun" created="Wed, 25 Apr 2018 19:14:35 +0000"/>
                            <attachment id="12907028" name="SOLR-11881.patch" size="1602" author="varun" created="Mon, 22 Jan 2018 01:56:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 14 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3p5wn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>