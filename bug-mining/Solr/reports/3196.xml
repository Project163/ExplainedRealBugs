<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:18:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-9448] [subquery] calls another collection fails with &quot;undefined field&quot; or NPE from mergeIds</title>
                <link>https://issues.apache.org/jira/browse/SOLR-9448</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;If subquery collection has a different unique key field name (let&apos;s say &lt;tt&gt;foo_id&lt;/tt&gt; is different to &lt;tt&gt;id&lt;/tt&gt; in primary collection), you&apos;ve got &lt;tt&gt;NullPoniterException&lt;/tt&gt; from &lt;tt&gt;QueryComponent.mergeIds()&lt;/tt&gt;. To accommodate the difference between uniqueKey field names between collections, add the following parameters &lt;tt&gt;foo.fl=id:foo_id&amp;amp;foo.distrib.singlePass=true&lt;/tt&gt;. The former one renames uniqueKey field, the later switches to single pass search. There is no way to rename field in default processing. &lt;br/&gt;
In a rare case when a collection under subquery has no unqueKey at all, it leads to something like &quot;undefined field&quot;, but it&apos;s not going to work anyway.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13000805">SOLR-9448</key>
            <summary>[subquery] calls another collection fails with &quot;undefined field&quot; or NPE from mergeIds</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10005">Workaround</resolution>
                                        <assignee username="mkhl">Mikhail Khludnev</assignee>
                                    <reporter username="mkhl">Mikhail Khludnev</reporter>
                        <labels>
                    </labels>
                <created>Sun, 28 Aug 2016 20:13:38 +0000</created>
                <updated>Sat, 8 Jun 2019 15:38:16 +0000</updated>
                            <resolved>Sun, 25 Dec 2016 18:56:36 +0000</resolved>
                                    <version>6.1</version>
                    <version>6.2</version>
                                    <fixVersion>6.4</fixVersion>
                    <fixVersion>7.0</fixVersion>
                                    <component>SolrCloud</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15467083" author="mkhludnev" created="Tue, 6 Sep 2016 10:37:11 +0000"  >&lt;p&gt;ok. reproduced it with attached test case. The synopsis is: &lt;/p&gt;

&lt;p&gt;if we request one collection from another &lt;tt&gt;/people/select?q=department_text:foo&amp;amp;collection=departments&lt;/tt&gt; the query is unnecessary parsed in &lt;tt&gt;people&lt;/tt&gt; collection where it can hit a wall if schemas are different. &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  @Test
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testJustCrossCollectionRequest() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SolrServerException, IOException { 
    cluster.getSolrClient().request(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; QueryRequest(
        params( &lt;span class=&quot;code-quote&quot;&gt;&quot;q&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;departments_text:foo&quot;&lt;/span&gt;,
                     &lt;span class=&quot;code-quote&quot;&gt;&quot;collection&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;departments&quot;&lt;/span&gt;)
    ), &lt;span class=&quot;code-quote&quot;&gt;&quot;people&quot;&lt;/span&gt;);
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
&lt;p&gt;org.apache.solr.client.solrj.impl.HttpSolrClient$RemoteSolrException: Error from server at &lt;a href=&quot;http://127.0.0.1:52548/solr/people_shard1_replica1:&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://127.0.0.1:52548/solr/people_shard1_replica1:&lt;/a&gt; undefined field departments_text&lt;br/&gt;
	at __randomizedtesting.SeedInfo.seed(&lt;span class=&quot;error&quot;&gt;&amp;#91;1E3C35306C9B6800:E9590C1B5403419&amp;#93;&lt;/span&gt;:0)&lt;br/&gt;
	at org.apache.solr.client.solrj.impl.HttpSolrClient.executeMethod(HttpSolrClient.java:608)&lt;br/&gt;
	at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:261)&lt;br/&gt;
	at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:250)&lt;br/&gt;
	at org.apache.solr.client.solrj.impl.LBHttpSolrClient.doRequest(LBHttpSolrClient.java:415)&lt;br/&gt;
	at org.apache.solr.client.solrj.impl.LBHttpSolrClient.request(LBHttpSolrClient.java:367)&lt;br/&gt;
	at org.apache.solr.client.solrj.impl.CloudSolrClient.sendRequest(CloudSolrClient.java:1280)&lt;br/&gt;
	at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:1050)&lt;br/&gt;
	at org.apache.solr.client.solrj.impl.CloudSolrClient.request(CloudSolrClient.java:992)&lt;br/&gt;
	at org.apache.solr.response.transform.TestSubQueryTransformerDistrib.testJustCrossCollectionRequest(TestSubQueryTransformerDistrib.java:200)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;So, suggested workaround is just to declare fields from the secondary collection or wildcard just to pass unnecessary query parsing.&lt;/p&gt;

&lt;h3&gt;&lt;a name=&quot;Questiontodevelopers&quot;&gt;&lt;/a&gt;Question to developers&lt;/h3&gt;
&lt;p&gt;Don&apos;t we need to bypass query parsing in QueryComponent.prepare() when it&apos;s followed by distributed processing? If we do, I can come up with the patch.&lt;/p&gt;</comment>
                            <comment id="15467140" author="mkhludnev" created="Tue, 6 Sep 2016 11:06:21 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  @Test
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testJustCrossCollectionRequest() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SolrServerException, IOException { 
    cluster.getSolrClient().request(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; QueryRequest(
        params( &lt;span class=&quot;code-quote&quot;&gt;&quot;q&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;*:*&quot;&lt;/span&gt;,
                     &lt;span class=&quot;code-quote&quot;&gt;&quot;collection&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;departments&quot;&lt;/span&gt;)
    ), &lt;span class=&quot;code-quote&quot;&gt;&quot;people&quot;&lt;/span&gt;);
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;if we bypassing query parsing stage, we hit NPE in reduce phase because primary collection ID field name is used for reducing shards results.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;departments_shard1_replica1&amp;#93;&lt;/span&gt;  webapp=/solr path=/select params=&lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {distrib=false&amp;amp;_stateVer_=people}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt; hits=8 status=0 QTime=45&lt;br/&gt;
43234 ERROR (qtp2060379030-30) &lt;span class=&quot;error&quot;&gt;&amp;#91;n:127.0.0.1:53331_solr c:people s:shard1 r:core_node1 x:people_shard1_replica2&amp;#93;&lt;/span&gt; o.a.s.h.RequestHandlerBase java.lang.NullPointerException&lt;br/&gt;
	at org.apache.solr.handler.component.QueryComponent.mergeIds(QueryComponent.java:1113)&lt;br/&gt;
	at org.apache.solr.handler.component.QueryComponent.handleRegularResponses(QueryComponent.java:757)&lt;br/&gt;
	at org.apache.solr.handler.component.QueryComponent.handleResponses(QueryComponent.java:736)&lt;br/&gt;
	at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:422)&lt;br/&gt;
	at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:154)&lt;br/&gt;
	at org.apache.solr.core.SolrCore.execute(SolrCore.java:2107)&lt;br/&gt;
	at org.apache.solr.servlet.HttpSolrCall.execute(HttpSolrCall.java:653)&lt;br/&gt;
	at org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:460)&lt;br/&gt;
	at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:257)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Shouldn&apos;t it be fixed? &lt;/p&gt;</comment>
                            <comment id="15467176" author="mkhludnev" created="Tue, 6 Sep 2016 11:22:50 +0000"  >&lt;p&gt;There reason is that we set caller collection uniqKey even it&apos;s different in another (calee) collection.  &lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/lucene-solr/blob/master/solr/core/src/java/org/apache/solr/handler/component/QueryComponent.java#L914&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/master/solr/core/src/java/org/apache/solr/handler/component/QueryComponent.java#L914&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15773633" author="mkhludnev" created="Fri, 23 Dec 2016 20:30:34 +0000"  >&lt;p&gt;attaching simpler approach to reproduce:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;15551 ERROR (qtp1315527986-39) [n:127.0.0.1:56344_solr c:people s:shard2 r:core_node1 x:people_shard2_replica1] o.a.s.h.RequestHandlerBase java.lang.NullPointerException
	at org.apache.solr.handler.component.QueryComponent.mergeIds(QueryComponent.java:1118)
	at org.apache.solr.handler.component.QueryComponent.handleRegularResponses(QueryComponent.java:763)
	at org.apache.solr.handler.component.QueryComponent.handleResponses(QueryComponent.java:742)
	at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:422)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15775395" author="mkhludnev" created="Sat, 24 Dec 2016 20:32:29 +0000"  >&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12844624/12844624_SOLR-9448.patch&quot; title=&quot;SOLR-9448.patch attached to SOLR-9448&quot;&gt;SOLR-9448.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; proposes a workaround (when a collection for subquery has a different uniqueKey):&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;add field alias for expected uniqueKey: &lt;tt&gt;subq.fl=id:subq_coll_id&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;add &lt;tt&gt;subq.distrib.singlePass=true&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="15776104" author="jira-bot" created="Sun, 25 Dec 2016 07:37:56 +0000"  >&lt;p&gt;Commit 54d8574f9662f89598a06fbb47de9a376ef5d2bc in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mkhludnev&quot; class=&quot;user-hover&quot; rel=&quot;mkhludnev&quot;&gt;mkhludnev&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=54d8574&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=54d8574&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9448&quot; title=&quot;[subquery] calls another collection fails with &amp;quot;undefined field&amp;quot; or NPE from mergeIds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9448&quot;&gt;&lt;del&gt;SOLR-9448&lt;/del&gt;&lt;/a&gt;: providing a test for workaround of a differently named uniqueKey field&lt;/p&gt;</comment>
                            <comment id="15776149" author="jira-bot" created="Sun, 25 Dec 2016 08:20:34 +0000"  >&lt;p&gt;Commit 6cf1f0f51f5f11750b4d9d9ebe157453550b76eb in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mkhludnev&quot; class=&quot;user-hover&quot; rel=&quot;mkhludnev&quot;&gt;mkhludnev&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6cf1f0f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6cf1f0f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9448&quot; title=&quot;[subquery] calls another collection fails with &amp;quot;undefined field&amp;quot; or NPE from mergeIds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9448&quot;&gt;&lt;del&gt;SOLR-9448&lt;/del&gt;&lt;/a&gt;: providing a test for workaround of a differently named uniqueKey field&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12907663">SOLR-8202</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12907778">SOLR-8208</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12844624" name="SOLR-9448.patch" size="7249" author="mkhl" created="Sat, 24 Dec 2016 20:32:29 +0000"/>
                            <attachment id="12844608" name="SOLR-9448.patch" size="3794" author="mkhl" created="Fri, 23 Dec 2016 20:40:28 +0000"/>
                            <attachment id="12827172" name="SOLR-9448.patch" size="15004" author="mkhl" created="Tue, 6 Sep 2016 11:24:11 +0000"/>
                            <attachment id="12827165" name="SOLR-9448.patch" size="14602" author="mkhl" created="Tue, 6 Sep 2016 10:37:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 47 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i32x5j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>