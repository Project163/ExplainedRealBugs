<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:07:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-8001] Using value sources on a multi-valued field can result in an exception if no data</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8001</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2522&quot; title=&quot;add syntax for selecting the min or max of a multivalued field in value source functions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2522&quot;&gt;&lt;del&gt;SOLR-2522&lt;/del&gt;&lt;/a&gt; Introduced the ability to reference a multi-valued field with doc values in a function query (value source) such as like this (an example using it for sorting): &lt;tt&gt;sort=field(myMultiValField,min) asc&lt;/tt&gt;.  In the event that the document has no values for this field, this feature behaves nicely in the aforementioned example.  And it does if you reference in a &apos;fl&apos; (as a DocTransformer): &lt;tt&gt;fl=id,myMultiValField:field(myMultiValField,min)&lt;/tt&gt;.  In that case, the returned document simply doesn&apos;t have a name-value pair.  &lt;b&gt;But&lt;/b&gt;, if you sort on a more complex function that incorporates this, then you get an ArrayIndexOutOfBoundsException.  Such as this:&lt;br/&gt;
&lt;tt&gt;sort=sum(otherField,field(myMultiValField,min)) asc&lt;/tt&gt;  There may be other conditions where this same exception will be thrown; not sure.&lt;/p&gt;

&lt;p&gt;The root cause can either be considered one of two things (or both) I think:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The longVal, intVal, etc. methods on FunctionValues need to be prepared for the possibility that the document has no data, in which case it should return a default value.  This means TrieLongField (&amp;amp; friends) are erroneous.&lt;/li&gt;
	&lt;li&gt;ValueSource.ValueSourceComparator could/should &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; call &lt;tt&gt;exists&lt;/tt&gt; before calling &lt;tt&gt;doubleVal&lt;/tt&gt; in the various methods where it does.&lt;/li&gt;
&lt;/ul&gt;


&lt;hr /&gt;

&lt;p&gt;A workarround for Solr 5.3 users that should work in any situation is to wrap the &lt;tt&gt;field&lt;/tt&gt; function in a &lt;tt&gt;def&lt;/tt&gt; function since that forces an existence check before attempting to access the value (ie: use &lt;tt&gt;sort=def(field(mult_field,min),0)+asc&lt;/tt&gt; instead of &lt;tt&gt;sort=field(mult_field,min)+asc&lt;/tt&gt;)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12861110">SOLR-8001</key>
            <summary>Using value sources on a multi-valued field can result in an exception if no data</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="dsmiley">David Smiley</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Sep 2015 20:31:36 +0000</created>
                <updated>Tue, 15 Dec 2015 13:55:20 +0000</updated>
                            <resolved>Thu, 3 Sep 2015 18:13:36 +0000</resolved>
                                    <version>5.3</version>
                                    <fixVersion>5.4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14726130" author="dsmiley" created="Tue, 1 Sep 2015 20:33:59 +0000"  >&lt;p&gt;I don&apos;t have a complete patch with proper assertions but I triggered the bug by editing &lt;tt&gt;TestMinMaxOnMultiValuedField&lt;/tt&gt; to have a test method like so:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    assertU(adoc(sdoc(&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;)));&lt;span class=&quot;code-comment&quot;&gt;//nothing
&lt;/span&gt;    assertU(commit());
    assertQ(req(&lt;span class=&quot;code-quote&quot;&gt;&quot;q&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;*:*&quot;&lt;/span&gt;,
            &lt;span class=&quot;code-quote&quot;&gt;&quot;sort&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;sum(32,field(val_tls_dv,min)) asc&quot;&lt;/span&gt;),
        &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-comment&quot;&gt;//TODO&quot;&lt;/span&gt;);&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14726194" author="hossman" created="Tue, 1 Sep 2015 21:11:16 +0000"  >&lt;p&gt;david: thanks for following up ... in this context your comments in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2522&quot; title=&quot;add syntax for selecting the min or max of a multivalued field in value source functions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2522&quot;&gt;&lt;del&gt;SOLR-2522&lt;/del&gt;&lt;/a&gt; totally make sense to me now.&lt;/p&gt;

&lt;p&gt;i&apos;ll take care of fleshing out a patch with comprehensive tests and fixes (including your note about optimizing away the extra ord call)&lt;/p&gt;</comment>
                            <comment id="14728197" author="hossman" created="Wed, 2 Sep 2015 23:02:17 +0000"  >
&lt;p&gt;David: please check out the attached patch and let me know if this is what you had in mind.&lt;/p&gt;

&lt;p&gt;NOTE: I discovered that the sort &lt;b&gt;order&lt;/b&gt; when using this function on docs w/o values is inconsistent with the order when using a single valued field (containing the same effictive value) and filed that as a seperate bug since i can&apos;t think of a clear solution at the moment: &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8005&quot; title=&quot;when some docs have no values, sorting on field(multivalued_field,min/max) has inconsistent ordering compared to sorting on same effective values in a single valued field&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8005&quot;&gt;SOLR-8005&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14729088" author="dsmiley" created="Thu, 3 Sep 2015 14:01:53 +0000"  >&lt;p&gt;+1 Nice work &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman&quot; class=&quot;user-hover&quot; rel=&quot;hossman&quot;&gt;hossman&lt;/a&gt;. The patch looks good.&lt;/p&gt;</comment>
                            <comment id="14729420" author="jira-bot" created="Thu, 3 Sep 2015 17:22:11 +0000"  >&lt;p&gt;Commit 1701081 from hossman@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1701081&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1701081&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8001&quot; title=&quot;Using value sources on a multi-valued field can result in an exception if no data&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8001&quot;&gt;&lt;del&gt;SOLR-8001&lt;/del&gt;&lt;/a&gt;: Fixed bugs in field(foo,min) and field(foo,max) when some docs have no values&lt;/p&gt;</comment>
                            <comment id="14729490" author="jira-bot" created="Thu, 3 Sep 2015 18:08:05 +0000"  >&lt;p&gt;Commit 1701090 from hossman@apache.org in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1701090&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1701090&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8001&quot; title=&quot;Using value sources on a multi-valued field can result in an exception if no data&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8001&quot;&gt;&lt;del&gt;SOLR-8001&lt;/del&gt;&lt;/a&gt;: Fixed bugs in field(foo,min) and field(foo,max) when some docs have no values (merge r1701081)&lt;/p&gt;</comment>
                            <comment id="14729496" author="hossman" created="Thu, 3 Sep 2015 18:13:36 +0000"  >&lt;p&gt;thanks david.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12861421">SOLR-8005</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12507438">SOLR-2522</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12753878" name="SOLR-8001.patch" size="11830" author="hossman" created="Wed, 2 Sep 2015 23:02:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 11 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2jo3j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>