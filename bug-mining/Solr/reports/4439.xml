<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:43:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-14217] tests respect tests.workDir correctly (prevent SSD destruction)</title>
                <link>https://issues.apache.org/jira/browse/SOLR-14217</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;To prevent SSD destruction you should be able to set in your &lt;tt&gt;gradle.properties&lt;/tt&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
tests.workDir=/tmp/lucene_gradle
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This causes all tests to write their temporary stuff (e.g. indexes) to that location, instead of build/ directories inside the checkout.&lt;/p&gt;

&lt;p&gt;Unfortunately if you do this, some solr tests fail, because their configs will then try to reach out to invalid places. It happens because they load up configuration files with logic that looks like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;lib dir=&lt;span class=&quot;code-quote&quot;&gt;&quot;${solr.install.dir:../../../..}/contrib/extraction/lib&quot;&lt;/span&gt; regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;.*\.jar&quot;&lt;/span&gt; /&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Because &lt;tt&gt;solr.install.dir&lt;/tt&gt; is not set, it falls back to an inappropriate relative path, and tries to access bogus locations on the filesystem, causing tests to fail:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  2&amp;gt; Caused by: org.apache.solr.common.SolrException: Error loading solr config from /tmp/lucene_gradle/solr.client.solrj.embedded.SolrExampleJettyTest_FF93943C1C04FCAC-001/tempDir-001/collection1/conf/solrconfig.xml
  2&amp;gt;    at org.apache.solr.core.SolrConfig.readFromResourceLoader(SolrConfig.java:157)
  2&amp;gt;    at org.apache.solr.core.ConfigSetService.createSolrConfig(ConfigSetService.java:111)
  2&amp;gt;    at org.apache.solr.core.ConfigSetService.loadConfigSet(ConfigSetService.java:82)
  2&amp;gt;    ... 8 more
  2&amp;gt; Caused by: java.security.AccessControlException: access denied (&quot;java.io.FilePermission&quot; &quot;/tmp/lucene_gradle/solr.client.solrj.embedded.SolrExampleJettyTest_FF93943C1C04FCAC-001/tempDir-001/collection1/../../../../contrib/extraction/lib&quot; &quot;read&quot;)
  2&amp;gt;    at java.base/java.security.AccessControlContext.checkPermission(AccessControlContext.java:472)
  2&amp;gt;    at java.base/java.security.AccessController.checkPermission(AccessController.java:1036)
  2&amp;gt;    at java.base/java.lang.SecurityManager.checkPermission(SecurityManager.java:408)
  2&amp;gt;    at java.base/java.lang.SecurityManager.checkRead(SecurityManager.java:747)
  2&amp;gt;    at java.base/sun.nio.fs.UnixPath.checkRead(UnixPath.java:818)
  2&amp;gt;    at java.base/sun.nio.fs.UnixFileSystemProvider.newDirectoryStream(UnixFileSystemProvider.java:399)
  2&amp;gt;    at java.base/java.nio.file.Files.newDirectoryStream(Files.java:607)
  2&amp;gt;    at org.apache.solr.core.SolrResourceLoader.getURLs(SolrResourceLoader.java:286)
  2&amp;gt;    at org.apache.solr.core.SolrResourceLoader.getFilteredURLs(SolrResourceLoader.java:319)
  2&amp;gt;    at org.apache.solr.core.SolrConfig.initLibs(SolrConfig.java:782)
  2&amp;gt;    at org.apache.solr.core.SolrConfig.&amp;lt;init&amp;gt;(SolrConfig.java:176)
  2&amp;gt;    at org.apache.solr.core.SolrConfig.readFromResourceLoader(SolrConfig.java:149)
  2&amp;gt;    ... 10 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The system property must be set so that these tests will work with the configured tests.workDir&lt;/p&gt;

&lt;p&gt;It has no impact on tests speed, because solr tests are all sitting in Thread.sleep, not bottlenecked on anything related to this.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13281548">SOLR-14217</key>
            <summary>tests respect tests.workDir correctly (prevent SSD destruction)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Sat, 25 Jan 2020 14:29:56 +0000</created>
                <updated>Thu, 20 Jan 2022 21:26:57 +0000</updated>
                            <resolved>Mon, 27 Jan 2020 11:09:23 +0000</resolved>
                                                    <fixVersion>8.5</fixVersion>
                                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17024255" author="jira-bot" created="Mon, 27 Jan 2020 11:07:46 +0000"  >&lt;p&gt;Commit 5f964eeef2fe4ebb65fc4053f62e2916f4ae6b33 in lucene-solr&apos;s branch refs/heads/master from Robert Muir&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=5f964ee&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=5f964ee&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14217&quot; title=&quot;tests respect tests.workDir correctly (prevent SSD destruction)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14217&quot;&gt;&lt;del&gt;SOLR-14217&lt;/del&gt;&lt;/a&gt;: tests respect tests.workDir correctly (prevent SSD destruction)&lt;/p&gt;</comment>
                            <comment id="17024281" author="jira-bot" created="Mon, 27 Jan 2020 11:37:49 +0000"  >&lt;p&gt;Commit 5f964eeef2fe4ebb65fc4053f62e2916f4ae6b33 in lucene-solr&apos;s branch refs/heads/gradle-master from Robert Muir&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=5f964ee&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=5f964ee&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14217&quot; title=&quot;tests respect tests.workDir correctly (prevent SSD destruction)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14217&quot;&gt;&lt;del&gt;SOLR-14217&lt;/del&gt;&lt;/a&gt;: tests respect tests.workDir correctly (prevent SSD destruction)&lt;/p&gt;</comment>
                            <comment id="17026136" author="jira-bot" created="Wed, 29 Jan 2020 19:18:54 +0000"  >&lt;p&gt;Commit 0cc67223a82edf688b3dff66c286c492b1513467 in lucene-solr&apos;s branch refs/heads/branch_8x from Robert Muir&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=0cc6722&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=0cc6722&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14217&quot; title=&quot;tests respect tests.workDir correctly (prevent SSD destruction)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14217&quot;&gt;&lt;del&gt;SOLR-14217&lt;/del&gt;&lt;/a&gt;: tests respect tests.workDir correctly (prevent SSD destruction)&lt;/p&gt;</comment>
                            <comment id="17039400" author="gus_heck" created="Tue, 18 Feb 2020 19:41:04 +0000"  >&lt;p&gt;I think we at least need a null check here... &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-comment&quot;&gt;// set solr.install.dir needed by some test configs outside of the test sandbox (!)
&lt;/span&gt;    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.setProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.install.dir&quot;&lt;/span&gt;, ExternalPaths.SOURCE_HOME);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This causes failures for folks using the solr test infrastructure in projects other than solr because SOURCE_HOME can be null. That leads to:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.NullPointerException
	at __randomizedtesting.SeedInfo.seed([7A1D202DDAEA1C07]:0)
	at java.base/java.util.concurrent.ConcurrentHashMap.putVal(ConcurrentHashMap.java:1011)
	at java.base/java.util.concurrent.ConcurrentHashMap.put(ConcurrentHashMap.java:1006)
	at java.base/java.util.Properties.put(Properties.java:1337)
	at java.base/java.util.Properties.setProperty(Properties.java:225)
	at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.setProperty(&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.java:895)
	at org.apache.solr.SolrTestCaseJ4.setupTestCases(SolrTestCaseJ4.java:284)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
	at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1750)
	at com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:878)
	at com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:894)
	at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
	at com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:57)
	at org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:45)
	at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
	at org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:41)
	at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
	at com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:40)
	at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
	at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
	at org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:53)
	at org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:47)
	at org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:64)
	at org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:54)
	at com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)
	at com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:368)
	at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:834)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17039422" author="rcmuir" created="Tue, 18 Feb 2020 20:17:01 +0000"  >&lt;p&gt;All tests pass with the change here. It is all I can do to support the apache lucene/solr projects. &lt;/p&gt;

&lt;p&gt;If we have a use-case for consuming this stuff downstream, there should be a test for that, otherwise it will break &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17039501" author="gus_heck" created="Tue, 18 Feb 2020 21:57:39 +0000"  >&lt;p&gt;Well yes, a unit test would be very good indeed, but it&apos;s pretty clear from the code in &lt;tt&gt;org.apache.solr.util.ExternalPaths#determineSourceHome&lt;/tt&gt; that null is a potential outcome.  I can fix it myself, do you suspect that your use case will be bothered if it becomes: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-comment&quot;&gt;// set solr.install.dir needed by some test configs outside of the test sandbox (!)
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ExternalPaths.SOURCE_HOME != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.setProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.install.dir&quot;&lt;/span&gt;, ExternalPaths.SOURCE_HOME);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;(that&apos;s avoiding the exception for me locally already, though I haven&apos;t added/run the solr tests yet) The unit test for this should be slightly interesting since it&apos;s code in a static method and it&apos;s going to go looking at the file system... &lt;/p&gt;</comment>
                            <comment id="17039529" author="rcmuir" created="Tue, 18 Feb 2020 22:51:10 +0000"  >&lt;p&gt;my use case is just fixing SSD destruction for the apache project. I&apos;m not concerned at all about downstream uses (if it is not tested, I will break it).&lt;/p&gt;</comment>
                            <comment id="17065667" author="romseygeek" created="Tue, 24 Mar 2020 12:45:49 +0000"  >&lt;p&gt;Bulk close for 8.5.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13287752">SOLR-14283</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13288186">SOLR-14290</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12991827" name="SOLR-14217.patch" size="1329" author="rcmuir" created="Sat, 25 Jan 2020 14:30:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 34 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0auzk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>