<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:18:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-9917] NPE in JSON facet merger</title>
                <link>https://issues.apache.org/jira/browse/SOLR-9917</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;I&apos;ve spotted this before, and just now one of my unit tests does it as well. I believe this happens when there is no data for the requested field.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.NullPointerException
        at java.nio.ByteBuffer.wrap(ByteBuffer.java:396)
        at org.apache.solr.search.facet.PercentileAgg$Merger.merge(PercentileAgg.java:195)
        at org.apache.solr.search.facet.FacetBucket.mergeBucket(FacetBucket.java:90)
        at org.apache.solr.search.facet.FacetRequestSortedMerger.mergeBucketList(FacetRequestSortedMerger.java:61)
        at org.apache.solr.search.facet.FacetRangeMerger.mergeBucketList(FacetRangeMerger.java:27)
        at org.apache.solr.search.facet.FacetRangeMerger.merge(FacetRangeMerger.java:91)
        at org.apache.solr.search.facet.FacetRangeMerger.merge(FacetRangeMerger.java:43)
        at org.apache.solr.search.facet.FacetBucket.mergeBucket(FacetBucket.java:90)
        at org.apache.solr.search.facet.FacetQueryMerger.merge(FacetModule.java:444)
        at org.apache.solr.search.facet.FacetModule.handleResponses(FacetModule.java:272)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13031702">SOLR-9917</key>
            <summary>NPE in JSON facet merger</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                    <reporter username="markus17">Markus Jelsma</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 Jan 2017 17:28:39 +0000</created>
                <updated>Sat, 8 Jun 2019 15:29:27 +0000</updated>
                            <resolved>Thu, 5 Jan 2017 13:02:54 +0000</resolved>
                                    <version>6.3</version>
                                    <fixVersion>6.4</fixVersion>
                    <fixVersion>7.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15795608" author="markus17" created="Tue, 3 Jan 2017 17:32:42 +0000"  >&lt;p&gt;I can now also confirm that lack of data for a field causes the NPE to occur. I added data for a field to my failing unit test, it now passes.&lt;/p&gt;</comment>
                            <comment id="15795820" author="yseeley@gmail.com" created="Tue, 3 Jan 2017 18:47:32 +0000"  >&lt;p&gt;Thanks for investigating Markus, I&apos;ll look into it now...&lt;/p&gt;</comment>
                            <comment id="15796234" author="yseeley@gmail.com" created="Tue, 3 Jan 2017 21:28:13 +0000"  >&lt;p&gt;It&apos;s odd this never happens once in a while to TestJsonFacets, so the criteria may be more specific than having a shard w/o a field.  What does the relevant part of the query request look like (i.e. how is the percentile being used and what is it nested under?)&lt;/p&gt;</comment>
                            <comment id="15796276" author="yseeley@gmail.com" created="Tue, 3 Jan 2017 21:44:53 +0000"  >&lt;p&gt;Here&apos;s a test patch I tried using to force empty shards.  But I guess we need more along the lines of shards with documents but w/o the values.  I&apos;ll try that next.&lt;/p&gt;</comment>
                            <comment id="15796277" author="markus17" created="Tue, 3 Jan 2017 21:45:29 +0000"  >&lt;p&gt;I only have access to the code right now, here&apos;s the SolrJ code causing it:&lt;/p&gt;

&lt;p&gt;vars:&lt;br/&gt;
logHistory is just the number of days we look back in the history;&lt;br/&gt;
percentile is, well, the percentile, it is set to 90th percentile&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    SolrQuery query = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SolrQuery(&lt;span class=&quot;code-quote&quot;&gt;&quot;{!term f=document}&quot;&lt;/span&gt; + document);
    query.setRows(0);
    query.addFilterQuery(&lt;span class=&quot;code-quote&quot;&gt;&quot;{!term f=type}view&quot;&lt;/span&gt;);
    query.addFilterQuery(&lt;span class=&quot;code-quote&quot;&gt;&quot;time:[NOW-&quot;&lt;/span&gt; + logHistory + &lt;span class=&quot;code-quote&quot;&gt;&quot;DAY/DAY TO NOW+1DAY/DAY]&quot;&lt;/span&gt;);

    query.setParam(&lt;span class=&quot;code-quote&quot;&gt;&quot;json.facet&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;{period:{type:range,field:time,start:\&quot;&lt;/span&gt;NOW-&lt;span class=&quot;code-quote&quot;&gt;&quot; + logHistory + &quot;&lt;/span&gt;DAY/DAY\&lt;span class=&quot;code-quote&quot;&gt;&quot;,end:\&quot;&lt;/span&gt;NOW+1DAY/DAY\&lt;span class=&quot;code-quote&quot;&gt;&quot;,gap:\&quot;&lt;/span&gt;+&lt;span class=&quot;code-quote&quot;&gt;&quot; + logHistory + &quot;&lt;/span&gt;DAY\&lt;span class=&quot;code-quote&quot;&gt;&quot;,facet:{time_percentiles:\&quot;&lt;/span&gt;percentile(view_time,&lt;span class=&quot;code-quote&quot;&gt;&quot; + percentile + &quot;&lt;/span&gt;)\&lt;span class=&quot;code-quote&quot;&gt;&quot;}}}&quot;&lt;/span&gt;);

    QueryResponse response = client.query(query);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Let me know if you need more information.&lt;/p&gt;</comment>
                            <comment id="15796280" author="markus17" created="Tue, 3 Jan 2017 21:46:50 +0000"  >&lt;p&gt;Oh, i should add that this is indeed in cloud mode. The unit tests also run in cloud mode.&lt;/p&gt;</comment>
                            <comment id="15796293" author="markus17" created="Tue, 3 Jan 2017 21:52:41 +0000"  >&lt;p&gt;The NPE is thrown at the line where i execute the query with this test input data:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    indexDoc(sdoc(&lt;span class=&quot;code-quote&quot;&gt;&quot;document&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;document_A&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;uid&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;time&quot;&lt;/span&gt;, time(24), &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;view&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;key&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;test_key&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;coord&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;53.22,6.56&quot;&lt;/span&gt;));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It&apos;s gone when adding the requested data (view_time=50)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    indexDoc(sdoc(&lt;span class=&quot;code-quote&quot;&gt;&quot;document&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;document_A&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;uid&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;time&quot;&lt;/span&gt;, time(24), &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;view&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;key&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;test_key&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;coord&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;53.22,6.56&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;view_time&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;50&quot;&lt;/span&gt;));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test extends AbstractFullDistribZkTestBase and has @ShardsFixed(num = 2) set&lt;/p&gt;</comment>
                            <comment id="15796375" author="yseeley@gmail.com" created="Tue, 3 Jan 2017 22:18:31 +0000"  >&lt;p&gt;Thanks for the extra info, I&apos;ve now reproduced it and am working on a fix.&lt;/p&gt;</comment>
                            <comment id="15799347" author="yseeley@gmail.com" created="Wed, 4 Jan 2017 21:08:56 +0000"  >&lt;p&gt;OK, here&apos;s a patch + test.&lt;/p&gt;</comment>
                            <comment id="15800320" author="jira-bot" created="Thu, 5 Jan 2017 04:53:19 +0000"  >&lt;p&gt;Commit 7ef6a8184682e046a6a8ce9166978c320d285a1a in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7ef6a81&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7ef6a81&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9917&quot; title=&quot;NPE in JSON facet merger&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9917&quot;&gt;&lt;del&gt;SOLR-9917&lt;/del&gt;&lt;/a&gt;: fix NPE in distrib percentiles when no values for field in bucket&lt;/p&gt;</comment>
                            <comment id="15801122" author="jira-bot" created="Thu, 5 Jan 2017 11:32:07 +0000"  >&lt;p&gt;Commit 302cee59242c95b03750ebeb581b5ac27e8f2c55 in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=302cee5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=302cee5&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9917&quot; title=&quot;NPE in JSON facet merger&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9917&quot;&gt;&lt;del&gt;SOLR-9917&lt;/del&gt;&lt;/a&gt;: fix NPE in distrib percentiles when no values for field in bucket&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12845619" name="SOLR-9917.patch" size="8833" author="yseeley@gmail.com" created="Wed, 4 Jan 2017 21:08:56 +0000"/>
                            <attachment id="12845432" name="SOLR-9917.patch" size="4147" author="yseeley@gmail.com" created="Tue, 3 Jan 2017 21:44:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 45 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i387kf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>