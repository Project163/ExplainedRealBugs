<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:32:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-12256] Aliases and eventual consistency (should use sync())</title>
                <link>https://issues.apache.org/jira/browse/SOLR-12256</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;ZkStateReader.AliasesManager.update() reads alias info from ZK into the ZkStateReader. &#160;This method is called in ~5 places&#160;(+2 for tests). &#160;In at least some of these places, the caller assumes that the alias&#160;info is subsequently up to date when in fact this might not be so since ZK is allowed to return a stale value. &#160;ZooKeeper.sync() can be called to force an up to date value. &#160;As with sync(), AliasManager.update() ought not to be called&#160;aggressively/commonly, only in certain circumstances (e.g. &lt;em&gt;after&lt;/em&gt;&#160;failing to resolve stuff that would otherwise return an error).&lt;/p&gt;

&lt;p&gt;And related to this eventual consistency issue, SetAliasPropCmd will throw an exception if the alias doesn&apos;t exist. &#160;Fair enough, but sometimes (as seen in some tests), the node receiving the command to update Alias properties is simply &quot;behind&quot;; it does not yet know about an alias that other nodes know about. &#160;I believe this is the cause of some failures in&#160;AliasIntegrationTest; perhaps others.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13154132">SOLR-12256</key>
            <summary>Aliases and eventual consistency (should use sync())</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dsmiley">David Smiley</assignee>
                                    <reporter username="dsmiley">David Smiley</reporter>
                        <labels>
                    </labels>
                <created>Fri, 20 Apr 2018 19:50:20 +0000</created>
                <updated>Sat, 8 Jun 2019 14:47:52 +0000</updated>
                            <resolved>Tue, 15 May 2018 03:19:30 +0000</resolved>
                                                    <fixVersion>7.3.1</fixVersion>
                                    <component>SolrCloud</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16446299" author="dsmiley" created="Fri, 20 Apr 2018 20:14:47 +0000"  >&lt;p&gt;Patch notes:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;ZkStateReader: AliasesManager.update() add call to ZooKeeper.sync()&lt;/li&gt;
	&lt;li&gt;SetAliasPropCmd:
	&lt;ul&gt;
		&lt;li&gt;eagerly call&#160;AliasesManager.update(). &#160;Setting alias props won&apos;t be called in high frequency so I think this is ok.&lt;/li&gt;
		&lt;li&gt;Improve efficiency by using the the overloaded method of .applyModificationAndExportToZk that takes a Map instead of making modifications one at a time.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;AliasIntegrationTest:
	&lt;ul&gt;
		&lt;li&gt;comment away BadApple annotations. &#160;I&apos;m looking at these things.&lt;/li&gt;
		&lt;li&gt;Minor inlining of needless UnaryOperator local vars&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;CreateRoutedAliasTest:&#160;comment away BadApple annotations. &#160;I&apos;m looking at these things.&lt;/li&gt;
	&lt;li&gt;TimeRoutedAliasUpdateProcessorTest: added more diagnostic logging and cleaned up some indentation and other minor stuff.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;b&gt;I&apos;m going to commit this right away and keep the issue open a bit to see the effects (hopefully no Jenkins failures).&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;Furthermore, I looked at two separate&#160;TimeRoutedAliasUpdateProcessorTest failures by Jenkins. &#160;These failures I&apos;m certain have (almost) nothing to do with the above.&lt;/p&gt;

&lt;p&gt;(1)&#160;Timed out creating the collection &lt;tt&gt;alias + &quot;_2017-10-23&quot;&lt;/tt&gt; which is at a point before any actual TRA stuff is happening. &#160;I looked at the logs carefully and I have no idea why it timed out. &#160;It seems the collection was created (shards were being made) then a long pause of ~165 seconds and then the timeout failure. &#160;I&apos;ll keep an eye on this... I&apos;m keeping the logs to compare.&lt;/p&gt;

&lt;p&gt;(2) After&#160;the comment &quot;manipulate the config&quot; we configure the collection created before this step. &#160;We use the V2 API. &#160;But when it got to Solr, the node receiving it didn&apos;t know about this collection and so it failed. &#160;Note that the V1 API will not immediately fail, it will&#160;internally call AliasesManager.update() and then do a retry. &#160;Wether or not an alias is actually being referenced, this has the effect of giving the V1 API a little bit more time to see the collection or alias. &#160;I&apos;ll file a separate issue about this.&lt;/p&gt;</comment>
                            <comment id="16446305" author="jira-bot" created="Fri, 20 Apr 2018 20:22:22 +0000"  >&lt;p&gt;Commit 8f296d0ccf82174f9c612920ce25b928196a1fa8 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8f296d0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8f296d0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12256&quot; title=&quot;Aliases and eventual consistency (should use sync())&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12256&quot;&gt;&lt;del&gt;SOLR-12256&lt;/del&gt;&lt;/a&gt;: AliasesManager.update() should call ZooKeeper.sync()&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;SetAliasPropCmd now calls AliasesManager.update() first.&lt;/li&gt;
	&lt;li&gt;SetAliasPropCmd now more efficiently updates multiple values.&lt;/li&gt;
	&lt;li&gt;Tests: Commented out BadApple annotations on alias related stuff.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16446307" author="jira-bot" created="Fri, 20 Apr 2018 20:24:14 +0000"  >&lt;p&gt;Commit b16b380b2cec1614597df6a045599307628988c2 in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b16b380&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b16b380&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12256&quot; title=&quot;Aliases and eventual consistency (should use sync())&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12256&quot;&gt;&lt;del&gt;SOLR-12256&lt;/del&gt;&lt;/a&gt;: AliasesManager.update() should call ZooKeeper.sync()&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;SetAliasPropCmd now calls AliasesManager.update() first.&lt;/li&gt;
	&lt;li&gt;SetAliasPropCmd now more efficiently updates multiple values.&lt;/li&gt;
	&lt;li&gt;Tests: Commented out BadApple annotations on alias related stuff.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;(cherry picked from commit 8f296d0)&lt;/p&gt;</comment>
                            <comment id="16446314" author="jira-bot" created="Fri, 20 Apr 2018 20:29:17 +0000"  >&lt;p&gt;Commit 566c07f7de3ada3a537d34ec10a38565f5094398 in lucene-solr&apos;s branch refs/heads/branch_7_3 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=566c07f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=566c07f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12256&quot; title=&quot;Aliases and eventual consistency (should use sync())&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12256&quot;&gt;&lt;del&gt;SOLR-12256&lt;/del&gt;&lt;/a&gt;: AliasesManager.update() should call ZooKeeper.sync()&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;SetAliasPropCmd now calls AliasesManager.update() first.&lt;/li&gt;
	&lt;li&gt;SetAliasPropCmd now more efficiently updates multiple values.&lt;/li&gt;
	&lt;li&gt;Tests: Commented out BadApple annotations on alias related stuff.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;(cherry picked from commit b16b380)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13154166">SOLR-12258</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12920072" name="SOLR-12256.patch" size="18350" author="dsmiley" created="Fri, 20 Apr 2018 19:55:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 30 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3su7r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>