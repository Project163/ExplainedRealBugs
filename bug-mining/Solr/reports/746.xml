<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:24:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-1730] Solr fails to start if QueryElevationComponent config is missing</title>
                <link>https://issues.apache.org/jira/browse/SOLR-1730</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;QueryElevationComponent tries to do preload some data if its config file does not exist:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!exists){
          &lt;span class=&quot;code-comment&quot;&gt;// preload the first data
&lt;/span&gt;          RefCounted&amp;lt;SolrIndexSearcher&amp;gt; searchHolder = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
          &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            searchHolder = core.getNewestSearcher(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
            IndexReader reader = searchHolder.get().getReader();
            getElevationMap( reader, core );
          } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (searchHolder != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) searchHolder.decref();
          }
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This does not work though, as asking for the newest searcher causes a request to be submitted to Solr before its ready to handle it:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;     [java] SEVERE: java.lang.NullPointerException
     [java] 	at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:173)
     [java] 	at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:131)
     [java] 	at org.apache.solr.core.SolrCore.execute(SolrCore.java:1317)
     [java] 	at org.apache.solr.core.QuerySenderListener.newSearcher(QuerySenderListener.java:52)
     [java] 	at org.apache.solr.core.SolrCore$3.call(SolrCore.java:1147)
     [java] 	at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)
     [java] 	at java.util.concurrent.FutureTask.run(FutureTask.java:138)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The SearchHandler has not yet been core informed (as the QueryElevationComponent causes this as its getting core informed right before the SearchHandler) and so its components arraylist is still null.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12446259">SOLR-1730</key>
            <summary>Solr fails to start if QueryElevationComponent config is missing</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gsingers">Grant Ingersoll</assignee>
                                    <reporter username="markrmiller@gmail.com">Mark Miller</reporter>
                        <labels>
                            <label>newdev</label>
                    </labels>
                <created>Thu, 21 Jan 2010 19:58:30 +0000</created>
                <updated>Fri, 10 May 2013 10:40:57 +0000</updated>
                            <resolved>Thu, 8 Dec 2011 12:09:30 +0000</resolved>
                                    <version>1.4</version>
                                    <fixVersion>3.6</fixVersion>
                    <fixVersion>4.0-ALPHA</fixVersion>
                                    <component>SearchComponents - other</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12872584" author="hossman" created="Thu, 27 May 2010 22:08:17 +0000"  >&lt;p&gt;Bulk updating 240 Solr issues to set the Fix Version to &quot;next&quot; per the process outlined in this email...&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/lucene-dev/201005.mbox/%3Calpine.DEB.1.10.1005251052040.24672@radix.cryptio.net%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://mail-archives.apache.org/mod_mbox/lucene-dev/201005.mbox/%3Calpine.DEB.1.10.1005251052040.24672@radix.cryptio.net%3E&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Selection criteria was &quot;Unresolved&quot; with a Fix Version of 1.5, 1.6, 3.1, or 4.0.  email notifications were suppressed.&lt;/p&gt;

&lt;p&gt;A unique token for finding these 240 issues in the future: hossversioncleanup20100527&lt;/p&gt;</comment>
                            <comment id="12884078" author="gsingers" created="Wed, 30 Jun 2010 22:19:14 +0000"  >&lt;p&gt;I don&apos;t understand why it needs to even do this, what benefit is there to the QEC if it doesn&apos;t have an elevation file?  Seems like it should just disable itself or throw an exception and fail.&lt;/p&gt;</comment>
                            <comment id="13043655" author="rcmuir" created="Fri, 3 Jun 2011 16:46:21 +0000"  >&lt;p&gt;Bulk move 3.2 -&amp;gt; 3.3&lt;/p&gt;</comment>
                            <comment id="13106470" author="rcmuir" created="Fri, 16 Sep 2011 14:51:13 +0000"  >&lt;p&gt;3.4 -&amp;gt; 3.5&lt;/p&gt;</comment>
                            <comment id="13140177" author="buckett" created="Mon, 31 Oct 2011 14:18:49 +0000"  >&lt;p&gt;I&apos;ve been seeing a similar stack trace:&lt;/p&gt;

&lt;p&gt;Oct 31, 2011 2:06:55 PM org.apache.solr.common.SolrException log&lt;br/&gt;
SEVERE: java.lang.NullPointerException&lt;br/&gt;
	at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:172)&lt;br/&gt;
	at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:129)&lt;br/&gt;
	at org.apache.solr.core.SolrCore.execute(SolrCore.java:1368)&lt;br/&gt;
	at org.apache.solr.core.QuerySenderListener.newSearcher(QuerySenderListener.java:54)&lt;br/&gt;
	at org.apache.solr.core.SolrCore$3.call(SolrCore.java:1177)&lt;br/&gt;
	at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&lt;br/&gt;
	at java.util.concurrent.FutureTask.run(FutureTask.java:138)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:680)&lt;/p&gt;

&lt;p&gt;and when trying to access solr the error is:&lt;/p&gt;

&lt;p&gt;QueryElevationComponent missing config file: &apos;elevate.xml either: /Applications/Eclipse Indigo/Eclipse (Indigo).app/Contents/MacOS/solr/./conf/elevate.xml or /Applications/Eclipse Indigo/Eclipse (Indigo).app/Contents/MacOS/solr/./data/elevate.xml must exist, but not both.&lt;/p&gt;</comment>
                            <comment id="13163834" author="gsingers" created="Tue, 6 Dec 2011 21:01:02 +0000"  >&lt;p&gt;If I move elevate.xml out of example/solr/conf, I get:&lt;/p&gt;
&lt;blockquote&gt;

&lt;p&gt;Dec 6, 2011 3:59:17 PM org.apache.solr.common.SolrException log&lt;br/&gt;
SEVERE: java.lang.NullPointerException&lt;br/&gt;
	at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:167)&lt;br/&gt;
	at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:129)&lt;br/&gt;
	at org.apache.solr.core.SolrCore.execute(SolrCore.java:1474)&lt;br/&gt;
	at org.apache.solr.core.QuerySenderListener.newSearcher(QuerySenderListener.java:59)&lt;br/&gt;
	at org.apache.solr.core.SolrCore$3.call(SolrCore.java:1251)&lt;br/&gt;
	at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&lt;br/&gt;
	at java.util.concurrent.FutureTask.run(FutureTask.java:138)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:680)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;But I don&apos;t see the exception in the QEC that should be thrown by line 191.  If I setup a test locally using the solrconfig-elevate.xml, then I can get the Solr exception.&lt;/p&gt;</comment>
                            <comment id="13163836" author="gsingers" created="Tue, 6 Dec 2011 21:03:48 +0000"  >&lt;p&gt;I can also see this would get screwed up in Zookeeper mode if the elevate file didn&apos;t exist.&lt;/p&gt;</comment>
                            <comment id="13163837" author="gsingers" created="Tue, 6 Dec 2011 21:04:37 +0000"  >&lt;p&gt;AFAICT, the problem seems to hinge on the fact that we assume that if the file doesn&apos;t exist in the conf dir that it must exist in the data dir.&lt;/p&gt;</comment>
                            <comment id="13163852" author="gsingers" created="Tue, 6 Dec 2011 21:14:01 +0000"  >&lt;p&gt;In the Solr example case, it appears the exception is getting swallowed somewhere along the line.  It isn&apos;t showing up in the logs, but for some reason, it thinks it has already been logged.&lt;/p&gt;</comment>
                            <comment id="13163855" author="gsingers" created="Tue, 6 Dec 2011 21:18:12 +0000"  >&lt;p&gt;The cause is due to the wrapping SolrException on line 217, which marks it as logged by true&lt;/p&gt;</comment>
                            <comment id="13164063" author="gsingers" created="Wed, 7 Dec 2011 01:58:02 +0000"  >&lt;p&gt;Note, this NPE actually happens if any component throws an exception in inform(), it seems.&lt;/p&gt;</comment>
                            <comment id="13164506" author="gsingers" created="Wed, 7 Dec 2011 16:43:03 +0000"  >&lt;p&gt;A little bit of progress, namely in setting up some tests for this as well as fixing the logging of the main exception.&lt;/p&gt;

&lt;p&gt;The BadComponentTest shows the error (as well as some issue with either the harness or core itself when it comes to bad components).  The QEC is just the symptom of what&apos;s wrong here, as all Components produce similar errors if the inform() fails.  The real question is, what should we do about it, since inform is called on reloads, not just at startup it gets a bit trickier with the fail early approach that one often wants.&lt;/p&gt;</comment>
                            <comment id="13164523" author="gsingers" created="Wed, 7 Dec 2011 17:06:42 +0000"  >&lt;blockquote&gt;
&lt;p&gt;The SearchHandler has not yet been core informed (as the QueryElevationComponent causes this as its getting core informed right before the SearchHandler) and so its components arraylist is still null.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I believe this is no longer the case, at least in 4.  I think this all works correctly other than what to do if an inform() actually fails.  For QEC, it&apos;s probably enough to log and silently not elevate anything, but I&apos;m not sure if that makes sense with other components&lt;/p&gt;</comment>
                            <comment id="13164537" author="gsingers" created="Wed, 7 Dec 2011 17:19:46 +0000"  >&lt;p&gt;OK, so per IRC discussion w/ Mark and looking at the code, this exception actually causes the core to fail to construct and be registered.&lt;/p&gt;

&lt;p&gt;It seems to me, then, that the way forward is that if this is the only core (or would be the only core) then Solr should fail and exit.  If there are other cores, it should log that the core for XXXX cannot be created and then proceed.  One core failure should not cause the others to be out of service.&lt;/p&gt;</comment>
                            <comment id="13164565" author="yseeley@gmail.com" created="Wed, 7 Dec 2011 17:45:11 +0000"  >&lt;p&gt;Is there an easy way we could avoid yet another solrconfig.xml file?  Perhaps making the elevate file a system property in the existing solrconfig-elevate.xml and just change it for the &quot;bad&quot; test?&lt;/p&gt;</comment>
                            <comment id="13164575" author="gsingers" created="Wed, 7 Dec 2011 17:52:35 +0000"  >&lt;p&gt;The NPE is due to the fact that we initListeners() then we call getSearcher() which creates the new searcher and registers a Future/Callable on those listeners passing in &quot;this&quot; (i.e. the partially constructed core that is about to fail), then later, when the core fails, there is still an thread/future/callable waiting to fire off the newSearcher event which it does as soon as the CountDownLatch is released.  Little does it know, the core is actually dead.  I don&apos;t particularly think we need to fix this other than to perhaps document it here, as I think, since things are undefined at this point b/c the core is dead, that we shouldn&apos;t care too much about these side consequences.&lt;/p&gt;</comment>
                            <comment id="13164590" author="gsingers" created="Wed, 7 Dec 2011 18:18:04 +0000"  >&lt;p&gt;This patch should fix the problem.  I did a couple of things:&lt;/p&gt;

&lt;p&gt;1. Addressed the solrconfig issue Yonik raised (i.e. use a sys property)&lt;br/&gt;
2. I logged that the core can&apos;t be created.&lt;br/&gt;
3. If there is only 1 core being created, then this throws an exception up and out of Solr to the container.  Based on the docs, it seems different containers will deal with this as they see fit.  Jetty simply displays an error message.&lt;br/&gt;
4. I marked the exception coming out of QEC as not logged yet.&lt;br/&gt;
5. In the SolrCore initialization code, I changed from only catching IOException to catching Throwable.  I also then release the latch and close down any resources the core has allocated so far.  I had to release the latch in the catch block there otherwise the ExecutorService can&apos;t shutdown because it is blocked on the latch.&lt;/p&gt;

&lt;p&gt;I&apos;m running full tests now.&lt;/p&gt;</comment>
                            <comment id="13164594" author="gsingers" created="Wed, 7 Dec 2011 18:26:33 +0000"  >&lt;p&gt;All tests pass for me locally.&lt;/p&gt;</comment>
                            <comment id="13164779" author="gsingers" created="Wed, 7 Dec 2011 22:24:07 +0000"  >&lt;p&gt;I&apos;m pretty comfortable with this solution and would like to commit in the coming day or two, if others want to review it.&lt;/p&gt;</comment>
                            <comment id="13164836" author="markrmiller@gmail.com" created="Wed, 7 Dec 2011 23:33:00 +0000"  >&lt;p&gt;I have not had a chance to apply it and look thoroughly, but I read the patch and comment earlier today and it all looks good to me.&lt;/p&gt;</comment>
                            <comment id="13165175" author="gsingers" created="Thu, 8 Dec 2011 12:09:30 +0000"  >&lt;p&gt;Fixed on trunk and 3.x&lt;/p&gt;</comment>
                            <comment id="13166655" author="markrmiller@gmail.com" created="Fri, 9 Dec 2011 23:23:33 +0000"  >&lt;p&gt;Just noticed the expected exception is not ignored in ant test output.&lt;/p&gt;</comment>
                            <comment id="13167568" author="gsingers" created="Mon, 12 Dec 2011 16:04:30 +0000"  >&lt;p&gt;Do we have a better way of checking exceptions besides comparing the messages?  I can check the cause is a SolrException, but it seems the only way to check the actual proper exception is to compare the message:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (e.getCause() &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; SolrException &amp;amp;&amp;amp; e.getCause().getCause().getMessage().equals(&lt;span class=&quot;code-quote&quot;&gt;&quot;Error initializing QueryElevationComponent.&quot;&lt;/span&gt;)){
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12509592">SOLR-2580</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12506493" name="SOLR-1730.patch" size="9752" author="gsingers" created="Wed, 7 Dec 2011 18:18:04 +0000"/>
                            <attachment id="12506480" name="SOLR-1730.patch" size="15286" author="gsingers" created="Wed, 7 Dec 2011 16:43:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5720</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 50 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03p07:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19484</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>