<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:29:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-11532] Solr hits NPE when fl only contains DV fields and any of them is a spatial field</title>
                <link>https://issues.apache.org/jira/browse/SOLR-11532</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Right now, Solr does not know how to decode DV value of LatLonPointSpatialField. Therefore, Solr will hit NPE when trying to do that, for example: &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;when fl contains a spatial field and it is DV + not stored&lt;/li&gt;
	&lt;li&gt;when fl only contains DV fields and any of them is a spatial field ( stored + DV ). Because &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8344&quot; title=&quot;Decide default when requested fields are both column and row stored.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8344&quot;&gt;&lt;del&gt;SOLR-8344&lt;/del&gt;&lt;/a&gt; will always use values from DV fields. This seems a common case.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Stacktrace (from Solr 7.1)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2017-10-23 10:28:52,528 [qtp1649011739-67] ERROR HttpSolrCall  - &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;:java.lang.NullPointerException
    at org.apache.solr.search.SolrDocumentFetcher.decorateDocValueFields(SolrDocumentFetcher.java:525)
    at org.apache.solr.response.DocsStreamer.next(DocsStreamer.java:108)
    at org.apache.solr.response.DocsStreamer.next(DocsStreamer.java:57)
    at org.apache.solr.response.BinaryResponseWriter$Resolver.writeResultsBody(BinaryResponseWriter.java:126)
    at org.apache.solr.response.BinaryResponseWriter$Resolver.writeResults(BinaryResponseWriter.java:145)
    at org.apache.solr.response.BinaryResponseWriter$Resolver.resolve(BinaryResponseWriter.java:89)
    at org.apache.solr.common.util.JavaBinCodec.writeVal(JavaBinCodec.java:239)
    at org.apache.solr.common.util.JavaBinCodec.writeNamedList(JavaBinCodec.java:223)
    at org.apache.solr.common.util.JavaBinCodec.writeKnownType(JavaBinCodec.java:330)
    at org.apache.solr.common.util.JavaBinCodec.writeVal(JavaBinCodec.java:228)
    at org.apache.solr.common.util.JavaBinCodec.marshal(JavaBinCodec.java:155)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This bug found by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kiranch&quot; class=&quot;user-hover&quot; rel=&quot;kiranch&quot;&gt;kiranch&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;The only solution for this problem is adding a stored field only in fl.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13111603">SOLR-11532</key>
            <summary>Solr hits NPE when fl only contains DV fields and any of them is a spatial field</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="caomanhdat">Cao Manh Dat</assignee>
                                    <reporter username="caomanhdat">Cao Manh Dat</reporter>
                        <labels>
                    </labels>
                <created>Tue, 24 Oct 2017 04:19:11 +0000</created>
                <updated>Sat, 8 Jun 2019 15:15:28 +0000</updated>
                            <resolved>Wed, 29 Nov 2017 01:32:26 +0000</resolved>
                                    <version>7.1</version>
                                    <fixVersion>7.2</fixVersion>
                    <fixVersion>8.0</fixVersion>
                                    <component>spatial</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16216295" author="dsmiley" created="Tue, 24 Oct 2017 04:42:59 +0000"  >&lt;p&gt;Ouch; this is a serious bug!  If we can have &lt;tt&gt;useDocValuesAsStored&lt;/tt&gt;=false influence the optimization in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8344&quot; title=&quot;Decide default when requested fields are both column and row stored.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8344&quot;&gt;&lt;del&gt;SOLR-8344&lt;/del&gt;&lt;/a&gt; then that would both fix this bug and be something that makes sense to do regardless.  LLPSF can then set useDocValuesAsStored=true as a default for itself since the docValues data is not preferable to return &amp;#8211; it&apos;s less precision (~1cm).&lt;/p&gt;

&lt;p&gt;If we can agree on the above, I think it&apos;d be a separate issue to add a feature to actually allow LLPSF to return the lat &amp;amp; lon from it&apos;s DocValues.  You didn&apos;t suggest that but I thought I&apos;d mention it.&lt;/p&gt;

&lt;p&gt;Can you post the NPE stacktrace?&lt;/p&gt;</comment>
                            <comment id="16216467" author="caomanhdat" created="Tue, 24 Oct 2017 07:48:43 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think it&apos;d be a separate issue to add a feature to actually allow LLPSF to return the lat &amp;amp; lon from it&apos;s DocValues. You didn&apos;t suggest that but I thought I&apos;d mention it.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt; Yeah sure, the aim of this ticket is change &lt;tt&gt;RetrieveFieldsOptimizer&lt;/tt&gt;, so if a spatial field is stored + DV, it will use stored instead.&lt;/p&gt;</comment>
                            <comment id="16216922" author="steve_rowe" created="Tue, 24 Oct 2017 13:43:52 +0000"  >&lt;p&gt;Here&apos;s a simple test that triggers the bug: retrieving one single-valued LLPSF field with DV+stored.&lt;/p&gt;</comment>
                            <comment id="16216958" author="steve_rowe" created="Tue, 24 Oct 2017 14:07:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think it&apos;d be a separate issue to add a feature to actually allow LLPSF to return the lat &amp;amp; lon from it&apos;s DocValues. You didn&apos;t suggest that but I thought I&apos;d mention it.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The condition would be &lt;tt&gt;useDocValuesAsStored=true&lt;/tt&gt; and &lt;tt&gt;docValues=true&lt;/tt&gt; (obvi), or if &lt;tt&gt;stored=false&lt;/tt&gt;, right?&lt;/p&gt;

&lt;p&gt;Note that this would expand/complicate the meaning of &lt;tt&gt;useDocValuesAsStored&lt;/tt&gt;, which currently only applies to &lt;tt&gt;fl&lt;/tt&gt; lists with wildcards.&lt;/p&gt;</comment>
                            <comment id="16217003" author="dsmiley" created="Tue, 24 Oct 2017 14:30:42 +0000"  >&lt;blockquote&gt;&lt;p&gt;The condition would be useDocValuesAsStored=true and docValues=true (obvi), or if stored=false, right?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes I think so.  Again, I think that&apos;s a separate issue (and not a bug &amp;#8211; a feature).  &lt;/p&gt;

&lt;p&gt;It&apos;s a fair point that my proposal to have the optimizer consider useDocValuesAsStored will expand the semantic scope of it... but I think it&apos;s a fitting of this flag.  If you disagree, then perhaps we can have the FieldType more explicitly declare that the stored value should be used in preference to the docValues value.  Although you then might be annoying to efficiently capture which such fields declare this whereas we&apos;ve already done so for useDocValuesAsStored.  Notice useDocValuesAsStored doesn&apos;t say &quot;wildcard&quot; in its name &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  I think of it as... use docValues as stored if there is ambiguity.  Ambiguity if for a wildcard, but it&apos;s also for a field that has both stored &amp;amp; docValues.&lt;/p&gt;</comment>
                            <comment id="16218076" author="caomanhdat" created="Wed, 25 Oct 2017 04:35:04 +0000"  >&lt;p&gt;Here is my patch for this ticket. Aiming to handle not decodable fields carefully. &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;tt&gt;RetrieveFieldsOptimizer&lt;/tt&gt; will only use DV for fields that are decodable.&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;SolrDocumentFetcher&lt;/tt&gt; will handle decoding DV more carefully. If there are an Exception in decode a DV, it will fall-back on using stored value instead.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt; What do your guys think?&lt;/p&gt;</comment>
                            <comment id="16218552" author="dsmiley" created="Wed, 25 Oct 2017 12:52:44 +0000"  >&lt;p&gt;Interesting &amp;#8211; I like your approach &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat&quot; class=&quot;user-hover&quot; rel=&quot;caomanhdat&quot;&gt;caomanhdat&lt;/a&gt;.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;the wording &quot;decorable&quot; is not quite right, should be &quot;decoratable&quot;.  But besides, this, &quot;allSingleDV&quot; becoming &quot;allSingleDecoratableDV&quot; seems suspiciously troubling of some code quality concerns here... I&apos;ll think about this more and suggest something more specific, and it&apos;s not going to be just about some variable name.&lt;/li&gt;
	&lt;li&gt;perhaps the multiValued check on SolrDocumentFetcher constructor line 123 belongs in the method isDecorableDV that you refactored out?&lt;/li&gt;
	&lt;li&gt;in the catch around decorating docValues falling back on the stored value, we ought to at least log at debug level?&lt;/li&gt;
	&lt;li&gt;in that same method &lt;tt&gt;decorateDocValueFields&lt;/tt&gt;, perhaps move the lines of code preceding the try-statement that fetch the schemaField &amp;amp; FieldInfo into the refactored method you extracted &lt;tt&gt;decorateDocValueField&lt;/tt&gt; to reduce the number of parameters by two?  Seeing many method parameters is a code smell.  Perhaps &lt;tt&gt;decorateDocValueField&lt;/tt&gt; should not actually set the field value but instead return a potentially null value that the caller sets (and can thus decide if null then don&apos;t replace with former value if it was non-null)&lt;/li&gt;
	&lt;li&gt;you added the comment &lt;tt&gt;// The NumberType can be null&lt;/tt&gt; but did nothing about it when I think you intended to?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16218644" author="caomanhdat" created="Wed, 25 Oct 2017 13:40:09 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;the wording &quot;decorable&quot; is not quite right, should be &quot;decoratable&quot;. But besides, this, &quot;allSingleDV&quot; becoming &quot;allSingleDecoratableDV&quot; seems suspiciously troubling of some code quality concerns here... I&apos;ll think about this more and suggest something more specific, and it&apos;s not going to be just about some variable name.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Thanks for the naming suggestion ( but I see a red line below work decoratable &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ). I think that allSingleDv is only used by RetrieveFieldsOptimizer so there is no problem in rename it. Yeah, the code looks not very nice, but could not come up with better solution&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;perhaps the multiValued check on SolrDocumentFetcher constructor line 123 belongs in the method isDecorableDV that you refactored out?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes, the method makes the boolean check easier to understand without having to look into detail.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;in the catch around decorating docValues falling back on the stored value, we ought to at least log at debug level?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yeah, sure!&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;in that same method decorateDocValueFields, perhaps move the lines of code preceding the try-statement that fetch the schemaField &amp;amp; FieldInfo into the refactored method you extracted decorateDocValueField to reduce the number of parameters by two? Seeing many method parameters is a code smell. Perhaps decorateDocValueField should not actually set the field value but instead return a potentially null value that the caller sets (and can thus decide if null then don&apos;t replace with former value if it was non-null)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Excellent suggestion&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;you added the comment // The NumberType can be null but did nothing about it when I think you intended to?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;my idea here is adding a NumberType called Unknown, but did not sure about this.&lt;/p&gt;</comment>
                            <comment id="16218693" author="caomanhdat" created="Wed, 25 Oct 2017 14:07:49 +0000"  >&lt;p&gt;Updated patch based on &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt; reviews&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Introduce NumberType.UNKNOWN, therefore we never return a null numberType ( which can easily lead to NPE )&lt;/li&gt;
	&lt;li&gt;Adding method decodeDVField ( decorateDocValueField of the previous patch ), which return an Object. If for some reason we can decode value from DV of a document, this method will return null.&lt;/li&gt;
	&lt;li&gt;Removed try-catch block in decorateDocValueFields from the previous patch.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16218715" author="dsmiley" created="Wed, 25 Oct 2017 14:19:48 +0000"  >&lt;p&gt;In the short term, I suppose just coming up with a new name for &quot;singleDVs&quot; is fine.  I don&apos;t like &quot;decorate&quot; because it&apos;s not clear looking in SolrDocumentFetcher what it is that is being decorated.  This set of field names is used exclusively by RetrieveFieldsOptimizer on a set of stored fields that can be substituted for their docValues equivalent.  So in conjunction with giving this field a new name (and renaming the param arg to optimize() accordingly, it cold be changed to be fields that are stored as well.  Perhaps &lt;tt&gt;storedOptimizableToDV&lt;/tt&gt;?&lt;/p&gt;

&lt;p&gt;BTW I see some inconsistency between DV and Dv.  It&apos;s very debatable what should be used... but I suppose the smallest change is to standardize on DV.&lt;/p&gt;

&lt;p&gt;Please add a test that we don&apos;t return a LLPSF field that is stored=false, docValues=true when fl=*.  It&apos;s a TODO to support that (in another issue).  At least here we want to ensure it won&apos;t throw an exception today.  I&apos;m not certain your patch yet addresses this scenario.&lt;/p&gt;

&lt;p&gt;I was thinking maybe your SolrDocumentFetcher.isDecorableDV() method should belong on the Solr FieldType to thus give the FieldType the ability to elect a choice?  And of course named something like canDocValueSubstituteForStoredIfHasBoth?  I was thinking of a field type that knew that despite being multiValued, it knows it&apos;s docValues is equivalent (perhaps &apos;set&apos; functionality).  But then such an advanced user would then simply not have the redundant stored field.   So perhaps nevermind then; I just want to share my thoughts.&lt;/p&gt;</comment>
                            <comment id="16219866" author="caomanhdat" created="Thu, 26 Oct 2017 02:28:04 +0000"  >&lt;blockquote&gt;&lt;p&gt;BTW I see some inconsistency between DV and Dv. It&apos;s very debatable what should be used... but I suppose the smallest change is to standardize on DV.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;All others places called them Dv instead of DV so I think we should do the renaming in other ticket.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Please add a test that we don&apos;t return a LLPSF field that is stored=false, docValues=true when fl=*. It&apos;s a TODO to support that (in another issue). At least here we want to ensure it won&apos;t throw an exception today. I&apos;m not certain your patch yet addresses this scenario.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Sure!&lt;/p&gt;</comment>
                            <comment id="16219871" author="caomanhdat" created="Thu, 26 Oct 2017 02:29:42 +0000"  >&lt;blockquote&gt;&lt;p&gt;In the short term, I suppose just coming up with a new name for &quot;singleDVs&quot; is fine. I don&apos;t like &quot;decorate&quot; because it&apos;s not clear looking in SolrDocumentFetcher what it is that is being decorated. This set of field names is used exclusively by RetrieveFieldsOptimizer on a set of stored fields that can be substituted for their docValues equivalent. So in conjunction with giving this field a new name (and renaming the param arg to optimize() accordingly, it cold be changed to be fields that are stored as well. Perhaps storedOptimizableToDV?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Can we call them &lt;tt&gt;decodable&lt;/tt&gt;? It really reflect the fact that, we do encode the field&apos;s value to DV, but can not do the reverse.&lt;/p&gt;</comment>
                            <comment id="16219874" author="caomanhdat" created="Thu, 26 Oct 2017 02:38:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;I was thinking maybe your SolrDocumentFetcher.isDecorableDV() method should belong on the Solr FieldType to thus give the FieldType the ability to elect a choice? And of course named something like canDocValueSubstituteForStoredIfHasBoth? I was thinking of a field type that knew that despite being multiValued, it knows it&apos;s docValues is equivalent (perhaps &apos;set&apos; functionality). But then such an advanced user would then simply not have the redundant stored field. So perhaps nevermind then; I just want to share my thoughts.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I do not sure this is a good idea. There are couple of concerns here&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;FieldType already has many many methods, it will be easy for someone to not implement them and not all FieldType support encode field&apos;s value to DV.&lt;/li&gt;
	&lt;li&gt;SolrDocumentFetcher is a central place to do the decoding from DV to field&apos;s value. So I kinda feel this is the right place to put this method.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16219896" author="dsmiley" created="Thu, 26 Oct 2017 03:19:09 +0000"  >&lt;p&gt;Sorry I hate the name &quot;decodable&quot; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  I&apos;ll propose some additional names for your consideration:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;canDocValueSubstituteForStoredIfHasBoth    (I mentioned this before but it&apos;s not clear if you like or not)&lt;/li&gt;
	&lt;li&gt;preferDVToStored&lt;/li&gt;
	&lt;li&gt;canSubstituteDvForStored    (I like this best)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16220088" author="caomanhdat" created="Thu, 26 Oct 2017 07:29:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt; Yeah, I like the last one best. It is perfect for method name, but for field&apos;s name, It should be &lt;tt&gt;dvsCanSubstituteStored&lt;/tt&gt;?&lt;/p&gt;</comment>
                            <comment id="16220099" author="caomanhdat" created="Thu, 26 Oct 2017 07:34:14 +0000"  >&lt;p&gt;Updated patch for this ticket. Including&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;proper names&lt;/li&gt;
	&lt;li&gt;refactoring SolrDocumentFetcher logic, so It looks nicer&lt;/li&gt;
	&lt;li&gt;removed NumberType.UNKNOWN ( compared to last patch ), because there are many places check for null numberType instead of UNKNOWN.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16220436" author="dsmiley" created="Thu, 26 Oct 2017 13:38:53 +0000"  >&lt;p&gt;Overall, looks improved Dat.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;I think the multiValued condition should move to the method &lt;tt&gt;canSubstituteDvForStored(...&lt;/tt&gt;}, in addition to checking that the field be stored.  Adding that it be stored isn&apos;t strictly necessary but reduces needless entries in the set.&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;decorateDocValueFields&lt;/tt&gt;
	&lt;ul&gt;
		&lt;li&gt;javadocs are wrong or confusing.  &quot;The list of docValues fields to be decorated&quot;.  As I understand it, we&apos;re decorating the &lt;em&gt;documents&lt;/em&gt; with the fields, but as written you suggest the fields themselves are to be decorated.  Can we not use this &quot;decorated&quot; terminology please?  We&apos;re simply fetching the value from docValues, decoding/converting it to the right object type, and putting it on the document &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/li&gt;
		&lt;li&gt;You&apos;ve logged a warning &quot;Couldn&apos;t decode docValues for field: [{}]&quot; when decodeDVField returns not-null.  But this is incorrect; it&apos;s inverted &amp;#8211; we &lt;b&gt;did&lt;/b&gt; get a value.  And even if we didn&apos;t, it&apos;s not necessarily a problem &amp;#8211; their might be no value for this field on this particular document.  So in summary, just remove the warning.&lt;/li&gt;
		&lt;li&gt;can&apos;t the remove then addField be replaced with simply setField ?&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16220447" author="caomanhdat" created="Thu, 26 Oct 2017 13:50:59 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt;, all of your comments are correct. &lt;br/&gt;
BTW: &quot;The list of docValues fields to be decorated&quot;  is what we are using today (so I did not introduce that line). Do you have any idea for this?&lt;/p&gt;</comment>
                            <comment id="16220481" author="dsmiley" created="Thu, 26 Oct 2017 14:12:01 +0000"  >&lt;p&gt;&quot;The fields with docValues to populate the document with&quot; is short &amp;amp; sweet&lt;/p&gt;</comment>
                            <comment id="16220496" author="caomanhdat" created="Thu, 26 Oct 2017 14:18:16 +0000"  >&lt;p&gt;Thanks. Here is the updated patch. I think it is ready.&lt;/p&gt;</comment>
                            <comment id="16220524" author="dsmiley" created="Thu, 26 Oct 2017 14:25:29 +0000"  >&lt;p&gt;Do you disagree with my recommendation to add a stored flag check in the method canSubstituteDvForStored()?&lt;br/&gt;
javadocs typo: &quot;DocValues fields which are not exist or not decodable will be ignored.&quot;  change &quot;are not exist&quot; to &quot;do not exist&quot;&lt;/p&gt;

&lt;p&gt;Otherwise looks good.&lt;/p&gt;</comment>
                            <comment id="16220534" author="caomanhdat" created="Thu, 26 Oct 2017 14:34:56 +0000"  >&lt;blockquote&gt;&lt;p&gt;Do you disagree with my recommendation to add a stored flag check in the method canSubstituteDvForStored()?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Did you recommend that change, I seem missed that? And why we need stored flag check here?&lt;/p&gt;</comment>
                            <comment id="16220535" author="steve_rowe" created="Thu, 26 Oct 2017 14:35:06 +0000"  >&lt;blockquote&gt;&lt;p&gt;It&apos;s a fair point that my proposal to have the optimizer consider useDocValuesAsStored will expand the semantic scope of it... but I think it&apos;s a fitting of this flag. If you disagree, then perhaps we can have the FieldType more explicitly declare that the stored value should be used in preference to the docValues value.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m okay with expanding uDVAS&apos;s semantic scope - just wanted to note it explicitly.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Notice useDocValuesAsStored doesn&apos;t say &quot;wildcard&quot; in its name  I think of it as... use docValues as stored if there is ambiguity. Ambiguity if for a wildcard, but it&apos;s also for a field that has both stored &amp;amp; docValues.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="16221570" author="caomanhdat" created="Fri, 27 Oct 2017 01:42:27 +0000"  >&lt;p&gt;Updated patch fixes the javadocs typo.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt; I think the aim of this ticket is fixing NPE problem and make SolrDocumentFetcher less error-prone. Expanding the scope of uDVAs seems like an optimization for me and can be done in another ticket.&lt;/p&gt;</comment>
                            <comment id="16221643" author="dsmiley" created="Fri, 27 Oct 2017 03:09:38 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="16221871" author="jira-bot" created="Fri, 27 Oct 2017 07:34:30 +0000"  >&lt;p&gt;Commit 7a19128109d9b40b28a09a59efa718d63f7a31e9 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat&quot; class=&quot;user-hover&quot; rel=&quot;caomanhdat&quot;&gt;caomanhdat&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7a19128&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7a19128&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11532&quot; title=&quot;Solr hits NPE when fl only contains DV fields and any of them is a spatial field&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11532&quot;&gt;&lt;del&gt;SOLR-11532&lt;/del&gt;&lt;/a&gt;: Solr hits NPE when fl only contains DV fields and any of them is a spatial field&lt;/p&gt;</comment>
                            <comment id="16221884" author="jira-bot" created="Fri, 27 Oct 2017 07:50:20 +0000"  >&lt;p&gt;Commit 8a05e6ea88eeb15a4ddfabdfc5aae66302335259 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat&quot; class=&quot;user-hover&quot; rel=&quot;caomanhdat&quot;&gt;caomanhdat&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8a05e6e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8a05e6e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11532&quot; title=&quot;Solr hits NPE when fl only contains DV fields and any of them is a spatial field&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11532&quot;&gt;&lt;del&gt;SOLR-11532&lt;/del&gt;&lt;/a&gt;: Update CHANGES.txt&lt;/p&gt;</comment>
                            <comment id="16221893" author="jira-bot" created="Fri, 27 Oct 2017 07:51:18 +0000"  >&lt;p&gt;Commit 60e2493759013325769fa94d3992f5078b14da7b in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat&quot; class=&quot;user-hover&quot; rel=&quot;caomanhdat&quot;&gt;caomanhdat&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=60e2493&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=60e2493&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11532&quot; title=&quot;Solr hits NPE when fl only contains DV fields and any of them is a spatial field&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11532&quot;&gt;&lt;del&gt;SOLR-11532&lt;/del&gt;&lt;/a&gt;: Solr hits NPE when fl only contains DV fields and any of them is a spatial field&lt;/p&gt;</comment>
                            <comment id="16221894" author="jira-bot" created="Fri, 27 Oct 2017 07:51:20 +0000"  >&lt;p&gt;Commit 615ac17a412801d7975a8bc827c5cc32702df6ec in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat&quot; class=&quot;user-hover&quot; rel=&quot;caomanhdat&quot;&gt;caomanhdat&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=615ac17&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=615ac17&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11532&quot; title=&quot;Solr hits NPE when fl only contains DV fields and any of them is a spatial field&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11532&quot;&gt;&lt;del&gt;SOLR-11532&lt;/del&gt;&lt;/a&gt;: Update CHANGES.txt&lt;/p&gt;</comment>
                            <comment id="16269826" author="erickerickson" created="Wed, 29 Nov 2017 00:42:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat&quot; class=&quot;user-hover&quot; rel=&quot;caomanhdat&quot;&gt;caomanhdat&lt;/a&gt; Should this JIRA be closed?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13098914">SOLR-11304</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12893747" name="SOLR-11532-test.patch" size="1795" author="sarowe" created="Tue, 24 Oct 2017 13:41:24 +0000"/>
                            <attachment id="12894261" name="SOLR-11532.patch" size="18524" author="caomanhdat" created="Fri, 27 Oct 2017 01:40:08 +0000"/>
                            <attachment id="12894138" name="SOLR-11532.patch" size="18500" author="caomanhdat" created="Thu, 26 Oct 2017 14:17:58 +0000"/>
                            <attachment id="12894094" name="SOLR-11532.patch" size="18576" author="caomanhdat" created="Thu, 26 Oct 2017 07:33:20 +0000"/>
                            <attachment id="12893945" name="SOLR-11532.patch" size="18436" author="caomanhdat" created="Wed, 25 Oct 2017 14:04:47 +0000"/>
                            <attachment id="12893871" name="SOLR-11532.patch" size="16843" author="caomanhdat" created="Wed, 25 Oct 2017 04:34:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 51 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3lmh3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>