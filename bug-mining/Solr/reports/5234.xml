<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:11:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-17464] Http2SolrClient.requestAsync triggers NPE when using a shared Jetty client</title>
                <link>https://issues.apache.org/jira/browse/SOLR-17464</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Http2SolrClient can be configured to either create its own Jetty HttpClient, or reuse an existing one.&lt;/p&gt;

&lt;p&gt;In this latter &quot;reuse&quot; case, the Http2SolrClient never sets the &quot;executor&quot; instance variable.  This causes a NullPointerException any time the SolrClient&apos;s &quot;requestAsync&quot; method is called, which expects &quot;executor&quot; to be set.&lt;/p&gt;

&lt;p&gt;The bug is easy to reproduce with the following JUnit code (that, as of writing, can be dropped into Http2SolrClientTest and run):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  @Test
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testReproduceExecutorNPEBug() {
    DebugServlet.clear();
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; url = getBaseUrl() + DEBUG_SERVLET_PATH;
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; queryParams = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ModifiableSolrParams();
    queryParams.add(&lt;span class=&quot;code-quote&quot;&gt;&quot;q&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;*:*&quot;&lt;/span&gt;);

    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (Http2SolrClient originalClient = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Http2SolrClient.Builder(url).withDefaultCollection(DEFAULT_CORE).build()) {

      &lt;span class=&quot;code-comment&quot;&gt;// TODO The &lt;span class=&quot;code-quote&quot;&gt;&apos;requestAsync&apos;&lt;/span&gt; call below should succeed, but produces an NPE since 
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (Http2SolrClient derivedClient = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Http2SolrClient.Builder(url).withDefaultCollection(DEFAULT_CORE).withHttpClient(originalClient).build()) {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; = derivedClient.requestAsync(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; QueryRequest(queryParams));
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; results = &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt;.join();
      }
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And the exception:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
3429 INFO  (h2sc-21-thread-2) [n: c: s: r: x: t:] o.e.j.c.ResponseNotifier Exception &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; notifying listener org.apache.solr.client.solrj.impl.Http2SolrClient$1@34bcd66e
          =&amp;gt; java.lang.NullPointerException: Cannot invoke &lt;span class=&quot;code-quote&quot;&gt;&quot;java.util.concurrent.ExecutorService.execute(java.lang.&lt;span class=&quot;code-object&quot;&gt;Runnable&lt;/span&gt;)&quot;&lt;/span&gt; because &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;$0.executor&quot;&lt;/span&gt; is &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
	at org.apache.solr.client.solrj.impl.Http2SolrClient$1.onHeaders(Http2SolrClient.java:447)
java.lang.NullPointerException: Cannot invoke &lt;span class=&quot;code-quote&quot;&gt;&quot;java.util.concurrent.ExecutorService.execute(java.lang.&lt;span class=&quot;code-object&quot;&gt;Runnable&lt;/span&gt;)&quot;&lt;/span&gt; because &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;$0.executor&quot;&lt;/span&gt; is &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
	at org.apache.solr.client.solrj.impl.Http2SolrClient$1.onHeaders(Http2SolrClient.java:447) ~[main/:?]
	at org.eclipse.jetty.client.ResponseNotifier.notifyHeaders(ResponseNotifier.java:95) [jetty-client-10.0.22.jar:10.0.22]
	at org.eclipse.jetty.client.ResponseNotifier.notifyHeaders(ResponseNotifier.java:87) [jetty-client-10.0.22.jar:10.0.22]
	at org.eclipse.jetty.client.HttpReceiver.responseHeaders(HttpReceiver.java:327) [jetty-client-10.0.22.jar:10.0.22]
	at org.eclipse.jetty.http2.client.http.HttpReceiverOverHTTP2.onHeaders(HttpReceiverOverHTTP2.java:120) [http2-http-client-transport-10.0.22.jar:10.0.22]
	at org.eclipse.jetty.http2.client.http.HttpChannelOverHTTP2$Listener.onHeaders(HttpChannelOverHTTP2.java:186) [http2-http-client-transport-10.0.22.jar:10.0.22]
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13593538">SOLR-17464</key>
            <summary>Http2SolrClient.requestAsync triggers NPE when using a shared Jetty client</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdyer">James Dyer</assignee>
                                    <reporter username="gerlowskija">Jason Gerlowski</reporter>
                        <labels>
                            <label>newdev</label>
                    </labels>
                <created>Fri, 27 Sep 2024 17:24:09 +0000</created>
                <updated>Fri, 17 Oct 2025 20:05:33 +0000</updated>
                            <resolved>Wed, 30 Oct 2024 10:29:47 +0000</resolved>
                                    <version>9.7</version>
                    <version>10.0</version>
                                    <fixVersion>9.8</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17885434" author="gerlowskija" created="Fri, 27 Sep 2024 17:29:13 +0000"  >&lt;p&gt;One potential fix would be for the &quot;reuse&quot; codepath to populate Http2SolrClient&apos;s &quot;executor&quot; field with the value of &quot;httpClient.getExecutor()&quot; &lt;a href=&quot;https://github.com/apache/solr/blob/ee5c9bedf06999c4287414ac2a9ff81c068f7caf/solr/solrj/src/java/org/apache/solr/client/solrj/impl/Http2SolrClient.java#L129-L131&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.  There&apos;s a slight hiccup to this, in that &quot;httpClient.getExecutor()&quot; returns an &quot;Executor&quot;, but Http2SolrClient currently requires an &quot;ExecutorService&quot;.  But perhaps casting would be safe here, since all reused Jetty client&apos;s come from an existing Http2SolrClient?&lt;/p&gt;</comment>
                            <comment id="17885437" author="gerlowskija" created="Fri, 27 Sep 2024 17:33:22 +0000"  >&lt;p&gt;FYI &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jdyer&quot; class=&quot;user-hover&quot; rel=&quot;jdyer&quot;&gt;jdyer&lt;/a&gt; - I think you helped with these async APIs.  Any chance this rings any bells from back then?&lt;/p&gt;</comment>
                            <comment id="17885924" author="jdyer" created="Mon, 30 Sep 2024 14:29:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gerlowskija&quot; class=&quot;user-hover&quot; rel=&quot;gerlowskija&quot;&gt;gerlowskija&lt;/a&gt; I was in this code somewhat recently and thought I could jumpstart my Monday with a cast-free PR.  See &lt;a href=&quot;https://github.com/apache/solr/pull/2733&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; and let me know if you feel this fix is adequate.&lt;/p&gt;</comment>
                            <comment id="17886678" author="jira-bot" created="Thu, 3 Oct 2024 13:21:21 +0000"  >&lt;p&gt;Commit e5d26619509626f7bad13d4ae86e7f9b9344fba1 in solr&apos;s branch refs/heads/main from James Dyer&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=e5d26619509&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=e5d26619509&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17464&quot; title=&quot;Http2SolrClient.requestAsync triggers NPE when using a shared Jetty client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17464&quot;&gt;&lt;del&gt;SOLR-17464&lt;/del&gt;&lt;/a&gt; (#2733)&lt;/p&gt;
</comment>
                            <comment id="17886682" author="gerlowskija" created="Thu, 3 Oct 2024 13:36:53 +0000"  >&lt;blockquote&gt;&lt;p&gt;I was in this code somewhat recently and thought I could jumpstart my Monday with a cast-free PR.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hey, no better way to start the week, that&apos;s awesome.  Thanks for fixing!&lt;/p&gt;</comment>
                            <comment id="17886713" author="jira-bot" created="Thu, 3 Oct 2024 16:12:13 +0000"  >&lt;p&gt;Commit 3d76ccdf65c0a1231b40c937f72ba174ae3a0dff in solr&apos;s branch refs/heads/branch_9x from James Dyer&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=3d76ccdf65c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=3d76ccdf65c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17464&quot; title=&quot;Http2SolrClient.requestAsync triggers NPE when using a shared Jetty client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17464&quot;&gt;&lt;del&gt;SOLR-17464&lt;/del&gt;&lt;/a&gt;: Fixed Http2SolrClient bug in that &apos;requestAsync&apos; triggered NPE when using a shared Jetty client (#2733)&lt;/p&gt;</comment>
                            <comment id="17893962" author="gerlowskija" created="Tue, 29 Oct 2024 19:02:47 +0000"  >&lt;p&gt;I&apos;m going to reopen this and backport to branch_9_7, since it appears we have need for a 9.7.1 soon. &lt;/p&gt;</comment>
                            <comment id="17894129" author="jira-bot" created="Wed, 30 Oct 2024 10:11:23 +0000"  >&lt;p&gt;Commit f19981143abe05682a9a20b6c3c87b5923fba8d8 in solr&apos;s branch refs/heads/branch_9_7 from James Dyer&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=f19981143ab&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=f19981143ab&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17464&quot; title=&quot;Http2SolrClient.requestAsync triggers NPE when using a shared Jetty client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17464&quot;&gt;&lt;del&gt;SOLR-17464&lt;/del&gt;&lt;/a&gt;: Fixed Http2SolrClient bug in that &apos;requestAsync&apos; triggered NPE when using a shared Jetty client (#2733)&lt;/p&gt;</comment>
                            <comment id="17921956" author="anshumg" created="Tue, 28 Jan 2025 22:17:55 +0000"  >&lt;p&gt;Closing after the 9.8.0 release&lt;/p&gt;</comment>
                            <comment id="17945730" author="jira-bot" created="Fri, 18 Apr 2025 18:14:50 +0000"  >&lt;p&gt;Commit 5afd8dac0c4d5f4d19fb2f789b9ca85f7ae278e6 in solr&apos;s branch refs/heads/add-pki-caching from James Dyer&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=5afd8dac0c4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=5afd8dac0c4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17464&quot; title=&quot;Http2SolrClient.requestAsync triggers NPE when using a shared Jetty client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17464&quot;&gt;&lt;del&gt;SOLR-17464&lt;/del&gt;&lt;/a&gt;: Fixed Http2SolrClient bug in that &apos;requestAsync&apos; triggered NPE when using a shared Jetty client (#2733)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            29 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1rnww:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>