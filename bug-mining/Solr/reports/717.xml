<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:23:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-2739] TestSqlEntityProcessorDelta.testNonWritablePersistFile failures on some systems</title>
                <link>https://issues.apache.org/jira/browse/SOLR-2739</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Shawn Heisey noted on the mailing list that he was getting consistent failures from TestSqlEntityProcessorDelta.testNonWritablePersistFile on his machine.&lt;/p&gt;

&lt;p&gt;I can&apos;t reproduce his exact failures, but the test is hinky enough that i want to try and clean it up.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12521121">SOLR-2739</key>
            <summary>TestSqlEntityProcessorDelta.testNonWritablePersistFile failures on some systems</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="elyograg">Shawn Heisey</reporter>
                        <labels>
                    </labels>
                <created>Thu, 1 Sep 2011 21:56:18 +0000</created>
                <updated>Sun, 27 Nov 2011 12:36:05 +0000</updated>
                            <resolved>Mon, 26 Sep 2011 21:07:05 +0000</resolved>
                                    <version>3.3</version>
                                    <fixVersion>3.5</fixVersion>
                    <fixVersion>4.0-ALPHA</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13095635" author="hossman" created="Thu, 1 Sep 2011 22:02:05 +0000"  >&lt;p&gt;Failure Shawn reported seeing consistently with all seeds...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    [junit] 08/08/2011 10:05:13 &#1605; org.apache.solr.SolrTestCaseJ4 assertQ
    [junit] SEVERE: REQUEST FAILED: xpath=//*[@numFound=&apos;0&apos;]
    [junit]     xml response was: &amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;
    [junit] &amp;lt;response&amp;gt;
    [junit] &amp;lt;lst name=&quot;responseHeader&quot;&amp;gt;&amp;lt;int name=&quot;status&quot;&amp;gt;0&amp;lt;/int&amp;gt;&amp;lt;int name=&quot;QTime&quot;&amp;gt;1&amp;lt;/int&amp;gt;&amp;lt;lst name=&quot;params&quot;&amp;gt;&amp;lt;str name=&quot;start&quot;&amp;gt;0&amp;lt;/str&amp;gt;&amp;lt;str name=&quot;q&quot;&amp;gt;id:1&amp;lt;/str&amp;gt;&amp;lt;str name=&quot;qt&quot;&amp;gt;standard&amp;lt;/str&amp;gt;&amp;lt;str name=&quot;rows&quot;&amp;gt;20&amp;lt;/str&amp;gt;&amp;lt;str name=&quot;version&quot;&amp;gt;2.2&amp;lt;/str&amp;gt;&amp;lt;/lst&amp;gt;&amp;lt;/lst&amp;gt;&amp;lt;result name=&quot;response&quot; numFound=&quot;1&quot; start=&quot;0&quot;&amp;gt;&amp;lt;doc&amp;gt;&amp;lt;arr name=&quot;desc&quot;&amp;gt;&amp;lt;str&amp;gt;hello&amp;lt;/str&amp;gt;&amp;lt;/arr&amp;gt;&amp;lt;str name=&quot;id&quot;&amp;gt;1&amp;lt;/str&amp;gt;&amp;lt;date name=&quot;timestamp&quot;&amp;gt;2011-08-08T19:05:13.353Z&amp;lt;/date&amp;gt;&amp;lt;/doc&amp;gt;&amp;lt;/result&amp;gt;
    [junit] &amp;lt;/response&amp;gt;
    [junit]
    [junit]     request was:start=0&amp;amp;q=id:1&amp;amp;qt=standard&amp;amp;rows=20&amp;amp;version=2.2
    [junit] 08/08/2011 10:05:13 &#1605; org.apache.solr.common.SolrException log
    [junit] SEVERE: REQUEST FAILED: start=0&amp;amp;q=id:1&amp;amp;qt=standard&amp;amp;rows=20&amp;amp;version=2.2:java.lang.RuntimeException: REQUEST FAILED: xpath=//*[@numFound=&apos;0&apos;]
    [junit]     xml response was: &amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;
    [junit] &amp;lt;response&amp;gt;
    [junit] &amp;lt;lst name=&quot;responseHeader&quot;&amp;gt;&amp;lt;int name=&quot;status&quot;&amp;gt;0&amp;lt;/int&amp;gt;&amp;lt;int name=&quot;QTime&quot;&amp;gt;1&amp;lt;/int&amp;gt;&amp;lt;lst name=&quot;params&quot;&amp;gt;&amp;lt;str name=&quot;start&quot;&amp;gt;0&amp;lt;/str&amp;gt;&amp;lt;str name=&quot;q&quot;&amp;gt;id:1&amp;lt;/str&amp;gt;&amp;lt;str name=&quot;qt&quot;&amp;gt;standard&amp;lt;/str&amp;gt;&amp;lt;str name=&quot;rows&quot;&amp;gt;20&amp;lt;/str&amp;gt;&amp;lt;str name=&quot;version&quot;&amp;gt;2.2&amp;lt;/str&amp;gt;&amp;lt;/lst&amp;gt;&amp;lt;/lst&amp;gt;&amp;lt;result name=&quot;response&quot; numFound=&quot;1&quot; start=&quot;0&quot;&amp;gt;&amp;lt;doc&amp;gt;&amp;lt;arr name=&quot;desc&quot;&amp;gt;&amp;lt;str&amp;gt;hello&amp;lt;/str&amp;gt;&amp;lt;/arr&amp;gt;&amp;lt;str name=&quot;id&quot;&amp;gt;1&amp;lt;/str&amp;gt;&amp;lt;date name=&quot;timestamp&quot;&amp;gt;2011-08-08T19:05:13.353Z&amp;lt;/date&amp;gt;&amp;lt;/doc&amp;gt;&amp;lt;/result&amp;gt;
    [junit] &amp;lt;/response&amp;gt;
    [junit]
    [junit]     request was:start=0&amp;amp;q=id:1&amp;amp;qt=standard&amp;amp;rows=20&amp;amp;version=2.2
    [junit]     at org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:377)
    [junit]     at org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:351)
    [junit]     at org.apache.solr.handler.dataimport.TestSqlEntityProcessorDelta.testNonWritablePersistFile(TestSqlEntityProcessorDelta.java:121)
    [junit]     at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    [junit]     at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
    [junit]     at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
    [junit]     at java.lang.reflect.Method.invoke(Method.java:597)
    [junit]     at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)
    [junit]     at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)
    [junit]     at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)
    [junit]     at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)
    [junit]     at org.junit.rules.TestWatchman$1.evaluate(TestWatchman.java:48)
    [junit]     at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)
    [junit]     at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:31)
    [junit]     at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:76)
    [junit]     at org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:1339)
    [junit]     at org.apache.lucene.util.LuceneTestCase$LuceneTestCaseRunner.runChild(LuceneTestCase.java:1241)
    [junit]     at org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)
    [junit]     at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)
    [junit]     at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)
    [junit]     at org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)
    [junit]     at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)
    [junit]     at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)
    [junit]     at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:31)
    [junit]     at org.junit.runners.ParentRunner.run(ParentRunner.java:236)
    [junit]     at junit.framework.JUnit4TestAdapter.run(JUnit4TestAdapter.java:39)
    [junit]     at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.run(JUnitTestRunner.java:420)
    [junit]     at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.launch(JUnitTestRunner.java:911)
    [junit]     at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.main(JUnitTestRunner.java:743)
    [junit]
    [junit] NOTE: reproduce with: ant test -Dtestcase=TestSqlEntityProcessorDelta -Dtestmethod=testNonWritablePersistFile -Dtests.seed=-792d6c110a4b6e96:1c3eeb109a03bb0b:-1ac8e3d1d169d356
    [junit] NOTE: test params are: locale=ar_SA, timezone=Asia/Amman
    [junit] NOTE: all tests run in this JVM:
    [junit] [TestCachedSqlEntityProcessor, TestClobTransformer, TestContentStreamDataSource, TestDataConfig, TestDateFormatTransformer, TestDocBuilder, TestDocBuilder2, TestDocBuilderThreaded, TestEntityProcessorBase, TestErrorHandling, TestEvaluatorBag, TestFieldReader, TestFileListEntityProcessor, TestJdbcDataSource, TestLineEntityProcessor, TestNumberFormatTransformer, TestPlainTextEntityProcessor, TestRegexTransformer, TestScriptTransformer, TestSqlEntityProcessor, TestSqlEntityProcessor2, TestSqlEntityProcessorDelta]
    [junit] NOTE: Linux 2.6.18-238.12.1.el5.centos.plusxen amd64/Sun Microsystems Inc. 1.6.0_26 (64-bit)/cpus=3,threads=4,free=109853160,total=195952640
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;i can&apos;t reproduce, this exact error and i don&apos;t fully understand the test, but it seems to be attempting to verify that if the dataimport.properties file can&apos;t be written to, then after it &quot;does some stuff&quot;, there are still no docs in the index.&lt;/p&gt;

&lt;p&gt;the problem is that it conditionally tries to &quot;do stuff&quot; if the JVM says that it was able to mark the dataimport.properties as read only w/o any indication of this in the test output.  on top of that: the file it creates &amp;amp; attempts to mark read only is only cleaned up if all of this succeeds - and from my own testing that can cause problems in other tests in this class.&lt;/p&gt;

&lt;p&gt;I&apos;m going to change this silent conditional to an assumption, and move the file deletion logic into a higher up finally block, and see if that change the behavior on shawns box (if he starts seeing a message about the assumption failed, we&apos;ll have made progress)&lt;/p&gt;</comment>
                            <comment id="13095642" author="hossman" created="Thu, 1 Sep 2011 22:14:00 +0000"  >&lt;p&gt;Committed revision 1164287 - trunk&lt;br/&gt;
Committed revision 1164289 - 3x&lt;/p&gt;

&lt;p&gt;This should make the test sane enough that it either works, or correctly skips because of the assumption, on all platforms.&lt;/p&gt;

&lt;p&gt;leaving open to see if Shawn chimes in with any followup comments&lt;/p&gt;</comment>
                            <comment id="13095718" author="elyograg" created="Fri, 2 Sep 2011 01:55:03 +0000"  >&lt;p&gt;I continue to get a failure.  It looks like it&apos;s checking to make sure numFound is 0, but it&apos;s seeing 1, which is what it did before.  The exception does look different, and now it&apos;s caused by another exception.  Failure text from the new branch_3x:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    [junit] ------------- Standard Error -----------------
    [junit] NOTE: reproduce with: ant test -Dtestcase=TestSqlEntityProcessorDelta -Dtestmethod=testNonWritablePersistFile -Dtests.seed=-5706afed1ddb3d06:65ec54c2cd2efa63:3ba1f077e387d65
    [junit] NOTE: test params are: locale=en_IE, timezone=Europe/Berlin
    [junit] NOTE: all tests run in this JVM:
    [junit] [TestCachedSqlEntityProcessor, TestClobTransformer, TestContentStreamDataSource, TestDataConfig, TestDateFormatTransformer, TestDocBuilder, TestDocBuilder2, TestDocBuilderThreaded, TestEntityProcessorBase, TestErrorHandling, TestEvaluatorBag, TestFieldReader, TestFileListEntityProcessor, TestJdbcDataSource, TestLineEntityProcessor, TestNumberFormatTransformer, TestPlainTextEntityProcessor, TestRegexTransformer, TestScriptTransformer, TestSqlEntityProcessor, TestSqlEntityProcessor2, TestSqlEntityProcessorDelta]
    [junit] NOTE: Linux 2.6.18-238.12.1.el5.centos.plusxen amd64/Sun Microsystems Inc. 1.6.0_26 (64-bit)/cpus=3,threads=4,free=193825632,total=247136256
    [junit] ------------- ---------------- ---------------
    [junit] Testcase: testNonWritablePersistFile(org.apache.solr.handler.dataimport.TestSqlEntityProcessorDelta):       Caused an ERROR
    [junit] Exception during query
    [junit] java.lang.RuntimeException: Exception during query
    [junit]     at org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:385)
    [junit]     at org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:352)
    [junit]     at org.apache.solr.handler.dataimport.TestSqlEntityProcessorDelta.testNonWritablePersistFile(TestSqlEntityProcessorDelta.java:124)
    [junit]     at org.apache.lucene.util.LuceneTestCaseRunner.runChild(LuceneTestCaseRunner.java:147)
    [junit]     at org.apache.lucene.util.LuceneTestCaseRunner.runChild(LuceneTestCaseRunner.java:50)
    [junit] Caused by: java.lang.RuntimeException: REQUEST FAILED: xpath=//*[@numFound=&apos;0&apos;]
    [junit]     xml response was: &amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;
    [junit] &amp;lt;response&amp;gt;
    [junit] &amp;lt;lst name=&quot;responseHeader&quot;&amp;gt;&amp;lt;int name=&quot;status&quot;&amp;gt;0&amp;lt;/int&amp;gt;&amp;lt;int name=&quot;QTime&quot;&amp;gt;0&amp;lt;/int&amp;gt;&amp;lt;lst name=&quot;params&quot;&amp;gt;&amp;lt;str name=&quot;start&quot;&amp;gt;0&amp;lt;/str&amp;gt;&amp;lt;str name=&quot;q&quot;&amp;gt;id:1&amp;lt;/str&amp;gt;&amp;lt;str name=&quot;qt&quot;&amp;gt;standard&amp;lt;/str&amp;gt;&amp;lt;str name=&quot;rows&quot;&amp;gt;20&amp;lt;/str&amp;gt;&amp;lt;str name=&quot;version&quot;&amp;gt;2.2&amp;lt;/str&amp;gt;&amp;lt;/lst&amp;gt;&amp;lt;/lst&amp;gt;&amp;lt;result name=&quot;response&quot; numFound=&quot;1&quot; start=&quot;0&quot;&amp;gt;&amp;lt;doc&amp;gt;&amp;lt;arr name=&quot;desc&quot;&amp;gt;&amp;lt;str&amp;gt;hello&amp;lt;/str&amp;gt;&amp;lt;/arr&amp;gt;&amp;lt;str name=&quot;id&quot;&amp;gt;1&amp;lt;/str&amp;gt;&amp;lt;date name=&quot;timestamp&quot;&amp;gt;2011-09-02T01:45:21.014Z&amp;lt;/date&amp;gt;&amp;lt;/doc&amp;gt;&amp;lt;/result&amp;gt;
    [junit] &amp;lt;/response&amp;gt;
    [junit]
    [junit]     request was:start=0&amp;amp;q=id:1&amp;amp;qt=standard&amp;amp;rows=20&amp;amp;version=2.2
    [junit]     at org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:378)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13104824" author="elyograg" created="Wed, 14 Sep 2011 19:46:10 +0000"  >&lt;p&gt;This is still a problem.  As it seems to be specific to my environment, I am very interested in tracking it down, but I have no idea where to begin.  My current test setup is CentOS 6, ext4, Oracle Java 1.6.0_27-b07.  Can you give me pointers on how to figure out what the problem is?  Do you need me to provide any more information than I have already?&lt;/p&gt;

&lt;p&gt;Steps to reproduce current failures on my system from the commandline with 3.4 or branch_3x:&lt;/p&gt;

&lt;p&gt;svn co &lt;a href=&quot;https://svn.apache.org/repos/asf/lucene/dev/branches/lucene_solr_3_4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/repos/asf/lucene/dev/branches/lucene_solr_3_4&lt;/a&gt; lucene_solr_3_4&lt;br/&gt;
cd lucene_solr_3_4/solr&lt;br/&gt;
ant test&lt;/p&gt;

&lt;p&gt;svn co &lt;a href=&quot;https://svn.apache.org/repos/asf/lucene/dev/branches/branch_3x&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/repos/asf/lucene/dev/branches/branch_3x&lt;/a&gt; branch_3x&lt;br/&gt;
cd branch_3x/solr&lt;br/&gt;
ant test&lt;/p&gt;

&lt;p&gt;Some additional info:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;root@bigindy5 src&amp;#93;&lt;/span&gt;# rpm -qa | egrep &quot;ant|junit|java&quot;&lt;br/&gt;
java-1.6.0-openjdk-1.6.0.0-1.36.b17.el6_0.x86_64&lt;br/&gt;
java-1.6.0-sun-1.6.0.27-1.0.cf.x86_64&lt;br/&gt;
ant-nodeps-1.7.1-13.el6.x86_64&lt;br/&gt;
wpa_supplicant-0.6.8-10.el6.x86_64&lt;br/&gt;
libvirt-java-devel-0.4.5-2.el6.noarch&lt;br/&gt;
java-1.6.0-sun-devel-1.6.0.27-1.0.cf.x86_64&lt;br/&gt;
enchant-1.5.0-4.el6.x86_64&lt;br/&gt;
tzdata-java-2011g-1.el6.noarch&lt;br/&gt;
java_cup-0.10k-5.el6.x86_64&lt;br/&gt;
junit-3.8.2-6.5.el6.x86_64&lt;br/&gt;
java-1.6.0-sun-plugin-1.6.0.27-1.0.cf.x86_64&lt;br/&gt;
anthy-9100h-10.1.el6.x86_64&lt;br/&gt;
libvirt-java-0.4.5-2.el6.noarch&lt;br/&gt;
java-1.5.0-gcj-1.5.0.0-29.1.el6.x86_64&lt;br/&gt;
ant-1.7.1-13.el6.x86_64&lt;br/&gt;
ant-junit-1.7.1-13.el6.x86_64&lt;br/&gt;
ibus-anthy-1.2.1-1.el6.x86_64&lt;br/&gt;
java-1.6.0-sun-jdbc-1.6.0.27-1.0.cf.x86_64&lt;br/&gt;
junit4-4.5-5.3.el6.noarch&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;root@bigindy5 src&amp;#93;&lt;/span&gt;# java -version&lt;br/&gt;
java version &quot;1.6.0_27&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.6.0_27-b07)&lt;br/&gt;
Java HotSpot(TM) 64-Bit Server VM (build 20.2-b06, mixed mode)&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;root@bigindy5 src&amp;#93;&lt;/span&gt;# uname -a&lt;br/&gt;
Linux bigindy5 2.6.32-71.29.1.el6.centos.plus.x86_64 #1 SMP Sun Jun 26 16:27:27 BST 2011 x86_64 x86_64 x86_64 GNU/Linux&lt;/p&gt;</comment>
                            <comment id="13104841" author="elyograg" created="Wed, 14 Sep 2011 20:01:25 +0000"  >&lt;p&gt;I&apos;ve also been seeing intermittent failures in TestCSVLoader, in both 3.4 and 3x.  The nature of the failure is the same as on TestSqlEntityProcessorDelta, numFound shows a different value than what the test expects.  If I run the following command over and over, sometimes it will fail, but mostly it will pass:&lt;/p&gt;

&lt;p&gt;ant test -Dtestcase=TestCSVLoader -Dtestmethod=testCommitWithin&lt;/p&gt;

&lt;p&gt;Here&apos;s one failure on lucene_solr_3_4:&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Testsuite: org.apache.solr.handler.TestCSVLoader&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Testcase: testCommitWithin(org.apache.solr.handler.TestCSVLoader):  Caused an ERROR&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Exception during query&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; java.lang.RuntimeException: Exception during query&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:385)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:352)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.apache.solr.handler.TestCSVLoader.testCommitWithin(TestCSVLoader.java:121)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.apache.lucene.util.LuceneTestCaseRunner.runChild(LuceneTestCaseRunner.java:147)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.apache.lucene.util.LuceneTestCaseRunner.runChild(LuceneTestCaseRunner.java:50)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Caused by: java.lang.RuntimeException: REQUEST FAILED: xpath=//*&lt;span class=&quot;error&quot;&gt;&amp;#91;@numFound=&amp;#39;3&amp;#39;&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     xml response was: &amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; &amp;lt;response&amp;gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; &amp;lt;responseHeader&amp;gt;&amp;lt;status&amp;gt;0&amp;lt;/status&amp;gt;&amp;lt;QTime&amp;gt;0&amp;lt;/QTime&amp;gt;&amp;lt;/responseHeader&amp;gt;&amp;lt;result name=&quot;response&quot; numFound=&quot;0&quot; start=&quot;0&quot;/&amp;gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; &amp;lt;/response&amp;gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     request was:start=0&amp;amp;q=id:&lt;span class=&quot;error&quot;&gt;&amp;#91;100+TO+110&amp;#93;&lt;/span&gt;&amp;amp;qt=standard&amp;amp;rows=20&amp;amp;version=2.0&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:378)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Tests run: 5, Failures: 0, Errors: 1, Time elapsed: 29.793 sec&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; ------------- Standard Error -----------------&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 2011-09-15 12:46:04.PD org.apache.solr.SolrTestCaseJ4 assertQ&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; SEVERE: REQUEST FAILED: xpath=//*&lt;span class=&quot;error&quot;&gt;&amp;#91;@numFound=&amp;#39;3&amp;#39;&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     xml response was: &amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; &amp;lt;response&amp;gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; &amp;lt;responseHeader&amp;gt;&amp;lt;status&amp;gt;0&amp;lt;/status&amp;gt;&amp;lt;QTime&amp;gt;0&amp;lt;/QTime&amp;gt;&amp;lt;/responseHeader&amp;gt;&amp;lt;result name=&quot;response&quot; numFound=&quot;0&quot; start=&quot;0&quot;/&amp;gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; &amp;lt;/response&amp;gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     request was:start=0&amp;amp;q=id:&lt;span class=&quot;error&quot;&gt;&amp;#91;100+TO+110&amp;#93;&lt;/span&gt;&amp;amp;qt=standard&amp;amp;rows=20&amp;amp;version=2.0&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 2011-09-15 12:46:04.PD org.apache.solr.common.SolrException log&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; SEVERE: REQUEST FAILED: start=0&amp;amp;q=id:&lt;span class=&quot;error&quot;&gt;&amp;#91;100+TO+110&amp;#93;&lt;/span&gt;&amp;amp;qt=standard&amp;amp;rows=20&amp;amp;version=2.0:java.lang.RuntimeException: REQUEST FAILED: xpath=//*&lt;span class=&quot;error&quot;&gt;&amp;#91;@numFound=&amp;#39;3&amp;#39;&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     xml response was: &amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; &amp;lt;response&amp;gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; &amp;lt;responseHeader&amp;gt;&amp;lt;status&amp;gt;0&amp;lt;/status&amp;gt;&amp;lt;QTime&amp;gt;0&amp;lt;/QTime&amp;gt;&amp;lt;/responseHeader&amp;gt;&amp;lt;result name=&quot;response&quot; numFound=&quot;0&quot; start=&quot;0&quot;/&amp;gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; &amp;lt;/response&amp;gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     request was:start=0&amp;amp;q=id:&lt;span class=&quot;error&quot;&gt;&amp;#91;100+TO+110&amp;#93;&lt;/span&gt;&amp;amp;qt=standard&amp;amp;rows=20&amp;amp;version=2.0&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:378)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:352)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.apache.solr.handler.TestCSVLoader.testCommitWithin(TestCSVLoader.java:121)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.junit.rules.TestWatchman$1.evaluate(TestWatchman.java:48)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:31)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:76)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.apache.lucene.util.LuceneTestCaseRunner.runChild(LuceneTestCaseRunner.java:147)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.apache.lucene.util.LuceneTestCaseRunner.runChild(LuceneTestCaseRunner.java:50)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:31)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.junit.runners.ParentRunner.run(ParentRunner.java:236)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at junit.framework.JUnit4TestAdapter.run(JUnit4TestAdapter.java:39)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.run(JUnitTestRunner.java:420)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.launch(JUnitTestRunner.java:911)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;     at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.main(JUnitTestRunner.java:743)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; NOTE: reproduce with: ant test -Dtestcase=TestCSVLoader -Dtestmethod=testCommitWithin -Dtests.seed=-17a44f827c503e4f:5a853ada905dd3c8:-362930cca8744e9b&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; NOTE: test params are: locale=sq_AL, timezone=Asia/Tashkent&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; NOTE: all tests run in this JVM:&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;SolrInfoMBeanTest, TestSolrCoreProperties, DoubleMetaphoneFilterFactoryTest, TestArabicFilters, TestBulgarianStemFilterFactory, TestCzechStemFilterFactory, TestDictionaryCompoundWordTokenFilterFactory, TestGreekStemFilterFactory, TestHindiFilters, TestKeepFilterFactory, TestTurkishLowerCaseFilterFactory, TestJmxIntegration, TestLegacyMergeSchedulerPolicyConfig, TestPropInjectDefaults, TestCSVLoader&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; NOTE: Linux 2.6.32-71.29.1.el6.centos.plus.x86_64 amd64/Sun Microsystems Inc. 1.6.0_27 (64-bit)/cpus=4,threads=2,free=146206112,total=246153216&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; ------------- ---------------- ---------------&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; TEST org.apache.solr.handler.TestCSVLoader FAILED&lt;/p&gt;</comment>
                            <comment id="13105030" author="elyograg" created="Thu, 15 Sep 2011 00:26:44 +0000"  >&lt;p&gt;I&apos;ve now tried it on a completely unrelated Debian system (Squeeze, ext4) with the same TestSqlEntityProcessorDelta failure.  All packages on this system are from the standard Debian repositories, and include ant 1.8.1, which I remember reading isn&apos;t supported by the lucene/solr build system.  I also tried to do it on a Debian Lenny system, but it&apos;s running ant 1.7.0 and won&apos;t run Solr&apos;s build.xml at all.&lt;/p&gt;</comment>
                            <comment id="13105636" author="hossman" created="Thu, 15 Sep 2011 19:50:45 +0000"  >&lt;p&gt;Shawn: still no suggestion for you on why you&apos;re the only one getting failures with TestSqlEntityProcessorDelta, but as for this...&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;ve also been seeing intermittent failures in TestCSVLoader, in both 3.4 and 3x.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;...that is definitely unrelated, see &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2540&quot; title=&quot;CommitWithin as an Update Request parameter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2540&quot;&gt;&lt;del&gt;SOLR-2540&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;
</comment>
                            <comment id="13106252" author="rcmuir" created="Fri, 16 Sep 2011 14:50:15 +0000"  >&lt;p&gt;3.4 -&amp;gt; 3.5&lt;/p&gt;</comment>
                            <comment id="13109585" author="elyograg" created="Wed, 21 Sep 2011 15:42:00 +0000"  >&lt;p&gt;I was looking at the test and &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2551&quot; title=&quot;Check dataimport.properties for write access before starting import&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2551&quot;&gt;&lt;del&gt;SOLR-2551&lt;/del&gt;&lt;/a&gt;, the issue where it was created.  It could be that I&apos;m misreading that issue, but shouldn&apos;t it only fail to import on a &lt;b&gt;delta&lt;/b&gt;?  The code for testNonWritablePersistFile does a &lt;b&gt;full&lt;/b&gt; import before it does the numFound check.&lt;/p&gt;

&lt;p&gt;Changing runFullImport to runDeltaImport makes the test pass for me.&lt;/p&gt;

&lt;p&gt;Have I got the wrong idea here?&lt;/p&gt;</comment>
                            <comment id="13109602" author="elyograg" created="Wed, 21 Sep 2011 15:58:10 +0000"  >&lt;p&gt;If I do have the right idea, then the rest of this paragraph applies, otherwise not:  I have to wonder why the current test is passing for everyone but me.  It seems as though it should be failing for everyone.&lt;/p&gt;

&lt;p&gt;I added a couple more lines, so now it tries a delta import, checks for numFound=0, then runs a full import and checks for numFound=1.  Contrary to what I expected, the second part failed.&lt;/p&gt;</comment>
                            <comment id="13112426" author="shalinmangar" created="Thu, 22 Sep 2011 09:06:42 +0000"  >&lt;p&gt;Shawn, the test does a full-import because that operation also writes the last import time to the dataimport.properties and a delta import is supposed to start from after that time. So, if dataimport.properties is not writable, a delta import will always do a full import regardless of whether a full import had succeeded before it. This is why the test makes sure that a full-import is failed if dataimport.properties is not writable and the data-config has configured the delta import related attributes.&lt;/p&gt;</comment>
                            <comment id="13112899" author="elyograg" created="Thu, 22 Sep 2011 20:51:10 +0000"  >&lt;p&gt;Shalin,&lt;/p&gt;

&lt;p&gt;Thanks.  So the weird thing on my system is that the import is not only proceeding, it&apos;s succeeding, so there is a document in the index when it turns around and queries for id:1, so the test as-is fails for me.&lt;/p&gt;

&lt;p&gt;If I tell it to do a delta import rather than a full import, the test succeeds - no document is indexed.  If I tell it to do a delta import, check for no documents, then do a full import and check for 1 document, the second part fails - the full import did not index anything.&lt;/p&gt;

&lt;p&gt;None of my test runs show the following exception in checkWritablePersistFile.  On systems where the test passes, is it thrown?&lt;/p&gt;

&lt;p&gt;throw new DataImportHandlerException(SEVERE, persistFile.getAbsolutePath() +&lt;br/&gt;
          &quot; is not writable. Delta imports are supported by data config but will not work.&quot;);&lt;/p&gt;

&lt;p&gt;There&apos;s nothing particularly unusual about this setup.  It&apos;s 64-bit CentOS 6, ext4 over LVM on a Dell server with hardware RAID1, running Oracle Java 1.6.0_27.  Java was installed using the method on this page, with the nosrc rpm specific to version _27, not the _26 one on the page:&lt;br/&gt;
&lt;a href=&quot;http://www.city-fan.org/tips/SunJava6OnFedora&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.city-fan.org/tips/SunJava6OnFedora&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;My best guess (on the unmodified test) is that when checkWritablePersistFile (called from doFullImport) runs the isWritable() check, it is being told that the file is writable, so the full import proceeds.  I can&apos;t see any reason for the check to work correctly on delta import but not work on full import.&lt;/p&gt;

&lt;p&gt;My first thought is thread locking/timing problems in the test code, but I don&apos;t know how to look for that, and I know the build.xml for DIH tests is configured to not run tests in parallel.  Second thought if that&apos;s not the problem is that it is a bug in the OS, Java, or the OS/Java combination.  It fails on CentOS5/1.6.0_26 on NFS and ext3.  It fails on CentOS6/1.6.0_27 on NFS and ext4.  It fails on Debian6/1.6.0_26 on ext4.  Due to ongoing work that can&apos;t be interrupted to remake the platform, I can&apos;t easily try any other combinations.&lt;/p&gt;</comment>
                            <comment id="13113535" author="elyograg" created="Fri, 23 Sep 2011 16:28:13 +0000"  >&lt;p&gt;By adding print statements to the Solr and test code, I was able to determine that canWrite() is always returning true.&lt;/p&gt;

&lt;p&gt;As a further test, I wrote the following code:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;import java.io.*;

public class Main
{
        public static void main(String[] args)
        {
                File f = new File(&quot;testfile&quot;);
                File g = new File(&quot;.&quot;);
                System.out.println(&quot;writable: &quot; + f.canWrite());
                f.setReadOnly();
                System.out.println(&quot;writable: &quot; + f.canWrite());
                g.setReadOnly();
                System.out.println(&quot;writable: &quot; + f.canWrite());
        }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;What this does is check canWrite on the file, then change the file to read only, then change the current directory to read only, printing the state of canWrite() after each step.&lt;/p&gt;

&lt;p&gt;I created a directory /tmp/testfile (0x755) and created a file in that directory called testfile (0x644).  While in /tmp/testfile, I ran the above program.  When it&apos;s done both the directory and the file have no write permissions, with this output:&lt;/p&gt;

&lt;p&gt;writable: true&lt;br/&gt;
writable: true&lt;br/&gt;
writable: true&lt;/p&gt;

&lt;p&gt;Running it multiple times produces the same output.  This is looking to me like a bug in java, one that seems to have been there for quite a while.  I got the same results on our production webserver (CentOS5 with java 1.6.0_14).&lt;/p&gt;</comment>
                            <comment id="13113539" author="elyograg" created="Fri, 23 Sep 2011 16:36:50 +0000"  >&lt;p&gt;On Windows, it behaves as expected:&lt;/p&gt;

&lt;p&gt;C:\Users\sheisey\Downloads\testfile&amp;gt;java Main&lt;br/&gt;
writable: true&lt;br/&gt;
writable: false&lt;br/&gt;
writable: false&lt;/p&gt;

&lt;p&gt;C:\Users\sheisey\Downloads\testfile&amp;gt;java -version&lt;br/&gt;
java version &quot;1.6.0_27&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.6.0_27-b07)&lt;br/&gt;
Java HotSpot(TM) 64-Bit Server VM (build 20.2-b06, mixed mode)&lt;/p&gt;</comment>
                            <comment id="13113553" author="elyograg" created="Fri, 23 Sep 2011 16:53:15 +0000"  >&lt;p&gt;I wondered how this problem didn&apos;t show up for me before now, so I checked something.  The canWrite method shows up in the solr source in exactly two places:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;root@bigindy5 solr&amp;#93;&lt;/span&gt;# grep -rl canWrite . | grep &quot;java$&quot;&lt;br/&gt;
./core/src/java/org/apache/solr/handler/SnapShooter.java&lt;br/&gt;
./contrib/dataimporthandler/src/java/org/apache/solr/handler/dataimport/DataImporter.java&lt;/p&gt;


&lt;p&gt;It&apos;s slightly more prevalent on the lucene side of the house:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;root@bigindy5 lucene&amp;#93;&lt;/span&gt;# grep -rl canWrite . | grep &quot;java$&quot;&lt;br/&gt;
./contrib/spellchecker/src/java/org/apache/lucene/search/suggest/tst/TSTLookup.java&lt;br/&gt;
./contrib/spellchecker/src/java/org/apache/lucene/search/suggest/jaspell/JaspellLookup.java&lt;br/&gt;
./contrib/spellchecker/src/java/org/apache/lucene/search/suggest/fst/FSTLookup.java&lt;br/&gt;
./contrib/facet/src/java/org/apache/lucene/facet/search/TotalFacetCountsCache.java&lt;/p&gt;</comment>
                            <comment id="13113576" author="elyograg" created="Fri, 23 Sep 2011 17:22:34 +0000"  >&lt;p&gt;One of my co-workers has a Gentoo box with 2.6.38.  Unlike my CentOS and Debian machines, this bug is not there:&lt;/p&gt;

&lt;p&gt;apalmer@toro /tmp/testfile $ java -version&lt;br/&gt;
java version &quot;1.6.0_26&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.6.0_26-b03)&lt;br/&gt;
Java HotSpot(TM) 64-Bit Server VM (build 20.1-b02, mixed mode)&lt;/p&gt;

&lt;p&gt;apalmer@toro /tmp/testfile $ java Main&lt;br/&gt;
writable: true&lt;br/&gt;
writable: false&lt;br/&gt;
writable: false&lt;/p&gt;</comment>
                            <comment id="13113601" author="elyograg" created="Fri, 23 Sep 2011 17:42:20 +0000"  >&lt;p&gt;My co-worker figured out the problem.  Running it as root overrides the read-only permission.  Tried it again as a nonprivileged user and everything is fine.  Would it be difficult for &quot;ant test&quot; to see a username of root or a uid of 0?  If a test fails and they are root/0, perhaps a warning could be issued asking them to try again with a nonprivileged user.&lt;/p&gt;</comment>
                            <comment id="13113651" author="hossman" created="Fri, 23 Sep 2011 18:46:05 +0000"  >&lt;p&gt;Shawn: awesome that you finally figured out the problem &amp;#8211; never would have ocured to me you were running tests as root.&lt;/p&gt;

&lt;p&gt;i actually want to re-open this and make the test catch this.&lt;/p&gt;

&lt;p&gt;similar to how i made the test &quot;assume&quot; the setReadOnly call worked, i want the test to &quot;assume&quot; !isWritable so you don&apos;t get false failures here.&lt;/p&gt;</comment>
                            <comment id="13114930" author="hossman" created="Mon, 26 Sep 2011 21:07:05 +0000"  >&lt;p&gt;I&apos;ve committed additional &quot;assume&quot; statements to the test so that we not only verify setReadonly succeeds, but subsequent calls to canWrite fail.  this should ensure that people running as root (or on esoteric filesystems that don&apos;t support read only files) don&apos;t see false failures.&lt;/p&gt;</comment>
                            <comment id="13157848" author="thetaphi" created="Sun, 27 Nov 2011 12:36:05 +0000"  >&lt;p&gt;Bulk close after 3.5 is released&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1831</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03ivr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>18492</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>