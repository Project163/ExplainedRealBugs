<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:30:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-11898] ConcurrentModificationException when calling org.apache.solr.core.SolrInfoBean.getMetricsSnapshot</title>
                <link>https://issues.apache.org/jira/browse/SOLR-11898</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11255&quot; title=&quot;ConcurrentModificationException when using SolrInfoMBeanHandler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11255&quot;&gt;&lt;del&gt;SOLR-11255&lt;/del&gt;&lt;/a&gt;&#160;Updated to use&#160; ConcurrentHashMap.newKeySet(); for all metricNames implementation but missed a few classes.&lt;/p&gt;

&lt;p&gt;I see this exception happening once in a while:&lt;/p&gt;

&lt;p&gt;Cause0: java.util.ConcurrentModificationException Cause0-StackTrace: at java.util.HashMap$KeySpliterator.forEachRemaining(HashMap.java:1558) at java.util.stream.ReferencePipeline$Head.forEach(ReferencePipeline.java:580) at org.apache.solr.util.stats.MetricUtils.convertMetrics(MetricUtils.java:248) at org.apache.solr.util.stats.MetricUtils.convertMetrics(MetricUtils.java:226) at org.apache.solr.core.SolrInfoBean.getMetricsSnapshot(SolrInfoBean.java:62)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Three classes weren&apos;t updated from using a HashSet for metricNames: FastLRUCache, LFUCache and LRUCache&lt;/p&gt;</description>
                <environment></environment>
        <key id="13133462">SOLR-11898</key>
            <summary>ConcurrentModificationException when calling org.apache.solr.core.SolrInfoBean.getMetricsSnapshot</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="erickerickson">Erick Erickson</assignee>
                                    <reporter username="millerjeff0">Jeff Miller</reporter>
                        <labels>
                            <label>newbie</label>
                    </labels>
                <created>Wed, 24 Jan 2018 18:52:38 +0000</created>
                <updated>Sat, 8 Jun 2019 15:10:44 +0000</updated>
                            <resolved>Tue, 13 Feb 2018 03:42:35 +0000</resolved>
                                    <version>7.1</version>
                                    <fixVersion>7.3</fixVersion>
                                    <component>metrics</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                    <workratio workratioPercent="33"/>
                                    <progress percentage="33">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="33" backgroundColor="#51a825"/>
                                                    <row percentage="67" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="33">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="33" backgroundColor="#51a825"/>
                                                    <row percentage="67" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="1800">0.5h</timeoriginalestimate>
                            <timeestimate seconds="1200">20m</timeestimate>
                            <timespent seconds="600">10m</timespent>
                                <comments>
                            <comment id="16338163" author="githubbot" created="Wed, 24 Jan 2018 20:22:13 +0000"  >&lt;p&gt;GitHub user millerjeff0 opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/lucene-solr/pull/312&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/pull/312&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Solr 11898&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11898&quot; title=&quot;ConcurrentModificationException when calling org.apache.solr.core.SolrInfoBean.getMetricsSnapshot&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11898&quot;&gt;&lt;del&gt;SOLR-11898&lt;/del&gt;&lt;/a&gt; adding classes missed in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11898&quot; title=&quot;ConcurrentModificationException when calling org.apache.solr.core.SolrInfoBean.getMetricsSnapshot&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11898&quot;&gt;&lt;del&gt;SOLR-11898&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/millerjeff0/lucene-solr&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/millerjeff0/lucene-solr&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11898&quot; title=&quot;ConcurrentModificationException when calling org.apache.solr.core.SolrInfoBean.getMetricsSnapshot&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11898&quot;&gt;&lt;del&gt;SOLR-11898&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/lucene-solr/pull/312.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/pull/312.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #312&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit af2f43f3d182f46b890db467257b6480b842a16c&lt;br/&gt;
Author: Jeff &amp;lt;jeff.miller@...&amp;gt;&lt;br/&gt;
Date:   2018-01-24T18:55:24Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11898&quot; title=&quot;ConcurrentModificationException when calling org.apache.solr.core.SolrInfoBean.getMetricsSnapshot&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11898&quot;&gt;&lt;del&gt;SOLR-11898&lt;/del&gt;&lt;/a&gt; Updating classes to use ConcurrentHashMap.newKeySet&lt;/p&gt;

&lt;p&gt;commit 79ceffd56cad6e34815055f408b03e030e1505c6&lt;br/&gt;
Author: Jeff &amp;lt;jeff.miller@...&amp;gt;&lt;br/&gt;
Date:   2018-01-24T20:20:42Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11898&quot; title=&quot;ConcurrentModificationException when calling org.apache.solr.core.SolrInfoBean.getMetricsSnapshot&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11898&quot;&gt;&lt;del&gt;SOLR-11898&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16361144" author="erickerickson" created="Mon, 12 Feb 2018 17:40:42 +0000"  >&lt;p&gt;LGTM, I&apos;m testing now. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ab&quot; class=&quot;user-hover&quot; rel=&quot;ab&quot;&gt;ab&lt;/a&gt; since you&apos;ve been in the metrics code a lot, do you have any comments?&lt;/p&gt;</comment>
                            <comment id="16361520" author="ab" created="Mon, 12 Feb 2018 22:02:56 +0000"  >&lt;p&gt;+1, LGTM.&lt;/p&gt;</comment>
                            <comment id="16361778" author="erickerickson" created="Tue, 13 Feb 2018 03:34:51 +0000"  >&lt;p&gt;Added patch with CHANGES.txt&lt;/p&gt;</comment>
                            <comment id="16361780" author="jira-bot" created="Tue, 13 Feb 2018 03:35:33 +0000"  >&lt;p&gt;Commit b5bf3b9c3844a739ef5b2f6317480b37dd0fe47b in lucene-solr&apos;s branch refs/heads/master from Erick Erickson&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b5bf3b9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b5bf3b9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11898&quot; title=&quot;ConcurrentModificationException when calling org.apache.solr.core.SolrInfoBean.getMetricsSnapshot&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11898&quot;&gt;&lt;del&gt;SOLR-11898&lt;/del&gt;&lt;/a&gt;: ConcurrentModificationException when calling org.apache.solr.core.SolrInfoBean.getMetricsSnapshot&lt;/p&gt;</comment>
                            <comment id="16361785" author="jira-bot" created="Tue, 13 Feb 2018 03:41:54 +0000"  >&lt;p&gt;Commit d56751488fbccc8e1a983fc0c7815879906766e7 in lucene-solr&apos;s branch refs/heads/branch_7x from Erick Erickson&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d567514&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d567514&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11898&quot; title=&quot;ConcurrentModificationException when calling org.apache.solr.core.SolrInfoBean.getMetricsSnapshot&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11898&quot;&gt;&lt;del&gt;SOLR-11898&lt;/del&gt;&lt;/a&gt;: ConcurrentModificationException when calling org.apache.solr.core.SolrInfoBean.getMetricsSnapshot&lt;/p&gt;

&lt;p&gt;(cherry picked from commit b5bf3b9)&lt;/p&gt;</comment>
                            <comment id="16361787" author="erickerickson" created="Tue, 13 Feb 2018 03:42:35 +0000"  >&lt;p&gt;Thanks Jeff!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12910315" name="SOLR-11898.patch" size="3325" author="erickerickson" created="Tue, 13 Feb 2018 03:34:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 40 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3pbh3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>