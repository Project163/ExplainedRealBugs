<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:37:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-13369] TriLevelCompositeIdRoutingTest failure: same route prefix maped to multiple shards</title>
                <link>https://issues.apache.org/jira/browse/SOLR-13369</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;thetaphi&apos;s 8x jenkins job just identified a reproducing seed that causes TriLevelCompositeIdRoutingTest to fail after detecting 2 docs with matching route prefixes on different shards...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TriLevelCompositeIdRoutingTest -Dtests.method=test -Dtests.seed=A6B6F0104FE6018F -Dtests.multiplier=3 -Dtests.slow=true -Dtests.locale=sr-Latn -Dtests.timezone=Pacific/Tongatapu -Dtests.asserts=true -Dtests.file.encoding=US-ASCII
   [junit4] FAILURE 9.38s J0 | TriLevelCompositeIdRoutingTest.test &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: org.junit.ComparisonFailure: routePrefix app9/2!user32 found in multiple shards expected:&amp;lt;shard[3]&amp;gt; but was:&amp;lt;shard[2]&amp;gt;
   [junit4]    &amp;gt;        at __randomizedtesting.SeedInfo.seed([A6B6F0104FE6018F:2EE2CFCAE11A6C77]:0)
   [junit4]    &amp;gt;        at org.apache.solr.cloud.TriLevelCompositeIdRoutingTest.test(TriLevelCompositeIdRoutingTest.java:122)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It&apos;s possible this is just a bug I introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13210&quot; title=&quot;TriLevelCompositeIdRoutingTest makes no sense -- can never fail&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13210&quot;&gt;&lt;del&gt;SOLR-13210&lt;/del&gt;&lt;/a&gt; due to a missunderstanding in how routePrefixes that use a bit mask (ie: &lt;tt&gt;/2&lt;/tt&gt; in the assertion failure) are expected to work &amp;#8211; but I thought i had that squared away based on shalin&apos;s feedback in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13210&quot; title=&quot;TriLevelCompositeIdRoutingTest makes no sense -- can never fail&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13210&quot;&gt;&lt;del&gt;SOLR-13210&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13225991">SOLR-13369</key>
            <summary>TriLevelCompositeIdRoutingTest failure: same route prefix maped to multiple shards</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Wed, 3 Apr 2019 23:48:03 +0000</created>
                <updated>Wed, 2 Oct 2019 17:25:01 +0000</updated>
                                                                                <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16809376" author="hossman" created="Wed, 3 Apr 2019 23:52:02 +0000"  >&lt;p&gt;Attaching two log files:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;thetaphi_Lucene-Solr-8.x-Linux_342.log.txt - showing this failure as found by jenkins&lt;/li&gt;
	&lt;li&gt;TriLevelCompositeIdRoutingTest-failure-with-debug-log.txt - same seed with DEBUG logging enabled for the TriLevelCompositeIdRoutingTest logger, although it&apos;s prety easy to see from just the &lt;tt&gt;/update&lt;/tt&gt; log messages that the same prefix is being mapped to two diff shards...&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;hossman@tray:~/lucene/dev/solr/core [branch_8x] $ grep &apos;app9/2!user32&apos; TriLevelCompositeIdRoutingTest-failure-with-debug-log.txt | grep -v /select | grep -v control_collection
   [junit4]   2&amp;gt; 18598 INFO  (qtp1674344396-97) [n:127.0.0.1:41354_kgk%2Ff c:collection1 s:shard2 r:core_node5 x:collection1_shard2_replica_n1] o.a.s.u.p.LogUpdateProcessorFactory [collection1_shard2_replica_n1]  webapp=/kgk/f path=/update params={wt=javabin&amp;amp;version=2}{add=[app9/2!user32!doc58 (1629837673617162240)]} 0 0
   [junit4]   2&amp;gt; 19946 INFO  (qtp282934571-109) [n:127.0.0.1:46406_kgk%2Ff c:collection1 s:shard3 r:core_node6 x:collection1_shard3_replica_n3] o.a.s.u.p.LogUpdateProcessorFactory [collection1_shard3_replica_n3]  webapp=/kgk/f path=/update params={wt=javabin&amp;amp;version=2}{add=[app9/2!user32!doc34 (1629837675031691264)]} 0 0
   [junit4]   2&amp;gt; 21518 DEBUG (TEST-TriLevelCompositeIdRoutingTest.test-seed#[A6B6F0104FE6018F]) [    ] o.a.s.c.TriLevelCompositeIdRoutingTest shard( shard2 ) : uniqueKey( app9/2!user32!doc58 ) -&amp;gt; routePrefix( app9/2!user32 )
   [junit4]   2&amp;gt; 21780 DEBUG (TEST-TriLevelCompositeIdRoutingTest.test-seed#[A6B6F0104FE6018F]) [    ] o.a.s.c.TriLevelCompositeIdRoutingTest shard( shard3 ) : uniqueKey( app9/2!user32!doc34 ) -&amp;gt; routePrefix( app9/2!user32 )
   [junit4]    &amp;gt; Throwable #1: org.junit.ComparisonFailure: routePrefix app9/2!user32 found in multiple shards expected:&amp;lt;shard[3]&amp;gt; but was:&amp;lt;shard[2]&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt; &amp;#8211; did i missunderstand you in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13210&quot; title=&quot;TriLevelCompositeIdRoutingTest makes no sense -- can never fail&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13210&quot;&gt;&lt;del&gt;SOLR-13210&lt;/del&gt;&lt;/a&gt;? is this test flawed?  or is this indicating a real bug in tri level routing prefixes using bit masks?&lt;/p&gt;</comment>
                            <comment id="16812180" author="shalinmangar" created="Mon, 8 Apr 2019 07:28:50 +0000"  >&lt;p&gt;My understanding in the case of &lt;tt&gt;app9/2!user32!doc58&lt;/tt&gt; is that:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;2 bits are taken from the 32 bit hash of app9&lt;/li&gt;
	&lt;li&gt;8 bits are taken from the 32 bit hash of user32&lt;/li&gt;
	&lt;li&gt;22 bits are taken from the 32 bit hash of doc58&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Going back to what you wrote in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13210&quot; title=&quot;TriLevelCompositeIdRoutingTest makes no sense -- can never fail&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13210&quot;&gt;&lt;del&gt;SOLR-13210&lt;/del&gt;&lt;/a&gt;, I think you&apos;re right. When the bits is specified neither app nor app!user is guaranteed to be limited to a single shard. I don&apos;t really understand this router very well. Perhaps &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anshumg&quot; class=&quot;user-hover&quot; rel=&quot;anshumg&quot;&gt;anshumg&lt;/a&gt; can help?&lt;/p&gt;</comment>
                            <comment id="16812912" author="jira-bot" created="Tue, 9 Apr 2019 01:17:52 +0000"  >&lt;p&gt;Commit 90ae5c1956eec9e4d8548441b971659e9dbcc8c6 in lucene-solr&apos;s branch refs/heads/branch_8x from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=90ae5c1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=90ae5c1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13369&quot; title=&quot;TriLevelCompositeIdRoutingTest failure: same route prefix maped to multiple shards&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13369&quot;&gt;SOLR-13369&lt;/a&gt;: disable TriLevelCompositeIdRoutingTest until someone who actually understands how the /bits option is &lt;b&gt;suppose&lt;/b&gt; to work can assess it to determine if the test is flawed or it there is a bug in the underlying CompositeIdRouter&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 2533fd1edeb5cccfd835d9999adcd288f98722b5)&lt;/p&gt;</comment>
                            <comment id="16812913" author="jira-bot" created="Tue, 9 Apr 2019 01:18:11 +0000"  >&lt;p&gt;Commit 2533fd1edeb5cccfd835d9999adcd288f98722b5 in lucene-solr&apos;s branch refs/heads/master from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=2533fd1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=2533fd1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13369&quot; title=&quot;TriLevelCompositeIdRoutingTest failure: same route prefix maped to multiple shards&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13369&quot;&gt;SOLR-13369&lt;/a&gt;: disable TriLevelCompositeIdRoutingTest until someone who actually understands how the /bits option is &lt;b&gt;suppose&lt;/b&gt; to work can assess it to determine if the test is flawed or it there is a bug in the underlying CompositeIdRouter&lt;/p&gt;</comment>
                            <comment id="16813351" author="jira-bot" created="Tue, 9 Apr 2019 12:49:55 +0000"  >&lt;p&gt;Commit 2533fd1edeb5cccfd835d9999adcd288f98722b5 in lucene-solr&apos;s branch refs/heads/jira/&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-8738&quot; title=&quot;Bump minimum Java version requirement to 11&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-8738&quot;&gt;&lt;del&gt;LUCENE-8738&lt;/del&gt;&lt;/a&gt; from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=2533fd1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=2533fd1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13369&quot; title=&quot;TriLevelCompositeIdRoutingTest failure: same route prefix maped to multiple shards&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13369&quot;&gt;SOLR-13369&lt;/a&gt;: disable TriLevelCompositeIdRoutingTest until someone who actually understands how the /bits option is &lt;b&gt;suppose&lt;/b&gt; to work can assess it to determine if the test is flawed or it there is a bug in the underlying CompositeIdRouter&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13213149">SOLR-13210</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12964789" name="TriLevelCompositeIdRoutingTest-failure-with-debug-log.txt" size="1000059" author="hossman" created="Wed, 3 Apr 2019 23:48:40 +0000"/>
                            <attachment id="12964790" name="thetaphi_Lucene-Solr-8.x-Linux_342.log.txt" size="8081261" author="hossman" created="Wed, 3 Apr 2019 23:48:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 32 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z01fps:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>