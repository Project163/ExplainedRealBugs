<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:40:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-13811] possible autoAddReplicas bug and/or (Hdfs)AutoAddReplicasIntegrationTest refactoring / fixes</title>
                <link>https://issues.apache.org/jira/browse/SOLR-13811</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;I&apos;ve noticed a pattern of failure behavior in jenkins runs of &lt;tt&gt;AutoAddReplicasIntegrationTest&lt;/tt&gt; (which mostly manifests in the subclass &lt;tt&gt;HdfsAutoAddReplicasIntegrationTest&lt;/tt&gt;, probably due to timing) which indicates either:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;the test is too contrived, and expects &lt;tt&gt;autoAddReplicas&lt;/tt&gt; to kick in in a situation where the current impl of &lt;tt&gt;NodeLostTrigger&lt;/tt&gt; isn&apos;t smart enough to handle&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;NodeLostTrigger&lt;/tt&gt; &lt;em&gt;should&lt;/em&gt; be smart enough to handle this, but isn&apos;t.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;The test failure is currently somewhat finicky to reproduce, and depends on a node being stoped, restarted, and stopped again &#8211; while an affected collection is changed from &lt;tt&gt;autoAddReplicas=false&lt;/tt&gt; to &lt;tt&gt;autoAddReplicas=true&lt;/tt&gt; before the second &quot;stop&quot;&lt;/p&gt;

&lt;p&gt;Regardless of which of the 2 above is true: the test itself is somewhat convoluted. It creates a sequence of events (some randomized, some static) and asserting specific outcomes after each &#8211; but the timing of scheduled triggers like &lt;tt&gt;NodeLostTrigger&lt;/tt&gt; , and the interplay of things like &quot;pick a random node to shutdown&quot; with a subsequent &quot;explicitly shut down node2&quot; (even if it was the node randomly shut down earlier) is confusing.&lt;/p&gt;

&lt;p&gt;I&apos;m creating this issue to track two tightly dependent objectives:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;refactoring this test to:
	&lt;ul&gt;
		&lt;li&gt;better isolate the specific things it&apos;s trying to test in individual test methods.&lt;/li&gt;
		&lt;li&gt;have a singular test method that triggers the specific sequence of events that is currently problematic (ideally in such a way that it reliably fails).&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;AwaitsFix this new test method until someone with a better understand of the &lt;tt&gt;autoAddReplicas&lt;/tt&gt; / &lt;tt&gt;NodeLostTrigger&lt;/tt&gt; code can assess if the test is faulty or the code being tested is faulty.&lt;/li&gt;
&lt;/ol&gt;
</description>
                <environment></environment>
        <key id="13260143">SOLR-13811</key>
            <summary>possible autoAddReplicas bug and/or (Hdfs)AutoAddReplicasIntegrationTest refactoring / fixes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Oct 2019 16:45:01 +0000</created>
                <updated>Fri, 13 Aug 2021 18:43:51 +0000</updated>
                            <resolved>Fri, 13 Aug 2021 18:43:51 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="16942993" author="jira-bot" created="Wed, 2 Oct 2019 17:13:42 +0000"  >&lt;p&gt;Commit a57ec148e52507104fdf0f99381d2b485fa846fc in lucene-solr&apos;s branch refs/heads/master from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=a57ec14&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=a57ec14&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13811&quot; title=&quot;possible autoAddReplicas bug and/or (Hdfs)AutoAddReplicasIntegrationTest refactoring / fixes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13811&quot;&gt;&lt;del&gt;SOLR-13811&lt;/del&gt;&lt;/a&gt;: Refactor AutoAddReplicasIntegrationTest to isolate problematic situation into an AwaitsFix test method&lt;/p&gt;</comment>
                            <comment id="16943010" author="jira-bot" created="Wed, 2 Oct 2019 17:27:09 +0000"  >&lt;p&gt;Commit 18bf61504fbd9d8becff1a572642b4207dc7d54c in lucene-solr&apos;s branch refs/heads/branch_8x from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=18bf615&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=18bf615&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13811&quot; title=&quot;possible autoAddReplicas bug and/or (Hdfs)AutoAddReplicasIntegrationTest refactoring / fixes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13811&quot;&gt;&lt;del&gt;SOLR-13811&lt;/del&gt;&lt;/a&gt;: Refactor AutoAddReplicasIntegrationTest to isolate problematic situation into an AwaitsFix test method&lt;/p&gt;

&lt;p&gt;(cherry picked from commit a57ec148e52507104fdf0f99381d2b485fa846fc)&lt;/p&gt;</comment>
                            <comment id="16943017" author="hossman" created="Wed, 2 Oct 2019 17:31:57 +0000"  >&lt;p&gt;As noted by gitbot, I&apos;ve committed some refactoring to help clean this up and isolate the problematic test logic.&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;I&apos;m attaching two files:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;apache_Lucene-Solr-NightlyTests-8.x_221.log.txt&lt;/tt&gt; - showing and example of how the problem has manifested in jenkins builds &lt;em&gt;prior&lt;/em&gt; to the refactoring I&apos;ve just committed.&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;hoss_local_failure_after_refactoring.log.txt&lt;/tt&gt; - showing how the newly refactored &lt;tt&gt;testRapidStopStartStopWithPropChange()&lt;/tt&gt; can fail demonstrating the same problem in isolation.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Note that &lt;tt&gt;testRapidStopStartStopWithPropChange()&lt;/tt&gt; does not fail deterministically &#8211; the behavior is dependent on the timing of when exactly &lt;tt&gt;NodeLostTrigger&lt;/tt&gt; fires &lt;em&gt;after&lt;/em&gt; the node is restarted, but before it is stopped again. Perhaps there is a way to &quot;pause&quot; the triggers to increase the odds of this happening? ... not sure.&#160; (It also seems to fail much more often in the Hdfs version of the test ... i&apos;m not sure if that&apos;s because the MOVEREPLICA logic works faster/slower then in the non hdfs situation? ... i actaully haven&apos;t been able to trigger the failure w/the refactoring in place)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ab&quot; class=&quot;user-hover&quot; rel=&quot;ab&quot;&gt;ab&lt;/a&gt; : can you please take a look at this and chime in with wether you think the current code in &lt;tt&gt;testRapidStopStartStopWithPropChange()&lt;/tt&gt; is something that should pass reliably given the way the code is designed to work? ... if so please update the jira summary/description to make it clear what the underlying bug is, if not we should go ahead and: delete this test method, reclassify this issue as a &quot;Test&quot; task, and resolve as &quot;DONE&quot;.&lt;/p&gt;</comment>
                            <comment id="17398859" author="ctargett" created="Fri, 13 Aug 2021 18:43:51 +0000"  >&lt;p&gt;Both of the tests specifically discussed in this issue were removed as part of the removal of the autoscaling framework, so I think this can be resolved as Won&apos;t Fix.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12982004" name="apache_Lucene-Solr-NightlyTests-8.x_221.log.txt" size="4724998" author="hossman" created="Wed, 2 Oct 2019 17:28:28 +0000"/>
                            <attachment id="12982005" name="hoss_local_failure_after_refactoring.log.txt" size="3260428" author="hossman" created="Wed, 2 Oct 2019 17:28:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 13 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z078i0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>