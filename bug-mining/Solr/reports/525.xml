<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:19:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-2100] Fix for saving commit points during java-based backups</title>
                <link>https://issues.apache.org/jira/browse/SOLR-2100</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;This patch fixes the saving of commit points during backup operations.&lt;/p&gt;

&lt;p&gt;This fixes the perviously commited (for 1.4) &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1475&quot; title=&quot;Java-based replication doesn&amp;#39;t properly reserve its commit point during backups&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1475&quot;&gt;&lt;del&gt;SOLR-1475&lt;/del&gt;&lt;/a&gt; patch.&lt;/p&gt;

&lt;p&gt;1. In IndexDeletionPolicyWrapper.java, commit points are not saved to the &apos;savedCommits&apos; map.&lt;br/&gt;
2. Also, the testing of the presence of a commit point uses the contains() method instead of containsKey().&lt;/p&gt;

&lt;p&gt;The result of this means that backups for anything but toy indexes fail, because the commit points are deleted (after 10s) before the full backup is completed.&lt;/p&gt;

&lt;p&gt;This patch addresses these 2 issues.&lt;/p&gt;

&lt;p&gt;Tested with 1.4.1 release trunk, but should also work fine with 1.4.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12473271">SOLR-2100</key>
            <summary>Fix for saving commit points during java-based backups</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="midiman">Peter Sturge</reporter>
                        <labels>
                    </labels>
                <created>Fri, 3 Sep 2010 18:32:41 +0000</created>
                <updated>Wed, 30 Mar 2011 15:45:31 +0000</updated>
                            <resolved>Mon, 6 Sep 2010 17:49:49 +0000</resolved>
                                    <version>1.4</version>
                    <version>1.4.1</version>
                                    <fixVersion>1.4.2</fixVersion>
                    <fixVersion>3.1</fixVersion>
                    <fixVersion>4.0-ALPHA</fixVersion>
                                    <component>replication (java)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                    <workratio workratioPercent="0"/>
                                                                    <timeoriginalestimate seconds="0">0h</timeoriginalestimate>
                            <timeestimate seconds="0">0h</timeestimate>
                                        <comments>
                            <comment id="12906408" author="yseeley@gmail.com" created="Mon, 6 Sep 2010 00:50:58 +0000"  >&lt;p&gt;Thanks for the patch Peter!  Such a small patch... but I&apos;ve been trying to puzzle out all of the possible ramifications (and going back to puzzle through some of the replication code).&lt;/p&gt;

&lt;p&gt;saveCommitPoint() (which obviously did nothing before this) is called in the postCommit (and postOptimize) events.&lt;br/&gt;
This doesn&apos;t even seem necessary for replication, since SolrDeletionPolicy always saves the last commit point and the last optimized point (if configured to do so, or if replicate on optimize is configured).  Once replication has started, a reservation scheme is used rather than saving a commit point forever.&lt;/p&gt;

&lt;p&gt;Also, if one configures replication onCommit and onOptimize, then the event callback code has some bugs: both refer to indexCommitPoint, and close the previous one.  So if we did rely on saveCommitPoint, a commit after an optimize would release the optimized commit point.&lt;/p&gt;</comment>
                            <comment id="12906497" author="midiman" created="Mon, 6 Sep 2010 12:22:41 +0000"  >&lt;p&gt;I&apos;m not really familiar with the reservation code for replication, but will it still save the commit point for replication even if another commit (or many commits) come along during replication?&lt;/p&gt;

&lt;p&gt;By default, it would probably be rare, as the data to be replicated is only a delta and would likely not take too long to complete.&lt;br/&gt;
This was the problem with backups - it&apos;s a full file copy of everything, which typically takes minutes on large indexes - longer if writing to a remote volume. &lt;/p&gt;

&lt;p&gt;As the replication timing is configurable, you could have a scenario where the amount of data to be replicated is very significant, and is generally remote, so could take some time to complete. Would the reserveration mechanism still hold the commit point if 1,2, 5 or 10 commits came along during the replication process?&lt;/p&gt;

&lt;p&gt;ReplicationHandler.postCommit() calls saveCommitPoint()/releaseCommitPoint(), so as things stand this would preserve the commit point even if a separate reserveration didn&apos;t, and there&apos;s no price to pay for holding the indexVersion in this way.&lt;/p&gt;

&lt;p&gt;Not sure what the standard policy is for marking issues Resolved/Closed, so I&apos;ll leave this up to you. But do let me know if you&apos;d like me to perform any additional testing.&lt;/p&gt;</comment>
                            <comment id="12906505" author="yseeley@gmail.com" created="Mon, 6 Sep 2010 13:22:06 +0000"  >&lt;blockquote&gt;&lt;p&gt;but will it still save the commit point for replication even if another commit (or many commits) come along during replication? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes.... that&apos;s what the reservation system is for.  When someone asks us for the current  index version, we reserve that version for some amount of time and return that.  When the client is retrieving a file, they also specify what index version it is for so we can periodically renew the reservation during streaming back.&lt;/p&gt;

&lt;p&gt;If we didn&apos;t use a reservation system, a client could ask for the index version, die, and then we would save it forever.&lt;/p&gt;</comment>
                            <comment id="12906551" author="yseeley@gmail.com" created="Mon, 6 Sep 2010 17:49:49 +0000"  >&lt;p&gt;OK, I&apos;ve fixed this in 4.x, 3.x, and 1.4.x&lt;/p&gt;</comment>
                            <comment id="13013095" author="gsingers" created="Wed, 30 Mar 2011 15:45:31 +0000"  >&lt;p&gt;Bulk close for 3.1.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12453803" name="SOLR-2100.PATCH" size="788" author="midiman" created="Fri, 3 Sep 2010 18:34:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5404</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 34 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03msv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19127</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>