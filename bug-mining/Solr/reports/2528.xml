<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:06:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-7689] ReRankQuery rewrite method can change the QueryResultKey causing cache misses.</title>
                <link>https://issues.apache.org/jira/browse/SOLR-7689</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;In SolrIndexSearcher class, the key used to lookup results in queryResultCache uses the original query. &lt;/p&gt;

&lt;p&gt;However later in createNormalizedWeight the query gets re-written, and then saved in the queryResultCache after it&apos;s re-written. &lt;/p&gt;

&lt;p&gt;This causes cache misses for the same query, and un-necessary inserts in the queryResultCache.&lt;/p&gt;

&lt;p&gt;I can reproduce this using a re-ranking query that is using a main query as a dismax query, the dismax Query could be re-written into a TermQuery, which makes sense, but will cause cache misses.&lt;/p&gt;

&lt;p&gt;I tested a quick solution by just using q.clone()  when it comes to build QueryResultKey, and it works fine, but not sure if that is the best way of doing it.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12838068">SOLR-7689</key>
            <summary>ReRankQuery rewrite method can change the QueryResultKey causing cache misses.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbernste">Joel Bernstein</assignee>
                                    <reporter username="enashed">Emad Nashed</reporter>
                        <labels>
                    </labels>
                <created>Tue, 16 Jun 2015 06:53:28 +0000</created>
                <updated>Tue, 8 Oct 2019 14:50:22 +0000</updated>
                            <resolved>Fri, 18 Sep 2015 02:09:01 +0000</resolved>
                                                    <fixVersion>5.2.2</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>search</component>
                    <component>SearchComponents - other</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14587769" author="joel.bernstein" created="Tue, 16 Jun 2015 09:48:42 +0000"  >&lt;p&gt;Wondering if this is a bug in the re-ranking? I&apos;ll investigate.&lt;/p&gt;</comment>
                            <comment id="14587797" author="joel.bernstein" created="Tue, 16 Jun 2015 10:11:56 +0000"  >&lt;p&gt;It looks like the only way this could be a problem is if the Query was not immutable. Can you post the exact query that is causing the cache miss?&lt;/p&gt;</comment>
                            <comment id="14587798" author="joel.bernstein" created="Tue, 16 Jun 2015 10:15:20 +0000"  >&lt;p&gt;Quick search turns this up: &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-6570&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/LUCENE-6570&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;So cloning would seem like the safe thing to do. &lt;/p&gt;

&lt;p&gt;Would be good to get some more eyes on this.&lt;/p&gt;</comment>
                            <comment id="14587971" author="joel.bernstein" created="Tue, 16 Jun 2015 12:45:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yseeley%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;yseeley@gmail.com&quot;&gt;yseeley@gmail.com&lt;/a&gt; curious to see what you see with this ticket. &lt;/p&gt;</comment>
                            <comment id="14588101" author="yseeley@gmail.com" created="Tue, 16 Jun 2015 14:27:45 +0000"  >&lt;p&gt;This would definitely be a bug if we actually do use a rewritten query for any caches.  SolrIndexSearcher certainly didn&apos;t do that in the past, but it&apos;s possible that a bug was introduced somewhere along the way.&lt;/p&gt;

&lt;p&gt;Is this because some other code passes SolrIndexSearcher a rewritten query, or do you think there&apos;s a bug internal to SolrIndexSearcher?&lt;/p&gt;

&lt;p&gt;edit: I reviewed SolrIndexSearcher, and nothing jumps out at me as incorrect.&lt;br/&gt;
We should not clone the queries in general though (in SolrIndexSearcher) - that&apos;s a lot of overhead and the wrong fix.  If there&apos;s a bad-egg query somewhere that is not effectively immutable (i.e. using it in a search can change it) then that&apos;s what should be fixed.&lt;/p&gt;</comment>
                            <comment id="14588136" author="yseeley@gmail.com" created="Tue, 16 Jun 2015 14:44:09 +0000"  >&lt;p&gt;Took a brief look at ReRankQuery, and I do see one problem:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;          &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.boostedPriority = (Map&amp;lt;BytesRef, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;)context.get(QueryElevationComponent.BOOSTED_PRIORITY);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;boostedPriority is a field on ReRankQuery, so this query won&apos;t be immutable or thread safe.  &lt;/p&gt;</comment>
                            <comment id="14588142" author="joel.bernstein" created="Tue, 16 Jun 2015 14:50:50 +0000"  >&lt;p&gt;I&apos;ll review this.&lt;/p&gt;</comment>
                            <comment id="14588154" author="joel.bernstein" created="Tue, 16 Jun 2015 14:57:49 +0000"  >&lt;p&gt;I think the problem would be in the query itself. If they are not immutable now, under what conditions can they change? The Lucene IndexSearcher calls rewrite on the query, do any queries change internally because of a call like this?&lt;/p&gt;</comment>
                            <comment id="14588166" author="yseeley@gmail.com" created="Tue, 16 Jun 2015 15:08:41 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think the problem would be in the query itself. If they are not immutable now, under what conditions can they change?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The work in &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-6570&quot; title=&quot;Make BooleanQuery immutable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-6570&quot;&gt;&lt;del&gt;LUCENE-6570&lt;/del&gt;&lt;/a&gt; is only tangentially related.&lt;br/&gt;
All the core Lucene queries are what I guess I would call &quot;weakly immutable&quot;.  If the user (in this case Solr) does not change the query, then the query won&apos;t be changed by other read / search operations and is safe to use concurrently across different threads, etc.&lt;/p&gt;

&lt;p&gt;So stuff like &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-6570&quot; title=&quot;Make BooleanQuery immutable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-6570&quot;&gt;&lt;del&gt;LUCENE-6570&lt;/del&gt;&lt;/a&gt; is to make stuff like BooleanQuery truly immutable.  It would only matter to Solr in the event of a bug.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The Lucene IndexSearcher calls rewrite on the query, do any queries change internally because of a call like this?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No, they should not.&lt;/p&gt;</comment>
                            <comment id="14588197" author="joel.bernstein" created="Tue, 16 Jun 2015 15:20:27 +0000"  >&lt;p&gt;Not seeing a problem with the boostedPriority Map. This is map is created by the main execution thread in the QueryElevationComponent and is only used for a specific query. So each query should have a unique HashMap. Once it&apos;s created I believe it&apos;s read only. The code is pretty confusing though because of the callback to QueryElelvationComponent. This should probably be looked at.&lt;/p&gt;</comment>
                            <comment id="14588240" author="joel.bernstein" created="Tue, 16 Jun 2015 15:39:06 +0000"  >&lt;p&gt;Ok, I see the issue. It&apos;s a bug specific to the ReRankQParserPlugin. Rewritten queries will foil the query result cache. I&apos;ll work on a fix.&lt;/p&gt;</comment>
                            <comment id="14588418" author="joel.bernstein" created="Tue, 16 Jun 2015 17:32:18 +0000"  >&lt;p&gt;Patch that resolves the issue. More details to follow.&lt;/p&gt;</comment>
                            <comment id="14588459" author="yseeley@gmail.com" created="Tue, 16 Jun 2015 17:50:12 +0000"  >&lt;p&gt;Hmmm, the patch makes rewrite on ReRankQuery do nothing.&lt;br/&gt;
Are the internal queries rewritten at some point (some queries require that).&lt;/p&gt;

&lt;p&gt;The normal pattern of rewrite is to rewrite your child queries and if any of them changed, create a new parent query with those child queries.&lt;/p&gt;</comment>
                            <comment id="14588670" author="joel.bernstein" created="Tue, 16 Jun 2015 20:04:40 +0000"  >&lt;p&gt;Added a set of tests that ensures that the queryResultCache misses are resolved.&lt;/p&gt;</comment>
                            <comment id="14588811" author="joel.bernstein" created="Tue, 16 Jun 2015 21:30:25 +0000"  >&lt;p&gt;Yeah this is special case. The ReRankQuery is just a wrapper that peels off on the rewrite() method. The wrapper stays on in the SolrIndexSearcher to set the topdocs collecter and act as the cache key. In the Lucene IndexSearcher search() method where rewrite() is called, all it needs to do is return the mainQuery. The rewrite method in the Lucene IndexSearcher does a nifty little loop that ensures the main query then gets rewritten.&lt;/p&gt;</comment>
                            <comment id="14588833" author="yseeley@gmail.com" created="Tue, 16 Jun 2015 21:42:46 +0000"  >&lt;p&gt;Ah, I had missed that you were returning this.mainQuery and not just &quot;this&quot;&lt;/p&gt;</comment>
                            <comment id="14589107" author="enashed" created="Wed, 17 Jun 2015 00:48:46 +0000"  >&lt;p&gt;Thanks a lot for giving this issue your attention. The query I am trying looks basically like this (after omitting some unimportant stuff)&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;q={!dismax qf=$sqf pf=$spf v=$sq}
rq={!rerank reRankQuery=$rqq reRankDocs=1000 reRankWeight=2}
rqq=_val_:&quot;recip(ms(NOW/DAY+1DAY,DateUpdated),3.16e-11,1.4,1)&quot;
sq=&quot;test&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I tried the patch, although it fixes the caching issue, but now the Re-Ranking doesn&apos;t happen anymore. This is basically because when rewrite is called, ReRanking query will just return the inner dismax query and just hide itself from the searcher. I&apos;ll propose another patch shortly. I&apos;d propose that rewrite method on ReRankQuery would clone itself (if the mainQuery has changed) and return the new instance. Sorry for the delay, I just live on the other side of the earth, and there is a big time difference.&lt;br/&gt;
Cheers&lt;/p&gt;
</comment>
                            <comment id="14589178" author="enashed" created="Wed, 17 Jun 2015 02:03:05 +0000"  >&lt;p&gt;This patch changes the rewrite function in ReRankQuery. It will rewrite the mainQuery, and if there is a change it will create a new clone instead of modifying itself. &lt;/p&gt;</comment>
                            <comment id="14589548" author="joel.bernstein" created="Wed, 17 Jun 2015 09:40:54 +0000"  >&lt;p&gt;The test cases are showing that the rerank is occurring with this patch. &lt;/p&gt;

&lt;p&gt;The SolrIndexSearcher never calls rewrite on the query. So it sees the query as the RankQuery wrapper, and will use the ReRankCollector. The search method inside of the parent Lucene IndexSearcher calls rewrite on the RankQuery which returns the mainQuery. IndexSearcher.rewrite() will then call rewrite on the mainQuery. There is a loop in the IndexSearcher.rewrite() method that loops over the query until all the rewrites have been completed.&lt;/p&gt;

&lt;p&gt;If you can provide a failing test case for your example I&apos;ll take a look at it. &lt;/p&gt;</comment>
                            <comment id="14589591" author="enashed" created="Wed, 17 Jun 2015 10:18:08 +0000"  >&lt;p&gt;I was actually relying on the output from debugQuery to see if it is re-ranking. I didn&apos;t see any output for reranking with your patch, so it looks like I made the wrong assumption that if there is no output in debugQuery then it is not re-ranking.  &lt;/p&gt;</comment>
                            <comment id="14589620" author="joel.bernstein" created="Wed, 17 Jun 2015 10:52:39 +0000"  >&lt;p&gt;I&apos;ll take a look at that. It sounds like we lost the explain part of the re-ranking with this patch. Thanks.&lt;/p&gt;</comment>
                            <comment id="14589625" author="joel.bernstein" created="Wed, 17 Jun 2015 11:00:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enashed&quot; class=&quot;user-hover&quot; rel=&quot;enashed&quot;&gt;enashed&lt;/a&gt; you&apos;re right we lost the ReRank portion of the Explain with this patch. You&apos;re approach of cloning the ReRankQuery in the rewrite method should solve the issue. I&apos;ll put another patch up to review. &lt;/p&gt;</comment>
                            <comment id="14589777" author="joel.bernstein" created="Wed, 17 Jun 2015 13:46:51 +0000"  >&lt;p&gt;New patch using a different approach then cloning the ReRankQuery. See comments for explanation. I believe this should resolve the cache miss issue and preserve the ReRankQuery&apos;s Explain&lt;/p&gt;</comment>
                            <comment id="14589897" author="yseeley@gmail.com" created="Wed, 17 Jun 2015 15:05:00 +0000"  >&lt;p&gt;ReRankQuery looks like a normal query type to me (i.e. it can be produced by a QParser from a user request, and can be used as a cache key, etc).  This also means that a single ReRankQuery object can be used concurrently on different indexes (autowarming is one way this can happen).&lt;/p&gt;

&lt;p&gt;So caching both &quot;rewrittenQuery&quot; and &quot;boostedPriority&quot; which depend on specific requests / indexes is problematic.  As a general rule, queries shouldn&apos;t change themselves during execution.&lt;/p&gt;

&lt;p&gt;Is there a reason we can&apos;t use the normal pattern of returning a new main query in rewrite if any of the child queries were changed by a rewrite?&lt;/p&gt;</comment>
                            <comment id="14589917" author="joel.bernstein" created="Wed, 17 Jun 2015 15:23:36 +0000"  >&lt;p&gt;Ok I see the issue you&apos;re taking about with the rewrittenQuery. I believe it doesn&apos;t apply to the boostedPriority because that won&apos;t get regenerated during autowarming. I&apos;ll verify this.&lt;/p&gt;

&lt;p&gt;The normal pattern is a little different here because we need to return the re-written query wrapped in a ReRankQuery in order to preserver the re-rank Explain. Otherwise we could just return the mainQuery and let that get rewritten. I&apos;ll work on a patch that returns a clone of the ReRankedQuery wrapped around the rewritten query. The only trick to this is that the cloned ReRankQuery will also have rewrite() called on it because of the loop in IndexSearcher.rewrite(). So the cloned ReRankQuery will need to return itself from the rewrite method, rather then cloning again in an endless loop.&lt;/p&gt;</comment>
                            <comment id="14589929" author="yseeley@gmail.com" created="Wed, 17 Jun 2015 15:32:00 +0000"  >&lt;blockquote&gt;&lt;p&gt;The normal pattern is a little different here because we need to return the re-written query wrapped in a ReRankQuery in order to preserver the re-rank Explain. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;But that is the normal pattern of how rewrite() is implemented.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The only trick to this is that the cloned ReRankQuery will also have rewrite() called on it because of the loop in IndexSearcher.rewrite()&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This isn&apos;t a problem if you follow the normal pattern of returning a clone &lt;b&gt;only if&lt;/b&gt; one of your sub-queries was changed by the rewrite.  The query will change the first time through the loop and won&apos;t change the second time.&lt;/p&gt;

&lt;p&gt;Check something like BoostedQuery.rewrite() for the standard way of doing it.&lt;/p&gt;</comment>
                            <comment id="14589944" author="yseeley@gmail.com" created="Wed, 17 Jun 2015 15:44:31 +0000"  >&lt;p&gt;As for ReRankQuery.boostedPriority, which is retrieved from the request context, it seems like it can be safely removed?&lt;br/&gt;
It&apos;s only used to pass to the collector during creation, and that&apos;s also where it&apos;s set.&lt;/p&gt;</comment>
                            <comment id="14589957" author="joel.bernstein" created="Wed, 17 Jun 2015 15:54:47 +0000"  >&lt;p&gt;I believe it was kept around to handle the cache warming scenario when the QueryElevationComponent is not called. I&apos;ll need to do a full review again though because the code looks odd.&lt;/p&gt;</comment>
                            <comment id="14589959" author="joel.bernstein" created="Wed, 17 Jun 2015 15:55:43 +0000"  >&lt;p&gt;Supporting the QueryElevationComponent with ReRanking was tricky&lt;/p&gt;</comment>
                            <comment id="14589968" author="joel.bernstein" created="Wed, 17 Jun 2015 16:04:11 +0000"  >&lt;p&gt;Ok, new patch using the normal pattern for query rewriting.&lt;/p&gt;</comment>
                            <comment id="14589992" author="yseeley@gmail.com" created="Wed, 17 Jun 2015 16:17:12 +0000"  >&lt;p&gt;Don&apos;t forget to replicate the boost in clone()&lt;/p&gt;</comment>
                            <comment id="14590177" author="joel.bernstein" created="Wed, 17 Jun 2015 17:55:24 +0000"  >&lt;p&gt;New patch cloning the boost as well. The boost on the ReRankQuery is not actually applied though. There is a reRankWeight param that serves as a boost. The boost is included in the hashCode and equals of the ReRankQuery because the test framework enforces that.&lt;/p&gt;</comment>
                            <comment id="14591192" author="enashed" created="Thu, 18 Jun 2015 03:50:10 +0000"  >&lt;p&gt;Thanks a lot for that, it works for me! (Y)&lt;/p&gt;</comment>
                            <comment id="14591732" author="joel.bernstein" created="Thu, 18 Jun 2015 12:51:57 +0000"  >&lt;p&gt;Ok, this is looking pretty good. New test scenario ensures that cache hit occurs when the main query is re-written. The reRank Explain is showing up properly in the debugQuery output. &lt;/p&gt;

&lt;p&gt;Running the full test suite now so hope to commit and backport to the 5x branch shortly.&lt;/p&gt;

&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enashed&quot; class=&quot;user-hover&quot; rel=&quot;enashed&quot;&gt;enashed&lt;/a&gt; for reporting the bug and collaborating on the ticket. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yseeley%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;yseeley@gmail.com&quot;&gt;yseeley@gmail.com&lt;/a&gt; for guidance on the rewrite.&lt;/p&gt;
</comment>
                            <comment id="14591779" author="jira-bot" created="Thu, 18 Jun 2015 13:27:58 +0000"  >&lt;p&gt;Commit 1686213 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbernste&quot; class=&quot;user-hover&quot; rel=&quot;jbernste&quot;&gt;jbernste&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1686213&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1686213&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7689&quot; title=&quot;ReRankQuery rewrite method can change the QueryResultKey causing cache misses.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7689&quot;&gt;&lt;del&gt;SOLR-7689&lt;/del&gt;&lt;/a&gt;: ReRankQuery rewrite method can change the QueryResultKey causing cache misses&lt;/p&gt;</comment>
                            <comment id="14591899" author="jira-bot" created="Thu, 18 Jun 2015 14:35:48 +0000"  >&lt;p&gt;Commit 1686236 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbernste&quot; class=&quot;user-hover&quot; rel=&quot;jbernste&quot;&gt;jbernste&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1686236&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1686236&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7689&quot; title=&quot;ReRankQuery rewrite method can change the QueryResultKey causing cache misses.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7689&quot;&gt;&lt;del&gt;SOLR-7689&lt;/del&gt;&lt;/a&gt;: ReRankQuery rewrite method can change the QueryResultKey causing cache misses&lt;/p&gt;</comment>
                            <comment id="14591909" author="joel.bernstein" created="Thu, 18 Jun 2015 14:43:03 +0000"  >&lt;p&gt;I have this labeled as 5.2.2 fix, but not sure if there will be a 5.2.2. I&apos;ll keep an eye out for it and backport to lucene_solr_5_2 if it materializes. I&apos;ll also hold off updating the CHANGES.txt until we know what release it will be in.&lt;/p&gt;</comment>
                            <comment id="14591941" author="shalinmangar" created="Thu, 18 Jun 2015 15:07:09 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;ll also hold off updating the CHANGES.txt until we know what release it will be in.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Creating the list of changes for 5.2.2 in the CHANGES.txt is part of the release process. So, please add this issue to the CHANGES.txt under 5.3 so that we can make a decision to backport this to 5.2.2. At least, this way this fix will not be forgotten even if you&apos;re on vacation or not paying attention.&lt;/p&gt;</comment>
                            <comment id="14591955" author="joel.bernstein" created="Thu, 18 Jun 2015 15:19:00 +0000"  >&lt;p&gt;ok&lt;/p&gt;</comment>
                            <comment id="14591962" author="jira-bot" created="Thu, 18 Jun 2015 15:24:35 +0000"  >&lt;p&gt;Commit 1686243 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbernste&quot; class=&quot;user-hover&quot; rel=&quot;jbernste&quot;&gt;jbernste&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1686243&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1686243&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7689&quot; title=&quot;ReRankQuery rewrite method can change the QueryResultKey causing cache misses.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7689&quot;&gt;&lt;del&gt;SOLR-7689&lt;/del&gt;&lt;/a&gt;: Updating CHANGES.txt&lt;/p&gt;</comment>
                            <comment id="14591969" author="jira-bot" created="Thu, 18 Jun 2015 15:27:12 +0000"  >&lt;p&gt;Commit 1686245 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbernste&quot; class=&quot;user-hover&quot; rel=&quot;jbernste&quot;&gt;jbernste&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1686245&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1686245&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7689&quot; title=&quot;ReRankQuery rewrite method can change the QueryResultKey causing cache misses.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7689&quot;&gt;&lt;del&gt;SOLR-7689&lt;/del&gt;&lt;/a&gt;: Updating CHANGES.txt&lt;/p&gt;</comment>
                            <comment id="14591975" author="jira-bot" created="Thu, 18 Jun 2015 15:31:52 +0000"  >&lt;p&gt;Commit 1686246 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbernste&quot; class=&quot;user-hover&quot; rel=&quot;jbernste&quot;&gt;jbernste&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1686246&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1686246&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7689&quot; title=&quot;ReRankQuery rewrite method can change the QueryResultKey causing cache misses.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7689&quot;&gt;&lt;del&gt;SOLR-7689&lt;/del&gt;&lt;/a&gt;: Updating CHANGES.txt&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12740160" name="SOLR-7689.patch" size="5191" author="jbernste" created="Wed, 17 Jun 2015 17:55:24 +0000"/>
                            <attachment id="12740139" name="SOLR-7689.patch" size="5103" author="jbernste" created="Wed, 17 Jun 2015 16:04:11 +0000"/>
                            <attachment id="12740114" name="SOLR-7689.patch" size="5848" author="jbernste" created="Wed, 17 Jun 2015 13:49:11 +0000"/>
                            <attachment id="12739955" name="SOLR-7689.patch" size="4861" author="jbernste" created="Tue, 16 Jun 2015 20:04:40 +0000"/>
                            <attachment id="12739918" name="SOLR-7689.patch" size="604" author="jbernste" created="Tue, 16 Jun 2015 17:32:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 22 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2g353:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>