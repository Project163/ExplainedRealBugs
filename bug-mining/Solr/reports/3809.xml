<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:31:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-12050] UTILIZENODE does not enforce policy rules</title>
                <link>https://issues.apache.org/jira/browse/SOLR-12050</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;I&apos;ve been poking around TestUtilizeNode and some of it&apos;s recent jenkins failures &amp;#8211; AFAICT the &lt;tt&gt;UTILIZENODE&lt;/tt&gt; is not behaving correctly per it&apos;s current documentation...&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;It tries to fix any policy violations first and then it tries to move some load off of the most loaded nodes according to the preferences&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;...based on my testing w/a slightly modified testcase that does additional logging/asserts, it will frequently choose to move a &quot;random&quot; replica to move, even when there are existing replicas that violate the policy.&lt;/p&gt;

&lt;p&gt;I will be commiting my current improvements to the test while citing this issue, and marking the test &amp;#64;AwaitsFix  Then i&apos;ll attach some logs/comments showing what i mean.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13141939">SOLR-12050</key>
            <summary>UTILIZENODE does not enforce policy rules</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="noble.paul">Noble Paul</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Thu, 1 Mar 2018 23:32:32 +0000</created>
                <updated>Fri, 13 Aug 2021 21:14:58 +0000</updated>
                            <resolved>Fri, 13 Aug 2021 21:14:58 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="16382922" author="jira-bot" created="Fri, 2 Mar 2018 00:17:28 +0000"  >&lt;p&gt;Commit e2b3a97587a4387ab138252354d819ce253b625f in lucene-solr&apos;s branch refs/heads/branch_7x from Chris Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e2b3a97&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e2b3a97&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12050&quot; title=&quot;UTILIZENODE does not enforce policy rules&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12050&quot;&gt;&lt;del&gt;SOLR-12050&lt;/del&gt;&lt;/a&gt;: mark TestUtilizeNode as AwaitsFix as well as adding additional logging/assertions to help see what the bug is&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 0424d9c06ba52037024ce5f0f678b2aca8c34fb7)&lt;/p&gt;</comment>
                            <comment id="16382923" author="jira-bot" created="Fri, 2 Mar 2018 00:17:30 +0000"  >&lt;p&gt;Commit 0424d9c06ba52037024ce5f0f678b2aca8c34fb7 in lucene-solr&apos;s branch refs/heads/master from Chris Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0424d9c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0424d9c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12050&quot; title=&quot;UTILIZENODE does not enforce policy rules&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12050&quot;&gt;&lt;del&gt;SOLR-12050&lt;/del&gt;&lt;/a&gt;: mark TestUtilizeNode as AwaitsFix as well as adding additional logging/assertions to help see what the bug is&lt;/p&gt;</comment>
                            <comment id="16382930" author="hossman" created="Fri, 2 Mar 2018 00:31:46 +0000"  >
&lt;p&gt;I&apos;ve attached a sample log file from running this test after my assert/logging updates, if you look for the new logging messages, it&apos;s pretty easy to see that while the 2nd UTILIZE command is causing a replica to be moved onto the new node (jettyY), it seems to be completley ignoring the fact that there is a core hosted on a &quot;blacklist&quot; (per the policy) port (jettyX) that should be the first candidate for being moved...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  // in this particular run, the first UTILIZENODE command works,
  // it moves a replica off a random node to jettyX/34444
  //
  // (allthough see TODO in test -- based on how the docs are worded,
  // it&apos;s not clear if there&apos;s any requirement that it do so)
  
9201 INFO  (TEST-TestUtilizeNode.test-seed#[78A4DE08FC5237FE]) [    ] o.a.s.c.TestUtilizeNode Sending UTILIZE command for jettyX (127.0.0.1:34444_solr)
9204 INFO  (qtp1498399719-45) [n:127.0.0.1:33567_solr    ] o.a.s.h.a.CollectionsHandler Invoked Collection Action :utilizenode with params node=127.0.0.1:34444_solr&amp;amp;action=UTILIZENODE&amp;amp;wt=javabin&amp;amp;version=2 and sendToOCPQueue=true
  ...
9355 INFO  (OverseerThreadFactory-20-thread-3-processing-n:127.0.0.1:46180_solr) [n:127.0.0.1:46180_solr    ] o.a.s.c.a.c.MoveReplicaCmd Replica will be moved to node 127.0.0.1:34444_solr: core_node8:{&quot;core&quot;:&quot;utilizenodecoll_shard2_replica_n7&quot;,&quot;base_url&quot;:&quot;http://127.0.0.1:33567/solr&quot;,&quot;node_name&quot;:&quot;127.0.0.1:33567_solr&quot;,&quot;state&quot;:&quot;active&quot;,&quot;type&quot;:&quot;NRT&quot;}
9361 INFO  (OverseerThreadFactory-20-thread-3-processing-n:127.0.0.1:46180_solr) [n:127.0.0.1:46180_solr    ] o.a.s.c.a.c.AddReplicaCmd Node Identified 127.0.0.1:34444_solr for creating new replica
  ...
10078 INFO  (qtp1498399719-45) [n:127.0.0.1:33567_solr    ] o.a.s.s.HttpSolrCall [admin] webapp=null path=/admin/collections params={node=127.0.0.1:34444_solr&amp;amp;action=UTILIZENODE&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=874
  
  // next up, sanity check which replicas jettyX/34444 now has,
  // then set a new policy saying that port 34444 should have 0 replicas...

10079 INFO  (TEST-TestUtilizeNode.test-seed#[78A4DE08FC5237FE]) [    ] o.a.s.c.TestUtilizeNode jettyX replicas prior to being blacklisted: [core_node10:{&quot;core&quot;:&quot;utilizenodecoll_shard2_replica_n9&quot;,&quot;base_url&quot;:&quot;http://127.0.0.1:34444/solr&quot;,&quot;node_name&quot;:&quot;127.0.0.1:34444_solr&quot;,&quot;state&quot;:&quot;recovering&quot;,&quot;type&quot;:&quot;NRT&quot;}]
10079 INFO  (TEST-TestUtilizeNode.test-seed#[78A4DE08FC5237FE]) [    ] o.a.s.c.TestUtilizeNode Setting new policy to blacklist jettyX (127.0.0.1:34444_solr) port=34444
  ...
10143 INFO  (qtp1498399719-27) [n:127.0.0.1:33567_solr    ] o.a.s.s.HttpSolrCall [admin] webapp=null path=/admin/autoscaling params={wt=javabin&amp;amp;version=2} status=0 QTime=59

  // now spin up another new node: jettyY/55619, 
  // redundently sanity check the replicas on jettyX again,

10144 INFO  (TEST-TestUtilizeNode.test-seed#[78A4DE08FC5237FE]) [    ] o.a.s.c.TestUtilizeNode Spinning up additional jettyY...
  ...
10361 INFO  (zkConnectionManagerCallback-78-thread-1) [    ] o.a.s.c.c.ConnectionManager zkClient has connected
10365 INFO  (TEST-TestUtilizeNode.test-seed#[78A4DE08FC5237FE]) [    ] o.a.s.c.TestUtilizeNode jettyX replicas prior to utilizing jettyY: [core_node10:{&quot;core&quot;:&quot;utilizenodecoll_shard2_replica_n9&quot;,&quot;base_url&quot;:&quot;http://127.0.0.1:34444/solr&quot;,&quot;node_name&quot;:&quot;127.0.0.1:34444_solr&quot;,&quot;state&quot;:&quot;recovering&quot;,&quot;type&quot;:&quot;NRT&quot;}]

  // Now send a UTILIZENODE command for jettyY/55619,
  // this *should* move the replica from jettyX-&amp;gt;jettyY
  // (in order to resolve the existing policy violation)

10365 INFO  (TEST-TestUtilizeNode.test-seed#[78A4DE08FC5237FE]) [    ] o.a.s.c.TestUtilizeNode Sending UTILIZE command for jettyY (127.0.0.1:55619_solr)
10366 INFO  (qtp1498399719-45) [n:127.0.0.1:33567_solr    ] o.a.s.h.a.CollectionsHandler Invoked Collection Action :utilizenode with params node=127.0.0.1:55619_solr&amp;amp;action=UTILIZENODE&amp;amp;wt=javabin&amp;amp;version=2 and sendToOCPQueue=true
  ...
10448 INFO  (OverseerThreadFactory-20-thread-4-processing-n:127.0.0.1:46180_solr) [n:127.0.0.1:46180_solr    ] o.a.s.c.a.c.MoveReplicaCmd Replica will be moved to node 127.0.0.1:55619_solr: core_node6:{&quot;core&quot;:&quot;utilizenodecoll_shard2_replica_n5&quot;,&quot;base_url&quot;:&quot;http://127.0.0.1:46180/solr&quot;,&quot;node_name&quot;:&quot;127.0.0.1:46180_solr&quot;,&quot;state&quot;:&quot;active&quot;,&quot;type&quot;:&quot;NRT&quot;,&quot;leader&quot;:&quot;true&quot;}
10450 INFO  (OverseerThreadFactory-20-thread-4-processing-n:127.0.0.1:46180_solr) [n:127.0.0.1:46180_solr    ] o.a.s.c.a.c.AddReplicaCmd Node Identified 127.0.0.1:55619_solr for creating new replica
  ...
12710 INFO  (qtp1498399719-45) [n:127.0.0.1:33567_solr    ] o.a.s.s.HttpSolrCall [admin] webapp=null path=/admin/collections params={node=127.0.0.1:55619_solr&amp;amp;action=UTILIZENODE&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=2343

  // but as you can see above, the replica that&apos;s added to jettyY/55619
  // comes from a completley different node on port 46180

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="16383217" author="jira-bot" created="Fri, 2 Mar 2018 06:00:45 +0000"  >&lt;p&gt;Commit 888c6260f122d03beec03615469dbed444ab62e7 in lucene-solr&apos;s branch refs/heads/branch_7x from noble&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=888c626&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=888c626&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12031&quot; title=&quot;Refactor Policy framework to let state changes to be applied to all nodes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12031&quot;&gt;&lt;del&gt;SOLR-12031&lt;/del&gt;&lt;/a&gt;: Refactor Policy framework to make simulated changes affect more than a single node&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12050&quot; title=&quot;UTILIZENODE does not enforce policy rules&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12050&quot;&gt;&lt;del&gt;SOLR-12050&lt;/del&gt;&lt;/a&gt;: UTILIZENODE does not enforce policy rules&lt;/p&gt;</comment>
                            <comment id="16383222" author="jira-bot" created="Fri, 2 Mar 2018 06:04:33 +0000"  >&lt;p&gt;Commit 23aee00213a2c48bd578bcf01a5ed435b0bdc881 in lucene-solr&apos;s branch refs/heads/master from noble&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=23aee00&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=23aee00&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12031&quot; title=&quot;Refactor Policy framework to let state changes to be applied to all nodes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12031&quot;&gt;&lt;del&gt;SOLR-12031&lt;/del&gt;&lt;/a&gt;: Refactor Policy framework to make simulated changes affect more than a single node&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12050&quot; title=&quot;UTILIZENODE does not enforce policy rules&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12050&quot;&gt;&lt;del&gt;SOLR-12050&lt;/del&gt;&lt;/a&gt;: UTILIZENODE does not enforce policy rules&lt;/p&gt;</comment>
                            <comment id="17398925" author="ctargett" created="Fri, 13 Aug 2021 21:14:58 +0000"  >&lt;p&gt;UTILIZENODE was removed as part of the removal of the autoscaling framework.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12912699" name="SOLR-12050.log.txt" size="228680" author="hossman" created="Fri, 2 Mar 2018 00:29:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 13 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3qro7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>