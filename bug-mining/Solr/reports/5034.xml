<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:59:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-15083] prometheus-exporter metric solr_metrics_jvm_os_cpu_time_seconds is misnamed</title>
                <link>https://issues.apache.org/jira/browse/SOLR-15083</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;&lt;b&gt;solr_metrics_jvm_os_cpu_time_seconds&lt;/b&gt; metric exported by prometheus-exporter has seconds in its name, however it appears that it is microseconds.&lt;/p&gt;

&lt;p&gt;This name can create confusion when one wants to report it in a dashboard.&lt;br/&gt;
 That metric is defined in &lt;a href=&quot;https://github.com/apache/lucene-solr/blob/branch_8_5/solr/contrib/prometheus-exporter/conf/solr-exporter-config.xml#L247&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/branch_8_5/solr/contrib/prometheus-exporter/conf/solr-exporter-config.xml#L247&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
          &amp;lt;str&amp;gt;
            .metrics[&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.jvm&quot;&lt;/span&gt;] | to_entries | .[] | select(.key == &lt;span class=&quot;code-quote&quot;&gt;&quot;os.processCpuTime&quot;&lt;/span&gt;) as $object |
            ($object.value / 1000.0) as $value |
            {
              name         : &lt;span class=&quot;code-quote&quot;&gt;&quot;solr_metrics_jvm_os_cpu_time_seconds&quot;&lt;/span&gt;,
              type         : &lt;span class=&quot;code-quote&quot;&gt;&quot;COUNTER&quot;&lt;/span&gt;,
              help         : &lt;span class=&quot;code-quote&quot;&gt;&quot;See following URL: https:&lt;span class=&quot;code-comment&quot;&gt;//lucene.apache.org/solr/guide/metrics-reporting.html&quot;&lt;/span&gt;,
&lt;/span&gt;              label_names  : [&lt;span class=&quot;code-quote&quot;&gt;&quot;item&quot;&lt;/span&gt;],
              label_values : [&lt;span class=&quot;code-quote&quot;&gt;&quot;processCpuTime&quot;&lt;/span&gt;],
              value        : $value
            }
          &amp;lt;/str&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In the above config we see that the metric came from &#160;&lt;b&gt;os.processCpuTime&lt;/b&gt;, which itself came from JMX call &lt;a href=&quot;https://docs.oracle.com/javase/7/docs/jre/api/management/extension/com/sun/management/OperatingSystemMXBean.html#getProcessCpuTime()&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;getProcessCpuTime()&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;That javadoc says&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; getProcessCpuTime()
Returns the CPU time used by the process on which the Java virtual machine is running in nanoseconds. The returned value is of nanoseconds precision but not necessarily nanoseconds accuracy. This method returns -1 &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the the platform does not support &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; operation.
Returns:
the CPU time used by the process in nanoseconds, or -1 &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; operation is not supported.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Nanoseconds / 1000 is microseconds.&lt;br/&gt;
Either the name or the computation should be updated.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="13352530">SOLR-15083</key>
            <summary>prometheus-exporter metric solr_metrics_jvm_os_cpu_time_seconds is misnamed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dsmiley">David Smiley</assignee>
                                    <reporter username="matmarie">Mathieu Marie</reporter>
                        <labels>
                            <label>monitoring</label>
                            <label>newdev</label>
                            <label>prometheus</label>
                    </labels>
                <created>Fri, 15 Jan 2021 17:12:03 +0000</created>
                <updated>Fri, 21 Jul 2023 20:40:34 +0000</updated>
                            <resolved>Thu, 27 Apr 2023 07:37:01 +0000</resolved>
                                    <version>8.6</version>
                    <version>9.0</version>
                                    <fixVersion>9.3</fixVersion>
                                    <component>contrib - prometheus-exporter</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="5400">1.5h</timespent>
                                <comments>
                            <comment id="17266902" author="dsmiley" created="Sun, 17 Jan 2021 20:02:48 +0000"  >&lt;p&gt;Since it&apos;s &quot;just&quot; configuration (some XML file) that is affected that users have the ability (and encouraged to) edit, I don&apos;t think there&apos;s a significant backwards compatibility concern... though of course we&apos;d mention this in upgrade notes.&lt;/p&gt;

&lt;p&gt;My initial preference is fixing the math so that this metric name is true to the units of its existing name &amp;#8211; to be in seconds.  On the other hand, I can see most (all?) the other times we report are in milliseconds, both for Jetty level metrics and Solr (&quot;*.requestTimes&quot;), so maybe we should be consistent?  CC @ab &lt;/p&gt;</comment>
                            <comment id="17266904" author="dsmiley" created="Sun, 17 Jan 2021 20:05:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=matmarie&quot; class=&quot;user-hover&quot; rel=&quot;matmarie&quot;&gt;matmarie&lt;/a&gt; I recall we want to see % CPU Load, which I think we calculate from this number and the number of CPUs.  Maybe Solr should report that?  Otherwise, I doubt this number by itself (without knowledge of number of CPUs) is useful &amp;#8211; too raw?&lt;/p&gt;</comment>
                            <comment id="17479393" author="dsmiley" created="Thu, 20 Jan 2022 14:10:38 +0000"  >&lt;p&gt;Marking 9.0 blocker because a change like this would best be done on a major release.  But maybe not critical if the metric is plain wrong?&lt;/p&gt;</comment>
                            <comment id="17626193" author="janhoy" created="Sun, 30 Oct 2022 09:15:38 +0000"  >&lt;p&gt;This was never marked as blocker, since you need to use &quot;fix version&quot; for that.&lt;/p&gt;</comment>
                            <comment id="17626814" author="dsmiley" created="Mon, 31 Oct 2022 20:03:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=houston&quot; class=&quot;user-hover&quot; rel=&quot;houston&quot;&gt;houston&lt;/a&gt; (or anyone; I asked &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ab&quot; class=&quot;user-hover&quot; rel=&quot;ab&quot;&gt;ab&lt;/a&gt; before) do you have opinion on the fix approach?  Change the metrics name (in prometheus config XML) or change the data from Solr to match the existing name?&lt;/p&gt;</comment>
                            <comment id="17626820" author="houston" created="Mon, 31 Oct 2022 20:12:32 +0000"  >&lt;p&gt;Given that the base time unit in Prometheus is seconds, I vote for changing the data to match seconds instead of changing the name:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://prometheus.io/docs/practices/naming/#base-units&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://prometheus.io/docs/practices/naming/#base-units&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17626828" author="dsmiley" created="Mon, 31 Oct 2022 20:21:33 +0000"  >&lt;p&gt;The metrics from Solr is an independent layer of Prometheus; users don&apos;t even have to use Prometheus.  The metrics name there is &quot;os.processCpuTime&quot;.&lt;br/&gt;
Another option I didn&apos;t list but of course applies as well, is just to change the math in the prometheus XML to convert to seconds.  I suppose there&apos;s the least back-combat impacting option as well.&lt;/p&gt;</comment>
                            <comment id="17626835" author="houston" created="Mon, 31 Oct 2022 20:34:06 +0000"  >&lt;p&gt;I don&apos;t really have an issue with the underlying Solr metrics being in nanoseconds/milliseconds. If we want to have general consistency across our time metrics out of Solr, then converting it to milliseconds (for the Solr response) is fine with me. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Another option I didn&apos;t list but of course applies as well, is just to change the math in the prometheus XML to convert to seconds.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ahhh I misunderstood and thought that was what your suggestion was. I vote for this. (independently of changing from nano -&amp;gt; micro inside of Solr)&lt;/p&gt;</comment>
                            <comment id="17717034" author="jira-bot" created="Thu, 27 Apr 2023 07:34:53 +0000"  >&lt;p&gt;Commit a557776ba196d5adb7cd689a6ceffa9084440407 in solr&apos;s branch refs/heads/main from Matthew Biscocho&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=a557776ba19&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=a557776ba19&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15083&quot; title=&quot;prometheus-exporter metric solr_metrics_jvm_os_cpu_time_seconds is misnamed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15083&quot;&gt;&lt;del&gt;SOLR-15083&lt;/del&gt;&lt;/a&gt;: prometheus-exporter incorrect metric namings (#1588)&lt;/p&gt;
</comment>
                            <comment id="17717035" author="janhoy" created="Thu, 27 Apr 2023 07:37:01 +0000"  >&lt;p&gt;Two years in the making, finally this annoying bug is fixed &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Thanks all!&lt;/p&gt;</comment>
                            <comment id="17717036" author="jira-bot" created="Thu, 27 Apr 2023 07:39:07 +0000"  >&lt;p&gt;Commit c5927d9c68dfaddce7690615b1a8f4f3d9277bb1 in solr&apos;s branch refs/heads/branch_9x from Matthew Biscocho&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=c5927d9c68d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=c5927d9c68d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15083&quot; title=&quot;prometheus-exporter metric solr_metrics_jvm_os_cpu_time_seconds is misnamed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15083&quot;&gt;&lt;del&gt;SOLR-15083&lt;/del&gt;&lt;/a&gt;: prometheus-exporter incorrect metric namings (#1588)&lt;/p&gt;
</comment>
                            <comment id="17745739" author="houston" created="Fri, 21 Jul 2023 20:40:34 +0000"  >&lt;p&gt;Closing after the 9.3.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 16 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0mmu8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>