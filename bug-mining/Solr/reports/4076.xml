<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:35:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-13030] MetricsHistoryHandler appears to never be &quot;close()ed&quot; - causes thread leaks?</title>
                <link>https://issues.apache.org/jira/browse/SOLR-13030</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;&lt;tt&gt;MetricsHistoryHandler&lt;/tt&gt; implements &lt;tt&gt;Closeable&lt;/tt&gt; and depends on it&apos;s &lt;tt&gt;close()&lt;/tt&gt; method to shutdown a &lt;tt&gt;private ScheduledThreadPoolExecutor collectService&lt;/tt&gt; as well as a &lt;tt&gt;private final SolrRrdBackendFactory factory&lt;/tt&gt; (which maintains it&apos;s own &lt;tt&gt;private ScheduledThreadPoolExecutor&lt;/tt&gt; but &lt;del&gt;as far as i can tell nothing seems to every &quot;close&quot; this &lt;tt&gt;MetricsHistoryHandler&lt;/tt&gt; on shutdown.&lt;/del&gt; after changes in 75b1831967982 which move this close() call to a &lt;tt&gt;ForkJoinPool&lt;/tt&gt; in &lt;tt&gt;CoreContainer.shutdown()&lt;/tt&gt; it seems to be leaking threads.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13201741">SOLR-13030</key>
            <summary>MetricsHistoryHandler appears to never be &quot;close()ed&quot; - causes thread leaks?</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="markrmiller@gmail.com">Mark Miller</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Fri, 30 Nov 2018 23:16:11 +0000</created>
                <updated>Fri, 13 Aug 2021 19:30:20 +0000</updated>
                            <resolved>Fri, 13 Aug 2021 19:30:20 +0000</resolved>
                                                    <fixVersion>8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16705430" author="hossman" created="Fri, 30 Nov 2018 23:33:27 +0000"  >&lt;p&gt;Digging in, i just realized the code for closing the MetricsHistoryHandler was changed heavily by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt;&apos;s 75b1831967982 commit in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12932&quot; title=&quot;ant test (without badapples=false) should pass easily for developers.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12932&quot;&gt;SOLR-12932&lt;/a&gt;, and now happens as part of a &lt;tt&gt;customThreadPool.submit()&lt;/tt&gt; in CoreContainer.shutdown &amp;#8211; which is why i missed seeing it the first time i looked.&lt;/p&gt;</comment>
                            <comment id="16705489" author="jira-bot" created="Sat, 1 Dec 2018 00:13:41 +0000"  >&lt;p&gt;Commit a01d0d9ef9cb3d4bbb5a725f9e2aa8dfd9064f95 in lucene-solr&apos;s branch refs/heads/master from markrmiller&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a01d0d9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a01d0d9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13030&quot; title=&quot;MetricsHistoryHandler appears to never be &amp;quot;close()ed&amp;quot; - causes thread leaks?&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13030&quot;&gt;&lt;del&gt;SOLR-13030&lt;/del&gt;&lt;/a&gt;: Close MetricsHistoryHandler inline.&lt;/p&gt;</comment>
                            <comment id="16705490" author="jira-bot" created="Sat, 1 Dec 2018 00:14:01 +0000"  >&lt;p&gt;Commit 2f6bdb5940ba34386b60ab5868df98eb8cf94b2a in lucene-solr&apos;s branch refs/heads/branch_7x from markrmiller&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2f6bdb5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2f6bdb5&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13030&quot; title=&quot;MetricsHistoryHandler appears to never be &amp;quot;close()ed&amp;quot; - causes thread leaks?&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13030&quot;&gt;&lt;del&gt;SOLR-13030&lt;/del&gt;&lt;/a&gt;: Close MetricsHistoryHandler inline.&lt;/p&gt;</comment>
                            <comment id="16705503" author="markrmiller@gmail.com" created="Sat, 1 Dec 2018 00:16:50 +0000"  >&lt;p&gt;I&apos;m not sure if it&apos;s as simple as that, but for now I&apos;ll just close it inline and see what happens since I&apos;ve never seen this leak in my local runs.&lt;/p&gt;</comment>
                            <comment id="16705574" author="markrmiller@gmail.com" created="Sat, 1 Dec 2018 02:02:59 +0000"  >&lt;p&gt;I see some permissions issues with Java 11 I have to deal with.&lt;/p&gt;</comment>
                            <comment id="16705668" author="jira-bot" created="Sat, 1 Dec 2018 06:32:01 +0000"  >&lt;p&gt;Commit d8f482f5fbae50a4d2ed1758a835a90768f5b279 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d8f482f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d8f482f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13030&quot; title=&quot;MetricsHistoryHandler appears to never be &amp;quot;close()ed&amp;quot; - causes thread leaks?&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13030&quot;&gt;&lt;del&gt;SOLR-13030&lt;/del&gt;&lt;/a&gt;: Update executor usage to work correctly with Java 11 and update Mockito &amp;amp; HttpComponents to work with Java 11 and fix get remote info retry to work across jvms better.&lt;/p&gt;</comment>
                            <comment id="16705673" author="jira-bot" created="Sat, 1 Dec 2018 06:34:56 +0000"  >&lt;p&gt;Commit a47b64000b227aae57636877b26f2aa2bc16e1f5 in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a47b640&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a47b640&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13030&quot; title=&quot;MetricsHistoryHandler appears to never be &amp;quot;close()ed&amp;quot; - causes thread leaks?&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13030&quot;&gt;&lt;del&gt;SOLR-13030&lt;/del&gt;&lt;/a&gt;: Update executor usage to work correctly with Java 11 and update Mockito &amp;amp; HttpComponents to work with Java 11 and fix get remote info retry to work across jvms better.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Conflicts:&lt;/li&gt;
	&lt;li&gt;solr/CHANGES.txt&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="16705677" author="markrmiller@gmail.com" created="Sat, 1 Dec 2018 06:36:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman&quot; class=&quot;user-hover&quot; rel=&quot;hossman&quot;&gt;hossman&lt;/a&gt;, I think I addressed most of that and it was related to Java &amp;gt; 8. There is still a problem with SSL on Java 12 though. Otherwise I think things are working now.&lt;/p&gt;</comment>
                            <comment id="16705921" author="jira-bot" created="Sat, 1 Dec 2018 17:09:53 +0000"  >&lt;p&gt;Commit a01d0d9ef9cb3d4bbb5a725f9e2aa8dfd9064f95 in lucene-solr&apos;s branch refs/heads/jira/http2 from markrmiller&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a01d0d9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a01d0d9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13030&quot; title=&quot;MetricsHistoryHandler appears to never be &amp;quot;close()ed&amp;quot; - causes thread leaks?&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13030&quot;&gt;&lt;del&gt;SOLR-13030&lt;/del&gt;&lt;/a&gt;: Close MetricsHistoryHandler inline.&lt;/p&gt;</comment>
                            <comment id="16705922" author="jira-bot" created="Sat, 1 Dec 2018 17:09:54 +0000"  >&lt;p&gt;Commit d8f482f5fbae50a4d2ed1758a835a90768f5b279 in lucene-solr&apos;s branch refs/heads/jira/http2 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d8f482f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d8f482f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13030&quot; title=&quot;MetricsHistoryHandler appears to never be &amp;quot;close()ed&amp;quot; - causes thread leaks?&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13030&quot;&gt;&lt;del&gt;SOLR-13030&lt;/del&gt;&lt;/a&gt;: Update executor usage to work correctly with Java 11 and update Mockito &amp;amp; HttpComponents to work with Java 11 and fix get remote info retry to work across jvms better.&lt;/p&gt;</comment>
                            <comment id="17088133" author="dsmiley" created="Mon, 20 Apr 2020 22:15:54 +0000"  >&lt;p&gt;Shouldn&apos;t this be Closed for 8.0?&lt;/p&gt;</comment>
                            <comment id="17398878" author="ctargett" created="Fri, 13 Aug 2021 19:30:20 +0000"  >&lt;p&gt;I&apos;ll take a cue from David&apos;s comment that this probably should have been closed for 8.0, but at this point the test has been removed from Solr so if there was anything else to do here, there isn&apos;t now.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310060">
                    <name>Container</name>
                                            <outwardlinks description="contains">
                                        <issuelink>
            <issuekey id="13192495">SOLR-12883</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13194637">SOLR-12932</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 13 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|s0129k:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>