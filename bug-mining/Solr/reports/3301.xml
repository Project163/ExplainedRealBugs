<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:20:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-10266] invalid assumptions about doc order in TestPointFields, masking test bug with date functions</title>
                <link>https://issues.apache.org/jira/browse/SOLR-10266</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;There are a bunch of places in TestPointFields where &lt;tt&gt;assertQ()&lt;/tt&gt; is used to verify that many docs match a query and have particular values &amp;#8211; but because of how the XPath expressions are written there are implicit assumptions about the order of the docs matching the order they were added to the index, which isn&apos;t always garunteed depending on the randomized merge policy that might be used.&lt;/p&gt;

&lt;p&gt;While fixing this, I also uncovered another test bug when checking &lt;tt&gt;DatePointField&lt;/tt&gt; function sorting due to every doc having the same effective sort value&lt;/p&gt;</description>
                <environment></environment>
        <key id="13050112">SOLR-10266</key>
            <summary>invalid assumptions about doc order in TestPointFields, masking test bug with date functions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Fri, 10 Mar 2017 18:48:34 +0000</created>
                <updated>Sat, 8 Jun 2019 15:34:14 +0000</updated>
                            <resolved>Tue, 14 Mar 2017 17:01:53 +0000</resolved>
                                                    <fixVersion>6.5</fixVersion>
                    <fixVersion>7.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15905549" author="hossman" created="Fri, 10 Mar 2017 18:54:00 +0000"  >
&lt;p&gt;Here&apos;s the patch of what i&apos;ve got so far, generally making 2 changes everywhere the test has an implicit assumption about the order docs would be returned:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;change the order the test &lt;em&gt;adds&lt;/em&gt; the docs in to be (effectively) be &quot;id desc&quot;
	&lt;ul&gt;
		&lt;li&gt;this forces solr&apos;s implicit default sort to mismatch the existing implicitly expected order (even if no funky merging happens) so the tests would fail reliably regardless of seed&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;add a sort by &quot;id asc&quot; everywhere the &lt;tt&gt;assertQ()&lt;/tt&gt; calls had an implicit assumption that the results would be returned in &quot;id&quot; order&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;(in a few places early on in my fixes, I also added some tighter asserts to the range query testing as well)&lt;/p&gt;

&lt;p&gt;there is one nocommit in this patch, in &lt;tt&gt;doTestDatePointFunctionQuery&lt;/tt&gt;...&lt;/p&gt;

&lt;p&gt;AFAICT something is really wrong with the first &lt;tt&gt;assertQ&lt;/tt&gt; in this test &amp;#8211; which is specifically about sorting by a function on the date point field (which also uses DocValues).&lt;/p&gt;

&lt;p&gt;Even w/o any of my changes, I can&apos;t see any reason why the doc order currently listed in this assert should be the expected doc order for the specified sort.  It looks backwards to me.  And when I flip the order the documents are added to the index, the actual order returned flips as well &amp;#8211; suggesting that the sort by function is having no effect at all.&lt;/p&gt;

&lt;p&gt;This suggests that sorting by function on &lt;tt&gt;DatePointField&lt;/tt&gt; may not be working? ... either that or maybe the particular function used in this test isn&apos;t valid for date fields and results in identical values for all docs? (i&apos;ve never tried usig &lt;tt&gt;product(...)&lt;/tt&gt; on a date before)&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat&quot; class=&quot;user-hover&quot; rel=&quot;caomanhdat&quot;&gt;caomanhdat&lt;/a&gt; - i know you just added &lt;tt&gt;DatePointField&lt;/tt&gt; support in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9986&quot; title=&quot;Implement DatePointField&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9986&quot;&gt;&lt;del&gt;SOLR-9986&lt;/del&gt;&lt;/a&gt;, can you please take a look at the nocommit in this patch?&lt;/p&gt;</comment>
                            <comment id="15905994" author="caomanhdat" created="Sat, 11 Mar 2017 01:48:35 +0000"  >&lt;p&gt;@Hoss : Sure!&lt;/p&gt;</comment>
                            <comment id="15923703" author="caomanhdat" created="Tue, 14 Mar 2017 07:07:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman&quot; class=&quot;user-hover&quot; rel=&quot;hossman&quot;&gt;hossman&lt;/a&gt; I checked the test and you actually right. The test is badly written, It should change from &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;assertQ(req(&lt;span class=&quot;code-quote&quot;&gt;&quot;q&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;*:*&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;fl&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;id, &quot;&lt;/span&gt; + dvFieldName, &lt;span class=&quot;code-quote&quot;&gt;&quot;sort&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;product(-1,&quot;&lt;/span&gt; + dvFieldName + &lt;span class=&quot;code-quote&quot;&gt;&quot;) asc&quot;&lt;/span&gt;),
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;to&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;assertQ(req(&lt;span class=&quot;code-quote&quot;&gt;&quot;q&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;*:*&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;fl&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;id, &quot;&lt;/span&gt; + dvFieldName, &lt;span class=&quot;code-quote&quot;&gt;&quot;sort&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;product(-1,ms(&quot;&lt;/span&gt; + dvFieldName + &lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;+baseDate+&lt;span class=&quot;code-quote&quot;&gt;&quot;)) desc&quot;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But the sorting by function on DatePointField still work. Because &lt;tt&gt;ProductFloatFunction&lt;/tt&gt; is used for &lt;tt&gt;product()&lt;/tt&gt; so the long value ( of date field ) will be converted into float before doing multiplication. It lead into losing some last decimals. So they will end up with same value &lt;tt&gt;7.8973554E11&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="15924474" author="hossman" created="Tue, 14 Mar 2017 16:05:02 +0000"  >&lt;p&gt;ah ... ok &amp;#8211; so the behavior i was seeing was just because all docs were getting the same (effective) sort value &amp;#8211; after Double conversion.&lt;/p&gt;

&lt;p&gt;that makes sense.&lt;/p&gt;</comment>
                            <comment id="15924555" author="jira-bot" created="Tue, 14 Mar 2017 16:52:16 +0000"  >&lt;p&gt;Commit 5d7b83adbedaef429d0375d9b37c11bcff173500 in lucene-solr&apos;s branch refs/heads/branch_6x from Chris Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5d7b83a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5d7b83a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10266&quot; title=&quot;invalid assumptions about doc order in TestPointFields, masking test bug with date functions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10266&quot;&gt;&lt;del&gt;SOLR-10266&lt;/del&gt;&lt;/a&gt;: fix implicit test assumptions about doc order&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 9417367b1afd404b944692d9947f78587e2b2d94)&lt;/p&gt;</comment>
                            <comment id="15924556" author="jira-bot" created="Tue, 14 Mar 2017 16:52:18 +0000"  >&lt;p&gt;Commit 9417367b1afd404b944692d9947f78587e2b2d94 in lucene-solr&apos;s branch refs/heads/master from Chris Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9417367&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9417367&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10266&quot; title=&quot;invalid assumptions about doc order in TestPointFields, masking test bug with date functions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10266&quot;&gt;&lt;del&gt;SOLR-10266&lt;/del&gt;&lt;/a&gt;: fix implicit test assumptions about doc order&lt;/p&gt;</comment>
                            <comment id="15924568" author="hossman" created="Tue, 14 Mar 2017 17:01:37 +0000"  >&lt;p&gt;updating summay &amp;amp; description&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13036046">SOLR-9986</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13077280">SOLR-10815</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12857371" name="SOLR-10266.patch" size="27992" author="hossman" created="Fri, 10 Mar 2017 18:54:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 36 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3b987:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>