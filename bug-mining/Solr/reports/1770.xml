<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:45:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-5561] DefaultSimilarity &apos;init&apos; method is not called, if the similarity plugin is not explicitly declared in the schema</title>
                <link>https://issues.apache.org/jira/browse/SOLR-5561</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;As a result, discountOverlap is not initialized to true, and the default behavior is that multiple terms on the same position DO affect the fieldNorm. this is not the intended default.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12685636">SOLR-5561</key>
            <summary>DefaultSimilarity &apos;init&apos; method is not called, if the similarity plugin is not explicitly declared in the schema</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="isaachebsh">Isaac Hebsh</reporter>
                        <labels>
                            <label>similarity</label>
                    </labels>
                <created>Thu, 19 Dec 2013 17:23:54 +0000</created>
                <updated>Mon, 9 May 2016 18:44:38 +0000</updated>
                            <resolved>Mon, 10 Feb 2014 23:59:19 +0000</resolved>
                                    <version>4.6</version>
                                    <fixVersion>4.7</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>Schema and Analysis</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13856995" author="isaachebsh" created="Thu, 26 Dec 2013 18:47:37 +0000"  >&lt;p&gt;Patch attached.&lt;/p&gt;</comment>
                            <comment id="13870056" author="hossman" created="Mon, 13 Jan 2014 22:09:57 +0000"  >&lt;blockquote&gt;&lt;p&gt;As a result, discountOverlap is not initialized to true, and the default behavior is that multiple terms on the same position DO affect the fieldNorm. this is not the intended default.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Grr... that really sucks &amp;#8211; and seems easily confusing.&lt;/p&gt;

&lt;p&gt;My concern about making this change as written in Isaac&apos;s patch is that it could cause some very weird inconsistencies for people who upgrade.&lt;/p&gt;

&lt;p&gt;My suggestion would be to do the following...&lt;/p&gt;

&lt;p&gt;1) in DefaultSimilarityFactory, change the declaration of the discountOverlaps variable to default to true for cnsistency (seems like a good idea in general, even if we do fix the lifecycle to ensure init() gets called)&lt;br/&gt;
2) in IndexSchema.java, where Isaac&apos;s patch currently fixes the hadcoded construction of a default instance of DefaultSimilarityFactory to always call init with empty SolrParams, make the params pased to the init param contingent on the value of the luceneMatchVersion &amp;#8211; if it&apos;s less then 4.7, pass discountOverlaps=false to the init method for backcompat, and if it&apos;s 4.7 or greater pass an empty set of params (so the factories defaults are used correctly)&lt;br/&gt;
3) write some tests using trivial solrconfig.xml+schema.xml files with hardcoded version match params to verify that the correct behavior is being implemented.&lt;/p&gt;

&lt;p&gt;thoughts?&lt;/p&gt;</comment>
                            <comment id="13873339" author="iorixxx" created="Thu, 16 Jan 2014 13:06:00 +0000"  >&lt;p&gt;I had this test case handy.&lt;/p&gt;</comment>
                            <comment id="13885697" author="vzhovtiuk" created="Wed, 29 Jan 2014 19:35:47 +0000"  >&lt;p&gt;Added changes to IndexSchema&lt;br/&gt;
Added IndexSchema tests checking discountOverlaps depending on luceneMatchVersion&lt;/p&gt;</comment>
                            <comment id="13897114" author="hossman" created="Mon, 10 Feb 2014 22:18:10 +0000"  >&lt;p&gt;Ahmet &amp;amp; Vitaliy - thanks for your tests &amp;amp; improvements!&lt;/p&gt;

&lt;p&gt;Here&apos;s a slightly updated patch...&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;introduce a String constant for the &quot;discountOverlaps&quot; param name (since it&apos;s now used outside the class in IndexSchema, a constant is appropriate)&lt;/li&gt;
	&lt;li&gt;consolidated the two tests classes into one to reduce some duplication &amp;amp; leverage some existing BaseSimilarityTestCase helper methods&lt;/li&gt;
	&lt;li&gt;change the tests to leverage the Version enum values instead of just version string constants (this will make it easier to find/remove tests refering to 4.6 and 4.7 once those constants are no longer explicitly supported)&lt;/li&gt;
	&lt;li&gt;added some javadocs&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;ll commit soon unless anyone sees any problems?&lt;/p&gt;</comment>
                            <comment id="13897275" author="jira-bot" created="Mon, 10 Feb 2014 23:26:22 +0000"  >&lt;p&gt;Commit 1566842 from hossman@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1566842&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1566842&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5561&quot; title=&quot;DefaultSimilarity &amp;#39;init&amp;#39; method is not called, if the similarity plugin is not explicitly declared in the schema&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5561&quot;&gt;&lt;del&gt;SOLR-5561&lt;/del&gt;&lt;/a&gt;: Fix implicit DefaultSimilarityFactory initialization in IndexSchema to properly specify discountOverlap option&lt;/p&gt;</comment>
                            <comment id="13897302" author="jira-bot" created="Mon, 10 Feb 2014 23:55:37 +0000"  >&lt;p&gt;Commit 1566871 from hossman@apache.org in branch &apos;dev/branches/branch_4x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1566871&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1566871&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5561&quot; title=&quot;DefaultSimilarity &amp;#39;init&amp;#39; method is not called, if the similarity plugin is not explicitly declared in the schema&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5561&quot;&gt;&lt;del&gt;SOLR-5561&lt;/del&gt;&lt;/a&gt;: Fix implicit DefaultSimilarityFactory initialization in IndexSchema to properly specify discountOverlap option (merge r1566842)&lt;/p&gt;</comment>
                            <comment id="13897307" author="hossman" created="Mon, 10 Feb 2014 23:59:19 +0000"  >&lt;p&gt;Thanks everyone!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12628084" name="SOLR-5561.patch" size="5140" author="hossman" created="Mon, 10 Feb 2014 22:18:10 +0000"/>
                            <attachment id="12625938" name="SOLR-5561.patch" size="6651" author="vzhovtiuk" created="Wed, 29 Jan 2014 19:35:47 +0000"/>
                            <attachment id="12623371" name="SOLR-5561.patch" size="2841" author="iorixxx" created="Thu, 16 Jan 2014 13:06:00 +0000"/>
                            <attachment id="12620526" name="SOLR-5561.patch" size="788" author="isaachebsh" created="Thu, 26 Dec 2013 18:47:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>364711</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 41 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1qv3j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>365011</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>