<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:41:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-13882] Collections API COLSTATUS does not check live_nodes when reporting replica&apos;s status</title>
                <link>https://issues.apache.org/jira/browse/SOLR-13882</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The COLSTATUS command will report all replicas as &quot;active&quot; even when the node is not in live_nodes.&lt;/p&gt;

&lt;p&gt;To reproduce:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Start two Solr instances&lt;/li&gt;
	&lt;li&gt;create a collection with replicas on both&lt;/li&gt;
	&lt;li&gt;issue a &quot;kill -9&quot; to one of the Solr instances.&lt;/li&gt;
	&lt;li&gt;issue the COLSTATUS command&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Result:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{
 &lt;span class=&quot;code-quote&quot;&gt;&quot;responseHeader&quot;&lt;/span&gt;:{
   &lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;:0,
   &lt;span class=&quot;code-quote&quot;&gt;&quot;QTime&quot;&lt;/span&gt;:7},
   &lt;span class=&quot;code-quote&quot;&gt;&quot;gettingstarted&quot;&lt;/span&gt;:{
     &lt;span class=&quot;code-quote&quot;&gt;&quot;stateFormat&quot;&lt;/span&gt;:2,
     &lt;span class=&quot;code-quote&quot;&gt;&quot;znodeVersion&quot;&lt;/span&gt;:15,
     &lt;span class=&quot;code-quote&quot;&gt;&quot;properties&quot;&lt;/span&gt;:{
        &lt;span class=&quot;code-quote&quot;&gt;&quot;autoAddReplicas&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;,
         &lt;span class=&quot;code-quote&quot;&gt;&quot;maxShardsPerNode&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;-1&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;nrtReplicas&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;pullReplicas&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;replicationFactor&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;router&quot;&lt;/span&gt;:\{&lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;compositeId&quot;&lt;/span&gt;},
        &lt;span class=&quot;code-quote&quot;&gt;&quot;tlogReplicas&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;},
        &lt;span class=&quot;code-quote&quot;&gt;&quot;activeShards&quot;&lt;/span&gt;:2,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;inactiveShards&quot;&lt;/span&gt;:0,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;schemaNonCompliant&quot;&lt;/span&gt;:[&lt;span class=&quot;code-quote&quot;&gt;&quot;(NONE)&quot;&lt;/span&gt;],
        &lt;span class=&quot;code-quote&quot;&gt;&quot;shards&quot;&lt;/span&gt;:{
           &lt;span class=&quot;code-quote&quot;&gt;&quot;shard1&quot;&lt;/span&gt;:{
           &lt;span class=&quot;code-quote&quot;&gt;&quot;state&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;active&quot;&lt;/span&gt;,
           &lt;span class=&quot;code-quote&quot;&gt;&quot;range&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;80000000-ffffffff&quot;&lt;/span&gt;,
           &lt;span class=&quot;code-quote&quot;&gt;&quot;replicas&quot;&lt;/span&gt;:{
               &lt;span class=&quot;code-quote&quot;&gt;&quot;total&quot;&lt;/span&gt;:2,
#####          &lt;span class=&quot;code-quote&quot;&gt;&quot;active&quot;&lt;/span&gt;:2,
#####          &lt;span class=&quot;code-quote&quot;&gt;&quot;down&quot;&lt;/span&gt;:0,
               &lt;span class=&quot;code-quote&quot;&gt;&quot;recovering&quot;&lt;/span&gt;:0,
              &lt;span class=&quot;code-quote&quot;&gt;&quot;recovery_failed&quot;&lt;/span&gt;:0},
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13265276">SOLR-13882</key>
            <summary>Collections API COLSTATUS does not check live_nodes when reporting replica&apos;s status</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ab">Andrzej Bialecki</assignee>
                                    <reporter username="erickerickson">Erick Erickson</reporter>
                        <labels>
                    </labels>
                <created>Wed, 30 Oct 2019 11:56:05 +0000</created>
                <updated>Tue, 21 Jan 2020 16:56:35 +0000</updated>
                            <resolved>Tue, 5 Nov 2019 13:25:39 +0000</resolved>
                                                    <fixVersion>8.4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16962984" author="erickerickson" created="Wed, 30 Oct 2019 12:30:40 +0000"  >&lt;p&gt;Actually, I didn&apos;t check specifically whether COLSTATUS checks live_nodes or not, but that&apos;s what I&apos;d bet. At any rate, when a node is forcefully killed, the command shows all replicas as &quot;active&quot;.&lt;/p&gt;</comment>
                            <comment id="16962997" author="erickerickson" created="Wed, 30 Oct 2019 12:52:59 +0000"  >&lt;p&gt;This fixes the problem, I only tested with a single manual test. Needs a test though, perhaps in &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;CollectionsAPISolrJTest.testColStatus&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;?&lt;/p&gt;

&lt;p&gt;I won&apos;t pursue this ATM, so anyone who wants to pick it up and add a test, please do.&lt;/p&gt;

&lt;p&gt;NOTE: the replicas will be reported as &quot;active&quot; for some time after the node is killed while waiting for Zookeeper to remove the entry from live_nodes.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ab&quot; class=&quot;user-hover&quot; rel=&quot;ab&quot;&gt;ab&lt;/a&gt;Doe reporting this state as &quot;down&quot; break anything you know of?&lt;/p&gt;

&lt;p&gt;For discussion: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Replica.isActive() and Replica.getState()&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; are trappy. It&apos;s perfectly reasonable to think &quot;If the replica says it&apos;s active, it must be&quot;. I&apos;ve spent time debugging this, here&apos;s another case where it&apos;s an issue, I&apos;ve seen this mentioned more than a few times on the dev and user&apos;s list.&lt;/p&gt;

&lt;p&gt;I know it&apos;d be changes to a number of places in the code, and there are some legitimate places where &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Replica.isActive()&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; &lt;em&gt;should&lt;/em&gt; return &quot;active&quot; when the node is &lt;em&gt;not&lt;/em&gt; in live_nodes. That said, what do people think about:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;changing at least these two methods to return &quot;down&quot; if the replica&apos;s node isn&apos;t in live_nodes&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;creating some &quot;expert&quot; level method to return what &lt;tt&gt;getState()&lt;/tt&gt; does now (i.e return &quot;active&quot; if the state is &quot;active&quot; but the node isn&apos;t in live_nodes) for those cases that need to make a distinction&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16967510" author="jira-bot" created="Tue, 5 Nov 2019 13:06:49 +0000"  >&lt;p&gt;Commit 720fb94113d0dca346c40857d26da50fc0e996e8 in lucene-solr&apos;s branch refs/heads/master from Andrzej Bialecki&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=720fb94&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=720fb94&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13882&quot; title=&quot;Collections API COLSTATUS does not check live_nodes when reporting replica&amp;#39;s status&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13882&quot;&gt;&lt;del&gt;SOLR-13882&lt;/del&gt;&lt;/a&gt;: Collections API COLSTATUS does not check live_nodes when reporting replica&apos;s status.&lt;/p&gt;</comment>
                            <comment id="16967525" author="jira-bot" created="Tue, 5 Nov 2019 13:24:37 +0000"  >&lt;p&gt;Commit 848529128f06a9643797786411b32c55aac55f5c in lucene-solr&apos;s branch refs/heads/branch_8x from Andrzej Bialecki&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=8485291&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=8485291&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13882&quot; title=&quot;Collections API COLSTATUS does not check live_nodes when reporting replica&amp;#39;s status&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13882&quot;&gt;&lt;del&gt;SOLR-13882&lt;/del&gt;&lt;/a&gt;: Collections API COLSTATUS does not check live_nodes when reporting replica&apos;s status.&lt;/p&gt;</comment>
                            <comment id="17004925" author="jpountz" created="Sun, 29 Dec 2019 20:49:45 +0000"  >&lt;p&gt;Closing after the 8.4.0 release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12984365" name="SOLR-13882.patch" size="716" author="erickerickson" created="Wed, 30 Oct 2019 12:50:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 46 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z083b4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>