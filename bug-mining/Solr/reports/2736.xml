<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:09:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-8318] SimpleQueryParser doesn&apos;t use MultiTermAnalysis for Fuzzy Queries</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8318</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Fuzzy queries in SimpleQParserPlugin don&apos;t seem to use the multi-term analysis chain. Prefix queries do, and SolrQueryParser does use multi-term analysis for fuzzy queries, so it seems like SimpleQParserPlugin should as well.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12914642">SOLR-8318</key>
            <summary>SimpleQueryParser doesn&apos;t use MultiTermAnalysis for Fuzzy Queries</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Trivial</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="erickerickson">Erick Erickson</assignee>
                                    <reporter username="tomsolr">Tom Hill</reporter>
                        <labels>
                    </labels>
                <created>Thu, 19 Nov 2015 22:25:43 +0000</created>
                <updated>Mon, 9 May 2016 18:58:26 +0000</updated>
                            <resolved>Mon, 7 Dec 2015 01:24:40 +0000</resolved>
                                    <version>5.3</version>
                                    <fixVersion>5.5</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>query parsers</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15014551" author="tomsolr" created="Thu, 19 Nov 2015 22:29:59 +0000"  >&lt;p&gt;In newPrefixQuery() in SimpleQParserPlugin, new queries are created like this&lt;/p&gt;

&lt;p&gt;          prefix = sf.getType().getPrefixQuery(qParser, sf, term);&lt;/p&gt;

&lt;p&gt;Which adds a rewrite method:&lt;/p&gt;

&lt;p&gt;    query.setRewriteMethod(sf.getType().getRewriteMethod(parser, sf));&lt;/p&gt;

&lt;p&gt;Is that relevant for fuzzy queries? Or can I just do:&lt;/p&gt;

&lt;p&gt;fuzzy = new FuzzyQuery(new Term(entry.getKey(), text), fuzziness);&lt;/p&gt;</comment>
                            <comment id="15029231" author="erickerickson" created="Thu, 26 Nov 2015 20:17:38 +0000"  >&lt;p&gt;Bah! Was on the wrong JIRA.&lt;/p&gt;</comment>
                            <comment id="15033939" author="erickerickson" created="Tue, 1 Dec 2015 16:00:15 +0000"  >&lt;p&gt;Hmmm, I&apos;m a bit puzzled here. The base class SimpleQueryParser already &lt;em&gt;has&lt;/em&gt; a newFuzzyQuery method that this patch overrides. I&apos;m out of my familiarity with the code, so my question is whether we should override this method in the plugin or is the real problem in the base class&apos; implementation of newFuzzyQuery?&lt;/p&gt;

&lt;p&gt;The tests in this patch certainly fail with the new overridden method commented out though.... I put some debugging in and the superclass&apos; method is never called in our regular tests so maybe this is really straight bug with SimpleQueryParser?&lt;/p&gt;</comment>
                            <comment id="15034150" author="tomsolr" created="Tue, 1 Dec 2015 17:37:16 +0000"  >&lt;p&gt;Right. The SimpleQueryParser has implementations of newFuzzyQuery and newPrefixQuery that just loop through the weights, and build a Boolean query.&lt;/p&gt;

&lt;p&gt;The existing implementation for SimpleQParser in SimpleQParserPlugin does override newPrefixQuery to use the multi-term analysis chain. It does not call the base class implementation. (the base class is basically a loop and a new. I looked at using a lambda to share a bit more code, but I found that more confusing).&lt;/p&gt;

&lt;p&gt;The problem I was trying to fix is that the existing implementation does not override newFuzzyQuery to use the muti-term analysis chain for fuzzy queries. So I basically duplicated what had been done for newPrefixQuery in SimpleQParser.&lt;/p&gt;
</comment>
                            <comment id="15034166" author="tomsolr" created="Tue, 1 Dec 2015 17:40:24 +0000"  >&lt;p&gt;To answer my Nov 19th comment:&lt;/p&gt;

&lt;p&gt;I don&apos;t think I need to do anything with setRewriteMethod for fuzzy queries. QueryParserBase has a newPrefixQuery() and a newFuzzyQuery(), and it does call setRewriteMethod in newPrefixQuery, but not in newFuzzyQuery.&lt;/p&gt;
</comment>
                            <comment id="15037191" author="erickerickson" created="Thu, 3 Dec 2015 03:35:36 +0000"  >&lt;p&gt;OK. LGTM then. I&apos;ll check this in in a day or so unless someone objects.&lt;/p&gt;</comment>
                            <comment id="15044182" author="erickerickson" created="Sun, 6 Dec 2015 22:41:06 +0000"  >&lt;p&gt;Patch with CHANGES.txt entry&lt;/p&gt;</comment>
                            <comment id="15044184" author="jira-bot" created="Sun, 6 Dec 2015 22:41:57 +0000"  >&lt;p&gt;Commit 1718233 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickoerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickoerickson&quot;&gt;erickoerickson&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1718233&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1718233&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8318&quot; title=&quot;SimpleQueryParser doesn&amp;#39;t use MultiTermAnalysis for Fuzzy Queries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8318&quot;&gt;&lt;del&gt;SOLR-8318&lt;/del&gt;&lt;/a&gt;: SimpleQueryParser doesn&apos;t use MultiTermAnalysis for Fuzzy Queries. Thanks Tom&lt;/p&gt;</comment>
                            <comment id="15044240" author="jira-bot" created="Mon, 7 Dec 2015 01:22:42 +0000"  >&lt;p&gt;Commit 1718236 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickoerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickoerickson&quot;&gt;erickoerickson&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1718236&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1718236&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8318&quot; title=&quot;SimpleQueryParser doesn&amp;#39;t use MultiTermAnalysis for Fuzzy Queries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8318&quot;&gt;&lt;del&gt;SOLR-8318&lt;/del&gt;&lt;/a&gt;: SimpleQueryParser doesn&apos;t use MultiTermAnalysis for Fuzzy Queries. Thanks Tom&lt;/p&gt;</comment>
                            <comment id="15044247" author="erickerickson" created="Mon, 7 Dec 2015 01:24:40 +0000"  >&lt;p&gt;Thanks Mr. Hill!&lt;/p&gt;</comment>
                            <comment id="15147490" author="ctargett" created="Mon, 15 Feb 2016 15:31:22 +0000"  >&lt;p&gt;Just FYI, the CHANGES.txt entry for this patch incorrectly references &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8313&quot; title=&quot;Migrate to new slf4j logging implementation (log4j 1.x is EOL)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8313&quot;&gt;&lt;del&gt;SOLR-8313&lt;/del&gt;&lt;/a&gt; instead of &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8318&quot; title=&quot;SimpleQueryParser doesn&amp;#39;t use MultiTermAnalysis for Fuzzy Queries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8318&quot;&gt;&lt;del&gt;SOLR-8318&lt;/del&gt;&lt;/a&gt;. The commit had the issue right, but CHANGES.txt does not.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12776010" name="SOLR-8318.patch" size="3735" author="erickerickson" created="Sun, 6 Dec 2015 22:41:06 +0000"/>
                            <attachment id="12773357" name="sqp_fuzzy_multiterm.patch" size="3804" author="tomsolr" created="Thu, 19 Nov 2015 22:36:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 40 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2oo3z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>