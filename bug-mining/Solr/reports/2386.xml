<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:03:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-7254] NullPointerException thrown in the QueryComponent</title>
                <link>https://issues.apache.org/jira/browse/SOLR-7254</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;In case of a distributed search, if we pass invalid query parameters (e.g. negative start value), then Solr returns internal server error (HTTP 500 response) due to following NullPointerException,&lt;/p&gt;

&lt;p&gt;{&lt;br/&gt;
  &quot;responseHeader&quot;:{&lt;br/&gt;
    &quot;status&quot;:500,&lt;br/&gt;
    &quot;QTime&quot;:6,&lt;br/&gt;
    &quot;params&quot;:{&lt;br/&gt;
      &quot;indent&quot;:&quot;true&quot;,&lt;br/&gt;
      &quot;start&quot;:&quot;-1&quot;,&lt;br/&gt;
      &quot;q&quot;:&quot;&lt;b&gt;:&lt;/b&gt;&quot;,&lt;br/&gt;
      &quot;wt&quot;:&quot;json&quot;}},&lt;br/&gt;
  &quot;error&quot;:{&lt;br/&gt;
    &quot;trace&quot;:&quot;java.lang.NullPointerException\n\tat org.apache.solr.handler.component.QueryComponent.mergeIds(QueryComponent.java:1031)\n\tat org.apache.solr.handler.component.QueryComponent.handleRegularResponses(QueryComponent.java:715)\n\tat org.apache.solr.handler.component.QueryComponent.handleResponses(QueryComponent.java:694)\n\tat org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:324)\n\tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:135)\n\tat org.apache.solr.core.SolrCore.execute(SolrCore.java:1984)\n\tat org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:818)\n\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:422)\n\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:211)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\n\tat org.apache.solr.servlet.SolrHadoopAuthenticationFilter$2.doFilter(SolrHadoopAuthenticationFilter.java:272)\n\tat org.apache.hadoop.security.authentication.server.AuthenticationFilter.doFilter(AuthenticationFilter.java:592)\n\tat org.apache.hadoop.security.token.delegation.web.DelegationTokenAuthenticationFilter.doFilter(DelegationTokenAuthenticationFilter.java:277)\n\tat org.apache.hadoop.security.authentication.server.AuthenticationFilter.doFilter(AuthenticationFilter.java:555)\n\tat org.apache.solr.servlet.SolrHadoopAuthenticationFilter.doFilter(SolrHadoopAuthenticationFilter.java:277)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\n\tat org.apache.solr.servlet.HostnameFilter.doFilter(HostnameFilter.java:86)\n\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)\n\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\n\tat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)\n\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)\n\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)\n\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:103)\n\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)\n\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:293)\n\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:861)\n\tat org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:606)\n\tat org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:489)\n\tat java.lang.Thread.run(Thread.java:745)\n&quot;,&lt;br/&gt;
    &quot;code&quot;:500}}&lt;/p&gt;

&lt;p&gt;The root cause of this error is that in case of a distributed query, input validation is missing.&lt;/p&gt;

&lt;p&gt;(Non distributed version)&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/lucene-solr/blob/817303840fce547a1557e330e93e5a8ac0618f34/solr/core/src/java/org/apache/solr/handler/component/QueryComponent.java#L284&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/817303840fce547a1557e330e93e5a8ac0618f34/solr/core/src/java/org/apache/solr/handler/component/QueryComponent.java#L284&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;(Distributed version)&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/lucene-solr/blob/817303840fce547a1557e330e93e5a8ac0618f34/solr/core/src/java/org/apache/solr/handler/component/QueryComponent.java#L691&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/817303840fce547a1557e330e93e5a8ac0618f34/solr/core/src/java/org/apache/solr/handler/component/QueryComponent.java#L691&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12782411">SOLR-7254</key>
            <summary>NullPointerException thrown in the QueryComponent</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="andyetitmoves">Ramkumar Aiyengar</assignee>
                                    <reporter username="hgadre">Hrishikesh Gadre</reporter>
                        <labels>
                    </labels>
                <created>Mon, 16 Mar 2015 23:22:24 +0000</created>
                <updated>Wed, 15 Apr 2015 00:30:47 +0000</updated>
                            <resolved>Tue, 24 Mar 2015 20:08:34 +0000</resolved>
                                    <version>4.10.3</version>
                                    <fixVersion>5.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="14369342" author="andyetitmoves" created="Thu, 19 Mar 2015 14:02:47 +0000"  >&lt;p&gt;Here&apos;s a patch to start things off. I haven&apos;t tested this as yet or added tests for this as yet. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hgadre&quot; class=&quot;user-hover&quot; rel=&quot;hgadre&quot;&gt;hgadre&lt;/a&gt;, if you can knock up some tests for this, that would be great, else I will probably get to it some time. You can start at &lt;tt&gt;TestDistributedSearch&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="14369765" author="hgadre" created="Thu, 19 Mar 2015 17:34:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=andyetitmoves&quot; class=&quot;user-hover&quot; rel=&quot;andyetitmoves&quot;&gt;andyetitmoves&lt;/a&gt; Yes I am working on the test. I will update ASAP&lt;/p&gt;</comment>
                            <comment id="14370143" author="hgadre" created="Thu, 19 Mar 2015 21:24:10 +0000"  >&lt;p&gt;Added a unit test for this scenario. (note I have commented out the test for rows parameter since it is not returning expected error).&lt;/p&gt;

&lt;p&gt;Also since this error is caused by bad parameters (rather than query syntax error), I think we should be throwing SolrException (with errorCode = BAD_REQUEST). Also is QParser the correct place for these validations or should it be in QueryComponent#prepare(...) method ?&lt;/p&gt;</comment>
                            <comment id="14370156" author="yseeley@gmail.com" created="Thu, 19 Mar 2015 21:30:35 +0000"  >&lt;blockquote&gt;&lt;p&gt;Also is QParser the correct place for these validations or should it be in QueryComponent#prepare(...) method ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1, Query component feels like the more natural place.&lt;/p&gt;</comment>
                            <comment id="14370172" author="hgadre" created="Thu, 19 Mar 2015 21:37:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=andyetitmoves&quot; class=&quot;user-hover&quot; rel=&quot;andyetitmoves&quot;&gt;andyetitmoves&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yseeley%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;yseeley@gmail.com&quot;&gt;yseeley@gmail.com&lt;/a&gt; There few additional validations in QueryComponent#process method. e.g.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/lucene-solr/blob/trunk/solr/core/src/java/org/apache/solr/handler/component/QueryComponent.java#L314&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/trunk/solr/core/src/java/org/apache/solr/handler/component/QueryComponent.java#L314&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This validation does not get invoked in case of distributed search. Is this by design? If not, may be this should also go in the common validation code...&lt;/p&gt;</comment>
                            <comment id="14370199" author="andyetitmoves" created="Thu, 19 Mar 2015 21:53:39 +0000"  >&lt;p&gt;Actually I am not sure myself if QParser should be constructing the SortSpec object from request params &amp;#8211; may be that should as such move elsewhere. But it makes sense to validate this at the time the object is created from URL params (which is where my changes currently are) than after the object is created?&lt;/p&gt;</comment>
                            <comment id="14376565" author="hgadre" created="Mon, 23 Mar 2015 20:24:03 +0000"  >&lt;p&gt;Following changes made to the patch&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt; Removed redundant validation check in QueryComponent#process&lt;br/&gt;
&amp;gt;&amp;gt; Fixed a unit test failure.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=andyetitmoves&quot; class=&quot;user-hover&quot; rel=&quot;andyetitmoves&quot;&gt;andyetitmoves&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt; Should we commit this change and tackle the (possible) refactoring (from QueryParser to QueryComponent) as part of a different JIRA?&lt;/p&gt;</comment>
                            <comment id="14376654" author="yseeley@gmail.com" created="Mon, 23 Mar 2015 21:17:23 +0000"  >&lt;p&gt;The current patch causes TestGroupingSearch to fail.&lt;br/&gt;
I haven&apos;t had a chance to look into whether this is just a bad test, or if grouping search actually supports &quot;-1&quot; as a valid value.&lt;/p&gt;</comment>
                            <comment id="14376673" author="yseeley@gmail.com" created="Mon, 23 Mar 2015 21:23:19 +0000"  >&lt;p&gt;OK, I confirmed through experimentation that grouped search does support &quot;-1&quot; to mean &quot;all groups&quot;.  This means that the parsing of SortSpec does not have enough context to throw an exception, and it needs to be in QueryComponent (or some place that does have that context).&lt;/p&gt;

&lt;p&gt;FWIW, I&apos;ve planned to support &quot;rows=-1&quot; to mean &quot;all rows&quot; for normal queries as well... just never got around to it.&lt;/p&gt;</comment>
                            <comment id="14376781" author="hgadre" created="Mon, 23 Mar 2015 22:27:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt; Yes you are right. As per the SortSpec documentation, rows = -1 is acceptable (Check SortSpec#getCount() method docs). Following changes are made to the patch,&lt;br/&gt;
&amp;gt;&amp;gt; Removed check for rows = -1 along with the unit test&lt;br/&gt;
&amp;gt;&amp;gt; Refactored the validation code to QueryComponent#prepare method (instead of QParser).&lt;/p&gt;

&lt;p&gt;Please take a look.&lt;/p&gt;</comment>
                            <comment id="14376831" author="yseeley@gmail.com" created="Mon, 23 Mar 2015 22:47:41 +0000"  >&lt;p&gt;Seems like the last patch is missing the tests that were in the previous patch?&lt;/p&gt;</comment>
                            <comment id="14376905" author="hgadre" created="Mon, 23 Mar 2015 23:30:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt; OK. I updated the patch to check for rows = -1 in case of non-groupings search&lt;/p&gt;</comment>
                            <comment id="14376927" author="yseeley@gmail.com" created="Mon, 23 Mar 2015 23:44:02 +0000"  >&lt;blockquote&gt;&lt;p&gt;As per the SortSpec documentation, rows = -1 is acceptable&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Looks like rows=-1 for a non grouped search just acts like rows=0 right now.&lt;br/&gt;
I guess we can leave that alone though, and just tackle the start=-1 issue.&lt;/p&gt;</comment>
                            <comment id="14376945" author="yseeley@gmail.com" created="Mon, 23 Mar 2015 23:58:32 +0000"  >&lt;blockquote&gt;&lt;p&gt;I updated the patch to check for rows = -1 in case of non-groupings search&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Crossed comments (I didn&apos;t refresh JIRA before I posted).  This should be fine too.&lt;/p&gt;</comment>
                            <comment id="14378480" author="jira-bot" created="Tue, 24 Mar 2015 20:05:24 +0000"  >&lt;p&gt;Commit 1668976 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1668976&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1668976&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7254&quot; title=&quot;NullPointerException thrown in the QueryComponent&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7254&quot;&gt;&lt;del&gt;SOLR-7254&lt;/del&gt;&lt;/a&gt;: invalid start/rows should throw 400 rather than 500 error code&lt;/p&gt;</comment>
                            <comment id="14378486" author="jira-bot" created="Tue, 24 Mar 2015 20:08:04 +0000"  >&lt;p&gt;Commit 1668978 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1668978&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1668978&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7254&quot; title=&quot;NullPointerException thrown in the QueryComponent&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7254&quot;&gt;&lt;del&gt;SOLR-7254&lt;/del&gt;&lt;/a&gt;: invalid start/rows should throw 400 rather than 500 error code&lt;/p&gt;</comment>
                            <comment id="14378747" author="andyetitmoves" created="Tue, 24 Mar 2015 22:03:29 +0000"  >&lt;p&gt;Thanks for getting to this Yonik..&lt;/p&gt;</comment>
                            <comment id="14495361" author="thelabdude" created="Wed, 15 Apr 2015 00:30:47 +0000"  >&lt;p&gt;Bulk close after 5.1 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12706759" name="SOLR-7254.patch" size="4042" author="hgadre" created="Mon, 23 Mar 2015 23:30:17 +0000"/>
                            <attachment id="12706737" name="SOLR-7254.patch" size="3558" author="hgadre" created="Mon, 23 Mar 2015 22:27:16 +0000"/>
                            <attachment id="12706712" name="SOLR-7254.patch" size="5644" author="hgadre" created="Mon, 23 Mar 2015 20:24:03 +0000"/>
                            <attachment id="12705716" name="SOLR-7254.patch" size="4877" author="hgadre" created="Thu, 19 Mar 2015 21:24:10 +0000"/>
                            <attachment id="12705595" name="SOLR-7254.patch" size="1979" author="andyetitmoves" created="Thu, 19 Mar 2015 14:02:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 32 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i26uaf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>