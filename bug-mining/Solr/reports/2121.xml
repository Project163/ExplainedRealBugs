<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:57:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-6592] Re-try loop in the ZkController.waitForLeaderToSeeDownState method hangs unit test when leader is gone</title>
                <link>https://issues.apache.org/jira/browse/SOLR-6592</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;HttpPartitionTest is failing due to a ThreadLeakError, which I believe is because the re-try loop in ZkController.waitForLeaderToSeeDownState is coded to take upwards of 12 minutes to fail (2 minutes socket timeout, 6 max retries). The code should be improved to stop trying if the leader is gone, which seems to be the case here (maybe). At the very least, need to figure out how to avoid this ThreadLeakError.&lt;/p&gt;

&lt;p&gt;Build: &lt;a href=&quot;http://jenkins.thetaphi.de/job/Lucene-Solr-5.x-Linux/11234/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jenkins.thetaphi.de/job/Lucene-Solr-5.x-Linux/11234/&lt;/a&gt;&lt;br/&gt;
Java: 64bit/jdk1.8.0_40-ea-b04 -XX:+UseCompressedOops -XX:+UseG1GC&lt;/p&gt;

&lt;p&gt;2 tests failed.&lt;br/&gt;
FAILED:  junit.framework.TestSuite.org.apache.solr.cloud.HttpPartitionTest&lt;/p&gt;

&lt;p&gt;Error Message:&lt;br/&gt;
1 thread leaked from SUITE scope at org.apache.solr.cloud.HttpPartitionTest:     1) Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;id=8655, name=Thread-2764, state=RUNNABLE, group=TGRP-HttpPartitionTest&amp;#93;&lt;/span&gt;         at java.net.SocketInputStream.socketRead0(Native Method)         at java.net.SocketInputStream.socketRead(SocketInputStream.java:116)         at java.net.SocketInputStream.read(SocketInputStream.java:170)         at java.net.SocketInputStream.read(SocketInputStream.java:141)         at org.apache.http.impl.io.AbstractSessionInputBuffer.fillBuffer(AbstractSessionInputBuffer.java:160)         at org.apache.http.impl.io.SocketInputBuffer.fillBuffer(SocketInputBuffer.java:84)         at org.apache.http.impl.io.AbstractSessionInputBuffer.readLine(AbstractSessionInputBuffer.java:273)         at org.apache.http.impl.conn.DefaultHttpResponseParser.parseHead(DefaultHttpResponseParser.java:140)         at org.apache.http.impl.conn.DefaultHttpResponseParser.parseHead(DefaultHttpResponseParser.java:57)         at org.apache.http.impl.io.AbstractMessageParser.parse(AbstractMessageParser.java:260)         at org.apache.http.impl.AbstractHttpClientConnection.receiveResponseHeader(AbstractHttpClientConnection.java:283)         at org.apache.http.impl.conn.DefaultClientConnection.receiveResponseHeader(DefaultClientConnection.java:251)         at org.apache.http.impl.conn.ManagedClientConnectionImpl.receiveResponseHeader(ManagedClientConnectionImpl.java:197)         at org.apache.http.protocol.HttpRequestExecutor.doReceiveResponse(HttpRequestExecutor.java:271)         at org.apache.http.protocol.HttpRequestExecutor.execute(HttpRequestExecutor.java:123)         at org.apache.http.impl.client.DefaultRequestDirector.tryExecute(DefaultRequestDirector.java:682)         at org.apache.http.impl.client.DefaultRequestDirector.execute(DefaultRequestDirector.java:486)         at org.apache.http.impl.client.AbstractHttpClient.doExecute(AbstractHttpClient.java:863)         at org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:82)         at org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:106)         at org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:57)         at org.apache.solr.client.solrj.impl.HttpSolrServer.executeMethod(HttpSolrServer.java:466)         at org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:215)         at org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:211)         at org.apache.solr.cloud.ZkController.waitForLeaderToSeeDownState(ZkController.java:1623)         at org.apache.solr.cloud.ZkController.registerAllCoresAsDown(ZkController.java:422)         at org.apache.solr.cloud.ZkController.access$100(ZkController.java:93)         at org.apache.solr.cloud.ZkController$1.command(ZkController.java:261)         at org.apache.solr.common.cloud.ConnectionManager$1$1.run(ConnectionManager.java:166)&lt;/p&gt;

&lt;p&gt;Stack Trace:&lt;br/&gt;
com.carrotsearch.randomizedtesting.ThreadLeakError: 1 thread leaked from SUITE scope at org.apache.solr.cloud.HttpPartitionTest:&lt;br/&gt;
   1) Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;id=8655, name=Thread-2764, state=RUNNABLE, group=TGRP-HttpPartitionTest&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.net.SocketInputStream.socketRead0(Native Method)&lt;br/&gt;
        at java.net.SocketInputStream.socketRead(SocketInputStream.java:116)&lt;br/&gt;
        at java.net.SocketInputStream.read(SocketInputStream.java:170)&lt;br/&gt;
        at java.net.SocketInputStream.read(SocketInputStream.java:141)&lt;br/&gt;
        at org.apache.http.impl.io.AbstractSessionInputBuffer.fillBuffer(AbstractSessionInputBuffer.java:160)&lt;br/&gt;
        at org.apache.http.impl.io.SocketInputBuffer.fillBuffer(SocketInputBuffer.java:84)&lt;br/&gt;
        at org.apache.http.impl.io.AbstractSessionInputBuffer.readLine(AbstractSessionInputBuffer.java:273)&lt;br/&gt;
        at org.apache.http.impl.conn.DefaultHttpResponseParser.parseHead(DefaultHttpResponseParser.java:140)&lt;br/&gt;
        at org.apache.http.impl.conn.DefaultHttpResponseParser.parseHead(DefaultHttpResponseParser.java:57)&lt;br/&gt;
        at org.apache.http.impl.io.AbstractMessageParser.parse(AbstractMessageParser.java:260)&lt;br/&gt;
        at org.apache.http.impl.AbstractHttpClientConnection.receiveResponseHeader(AbstractHttpClientConnection.java:283)&lt;br/&gt;
        at org.apache.http.impl.conn.DefaultClientConnection.receiveResponseHeader(DefaultClientConnection.java:251)&lt;br/&gt;
        at org.apache.http.impl.conn.ManagedClientConnectionImpl.receiveResponseHeader(ManagedClientConnectionImpl.java:197)&lt;br/&gt;
        at org.apache.http.protocol.HttpRequestExecutor.doReceiveResponse(HttpRequestExecutor.java:271)&lt;br/&gt;
        at org.apache.http.protocol.HttpRequestExecutor.execute(HttpRequestExecutor.java:123)&lt;br/&gt;
        at org.apache.http.impl.client.DefaultRequestDirector.tryExecute(DefaultRequestDirector.java:682)&lt;br/&gt;
        at org.apache.http.impl.client.DefaultRequestDirector.execute(DefaultRequestDirector.java:486)&lt;br/&gt;
        at org.apache.http.impl.client.AbstractHttpClient.doExecute(AbstractHttpClient.java:863)&lt;br/&gt;
        at org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:82)&lt;br/&gt;
        at org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:106)&lt;br/&gt;
        at org.apache.http.impl.client.CloseableHttpClient.execute(CloseableHttpClient.java:57)&lt;br/&gt;
        at org.apache.solr.client.solrj.impl.HttpSolrServer.executeMethod(HttpSolrServer.java:466)&lt;br/&gt;
        at org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:215)&lt;br/&gt;
        at org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:211)&lt;br/&gt;
        at org.apache.solr.cloud.ZkController.waitForLeaderToSeeDownState(ZkController.java:1623)&lt;br/&gt;
        at org.apache.solr.cloud.ZkController.registerAllCoresAsDown(ZkController.java:422)&lt;br/&gt;
        at org.apache.solr.cloud.ZkController.access$100(ZkController.java:93)&lt;br/&gt;
        at org.apache.solr.cloud.ZkController$1.command(ZkController.java:261)&lt;br/&gt;
        at org.apache.solr.common.cloud.ConnectionManager$1$1.run(ConnectionManager.java:166)&lt;br/&gt;
        at __randomizedtesting.SeedInfo.seed(&lt;span class=&quot;error&quot;&gt;&amp;#91;BE8A2D1EED13DDED&amp;#93;&lt;/span&gt;:0)&lt;/p&gt;


&lt;p&gt;FAILED:  junit.framework.TestSuite.org.apache.solr.cloud.HttpPartitionTest&lt;/p&gt;</description>
                <environment></environment>
        <key id="12746160">SOLR-6592</key>
            <summary>Re-try loop in the ZkController.waitForLeaderToSeeDownState method hangs unit test when leader is gone</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thelabdude">Timothy Potter</assignee>
                                    <reporter username="thelabdude">Timothy Potter</reporter>
                        <labels>
                    </labels>
                <created>Mon, 6 Oct 2014 15:06:56 +0000</created>
                <updated>Mon, 23 Feb 2015 05:02:31 +0000</updated>
                            <resolved>Mon, 13 Oct 2014 20:10:08 +0000</resolved>
                                                    <fixVersion>5.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14160543" author="thelabdude" created="Mon, 6 Oct 2014 17:29:03 +0000"  >&lt;p&gt;Here&apos;s a patch that checks to see if the leader node is live after receiving an IO error and if the leader is not live, it throws an exception instead of re-trying another pass through the loop. This may be too aggressive but my thinking is there&apos;s no need to wait for the leader to see the down state if it&apos;s not live right? &lt;/p&gt;</comment>
                            <comment id="14160553" author="markrmiller@gmail.com" created="Mon, 6 Oct 2014 17:34:52 +0000"  >&lt;p&gt;It should be fine. At worst, the cluster state is a bit stale and it throws that exception when the node is live (in some crazy scenario), but even then the replica recovery will just attempt again.&lt;/p&gt;</comment>
                            <comment id="14160559" author="thelabdude" created="Mon, 6 Oct 2014 17:38:57 +0000"  >&lt;p&gt;Thanks Mark - hopefully this will resolve the weird failures of the HttpPartitionTest on Jenkins!&lt;/p&gt;</comment>
                            <comment id="14160572" author="jira-bot" created="Mon, 6 Oct 2014 17:50:01 +0000"  >&lt;p&gt;Commit 1629719 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thelabdude&quot; class=&quot;user-hover&quot; rel=&quot;thelabdude&quot;&gt;thelabdude&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1629719&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1629719&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6592&quot; title=&quot;Re-try loop in the ZkController.waitForLeaderToSeeDownState method hangs unit test when leader is gone&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6592&quot;&gt;&lt;del&gt;SOLR-6592&lt;/del&gt;&lt;/a&gt;: Avoid waiting for the leader to see the down state if that leader is not live.&lt;/p&gt;</comment>
                            <comment id="14169425" author="jira-bot" created="Mon, 13 Oct 2014 15:48:45 +0000"  >&lt;p&gt;Commit 1631442 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thelabdude&quot; class=&quot;user-hover&quot; rel=&quot;thelabdude&quot;&gt;thelabdude&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1631442&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1631442&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6592&quot; title=&quot;Re-try loop in the ZkController.waitForLeaderToSeeDownState method hangs unit test when leader is gone&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6592&quot;&gt;&lt;del&gt;SOLR-6592&lt;/del&gt;&lt;/a&gt;: Avoid waiting for the leader to see the down state if that leader is not live.&lt;/p&gt;</comment>
                            <comment id="14169498" author="jira-bot" created="Mon, 13 Oct 2014 16:38:50 +0000"  >&lt;p&gt;Commit 1631462 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thelabdude&quot; class=&quot;user-hover&quot; rel=&quot;thelabdude&quot;&gt;thelabdude&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1631462&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1631462&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6592&quot; title=&quot;Re-try loop in the ZkController.waitForLeaderToSeeDownState method hangs unit test when leader is gone&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6592&quot;&gt;&lt;del&gt;SOLR-6592&lt;/del&gt;&lt;/a&gt;: add mention in solr/CHANGES.txt&lt;/p&gt;</comment>
                            <comment id="14169503" author="jira-bot" created="Mon, 13 Oct 2014 16:40:29 +0000"  >&lt;p&gt;Commit 1631464 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thelabdude&quot; class=&quot;user-hover&quot; rel=&quot;thelabdude&quot;&gt;thelabdude&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1631464&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1631464&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6592&quot; title=&quot;Re-try loop in the ZkController.waitForLeaderToSeeDownState method hangs unit test when leader is gone&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6592&quot;&gt;&lt;del&gt;SOLR-6592&lt;/del&gt;&lt;/a&gt;: add mention in solr/CHANGES.txt&lt;/p&gt;</comment>
                            <comment id="14169515" author="jira-bot" created="Mon, 13 Oct 2014 16:44:36 +0000"  >&lt;p&gt;Commit 1631467 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thelabdude&quot; class=&quot;user-hover&quot; rel=&quot;thelabdude&quot;&gt;thelabdude&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1631467&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1631467&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6592&quot; title=&quot;Re-try loop in the ZkController.waitForLeaderToSeeDownState method hangs unit test when leader is gone&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6592&quot;&gt;&lt;del&gt;SOLR-6592&lt;/del&gt;&lt;/a&gt;: add mention in solr/CHANGES.txt&lt;/p&gt;</comment>
                            <comment id="14332902" author="anshumg" created="Mon, 23 Feb 2015 05:02:31 +0000"  >&lt;p&gt;Bulk close after 5.0 release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12673132" name="SOLR-6592.patch" size="3808" author="thelabdude" created="Mon, 6 Oct 2014 17:29:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 39 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i20ubz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>