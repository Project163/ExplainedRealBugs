<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:50:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-13044] IndexFetcher.openNewSearcherAndUpdateCommitPoint can throw NPE on null SolrCore</title>
                <link>https://issues.apache.org/jira/browse/SOLR-13044</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;While working through the logs in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13031&quot; title=&quot;Harden ChaosMonkeySafeLeaderWithPullReplicasTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13031&quot;&gt;SOLR-13031&lt;/a&gt;, i observed the following...&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  [beaster]   2&amp;gt; 57230 ERROR (indexFetcher-193-thread-1) [    ] o.a.s.h.ReplicationHandler Index fetch failed :org.apache.solr.common.SolrException: Index fetch failed : 
  [beaster]   2&amp;gt;        at org.apache.solr.handler.IndexFetcher.fetchLatestIndex(IndexFetcher.java:676)
  [beaster]   2&amp;gt;        at org.apache.solr.handler.IndexFetcher.fetchLatestIndex(IndexFetcher.java:346)
  [beaster]   2&amp;gt;        at org.apache.solr.handler.ReplicationHandler.doFetch(ReplicationHandler.java:424)
  [beaster]   2&amp;gt;        at org.apache.solr.handler.ReplicationHandler.lambda$setupPolling$13(ReplicationHandler.java:1184)
  [beaster]   2&amp;gt;        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
  [beaster]   2&amp;gt;        at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308)
  [beaster]   2&amp;gt;        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180)
  [beaster]   2&amp;gt;        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294)
  [beaster]   2&amp;gt;        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
  [beaster]   2&amp;gt;        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
  [beaster]   2&amp;gt;        at java.lang.Thread.run(Thread.java:748)
  [beaster]   2&amp;gt; Caused by: java.lang.NullPointerException
  [beaster]   2&amp;gt;        at org.apache.solr.handler.IndexFetcher.openNewSearcherAndUpdateCommitPoint(IndexFetcher.java:909)
  [beaster]   2&amp;gt;        at org.apache.solr.handler.IndexFetcher.fetchLatestIndex(IndexFetcher.java:653)
  [beaster]   2&amp;gt;        ... 10 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Which comes from this bit of code...&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-comment&quot;&gt;// must get the latest solrCore object because the one we have might be closed because of a reload
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// todo stop keeping solrCore around
&lt;/span&gt;    SolrCore core = solrCore.getCoreContainer().getCore(solrCore.getName());
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
      Future[] waitSearcher = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Future[1];
      searcher = core.getSearcher(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, waitSearcher, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (waitSearcher[0] != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
          waitSearcher[0].get();
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException | ExecutionException e) {
          SolrException.log(log, e);
        }
      }
      commitPoint = searcher.get().getIndexReader().getIndexCommit();
    } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (searcher != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        searcher.decref();
      }
      core.close(); &lt;span class=&quot;code-comment&quot;&gt;// IndexFetcher.java:909 where NPE is being thrown
&lt;/span&gt;    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;IIUC: openNewSearcherAndUpdateCommitPoint isn&apos;t accounting for the possibility that the the IndexFetcher is getting run before the SolrCore has been fully initialized and regsitere with the CoreContainer and/or after/while the SolrCore (and/or CoreContainer) is in the process of being closed, and isn&apos;t available from &lt;tt&gt;solrCore.getCoreContainer().getCore(String)&lt;/tt&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13202664">SOLR-13044</key>
            <summary>IndexFetcher.openNewSearcherAndUpdateCommitPoint can throw NPE on null SolrCore</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dsmiley">David Smiley</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Thu, 6 Dec 2018 00:06:10 +0000</created>
                <updated>Tue, 10 Jan 2023 20:45:24 +0000</updated>
                            <resolved>Wed, 27 Apr 2022 16:30:34 +0000</resolved>
                                                    <fixVersion>9.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="8400">2h 20m</timespent>
                                <comments>
                            <comment id="16710778" author="hossman" created="Thu, 6 Dec 2018 00:07:21 +0000"  >&lt;p&gt;I&apos;m not sure what the &quot;correct&quot; behavior is in this situation where the SolrCore is not available ... do nothing? throw an Exception?&lt;/p&gt;</comment>
                            <comment id="17518581" author="dsmiley" created="Thu, 7 Apr 2022 04:40:23 +0000"  >&lt;p&gt;I think the right thing to do is simply do nothing. &lt;a href=&quot;https://github.com/apache/solr/pull/794&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/solr/pull/794&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17519091" author="hossman" created="Thu, 7 Apr 2022 18:42:53 +0000"  >&lt;p&gt;I only vaguely remember this issue, but yeah, &quot;do nothing&quot; is probably fine.&lt;/p&gt;

&lt;p&gt;Have you by any chance been able to reliably reproduce &amp;amp; test this fix in the &quot;core is closing&quot; situation?&lt;/p&gt;

&lt;p&gt;I&apos;m wondering if &quot;do nothing&quot; here just kicks the can down the road and causes the caller(s) of this method to get a similar failure somewhere else (or worse: start making some on disk changes that fail part way through)&lt;/p&gt;</comment>
                            <comment id="17519177" author="dsmiley" created="Thu, 7 Apr 2022 21:32:17 +0000"  >&lt;p&gt;I merely observed it in a test where it was clear based on logs that the core was closing.  I hear you on &quot;kick the can&quot; &amp;#8211; so I looked a bit to see who calls it and what happens and there isn&apos;t an obvious follow-on error that might happen but who knows.  I&apos;d rather merge this as progress not perfection.  If one of us sees some further ramifications then we&apos;ll deal with that if/when there is more to do.&lt;/p&gt;</comment>
                            <comment id="17519178" author="hossman" created="Thu, 7 Apr 2022 21:34:03 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="17524702" author="jira-bot" created="Wed, 20 Apr 2022 04:13:21 +0000"  >&lt;p&gt;Commit 61df03f2f48985a7ba1c5754aaed6315a6a498e7 in solr&apos;s branch refs/heads/main from David Smiley&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=61df03f2f48&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=61df03f2f48&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13044&quot; title=&quot;IndexFetcher.openNewSearcherAndUpdateCommitPoint can throw NPE on null SolrCore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13044&quot;&gt;&lt;del&gt;SOLR-13044&lt;/del&gt;&lt;/a&gt;: Fix NPE in IndexFetcher.openNewSearcherAndUpdateCommitPoint (#794)&lt;/p&gt;

&lt;p&gt;Core might be closing.&lt;/p&gt;</comment>
                            <comment id="17524706" author="jira-bot" created="Wed, 20 Apr 2022 04:15:18 +0000"  >&lt;p&gt;Commit 6d05702bb55a97f0bec053dc4fdf8ae8286abd87 in solr&apos;s branch refs/heads/branch_9x from David Smiley&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=6d05702bb55&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=6d05702bb55&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13044&quot; title=&quot;IndexFetcher.openNewSearcherAndUpdateCommitPoint can throw NPE on null SolrCore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13044&quot;&gt;&lt;del&gt;SOLR-13044&lt;/del&gt;&lt;/a&gt;: Fix NPE in IndexFetcher.openNewSearcherAndUpdateCommitPoint (#794)&lt;/p&gt;

&lt;p&gt;Core might be closing.&lt;/p&gt;</comment>
                            <comment id="17526672" author="jira-bot" created="Fri, 22 Apr 2022 20:39:56 +0000"  >&lt;p&gt;Commit 760efed45321f197da86c353a51c5d48bc0a3a6e in solr&apos;s branch refs/heads/branch_9x from David Smiley&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=760efed4532&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=760efed4532&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13044&quot; title=&quot;IndexFetcher.openNewSearcherAndUpdateCommitPoint can throw NPE on null SolrCore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13044&quot;&gt;&lt;del&gt;SOLR-13044&lt;/del&gt;&lt;/a&gt;: fix searcher/core close sequence (#815)&lt;/p&gt;
</comment>
                            <comment id="17656804" author="ishan" created="Tue, 10 Jan 2023 20:45:24 +0000"  >&lt;p&gt;Bulk closing 9.1 issues.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13201801">SOLR-13031</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 44 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|s017vc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>