<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:56:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-6402] OverseerCollectionProcessor should not exit for ZK ConnectionLoss</title>
                <link>https://issues.apache.org/jira/browse/SOLR-6402</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;We saw an occurrence where we had some ZK connection blip and the OverseerCollectionProcessor thread stopped but the ClusterStateUpdater output some error but kept running, and the node didn&apos;t lose its leadership. this caused our collection work queue to back up.&lt;/p&gt;

&lt;p&gt;Right now OverseerCollectionProcessor&apos;s run method has on trunk:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;344           if (e.code() == KeeperException.Code.SESSIONEXPIRED&lt;br/&gt;
345	              || e.code() == KeeperException.Code.CONNECTIONLOSS) {&lt;br/&gt;
346	            log.warn(&quot;Overseer cannot talk to ZK&quot;);&lt;br/&gt;
347	            return;&lt;br/&gt;
348	          }&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think this if statement should only be for SESSIONEXPIRED. If it just experiences a connection loss but then reconnect before the session expired, it&apos;ll keep being the leader.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12735957">SOLR-6402</key>
            <summary>OverseerCollectionProcessor should not exit for ZK ConnectionLoss</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="markrmiller@gmail.com">Mark Miller</assignee>
                                    <reporter username="mewmewball">Jessica Cheng Mallet</reporter>
                        <labels>
                    </labels>
                <created>Fri, 22 Aug 2014 00:42:12 +0000</created>
                <updated>Mon, 9 May 2016 18:48:16 +0000</updated>
                            <resolved>Sun, 24 Aug 2014 13:46:29 +0000</resolved>
                                    <version>4.8</version>
                    <version>6.0</version>
                                    <fixVersion>4.10</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>SolrCloud</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14106275" author="markrmiller@gmail.com" created="Fri, 22 Aug 2014 01:04:34 +0000"  >&lt;p&gt;Indeed!&lt;/p&gt;</comment>
                            <comment id="14106280" author="markrmiller@gmail.com" created="Fri, 22 Aug 2014 01:09:34 +0000"  >&lt;p&gt;Any chance you have a stack trace or something?&lt;/p&gt;

&lt;p&gt;What surprises me is that commands should be retried passed expiration - that takes a bit of guesswork and padding, but I&apos;m surprised a connectionloss leaked out that didn&apos;t lead to an expiration.&lt;/p&gt;</comment>
                            <comment id="14106290" author="jira-bot" created="Fri, 22 Aug 2014 01:20:19 +0000"  >&lt;p&gt;Commit 1619641 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1619641&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1619641&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6402&quot; title=&quot;OverseerCollectionProcessor should not exit for ZK ConnectionLoss&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6402&quot;&gt;&lt;del&gt;SOLR-6402&lt;/del&gt;&lt;/a&gt;: OverseerCollectionProcessor should not exit for ZooKeeper ConnectionLoss.&lt;/p&gt;</comment>
                            <comment id="14106293" author="jira-bot" created="Fri, 22 Aug 2014 01:22:22 +0000"  >&lt;p&gt;Commit 1619643 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; in branch &apos;dev/branches/branch_4x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1619643&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1619643&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6402&quot; title=&quot;OverseerCollectionProcessor should not exit for ZK ConnectionLoss&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6402&quot;&gt;&lt;del&gt;SOLR-6402&lt;/del&gt;&lt;/a&gt;: OverseerCollectionProcessor should not exit for ZooKeeper ConnectionLoss.&lt;/p&gt;</comment>
                            <comment id="14106303" author="jira-bot" created="Fri, 22 Aug 2014 01:28:06 +0000"  >&lt;p&gt;Commit 1619645 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; in branch &apos;dev/branches/lucene_solr_4_10&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1619645&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1619645&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6402&quot; title=&quot;OverseerCollectionProcessor should not exit for ZK ConnectionLoss&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6402&quot;&gt;&lt;del&gt;SOLR-6402&lt;/del&gt;&lt;/a&gt;: OverseerCollectionProcessor should not exit for ZooKeeper ConnectionLoss.&lt;/p&gt;</comment>
                            <comment id="14106324" author="mewmewball" created="Fri, 22 Aug 2014 01:43:40 +0000"  >&lt;p&gt;Unfortunately since it just logs and return, I just have the log line&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;2014-08-21 10:51:39,060 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;Overseer-164353762238923913-&amp;lt;scrubbed IP&amp;gt;:8983_solr-n_0000000757&amp;#93;&lt;/span&gt; OverseerCollectionProcessor.java (line 350) Overseer cannot talk to ZK&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Unfortunately, even though amILeader() tries to handle connection loss, there are lots of other operations past the if check that don&apos;t. E.g. all those workqueue manipulations.&lt;/p&gt;</comment>
                            <comment id="14106325" author="mewmewball" created="Fri, 22 Aug 2014 01:43:50 +0000"  >&lt;p&gt;And thanks for fixing! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14106365" author="markrmiller@gmail.com" created="Fri, 22 Aug 2014 02:17:43 +0000"  >&lt;blockquote&gt;&lt;p&gt;there are lots of other operations past the if check that don&apos;t. E.g. all those workqueue manipulations.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That should not be the case. All ZK manipulation should be through SolrZkClient, which should use ZkCmdExecutor to retry on connection loss passed expiration unless explicitly asked not to.&lt;/p&gt;</comment>
                            <comment id="14106378" author="anshumg" created="Fri, 22 Aug 2014 02:41:58 +0000"  >&lt;blockquote&gt;&lt;p&gt;All ZK manipulation should be through SolrZkClient, which should use ZkCmdExecutor&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;AFAIR, that&apos;s the case.&lt;/p&gt;</comment>
                            <comment id="14106433" author="mewmewball" created="Fri, 22 Aug 2014 04:04:00 +0000"  >&lt;blockquote&gt;
&lt;p&gt;All ZK manipulation should be through SolrZkClient, which should use ZkCmdExecutor to retry on connection loss passed expiration unless explicitly asked not to.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Ah, I missed that.&lt;/p&gt;

&lt;p&gt;So I took a look at ZkCmdExecutor.retryOperation(), we have this effect (for the default of 15s timeout and therefore retryCount=5):&lt;br/&gt;
i     sleep&lt;br/&gt;
0    0s&lt;br/&gt;
1    1.5s&lt;br/&gt;
2    3s&lt;br/&gt;
3    4.5s&lt;br/&gt;
4    6s&lt;/p&gt;

&lt;p&gt;which adds up to 15s, the timeout. However, what if on loop i=4, the operation threw connection loss again, but then since the sleep is at the end of the catch block, while it slept the last time for 6s, the client reconnected so the session didn&apos;t expire? Maybe the intended thing is to do retryDelay(i+1) so that it would&apos;ve slept 1.5s when i=0,..., and 6s when i=3, but retry i=4 at the end of 15s?&lt;/p&gt;

&lt;p&gt;Disclaimer that I actually don&apos;t know that what I think may have happened happened at all, since, like I said, I only have that one log message and the fact that while OverseerCollectionProcessor died, the ClusterStateUpdater didn&apos;t die.&lt;/p&gt;</comment>
                            <comment id="14106803" author="jira-bot" created="Fri, 22 Aug 2014 13:05:27 +0000"  >&lt;p&gt;Commit 1619792 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1619792&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1619792&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6402&quot; title=&quot;OverseerCollectionProcessor should not exit for ZK ConnectionLoss&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6402&quot;&gt;&lt;del&gt;SOLR-6402&lt;/del&gt;&lt;/a&gt;: Only exit the thread loop on a KeeperException if it&apos;s expiration.&lt;/p&gt;</comment>
                            <comment id="14106806" author="jira-bot" created="Fri, 22 Aug 2014 13:07:50 +0000"  >&lt;p&gt;Commit 1619794 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; in branch &apos;dev/branches/branch_4x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1619794&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1619794&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6402&quot; title=&quot;OverseerCollectionProcessor should not exit for ZK ConnectionLoss&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6402&quot;&gt;&lt;del&gt;SOLR-6402&lt;/del&gt;&lt;/a&gt;: Only exit the thread loop on a KeeperException if it&apos;s expiration.&lt;/p&gt;</comment>
                            <comment id="14106808" author="jira-bot" created="Fri, 22 Aug 2014 13:09:12 +0000"  >&lt;p&gt;Commit 1619795 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; in branch &apos;dev/branches/lucene_solr_4_10&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1619795&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1619795&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6402&quot; title=&quot;OverseerCollectionProcessor should not exit for ZK ConnectionLoss&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6402&quot;&gt;&lt;del&gt;SOLR-6402&lt;/del&gt;&lt;/a&gt;: Only exit the thread loop on a KeeperException if it&apos;s expiration.&lt;/p&gt;</comment>
                            <comment id="14106813" author="markrmiller@gmail.com" created="Fri, 22 Aug 2014 13:17:16 +0000"  >&lt;blockquote&gt;&lt;p&gt;Maybe the intended thing is to do&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes! That sounds off. The intention is to try very hard to retry beyond expiration as we are guestimating time on the zk server. This is fairly important. I&apos;ll work on a test.&lt;/p&gt;</comment>
                            <comment id="14106832" author="markrmiller@gmail.com" created="Fri, 22 Aug 2014 13:47:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6405&quot; title=&quot;ZooKeeper calls can easily not be retried enough on ConnectionLoss.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6405&quot;&gt;&lt;del&gt;SOLR-6405&lt;/del&gt;&lt;/a&gt; ZooKeeper calls can easily not be retried enough on ConnectionLoss.&lt;/p&gt;</comment>
                            <comment id="14108414" author="markrmiller@gmail.com" created="Sun, 24 Aug 2014 13:46:29 +0000"  >&lt;p&gt;Thanks Jessica!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12736064">SOLR-6405</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 13 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1z7o7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>