<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:31:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-2141] NullPointerException when using escapeSql function</title>
                <link>https://issues.apache.org/jira/browse/SOLR-2141</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;I have two entities defined, nested in each other..&lt;/p&gt;

&lt;p&gt;&amp;lt;entity name=&quot;article&quot; query=&quot;select category, subcategory from articles&quot;&amp;gt;&lt;br/&gt;
   &amp;lt;entity name=&quot;other&quot; query=&quot;select other from othertable where category=&apos;${dataimporter.functions.escapeSql(article.category)}&apos;&lt;br/&gt;
              AND subcategory=&apos;${dataimporter.functions.escapeSql(article.subcategory)}&apos;&quot;&amp;gt;  &lt;br/&gt;
   &amp;lt;/entity&amp;gt;&lt;br/&gt;
&amp;lt;/entity&amp;gt;&lt;/p&gt;

&lt;p&gt;Now, when I run that it bombs on any article where subcategory = &apos;&apos; (it&apos;s a NOT NULL column so empty string is there)  If i do where subcategory!=&apos;&apos; in the article query it works fine (aside from not pulling in all of the articles).&lt;/p&gt;

&lt;p&gt;org.apache.solr.handler.dataimport.DataImportHandlerException: java.lang.NullPointerException&lt;br/&gt;
        at org.apache.solr.handler.dataimport.DocBuilder.buildDocument(DocBuilder.java:424)&lt;br/&gt;
        at org.apache.solr.handler.dataimport.DocBuilder.buildDocument(DocBuilder.java:383)&lt;br/&gt;
        at org.apache.solr.handler.dataimport.DocBuilder.doFullDump(DocBuilder.java:242)&lt;br/&gt;
        at org.apache.solr.handler.dataimport.DocBuilder.execute(DocBuilder.java:180)&lt;br/&gt;
        at org.apache.solr.handler.dataimport.DataImporter.doFullImport(DataImporter.java:331)&lt;br/&gt;
        at org.apache.solr.handler.dataimport.DataImporter.runCmd(DataImporter.java:389)&lt;br/&gt;
        at org.apache.solr.handler.dataimport.DataImporter$1.run(DataImporter.java:370)&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
        at org.apache.solr.handler.dataimport.EvaluatorBag$1.evaluate(EvaluatorBag.java:75)&lt;br/&gt;
        at org.apache.solr.handler.dataimport.EvaluatorBag$5.get(EvaluatorBag.java:216)&lt;br/&gt;
        at org.apache.solr.handler.dataimport.EvaluatorBag$5.get(EvaluatorBag.java:204)&lt;br/&gt;
        at org.apache.solr.handler.dataimport.VariableResolverImpl.resolve(VariableResolverImpl.java:107)&lt;br/&gt;
        at org.apache.solr.handler.dataimport.TemplateString.fillTokens(TemplateString.java:81)&lt;br/&gt;
        at org.apache.solr.handler.dataimport.TemplateString.replaceTokens(TemplateString.java:75)&lt;br/&gt;
        at org.apache.solr.handler.dataimport.VariableResolverImpl.replaceTokens(VariableResolverImpl.java:87)&lt;br/&gt;
        at org.apache.solr.handler.dataimport.SqlEntityProcessor.nextRow(SqlEntityProcessor.java:71)&lt;br/&gt;
        at org.apache.solr.handler.dataimport.EntityProcessorWrapper.nextRow(EntityProcessorWrapper.java:237)&lt;br/&gt;
        at org.apache.solr.handler.dataimport.DocBuilder.buildDocument(DocBuilder.java:357)&lt;br/&gt;
        ... 6 more&lt;/p&gt;</description>
                <environment>&lt;p&gt;openjdk 1.6.0 b12&lt;/p&gt;</environment>
        <key id="12475830">SOLR-2141</key>
            <summary>NullPointerException when using escapeSql function</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdyer">James Dyer</assignee>
                                    <reporter username="urkle">Edward Rudd</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 Oct 2010 01:37:36 +0000</created>
                <updated>Mon, 9 May 2016 18:56:18 +0000</updated>
                            <resolved>Tue, 27 Nov 2012 16:51:27 +0000</resolved>
                                    <version>1.4.1</version>
                    <version>4.0</version>
                                    <fixVersion>4.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>contrib - DataImportHandler</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="12926543" author="koji" created="Sat, 30 Oct 2010 05:57:06 +0000"  >&lt;p&gt;Edward,&lt;/p&gt;

&lt;p&gt;Maybe I&apos;m missing something, but I couldn&apos;t reproduce the problem you mentioned using attached short sample.&lt;br/&gt;
Please modify the attached file and reproduce it to share your problem.&lt;/p&gt;</comment>
                            <comment id="12982501" author="koji" created="Mon, 17 Jan 2011 07:03:07 +0000"  >&lt;p&gt;Don&apos;t hesitate to reopen when you reproduce the problem.&lt;/p&gt;</comment>
                            <comment id="13153821" author="sandeep2852" created="Sun, 20 Nov 2011 16:02:59 +0000"  >&lt;p&gt;I am also getting same error. &lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Sand&lt;/p&gt;</comment>
                            <comment id="13495281" author="vkirilchuk" created="Mon, 12 Nov 2012 14:23:01 +0000"  >&lt;p&gt;Hi, &lt;/p&gt;

&lt;p&gt;I am facing this error too and it seems that something is broken in 4.x branch.&lt;/p&gt;

&lt;p&gt;I am attaching two files which can help to reproduce the problem:&lt;br/&gt;
1) dih-config.xml&lt;br/&gt;
contains dih configuration which uses escapeSql function with outer entity parameter&lt;br/&gt;
2) dih-file.xml &lt;br/&gt;
To create outer entity without any db related stuff i need to create it from file.&lt;br/&gt;
Note: YOU MUST CHANGE ABSOLUTE PATH TO THIS FILE IN dih-config.xml to correct one.&lt;/p&gt;

&lt;p&gt;--------------------&lt;br/&gt;
Ok, i can also shay the light on what happens under the hood:&lt;/p&gt;

&lt;p&gt;The problem is in instances of VariableResolverImpl which are created every time anyone calls DocBuilder#getVariableResolver();&lt;/p&gt;

&lt;p&gt;First, it is called to create function namespaces which are cached in DocBuilder instance.&lt;/p&gt;

&lt;p&gt;Then it is created when DocBuilder#doFullDump() is called.&lt;/p&gt;

&lt;p&gt;Then subEntity tries to resolve its &apos;query&apos; parameter which has escapeSql function, and escapeSql function tries to resolve its param with the first VariableResolver which know nothing about current context and outer entity values.&lt;/p&gt;

&lt;p&gt;However all fails a little bit later, when EvaluatorBag#evaluate() is called:&lt;br/&gt;
List l = parseParams(expression, context.getVariableResolver());&lt;br/&gt;
        if (l.size() != 1) &lt;/p&gt;
{
          throw new DataImportHandlerException(SEVERE, &quot;&apos;escapeSql&apos; must have at least one parameter &quot;);
        }
&lt;p&gt;        String s = l.get(0).toString();&lt;br/&gt;
        return s.replaceAll&lt;/p&gt;

&lt;p&gt;Here parseParams returns list with single VariableWrapper, but wrapper.toString returns null because variable cant be resolved. And finally (ta-dam!) replaceAll method is called on null value.&lt;/p&gt;

&lt;p&gt;P.s.&lt;br/&gt;
don`t be confused with FileDataSource for first entity mixed up with Sql query for second entity. Absense of sql datasource has no effect on this bug.&lt;/p&gt;

&lt;p&gt;Thanks, it would be great if this bug will be fixed ASAP.&lt;/p&gt;</comment>
                            <comment id="13495410" author="dsiebel" created="Mon, 12 Nov 2012 16:54:21 +0000"  >&lt;p&gt;I am having the exact same issue since upgrading from 4.0.0 nightly (aprox. November 2011) to 4.0.0 stable (and previously also 4.0.0 BETA).&lt;/p&gt;

&lt;p&gt;I already tried to resolve it with the help of the Solr User&apos;s mailinglist:&lt;br/&gt;
&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/lucene-solr-user/201210.mbox/%3CCAAh4Jhuv86xbVa6=ZdxshUw3FeRuM+ORg4pDTkqAdGagEFbsDg@mail.gmail.com%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://mail-archives.apache.org/mod_mbox/lucene-solr-user/201210.mbox/%3CCAAh4Jhuv86xbVa6=ZdxshUw3FeRuM+ORg4pDTkqAdGagEFbsDg@mail.gmail.com%3E&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13495421" author="dsiebel" created="Mon, 12 Nov 2012 17:06:42 +0000"  >&lt;p&gt;Sadly there&apos;s no way for me to reopen this issue like &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=koji&quot; class=&quot;user-hover&quot; rel=&quot;koji&quot;&gt;koji&lt;/a&gt; suggested.&lt;br/&gt;
Maybe &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=urkle&quot; class=&quot;user-hover&quot; rel=&quot;urkle&quot;&gt;urkle&lt;/a&gt; can?&lt;/p&gt;</comment>
                            <comment id="13495438" author="jdyer" created="Mon, 12 Nov 2012 17:29:56 +0000"  >&lt;p&gt;I re-opened the issue as it sounds like an actual problem.&lt;/p&gt;

&lt;p&gt;Vadim/Sand, can either of you create a failing unit test?  This would make it a lot easier to fix.  Perhaps you can start with something like TestFileListWithLineEntityProcessor .  Also, can you point to an svn revision number when this functionality worked for you?  This would help track down what broke it.&lt;/p&gt;</comment>
                            <comment id="13495635" author="dsiebel" created="Mon, 12 Nov 2012 21:06:59 +0000"  >&lt;p&gt;If it helps:&lt;br/&gt;
I just checked for the nightly build I had in use (with DIH working fine) until I started upgrading to 4.0.0 (beta) a few weeks ago:&lt;/p&gt;

&lt;p&gt;apache-solr-4.0-2011-09-16_08-37-32.war&lt;/p&gt;

&lt;p&gt;with&lt;/p&gt;

&lt;p&gt;apache-solr-dataimporthandler-4.0-2011-09-16_08-37-32.jar&lt;br/&gt;
apache-solr-dataimporthandler-extras-4.0-2011-09-16_08-37-32.jar&lt;/p&gt;</comment>
                            <comment id="13495701" author="jdyer" created="Mon, 12 Nov 2012 22:31:44 +0000"  >&lt;p&gt;We really need a failing unit test for this, or at least simplify the config info Vadim supplied with the bare essentials (and maybe a step-by-step how-to) for reproducing this failure.&lt;/p&gt;

&lt;p&gt;Going through the commits since Sept 2011, there isn&apos;t any one that seems like it definitely would have caused this.  These 3 seem most suspicious but this is just a guess:&lt;/p&gt;

&lt;p&gt;r1201659 - &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2382&quot; title=&quot;DIH Cache Improvements&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2382&quot;&gt;&lt;del&gt;SOLR-2382&lt;/del&gt;&lt;/a&gt;, pluggable caches&lt;br/&gt;
r1231367 - &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2542&quot; title=&quot;dataimport global session putVal blank&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2542&quot;&gt;&lt;del&gt;SOLR-2542&lt;/del&gt;&lt;/a&gt;, fix for context variables&lt;br/&gt;
r1332292 - &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3422&quot; title=&quot;Refactor DIH - configuration data&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3422&quot;&gt;&lt;del&gt;SOLR-3422&lt;/del&gt;&lt;/a&gt;, refactor configuration load&lt;/p&gt;</comment>
                            <comment id="13496033" author="vkirilchuk" created="Tue, 13 Nov 2012 08:06:37 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I am attaching the patch (&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12553286/SOLR-2141-test.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;SOLR-2141-test.patch&lt;/a&gt;) to existing test that will help to reproduce the issue. (I`d like someone to write another test instead of modifying existing one)&lt;/p&gt;

&lt;p&gt;If you execute this test you will see already mentioned stacktrace in console output:&lt;/p&gt;

&lt;p&gt;Caused by: java.lang.RuntimeException: org.apache.solr.handler.dataimport.DataImportHandlerException: java.lang.NullPointerException&lt;br/&gt;
		at org.apache.solr.handler.dataimport.DocBuilder.buildDocument(DocBuilder.java:413)&lt;br/&gt;
		at org.apache.solr.handler.dataimport.DocBuilder.doFullDump(DocBuilder.java:326)&lt;br/&gt;
		at org.apache.solr.handler.dataimport.DocBuilder.execute(DocBuilder.java:234)&lt;br/&gt;
		... 47 more&lt;br/&gt;
	Caused by: org.apache.solr.handler.dataimport.DataImportHandlerException: java.lang.NullPointerException&lt;br/&gt;
		at org.apache.solr.handler.dataimport.DocBuilder.buildDocument(DocBuilder.java:556)&lt;br/&gt;
		at org.apache.solr.handler.dataimport.DocBuilder.buildDocument(DocBuilder.java:411)&lt;br/&gt;
		... 49 more&lt;br/&gt;
	Caused by: java.lang.NullPointerException&lt;br/&gt;
		at org.apache.solr.client.solrj.util.ClientUtils.escapeQueryChars(ClientUtils.java:206)&lt;br/&gt;
		at org.apache.solr.handler.dataimport.EvaluatorBag$3.evaluate(EvaluatorBag.java:101)&lt;br/&gt;
		at org.apache.solr.handler.dataimport.EvaluatorBag$6.get(EvaluatorBag.java:223)&lt;br/&gt;
		at org.apache.solr.handler.dataimport.EvaluatorBag$6.get(EvaluatorBag.java:1)&lt;br/&gt;
		at org.apache.solr.handler.dataimport.VariableResolverImpl.resolve(VariableResolverImpl.java:113)&lt;br/&gt;
		at org.apache.solr.handler.dataimport.TemplateString.fillTokens(TemplateString.java:81)&lt;br/&gt;
		at org.apache.solr.handler.dataimport.TemplateString.replaceTokens(TemplateString.java:75)&lt;br/&gt;
		at org.apache.solr.handler.dataimport.VariableResolverImpl.replaceTokens(VariableResolverImpl.java:91)&lt;br/&gt;
		at org.apache.solr.handler.dataimport.ContextImpl.getResolvedEntityAttribute(ContextImpl.java:81)&lt;br/&gt;
		at org.apache.solr.handler.dataimport.LineEntityProcessor.init(LineEntityProcessor.java:84)&lt;br/&gt;
		at org.apache.solr.handler.dataimport.EntityProcessorWrapper.init(EntityProcessorWrapper.java:74)&lt;br/&gt;
		at org.apache.solr.handler.dataimport.DocBuilder.buildDocument(DocBuilder.java:430)&lt;br/&gt;
		at org.apache.solr.handler.dataimport.DocBuilder.buildDocument(DocBuilder.java:511)&lt;/p&gt;

&lt;p&gt;P.s my solr is branch_4x 7da8d768b8b08923b274fcf32ca28edd1a78e8eb&lt;/p&gt;</comment>
                            <comment id="13496160" author="dsiebel" created="Tue, 13 Nov 2012 12:55:41 +0000"  >&lt;p&gt;I just added the patch &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2141&quot; title=&quot;NullPointerException when using escapeSql function&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2141&quot;&gt;&lt;del&gt;SOLR-2141&lt;/del&gt;&lt;/a&gt;.b341f5b.patch for commit b341f5b (github mirror of branch_4x).&lt;br/&gt;
Might this have caused the error?&lt;br/&gt;
The way I see it the EvaluatorBag looses the current context when used in a nested entity.&lt;br/&gt;
The commit was executed in connection with &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2542&quot; title=&quot;dataimport global session putVal blank&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2542&quot;&gt;&lt;del&gt;SOLR-2542&lt;/del&gt;&lt;/a&gt; as git log shows:&lt;/p&gt;

&lt;p&gt;b341f5b - &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2542&quot; title=&quot;dataimport global session putVal blank&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2542&quot;&gt;&lt;del&gt;SOLR-2542&lt;/del&gt;&lt;/a&gt;: Fixed DIH Context variables which were broken for all scopes other then SCOPE_ENTITY (10 months ago) &amp;lt;Chris M. Hostetter&amp;gt;&lt;/p&gt;</comment>
                            <comment id="13497207" author="dsiebel" created="Wed, 14 Nov 2012 16:34:36 +0000"  >&lt;p&gt;Hi guys,&lt;/p&gt;

&lt;p&gt;I think I might have found the root of evil:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3262&quot; title=&quot;Remove &amp;quot;threads&amp;quot; from DIH (Trunk only)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3262&quot;&gt;&lt;del&gt;SOLR-3262&lt;/del&gt;&lt;/a&gt; (removing &quot;threads&quot; from DIH). Problem is that in nested entites the used VariableResolverImpl differs from the one used by the EvaluatorBag (since everytime the getVariableResolver method is called a new one gets created) in the functions namespace (since that one get&apos;s initialized in the DocBuilder constructor).&lt;br/&gt;
Anyway: I removed the private functionsNamespace cache property from the docBuilder and moved the call EvaluatorBag.getFunctionsNamespace() into DocBuilder.getVariableResolver(). That fixes all of my problems.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vkirilchuk&quot; class=&quot;user-hover&quot; rel=&quot;vkirilchuk&quot;&gt;vkirilchuk&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sandeep2852&quot; class=&quot;user-hover&quot; rel=&quot;sandeep2852&quot;&gt;sandeep2852&lt;/a&gt; please find attached patch and let me know if this fixes your errors, too.&lt;/p&gt;</comment>
                            <comment id="13497209" author="dsiebel" created="Wed, 14 Nov 2012 16:35:39 +0000"  >&lt;p&gt;Patch to fix loading of functions namespace at runtime to use the correct (the newly created) VariableResolverImpl&lt;/p&gt;</comment>
                            <comment id="13500132" author="dsiebel" created="Mon, 19 Nov 2012 10:31:01 +0000"  >&lt;p&gt;/push &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vkirilchuk&quot; class=&quot;user-hover&quot; rel=&quot;vkirilchuk&quot;&gt;vkirilchuk&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sandeep2852&quot; class=&quot;user-hover&quot; rel=&quot;sandeep2852&quot;&gt;sandeep2852&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jdyer&quot; class=&quot;user-hover&quot; rel=&quot;jdyer&quot;&gt;jdyer&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13500198" author="vkirilchuk" created="Mon, 19 Nov 2012 12:32:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsiebel&quot; class=&quot;user-hover&quot; rel=&quot;dsiebel&quot;&gt;dsiebel&lt;/a&gt; sorry, but i am very busy this week. I looked through your patch and i think it will fix my issue, however currently i have no time to check it. Thanks for the patch anyway!&lt;/p&gt;</comment>
                            <comment id="13502319" author="jdyer" created="Wed, 21 Nov 2012 21:19:02 +0000"  >&lt;p&gt;Could you try importing again with the latest revision from Trunk/5.x or branch_4x ?  Based on my limited understanding of this problem, I think it might have been solved with &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4086&quot; title=&quot;Refactor DIH - VariableResolver &amp;amp; Evaluator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4086&quot;&gt;&lt;del&gt;SOLR-4086&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;In either case, we probably should write a good unit test for this so that it doesn&apos;t break again.&lt;/p&gt;</comment>
                            <comment id="13502751" author="dsiebel" created="Thu, 22 Nov 2012 12:57:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jdyer&quot; class=&quot;user-hover&quot; rel=&quot;jdyer&quot;&gt;jdyer&lt;/a&gt; Thanks, this seems to have fixed my problem. I&apos;m currently doing a full import with a build from branch_4x, no NPEs, yet (at ~10% now).&lt;br/&gt;
Sorry for the (maybe) dumb question, but: is there a gonna be a &quot;stable&quot; bugfix release or tag in the near future (not only for this issue, of course)?&lt;/p&gt;</comment>
                            <comment id="13503763" author="dsiebel" created="Mon, 26 Nov 2012 12:47:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jdyer&quot; class=&quot;user-hover&quot; rel=&quot;jdyer&quot;&gt;jdyer&lt;/a&gt;&lt;br/&gt;
After I finally had some time to check whether the indexed results (after the update) are as I expect them to be I had to find out that the importer did not throw any NPE&apos;s now, instead the fields are just missing.&lt;br/&gt;
I have 7 fields defined in my nested entity that use escapeSql. Those are the exact fields that don&apos;t get indexed now :-/&lt;br/&gt;
Any other suggestions? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I will have a look at the changed DIH code, maybe i can figure out where this is coming from.&lt;/p&gt;</comment>
                            <comment id="13503815" author="dsiebel" created="Mon, 26 Nov 2012 14:51:57 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jdyer&quot; class=&quot;user-hover&quot; rel=&quot;jdyer&quot;&gt;jdyer&lt;/a&gt;,&lt;br/&gt;
I just worked through the changes in the DIH. Turns out my fields were null, because I used the &apos;dih.functions.&apos; namespace since the &apos;dataimporter.functions.&apos; was marked &lt;b&gt;&lt;em&gt;deprecated&lt;/em&gt;&lt;/b&gt; before the change. Did you change that back on purpose, because it might cause some confusion (like in my case).&lt;/p&gt;</comment>
                            <comment id="13503828" author="jdyer" created="Mon, 26 Nov 2012 15:11:58 +0000"  >&lt;p&gt;Dominik,&lt;/p&gt;

&lt;p&gt;Can you confirm for me that with the current Trunk that the functionality is working so long you use the &quot;dataimporter.functions.&quot; namespace?&lt;/p&gt;

&lt;p&gt;Removing support for the &quot;dih.functions.&quot; namespace was indeed a mistake.  I can fix that too (and its a simple change).  But I really want to know for sure if your bigger problem is solved first??&lt;/p&gt;</comment>
                            <comment id="13503879" author="dsiebel" created="Mon, 26 Nov 2012 16:37:34 +0000"  >&lt;p&gt;Checked with&lt;/p&gt;

&lt;p&gt;git-svn-id: &lt;a href=&quot;https://svn.apache.org/repos/asf/lucene/dev/trunk@1413079&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/repos/asf/lucene/dev/trunk@1413079&lt;/a&gt; 13f79535-47bb-0310-9956-ffa450edef68&lt;/p&gt;

&lt;p&gt;from github trunk.&lt;br/&gt;
Everything seems to be running, at least the fields are present. &lt;br/&gt;
On optimize I get a &quot;&lt;em&gt;SEVERE: null:java.lang.NoSuchMethodError: org.apache.lucene.document.Document.add(Lorg/apache/lucene/index/IndexableField;)V&lt;/em&gt;&quot; from the SpellChecker component, though. But this might be related to some other issue.&lt;/p&gt;

&lt;p&gt;I could not verify with the whole dataset yet since indexing, commit and optimize (required for spellcheckers) take around 5h. I&apos;ll get back to you once the import finished on our staging system.&lt;/p&gt;</comment>
                            <comment id="13504104" author="jdyer" created="Mon, 26 Nov 2012 21:15:53 +0000"  >&lt;p&gt;I&apos;ve attached a patch which fixes the functions namespace issue.  More importantly, it tests for the problem described here, in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4047&quot; title=&quot;dataimporter.functions.encodeUrl throughs Unable to encode expression: field.name with value: null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4047&quot;&gt;&lt;del&gt;SOLR-4047&lt;/del&gt;&lt;/a&gt; &amp;amp; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3842&quot; title=&quot;DataImportHandler: When attempting to use column values as field names, multivalued fields only retain the first result&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3842&quot;&gt;&lt;del&gt;SOLR-3842&lt;/del&gt;&lt;/a&gt;.  &lt;/p&gt;

&lt;p&gt;My plan is to commit this tomorrow and if you do not have any more problems, I will close this.&lt;/p&gt;</comment>
                            <comment id="13504184" author="jdyer" created="Mon, 26 Nov 2012 22:23:16 +0000"  >&lt;p&gt;better patch.  fixes problem for &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3842&quot; title=&quot;DataImportHandler: When attempting to use column values as field names, multivalued fields only retain the first result&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3842&quot;&gt;&lt;del&gt;SOLR-3842&lt;/del&gt;&lt;/a&gt; also.&lt;/p&gt;</comment>
                            <comment id="13504189" author="jdyer" created="Mon, 26 Nov 2012 22:31:23 +0000"  >&lt;p&gt;this 3rd patch version contains a test that won&apos;t begin to fail on Jan 1 &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13504443" author="dsiebel" created="Tue, 27 Nov 2012 08:19:18 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jdyer&quot; class=&quot;user-hover&quot; rel=&quot;jdyer&quot;&gt;jdyer&lt;/a&gt;,&lt;br/&gt;
Index with the whole dataset looks good. So things seem to be fixed now. Thanks for that!&lt;/p&gt;

&lt;p&gt;Just another dumb question:&lt;br/&gt;
What do I use the patch for? Aren&apos;t those the changes that are already in the branch_4x &amp;amp; trunk?&lt;/p&gt;</comment>
                            <comment id="13504714" author="jdyer" created="Tue, 27 Nov 2012 16:09:45 +0000"  >&lt;p&gt;final patch to commit, fixes a locale problem in the unit test.&lt;/p&gt;

&lt;p&gt;Dominik, this patch solves the absence of the dih.functions. namespace, so you can use either &quot;dih.&quot; or &quot;dataimport.&quot; as before.  Also, it solves the related problem on &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3842&quot; title=&quot;DataImportHandler: When attempting to use column values as field names, multivalued fields only retain the first result&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3842&quot;&gt;&lt;del&gt;SOLR-3842&lt;/del&gt;&lt;/a&gt;.  Finally it has a pretty good unit test that demonstrates this issue, &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3842&quot; title=&quot;DataImportHandler: When attempting to use column values as field names, multivalued fields only retain the first result&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3842&quot;&gt;&lt;del&gt;SOLR-3842&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4047&quot; title=&quot;dataimporter.functions.encodeUrl throughs Unable to encode expression: field.name with value: null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4047&quot;&gt;&lt;del&gt;SOLR-4047&lt;/del&gt;&lt;/a&gt; (this last one doesn&apos;t appear to actually be broken).&lt;/p&gt;</comment>
                            <comment id="13504752" author="jdyer" created="Tue, 27 Nov 2012 16:51:27 +0000"  >&lt;p&gt;committed.&lt;/p&gt;

&lt;p&gt;Trunk: r1414242&lt;br/&gt;
4x: r1414250&lt;/p&gt;</comment>
                            <comment id="13505337" author="dsiebel" created="Wed, 28 Nov 2012 09:53:36 +0000"  >&lt;p&gt;Hi, James, sorry I already forgot about that. Thanks for the good work!&lt;/p&gt;</comment>
                            <comment id="13610495" author="commit-tag-bot" created="Fri, 22 Mar 2013 16:13:28 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; James Dyer&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1414260&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1414260&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2141&quot; title=&quot;NullPointerException when using escapeSql function&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2141&quot;&gt;&lt;del&gt;SOLR-2141&lt;/del&gt;&lt;/a&gt;  / &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4047&quot; title=&quot;dataimporter.functions.encodeUrl throughs Unable to encode expression: field.name with value: null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4047&quot;&gt;&lt;del&gt;SOLR-4047&lt;/del&gt;&lt;/a&gt; / &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3842&quot; title=&quot;DataImportHandler: When attempting to use column values as field names, multivalued fields only retain the first result&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3842&quot;&gt;&lt;del&gt;SOLR-3842&lt;/del&gt;&lt;/a&gt; - remove tabs&lt;/p&gt;</comment>
                            <comment id="13610498" author="commit-tag-bot" created="Fri, 22 Mar 2013 16:13:36 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; James Dyer&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1414250&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1414250&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2141&quot; title=&quot;NullPointerException when using escapeSql function&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2141&quot;&gt;&lt;del&gt;SOLR-2141&lt;/del&gt;&lt;/a&gt;  / &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4047&quot; title=&quot;dataimporter.functions.encodeUrl throughs Unable to encode expression: field.name with value: null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4047&quot;&gt;&lt;del&gt;SOLR-4047&lt;/del&gt;&lt;/a&gt; / &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3842&quot; title=&quot;DataImportHandler: When attempting to use column values as field names, multivalued fields only retain the first result&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3842&quot;&gt;&lt;del&gt;SOLR-3842&lt;/del&gt;&lt;/a&gt; - fix problems with VariableResolver, better test coverage&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12607638">SOLR-3842</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12615169">SOLR-4047</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12458473" name="SOLR-2141-sample.patch" size="69767" author="koji" created="Sat, 30 Oct 2010 05:57:06 +0000"/>
                            <attachment id="12553286" name="SOLR-2141-test.patch" size="1503" author="vkirilchuk" created="Tue, 13 Nov 2012 08:06:37 +0000"/>
                            <attachment id="12553309" name="SOLR-2141.b341f5b.patch" size="3122" author="dsiebel" created="Tue, 13 Nov 2012 12:51:23 +0000"/>
                            <attachment id="12555026" name="SOLR-2141.patch" size="13794" author="jdyer" created="Tue, 27 Nov 2012 16:09:45 +0000"/>
                            <attachment id="12554926" name="SOLR-2141.patch" size="13766" author="jdyer" created="Mon, 26 Nov 2012 22:31:23 +0000"/>
                            <attachment id="12554925" name="SOLR-2141.patch" size="13635" author="jdyer" created="Mon, 26 Nov 2012 22:23:16 +0000"/>
                            <attachment id="12554915" name="SOLR-2141.patch" size="12308" author="jdyer" created="Mon, 26 Nov 2012 21:15:52 +0000"/>
                            <attachment id="12553630" name="SOLR-2141.patch" size="4768" author="dsiebel" created="Thu, 15 Nov 2012 08:02:58 +0000"/>
                            <attachment id="12553508" name="SOLR-2141.patch" size="5231" author="dsiebel" created="Wed, 14 Nov 2012 16:35:39 +0000"/>
                            <attachment id="12553117" name="dih-config.xml" size="404" author="vkirilchuk" created="Mon, 12 Nov 2012 14:23:01 +0000"/>
                            <attachment id="12553118" name="dih-file.xml" size="54" author="vkirilchuk" created="Mon, 12 Nov 2012 14:23:01 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5367</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 35 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03mkf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19089</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>