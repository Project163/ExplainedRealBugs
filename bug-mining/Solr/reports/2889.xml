<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:12:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-8804] Race condition in ClusterStatus.getClusterStatus</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8804</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Reading cluster state information using &lt;tt&gt;/collections?action=CLUSTERSTATUS&lt;/tt&gt; can fail if there&apos;s a concurrent &lt;tt&gt;/collections?action=DELETE&lt;/tt&gt; operation.&lt;/p&gt;

&lt;p&gt;The code in &lt;tt&gt;ClusterStatus.getClusterStatus&lt;/tt&gt; &lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;gets collection names&lt;/li&gt;
	&lt;li&gt;for every collection reads its cluster state info using &lt;tt&gt;ClusterState.getCollection&lt;/tt&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;The problem is that if there&apos;s a &lt;tt&gt;DELETE&lt;/tt&gt; operation in between then &lt;tt&gt;ClusterState.getCollection&lt;/tt&gt; can fail thus causing the whole operation to fail. It seems that it would be better to call &lt;tt&gt;ClusterState.getCollectionOrNull&lt;/tt&gt; and skip/ignore that collection if the result is null.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;19:49:32.479 [qtp1531448569-881] ERROR org.apache.solr.core.SolrCore - org.apache.solr.common.SolrException: Could not find collection : collection
    at org.apache.solr.common.cloud.ClusterState.getCollection(ClusterState.java:165)
    at org.apache.solr.handler.admin.ClusterStatus.getClusterStatus(ClusterStatus.java:110)
    at org.apache.solr.handler.admin.CollectionsHandler$CollectionOperation$19.call(CollectionsHandler.java:614)
    at org.apache.solr.handler.admin.CollectionsHandler.handleRequestBody(CollectionsHandler.java:166)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12948094">SOLR-8804</key>
            <summary>Race condition in ClusterStatus.getClusterStatus</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Trivial</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="varun">Varun Thacker</assignee>
                                    <reporter username="alexey.serba">Alexey Serba</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Mar 2016 18:04:36 +0000</created>
                <updated>Thu, 21 Nov 2019 00:41:46 +0000</updated>
                            <resolved>Mon, 25 Apr 2016 04:43:13 +0000</resolved>
                                    <version>5.3.1</version>
                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                    <fixVersion>6.1</fixVersion>
                    <fixVersion>7.0</fixVersion>
                                    <component>SolrCloud</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="15187703" author="varunthacker" created="Wed, 9 Mar 2016 19:13:44 +0000"  >&lt;p&gt;Patch which fixes the problem. &lt;/p&gt;</comment>
                            <comment id="15189218" author="noble.paul" created="Thu, 10 Mar 2016 12:34:13 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15189257" author="shalinmangar" created="Thu, 10 Mar 2016 13:06:48 +0000"  >&lt;p&gt;This fix isn&apos;t correct. We should throw an exception only if the user specifically asked for a collection and it doesn&apos;t exist anymore because of a concurrent delete request. In case no collection was specified in the request, we should just ignore a missing collection and continue to the next one.&lt;/p&gt;</comment>
                            <comment id="15189371" author="varunthacker" created="Thu, 10 Mar 2016 14:38:29 +0000"  >&lt;p&gt;Thanks Shalin for the review! Updated patch taking into account your suggestions&lt;/p&gt;</comment>
                            <comment id="15189531" author="shalinmangar" created="Thu, 10 Mar 2016 16:54:36 +0000"  >&lt;p&gt;+1 LGTM&lt;/p&gt;</comment>
                            <comment id="15190681" author="jira-bot" created="Fri, 11 Mar 2016 09:11:35 +0000"  >&lt;p&gt;Commit 343d9c6fa4ccff3d997b5b8c143b839364569ae6 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=343d9c6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=343d9c6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8804&quot; title=&quot;Race condition in ClusterStatus.getClusterStatus&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8804&quot;&gt;&lt;del&gt;SOLR-8804&lt;/del&gt;&lt;/a&gt;: Fix a race condition in the ClusterStatus API call&lt;/p&gt;</comment>
                            <comment id="15190682" author="jira-bot" created="Fri, 11 Mar 2016 09:12:24 +0000"  >&lt;p&gt;Commit b8e454c1daf52b4f6126c0997e4e0b75eae9e34d in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b8e454c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b8e454c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8804&quot; title=&quot;Race condition in ClusterStatus.getClusterStatus&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8804&quot;&gt;&lt;del&gt;SOLR-8804&lt;/del&gt;&lt;/a&gt;: Fix a race condition in the ClusterStatus API call&lt;/p&gt;</comment>
                            <comment id="15190683" author="jira-bot" created="Fri, 11 Mar 2016 09:13:31 +0000"  >&lt;p&gt;Commit c0f69138a271f7aad67e937e99a24090986612fc in lucene-solr&apos;s branch refs/heads/branch_6_0 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c0f6913&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c0f6913&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8804&quot; title=&quot;Race condition in ClusterStatus.getClusterStatus&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8804&quot;&gt;&lt;del&gt;SOLR-8804&lt;/del&gt;&lt;/a&gt;: Fix a race condition in the ClusterStatus API call&lt;/p&gt;</comment>
                            <comment id="15190686" author="varunthacker" created="Fri, 11 Mar 2016 09:15:41 +0000"  >&lt;p&gt;Thanks Alexey for reporting the issue and Noble/Shalin for the reviews! &lt;/p&gt;</comment>
                            <comment id="15254150" author="anshumg" created="Fri, 22 Apr 2016 16:12:05 +0000"  >&lt;p&gt;back porting for 5.5.1&lt;/p&gt;</comment>
                            <comment id="15255026" author="jira-bot" created="Sat, 23 Apr 2016 01:51:44 +0000"  >&lt;p&gt;Commit bf8a2c7caa2350e4764a0791cbee0c6764995e76 in lucene-solr&apos;s branch refs/heads/branch_5x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=bf8a2c7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=bf8a2c7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8804&quot; title=&quot;Race condition in ClusterStatus.getClusterStatus&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8804&quot;&gt;&lt;del&gt;SOLR-8804&lt;/del&gt;&lt;/a&gt;: Fix a race condition in the ClusterStatus API call&lt;/p&gt;</comment>
                            <comment id="15255880" author="jira-bot" created="Mon, 25 Apr 2016 04:40:58 +0000"  >&lt;p&gt;Commit a0e686d0697957fac7f85fa8b606f547e5982e36 in lucene-solr&apos;s branch refs/heads/branch_5_5 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a0e686d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a0e686d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8804&quot; title=&quot;Race condition in ClusterStatus.getClusterStatus&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8804&quot;&gt;&lt;del&gt;SOLR-8804&lt;/del&gt;&lt;/a&gt;: Fix a race condition in the ClusterStatus API call&lt;/p&gt;</comment>
                            <comment id="15279246" author="hossman" created="Tue, 10 May 2016 23:45:35 +0000"  >&lt;p&gt;Manually correcting fixVersion per Step #S6 of &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-7271&quot; title=&quot;Cleanup jira&amp;#39;s concept of &amp;#39;master&amp;#39; and &amp;#39;6.0&amp;#39;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-7271&quot;&gt;&lt;del&gt;LUCENE-7271&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13002440">SOLR-9471</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12792517" name="SOLR-8804.patch" size="3330" author="varun" created="Thu, 10 Mar 2016 14:38:29 +0000"/>
                            <attachment id="12792318" name="SOLR-8804.patch" size="1803" author="varun" created="Wed, 9 Mar 2016 19:13:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 28 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2uck7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>