<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:45:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-13181] NullPointerException in org.apache.solr.request.macro.MacroExpander</title>
                <link>https://issues.apache.org/jira/browse/SOLR-13181</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Requesting the following URL causes Solr to return an HTTP 500 error response:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;http://localhost:8983/solr/films/select?a=${${b}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The error response seems to be caused by the following uncaught exception:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.StringIndexOutOfBoundsException: String index out of range: -4
	at java.lang.String.substring(String.java:1967)
	at org.apache.solr.request.macro.MacroExpander._expand(MacroExpander.java:150)
	at org.apache.solr.request.macro.MacroExpander.expand(MacroExpander.java:101)
	at org.apache.solr.request.macro.MacroExpander.expand(MacroExpander.java:65)
	at org.apache.solr.request.macro.MacroExpander.expand(MacroExpander.java:51)
	at org.apache.solr.request.json.RequestUtil.processParams(RequestUtil.java:159)
	at org.apache.solr.util.SolrPluginUtils.setDefaults(SolrPluginUtils.java:167)
	at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:196)
[...]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Parameter &lt;a href=&quot;http://yonik.com/solr-query-parameter-substitution/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;macro expansion&lt;/a&gt; seems to take place in &lt;tt&gt;org.apache.solr.request.macro.MacroExpander._expand(String val)&lt;/tt&gt;. From reading the code of the function it seems that macros are not expanded inside curly brackets &lt;tt&gt;${...&lt;/tt&gt;}, and so the &lt;tt&gt;${b&lt;/tt&gt;} inside&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;${${b}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;should not be expanded. But the function seems to fail to detect this specific case and graciously refuse to expand it.&lt;/p&gt;

&lt;p&gt;A possible fix could be updating the &lt;tt&gt;idx&lt;/tt&gt; variable when the &lt;tt&gt;StrParser&lt;/tt&gt; detects that no valid identifier can be found inside the brackets. See attached file &lt;tt&gt;0001-Macro-expander-fail-gracefully-on-unsupported-syntax.patch&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;We found this bug using &lt;a href=&quot;https://www.diffblue.com/labs/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Diffblue Microservices Testing&lt;/a&gt;. Find more information on this &lt;a href=&quot;https://www.diffblue.com/blog/2018/12/19/diffblue-microservice-testing-a-sneak-peek-at-our-early-product-and-results&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;fuzz testing campaign&lt;/a&gt;.&lt;/p&gt;</description>
                <environment>&lt;h1&gt;&lt;a name=&quot;Stepstoreproduce&quot;&gt;&lt;/a&gt;Steps to reproduce&lt;/h1&gt;

&lt;ul&gt;
	&lt;li&gt;Use a Linux machine.&lt;/li&gt;
	&lt;li&gt;Build commit &lt;tt&gt;ea2c8ba&lt;/tt&gt; of Solr as described in the section below.&lt;/li&gt;
	&lt;li&gt;Build the films collection as described below.&lt;/li&gt;
	&lt;li&gt;Start the server using the command &lt;tt&gt;./bin/solr start -f -p 8983 -s /tmp/home&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;Request the URL given in the bug description.&lt;/li&gt;
&lt;/ul&gt;


&lt;h1&gt;&lt;a name=&quot;Compilingtheserver&quot;&gt;&lt;/a&gt;Compiling the server&lt;/h1&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;git clone https://github.com/apache/lucene-solr
cd lucene-solr
git checkout ea2c8ba
ant compile
cd solr
ant server
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;h1&gt;&lt;a name=&quot;Buildingthecollection&quot;&gt;&lt;/a&gt;Building the collection&lt;/h1&gt;

&lt;p&gt;We followed &lt;a href=&quot;http://lucene.apache.org/solr/guide/7_5/solr-tutorial.html#exercise-2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Exercise 2&lt;/a&gt; from the &lt;a href=&quot;http://lucene.apache.org/solr/guide/7_5/solr-tutorial.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Solr Tutorial&lt;/a&gt;. The attached file (&lt;tt&gt;home.zip&lt;/tt&gt;) gives the contents of folder &lt;tt&gt;/tmp/home&lt;/tt&gt; that you will obtain by following the steps below:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;mkdir -p /tmp/home
echo &apos;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&amp;gt;&amp;lt;solr&amp;gt;&amp;lt;/solr&amp;gt;&apos; &amp;gt; /tmp/home/solr.xml
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In one terminal start a Solr instance in foreground:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;./bin/solr start -f -p 8983 -s /tmp/home
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In another terminal, create a collection of movies, with no shards and no replication, and initialize it:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;bin/solr create -c films
curl -X POST -H &apos;Content-type:application/json&apos; --data-binary &apos;{&quot;add-field&quot;: {&quot;name&quot;:&quot;name&quot;, &quot;type&quot;:&quot;text_general&quot;, &quot;multiValued&quot;:false, &quot;stored&quot;:true}}&apos; http://localhost:8983/solr/films/schema
curl -X POST -H &apos;Content-type:application/json&apos; --data-binary &apos;{&quot;add-copy-field&quot; : {&quot;source&quot;:&quot;*&quot;,&quot;dest&quot;:&quot;_text_&quot;}}&apos; http://localhost:8983/solr/films/schema
./bin/post -c films example/films/films.json
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</environment>
        <key id="13212589">SOLR-13181</key>
            <summary>NullPointerException in org.apache.solr.request.macro.MacroExpander</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dsmiley">David Smiley</assignee>
                                    <reporter username="cesar.rodriguez">Cesar Rodriguez</reporter>
                        <labels>
                            <label>diffblue</label>
                            <label>newdev</label>
                    </labels>
                <created>Tue, 29 Jan 2019 16:08:32 +0000</created>
                <updated>Wed, 4 Nov 2020 15:22:59 +0000</updated>
                            <resolved>Tue, 22 Sep 2020 20:26:07 +0000</resolved>
                                    <version>9.0</version>
                                    <fixVersion>8.7</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="11400">3h 10m</timespent>
                                <comments>
                            <comment id="16756549" author="cpoerschke" created="Wed, 30 Jan 2019 21:03:54 +0000"  >&lt;p&gt;Interesting edge case for the macro expander! And thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cesar.rodriguez&quot; class=&quot;user-hover&quot; rel=&quot;cesar.rodriguez&quot;&gt;cesar.rodriguez&lt;/a&gt;&#160;for attaching the initial &lt;tt&gt;0001-Macro-expander-fail-gracefully-on-unsupported-syntax.patch&lt;/tt&gt; patch.&lt;/p&gt;

&lt;p&gt;I wonder if a test case could be added (say) in the &lt;a href=&quot;https://github.com/apache/lucene-solr/blob/master/solr/core/src/test/org/apache/solr/request/macro/TestMacroExpander.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/master/solr/core/src/test/org/apache/solr/request/macro/TestMacroExpander.java&lt;/a&gt; tests?&lt;/p&gt;

&lt;p&gt;(&lt;a href=&quot;https://wiki.apache.org/solr/HowToContribute#Contributing_your_work&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://wiki.apache.org/solr/HowToContribute#Contributing_your_work&lt;/a&gt; has a lot of info but maybe the most actionable suggestion here in this context would be that if the next patch file was named (say) &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13181&quot; title=&quot;NullPointerException in org.apache.solr.request.macro.MacroExpander&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13181&quot;&gt;&lt;del&gt;SOLR-13181&lt;/del&gt;&lt;/a&gt;.patch then the automatic validation of JIRA patches could be used with that. Hope that helps?)&lt;/p&gt;</comment>
                            <comment id="16758597" author="cesar.rodriguez" created="Fri, 1 Feb 2019 19:16:17 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke&quot; class=&quot;user-hover&quot; rel=&quot;cpoerschke&quot;&gt;cpoerschke&lt;/a&gt;, and sorry for the patch naming, I&apos;ve renamed the file now.&lt;/p&gt;

&lt;p&gt;I will try to write a test, but note that I found this bug using an automatic tool and I&apos;m not sure I follow the code very well!&lt;/p&gt;</comment>
                            <comment id="17196710" author="dsmiley" created="Wed, 16 Sep 2020 06:29:14 +0000"  >&lt;p&gt;I stumbled over this where I work and I see here there&apos;s this existing issue. See the PR.  I modified more lines and different than the one Cesar did as I tried to grok the code and clarify what&apos;s going on.&lt;/p&gt;</comment>
                            <comment id="17200342" author="jira-bot" created="Tue, 22 Sep 2020 19:52:23 +0000"  >&lt;p&gt;Commit 2197776be67384d628f12a5def8663db9e4220cf in lucene-solr&apos;s branch refs/heads/master from David Smiley&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=2197776&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=2197776&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13181&quot; title=&quot;NullPointerException in org.apache.solr.request.macro.MacroExpander&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13181&quot;&gt;&lt;del&gt;SOLR-13181&lt;/del&gt;&lt;/a&gt;: param macro expansion could throw (#1877)&lt;/p&gt;

&lt;p&gt;...StringIndexOutOfBoundsException on bad syntax&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;failOnMissingParams: should have been returning null (failing) on bad syntax cases&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Co-authored-by: Christine Poerschke &amp;lt;cpoerschke@apache.org&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17200358" author="jira-bot" created="Tue, 22 Sep 2020 20:13:06 +0000"  >&lt;p&gt;Commit 05b7a4a40d33403210a278c14ee951cfc2b7103f in lucene-solr&apos;s branch refs/heads/branch_8x from David Smiley&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=05b7a4a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=05b7a4a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13181&quot; title=&quot;NullPointerException in org.apache.solr.request.macro.MacroExpander&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13181&quot;&gt;&lt;del&gt;SOLR-13181&lt;/del&gt;&lt;/a&gt;: param macro expansion could throw (#1877)&lt;/p&gt;

&lt;p&gt;...StringIndexOutOfBoundsException on bad syntax&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;failOnMissingParams: should have been returning null (failing) on bad syntax cases&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Co-authored-by: Christine Poerschke &amp;lt;cpoerschke@apache.org&amp;gt;&lt;br/&gt;
(cherry picked from commit 2197776be67384d628f12a5def8663db9e4220cf)&lt;/p&gt;</comment>
                            <comment id="17226218" author="atri" created="Wed, 4 Nov 2020 15:22:59 +0000"  >&lt;p&gt;Closing after the 8.7.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12957302" name="SOLR-13181.patch" size="962" author="cesar.rodriguez" created="Fri, 1 Feb 2019 19:13:05 +0000"/>
                            <attachment id="12956736" name="home.zip" size="384713" author="cesar.rodriguez" created="Tue, 29 Jan 2019 15:59:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 1 week, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|yi0fzs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>