<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:34:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-4361] DIH request parameters with dots throws UnsupportedOperationException</title>
                <link>https://issues.apache.org/jira/browse/SOLR-4361</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;If the user puts placeholders for request parameters and these contain dots, DIH fails.  Current workaround is to either use no dots or use the 4.0 DIH jar.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12629303">SOLR-4361</key>
            <summary>DIH request parameters with dots throws UnsupportedOperationException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="jdyer">James Dyer</assignee>
                                    <reporter username="jdyer">James Dyer</reporter>
                        <labels>
                    </labels>
                <created>Fri, 25 Jan 2013 18:42:07 +0000</created>
                <updated>Sat, 29 Aug 2020 19:43:28 +0000</updated>
                            <resolved>Sat, 29 Aug 2020 19:43:28 +0000</resolved>
                                    <version>4.1</version>
                                    <fixVersion>4.9</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>contrib - DataImportHandler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13562900" author="jdyer" created="Fri, 25 Jan 2013 18:42:38 +0000"  >&lt;p&gt;Example from user list:&lt;/p&gt;

&lt;p&gt;I&apos;ve just tried to upgrade from 4.0 to 4.1 and I have the following&lt;br/&gt;
exception when reindexing my data:&lt;/p&gt;

&lt;p&gt;Caused by: java.lang.UnsupportedOperationException&lt;br/&gt;
 at java.util.Collections$UnmodifiableMap.put(Collections.java:1283)&lt;br/&gt;
at&lt;br/&gt;
org.apache.solr.handler.dataimport.VariableResolver.currentLevelMap(VariableResolver.java:204)&lt;br/&gt;
 at&lt;br/&gt;
org.apache.solr.handler.dataimport.VariableResolver.resolve(VariableResolver.java:94)&lt;br/&gt;
at&lt;br/&gt;
org.apache.solr.handler.dataimport.VariableResolver.replaceTokens(VariableResolver.java:144)&lt;br/&gt;
 at&lt;br/&gt;
org.apache.solr.handler.dataimport.ContextImpl.replaceTokens(ContextImpl.java:254)&lt;br/&gt;
at&lt;br/&gt;
org.apache.solr.handler.dataimport.JdbcDataSource.resolveVariables(JdbcDataSource.java:203)&lt;br/&gt;
 at&lt;br/&gt;
org.apache.solr.handler.dataimport.JdbcDataSource.createConnectionFactory(JdbcDataSource.java:101)&lt;br/&gt;
at&lt;br/&gt;
org.apache.solr.handler.dataimport.JdbcDataSource.init(JdbcDataSource.java:62)&lt;br/&gt;
 at&lt;br/&gt;
org.apache.solr.handler.dataimport.DataImporter.getDataSourceInstance(DataImporter.java:394)&lt;/p&gt;

&lt;p&gt;It seems to be related to the use of placeholders in data-config.xml:&lt;/p&gt;

&lt;p&gt;&amp;lt;dataConfig&amp;gt;&lt;br/&gt;
    &amp;lt;dataSource type=&quot;JdbcDataSource&quot;&lt;br/&gt;
                name=&quot;bceDS&quot;&lt;br/&gt;
                driver=&quot;${dataimporter.request.solr.bceDS.driver}&quot;&lt;br/&gt;
                url=&quot;${dataimporter.request.solr.bceDS.url}&quot;&lt;br/&gt;
                user=&quot;${dataimporter.request.solr.bceDS.user}&quot;&lt;br/&gt;
                password=&quot;${dataimporter.request.solr.bceDS.password}&quot;&lt;br/&gt;
                batchSize=&quot;-1&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;solrconfig.xml:&lt;/p&gt;

&lt;p&gt;&amp;lt;requestHandler name=&quot;/dataimport&quot;&lt;br/&gt;
class=&quot;org.apache.solr.handler.dataimport.DataImportHandler&quot;&amp;gt;&lt;br/&gt;
 &amp;lt;lst name=&quot;defaults&quot;&amp;gt;&lt;br/&gt;
&amp;lt;str name=&quot;config&quot;&amp;gt;data-config.xml&amp;lt;/str&amp;gt;&lt;/p&gt;

&lt;p&gt;&amp;lt;!-- dataSource parameters for data-config.xml --&amp;gt;&lt;br/&gt;
&amp;lt;str name=&quot;solr.bceDS.driver&quot;&amp;gt;...&amp;lt;/str&amp;gt;&lt;br/&gt;
 &amp;lt;str name=&quot;solr.bceDS.url&quot;&amp;gt;...&amp;lt;/str&amp;gt;&lt;br/&gt;
&amp;lt;str name=&quot;solr.bceDS.user&quot;&amp;gt;...&amp;lt;/str&amp;gt;&lt;br/&gt;
 &amp;lt;str name=&quot;solr.bceDS.password&quot;&amp;gt;...&amp;lt;/str&amp;gt;&lt;br/&gt;
&amp;lt;/lst&amp;gt;&lt;br/&gt;
&amp;lt;/requestHandler&amp;gt;&lt;/p&gt;</comment>
                            <comment id="13562947" author="jdyer" created="Fri, 25 Jan 2013 19:37:40 +0000"  >&lt;p&gt;Also, this workaround was mentioned.  This should be protected with a unit test so it doesn&apos;t get broken, also added to the wiki if not currently documented:&lt;/p&gt;

&lt;p&gt;I do something similar, but without the placeholders in db-data-config.xml. You can define the entire datasource in solrconfig.xml, then leave out that element entirely in db-data-config.xml. It seems really odd, but that is how the code works.&lt;/p&gt;

&lt;p&gt;This is working for me in 4.1, so it might be a workaround for you.&lt;/p&gt;

&lt;p&gt;It looks like this:&lt;/p&gt;

&lt;p&gt;  &amp;lt;requestHandler name=&quot;/dataimport&quot; class=&quot;org.apache.solr.handler.dataimport.DataImportHandler&quot;&amp;gt;&lt;br/&gt;
    &amp;lt;lst name=&quot;defaults&quot;&amp;gt;&lt;br/&gt;
      &amp;lt;str name=&quot;config&quot;&amp;gt;db-data-config.xml&amp;lt;/str&amp;gt;&lt;br/&gt;
      &amp;lt;lst name=&quot;datasource&quot;&amp;gt;&lt;br/&gt;
        &amp;lt;str name=&quot;defType&quot;&amp;gt;JdbcDataSource&amp;lt;/str&amp;gt;&lt;br/&gt;
        &amp;lt;str name=&quot;driver&quot;&amp;gt;com.mysql.jdbc.Driver&amp;lt;/str&amp;gt;&lt;br/&gt;
        &amp;lt;str name=&quot;url&quot;&amp;gt;jdbc:mysql://${textbooks.dbhost:nohost}/xxxx&amp;lt;/str&amp;gt;&lt;br/&gt;
        &amp;lt;str name=&quot;user&quot;&amp;gt;${textbooks.dbuser:yyyyy}&amp;lt;/str&amp;gt;&lt;br/&gt;
        &amp;lt;str name=&quot;password&quot;&amp;gt;${textbooks.dbpass:zzzzzz}&amp;lt;/str&amp;gt;&lt;br/&gt;
	&amp;lt;str name=&quot;batchSize&quot;&amp;gt;-1&amp;lt;/str&amp;gt;&lt;br/&gt;
	&amp;lt;str name=&quot;readOnly&quot;&amp;gt;true&amp;lt;/str&amp;gt;&lt;br/&gt;
	&amp;lt;str name=&quot;onError&quot;&amp;gt;skip&amp;lt;/str&amp;gt;&lt;br/&gt;
	&amp;lt;str name=&quot;netTimeoutForStreamingResults&quot;&amp;gt;600&amp;lt;/str&amp;gt;&lt;br/&gt;
	&amp;lt;str name=&quot;zeroDateTimeBehavior&quot;&amp;gt;convertToNull&amp;lt;/str&amp;gt;&lt;br/&gt;
      &amp;lt;/lst&amp;gt;&lt;br/&gt;
    &amp;lt;/lst&amp;gt;&lt;br/&gt;
  &amp;lt;/requestHandler&amp;gt;&lt;/p&gt;</comment>
                            <comment id="13597649" author="jdyer" created="Fri, 8 Mar 2013 22:43:25 +0000"  >&lt;p&gt;Here is a fix and a unit test.  All DIH tests pass with this.  I will commit in a few days.&lt;/p&gt;</comment>
                            <comment id="13599037" author="commit-tag-bot" created="Mon, 11 Mar 2013 17:40:37 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;trunk commit&amp;#93;&lt;/span&gt; James Dyer&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1455245&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1455245&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4361&quot; title=&quot;DIH request parameters with dots throws UnsupportedOperationException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4361&quot;&gt;&lt;del&gt;SOLR-4361&lt;/del&gt;&lt;/a&gt;: DIH to allow handler parameters with dots in the name&lt;/p&gt;</comment>
                            <comment id="13599043" author="commit-tag-bot" created="Mon, 11 Mar 2013 17:48:32 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; James Dyer&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1455247&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1455247&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4361&quot; title=&quot;DIH request parameters with dots throws UnsupportedOperationException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4361&quot;&gt;&lt;del&gt;SOLR-4361&lt;/del&gt;&lt;/a&gt;: DIH to allow handler parameters with dots in the name&lt;/p&gt;</comment>
                            <comment id="13609404" author="chris.eldredge" created="Thu, 21 Mar 2013 20:12:58 +0000"  >&lt;p&gt;Request to reopen this issue. Testing on lucene_solr_4_2 r1459428, TestURLDataSource is still broken when changing &quot;baseurl&quot; to &quot;base.url&quot; and &quot;${dataimporter.request.baseurl}&quot; to &quot;${dataimporter.request.base.url}&quot;.&lt;/p&gt;</comment>
                            <comment id="13609432" author="jdyer" created="Thu, 21 Mar 2013 20:30:24 +0000"  >&lt;p&gt;Chris,&lt;/p&gt;

&lt;p&gt;Do you have a real-world problem that is still broken, or is this just a problem with modifying TestURLDataSource?  This issue is tested in TestVariableResolverEndToEnd.  The solrconfig.xml file contains a default parameter &quot;dots.in.hsqldb.driver&quot; with the driver name.  The test subsequently references &amp;lt;dataSource ... driver=&quot;${dataimporter.request.dots.in.hsqldb.driver}&quot; ... /&amp;gt;.  Prior to fixing VariableResolver, this test would fail because the driver name would not resolve.  With this fix, the test passes.&lt;/p&gt;

&lt;p&gt;The difference is that the &quot;dataimporter.request&quot; namespaces are (in reality) added by DocBuilder#getVariableResolver by creating a map for the &quot;dataimporter&quot; namespace and then a child map for the &quot;request&quot; namespace.  With the fix here, VariableResolver is still requiring each node in the Variable tree to be added individually, rather than taking the shortcut you used in your modified version of TestURLDataSource.  However, it is more forgiving with variable names containing dots:  if it cannot walk the tree to find the rightmost name, then it goes as far as it can and then assumes the rest is a name with embedded dots in it.&lt;/p&gt;</comment>
                            <comment id="13609493" author="chris.eldredge" created="Thu, 21 Mar 2013 21:16:37 +0000"  >&lt;p&gt;Yes, upgrading from 4.0 to 4.2 breaks DIH for me. I&apos;m using the URLDataSource with variables in the baseUrl, such as dataimport.request.server.prefix. The properties are all replaced with empty strings whereas in 4.0 they&apos;re correctly substituted. I&apos;ll test using variables that don&apos;t contain dots to make sure it&apos;s related to this issue.&lt;/p&gt;</comment>
                            <comment id="13609511" author="jdyer" created="Thu, 21 Mar 2013 21:30:05 +0000"  >&lt;p&gt;If this is still a problem for you, by all means, reopen.  Please include the line in your data-config.xml that has the variable that doesn&apos;t resolve and also the url you&apos;re using (or section from solrconfig.xml that has the variable in &quot;defaults&quot;).  Based on TestVariableResolverEndToEnd, which does something very similar to what you describe, I would not expect this to still fail. &lt;/p&gt;</comment>
                            <comment id="13614464" author="chris.eldredge" created="Tue, 26 Mar 2013 19:42:33 +0000"  >&lt;p&gt;I don&apos;t have permission to reopen the issue, but I just confirmed that URLDataSource does not correctly replace variables that contain dots in its baseUrl. However, it substitutes an empty string instead of throwing UnsupportedOperationException.&lt;/p&gt;

&lt;p&gt;Removing the dots still works around the issue.&lt;/p&gt;

&lt;p&gt;I tested against &lt;a href=&quot;https://svn.apache.org/repos/asf/lucene/dev/branches/lucene_solr_4_2@1460810&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/repos/asf/lucene/dev/branches/lucene_solr_4_2@1460810&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13614469" author="jdyer" created="Tue, 26 Mar 2013 19:45:55 +0000"  >&lt;p&gt;re-open to investigate the issue reported by Chris Eldredge.  &lt;/p&gt;

&lt;p&gt;Chris, Can you provide (at least) the line in your data-config.xml that has the variable that doesn&apos;t resolve and also the url you&apos;re using (or section from solrconfig.xml that has the variable in &quot;defaults&quot;).&lt;/p&gt;</comment>
                            <comment id="13614485" author="chris.eldredge" created="Tue, 26 Mar 2013 19:56:39 +0000"  >&lt;p&gt;Snippet of our configuration that stopped working in 4.2:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;solrconfig.xml&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;requestHandler name=&lt;span class=&quot;code-quote&quot;&gt;&quot;/dataimport&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.solr.handler.dataimport.DataImportHandler&quot;&lt;/span&gt;&amp;gt;
  &amp;lt;lst name=&lt;span class=&quot;code-quote&quot;&gt;&quot;defaults&quot;&lt;/span&gt;&amp;gt;
    &amp;lt;str name=&lt;span class=&quot;code-quote&quot;&gt;&quot;server.prefix&quot;&lt;/span&gt;&amp;gt;${server.prefix:}&amp;lt;/str&amp;gt;
  &amp;lt;/lst&amp;gt;
&amp;lt;/requestHandler&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;data-config.xml&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;dataSource type=&lt;span class=&quot;code-quote&quot;&gt;&quot;URLDataSource&quot;&lt;/span&gt; baseUrl=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//${dataimporter.request.server.prefix}api.fool.com&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Changing server.prefix to server-prefix makes it work again.&lt;/p&gt;</comment>
                            <comment id="13614545" author="chris.eldredge" created="Tue, 26 Mar 2013 21:01:25 +0000"  >&lt;p&gt;By the way, in case it isn&apos;t clear, we define &lt;tt&gt;server.prefix&lt;/tt&gt; as a system property and it defaults to &lt;tt&gt;&quot;&quot;&lt;/tt&gt; in production, but it would be something like &lt;tt&gt;&quot;test.&quot;&lt;/tt&gt; in pre-production to produce a complete baseUrl like &lt;tt&gt;&lt;a href=&quot;http://test.api.fool.com&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://test.api.fool.com&lt;/a&gt;&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="13717236" author="steve_rowe" created="Tue, 23 Jul 2013 18:47:34 +0000"  >&lt;p&gt;Bulk move 4.4 issues to 4.5 and 5.0&lt;/p&gt;</comment>
                            <comment id="13971042" author="thetaphi" created="Wed, 16 Apr 2014 12:56:58 +0000"  >&lt;p&gt;Move issue to Solr 4.9.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                                                <inwardlinks description="is superceded by">
                                        <issuelink>
            <issuekey id="13324904">SOLR-14783</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12572849" name="SOLR-4361.patch" size="6285" author="jdyer" created="Fri, 8 Mar 2013 22:43:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>309399</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 31 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1eyzr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>295598</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>