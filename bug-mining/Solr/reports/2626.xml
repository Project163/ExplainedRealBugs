<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:07:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-7990] timeAllowed is returning wrong results on the same query submitted with different timeAllowed limits</title>
                <link>https://issues.apache.org/jira/browse/SOLR-7990</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;William Bell raised a question on the user&apos;s list. The scenario is&lt;br/&gt;
&amp;gt; send a query that exceeds timeAllowed&lt;br/&gt;
&amp;gt; send another identical query with larger timeAllowed that does NOT time out&lt;/p&gt;

&lt;p&gt;The results from the second query are not correct, they reflect the doc count from the first query.&lt;/p&gt;

&lt;p&gt;It apparently has to do with filter queries being inappropriately created and re-used. I&apos;ve attached a test case that illustrates the problem.&lt;/p&gt;

&lt;p&gt;There are three tests here. &lt;br/&gt;
testFilterSimpleCase shows the problem.&lt;/p&gt;

&lt;p&gt;testCacheAssumptions is my hack at what I &lt;em&gt;think&lt;/em&gt; the states of the caches should be, but has a bunch of clutter so I&apos;m Ignoring it for now. This should be un-ignored and testFilterSimpleCase removed when there&apos;s any fix proposed. The assumptions may not be correct though.&lt;/p&gt;

&lt;p&gt;testQueryResults shows what I think is a problem, the second call that does NOT exceed timeAllowed still reports partial results.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12860529">SOLR-7990</key>
            <summary>timeAllowed is returning wrong results on the same query submitted with different timeAllowed limits</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                    <reporter username="erickerickson">Erick Erickson</reporter>
                        <labels>
                    </labels>
                <created>Sat, 29 Aug 2015 22:23:33 +0000</created>
                <updated>Mon, 9 May 2016 18:56:02 +0000</updated>
                            <resolved>Wed, 9 Sep 2015 15:05:45 +0000</resolved>
                                    <version>5.2.1</version>
                    <version>5.4</version>
                    <version>6.0</version>
                                    <fixVersion>5.3.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14721277" author="erickerickson" created="Sat, 29 Aug 2015 22:24:51 +0000"  >&lt;p&gt;Failing test cases, no fixes though.&lt;/p&gt;</comment>
                            <comment id="14721558" author="erickerickson" created="Sun, 30 Aug 2015 15:13:57 +0000"  >&lt;p&gt;testQueryResults was a bad test, didn&apos;t test for null so that test was inappropriately failing when looking for partial results after the second search&lt;/p&gt;</comment>
                            <comment id="14729300" author="yseeley@gmail.com" created="Thu, 3 Sep 2015 15:51:19 +0000"  >&lt;p&gt;Here&apos;s a patch that should fix the filter issue.&lt;/p&gt;

&lt;p&gt;The bad code was in getDocSetNC (I have since moved that code to DocSetUtil) that caught the exception and logged a warning but did nothing else.&lt;/p&gt;

&lt;p&gt;Since we don&apos;t know the context that the DocSet will be used in, we can&apos;t catch the exception there.  It may be cached later.  It may even be negated - there are multiple places this can happen, such as a pure-negative filter query.  In that case, terminating early could result in matching documents that would otherwise have never matched!&lt;/p&gt;

&lt;p&gt;Here&apos;s a simple match removing the exception swallow.&lt;/p&gt;

&lt;p&gt;edit: this isn&apos;t a complete patch - I haven&apos;t run tests, and I don&apos;t know if this breaks other tests.&lt;/p&gt;</comment>
                            <comment id="14729313" author="erickerickson" created="Thu, 3 Sep 2015 16:00:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yseeley%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;yseeley@gmail.com&quot;&gt;yseeley@gmail.com&lt;/a&gt; Cool, I just assigned it to myself to not lose track it, wasn&apos;t going to be getting around to it for a while. Want me to run with it?&lt;/p&gt;</comment>
                            <comment id="14729318" author="yseeley@gmail.com" created="Thu, 3 Sep 2015 16:04:58 +0000"  >&lt;p&gt;Yeah sure, I was just running the full tests, and it does look like some fail now.  Not sure if it&apos;s a test bug or if we&apos;re missing a high level catch of this exception...&lt;/p&gt;</comment>
                            <comment id="14729442" author="erickerickson" created="Thu, 3 Sep 2015 17:35:49 +0000"  >&lt;p&gt;I don&apos;t particularly have any investment in owning this, mostly volunteering to do the scutwork......&lt;/p&gt;</comment>
                            <comment id="14729680" author="erickerickson" created="Thu, 3 Sep 2015 19:59:32 +0000"  >&lt;p&gt;The test I added for this condition still fails though for a start.. testSimpleFilterCase...&lt;/p&gt;</comment>
                            <comment id="14735144" author="yseeley@gmail.com" created="Tue, 8 Sep 2015 16:54:10 +0000"  >&lt;p&gt;This patch makes all the tests pass and should fix the issue with a partial filter being cached.&lt;/p&gt;

&lt;p&gt;Still needs a test that fails w/o it though.  I&apos;ll also try to look at why your test fails.&lt;/p&gt;</comment>
                            <comment id="14735256" author="yseeley@gmail.com" created="Tue, 8 Sep 2015 17:46:41 +0000"  >&lt;p&gt;Actually, I may just try to rewrite the ExitableDirectoryReaderTest, as that test uses no caches and hence can&apos;t test if it&apos;s caching any partial results.&lt;/p&gt;</comment>
                            <comment id="14735291" author="erickerickson" created="Tue, 8 Sep 2015 18:01:38 +0000"  >&lt;p&gt;Right, I ripped this test off ExitableDirectoryReaderTest just to get a fast-n-dirty isolation of the issue, see the nocommit comments &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;

&lt;p&gt;So yeah, piggy-backing this off ExitableDirectoryTest seems like A Good Thing.&lt;/p&gt;</comment>
                            <comment id="14735368" author="yseeley@gmail.com" created="Tue, 8 Sep 2015 18:43:56 +0000"  >&lt;p&gt;Here&apos;s the latest patch with the rewritten ExitableDirectoryReaderTest.  It fails without the patch and passes with it.&lt;/p&gt;</comment>
                            <comment id="14735415" author="yseeley@gmail.com" created="Tue, 8 Sep 2015 19:02:51 +0000"  >&lt;p&gt;OK, I figured out why your test was failing... there were no name:a* docs because you overwrote them all with name:b* docs in createIndex &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14735628" author="erickerickson" created="Tue, 8 Sep 2015 21:16:42 +0000"  >&lt;p&gt;Seems I&apos;m the statue more often than the pigeon lately....&lt;/p&gt;

&lt;p&gt;assertU(adoc(&quot;id&quot;, Integer.toString(idx), &quot;name&quot;, &quot;b&quot; + idx + NUM_DOCS));&lt;/p&gt;

&lt;p&gt;should have been&lt;/p&gt;

&lt;p&gt;assertU(adoc(&quot;id&quot;, Integer.toString(idx + NUM_DOCS), &quot;name&quot;, &quot;b&quot; + idx));&lt;/p&gt;

&lt;p&gt;Oops.&lt;/p&gt;</comment>
                            <comment id="14735666" author="yseeley@gmail.com" created="Tue, 8 Sep 2015 21:37:16 +0000"  >&lt;p&gt;I&apos;m working on test fixes... my test changes were no good since the timeAllowed does not include query parsing time (which is where the time goes in the sleep function).&lt;/p&gt;</comment>
                            <comment id="14735788" author="yseeley@gmail.com" created="Tue, 8 Sep 2015 23:02:10 +0000"  >&lt;p&gt;Here&apos;s the final patch.&lt;br/&gt;
I also incorporated parts of Erick&apos;s test and modified the delay component to take a parameter that tells it how long to sleep.&lt;/p&gt;</comment>
                            <comment id="14736040" author="yseeley@gmail.com" created="Wed, 9 Sep 2015 02:49:11 +0000"  >&lt;p&gt;Oops, forgot to take care of the cloud version of the test.  Here&apos;s another patch.&lt;/p&gt;</comment>
                            <comment id="14736889" author="jira-bot" created="Wed, 9 Sep 2015 14:00:44 +0000"  >&lt;p&gt;Commit 1702015 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1702015&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1702015&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7990&quot; title=&quot;timeAllowed is returning wrong results on the same query submitted with different timeAllowed limits&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7990&quot;&gt;&lt;del&gt;SOLR-7990&lt;/del&gt;&lt;/a&gt;: don&apos;t swallow ExitingReaderException&lt;/p&gt;</comment>
                            <comment id="14736897" author="jira-bot" created="Wed, 9 Sep 2015 14:03:00 +0000"  >&lt;p&gt;Commit 1702016 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1702016&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1702016&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7990&quot; title=&quot;timeAllowed is returning wrong results on the same query submitted with different timeAllowed limits&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7990&quot;&gt;&lt;del&gt;SOLR-7990&lt;/del&gt;&lt;/a&gt;: don&apos;t swallow ExitingReaderException&lt;/p&gt;</comment>
                            <comment id="14736924" author="yseeley@gmail.com" created="Wed, 9 Sep 2015 14:20:44 +0000"  >&lt;p&gt;Merging back to 5.3.1 had conflicts, so needed some backport... running full tests now.&lt;/p&gt;</comment>
                            <comment id="14736998" author="jira-bot" created="Wed, 9 Sep 2015 15:04:44 +0000"  >&lt;p&gt;Commit 1702037 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt; in branch &apos;dev/branches/lucene_solr_5_3&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1702037&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1702037&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7990&quot; title=&quot;timeAllowed is returning wrong results on the same query submitted with different timeAllowed limits&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7990&quot;&gt;&lt;del&gt;SOLR-7990&lt;/del&gt;&lt;/a&gt;: don&apos;t swallow ExitingReaderException&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12754802" name="SOLR-7990.patch" size="16922" author="yseeley@gmail.com" created="Wed, 9 Sep 2015 02:49:11 +0000"/>
                            <attachment id="12754757" name="SOLR-7990.patch" size="15216" author="yseeley@gmail.com" created="Tue, 8 Sep 2015 23:02:10 +0000"/>
                            <attachment id="12754693" name="SOLR-7990.patch" size="9012" author="yseeley@gmail.com" created="Tue, 8 Sep 2015 18:43:56 +0000"/>
                            <attachment id="12754669" name="SOLR-7990.patch" size="2477" author="yseeley@gmail.com" created="Tue, 8 Sep 2015 16:54:10 +0000"/>
                            <attachment id="12753193" name="SOLR-7990.patch" size="9700" author="erickerickson" created="Sun, 30 Aug 2015 15:13:57 +0000"/>
                            <attachment id="12753154" name="SOLR-7990.patch" size="11308" author="erickerickson" created="Sat, 29 Aug 2015 22:24:51 +0000"/>
                            <attachment id="12754010" name="SOLR-7990_filterFix.patch" size="1179" author="yseeley@gmail.com" created="Thu, 3 Sep 2015 15:51:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 10 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2jklj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>