<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:29:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-3790] NullPointerException and ConcurrentModificationException are thrown when searching with highlighter</title>
                <link>https://issues.apache.org/jira/browse/SOLR-3790</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Hi, Im using Solr 3.5.&lt;/p&gt;

&lt;p&gt;I found strange phenomenon in solr log.&lt;br/&gt;
This phenomenon has two exceptions that NullPointerException and ConcurrentModificationException.&lt;br/&gt;
These exceptions are thrown by discrete threads.&lt;/p&gt;

&lt;p&gt;I think, The same two queries thrown at same time because error log recorded at same time. But I can&apos;t reproduce it.&lt;br/&gt;
Does anyone have the same phenomenon?&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2012-08-21 00:07:49,868 [qtp979682126-953] INFO  SolrCore - [c3] webapp=/solr path=/select params={hl.tag.post=[%02]&amp;amp;sort=score+desc&amp;amp;hl.tag.pre=[%01]&amp;amp;hl.fl=*&amp;amp;wt=javabin&amp;amp;hl=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;defType=normalizeQParser&amp;amp;rows=40&amp;amp;version=2&amp;amp;fl=score,*&amp;amp;hl.useFastVectorHighlighter=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;start=0&amp;amp;q=hoge&amp;amp;fq=((ap.l:&lt;span class=&quot;code-quote&quot;&gt;&quot;771&quot;&lt;/span&gt;)+AND+(*:*))} hits=4 status=500 QTime=164 
2012-08-21 00:07:49,868 [qtp979682126-938] INFO  SolrCore - [c3] webapp=/solr path=/select params={hl.tag.post=[%02]&amp;amp;sort=score+desc&amp;amp;hl.tag.pre=[%01]&amp;amp;hl.fl=*&amp;amp;wt=javabin&amp;amp;hl=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;defType=normalizeQParser&amp;amp;rows=12&amp;amp;version=2&amp;amp;fl=score,*&amp;amp;hl.useFastVectorHighlighter=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;start=0&amp;amp;q=hoge&amp;amp;fq=((ap.l:&lt;span class=&quot;code-quote&quot;&gt;&quot;771&quot;&lt;/span&gt;)+AND+(*:*))} hits=4 status=500 QTime=1094 
2012-08-21 00:07:49,873 [qtp979682126-953] ERROR SolrDispatchFilter - java.util.ConcurrentModificationException
        at java.util.LinkedList$ListItr.checkForComodification(LinkedList.java:778)
        at java.util.LinkedList$ListItr.next(LinkedList.java:713)
        at org.apache.solr.highlight.SolrHighlighter.getHighlightFields(SolrHighlighter.java:106)
        at org.apache.solr.util.SolrPluginUtils.optimizePreFetchDocs(SolrPluginUtils.java:259)
        at org.apache.solr.handler.component.QueryComponent.doPrefetch(QueryComponent.java:478)
        at org.apache.solr.handler.component.QueryComponent.process(QueryComponent.java:385)
        at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:194)
        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:129)
        at org.apache.solr.core.SolrCore.execute(SolrCore.java:1372)
        at org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:356)
        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:252)
        at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1337)
        at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:486)
        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:119)
        at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:520)
        at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:233)
        at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:973)
        at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:417)
        at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:192)
        at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:907)
        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:117)
        at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:250)
        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:110)
        at org.eclipse.jetty.server.Server.handle(Server.java:350)
        at org.eclipse.jetty.server.HttpConnection.handleRequest(HttpConnection.java:442)
        at org.eclipse.jetty.server.HttpConnection$RequestHandler.content(HttpConnection.java:941)
        at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:801)
        at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:224)
        at org.eclipse.jetty.server.AsyncHttpConnection.handle(AsyncHttpConnection.java:51)
        at org.eclipse.jetty.io.nio.SelectChannelEndPoint.handle(SelectChannelEndPoint.java:586)
        at org.eclipse.jetty.io.nio.SelectChannelEndPoint$1.run(SelectChannelEndPoint.java:44)
        at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:598)
        at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:533)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:679)

2012-08-21 00:07:49,873 [qtp979682126-938] ERROR SolrDispatchFilter - java.lang.NullPointerException
        at org.apache.solr.highlight.SolrHighlighter.getHighlightFields(SolrHighlighter.java:107)
        at org.apache.solr.util.SolrPluginUtils.optimizePreFetchDocs(SolrPluginUtils.java:259)
        at org.apache.solr.handler.component.QueryComponent.doPrefetch(QueryComponent.java:478)
        at org.apache.solr.handler.component.QueryComponent.process(QueryComponent.java:385)
        at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:194)
        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:129)
        at org.apache.solr.core.SolrCore.execute(SolrCore.java:1372)
        at org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:356)
        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:252)
        at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1337)
        at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:486)
        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:119)
        at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:520)
        at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:233)
        at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:973)
        at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:417)
        at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:192)
        at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:907)
        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:117)
        at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:250)
        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:110)
        at org.eclipse.jetty.server.Server.handle(Server.java:350)
        at org.eclipse.jetty.server.HttpConnection.handleRequest(HttpConnection.java:442)
        at org.eclipse.jetty.server.HttpConnection$RequestHandler.content(HttpConnection.java:941)
        at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:801)
        at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:224)
        at org.eclipse.jetty.server.AsyncHttpConnection.handle(AsyncHttpConnection.java:51)
        at org.eclipse.jetty.io.nio.SelectChannelEndPoint.handle(SelectChannelEndPoint.java:586)
        at org.eclipse.jetty.io.nio.SelectChannelEndPoint$1.run(SelectChannelEndPoint.java:44)
        at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:598)
        at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:533)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:679)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is rarely accident? These are discrete bug?&lt;/p&gt;

&lt;p&gt;See: Similar phenomenon&lt;br/&gt;
&lt;a href=&quot;http://lucene.472066.n3.nabble.com/Null-Pointer-Exception-in-SOLR-td3954952.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://lucene.472066.n3.nabble.com/Null-Pointer-Exception-in-SOLR-td3954952.html&lt;/a&gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;Ubuntu 12.04, Solr 3.5&lt;/p&gt;</environment>
        <key id="12606216">SOLR-3790</key>
            <summary>NullPointerException and ConcurrentModificationException are thrown when searching with highlighter</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="koji">Koji Sekiguchi</assignee>
                                    <reporter username="shou.aoki">shou aoki</reporter>
                        <labels>
                    </labels>
                <created>Wed, 5 Sep 2012 08:38:00 +0000</created>
                <updated>Mon, 9 May 2016 18:55:16 +0000</updated>
                            <resolved>Thu, 6 Sep 2012 07:45:25 +0000</resolved>
                                    <version>3.5</version>
                                    <fixVersion>3.6.2</fixVersion>
                    <fixVersion>4.0</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>highlighter</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13448798" author="koji" created="Wed, 5 Sep 2012 14:49:32 +0000"  >&lt;p&gt;Hmm, this is not good. I think storedHighlightFieldNames in SolrIndexSearcher could be initialized twice in getStoredHighlightFieldNames() method:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Collection&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; getStoredHighlightFieldNames() {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (storedHighlightFieldNames == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      storedHighlightFieldNames = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; LinkedList&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;();
      &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; fieldName : fieldNames) {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
          SchemaField field = schema.getField(fieldName);
          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (field.stored() &amp;amp;&amp;amp;
                  ((field.getType() &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; org.apache.solr.schema.TextField) ||
                  (field.getType() &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; org.apache.solr.schema.StrField))) {
            storedHighlightFieldNames.add(fieldName);
          }
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (RuntimeException e) { &lt;span class=&quot;code-comment&quot;&gt;// getField() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; a SolrException, but it arrives as a RuntimeException
&lt;/span&gt;            log.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Field \&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot; + fieldName + &quot;&lt;/span&gt;\&lt;span class=&quot;code-quote&quot;&gt;&quot; found in index, but not defined in schema.&quot;&lt;/span&gt;);
        }
      }
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; storedHighlightFieldNames;
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think the initialization block should go to constructor. Meanwhile, Aoki-san, you can avoid the bug by specifying the explicit field names for hl.fl parameter instead of using &quot;*&quot;.&lt;/p&gt;</comment>
                            <comment id="13449301" author="shou.aoki" created="Thu, 6 Sep 2012 00:24:47 +0000"  >&lt;p&gt;Thank you Mr.Sekiguchi.&lt;br/&gt;
I read your blog often, I respect for you.&lt;/p&gt;

&lt;p&gt;OK, I&apos;ll investigate that hl.fl parameter assigned expect &quot;*&quot;.&lt;br/&gt;
Thank you.&lt;/p&gt;</comment>
                            <comment id="13449473" author="koji" created="Thu, 6 Sep 2012 06:54:10 +0000"  >&lt;p&gt;This bug has not been filed but fixed in trunk and branch_4x at r1231606:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/viewvc/lucene/dev/trunk/solr/core/src/java/org/apache/solr/search/SolrIndexSearcher.java?r1=1229401&amp;amp;r2=1231606&amp;amp;diff_format=h&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc/lucene/dev/trunk/solr/core/src/java/org/apache/solr/search/SolrIndexSearcher.java?r1=1229401&amp;amp;r2=1231606&amp;amp;diff_format=h&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ll backport it to 3.6 branch and close the ticket shortly.&lt;/p&gt;</comment>
                            <comment id="13449500" author="koji" created="Thu, 6 Sep 2012 07:45:25 +0000"  >&lt;p&gt;Done.&lt;/p&gt;</comment>
                            <comment id="13610912" author="commit-tag-bot" created="Fri, 22 Mar 2013 16:43:49 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; Koji Sekiguchi&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1381495&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1381495&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3790&quot; title=&quot;NullPointerException and ConcurrentModificationException are thrown when searching with highlighter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3790&quot;&gt;&lt;del&gt;SOLR-3790&lt;/del&gt;&lt;/a&gt;: ConcurrentModificationException could be thrown when using hl.fl=*&lt;/p&gt;</comment>
                            <comment id="13654102" author="thetaphi" created="Fri, 10 May 2013 10:34:02 +0000"  >&lt;p&gt;Closed after release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>243200</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 28 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03cm7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>17477</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>