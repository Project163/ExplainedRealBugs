<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:45:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-5689] On reconnect, ZkController cancels election on first context rather than latest</title>
                <link>https://issues.apache.org/jira/browse/SOLR-5689</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;I haven&apos;t tested this yet, so I could be wrong, but this is my reading of the code:&lt;br/&gt;
During init:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ElectionContext context = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; OverseerElectionContext(zkClient, overseer, getNodeName());
overseerElector.setup(context);
overseerElector.joinElection(context, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;On reconnect:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ElectionContext context = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; OverseerElectionContext(zkClient,overseer, getNodeName());
              
ElectionContext prevContext = overseerElector.getContext();
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (prevContext != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
  prevContext.cancelElection();
}
              
overseerElector.joinElection(context, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;setup doesn&apos;t appear to be called on reconnect, so the new context is never set and the first context gets cancelled over and over.&lt;/p&gt;

&lt;p&gt;A call to overseerElector.setup(context); before joinElection in the reconnect case would address this.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12692753">SOLR-5689</key>
            <summary>On reconnect, ZkController cancels election on first context rather than latest</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shalin">Shalin Shekhar Mangar</assignee>
                                    <reporter username="gchanan">Gregory Chanan</reporter>
                        <labels>
                    </labels>
                <created>Sun, 2 Feb 2014 22:34:17 +0000</created>
                <updated>Mon, 9 May 2016 18:57:05 +0000</updated>
                            <resolved>Tue, 11 Feb 2014 11:14:25 +0000</resolved>
                                    <version>4.6.1</version>
                    <version>4.7</version>
                    <version>6.0</version>
                                    <fixVersion>4.7</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="13889390" author="dancollins" created="Mon, 3 Feb 2014 11:14:37 +0000"  >&lt;p&gt;My understanding of what `LeaderElector.setup()` does is that it just creates the `/overseer_elect/election` &quot;directory&quot; in ZK.  This isn&apos;t ephemeral, so in reality should only be a one-off job?  Unless ZK has been wiped whilst the node was disconnected from ZK, that directory should still be there.  It shouldn&apos;t hurt to add in the call to setup in reconnect, but I don&apos;t believe it is necessary.&lt;/p&gt;

&lt;p&gt;cancelElection() removes the `leaderSeqPath` which is the ephemeral node(s) under that &quot;directory&quot;, e.g. &quot;19127283862405127-xxxxxxx:yyyyy_solr-n_0000000368&quot; in my case.&lt;/p&gt;</comment>
                            <comment id="13889551" author="markrmiller@gmail.com" created="Mon, 3 Feb 2014 15:23:12 +0000"  >&lt;p&gt;It also sets the latest context on the elector though - which we want to make sure is always the latest so that if for some reason we are asked to join the election again and are already participating, we cancel our participation first.&lt;/p&gt;</comment>
                            <comment id="13889607" author="dancollins" created="Mon, 3 Feb 2014 16:42:02 +0000"  >&lt;p&gt;DOH, my bad, missed that line, too used to expecting whitespace line between bracket and first code statement, must be a bug in my brain&apos;s Java parser.&lt;/p&gt;</comment>
                            <comment id="13897730" author="shalinmangar" created="Tue, 11 Feb 2014 11:07:56 +0000"  >&lt;p&gt;Trivial fix attached. I&apos;ll commit once the test suite succeeds.&lt;/p&gt;</comment>
                            <comment id="13897736" author="jira-bot" created="Tue, 11 Feb 2014 11:11:57 +0000"  >&lt;p&gt;Commit 1567049 from shalin@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1567049&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1567049&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5689&quot; title=&quot;On reconnect, ZkController cancels election on first context rather than latest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5689&quot;&gt;&lt;del&gt;SOLR-5689&lt;/del&gt;&lt;/a&gt;: On reconnect, ZkController cancels election on first context rather than latest&lt;/p&gt;</comment>
                            <comment id="13897737" author="jira-bot" created="Tue, 11 Feb 2014 11:13:06 +0000"  >&lt;p&gt;Commit 1567050 from shalin@apache.org in branch &apos;dev/branches/branch_4x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1567050&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1567050&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5689&quot; title=&quot;On reconnect, ZkController cancels election on first context rather than latest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5689&quot;&gt;&lt;del&gt;SOLR-5689&lt;/del&gt;&lt;/a&gt;: On reconnect, ZkController cancels election on first context rather than latest&lt;/p&gt;</comment>
                            <comment id="13897740" author="shalinmangar" created="Tue, 11 Feb 2014 11:14:25 +0000"  >&lt;p&gt;Thanks Gregory!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12628187" name="SOLR-5689.patch" size="629" author="shalin" created="Tue, 11 Feb 2014 11:07:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>371348</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 41 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1rzzj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>371651</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>