<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:20:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-1993] SolrJ binary update erro when commitWithin is set.</title>
                <link>https://issues.apache.org/jira/browse/SOLR-1993</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Solr server is unable to unmarshall a binary update request where the commitWithin property is set on the UpdateRequest class.&lt;/p&gt;

&lt;p&gt;The client marshalls the request with the following code&lt;br/&gt;
if (updateRequest.getCommitWithin() != -1) {&lt;br/&gt;
      params.add(&quot;commitWithin&quot;, updateRequest.getCommitWithin());&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;The property is an int and when the server unmarshalls, the following error happens (can&apos;t cast to List&amp;lt;String&amp;gt; due to an Integer element)&lt;/p&gt;

&lt;p&gt;SEVERE: java.lang.ClassCastException: java.lang.Integer cannot be cast to java.util.List&lt;br/&gt;
        at org.apache.solr.client.solrj.request.JavaBinUpdateRequestCodec.namedListToSolrParams(JavaBinUpdateRequestCodec.java:213)&lt;br/&gt;
        at org.apache.solr.client.solrj.request.JavaBinUpdateRequestCodec.access$100(JavaBinUpdateRequestCodec.java:40)&lt;br/&gt;
        at org.apache.solr.client.solrj.request.JavaBinUpdateRequestCodec$2.readOuterMostDocIterator(JavaBinUpdateRequestCodec.java:131)&lt;br/&gt;
        at org.apache.solr.client.solrj.request.JavaBinUpdateRequestCodec$2.readIterator(JavaBinUpdateRequestCodec.java:126)&lt;br/&gt;
        at org.apache.solr.common.util.JavaBinCodec.readVal(JavaBinCodec.java:210)&lt;br/&gt;
        at org.apache.solr.client.solrj.request.JavaBinUpdateRequestCodec$2.readNamedList(JavaBinUpdateRequestCodec.java:112)&lt;br/&gt;
        at org.apache.solr.common.util.JavaBinCodec.readVal(JavaBinCodec.java:175)&lt;br/&gt;
        at org.apache.solr.common.util.JavaBinCodec.unmarshal(JavaBinCodec.java:101)&lt;br/&gt;
        at org.apache.solr.client.solrj.request.JavaBinUpdateRequestCodec.unmarshal(JavaBinUpdateRequestCodec.java:141)&lt;br/&gt;
        at org.apache.solr.handler.BinaryUpdateRequestHandler.parseAndLoadDocs(BinaryUpdateRequestHandler.java:68)&lt;br/&gt;
        at org.apache.solr.handler.BinaryUpdateRequestHandler.access$000(BinaryUpdateRequestHandler.java:46)&lt;br/&gt;
        at org.apache.solr.handler.BinaryUpdateRequestHandler$1.load(BinaryUpdateRequestHandler.java:55)&lt;br/&gt;
        at org.apache.solr.handler.ContentStreamHandlerBase.handleRequestBody(ContentStreamHandlerBase.java:54)&lt;br/&gt;
        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:131)&lt;br/&gt;
        at org.apache.solr.core.SolrCore.execute(SolrCore.java:1316)&lt;br/&gt;
        at org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:338)&lt;br/&gt;
        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:241)&lt;br/&gt;
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)&lt;br/&gt;
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)&lt;br/&gt;
        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)&lt;br/&gt;
        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)&lt;br/&gt;
        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:128)&lt;br/&gt;
        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)&lt;br/&gt;
        at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:567)&lt;br/&gt;
        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)&lt;br/&gt;
        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:293)&lt;br/&gt;
        at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:849)&lt;br/&gt;
        at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:583)&lt;br/&gt;
        at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:454)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:619)&lt;/p&gt;

&lt;p&gt;Workaround is to set the parameter manually as a string value instead of setting using the property on the UpdateRequest class.&lt;/p&gt;


</description>
                <environment></environment>
        <key id="12468878">SOLR-1993</key>
            <summary>SolrJ binary update erro when commitWithin is set.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="bixby">Phil Bingley</reporter>
                        <labels>
                    </labels>
                <created>Fri, 9 Jul 2010 01:21:56 +0000</created>
                <updated>Wed, 30 Mar 2011 15:45:54 +0000</updated>
                            <resolved>Tue, 21 Dec 2010 19:35:49 +0000</resolved>
                                    <version>1.4</version>
                    <version>1.4.1</version>
                                    <fixVersion>1.4.2</fixVersion>
                    <fixVersion>3.1</fixVersion>
                    <fixVersion>4.0-ALPHA</fixVersion>
                                    <component>clients - java</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12928835" author="noble.paul" created="Fri, 5 Nov 2010 21:46:31 +0000"  >&lt;p&gt;Added a constructor to ModifiableSolrParams(NamedList)&lt;/p&gt;</comment>
                            <comment id="12928843" author="noble.paul" created="Fri, 5 Nov 2010 22:00:02 +0000"  >&lt;p&gt;untested patch&lt;/p&gt;

&lt;p&gt;Added a constructor to ModifiableSolrParams(NamedList)&lt;/p&gt;</comment>
                            <comment id="12970771" author="maxim.valyanskiy" created="Mon, 13 Dec 2010 10:40:56 +0000"  >&lt;p&gt;Paul, could you show workaround code example? &lt;/p&gt;</comment>
                            <comment id="12970773" author="noble.paul" created="Mon, 13 Dec 2010 10:43:59 +0000"  >&lt;p&gt;This patch has the fix. There is no work around&lt;/p&gt;</comment>
                            <comment id="12970927" author="hossman" created="Mon, 13 Dec 2010 18:06:20 +0000"  >&lt;p&gt;before committing this patch, I was going to modify one of the existing SolrJ tests to set commitWithin to demonstrate the bug (and then the fix) but i then discovered that SolrExampleTests already uses commitWithin...&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    UpdateRequest up = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; UpdateRequest();
    up.add( doc3 );
    up.setCommitWithin( 500 );  &lt;span class=&quot;code-comment&quot;&gt;// a smaller commitWithin caused failures on the following &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt;
&lt;/span&gt;    up.process( server );
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;...and doesn&apos;t have this bug.&lt;/p&gt;

&lt;p&gt;i&apos;m a little concerned about being able to verify that the fix actaully works w/o being able to reproduce the test &amp;#8211; Nobel, can you explain why this test currently succeeds in spite of this bug?  ideally could you include a test (or test additions) in the patch demonstrating the bug?&lt;/p&gt;</comment>
                            <comment id="12970928" author="noble.paul" created="Mon, 13 Dec 2010 18:11:16 +0000"  >&lt;p&gt;The Original code expects all params to be strings. In this case it is an integer that it&apos;s why it&apos;s failing. &lt;/p&gt;</comment>
                            <comment id="12970955" author="hossman" created="Mon, 13 Dec 2010 18:53:05 +0000"  >&lt;blockquote&gt;&lt;p&gt;The Original code expects all params to be strings. In this case it is an integer that it&apos;s why it&apos;s failing.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t relaly see how that addresses my question at all.&lt;/p&gt;

&lt;p&gt;We have an existing test, which uses UpdateRequest.setCommitWithin, which uses an int, which passes.&lt;/p&gt;

&lt;p&gt;how can i actually verify this bug?&lt;/p&gt;</comment>
                            <comment id="12971031" author="maxim.valyanskiy" created="Mon, 13 Dec 2010 20:48:41 +0000"  >&lt;p&gt;I have the same problem. Unit tests derived from SolrExampleTests works because they do not use BinaryRequestWriter. I will write unit test for it tomorrow&lt;/p&gt;</comment>
                            <comment id="12971202" author="maxim.valyanskiy" created="Tue, 14 Dec 2010 09:07:26 +0000"  >&lt;p&gt;solr/src/test/org/apache/solr/client/solrj/embedded/SolrExampleBinaryTest.java&lt;/p&gt;</comment>
                            <comment id="12971203" author="maxim.valyanskiy" created="Tue, 14 Dec 2010 09:08:26 +0000"  >&lt;p&gt;this test reproduces the problem on todays lucene-solr trunk&lt;/p&gt;</comment>
                            <comment id="12971379" author="hossman" created="Tue, 14 Dec 2010 19:22:25 +0000"  >&lt;p&gt;Ah, thank you Maxim &amp;#8211; not realizing that the existing Jetty tests use XML by default - that was the piece of the puzzle i was missing.&lt;/p&gt;

&lt;p&gt;With Maxim&apos;s test,  i was able to reproduce the bug, and with Noble&apos;s patch the bug when away, but a new one still surfaced.&lt;/p&gt;

&lt;p&gt;However one of the things i noticed was that the SolrParam building code being moved around/fixed was in general redundant &amp;#8211; we already have SolrParams.toSolrparams(NamedList) and using that made the tests pass&lt;/p&gt;

&lt;p&gt;So i switched to using that, and all tests now pass.&lt;/p&gt;

&lt;p&gt;attached patch include Maxim&apos;s test case and the fix &amp;#8211; comments appreciated.&lt;/p&gt;</comment>
                            <comment id="12971539" author="noble.paul" created="Wed, 15 Dec 2010 03:39:14 +0000"  >&lt;p&gt;Oh. I missed that helper method. the patch is good&lt;/p&gt;</comment>
                            <comment id="12972035" author="maxim.valyanskiy" created="Thu, 16 Dec 2010 10:34:18 +0000"  >&lt;p&gt;Patch for Solr 1.4 branch&lt;/p&gt;</comment>
                            <comment id="12972036" author="maxim.valyanskiy" created="Thu, 16 Dec 2010 10:39:21 +0000"  >&lt;p&gt;I ported this patch to 1.4 branch and test it in my application. 5 min test passed without any problems, commitWithin parametes works as excepted.&lt;/p&gt;

&lt;p&gt;Is it possible to include this patch in 1.4.2?&lt;/p&gt;</comment>
                            <comment id="12973837" author="hossman" created="Tue, 21 Dec 2010 19:35:49 +0000"  >&lt;p&gt;Committed revision 1051611. - trunk&lt;br/&gt;
Committed revision 1051616. - 3x&lt;br/&gt;
Committed revision 1051624 - solr 1.4 branch&lt;/p&gt;

&lt;p&gt;Maxim: thanks for your help on this issue.  I&apos;m not sure if/when 1.4.2 might be released, but i went ahead and committed your backport just in case.&lt;/p&gt;</comment>
                            <comment id="13013223" author="gsingers" created="Wed, 30 Mar 2011 15:45:54 +0000"  >&lt;p&gt;Bulk close for 3.1.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12466379" name="SOLR-1993-1.4.patch" size="4023" author="maxim.valyanskiy" created="Thu, 16 Dec 2010 10:34:18 +0000"/>
                            <attachment id="12466238" name="SOLR-1993.patch" size="4084" author="hossman" created="Tue, 14 Dec 2010 19:22:25 +0000"/>
                            <attachment id="12458959" name="SOLR-1993.patch" size="2588" author="noble.paul" created="Fri, 5 Nov 2010 22:00:02 +0000"/>
                            <attachment id="12466202" name="SolrExampleBinaryTest.java" size="2020" author="maxim.valyanskiy" created="Tue, 14 Dec 2010 09:07:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5490</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 34 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03ngn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19234</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>