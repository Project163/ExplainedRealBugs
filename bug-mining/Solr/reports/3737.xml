<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:30:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-11555] If the query terms reduce to nothing, filter(clause) produces an NPE whereas fq=clause does not</title>
                <link>https://issues.apache.org/jira/browse/SOLR-11555</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description></description>
                <environment></environment>
        <key id="13112393">SOLR-11555</key>
            <summary>If the query terms reduce to nothing, filter(clause) produces an NPE whereas fq=clause does not</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="erickerickson">Erick Erickson</assignee>
                                    <reporter username="erickerickson">Erick Erickson</reporter>
                        <labels>
                    </labels>
                <created>Thu, 26 Oct 2017 20:25:46 +0000</created>
                <updated>Sat, 8 Jun 2019 15:16:20 +0000</updated>
                            <resolved>Wed, 27 Dec 2017 20:12:35 +0000</resolved>
                                                    <fixVersion>7.2.1</fixVersion>
                    <fixVersion>7.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16221274" author="erickerickson" created="Thu, 26 Oct 2017 21:37:00 +0000"  >&lt;p&gt;Patch with test. This gives the same behavior (albeit a slightly different explain) for filter(wdf:&amp;amp;) and fq=wdf:&amp;amp;. All it does is assign MatchNoDocsQuery to the internal q when a null q comes in to the c&apos;tor.&lt;/p&gt;

&lt;p&gt;The attached test succeeds, I have not yet run it through precommit and the full test suite, will do tonight and commit soon unless there are objections.&lt;/p&gt;</comment>
                            <comment id="16221317" author="yseeley@gmail.com" created="Thu, 26 Oct 2017 22:07:00 +0000"  >&lt;p&gt;Hmmm, that&apos;s interesting... how did this null query come to be?  I didn&apos;t think our lucene qparser would ever return null.  If it can, I wonder if any other places could be hit by a NPE (and if we should fix it at a lower level)&lt;/p&gt;</comment>
                            <comment id="16221375" author="erickerickson" created="Thu, 26 Oct 2017 22:39:30 +0000"  >&lt;p&gt;Fixing it at a lower level would certainly be preferable. I looked briefly at another couple of classes and it seems that the same kind of problem is possible in other places.&lt;/p&gt;

&lt;p&gt;bq: how did this null query come to be&lt;br/&gt;
Guessing this is a rhetorical question, but answering anyway....&lt;/p&gt;

&lt;p&gt;WordDelimiter(Graph)FilterFactory got a single term that was all punctuation and removed them all. I don&apos;t know at this point whether an actual null was returned as the token or an empty string and/or if this behavior changed..... The test case exercises the situation though.&lt;/p&gt;</comment>
                            <comment id="16221412" author="yseeley@gmail.com" created="Thu, 26 Oct 2017 23:12:23 +0000"  >&lt;blockquote&gt;&lt;p&gt;Guessing this is a rhetorical question&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Not really... I don&apos;t recall seeing null queries come out of the lucene query parser before, and there is code that should prevent that from happening.&lt;br/&gt;
SolrQueryParser.parse() has the following code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; res!=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? res : newBooleanQuery().build();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Which could prob be replaced with MatchNoDocsQuery these days...&lt;/p&gt;</comment>
                            <comment id="16221425" author="yseeley@gmail.com" created="Thu, 26 Oct 2017 23:15:53 +0000"  >&lt;p&gt;Ah, I see - filter clause doesn&apos;t invoke the parser from the top level since it&apos;s part of the parser itself.  So we&apos;re good, and your fix is fine.  External callers won&apos;t see &quot;null&quot; coming out of our query parsers.&lt;/p&gt;</comment>
                            <comment id="16221660" author="dsmiley" created="Fri, 27 Oct 2017 03:24:40 +0000"  >&lt;p&gt;Very related:  It&apos;s a shame that &lt;tt&gt;QParser.getQuery(...)&lt;/tt&gt; and &lt;tt&gt;parse()&lt;/tt&gt; can return a null query.  This leads to bugs since it&apos;s rare and this method doesn&apos;t even document this possibility.  Some call sites treat as the equivalent as MatchAllDocsQuery (e.g. fq is one) while others treat as equivalent to MatchNoDocsQuery (AnalyticsHandler is one), and others will blow up with NPE (e.g. BoolQParserPlugin, others).&lt;/p&gt;</comment>
                            <comment id="16222485" author="erickerickson" created="Fri, 27 Oct 2017 14:50:11 +0000"  >&lt;p&gt;Thanks Yonik and David!&lt;/p&gt;

&lt;p&gt;I&apos;d feel a lot safer if we didn&apos;t have to catch this case wherever these are called. I&apos;ll poke around a bit and search for other places that are vulnerable. I suppose to do really safely any place calling these methods that already checks for null and does something else would have to continue to function as it does now.&lt;/p&gt;

&lt;p&gt;Won&apos;t happen today, but maybe this weekend.&lt;/p&gt;</comment>
                            <comment id="16304762" author="jira-bot" created="Wed, 27 Dec 2017 20:05:38 +0000"  >&lt;p&gt;Commit 05ab5e10ae2309a307951d753ec0c141b6c12f7d in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=05ab5e1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=05ab5e1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11555&quot; title=&quot;If the query terms reduce to nothing, filter(clause) produces an NPE whereas fq=clause does not&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11555&quot;&gt;&lt;del&gt;SOLR-11555&lt;/del&gt;&lt;/a&gt;: If the query terms reduce to nothing, filter(clause) produces an NPE whereas fq=clause does not&lt;/p&gt;</comment>
                            <comment id="16304768" author="jira-bot" created="Wed, 27 Dec 2017 20:11:01 +0000"  >&lt;p&gt;Commit a78db4b259551464ba252e54d84e95d6c456b461 in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a78db4b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=a78db4b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11555&quot; title=&quot;If the query terms reduce to nothing, filter(clause) produces an NPE whereas fq=clause does not&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11555&quot;&gt;&lt;del&gt;SOLR-11555&lt;/del&gt;&lt;/a&gt;: If the query terms reduce to nothing, filter(clause) produces an NPE whereas fq=clause does not&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 05ab5e1)&lt;/p&gt;</comment>
                            <comment id="16304771" author="erickerickson" created="Wed, 27 Dec 2017 20:12:20 +0000"  >&lt;p&gt;Same patch with CHANGES.txt&lt;/p&gt;</comment>
                            <comment id="16317423" author="jira-bot" created="Tue, 9 Jan 2018 00:36:07 +0000"  >&lt;p&gt;Commit 4d919e2c2e34693a5cfa3cd2170ac3eb3ebdf465 in lucene-solr&apos;s branch refs/heads/branch_7_2 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4d919e2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4d919e2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11555&quot; title=&quot;If the query terms reduce to nothing, filter(clause) produces an NPE whereas fq=clause does not&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11555&quot;&gt;&lt;del&gt;SOLR-11555&lt;/del&gt;&lt;/a&gt;: If the query terms reduce to nothing, filter(clause) produces an NPE whereas fq=clause does not&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12903830" name="SOLR-11555.patch" size="2556" author="erickerickson" created="Wed, 27 Dec 2017 20:12:15 +0000"/>
                            <attachment id="12894226" name="SOLR-11555.patch" size="2134" author="erickerickson" created="Thu, 26 Oct 2017 21:36:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 45 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3lrbr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>