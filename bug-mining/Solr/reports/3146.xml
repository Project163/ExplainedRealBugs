<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:17:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-9536] OldBackupDirectory timestamp init bug causes NPEs from SnapShooter?</title>
                <link>https://issues.apache.org/jira/browse/SOLR-9536</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;On IRC, a 6.2.0 user reported getting an NPE from SnapShooter.deleteOldBackups L244, with the only other frame of the stacktrace being &lt;tt&gt;lambda$createSnapAsync$1&lt;/tt&gt; L196 (it was a screenshot, not text easily cut/paste here)&lt;/p&gt;

&lt;p&gt;The problematic L244 is...&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (obd.getTimestamp().isPresent()) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;..and i believe the root of the issue is that while &lt;tt&gt;getTimestamp()&lt;/tt&gt; is declared to return an &lt;tt&gt;Optional&amp;lt;Date&amp;gt;&lt;/tt&gt;, there is no guarantee that the &lt;tt&gt;Optional&lt;/tt&gt; instance is itself non-null...&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;   &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; Optional&amp;lt;Date&amp;gt; timestamp;

  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; OldBackupDirectory(URI basePath, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; dirName) {
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.dirName = Preconditions.checkNotNull(dirName);
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.basePath = Preconditions.checkNotNull(basePath);
    Matcher m = dirNamePattern.matcher(dirName);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (m.find()) {
      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.timestamp = Optional.of(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SimpleDateFormat(SnapShooter.DATE_FMT, Locale.ROOT).parse(m.group(1)));
      } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (ParseException e) {
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.timestamp = Optional.empty();
      }
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Allthough i&apos;m not 100% certain, I believe the way the user was triggering this bug was by configuring classic replication configured with something like &lt;tt&gt;&amp;lt;str name=&quot;replicateAfter&quot;&amp;gt;commit&amp;lt;/str&amp;gt;&lt;/tt&gt; &amp;#8211; so that usage may be neccessary to trigger the exception?&lt;/p&gt;

&lt;p&gt;Alternatively: perhaps this exception gets logged the &lt;b&gt;first&lt;/b&gt; time anyone tries to use any code that involves SnapShooter &amp;#8211; and after that a timestamp file &lt;b&gt;is&lt;/b&gt; created and teh problem neer manifests itself again?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13006053">SOLR-9536</key>
            <summary>OldBackupDirectory timestamp init bug causes NPEs from SnapShooter?</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="markrmiller@gmail.com">Mark Miller</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Mon, 19 Sep 2016 22:02:53 +0000</created>
                <updated>Sat, 8 Jun 2019 15:33:41 +0000</updated>
                            <resolved>Tue, 25 Oct 2016 16:43:15 +0000</resolved>
                                                    <fixVersion>6.3</fixVersion>
                    <fixVersion>7.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="15504829" author="hossman" created="Mon, 19 Sep 2016 22:03:45 +0000"  >&lt;p&gt;pretty sure the code in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7374&quot; title=&quot;Backup/Restore should provide a param for specifying the directory implementation it should use&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7374&quot;&gt;&lt;del&gt;SOLR-7374&lt;/del&gt;&lt;/a&gt; introduced this NPE&lt;/p&gt;</comment>
                            <comment id="15504830" author="hossman" created="Mon, 19 Sep 2016 22:04:37 +0000"  >&lt;p&gt;Varun: can you take a look at this and sanity check my analysis here?&lt;/p&gt;</comment>
                            <comment id="15505410" author="hgadre" created="Tue, 20 Sep 2016 03:00:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman&quot; class=&quot;user-hover&quot; rel=&quot;hossman&quot;&gt;hossman&lt;/a&gt; Yes this is correct. We need to initialize the timestamp field during the construction. I have prepared a patch and running the unit tests currently. Will submit the patch in next couple of hours.&lt;/p&gt;</comment>
                            <comment id="15505491" author="githubbot" created="Tue, 20 Sep 2016 03:57:32 +0000"  >&lt;p&gt;GitHub user hgadre opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/lucene-solr/pull/81&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/pull/81&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9536&quot; title=&quot;OldBackupDirectory timestamp init bug causes NPEs from SnapShooter?&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9536&quot;&gt;&lt;del&gt;SOLR-9536&lt;/del&gt;&lt;/a&gt; Initialize timestamp field with Optional.empty() to avoid an NPE&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/hgadre/lucene-solr&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/hgadre/lucene-solr&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9536&quot; title=&quot;OldBackupDirectory timestamp init bug causes NPEs from SnapShooter?&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9536&quot;&gt;&lt;del&gt;SOLR-9536&lt;/del&gt;&lt;/a&gt;_fix&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/lucene-solr/pull/81.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/pull/81.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #81&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit b3f52a7d4dd4823c2ba2e54ae75dc0f50533dcf8&lt;br/&gt;
Author: Hrishikesh Gadre &amp;lt;hgadre@cloudera.com&amp;gt;&lt;br/&gt;
Date:   2016-09-20T02:58:21Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9536&quot; title=&quot;OldBackupDirectory timestamp init bug causes NPEs from SnapShooter?&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9536&quot;&gt;&lt;del&gt;SOLR-9536&lt;/del&gt;&lt;/a&gt; Initialize timestamp field with Optional.empty() to avoid an NPE&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15605803" author="jira-bot" created="Tue, 25 Oct 2016 16:40:16 +0000"  >&lt;p&gt;Commit e152575f5ea5ea798ca989c852afb763189dee60 in lucene-solr&apos;s branch refs/heads/master from markrmiller&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e152575&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e152575&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9536&quot; title=&quot;OldBackupDirectory timestamp init bug causes NPEs from SnapShooter?&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9536&quot;&gt;&lt;del&gt;SOLR-9536&lt;/del&gt;&lt;/a&gt;: OldBackupDirectory timestamp field needs to be initialized to avoid NPE.&lt;/p&gt;</comment>
                            <comment id="15605805" author="jira-bot" created="Tue, 25 Oct 2016 16:40:51 +0000"  >&lt;p&gt;Commit 22117ddde47bc5b646ec1f0e732b51479a8e8bab in lucene-solr&apos;s branch refs/heads/branch_6x from markrmiller&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=22117dd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=22117dd&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9536&quot; title=&quot;OldBackupDirectory timestamp init bug causes NPEs from SnapShooter?&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9536&quot;&gt;&lt;del&gt;SOLR-9536&lt;/del&gt;&lt;/a&gt;: OldBackupDirectory timestamp field needs to be initialized to avoid NPE.&lt;/p&gt;

&lt;p&gt;This closes #81.&lt;/p&gt;</comment>
                            <comment id="15605810" author="jira-bot" created="Tue, 25 Oct 2016 16:42:22 +0000"  >&lt;p&gt;Commit c15c8af66db5c2c84cdf95520a61f78d512c5911 in lucene-solr&apos;s branch refs/heads/master from markrmiller&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c15c8af&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c15c8af&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9536&quot; title=&quot;OldBackupDirectory timestamp init bug causes NPEs from SnapShooter?&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9536&quot;&gt;&lt;del&gt;SOLR-9536&lt;/del&gt;&lt;/a&gt;: Add hossman to CHANGES.&lt;/p&gt;</comment>
                            <comment id="15605812" author="jira-bot" created="Tue, 25 Oct 2016 16:42:32 +0000"  >&lt;p&gt;Commit c1d1e6098a6c4dcc2d6f031b1299545f79972794 in lucene-solr&apos;s branch refs/heads/branch_6x from markrmiller&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c1d1e60&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c1d1e60&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9536&quot; title=&quot;OldBackupDirectory timestamp init bug causes NPEs from SnapShooter?&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9536&quot;&gt;&lt;del&gt;SOLR-9536&lt;/del&gt;&lt;/a&gt;: Add hossman to CHANGES.&lt;/p&gt;</comment>
                            <comment id="15605816" author="markrmiller@gmail.com" created="Tue, 25 Oct 2016 16:43:15 +0000"  >&lt;p&gt;Thanks guys!&lt;/p&gt;</comment>
                            <comment id="15650205" author="shalinmangar" created="Wed, 9 Nov 2016 08:37:03 +0000"  >&lt;p&gt;Closing after 6.3.0 release.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13076009">SOLR-10777</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12820026">SOLR-7374</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 1 week, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i33ti7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>