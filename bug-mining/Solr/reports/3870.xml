<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:31:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-11929] UpdateLog metrics are not initialized on core reload</title>
                <link>https://issues.apache.org/jira/browse/SOLR-11929</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;My Jenkins found a branch_7x seed for &lt;tt&gt;TestRecovery.testBuffering()&lt;/tt&gt; and &lt;tt&gt;TestRecovery.testCorruptLog()&lt;/tt&gt; that reproduces for me 5/5 times (when I exclude &lt;tt&gt;-Dtests.method=...&lt;/tt&gt; from the cmdline):&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Checking out Revision 1ef988a26378137b1e1f022985dacee1f557f4fc (refs/remotes/origin/branch_7x)
[...]
   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestRecovery -Dtests.method=testBuffering -Dtests.seed=FC96FD26F8A8CC6F -Dtests.slow=true -Dtests.locale=de-GR -Dtests.timezone=Europe/London -Dtests.asserts=true -Dtests.file.encoding=UTF-8
   [junit4] FAILURE 0.02s J3  | TestRecovery.testBuffering &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: expected:&amp;lt;1&amp;gt; but was:&amp;lt;3&amp;gt;
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([FC96FD26F8A8CC6F:E178530D59F16D44]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.search.TestRecovery.testBuffering(TestRecovery.java:494)
   [junit4]    &amp;gt; 	at java.lang.Thread.run(Thread.java:748)
[...]
   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestRecovery -Dtests.method=testCorruptLog -Dtests.seed=FC96FD26F8A8CC6F -Dtests.slow=true -Dtests.locale=de-GR -Dtests.timezone=Europe/London -Dtests.asserts=true -Dtests.file.encoding=UTF-8
   [junit4] ERROR   0.35s J3  | TestRecovery.testCorruptLog &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.RuntimeException: mismatch: &apos;3&apos;!=&apos;0&apos; @ response/numFound
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([FC96FD26F8A8CC6F:E4B49F502909DB3]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.SolrTestCaseJ4.assertJQ(SolrTestCaseJ4.java:990)
   [junit4]    &amp;gt; 	at org.apache.solr.SolrTestCaseJ4.assertJQ(SolrTestCaseJ4.java:937)
   [junit4]    &amp;gt; 	at org.apache.solr.search.TestRecovery.testCorruptLog(TestRecovery.java:1367)
   [junit4]    &amp;gt; 	at java.lang.Thread.run(Thread.java:748)
[...]
   [junit4]   2&amp;gt; NOTE: test params are: codec=Asserting(Lucene70): {_root_=PostingsFormat(name=LuceneVarGapFixedInterval), id=PostingsFormat(name=Direct)}, docValues:{_version_=DocValuesFormat(name=Lucene70), val_i_dvo=DocValuesFormat(name=Memory), val_i=DocValuesFormat(name=Memory)}, maxPointsInLeafNode=1937, maxMBSortInHeap=7.529691259992591, sim=RandomSimilarity(queryNorm=false): {}, locale=de-GR, timezone=Europe/London
   [junit4]   2&amp;gt; NOTE: Linux 4.1.0-custom2-amd64 amd64/Oracle Corporation 1.8.0_151 (64-bit)/cpus=16,threads=1,free=217064096,total=530579456
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13134796">SOLR-11929</key>
            <summary>UpdateLog metrics are not initialized on core reload</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sarowe">Steven Rowe</assignee>
                                    <reporter username="sarowe">Steven Rowe</reporter>
                        <labels>
                    </labels>
                <created>Tue, 30 Jan 2018 16:00:10 +0000</created>
                <updated>Sat, 8 Jun 2019 15:15:09 +0000</updated>
                            <resolved>Wed, 4 Apr 2018 15:19:50 +0000</resolved>
                                                    <fixVersion>7.4</fixVersion>
                                    <component>metrics</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16419428" author="steve_rowe" created="Thu, 29 Mar 2018 17:21:08 +0000"  >&lt;p&gt;Another reproducing seed (again without &lt;tt&gt;&amp;#45;Dtests.method=...&lt;/tt&gt;), from &lt;a href=&quot;https://jenkins.thetaphi.de/job/Lucene-Solr-master-Solaris/1769/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jenkins.thetaphi.de/job/Lucene-Solr-master-Solaris/1769/&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Checking out Revision 668b81721fa5b539d9286ed2f464426a598c352a (refs/remotes/origin/master)
[...]
   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestRecovery -Dtests.method=testBuffering -Dtests.seed=D6674863F4F03A58 -Dtests.slow=true -Dtests.locale=lt -Dtests.timezone=Africa/Conakry -Dtests.asserts=true -Dtests.file.encoding=US-ASCII
   [junit4] ERROR   0.02s J0 | TestRecovery.testBuffering &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.NullPointerException
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([D6674863F4F03A58:CB89E64855A99B73]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.search.TestRecovery.testBuffering(TestRecovery.java:495)
   [junit4]    &amp;gt; 	at java.lang.Thread.run(Thread.java:748)
[...]
   [junit4]   2&amp;gt; 1992912 ERROR (TEST-TestRecovery.testRecoveryMultipleLogs-seed#[D6674863F4F03A58]) [    x:collection1] o.a.s.SolrTestCaseJ4 query failed JSON validation. error=mismatch: &apos;6&apos;!=&apos;3&apos; @ response/numFound
   [junit4]   2&amp;gt;  expected =/response/numFound==6
   [junit4]   2&amp;gt;  response = {
   [junit4]   2&amp;gt;   &quot;responseHeader&quot;:{
   [junit4]   2&amp;gt;     &quot;status&quot;:0,
   [junit4]   2&amp;gt;     &quot;QTime&quot;:0},
   [junit4]   2&amp;gt;   &quot;response&quot;:{&quot;numFound&quot;:3,&quot;start&quot;:0,&quot;docs&quot;:[
   [junit4]   2&amp;gt;       {
   [junit4]   2&amp;gt;         &quot;id&quot;:&quot;aaaaaa&quot;,
   [junit4]   2&amp;gt;         &quot;_version_&quot;:1596276857454460929},
   [junit4]   2&amp;gt;       {
   [junit4]   2&amp;gt;         &quot;id&quot;:&quot;bbbbbb&quot;,
   [junit4]   2&amp;gt;         &quot;_version_&quot;:1596276857455509504},
   [junit4]   2&amp;gt;       {
   [junit4]   2&amp;gt;         &quot;id&quot;:&quot;cccccc&quot;,
   [junit4]   2&amp;gt;         &quot;_version_&quot;:1596276857455509505}]
   [junit4]   2&amp;gt;   }}
   [junit4]   2&amp;gt; 
   [junit4]   2&amp;gt;  request = q=*:*&amp;amp;wt=xml
   [junit4]   2&amp;gt; 1992912 INFO  (TEST-TestRecovery.testRecoveryMultipleLogs-seed#[D6674863F4F03A58]) [    x:collection1] o.a.s.SolrTestCaseJ4 ###Ending testRecoveryMultipleLogs
   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestRecovery -Dtests.method=testRecoveryMultipleLogs -Dtests.seed=D6674863F4F03A58 -Dtests.slow=true -Dtests.locale=lt -Dtests.timezone=Africa/Conakry -Dtests.asserts=true -Dtests.file.encoding=US-ASCII
   [junit4] ERROR   0.36s J0 | TestRecovery.testRecoveryMultipleLogs &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.RuntimeException: mismatch: &apos;6&apos;!=&apos;3&apos; @ response/numFound
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([D6674863F4F03A58:6FF2D052738B7DB1]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.SolrTestCaseJ4.assertJQ(SolrTestCaseJ4.java:1002)
   [junit4]    &amp;gt; 	at org.apache.solr.SolrTestCaseJ4.assertJQ(SolrTestCaseJ4.java:949)
   [junit4]    &amp;gt; 	at org.apache.solr.search.TestRecovery.testRecoveryMultipleLogs(TestRecovery.java:1448)
   [junit4]    &amp;gt; 	at java.lang.Thread.run(Thread.java:748)
[...]
   [junit4]   2&amp;gt; NOTE: test params are: codec=Asserting(Lucene70): {_root_=Lucene50(blocksize=128), id=FSTOrd50}, docValues:{_version_=DocValuesFormat(name=Lucene70), val_i_dvo=DocValuesFormat(name=Asserting)}, maxPointsInLeafNode=647, maxMBSortInHeap=6.830494683367925, sim=Asserting(org.apache.lucene.search.similarities.AssertingSimilarity@2da1e99a), locale=lt, timezone=Africa/Conakry
   [junit4]   2&amp;gt; NOTE: SunOS 5.11 amd64/Oracle Corporation 1.8.0_162 (64-bit)/cpus=3,threads=1,free=161610624,total=473956352
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16424784" author="steve_rowe" created="Tue, 3 Apr 2018 23:55:59 +0000"  >&lt;p&gt;I traced the problem to the &lt;tt&gt;testReload()&lt;/tt&gt; method being run prior to the other failing test methods; when I comment out its body all tests succeed with all seeds.  &lt;/p&gt;

&lt;p&gt;The NPE in &lt;tt&gt;testBuffering()&lt;/tt&gt; is caused by the &lt;tt&gt;TLOG.state&lt;/tt&gt; metric not being present, apparently because &lt;tt&gt;UpdateLog.initializeMetrics()&lt;/tt&gt; is never called on core reload.&lt;/p&gt;

&lt;p&gt;I&apos;ve attached a patch that initializes &lt;tt&gt;UpdateLog&lt;/tt&gt; metrics upon core reload, and this allows all tests to pass with the seeds I have for this problem (another one not listed above: &lt;tt&gt;F999698B6BBE3431&lt;/tt&gt;, from &lt;a href=&quot;https://jenkins.thetaphi.de/job/Lucene-Solr-master-MacOSX/4542/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jenkins.thetaphi.de/job/Lucene-Solr-master-MacOSX/4542/&lt;/a&gt; ).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ab&quot; class=&quot;user-hover&quot; rel=&quot;ab&quot;&gt;ab&lt;/a&gt;, can you take a look and see if the patch is doing the right thing here?&lt;/p&gt;</comment>
                            <comment id="16425160" author="ab" created="Wed, 4 Apr 2018 08:20:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt; LGTM, good catch!&lt;/p&gt;</comment>
                            <comment id="16425688" author="steve_rowe" created="Wed, 4 Apr 2018 15:16:30 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ab&quot; class=&quot;user-hover&quot; rel=&quot;ab&quot;&gt;ab&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Attached a slightly reworked patch, to de-emphasize the &quot;nothing to do here on core reload&quot; message in comments/log msg, and also including a CHANGES entry.&lt;/p&gt;

&lt;p&gt;Committing shortly.&lt;/p&gt;</comment>
                            <comment id="16425701" author="jira-bot" created="Wed, 4 Apr 2018 15:19:14 +0000"  >&lt;p&gt;Commit 5a5802f5cb40811cd25232f3fe5127ecc80bdfc7 in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5a5802f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5a5802f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11929&quot; title=&quot;UpdateLog metrics are not initialized on core reload&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11929&quot;&gt;&lt;del&gt;SOLR-11929&lt;/del&gt;&lt;/a&gt;: UpdateLog metrics are not initialized on core reload&lt;/p&gt;</comment>
                            <comment id="16425702" author="jira-bot" created="Wed, 4 Apr 2018 15:19:35 +0000"  >&lt;p&gt;Commit 8e276b90f520df771d8a1e60408fe112c40ceea4 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8e276b9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8e276b9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11929&quot; title=&quot;UpdateLog metrics are not initialized on core reload&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11929&quot;&gt;&lt;del&gt;SOLR-11929&lt;/del&gt;&lt;/a&gt;: UpdateLog metrics are not initialized on core reload&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12917560" name="SOLR-11929.patch" size="1612" author="sarowe" created="Wed, 4 Apr 2018 15:14:42 +0000"/>
                            <attachment id="12917464" name="SOLR-11929.patch" size="623" author="sarowe" created="Tue, 3 Apr 2018 23:48:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 32 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3pjov:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>