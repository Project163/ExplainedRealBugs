<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:54:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-6257] More than two &quot;!&quot;-s in a doc ID throws an ArrayIndexOutOfBoundsException when using the composite id router</title>
                <link>https://issues.apache.org/jira/browse/SOLR-6257</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Since &lt;tt&gt;CompositeIdRouter&lt;/tt&gt; is the default router, it has to be able to deal with &lt;b&gt;any&lt;/b&gt; ID string without throwing an exception.&lt;/p&gt;

&lt;p&gt;The following test (added to &lt;tt&gt;TestHashPartitioner&lt;/tt&gt;) currently fails:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testNonConformingCompositeId() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
    DocRouter router = DocRouter.getDocRouter(CompositeIdRouter.NAME);
    DocCollection coll = createCollection(4, router);
    Slice targetSlice = coll.getRouter().getTargetSlice(&lt;span class=&quot;code-quote&quot;&gt;&quot;A!B!C!D&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, coll);
    assertNotNull(targetSlice);
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;with the following output: &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4] Suite: org.apache.solr.cloud.TestHashPartitioner
   [junit4]   2&amp;gt; log4j:WARN No such property [conversionPattern] in org.apache.solr.util.SolrLogLayout.
   [junit4]   2&amp;gt; Creating dataDir: /Users/sarowe/svn/lucene/dev/trunk/solr/build/solr-core/test/J0/./temp/solr.cloud.TestHashPartitioner-19514036FB5C5E56-001/init-core-data-001
   [junit4]   2&amp;gt; 1233 T11 oas.SolrTestCaseJ4.buildSSLConfig Randomized ssl (false) and clientAuth (false)
   [junit4]   2&amp;gt; 1296 T11 oas.SolrTestCaseJ4.setUp ###Starting testNonConformingCompositeId
   [junit4]    &amp;gt; Throwable #1: java.lang.ArrayIndexOutOfBoundsException: 2
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([19514036FB5C5E56:3A131EC016F531A4]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.common.cloud.CompositeIdRouter$KeyParser.getHash(CompositeIdRouter.java:296)
   [junit4]    &amp;gt; 	at org.apache.solr.common.cloud.CompositeIdRouter.sliceHash(CompositeIdRouter.java:58)
   [junit4]    &amp;gt; 	at org.apache.solr.common.cloud.HashBasedRouter.getTargetSlice(HashBasedRouter.java:33)
   [junit4]    &amp;gt; 	at org.apache.solr.cloud.TestHashPartitioner.testNonConformingCompositeId(TestHashPartitioner.java:205)
   [junit4]    &amp;gt; 	at java.lang.Thread.run(Thread.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12728258">SOLR-6257</key>
            <summary>More than two &quot;!&quot;-s in a doc ID throws an ArrayIndexOutOfBoundsException when using the composite id router</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sarowe">Steven Rowe</assignee>
                                    <reporter username="sarowe">Steven Rowe</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 Jul 2014 18:56:29 +0000</created>
                <updated>Mon, 9 May 2016 18:50:38 +0000</updated>
                            <resolved>Sat, 19 Jul 2014 18:30:49 +0000</resolved>
                                                    <fixVersion>4.10</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14066753" author="steve_rowe" created="Fri, 18 Jul 2014 19:12:09 +0000"  >&lt;p&gt;Patch with two tests and a fix.&lt;/p&gt;

&lt;p&gt;The first test routes ID strings known not to conform to the composite ID format, and the second routes ID strings containing a random sequence of &quot;!&quot;-s, &quot;/&quot;-s, random numbers, and random Unicode strings.  Both fail without the fix.&lt;/p&gt;

&lt;p&gt;The included fix changes &lt;tt&gt;CompositeIdRouter.KeyParser&lt;/tt&gt; to treat the first two &quot;&amp;#33;&quot;-s in an ID as separators, but then treat any further &quot;&amp;#33;&quot;-s as regular text.&lt;/p&gt;

&lt;p&gt;With the fix, the random test passed when I set it to test 5,000,000 IDs, but it&apos;s dialed down to 10,000 in the patch.&lt;/p&gt;

&lt;p&gt;Running all Solr tests now.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anshumg&quot; class=&quot;user-hover&quot; rel=&quot;anshumg&quot;&gt;anshumg&lt;/a&gt;, I&apos;d appreciate a review if you have time.&lt;/p&gt;</comment>
                            <comment id="14066758" author="steve_rowe" created="Fri, 18 Jul 2014 19:16:21 +0000"  >&lt;p&gt;The random test included in the patch would have caught &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5502&quot; title=&quot;A &amp;quot;/&amp;quot; in the ID itself throws an ArrayIndexOutOfBoundsException when using the composite id router&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5502&quot;&gt;&lt;del&gt;SOLR-5502&lt;/del&gt;&lt;/a&gt; too.&lt;/p&gt;</comment>
                            <comment id="14066823" author="steve_rowe" created="Fri, 18 Jul 2014 20:15:23 +0000"  >&lt;p&gt;Thinking about back-compat: this will change how docs are routed, but the behavior is only different for documents with IDs that would currently trigger an AIOOBE and thus fail to index, so I think it&apos;s fine.&lt;/p&gt;

&lt;p&gt;There is one corner case I can think of that does not currently throw an exception, but that hashes differently: two trailing &quot;&amp;#33;&quot;-s - &lt;tt&gt;String.split(&quot;&amp;#33;&quot;)&lt;/tt&gt; (used currently to break up IDs into pieces, but not by my fixed version) only returns one piece for &quot;A&amp;#33;&amp;#33;&quot;, but my changes would return two pieces (the second being empty). &lt;tt&gt;KeyParser&lt;/tt&gt; adds another &quot;piece&quot; if it finds a trailing &quot;!&quot; in the key, so the current behavior will operate with pieces=2, my changes with pieces=3.&lt;/p&gt;

&lt;p&gt;I confirmed the problem: the hash produced by &lt;tt&gt;KeyParser.getHash()&lt;/tt&gt; in the fixed version for &quot;A&amp;#33;&amp;#33;&quot; is different from the currentlly produced hash. (By contrast, the hash for &quot;A&amp;#33;&quot; is the same.)&lt;/p&gt;

&lt;p&gt;Should be fairly easy to change this corner case back to the previous behavior.  I&apos;ll post a patch shortly.&lt;/p&gt;</comment>
                            <comment id="14066905" author="steve_rowe" created="Fri, 18 Jul 2014 21:26:25 +0000"  >&lt;p&gt;Modified patch fixing the back-compat issue.&lt;/p&gt;

&lt;p&gt;Added a CHANGES.txt entry.&lt;/p&gt;

&lt;p&gt;I think it&apos;s ready to go.&lt;/p&gt;</comment>
                            <comment id="14066937" author="anshumg" created="Fri, 18 Jul 2014 21:51:22 +0000"  >&lt;p&gt;This looks good to me. The only suggestion is to move the test to TriLevelCompositeIdRoutingTest perhaps?&lt;br/&gt;
But yes, keep it here if you think this works better.&lt;/p&gt;</comment>
                            <comment id="14067371" author="steve_rowe" created="Sat, 19 Jul 2014 04:06:25 +0000"  >&lt;p&gt;Thanks Anshum.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The only suggestion is to move the test to TriLevelCompositeIdRoutingTest perhaps? But yes, keep it here if you think this works better.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The two new tests are unit tests and don&apos;t require indexing/querying, so I put them with the other (non-cloud) tests in &lt;tt&gt;TestHashPartitioner&lt;/tt&gt; - there were already a couple of other composite id router tests in there.&lt;/p&gt;

&lt;p&gt;I&apos;ll commit tomorrow if there are no objections.&lt;/p&gt;</comment>
                            <comment id="14067471" author="anshumg" created="Sat, 19 Jul 2014 10:34:59 +0000"  >&lt;p&gt;+1. LGTM!&lt;/p&gt;</comment>
                            <comment id="14067624" author="steve_rowe" created="Sat, 19 Jul 2014 18:30:49 +0000"  >&lt;p&gt;Committed:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;trunk: &lt;a href=&quot;http://svn.apache.org/r1611934&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1611934&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;branch_4x: &lt;a href=&quot;http://svn.apache.org/r1611940&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1611940&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12681089">SOLR-5502</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12656575" name="SOLR-6257.patch" size="6747" author="sarowe" created="Fri, 18 Jul 2014 21:26:25 +0000"/>
                            <attachment id="12656557" name="SOLR-6257.patch" size="5801" author="sarowe" created="Fri, 18 Jul 2014 19:12:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>406363</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 18 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1xxfz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>406384</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>