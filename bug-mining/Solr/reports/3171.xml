<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:17:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-9366] replicas in LIR seem to still be participating in search requests</title>
                <link>https://issues.apache.org/jira/browse/SOLR-9366</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Spinning this off from &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9363&quot; title=&quot;TestStressCloudBlindAtomicUpdates.test_dv_stored() failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9363&quot;&gt;&lt;del&gt;SOLR-9363&lt;/del&gt;&lt;/a&gt; where sarowe&apos;s jenkins encountered a strange test failure when TestInjection is used causing replicas to return errors on some requests.&lt;/p&gt;

&lt;p&gt;Reading over the logs it appears that when this happens, and the replicas are put into LIR they then ignore an explicit user requested commit (ie: &lt;tt&gt;Ignoring commit while not ACTIVE - state: BUFFERING replay: false&lt;/tt&gt;) but still participate in queries &amp;#8211; apparently before they finish recovery (or at the very least before / with-out doing the commit/openSearcher that they previously ignored.&lt;/p&gt;

&lt;p&gt;Details and logs to follow...&lt;/p&gt;</description>
                <environment></environment>
        <key id="12994130">SOLR-9366</key>
            <summary>replicas in LIR seem to still be participating in search requests</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Tue, 2 Aug 2016 00:20:08 +0000</created>
                <updated>Tue, 3 Sep 2019 20:53:28 +0000</updated>
                                                                                <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15403104" author="hossman" created="Tue, 2 Aug 2016 00:35:35 +0000"  >
&lt;p&gt;sarowe&apos;s jenkins identified that this test fails fairly reliably on master (circa d86c369533)...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ant test  -Dtestcase=TestStressCloudBlindAtomicUpdates  -Dtests.seed=60C9AAFC94FD8921 -Dtests.multiplier=2 -Dtests.nightly=true -Dtests.slow=true -Dtests.linedocsfile=/home/jenkins/lucene-data/enwiki.random.lines.txt -Dtests.locale=id -Dtests.timezone=America/Puerto_Rico -Dtests.asserts=true -Dtests.file.encoding=UTF-8
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;NOTE: &lt;tt&gt;test_dv_stored&lt;/tt&gt; is the specific test method that fails, but including &lt;tt&gt;-Dtest.method&lt;/tt&gt; in the reproduce line won&apos;t work due to an unrelated bug in TestInjection (jira link to follow once i get a chance to file it)&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;The attached (gzipped) &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9366&quot; title=&quot;replicas in LIR seem to still be participating in search requests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9366&quot;&gt;SOLR-9366&lt;/a&gt;.txt.gz log file is from a run of that seed on my computer, pruned down to only the output from test_dv_stored.&lt;/p&gt;

&lt;p&gt;Note that MinSolrCluster collection has 5 shards with a repFactor of 2.  the test indexes 332 docs, and during the process encounters many errors caused by TestInjection &amp;#8211; ultimately leading to all non-leader replicas to be in recovery.&lt;/p&gt;

&lt;p&gt;After all 332 docs are added, the test issues an explicit commit, which all of the replicas in recovery log that they are explicitly ignoring...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; 96495 INFO  (qtp1014592735-82) [n:127.0.0.1:53326_solr c:test_col s:shard1 r:core_node9 x:test_col_shard1_replica2] o.a.s.u.p.DistributedU
pdateProcessor Ignoring commit while not ACTIVE - state: BUFFERING replay: false

   [junit4]   2&amp;gt; 96497 INFO  (qtp463019022-84) [n:127.0.0.1:51890_solr c:test_col s:shard2 r:core_node4 x:test_col_shard2_replica1] o.a.s.u.p.DistributedUpdateProcessor Ignoring commit while not ACTIVE - state: BUFFERING replay: false

   [junit4]   2&amp;gt; 96503 INFO  (qtp574107834-44) [n:127.0.0.1:45722_solr c:test_col s:shard4 r:core_node10 x:test_col_shard4_replica2] o.a.s.u.p.DistributedUpdateProcessor Ignoring commit while not ACTIVE - state: BUFFERING replay: false

   [junit4]   2&amp;gt; 96504 INFO  (qtp1497478396-522) [n:127.0.0.1:60681_solr c:test_col s:shard3 r:core_node3 x:test_col_shard3_replica1] o.a.s.u.p.DistributedUpdateProcessor Ignoring commit while not ACTIVE - state: BUFFERING replay: false

   [junit4]   2&amp;gt; 96510 INFO  (qtp1947867562-490) [n:127.0.0.1:35941_solr c:test_col s:shard5 r:core_node6 x:test_col_shard5_replica1] o.a.s.u.p.DistributedUpdateProcessor Ignoring commit while not ACTIVE - state: BUFFERING replay: false
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;...meanwhile the 5 leaders are all committing &amp;amp; opening new searchers...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;
   [junit4]   2&amp;gt; 96503 INFO  (searcherExecutor-70-thread-1-processing-n:127.0.0.1:50832_solr x:test_col_shard1_replica1 s:shard1 c:test_col r:core_node2) [n:127.0.0.1:50832_solr c:test_col s:shard1 r:core_node2 x:test_col_shard1_replica1] o.a.s.c.SolrCore [test_col_shard1_replica1] Registered new searcher Searcher@641bc113[test_col_shard1_replica1] main{ExitableDirectoryReader(UninvertingDirectoryReader(Uninverting(_y(7.0.0):C65)))}

   [junit4]   2&amp;gt; 96508 INFO  (searcherExecutor-71-thread-1-processing-n:127.0.0.1:43905_solr x:test_col_shard2_replica2 s:shard2 c:test_col r:core_node8) [n:127.0.0.1:43905_solr c:test_col s:shard2 r:core_node8 x:test_col_shard2_replica2] o.a.s.c.SolrCore [test_col_shard2_replica2] Registered new searcher Searcher@2fd5ffdc[test_col_shard2_replica2] main{ExitableDirectoryReader(UninvertingDirectoryReader(Uninverting(_v(7.0.0):C65)))}

   [junit4]   2&amp;gt; 96511 INFO  (searcherExecutor-68-thread-1-processing-n:127.0.0.1:56607_solr x:test_col_shard3_replica2 s:shard3 c:test_col r:core_node5) [n:127.0.0.1:56607_solr c:test_col s:shard3 r:core_node5 x:test_col_shard3_replica2] o.a.s.c.SolrCore [test_col_shard3_replica2] Registered new searcher Searcher@29273482[test_col_shard3_replica2] main{ExitableDirectoryReader(UninvertingDirectoryReader(Uninverting(_15(7.0.0):C75)))}

   [junit4]   2&amp;gt; 96513 INFO  (searcherExecutor-69-thread-1-processing-n:127.0.0.1:36018_solr x:test_col_shard5_replica2 s:shard5 c:test_col r:core_node1) [n:127.0.0.1:36018_solr c:test_col s:shard5 r:core_node1 x:test_col_shard5_replica2] o.a.s.c.SolrCore [test_col_shard5_replica2] Registered new searcher Searcher@126ca96c[test_col_shard5_replica2] main{ExitableDirectoryReader(UninvertingDirectoryReader(Uninverting(_w(7.0.0):C68)))}

   [junit4]   2&amp;gt; 96515 INFO  (searcherExecutor-72-thread-1-processing-n:127.0.0.1:45414_solr x:test_col_shard4_replica1 s:shard4 c:test_col r:core_node7) [n:127.0.0.1:45414_solr c:test_col s:shard4 r:core_node7 x:test_col_shard4_replica1] o.a.s.c.SolrCore [test_col_shard4_replica1] Registered new searcher Searcher@5204d7bc[test_col_shard4_replica1] main{ExitableDirectoryReader(UninvertingDirectoryReader(Uninverting(_q(7.0.0):C59)))}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Once the test gets a &quot;success&quot; status from the SolrCloudClient in response to the commit request, it attempts to do a &lt;tt&gt;&amp;#42;:&amp;#42;&lt;/tt&gt; search to sanity check that the index contains the expected docs before proceeding with the actual stuff the test cares about &amp;#8211; but this assertion fails, because some of those replicas that are in recovery are consulted as part of the search...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; 96526 INFO  (qtp1665435692-109) [n:127.0.0.1:56607_solr c:test_col s:shard3 r:core_node5 x:test_col_shard3_replica2] o.a.s.c.S.Request [test_col_shard3_replica2]  webapp=/solr path=/select params={distrib=false&amp;amp;_stateVer_=test_col:9&amp;amp;fl=id&amp;amp;fl=score&amp;amp;shards.purpose=4&amp;amp;start=0&amp;amp;fsv=true&amp;amp;shard.url=http://127.0.0.1:56607/solr/test_col_shard3_replica2/&amp;amp;rows=10&amp;amp;version=2&amp;amp;q=*:*&amp;amp;NOW=1470079073107&amp;amp;isShard=true&amp;amp;wt=javabin} hits=75 status=0 QTime=0

   [junit4]   2&amp;gt; 96527 INFO  (qtp831283616-488) [n:127.0.0.1:43905_solr c:test_col s:shard2 r:core_node8 x:test_col_shard2_replica2] o.a.s.c.S.Request [test_col_shard2_replica2]  webapp=/solr path=/select params={distrib=false&amp;amp;_stateVer_=test_col:9&amp;amp;fl=id&amp;amp;fl=score&amp;amp;shards.purpose=4&amp;amp;start=0&amp;amp;fsv=true&amp;amp;shard.url=http://127.0.0.1:43905/solr/test_col_shard2_replica2/&amp;amp;rows=10&amp;amp;version=2&amp;amp;q=*:*&amp;amp;NOW=1470079073107&amp;amp;isShard=true&amp;amp;wt=javabin} hits=65 status=0 QTime=0
   [junit4]   2&amp;gt; 96530 INFO  (qtp574107834-44) [n:127.0.0.1:45722_solr c:test_col s:shard4 r:core_node10 x:test_col_shard4_replica2] o.a.s.c.S.Request [test_col_shard4_replica2]  webapp=/solr path=/select params={distrib=false&amp;amp;_stateVer_=test_col:9&amp;amp;fl=id&amp;amp;fl=score&amp;amp;shards.purpose=4&amp;amp;start=0&amp;amp;fsv=true&amp;amp;shard.url=http://127.0.0.1:45414/solr/test_col_shard4_replica1/|http://127.0.0.1:45722/solr/test_col_shard4_replica2/&amp;amp;rows=10&amp;amp;version=2&amp;amp;q=*:*&amp;amp;NOW=1470079073107&amp;amp;isShard=true&amp;amp;wt=javabin} hits=0 status=0 QTime=0
   [junit4]   2&amp;gt; 96531 INFO  (qtp287931206-46) [n:127.0.0.1:50832_solr c:test_col s:shard1 r:core_node2 x:test_col_shard1_replica1] o.a.s.c.S.Request [test_col_shard1_replica1]  webapp=/solr path=/select params={distrib=false&amp;amp;_stateVer_=test_col:9&amp;amp;fl=id&amp;amp;fl=score&amp;amp;shards.purpose=4&amp;amp;start=0&amp;amp;fsv=true&amp;amp;shard.url=http://127.0.0.1:50832/solr/test_col_shard1_replica1/&amp;amp;rows=10&amp;amp;version=2&amp;amp;q=*:*&amp;amp;NOW=1470079073107&amp;amp;isShard=true&amp;amp;wt=javabin} hits=65 status=0 QTime=0
   [junit4]   2&amp;gt; 96532 INFO  (qtp1947867562-96) [n:127.0.0.1:35941_solr c:test_col s:shard5 r:core_node6 x:test_col_shard5_replica1] o.a.s.c.S.Request [test_col_shard5_replica1]  webapp=/solr path=/select params={distrib=false&amp;amp;_stateVer_=test_col:9&amp;amp;fl=id&amp;amp;fl=score&amp;amp;shards.purpose=4&amp;amp;start=0&amp;amp;fsv=true&amp;amp;shard.url=http://127.0.0.1:36018/solr/test_col_shard5_replica2/|http://127.0.0.1:35941/solr/test_col_shard5_replica1/&amp;amp;rows=10&amp;amp;version=2&amp;amp;q=*:*&amp;amp;NOW=1470079073107&amp;amp;isShard=true&amp;amp;wt=javabin} hits=0 status=0 QTime=0
   [junit4]   2&amp;gt; 96533 INFO  (qtp831283616-487) [n:127.0.0.1:43905_solr c:test_col s:shard2 r:core_node8 x:test_col_shard2_replica2] o.a.s.c.S.Request [test_col_shard2_replica2]  webapp=/solr path=/select params={q=*:*&amp;amp;distrib=false&amp;amp;_stateVer_=test_col:9&amp;amp;shards.purpose=64&amp;amp;NOW=1470079073107&amp;amp;ids=0,35,13,36,15,4,16,8,41,32&amp;amp;isShard=true&amp;amp;shard.url=http://127.0.0.1:43905/solr/test_col_shard2_replica2/&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=0
   [junit4]   2&amp;gt; 96534 INFO  (qtp287931206-461) [n:127.0.0.1:50832_solr c:test_col s:shard1 r:core_node2 x:test_col_shard1_replica1] o.a.s.c.S.Request [test_col_shard1_replica1]  webapp=/solr path=/select params={q=*:*&amp;amp;_stateVer_=test_col:9&amp;amp;wt=javabin&amp;amp;version=2} hits=205 status=0 QTime=13

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;...and BOOM, the test fails before it ever really starts because 332 docs expected != the 205 numFound returned by the search.&lt;/p&gt;

</comment>
                            <comment id="15403321" author="shalinmangar" created="Tue, 2 Aug 2016 04:22:53 +0000"  >&lt;p&gt;Yes, this is to be expected. The reason is that the queries execute before the new state (i.e. &apos;down&apos;) is propagated to all the nodes.&lt;/p&gt;

&lt;p&gt;You can see this in the logs (the following excerpt is for shard5 only):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;   [junit4]   2&amp;gt; 96432 INFO  (updateExecutor-29-thread-10-processing-x:test_col_shard5_replica2 r:core_node1 http:&lt;span class=&quot;code-comment&quot;&gt;////127.0.0.1:35941//solr//test_col_shard5_replica1// n:127.0.0.1:36018_solr s:shard5 c:test_col) [n:127.0.0.1:36018_solr c:test_col s:shard5 r:core_node1 x:test_col_shard5_replica2] o.a.s.c.LeaderInitiatedRecoveryThread Asking core=test_col_shard5_replica1 coreNodeName=core_node6 on http://127.0.0.1:35941/solr to recover
&lt;/span&gt;....
   [junit4]   2&amp;gt; 96458 INFO  (qtp1947867562-51) [n:127.0.0.1:35941_solr    ] o.a.s.h.a.CoreAdminOperation It has been requested that we recover: core=test_col_shard5_replica1
....
   [junit4]   2&amp;gt; 96510 INFO  (OverseerStateUpdate-96343095816486940-127.0.0.1:36018_solr-n_0000000000) [n:127.0.0.1:36018_solr    ] o.a.s.c.o.ReplicaMutator Update state numShards=5 message={
   [junit4]   2&amp;gt;   &lt;span class=&quot;code-quote&quot;&gt;&quot;core&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;test_col_shard5_replica1&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt;   &lt;span class=&quot;code-quote&quot;&gt;&quot;core_node_name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;core_node6&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt;   &lt;span class=&quot;code-quote&quot;&gt;&quot;roles&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,
   [junit4]   2&amp;gt;   &lt;span class=&quot;code-quote&quot;&gt;&quot;base_url&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:35941/solr&quot;&lt;/span&gt;,
&lt;/span&gt;   [junit4]   2&amp;gt;   &lt;span class=&quot;code-quote&quot;&gt;&quot;node_name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;127.0.0.1:35941_solr&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt;   &lt;span class=&quot;code-quote&quot;&gt;&quot;numShards&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;5&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt;   &lt;span class=&quot;code-quote&quot;&gt;&quot;state&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;recovering&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt;   &lt;span class=&quot;code-quote&quot;&gt;&quot;shard&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;shard5&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt;   &lt;span class=&quot;code-quote&quot;&gt;&quot;collection&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;test_col&quot;&lt;/span&gt;,
   [junit4]   2&amp;gt;   &lt;span class=&quot;code-quote&quot;&gt;&quot;operation&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;state&quot;&lt;/span&gt;}
....
   [junit4]   2&amp;gt; 96527 INFO  (qtp623658064-525) [n:127.0.0.1:36018_solr    ] o.a.s.h.a.CoreAdminOperation Will wait a max of 183 seconds to see test_col_shard5_replica2 (shard5 of test_col) have state: recovering
....
   [junit4]   2&amp;gt; 96713 INFO  (OverseerStateUpdate-96343095816486940-127.0.0.1:36018_solr-n_0000000000) [n:127.0.0.1:36018_solr    ] o.a.s.c.o.ZkStateWriter going to update_collection /collections/test_col/state.json version: 14
....
[junit4]   2&amp;gt; 96715 INFO  (zkCallback-45-thread-2-processing-n:127.0.0.1:50832_solr) [n:127.0.0.1:50832_solr    ] o.a.s.c.c.ZkStateReader Updating data &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; [test_col] from [14] to [15]
[junit4]   2&amp;gt; 96715 INFO  (zkCallback-50-thread-5-processing-n:127.0.0.1:36018_solr) [n:127.0.0.1:36018_solr    ] o.a.s.c.c.ZkStateReader Updating data &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; [test_col] from [14] to [15]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;ol&gt;
	&lt;li&gt;Time: 96432 &amp;#8211; The shard5 leader asks replica shard5_replica1 to recover.&lt;/li&gt;
	&lt;li&gt;Time: 96458 &amp;#8211; The replica shard5_replica1 receives the recovery request. At this point, it internally marks itself in recovering state.&lt;/li&gt;
	&lt;li&gt;Time: 96510 &amp;#8211; The message to publish shard5_replica1 as &apos;down&apos; is received at overseer&lt;/li&gt;
	&lt;li&gt;Time: 96527 &amp;#8211; The shard5 leader i.e. shard5_replica2 is still waiting to see shard5_replica1 as down. Note that around this time, the query is being executed&lt;/li&gt;
	&lt;li&gt;Time: 96713 &amp;#8211; The overseer actually writes the new collection state to ZooKeeper. The delay is because the overseer buffers writes to ZK. The query has already executed by 96534.&lt;/li&gt;
	&lt;li&gt;Time: 96715 &amp;#8211; The new collection state is finally available at the relevant nodes.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;In summary, state updates cannot be instantaneously propagated to the entire cluster and this information asymmetry will always exist unless we implement consensus for each update. Also note that this is a &lt;b&gt;temporary&lt;/b&gt; issue because the replica in recovery will not be selected for shard requests once the state is propagated across the cluster.&lt;/p&gt;

&lt;p&gt;It is a bad idea to use Solr as a consistent data store like this test does. The test can do one of the following:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Wait for recovery to complete before asserting doc counts,&lt;/li&gt;
	&lt;li&gt;Use min_rf with updates and assert that all documents which made to both replicas are returned in the query results&lt;/li&gt;
	&lt;li&gt;Query each shard leader individually (distrib=false) and sum up the numFound on the client&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;That being said, we can improve a few things:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;If the query happens to be aggregated by the leader, it can take LIR into account while selecting a replica for the non-distrib request&lt;/li&gt;
	&lt;li&gt;The overseer can help by flushing &apos;down&apos; state updates to ZK faster and not perform buffering.&lt;/li&gt;
	&lt;li&gt;Provide a way to query leaders only for full consistency&lt;/li&gt;
	&lt;li&gt;Use LIR information from ZK in addition to live_nodes to select replica for non-distrib request &amp;#8211; I am not sure we should do this. If we do, we should make sure we do not hit ZK in the fast path.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;None of the above will completely avoid this problem but they will make it less probable.&lt;/p&gt;</comment>
                            <comment id="15403348" author="hossman" created="Tue, 2 Aug 2016 04:57:20 +0000"  >&lt;blockquote&gt;&lt;p&gt;That being said, we can improve a few things:&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Add to that list &quot;replicas which know they are not active can response with &lt;tt&gt;503 Service Unavailable&lt;/tt&gt;&quot; ... which is what I thought replicas were already suppose to be doing in situations like this.&lt;/p&gt;

&lt;p&gt;I understand that not every client can immediately/magically know that replicas which are in recovery shouldn&apos;t be queried &amp;#8211; my concern is that replicas which &lt;em&gt;do&lt;/em&gt; know for a fact that they are in recovery and are inconsistent with their leader are happily participating in queries knowing that they are returning incorrect results.&lt;/p&gt;</comment>
                            <comment id="15404247" author="jira-bot" created="Tue, 2 Aug 2016 16:01:50 +0000"  >&lt;p&gt;Commit c17605b4a9978311b6b231f202d70dd800e473e6 in lucene-solr&apos;s branch refs/heads/branch_6x from Chris Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c17605b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c17605b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9363&quot; title=&quot;TestStressCloudBlindAtomicUpdates.test_dv_stored() failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9363&quot;&gt;&lt;del&gt;SOLR-9363&lt;/del&gt;&lt;/a&gt;: tweak test to work around &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9366&quot; title=&quot;replicas in LIR seem to still be participating in search requests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9366&quot;&gt;SOLR-9366&lt;/a&gt; + &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9367&quot; title=&quot;TestInjection&amp;#39;s use of a static Random means that sequences of events can be diff for the same test seed depending on wether individual methods are run, or entire test classes, or multiple classes in the same slave JVM&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9367&quot;&gt;&lt;del&gt;SOLR-9367&lt;/del&gt;&lt;/a&gt; since those issues are not key to what&apos;s being tested here&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 04321c401c6584395c76c509f8513c5e5e4730ee)&lt;/p&gt;</comment>
                            <comment id="15404250" author="jira-bot" created="Tue, 2 Aug 2016 16:01:55 +0000"  >&lt;p&gt;Commit 04321c401c6584395c76c509f8513c5e5e4730ee in lucene-solr&apos;s branch refs/heads/master from Chris Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=04321c4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=04321c4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9363&quot; title=&quot;TestStressCloudBlindAtomicUpdates.test_dv_stored() failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9363&quot;&gt;&lt;del&gt;SOLR-9363&lt;/del&gt;&lt;/a&gt;: tweak test to work around &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9366&quot; title=&quot;replicas in LIR seem to still be participating in search requests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9366&quot;&gt;SOLR-9366&lt;/a&gt; + &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9367&quot; title=&quot;TestInjection&amp;#39;s use of a static Random means that sequences of events can be diff for the same test seed depending on wether individual methods are run, or entire test classes, or multiple classes in the same slave JVM&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9367&quot;&gt;&lt;del&gt;SOLR-9367&lt;/del&gt;&lt;/a&gt; since those issues are not key to what&apos;s being tested here&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12557532">SOLR-3486</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12994138">SOLR-9367</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13212648">SOLR-13189</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12994000">SOLR-9363</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12821474" name="SOLR-9366.txt.gz" size="41662" author="hossman" created="Tue, 2 Aug 2016 00:35:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 16 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i31rzj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>