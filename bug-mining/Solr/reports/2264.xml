<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:00:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-6923] AutoAddReplicas should consult live nodes also to see if a state has changed</title>
                <link>https://issues.apache.org/jira/browse/SOLR-6923</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I did the following
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;./solr start -e cloud -noprompt

kill -9 &amp;lt;pid-of-node2&amp;gt; &lt;span class=&quot;code-comment&quot;&gt;//Not the node which is running ZK&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;/live_nodes reflects that the node is gone.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;This is the only message which gets logged on the node1 server after killing node2&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;45812 [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:9983] WARN  org.apache.zookeeper.server.NIOServerCnxn  &#8211; caught end of stream exception
EndOfStreamException: Unable to read additional data from client sessionid 0x14ac40f26660001, likely client has closed socket
    at org.apache.zookeeper.server.NIOServerCnxn.doIO(NIOServerCnxn.java:228)
    at org.apache.zookeeper.server.NIOServerCnxnFactory.run(NIOServerCnxnFactory.java:208)
    at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The graph shows the node2 as &apos;Gone&apos; state&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;clusterstate.json keeps showing the replica as &apos;active&apos;&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;{&lt;span class=&quot;code-quote&quot;&gt;&quot;collection1&quot;&lt;/span&gt;:{
    &lt;span class=&quot;code-quote&quot;&gt;&quot;shards&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;shard1&quot;&lt;/span&gt;:{
        &lt;span class=&quot;code-quote&quot;&gt;&quot;range&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;80000000-7fffffff&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;state&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;active&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;replicas&quot;&lt;/span&gt;:{
          &lt;span class=&quot;code-quote&quot;&gt;&quot;core_node1&quot;&lt;/span&gt;:{
            &lt;span class=&quot;code-quote&quot;&gt;&quot;state&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;active&quot;&lt;/span&gt;,
            &lt;span class=&quot;code-quote&quot;&gt;&quot;core&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;collection1&quot;&lt;/span&gt;,
            &lt;span class=&quot;code-quote&quot;&gt;&quot;node_name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;169.254.113.194:8983_solr&quot;&lt;/span&gt;,
            &lt;span class=&quot;code-quote&quot;&gt;&quot;base_url&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//169.254.113.194:8983/solr&quot;&lt;/span&gt;,
&lt;/span&gt;            &lt;span class=&quot;code-quote&quot;&gt;&quot;leader&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;},
          &lt;span class=&quot;code-quote&quot;&gt;&quot;core_node2&quot;&lt;/span&gt;:{
            &lt;span class=&quot;code-quote&quot;&gt;&quot;state&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;active&quot;&lt;/span&gt;,
            &lt;span class=&quot;code-quote&quot;&gt;&quot;core&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;collection1&quot;&lt;/span&gt;,
            &lt;span class=&quot;code-quote&quot;&gt;&quot;node_name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;169.254.113.194:8984_solr&quot;&lt;/span&gt;,
            &lt;span class=&quot;code-quote&quot;&gt;&quot;base_url&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//169.254.113.194:8984/solr&quot;&lt;/span&gt;}}}},
&lt;/span&gt;    &lt;span class=&quot;code-quote&quot;&gt;&quot;maxShardsPerNode&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;router&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;compositeId&quot;&lt;/span&gt;},
    &lt;span class=&quot;code-quote&quot;&gt;&quot;replicationFactor&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;autoAddReplicas&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;autoCreated&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;One immediate problem I can see is that AutoAddReplicas doesn&apos;t work since the clusterstate.json never changes. There might be more features which are affected by this.&lt;/p&gt;

&lt;p&gt;On first thought I think we can handle this - The shard leader could listen to changes on /live_nodes and if it has replicas that were on that node, mark it as &apos;down&apos; in the clusterstate.json?&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12765357">SOLR-6923</key>
            <summary>AutoAddReplicas should consult live nodes also to see if a state has changed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="markrmiller@gmail.com">Mark Miller</assignee>
                                    <reporter username="varun">Varun Thacker</reporter>
                        <labels>
                    </labels>
                <created>Wed, 7 Jan 2015 12:14:03 +0000</created>
                <updated>Mon, 9 May 2016 18:51:59 +0000</updated>
                            <resolved>Fri, 18 Sep 2015 12:17:27 +0000</resolved>
                                                    <fixVersion>5.0</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>SolrCloud</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="14268278" author="thelabdude" created="Wed, 7 Jan 2015 21:29:34 +0000"  >&lt;p&gt;The actual runtime state of a replica is determined by 1) what&apos;s in clusterstate.json and 2) check that the node hosting the replica is live. If the node is not live, the state reported in clusterstate.json can be &quot;stale&quot; for some time. It has always worked this way in SolrCloud. Thus, AutoAddReplicas needs to consult live nodes prior to thinking a node is live.&lt;/p&gt;</comment>
                            <comment id="14272953" author="varunthacker" created="Sun, 11 Jan 2015 16:35:36 +0000"  >&lt;p&gt;Thanks Tim for pointing it out. I was not aware of this.&lt;/p&gt;

&lt;p&gt;I&apos;ll rename the issue appropriately with this information and come up up with a patch for AutoAddReplicas to consult live nodes too.&lt;/p&gt;</comment>
                            <comment id="14274143" author="varunthacker" created="Mon, 12 Jan 2015 20:45:24 +0000"  >&lt;p&gt;Simple patch which checks against live nodes before short circuiting.&lt;/p&gt;

&lt;p&gt;SharedFSAutoReplicaFailoverTest passes. &lt;/p&gt;</comment>
                            <comment id="14274211" author="anshumg" created="Mon, 12 Jan 2015 21:35:59 +0000"  >&lt;p&gt;LGTM.&lt;/p&gt;</comment>
                            <comment id="14274340" author="jira-bot" created="Mon, 12 Jan 2015 22:53:40 +0000"  >&lt;p&gt;Commit 1651221 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anshumg&quot; class=&quot;user-hover&quot; rel=&quot;anshumg&quot;&gt;anshumg&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1651221&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1651221&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6923&quot; title=&quot;AutoAddReplicas should consult live nodes also to see if a state has changed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6923&quot;&gt;&lt;del&gt;SOLR-6923&lt;/del&gt;&lt;/a&gt;: AutoAddReplicas also consults live_nodes to see if a state change has happened&lt;/p&gt;</comment>
                            <comment id="14274345" author="jira-bot" created="Mon, 12 Jan 2015 22:56:33 +0000"  >&lt;p&gt;Commit 1651223 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anshumg&quot; class=&quot;user-hover&quot; rel=&quot;anshumg&quot;&gt;anshumg&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1651223&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1651223&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6923&quot; title=&quot;AutoAddReplicas should consult live nodes also to see if a state has changed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6923&quot;&gt;&lt;del&gt;SOLR-6923&lt;/del&gt;&lt;/a&gt;: AutoAddReplicas also consults live_nodes to see if a state change has happened (merge from trunk)&lt;/p&gt;</comment>
                            <comment id="14275556" author="markrmiller@gmail.com" created="Tue, 13 Jan 2015 17:08:45 +0000"  >&lt;p&gt;I&apos;ll look at what test we should add for this today or tomorrow.&lt;/p&gt;</comment>
                            <comment id="14305364" author="markrmiller@gmail.com" created="Wed, 4 Feb 2015 16:02:19 +0000"  >&lt;p&gt;Never got to this - I&apos;ll open a new issue to add a test.&lt;/p&gt;</comment>
                            <comment id="14338469" author="shalinmangar" created="Thu, 26 Feb 2015 14:40:06 +0000"  >&lt;p&gt;I was going to backport is to 4.10.4 but then I realized that this code has:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (lastClusterStateVersion == clusterState.getZkClusterStateVersion() &amp;amp;&amp;amp; baseUrlForBadNodes.size() == 0 &amp;amp;&amp;amp;
          liveNodes.equals(clusterState.getLiveNodes())) {
...
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Two Number objects are compared using == instead of .equals which is only guaranteed to work if the values are between -128 to 127. This is buggy!&lt;/p&gt;</comment>
                            <comment id="14341523" author="shalinmangar" created="Sat, 28 Feb 2015 13:33:03 +0000"  >&lt;p&gt;I am marking this for 4.10.5 whenever that happens. I fixed the bug I reported in my last comment with &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7178&quot; title=&quot;OverseerAutoReplicaFailoverThread compares Integer objects using ==&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7178&quot;&gt;&lt;del&gt;SOLR-7178&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14847340" author="shalinmangar" created="Fri, 18 Sep 2015 12:17:27 +0000"  >&lt;p&gt;This was released in 5.0&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12691734" name="SOLR-6923.patch" size="1674" author="varun" created="Mon, 12 Jan 2015 20:45:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 9 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i24147:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>