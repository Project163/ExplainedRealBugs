<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:11:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-17638] Some CLI errors not logged when starting prometheus exporter</title>
                <link>https://issues.apache.org/jira/browse/SOLR-17638</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Hey everyone, we are currently upgrading our 8.11 setup to 9.8 and right now I&apos;m working on the prometheus-exporter.&lt;/p&gt;

&lt;p&gt;To my surprise, the program was exiting directly without any output at all, which was very frustrating. Only after manually putting a log4j2 config in the classpath the culprit was finally visible:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.commons.cli.UnrecognizedOptionException: Unrecognized option: --zkhost&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;So the program was exiting because the cli option was renamed from zkhost to zk-host, would have been an easy fix normally, &lt;em&gt;if&lt;/em&gt; the program would have told me. What&apos;s funny though is that other messages are being logged to the console and I can&apos;t find the difference atm. My guess is that something got messed up after switching the cli lib in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16996&quot; title=&quot;Move Solr Exporter for Prometheus CLI to commons-cli&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16996&quot;&gt;&lt;del&gt;SOLR-16996&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Reproduction:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ podman run --rm -it --entrypoint bash solr:9.8.0 /opt/solr/prometheus-exporter/bin/solr-exporter --port=9854
ERROR - 2025-01-30 08:52:53.052; org.apache.solr.prometheus.exporter.SolrExporter; Must provide either --base-url or --zk-host
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.NullPointerException: Cannot invoke &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.solr.prometheus.exporter.SolrScrapeConfiguration.getType()&quot;&lt;/span&gt; because &lt;span class=&quot;code-quote&quot;&gt;&quot;configuration&quot;&lt;/span&gt; is &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&#160; &#160; at org.apache.solr.prometheus.exporter.SolrExporter.createScraper(SolrExporter.java:127)
&#160; &#160; at org.apache.solr.prometheus.exporter.SolrExporter.&amp;lt;init&amp;gt;(SolrExporter.java:90)
&#160; &#160; at org.apache.solr.prometheus.exporter.SolrExporter.main(SolrExporter.java:426)

$ podman run --rm -it --entrypoint bash solr:9.8.0 /opt/solr/prometheus-exporter/bin/solr-exporter --zkhost=lalala
  -&amp;gt; no output&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;(Small sidenote: The program errors when not providing --base-url or --zk-host, even though the help text says &lt;em&gt;If omitted both the -b parameter and the -z parameter, connect to &lt;a href=&quot;http://localhost:8983/solr&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8983/solr&lt;/a&gt;&lt;/em&gt;. Not sure if it&apos;s worth opening a separate issue for that, looks like the CLI args are being worked on already in 9.9)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13606749">SOLR-17638</key>
            <summary>Some CLI errors not logged when starting prometheus exporter</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stillalex">Alex Deparvu</assignee>
                                    <reporter username="der_eismann">Philipp Trulson</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 30 Jan 2025 08:54:56 +0000</created>
                <updated>Fri, 17 Oct 2025 20:05:46 +0000</updated>
                            <resolved>Fri, 25 Apr 2025 13:41:32 +0000</resolved>
                                    <version>9.8</version>
                                    <fixVersion>9.9</fixVersion>
                    <fixVersion>10.0</fixVersion>
                                    <component>contrib - prometheus-exporter</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="11400">3h 10m</timespent>
                                <comments>
                            <comment id="17931494" author="alex.parvulescu" created="Fri, 28 Feb 2025 14:54:17 +0000"  >&lt;p&gt;I am able to reproduce this and I think it might be related to the `exec` command somehow not being able to deal with the stacktrace being included in the output.&lt;/p&gt;

&lt;p&gt;This is the current code that breaks output - and aparently any logs coming to the cli after this messsage:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
log.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Failed to parse command line arguments: &quot;&lt;/span&gt;, e);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;A simple change fixes this. downside is for the ParseException this is sufficient but in the generic exception case it is not ideal to not have the stacktrace.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
log.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Failed to parse command line arguments: {}&quot;&lt;/span&gt;, e.getMessage());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I think a better fix could be in the exec script itself, but don&apos;t know yet.&lt;/p&gt;

&lt;p&gt;I can&apos;t tell if this is a widerspread cli issue of just affecting this module only. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=epugh&quot; class=&quot;user-hover&quot; rel=&quot;epugh&quot;&gt;epugh&lt;/a&gt; any ideas?&lt;/p&gt;

&lt;p&gt;Note. there is also a `return` statement &lt;a href=&quot;https://github.com/apache/solr/blob/releases/solr/9.8.0/solr/prometheus-exporter/src/java/org/apache/solr/prometheus/exporter/SolrExporter.java#L366&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;missing here&lt;/a&gt; causing the NPE in the cli output which should be fixed.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.NullPointerException: Cannot invoke &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.solr.prometheus.exporter.SolrScrapeConfiguration.getType()&quot;&lt;/span&gt; because &lt;span class=&quot;code-quote&quot;&gt;&quot;configuration&quot;&lt;/span&gt; is &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17931500" author="alex.parvulescu" created="Fri, 28 Feb 2025 15:08:48 +0000"  >&lt;p&gt;digging deeper, it might actually be related to the `log4j2.xml` config coming with the exporter. this would explain why providing a different one can show the exception. maybe the simpler fix is to tweak the OOTB config.&lt;/p&gt;</comment>
                            <comment id="17931580" author="epugh" created="Fri, 28 Feb 2025 21:49:44 +0000"  >&lt;p&gt;Thanks for digging into this.&#160;&#160; One of the goals for the CLI refactor work was to try and make ALL our CLI&apos;s work the same way, so that we have some strong patterns, and these weridnesses don&apos;t happen.&#160;&#160; It would be nice to add another test to the test_prometheus.bats file to demonstarate the error.&#160;&#160;&#160; &lt;/p&gt;

&lt;p&gt;Do tag me/bug me on any fixes.&#160; I wish i knew the prometheus stuff better, so thank you for digging into this...&#160;&#160;&#160; It&apos;s definitly a fail if the parmaeter parsing isn&apos;t working.&lt;/p&gt;

&lt;p&gt;Oh, one last thing, is the CLIUtils has a method to get the default solr if you don&apos;t provide -s or -z, but it check for expoert environment variables.&#160; Maybe those aren&apos;t being exported?&lt;/p&gt;</comment>
                            <comment id="17932341" author="alex.parvulescu" created="Tue, 4 Mar 2025 14:34:30 +0000"  >&lt;p&gt;put together a PR for this &lt;a href=&quot;https://github.com/apache/solr/pull/3236&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/solr/pull/3236&lt;/a&gt; &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=epugh&quot; class=&quot;user-hover&quot; rel=&quot;epugh&quot;&gt;epugh&lt;/a&gt; if you have a few spare minutes please take a look!&lt;/p&gt;</comment>
                            <comment id="17947319" author="jira-bot" created="Fri, 25 Apr 2025 12:23:05 +0000"  >&lt;p&gt;Commit 75289fa19237acafb34916548def8677b964d172 in solr&apos;s branch refs/heads/main from Alex Deparvu&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=75289fa1923&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=75289fa1923&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17638&quot; title=&quot;Some CLI errors not logged when starting prometheus exporter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17638&quot;&gt;&lt;del&gt;SOLR-17638&lt;/del&gt;&lt;/a&gt; Some CLI errors not logged when starting prometheus exporter (#3236)&lt;/p&gt;
</comment>
                            <comment id="17947333" author="alex.parvulescu" created="Fri, 25 Apr 2025 13:41:32 +0000"  >&lt;p&gt;working on backport now&lt;/p&gt;</comment>
                            <comment id="17947358" author="jira-bot" created="Fri, 25 Apr 2025 15:42:05 +0000"  >&lt;p&gt;Commit f5199e4c8c83d2b633acd55b91e16a3e335d08e5 in solr&apos;s branch refs/heads/branch_9x from Alex Deparvu&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=f5199e4c8c8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=f5199e4c8c8&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17638&quot; title=&quot;Some CLI errors not logged when starting prometheus exporter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17638&quot;&gt;&lt;del&gt;SOLR-17638&lt;/del&gt;&lt;/a&gt; Some CLI errors not logged when starting prometheus exporter (#3236) (#3337)&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 75289fa19237acafb34916548def8677b964d172)&lt;/p&gt;</comment>
                            <comment id="18009753" author="houston" created="Thu, 24 Jul 2025 22:50:53 +0000"  >&lt;p&gt;Closing after the 9.9.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1tx1c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>