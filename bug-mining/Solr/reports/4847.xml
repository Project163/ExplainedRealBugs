<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:50:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-15830] Concurrent core reloads mess up commits when using Schema API</title>
                <link>https://issues.apache.org/jira/browse/SOLR-15830</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;When using Schema API SchemaManager class triggers a core reload here: &lt;a href=&quot;https://github.com/apache/solr/blob/cfc953b6b906ef742bba57024d327fbde5d564c2/solr/core/src/java/org/apache/solr/schema/SchemaManager.java#L132&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/solr/blob/cfc953b6b906ef742bba57024d327fbde5d564c2/solr/core/src/java/org/apache/solr/schema/SchemaManager.java#L132&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;As I understand this was introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9832&quot; title=&quot;Schema modifications are not immediately visible on the coordinating node&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9832&quot;&gt;&lt;del&gt;SOLR-9832&lt;/del&gt;&lt;/a&gt; and is useful to avoid accidentally reloading to an older version of the config. The problem is that in the solr core a listener is implemented to initiate a reload whenever a config change happens in ZK, this can be found here: &lt;a href=&quot;https://github.com/apache/solr/blob/cfc953b6b906ef742bba57024d327fbde5d564c2/solr/core/src/java/org/apache/solr/core/SolrCore.java#L3140&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/solr/blob/cfc953b6b906ef742bba57024d327fbde5d564c2/solr/core/src/java/org/apache/solr/core/SolrCore.java#L3140&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;When updating the schema using the Schema API both of these reloads get triggered and this can result a strange bug, where not all the indexed documents are visible if the indexing is started just after the schema API returned.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13415281">SOLR-15830</key>
            <summary>Concurrent core reloads mess up commits when using Schema API</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="asalamon74">Andras Salamon</assignee>
                                    <reporter username="bszabo97">Bence Szab&#243;</reporter>
                        <labels>
                    </labels>
                <created>Fri, 3 Dec 2021 13:58:09 +0000</created>
                <updated>Tue, 10 Jan 2023 20:45:39 +0000</updated>
                            <resolved>Wed, 27 Apr 2022 12:58:57 +0000</resolved>
                                                    <fixVersion>9.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3600">1h</timespent>
                                <comments>
                            <comment id="17453026" author="bszabo97" created="Fri, 3 Dec 2021 14:03:57 +0000"  >&lt;p&gt;I was able to reproduce this bug in many versions with a script which creates a brand new collection and uses these two curl commands:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
curl -X POST -H &lt;span class=&quot;code-quote&quot;&gt;&apos;Content-Type: application/json&apos;&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//${solr_host}:${solr_port}/solr/${collection_name}/schema&quot;&lt;/span&gt; --data-binary @/root/schema
&lt;/span&gt;curl -X POST -H &lt;span class=&quot;code-quote&quot;&gt;&apos;Content-Type: application/csv&apos;&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//${solr_host}:${solr_port}/solr/${collection_name}/update&quot;&lt;/span&gt; --data-binary @/root/movieDetails3.csv &lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here movieDetail3.csv is a ~1MB csv document and schema is a json file which starts like:&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;add-field&quot;&lt;/span&gt;:[{&lt;span class=&quot;code-quote&quot;&gt;&quot;stored&quot;&lt;/span&gt;: True, &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;title&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;multiValued&quot;&lt;/span&gt;: False}, ...&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and all the fields found in the csv file are specified afterwards.&lt;/p&gt;

&lt;p&gt;After this in many cases I can&apos;t see all the documents, and no autocommits are triggered. If I commit manually (for example with curl) all the documents become available.&lt;/p&gt;</comment>
                            <comment id="17453030" author="bszabo97" created="Fri, 3 Dec 2021 14:07:58 +0000"  >&lt;p&gt;Also as an attempt to solve this, I added a lock to the SchemaManager class, before the reload, which is similar to the one I found in SolrCore: &lt;a href=&quot;https://github.com/apache/solr/blob/cfc953b6b906ef742bba57024d327fbde5d564c2/solr/core/src/java/org/apache/solr/core/SolrCore.java#L3137&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/solr/blob/cfc953b6b906ef742bba57024d327fbde5d564c2/solr/core/src/java/org/apache/solr/core/SolrCore.java#L3137&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This solved the problem, and I could see in solr logs that when solr core would try to initiate the second reload (triggered by the callback function), skips with the message:&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2021-12-02 14:39:59,267 INFO (&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-137)-----o.a.s.c.SolrCore: Another reload is in progress. Not doing anything. &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I did not create any PR for this one yet, I wanted to consult the idea first here.&lt;/p&gt;</comment>
                            <comment id="17462659" author="bszabo97" created="Mon, 20 Dec 2021 15:00:55 +0000"  >&lt;p&gt;I have opened a PR for this one where I also added a test which points out the bug, and fails without the locking in the SchemaManager.&#160;&lt;/p&gt;

&lt;p&gt;If anyone have some time please review it! Thank you!&lt;/p&gt;</comment>
                            <comment id="17528771" author="jira-bot" created="Wed, 27 Apr 2022 12:55:21 +0000"  >&lt;p&gt;Commit bdbb56cc0a38e964ba5c9c965c04c14e19cd7e67 in solr&apos;s branch refs/heads/main from Andras Salamon&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=bdbb56cc0a3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=bdbb56cc0a3&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15830&quot; title=&quot;Concurrent core reloads mess up commits when using Schema API&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15830&quot;&gt;&lt;del&gt;SOLR-15830&lt;/del&gt;&lt;/a&gt;: Concurrent core reloads mess up commits when using Schema API (#462)&lt;/p&gt;

&lt;p&gt;Co-authored-by: Bence Szabo &amp;lt;szabo.bencesandor97@gmail.com&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17528772" author="jira-bot" created="Wed, 27 Apr 2022 12:57:27 +0000"  >&lt;p&gt;Commit 3e4e230bfcb1d8e9889a0e705f6c397fbad42d86 in solr&apos;s branch refs/heads/branch_9x from Andras Salamon&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=3e4e230bfcb&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=3e4e230bfcb&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15830&quot; title=&quot;Concurrent core reloads mess up commits when using Schema API&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15830&quot;&gt;&lt;del&gt;SOLR-15830&lt;/del&gt;&lt;/a&gt;: Concurrent core reloads mess up commits when using Schema API (#462)&lt;/p&gt;

&lt;p&gt;Co-authored-by: Bence Szabo &amp;lt;szabo.bencesandor97@gmail.com&amp;gt;&lt;br/&gt;
(cherry picked from commit bdbb56cc0a38e964ba5c9c965c04c14e19cd7e67)&lt;/p&gt;</comment>
                            <comment id="17528773" author="asalamon74" created="Wed, 27 Apr 2022 12:58:57 +0000"  >&lt;p&gt;Thanks for the contribution &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bszabo97&quot; class=&quot;user-hover&quot; rel=&quot;bszabo97&quot;&gt;bszabo97&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17530227" author="risdenk" created="Fri, 29 Apr 2022 20:13:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=asalamon74&quot; class=&quot;user-hover&quot; rel=&quot;asalamon74&quot;&gt;asalamon74&lt;/a&gt; / &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bszabo97&quot; class=&quot;user-hover&quot; rel=&quot;bszabo97&quot;&gt;bszabo97&lt;/a&gt; idk if this ticket is related but can you see if this is related to the recent uptick in failures: &lt;a href=&quot;http://fucit.org/solr-jenkins-reports/history-trend-of-recent-failures.html#series/org.apache.solr.schema.TestBulkSchemaConcurrent.test&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://fucit.org/solr-jenkins-reports/history-trend-of-recent-failures.html#series/org.apache.solr.schema.TestBulkSchemaConcurrent.test&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The logs are filled with the new message &quot;  2&amp;gt; 2090637 INFO  (qtp189225028-23198) &lt;span class=&quot;error&quot;&gt;&amp;#91;n:127.0.0.1:35755_ c:collection1 s:shard2 r:core_node4 x:collection1_shard2_replica_n1&amp;#93;&lt;/span&gt; o.a.s.s.SchemaManager Another reload is in progress. Not doing anything.&quot;&lt;/p&gt;</comment>
                            <comment id="17530242" author="risdenk" created="Fri, 29 Apr 2022 20:57:07 +0000"  >&lt;p&gt;There is definitely a bug here - tracking it down in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16174&quot; title=&quot;Modernize TestBulkSchemaConcurrent&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16174&quot;&gt;&lt;del&gt;SOLR-16174&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17530247" author="risdenk" created="Fri, 29 Apr 2022 21:08:15 +0000"  >&lt;p&gt;PR to fix the lock bug: &lt;a href=&quot;https://github.com/apache/solr/pull/829&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/solr/pull/829&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17530345" author="asalamon74" created="Sat, 30 Apr 2022 06:34:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krisden&quot; class=&quot;user-hover&quot; rel=&quot;krisden&quot;&gt;krisden&lt;/a&gt; Yes, you are right ( as always &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ) we definitely need the &lt;tt&gt;unlock&lt;/tt&gt; here. Thanks for the fix and sorry for introducing the bug.&lt;/p&gt;</comment>
                            <comment id="17530346" author="bszabo97" created="Sat, 30 Apr 2022 07:00:04 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krisden&quot; class=&quot;user-hover&quot; rel=&quot;krisden&quot;&gt;krisden&lt;/a&gt; for the quick fix. Somehow I missed the unlock part, sorry for introducing this bug.&lt;/p&gt;</comment>
                            <comment id="17530529" author="jira-bot" created="Sun, 1 May 2022 16:08:33 +0000"  >&lt;p&gt;Commit 9f2dce1d9b56e774452ab5fe914f98ddcd4fb17b in solr&apos;s branch refs/heads/main from Kevin Risden&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=9f2dce1d9b5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=9f2dce1d9b5&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15830&quot; title=&quot;Concurrent core reloads mess up commits when using Schema API&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15830&quot;&gt;&lt;del&gt;SOLR-15830&lt;/del&gt;&lt;/a&gt;: Ensure SchemaManager releases lock&lt;/p&gt;</comment>
                            <comment id="17530531" author="jira-bot" created="Sun, 1 May 2022 16:11:26 +0000"  >&lt;p&gt;Commit 691bc7d3f15e917983fc64c38b287c0bd8128ad7 in solr&apos;s branch refs/heads/branch_9x from Kevin Risden&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=691bc7d3f15&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=691bc7d3f15&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15830&quot; title=&quot;Concurrent core reloads mess up commits when using Schema API&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15830&quot;&gt;&lt;del&gt;SOLR-15830&lt;/del&gt;&lt;/a&gt;: Ensure SchemaManager releases lock&lt;/p&gt;</comment>
                            <comment id="17656955" author="ishan" created="Tue, 10 Jan 2023 20:45:39 +0000"  >&lt;p&gt;Bulk closing 9.1 issues.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13442583">SOLR-16174</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 44 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0xc2w:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>