<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:43:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-11746] numeric fields need better error handling for prefix/wildcard syntax -- consider uniform support for &quot;foo:* == foo:[* TO *]&quot;</title>
                <link>https://issues.apache.org/jira/browse/SOLR-11746</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;On the solr-user mailing list, Torsten Krah pointed out that with Trie numeric fields, query syntax such as &lt;tt&gt;foo_d:&amp;#42;&lt;/tt&gt; has been functionality equivilent to &lt;tt&gt;foo_d:[&amp;#42; TO &amp;#42;]&lt;/tt&gt; and asked why this was not also supported for Point based numeric fields.&lt;/p&gt;

&lt;p&gt;The fact that this type of syntax works (for &lt;tt&gt;indexed=&quot;true&quot;&lt;/tt&gt; Trie fields) appears to have been an (untested, undocumented) fluke of Trie fields given that they use indexed terms for the (encoded) numeric terms and inherit the default implementation of &lt;tt&gt;FieldType.getPrefixQuery&lt;/tt&gt; which produces a prefix query against the &lt;tt&gt;&quot;&quot;&lt;/tt&gt; (empty string) term.  &lt;/p&gt;

&lt;p&gt;(Note that this syntax has aparently &lt;em&gt;&lt;b&gt;never&lt;/b&gt;&lt;/em&gt; worked for Trie fields with &lt;tt&gt;indexed=&quot;false&quot; docValues=&quot;true&quot;&lt;/tt&gt; )&lt;/p&gt;

&lt;p&gt;In general, we should assess the behavior users attempt a prefix/wildcard syntax query against numeric fields, as currently the behavior is largely non-sensical:  prefix/wildcard syntax frequently match no docs w/o any sort of error, and the aformentioned &lt;tt&gt;numeric_field:*&lt;/tt&gt; behaves inconsistently between points/trie fields and between indexed/docValued trie fields.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13124223">SOLR-11746</key>
            <summary>numeric fields need better error handling for prefix/wildcard syntax -- consider uniform support for &quot;foo:* == foo:[* TO *]&quot;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="houston">Houston Putman</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 Dec 2017 21:45:47 +0000</created>
                <updated>Mon, 14 Sep 2020 21:24:24 +0000</updated>
                            <resolved>Thu, 23 Jan 2020 05:52:26 +0000</resolved>
                                    <version>7.0</version>
                                    <fixVersion>8.5</fixVersion>
                    <fixVersion>9.0</fixVersion>
                                        <due></due>
                            <votes>3</votes>
                                    <watches>12</watches>
                                                                                                                <comments>
                            <comment id="16286637" author="hossman" created="Mon, 11 Dec 2017 21:58:16 +0000"  >&lt;blockquote&gt;&lt;p&gt;...currently the behavior is largely non-sensical: ...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Here&apos;s some examples of how solr behaves with a few &quot;odd&quot; queries (using the techproducts schema where &quot;price&quot; is a FloatPointField)...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;price:fo*o - Valid, Matches no docs
price:*    - Valid, Matches no docs
price:foo* - Error: &quot;Can&apos;t run prefix queries on numeric field&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The combination of the last two particularly confuses me, since clearly PointField is going out of it&apos;s way to do some error validation of attempting a prefix query on a numeric field, but somehow that error handling isn&apos;t being triggered by the simplest case (empty prefix) &lt;em&gt;AND&lt;/em&gt; neither is it able to &quot;match docs with prices&quot; (which is what TrieFloatField would do by accident) &lt;/p&gt;</comment>
                            <comment id="16288675" author="yseeley@gmail.com" created="Wed, 13 Dec 2017 03:47:32 +0000"  >&lt;p&gt;IMO it should count as a bug that numeric_field:* doesn&apos;t work.&lt;br/&gt;
The fact that it does work with trie fields may have originally been a fluke, but I would have added it if it hadn&apos;t worked (didn&apos;t realize there were no tests for it...)&lt;/p&gt;</comment>
                            <comment id="16295413" author="hossman" created="Mon, 18 Dec 2017 18:42:40 +0000"  >&lt;blockquote&gt;&lt;p&gt;IMO it should count as a bug that numeric_field:* doesn&apos;t work.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;I would go so far as to say thta once we &quot;fix&quot; this bug, we should also update QueryEqualityTest to assert that for all indexed/docValues/trie/points permutations of &quot;primative&quot; types (numbers, dates, string, boolean) &lt;tt&gt;field:&amp;#42;&lt;/tt&gt; should produce an identical Query object to &lt;tt&gt;field:[&amp;#42; TO &amp;#42;]&lt;/tt&gt; &amp;#8211; so that whatever &quot;optimizations&quot; may exist (or be added in the future) in one query parser code path, also happen for the other syntax as well.&lt;/p&gt;</comment>
                            <comment id="16315708" author="wkaichan" created="Mon, 8 Jan 2018 06:00:54 +0000"  >&lt;p&gt;I have added a patch to treat foo:* the same way as foo:&lt;span class=&quot;error&quot;&gt;&amp;#91;* TO *&amp;#93;&lt;/span&gt; for point fields. I hope it is useful as a starting point.&lt;/p&gt;</comment>
                            <comment id="16324739" author="hossman" created="Fri, 12 Jan 2018 23:37:02 +0000"  >&lt;p&gt;Kai: Thank you for your patch.&lt;/p&gt;

&lt;p&gt;I really don&apos;t think we should be special casing points fields in the parser like that &amp;#8211; if for no other reason then that it does nothing to fix the bug with docValue only trie fields, or address the concerns about ensuring these 2 syntaxes are functionally equivalent for all types.&lt;/p&gt;

&lt;p&gt;What suprised me the most about your patch was realizing that &lt;tt&gt;SolrQueryParserBase.getWildcardQuery&lt;/tt&gt; is the method getting triggered by the grammer when &lt;tt&gt;foo:&amp;#42;&lt;/tt&gt; is parsed &amp;#8211; i assumed it was smart enough to use &lt;tt&gt;SolrQueryParserBase.getPrefixQuery&lt;/tt&gt; with an empty prefix in this case.&lt;/p&gt;

&lt;p&gt;I&apos;m attaching a new patch that:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;makes &lt;tt&gt;getWildcardQuery&lt;/tt&gt; delegate to &lt;tt&gt;getPrefixQuery(...,&quot;&quot;)&lt;/tt&gt; when the wildcard pattern is &lt;tt&gt;&amp;#42;&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;makes &lt;tt&gt;FieldType.getPrefixQuery&lt;/tt&gt; smart enough to delegate to &lt;tt&gt;getRangeQuery(parser, sf,null,null,true,true)&lt;/tt&gt; when the prefix is the empty string&lt;/li&gt;
	&lt;li&gt;beefs up the QueryEqualiyTesting to cover more field types&lt;/li&gt;
	&lt;li&gt;adds new testing to TestSolrQueryParser to ensure that both syntaxes do what is intended: match all docs that contain the specific field.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I feel like this solution is more robust, and IIUC should even improve the performance of things like StrField and TextField by avoiding the need for an Atomoton that matches all terms&lt;/p&gt;

&lt;p&gt;What do folks think of this approach?&lt;/p&gt;</comment>
                            <comment id="16978796" author="tomasflobbe" created="Wed, 20 Nov 2019 22:50:32 +0000"  >&lt;p&gt;Does this make sense to do this in FieldType? or should it be in the NumericFieldType?&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   public Query getPrefixQuery(QParser parser, SchemaField sf, String termStr) {
+    if (&quot;&quot;.equals(termStr)) {
+      return getRangeQuery(parser, sf, null, null, true, true);
+    } 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Don&apos;t know if this was available when you wrote the patch, but there is a &lt;tt&gt;DocValuesFieldExistsQuery&lt;/tt&gt; which we could use now if dv=true&lt;/p&gt;</comment>
                            <comment id="16978805" author="hossman" created="Wed, 20 Nov 2019 23:04:08 +0000"  >&lt;p&gt;i&apos;m ashamed to admit that i thought this fix had been committed long ago ... i&apos;m not sure why i dropped the ball, let alone why i focused on FieldType instead of just NumericFieldType.  If i had to second guess myself i&apos;m assuming it&apos;s because I didn&apos;t think there was any risk in putting the prefix-&amp;gt;range delegation in FieldType and it would generally be an improvement for any Impl? but i have no strong feelings on it either way.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;... &lt;tt&gt;DocValuesFieldExistsQuery&lt;/tt&gt; ...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;yeah, i don&apos;t remember if that existed at the time, but it seems like the the choice to use that should be left up to the individual impl&apos;s of getRangeQuery as an optimization choice? ... ie: it would be a shame to have &lt;tt&gt;foo:*&lt;/tt&gt; be treated as special directly in FieldType (or NumericFieldType) and use &lt;tt&gt;DocValuesFieldExistsQuery&lt;/tt&gt; if foo has docValues, but not do the same if the user sends in &lt;tt&gt;foo:&lt;span class=&quot;error&quot;&gt;&amp;#91;\* TO \*&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;please feel free to take this issue see it to completely.&lt;/p&gt;</comment>
                            <comment id="17007084" author="houston" created="Thu, 2 Jan 2020 21:20:18 +0000"  >&lt;p&gt;I agree &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman&quot; class=&quot;user-hover&quot; rel=&quot;hossman&quot;&gt;hossman&lt;/a&gt;. If we are going to default to the &lt;tt&gt;getRangeQuery()&lt;/tt&gt;&#160;for every possible entrypoint of a field wildcard, then the docValues check should be done in that method.&lt;/p&gt;

&lt;p&gt;Also every &lt;tt&gt;getRangeQuery()&lt;/tt&gt; implementation should support this new optimization. So in order to help facilitate that, I refactored all overriding implementations of &lt;tt&gt;getRangeQuery()&lt;/tt&gt;&#160;to &lt;tt&gt;getSpecializedRangeQuery()&lt;/tt&gt;, which is called from &lt;tt&gt;FieldType.getRangeQuery()&lt;/tt&gt; which does the check for an existence Queries. Any pieces of custom code that add new fields (and override &lt;tt&gt;getRangeQuery()&lt;/tt&gt;)&#160;will not be broken by this, they will just not receive the new optimization.&lt;/p&gt;

&lt;p&gt;I would do the same thing for &lt;tt&gt;getPrefixQuery&lt;/tt&gt;, but there are no other overriding methods than the one included in this patch.&lt;/p&gt;</comment>
                            <comment id="17007683" author="tomasflobbe" created="Fri, 3 Jan 2020 18:22:37 +0000"  >&lt;p&gt;Patch Looks good. I&apos;d add a test to assert explicitly the cases where the query created is a &lt;tt&gt;DocValuesFieldExistsQuery&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17008988" author="houston" created="Mon, 6 Jan 2020 16:47:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tflobbe&quot; class=&quot;user-hover&quot; rel=&quot;tflobbe&quot;&gt;tflobbe&lt;/a&gt;&#160;added a test for that.&lt;/p&gt;

&lt;p&gt;All tests passed before I added the test, so I&apos;m going to do a final precommit check, then commit to 8 and master.&lt;/p&gt;</comment>
                            <comment id="17009000" author="houston" created="Mon, 6 Jan 2020 17:02:10 +0000"  >&lt;p&gt;Updated the ref-guide to reduce confusion.&lt;/p&gt;</comment>
                            <comment id="17009011" author="jira-bot" created="Mon, 6 Jan 2020 17:16:03 +0000"  >&lt;p&gt;Commit f5ab3ca688b3127bece252ffd87cc8bfa9f285ff in lucene-solr&apos;s branch refs/heads/master from Houston Putman&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=f5ab3ca&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=f5ab3ca&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11746&quot; title=&quot;numeric fields need better error handling for prefix/wildcard syntax -- consider uniform support for &amp;quot;foo:* == foo:[* TO *]&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11746&quot;&gt;&lt;del&gt;SOLR-11746&lt;/del&gt;&lt;/a&gt;: Existence query support for numeric point fields&lt;/p&gt;</comment>
                            <comment id="17009048" author="tomasflobbe" created="Mon, 6 Jan 2020 17:41:56 +0000"  >&lt;p&gt;Thanks for updating the docs. One nit:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-** `field:[* TO *]` matches all documents with the field
+** `field:*` or `field:[* TO *]` matches all documents where the field exists
 * Pure negative queries (all clauses prohibited) are allowed (only as a top-level clause)
 ** `-inStock:&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;` finds all field values where inStock is not &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
 ** `-field:[* TO *]` finds all documents without a value &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; field
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;You updated the positive but not the negative, i.e. &lt;tt&gt;`-field:*` or `-field:&lt;span class=&quot;error&quot;&gt;&amp;#91;* TO *&amp;#93;&lt;/span&gt;`...&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="17009050" author="houston" created="Mon, 6 Jan 2020 17:44:03 +0000"  >&lt;p&gt;Good call, I&apos;ll add that in when I push to 8x, and commit the small change to master&lt;/p&gt;</comment>
                            <comment id="17009068" author="jira-bot" created="Mon, 6 Jan 2020 18:09:33 +0000"  >&lt;p&gt;Commit 1f1b719478e298b5ada064197a7fa919b608d24c in lucene-solr&apos;s branch refs/heads/branch_8x from Houston Putman&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=1f1b719&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=1f1b719&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11746&quot; title=&quot;numeric fields need better error handling for prefix/wildcard syntax -- consider uniform support for &amp;quot;foo:* == foo:[* TO *]&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11746&quot;&gt;&lt;del&gt;SOLR-11746&lt;/del&gt;&lt;/a&gt;: Existence query support for numeric point fields&lt;/p&gt;</comment>
                            <comment id="17009069" author="jira-bot" created="Mon, 6 Jan 2020 18:10:49 +0000"  >&lt;p&gt;Commit 9edb143efdc6616906972ae6c629860c91a5a2e7 in lucene-solr&apos;s branch refs/heads/master from Houston Putman&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=9edb143&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=9edb143&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11746&quot; title=&quot;numeric fields need better error handling for prefix/wildcard syntax -- consider uniform support for &amp;quot;foo:* == foo:[* TO *]&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11746&quot;&gt;&lt;del&gt;SOLR-11746&lt;/del&gt;&lt;/a&gt;: Adding docs for negative existence queries.&lt;/p&gt;</comment>
                            <comment id="17009132" author="dsmiley" created="Mon, 6 Jan 2020 19:55:40 +0000"  >&lt;p&gt;I&apos;m really glad to finally see this get in &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&#160;. Thanks everyone!&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17009443" author="jira-bot" created="Tue, 7 Jan 2020 07:47:18 +0000"  >&lt;p&gt;Commit f5ab3ca688b3127bece252ffd87cc8bfa9f285ff in lucene-solr&apos;s branch refs/heads/gradle-master from Houston Putman&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=f5ab3ca&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=f5ab3ca&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11746&quot; title=&quot;numeric fields need better error handling for prefix/wildcard syntax -- consider uniform support for &amp;quot;foo:* == foo:[* TO *]&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11746&quot;&gt;&lt;del&gt;SOLR-11746&lt;/del&gt;&lt;/a&gt;: Existence query support for numeric point fields&lt;/p&gt;</comment>
                            <comment id="17009444" author="jira-bot" created="Tue, 7 Jan 2020 07:47:20 +0000"  >&lt;p&gt;Commit 9edb143efdc6616906972ae6c629860c91a5a2e7 in lucene-solr&apos;s branch refs/heads/gradle-master from Houston Putman&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=9edb143&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=9edb143&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11746&quot; title=&quot;numeric fields need better error handling for prefix/wildcard syntax -- consider uniform support for &amp;quot;foo:* == foo:[* TO *]&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11746&quot;&gt;&lt;del&gt;SOLR-11746&lt;/del&gt;&lt;/a&gt;: Adding docs for negative existence queries.&lt;/p&gt;</comment>
                            <comment id="17010951" author="hossman" created="Wed, 8 Jan 2020 19:15:56 +0000"  >&lt;p&gt;something about this change appears to have broken &quot;range search&quot; for numeric float (and possibly double?) fields when dealing with &quot;NaN&quot; in indexed documents&lt;/p&gt;

&lt;p&gt;Jenkins found the following reproducing failing seed on master...&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://fucit.org/solr-jenkins-reports/job-data/thetaphi/Lucene-Solr-master-Linux/25286&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://fucit.org/solr-jenkins-reports/job-data/thetaphi/Lucene-Solr-master-Linux/25286&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; 2210525 INFO  (TEST-DocValuesTest.testFloatAndDoubleRangeQueryRandom-seed#[71B4E4F64D35520]) [     ] o.a.s.s.DocValuesTest Expected: [//*[@numFound=&apos;5&apos;], //result/doc[1]/st
r[@name=&apos;id&apos;][.=1], //result/doc[1]/float[@name=&apos;score&apos;][.=1.0], //result/doc[2]/str[@name=&apos;id&apos;][.=2], //result/doc[2]/float[@name=&apos;score&apos;][.=1.0], //result/doc[3]/str[@name=&apos;id&apos;][.=3], //r
esult/doc[3]/float[@name=&apos;score&apos;][.=1.0], //result/doc[4]/str[@name=&apos;id&apos;][.=5], //result/doc[4]/float[@name=&apos;score&apos;][.=1.0], //result/doc[5]/str[@name=&apos;id&apos;][.=6], //result/doc[5]/float[@nam
e=&apos;score&apos;][.=1.0]]
   [junit4]   2&amp;gt; 2210525 INFO  (TEST-DocValuesTest.testFloatAndDoubleRangeQueryRandom-seed#[71B4E4F64D35520]) [     ] o.a.s.c.S.Request [collection1]  webapp=null path=null params={q=floatd
v:{*+TO+*}&amp;amp;fl=id,floatdv,score&amp;amp;sort=id_i+asc&amp;amp;wt=xml} hits=6 status=0 QTime=0
   [junit4]   2&amp;gt; 2210525 ERROR (TEST-DocValuesTest.testFloatAndDoubleRangeQueryRandom-seed#[71B4E4F64D35520]) [     ] o.a.s.SolrTestCaseJ4 REQUEST FAILED: xpath=//*[@numFound=&apos;5&apos;]
   [junit4]   2&amp;gt;        xml response was: &amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;
   [junit4]   2&amp;gt; &amp;lt;response&amp;gt;
   [junit4]   2&amp;gt; &amp;lt;lst name=&quot;responseHeader&quot;&amp;gt;&amp;lt;int name=&quot;status&quot;&amp;gt;0&amp;lt;/int&amp;gt;&amp;lt;int name=&quot;QTime&quot;&amp;gt;0&amp;lt;/int&amp;gt;&amp;lt;/lst&amp;gt;&amp;lt;result name=&quot;response&quot; numFound=&quot;6&quot; start=&quot;0&quot; maxScore=&quot;1.0&quot;&amp;gt;&amp;lt;doc&amp;gt;&amp;lt;str name=&quot;id&quot;&amp;gt;1&amp;lt;/str
&amp;gt;&amp;lt;float name=&quot;floatdv&quot;&amp;gt;-5.9166734E-15&amp;lt;/float&amp;gt;&amp;lt;float name=&quot;score&quot;&amp;gt;1.0&amp;lt;/float&amp;gt;&amp;lt;/doc&amp;gt;&amp;lt;doc&amp;gt;&amp;lt;str name=&quot;id&quot;&amp;gt;2&amp;lt;/str&amp;gt;&amp;lt;float name=&quot;floatdv&quot;&amp;gt;1.6398867E38&amp;lt;/float&amp;gt;&amp;lt;float name=&quot;score&quot;&amp;gt;1.0&amp;lt;/float&amp;gt;&amp;lt;/doc&amp;gt;&amp;lt;
doc&amp;gt;&amp;lt;str name=&quot;id&quot;&amp;gt;3&amp;lt;/str&amp;gt;&amp;lt;float name=&quot;floatdv&quot;&amp;gt;-4.211542E-32&amp;lt;/float&amp;gt;&amp;lt;float name=&quot;score&quot;&amp;gt;1.0&amp;lt;/float&amp;gt;&amp;lt;/doc&amp;gt;&amp;lt;doc&amp;gt;&amp;lt;str name=&quot;id&quot;&amp;gt;4&amp;lt;/str&amp;gt;&amp;lt;float name=&quot;floatdv&quot;&amp;gt;NaN&amp;lt;/float&amp;gt;&amp;lt;float name=&quot;score&quot;&amp;gt;1.0
&amp;lt;/float&amp;gt;&amp;lt;/doc&amp;gt;&amp;lt;doc&amp;gt;&amp;lt;str name=&quot;id&quot;&amp;gt;5&amp;lt;/str&amp;gt;&amp;lt;float name=&quot;floatdv&quot;&amp;gt;-3.1379082E32&amp;lt;/float&amp;gt;&amp;lt;float name=&quot;score&quot;&amp;gt;1.0&amp;lt;/float&amp;gt;&amp;lt;/doc&amp;gt;&amp;lt;doc&amp;gt;&amp;lt;str name=&quot;id&quot;&amp;gt;6&amp;lt;/str&amp;gt;&amp;lt;float name=&quot;floatdv&quot;&amp;gt;3407.986&amp;lt;/float&amp;gt;&amp;lt;fl
oat name=&quot;score&quot;&amp;gt;1.0&amp;lt;/float&amp;gt;&amp;lt;/doc&amp;gt;&amp;lt;/result&amp;gt;
   [junit4]   2&amp;gt; &amp;lt;/response&amp;gt;
...

   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=DocValuesTest -Dtests.method=testFloatAndDoubleRangeQueryRandom -Dtests.seed=71B4E4F64D35520 -Dtests.multiplier=3 -Dtests.slow=true -Dtests.locale=ksf -Dtests.timezone=Asia/Yangon -Dtests.asserts=true -Dtests.file.encoding=UTF-8
   [junit4] ERROR   0.14s J0 | DocValuesTest.testFloatAndDoubleRangeQueryRandom &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.RuntimeException: Exception during query
   [junit4]    &amp;gt;        at __randomizedtesting.SeedInfo.seed([71B4E4F64D35520:3F8B601CA87B4CBB]:0)
   [junit4]    &amp;gt;        at org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:1002)
   [junit4]    &amp;gt;        at org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:962)
   [junit4]    &amp;gt;        at org.apache.solr.schema.DocValuesTest.testFloatAndDoubleRangeQueryRandom(DocValuesTest.java:632)
   [junit4]    &amp;gt;        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
   [junit4]    &amp;gt;        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
   [junit4]    &amp;gt;        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
   [junit4]    &amp;gt;        at java.base/java.lang.reflect.Method.invoke(Method.java:564)
   [junit4]    &amp;gt;        at java.base/java.lang.Thread.run(Thread.java:832)
   [junit4]    &amp;gt; Caused by: java.lang.RuntimeException: REQUEST FAILED: xpath=//*[@numFound=&apos;5&apos;]
   [junit4]    &amp;gt;        xml response was: &amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;
   [junit4]    &amp;gt; &amp;lt;response&amp;gt;
   [junit4]    &amp;gt; &amp;lt;lst name=&quot;responseHeader&quot;&amp;gt;&amp;lt;int name=&quot;status&quot;&amp;gt;0&amp;lt;/int&amp;gt;&amp;lt;int name=&quot;QTime&quot;&amp;gt;0&amp;lt;/int&amp;gt;&amp;lt;/lst&amp;gt;&amp;lt;result name=&quot;response&quot; numFound=&quot;6&quot; start=&quot;0&quot; maxScore=&quot;1.0&quot;&amp;gt;&amp;lt;doc&amp;gt;&amp;lt;str name=&quot;id&quot;&amp;gt;1&amp;lt;/str&amp;gt;&amp;lt;float name=&quot;floatdv&quot;&amp;gt;-5.9166734E-15&amp;lt;/float&amp;gt;&amp;lt;float name=&quot;score&quot;&amp;gt;1.0&amp;lt;/float&amp;gt;&amp;lt;/doc&amp;gt;&amp;lt;doc&amp;gt;&amp;lt;str name=&quot;id&quot;&amp;gt;2&amp;lt;/str&amp;gt;&amp;lt;float name=&quot;floatdv&quot;&amp;gt;1.6398867E38&amp;lt;/float&amp;gt;&amp;lt;float name=&quot;score&quot;&amp;gt;1.0&amp;lt;/float&amp;gt;&amp;lt;/doc&amp;gt;&amp;lt;doc&amp;gt;&amp;lt;str name=&quot;id&quot;&amp;gt;3&amp;lt;/str&amp;gt;&amp;lt;float name=&quot;floatdv&quot;&amp;gt;-4.211542E-32&amp;lt;/float&amp;gt;&amp;lt;float name=&quot;score&quot;&amp;gt;1.0&amp;lt;/float&amp;gt;&amp;lt;/doc&amp;gt;&amp;lt;doc&amp;gt;&amp;lt;str name=&quot;id&quot;&amp;gt;4&amp;lt;/str&amp;gt;&amp;lt;float name=&quot;floatdv&quot;&amp;gt;NaN&amp;lt;/float&amp;gt;&amp;lt;float name=&quot;score&quot;&amp;gt;1.0&amp;lt;/float&amp;gt;&amp;lt;/doc&amp;gt;&amp;lt;doc&amp;gt;&amp;lt;str name=&quot;id&quot;&amp;gt;5&amp;lt;/str&amp;gt;&amp;lt;float name=&quot;floatdv&quot;&amp;gt;-3.1379082E32&amp;lt;/float&amp;gt;&amp;lt;float name=&quot;score&quot;&amp;gt;1.0&amp;lt;/float&amp;gt;&amp;lt;/doc&amp;gt;&amp;lt;doc&amp;gt;&amp;lt;str name=&quot;id&quot;&amp;gt;6&amp;lt;/str&amp;gt;&amp;lt;float name=&quot;floatdv&quot;&amp;gt;3407.986&amp;lt;/float&amp;gt;&amp;lt;float name=&quot;score&quot;&amp;gt;1.0&amp;lt;/float&amp;gt;&amp;lt;/doc&amp;gt;&amp;lt;/result&amp;gt;
   [junit4]    &amp;gt; &amp;lt;/response&amp;gt;
   [junit4]    &amp;gt;        request was:q=floatdv:{*+TO+*}&amp;amp;fl=id,floatdv,score&amp;amp;sort=id_i+asc&amp;amp;wt=xml
   [junit4]    &amp;gt;        at org.apache.solr.SolrTestCaseJ4.assertQ(SolrTestCaseJ4.java:995)
   [junit4]    &amp;gt;        ... 41 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This seed reprodces reliably for me as of f5ab3ca688b3127bece252ffd87cc8bfa9f285ff, but not for the commit just prior to this change (b6f31835ad18da0f7a22064481b0d0e167f9f30c)&lt;/p&gt;</comment>
                            <comment id="17010985" author="houston" created="Wed, 8 Jan 2020 20:08:46 +0000"  >&lt;p&gt;Yeah, it looks like &lt;tt&gt;NaN&lt;/tt&gt; used to be treated as a missing field. Switching to &lt;tt&gt;DocValuesFieldExistsQuery&lt;/tt&gt; caused the&#160;&#160;&lt;span class=&quot;error&quot;&gt;&amp;#91;* TO *&amp;#93;&lt;/span&gt; query to treat NaN like any other numeric value.&lt;/p&gt;

&lt;p&gt;Seeing here&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3582&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/LUCENE-3582&lt;/a&gt;&#160;it looks like the expected behavior of numericField:* is not to return any NaN values, which makes it not really an existence query... This complicates things, and doesn&apos;t really let us use the&#160;&lt;tt&gt;DocValuesFieldExistsQuery anymore.&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="17011006" author="dsmiley" created="Wed, 8 Jan 2020 20:49:28 +0000"  >&lt;p&gt;I think if a user supplies NaN in a document, we should treat that identically as indexing nothing at all.&lt;/p&gt;</comment>
                            <comment id="17011049" author="hossman" created="Wed, 8 Jan 2020 22:48:51 +0000"  >&lt;blockquote&gt;&lt;p&gt;Yeah, it looks like NaN used to be treated as a missing field.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;That&apos;s not true &#8211; in 8.4 the &lt;tt&gt;exists()&lt;/tt&gt; function recognizes &apos;NaN&apos; as a field value that exists...&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ curl &apos;http://localhost:8983/solr/techproducts/update?commit=true&apos; -H &apos;Content-Type: application/json&apos; --data-binary &apos;[{&quot;id&quot;:&quot;hoss_1&quot;,&quot;hoss_b&quot;:true,&quot;hoss_f&quot;:1},{&quot;id&quot;:&quot;hoss_nan&quot;,&quot;hoss_b&quot;:true,&quot;hoss_f&quot;:&quot;NaN&quot;},{&quot;id&quot;:&quot;hoss_missing&quot;,&quot;hoss_b&quot;:true}]&apos;
{
  &quot;responseHeader&quot;:{
    &quot;status&quot;:0,
    &quot;QTime&quot;:34}}
$ curl &apos;http://localhost:8983/solr/techproducts/query?q=hoss_b:true&amp;amp;fl=id,exists(hoss_f)&apos;
{
  &quot;responseHeader&quot;:{
    &quot;status&quot;:0,
    &quot;QTime&quot;:18,
    &quot;params&quot;:{
      &quot;q&quot;:&quot;hoss_b:true&quot;,
      &quot;fl&quot;:&quot;id,exists(hoss_f)&quot;}},
  &quot;response&quot;:{&quot;numFound&quot;:3,&quot;start&quot;:0,&quot;docs&quot;:[
      {
        &quot;id&quot;:&quot;hoss_1&quot;,
        &quot;exists(hoss_f)&quot;:true},
      {
        &quot;id&quot;:&quot;hoss_nan&quot;,
        &quot;exists(hoss_f)&quot;:true},
      {
        &quot;id&quot;:&quot;hoss_missing&quot;,
        &quot;exists(hoss_f)&quot;:false}]
  }}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;...what changed is how wild card range queries treat NaN.&lt;/p&gt;

&lt;p&gt;specifically, that the commits in this issue modified open ended wildcard queries to now automatically acting as &quot;exists&quot; queries, even for float &amp;amp; double where &quot;NaN&quot; is a (currently) a legal value to index and query, but is (correctly AFAICT) not considered in the range of &quot;* TO *&quot;&#160; (ie: -Infinity TO +Infinity&quot;) for those field types ...&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; $ curl &apos;http://localhost:8983/solr/techproducts/query?q=hoss_f:NaN&apos;
{
  &quot;responseHeader&quot;:{
    &quot;status&quot;:0,
    &quot;QTime&quot;:11,
    &quot;params&quot;:{
      &quot;q&quot;:&quot;hoss_f:NaN&quot;}},
  &quot;response&quot;:{&quot;numFound&quot;:1,&quot;start&quot;:0,&quot;docs&quot;:[
      {
        &quot;id&quot;:&quot;hoss_nan&quot;,
        &quot;hoss_b&quot;:true,
        &quot;hoss_f&quot;:&quot;NaN&quot;,
        &quot;_version_&quot;:1655199818342989824}]
  }}

$ curl &apos;http://localhost:8983/solr/techproducts/query?q=hoss_f:%5B*+TO+*%5D&apos;
{
  &quot;responseHeader&quot;:{
    &quot;status&quot;:0,
    &quot;QTime&quot;:7,
    &quot;params&quot;:{
      &quot;q&quot;:&quot;hoss_f:[* TO *]&quot;}},
  &quot;response&quot;:{&quot;numFound&quot;:1,&quot;start&quot;:0,&quot;docs&quot;:[
      {
        &quot;id&quot;:&quot;hoss_1&quot;,
        &quot;hoss_b&quot;:true,
        &quot;hoss_f&quot;:1.0,
        &quot;_version_&quot;:1655199818341941248}]
  }}

$ curl &apos;http://localhost:8983/solr/techproducts/query?q=hoss_f:%5B-Infinity+TO+%2BInfinity%5D&apos;
{
  &quot;responseHeader&quot;:{
    &quot;status&quot;:0,
    &quot;QTime&quot;:2,
    &quot;params&quot;:{
      &quot;q&quot;:&quot;hoss_f:[-Infinity TO +Infinity]&quot;}},
  &quot;response&quot;:{&quot;numFound&quot;:1,&quot;start&quot;:0,&quot;docs&quot;:[
      {
        &quot;id&quot;:&quot;hoss_1&quot;,
        &quot;hoss_b&quot;:true,
        &quot;hoss_f&quot;:1.0,
        &quot;_version_&quot;:1655199818341941248}]
  }}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Seeing here &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3582&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/LUCENE-3582&lt;/a&gt; it looks like the expected behavior of numericField:* is not to return any NaN values, ...&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;really? ... i don&apos;t see the concept of how a &quot;prefix&quot; syntax on numeric fields should behave discussed in &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3582&quot; title=&quot;NumericUtils.floatToSortableInt/doubleToSortableLong does not sort certain NaN ranges correctly and NumericRangeQuery produces wrong results for NaNs with half-open ranges&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-3582&quot;&gt;&lt;del&gt;LUCENE-3582&lt;/del&gt;&lt;/a&gt; at all ... or are you extrapolating from the assumption made in &lt;em&gt;this&lt;/em&gt; issue that &lt;tt&gt;numericField:*&lt;/tt&gt; should be equivalent to &lt;tt&gt;numericField:&lt;span class=&quot;error&quot;&gt;&amp;#91;* TO *&amp;#93;&lt;/span&gt;&lt;/tt&gt; ?&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;I think if a user supplies NaN in a document, we should treat that identically as indexing nothing at all.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I don&apos;t know if i agree with that (but i also don&apos;t know that i feel strongly opposed to it either)&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;I would suggest taking a step back and re-evaluating the original objective of this jira:&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Attemping prefix or wildcard query syntax on a numeric field has unspecified &amp;amp; inconsistent behavior between trie &amp;amp; point fields&lt;/b&gt;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;From that initial problem statement, there was discussion focused specifically on officially supporting &quot;empty prefix syntax&quot; input (ie: &lt;tt&gt;foo:*&lt;/tt&gt; ) and defining it as being equivalent to an open ended range query (ie: &lt;tt&gt;foo:&lt;span class=&quot;error&quot;&gt;&amp;#91;* TO *&amp;#93;&lt;/span&gt;&lt;/tt&gt;) ... with the implied assumption that any &lt;em&gt;other&lt;/em&gt; prefix/wildcard syntax should certainly be an error.&lt;/li&gt;
	&lt;li&gt;&lt;em&gt;After&lt;/em&gt; that came some discussion of making both of those syntaxs use DocValuesFieldExistsQuery &lt;em&gt;as an optimization&lt;/em&gt; ... but that optimization doesn&apos;t hold true for float &amp;amp; double where &quot;NaN&quot; is currently supported&lt;/li&gt;
	&lt;li&gt;And through it all, it seems we never explicitly considered/discussed if/how these things did/should behave for float/double fields when &quot;NaN&quot; was involved.&lt;/li&gt;
&lt;/ul&gt;


&lt;hr /&gt;
&lt;p&gt;My personal opinion, today, is that I was wrong back in 2018; that we should &lt;em&gt;&lt;b&gt;NOT&lt;/b&gt;&lt;/em&gt; make a blanket assumption that &lt;tt&gt;foo:*&lt;/tt&gt; is equivalent to &lt;tt&gt;foo:&lt;span class=&quot;error&quot;&gt;&amp;#91;* TO *&amp;#93;&lt;/span&gt;&lt;/tt&gt; for all numeric types.&lt;/p&gt;

&lt;p&gt;I think that for types like &quot;int&quot; and &quot;long&quot;, this sort of equivalence/optimization may makes sense, but it doesn&apos;t necessarily make sense for float/double.&lt;/p&gt;

&lt;p&gt;I think what would make sense as a general statement/attitude/documetation is to say:&lt;/p&gt;
&lt;div class=&quot;panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;p&gt;For all numeric fields &apos;foo&apos;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;foo:*&lt;/tt&gt; matches any document that has a value in that field
	&lt;ul&gt;
		&lt;li&gt;ie: use DocValuesFieldExistsQuery (or possible equivalent when docValues=false)&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;foo:&lt;span class=&quot;error&quot;&gt;&amp;#91;* TO *&amp;#93;&lt;/span&gt;&lt;/tt&gt; matches any document with a value between the effective values of -Infinity and +Infinity for that field type
	&lt;ul&gt;
		&lt;li&gt;ie: functionally equivalent to &lt;tt&gt;foo:*&lt;/tt&gt; for int/long, but will not match &apos;NaN&apos; for float/double field types&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I also think that whatever we decide, we need to make sure some of those other prefix/wildcard examples mentioned back when this jira was filed have (new) tests showing they give clean &amp;amp; consistent errors across the types...&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Here&apos;s some examples of how solr behaves with a few &quot;odd&quot; queries (using the techproducts schema where &quot;price&quot; is a FloatPointField)...&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;price:fo*o - Valid, Matches no docs
price:*    - Valid, Matches no docs
price:foo* - Error: &quot;Can&apos;t run prefix queries on numeric field&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;
&lt;p&gt;...looking at on the existing commits for this issue, i don&apos;t see any test cases for these &quot;bad input&quot; type situations&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;Either way, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=houston&quot; class=&quot;user-hover&quot; rel=&quot;houston&quot;&gt;houston&lt;/a&gt;: i &apos;d like to request that you revert the existing commits to this issue since:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;it&apos;s actively causing jenkins test failures&lt;/li&gt;
	&lt;li&gt;instead of just being a &quot;fix&quot; for bad input + an optimization, we&apos;ve now identified a situation where the optimization breaks existing behavior, so...&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;further discussion seems warranted to reach consensus on the expected behavior master&lt;/li&gt;
		&lt;li&gt;some/all of this should definitely not be in branch_8x as a result of the (current) backcompat break&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17011072" author="houston" created="Wed, 8 Jan 2020 23:31:53 +0000"  >&lt;p&gt;I&apos;ll revert the commits.&lt;/p&gt;

&lt;p&gt;In general, yes I was assuming that the logic of &lt;tt&gt;field:&lt;span class=&quot;error&quot;&gt;&amp;#91;* TO *&amp;#93;&lt;/span&gt;&lt;/tt&gt; and &lt;tt&gt;field:*&lt;/tt&gt; were identical. I do think this warrants a larger discussion on how NaN should be treated, because I don&apos;t think that those two queries should be logically different. (Though I do understand there&apos;s nothing we can do about 8.x)&lt;/p&gt;</comment>
                            <comment id="17011076" author="jira-bot" created="Wed, 8 Jan 2020 23:36:34 +0000"  >&lt;p&gt;Commit 6fde6dc5040729cc108e2efe3f2540bd74f3ca92 in lucene-solr&apos;s branch refs/heads/branch_8x from Houston Putman&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=6fde6dc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=6fde6dc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Revert &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11746&quot; title=&quot;numeric fields need better error handling for prefix/wildcard syntax -- consider uniform support for &amp;quot;foo:* == foo:[* TO *]&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11746&quot;&gt;&lt;del&gt;SOLR-11746&lt;/del&gt;&lt;/a&gt;: Existence query support for numeric point fields&quot;&lt;/p&gt;

&lt;p&gt;This reverts commit 1f1b719478e298b5ada064197a7fa919b608d24c.&lt;/p&gt;</comment>
                            <comment id="17011077" author="jira-bot" created="Wed, 8 Jan 2020 23:38:07 +0000"  >&lt;p&gt;Commit ee66e5ef23b841f7f1f2e9820f1ebe380c29b672 in lucene-solr&apos;s branch refs/heads/master from Houston Putman&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=ee66e5e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=ee66e5e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Revert &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11746&quot; title=&quot;numeric fields need better error handling for prefix/wildcard syntax -- consider uniform support for &amp;quot;foo:* == foo:[* TO *]&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11746&quot;&gt;&lt;del&gt;SOLR-11746&lt;/del&gt;&lt;/a&gt;: Adding docs for negative existence queries.&quot;&lt;/p&gt;

&lt;p&gt;This reverts commit 9edb143efdc6616906972ae6c629860c91a5a2e7.&lt;/p&gt;</comment>
                            <comment id="17011078" author="jira-bot" created="Wed, 8 Jan 2020 23:38:09 +0000"  >&lt;p&gt;Commit 08b64aab8f0c3af58b519e83c33dd3b599612cf4 in lucene-solr&apos;s branch refs/heads/master from Houston Putman&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=08b64aa&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=08b64aa&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Revert &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11746&quot; title=&quot;numeric fields need better error handling for prefix/wildcard syntax -- consider uniform support for &amp;quot;foo:* == foo:[* TO *]&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11746&quot;&gt;&lt;del&gt;SOLR-11746&lt;/del&gt;&lt;/a&gt;: Existence query support for numeric point fields&quot;&lt;/p&gt;

&lt;p&gt;This reverts commit f5ab3ca688b3127bece252ffd87cc8bfa9f285ff.&lt;/p&gt;</comment>
                            <comment id="17011083" author="hossman" created="Wed, 8 Jan 2020 23:56:56 +0000"  >&lt;blockquote&gt;&lt;p&gt;I do think this warrants a larger discussion on how NaN should be treated, because I don&apos;t think that those two queries should be logically different.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yeah ... my (current) opinion is that i could make sense for them to behave differently as far as NaN is concerned ... but&#160; if consensus is that moving forward those two queries syntaxes should behave identical for all numeric types, then i can probably get on board with that as well&lt;/p&gt;

&lt;p&gt;(but that would be a backcompat break for NaN in range queries, so it should be 9.x only)&lt;/p&gt;</comment>
                            <comment id="17011084" author="hossman" created="Thu, 9 Jan 2020 00:00:10 +0000"  >&lt;blockquote&gt;&lt;p&gt;...but if consensus is that moving forward those two queries syntaxes should behave identical for all numeric types, then i can probably get on board with that as well&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Allthough it remains to be seen &lt;em&gt;what&lt;/em&gt; that identical behavior should be ... with the (now reverted) changes in this issue, those queries both matched docs containing NaN in them &#8211; smliey&apos;s last comment seemed to suggest that he thought they should &lt;em&gt;not&lt;/em&gt; match docs containing NaN : )&lt;/p&gt;</comment>
                            <comment id="17011391" author="dsmiley" created="Thu, 9 Jan 2020 04:02:08 +0000"  >&lt;p&gt;I agree with Hoss&apos;s boxed new opinion (BTW I didn&apos;t know we could do that in JIRA markup).  Thus * isn&apos;t quite exactly &lt;span class=&quot;error&quot;&gt;&amp;#91;* TO *&amp;#93;&lt;/span&gt; when NaN exists.&lt;/p&gt;

&lt;p&gt;We needn&apos;t give up on our wish to use DocValuesFieldExistsQuery for a range syntax.  We can produce a BooleanQuery with MUST clause DocValuesFieldExistsQuery and a MUST_NOT on NaN.&lt;/p&gt;</comment>
                            <comment id="17011695" author="jira-bot" created="Thu, 9 Jan 2020 10:59:39 +0000"  >&lt;p&gt;Commit ee66e5ef23b841f7f1f2e9820f1ebe380c29b672 in lucene-solr&apos;s branch refs/heads/gradle-master from Houston Putman&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=ee66e5e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=ee66e5e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Revert &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11746&quot; title=&quot;numeric fields need better error handling for prefix/wildcard syntax -- consider uniform support for &amp;quot;foo:* == foo:[* TO *]&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11746&quot;&gt;&lt;del&gt;SOLR-11746&lt;/del&gt;&lt;/a&gt;: Adding docs for negative existence queries.&quot;&lt;/p&gt;

&lt;p&gt;This reverts commit 9edb143efdc6616906972ae6c629860c91a5a2e7.&lt;/p&gt;</comment>
                            <comment id="17011696" author="jira-bot" created="Thu, 9 Jan 2020 10:59:42 +0000"  >&lt;p&gt;Commit 08b64aab8f0c3af58b519e83c33dd3b599612cf4 in lucene-solr&apos;s branch refs/heads/gradle-master from Houston Putman&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=08b64aa&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=08b64aa&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Revert &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11746&quot; title=&quot;numeric fields need better error handling for prefix/wildcard syntax -- consider uniform support for &amp;quot;foo:* == foo:[* TO *]&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11746&quot;&gt;&lt;del&gt;SOLR-11746&lt;/del&gt;&lt;/a&gt;: Existence query support for numeric point fields&quot;&lt;/p&gt;

&lt;p&gt;This reverts commit f5ab3ca688b3127bece252ffd87cc8bfa9f285ff.&lt;/p&gt;</comment>
                            <comment id="17011704" author="thetaphi" created="Thu, 9 Jan 2020 11:10:12 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
I have some further improvement for fields without docvalues. If the field has norms enabled (e.g. a text field or StringField with norms), then you can also use NormsFieldExistsQuery: &lt;a href=&quot;https://lucene.apache.org/core/8_4_0/core/org/apache/lucene/search/NormsFieldExistsQuery.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lucene.apache.org/core/8_4_0/core/org/apache/lucene/search/NormsFieldExistsQuery.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This would be a fallback, if there are no docvalues enabled and you have a full range, so existence is important.&lt;/p&gt;

&lt;p&gt;You can just add this here:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Query getRangeQuery(QParser parser, SchemaField field, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; part1, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; part2, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; minInclusive, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; maxInclusive) {
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (field.hasDocValues() &amp;amp;&amp;amp; part1 == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; part2 == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
   &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DocValuesFieldExistsQuery(field.getName());
  } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (field.hasNorms() &amp;amp;&amp;amp; part1 == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; part2 == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
   &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NormsFieldExistsQuery(field.getName());
  } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
   &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; getSpecializedRangeQuery(parser, field, part1, part2, minInclusive, maxInclusive);
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17011715" author="thetaphi" created="Thu, 9 Jan 2020 11:16:37 +0000"  >&lt;p&gt;Nevertheless as it was reverted, I&apos;d propose this for the rework. IMHO, we may just need to handle doubles and floats differently, so it should override the getRangeQuery() and handle it differently. All other field types should stay with above code.&lt;/p&gt;</comment>
                            <comment id="17011716" author="thetaphi" created="Thu, 9 Jan 2020 11:18:49 +0000"  >&lt;p&gt;If we finally fix this, we also fix &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11437&quot; title=&quot;double open ended range queries should be optimized to DocValuesFieldExistsQuery or NormsFieldExistsQuery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11437&quot;&gt;&lt;del&gt;SOLR-11437&lt;/del&gt;&lt;/a&gt; - a long open issue about exactly my proposal.&lt;/p&gt;</comment>
                            <comment id="17011936" author="dsmiley" created="Thu, 9 Jan 2020 15:14:14 +0000"  >&lt;p&gt;Very clever recommendation to use Norms, Uwe!&lt;/p&gt;</comment>
                            <comment id="17011962" author="houston" created="Thu, 9 Jan 2020 15:43:57 +0000"  >&lt;blockquote&gt;&lt;p&gt;We needn&apos;t give up on our wish to use DocValuesFieldExistsQuery for a range syntax. We can produce a BooleanQuery with MUST clause DocValuesFieldExistsQuery and a MUST_NOT on NaN.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I was also thinking about this &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt;, but I don&apos;t think it will match on the edge case of a multivalued field with values&#160;&lt;span class=&quot;error&quot;&gt;&amp;#91;4.0, NaN&amp;#93;&lt;/span&gt;. I think the safest option for the&#160;&#160;&lt;span class=&quot;error&quot;&gt;&amp;#91;* TO *&amp;#93;&lt;/span&gt; query for doubles &amp;amp; floats is to stick with the legacy implementation. As Uwe said, the new method can be used for everything else.&lt;/p&gt;

&lt;p&gt;Thanks for pointing out the norms method Uwe! That should definitely be included.&lt;/p&gt;</comment>
                            <comment id="17012151" author="tomasflobbe" created="Thu, 9 Jan 2020 18:57:08 +0000"  >&lt;blockquote&gt;&lt;p&gt;I agree with Hoss&apos;s boxed new opinion&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;+1 &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;tt&gt;price:*    - Valid, Matches no docs&lt;/tt&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think this should be considered a bug, thus, we wouldn&apos;t need back compat here, right?&lt;br/&gt;
If we consider the case of &lt;tt&gt;numeric:*&lt;/tt&gt; not turning into an &quot;exists&quot; query for float/doubles then there shouldn&apos;t be any compatibility issues, or am I missing something?&lt;/p&gt;</comment>
                            <comment id="17012196" author="houston" created="Thu, 9 Jan 2020 20:16:53 +0000"  >&lt;blockquote&gt;&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;* TO *&amp;#93;&lt;/span&gt; query for doubles &amp;amp; floats&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I believe that is the only backwards incompatibility that was introduced by the reverted patch.&lt;/p&gt;

&lt;p&gt;Unless I am mistaken, &lt;tt&gt;numeric:*&lt;/tt&gt; is equivalent to an &quot;exists&quot; query, even for float/doubles, so there should be no issues formalizing that. This &quot;exists&quot; query will return true even for &lt;tt&gt;NaN&lt;/tt&gt; values, which is backwards compatible with the old trie fields. &lt;/p&gt;

&lt;p&gt;And I&apos;m onboard now with Hoss&apos;s suggestion. Will work on another patch soon.&lt;/p&gt;</comment>
                            <comment id="17013095" author="hossman" created="Fri, 10 Jan 2020 17:53:32 +0000"  >&lt;blockquote&gt;&lt;p&gt;I believe that is the only backwards incompatibility that was introduced by the reverted patch.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;that was &lt;em&gt;my&lt;/em&gt; only backcompat concern: the redefining how NaN behaved in range queries (which has since been reverted)&lt;/p&gt;

&lt;p&gt;I agree, fixing &lt;tt&gt;foo:&lt;b&gt;&lt;/tt&gt; in point fields and docValues only trie fields to behave consistently is a bug fix &#8211; wasn&apos;t trying to suggest that fixing that bug was a backcompat problem.&#160; my point about that old comment where i refered to the &quot;current&quot; (circa 2017) behaior of point fields is that the only one that seems to be tested in the current code/patches is the sinple&#160; &lt;tt&gt;foo:&lt;/b&gt;&lt;/tt&gt; case being fixed to do something useful &amp;#8211; we should also make sure we have tests that hte other nonsensical input cases give informative (and consistent) errors.&lt;/p&gt;</comment>
                            <comment id="17018314" author="houston" created="Fri, 17 Jan 2020 21:12:27 +0000"  >&lt;p&gt;I&apos;ve been updating the patch with everything detailed above (docValues, norms, and the specialized &lt;span class=&quot;error&quot;&gt;&amp;#91;* TO *&amp;#93;&lt;/span&gt; functionality for floats and doubles), as well as extended tests.&lt;/p&gt;

&lt;p&gt;I have run into a snag with the &lt;tt&gt;NormsFieldExistsQuery&lt;/tt&gt;. For PointFields (not TrieFields), the behavior of a field&apos;s &lt;tt&gt;SchemaField.indexOptions&lt;/tt&gt; do not line up with the &lt;tt&gt;FieldInfo.indexOptions&lt;/tt&gt; for the same field. This means that when &lt;a href=&quot;https://github.com/apache/lucene-solr/blob/master/lucene/core/src/java/org/apache/lucene/index/FieldInfo.java#L321&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;FieldInfo.hasNorms()&lt;/a&gt; is called in &lt;tt&gt;NormsFieldExistsQuery&lt;/tt&gt;, for PointFields,&#160;&lt;b&gt;false&lt;/b&gt;&#160;will be returned even if the same logic &lt;tt&gt;(omitNorms == false &amp;amp;&amp;amp; IndexOptions != IndexOptions.None)&lt;/tt&gt;&#160;used with the data in &lt;tt&gt;SchemaField&lt;/tt&gt;&#160;returns &lt;b&gt;true&lt;/b&gt;. Since this &quot;hasNorms&quot; logic is different in &lt;tt&gt;FieldType&lt;/tt&gt;, which uses SchemaType, and &lt;tt&gt;NormsFieldExistsQuery&lt;/tt&gt;, which uses &lt;tt&gt;FieldInfo&lt;/tt&gt;, the logic in FieldType cannot accurately determine if the NormsFieldExistsQuery is the correct method to use. &lt;/p&gt;

&lt;p&gt;I&apos;ve been unable so far to figure out how FieldInfo and SchemaField have received different values for IndexOptions. (This seems to be the reason why the logic results in different results, &lt;tt&gt;omitNorms&lt;/tt&gt; has the correct value in both classes.) Any advice here beyond just omitting the &lt;tt&gt;NormsFieldExistsQuery&lt;/tt&gt; entirely?&lt;/p&gt;

&lt;p&gt;To be clear this issue only exists for PointFields.&lt;/p&gt;</comment>
                            <comment id="17018350" author="hossman" created="Fri, 17 Jan 2020 21:58:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=houston&quot; class=&quot;user-hover&quot; rel=&quot;houston&quot;&gt;houston&lt;/a&gt; - i&apos;m having a little trouble following what exactly the problem is ... whether you&apos;re referring to:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;a (modified) patch you have in progress that seems to have a bug but you can&apos;t figure out where
	&lt;ul&gt;
		&lt;li&gt;posting the patch for discussion would help)&lt;br/&gt;
&lt;b&gt;OR&lt;/b&gt;&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;that independent of any of the changes discussed here, you&apos;ve found a bug in that that trying to use &lt;tt&gt;NormsFieldExistsQuery&lt;/tt&gt; doesn&apos;t seem to work with PointsFields (in solr) at all because &lt;tt&gt;FieldInfo.hasNorms()&lt;/tt&gt; on an existing index is returning false when it shouldn&apos;t based on the indexOptions set (in solr) when indexing thta field
	&lt;ul&gt;
		&lt;li&gt;in which case perhaps make a Sub-Task and post an isolated &quot;test only&quot; white box patch asserting what &lt;tt&gt;FieldInfo.hasNorms()&lt;/tt&gt; returns for a a variety of field types?&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Either way: a patch with a failing test case and some nocommit comments drawing attention to the problematic bits would be helpful for further discussion.&lt;/p&gt;</comment>
                            <comment id="17018375" author="houston" created="Fri, 17 Jan 2020 22:44:28 +0000"  >&lt;p&gt;Sorry about that Hoss, it&apos;s #2. I&apos;ve posted my patch with a comment around the test that fails &lt;tt&gt;TestSolrQueryParser.testDocsWithValuesInField()&lt;/tt&gt;.&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
reproduce with: ant test -Dtestcase=TestSolrQueryParser -Dtests.method=testDocsWithValuesInField -Dtests.seed=8945CFEE0F9CB0A8 -Dtests.slow=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.badapples=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.locale=kab-DZ -Dtests.timezone=Brazil/East -Dtests.asserts=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.file.encoding=UTF-8&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I&apos;m pretty sure it&apos;s a Solr bug with creating FieldInfo objects, but I&apos;m new to this part of Solr and haven&apos;t been able to track down how the IndexOptions get populated yet.&#160;&lt;/p&gt;</comment>
                            <comment id="17018406" author="hossman" created="Fri, 17 Jan 2020 23:40:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=houston&quot; class=&quot;user-hover&quot; rel=&quot;houston&quot;&gt;houston&lt;/a&gt; - i have to step away for a minute, but based on my poking around a bit i think that fundamentally the problem is that &#8211; at a lucene level &#8211; Point fields just don&apos;t seem to ever support (or care about) norms?&lt;/p&gt;

&lt;p&gt;Unlike other solr fieldtypes, none of the &lt;tt&gt;...solr.schema.*PointField&lt;/tt&gt; impls ever &lt;em&gt;create&lt;/em&gt; or pass a &lt;tt&gt;...lucene.document.FieldType&lt;/tt&gt; instance (containing the &quot;omitNorms&quot; setting from the SchemaField) to the underlying &lt;tt&gt;...lucene.document.Field&lt;/tt&gt; instance that they create their &lt;tt&gt;...solr.schema.FieldType.createField()&lt;/tt&gt; method &#8211; because the underlying classes (like &lt;tt&gt;...lucene.document.IntPoint&lt;/tt&gt; don&apos;t &lt;em&gt;allow&lt;/em&gt; you to specify you&apos;re own FieldType (where you set things like &lt;tt&gt;omitNorms&lt;/tt&gt; ... instead that&apos;s all private &amp;amp; internal to the (point &lt;tt&gt;Field&lt;/tt&gt; impl&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;There are no existing lucene layer test cases of using Point Fields + NormsFieldExistsQuery, and I&apos;m pretty sure if you tried to write one you&apos;d find that you can never make it pass, because it&apos;s physically impossible to create a &quot;Point&quot; field with &lt;tt&gt;omitNorms=true&lt;/tt&gt; ?&lt;/p&gt;

&lt;p&gt;BUT ... I don&apos;t think this is a bug? ... If you look back at what Uwe said above when he suggested using NormsFieldExistsQuery he was very specific...&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;If the field has norms enabled (e.g. a text field or StringField with norms), then you can also use NormsFieldExistsQuery:&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;...i think fundamentally your patch should be restructured to ensure it never attempts to use NormsFieldExistsQuery with Point based fields?&lt;/p&gt;

&lt;p&gt;Off the top of my head, i would straw man suggest eliminating the concept of &lt;tt&gt;getSpecializedExistenceQuery&lt;/tt&gt; and instead just make FieldType use...&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Query getExistenceQuery(QParser parser, SchemaField field) {
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (field.hasDocValues()) {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DocValuesFieldExistsQuery(field.getName());
  } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!isPointField() &amp;amp;&amp;amp; !field.omitNorms() &amp;amp;&amp;amp; field.indexOptions() != IndexOptions.NONE) {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NormsFieldExistsQuery(field.getName());
  }
  &lt;span class=&quot;code-comment&quot;&gt;// Default to an unbounded range query
&lt;/span&gt;  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; getRangeQuery(...); &lt;span class=&quot;code-comment&quot;&gt;// ? getSpecializedRangeQuery ? 
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And let subclasses (like the point fields) override getExistenceQuery as needed.&lt;/p&gt;

&lt;p&gt;(Although I generally hate the existence of that &lt;tt&gt;isPointField()&lt;/tt&gt; method, so i&apos;m not fully sold on this idea ... I&apos;m also not really clear on the purpose/need of getSpecializedRangeQuery as opposed to just letting subclasses override &lt;tt&gt;getRangeQuery(...)&lt;/tt&gt; ... so take this entire suggestion with a grain of salt)&lt;/p&gt;</comment>
                            <comment id="17018422" author="houston" created="Sat, 18 Jan 2020 00:04:02 +0000"  >&lt;p&gt;The &lt;tt&gt;getSpecializedRangeQuery()&lt;/tt&gt;&#160;call is to make sure that there&apos;s no circular dependency, since &lt;tt&gt;getRangeQuery()&lt;/tt&gt;&#160;can possibly call &lt;tt&gt;getExistenceQuery()&lt;/tt&gt;. And yeah, I will remove using norms with Point fields.&lt;/p&gt;

&lt;p&gt;Thanks for looking into the norms &amp;amp; PointFields, that makes sense. I think it would be nice to have a separate patch/issue to add something like a &lt;tt&gt;hasNorms()&lt;/tt&gt; functionality to SchemaField, so that there doesn&apos;t have to be special logic for certain types. But it&apos;s easy enough to use the special case of PointFields in this patch.&lt;/p&gt;</comment>
                            <comment id="17018437" author="hossman" created="Sat, 18 Jan 2020 00:32:35 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think it would be nice to have a separate patch/issue to add something like a hasNorms() functionality to SchemaField&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sounds like a good idea ... but I think it would probably be cleaner if &lt;tt&gt;PointField.init(...)&lt;/tt&gt; &amp;amp; &lt;tt&gt;PointField.checkSchemaField(...)&lt;/tt&gt; would check for types/fields using &lt;tt&gt;omitNorm==false&lt;/tt&gt; and if found explicitly fail with an error that &lt;tt&gt;PointFields don&apos;t support &apos;omitNorms=false&apos;&lt;/tt&gt;....  (...unless &lt;tt&gt;TEST_HACK_IGNORE_USELESS_TRIEFIELD_ARGS == true&lt;/tt&gt; &amp;#8211; similar to how precisionStep is silently ignored at a &apos;type&apos; level &amp;#8211; so that we could continue to randomize either point fields or trie fields in the same test schema)&lt;/p&gt;

&lt;p&gt;that way &amp;#8211; IIUC &amp;#8211; your proposed &lt;tt&gt;SchemaField.hasNorms()&lt;/tt&gt; would just be &lt;tt&gt;! SchemaField.omitNorms()&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="17020610" author="houston" created="Tue, 21 Jan 2020 22:17:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman&quot; class=&quot;user-hover&quot; rel=&quot;hossman&quot;&gt;hossman&lt;/a&gt; I added a ticket for that, &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14199&quot; title=&quot;Enforce omitNorms for PointFields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14199&quot;&gt;SOLR-14199&lt;/a&gt;, and will put some work towards it after this gets merged. For now I&apos;ve kept the use of&#160;&lt;tt&gt;isPointField()&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I&apos;ve attached a new patch which should address all of the issues we have seen so far, with new tests that cover all of these issues. I&apos;ve also increased the documentation to make all of this explicitly clear. I&apos;m very open to suggestions on how the documentation could be improved.&lt;/p&gt;

&lt;p&gt;I kept &lt;tt&gt;getSpecializedRangeQuery()&lt;/tt&gt; because it&apos;s necessary in order to prevent a circular dependency, and I also kept &lt;tt&gt;getSpecializedExistenceQuery()&lt;/tt&gt; because it removes the need to write out the following logic multiple places:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (field.hasDocValues()) {
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DocValuesFieldExistsQuery(field.getName());
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!field.omitNorms() &amp;amp;&amp;amp; !isPointField()) { &lt;span class=&quot;code-comment&quot;&gt;//TODO: Remove !isPointField() &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; SOLR-14199
&lt;/span&gt;  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NormsFieldExistsQuery(field.getName());
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
  &lt;span class=&quot;code-comment&quot;&gt;// Default to an unbounded range query
&lt;/span&gt;  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; getSpecializedExistenceQuery(parser, field);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I&apos;m willing to remove &lt;tt&gt;getSpecializedExistenceQuery()&lt;/tt&gt; if y&apos;all think its unnecessary clutter, I just think it&apos;s a cleaner way of doing it.&lt;/p&gt;

&lt;p&gt;Other than that small implementation detail, I think this is ready to go.&lt;/p&gt;</comment>
                            <comment id="17021403" author="hossman" created="Wed, 22 Jan 2020 19:11:36 +0000"  >&lt;p&gt;Skimmed the patch, read the tests &#8211; LGTM.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;I&apos;ve also increased the documentation to make all of this explicitly clear. I&apos;m very open to suggestions on how the documentation could be improved.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think the best way to document this would be along the lines of what i wrote before...&lt;/p&gt;
&lt;blockquote&gt;&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;foo:*&lt;/tt&gt; matches any document that has a value in that field&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;foo:&lt;span class=&quot;error&quot;&gt;&amp;#91;* TO *&amp;#93;&lt;/span&gt;&lt;/tt&gt; matches any document with a value between the effective values of -Infinity and +Infinity for that field type&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;Then as an &lt;tt&gt;NOTE&lt;/tt&gt; box we can mention: &quot;For many field types, &lt;tt&gt;foo:&lt;span class=&quot;error&quot;&gt;&amp;#91;* TO *&amp;#93;&lt;/span&gt;&lt;/tt&gt; is functionally equivalent to &lt;tt&gt;foo:&lt;b&gt;&lt;/tt&gt;, but the notable exception is float/double types that support &lt;tt&gt;NaN&lt;/tt&gt;. &lt;tt&gt;NaN&lt;/tt&gt; will be matched by &lt;tt&gt;foo:&lt;/b&gt;&lt;/tt&gt; but is not in the range of &lt;tt&gt;foo:&lt;span class=&quot;error&quot;&gt;&amp;#91;* TO *&amp;#93;&lt;/span&gt;&lt;/tt&gt;&quot;&lt;/p&gt;

&lt;p&gt;I would also suggest moving the docs about &lt;tt&gt;foo:*&lt;/tt&gt; / existences queries &lt;em&gt;before&lt;/em&gt; the docs about range queries, to better facilitate this explanation of the distinction&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;Ideally we should also be able to add something like this to QueryEqualityTest, to &lt;em&gt;prove&lt;/em&gt; the docs are correct, ..&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  public void testQueryLuceneFloatNumericRangeInfinity() throws Exception {
    for (String field : Arrays.asList(&quot;foo_f&quot;, &quot;foo_f_dvo&quot;,
                                      &quot;foo_d&quot;, &quot;foo_d_dvo&quot;)) {
      assertQueryEquals(&quot;lucene&quot;, field+&quot;:[* TO *]&quot;, field+&quot;:[-Infinity TO Infinity]&quot;);
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;...but when i tried beasting that it seemed to fail on Trie Float (and presumably TrieDouble) ?&lt;/p&gt;


&lt;p&gt; (Off the top of my head I&apos;m not sure why it&apos;s failing &#8211; it doesn&apos;t seem to be a regression in your changes though, so feel free to punt this into a new &apos;Optimization&apos; jira if nothing immediately jumps out at you... it shouldn&apos;t have any practical impacts on anyone except slightly better cache hit ratios for (non existent) people who might try both syntaxes on the same field)&lt;/p&gt;</comment>
                            <comment id="17021602" author="houston" created="Wed, 22 Jan 2020 22:54:11 +0000"  >&lt;p&gt;I modified one of the tests to at least partially make sure that &lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;-Infinity TO Infinity&amp;#93;&lt;/span&gt;&lt;/tt&gt; behaves similarly to &lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;* TO *&amp;#93;&lt;/span&gt;&lt;/tt&gt; but I didn&apos;t want to enforce that they both use the same classes, at least not yet. As you said that can be done in a separate JIRA.&lt;/p&gt;

&lt;p&gt;I think this is ready to go. Running precommit, then I&apos;ll push it. Thanks for the help with the docs, and everything else!&lt;/p&gt;</comment>
                            <comment id="17021609" author="jira-bot" created="Wed, 22 Jan 2020 23:01:51 +0000"  >&lt;p&gt;Commit ffba54a827778c2e9288f45ce5801b2546786bb6 in lucene-solr&apos;s branch refs/heads/master from Houston Putman&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=ffba54a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=ffba54a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11746&quot; title=&quot;numeric fields need better error handling for prefix/wildcard syntax -- consider uniform support for &amp;quot;foo:* == foo:[* TO *]&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11746&quot;&gt;&lt;del&gt;SOLR-11746&lt;/del&gt;&lt;/a&gt;: Adding existence queries for PointFields&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;DocValuesFieldExistsQuery and NormsFieldExistsQuery are used for existence queries when possible.&lt;/li&gt;
	&lt;li&gt;Added documentation on the difference between field:* and field:&lt;span class=&quot;error&quot;&gt;&amp;#91;* TO *&amp;#93;&lt;/span&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17021767" author="jira-bot" created="Thu, 23 Jan 2020 04:45:14 +0000"  >&lt;p&gt;Commit c53cbb12f4df045432d9b3a831568d9543d81c88 in lucene-solr&apos;s branch refs/heads/master from Houston Putman&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=c53cbb1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=c53cbb1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11746&quot; title=&quot;numeric fields need better error handling for prefix/wildcard syntax -- consider uniform support for &amp;quot;foo:* == foo:[* TO *]&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11746&quot;&gt;&lt;del&gt;SOLR-11746&lt;/del&gt;&lt;/a&gt;: Adding CHANGES.txt entry&lt;/p&gt;</comment>
                            <comment id="17021793" author="jira-bot" created="Thu, 23 Jan 2020 05:51:53 +0000"  >&lt;p&gt;Commit 3129ef9461f84ec69ac0c858f886869ad6164866 in lucene-solr&apos;s branch refs/heads/branch_8x from Houston Putman&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=3129ef9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=3129ef9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11746&quot; title=&quot;numeric fields need better error handling for prefix/wildcard syntax -- consider uniform support for &amp;quot;foo:* == foo:[* TO *]&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11746&quot;&gt;&lt;del&gt;SOLR-11746&lt;/del&gt;&lt;/a&gt;: Adding existence queries for PointFields&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;DocValuesFieldExistsQuery and NormsFieldExistsQuery are used for existence queries when possible.&lt;/li&gt;
	&lt;li&gt;Added documentation on the difference between field:* and field:&lt;span class=&quot;error&quot;&gt;&amp;#91;* TO *&amp;#93;&lt;/span&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17048257" author="tomoko uchida" created="Sat, 29 Feb 2020 09:12:22 +0000"  >&lt;p&gt;It seems like the Ref Guide build is now failing due to the changes here.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
solr-ref-guide $ ant build-site
...
build-site:
     [java] Relative link points at id that doesn&apos;t exist in dest: #differences-between-lucenes-classic-query-parser-and-solrs-standard-query-parser
     [java]  ... source: file:/mnt/hdd/repo/lucene-solr/solr/build/solr-ref-guide/html-site/the-standard-query-parser.html
     [java] Relative link points at id that doesn&apos;t exist in dest: the-standard-query-parser.html#differences-between-lucenes-classic-query-parser-and-solrs-standard-query-parser
     [java]  ... source: file:/mnt/hdd/repo/lucene-solr/solr/build/solr-ref-guide/html-site/common-query-parameters.html
     [java] Processed 2611 links (1932 relative) to 3477 anchors in 262 files
     [java] Total of 2 problems found

BUILD FAILED
/mnt/hdd/repo/lucene-solr/solr/solr-ref-guide/build.xml:251: Java returned: 255
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The build works for me when I removed those two lines.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
--- a/solr/solr-ref-guide/src/common-query-parameters.adoc
+++ b/solr/solr-ref-guide/src/common-query-parameters.adoc
@@ -102,7 +102,7 @@ fq=+popularity:[10 TO *] +section:0
 ----
 
 * The document sets from each filter query are cached independently. Thus, concerning the previous examples: use a single `fq` containing two mandatory clauses &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; those clauses appear together often, and use two separate `fq` parameters &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; they are relatively independent. (To learn about tuning cache sizes and making sure a filter cache actually exists, see &amp;lt;&amp;lt;the-well-configured-solr-instance.adoc#the-well-configured-solr-instance,The Well-Configured Solr Instance&amp;gt;&amp;gt;.)
-* It is also possible to use &amp;lt;&amp;lt;the-standard-query-parser.adoc#differences-between-lucenes-classic-query-parser-and-solrs-standard-query-parser,filter(condition) syntax&amp;gt;&amp;gt; inside the `fq` to cache clauses individually and - among other things - to achieve union of cached filter queries.
+&lt;span class=&quot;code-comment&quot;&gt;// * It is also possible to use &amp;lt;&amp;lt;the-standard-query-parser.adoc#differences-between-lucenes-classic-query-parser-and-solrs-standard-query-parser,filter(condition) syntax&amp;gt;&amp;gt; inside the `fq` to cache clauses individually and - among other things - to achieve union of cached filter queries.
&lt;/span&gt;
diff --git a/solr/solr-ref-guide/src/the-standard-query-parser.adoc b/solr/solr-ref-guide/src/the-standard-query-parser.adoc
index c572e503e5b..3a3cd7f958d 100644
--- a/solr/solr-ref-guide/src/the-standard-query-parser.adoc
+++ b/solr/solr-ref-guide/src/the-standard-query-parser.adoc
@@ -174,7 +174,7 @@ The brackets around a query determine its inclusiveness.
 * You can mix these types so one end of the range is inclusive and the other is exclusive. Here&apos;s an example: `count:{1 TO 10]`
 
 Wildcards, `*`, can also be used &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; either or both endpoints to specify an open-ended range query.
-This is a &amp;lt;&amp;lt;#differences-between-lucenes-classic-query-parser-and-solrs-standard-query-parser,divergence from Lucene&apos;s Classic Query Parser&amp;gt;&amp;gt;.
+&lt;span class=&quot;code-comment&quot;&gt;// This is a &amp;lt;&amp;lt;#differences-between-lucenes-classic-query-parser-and-solrs-standard-query-parser,divergence from Lucene&apos;s Classic Query Parser&amp;gt;&amp;gt;.&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I know nothing about this issue, just noticed the broken links when I updated the ref-guide on another issue...&lt;/p&gt;</comment>
                            <comment id="17049901" author="houston" created="Tue, 3 Mar 2020 04:47:07 +0000"  >&lt;p&gt;I&apos;m not sure why that&apos;d be an issue, those links do work both on the released 8.4 ref guide, and on the master branch.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://lucene.apache.org/solr/guide/8_4/the-standard-query-parser.html#differences-between-lucenes-classic-query-parser-and-solrs-standard-query-parser&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lucene.apache.org/solr/guide/8_4/the-standard-query-parser.html#differences-between-lucenes-classic-query-parser-and-solrs-standard-query-parser&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/lucene-solr/blob/master/solr/solr-ref-guide/src/the-standard-query-parser.adoc#differences-between-lucenes-classic-query-parser-and-solrs-standard-query-parser&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/master/solr/solr-ref-guide/src/the-standard-query-parser.adoc#differences-between-lucenes-classic-query-parser-and-solrs-standard-query-parser&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I also tested &lt;tt&gt;ant build-site&lt;/tt&gt;, which works for me off of master.&lt;/p&gt;</comment>
                            <comment id="17049991" author="tomoko uchida" created="Tue, 3 Mar 2020 08:14:34 +0000"  >&lt;p&gt;I did clean checkout from the Apache repo, and saw the build still doesn&apos;t work for me.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
git clone git@github.com:apache/lucene-solr.git
cd lucene-solr/
ant -f solr/solr-ref-guide/build.xml build-site
...
build-site:
     [java] Relative link points at id that doesn&apos;t exist in dest: the-standard-query-parser.html#differences-between-lucenes-classic-query-parser-and-solrs-standard-query-parser
     [java]  ... source: file:/mnt/hdd/tmp/lucene-solr/solr/build/solr-ref-guide/html-site/common-query-parameters.html
     [java] Relative link points at id that doesn&apos;t exist in dest: #differences-between-lucenes-classic-query-parser-and-solrs-standard-query-parser
     [java]  ... source: file:/mnt/hdd/tmp/lucene-solr/solr/build/solr-ref-guide/html-site/the-standard-query-parser.html
     [java] Processed 2610 links (1930 relative) to 3728 anchors in 262 files
     [java] Total of 2 problems found

BUILD FAILED
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I have not looked at the details yet, but the problem could occur only for me (caused by my setups?).&lt;/p&gt;</comment>
                            <comment id="17051517" author="ctargett" created="Wed, 4 Mar 2020 18:45:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tomoko&quot; class=&quot;user-hover&quot; rel=&quot;tomoko&quot;&gt;tomoko&lt;/a&gt;, please check the version of Asciidoctor you are using. That error is because of a different way an older version constructs in-page anchor references. You should be on 1.5.7 or higher (preferably 2.0+).&lt;/p&gt;

&lt;p&gt;This reminded me that I neglected to update the Ref Guide README when I updated the versions in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12786&quot; title=&quot;Upgrade refGuide build to Asciidoctor 2.0.10 and new link structure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12786&quot;&gt;&lt;del&gt;SOLR-12786&lt;/del&gt;&lt;/a&gt; (you can find the correct versions in &lt;tt&gt;dev-tools/scripts/jenkins.build.ref.guide.sh&lt;/tt&gt; since that&apos;s what the build uses)...I&apos;ll fix the README now.&lt;/p&gt;</comment>
                            <comment id="17051526" author="ctargett" created="Wed, 4 Mar 2020 18:52:47 +0000"  >&lt;blockquote&gt;&lt;p&gt;This reminded me that I neglected to update the Ref Guide README &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Scratch that, I did update it. I was looking at an old branch.&lt;/p&gt;

&lt;p&gt;However, if you previously had all the pre-reqs already installed and upgraded to the versions mentioned in the README, it would not update the asciidoctor version &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;. To upgrade Asciidoctor, use:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
gem upgrade asciidoctor
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; The reason for this is because the asciidoctor gem is a dependency of jekyll-asciidoc so new installs of the pre-reqs get asciidoctor as part of the install of jekyll-asciidoc. When you upgrade jekyll-asciidoc, however, it does not automatically update it&apos;s dependency, it only validates that it is already installed.&lt;/p&gt;

&lt;p&gt;Edit: Or, you could use the gradle build: &lt;tt&gt;./gradlew buildSite&lt;/tt&gt; which downloads the dependencies even if you have them already.&lt;/p&gt;</comment>
                            <comment id="17052294" author="tomoko uchida" created="Thu, 5 Mar 2020 16:12:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ctargett&quot; class=&quot;user-hover&quot; rel=&quot;ctargett&quot;&gt;ctargett&lt;/a&gt; I&apos;ve used asciidoctor 1.5.6.2, and after updating its version &lt;tt&gt;ant build-site&lt;/tt&gt; started to work for me again. Thank you!&lt;/p&gt;

&lt;p&gt;And yes, with Gradle build we shouldn&apos;t have such problems. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&#160; (I didn&apos;t know jruby-gradle-plugin but it seems to work just as &lt;a href=&quot;https://bundler.io/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Bundler&lt;/a&gt;, the defact dependency management tool for Ruby.&lt;/p&gt;</comment>
                            <comment id="17065639" author="romseygeek" created="Tue, 24 Mar 2020 12:45:27 +0000"  >&lt;p&gt;Bulk close for 8.5.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310060">
                    <name>Container</name>
                                            <outwardlinks description="contains">
                                        <issuelink>
            <issuekey id="13106992">SOLR-11437</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13327142">SOLR-14859</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13280784">SOLR-14199</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12991588" name="SOLR-11746.patch" size="52888" author="houston" created="Wed, 22 Jan 2020 22:47:17 +0000"/>
                            <attachment id="12991587" name="SOLR-11746.patch" size="52978" author="houston" created="Wed, 22 Jan 2020 22:44:20 +0000"/>
                            <attachment id="12991585" name="SOLR-11746.patch" size="53647" author="houston" created="Wed, 22 Jan 2020 22:23:59 +0000"/>
                            <attachment id="12991479" name="SOLR-11746.patch" size="52991" author="houston" created="Tue, 21 Jan 2020 21:59:45 +0000"/>
                            <attachment id="12991267" name="SOLR-11746.patch" size="47087" author="houston" created="Fri, 17 Jan 2020 22:33:54 +0000"/>
                            <attachment id="12990030" name="SOLR-11746.patch" size="33920" author="houston" created="Mon, 6 Jan 2020 18:13:59 +0000"/>
                            <attachment id="12990024" name="SOLR-11746.patch" size="33224" author="houston" created="Mon, 6 Jan 2020 17:01:40 +0000"/>
                            <attachment id="12990023" name="SOLR-11746.patch" size="32037" author="houston" created="Mon, 6 Jan 2020 16:46:01 +0000"/>
                            <attachment id="12989842" name="SOLR-11746.patch" size="25860" author="houston" created="Thu, 2 Jan 2020 21:20:41 +0000"/>
                            <attachment id="12905954" name="SOLR-11746.patch" size="8071" author="hossman" created="Fri, 12 Jan 2018 23:36:58 +0000"/>
                            <attachment id="12905022" name="SOLR-11746.patch" size="2019" author="wkaichan" created="Mon, 8 Jan 2018 05:58:01 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 34 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ns3j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>