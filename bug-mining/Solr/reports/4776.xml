<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:49:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-15484] Frequent test failures for JWTAuthPluginIntegrationTest</title>
                <link>https://issues.apache.org/jira/browse/SOLR-15484</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Example:&lt;/p&gt;

&lt;p&gt;Build: &lt;a href=&quot;https://ci-builds.apache.org/job/Solr/job/Solr-Check-main/1053/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-builds.apache.org/job/Solr/job/Solr-Check-main/1053/&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
1 tests failed.
FAILED: &#160;org.apache.solr.security.JWTAuthPluginIntegrationTest.mockOAuth2Server

Error Message:
org.junit.ComparisonFailure: Should have received 401 code expected:&amp;lt;[401]&amp;gt; but was:&amp;lt;[200]&amp;gt;

Stack Trace:
org.junit.ComparisonFailure: Should have received 401 code expected:&amp;lt;[401]&amp;gt; but was:&amp;lt;[200]&amp;gt;
 at __randomizedtesting.SeedInfo.seed([7827798BF4D91EFE:FF2798DB9165E212]:0)
 at org.junit.Assert.assertEquals(Assert.java:117)
 at org.apache.solr.security.JWTAuthPluginIntegrationTest.mockOAuth2Server(JWTAuthPluginIntegrationTest.java:143)
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The other test failure is&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.solr.security.JWTAuthPluginTest.initWithInvalidTrustedCertsFile

Failing &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the past 1 build (Since #924 )
Took 7 ms.

Error Message
junit.framework.AssertionFailedError: Expected exception SolrException but no exception was thrown
Stacktrace
junit.framework.AssertionFailedError: Expected exception SolrException but no exception was thrown
	at __randomizedtesting.SeedInfo.seed([8651FF5FA6DE29A1:91C33C9AFD0459B5]:0)
	at org.apache.lucene.util.LuceneTestCase.expectThrows(LuceneTestCase.java:2863)
	at org.apache.lucene.util.LuceneTestCase.expectThrows(LuceneTestCase.java:2849)
	at org.apache.solr.security.JWTAuthPluginTest.initWithInvalidTrustedCertsFile(JWTAuthPluginTest.java:521)
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13384329">SOLR-15484</key>
            <summary>Frequent test failures for JWTAuthPluginIntegrationTest</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="janhoy">Jan H&#248;ydahl</assignee>
                                    <reporter username="janhoy">Jan H&#248;ydahl</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 Jun 2021 10:22:43 +0000</created>
                <updated>Wed, 5 Jun 2024 12:41:34 +0000</updated>
                            <resolved>Fri, 22 Dec 2023 19:47:59 +0000</resolved>
                                    <version>9.0</version>
                                    <fixVersion>9.5</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>7</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="12600">3.5h</timespent>
                                <comments>
                            <comment id="17364953" author="janhoy" created="Thu, 17 Jun 2021 13:57:49 +0000"  >&lt;p&gt;PR: &lt;a href=&quot;https://github.com/apache/solr/pull/178&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/solr/pull/178&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17364961" author="jira-bot" created="Thu, 17 Jun 2021 14:05:25 +0000"  >&lt;p&gt;Commit 2bbee53062dd85b234f1d96bd99f35798067bbff in solr&apos;s branch refs/heads/main from Jan H&#248;ydahl&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=2bbee53&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=2bbee53&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15423&quot; title=&quot;JWTAuthPlugin support for custom truststore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15423&quot;&gt;&lt;del&gt;SOLR-15423&lt;/del&gt;&lt;/a&gt; Fix test failures (#178)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15484&quot; title=&quot;Frequent test failures for JWTAuthPluginIntegrationTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15484&quot;&gt;&lt;del&gt;SOLR-15484&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17365295" author="janhoy" created="Fri, 18 Jun 2021 07:47:10 +0000"  >&lt;p&gt;After the fix, there are still some failures where security.json is not applied even after 10 seconds, e.g. &lt;a href=&quot;https://jenkins.thetaphi.de/view/Solr/job/Solr-main-Linux/948/testReport/junit/org.apache.solr.security/JWTAuthPluginIntegrationTest/mockOAuth2Server/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jenkins.thetaphi.de/view/Solr/job/Solr-main-Linux/948/testReport/junit/org.apache.solr.security/JWTAuthPluginIntegrationTest/mockOAuth2Server/&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Failed
org.apache.solr.security.JWTAuthPluginIntegrationTest.mockOAuth2Server

Failing for the past 1 build (Since #948 )
Took 11 sec.
Error Message
java.lang.Exception: Custom &apos;security.json&apos; not applied in 10000ms
Stacktrace
java.lang.Exception: Custom &apos;security.json&apos; not applied in 10000ms
	at __randomizedtesting.SeedInfo.seed([9923019762100B0E:1E23E0C707ACF7E2]:0)
	at org.apache.solr.security.JWTAuthPluginIntegrationTest.configureClusterMockOauth (JWTAuthPluginIntegrationTest.java:275)
	at org.apache.solr.security.JWTAuthPluginIntegrationTest.mockOAuth2Server (JWTAuthPluginIntegrationTest.java:140)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0 (Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke (NativeMethodAccessorImpl.java:62)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke (DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke (Method.java:566)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17365320" author="janhoy" created="Fri, 18 Jun 2021 08:24:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mdrob&quot; class=&quot;user-hover&quot; rel=&quot;mdrob&quot;&gt;mdrob&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt;&#160;- check out the test failure mentioned in last comment.&#160;The test starts a cluster, then applies security.json, waiting up to 10s for the auth plugin to be configured. The test always passes locally, even with beasting. However, it seems to time out on every build for &lt;a href=&quot;https://jenkins.thetaphi.de/view/Solr/job/Solr-main-Linux/948/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Policeman&#160; Jenkins&lt;/a&gt; and on most builds for &lt;a href=&quot;https://ci-builds.apache.org/job/Solr/job/Solr-Check-main/1060/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ASF Jenkins&lt;/a&gt;.&#160;&lt;/p&gt;

&lt;p&gt;I believe the reason is that&#160;&lt;tt&gt;SolrCloudAuthTestCase&lt;/tt&gt;&#160;is intended to spin up ONE cluster for all tests, thus the &quot;cluster&quot; variable is static. So in a parallellized test env this variable will be overwritten by the other test methods in the same class.&lt;/p&gt;

&lt;p&gt;I&apos;ll try to fix this by NOT using the global &quot;cluster&quot; variable, but instead let each test initialize a method-private cluster which is then shutdown at the end of the test. PR will follow soon...&lt;/p&gt;

&lt;p&gt;*UPDATE: PR is&#160;&lt;a href=&quot;https://github.com/apache/solr/pull/182*&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/solr/pull/182*&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17365807" author="jira-bot" created="Fri, 18 Jun 2021 22:42:22 +0000"  >&lt;p&gt;Commit 3155565420ac84b11cf8507cef7c412a87b15006 in solr&apos;s branch refs/heads/main from Jan H&#248;ydahl&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=3155565&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=3155565&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15423&quot; title=&quot;JWTAuthPlugin support for custom truststore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15423&quot;&gt;&lt;del&gt;SOLR-15423&lt;/del&gt;&lt;/a&gt; Redesign integration test, with cluster in local scope variable per test (#182)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15484&quot; title=&quot;Frequent test failures for JWTAuthPluginIntegrationTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15484&quot;&gt;&lt;del&gt;SOLR-15484&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17366265" author="jira-bot" created="Sun, 20 Jun 2021 20:01:45 +0000"  >&lt;p&gt;Commit 2ee7f6cb32bf572b70712c01043369856c6eb2aa in solr&apos;s branch refs/heads/main from Jan H&#248;ydahl&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=2ee7f6c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=2ee7f6c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15484&quot; title=&quot;Frequent test failures for JWTAuthPluginIntegrationTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15484&quot;&gt;&lt;del&gt;SOLR-15484&lt;/del&gt;&lt;/a&gt;: BadApple failing test&lt;/p&gt;</comment>
                            <comment id="17368062" author="janhoy" created="Wed, 23 Jun 2021 11:35:08 +0000"  >&lt;p&gt;I inspected the test log in Jenkins: &lt;a href=&quot;https://jenkins.thetaphi.de/job/Solr-BadApples-main-Linux/49/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jenkins.thetaphi.de/job/Solr-BadApples-main-Linux/49/&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;927760 INFO  (zkCallback-10371-thread-2) [     ] o.a.s.c.CoreContainer Initializing authentication plugin: solr.JWTAuthPlugin
  2&amp;gt; 927760 INFO  (zkCallback-10371-thread-2) [     ] o.a.s.s.JWTAuthPlugin Reading trustedCerts PEM from configuration string
  2&amp;gt; 927760 INFO  (zkCallback-10390-thread-2) [     ] o.a.s.s.JWTAuthPlugin Reading trustedCerts PEM from configuration string
  2&amp;gt; 927771 ERROR (zkCallback-10371-thread-2) [     ] o.a.s.c.c.ZkStateReader Error running collections node listener
  2&amp;gt;           =&amp;gt; org.apache.solr.common.SolrException: Well-known config could not be read from url https://localhost.localdomain:48139/default/.well-known/openid-configuration
  2&amp;gt; 	at org.apache.solr.security.JWTIssuerConfig$WellKnownDiscoveryConfig.parse(JWTIssuerConfig.java:452)
  2&amp;gt; org.apache.solr.common.SolrException: Well-known config could not be read from url https://localhost.localdomain:48139/default/.well-known/openid-configuration
  2&amp;gt; 	at org.apache.solr.security.JWTIssuerConfig$WellKnownDiscoveryConfig.parse(JWTIssuerConfig.java:452) ~[main/:?]
  2&amp;gt; 	at org.apache.solr.security.JWTIssuerConfig.fetchWellKnown(JWTIssuerConfig.java:190) ~[main/:?]
  2&amp;gt; 	at org.apache.solr.security.JWTIssuerConfig.init(JWTIssuerConfig.java:111) ~[main/:?]
  2&amp;gt; 	at org.apache.solr.security.JWTAuthPlugin.parseIssuerFromTopLevelConfig(JWTAuthPlugin.java:267) ~[main/:?]
  2&amp;gt; 	at org.apache.solr.security.JWTAuthPlugin.init(JWTAuthPlugin.java:213) ~[main/:?]
  2&amp;gt; 	at org.apache.solr.core.CoreContainer.initializeAuthenticationPlugin(CoreContainer.java:508) ~[main/:?]
  2&amp;gt; 	at org.apache.solr.core.CoreContainer.reloadSecurityProperties(CoreContainer.java:978) ~[main/:?]
  2&amp;gt; 	at org.apache.solr.core.CoreContainer.securityNodeChanged(CoreContainer.java:968) ~[main/:?]
  2&amp;gt; 	at org.apache.solr.cloud.ZkController.lambda$new$0(ZkController.java:463) ~[main/:9.0.0-SNAPSHOT 498f9c4c42a0824eaaef1e312992a5eb41da4e3e [snapshot build, details omitted]]
  2&amp;gt; 	at org.apache.solr.common.cloud.ZkStateReader.lambda$createClusterStateWatchersAndUpdate$0(ZkStateReader.java:445) ~[solr-solrj-9.0.0-SNAPSHOT.jar:9.0.0-SNAPSHOT 498f9c4c42a0824eaaef1e312992a5eb41da4e3e [snapshot build, details omitted]]
  2&amp;gt; 	at org.apache.solr.common.cloud.ZkStateReader$2.process(ZkStateReader.java:484) [solr-solrj-9.0.0-SNAPSHOT.jar:9.0.0-SNAPSHOT 498f9c4c42a0824eaaef1e312992a5eb41da4e3e [snapshot build, details omitted]]
  2&amp;gt; 	at org.apache.solr.common.cloud.SolrZkClient$ProcessWatchWithExecutor.lambda$process$1(SolrZkClient.java:863) [solr-solrj-9.0.0-SNAPSHOT.jar:9.0.0-SNAPSHOT 498f9c4c42a0824eaaef1e312992a5eb41da4e3e [snapshot build, details omitted]]
  2&amp;gt; 	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) [?:?]
  2&amp;gt; 	at java.util.concurrent.FutureTask.run(FutureTask.java:264) [?:?]
  2&amp;gt; 	at org.apache.solr.common.util.ExecutorUtil$MDCAwareThreadPoolExecutor.lambda$execute$0(ExecutorUtil.java:224) [solr-solrj-9.0.0-SNAPSHOT.jar:9.0.0-SNAPSHOT 498f9c4c42a0824eaaef1e312992a5eb41da4e3e [snapshot build, details omitted]]
  2&amp;gt; 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1130) [?:?]
  2&amp;gt; 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:630) [?:?]
  2&amp;gt; 	at java.lang.Thread.run(Thread.java:831) [?:?]
  2&amp;gt; Caused by: javax.net.ssl.SSLHandshakeException: No name matching localhost.localdomain found
  2&amp;gt; 	at sun.security.ssl.Alert.createSSLException(Alert.java:131) ~[?:?]&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So the core issue here is&#160;&lt;tt&gt;javax.net.ssl.SSLHandshakeException: No name matching localhost.localdomain found&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;So my canned SSL certificate with hostname &quot;localhost&quot; fails when the hostname ends up as &quot;localhost.localdomain&quot;. The MockWebServer uses &#160;&lt;tt&gt;InetAddress.getByName(&quot;localhost&quot;)&lt;/tt&gt;&#160;which ends up with &quot;localhost.localdomain&quot;. Wdyt &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=uschindler&quot; class=&quot;user-hover&quot; rel=&quot;uschindler&quot;&gt;uschindler&lt;/a&gt;&#160;is there a way to make Jenkins server return only &quot;localhost&quot; here? E.g. by using&#160;&lt;tt&gt;InetAddress.getLoopbackAddress()&lt;/tt&gt; instead? Or should I extend the SSL cert to also contain localhost.localdomain...&lt;/p&gt;</comment>
                            <comment id="17368080" author="thetaphi" created="Wed, 23 Jun 2021 11:56:58 +0000"  >&lt;p&gt;No idea, what we can do here. It depends on the local config.&lt;/p&gt;

&lt;p&gt;I think the only way to fix this is to add all possible hostnames into the certificate, including IP address.&lt;/p&gt;

&lt;p&gt;Could we not modify Test to ignore hostname when checking certificate?&lt;/p&gt;</comment>
                            <comment id="17368081" author="janhoy" created="Wed, 23 Jun 2021 11:56:59 +0000"  >&lt;p&gt;I found a workaround in &lt;a href=&quot;https://github.com/apache/solr/pull/187&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/solr/pull/187&lt;/a&gt;&#160;- removing &quot;.localdomain&quot; suffix for resolved host name in the test, before inserting the URL into security.json file. Plain &quot;localhost&quot; should always resolve anyway.&lt;/p&gt;</comment>
                            <comment id="17368302" author="thetaphi" created="Wed, 23 Jun 2021 15:48:37 +0000"  >&lt;blockquote&gt;&lt;p&gt;Plain &quot;localhost&quot; should always resolve anyway.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Not always.... sometimes localhost points to the IP address and not 127.0.0.1 then connection fails if service listens only on localhost (like test policy enforces).&lt;/p&gt;

&lt;p&gt;Is the certificate created as a blob in repo or is it created on test startup? If the latter (a temporary test certificate), you can create it with the hostname as returned by getLoopbackAddress().&lt;/p&gt;</comment>
                            <comment id="17476911" author="jira-bot" created="Mon, 17 Jan 2022 00:17:57 +0000"  >&lt;p&gt;Commit 59ad803f27cef11a845a7b6690bf4293f558ea4d in solr&apos;s branch refs/heads/main from Jan H&#248;ydahl&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=59ad803&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=59ad803&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15484&quot; title=&quot;Frequent test failures for JWTAuthPluginIntegrationTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15484&quot;&gt;&lt;del&gt;SOLR-15484&lt;/del&gt;&lt;/a&gt;: Re-enable test, with workaround for localhost.localdomwin (#187)&lt;/p&gt;
</comment>
                            <comment id="17476912" author="janhoy" created="Mon, 17 Jan 2022 00:20:10 +0000"  >&lt;p&gt;Merging current fix to main. Will see how the jenkins test runs, and then decide whether it is a suficient fix or if we should badapple again to find a better one.&lt;/p&gt;

&lt;p&gt;To your question Uwe, the certificates are blobs, not dynamically generated.&lt;/p&gt;</comment>
                            <comment id="17477097" author="jira-bot" created="Mon, 17 Jan 2022 10:16:51 +0000"  >&lt;p&gt;Commit 4b3d87ba312303e98664e4c47f3f75400c1199ef in solr&apos;s branch refs/heads/main from Jan H&#248;ydahl&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=4b3d87b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=4b3d87b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15484&quot; title=&quot;Frequent test failures for JWTAuthPluginIntegrationTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15484&quot;&gt;&lt;del&gt;SOLR-15484&lt;/del&gt;&lt;/a&gt; Re-add badapple&lt;/p&gt;</comment>
                            <comment id="17477098" author="janhoy" created="Mon, 17 Jan 2022 10:17:20 +0000"  >&lt;p&gt;Still fails&lt;/p&gt;</comment>
                            <comment id="17488262" author="mdrob" created="Mon, 7 Feb 2022 17:00:46 +0000"  >&lt;p&gt;I&apos;m not sure if updating the version of the test server will help at all, but linking it just in case.&lt;/p&gt;</comment>
                            <comment id="17622696" author="jira-bot" created="Sat, 22 Oct 2022 21:30:12 +0000"  >&lt;p&gt;Commit e56f73581f7f1f262791c5c70c848c7bff51ad25 in solr&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15484&quot; title=&quot;Frequent test failures for JWTAuthPluginIntegrationTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15484&quot;&gt;&lt;del&gt;SOLR-15484&lt;/del&gt;&lt;/a&gt;-jwt-test-failure from Jan H&#248;ydahl&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=e56f73581f7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=e56f73581f7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merge branch &apos;main&apos; into &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15484&quot; title=&quot;Frequent test failures for JWTAuthPluginIntegrationTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15484&quot;&gt;&lt;del&gt;SOLR-15484&lt;/del&gt;&lt;/a&gt;-jwt-test-failure&lt;/p&gt;</comment>
                            <comment id="17792412" author="don-vip" created="Sat, 2 Dec 2023 17:53:09 +0000"  >&lt;p&gt;Is it possible to update the certificate to allow &quot;&lt;font color=&quot;#cccccc&quot;&gt;kubernetes.docker.internal&quot;? This is the only failing test I face while setting up my environment:&lt;/font&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 2&amp;gt; org.apache.solr.common.SolrException: Well-known config could not be read from url +https:&lt;span class=&quot;code-comment&quot;&gt;//kubernetes.docker.internal:61103/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/.well-known/openid-configuration+
&lt;/span&gt; 2&amp;gt; at org.apache.solr.security.jwt.JWTIssuerConfig$WellKnownDiscoveryConfig.parse(JWTIssuerConfig.java:536) ~[main/:?]
 2&amp;gt; ...
 2&amp;gt; Caused by: javax.net.ssl.SSLHandshakeException: No name matching kubernetes.docker.internal found
 2&amp;gt; at java.base/sun.security.ssl.Alert.createSSLException(Alert.java:131) ~[?:?]
 2&amp;gt; ...
 2&amp;gt; Caused by: java.security.cert.CertificateException: No name matching kubernetes.docker.internal found
 2&amp;gt; at java.base/sun.security.util.HostnameChecker.matchDNS(HostnameChecker.java:234) ~[?:?]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17794064" author="janhoy" created="Thu, 7 Dec 2023 07:38:46 +0000"  >&lt;p&gt;The mockOauth2Server project has enabled auto generation of a SSL cert, see docs &lt;a href=&quot;https://github.com/navikt/mock-oauth2-server#enabling-https&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/navikt/mock-oauth2-server#enabling-https&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;But it only generates a cert for &quot;localhost&quot;. Perhaps one could contribute a PR to the project with more intelligent host-name sniffing so that it would discover all host names it needs to include in the self-generated cert, whether it is &lt;tt&gt;localhost.localdomain&lt;/tt&gt; or &lt;tt&gt;kubernetes.docker.internal&lt;/tt&gt;? Have not looked yet.&lt;/p&gt;</comment>
                            <comment id="17794477" author="jdyer" created="Thu, 7 Dec 2023 23:41:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Don-vip&quot; class=&quot;user-hover&quot; rel=&quot;Don-vip&quot;&gt;Don-vip&lt;/a&gt;  Would you be willing to try the latest changes in &lt;a href=&quot;https://github.com/apache/solr/pull/2099&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR #2099&lt;/a&gt; with your setup?&lt;/p&gt;</comment>
                            <comment id="17795384" author="jira-bot" created="Mon, 11 Dec 2023 14:03:07 +0000"  >&lt;p&gt;Commit 7a92bbfcb18153157c346c623b326fe8da7079e0 in solr&apos;s branch refs/heads/main from James Dyer&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=7a92bbfcb18&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=7a92bbfcb18&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15484&quot; title=&quot;Frequent test failures for JWTAuthPluginIntegrationTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15484&quot;&gt;&lt;del&gt;SOLR-15484&lt;/del&gt;&lt;/a&gt; JWTAuthPluginIntegrationTest - dynamically generate the self-signed certificate using the localhost loopback address (#2099)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15484&quot; title=&quot;Frequent test failures for JWTAuthPluginIntegrationTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15484&quot;&gt;&lt;del&gt;SOLR-15484&lt;/del&gt;&lt;/a&gt;: dynamically generate the self-signed certificate using the localhost loopback address&lt;/p&gt;</comment>
                            <comment id="17795412" author="jira-bot" created="Mon, 11 Dec 2023 15:35:58 +0000"  >&lt;p&gt;Commit 88bde09e22ef1f7e413f09fe03145220720a8a8e in solr&apos;s branch refs/heads/branch_9x from James Dyer&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=88bde09e22e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=88bde09e22e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15484&quot; title=&quot;Frequent test failures for JWTAuthPluginIntegrationTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15484&quot;&gt;&lt;del&gt;SOLR-15484&lt;/del&gt;&lt;/a&gt; JWTAuthPluginIntegrationTest - dynamically generate the self-signed certificate using the localhost loopback address (#2099)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15484&quot; title=&quot;Frequent test failures for JWTAuthPluginIntegrationTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15484&quot;&gt;&lt;del&gt;SOLR-15484&lt;/del&gt;&lt;/a&gt;: dynamically generate the self-signed certificate using the localhost loopback address&lt;/p&gt;</comment>
                            <comment id="17795662" author="janhoy" created="Tue, 12 Dec 2023 10:00:10 +0000"  >&lt;p&gt;Looking at &lt;a href=&quot;http://fucit.org/solr-jenkins-reports/failure-report.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://fucit.org/solr-jenkins-reports/failure-report.html&lt;/a&gt;, the original fails from test &quot;mockOAuth2Server()&quot; seems to be gone now (check last 24h graph).&lt;/p&gt;

&lt;p&gt;However, we now have one &quot;classMethod&quot; failure from time to time, see e.g. &lt;a href=&quot;https://jenkins.thetaphi.de/view/Solr/job/Solr-main-Linux/15897/testReport/junit/org.apache.solr.security.jwt/JWTAuthPluginIntegrationTest/classMethod/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jenkins.thetaphi.de/view/Solr/job/Solr-main-Linux/15897/testReport/junit/org.apache.solr.security.jwt/JWTAuthPluginIntegrationTest/classMethod/&lt;/a&gt; &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.IllegalArgumentException: invalid date string: Unparseable date: &lt;span class=&quot;code-quote&quot;&gt;&quot;highgfffffffGMT+00:00&quot;&lt;/span&gt;
	at __randomizedtesting.SeedInfo.seed([C2EF263646376D0B]:0)
	at org.bouncycastle.asn1.ASN1UTCTime.&amp;lt;init&amp;gt;(ASN1UTCTime.java:118)
	at org.bouncycastle.asn1.DERUTCTime.&amp;lt;init&amp;gt;(Unknown Source)
	at org.bouncycastle.asn1.x509.Time.&amp;lt;init&amp;gt;(Unknown Source)
	at org.bouncycastle.cert.X509v3CertificateBuilder.&amp;lt;init&amp;gt;(Unknown Source)
	at org.bouncycastle.cert.jcajce.JcaX509v3CertificateBuilder.&amp;lt;init&amp;gt;(Unknown Source)
	at org.apache.solr.security.jwt.KeystoreGenerator.selfSignCertificate(KeystoreGenerator.java:101)
	at org.apache.solr.security.jwt.KeystoreGenerator.generateKeystore(KeystoreGenerator.java:63)
	at org.apache.solr.security.jwt.JWTAuthPluginIntegrationTest.beforeClass(JWTAuthPluginIntegrationTest.java:110)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Turns out to be a known bug relating to &lt;a href=&quot;https://stackoverflow.com/questions/35987510/illegalargumentexception-unparseable-date-during-androidkeystore-key-generatio&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;wrong time initialization for locales in right-to-left languages&lt;/a&gt;. The test run had locale &lt;tt&gt;mr-IN&lt;/tt&gt; which is some hindi script. There is a proposed workaround to reset locale before generating key, and then set it back again. We could do that or we could ignore and wait for JDK to fix the bug?&lt;/p&gt;</comment>
                            <comment id="17795779" author="jira-bot" created="Tue, 12 Dec 2023 14:24:05 +0000"  >&lt;p&gt;Commit 686700b96edab4ee35199015297cd27c5ddca4a2 in solr&apos;s branch refs/heads/main from James Dyer&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=686700b96ed&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=686700b96ed&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15484&quot; title=&quot;Frequent test failures for JWTAuthPluginIntegrationTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15484&quot;&gt;&lt;del&gt;SOLR-15484&lt;/del&gt;&lt;/a&gt;: use latest version of bouncycastle libraries (#2145)&lt;/p&gt;
</comment>
                            <comment id="17795819" author="jira-bot" created="Tue, 12 Dec 2023 15:40:08 +0000"  >&lt;p&gt;Commit b1d6f628dc39271de48f1f345953c2018087e5fd in solr&apos;s branch refs/heads/branch_9x from James Dyer&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=b1d6f628dc3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=b1d6f628dc3&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15484&quot; title=&quot;Frequent test failures for JWTAuthPluginIntegrationTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15484&quot;&gt;&lt;del&gt;SOLR-15484&lt;/del&gt;&lt;/a&gt;: use latest version of bouncycastle libraries (#2145)&lt;/p&gt;
</comment>
                            <comment id="17816726" author="gerlowskija" created="Mon, 12 Feb 2024 19:48:57 +0000"  >&lt;p&gt;Closing after the 9.5.0 release&lt;/p&gt;</comment>
                            <comment id="17843423" author="JIRAUSER305513" created="Sat, 4 May 2024 10:40:43 +0000"  >&lt;p&gt;&lt;b&gt;This test failed again:-&lt;/b&gt;&lt;br/&gt;
&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
   44056 INFO (TEST-JWTAuthPluginIntegrationTest.mockOAuth2Server-seed#[F98DD07D54DABA29]) [n: c: s: r: x: t:] o.a.s.SolrTestCaseJ4 ###Ending mockOAuth2Server    6149 &amp;gt; org.junit.ComparisonFailure: Should have received 401 code expected:&amp;lt;[401]&amp;gt; but was:&amp;lt;[200]&amp;gt;        6150 &amp;gt; at __randomizedtesting.SeedInfo.seed([F98DD07D54DABA29:7E8D312D316646C5]:0)    6151 &amp;gt; at org.junit.Assert.assertEquals(Assert.java:117)    6152 &amp;gt; at org.apache.solr.security.jwt.JWTAuthPluginIntegrationTest.mockOAuth2Server(JWTAuthPluginIntegrationTest.java:145)    6153 &amp;gt; at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)    6154 &amp;gt; at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)    6155 &amp;gt; at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)    6156 &amp;gt; at java.base/java.lang.reflect.Method.invoke(Method.java:566)    6157 &amp;gt; at com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1758)    6158 &amp;gt; at com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:946)    6159 &amp;gt; at com.carrotsearch.randomizedtesting.RandomizedRunner$9.evaluate(RandomizedRunner.java:982)    6160 &amp;gt; at com.carrotsearch.randomizedtesting.RandomizedRunner$10.evaluate(RandomizedRunner.java:996)    6161 &amp;gt; at com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:80)    6162 &amp;gt; at org.junit.rules.RunRules.evaluate(RunRules.java:20)   

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Also there are bunch of other classMethod failures, because of resource leak. Once assert failed it did not shutdown the cluster. Two ways to solved it, either the whole test block should be inside the try block and in finally we should shutdown the cluster. Or, use the existing cluster reference from&#160;SolrCloudTestCase and that will take care of shutting down the cluster.&lt;br/&gt;
&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/solr/pull/2373&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/solr/pull/2373&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13379483">SOLR-15423</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13426992">SOLR-15985</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 27 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0s1e0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>