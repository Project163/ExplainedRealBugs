<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:11:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-8633] DistributedUpdateProcess processCommit/deleteByQuery call finish on DUP and SolrCmdDistributor, which violates the lifecycle and can cause bugs.</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8633</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;trying to wrap my head around a weird bug in my experiements with &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-445&quot; title=&quot;Update Handlers abort with bad documents&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-445&quot;&gt;&lt;del&gt;SOLR-445&lt;/del&gt;&lt;/a&gt;, i realized that &lt;tt&gt;DUP.processDelete&lt;/tt&gt; has a direct call to &lt;tt&gt;finish()&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;This violates the normal lifecycle of an UpdateProcessor (finish is only suppose to be called exactly once after processing any/all UpdateCommands) and could potentially break any UpdateProcessors configured after DUP (or in my case: processors configured &lt;em&gt;before&lt;/em&gt; DUP that expect to be in charge of calling finish, and catching any resulting exceptions, as part of the normal life cycle)&lt;/p&gt;

&lt;p&gt;Independent of how it impacts other update processors, this also means that:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;all the logic in &lt;tt&gt;DUP.doFinish&lt;/tt&gt; is getting executed twice &amp;#8211; which seems kind of expensive/dangerous to me since there is leader initiated recovery involved in this method&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;SolrCmdDistributor.finish()&lt;/tt&gt; gets called twice, which means &lt;tt&gt;StreamingSolrClients.shutdown()&lt;/tt&gt; gets called twice, which means &lt;tt&gt;ConcurrentUpdateSolrClient.close()&lt;/tt&gt; gets called twice ... it seems like we&apos;re just getting really lucky that (as configured by DUP) all of these resources are still usable after being finished/shutdown/closed&lt;/li&gt;
&lt;/ol&gt;


</description>
                <environment></environment>
        <key id="12936137">SOLR-8633</key>
            <summary>DistributedUpdateProcess processCommit/deleteByQuery call finish on DUP and SolrCmdDistributor, which violates the lifecycle and can cause bugs.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="markrmiller@gmail.com">Mark Miller</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Tue, 2 Feb 2016 21:54:08 +0000</created>
                <updated>Mon, 9 May 2016 18:46:06 +0000</updated>
                            <resolved>Thu, 21 Apr 2016 18:58:38 +0000</resolved>
                                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15129112" author="hossman" created="Tue, 2 Feb 2016 21:55:13 +0000"  >
&lt;p&gt;I suspect that the &lt;em&gt;intended&lt;/em&gt; goal here (in processCommit) is to do the same sort of &quot;force sequential ordering&quot; type logic as doDeleteByQuery &amp;#8211; in which case we can/should replace the call to &lt;tt&gt;finish()&lt;/tt&gt; with a call to &lt;tt&gt;cmdDistrib.finish()&lt;/tt&gt; ... except that i&apos;m still concerned about shutdown/closing of clients done by that method, and wonder if &lt;em&gt;both&lt;/em&gt; processCommit &amp;amp; processDelete should be calling &lt;tt&gt;SolrCmdDistributor.blockAndDoRetries()&lt;/tt&gt; directly? (we would just need to make that method public)&lt;/p&gt;

&lt;p&gt;Hoping folks like &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; / &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tim.potter&quot; class=&quot;user-hover&quot; rel=&quot;tim.potter&quot;&gt;tim.potter&lt;/a&gt; might have some ideas about this?&lt;/p&gt;</comment>
                            <comment id="15129378" author="hossman" created="Tue, 2 Feb 2016 23:54:39 +0000"  >&lt;p&gt;attaching a strawman patch that has asserts ensuring that &lt;tt&gt;finish()&lt;/tt&gt; is never called more then once on either DUP or SolrCmdDistributor, and makes &lt;tt&gt;blockAndDoRetries()&lt;/tt&gt; public so DUP can call it instead of &lt;tt&gt;finish()&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;all tests pass ... anyone see any problems with this? &lt;/p&gt;

&lt;p&gt;any reason why the previous code (where all the logic in DUP.finish() was getting executed twice when there was an explicit commit) was better/needed ?&lt;/p&gt;</comment>
                            <comment id="15129751" author="markrmiller@gmail.com" created="Wed, 3 Feb 2016 04:13:29 +0000"  >&lt;p&gt;Healing. Happy to review soon (this week). &lt;/p&gt;</comment>
                            <comment id="15154144" author="markrmiller@gmail.com" created="Fri, 19 Feb 2016 12:04:19 +0000"  >&lt;p&gt;Forgot this issue. I&apos;ll review this today.&lt;/p&gt;</comment>
                            <comment id="15154184" author="markrmiller@gmail.com" created="Fri, 19 Feb 2016 12:59:01 +0000"  >&lt;p&gt;Yeah, it&apos;s a bug, patch is the right fix.&lt;/p&gt;</comment>
                            <comment id="15154482" author="hossman" created="Fri, 19 Feb 2016 16:48:25 +0000"  >&lt;p&gt;thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; - if you want to take this go ahead, otherwise i&apos;ll commit &amp;amp; backport first thing next week.&lt;/p&gt;</comment>
                            <comment id="15154788" author="jira-bot" created="Fri, 19 Feb 2016 20:05:55 +0000"  >&lt;p&gt;Commit 8cd53a076b579ebc3be1fbb26875321e66a41608 in lucene-solr&apos;s branch refs/heads/master from markrmiller&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8cd53a0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8cd53a0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8633&quot; title=&quot;DistributedUpdateProcess processCommit/deleteByQuery call finish on DUP and SolrCmdDistributor, which violates the lifecycle and can cause bugs.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8633&quot;&gt;&lt;del&gt;SOLR-8633&lt;/del&gt;&lt;/a&gt;: DistributedUpdateProcess processCommit/deleteByQuery call finish on DUP and SolrCmdDistributor, which violates the lifecycle and can cause bugs.&lt;/p&gt;</comment>
                            <comment id="15248893" author="anshumg" created="Tue, 19 Apr 2016 23:18:52 +0000"  >&lt;p&gt;Reopening for 5.5.1&lt;/p&gt;</comment>
                            <comment id="15252398" author="jira-bot" created="Thu, 21 Apr 2016 18:23:44 +0000"  >&lt;p&gt;Commit 30fee6ba03fc77c51ff0e87a405f5b2942d8e7c9 in lucene-solr&apos;s branch refs/heads/branch_5x from markrmiller&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=30fee6b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=30fee6b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8633&quot; title=&quot;DistributedUpdateProcess processCommit/deleteByQuery call finish on DUP and SolrCmdDistributor, which violates the lifecycle and can cause bugs.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8633&quot;&gt;&lt;del&gt;SOLR-8633&lt;/del&gt;&lt;/a&gt;: DistributedUpdateProcess processCommit/deleteByQuery call finish on DUP and SolrCmdDistributor, which violates the lifecycle and can cause bugs.&lt;/p&gt;</comment>
                            <comment id="15252468" author="jira-bot" created="Thu, 21 Apr 2016 18:57:50 +0000"  >&lt;p&gt;Commit e603565d4757625cc90d9db77a7ee240c20f93ed in lucene-solr&apos;s branch refs/heads/branch_5_5 from markrmiller&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e603565&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e603565&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8633&quot; title=&quot;DistributedUpdateProcess processCommit/deleteByQuery call finish on DUP and SolrCmdDistributor, which violates the lifecycle and can cause bugs.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8633&quot;&gt;&lt;del&gt;SOLR-8633&lt;/del&gt;&lt;/a&gt;: DistributedUpdateProcess processCommit/deleteByQuery call finish on DUP and SolrCmdDistributor, which violates the lifecycle and can cause bugs.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12385211">SOLR-445</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12785884" name="SOLR-8633.patch" size="2805" author="hossman" created="Tue, 2 Feb 2016 23:54:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 30 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2sbmn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>