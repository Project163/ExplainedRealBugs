<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:12:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-8423] DELETESHARD should cleanup the instance and data directory, like DELETEREPLICA</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8423</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;DELETESHARD only cleans up the index directory and not the instance/data directory. DELETEREPLICA on the other hand cleans up the data and instance directory.&lt;/p&gt;

&lt;p&gt;DELETESHARD should clean up the instance and data directory, so that we don&apos;t leak disk space on executing the command.&lt;/p&gt;

&lt;p&gt;If we think this would break back-compat, though I don&apos;t see why this should not clean up the instance dir, we should at least provide an option to clean up everything and make it default in 6.0.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12922318">SOLR-8423</key>
            <summary>DELETESHARD should cleanup the instance and data directory, like DELETEREPLICA</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="anshum">Anshum Gupta</assignee>
                                    <reporter username="anshum">Anshum Gupta</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Dec 2015 10:06:32 +0000</created>
                <updated>Wed, 2 Oct 2019 17:23:59 +0000</updated>
                            <resolved>Thu, 3 Mar 2016 23:01:33 +0000</resolved>
                                                    <fixVersion>6.0</fixVersion>
                    <fixVersion>6.1</fixVersion>
                    <fixVersion>7.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15060299" author="erickerickson" created="Wed, 16 Dec 2015 17:02:22 +0000"  >&lt;p&gt;I don&apos;t think this breaks back-compat &apos;cause I don&apos;t see any promises in the docs &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; But I vaguely recall that this was to clean up stale cluster states without having to directly edit the ZK node, so maybe nobody thought about it?&lt;/p&gt;

&lt;p&gt;I might advocate an option to keep at least the data directory just on general principles here though. I&apos;m thinking of the case where the user is explicitly controlling routing, say time-series data. Does it make sense to delete/create shards to hide/show some time-interval? I have to admit this is a &lt;em&gt;theoretical&lt;/em&gt; use-case, haven&apos;t seen anyone actually ask for it so feel free to ignore...&lt;/p&gt;</comment>
                            <comment id="15061728" author="anshumg" created="Thu, 17 Dec 2015 08:42:32 +0000"  >&lt;p&gt;Patch without a test. I&apos;ll add a test for this and also need to find a better param for supporting deletion without cleaning up of the instance directory (like right now). In this patch, it&apos;s called &lt;em&gt;safedelete&lt;/em&gt;.&lt;/p&gt;</comment>
                            <comment id="15061776" author="shaie" created="Thu, 17 Dec 2015 09:23:40 +0000"  >&lt;p&gt;So with this patch, the default is that we delete the index + instance + data directory, but if the user wants, he can request a &lt;em&gt;safedelete&lt;/em&gt; and the behavior goes back to what it is today? I&apos;m fine with that.&lt;/p&gt;</comment>
                            <comment id="15061798" author="shalinmangar" created="Thu, 17 Dec 2015 09:39:03 +0000"  >&lt;p&gt;Why not just use the existing deleteInstanceDir and deleteDataDir core admin params (and default them to true)? It is not obvious to me what &apos;safedelete&apos; means.&lt;/p&gt;</comment>
                            <comment id="15061804" author="anshumg" created="Thu, 17 Dec 2015 09:47:22 +0000"  >&lt;p&gt;I just wanted to keep it easy for users and I think adding a single flag is an easier option.&lt;br/&gt;
Also, we want to set both those to true and I personally feel that deleteInstanceDir/deleteDataDir being set to true is a little less intuitive.&lt;/p&gt;</comment>
                            <comment id="15061813" author="shalinmangar" created="Thu, 17 Dec 2015 09:54:44 +0000"  >&lt;p&gt;This is easy for the users. No need to remember what a new vague sounding parameter does. deleteInstanceDir/deleteDataDir is as explicit as it gets. &lt;/p&gt;

&lt;p&gt;What the hell is a safedelete anyway?&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;We don&apos;t accidentally delete other&apos;s data?&lt;/li&gt;
	&lt;li&gt;We don&apos;t delete our data?&lt;/li&gt;
	&lt;li&gt;We ensure that data is actually deleted and cannot be recovered?&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;If you really want to keep things simple for users, do what deletereplica already does i.e. deletes instance dir, data dir, index automatically as we did in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6072&quot; title=&quot;The &amp;#39;deletereplica&amp;#39; API should remove the data and instance directory default&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6072&quot;&gt;&lt;del&gt;SOLR-6072&lt;/del&gt;&lt;/a&gt;. No switch necessary to control that. If you want to implement a way to control what gets deleted, implement it for both deleteshard and deletereplica and even better, just have deleteshard internally call deletereplica and avoid the code duplication.&lt;/p&gt;</comment>
                            <comment id="15061880" author="anshumg" created="Thu, 17 Dec 2015 10:47:33 +0000"  >&lt;p&gt;As I said, the name of the param was just something I put in there.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;need to find a better param for supporting deletion without cleaning up of the instance directory (like right now). In this patch, it&apos;s called safedelete.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;As far as reusing the current params is concerned, I&apos;ll go with your suggestion and put up another patch. I used CoreAdmin calls directly because I didn&apos;t want to stack up more tasks for the Overseer. It however makes sense to just refactor the coreadmin call code and reuse that.&lt;/p&gt;

&lt;p&gt;P.S: The meaning of &apos;safedelete&apos; would have been clear through the ref guide/documentation. The difference between instance/data/index directory can get a little complicated for users though, specially as we&apos;re trying to move away from Core admin calls being exposed to end users (via http api).&lt;/p&gt;</comment>
                            <comment id="15062003" author="markrmiller@gmail.com" created="Thu, 17 Dec 2015 12:55:26 +0000"  >&lt;blockquote&gt;&lt;p&gt;deleteInstanceDir and deleteDataDir &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Probably best to be consistent in naming these params - especially given the behavior is the same. At least on 5x. On 6x, would still be nice to be consistent, but we could change how it works if we had ideas to improve it.&lt;/p&gt;</comment>
                            <comment id="15067858" author="anshumg" created="Tue, 22 Dec 2015 09:37:42 +0000"  >&lt;p&gt;Patch that uses deleteDataDir, deleteInstanceDir and defaults them to true.&lt;br/&gt;
It now also supports setting those to false for DELETESHARD and DELETEREPLICA.&lt;/p&gt;</comment>
                            <comment id="15068033" author="shalinmangar" created="Tue, 22 Dec 2015 12:10:24 +0000"  >&lt;p&gt;Thanks Anshum. Looks good to me. We need a test though.&lt;/p&gt;</comment>
                            <comment id="15068039" author="anshumg" created="Tue, 22 Dec 2015 12:13:41 +0000"  >&lt;p&gt;Right, working on that. Got stuck up with something else.&lt;/p&gt;</comment>
                            <comment id="15176259" author="anshumg" created="Wed, 2 Mar 2016 18:59:36 +0000"  >&lt;p&gt;Patch with tests. I&apos;ll commit this once the 6.0 work is in place.&lt;/p&gt;</comment>
                            <comment id="15178507" author="jira-bot" created="Thu, 3 Mar 2016 19:55:25 +0000"  >&lt;p&gt;Commit 9c777ab5adfd07e49310a5fb091d8bac611ef0ba in lucene-solr&apos;s branch refs/heads/master from anshum&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9c777ab&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=9c777ab&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8423&quot; title=&quot;DELETESHARD should cleanup the instance and data directory, like DELETEREPLICA&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8423&quot;&gt;&lt;del&gt;SOLR-8423&lt;/del&gt;&lt;/a&gt;: DeleteShard and DeleteReplica should cleanup instance and data directory by default and add support for optionally retaining the directories&lt;/p&gt;</comment>
                            <comment id="15178679" author="jira-bot" created="Thu, 3 Mar 2016 21:51:59 +0000"  >&lt;p&gt;Commit 638b145376baea5281273bb90cedd8f69fecfa9f in lucene-solr&apos;s branch refs/heads/branch_6x from anshum&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=638b145&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=638b145&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8423&quot; title=&quot;DELETESHARD should cleanup the instance and data directory, like DELETEREPLICA&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8423&quot;&gt;&lt;del&gt;SOLR-8423&lt;/del&gt;&lt;/a&gt;: DeleteShard and DeleteReplica should cleanup instance and data directory by default and add support for optionally retaining the directories&lt;/p&gt;</comment>
                            <comment id="15178687" author="jira-bot" created="Thu, 3 Mar 2016 21:58:46 +0000"  >&lt;p&gt;Commit ca03639e6d5fbae924060fdb0b087189bb65a75d in lucene-solr&apos;s branch refs/heads/branch_6_0 from anshum&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ca03639&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ca03639&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8423&quot; title=&quot;DELETESHARD should cleanup the instance and data directory, like DELETEREPLICA&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8423&quot;&gt;&lt;del&gt;SOLR-8423&lt;/del&gt;&lt;/a&gt;: DeleteShard and DeleteReplica should cleanup instance and data directory by default and add support for optionally retaining the directories&lt;/p&gt;</comment>
                            <comment id="15227580" author="hossman" created="Wed, 6 Apr 2016 02:28:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anshumg&quot; class=&quot;user-hover&quot; rel=&quot;anshumg&quot;&gt;anshumg&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; - can one of you please review the ref guide edits i made for this issue...&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/pages/diffpagesbyversion.action?pageId=32604284&amp;amp;selectedPageVersions=156&amp;amp;selectedPageVersions=157&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/pages/diffpagesbyversion.action?pageId=32604284&amp;amp;selectedPageVersions=156&amp;amp;selectedPageVersions=157&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/pages/diffpagesbyversion.action?pageId=61339928&amp;amp;selectedPageVersions=5&amp;amp;selectedPageVersions=6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/pages/diffpagesbyversion.action?pageId=61339928&amp;amp;selectedPageVersions=5&amp;amp;selectedPageVersions=6&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;(It was a little confusing to me how to document this clearly since, AFAICT, &lt;em&gt;all&lt;/em&gt; the params default to &quot;true&quot;, regardless of what other params the user might set to &quot;false&quot;, so setting &lt;tt&gt;deleteInstanceDir=false&lt;/tt&gt; by itself doesn&apos;t seem to do anything very useful &amp;#8211; the dataDir (and index) is still deleted because deleteDatadDir defaults to true.)&lt;/p&gt;</comment>
                            <comment id="15227586" author="anshumg" created="Wed, 6 Apr 2016 02:29:55 +0000"  >&lt;p&gt;I&apos;ll take a look.&lt;/p&gt;</comment>
                            <comment id="15227602" author="anshumg" created="Wed, 6 Apr 2016 02:45:09 +0000"  >&lt;p&gt;You are right about deleteInstanceDir not doing anything by itself as the data directory would still be deleted by default and deleteDataDir has a similar issue. This calls for a JIRA but in terms of documenting this, we might have to ask users to set both of them to false for 6.0.&lt;/p&gt;</comment>
                            <comment id="15279238" author="hossman" created="Tue, 10 May 2016 23:39:37 +0000"  >
&lt;p&gt;Manually correcting fixVersion per Step #S6 of &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-7271&quot; title=&quot;Cleanup jira&amp;#39;s concept of &amp;#39;master&amp;#39; and &amp;#39;6.0&amp;#39;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-7271&quot;&gt;&lt;del&gt;LUCENE-7271&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12790992" name="SOLR-8423.patch" size="16969" author="anshum" created="Wed, 2 Mar 2016 18:59:36 +0000"/>
                            <attachment id="12779020" name="SOLR-8423.patch" size="3372" author="anshum" created="Tue, 22 Dec 2015 09:37:42 +0000"/>
                            <attachment id="12778210" name="SOLR-8423.patch" size="1750" author="anshum" created="Thu, 17 Dec 2015 08:42:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 28 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2pywn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>