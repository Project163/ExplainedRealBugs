<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:22:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-2474] Analysis.jsp and AnalaysisRequestHandlerBase do not correctly clear attributes on caching tokens</title>
                <link>https://issues.apache.org/jira/browse/SOLR-2474</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;When caching tokens, the helper TokenStreams in analysis.jsp and AnalysisRequestHandlerBase do not clear all attributes.&lt;br/&gt;
The issue is tricky. The cached tokens do not contain all attributes in early stages, so copyTo() does not necessarily overwrite all attributes in &quot;this&quot;. Calling clearAttributes ensures this.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Was: &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2901&quot; title=&quot;KeywordMarkerFilter resets keyword attribute state to false for tokens not in protwords.txt&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-2901&quot;&gt;&lt;del&gt;LUCENE-2901&lt;/del&gt;&lt;/a&gt; broke protected words by only setting and never clearing (that change should have been accompanied by offsetting code to clear the attribute somewhere).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The problem here was, that this attribute was added later in anaylsis chain, so cached tokens don&apos;t include this. Sorry, that was my fault when rewriting analysis.jsp together with Robert &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12504817">SOLR-2474</key>
            <summary>Analysis.jsp and AnalaysisRequestHandlerBase do not correctly clear attributes on caching tokens</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="uschindler">Uwe Schindler</assignee>
                                    <reporter username="yseeley@gmail.com">Yonik Seeley</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Apr 2011 18:37:12 +0000</created>
                <updated>Fri, 3 Jun 2011 16:44:52 +0000</updated>
                            <resolved>Wed, 20 Apr 2011 21:35:47 +0000</resolved>
                                    <version>3.1</version>
                                    <fixVersion>3.2</fixVersion>
                    <fixVersion>4.0-ALPHA</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13022283" author="rcmuir" created="Wed, 20 Apr 2011 18:44:41 +0000"  >&lt;p&gt;all tokenizers should be calling clearAttributes()?  where is the problem?&lt;/p&gt;</comment>
                            <comment id="13022286" author="thetaphi" created="Wed, 20 Apr 2011 18:47:31 +0000"  >&lt;p&gt;Yonik, clearing should be done by the Tokenizer or other token-producers (if a filter inserts Tokens, it also has to clear Attributes). If the Tokenizer does not clear all Attributes using clearAttributes(), it is borken. But not this one.&lt;/p&gt;

&lt;p&gt;Can you post the config of your Tokenizers and Filters or which Analyzer is affected?&lt;/p&gt;</comment>
                            <comment id="13022288" author="rcmuir" created="Wed, 20 Apr 2011 18:49:56 +0000"  >&lt;p&gt;I see the problem with the example config: simply enter &quot;dontstems foo&quot;&lt;/p&gt;

&lt;p&gt;But, we need to figure out:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;is it only a bug in analysis.jsp?&lt;/li&gt;
	&lt;li&gt;if not, who isn&apos;t clearing attributes.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="13022294" author="rcmuir" created="Wed, 20 Apr 2011 18:54:12 +0000"  >&lt;p&gt;This is just a bug in analysis.jsp, compare the query debug output &quot;dontstems bees&quot; to the analysis.jsp output of dontstems bees, and you will see what I mean.&lt;/p&gt;

&lt;p&gt;There is nothing wrong with the lucene filter here!&lt;/p&gt;</comment>
                            <comment id="13022297" author="yseeley@gmail.com" created="Wed, 20 Apr 2011 18:55:16 +0000"  >&lt;blockquote&gt;&lt;p&gt;clearing should be done by the Tokenizer or other token-producers&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Whew... ok, I didn&apos;t realize that pre-dated &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2901&quot; title=&quot;KeywordMarkerFilter resets keyword attribute state to false for tokens not in protwords.txt&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-2901&quot;&gt;&lt;del&gt;LUCENE-2901&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;So perhaps this is just an analysis.jsp bug, since a query of&lt;br/&gt;
&lt;a href=&quot;http://localhost:8983/solr/select?q=&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8983/solr/select?q=&lt;/a&gt;&quot;dontstems hellos&quot;&amp;amp;debugQuery=true&lt;br/&gt;
seems to work fine and produce &quot;dontstems hello&quot;&lt;/p&gt;
</comment>
                            <comment id="13022299" author="thetaphi" created="Wed, 20 Apr 2011 18:55:41 +0000"  >&lt;p&gt;I think the stupid Token caching in analysis.jsp is maybe broken. Does it also affect *AnalysisRequestHandler?&lt;/p&gt;</comment>
                            <comment id="13022301" author="rcmuir" created="Wed, 20 Apr 2011 18:58:14 +0000"  >&lt;p&gt;I created an issue for the analysis.jsp: SOLR-2473&lt;/p&gt;

&lt;p&gt;the problem is likely to cause a lot of confusion, and as Uwe said we should check the similar AnalysisRequestHandler too&lt;/p&gt;</comment>
                            <comment id="13022306" author="thetaphi" created="Wed, 20 Apr 2011 19:05:19 +0000"  >&lt;p&gt;I found the bug:&lt;br/&gt;
The problem is in analysis.jsp (3.x version), line 227: there should be a clearAttributes() first.&lt;br/&gt;
Reason is: In early stages, cached tokens dont have the Keyword Attribute, so the following copyTo() does not overwrite all attributes.&lt;br/&gt;
Same applies for AnalysisReqHandlerBase. The depreacted AnalysisReqHandler does not has this problem as it does not debug all filters and caches no Tokens.&lt;br/&gt;
Patch is coming...&lt;/p&gt;</comment>
                            <comment id="13022308" author="thetaphi" created="Wed, 20 Apr 2011 19:09:06 +0000"  >&lt;p&gt;I moved this issue over to Solr, as it has nothing to do with Lucene.&lt;/p&gt;</comment>
                            <comment id="13022310" author="thetaphi" created="Wed, 20 Apr 2011 19:09:59 +0000"  >&lt;p&gt;Patch (its on Lucene 3.1 branch, but should apply for 3.x and trunk, too)&lt;/p&gt;</comment>
                            <comment id="13022380" author="thetaphi" created="Wed, 20 Apr 2011 21:35:47 +0000"  >&lt;p&gt;Committed 3.x revision: 1095519&lt;br/&gt;
Merged trunk revision: 1095521&lt;/p&gt;

&lt;p&gt;Thanks Robert for investigating and Yonik for reporting this hairy one.&lt;/p&gt;</comment>
                            <comment id="13043578" author="rcmuir" created="Fri, 3 Jun 2011 16:44:52 +0000"  >&lt;p&gt;Bulk close for 3.2&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12476931" name="SOLR-2474.patch" size="1365" author="uschindler" created="Wed, 20 Apr 2011 19:09:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5063</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 25 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03kjb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>18760</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>