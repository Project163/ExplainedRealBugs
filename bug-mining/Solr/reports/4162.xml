<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:37:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-13268] Clean up any test failures resulting from defaulting to async logging</title>
                <link>https://issues.apache.org/jira/browse/SOLR-13268</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;This is a catch-all for test failures due to the async logging changes. So far, the I see a couple failures on JDK13 only. I&apos;ll collect a &quot;starter set&quot; here, these are likely systemic, once the root cause is found/fixed, then others are likely fixed as well.&lt;/p&gt;

&lt;p&gt;JDK13:&lt;/p&gt;

&lt;p&gt;ant test  -Dtestcase=TestJmxIntegration -Dtests.seed=54B30AC62A2D71E -Dtests.multiplier=3 -Dtests.slow=true -Dtests.locale=lv-LV -Dtests.timezone=Asia/Riyadh -Dtests.asserts=true -Dtests.file.encoding=UTF-8&lt;/p&gt;

&lt;p&gt;ant test  -Dtestcase=TestDynamicURP -Dtests.seed=54B30AC62A2D71E -Dtests.multiplier=3 -Dtests.slow=true -Dtests.locale=rwk -Dtests.timezone=Australia/Brisbane -Dtests.asserts=true -Dtests.file.encoding=UTF-8&lt;/p&gt;
</description>
                <environment></environment>
        <key id="13217560">SOLR-13268</key>
            <summary>Clean up any test failures resulting from defaulting to async logging</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="erickerickson">Erick Erickson</assignee>
                                    <reporter username="erickerickson">Erick Erickson</reporter>
                        <labels>
                    </labels>
                <created>Sat, 23 Feb 2019 00:56:03 +0000</created>
                <updated>Wed, 15 Jul 2020 15:08:49 +0000</updated>
                            <resolved>Tue, 23 Jun 2020 19:40:55 +0000</resolved>
                                                    <fixVersion>8.6</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3600">1h</timespent>
                                <comments>
                            <comment id="16775736" author="risdenk" created="Sat, 23 Feb 2019 01:35:23 +0000"  >&lt;p&gt;Shared on asf slack but adding here as well. I have a local Jenkins server that runs tests on JDK 8 (and 11). Here are 3 similar failures from AdoptOpenJdk 1.8.0_202&lt;/p&gt;

&lt;p&gt;&lt;b&gt;UpdateLogTest&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=UpdateLogTest -Dtests.seed=7E032A96C05E8363 -Dtests.slow=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.badapples=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.locale=ar -Dtests.timezone=America/Marigot -Dtests.asserts=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.file.encoding=US-ASCII
   [junit4] ERROR   0.00s J0 | UpdateLogTest (suite) &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: com.carrotsearch.randomizedtesting.ThreadLeakError: 1 thread leaked from SUITE scope at org.apache.solr.update.UpdateLogTest: 
   [junit4]    &amp;gt;    1) &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[id=29, name=Log4j2-TF-2-AsyncLoggerConfig--2, state=TIMED_WAITING, group=TGRP-UpdateLogTest]
   [junit4]    &amp;gt;         at sun.misc.Unsafe.park(Native Method)
   [junit4]    &amp;gt;         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    &amp;gt;         at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2078)
   [junit4]    &amp;gt;         at com.lmax.disruptor.TimeoutBlockingWaitStrategy.waitFor(TimeoutBlockingWaitStrategy.java:38)
   [junit4]    &amp;gt;         at com.lmax.disruptor.ProcessingSequenceBarrier.waitFor(ProcessingSequenceBarrier.java:56)
   [junit4]    &amp;gt;         at com.lmax.disruptor.BatchEventProcessor.run(BatchEventProcessor.java:128)
   [junit4]    &amp;gt;         at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
   [junit4]    &amp;gt;     at __randomizedtesting.SeedInfo.seed([7E032A96C05E8363]:0)Throwable #2: com.carrotsearch.randomizedtesting.ThreadLeakError: There are still zombie threads that couldn&apos;t be terminated:
   [junit4]    &amp;gt;    1) &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[id=29, name=Log4j2-TF-2-AsyncLoggerConfig--2, state=TIMED_WAITING, group=TGRP-UpdateLogTest]
   [junit4]    &amp;gt;         at sun.misc.Unsafe.park(Native Method)
   [junit4]    &amp;gt;         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    &amp;gt;         at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2078)
   [junit4]    &amp;gt;         at com.lmax.disruptor.TimeoutBlockingWaitStrategy.waitFor(TimeoutBlockingWaitStrategy.java:38)
   [junit4]    &amp;gt;         at com.lmax.disruptor.ProcessingSequenceBarrier.waitFor(ProcessingSequenceBarrier.java:56)
   [junit4]    &amp;gt;         at com.lmax.disruptor.BatchEventProcessor.run(BatchEventProcessor.java:128)
   [junit4]    &amp;gt;         at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
   [junit4]    &amp;gt;     at __randomizedtesting.SeedInfo.seed([7E032A96C05E8363]:0)
   [junit4] Completed [2/844 (1!)] on J0 in 32.30s, 4 tests, 2 errors &amp;lt;&amp;lt;&amp;lt; FAILURES
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;b&gt;VersionInfoTest&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=VersionInfoTest -Dtests.seed=7E032A96C05E8363 -Dtests.slow=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.badapples=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.locale=et -Dtests.timezone=Indian/Mauritius -Dtests.asserts=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.file.encoding=US-ASCII
   [junit4] ERROR   0.00s J2 | VersionInfoTest (suite) &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: com.carrotsearch.randomizedtesting.ThreadLeakError: 1 thread leaked from SUITE scope at org.apache.solr.update.VersionInfoTest: 
   [junit4]    &amp;gt;    1) &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[id=52, name=Log4j2-TF-2-AsyncLoggerConfig--2, state=TIMED_WAITING, group=TGRP-VersionInfoTest]
   [junit4]    &amp;gt;         at sun.misc.Unsafe.park(Native Method)
   [junit4]    &amp;gt;         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    &amp;gt;         at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2078)
   [junit4]    &amp;gt;         at com.lmax.disruptor.TimeoutBlockingWaitStrategy.waitFor(TimeoutBlockingWaitStrategy.java:38)
   [junit4]    &amp;gt;         at com.lmax.disruptor.ProcessingSequenceBarrier.waitFor(ProcessingSequenceBarrier.java:56)
   [junit4]    &amp;gt;         at com.lmax.disruptor.BatchEventProcessor.run(BatchEventProcessor.java:128)
   [junit4]    &amp;gt;         at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
   [junit4]    &amp;gt;     at __randomizedtesting.SeedInfo.seed([7E032A96C05E8363]:0)Throwable #2: com.carrotsearch.randomizedtesting.ThreadLeakError: There are still zombie threads that couldn&apos;t be terminated:
   [junit4]    &amp;gt;    1) &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[id=52, name=Log4j2-TF-2-AsyncLoggerConfig--2, state=TIMED_WAITING, group=TGRP-VersionInfoTest]
   [junit4]    &amp;gt;         at sun.misc.Unsafe.park(Native Method)
   [junit4]    &amp;gt;         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    &amp;gt;         at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2078)
   [junit4]    &amp;gt;         at com.lmax.disruptor.TimeoutBlockingWaitStrategy.waitFor(TimeoutBlockingWaitStrategy.java:38)
   [junit4]    &amp;gt;         at com.lmax.disruptor.ProcessingSequenceBarrier.waitFor(ProcessingSequenceBarrier.java:56)
   [junit4]    &amp;gt;         at com.lmax.disruptor.BatchEventProcessor.run(BatchEventProcessor.java:128)
   [junit4]    &amp;gt;         at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
   [junit4]    &amp;gt;     at __randomizedtesting.SeedInfo.seed([7E032A96C05E8363]:0)
   [junit4] Completed [59/844 (2!)] on J2 in 37.17s, 2 tests, 2 errors &amp;lt;&amp;lt;&amp;lt; FAILURES!
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;b&gt;AnalysisAfterCoreReloadTest&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=AnalysisAfterCoreReloadTest -Dtests.seed=44A484596B614BAD -Dtests.slow=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.badapples=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.locale=it-CH -Dtests.timezone=America/Nome -Dtests.asserts=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.file.encoding=US-ASCII
   [junit4] ERROR   0.00s J0 | AnalysisAfterCoreReloadTest (suite) &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: com.carrotsearch.randomizedtesting.ThreadLeakError: 1 thread leaked from SUITE scope at org.apache.solr.AnalysisAfterCoreReloadTest: 
   [junit4]    &amp;gt;    1) &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[id=32, name=Log4j2-TF-2-AsyncLoggerConfig--2, state=TIMED_WAITING, group=TGRP-AnalysisAfterCoreReloadTest]
   [junit4]    &amp;gt;         at sun.misc.Unsafe.park(Native Method)
   [junit4]    &amp;gt;         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    &amp;gt;         at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2078)
   [junit4]    &amp;gt;         at com.lmax.disruptor.TimeoutBlockingWaitStrategy.waitFor(TimeoutBlockingWaitStrategy.java:38)
   [junit4]    &amp;gt;         at com.lmax.disruptor.ProcessingSequenceBarrier.waitFor(ProcessingSequenceBarrier.java:56)
   [junit4]    &amp;gt;         at com.lmax.disruptor.BatchEventProcessor.run(BatchEventProcessor.java:128)
   [junit4]    &amp;gt;         at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([44A484596B614BAD]:0)Throwable #2: com.carrotsearch.randomizedtesting.ThreadLeakError: There are still zombie threads that couldn&apos;t be terminated:
   [junit4]    &amp;gt;    1) &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[id=32, name=Log4j2-TF-2-AsyncLoggerConfig--2, state=TIMED_WAITING, group=TGRP-AnalysisAfterCoreReloadTest]
   [junit4]    &amp;gt;         at sun.misc.Unsafe.park(Native Method)
   [junit4]    &amp;gt;         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    &amp;gt;         at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2078)
   [junit4]    &amp;gt;         at com.lmax.disruptor.TimeoutBlockingWaitStrategy.waitFor(TimeoutBlockingWaitStrategy.java:38)
   [junit4]    &amp;gt;         at com.lmax.disruptor.ProcessingSequenceBarrier.waitFor(ProcessingSequenceBarrier.java:56)
   [junit4]    &amp;gt;         at com.lmax.disruptor.BatchEventProcessor.run(BatchEventProcessor.java:128)
   [junit4]    &amp;gt;         at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([44A484596B614BAD]:0)
   [junit4] Completed [4/844 (1!)] on J0 in 27.01s, 1 test, 2 errors &amp;lt;&amp;lt;&amp;lt; FAILURES!
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16775737" author="risdenk" created="Sat, 23 Feb 2019 01:37:06 +0000"  >&lt;p&gt;Some other info about log4j2 and LMAX releases.&lt;/p&gt;

&lt;p&gt;We are on LMAX 3.4.0 and there is a 3.4.2 with changes related to `BatchEventProcessor` which was in the stack trace&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;3.4.1 - Fix race between run() and halt() on BatchEventProcessor.&lt;/li&gt;
	&lt;li&gt;3.4.2 - Fix for race condition on restart of BatchEventProcessor with 3 or more threads.&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/LMAX-Exchange/disruptor/releases&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/LMAX-Exchange/disruptor/releases&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Upgrading&#160;LMAX disrupter to 3.4.2 was in the log4j 2.11.1 release notes. We could also upgrade log4j2 2.11.0 -&amp;gt; 2.11.2.&lt;/p&gt;

&lt;p&gt;Not sure if these would help but probably wouldn&apos;t hurt either.&lt;/p&gt;</comment>
                            <comment id="16775738" author="risdenk" created="Sat, 23 Feb 2019 01:40:22 +0000"  >&lt;p&gt;Here is a failure from AdoptOpenJDK 11.0.2&lt;/p&gt;

&lt;p&gt;&lt;b&gt;TestInitParams&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestInitParams -Dtests.seed=466988C6E1830B46 -Dtests.slow=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.badapples=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.locale=yue-Hant -Dtests.timezone=America/Santo_Domingo -Dtests.asserts=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.file.encoding=US-ASCII
   [junit4] ERROR   0.00s J0 | TestInitParams (suite) &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: com.carrotsearch.randomizedtesting.ThreadLeakError: 1 thread leaked from SUITE scope at org.apache.solr.core.TestInitParams: 
   [junit4]    &amp;gt;    1) &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[id=35, name=Log4j2-TF-2-AsyncLoggerConfig--2, state=TIMED_WAITING, group=TGRP-TestInitParams]
   [junit4]    &amp;gt;         at java.base@11.0.2/jdk.internal.misc.Unsafe.park(Native Method)
   [junit4]    &amp;gt;         at java.base@11.0.2/java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:234)
   [junit4]    &amp;gt;         at java.base@11.0.2/java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2123)
   [junit4]    &amp;gt;         at app&lt;span class=&quot;code-comment&quot;&gt;//com.lmax.disruptor.TimeoutBlockingWaitStrategy.waitFor(TimeoutBlockingWaitStrategy.java:38)
&lt;/span&gt;   [junit4]    &amp;gt;         at app&lt;span class=&quot;code-comment&quot;&gt;//com.lmax.disruptor.ProcessingSequenceBarrier.waitFor(ProcessingSequenceBarrier.java:56)
&lt;/span&gt;   [junit4]    &amp;gt;         at app&lt;span class=&quot;code-comment&quot;&gt;//com.lmax.disruptor.BatchEventProcessor.run(BatchEventProcessor.java:128)
&lt;/span&gt;   [junit4]    &amp;gt;         at java.base@11.0.2/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:834)
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([466988C6E1830B46]:0)Throwable #2: com.carrotsearch.randomizedtesting.ThreadLeakError: There are still zombie threads that couldn&apos;t be terminated:
   [junit4]    &amp;gt;    1) &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[id=35, name=Log4j2-TF-2-AsyncLoggerConfig--2, state=TIMED_WAITING, group=TGRP-TestInitParams]
   [junit4]    &amp;gt;         at java.base@11.0.2/jdk.internal.misc.Unsafe.park(Native Method)
   [junit4]    &amp;gt;         at java.base@11.0.2/java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:234)
   [junit4]    &amp;gt;         at java.base@11.0.2/java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2123)
   [junit4]    &amp;gt;         at app&lt;span class=&quot;code-comment&quot;&gt;//com.lmax.disruptor.TimeoutBlockingWaitStrategy.waitFor(TimeoutBlockingWaitStrategy.java:38)
&lt;/span&gt;   [junit4]    &amp;gt;         at app&lt;span class=&quot;code-comment&quot;&gt;//com.lmax.disruptor.ProcessingSequenceBarrier.waitFor(ProcessingSequenceBarrier.java:56)
&lt;/span&gt;   [junit4]    &amp;gt;         at app&lt;span class=&quot;code-comment&quot;&gt;//com.lmax.disruptor.BatchEventProcessor.run(BatchEventProcessor.java:128)
&lt;/span&gt;   [junit4]    &amp;gt;         at java.base@11.0.2/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:834)
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([466988C6E1830B46]:0)
   [junit4] Completed [6/844 (1!)] on J0 in 21.23s, 7 tests, 2 errors &amp;lt;&amp;lt;&amp;lt; FAILURES!
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16775901" author="risdenk" created="Sat, 23 Feb 2019 14:27:23 +0000"  >&lt;p&gt;I was googling last night and came across&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1259&quot; title=&quot;Log4j threads are leaking on Tomcat shutdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1259&quot;&gt;LOG4J2-1259&lt;/a&gt;. Near the end it mentioned log4j-web. &lt;a href=&quot;https://logging.apache.org/log4j/2.0/manual/webapp.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://logging.apache.org/log4j/2.0/manual/webapp.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16775911" author="risdenk" created="Sat, 23 Feb 2019 15:00:29 +0000"  >&lt;p&gt;Created branch jira/solr-13268 and PR &lt;a href=&quot;https://github.com/apache/lucene-solr/pull/586&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/pull/586&lt;/a&gt;&#160;to try the changes I mentioned above.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Upgrade log4j2 from 2.11.0 to 2.11.2&lt;/li&gt;
	&lt;li&gt;Upgrade lmax from 3.4.0 to 3.4.2&lt;/li&gt;
	&lt;li&gt;Add log4j-web dependency based on &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1259&quot; title=&quot;Log4j threads are leaking on Tomcat shutdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1259&quot;&gt;LOG4J2-1259&lt;/a&gt; and &lt;a href=&quot;https://logging.apache.org/log4j/2.0/manual/webapp.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://logging.apache.org/log4j/2.0/manual/webapp.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16775946" author="erickerickson" created="Sat, 23 Feb 2019 17:12:52 +0000"  >&lt;p&gt;At the last minute I put the conditional in StartupLoggingUtils.shutdown because precommit failed with &quot;forbidden api&quot; and I copied other similar patterns specific to log4j2. I wondered if we weren&apos;t calling shutdown for some reason, but apparently we are.&lt;/p&gt;

&lt;p&gt;I checked, and the warning message that would print if we weren&apos;t running log4j2 is &lt;em&gt;NOT&lt;/em&gt; in the log, so apparently we are calling the log4j shutdown.&lt;/p&gt;

&lt;p&gt;Upgrading to the latest certainly seems like A Good Thing. Since I can&apos;t get tests to fail (beasted 1,000 times) it seems like we&apos;ll have to push the changes up. I&apos;ll pull down your changes and run the test suites and if all that works do you want to push it or shall I?&lt;/p&gt;

&lt;p&gt;And thanks a million for helping here...&lt;/p&gt;</comment>
                            <comment id="16776077" author="erickerickson" created="Sun, 24 Feb 2019 00:15:18 +0000"  >&lt;p&gt;A full test suite passes, but I&apos;m getting a precommit failure that there&apos;s no license for log4j-web-LICENSE...... Is this just a copy of the standard Apache license from &lt;a href=&quot;https://logging.apache.org/log4j/2.0/license.html?&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://logging.apache.org/log4j/2.0/license.html?&lt;/a&gt; If so I&apos;ll put this in and push this all sometime tonight...&lt;/p&gt;

&lt;p&gt;NM, found them right where they should be at the top level of the source tree.&lt;/p&gt;</comment>
                            <comment id="16776078" author="risdenk" created="Sun, 24 Feb 2019 00:17:27 +0000"  >&lt;p&gt;Yea it should be the standard log4j license/notice.&lt;/p&gt;

&lt;p&gt;I haven&apos;t seen any log4j thread leaks on JDK 8 in ~15 runs. I saw two log4j thread leak failures out of 12 runs so far for JDK 11.&lt;/p&gt;</comment>
                            <comment id="16776122" author="erickerickson" created="Sun, 24 Feb 2019 05:13:52 +0000"  >&lt;p&gt;I&apos;m experimenting with whether my shutdown in StartupLoggingUtils is necessary in jdk8 with these upgrades, mostly out of curiosity. I&apos;m not going to be able to push anything tonight, maybe tomorrow morning.....&lt;/p&gt;</comment>
                            <comment id="16776297" author="erickerickson" created="Sun, 24 Feb 2019 15:40:43 +0000"  >&lt;p&gt;I got a clean test run with the shutdown in StartupLoggingUtils commented completely out. Although that&apos;s weird enough that I&apos;ll double check it in a bit.&lt;/p&gt;

&lt;p&gt;So assuming precommit passes and I really did comment the shutdown bit out, I&apos;ll put up a patch and push the code this morning.&lt;/p&gt;

&lt;p&gt;Let&apos;s assume all that works and Kevin&apos;s changes fix up the leaks. WDYT about &lt;/p&gt;

&lt;p&gt;1&amp;gt; rolling back all the test cases where I changed the superclass from LuceneTestCase to SolrTestCaseJ4? Is there any reason to?&lt;/p&gt;

&lt;p&gt;2&amp;gt; rolling back the changes to StartupLoggingUtils?&lt;/p&gt;

&lt;p&gt;I&apos;ll do both unless there are objections, the additions to StartupLoggingUtils in particular is cruft.&lt;/p&gt;

&lt;p&gt;All bets are off of course if we still have problems, I&apos;ll un-comment the shutdown in StartupLoggingUtils in tat case and we&apos;ll see.&lt;/p&gt;

&lt;p&gt;Wish I could get this stuff to fail locally. I beasted 1,000 times with a bunch 12 in parallel and no failures.&lt;/p&gt;</comment>
                            <comment id="16776329" author="erickerickson" created="Sun, 24 Feb 2019 17:49:01 +0000"  >&lt;p&gt;Patch with Kevin&apos;s updates, precommit and all tests pass. This has the shutdown in StartupLoggingUtils commented out as it appears unnecessary.&lt;/p&gt;

&lt;p&gt;I&apos;m going to push this momentarily to see what the effects are on various test servers as I can&apos;t seem to make the leak happen locally.&lt;/p&gt;

&lt;p&gt;I&apos;m traveling until the afternoon, so if this does horrible things anyone who cares to should feel free to revert.&lt;/p&gt;</comment>
                            <comment id="16776335" author="jira-bot" created="Sun, 24 Feb 2019 18:05:22 +0000"  >&lt;p&gt;Commit fe5a96a284cf2f75b25114c20299d5bb4de843a3 in lucene-solr&apos;s branch refs/heads/master from erick&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=fe5a96a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=fe5a96a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13268&quot; title=&quot;Clean up any test failures resulting from defaulting to async logging&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13268&quot;&gt;&lt;del&gt;SOLR-13268&lt;/del&gt;&lt;/a&gt;: Clean up any test failures resulting from &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12055&quot; title=&quot;Enable async logging by default&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12055&quot;&gt;&lt;del&gt;SOLR-12055&lt;/del&gt;&lt;/a&gt; (async logging). Kevin&apos;s upgrades&lt;/p&gt;</comment>
                            <comment id="16776343" author="jira-bot" created="Sun, 24 Feb 2019 18:24:58 +0000"  >&lt;p&gt;Commit a108b4f730c5404ec7f798fb9d01da1ff0587070 in lucene-solr&apos;s branch refs/heads/branch_8x from erick&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=a108b4f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=a108b4f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13268&quot; title=&quot;Clean up any test failures resulting from defaulting to async logging&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13268&quot;&gt;&lt;del&gt;SOLR-13268&lt;/del&gt;&lt;/a&gt;: Clean up any test failures resulting from &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12055&quot; title=&quot;Enable async logging by default&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12055&quot;&gt;&lt;del&gt;SOLR-12055&lt;/del&gt;&lt;/a&gt; (async logging). Kevin&apos;s upgrades&lt;/p&gt;

&lt;p&gt;(cherry picked from commit fe5a96a)&lt;/p&gt;</comment>
                            <comment id="16776363" author="risdenk" created="Sun, 24 Feb 2019 19:02:36 +0000"  >&lt;p&gt;On JDK 8 in ~30 runs - 1 failure due to Log4j thread leak&lt;br/&gt;
On JDK 11 in ~30 runs - 4 failures due to Log4j thread leak&lt;/p&gt;

&lt;p&gt;Much better than JDK 8/11 on Apache master branch which was failing almost every other run.&lt;/p&gt;</comment>
                            <comment id="16776960" author="risdenk" created="Mon, 25 Feb 2019 14:47:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt; - FYI been testing with the shutdown and test class changes removed in &lt;a href=&quot;https://github.com/apache/lucene-solr/pull/586&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/pull/586&lt;/a&gt;. Tests pass with the cleanup as well.&lt;/p&gt;</comment>
                            <comment id="16777006" author="erickerickson" created="Mon, 25 Feb 2019 15:33:56 +0000"  >&lt;p&gt;I&apos;m going to be busy today all day and won&apos;t have time to deal with. This is obviously vastly better, but I&apos;m not sure what to do next. &lt;/p&gt;

&lt;p&gt;This certainly feels like a problem in log4j2, but doesn&apos;t seem like it affects running solr in the normal case. Does it make sense to ignore it? We&apos;d need to keep it from failing tests and creating noise, not sure how to get the leak checker to ignore this one, I think there&apos;s a way.&lt;/p&gt;

&lt;p&gt;Or try turning the shutdown back on? That feels like pushing a random button and hoping it&apos;ll work.&lt;/p&gt;

&lt;p&gt;Or just give this up as a bad idea? Async logging should be an option, I&apos;m not sure I see any &lt;em&gt;practical&lt;/em&gt; (as opposed to a test issue) consequences. And certainly users can enable it on their own.&lt;/p&gt;

&lt;p&gt;Or leave the config for async logging commented out (the opposite of now). Not sure I like that one, but....&lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;</comment>
                            <comment id="16777135" author="risdenk" created="Mon, 25 Feb 2019 17:42:30 +0000"  >&lt;p&gt;So I would guess that Solr isn&apos;t doing something right when it comes to logging. I haven&apos;t dug in to the details of how Solr does logging. There have only been a few failures related to log4j threads after adding the log4j-web dependency. Maybe we can collect those failures and see if there is a common theme. I have a few of the failures collected on my local Jenkins server but haven&apos;t sat down to look at them. I probably won&apos;t for a few days.&lt;/p&gt;

&lt;p&gt;Either way, the failures have gone down significantly recently. I don&apos;t think ignoring the leaked threads is correct. I also don&apos;t think adding shutdown is correct since that didn&apos;t seem to help. Also not sure this is a bad idea. If Solr is starting/stopping logging correctly, then I doubt we would have issues like this. Maybe we only see these start/stop issues due to the async logging since that type of logging is more sensitive to specific start/stop handling.&lt;/p&gt;</comment>
                            <comment id="16777213" author="risdenk" created="Mon, 25 Feb 2019 19:05:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt; Here is a reproducing seed from Uwe&apos;s Jenkins. This reproduces for me locally as well.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://jenkins.thetaphi.de/job/Lucene-Solr-master-Linux/23720/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jenkins.thetaphi.de/job/Lucene-Solr-master-Linux/23720/&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=BufferStoreTest -Dtests.seed=3EF531368FC72D9F -Dtests.multiplier=3 -Dtests.slow=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.locale=sr-Latn-BA -Dtests.timezone=Africa/Bissau -Dtests.asserts=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.file.encoding=ISO-8859-1
   [junit4] ERROR   0.00s J1 | BufferStoreTest (suite) &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: com.carrotsearch.randomizedtesting.ThreadLeakError: 1 thread leaked from SUITE scope at org.apache.solr.store.blockcache.BufferStoreTest: 
   [junit4]    &amp;gt;    1) &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[id=14, name=Log4j2-TF-1-AsyncLoggerConfig-1, state=TIMED_WAITING, group=TGRP-BufferStoreTest]
   [junit4]    &amp;gt;         at sun.misc.Unsafe.park(Native Method)
   [junit4]    &amp;gt;         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    &amp;gt;         at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2078)
   [junit4]    &amp;gt;         at com.lmax.disruptor.TimeoutBlockingWaitStrategy.waitFor(TimeoutBlockingWaitStrategy.java:38)
   [junit4]    &amp;gt;         at com.lmax.disruptor.ProcessingSequenceBarrier.waitFor(ProcessingSequenceBarrier.java:56)
   [junit4]    &amp;gt;         at com.lmax.disruptor.BatchEventProcessor.processEvents(BatchEventProcessor.java:159)
   [junit4]    &amp;gt;         at com.lmax.disruptor.BatchEventProcessor.run(BatchEventProcessor.java:125)
   [junit4]    &amp;gt;         at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([3EF531368FC72D9F]:0)Throwable #2: com.carrotsearch.randomizedtesting.ThreadLeakError: There are still zombie threads that couldn&apos;t be terminated:
   [junit4]    &amp;gt;    1) &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[id=14, name=Log4j2-TF-1-AsyncLoggerConfig-1, state=TIMED_WAITING, group=TGRP-BufferStoreTest]
   [junit4]    &amp;gt;         at sun.misc.Unsafe.park(Native Method)
   [junit4]    &amp;gt;         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    &amp;gt;         at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2078)
   [junit4]    &amp;gt;         at com.lmax.disruptor.TimeoutBlockingWaitStrategy.waitFor(TimeoutBlockingWaitStrategy.java:38)
   [junit4]    &amp;gt;         at com.lmax.disruptor.ProcessingSequenceBarrier.waitFor(ProcessingSequenceBarrier.java:56)
   [junit4]    &amp;gt;         at com.lmax.disruptor.BatchEventProcessor.processEvents(BatchEventProcessor.java:159)
   [junit4]    &amp;gt;         at com.lmax.disruptor.BatchEventProcessor.run(BatchEventProcessor.java:125)
   [junit4]    &amp;gt;         at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([3EF531368FC72D9F]:0)
   [junit4] Completed [8/844 (1!)] on J1 in 24.65s, 1 test, 2 errors &amp;lt;&amp;lt;&amp;lt; FAILURES!
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16777225" author="risdenk" created="Mon, 25 Feb 2019 19:17:41 +0000"  >&lt;p&gt;Another reproducing seed:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/job/Lucene-Solr-BadApples-Tests-master/291&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Lucene-Solr-BadApples-Tests-master/291&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=IgnoreLargeDocumentProcessorFactoryTest -Dtests.seed=FFE5AB53EC0B3896 -Dtests.multiplier=2 -Dtests.slow=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.badapples=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.locale=es-MX -Dtests.timezone=Pacific/Majuro -Dtests.asserts=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.file.encoding=UTF-8
   [junit4] ERROR   0.00s J2 | IgnoreLargeDocumentProcessorFactoryTest (suite) &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: com.carrotsearch.randomizedtesting.ThreadLeakError: 1 thread leaked from SUITE scope at org.apache.solr.update.processor.IgnoreLargeDocumentProcessorFactoryTest: 
   [junit4]    &amp;gt;    1) &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[id=13, name=Log4j2-TF-1-AsyncLoggerConfig-1, state=TIMED_WAITING, group=TGRP-IgnoreLargeDocumentProcessorFactoryTest]
   [junit4]    &amp;gt;         at sun.misc.Unsafe.park(Native Method)
   [junit4]    &amp;gt;         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    &amp;gt;         at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2078)
   [junit4]    &amp;gt;         at com.lmax.disruptor.TimeoutBlockingWaitStrategy.waitFor(TimeoutBlockingWaitStrategy.java:38)
   [junit4]    &amp;gt;         at com.lmax.disruptor.ProcessingSequenceBarrier.waitFor(ProcessingSequenceBarrier.java:56)
   [junit4]    &amp;gt;         at com.lmax.disruptor.BatchEventProcessor.processEvents(BatchEventProcessor.java:159)
   [junit4]    &amp;gt;         at com.lmax.disruptor.BatchEventProcessor.run(BatchEventProcessor.java:125)
   [junit4]    &amp;gt;         at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([FFE5AB53EC0B3896]:0)Throwable #2: com.carrotsearch.randomizedtesting.ThreadLeakError: There are still zombie threads that couldn&apos;t be terminated:
   [junit4]    &amp;gt;    1) &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[id=13, name=Log4j2-TF-1-AsyncLoggerConfig-1, state=TIMED_WAITING, group=TGRP-IgnoreLargeDocumentProcessorFactoryTest]
   [junit4]    &amp;gt;         at sun.misc.Unsafe.park(Native Method)
   [junit4]    &amp;gt;         at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
   [junit4]    &amp;gt;         at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2078)
   [junit4]    &amp;gt;         at com.lmax.disruptor.TimeoutBlockingWaitStrategy.waitFor(TimeoutBlockingWaitStrategy.java:38)
   [junit4]    &amp;gt;         at com.lmax.disruptor.ProcessingSequenceBarrier.waitFor(ProcessingSequenceBarrier.java:56)
   [junit4]    &amp;gt;         at com.lmax.disruptor.BatchEventProcessor.processEvents(BatchEventProcessor.java:159)
   [junit4]    &amp;gt;         at com.lmax.disruptor.BatchEventProcessor.run(BatchEventProcessor.java:125)
   [junit4]    &amp;gt;         at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([FFE5AB53EC0B3896]:0)
   [junit4] Completed [1/844 (1!)] on J2 in 38.09s, 4 tests, 2 errors &amp;lt;&amp;lt;&amp;lt; FAILURES!
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16777283" author="erickerickson" created="Mon, 25 Feb 2019 21:01:09 +0000"  >&lt;p&gt;Cool, reproduces for me too. I won&apos;t be able to look at this at least for the rest of the day. &lt;/p&gt;

&lt;p&gt;The shutdown bits changed some tests from always failing to passing, but I suspect that it was just masking a problem. Especially since the tests pass with that bit commented out. So I&apos;ll probably back those all out...&lt;/p&gt;</comment>
                            <comment id="16777383" author="risdenk" created="Mon, 25 Feb 2019 23:18:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt; so I played around with this a bit and I don&apos;t understand what I am seeing...&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;BufferStoreTest reproduces with the above seed&lt;/li&gt;
	&lt;li&gt;BufferStoreTest changed to extend&#160;SolrTestCaseJ4 - test passes&lt;/li&gt;
	&lt;li&gt;So I played around with&#160;SolrTestCaseJ4
	&lt;ul&gt;
		&lt;li&gt;If you comment out the entire file - seed fails (as expected)&lt;/li&gt;
		&lt;li&gt;Comment out EVERYTHING except for
		&lt;ul&gt;
			&lt;li&gt;private static final Logger log = LoggerFactory.getLogger(MethodHandles.lookup().lookupClass());&lt;/li&gt;
			&lt;li&gt;Test passes&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;Revert changes and make only the following change to BufferStoreTest:
	&lt;ul&gt;
		&lt;li&gt;Add &quot;private static final Logger log = LoggerFactory.getLogger(MethodHandles.lookup().lookupClass());&quot;&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So basically if there is a LoggerFactory.getLogger, the test passes. Otherwise there is an issue with thread hanging. I checked&#160;IgnoreLargeDocumentProcessorFactoryTest, and it doesn&apos;t extend SolrTestCaseJ4 and doesn&apos;t call LoggerFactory.&#160;&lt;/p&gt;

&lt;p&gt;I don&apos;t think adding &quot;private static final Logger log = LoggerFactory.getLogger(MethodHandles.lookup().lookupClass());&quot; to tests is the correct answer but it definitely is an interesting finding.&lt;/p&gt;</comment>
                            <comment id="16777391" author="risdenk" created="Mon, 25 Feb 2019 23:24:13 +0000"  >&lt;p&gt;My guess is the only way this reproduces is if the FIRST test in the test JVM, doesn&apos;t have &quot;LoggerFactory.getLogger(&quot;, then there will be a failure. All the failures I&apos;ve seen lately have been very early in the test runs.&#160;&lt;/p&gt;</comment>
                            <comment id="16777613" author="erickerickson" created="Tue, 26 Feb 2019 05:59:53 +0000"  >&lt;p&gt;Hmmm, SolrTestCaseJ4 has a LoggerFactory.getLogger in it. If the first test case extends SolrTestCaseJ4 rather than LuceneTestCase, then that would be consistent with your theory.&lt;/p&gt;

&lt;p&gt;So maybe my initial fixes where I added the shutdown to SolrTestCaseJ4 then extended from SolrTestCaseJ4 rather than LuceneTestCase was coincidental and that extending that class &lt;em&gt;also&lt;/em&gt; defined a logger which was the thing that actually made the difference.&lt;/p&gt;

&lt;p&gt;Making all Solr test cases extend SolrTestCaseJ4 seems overkill, but perhaps there&apos;s something we could add to LuceneTestCase? I&apos;m thinking that the shutdown process would be sensitive to a logger being defined (or not). But I admit I have no idea &lt;em&gt;how&lt;/em&gt; to make that happen.&lt;/p&gt;

&lt;p&gt;But that would give the Lucene devs heartburn, Lucene doesn&apos;t use logging. Hmmmm2. Is it really that onerous to require that test cases extend SolrTestCaseJ4 rather than LuceneTestCase?&lt;/p&gt;</comment>
                            <comment id="16777620" author="erickerickson" created="Tue, 26 Feb 2019 06:07:23 +0000"  >&lt;p&gt;Hmmmm2. On a very quick look at failing tests, every one of them extends LuceneTestCase. I admit I only looked at 4-5 recent failures, but still intriguing.&lt;/p&gt;

&lt;p&gt;Still, requiring that Solr tests derive from SolrTestCaseJ4 due to a poorly understood issue with log4j smells, really badly...&lt;/p&gt;

&lt;p&gt;It does seem like a fat clue though.&lt;/p&gt;</comment>
                            <comment id="16777828" author="risdenk" created="Tue, 26 Feb 2019 11:17:44 +0000"  >&lt;p&gt;I have no idea what is going on after thinking about this a lot last night.&lt;/p&gt;

&lt;p&gt;Another way I was able to get the BufferStoreTest to pass is to add&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@AfterClass
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void shutdownLogManager() {
  LogManager.shutdown();
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Which as you would expect shuts down the LogManager cleanly. So extending SolrTestCaseJ4 with the shutdown method should work too.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Is it really that onerous to require that test cases extend SolrTestCaseJ4 rather than LuceneTestCase?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I don&apos;t really see a downside to this. If the tests are in the Solr packages makes sense for them to extend the SolrTestCaseJ4...&lt;/p&gt;</comment>
                            <comment id="16777947" author="risdenk" created="Tue, 26 Feb 2019 14:14:13 +0000"  >&lt;p&gt;I guess the biggest question I have currently is how is the LogManager getting shutdown in the synchronous case? I don&apos;t see any LogManager.shutdown() calls and yet everything behaves properly. Maybe only the async case spins up background threads and thats why the shutdown has to be handled correctly?&lt;/p&gt;</comment>
                            <comment id="16777954" author="risdenk" created="Tue, 26 Feb 2019 14:17:09 +0000"  >&lt;p&gt;Another reproducing seed&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://jenkins.thetaphi.de/job/Lucene-Solr-8.x-Solaris/51&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jenkins.thetaphi.de/job/Lucene-Solr-8.x-Solaris/51&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[junit4] 2&amp;gt; NOTE: reproduce with: ant test -Dtestcase=TestSolrCoreParser -Dtests.seed=1385A6FD46415A7F -Dtests.slow=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.badapples=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.locale=mk-MK -Dtests.timezone=Etc/GMT+10 -Dtests.asserts=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtests.file.encoding=ISO-8859-1
[junit4] ERROR 0.00s | TestSolrCoreParser (suite) &amp;lt;&amp;lt;&amp;lt;
[junit4] &amp;gt; Throwable #1: com.carrotsearch.randomizedtesting.ThreadLeakError: 1 thread leaked from SUITE scope at org.apache.solr.search.TestSolrCoreParser:
[junit4] &amp;gt; 1) &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[id=14, name=Log4j2-TF-1-AsyncLoggerConfig-1, state=TIMED_WAITING, group=TGRP-TestSolrCoreParser]
[junit4] &amp;gt; at sun.misc.Unsafe.park(Native Method)
[junit4] &amp;gt; at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
[junit4] &amp;gt; at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2078)
[junit4] &amp;gt; at com.lmax.disruptor.TimeoutBlockingWaitStrategy.waitFor(TimeoutBlockingWaitStrategy.java:38)
[junit4] &amp;gt; at com.lmax.disruptor.ProcessingSequenceBarrier.waitFor(ProcessingSequenceBarrier.java:56)
[junit4] &amp;gt; at com.lmax.disruptor.BatchEventProcessor.processEvents(BatchEventProcessor.java:159)
[junit4] &amp;gt; at com.lmax.disruptor.BatchEventProcessor.run(BatchEventProcessor.java:125)
[junit4] &amp;gt; at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
[junit4] &amp;gt; at __randomizedtesting.SeedInfo.seed([1385A6FD46415A7F]:0)Throwable #2: com.carrotsearch.randomizedtesting.ThreadLeakError: There are still zombie threads that couldn&apos;t be terminated:
[junit4] &amp;gt; 1) &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[id=14, name=Log4j2-TF-1-AsyncLoggerConfig-1, state=TIMED_WAITING, group=TGRP-TestSolrCoreParser]
[junit4] &amp;gt; at sun.misc.Unsafe.park(Native Method)
[junit4] &amp;gt; at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
[junit4] &amp;gt; at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2078)
[junit4] &amp;gt; at com.lmax.disruptor.TimeoutBlockingWaitStrategy.waitFor(TimeoutBlockingWaitStrategy.java:38)
[junit4] &amp;gt; at com.lmax.disruptor.ProcessingSequenceBarrier.waitFor(ProcessingSequenceBarrier.java:56)
[junit4] &amp;gt; at com.lmax.disruptor.BatchEventProcessor.processEvents(BatchEventProcessor.java:159)
[junit4] &amp;gt; at com.lmax.disruptor.BatchEventProcessor.run(BatchEventProcessor.java:125)
[junit4] &amp;gt; at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
[junit4] &amp;gt; at __randomizedtesting.SeedInfo.seed([1385A6FD46415A7F]:0)
[junit4] Completed [1/1 (1!)] in 26.39s, 6 tests, 2 errors &amp;lt;&amp;lt;&amp;lt; FAILURES!
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16778221" author="erickerickson" created="Tue, 26 Feb 2019 17:24:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;Maybe only the async case spins up background threads and thats why the shutdown has to be handled correctly?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s certainly my guess. I&apos;ll see if I can trace through this with synchronous logging. In the synchronous case I suspect it&apos;s a no-op, but I&apos;ll check.&lt;/p&gt;

&lt;p&gt;And the reproducing seed is a test case that derives from..... LuceneTestCase.&lt;/p&gt;

&lt;p&gt;So if we do the @AfterClass thing, we can either&lt;br/&gt;
1&amp;gt; blanket-replace all the &quot;extends LuceneTestCase&quot; to &quot;extends SolrTestCaseJ4&quot;&lt;br/&gt;
or&lt;br/&gt;
2&amp;gt; play whack-a-mole for any of these that we see. Which is yucky.&lt;br/&gt;
or&lt;br/&gt;
3&amp;gt; run the tests with synchronous logging, which I also think is yucky. &lt;/p&gt;

&lt;p&gt;If we do something like &amp;lt;1&amp;gt;, I&apos;d like to have it become a precommit failure if possible to keep it from creeping back.&lt;/p&gt;

&lt;p&gt;I suppose in any extreme cases we can &quot;somehow&quot; allow a test case to subclass LuceneTestCase, but I can&apos;t think of a good reason offhand.&lt;/p&gt;</comment>
                            <comment id="16778225" author="risdenk" created="Tue, 26 Feb 2019 17:29:55 +0000"  >&lt;p&gt;Yea so I think #1 is a decent approach. Also having a precommit failure to keep it from coming back would be good. Maybe&#160;./lucene/tools/src/groovy/check-source-patterns.groovy since I know there are existing checks for logger patterns in there and a check for mockito on tests around like 170.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;FWIW I think this is only a test problem like you had said previously. Since I think tests are the only place the JVM is not shutdown between usage of the LogManager.&lt;/p&gt;</comment>
                            <comment id="16778236" author="erickerickson" created="Tue, 26 Feb 2019 17:45:11 +0000"  >&lt;p&gt;I just did a quick scan and there are about 150 tests that are part of Solr that subclass LuceneTestCase.&lt;/p&gt;

&lt;p&gt;Just to give a dimension to the problem.... On the one hand that&apos;s a lot of files and the process is &lt;em&gt;very&lt;/em&gt; mechanical.&lt;/p&gt;

&lt;p&gt;On the other hand, that&apos;s a lot of files that could change how the tests run and have &quot;stuff&quot; pop out.&lt;/p&gt;

&lt;p&gt;On the other other hand, I wonder if proper shutdown in general (and I&apos;m grasping at straws) might account for some other test failures to leaked objects. Doubtful, but I can always hope.&lt;/p&gt;

&lt;p&gt;I do want to look at the reproducing seeds and see if I can understand &lt;em&gt;why&lt;/em&gt; there&apos;s a need to shutdown. Some of the tests do not invoke a LogManager of any sort. Hmmm, I suppose if any class that sets up up a logger that runs as part of a test could account for it.&lt;/p&gt;</comment>
                            <comment id="16778244" author="risdenk" created="Tue, 26 Feb 2019 17:47:53 +0000"  >&lt;p&gt;So the one thing I can&apos;t account for is that ADDING&#160;&quot;private static final Logger log = LoggerFactory.getLogger(MethodHandles.lookup().lookupClass());&quot; to&#160;BufferStoreTest with no shutdown code, makes the test pass. I don&apos;t understand how that is possible that adding a new logger would result in shutdown happening properly.&lt;/p&gt;</comment>
                            <comment id="16779449" author="erickerickson" created="Wed, 27 Feb 2019 15:48:22 +0000"  >&lt;p&gt;I haven&apos;t seen any failures in the last day, however the seeds still reproduce.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krisden&quot; class=&quot;user-hover&quot; rel=&quot;krisden&quot;&gt;krisden&lt;/a&gt; I&apos;ve been fiddling around with my mail filters, so wanted to check if you&apos;ve seen any errors reported. I see other test errors so I&apos;m guessing it&apos;s just luck but wanted to check.&lt;/p&gt;</comment>
                            <comment id="16779452" author="risdenk" created="Wed, 27 Feb 2019 15:50:20 +0000"  >&lt;p&gt;I haven&apos;t seen any failures recently either on the public Jenkins servers. I&apos;ve still seen a few failures locally based on the master branch.&lt;/p&gt;</comment>
                            <comment id="16779834" author="erickerickson" created="Wed, 27 Feb 2019 22:31:47 +0000"  >&lt;p&gt;Just saw one from Jenkins, so it&apos;s still there. I can still work with the seeds that reliably fail of course.&lt;/p&gt;</comment>
                            <comment id="16780819" author="erickerickson" created="Thu, 28 Feb 2019 18:35:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krisden&quot; class=&quot;user-hover&quot; rel=&quot;krisden&quot;&gt;krisden&lt;/a&gt;. About to hop on a plane, I&apos;ll be looking at this some more.&lt;/p&gt;

&lt;p&gt;About just adding a logger to BufferStoreTest and having it work. That makes me wonder if the key to having tests succeed if they subclass SolrTestCaseJ4 is just because &lt;em&gt;that&lt;/em&gt; class instantiates a logger. Oh my.&lt;/p&gt;

&lt;p&gt;Perhaps unsurprisingly, creating a class that does &lt;em&gt;nothing&lt;/em&gt; except subclass LuceneTestCase and has a logger declaration causes BufferStoreTest to succeed.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;BogusClass &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; LuceneTestCase {

  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Logger log = LoggerFactory.getLogger(MethodHandles.lookup().lookupClass());
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now I&apos;m wondering if there&apos;s some weirdness with the slf4j....&lt;/p&gt;</comment>
                            <comment id="16780836" author="erickerickson" created="Thu, 28 Feb 2019 18:54:55 +0000"  >&lt;p&gt;FWIW, I can get BufferStoreTest to fail almost all the time, with or without the seed. I&apos;ve cleaned my ivy cache on the off chance there&apos;s something weird there and verifying. So it&apos;s apparently not something peculiar to the seed or randomization.&lt;/p&gt;</comment>
                            <comment id="16780891" author="risdenk" created="Thu, 28 Feb 2019 20:39:40 +0000"  >&lt;p&gt;So I know its not JUST adding the log line. If you add the LogManager shutdown (and not the log line) you can also get the test to pass.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I would guess that any test that uses logging and extends LuceneTestCase, will fail if you run just that test. Since it will be the only test that runs in the JVM and will fail to cleanup the LogManager.&lt;/p&gt;</comment>
                            <comment id="16781951" author="erickerickson" created="Fri, 1 Mar 2019 18:11:56 +0000"  >&lt;p&gt;BTW, I spent much of the flight yesterday (it was only an hour) chasing down framework assertions like &quot;tests.assert must be one of true|false enabled|disabled....&quot;. Turns out that somehow when I copy/pasted, there was a high-ascii byte &apos;c2&apos; after &quot;-Dtests.assert&quot; that was invisible that I was only able to see in a hex editor... About drove me nuts.&lt;/p&gt;</comment>
                            <comment id="16782736" author="mkhludnev" created="Sun, 3 Mar 2019 13:57:06 +0000"  >&lt;p&gt;I don&apos;t follow the topic, just evidence suspicious failure &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/325/artifact/out/patch-unit-solr_core.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/325/artifact/out/patch-unit-solr_core.txt&lt;/a&gt; &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt; ERROR   0.00s J0 | TestFacetMethods (suite) &amp;lt;&amp;lt;&amp;lt;&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;    &amp;gt; Throwable #1: com.carrotsearch.randomizedtesting.ThreadLeakError: 1 thread leaked from SUITE scope at org.apache.solr.request.TestFacetMethods: &lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;    &amp;gt;    1) Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;id=13, name=Log4j2-TF-1-AsyncLoggerConfig-1, state=TIMED_WAITING, group=TGRP-TestFacetMethods&amp;#93;&lt;/span&gt;&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;    &amp;gt;         at sun.misc.Unsafe.park(Native Method)&lt;/p&gt;
&lt;/blockquote&gt;</comment>
                            <comment id="16782771" author="erickerickson" created="Sun, 3 Mar 2019 16:27:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mkhludnev&quot; class=&quot;user-hover&quot; rel=&quot;mkhludnev&quot;&gt;mkhludnev&lt;/a&gt; Yeah, that&apos;s the same gremlin, the &quot;smoking gun&quot; is &quot;at com.lmax.disruptor&quot;. I should have a patch later today that I think addresses all of these, the question will be whether it&apos;s the right approach.&lt;/p&gt;</comment>
                            <comment id="16785763" author="erickerickson" created="Wed, 6 Mar 2019 15:40:41 +0000"  >&lt;p&gt;OK, 2 days later rather than &quot;later today&quot;.&lt;/p&gt;

&lt;p&gt;I&apos;ve been uncomfortable with bringing in the added cruft from SolrTestCaseJ4 to 150+ Solr test cases for two reasons:&lt;/p&gt;

&lt;p&gt;1&amp;gt; it seems like it might add to the test run length (although on a couple of quick tests this seems lost in the noise).&lt;/p&gt;

&lt;p&gt;2&amp;gt; The additional setup etc. in SolrTestCaseJ4 may affect tests. There&apos;s already one test for which this is true, there may be others over time.&lt;/p&gt;

&lt;p&gt;So I&apos;m thinking about a new class subclassing LuceneTestCase whose only function is to call the shutdown hook and calling &lt;em&gt;that&lt;/em&gt; from both SolrTestCaseJ4 and the tests that currently subclass LuceneTestCase. Comments?&lt;/p&gt;</comment>
                            <comment id="16785770" author="risdenk" created="Wed, 6 Mar 2019 15:44:44 +0000"  >&lt;p&gt;My rough two cents are, we should have a base class that all Solr tests extend from. That should allow for cleanup like this and to standardize the environment that Solr tests run in.&lt;/p&gt;

&lt;p&gt;I think if there is a class that extends LuceneTestCase (lets say SolrTestCase) it could have a AfterClass or After method that automatically shuts down the logger. Should not need to call it anywhere else. SolrTestCaseJ4 could extend SolrTestCase and it would get the shutdown for free?&lt;/p&gt;</comment>
                            <comment id="16786387" author="erickerickson" created="Thu, 7 Mar 2019 05:07:18 +0000"  >&lt;p&gt;This is a &lt;em&gt;lot&lt;/em&gt; of mechanical changes. The important bits are:&lt;/p&gt;

&lt;p&gt;1&amp;gt; new class SolrTestCase that extends LuceneTestCase and includes a logger shutdown call in @AfterClass&lt;/p&gt;

&lt;p&gt;2&amp;gt; precommit task that fails any file except&#160;SolrTestCase that extends LuceneTestCase&lt;/p&gt;

&lt;p&gt;I&apos;m beating this up with some full test over the next day or two and will commit (probably) this weekend unless there are objections.&lt;/p&gt;</comment>
                            <comment id="16787611" author="lucenesolrqa" created="Fri, 8 Mar 2019 07:05:31 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/check.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;b&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;&lt;/b&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Vote &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Runtime &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Comment &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Prechecks &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; test4tests &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  0m  0s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; The patch appears to include 160 new or modified test files. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; master Compile Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; compile &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  2m 30s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; master passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Patch Compile Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; compile &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  2m 21s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; javac &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  2m 21s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Release audit (RAT) &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  0m 24s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Check forbidden APIs &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  0m  3s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Validate source patterns &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  0m  3s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Other Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; unit &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  0m  7s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; tools in the patch passed. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; unit &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m 15s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; ltr in the patch passed. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; unit &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; 42m 18s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; core in the patch passed. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; unit &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  5m 41s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; solrj in the patch passed. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; unit &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  0m 25s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; test-framework in the patch passed. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt;&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt; &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt; 58m 57s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt; &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Report/Notes &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Issue &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13268&quot; title=&quot;Clean up any test failures resulting from defaulting to async logging&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13268&quot;&gt;&lt;del&gt;SOLR-13268&lt;/del&gt;&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Patch URL &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12961499/SOLR-13268.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12961499/SOLR-13268.patch&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Optional Tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  ratsources  validatesourcepatterns  compile  javac  unit  checkforbiddenapis  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; uname &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Linux lucene1-us-west 4.4.0-137-generic #163~14.04.1-Ubuntu SMP Mon Sep 24 17:14:57 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Build tool &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; ant &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Personality &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; /home/jenkins/jenkins-slave/workspace/PreCommit-SOLR-Build/sourcedir/dev-tools/test-patch/lucene-solr-yetus-personality.sh &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; git revision &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; master / 20de3d2 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; ant &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; version: Apache Ant(TM) version 1.9.3 compiled on July 24 2018 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Default Java &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 1.8.0_191 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  Test Results &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/330/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/330/testReport/&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; modules &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; C: lucene/tools solr/contrib/ltr solr/core solr/solrj solr/test-framework U: . &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Console output &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/330/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/330/console&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Powered by &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Apache Yetus 0.7.0   &lt;a href=&quot;http://yetus.apache.org&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://yetus.apache.org&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;p&gt;This message was automatically generated.&lt;/p&gt;
</comment>
                            <comment id="16788145" author="erickerickson" created="Fri, 8 Mar 2019 18:19:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke&quot; class=&quot;user-hover&quot; rel=&quot;cpoerschke&quot;&gt;cpoerschke&lt;/a&gt; Can you hop in the way back machine and take a look at&#160; TestXmlQParser?&#160;It was created as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-830&quot; title=&quot;snappuller picks bad snapshot name&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-830&quot;&gt;&lt;del&gt;SOLR-830&lt;/del&gt;&lt;/a&gt; according to Git and my questions are:&lt;/p&gt;

&lt;p&gt;1&amp;gt; does it really do anything? Looks like a stub.&lt;/p&gt;

&lt;p&gt;2&amp;gt; Can I remove it?&lt;/p&gt;

&lt;p&gt;3&amp;gt; If not &amp;lt;2&amp;gt;, does it belong in Solr tests or Lucene tests? AFAIK, it doesn&apos;t look like it was intended to do anything solr-ish.&lt;/p&gt;

&lt;p&gt;It relates to this JIRA, I have a reproducible seed on this test class. I can fix it without too much trouble, but when I looked at this I wondered if it shouldn&apos;t just be removed.&lt;/p&gt;</comment>
                            <comment id="16788999" author="erickerickson" created="Sun, 10 Mar 2019 18:04:44 +0000"  >&lt;p&gt;Final patch. I&apos;ll keep this open for a while.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke&quot; class=&quot;user-hover&quot; rel=&quot;cpoerschke&quot;&gt;cpoerschke&lt;/a&gt; I went ahead and removed TestXmlQParser, let me know if we need to add it back.&lt;/p&gt;</comment>
                            <comment id="16789000" author="jira-bot" created="Sun, 10 Mar 2019 18:05:11 +0000"  >&lt;p&gt;Commit 9272c295392a6e95394655b7abec8d75518c19d4 in lucene-solr&apos;s branch refs/heads/master from erick&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=9272c29&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=9272c29&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13268&quot; title=&quot;Clean up any test failures resulting from defaulting to async logging&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13268&quot;&gt;&lt;del&gt;SOLR-13268&lt;/del&gt;&lt;/a&gt;: Clean up any test failures resulting from defaulting to async logging&lt;/p&gt;</comment>
                            <comment id="16789006" author="jira-bot" created="Sun, 10 Mar 2019 18:51:25 +0000"  >&lt;p&gt;Commit 277251c20297ece755267f9bf70013b563854bb9 in lucene-solr&apos;s branch refs/heads/branch_8x from erick&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=277251c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=277251c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13268&quot; title=&quot;Clean up any test failures resulting from defaulting to async logging&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13268&quot;&gt;&lt;del&gt;SOLR-13268&lt;/del&gt;&lt;/a&gt;: Clean up any test failures resulting from defaulting to async logging&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 9272c29)&lt;/p&gt;</comment>
                            <comment id="16789179" author="lucenesolrqa" created="Mon, 11 Mar 2019 05:44:08 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;b&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;&lt;/b&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Vote &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Runtime &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Comment &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt; patch &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt;  0m  6s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13268&quot; title=&quot;Clean up any test failures resulting from defaulting to async logging&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13268&quot;&gt;&lt;del&gt;SOLR-13268&lt;/del&gt;&lt;/a&gt; does not apply to master. Rebase required? Wrong Branch? See &lt;a href=&quot;https://wiki.apache.org/solr/HowToContribute#Creating_the_patch_file&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://wiki.apache.org/solr/HowToContribute#Creating_the_patch_file&lt;/a&gt; for help. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Report/Notes &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Issue &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13268&quot; title=&quot;Clean up any test failures resulting from defaulting to async logging&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13268&quot;&gt;&lt;del&gt;SOLR-13268&lt;/del&gt;&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Patch URL &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12961869/SOLR-13268.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12961869/SOLR-13268.patch&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Console output &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/333/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/333/console&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Powered by &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Apache Yetus 0.7.0   &lt;a href=&quot;http://yetus.apache.org&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://yetus.apache.org&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;p&gt;This message was automatically generated.&lt;/p&gt;
</comment>
                            <comment id="16789828" author="jira-bot" created="Mon, 11 Mar 2019 18:03:39 +0000"  >&lt;p&gt;Commit 3a1603dab349fa828217fe1146e73c6a5f1a4fcf in lucene-solr&apos;s branch refs/heads/master from Erick Erickson&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=3a1603d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=3a1603d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13268&quot; title=&quot;Clean up any test failures resulting from defaulting to async logging&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13268&quot;&gt;&lt;del&gt;SOLR-13268&lt;/del&gt;&lt;/a&gt;: Clean up any test failures resulting from defaulting to async logging. Fix precommit test to not include the baseDir&lt;/p&gt;</comment>
                            <comment id="16789831" author="jira-bot" created="Mon, 11 Mar 2019 18:08:12 +0000"  >&lt;p&gt;Commit 132f5433103a121d400f071c5739a9af318f4807 in lucene-solr&apos;s branch refs/heads/branch_8x from Erick Erickson&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=132f543&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=132f543&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13268&quot; title=&quot;Clean up any test failures resulting from defaulting to async logging&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13268&quot;&gt;&lt;del&gt;SOLR-13268&lt;/del&gt;&lt;/a&gt;: Clean up any test failures resulting from defaulting to async logging. Fix precommit test to not include the baseDir&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 3a1603dab349fa828217fe1146e73c6a5f1a4fcf)&lt;/p&gt;</comment>
                            <comment id="16789860" author="cpoerschke" created="Mon, 11 Mar 2019 18:46:07 +0000"  >&lt;blockquote&gt;&lt;p&gt;... hop in the way back machine and take a look at TestXmlQParser? ... does it really do anything? Looks like a stub. ...&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt;! TestXmlQParser &#8211; that&apos;s a trip down memory lane indeed.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Yes, at first glance it looks like the test is just a stub.&lt;/li&gt;
	&lt;li&gt;On second look though (and this could have been made clearer e.g. with class level javadocs) the TestXmlQParser test extends the TestCoreParser test by overriding the &lt;tt&gt;coreParser()&lt;/tt&gt; method to return a &lt;tt&gt;SolrCoreParser&lt;/tt&gt; instead of a &lt;tt&gt;CoreParser&lt;/tt&gt; parser. The test also inherits all the parent class&apos;s tests and thus basically tests that whatever behaviour was present in the &lt;tt&gt;CoreParser&lt;/tt&gt; that same behaviour is also and still available via the &lt;tt&gt;SolrCoreParser&lt;/tt&gt; then.&lt;/li&gt;
&lt;/ul&gt;


&lt;blockquote&gt;&lt;p&gt;... It relates to this JIRA, I have a reproducible seed on this test class. I can fix it without too much trouble, but when I looked at this I wondered if it shouldn&apos;t just be removed.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Could you share details of what the reproducible failure is? I&apos;d be curious what it is. And yeah if it&apos;s not too much trouble to fix then it likely would be worthwhile fixing IMHO.&lt;/p&gt;</comment>
                            <comment id="16789924" author="erickerickson" created="Mon, 11 Mar 2019 20:17:22 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke&quot; class=&quot;user-hover&quot; rel=&quot;cpoerschke&quot;&gt;cpoerschke&lt;/a&gt;. I&apos;ll put that test back then, I took it out over the weekend &quot;on spec&quot;, but it&apos;s not a problem to put it back.&#160;&lt;/p&gt;

&lt;p&gt;The reproducible seed is probably uninteresting to you, it&apos;s about a leaked lmax.disruptor thread that is part of the switch to async logging, so nothing to do really with the test. And besides, I&apos;ve lost it....&lt;/p&gt;</comment>
                            <comment id="16790225" author="jira-bot" created="Tue, 12 Mar 2019 04:40:32 +0000"  >&lt;p&gt;Commit b893548d97f8b04b40dfbebd79bd860603b92c63 in lucene-solr&apos;s branch refs/heads/master from Erick Erickson&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=b893548&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=b893548&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13268&quot; title=&quot;Clean up any test failures resulting from defaulting to async logging&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13268&quot;&gt;&lt;del&gt;SOLR-13268&lt;/del&gt;&lt;/a&gt;: Clean up any test failures resulting from defaulting to async logging. Put TestXmlQParser back&lt;/p&gt;</comment>
                            <comment id="16790230" author="jira-bot" created="Tue, 12 Mar 2019 04:59:42 +0000"  >&lt;p&gt;Commit a87ba09e11a9bce4e5d97e3f713afe261112efc5 in lucene-solr&apos;s branch refs/heads/branch_8x from Erick Erickson&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=a87ba09&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=a87ba09&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13268&quot; title=&quot;Clean up any test failures resulting from defaulting to async logging&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13268&quot;&gt;&lt;del&gt;SOLR-13268&lt;/del&gt;&lt;/a&gt;: Clean up any test failures resulting from defaulting to async logging. Put TestXmlQParser back&lt;/p&gt;

&lt;p&gt;(cherry picked from commit b893548d97f8b04b40dfbebd79bd860603b92c63)&lt;/p&gt;</comment>
                            <comment id="16793870" author="erickerickson" created="Fri, 15 Mar 2019 18:56:56 +0000"  >&lt;p&gt;I&apos;m moving this to blocker for the 8.1 release, this does &lt;em&gt;not&lt;/em&gt; affect 8.0.&lt;/p&gt;

&lt;p&gt;Either this gets fixed before the release (and the behavior is very wonky, it&apos;ll take a while I&apos;m afraid) or we change the log4j2.xml files to go back to synchronous logging before release.&lt;/p&gt;

&lt;p&gt;I do&#160;__&lt;em&gt;not&lt;/em&gt; think that we need to rollback the rest of &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12055&quot; title=&quot;Enable async logging by default&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12055&quot;&gt;&lt;del&gt;SOLR-12055&lt;/del&gt;&lt;/a&gt; in that case, but that&apos;s certainly open for discussion.&lt;/p&gt;</comment>
                            <comment id="16795308" author="jira-bot" created="Mon, 18 Mar 2019 18:52:53 +0000"  >&lt;p&gt;Commit 3ac07b8dfb00322a291c61c480f7410afd5e4ee9 in lucene-solr&apos;s branch refs/heads/master from erick&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=3ac07b8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=3ac07b8&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13268&quot; title=&quot;Clean up any test failures resulting from defaulting to async logging&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13268&quot;&gt;&lt;del&gt;SOLR-13268&lt;/del&gt;&lt;/a&gt;: Patch that flushes when shutting down&lt;/p&gt;</comment>
                            <comment id="16795309" author="jira-bot" created="Mon, 18 Mar 2019 18:54:26 +0000"  >&lt;p&gt;Commit 0894e39cebbc349968bee024b82792f1d433bbd7 in lucene-solr&apos;s branch refs/heads/branch_8x from erick&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=0894e39&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=0894e39&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13268&quot; title=&quot;Clean up any test failures resulting from defaulting to async logging&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13268&quot;&gt;&lt;del&gt;SOLR-13268&lt;/del&gt;&lt;/a&gt;: Patch that flushes when shutting down&lt;/p&gt;</comment>
                            <comment id="16795313" author="erickerickson" created="Mon, 18 Mar 2019 18:59:17 +0000"  >&lt;p&gt;this is encouraging. This patch flushes all registered loggers when calling StartupLoggingUtils.shutdown(). I&#160;stepped through the log4j code and it looks good.&lt;/p&gt;

&lt;p&gt;It&apos;s still required to call LogManager.shutDown() to handle the lmax.disruptor thread leak case.&lt;/p&gt;

&lt;p&gt;I made the flush call separate and public on the theory there&apos;s no reason it couldn&apos;t be called in those (expert) cases someone needed to insure that all log messages were flushed but still wanted to use async logging &lt;em&gt;without&lt;/em&gt; shutting down the logging framework. That said I&apos;d&#160;first ask why not use synchronous logging.&lt;/p&gt;

&lt;p&gt;I&apos;ll continue to monitor failure cases for too many bytes written to sysout and the like, and if there are no failures by next week close this Jira and &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-8716&quot; title=&quot;Test logging can bleed from one suite to another, cause failures due to sysout limits&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-8716&quot;&gt;&lt;del&gt;LUCENE-8716&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16795794" author="lucenesolrqa" created="Tue, 19 Mar 2019 07:51:36 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;b&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;&lt;/b&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Vote &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Runtime &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Comment &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt; patch &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt;  0m  9s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13268&quot; title=&quot;Clean up any test failures resulting from defaulting to async logging&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13268&quot;&gt;&lt;del&gt;SOLR-13268&lt;/del&gt;&lt;/a&gt; does not apply to master. Rebase required? Wrong Branch? See &lt;a href=&quot;https://wiki.apache.org/solr/HowToContribute#Creating_the_patch_file&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://wiki.apache.org/solr/HowToContribute#Creating_the_patch_file&lt;/a&gt; for help. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Report/Notes &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Issue &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13268&quot; title=&quot;Clean up any test failures resulting from defaulting to async logging&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13268&quot;&gt;&lt;del&gt;SOLR-13268&lt;/del&gt;&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Patch URL &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12962865/SOLR-13268-flushing.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12962865/SOLR-13268-flushing.patch&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Console output &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/339/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/339/console&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Powered by &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Apache Yetus 0.7.0   &lt;a href=&quot;http://yetus.apache.org&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://yetus.apache.org&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;p&gt;This message was automatically generated.&lt;/p&gt;
</comment>
                            <comment id="16801268" author="erickerickson" created="Tue, 26 Mar 2019 00:38:44 +0000"  >&lt;p&gt;I&apos;m about at my wit&apos;s end with this. I have test code in place that &lt;em&gt;should&lt;/em&gt; flush all the loggers&apos; buffers as we exit a suite and it&apos;s not (apparently) working as I expect.&lt;/p&gt;

&lt;p&gt;It struck me that one difference is that when this happens, a bunch of log messages get sent to stdout/stderr and that&apos;s what&apos;s triggering the framework assertion error. However, tests don&apos;t print out &lt;em&gt;all&lt;/em&gt; log messages.&#160;So somehow, log messages are swallowed sometimes. Any pointers into how/where the test framework decides whether to send a message to stdout/err (err mostly)? I &lt;em&gt;think&lt;/em&gt; it may be that my flushing is happening too late and/or I need to move the bit that (apparently) reroutes the logging. But that&apos;s wild speculation and I may be totally off base.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=janhoy&quot; class=&quot;user-hover&quot; rel=&quot;janhoy&quot;&gt;janhoy&lt;/a&gt; You&apos;ve been into some of the logging, any clue?&lt;/p&gt;</comment>
                            <comment id="16825324" author="erickerickson" created="Wed, 24 Apr 2019 16:28:21 +0000"  >&lt;p&gt;We haven&apos;t seen any of these errors in a while, however I did find that the solrj log4j2.xml is still using synchronous logging, apparently I missed it when I made async the default. So I&apos;m going to push that change shortly and continue to monitor.&lt;/p&gt;

&lt;p&gt;And &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat2&quot; class=&quot;user-hover&quot; rel=&quot;caomanhdat2&quot;&gt;caomanhdat2&lt;/a&gt; I noticed you added jetty logging to the test log4j2.xml files. Does it need to be synchronous? I&apos;ve changed it to async in the push I&apos;m about to do, but I can change it back.&lt;/p&gt;</comment>
                            <comment id="16825387" author="jira-bot" created="Wed, 24 Apr 2019 17:53:23 +0000"  >&lt;p&gt;Commit 48dc020ddaf0b0911012b4d9b77d859b2af3d3ae in lucene-solr&apos;s branch refs/heads/master from Erick Erickson&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=48dc020&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=48dc020&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13268&quot; title=&quot;Clean up any test failures resulting from defaulting to async logging&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13268&quot;&gt;&lt;del&gt;SOLR-13268&lt;/del&gt;&lt;/a&gt;: Clean up any test failures resulting from defaulting to async logging&lt;/p&gt;</comment>
                            <comment id="16825396" author="jira-bot" created="Wed, 24 Apr 2019 17:59:39 +0000"  >&lt;p&gt;Commit f08ddbc713b8fa528307c6c1c48e2522e7c220f8 in lucene-solr&apos;s branch refs/heads/branch_8x from Erick Erickson&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=f08ddbc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=f08ddbc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13268&quot; title=&quot;Clean up any test failures resulting from defaulting to async logging&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13268&quot;&gt;&lt;del&gt;SOLR-13268&lt;/del&gt;&lt;/a&gt;: Clean up any test failures resulting from defaulting to async logging&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 48dc020ddaf0b0911012b4d9b77d859b2af3d3ae)&lt;/p&gt;</comment>
                            <comment id="16837677" author="markrmiller@gmail.com" created="Fri, 10 May 2019 23:05:12 +0000"  >&lt;p&gt;I&apos;ve seen them. I don&apos;t believe the shutdown is enough and yo still have to ignore these log4j2 async threads. I have to in order to get clean test runs. Although you still see the fails and have to add the base solr thread leak filters to the new solr base class you guys made to shutdown logging for tests that extend lucene test case directly. Although you then &lt;b&gt;still&lt;/b&gt; see these fails and find out that Hadoop tests redefine thread leak stuff so that they only use the hadoop stuff and not the base solr thread leak stuff. With all of that addressed, these go away.&lt;/p&gt;</comment>
                            <comment id="16841453" author="janhoy" created="Thu, 16 May 2019 15:20:56 +0000"  >&lt;p&gt;his Jira has several commits, is a Blocker but has no Fix Version.??&lt;/p&gt;</comment>
                            <comment id="16841491" author="erickerickson" created="Thu, 16 May 2019 15:53:41 +0000"  >&lt;p&gt;Changing from blocker. That was to make sure that at least some attention got paid to this issue and it didn&apos;t get lost in the process.&lt;/p&gt;

&lt;p&gt;Given that I&apos;m pretty sure it&apos;s a function of the test framework and it&apos;s become quite rare even in the test situations, I don&apos;t think it needs to be a blocker.&lt;/p&gt;</comment>
                            <comment id="16868869" author="hossman" created="Thu, 20 Jun 2019 19:23:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt; - we&apos;re still seeing jenkins test failures that indicate messages are leaking from one test to another...&lt;/p&gt;

&lt;p&gt;In this jenkins job, TestNumericTerms64 (which does no logging or writting to sysout, and extends SolrTestCase is failing because the logging from the previous test inthe same JVM, TestStressReorder, is bleding into it and exceeding the default sysout limits for the test runner...&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://fucit.org/solr-jenkins-reports/job-data/thetaphi/Lucene-Solr-8.x-Linux/735&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://fucit.org/solr-jenkins-reports/job-data/thetaphi/Lucene-Solr-8.x-Linux/735&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Checking out Revision 1c27c473558e81bf14a1392d9da6ebd7a2f961e1 (refs/remotes/origin/branch_8x)
Commit message: &quot;SOLR-10291: Updates CHANGES.txt&quot;
...
   [junit4] Suite: org.apache.solr.uninverting.TestNumericTerms64
   [junit4]   2&amp;gt; 1078666 INFO  (READER6) [     ] o.a.s.c.S.Request [collection1]  webapp=null path=null params={q=id:4&amp;amp;omitHeader=true&amp;amp;wt=json} hits=0 status=0 QTime=0
...
   [junit4]   2&amp;gt; 1078900 INFO  (SUITE-TestStressReorder-seed#[6B010C34AB756A8C]-worker) [     ] o.a.s.SolrTestCaseJ4 ------------------------------------------------------- Done waiting for tracked reso
urces to be released
   [junit4]   2&amp;gt; NOTE: test params are: codec=Lucene80, sim=Asserting(org.apache.lucene.search.similarities.AssertingSimilarity@6180af4c), locale=lo-LA, timezone=America/Lower_Princes
   [junit4]   2&amp;gt; NOTE: Linux 4.18.0-17-generic amd64/Oracle Corporation 13-ea (64-bit)/cpus=8,threads=1,free=81869784,total=518979584
   [junit4]   2&amp;gt; NOTE: All tests run in this JVM: [ShufflingReplicaListTransformerTest, HighlighterTest, TestConfig, DeleteShardTest, TestRandomDVFaceting, AddReplicaTest, TestFieldCacheSort, PeerSyncWi
thLeaderAndIndexFingerprintCachingTest, DistributedQueryComponentCustomSortTest, TestManagedSchemaAPI, DistanceUnitsTest, BlockCacheTest, TestBackupRepositoryFactory, TestLegacyNumericUtils, CoreMergeIn
dexesAdminHandlerTest, TestSimpleTextCodec, CloudExitableDirectoryReaderTest, SolrShardReporterTest, TestNamedUpdateProcessors, TestCollationFieldDocValues, UUIDFieldTest, TestCSVLoader, TestCustomDocTr
ansformer, TestStandardQParsers, SpellCheckCollatorTest, PropertiesRequestHandlerTest, ScheduledMaintenanceTriggerTest, SyncSliceTest, EmbeddedSolrNoSerializeTest, MetricsHistoryWithAuthIntegrationTest,
 PolyFieldTest, RAMDirectoryFactoryTest, OverseerCollectionConfigSetProcessorTest, HdfsThreadLeakTest, CreateCollectionCleanupTest, TestQuerySenderNoQuery, TestFaceting, TestXmlQParser, CircularListTest
, TestCoreDiscovery, TestCollapseQParserPlugin, AssignTest, TestCoreAdminApis, TestFunctionQuery, EchoParamsTest, TestReloadDeadlock, CollectionPropsTest, TestDynamicFieldResource, TestStreamBody, TestW
ordDelimiterFilterFactory, TestIndexSearcher, TestMergePolicyConfig, UniqFieldsUpdateProcessorFactoryTest, PreAnalyzedUpdateProcessorTest, ExecutePlanActionTest, SuggestComponentContextFilterQueryTest, 
DistributedFacetPivotSmallTest, TestJettySolrRunner, HdfsBasicDistributedZk2Test, TestPerFieldSimilarityWithDefaultOverride, TestLeaderElectionZkExpiry, SolrPluginUtilsTest, AuditLoggerPluginTest, Synon
ymTokenizerTest, TestRecovery, CoreSorterTest, OrderedExecutorTest, TestCloudConsistency, SolrCoreMetricManagerTest, NotRequiredUniqueKeyTest, NodeMutatorTest, HdfsDirectoryTest, OverseerStatusTest, Tes
tLegacyBM25SimilarityFactory, TestSegmentSorting, TestScoreJoinQPNoScore, NodeAddedTriggerIntegrationTest, TestMinHashQParser, InfoHandlerTest, DateRangeFieldTest, TestFieldCacheWithThreads, SpellingQue
ryConverterTest, TestCrossCoreJoin, PrimitiveFieldTypeTest, HdfsWriteToMultipleCollectionsTest, SaslZkACLProviderTest, TestCollectionsAPIViaSolrCloudCluster, LeaderElectionContextKeyTest, SuggesterWFSTT
est, MoveReplicaHDFSFailoverTest, TestSimExecutePlanAction, TestSkipOverseerOperations, TestJavabinTupleStreamParser, TestFieldSortValues, AnalysisAfterCoreReloadTest, MultiSolrCloudTestCaseTest, ShowFi
leRequestHandlerTest, DocValuesTest, IndexSizeTriggerTest, CurrencyRangeFacetCloudTest, TestRawResponseWriter, BigEndianAscendingWordSerializerTest, TestExclusionRuleCollectionAccess, TestSolrCoreProper
ties, CursorPagingTest, TestSolr4Spatial2, ZkCollectionPropsCachingTest, ClassificationUpdateProcessorFactoryTest, DistribDocExpirationUpdateProcessorTest, TaggerTest, TestTolerantUpdateProcessorRandomC
loud, TestApiFramework, PeerSyncReplicationTest, SolrJmxReporterTest, MoreLikeThisHandlerTest, RankQueryTest, DistributedFacetPivotLargeTest, TestSubQueryTransformer, TestStressReorder, TestNumericTerms
64]
   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestNumericTerms64 -Dtests.seed=6B010C34AB756A8C -Dtests.multiplier=3 -Dtests.slow=true -Dtests.locale=lo-LA -Dtests.timezone=America/Lower_Princes -Dtests.asserts=true -Dtests.file.encoding=UTF-8
   [junit4] ERROR   0.00s J0 | TestNumericTerms64 (suite) &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: The test or suite printed 641788 bytes to stdout and stderr, even though the limit was set to 8192 bytes. Increase the limit with @Limit, ignore it completely with @SuppressSysoutChecks or run with -Dtests.verbose=true
   [junit4]    &amp;gt;        at __randomizedtesting.SeedInfo.seed([6B010C34AB756A8C]:0)
   [junit4]    &amp;gt;        at java.base/java.lang.Thread.run(Thread.java:835)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16868967" author="erickerickson" created="Thu, 20 Jun 2019 22:04:40 +0000"  >&lt;p&gt;Yep, I&apos;m collecting them. I have a special e-mail folder that filter them to..... I have to say though that for the next month I won&apos;t have much time to devote, we&apos;re moving cross-country. They&apos;re rare enough that I&apos;m going to ask people to live with it until I relocate if I can&apos;t get to them till we&apos;re moved.&lt;/p&gt;

&lt;p&gt;Hey, but when I do get moved, if all goes well there &lt;em&gt;may&lt;/em&gt; be a fiber connection, won&apos;t I be fast then.....&lt;/p&gt;</comment>
                            <comment id="16956541" author="hossman" created="Tue, 22 Oct 2019 00:00:17 +0000"  >&lt;p&gt;FWIW, while looking for something else i noticed this static block in &lt;tt&gt;LuceneTestCase&lt;/tt&gt; ...&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  /**
   * Try to capture streams early so that other classes don&apos;t have a chance to steal references
   * to them (as is the &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; with ju.logging handlers).
   */
  &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; {
    TestRuleLimitSysouts.checkCaptureStreams();
    Logger.getGlobal().getHandlers();
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I haven&apos;t dug into this, or thought about it in depth at all really, but in the back of my head I wonder if what&apos;s happening here in this &lt;tt&gt;TestRuleLimitSysouts.checkCaptureStreams();&lt;/tt&gt; call is perhaps related to why/how/when we&apos;re seeing test logging bleed over from one test class to another?&lt;/p&gt;</comment>
                            <comment id="16957149" author="erickerickson" created="Tue, 22 Oct 2019 15:00:06 +0000"  >&lt;p&gt;No clue really, but thanks for pointing this out. It&apos;s a place to look at least and I&apos;m baffled.&lt;/p&gt;</comment>
                            <comment id="17106376" author="erickerickson" created="Wed, 13 May 2020 14:59:26 +0000"  >&lt;p&gt;The upgrade to a more recent log4j (&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14466&quot; title=&quot;Upgrade log4j2 to latest release (2.13.2)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14466&quot;&gt;&lt;del&gt;SOLR-14466&lt;/del&gt;&lt;/a&gt;) didn&apos;t solve the problem, I&apos;ve seen some more reports since then. So the upgrade wasn&apos;t a magic bullet. Rats.&lt;/p&gt;</comment>
                            <comment id="17142864" author="erickerickson" created="Tue, 23 Jun 2020 11:51:51 +0000"  >&lt;p&gt;I&apos;m thinking of reverting &lt;em&gt;testing&lt;/em&gt; to use synchronous logging. I don&apos;t particularly like that solution, as then we&apos;re testing something different in the test environment than production.&lt;/p&gt;

&lt;p&gt;OTOH, the &quot;logging bleed&quot; is happening, I believe, when the loggers shutdown and don&apos;t completely flush the queue. In the real world this happens when we bring Solr up and down. Tests do this artificially often. It&apos;s not even clear to me that the messages would be lost when &quot;real world&quot; Solr is being shut down, they do come out in the next test so they didn&apos;t disappear into the ether or we wouldn&apos;t be getting this message.&lt;/p&gt;

&lt;p&gt;So frankly I don&apos;t think it&apos;s worth the effort of tracking this down. Async logging has been in place for a long time and this is the only place we see a problem.&lt;/p&gt;

&lt;p&gt;I&apos;ll push this change in a day or three absent strenuous objections. If people insist on NOT reverting, I&apos;ll unassign it.&lt;/p&gt;</comment>
                            <comment id="17143248" author="jira-bot" created="Tue, 23 Jun 2020 19:39:31 +0000"  >&lt;p&gt;Commit de555f2656c8af8deb71a7341dd4111c4d9596f1 in lucene-solr&apos;s branch refs/heads/branch_8x from Erick Erickson&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=de555f2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=de555f2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13268&quot; title=&quot;Clean up any test failures resulting from defaulting to async logging&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13268&quot;&gt;&lt;del&gt;SOLR-13268&lt;/del&gt;&lt;/a&gt;: Clean up any test failures resulting from defaulting to async logging&lt;/p&gt;</comment>
                            <comment id="17143249" author="jira-bot" created="Tue, 23 Jun 2020 19:39:44 +0000"  >&lt;p&gt;Commit ea1bb9f2e963af17631640140f6fcb56f8ef0937 in lucene-solr&apos;s branch refs/heads/master from Erick Erickson&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=ea1bb9f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=ea1bb9f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13268&quot; title=&quot;Clean up any test failures resulting from defaulting to async logging&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13268&quot;&gt;&lt;del&gt;SOLR-13268&lt;/del&gt;&lt;/a&gt;: Clean up any test failures resulting from defaulting to async logging&lt;/p&gt;</comment>
                            <comment id="17143250" author="erickerickson" created="Tue, 23 Jun 2020 19:40:55 +0000"  >&lt;p&gt;I&apos;m calling this &quot;fixed&quot; because any future errors won&apos;t be because of async logging in tests, unless the tests somehow use the production log4j configs. In which case we need a new JIRA.&lt;/p&gt;</comment>
                            <comment id="17158247" author="broustant" created="Wed, 15 Jul 2020 15:08:49 +0000"  >&lt;p&gt;Closing after the 8.6.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13221984">SOLR-13327</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13142397">SOLR-12055</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13219323">SOLR-13290</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13219398">LUCENE-8716</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12962865" name="SOLR-13268-flushing.patch" size="3056" author="erickerickson" created="Mon, 18 Mar 2019 18:55:00 +0000"/>
                            <attachment id="12961869" name="SOLR-13268.patch" size="168088" author="erickerickson" created="Sun, 10 Mar 2019 18:03:38 +0000"/>
                            <attachment id="12961499" name="SOLR-13268.patch" size="165850" author="erickerickson" created="Thu, 7 Mar 2019 05:04:54 +0000"/>
                            <attachment id="12959953" name="SOLR-13268.patch" size="18441" author="erickerickson" created="Sun, 24 Feb 2019 17:46:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 17 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0007c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>