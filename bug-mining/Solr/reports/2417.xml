<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:03:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-7384] Delete-by-id with _route_ parameter fails on replicas for collections with implicit router</title>
                <link>https://issues.apache.org/jira/browse/SOLR-7384</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The FullSolrCloudDistribCmdsTest test has been failing quite regularly on jenkins. Some of those failures are spurious but there is an underlying bug that delete-by-id requests with &quot;&lt;em&gt;route&lt;/em&gt;&quot; parameter on a collection with implicit router, fails on replicas because of a missing &quot;&lt;em&gt;version&lt;/em&gt;&quot; field.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Build: &lt;a href=&quot;http://jenkins.thetaphi.de/job/Lucene-Solr-trunk-Linux/12286/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jenkins.thetaphi.de/job/Lucene-Solr-trunk-Linux/12286/&lt;/a&gt;&lt;br/&gt;
Java: 32bit/jdk1.9.0-ea-b54 -server -XX:+UseConcMarkSweepGC&lt;/p&gt;

&lt;p&gt;1 tests failed.&lt;br/&gt;
FAILED:  org.apache.solr.cloud.FullSolrCloudDistribCmdsTest.test&lt;/p&gt;

&lt;p&gt;Error Message:&lt;br/&gt;
Error from server at &lt;a href=&quot;http://127.0.0.1:44672/implicit_collection_without_routerfield_shard1_replica1:&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://127.0.0.1:44672/implicit_collection_without_routerfield_shard1_replica1:&lt;/a&gt; no servers hosting shard:&lt;/p&gt;

&lt;p&gt;Stack Trace:&lt;br/&gt;
org.apache.solr.client.solrj.impl.HttpSolrClient$RemoteSolrException: Error from server at &lt;a href=&quot;http://127.0.0.1:44672/implicit_collection_without_routerfield_shard1_replica1:&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://127.0.0.1:44672/implicit_collection_without_routerfield_shard1_replica1:&lt;/a&gt; no servers hosting shard:&lt;br/&gt;
        at __randomizedtesting.SeedInfo.seed(&lt;span class=&quot;error&quot;&gt;&amp;#91;944EEE25A6B2D153:1C1AD1FF084EBCAB&amp;#93;&lt;/span&gt;:0)&lt;br/&gt;
        at org.apache.solr.client.solrj.impl.HttpSolrClient.executeMethod(HttpSolrClient.java:557)&lt;br/&gt;
        at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:234)&lt;br/&gt;
        at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:226)&lt;br/&gt;
        at org.apache.solr.client.solrj.SolrRequest.process(SolrRequest.java:135)&lt;/p&gt;&lt;/blockquote&gt;</description>
                <environment></environment>
        <key id="12820530">SOLR-7384</key>
            <summary>Delete-by-id with _route_ parameter fails on replicas for collections with implicit router</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="shalin">Shalin Shekhar Mangar</assignee>
                                    <reporter username="shalin">Shalin Shekhar Mangar</reporter>
                        <labels>
                    </labels>
                <created>Mon, 13 Apr 2015 12:45:59 +0000</created>
                <updated>Fri, 13 Aug 2021 22:34:12 +0000</updated>
                            <resolved>Fri, 13 Aug 2021 22:34:12 +0000</resolved>
                                    <version>5.1</version>
                                    <fixVersion>5.2</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>SolrCloud</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14492353" author="shalinmangar" created="Mon, 13 Apr 2015 12:48:29 +0000"  >&lt;p&gt;Full plain text log from &lt;a href=&quot;http://jenkins.thetaphi.de/job/Lucene-Solr-trunk-Linux/12286/consoleText&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jenkins.thetaphi.de/job/Lucene-Solr-trunk-Linux/12286/consoleText&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14492378" author="jira-bot" created="Mon, 13 Apr 2015 13:05:35 +0000"  >&lt;p&gt;Commit 1673176 from shalin@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1673176&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1673176&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7384&quot; title=&quot;Delete-by-id with _route_ parameter fails on replicas for collections with implicit router&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7384&quot;&gt;&lt;del&gt;SOLR-7384&lt;/del&gt;&lt;/a&gt;: Fix spurious failures in FullSolrCloudDistribCmdsTest&lt;/p&gt;</comment>
                            <comment id="14492379" author="jira-bot" created="Mon, 13 Apr 2015 13:06:27 +0000"  >&lt;p&gt;Commit 1673177 from shalin@apache.org in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1673177&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1673177&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7384&quot; title=&quot;Delete-by-id with _route_ parameter fails on replicas for collections with implicit router&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7384&quot;&gt;&lt;del&gt;SOLR-7384&lt;/del&gt;&lt;/a&gt;: Fix spurious failures in FullSolrCloudDistribCmdsTest&lt;/p&gt;</comment>
                            <comment id="14492381" author="shalinmangar" created="Mon, 13 Apr 2015 13:08:52 +0000"  >&lt;p&gt;The test was creating collections and proceeding to make queries without ensuring that the nodes had recovered. This was causing the failure where a search request failed because it could find no &apos;active&apos; and live shard. I added a waitForRecoveriesToFinish in two places in this test so that this situation is avoided. Longer term, we need to refactor our test framework code so that this is done automatically.&lt;/p&gt;</comment>
                            <comment id="14492460" author="shalinmangar" created="Mon, 13 Apr 2015 14:37:29 +0000"  >&lt;p&gt;There are more failures for this test:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;FAILED:  org.apache.solr.cloud.FullSolrCloudDistribCmdsTest.test

Error Message:
expected:&amp;lt;1&amp;gt; but was:&amp;lt;2&amp;gt;

Stack Trace:
java.lang.AssertionError: expected:&amp;lt;1&amp;gt; but was:&amp;lt;2&amp;gt;
        at __randomizedtesting.SeedInfo.seed([60FAB0B863999B0A:E8AE8F62CD65F6F2]:0)
        at org.junit.Assert.fail(Assert.java:93)
        at org.junit.Assert.failNotEquals(Assert.java:647)
        at org.junit.Assert.assertEquals(Assert.java:128)
        at org.junit.Assert.assertEquals(Assert.java:472)
        at org.junit.Assert.assertEquals(Assert.java:456)
        at org.apache.solr.cloud.FullSolrCloudDistribCmdsTest.testDeleteByIdImplicitRouter(FullSolrCloudDistribCmdsTest.java:247)
        at org.apache.solr.cloud.FullSolrCloudDistribCmdsTest.test(FullSolrCloudDistribCmdsTest.java:144)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Still digging.&lt;/p&gt;</comment>
                            <comment id="14492532" author="shalinmangar" created="Mon, 13 Apr 2015 15:42:28 +0000"  >&lt;p&gt;Attaching log for the failure noted in my previous comment.&lt;/p&gt;</comment>
                            <comment id="14492537" author="shalinmangar" created="Mon, 13 Apr 2015 15:51:05 +0000"  >&lt;p&gt;It looks like the leader is distributing an update without a &lt;em&gt;version&lt;/em&gt; field.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;   [junit4]   2&amp;gt; 332853 T2394 N:127.0.0.1:45875_uhlt%2Fw C:implicit_collection_without_routerfield S:shard2 R:core_node4 c:implicit_collection_without_routerfield_shard2_replica1 C323 oasup.LogUpdateProcessor.finish [implicit_collection_without_routerfield_shard2_replica1] webapp=/uhlt/w path=/update params={update.distrib=FROMLEADER&amp;amp;distrib.from=http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:42537/uhlt/w/implicit_collection_without_routerfield_shard2_replica2/&amp;amp;wt=javabin&amp;amp;version=2} {} 0 1
&lt;/span&gt;   [junit4]   2&amp;gt; 332853 T2394 N:127.0.0.1:45875_uhlt%2Fw C:implicit_collection_without_routerfield S:shard2 R:core_node4 c:implicit_collection_without_routerfield_shard2_replica1 C323 oasc.SolrException.log ERROR org.apache.solr.common.SolrException: missing _version_ on update from leader
   [junit4]   2&amp;gt; 		at org.apache.solr.update.processor.DistributedUpdateProcessor.versionDelete(DistributedUpdateProcessor.java:1508)
   [junit4]   2&amp;gt; 		at org.apache.solr.update.processor.DistributedUpdateProcessor.processDelete(DistributedUpdateProcessor.java:1161)
   [junit4]   2&amp;gt; 		at org.apache.solr.update.processor.LogUpdateProcessor.processDelete(LogUpdateProcessorFactory.java:125)
   [junit4]   2&amp;gt; 		at org.apache.solr.handler.loader.JavabinLoader.delete(JavabinLoader.java:148)
   [junit4]   2&amp;gt; 		at org.apache.solr.handler.loader.JavabinLoader.parseAndLoadDocs(JavabinLoader.java:111)
   [junit4]   2&amp;gt; 		at org.apache.solr.handler.loader.JavabinLoader.load(JavabinLoader.java:58)
   [junit4]   2&amp;gt; 		at org.apache.solr.handler.UpdateRequestHandler$1.load(UpdateRequestHandler.java:98)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14492561" author="shalinmangar" created="Mon, 13 Apr 2015 16:12:32 +0000"  >&lt;p&gt;Interestingly, I always see the above exception in the logs even when the test passes. I think the changes made in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5890&quot; title=&quot;Delete silently fails if not sent to shard where document was added&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5890&quot;&gt;&lt;del&gt;SOLR-5890&lt;/del&gt;&lt;/a&gt; are not correct and the deleteById with a &lt;em&gt;route&lt;/em&gt; is sent to the leader but the leader replicates it without assigning a &lt;em&gt;version&lt;/em&gt; field. Since the update still succeeds on the leader, the test passes when the subsequent search query hits the leader but it fails when it happens to hit the replica directly.&lt;/p&gt;

&lt;p&gt;The second bug is why the leader even attempts to send such an update (i.e. without a &lt;em&gt;version&lt;/em&gt;). We should assert such things and make sure that they are not possible at all.&lt;/p&gt;</comment>
                            <comment id="14492870" author="jira-bot" created="Mon, 13 Apr 2015 19:04:57 +0000"  >&lt;p&gt;Commit 1673262 from shalin@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1673262&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1673262&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7384&quot; title=&quot;Delete-by-id with _route_ parameter fails on replicas for collections with implicit router&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7384&quot;&gt;&lt;del&gt;SOLR-7384&lt;/del&gt;&lt;/a&gt;: Disable the failing tests until the root cause is fixed&lt;/p&gt;</comment>
                            <comment id="14492874" author="jira-bot" created="Mon, 13 Apr 2015 19:05:44 +0000"  >&lt;p&gt;Commit 1673263 from shalin@apache.org in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1673263&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1673263&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7384&quot; title=&quot;Delete-by-id with _route_ parameter fails on replicas for collections with implicit router&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7384&quot;&gt;&lt;del&gt;SOLR-7384&lt;/del&gt;&lt;/a&gt;: Disable the failing tests until the root cause is fixed&lt;/p&gt;</comment>
                            <comment id="17398961" author="hossman" created="Fri, 13 Aug 2021 22:33:17 +0000"  >&lt;p&gt;resolving as duplicate of (newer) &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12694&quot; title=&quot;JavaBinUpdateRequestCodec fails to restore UpdateRequest.deleteById correctly when &amp;#39;_route_&amp;#39; is specified.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12694&quot;&gt;&lt;del&gt;SOLR-12694&lt;/del&gt;&lt;/a&gt; since that issue has more details as to what exactly the problem is.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13180881">SOLR-12694</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13131717">SOLR-11868</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12952954">SOLR-8889</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13180881">SOLR-12694</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12724966" name="FullSolrCloudDistribCmdsTest-2.log" size="1728733" author="shalin" created="Mon, 13 Apr 2015 15:42:28 +0000"/>
                            <attachment id="12724930" name="FullSolrCloudDistribCmdsTest.log" size="1632724" author="shalin" created="Mon, 13 Apr 2015 12:48:29 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 13 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2d6hb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>