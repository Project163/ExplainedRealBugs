<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:20:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-1826] highlighting breaks when using WordDelimiterFilter and setting termOffsets=true</title>
                <link>https://issues.apache.org/jira/browse/SOLR-1826</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;When using the WordDelimiterFilter and setting termOffsets to true the highlighting breaks in certain cases. This did not happen in the 1.3 release.&lt;br/&gt;
For example, if I index the term &quot;PowerShot.com&quot; and search for &lt;tt&gt;pow*&lt;/tt&gt; the highlighting snippet contains &lt;tt&gt;&amp;lt;em&amp;gt;Power&amp;lt;/em&amp;gt;&amp;lt;em&amp;gt;PowerShot.com&amp;lt;/em&amp;gt;&lt;/tt&gt;.&lt;br/&gt;
I will attach a patch which adds tests to the highlighter unittest to demonstrate the issue.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12459263">SOLR-1826</key>
            <summary>highlighting breaks when using WordDelimiterFilter and setting termOffsets=true</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rcmuir">Robert Muir</assignee>
                                    <reporter username="dlx">Stefan Oestreicher</reporter>
                        <labels>
                    </labels>
                <created>Tue, 16 Mar 2010 14:19:34 +0000</created>
                <updated>Wed, 6 Jun 2012 14:51:28 +0000</updated>
                            <resolved>Wed, 26 Jan 2011 13:01:17 +0000</resolved>
                                    <version>1.4</version>
                                    <fixVersion>3.1</fixVersion>
                    <fixVersion>4.0-ALPHA</fixVersion>
                                    <component>highlighter</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="12845913" author="dlx" created="Tue, 16 Mar 2010 14:21:02 +0000"  >&lt;p&gt;attached patch demonstrates the problem&lt;/p&gt;</comment>
                            <comment id="12845923" author="dlx" created="Tue, 16 Mar 2010 14:49:59 +0000"  >&lt;p&gt;I just realised that the field type definition in my patch is unnecessary. I removed it and set the termOffsets attribute directly for the field.&lt;/p&gt;</comment>
                            <comment id="12845925" author="dlx" created="Tue, 16 Mar 2010 15:02:49 +0000"  >&lt;p&gt;updated the patch because I borked the indentation&lt;/p&gt;</comment>
                            <comment id="12848271" author="sanjoy" created="Mon, 22 Mar 2010 18:33:29 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I investigated this some more.  The problem seems to be in:&lt;/p&gt;

&lt;p&gt;org.apache.lucene.search.highlight.TokenSource.java&lt;/p&gt;

&lt;p&gt;public static TokenStream getTokenStream(TermPositionVector tpv, boolean tokenPositionsGuaranteedContiguous) {&lt;/p&gt;

&lt;p&gt;   has at the end the following code to sort the tokens into original document order.&lt;/p&gt;

&lt;p&gt;            Arrays.sort(tokensInOriginalOrder, new Comparator(){&lt;br/&gt;
                public int compare(Object o1, Object o2)&lt;br/&gt;
                {&lt;br/&gt;
                    Token t1=(Token) o1;&lt;br/&gt;
                    Token t2=(Token) o2;&lt;br/&gt;
                    if(t1.startOffset()&amp;gt;t2.endOffset())&lt;br/&gt;
                        return 1;&lt;br/&gt;
                    if(t1.startOffset()&amp;lt;t2.startOffset())&lt;br/&gt;
                        return -1;&lt;br/&gt;
                    return 0;&lt;br/&gt;
                }});&lt;/p&gt;

&lt;p&gt;This is not sorting the tokens into the right original order.  The order should be&lt;/p&gt;

&lt;p&gt;lorem, power, powershotcom, shot, com, ipsum for this to work correctly.  Instead we are getting lorem, power, com, powershotcom, shot, ipsum which confuses TokenGroup.isDistinct().&lt;/p&gt;

&lt;p&gt;I would be happy to fix this bug.  &lt;/p&gt;

&lt;p&gt;Should we fix this as a Lucene bug or fix it in Solr by creating a new TokenStream that handles overlapping tokens correctly.&lt;/p&gt;</comment>
                            <comment id="12849070" author="sanjoy" created="Wed, 24 Mar 2010 06:10:22 +0000"  >&lt;p&gt;This is a fix that ensures that overlapping tokens are sorted correctly.&lt;/p&gt;</comment>
                            <comment id="12849071" author="sanjoy" created="Wed, 24 Mar 2010 06:11:26 +0000"  >&lt;p&gt;Just uploaded a patch that should fix this bug.  Please let me know if this is not the right fix.&lt;/p&gt;</comment>
                            <comment id="12884227" author="dlx" created="Thu, 1 Jul 2010 09:16:05 +0000"  >&lt;p&gt;I&apos;m sorry I completely lost track of this issue. I&apos;ll test your patch ASAP and get back to you.&lt;/p&gt;</comment>
                            <comment id="12884243" author="dlx" created="Thu, 1 Jul 2010 11:04:14 +0000"  >&lt;p&gt;Hi, the fix works for me. The patch didn&apos;t apply cleanly to 1.4.0 and 1.4.1. Fixed patch is attached. Thanks.&lt;/p&gt;</comment>
                            <comment id="12986994" author="rcmuir" created="Wed, 26 Jan 2011 13:01:17 +0000"  >&lt;p&gt;Hello, this same bug has been fixed in the Lucene highlighter: &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-2874&quot; title=&quot;Highlighting overlapping tokens outputs doubled words&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LUCENE-2874&quot;&gt;&lt;del&gt;LUCENE-2874&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I applied your test and it passes against current trunk... I also committed it.&lt;/p&gt;

&lt;p&gt;Thanks very much for the work here!!!!&lt;/p&gt;</comment>
                            <comment id="13013124" author="gsingers" created="Wed, 30 Mar 2011 15:45:38 +0000"  >&lt;p&gt;Bulk close for 3.1.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12508440">SOLR-2547</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12448487" name="SOLR-1826.patch" size="15320" author="dlx" created="Thu, 1 Jul 2010 11:04:14 +0000"/>
                            <attachment id="12439637" name="SOLR-1826.patch" size="76626" author="sanjoy" created="Wed, 24 Mar 2010 06:10:22 +0000"/>
                            <attachment id="12438925" name="SOLR-1826.txt" size="2363" author="dlx" created="Tue, 16 Mar 2010 15:02:49 +0000"/>
                            <attachment id="12438924" name="SOLR-1826.txt" size="2351" author="dlx" created="Tue, 16 Mar 2010 14:49:59 +0000"/>
                            <attachment id="12438921" name="SOLR-1826.txt" size="3643" author="dlx" created="Tue, 16 Mar 2010 14:21:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5640</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 34 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03ogf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19395</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>