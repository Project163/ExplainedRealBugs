<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:54:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-6286] TestReplicationHandler.doTestReplicateAfterCoreReload reliably reproducing seed failures comparing master commits before/after reload</title>
                <link>https://issues.apache.org/jira/browse/SOLR-6286</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;There have been a few failures on jenkins.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;3 tests failed.
REGRESSION:  org.apache.solr.handler.TestReplicationHandler.doTestReplicateAfterCoreReload

Error Message:
expected:&amp;lt;[{indexVersion=1406477990053,generation=2,filelist=[_bta.fdt, _bta.fdx, _bta.fnm, _bta.si, _bta_Lucene41_0.doc, _bta_Lucene41_0.tim, _bta_Lucene41_0.tip, _bta_nrm.cfe, _bta_nrm.cfs, _nik.cfe, _nik.cfs, _nik.si, _yok.cfe, _yok.cfs, _yok.si, _yp3.cfe, _yp3.cfs, _yp3.si, _yp4.cfe, _yp4.cfs, _yp4.si, _yp5.cfe, _yp5.cfs, _yp5.si, _yp6.cfe, _yp6.cfs, _yp6.si, _yp7.cfe, _yp7.cfs, _yp7.si, _yp8.cfe, _yp8.cfs, _yp8.si, _yp9.cfe, _yp9.cfs, _yp9.si, _ypa.cfe, _ypa.cfs, _ypa.si, _ypu.cfe, _ypu.cfs, _ypu.si, _ypv.cfe, _ypv.cfs, _ypv.si, _ypw.cfe, _ypw.cfs, _ypw.si, _ypx.cfe, _ypx.cfs, _ypx.si, _ypy.cfe, _ypy.cfs, _ypy.si, segments_2]}]&amp;gt; but was:&amp;lt;[{indexVersion=1406477990053,generation=2,filelist=[_bta.fdt, _bta.fdx, _bta.fnm, _bta.si, _bta_Lucene41_0.doc, _bta_Lucene41_0.tim, _bta_Lucene41_0.tip, _bta_nrm.cfe, _bta_nrm.cfs, _nik.cfe, _nik.cfs, _nik.si, _yok.cfe, _yok.cfs, _yok.si, _yp3.cfe, _yp3.cfs, _yp3.si, _yp4.cfe, _yp4.cfs, _yp4.si, _yp5.cfe, _yp5.cfs, _yp5.si, _yp6.cfe, _yp6.cfs, _yp6.si, _yp7.cfe, _yp7.cfs, _yp7.si, _yp8.cfe, _yp8.cfs, _yp8.si, _yp9.cfe, _yp9.cfs, _yp9.si, _ypa.cfe, _ypa.cfs, _ypa.si, _ypu.cfe, _ypu.cfs, _ypu.si, _ypv.cfe, _ypv.cfs, _ypv.si, _ypw.cfe, _ypw.cfs, _ypw.si, _ypx.cfe, _ypx.cfs, _ypx.si, _ypy.cfe, _ypy.cfs, _ypy.si, segments_2]}, {indexVersion=1406477990053,generation=3,filelist=[_bta.fdt, _bta.fdx, _bta.fnm, _bta.si, _bta_Lucene41_0.doc, _bta_Lucene41_0.tim, _bta_Lucene41_0.tip, _bta_nrm.cfe, _bta_nrm.cfs, _nik.cfe, _nik.cfs, _nik.si, _ypc.cfe, _ypc.cfs, _ypc.si, _ypu.cfe, _ypu.cfs, _ypu.si, _ypv.cfe, _ypv.cfs, _ypv.si, _ypw.cfe, _ypw.cfs, _ypw.si, _ypx.cfe, _ypx.cfs, _ypx.si, _ypy.cfe, _ypy.cfs, _ypy.si, segments_3]}]&amp;gt;

Stack Trace:
java.lang.AssertionError: expected:&amp;lt;[{indexVersion=1406477990053,generation=2,filelist=[_bta.fdt, _bta.fdx, _bta.fnm, _bta.si, _bta_Lucene41_0.doc, _bta_Lucene41_0.tim, _bta_Lucene41_0.tip, _bta_nrm.cfe, _bta_nrm.cfs, _nik.cfe, _nik.cfs, _nik.si, _yok.cfe, _yok.cfs, _yok.si, _yp3.cfe, _yp3.cfs, _yp3.si, _yp4.cfe, _yp4.cfs, _yp4.si, _yp5.cfe, _yp5.cfs, _yp5.si, _yp6.cfe, _yp6.cfs, _yp6.si, _yp7.cfe, _yp7.cfs, _yp7.si, _yp8.cfe, _yp8.cfs, _yp8.si, _yp9.cfe, _yp9.cfs, _yp9.si, _ypa.cfe, _ypa.cfs, _ypa.si, _ypu.cfe, _ypu.cfs, _ypu.si, _ypv.cfe, _ypv.cfs, _ypv.si, _ypw.cfe, _ypw.cfs, _ypw.si, _ypx.cfe, _ypx.cfs, _ypx.si, _ypy.cfe, _ypy.cfs, _ypy.si, segments_2]}]&amp;gt; but was:&amp;lt;[{indexVersion=1406477990053,generation=2,filelist=[_bta.fdt, _bta.fdx, _bta.fnm, _bta.si, _bta_Lucene41_0.doc, _bta_Lucene41_0.tim, _bta_Lucene41_0.tip, _bta_nrm.cfe, _bta_nrm.cfs, _nik.cfe, _nik.cfs, _nik.si, _yok.cfe, _yok.cfs, _yok.si, _yp3.cfe, _yp3.cfs, _yp3.si, _yp4.cfe, _yp4.cfs, _yp4.si, _yp5.cfe, _yp5.cfs, _yp5.si, _yp6.cfe, _yp6.cfs, _yp6.si, _yp7.cfe, _yp7.cfs, _yp7.si, _yp8.cfe, _yp8.cfs, _yp8.si, _yp9.cfe, _yp9.cfs, _yp9.si, _ypa.cfe, _ypa.cfs, _ypa.si, _ypu.cfe, _ypu.cfs, _ypu.si, _ypv.cfe, _ypv.cfs, _ypv.si, _ypw.cfe, _ypw.cfs, _ypw.si, _ypx.cfe, _ypx.cfs, _ypx.si, _ypy.cfe, _ypy.cfs, _ypy.si, segments_2]}, {indexVersion=1406477990053,generation=3,filelist=[_bta.fdt, _bta.fdx, _bta.fnm, _bta.si, _bta_Lucene41_0.doc, _bta_Lucene41_0.tim, _bta_Lucene41_0.tip, _bta_nrm.cfe, _bta_nrm.cfs, _nik.cfe, _nik.cfs, _nik.si, _ypc.cfe, _ypc.cfs, _ypc.si, _ypu.cfe, _ypu.cfs, _ypu.si, _ypv.cfe, _ypv.cfs, _ypv.si, _ypw.cfe, _ypw.cfs, _ypw.si, _ypx.cfe, _ypx.cfs, _ypx.si, _ypy.cfe, _ypy.cfs, _ypy.si, segments_3]}]&amp;gt;
        at __randomizedtesting.SeedInfo.seed([E4FFCDCA8EC968BC:C128D6FAFE8166BF]:0)
        at org.junit.Assert.fail(Assert.java:93)
        at org.junit.Assert.failNotEquals(Assert.java:647)
        at org.junit.Assert.assertEquals(Assert.java:128)
        at org.junit.Assert.assertEquals(Assert.java:147)
        at org.apache.solr.handler.TestReplicationHandler.doTestReplicateAfterCoreReload(TestReplicationHandler.java:1190)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/job/Lucene-Solr-NightlyTests-4.x/585/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Lucene-Solr-NightlyTests-4.x/585/&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12730086">SOLR-6286</key>
            <summary>TestReplicationHandler.doTestReplicateAfterCoreReload reliably reproducing seed failures comparing master commits before/after reload</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sarowe">Steven Rowe</assignee>
                                    <reporter username="shalin">Shalin Shekhar Mangar</reporter>
                        <labels>
                    </labels>
                <created>Sun, 27 Jul 2014 19:58:13 +0000</created>
                <updated>Wed, 2 Oct 2019 17:24:03 +0000</updated>
                            <resolved>Thu, 19 Apr 2018 18:53:07 +0000</resolved>
                                                    <fixVersion>7.4</fixVersion>
                    <fixVersion>8.0</fixVersion>
                                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14075747" author="jira-bot" created="Sun, 27 Jul 2014 20:27:50 +0000"  >&lt;p&gt;Commit 1613838 from shalin@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1613838&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1613838&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6286&quot; title=&quot;TestReplicationHandler.doTestReplicateAfterCoreReload reliably reproducing seed failures comparing master commits before/after reload&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6286&quot;&gt;&lt;del&gt;SOLR-6286&lt;/del&gt;&lt;/a&gt;: Add logging on how long we slept and how many docs were found&lt;/p&gt;</comment>
                            <comment id="14075748" author="jira-bot" created="Sun, 27 Jul 2014 20:28:36 +0000"  >&lt;p&gt;Commit 1613839 from shalin@apache.org in branch &apos;dev/branches/branch_4x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1613839&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1613839&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6286&quot; title=&quot;TestReplicationHandler.doTestReplicateAfterCoreReload reliably reproducing seed failures comparing master commits before/after reload&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6286&quot;&gt;&lt;del&gt;SOLR-6286&lt;/del&gt;&lt;/a&gt;: Add logging on how long we slept and how many docs were found&lt;/p&gt;</comment>
                            <comment id="14075942" author="shalinmangar" created="Mon, 28 Jul 2014 06:28:54 +0000"  >&lt;p&gt;What&apos;s happening here is that on a core reload, the old IndexWriter is closed which causes a commit and a new generation to be written out. I&apos;d expect that since there were no pending changes, there&apos;s be no need to write a new segment. Anyhow, that happens and a comparison between the old and new commit information fails because now we have this new segment that we didn&apos;t before. This failure only happens sometimes. The indexversion doesn&apos;t change though and the slave says that it is in sync with the master. &lt;/p&gt;

&lt;p&gt;The only difference I could find was that the noCFSRatio changed between the merge policy before reload and after. Before reload we had noCFSRatio=0.8239541096061591:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;   [junit4]   2&amp;gt; 4473463 T16555 oasu.RandomMergePolicy.&amp;lt;init&amp;gt; RandomMergePolicy wrapping &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.lucene.index.LogByteSizeMergePolicy: [LogByteSizeMergePolicy: minMergeSize=1677721, mergeFactor=9, maxMergeSize=2147483648, maxMergeSizeForForcedMerge=9223372036854775807, calibrateSizeByDeletes=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, maxMergeDocs=2147483647, maxCFSSegmentSizeMB=8.796093022207999E12, noCFSRatio=0.8239541096061591]
   [junit4]   2&amp;gt; 4473464 T16555 oasc.SolrDeletionPolicy.onInit SolrDeletionPolicy.onInit: commits: num=1
   [junit4]   2&amp;gt; 		commit{dir=MockDirectoryWrapper(RAMDirectory@48b4526 lockFactory=org.apache.lucene.store.SingleInstanceLockFactory@1e1c1e52),segFN=segments_1,generation=1}
   [junit4]   2&amp;gt; 4473464 T16555 oasc.SolrDeletionPolicy.updateCommits newest commit generation = 1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After reload, we had noCFSRatio=1.0:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;   [junit4]   2&amp;gt; 5017946 T16548 oasu.RandomMergePolicy.&amp;lt;init&amp;gt; RandomMergePolicy wrapping &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.lucene.index.LogByteSizeMergePolicy: [LogByteSizeMergePolicy: minMergeSize=1677721, mergeFactor=9, maxMergeSize=2147483648, maxMergeSizeForForcedMerge=9223372036854775807, calibrateSizeByDeletes=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, maxMergeDocs=2147483647, maxCFSSegmentSizeMB=8.796093022207999E12, noCFSRatio=1.0]
   [junit4]   2&amp;gt; 5017949 T16548 oasc.SolrDeletionPolicy.onInit SolrDeletionPolicy.onInit: commits: num=2
   [junit4]   2&amp;gt; 		commit{dir=MockDirectoryWrapper(RAMDirectory@48b4526 lockFactory=org.apache.lucene.store.SingleInstanceLockFactory@1e1c1e52),segFN=segments_2,generation=2}
   [junit4]   2&amp;gt; 		commit{dir=MockDirectoryWrapper(RAMDirectory@48b4526 lockFactory=org.apache.lucene.store.SingleInstanceLockFactory@1e1c1e52),segFN=segments_3,generation=3}
   [junit4]   2&amp;gt; 5017949 T16548 oasc.SolrDeletionPolicy.updateCommits newest commit generation = 3
   [junit4]   2&amp;gt; 5017950 T16548 oasu.DefaultSolrCoreState.newIndexWriter New IndexWriter is ready to be used.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Still digging.&lt;/p&gt;</comment>
                            <comment id="15421208" author="steve_rowe" created="Mon, 15 Aug 2016 16:15:38 +0000"  >&lt;p&gt;This nightly branch_6x failure from my Jenkins reproduces for me, though it takes almost 10 minutes to do so: &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestReplicationHandler -Dtests.method=doTestReplicateAfterCoreReload -Dtests.seed=1B0EF957D5556B48 -Dtests.multiplier=2 -Dtests.nightly=true -Dtests.slow=true -Dtests.linedocsfile=/home/jenkins/lucene-data/enwiki.random.lines.txt -Dtests.locale=es-MX -Dtests.timezone=Africa/Blantyre -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1
   [junit4] FAILURE  333s | TestReplicationHandler.doTestReplicateAfterCoreReload &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: expected:&amp;lt;[{indexVersion=1471276743771,generation=2,filelist=[_0.cfe, _0.cfs, _0.si, _1.cfe, _1.cfs, _1.si, _2.cfe, _2.cfs, _2.si, _3.cfe, _3.cfs, _3.si, _4.cfe, _4.cfs, _4.si, _5.cfe, _5.cfs, _5.si, segments_2]}]&amp;gt; but was:&amp;lt;[{indexVersion=1471276743771,generation=2,filelist=[_0.cfe, _0.cfs, _0.si, _1.cfe, _1.cfs, _1.si, _2.cfe, _2.cfs, _2.si, _3.cfe, _3.cfs, _3.si, _4.cfe, _4.cfs, _4.si, _5.cfe, _5.cfs, _5.si, segments_2]}, {indexVersion=1471276743771,generation=3,filelist=[_2.cfe, _2.cfs, _2.si, _3.cfe, _3.cfs, _3.si, _4.cfe, _4.cfs, _4.si, _6.fdt, _6.fdx, _6.fnm, _6.nvd, _6.nvm, _6.si, _6_LuceneVarGapDocFreqInterval_0.doc, _6_LuceneVarGapDocFreqInterval_0.tib, _6_LuceneVarGapDocFreqInterval_0.tiv, segments_3]}]&amp;gt;
   [junit4]    &amp;gt;        at __randomizedtesting.SeedInfo.seed([1B0EF957D5556B48:3ED9E267A51D654B]:0)
   [junit4]    &amp;gt;        at org.apache.solr.handler.TestReplicationHandler.doTestReplicateAfterCoreReload(TestReplicationHandler.java:1229)
   [junit4]    &amp;gt;        at java.lang.Thread.run(Thread.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15421260" author="thetaphi" created="Mon, 15 Aug 2016 16:56:20 +0000"  >&lt;p&gt;I am not sure if it is related: The nightly tests on ASF Jenkins regularily (always) fail currently with OOM errors. Jenkins found a &quot;.hprof&quot; dump and failed the build because of that. As the tests do not fail with OOM, this looks like a suppressed OOM error and may be related to this one: &lt;a href=&quot;https://builds.apache.org/job/Lucene-Solr-NightlyTests-master/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Lucene-Solr-NightlyTests-master/&lt;/a&gt; (all builds failed since July, all with a heap dump, e.g. &lt;a href=&quot;https://builds.apache.org/job/Lucene-Solr-NightlyTests-master/1095/):&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Lucene-Solr-NightlyTests-master/1095/):&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;/x1/jenkins/jenkins-slave/workspace/Lucene-Solr-NightlyTests-master/build.xml:771: The following error occurred while executing this line:
/x1/jenkins/jenkins-slave/workspace/Lucene-Solr-NightlyTests-master/build.xml:715: Some of the tests produced a heap dump, but did not fail. Maybe a suppressed OutOfMemoryError? Dumps created:
* java_pid26861.hprof
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15536307" author="steve_rowe" created="Fri, 30 Sep 2016 15:45:06 +0000"  >&lt;p&gt;This nightly 6.x failure from my Jenkins &lt;a href=&quot;http://jenkins.sarowe.net/job/Lucene-Solr-Nightly-6.x/168&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jenkins.sarowe.net/job/Lucene-Solr-Nightly-6.x/168&lt;/a&gt; reproduces for me, but only if I first remove &lt;tt&gt;-Dtests.method=doTestReplicateAfterCoreReload&lt;/tt&gt; from the repro line - takes over 12 minutes on my server:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestReplicationHandler -Dtests.method=doTestReplicateAfterCoreReload -Dtests.seed=2E632BF89D2E9EC3 -Dtests.multiplier=2 -Dtests.nightly=true -Dtests.slow=true -Dtests.linedocsfile=/home/jenkins/lucene-data/enwiki.random.lines.txt -Dtests.locale=el-CY -Dtests.timezone=Asia/Ho_Chi_Minh -Dtests.asserts=true -Dtests.file.encoding=UTF-8
   [junit4] FAILURE  441s J2 | TestReplicationHandler.doTestReplicateAfterCoreReload &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: expected:&amp;lt;[{indexVersion=1475239345178,generation=2,filelist=[_9by.fdt, _9by.fdx, _9by.fnm, _9by.nvd, _9by.nvm, _9by.si, _9by_FST50_0.doc, _9by_FST50_0.tfp, _ihg.cfe, _ihg.cfs, _ihg.si, _ms4.cfe, _ms4.cfs, _ms4.si, _ms5.cfe, _ms5.cfs, _ms5.si, _ms6.cfe, _ms6.cfs, _ms6.si, _ms7.cfe, _ms7.cfs, _ms7.si, _ms8.cfe, _ms8.cfs, _ms8.si, _ms9.cfe, _ms9.cfs, _ms9.si, _msa.cfe, _msa.cfs, _msa.si, _msb.cfe, _msb.cfs, _msb.si, _msc.cfe, _msc.cfs, _msc.si, _msd.cfe, _msd.cfs, _msd.si, _mse.cfe, _mse.cfs, _mse.si, _msf.cfe, _msf.cfs, _msf.si, _msg.cfe, _msg.cfs, _msg.si, _msh.cfe, _msh.cfs, _msh.si, _msi.cfe, _msi.cfs, _msi.si, _msj.cfe, _msj.cfs, _msj.si, _msk.cfe, _msk.cfs, _msk.si, _msl.cfe, _msl.cfs, _msl.si, _msm.cfe, _msm.cfs, _msm.si, _msn.cfe, _msn.cfs, _msn.si, _mso.cfe, _mso.cfs, _mso.si, _msp.cfe, _msp.cfs, _msp.si, _msq.cfe, _msq.cfs, _msq.si, _msr.cfe, _msr.cfs, _msr.si, _mss.cfe, _mss.cfs, _mss.si, _mst.cfe, _mst.cfs, _mst.si, _msu.cfe, _msu.cfs, _msu.si, _msv.cfe, _msv.cfs, _msv.si, _msw.cfe, _msw.cfs, _msw.si, _mtr.cfe, _mtr.cfs, _mtr.si, _mts.cfe, _mts.cfs, _mts.si, _mtt.cfe, _mtt.cfs, _mtt.si, _mtu.cfe, _mtu.cfs, _mtu.si, _mtv.cfe, _mtv.cfs, _mtv.si, _mtw.cfe, _mtw.cfs, _mtw.si, _mtx.cfe, _mtx.cfs, _mtx.si, _mty.cfe, _mty.cfs, _mty.si, _mtz.cfe, _mtz.cfs, _mtz.si, segments_2]}]&amp;gt; but was:&amp;lt;[{indexVersion=1475239345178,generation=2,filelist=[_9by.fdt, _9by.fdx, _9by.fnm, _9by.nvd, _9by.nvm, _9by.si, _9by_FST50_0.doc, _9by_FST50_0.tfp, _ihg.cfe, _ihg.cfs, _ihg.si, _ms4.cfe, _ms4.cfs, _ms4.si, _ms5.cfe, _ms5.cfs, _ms5.si, _ms6.cfe, _ms6.cfs, _ms6.si, _ms7.cfe, _ms7.cfs, _ms7.si, _ms8.cfe, _ms8.cfs, _ms8.si, _ms9.cfe, _ms9.cfs, _ms9.si, _msa.cfe, _msa.cfs, _msa.si, _msb.cfe, _msb.cfs, _msb.si, _msc.cfe, _msc.cfs, _msc.si, _msd.cfe, _msd.cfs, _msd.si, _mse.cfe, _mse.cfs, _mse.si, _msf.cfe, _msf.cfs, _msf.si, _msg.cfe, _msg.cfs, _msg.si, _msh.cfe, _msh.cfs, _msh.si, _msi.cfe, _msi.cfs, _msi.si, _msj.cfe, _msj.cfs, _msj.si, _msk.cfe, _msk.cfs, _msk.si, _msl.cfe, _msl.cfs, _msl.si, _msm.cfe, _msm.cfs, _msm.si, _msn.cfe, _msn.cfs, _msn.si, _mso.cfe, _mso.cfs, _mso.si, _msp.cfe, _msp.cfs, _msp.si, _msq.cfe, _msq.cfs, _msq.si, _msr.cfe, _msr.cfs, _msr.si, _mss.cfe, _mss.cfs, _mss.si, _mst.cfe, _mst.cfs, _mst.si, _msu.cfe, _msu.cfs, _msu.si, _msv.cfe, _msv.cfs, _msv.si, _msw.cfe, _msw.cfs, _msw.si, _mtr.cfe, _mtr.cfs, _mtr.si, _mts.cfe, _mts.cfs, _mts.si, _mtt.cfe, _mtt.cfs, _mtt.si, _mtu.cfe, _mtu.cfs, _mtu.si, _mtv.cfe, _mtv.cfs, _mtv.si, _mtw.cfe, _mtw.cfs, _mtw.si, _mtx.cfe, _mtx.cfs, _mtx.si, _mty.cfe, _mty.cfs, _mty.si, _mtz.cfe, _mtz.cfs, _mtz.si, segments_2]}, {indexVersion=1475239345178,generation=3,filelist=[_9by.fdt, _9by.fdx, _9by.fnm, _9by.nvd, _9by.nvm, _9by.si, _9by_FST50_0.doc, _9by_FST50_0.tfp, _ihg.cfe, _ihg.cfs, _ihg.si, _msy.cfe, _msy.cfs, _msy.si, _mtr.cfe, _mtr.cfs, _mtr.si, _mts.cfe, _mts.cfs, _mts.si, _mtt.cfe, _mtt.cfs, _mtt.si, _mtu.cfe, _mtu.cfs, _mtu.si, _mtv.cfe, _mtv.cfs, _mtv.si, _mtw.cfe, _mtw.cfs, _mtw.si, _mtx.cfe, _mtx.cfs, _mtx.si, _mty.cfe, _mty.cfs, _mty.si, _mtz.cfe, _mtz.cfs, _mtz.si, segments_3]}]&amp;gt;
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([2E632BF89D2E9EC3:BB430C8ED6690C0]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.handler.TestReplicationHandler.doTestReplicateAfterCoreReload(TestReplicationHandler.java:1229)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15924991" author="hossman" created="Tue, 14 Mar 2017 21:03:54 +0000"  >&lt;p&gt;I recently filed a similar issue but only now noticed this one &amp;#8211; i&apos;ll resolve &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10251&quot; title=&quot;reliable TestReplicationHandler.doTestReplicateAfterCoreReload failure -- more (identical) commits then expected&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10251&quot;&gt;&lt;del&gt;SOLR-10251&lt;/del&gt;&lt;/a&gt; as a dup, but here are my particular observations on this test/failure from that issue...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestReplicationHandler -Dtests.method=doTestReplicateAfterCoreReload -Dtests.seed=6F2AD3669775C0E9 -Dtests.nightly=true -Dtests.slow=true -Dtests.locale=ky-KG -Dtests.timezone=Etc/GMT+10 -Dtests.asserts=true -Dtests.file.encoding=ANSI_X3.4-1968
   [junit4] FAILURE 57.2s | TestReplicationHandler.doTestReplicateAfterCoreReload &amp;lt;&amp;lt;&amp;lt;

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;A few misc observations...&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;this line is comparing the commits on master &lt;em&gt;now&lt;/em&gt; to the commits on master just prior to a core reload
	&lt;ul&gt;
		&lt;li&gt;so failure has nothing to do with replicaiton&lt;/li&gt;
		&lt;li&gt;Looks like a merge is happening before/after reload &amp;#8211; but before test gets list of commits?
		&lt;ul&gt;
			&lt;li&gt;Possible from RandomMergePolicy?&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;At this line where this test fails, a non-nightly run won&apos;t have indexed a single doc &amp;#8211; so this particular failure will only be observable with &lt;tt&gt;-Dtests.nightly=true&lt;/tt&gt; ...
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; docs = TEST_NIGHTLY ? 200000 : 0;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;i don&apos;t understand the point of this test at all ... it doesn&apos;t compare anything between master/slave except after a commit &amp;#8211; so where does the &quot;AfterCoreReload&quot; part come into play?
	&lt;ul&gt;
		&lt;li&gt;it&apos;s particularly wonky given that half of the asserts comparing master/slave are about haven an identical &lt;tt&gt;numFound=0&lt;/tt&gt; for a &lt;tt&gt;&amp;#42;:&amp;#42;&lt;/tt&gt; search against an empty index! (unless nightly)&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;p&gt;In response to some earlier comments here in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6286&quot; title=&quot;TestReplicationHandler.doTestReplicateAfterCoreReload reliably reproducing seed failures comparing master commits before/after reload&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6286&quot;&gt;&lt;del&gt;SOLR-6286&lt;/del&gt;&lt;/a&gt;...&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;... I&apos;d expect that since there were no pending changes, there&apos;s be no need to write a new segment. ...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That seems like a naive assumption given the randomized merge settings &amp;#8211; there could easily be background merges in other threads, or the randomized merge scheduler could decide to do an arbitrary/useless merge on commit (IIRC)&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;... This failure only happens sometimes. ...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Note my other comments above: this test is virtually useless unless you are running in nightly mode ... you&apos;ll never see this failure w/o it.&lt;/p&gt;

&lt;p&gt;When nightly node is enabled, the seeds i&apos;ve seen fail are reliable.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The indexversion doesn&apos;t change though and the slave says that it is in sync with the master. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m not sure what the test looked like when this comment was made, but as of right now on master this test never makes any attempt to verify the slave&apos;s replication status / indexversion after (master) core reload &amp;#8211; it only compares the slave numFound &lt;b&gt;before&lt;/b&gt; the core reload, and then again &lt;b&gt;after&lt;/b&gt; both the reload &lt;b&gt;AND&lt;/b&gt; an additional master commit &amp;#8211; an assert the test never reaches when failures like those listed in this issue happen &amp;#8211; so it&apos;s impossible to reliably say the slave is in sync with the master at that point (let alone if it was in sync after the core reload, but but before the subsequent additional adds/commits)&lt;/p&gt;</comment>
                            <comment id="15925005" author="hossman" created="Tue, 14 Mar 2017 21:09:02 +0000"  >&lt;p&gt;here&apos;s another reproducible seed (as of master 09bd8612ce82c2852542127eb24b887c7b332a0d)&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestReplicationHandler -Dtests.method=doTestReplicateAfterCoreReload -Dtests.seed=29F881D77A7556D8 -Dtests.nightly=true -Dtests.slow=true -Dtests.locale=en-NG -Dtests.timezone=Israel -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1
   [junit4] FAILURE 55.3s | TestReplicationHandler.doTestReplicateAfterCoreReload &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: expected:&amp;lt;[{indexVersion=1489525699190,generation=2,filelist=[_5u.fdt, _5u.fdx, _5u.fnm, _5u.nvd, _5u.nvm, _5u.si, _5u_FST50_0.doc, _5u_FST50_0.tfp, _5v.fdt, _5v.fdx, _5v.fnm, _5v.nvd, _5v.nvm, _5v.si, _5v_FST50_0.doc, _5v_FST50_0.tfp, _5w.fdt, _5w.fdx, _5w.fnm, _5w.nvd, _5w.nvm, _5w.si, _5w_FST50_0.doc, _5w_FST50_0.tfp, _5x.fdt, _5x.fdx, _5x.fnm, _5x.nvd, _5x.nvm, _5x.si, _5x_FST50_0.doc, _5x_FST50_0.tfp, _5y.fdt, _5y.fdx, _5y.fnm, _5y.nvd, _5y.nvm, _5y.si, _5y_FST50_0.doc, _5y_FST50_0.tfp, _5z.fdt, _5z.fdx, _5z.fnm, _5z.nvd, _5z.nvm, _5z.si, _5z_FST50_0.doc, _5z_FST50_0.tfp, _60.fdt, _60.fdx, _60.fnm, _60.nvd, _60.nvm, _60.si, _60_FST50_0.doc, _60_FST50_0.tfp, _61.fdt, _61.fdx, _61.fnm, _61.nvd, _61.nvm, _61.si, _61_FST50_0.doc, _61_FST50_0.tfp, _62.fdt, _62.fdx, _62.fnm, _62.nvd, _62.nvm, _62.si, _62_FST50_0.doc, _62_FST50_0.tfp, _63.fdt, _63.fdx, _63.fnm, _63.nvd, _63.nvm, _63.si, _63_FST50_0.doc, _63_FST50_0.tfp, _64.fdt, _64.fdx, _64.fnm, _64.nvd, _64.nvm, _64.si, _64_FST50_0.doc, _64_FST50_0.tfp, _65.fdt, _65.fdx, _65.fnm, _65.nvd, _65.nvm, _65.si, _65_FST50_0.doc, _65_FST50_0.tfp, _66.fdt, _66.fdx, _66.fnm, _66.nvd, _66.nvm, _66.si, _66_FST50_0.doc, _66_FST50_0.tfp, _67.fdt, _67.fdx, _67.fnm, _67.nvd, _67.nvm, _67.si, _67_FST50_0.doc, _67_FST50_0.tfp, _68.fdt, _68.fdx, _68.fnm, _68.nvd, _68.nvm, _68.si, _68_FST50_0.doc, _68_FST50_0.tfp, _69.fdt, _69.fdx, _69.fnm, _69.nvd, _69.nvm, _69.si, _69_FST50_0.doc, _69_FST50_0.tfp, _6a.fdt, _6a.fdx, _6a.fnm, _6a.nvd, _6a.nvm, _6a.si, _6a_FST50_0.doc, _6a_FST50_0.tfp, _6b.fdt, _6b.fdx, _6b.fnm, _6b.nvd, _6b.nvm, _6b.si, _6b_FST50_0.doc, _6b_FST50_0.tfp, _6c.fdt, _6c.fdx, _6c.fnm, _6c.nvd, _6c.nvm, _6c.si, _6c_FST50_0.doc, _6c_FST50_0.tfp, _6d.fdt, _6d.fdx, _6d.fnm, _6d.nvd, _6d.nvm, _6d.si, _6d_FST50_0.doc, _6d_FST50_0.tfp, _6e.fdt, _6e.fdx, _6e.fnm, _6e.nvd, _6e.nvm, _6e.si, _6e_FST50_0.doc, _6e_FST50_0.tfp, _6f.fdt, _6f.fdx, _6f.fnm, _6f.nvd, _6f.nvm, _6f.si, _6f_FST50_0.doc, _6f_FST50_0.tfp, _6h.fdt, _6h.fdx, _6h.fnm, _6h.nvd, _6h.nvm, _6h.si, _6h_FST50_0.doc, _6h_FST50_0.tfp, _6i.fdt, _6i.fdx, _6i.fnm, _6i.nvd, _6i.nvm, _6i.si, _6i_FST50_0.doc, _6i_FST50_0.tfp, segments_2]}]&amp;gt; but was:&amp;lt;[{indexVersion=1489525699190,generation=2,filelist=[_5u.fdt, _5u.fdx, _5u.fnm, _5u.nvd, _5u.nvm, _5u.si, _5u_FST50_0.doc, _5u_FST50_0.tfp, _5v.fdt, _5v.fdx, _5v.fnm, _5v.nvd, _5v.nvm, _5v.si, _5v_FST50_0.doc, _5v_FST50_0.tfp, _5w.fdt, _5w.fdx, _5w.fnm, _5w.nvd, _5w.nvm, _5w.si, _5w_FST50_0.doc, _5w_FST50_0.tfp, _5x.fdt, _5x.fdx, _5x.fnm, _5x.nvd, _5x.nvm, _5x.si, _5x_FST50_0.doc, _5x_FST50_0.tfp, _5y.fdt, _5y.fdx, _5y.fnm, _5y.nvd, _5y.nvm, _5y.si, _5y_FST50_0.doc, _5y_FST50_0.tfp, _5z.fdt, _5z.fdx, _5z.fnm, _5z.nvd, _5z.nvm, _5z.si, _5z_FST50_0.doc, _5z_FST50_0.tfp, _60.fdt, _60.fdx, _60.fnm, _60.nvd, _60.nvm, _60.si, _60_FST50_0.doc, _60_FST50_0.tfp, _61.fdt, _61.fdx, _61.fnm, _61.nvd, _61.nvm, _61.si, _61_FST50_0.doc, _61_FST50_0.tfp, _62.fdt, _62.fdx, _62.fnm, _62.nvd, _62.nvm, _62.si, _62_FST50_0.doc, _62_FST50_0.tfp, _63.fdt, _63.fdx, _63.fnm, _63.nvd, _63.nvm, _63.si, _63_FST50_0.doc, _63_FST50_0.tfp, _64.fdt, _64.fdx, _64.fnm, _64.nvd, _64.nvm, _64.si, _64_FST50_0.doc, _64_FST50_0.tfp, _65.fdt, _65.fdx, _65.fnm, _65.nvd, _65.nvm, _65.si, _65_FST50_0.doc, _65_FST50_0.tfp, _66.fdt, _66.fdx, _66.fnm, _66.nvd, _66.nvm, _66.si, _66_FST50_0.doc, _66_FST50_0.tfp, _67.fdt, _67.fdx, _67.fnm, _67.nvd, _67.nvm, _67.si, _67_FST50_0.doc, _67_FST50_0.tfp, _68.fdt, _68.fdx, _68.fnm, _68.nvd, _68.nvm, _68.si, _68_FST50_0.doc, _68_FST50_0.tfp, _69.fdt, _69.fdx, _69.fnm, _69.nvd, _69.nvm, _69.si, _69_FST50_0.doc, _69_FST50_0.tfp, _6a.fdt, _6a.fdx, _6a.fnm, _6a.nvd, _6a.nvm, _6a.si, _6a_FST50_0.doc, _6a_FST50_0.tfp, _6b.fdt, _6b.fdx, _6b.fnm, _6b.nvd, _6b.nvm, _6b.si, _6b_FST50_0.doc, _6b_FST50_0.tfp, _6c.fdt, _6c.fdx, _6c.fnm, _6c.nvd, _6c.nvm, _6c.si, _6c_FST50_0.doc, _6c_FST50_0.tfp, _6d.fdt, _6d.fdx, _6d.fnm, _6d.nvd, _6d.nvm, _6d.si, _6d_FST50_0.doc, _6d_FST50_0.tfp, _6e.fdt, _6e.fdx, _6e.fnm, _6e.nvd, _6e.nvm, _6e.si, _6e_FST50_0.doc, _6e_FST50_0.tfp, _6f.fdt, _6f.fdx, _6f.fnm, _6f.nvd, _6f.nvm, _6f.si, _6f_FST50_0.doc, _6f_FST50_0.tfp, _6h.fdt, _6h.fdx, _6h.fnm, _6h.nvd, _6h.nvm, _6h.si, _6h_FST50_0.doc, _6h_FST50_0.tfp, _6i.fdt, _6i.fdx, _6i.fnm, _6i.nvd, _6i.nvm, _6i.si, _6i_FST50_0.doc, _6i_FST50_0.tfp, segments_2]}, {indexVersion=1489525699190,generation=3,filelist=[_6f.fdt, _6f.fdx, _6f.fnm, _6f.nvd, _6f.nvm, _6f.si, _6f_FST50_0.doc, _6f_FST50_0.tfp, _6g.fdt, _6g.fdx, _6g.fnm, _6g.nvd, _6g.nvm, _6g.si, _6g_FST50_0.doc, _6g_FST50_0.tfp, _6h.fdt, _6h.fdx, _6h.fnm, _6h.nvd, _6h.nvm, _6h.si, _6h_FST50_0.doc, _6h_FST50_0.tfp, _6i.fdt, _6i.fdx, _6i.fnm, _6i.nvd, _6i.nvm, _6i.si, _6i_FST50_0.doc, _6i_FST50_0.tfp, segments_3]}]&amp;gt;
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([29F881D77A7556D8:C2F9AE70A3D58DB]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.handler.TestReplicationHandler.doTestReplicateAfterCoreReload(TestReplicationHandler.java:1279)
   [junit4]    &amp;gt; 	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
   [junit4]    &amp;gt; 	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
   [junit4]    &amp;gt; 	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
   [junit4]    &amp;gt; 	at java.base/java.lang.reflect.Method.invoke(Method.java:547)
   [junit4]    &amp;gt; 	at java.base/java.lang.Thread.run(Thread.java:844)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15925007" author="hossman" created="Tue, 14 Mar 2017 21:10:02 +0000"  >&lt;p&gt;updating summary to make it clear these aren&apos;t sporadic jenkins failures &amp;#8211; these are reliably reproducing seeds&lt;/p&gt;</comment>
                            <comment id="15925033" author="ichattopadhyaya" created="Tue, 14 Mar 2017 21:22:00 +0000"  >&lt;p&gt;Would something like this work?&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/lucene-solr/blob/master/solr/core/src/test/org/apache/solr/update/TestInPlaceUpdatesDistrib.java#L86-L92&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/master/solr/core/src/test/org/apache/solr/update/TestInPlaceUpdatesDistrib.java#L86-L92&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16302427" author="steve_rowe" created="Sat, 23 Dec 2017 13:11:54 +0000"  >&lt;p&gt;My Jenkins found a branch_7x seed that reproduced for me 4/5 times:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Checking out Revision 136b2581e854a205a5a2e2a6c3dcc288138f0ce1 (refs/remotes/origin/branch_7x)
[...]
   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestReplicationHandler -Dtests.method=doTestReplicateAfterCoreReload -Dtests.seed=918B31009F59FEFF -Dtests.multiplier=2 -Dtests.nightly=true -Dtests.slow=true -Dtests.linedocsfile=/home/jenkins/lucene-data/enwiki.random.lines.txt -Dtests.locale=en-IE -Dtests.timezone=Australia/North -Dtests.asserts=true -Dtests.file.encoding=US-ASCII
   [junit4] FAILURE 67.8s J2 | TestReplicationHandler.doTestReplicateAfterCoreReload &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: expected:&amp;lt;[{indexVersion=1513967793357,generation=2,filelist=[_0.fdt, _0.fdx, _0.fnm, _0.nvd, _0.nvm, _0.si, _0_BlockTreeOrds_0.doc, _0_BlockTreeOrds_0.tio, _0_BlockTreeOrds_0.tipo, _1.fdt, _1.fdx, _1.fnm, _1.nvd, _1.nvm, _1.si, _1_BlockTreeOrds_0.doc, _1_BlockTreeOrds_0.tio, _1_BlockTreeOrds_0.tipo, _2.fdt, _2.fdx, _2.fnm, _2.nvd, _2.nvm, _2.si, _2_BlockTreeOrds_0.doc, _2_BlockTreeOrds_0.tio, _2_BlockTreeOrds_0.tipo, _3.fdt, _3.fdx, _3.fnm, _3.nvd, _3.nvm, _3.si, _3_BlockTreeOrds_0.doc, _3_BlockTreeOrds_0.tio, _3_BlockTreeOrds_0.tipo, _4.fdt, _4.fdx, _4.fnm, _4.nvd, _4.nvm, _4.si, _4_BlockTreeOrds_0.doc, _4_BlockTreeOrds_0.tio, _4_BlockTreeOrds_0.tipo, _5.fdt, _5.fdx, _5.fnm, _5.nvd, _5.nvm, _5.si, _5_BlockTreeOrds_0.doc, _5_BlockTreeOrds_0.tio, _5_BlockTreeOrds_0.tipo, segments_2]}]&amp;gt; but was:&amp;lt;[{indexVersion=1513967793357,generation=2,filelist=[_0.fdt, _0.fdx, _0.fnm, _0.nvd, _0.nvm, _0.si, _0_BlockTreeOrds_0.doc, _0_BlockTreeOrds_0.tio, _0_BlockTreeOrds_0.tipo, _1.fdt, _1.fdx, _1.fnm, _1.nvd, _1.nvm, _1.si, _1_BlockTreeOrds_0.doc, _1_BlockTreeOrds_0.tio, _1_BlockTreeOrds_0.tipo, _2.fdt, _2.fdx, _2.fnm, _2.nvd, _2.nvm, _2.si, _2_BlockTreeOrds_0.doc, _2_BlockTreeOrds_0.tio, _2_BlockTreeOrds_0.tipo, _3.fdt, _3.fdx, _3.fnm, _3.nvd, _3.nvm, _3.si, _3_BlockTreeOrds_0.doc, _3_BlockTreeOrds_0.tio, _3_BlockTreeOrds_0.tipo, _4.fdt, _4.fdx, _4.fnm, _4.nvd, _4.nvm, _4.si, _4_BlockTreeOrds_0.doc, _4_BlockTreeOrds_0.tio, _4_BlockTreeOrds_0.tipo, _5.fdt, _5.fdx, _5.fnm, _5.nvd, _5.nvm, _5.si, _5_BlockTreeOrds_0.doc, _5_BlockTreeOrds_0.tio, _5_BlockTreeOrds_0.tipo, segments_2]}, {indexVersion=1513967793357,generation=3,filelist=[_0.fdt, _0.fdx, _0.fnm, _0.nvd, _0.nvm, _0.si, _0_BlockTreeOrds_0.doc, _0_BlockTreeOrds_0.tio, _0_BlockTreeOrds_0.tipo, _1.fdt, _1.fdx, _1.fnm, _1.nvd, _1.nvm, _1.si, _1_BlockTreeOrds_0.doc, _1_BlockTreeOrds_0.tio, _1_BlockTreeOrds_0.tipo, _3.fdt, _3.fdx, _3.fnm, _3.nvd, _3.nvm, _3.si, _3_BlockTreeOrds_0.doc, _3_BlockTreeOrds_0.tio, _3_BlockTreeOrds_0.tipo, _4.fdt, _4.fdx, _4.fnm, _4.nvd, _4.nvm, _4.si, _4_BlockTreeOrds_0.doc, _4_BlockTreeOrds_0.tio, _4_BlockTreeOrds_0.tipo, _5.fdt, _5.fdx, _5.fnm, _5.nvd, _5.nvm, _5.si, _5_BlockTreeOrds_0.doc, _5_BlockTreeOrds_0.tio, _5_BlockTreeOrds_0.tipo, _6.cfe, _6.cfs, _6.si, segments_3]}]&amp;gt;
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([918B31009F59FEFF:B45C2A30EF11F0FC]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.handler.TestReplicationHandler.doTestReplicateAfterCoreReload(TestReplicationHandler.java:1277)
   [junit4]    &amp;gt; 	at java.lang.Thread.run(Thread.java:748)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16440132" author="steve_rowe" created="Mon, 16 Apr 2018 22:47:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman&quot; class=&quot;user-hover&quot; rel=&quot;hossman&quot;&gt;hossman&lt;/a&gt; wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;i don&apos;t understand the point of this test at all ... it doesn&apos;t compare anything between master/slave except after a commit &#8211; so where does the &quot;AfterCoreReload&quot; part come into play?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Explained here: &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2705?focusedCommentId=13082578&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13082578&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SOLR-2705?focusedCommentId=13082578&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13082578&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Rationale from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; for checking that commits are the same before/after a core reload, also from &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2705&quot; title=&quot;On reload, IndexWriterProvider holds onto the initial SolrCore it was created with&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2705&quot;&gt;&lt;del&gt;SOLR-2705&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I saw in the patch that you&apos;ve added getIndexversion and getCommits, but haven&apos;t used them.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Right - they where good for debugging and I figured I would use them to investigate &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2326&quot; title=&quot;Replication command indexversion fails to return index version&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2326&quot;&gt;SOLR-2326&lt;/a&gt;.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Can Junit check for indexversion/commits to be same right before and right after coreReload?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I&apos;ve committed this check.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I don&apos;t see how comparing commits before/after reload is providing useful information - as Hoss noted in a comment above in response to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt;&apos;s earlier commit:&lt;/p&gt;
&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;... I&apos;d expect that since there were no pending changes, there&apos;s be no need to write a new segment. ...&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;That seems like a naive assumption given the randomized merge settings &#8211; there could easily be background merges in other threads, or the randomized merge scheduler could decide to do an arbitrary/useless merge on commit (IIRC)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I&apos;ll attach a patch to remove this check from the test. &#160;I&apos;ll wait a couple days before committing in case there are objections.&lt;/p&gt;</comment>
                            <comment id="16440146" author="steve_rowe" created="Mon, 16 Apr 2018 23:11:04 +0000"  >&lt;p&gt;Responding to another of &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman&quot; class=&quot;user-hover&quot; rel=&quot;hossman&quot;&gt;hossman&lt;/a&gt;&apos;s comments:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;At this line where this test fails, a non-nightly run won&apos;t have indexed a single doc &#8211; so this particular failure will only be observable with -Dtests.nightly=true ...&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; docs = TEST_NIGHTLY ? 200000 : 0;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;

&lt;p&gt;I suspect that this was a typo when &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; committed it on &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4032&quot; title=&quot;Files larger than an internal buffer size fail to replicate&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4032&quot;&gt;&lt;del&gt;SOLR-4032&lt;/del&gt;&lt;/a&gt; (&lt;a href=&quot;http://svn.apache.org/viewvc/lucene/dev/trunk/solr/core/src/test/org/apache/solr/handler/TestReplicationHandler.java?r1=1414428&amp;amp;r2=1414427&amp;amp;pathrev=1414428&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc/lucene/dev/trunk/solr/core/src/test/org/apache/solr/handler/TestReplicationHandler.java?r1=1414428&amp;amp;r2=1414427&amp;amp;pathrev=1414428&lt;/a&gt;) - likely the intent was for the non-nightly doc count to remain at the &lt;tt&gt;10&lt;/tt&gt; docs it was before this change.&lt;/p&gt;</comment>
                            <comment id="16440151" author="steve_rowe" created="Mon, 16 Apr 2018 23:15:46 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;ll attach a patch to remove this check from the test. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Attached patch allows the most recently reported Jenkins seed to succeed, from &lt;a href=&quot;https://builds.apache.org/job/Lucene-Solr-NightlyTests-master/1529/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Lucene-Solr-NightlyTests-master/1529/&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Checking out Revision 487daab62978b9e331ffa59ce6be2b527e6b5526 (refs/remotes/origin/master)
[...]
   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestReplicationHandler -Dtests.method=doTestReplicateAfterCoreReload -Dtests.seed=9BA58DE2918DAC59 -Dtests.multiplier=2 -Dtests.nightly=true -Dtests.slow=true -Dtests.linedocsfile=/home/jenkins/jenkins-slave/workspace/Lucene-Solr-NightlyTests-master/test-data/enwiki.random.lines.txt -Dtests.locale=zh-HK -Dtests.timezone=America/Lower_Princes -Dtests.asserts=true -Dtests.file.encoding=US-ASCII
   [junit4] FAILURE 2053s J1 | TestReplicationHandler.doTestReplicateAfterCoreReload &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: expected:&amp;lt;[{indexVersion=1523670807821,generation=2,filelist=[_5zu.fdt, _5zu.fdx, _5zu.fnm, _5zu.nvd, _5zu.nvm, _5zu.si, _5zu_Asserting_0.doc, _5zu_Asserting_0.tim, _5zu_Asserting_0.tip, _5zv.cfe, _5zv.cfs, _5zv.si, _5zw.cfe, _5zw.cfs, _5zw.si, _5zx.cfe, _5zx.cfs, _5zx.si, _5zy.cfe, _5zy.cfs, _5zy.si, _5zz.cfe, _5zz.cfs, _5zz.si, _600.cfe, _600.cfs, _600.si, segments_2]}]&amp;gt; but was:&amp;lt;[{indexVersion=1523670807821,generation=2,filelist=[_5zu.fdt, _5zu.fdx, _5zu.fnm, _5zu.nvd, _5zu.nvm, _5zu.si, _5zu_Asserting_0.doc, _5zu_Asserting_0.tim, _5zu_Asserting_0.tip, _5zv.cfe, _5zv.cfs, _5zv.si, _5zw.cfe, _5zw.cfs, _5zw.si, _5zx.cfe, _5zx.cfs, _5zx.si, _5zy.cfe, _5zy.cfs, _5zy.si, _5zz.cfe, _5zz.cfs, _5zz.si, _600.cfe, _600.cfs, _600.si, segments_2]}, {indexVersion=1523670807821,generation=3,filelist=[_601.fdt, _601.fdx, _601.fnm, _601.nvd, _601.nvm, _601.si, _601_Asserting_0.doc, _601_Asserting_0.tim, _601_Asserting_0.tip, segments_3]}]&amp;gt;
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([9BA58DE2918DAC59:BE7296D2E1C5A25A]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.handler.TestReplicationHandler.doTestReplicateAfterCoreReload(TestReplicationHandler.java:1291)
   [junit4]    &amp;gt; 	at java.lang.Thread.run(Thread.java:748)
[...]
   [junit4]   2&amp;gt; NOTE: test params are: codec=Asserting(Lucene70), sim=Asserting(org.apache.lucene.search.similarities.AssertingSimilarity@7bf91bd5), locale=zh-HK, timezone=America/Lower_Princes
   [junit4]   2&amp;gt; NOTE: Linux 4.4.0-112-generic amd64/Oracle Corporation 1.8.0_152 (64-bit)/cpus=4,threads=1,free=87266800,total=527958016
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16440170" author="markrmiller@gmail.com" created="Mon, 16 Apr 2018 23:41:51 +0000"  >&lt;blockquote&gt;&lt;p&gt;likely the intent was for the non-nightly doc count to remain at the 10 docs it was before this change.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, mistake for sure. Small number of docs for normal runs and lots more for nightly was intent.&lt;/p&gt;</comment>
                            <comment id="16440171" author="markrmiller@gmail.com" created="Mon, 16 Apr 2018 23:43:00 +0000"  >&lt;blockquote&gt;&lt;p&gt;I don&apos;t see how comparing commits before/after reload is providing useful information&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Indeed, doesn&apos;t make sense to check around core reload.&lt;/p&gt;</comment>
                            <comment id="16440346" author="steve_rowe" created="Tue, 17 Apr 2018 03:42:46 +0000"  >&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;likely the intent was for the non-nightly doc count to remain at the 10 docs it was before this change.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yeah, mistake for sure. Small number of docs for normal runs and lots more for nightly was intent.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Cool, I&apos;ve updated the patch to up the non-nightly doc count.  Also added a CHANGES entry.&lt;/p&gt;</comment>
                            <comment id="16444611" author="jira-bot" created="Thu, 19 Apr 2018 18:50:07 +0000"  >&lt;p&gt;Commit 581983fd771b443d59696edb6eeef07e4a4442b5 in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=581983f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=581983f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6286&quot; title=&quot;TestReplicationHandler.doTestReplicateAfterCoreReload reliably reproducing seed failures comparing master commits before/after reload&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6286&quot;&gt;&lt;del&gt;SOLR-6286&lt;/del&gt;&lt;/a&gt;: TestReplicationHandler.doTestReplicateAfterCoreReload(): stop checking for identical commits before/after master core reload; and make non-nightly mode test 10 docs instead of 0.&lt;/p&gt;</comment>
                            <comment id="16444612" author="jira-bot" created="Thu, 19 Apr 2018 18:50:09 +0000"  >&lt;p&gt;Commit 46037dc67494a746857048399c02a6cf6f7a07c1 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=46037dc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=46037dc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6286&quot; title=&quot;TestReplicationHandler.doTestReplicateAfterCoreReload reliably reproducing seed failures comparing master commits before/after reload&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6286&quot;&gt;&lt;del&gt;SOLR-6286&lt;/del&gt;&lt;/a&gt;: TestReplicationHandler.doTestReplicateAfterCoreReload(): stop checking for identical commits before/after master core reload; and make non-nightly mode test 10 docs instead of 0.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13049336">SOLR-10251</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13144105">SOLR-12078</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12919329" name="SOLR-6286.patch" size="2082" author="sarowe" created="Tue, 17 Apr 2018 03:40:53 +0000"/>
                            <attachment id="12919298" name="SOLR-6286.patch" size="2082" author="sarowe" created="Mon, 16 Apr 2018 22:49:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>408159</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 30 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1y8dj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>408164</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>