<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:36:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-4842] Field faceting with local params affects successive field faceting parameters</title>
                <link>https://issues.apache.org/jira/browse/SOLR-4842</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4717&quot; title=&quot;SimpleFacets should respect localParams&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4717&quot;&gt;&lt;del&gt;SOLR-4717&lt;/del&gt;&lt;/a&gt; introduced local param support for per-field faceting, allowing the same field to be faceted in various ways.  There&apos;s a problem such that one fields local param setting will override the defaults of the next field.  For example: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8983/solr/query?q=*:*&amp;amp;facet=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;rows=0&amp;amp;facet.field={!facet.prefix=a}name&amp;amp;facet.field=features&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; where the facet.prefix for name affects the features faceting.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12648536">SOLR-4842</key>
            <summary>Field faceting with local params affects successive field faceting parameters</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ehatcher">Erik Hatcher</assignee>
                                    <reporter username="ehatcher">Erik Hatcher</reporter>
                        <labels>
                    </labels>
                <created>Tue, 21 May 2013 00:55:44 +0000</created>
                <updated>Mon, 9 May 2016 18:43:44 +0000</updated>
                            <resolved>Tue, 21 May 2013 17:59:32 +0000</resolved>
                                    <version>4.3</version>
                                    <fixVersion>4.3.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>search</component>
                    <component>SearchComponents - other</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13662535" author="ehatcher" created="Tue, 21 May 2013 00:58:10 +0000"  >&lt;p&gt;Here&apos;s a patch demonstrating a failing test case that should pass, demonstrating the corruption of one facet.field&apos;s local params into another facet.field.&lt;/p&gt;</comment>
                            <comment id="13662580" author="ehatcher" created="Tue, 21 May 2013 01:55:41 +0000"  >&lt;p&gt;I&apos;m not sure my patch actually shows the problem clearly yet.  facet.mincount and deprecated facet.zeros support still in there confuse things a bit.  I&apos;m still working through a test case showing the issue clearly.&lt;/p&gt;</comment>
                            <comment id="13662637" author="hossman" created="Tue, 21 May 2013 03:41:35 +0000"  >
&lt;p&gt;Erik: based on your followup comment, i ignored your patch and attempted to write a test to reproduce the general problem you described and could not do so &amp;#8211; see attached &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4842&quot; title=&quot;Field faceting with local params affects successive field faceting parameters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4842&quot;&gt;&lt;del&gt;SOLR-4842&lt;/del&gt;&lt;/a&gt;__hoss_tests.patch.&lt;/p&gt;

&lt;p&gt;if there is a bug, i suspect it must be something subtle in the way the defaults of a particular param are defined.  if you&apos;re having trouble writing a test aptch to demonstrate the problme you are seeing, can you at least describe a specific example query where you observe a problem?  even if you can&apos;t share the docs needed to seee the problem, knowing exactly what params may help narrow things down.&lt;/p&gt;
</comment>
                            <comment id="13662646" author="hossman" created="Tue, 21 May 2013 03:54:56 +0000"  >&lt;p&gt;Erik: ok, now looking at your test, i think it&apos;s just flawed.&lt;/p&gt;

&lt;p&gt;Ignore for a minute the issue of faceting multiple ways, ignore the &quot;foo&quot; key in the assertQ your patch modifies, ignore everything about it, delete it from the test, and just consider a query using only the &quot;bar&quot; key like so...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;      assertQ(&quot;ignore foo, look at bar&quot;,
              req(&quot;q&quot;, &quot;id:[42 TO 47]&quot;
                  ,&quot;facet&quot;, &quot;true&quot;
                  ,&quot;facet.zeros&quot;, &quot;false&quot;
                  ,&quot;fq&quot;, &quot;id:[42 TO 45]&quot;
                  ,&quot;facet.field&quot;, &quot;{!key=bar &quot; +
                     &quot;facet.missing=true &quot;+
                  &quot;}&quot;+fname
                  )
              ,&quot;*[count(//doc)=4]&quot;
              ,&quot;*[count(//lst[@name=&apos;bar&apos;]/int)=5]&quot;
              ,&quot;//lst[@name=&apos;bar&apos;]/int[not(@name)][.=&apos;1&apos;]&quot;
              );
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That test is still going to fail because facet.zeros=false but you are asserting that there should be 5 terms for &quot;bar&quot;.  the only way there could be 5 terms is if you include the terms with a  zero.&lt;/p&gt;

&lt;p&gt;I don&apos;t think the docs have never really specified what happens if you mix and match &quot;facet.mincount&quot; with the deprecated &quot;facet.zeros&quot; (ie: &quot;facet.mincount=1&amp;amp;facet.zeros=true&amp;amp;facet.field=XXX&quot;), let alone in the case of per-field overrides (ie: &quot;facet.mincount=1&amp;amp;f.XXX.facet.zeros=true&amp;amp;facet.field=XXX&quot;) &amp;#8211; i think it&apos;s fair game to say all bets are off in the new situation of localparams.  but in this specific case, there&apos;s no way it makes sense to think that the &quot;bar&quot; key should have a mincount of &quot;0&quot;.&lt;/p&gt;</comment>
                            <comment id="13662984" author="ehatcher" created="Tue, 21 May 2013 13:57:29 +0000"  >&lt;p&gt;Here&apos;s a patch that demonstrates the issue clearly.  The actual problem reported to me (via a customer) was about facet.prefix, but I tried to distill it to the mincount initially missing the weird mincount/zeros interaction.&lt;/p&gt;

&lt;p&gt;I&apos;ve added two test cases, one that passes as-is, the second fails, and the only difference is the order of the two facet.field params, one using a localparam of facet.prefix, the other not.&lt;/p&gt;</comment>
                            <comment id="13663012" author="ehatcher" created="Tue, 21 May 2013 14:28:09 +0000"  >&lt;p&gt;Here&apos;s a patch incorporating Hoss&apos; additional tests as well as my failing test and a fix in SimpleFacets in #parseParams logic when localParams == null which caused carrying over of previous local params.&lt;/p&gt;

&lt;p&gt;I&apos;m running the full test suite now and will await Hoss&apos; review (and maybe Ryan&apos;s eyes too?) before committing.&lt;/p&gt;</comment>
                            <comment id="13663048" author="ehatcher" created="Tue, 21 May 2013 15:18:41 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m running the full test suite now and will await Hoss&apos; review (and maybe Ryan&apos;s eyes too?) before committing.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Fresh branch_4x checkout with just this patch attached, &quot;ant test&quot; (from solr/ directory) gives me the following failures:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[junit4:junit4] Tests with failures:
[junit4:junit4]   - org.apache.solr.cloud.CollectionsAPIDistributedZkTest.testDistribSearch
[junit4:junit4]   - org.apache.solr.cloud.ZkCLITest.testUpConfigLinkConfigClearZk
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I can only presume this is unrelated to this patch.&lt;/p&gt;</comment>
                            <comment id="13663056" author="yseeley@gmail.com" created="Tue, 21 May 2013 15:30:27 +0000"  >&lt;p&gt;Confirmed bug w/ simple test on example data:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8983/solr/query?q=*:*&amp;amp;facet=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;rows=0&amp;amp;facet.field={!facet.prefix=a}name&amp;amp;facet.field=features&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The features constraints returned all start with &quot;a&quot; only.&lt;/p&gt;</comment>
                            <comment id="13663057" author="ehatcher" created="Tue, 21 May 2013 15:34:04 +0000"  >&lt;p&gt;adjusted example with Yonik&apos;s example since mincount is a red herring here.&lt;/p&gt;</comment>
                            <comment id="13663098" author="hossman" created="Tue, 21 May 2013 16:36:33 +0000"  >&lt;p&gt;Ugh ... i didn&apos;t realize how stateful param parsing had gotten i nthe faceting code.&lt;/p&gt;

&lt;p&gt;Erik&apos;s last patch had at least one bug remaining that affected range &amp;amp; date faceting because of the need to reset the &quot;required&quot; params.&lt;/p&gt;

&lt;p&gt;attached patch seems to fix that ... i don&apos;t see any other obvious bugs.&lt;/p&gt;</comment>
                            <comment id="13663117" author="yseeley@gmail.com" created="Tue, 21 May 2013 16:47:33 +0000"  >&lt;p&gt;Patch looks good, commit it!&lt;/p&gt;</comment>
                            <comment id="13663162" author="ehatcher" created="Tue, 21 May 2013 17:38:10 +0000"  >&lt;blockquote&gt;&lt;p&gt;Ugh ... i didn&apos;t realize how stateful param parsing had gotten i nthe faceting code.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, icky it is.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Erik&apos;s last patch had at least one bug remaining that affected range &amp;amp; date faceting because of the need to reset the &quot;required&quot; params.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hmmm... did you see a test failure?   I was wondering if that change you made was needed at the time but no tests were failing.  I added your one-line tweak in there.  If you added test cases in your patch I didn&apos;t catch that yet.  &lt;/p&gt;

&lt;p&gt;Committed to branch_4x and trunk.  Is there any other branch where this should go?&lt;/p&gt;</comment>
                            <comment id="13663168" author="steve_rowe" created="Tue, 21 May 2013 17:43:30 +0000"  >&lt;blockquote&gt;&lt;p&gt;Committed to branch_4x and trunk. Is there any other branch where this should go?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Erik, you set the fix version to 4.3.1, and in order for that to happen, this has to be committed on the lucene_solr_4_3 branch, no?&lt;/p&gt;</comment>
                            <comment id="13663169" author="yseeley@gmail.com" created="Tue, 21 May 2013 17:44:22 +0000"  >&lt;p&gt;I set the fix version &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  Erik, please do commit to the 43 branch.&lt;/p&gt;</comment>
                            <comment id="13663180" author="steve_rowe" created="Tue, 21 May 2013 17:50:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;I set the fix version &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Erik, please do commit to the 43 branch.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; - sorry guys, I looked at JIRA&apos;s All view and misinterpreted Erik&apos;s adding 5.0 as a fix version 2 hours ago as also adding 4.3.1, since it appears as if no fix version was previously set (empty left-hand column), and both 4.3.1 and 5.0 are in the right-hand column.&lt;/p&gt;</comment>
                            <comment id="13663184" author="hossman" created="Tue, 21 May 2013 17:51:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;I was wondering if that change you made was needed at the time but no tests were failing. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;because there were no tests using range on the same field multiple ways mixed with local params on only one of hte range facets.  ie: same bug you found with facet.prefix, but with any of hte facet.range.* params.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I added your one-line tweak in there. If you added test cases in your patch I didn&apos;t catch that yet. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;yes, the patch had a additional tests demonstrating the reason why reseting &quot;required&quot; was needed.&lt;/p&gt;
</comment>
                            <comment id="13663190" author="ehatcher" created="Tue, 21 May 2013 17:58:30 +0000"  >&lt;p&gt;Additional test case from Hoss picked up and committed.  Committed to trunk branch_4x, and lucene_solr_4_3&lt;/p&gt;</comment>
                            <comment id="13686928" author="shalinmangar" created="Tue, 18 Jun 2013 16:52:40 +0000"  >&lt;p&gt;Bulk close after 4.3.1 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12584032" name="SOLR-4842.patch" size="7127" author="hossman" created="Tue, 21 May 2013 16:36:33 +0000"/>
                            <attachment id="12584013" name="SOLR-4842.patch" size="6200" author="ehatcher" created="Tue, 21 May 2013 14:28:09 +0000"/>
                            <attachment id="12584009" name="SOLR-4842.patch" size="1958" author="ehatcher" created="Tue, 21 May 2013 13:57:29 +0000"/>
                            <attachment id="12583930" name="SOLR-4842.patch" size="1452" author="ehatcher" created="Tue, 21 May 2013 00:58:10 +0000"/>
                            <attachment id="12583949" name="SOLR-4842__hoss_tests.patch" size="3905" author="hossman" created="Tue, 21 May 2013 03:41:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>328891</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 23 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1kqtj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>329233</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>