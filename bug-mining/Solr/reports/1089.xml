<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:30:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-3589] Edismax parser does not honor mm parameter if analyzer splits a token</title>
                <link>https://issues.apache.org/jira/browse/SOLR-3589</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;With edismax mm set to 100%  if one of the tokens is split into two tokens by the analyzer chain (i.e. &quot;fire-fly&quot;  =&amp;gt; fire fly), the mm parameter is ignored and the equivalent of  OR query for &quot;fire OR fly&quot; is produced.&lt;br/&gt;
This is particularly a problem for languages that do not use white space to separate words such as Chinese or Japenese.&lt;/p&gt;

&lt;p&gt;See these messages for more discussion:&lt;br/&gt;
&lt;a href=&quot;http://lucene.472066.n3.nabble.com/edismax-parser-ignores-mm-parameter-when-tokenizer-splits-tokens-hypenated-words-WDF-splitting-etc-tc3991911.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://lucene.472066.n3.nabble.com/edismax-parser-ignores-mm-parameter-when-tokenizer-splits-tokens-hypenated-words-WDF-splitting-etc-tc3991911.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://lucene.472066.n3.nabble.com/edismax-parser-ignores-mm-parameter-when-tokenizer-splits-tokens-i-e-CJK-tc3991438.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://lucene.472066.n3.nabble.com/edismax-parser-ignores-mm-parameter-when-tokenizer-splits-tokens-i-e-CJK-tc3991438.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://lucene.472066.n3.nabble.com/Why-won-t-dismax-create-multiple-DisjunctionMaxQueries-when-autoGeneratePhraseQueries-is-false-tc3992109.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://lucene.472066.n3.nabble.com/Why-won-t-dismax-create-multiple-DisjunctionMaxQueries-when-autoGeneratePhraseQueries-is-false-tc3992109.html&lt;/a&gt;&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12596671">SOLR-3589</key>
            <summary>Edismax parser does not honor mm parameter if analyzer splits a token</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rcmuir">Robert Muir</assignee>
                                    <reporter username="tburtonwest">Tom Burton-West</reporter>
                        <labels>
                    </labels>
                <created>Mon, 2 Jul 2012 16:51:21 +0000</created>
                <updated>Mon, 9 May 2016 18:48:42 +0000</updated>
                            <resolved>Thu, 8 Nov 2012 12:03:15 +0000</resolved>
                                    <version>3.6</version>
                    <version>4.0-BETA</version>
                                    <fixVersion>3.6.2</fixVersion>
                    <fixVersion>4.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>search</component>
                        <due></due>
                            <votes>4</votes>
                                    <watches>12</watches>
                                                                                                                <comments>
                            <comment id="13418320" author="joelrosen" created="Thu, 19 Jul 2012 14:22:02 +0000"  >&lt;p&gt;A user in this thread reports this is a bug introduced in 3.6: &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://lucene.472066.n3.nabble.com/Dismax-Question-td3992446.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://lucene.472066.n3.nabble.com/Dismax-Question-td3992446.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;He says they reverted to 3.5 and it went away.&lt;/p&gt;

&lt;p&gt;However I just tried the same setup with Solr versions 3.5, 3.4, and 3.1, and I can verify that the behavior is the same in each, so now I doubt it was a bug introduced in 3.6.  Could it be something in the default configuration that changed between versions?&lt;/p&gt;</comment>
                            <comment id="13418537" author="tburtonwest" created="Thu, 19 Jul 2012 18:26:59 +0000"  >&lt;p&gt;I didn&apos;t see enough configuration information in that thread to determine whether they were reporting the same bug or some different bug or configuration issue. After reading that thread  I also verified that the problem reported here occurs with version 3.4.  So I think that the thread you cite may refer to a different issue.  If you do happen to find some configuration change that fixes the problem, please let me know.&lt;/p&gt;


&lt;p&gt;Tom  &lt;/p&gt;</comment>
                            <comment id="13435558" author="jkrupan" created="Wed, 15 Aug 2012 21:55:06 +0000"  >&lt;p&gt;The root problem is that with automatic phrase query generation turned off, by default and for the text_general field in particular, the core Lucene query parser is generating a query for the tuple of sub-terms using the default query operator, which is &quot;OR&quot; by default. There is no notion of an &quot;mm&quot; or min-match parameter down at that level in Lucene, which knows nothing about Solr or edismax or request parameters.&lt;/p&gt;

&lt;p&gt;As things stand, the only option is to set the default query operator, &quot;q.op&quot;, to &quot;AND&quot;.&lt;/p&gt;

&lt;p&gt;You can of course also turn on autoGeneratePhraseQueries or select an analyzer than doesn&apos;t split terms.&lt;/p&gt;

&lt;p&gt;At this point, I would advise resolving this issue as &quot;Won&apos;t Fix&quot;, although it could also be spun off into a Lucene issue to add support for min-match down at that level, which edismax can then also communicate with.&lt;/p&gt;
</comment>
                            <comment id="13435720" author="joelrosen" created="Thu, 16 Aug 2012 02:17:14 +0000"  >&lt;p&gt;It&apos;s not just mm.  You set q.op to AND and it does the same thing.&lt;/p&gt;

&lt;p&gt;The issue is that the query parser should treat the split tokens as separate tokens just as if they were separated by whitespace, but it doesn&apos;t.  If I use a smart Chinese tokenizer to split up a Chinese sentence into words, why can&apos;t the query parser treat those words exactly the same way it treats words from an English sentence?&lt;/p&gt;</comment>
                            <comment id="13435921" author="jkrupan" created="Thu, 16 Aug 2012 12:15:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;It&apos;s not just mm. You set q.op to AND and it does the same thing.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Joel, you&apos;re right. Upon closer inspection of the code, I see that the reason is that edismax never sets the Lucene default operator directly. Instead, it sets the default value of &quot;mm&quot; parameter to 100% if &quot;q.op&quot; is &quot;AND&quot;, and set&apos;s BooleanQuery.minNrShouldMatch to the number of optional terms. That is equivalent to setting the default Lucene query operator at the top-level boolean level, but has no effect for terms that get split down at the analyzer level. Oh well. Scratch that suggestion.&lt;/p&gt;

&lt;p&gt;I think I&apos;m back to wanting to suggest that edismax should actually set the Lucene-level default query operator if &quot;mm&quot; is 100%. I think that would fix the original problem and allow the user to choose whether to user &quot;mm&quot; or &quot;q.op&quot; to control AND/OR.&lt;/p&gt;</comment>
                            <comment id="13436045" author="jkrupan" created="Thu, 16 Aug 2012 15:45:43 +0000"  >&lt;blockquote&gt;&lt;p&gt;If I use a smart Chinese tokenizer to split up a Chinese sentence into words, why can&apos;t the query parser treat those words exactly the same way it treats words from an English sentence?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Indexing of whole documents can in fact treat text as if it were words from an English sentence, and split tokens do in fact behave as such in that context, but a query is not an English sentence or sentence in any natural language. Rather, a query is a structured expression composed of terms and operators, typically separated by whitespace or special operators such as parentheses. Portions of queries may look like natural language phrases or even whole sentences, but in reality they are sequences of terms and operators.&lt;/p&gt;

&lt;p&gt;In addition to being parsed according to the syntax of queries, as opposed to natural language processing or the raw token stream processing of an indexer, each of the query terms must be &quot;analyzed&quot; before the final form of the term can be generated into a Lucene Query structure. That analysis is performed separate form the &quot;parsing&quot; of the structured user query expression. That means that the processing of sub-terms that result from analysis is handled at a different level than source-level query terms that happen to &quot;look&quot; like English words. In other words, the sub-terms are processed by the &quot;query generator&quot; while the source terms were processed by the &quot;query parser&quot;. We loosely refer to the combination of (user) query parsing and (Lucene) query generation as &quot;the query parser&quot;, but it is important to distinguish (user query) &quot;parsing&quot; from (Lucene Query) &quot;generation&quot;.&lt;/p&gt;

&lt;p&gt;The query parser does its best to handle sub-terms reasonably, but expecting that they will magically handled the same exact way as source terms is somewhat impractical. That doesn&apos;t mean that there can&apos;t be improvement, but simply that a dose of realism is needed when considering the potential, challenges, and limits of query parsing/processing/generation.&lt;/p&gt;</comment>
                            <comment id="13436069" author="joelrosen" created="Thu, 16 Aug 2012 16:20:16 +0000"  >&lt;p&gt;Sounds to me like this is an English-centric design flaw with dismax.  The point of dismax is to intelligently process simple user-entered phrases, right?  If I understand correctly, it does this by looking at the terms entered and making some decisions about how to join them with AND or OR.  But it assumes that a term is a whitespace-delimited string, yes?  This is an incorrect assumption for Chinese.  If instead of making this assumption, dismax ran the analyzers first to determine what is and isn&apos;t a term, then I imagine you would get more predictable behavior across both whitespace delimited and non-whitespace delimited languages, and you wouldn&apos;t need any &quot;magical&quot; handling for different languages.&lt;/p&gt;</comment>
                            <comment id="13436082" author="jkrupan" created="Thu, 16 Aug 2012 16:40:09 +0000"  >&lt;p&gt;Be careful not to confuse dismax and edismax. They are two different query parsers, with different goals.&lt;/p&gt;

&lt;p&gt;One of edismax&apos;s goals was to support &quot;fielded queries&quot; (e.g., &quot;title:abc AND date:123&quot;) and the full Lucene query syntax. No typical analyzer will be able to tell you that title and date are field names.&lt;/p&gt;

&lt;p&gt;Not &quot;English-centric&quot;, but European/Latin-centric for sure. The edismax and classic Lucene query parsers share that heritage, based on whitespace, but the dismax query parser doesn&apos;t &quot;suffer&quot; from that same need to parse field names and operators.&lt;/p&gt;

&lt;p&gt;There is no question that better query parser support is needed for non-European/Latin languages, but that requires careful, high-level, overall design, which is a tall order for a fast-paced open source community where features tend to be looked at in isolation.&lt;/p&gt;

&lt;p&gt;One clarification...&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;assumes that a term is a whitespace-delimited string&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes and no. We need to be careful about distinguishing a &quot;source term&quot; - what the parser recognizes, which is whitespace delimited, from &quot;analyzed terms&quot; which are recognized and output by the field type analyzers. There is no requirement that the output terms be whitespace-delimited or that the input to an anlyzer be whitespace-delimited. So, the theory has been that even a whitespace-centric complex-structure query parser can also handle, for example, Chinese text. Obviously that hasn&apos;t worked out as cleanly as desired and more work is needed.&lt;/p&gt;</comment>
                            <comment id="13436454" author="jkrupan" created="Fri, 17 Aug 2012 00:04:36 +0000"  >&lt;p&gt;My proposal is for edismax to set the Lucene default query operator to &quot;AND&quot; if either: 1) &quot;q.op&quot; is &quot;AND&quot;, or 2) &quot;mm&quot; is &quot;100%&quot;.&lt;/p&gt;

&lt;p&gt;I think that will address the stated problem.&lt;/p&gt;

&lt;p&gt;Any objection?&lt;/p&gt;

&lt;p&gt;I&apos;ll try to come up with a patch, but a committer will be needed to apply it.&lt;/p&gt;</comment>
                            <comment id="13436468" author="yseeley@gmail.com" created="Fri, 17 Aug 2012 00:22:28 +0000"  >&lt;blockquote&gt;&lt;p&gt;My proposal is for edismax to set the Lucene default query operator to &quot;AND&quot;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hmmm, I dunno.  mm=100% is really only meant to apply to top level query terms, not structured lucene queries.&lt;/p&gt;

&lt;p&gt;For example, in (foo:x foo:(a b c))&lt;br/&gt;
It doesn&apos;t seem like a b c should all be mandatory just because there happens to be a default mm of 100% (and they are not today).&lt;/p&gt;</comment>
                            <comment id="13436484" author="jkrupan" created="Fri, 17 Aug 2012 00:45:04 +0000"  >&lt;p&gt;I could back off and simply say that edismax should set the Lucene default query operator to &quot;AND&quot; if &quot;q.op&quot; is &quot;AND&quot;, but that would not address this particular issue, which is complaining that mm won&apos;t force the split terms to be ANDed.&lt;/p&gt;

&lt;p&gt;If we really want to say that mm CAN&apos;T be used to force split terms to be ANDED, then we should really resolve this issue asinvalid/won&apos;t fix.&lt;/p&gt;

&lt;p&gt;I should probably file a separate issue for the fact that q.op is not obeyed for any but the top-level query.&lt;/p&gt;

&lt;p&gt;And, the wiki makes no mention of &quot;mm&quot; being intended only for the top level query.&lt;/p&gt;</comment>
                            <comment id="13436486" author="yseeley@gmail.com" created="Fri, 17 Aug 2012 00:48:37 +0000"  >&lt;p&gt;I was not saying that this issue shouldn&apos;t be fixed, but merely commenting on the negative consequences of one proposed solution.&lt;/p&gt;</comment>
                            <comment id="13437426" author="lancenorskog" created="Sat, 18 Aug 2012 22:23:35 +0000"  >&lt;p&gt;[&lt;br/&gt;
See &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3636&quot; title=&quot;edismax, synonyms and mm=100%&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3636&quot;&gt;&lt;del&gt;SOLR-3636&lt;/del&gt;&lt;/a&gt;, it&apos;s the same problem space but with synonym expansion. If &quot;Monkeyhouse&quot; expands to &quot;monkey house&quot;, then a dismax or edismax query finds words with either (&quot;monkey&quot; OR &quot;house&quot;). Must-match defaults to 100% so you would expect this to mean &quot;monkey&quot; AND &quot;house&quot;.&lt;/p&gt;

&lt;p&gt;This seems to be a multi-part problem.&lt;br/&gt;
] retracted as per below. Yes, synonyms are another box&apos;o&apos;fun. &lt;/p&gt;</comment>
                            <comment id="13437674" author="befehl" created="Mon, 20 Aug 2012 06:19:06 +0000"  >&lt;p&gt;I would not mix synonyms into this because they need a special seperate treatment.&lt;br/&gt;
It might work for &quot;monkeyhouse =&amp;gt; monkey house&quot; but what if you have synonyms like &quot;nuclear fission, kernspaltung, fissione nucleare&quot;?&lt;br/&gt;
You would expect to get a search like (nuclear AND fission) OR (kernspaltung) OR (fissione AND nucleare).&lt;br/&gt;
This is a simplified example just to show that if you include synonyms into this issue you also have to detect/parse/obey the kind of synonym mapping.&lt;/p&gt;</comment>
                            <comment id="13440583" author="tburtonwest" created="Thu, 23 Aug 2012 19:30:03 +0000"  >&lt;p&gt;Just repeated tests in Solr 4.0Beta and the bug behaves the same.&lt;/p&gt;</comment>
                            <comment id="13440667" author="tburtonwest" created="Thu, 23 Aug 2012 21:11:54 +0000"  >&lt;p&gt;File is gzipped. Unix line endings. Put document in solr/example/exampledocs.  Queries listed in file.&lt;/p&gt;</comment>
                            <comment id="13440669" author="tburtonwest" created="Thu, 23 Aug 2012 21:12:17 +0000"  >&lt;p&gt;I&apos;m not at the point where I understand the test cases for Edismax enough to write unit tests. If someone can point me to an example unit test somewhere that I could use to model a test please do.&lt;br/&gt;
  In the meantime, attached is a file which can be put in the Solr exampledocs directory and indexed.  Sample queries demonstrating the problem with English hyphenated words and with CJK are included &lt;/p&gt;</comment>
                            <comment id="13440670" author="tburtonwest" created="Thu, 23 Aug 2012 21:12:47 +0000"  >&lt;p&gt;See above note&lt;/p&gt;</comment>
                            <comment id="13454533" author="ndushay" created="Thu, 13 Sep 2012 01:00:02 +0000"  >&lt;p&gt;(comment redacted! &amp;#8211; I can&apos;t repeat the results today.  Perhaps I was missing a Solr commit ... since the index is behaving differently, and I didn&apos;t change the index, though I did restart Solr a few times.)&lt;/p&gt;

&lt;p&gt;(below left for historical purposes)&lt;/p&gt;

&lt;p&gt;I may have stumbled into something.   Try setting q.op explicitly.&lt;/p&gt;

&lt;p&gt;(baseurl)/select?q=fire-fly&lt;/p&gt;

&lt;p&gt;gives me a lot more results than&lt;/p&gt;

&lt;p&gt;(baseurl)/select?q=fire-fly&amp;amp;q.op=AND&lt;/p&gt;


&lt;p&gt;oddly,   q.op=OR   gives me the same results as setting it to AND.&lt;/p&gt;


&lt;p&gt;Why did I stumble into this?&lt;/p&gt;

&lt;p&gt;from &lt;a href=&quot;http://wiki.apache.org/solr/DisMaxQParserPlugin#mm_.28Minimum_.27Should.27_Match.29&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://wiki.apache.org/solr/DisMaxQParserPlugin#mm_.28Minimum_.27Should.27_Match.29&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&quot;In Solr 1.4 and prior, you should basically set mm=0 if you want the equivilent of q.op=OR, and mm=100% if you want the equivilent of q.op=AND. In 3.x and trunk the default value of mm is dictated by the q.op param (q.op=AND =&amp;gt; mm=100%; q.op=OR =&amp;gt; mm=0%). Keep in mind the default operator is effected by your schema.xml &amp;lt;solrQueryParser defaultOperator=&quot;xxx&quot;/&amp;gt; entry. In older versions of Solr the default value is 100% (all clauses must match)&quot;&lt;/p&gt;

&lt;p&gt;I have q.op set in my schema, thus:&lt;/p&gt;

&lt;p&gt;&amp;lt;solrQueryParser defaultOperator=&quot;AND&quot; /&amp;gt;&lt;/p&gt;

&lt;p&gt;but when I use the q.op parameter, I experience something different.  Wild! &lt;/p&gt;

&lt;p&gt;Does this give us any insights?&lt;/p&gt;</comment>
                            <comment id="13487310" author="ndushay" created="Tue, 30 Oct 2012 22:25:25 +0000"  >&lt;p&gt;Would this bug be addressed if this one is addressed?  &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-3833&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/LUCENE-3833&lt;/a&gt;  (add operator to lucene queryparser for term quorum)&lt;/p&gt;</comment>
                            <comment id="13488370" author="rcmuir" created="Thu, 1 Nov 2012 00:01:02 +0000"  >&lt;p&gt;Simple unit test, based on Tom&apos;s example.&lt;/p&gt;</comment>
                            <comment id="13488380" author="rcmuir" created="Thu, 1 Nov 2012 00:35:15 +0000"  >&lt;p&gt;here&apos;s my hack patch.&lt;/p&gt;

&lt;p&gt;no idea if its right... in particular i dont really know what is going on with this query parser in general.&lt;/p&gt;

&lt;p&gt;the high level idea is that we can detect if the &quot;multiple tokens&quot; are synonyms versus CJK by the coord setting of the BQ, since coord will be enabled in the e.g. CJK case (same as if it were whitespace), but disabled for synonyms.&lt;/p&gt;

&lt;p&gt;but it could be totally wrong: at least tests pass and it might give someone else some ideas or be a useful workaround &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;</comment>
                            <comment id="13488449" author="rcmuir" created="Thu, 1 Nov 2012 04:31:42 +0000"  >&lt;p&gt;I traced through the logic here, and added additional tests (e.g. multi-field aliasing for this CJK case).&lt;/p&gt;

&lt;p&gt;Actually I needed the logic in a different place, anyway I think this patch is significantly more baked.&lt;/p&gt;</comment>
                            <comment id="13488469" author="rcmuir" created="Thu, 1 Nov 2012 05:06:58 +0000"  >&lt;p&gt;More tests: I think this patch is ready actually.&lt;/p&gt;

&lt;p&gt;Its well contained, we only apply this when the analyzer splits a token (e.g. CJK), not to any structured queries and not for the synonyms case.&lt;/p&gt;</comment>
                            <comment id="13488932" author="rcmuir" created="Thu, 1 Nov 2012 18:57:22 +0000"  >&lt;p&gt;I pinged hossman on IRC for some feedback, ill update the tests to show we aren&apos;t changing behavior with synonyms: this isnt tested today.&lt;/p&gt;
</comment>
                            <comment id="13488988" author="rcmuir" created="Thu, 1 Nov 2012 20:07:05 +0000"  >&lt;p&gt;patch with the added synonyms test.&lt;/p&gt;</comment>
                            <comment id="13491918" author="tburtonwest" created="Tue, 6 Nov 2012 22:50:12 +0000"  >&lt;p&gt;Back-port to 3.6 branch&lt;/p&gt;</comment>
                            <comment id="13491922" author="tburtonwest" created="Tue, 6 Nov 2012 22:57:54 +0000"  >&lt;p&gt;I back-ported to 3.6 branch.  Forgot to change the name from &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3589&quot; title=&quot;Edismax parser does not honor mm parameter if analyzer splits a token&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3589&quot;&gt;&lt;del&gt;SOLR-3589&lt;/del&gt;&lt;/a&gt;.patch, so the 6/Nov/12 patch is the 3.6 patch against yesterdays svn version of 3.6.&lt;/p&gt;

&lt;p&gt;Main difference I saw between 3.6 and 4.0 is that Solr 4.0 uses DisMaxQParser.parseMinShouldMatch() to set the default at 0% if q.op=OR and %100 if q.op =AND&lt;/p&gt;

&lt;p&gt;I just kept the 3.6 behavior which uses 3.6 default of 100% (if mm is not set)&lt;/p&gt;

&lt;p&gt;I&apos;ll test the 3.6 patch against a production index tomorrow.&lt;/p&gt;

</comment>
                            <comment id="13492048" author="rcmuir" created="Wed, 7 Nov 2012 01:47:22 +0000"  >&lt;p&gt;Hi Tom: thanks for working on the 3.6 backport!&lt;/p&gt;

&lt;p&gt;I&apos;ll commit the trunk/4.x patch first, and wait for your testing and review your patch before looking at 3.6!&lt;/p&gt;</comment>
                            <comment id="13492095" author="rcmuir" created="Wed, 7 Nov 2012 03:40:40 +0000"  >&lt;p&gt;Committed to trunk/4.x.&lt;/p&gt;

&lt;p&gt;Will look tomorrow at 3.6.&lt;/p&gt;</comment>
                            <comment id="13492487" author="tburtonwest" created="Wed, 7 Nov 2012 16:41:07 +0000"  >&lt;p&gt;Forgot to work from your latest patch with the synonyms test.   I&apos;ll post a new backport of the patch with the synonyms test and against the latest 3.6x in svn shortly&lt;/p&gt;</comment>
                            <comment id="13492535" author="tburtonwest" created="Wed, 7 Nov 2012 17:41:00 +0000"  >&lt;p&gt;Backport to 3.6 r1406713. Includes synonyms test.&lt;/p&gt;

&lt;p&gt;Will test in against production later today &lt;/p&gt;</comment>
                            <comment id="13492591" author="tburtonwest" created="Wed, 7 Nov 2012 19:01:04 +0000"  >&lt;p&gt;Hi Robert,&lt;/p&gt;

&lt;p&gt;I just put the backport to 3.6 up on our test server and pointed it to one of our production shards.  The improvement for Chinese queries  are dramatic.  (Especially for longer queries like the TREC 5 queries, see examples below)&lt;/p&gt;

&lt;p&gt;When you have time, please look over the backport of the patch.  I think it is fine but I would appreciate you looking it over.  My understanding of your patch is that it just affects a small portion of the edismax logic, but I don&apos;t understand the edismax parser well enough to be sure there isn&apos;t some difference between 3.6 and 4.0 that I didn&apos;t account for in the patch.&lt;/p&gt;

&lt;p&gt;Thanks for working on this.   Naomi and I are both very excited about this bug finally being fixed and want to put the fix into production soon.&lt;br/&gt;
&amp;#8212;&lt;br/&gt;
Example TREC 5 Chinese queries:&lt;/p&gt;

&lt;p&gt;&amp;lt;num&amp;gt; Number: CH4&lt;br/&gt;
&amp;lt;E-title&amp;gt; The newly discovered oil fields in China.&lt;br/&gt;
&amp;lt;C-title&amp;gt; &#20013;&#22269;&#22823;&#38470;&#26032;&#21457;&#29616;&#30340;&#27833;&#30000;   &lt;br/&gt;
40,135 items found for &#20013;&#22269;&#22823;&#38470;&#26032;&#21457;&#29616;&#30340;&#27833;&#30000; with current implementation (due to dismax bug)&lt;br/&gt;
78 items found for &#20013;&#22269;&#22823;&#38470;&#26032;&#21457;&#29616;&#30340;&#27833;&#30000; with patch&lt;/p&gt;

&lt;p&gt;&amp;lt;num&amp;gt; Number: CH10&lt;br/&gt;
&amp;lt;E-title&amp;gt; Border Trade in Xinjiang&lt;br/&gt;
&amp;lt;C-title&amp;gt; &#26032;&#30086;&#30340;&#36793;&#22659;&#36152;&#26131;  &lt;br/&gt;
20,249 items found for &#26032;&#30086;&#30340;&#36793;&#22659;&#36152;&#26131;  current implementation (with bug)&lt;br/&gt;
243 items found for &#26032;&#30086;&#30340;&#36793;&#22659;&#36152;&#26131;      with patch.&lt;/p&gt;</comment>
                            <comment id="13493133" author="rcmuir" created="Thu, 8 Nov 2012 12:03:15 +0000"  >&lt;p&gt;Backported to 3.6 branch in case we do a 3.6.2&lt;/p&gt;

&lt;p&gt;Thanks Tom!&lt;/p&gt;</comment>
                            <comment id="13493397" author="ndushay" created="Thu, 8 Nov 2012 19:09:56 +0000"  >&lt;p&gt;any chance this fix can be applied to dismax as well?&lt;/p&gt;</comment>
                            <comment id="13610588" author="commit-tag-bot" created="Fri, 22 Mar 2013 16:19:39 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; Robert Muir&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1406439&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1406439&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3589&quot; title=&quot;Edismax parser does not honor mm parameter if analyzer splits a token&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3589&quot;&gt;&lt;del&gt;SOLR-3589&lt;/del&gt;&lt;/a&gt;: Edismax parser does not honor mm parameter if analyzer splits a token&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12599211">SOLR-3636</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12603921">SOLR-3739</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12498784">SOLR-2368</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12552500" name="SOLR-3589-3.6.PATCH" size="10818" author="tburtonwest" created="Wed, 7 Nov 2012 17:41:00 +0000"/>
                            <attachment id="12552358" name="SOLR-3589.patch" size="10515" author="tburtonwest" created="Tue, 6 Nov 2012 22:50:12 +0000"/>
                            <attachment id="12551756" name="SOLR-3589.patch" size="8650" author="rcmuir" created="Thu, 1 Nov 2012 20:07:05 +0000"/>
                            <attachment id="12551672" name="SOLR-3589.patch" size="8095" author="rcmuir" created="Thu, 1 Nov 2012 05:06:58 +0000"/>
                            <attachment id="12551666" name="SOLR-3589.patch" size="5285" author="rcmuir" created="Thu, 1 Nov 2012 04:31:42 +0000"/>
                            <attachment id="12551654" name="SOLR-3589.patch" size="2977" author="rcmuir" created="Thu, 1 Nov 2012 00:35:15 +0000"/>
                            <attachment id="12551648" name="SOLR-3589_test.patch" size="1497" author="rcmuir" created="Thu, 1 Nov 2012 00:01:02 +0000"/>
                            <attachment id="12542190" name="testSolr3589.xml.gz" size="1067" author="tburtonwest" created="Thu, 23 Aug 2012 21:12:47 +0000"/>
                            <attachment id="12542189" name="testSolr3589.xml.gz" size="1067" author="tburtonwest" created="Thu, 23 Aug 2012 21:11:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>242267</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 35 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02n27:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>13337</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>