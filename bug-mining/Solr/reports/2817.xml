<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:11:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-8409] Complex q param in Streaming Expression results in a bad query</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8409</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;When providing an expression like &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;stream=search(people, fl=&lt;span class=&quot;code-quote&quot;&gt;&quot;id,first&quot;&lt;/span&gt;, sort=&lt;span class=&quot;code-quote&quot;&gt;&quot;first asc&quot;&lt;/span&gt;, q=&lt;span class=&quot;code-quote&quot;&gt;&quot;presentTitles:\&quot;&lt;/span&gt;chief executive officer\&lt;span class=&quot;code-quote&quot;&gt;&quot; AND age:[36 TO *]&quot;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;the following error is seen.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;no field name specified in query and no &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; specified via &lt;span class=&quot;code-quote&quot;&gt;&apos;df&apos;&lt;/span&gt; param
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I believe the issue is related to the \&quot; (escaped quotes) and the spaces in the q field. If I remove the spaces then the query returns results as expected (though I&apos;ve yet to validate if those results are accurate).&lt;/p&gt;

&lt;p&gt;This requires some investigation to get down to the root cause. I would like to fix it before Solr 6 is cut.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12921368">SOLR-8409</key>
            <summary>Complex q param in Streaming Expression results in a bad query</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dpgove">Dennis Gove</assignee>
                                    <reporter username="dpgove">Dennis Gove</reporter>
                        <labels>
                            <label>streaming</label>
                            <label>streaming_api</label>
                    </labels>
                <created>Sat, 12 Dec 2015 02:46:56 +0000</created>
                <updated>Mon, 9 May 2016 18:54:23 +0000</updated>
                            <resolved>Wed, 20 Apr 2016 02:36:56 +0000</resolved>
                                    <version>6.0</version>
                                    <fixVersion>6.0</fixVersion>
                                    <component>SolrJ</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15053981" author="dpgove" created="Sat, 12 Dec 2015 02:59:12 +0000"  >&lt;p&gt;I&apos;ve been unable to replicate this in a unit test but have seen it in a fully packaged version of trunk. (ant package was run and then the tarball was unpacked).&lt;/p&gt;

&lt;p&gt;Differences between unit test and packaged version:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;unit test is using dynamic fields while packaged version is using static fields&lt;/li&gt;
	&lt;li&gt;unit test is not going through the StreamHandler&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15053995" author="joel.bernstein" created="Sat, 12 Dec 2015 03:15:48 +0000"  >&lt;p&gt;What does the query look like after the Streaming Expression been&apos;s parsed?&lt;/p&gt;</comment>
                            <comment id="15053998" author="dpgove" created="Sat, 12 Dec 2015 03:23:33 +0000"  >&lt;p&gt;It looks like this&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;presentTitles:\&lt;span class=&quot;code-quote&quot;&gt;&quot;chief executive officer\&quot;&lt;/span&gt; AND age:[36 TO *]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I suspect that the \&quot; is the culprit here because the streaming expression parser does not remove the \ before the quote. As such, and this is a hunch, I suspect that the query parser is seeing \&quot; and not considering it a quote that is starting a phase but instead a quote that is just part of the string being searched.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;chief executive officer
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I believe this can be fixed by adding logic into the expression parser that will transform \&quot; into &quot; and in fact I&apos;ve written that code (very simple) but my lack of ability to replicate in a unit test is preventing me from ensuring the issue is actually fixed.&lt;/p&gt;</comment>
                            <comment id="15054004" author="dpgove" created="Sat, 12 Dec 2015 03:30:14 +0000"  >&lt;p&gt;Backing up my hunch is that if I change the q to be &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;presentTitles:\&lt;span class=&quot;code-quote&quot;&gt;&quot;chief\&quot;&lt;/span&gt; AND age:[36 TO *]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I get results back but  a very small subset of the results I would expect to get back.&lt;/p&gt;

&lt;p&gt;I&apos;ve yet to visually verify the source data but I would guess that there is a record containing a field value&lt;br/&gt;
&amp;lt;presentTitles&amp;gt;&quot;chief&quot;&amp;lt;/presentTitles&amp;gt;&lt;/p&gt;

&lt;p&gt;I&apos;ll check for that the next time I&apos;m looking into this (by Monday I suspect) but I&apos;d wager that I&apos;ll find it. &lt;/p&gt;</comment>
                            <comment id="15056147" author="dpgove" created="Mon, 14 Dec 2015 15:47:44 +0000"  >&lt;p&gt;This patch &lt;b&gt;appears&lt;/b&gt; to fix the issues. Still am unable to replicate in a unit test but I have confirmed that the issue I was seeing in a packaged setup is fixed with this patch. &lt;/p&gt;

&lt;p&gt;I&apos;ll want to wait until I can get a replicated test before I commit this.&lt;/p&gt;</comment>
                            <comment id="15057921" author="dpgove" created="Tue, 15 Dec 2015 11:44:58 +0000"  >&lt;p&gt;Interestingly, if I leave the q param out entirely I don&apos;t see any raised exception. Also, if I leave out a field to filter on I also don&apos;t see any raised exception. I&apos;ve confirmed the solrconfig-streaming.xml doesn&apos;t include either default q or df settings so I&apos;d expect to see an exception in both of these cases.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;search(collection1, fl=&lt;span class=&quot;code-quote&quot;&gt;&quot;id,a_s,a_i,a_f&quot;&lt;/span&gt;, sort=&lt;span class=&quot;code-quote&quot;&gt;&quot;a_f asc, a_i asc&quot;&lt;/span&gt;)
search(collection1, fl=&lt;span class=&quot;code-quote&quot;&gt;&quot;id,a_s,a_i,a_f&quot;&lt;/span&gt;, sort=&lt;span class=&quot;code-quote&quot;&gt;&quot;a_f asc, a_i asc&quot;&lt;/span&gt;, q=&lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15057983" author="dpgove" created="Tue, 15 Dec 2015 12:31:25 +0000"  >&lt;p&gt;I take that back. The file schema-streaming.xml contains the default query field&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;defaultSearchField&amp;gt;text&amp;lt;/defaultSearchField&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If I comment out that setting then I am able to replicate the failure described in this ticket - finally. I will create a couple valid tests replicating the issue and will commit the fix as soon as I can.&lt;/p&gt;</comment>
                            <comment id="15128297" author="joel.bernstein" created="Tue, 2 Feb 2016 14:15:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dpgove&quot; class=&quot;user-hover&quot; rel=&quot;dpgove&quot;&gt;dpgove&lt;/a&gt;, this looks like it&apos;s almost ready to go. Still shooting to get this in for 6.0?&lt;/p&gt;</comment>
                            <comment id="15129772" author="dpgove" created="Wed, 3 Feb 2016 04:40:36 +0000"  >&lt;p&gt;Yeah. Planning to commit tomorrow.&lt;/p&gt;</comment>
                            <comment id="15131494" author="dpgove" created="Thu, 4 Feb 2016 01:14:58 +0000"  >&lt;p&gt;This new patch ensures that escaped quotes in the parameters of a CloudSolrStream stream are properly re-escaped when converting back to a string expression. This is necessary for situations where the expression is passed off to workers.&lt;/p&gt;

&lt;p&gt;Note the comment in CloudSolrStream&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;      &lt;span class=&quot;code-comment&quot;&gt;// SOLR-8409: This is a special &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; where the params contain a &quot; character
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// Do note that in any other BASE streams with parameters where a &quot; might come into play
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// that &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; same replacement needs to take place.
&lt;/span&gt;      value = value.replace(&lt;span class=&quot;code-quote&quot;&gt;&quot;\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;\\\&quot;&quot;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I hope that this comment is heeded if additional base streams dealing with solr params are ever added.&lt;/p&gt;</comment>
                            <comment id="15131563" author="joel.bernstein" created="Thu, 4 Feb 2016 02:02:55 +0000"  >&lt;p&gt;One thing to check is how the SQLHandler is handling quotes. All queries are quoted by default. The TupleStreams are first built through constructors but they are serialized to streaming expressions and sent to worker nodes. Somehow we never tripped this bug in that scenario. &lt;/p&gt;</comment>
                            <comment id="15131579" author="joel.bernstein" created="Thu, 4 Feb 2016 02:12:50 +0000"  >&lt;p&gt;Just tried to trip this bug with this test case:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;params.put(CommonParams.QT, &lt;span class=&quot;code-quote&quot;&gt;&quot;/sql&quot;&lt;/span&gt;);
      params.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;numWorkers&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;);
      params.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;stmt&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;select str_s, count(*), sum(field_i), min(field_i), max(field_i), avg(field_i) from collection1 where text=&lt;span class=&quot;code-quote&quot;&gt;&apos;XXXX XXXX&apos;&lt;/span&gt; group by str_s order by sum(field_i) asc limit 2&quot;&lt;/span&gt;);

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This would have a query like this: text:&quot;XXXX XXXX&quot; which would be serialized and sent to workers. It works, so somehow the serialization was handling things. &lt;/p&gt;</comment>
                            <comment id="15131624" author="dpgove" created="Thu, 4 Feb 2016 02:52:33 +0000"  >&lt;p&gt;I believe if it were changed to &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;text=&lt;span class=&quot;code-quote&quot;&gt;&quot;XXXX XXXX&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;it would trip the failure. The issue is with double quotes because double quotes are used to wrap the parameter values. So a q param of&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;search(....., q=&lt;span class=&quot;code-quote&quot;&gt;&quot;text:\&quot;&lt;/span&gt;XXXX XXXX\&quot;&quot;, ..... )
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;would show the issue.&lt;/p&gt;

&lt;p&gt;The issue is that the q param given to Solr cannot include the \&quot; and should instead include just the &quot; around XXXX XXXX. So, to deal with that we have to replace \&quot; with &quot;. That then also requires that on the toExpression(...) we have to replace &quot; with \&quot;.&lt;/p&gt;</comment>
                            <comment id="15131627" author="jira-bot" created="Thu, 4 Feb 2016 02:58:41 +0000"  >&lt;p&gt;Commit 3528cc32cb634137cf389beaa9ecdc2036588d96 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dpgove&quot; class=&quot;user-hover&quot; rel=&quot;dpgove&quot;&gt;dpgove&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3528cc3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3528cc3&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8409&quot; title=&quot;Complex q param in Streaming Expression results in a bad query&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8409&quot;&gt;&lt;del&gt;SOLR-8409&lt;/del&gt;&lt;/a&gt;: Ensures that quotes in solr params (eg. q param) are properly handled&lt;/p&gt;</comment>
                            <comment id="15131660" author="joel.bernstein" created="Thu, 4 Feb 2016 03:33:54 +0000"  >&lt;p&gt;Ok this interesting. What&apos;s below is before this patch:&lt;/p&gt;

&lt;p&gt;I ran this test, which I expected to break because the parser would have trouble with quotes inside the quotes. I was surprised to find that it worked perfectly.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; expression = StreamExpressionParser.parse(&lt;span class=&quot;code-quote&quot;&gt;&quot;parallel(collection1,&quot;&lt;/span&gt;
                                              + &lt;span class=&quot;code-quote&quot;&gt;&quot;rollup(&quot;&lt;/span&gt;
                                                + &lt;span class=&quot;code-quote&quot;&gt;&quot;search(collection1, q=\&quot;&lt;/span&gt;a_s:(\&lt;span class=&quot;code-quote&quot;&gt;&quot;hello0\&quot;&lt;/span&gt; OR \&lt;span class=&quot;code-quote&quot;&gt;&quot;hello3\&quot;&lt;/span&gt; OR \&lt;span class=&quot;code-quote&quot;&gt;&quot;hello4\&quot;&lt;/span&gt;)\&lt;span class=&quot;code-quote&quot;&gt;&quot;, fl=\&quot;&lt;/span&gt;a_s,a_i,a_f\&lt;span class=&quot;code-quote&quot;&gt;&quot;, sort=\&quot;&lt;/span&gt;a_s asc\&lt;span class=&quot;code-quote&quot;&gt;&quot;, partitionKeys=\&quot;&lt;/span&gt;a_s\&lt;span class=&quot;code-quote&quot;&gt;&quot;),&quot;&lt;/span&gt;
                                                + &lt;span class=&quot;code-quote&quot;&gt;&quot;over=\&quot;&lt;/span&gt;a_s\&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;
                                                + &lt;span class=&quot;code-quote&quot;&gt;&quot;sum(a_i),&quot;&lt;/span&gt;
                                                + &lt;span class=&quot;code-quote&quot;&gt;&quot;sum(a_f),&quot;&lt;/span&gt;
                                                + &lt;span class=&quot;code-quote&quot;&gt;&quot;min(a_i),&quot;&lt;/span&gt;
                                                + &lt;span class=&quot;code-quote&quot;&gt;&quot;min(a_f),&quot;&lt;/span&gt;
                                                + &lt;span class=&quot;code-quote&quot;&gt;&quot;max(a_i),&quot;&lt;/span&gt;
                                                + &lt;span class=&quot;code-quote&quot;&gt;&quot;max(a_f),&quot;&lt;/span&gt;
                                                + &lt;span class=&quot;code-quote&quot;&gt;&quot;avg(a_i),&quot;&lt;/span&gt;
                                                + &lt;span class=&quot;code-quote&quot;&gt;&quot;avg(a_f),&quot;&lt;/span&gt;
                                                + &lt;span class=&quot;code-quote&quot;&gt;&quot;count(*)&quot;&lt;/span&gt;
                                              + &lt;span class=&quot;code-quote&quot;&gt;&quot;),&quot;&lt;/span&gt;
                                              + &lt;span class=&quot;code-quote&quot;&gt;&quot;workers=\&quot;&lt;/span&gt;2\&lt;span class=&quot;code-quote&quot;&gt;&quot;, zkHost=\&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;+zkServer.getZkAddress()+&quot;&lt;/span&gt;\&lt;span class=&quot;code-quote&quot;&gt;&quot;, sort=\&quot;&lt;/span&gt;a_s asc\&lt;span class=&quot;code-quote&quot;&gt;&quot;)&quot;&lt;/span&gt;
                                              );
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Below is the what was sent to the workers. Notice the quotes are not escaped at all:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;rollup(search(collection1,q=&lt;span class=&quot;code-quote&quot;&gt;&quot;a_s:(&quot;&lt;/span&gt;hello0&lt;span class=&quot;code-quote&quot;&gt;&quot; OR &quot;&lt;/span&gt;hello3&lt;span class=&quot;code-quote&quot;&gt;&quot; OR &quot;&lt;/span&gt;hello4&lt;span class=&quot;code-quote&quot;&gt;&quot;)&quot;&lt;/span&gt;,fl=&lt;span class=&quot;code-quote&quot;&gt;&quot;a_s,a_i,a_f&quot;&lt;/span&gt;,sort=&lt;span class=&quot;code-quote&quot;&gt;&quot;a_s asc&quot;&lt;/span&gt;,partitionKeys=a_s,zkHost=&lt;span class=&quot;code-quote&quot;&gt;&quot;127.0.0.1:52813/solr&quot;&lt;/span&gt;),over=a_s,sum(a_i),sum(a_f),min(a_i),min(a_f),max(a_i),max(a_f),avg(a_i),avg(a_f),count(*))

rollup(search(collection1,q=&lt;span class=&quot;code-quote&quot;&gt;&quot;a_s:(&quot;&lt;/span&gt;hello0&lt;span class=&quot;code-quote&quot;&gt;&quot; OR &quot;&lt;/span&gt;hello3&lt;span class=&quot;code-quote&quot;&gt;&quot; OR &quot;&lt;/span&gt;hello4&lt;span class=&quot;code-quote&quot;&gt;&quot;)&quot;&lt;/span&gt;,fl=&lt;span class=&quot;code-quote&quot;&gt;&quot;a_s,a_i,a_f&quot;&lt;/span&gt;,sort=&lt;span class=&quot;code-quote&quot;&gt;&quot;a_s asc&quot;&lt;/span&gt;,partitionKeys=a_s,zkHost=&lt;span class=&quot;code-quote&quot;&gt;&quot;127.0.0.1:52813/solr&quot;&lt;/span&gt;),over=a_s,sum(a_i),sum(a_f),min(a_i),min(a_f),max(a_i),max(a_f),avg(a_i),avg(a_f),count(*))
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Below is what was sent from the workers to the shards. Notice that the query is correct. &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;   [junit4]   2&amp;gt; 36804 INFO  (qtp1665513927-67) [n:127.0.0.1:52821_ c:collection1 s:shard2 r:core_node1 x:collection1] o.a.s.c.S.Request [collection1]  webapp= path=/select params={q=a_s:(&lt;span class=&quot;code-quote&quot;&gt;&quot;hello0&quot;&lt;/span&gt;+OR+&lt;span class=&quot;code-quote&quot;&gt;&quot;hello3&quot;&lt;/span&gt;+OR+&lt;span class=&quot;code-quote&quot;&gt;&quot;hello4&quot;&lt;/span&gt;)&amp;amp;distrib=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;fl=a_s,a_i,a_f&amp;amp;fq={!hash+workers%3D2+worker%3D0}&amp;amp;sort=a_s+asc&amp;amp;partitionKeys=a_s&amp;amp;wt=json&amp;amp;version=2.2} hits=3 status=0 QTime=1
   [junit4]   2&amp;gt; 36804 INFO  (qtp637545437-123) [n:127.0.0.1:52829_ c:collection1 s:shard2 r:core_node3 x:collection1] o.a.s.c.S.Request [collection1]  webapp= path=/select params={q=a_s:(&lt;span class=&quot;code-quote&quot;&gt;&quot;hello0&quot;&lt;/span&gt;+OR+&lt;span class=&quot;code-quote&quot;&gt;&quot;hello3&quot;&lt;/span&gt;+OR+&lt;span class=&quot;code-quote&quot;&gt;&quot;hello4&quot;&lt;/span&gt;)&amp;amp;distrib=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;fl=a_s,a_i,a_f&amp;amp;fq={!hash+workers%3D2+worker%3D1}&amp;amp;sort=a_s+asc&amp;amp;partitionKeys=a_s&amp;amp;wt=json&amp;amp;version=2.2} hits=3 status=0 QTime=1
   [junit4]   2&amp;gt; 36804 INFO  (qtp682745908-97) [n:127.0.0.1:52825_ c:collection1 s:shard1 r:core_node2 x:collection1] o.a.s.c.S.Request [collection1]  webapp= path=/select params={q=a_s:(&lt;span class=&quot;code-quote&quot;&gt;&quot;hello0&quot;&lt;/span&gt;+OR+&lt;span class=&quot;code-quote&quot;&gt;&quot;hello3&quot;&lt;/span&gt;+OR+&lt;span class=&quot;code-quote&quot;&gt;&quot;hello4&quot;&lt;/span&gt;)&amp;amp;distrib=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;fl=a_s,a_i,a_f&amp;amp;fq={!hash+workers%3D2+worker%3D1}&amp;amp;sort=a_s+asc&amp;amp;partitionKeys=a_s&amp;amp;wt=json&amp;amp;version=2.2} hits=1 status=0 QTime=0
   [junit4]   2&amp;gt; 36804 INFO  (qtp682745908-471) [n:127.0.0.1:52825_ c:collection1 s:shard1 r:core_node2 x:collection1] o.a.s.c.S.Request [collection1]  webapp= path=/select params={q=a_s:(&lt;span class=&quot;code-quote&quot;&gt;&quot;hello0&quot;&lt;/span&gt;+OR+&lt;span class=&quot;code-quote&quot;&gt;&quot;hello3&quot;&lt;/span&gt;+OR+&lt;span class=&quot;code-quote&quot;&gt;&quot;hello4&quot;&lt;/span&gt;)&amp;amp;distrib=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;fl=a_s,a_i,a_f&amp;amp;fq={!hash+workers%3D2+worker%3D0}&amp;amp;sort=a_s+asc&amp;amp;partitionKeys=a_s&amp;amp;wt=json&amp;amp;version=2.2} hits=3 status=0 QTime=0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So it appears that the parser doesn&apos;t even need the quotes nested within quotes to be escaped. I&apos;m assuming that&apos;s because it&apos;s splitting on the comma and the equals sign and then removing the outer quotes.&lt;/p&gt;
</comment>
                            <comment id="15131674" author="dpgove" created="Thu, 4 Feb 2016 03:46:51 +0000"  >&lt;p&gt;Try putting a space inside the quote for the q param. That is where I saw the failure that prompted this ticket. So&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;search(collection1, q=\&lt;span class=&quot;code-quote&quot;&gt;&quot;a_s:(\&quot;&lt;/span&gt;hello0 hellospace\&lt;span class=&quot;code-quote&quot;&gt;&quot; OR \&quot;&lt;/span&gt;hello3\&lt;span class=&quot;code-quote&quot;&gt;&quot; OR \&quot;&lt;/span&gt;hello4\&lt;span class=&quot;code-quote&quot;&gt;&quot;)\&quot;&lt;/span&gt;, fl=\&lt;span class=&quot;code-quote&quot;&gt;&quot;a_s,a_i,a_f\&quot;&lt;/span&gt;, sort=\&lt;span class=&quot;code-quote&quot;&gt;&quot;a_s asc\&quot;&lt;/span&gt;, partitionKeys=\&lt;span class=&quot;code-quote&quot;&gt;&quot;a_s\&quot;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15132259" author="joel.bernstein" created="Thu, 4 Feb 2016 12:54:51 +0000"  >&lt;p&gt;It took me while to grasp this ticket because it&apos;s so hard to reproduce the exception. But I think I&apos;ve got it now. Basically the instructions to users are:&lt;/p&gt;

&lt;p&gt;If you have to use quotes in your query then escape the quotes:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;search(collection1, q=&lt;span class=&quot;code-quote&quot;&gt;&quot;blah \&quot;&lt;/span&gt;stuff stuff\&lt;span class=&quot;code-quote&quot;&gt;&quot; blah&quot;&lt;/span&gt;, ...)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ll do some more testing with the SQLHandler to make sure everything is working properly with the quotes.&lt;/p&gt;</comment>
                            <comment id="15134470" author="jira-bot" created="Fri, 5 Feb 2016 17:02:14 +0000"  >&lt;p&gt;Commit 3528cc32cb634137cf389beaa9ecdc2036588d96 in lucene-solr&apos;s branch refs/heads/lucene-6997 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dpgove&quot; class=&quot;user-hover&quot; rel=&quot;dpgove&quot;&gt;dpgove&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3528cc3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3528cc3&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8409&quot; title=&quot;Complex q param in Streaming Expression results in a bad query&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8409&quot;&gt;&lt;del&gt;SOLR-8409&lt;/del&gt;&lt;/a&gt;: Ensures that quotes in solr params (eg. q param) are properly handled&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12902422">SOLR-8125</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12786156" name="SOLR-8409.patch" size="5599" author="dpgove" created="Thu, 4 Feb 2016 01:14:58 +0000"/>
                            <attachment id="12777482" name="SOLR-8409.patch" size="972" author="dpgove" created="Mon, 14 Dec 2015 15:47:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 41 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2pt2f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>