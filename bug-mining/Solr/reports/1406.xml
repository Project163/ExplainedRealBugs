<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:36:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-4734] Leader election fails with an NPE if there is no UpdateLog.</title>
                <link>https://issues.apache.org/jira/browse/SOLR-4734</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The following setup and steps always lead to the same error:&lt;br/&gt;
app01: ZooKeeper&lt;br/&gt;
app02: ZooKeeper, Solr (in Tomcat)&lt;br/&gt;
app03: ZooKeeper, Solr (in Tomcat) &lt;/p&gt;


&lt;p&gt;*) Start ZooKeeper as ensemble on all machines.&lt;br/&gt;
*) Start tomcat on app02/app03&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;clusterstate.json&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-javascript&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
cZxid = 0x100000014
ctime = Thu Apr 18 10:59:24 CEST 2013
mZxid = 0x100000014
mtime = Thu Apr 18 10:59:24 CEST 2013
pZxid = 0x100000014
cversion = 0
dataVersion = 0
aclVersion = 0
ephemeralOwner = 0x0
dataLength = 0
numChildren = 0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;*) Upload the configuration (on app02) for the collection via the following command:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    zkcli.sh -cmd upconfig --zkhost app01:4181,app02:4181,app03:4181 --confdir config/solr/storage/conf/ --confname storage-conf 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;*) Linking the configuration (on app02) via the following command:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    zkcli.sh -cmd linkconfig --collection storage --confname storage-conf --zkhost app01:4181,app02:4181,app03:4181
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;*) Create Collection via: &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;http://app02/solr/admin/collections?action=CREATE&amp;amp;name=storage&amp;amp;numShards=1&amp;amp;replicationFactor=2&amp;amp;collection.configName=storage-conf
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;clusterstate.json&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-javascript&quot;&gt;{&lt;span class=&quot;code-quote&quot;&gt;&quot;storage&quot;&lt;/span&gt;:{
    &lt;span class=&quot;code-quote&quot;&gt;&quot;shards&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;shard1&quot;&lt;/span&gt;:{
        &lt;span class=&quot;code-quote&quot;&gt;&quot;range&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;80000000-7fffffff&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;state&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;active&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;replicas&quot;&lt;/span&gt;:{
          &lt;span class=&quot;code-quote&quot;&gt;&quot;app02:9985_solr_storage_shard1_replica2&quot;&lt;/span&gt;:{
            &lt;span class=&quot;code-quote&quot;&gt;&quot;shard&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;shard1&quot;&lt;/span&gt;,
            &lt;span class=&quot;code-quote&quot;&gt;&quot;state&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;down&quot;&lt;/span&gt;,
            &lt;span class=&quot;code-quote&quot;&gt;&quot;core&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;storage_shard1_replica2&quot;&lt;/span&gt;,
            &lt;span class=&quot;code-quote&quot;&gt;&quot;collection&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;storage&quot;&lt;/span&gt;,
            &lt;span class=&quot;code-quote&quot;&gt;&quot;node_name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;app02:9985_solr&quot;&lt;/span&gt;,
            &lt;span class=&quot;code-quote&quot;&gt;&quot;base_url&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//app02:9985/solr&quot;&lt;/span&gt;},
&lt;/span&gt;          &lt;span class=&quot;code-quote&quot;&gt;&quot;app03:9985_solr_storage_shard1_replica1&quot;&lt;/span&gt;:{
            &lt;span class=&quot;code-quote&quot;&gt;&quot;shard&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;shard1&quot;&lt;/span&gt;,
            &lt;span class=&quot;code-quote&quot;&gt;&quot;state&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;down&quot;&lt;/span&gt;,
            &lt;span class=&quot;code-quote&quot;&gt;&quot;core&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;storage_shard1_replica1&quot;&lt;/span&gt;,
            &lt;span class=&quot;code-quote&quot;&gt;&quot;collection&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;storage&quot;&lt;/span&gt;,
            &lt;span class=&quot;code-quote&quot;&gt;&quot;node_name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;app03:9985_solr&quot;&lt;/span&gt;,
            &lt;span class=&quot;code-quote&quot;&gt;&quot;base_url&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//app03:9985/solr&quot;&lt;/span&gt;}}}},
&lt;/span&gt;    &lt;span class=&quot;code-quote&quot;&gt;&quot;router&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;compositeId&quot;&lt;/span&gt;}}
cZxid = 0x100000014
ctime = Thu Apr 18 10:59:24 CEST 2013
mZxid = 0x100000047
mtime = Thu Apr 18 11:04:06 CEST 2013
pZxid = 0x100000014
cversion = 0
dataVersion = 2
aclVersion = 0
ephemeralOwner = 0x0
dataLength = 847
numChildren = 0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This creates the replication of the shard on app02 and app03, but neither of them is marked as leader, both are marked as DOWN.&lt;br/&gt;
And after wards I can not access the collection.&lt;br/&gt;
In the browser I get:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&quot;SEVERE: org.apache.solr.common.SolrException: no servers hosting shard:&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The following stacktrace in the logs:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Apr 18, 2013 11:04:05 AM org.apache.solr.common.SolrException log
SEVERE: org.apache.solr.common.SolrException: Error CREATEing SolrCore &lt;span class=&quot;code-quote&quot;&gt;&apos;storage_shard1_replica2&apos;&lt;/span&gt;: 
        at org.apache.solr.handler.admin.CoreAdminHandler.handleCreateAction(CoreAdminHandler.java:483)
        at org.apache.solr.handler.admin.CoreAdminHandler.handleRequestBody(CoreAdminHandler.java:140)
        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:135)
        at org.apache.solr.servlet.SolrDispatchFilter.handleAdminRequest(SolrDispatchFilter.java:591)
        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:192)
        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:141)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:243)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)
        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:225)
        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:169)
        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:168)
        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:98)
        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:118)
        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:407)
        at org.apache.coyote.http11.AbstractHttp11Processor.process(AbstractHttp11Processor.java:999)
        at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:565)
        at org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:307)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:722)
Caused by: org.apache.solr.common.cloud.ZooKeeperException: 
        at org.apache.solr.core.CoreContainer.registerInZk(CoreContainer.java:931)
        at org.apache.solr.core.CoreContainer.registerCore(CoreContainer.java:892)
        at org.apache.solr.core.CoreContainer.register(CoreContainer.java:841)
        at org.apache.solr.handler.admin.CoreAdminHandler.handleCreateAction(CoreAdminHandler.java:479)
        ... 19 more
Caused by: java.lang.NullPointerException
        at org.apache.solr.cloud.ShardLeaderElectionContext.runLeaderProcess(ElectionContext.java:190)
        at org.apache.solr.cloud.LeaderElector.runIamLeaderProcess(LeaderElector.java:156)
        at org.apache.solr.cloud.LeaderElector.checkIfIamLeader(LeaderElector.java:100)
        at org.apache.solr.cloud.LeaderElector.joinElection(LeaderElector.java:266)
        at org.apache.solr.cloud.ZkController.joinElection(ZkController.java:935)
        at org.apache.solr.cloud.ZkController.register(ZkController.java:761)
        at org.apache.solr.cloud.ZkController.register(ZkController.java:727)
        at org.apache.solr.core.CoreContainer.registerInZk(CoreContainer.java:908)
        ... 22 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I have attached a minimal set of configuration files which are needed to replicate this error, also containing the log files for the commands I have run in the order above.&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Linux 64bit on 3.2.0-33-generic kernel&lt;br/&gt;
Solr: 4.2.1&lt;br/&gt;
ZooKeeper: 3.4.5&lt;br/&gt;
Tomcat 7.0.27 &lt;/p&gt;</environment>
        <key id="12643168">SOLR-4734</key>
            <summary>Leader election fails with an NPE if there is no UpdateLog.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="markrmiller@gmail.com">Mark Miller</assignee>
                                    <reporter username="ae">Alexander Eibner</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 Apr 2013 09:36:30 +0000</created>
                <updated>Mon, 9 May 2016 18:55:09 +0000</updated>
                            <resolved>Wed, 15 May 2013 17:23:57 +0000</resolved>
                                    <version>4.2.1</version>
                    <version>4.3</version>
                                    <fixVersion>4.3.1</fixVersion>
                    <fixVersion>4.4</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>SolrCloud</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13635032" author="ae" created="Thu, 18 Apr 2013 09:38:05 +0000"  >&lt;p&gt;Minimal set of configurations for reproducing the error.&lt;/p&gt;

&lt;p&gt;Log files for the steps above&lt;/p&gt;</comment>
                            <comment id="13658327" author="markrmiller@gmail.com" created="Wed, 15 May 2013 13:00:56 +0000"  >&lt;p&gt;Could use a better erorr message - it&apos;s not finding an update log. Looking at a config your zip file, you have updatelog defined in the wrong place - it needs to be in updateHandler.&lt;/p&gt;</comment>
                            <comment id="13658431" author="elyograg" created="Wed, 15 May 2013 15:11:37 +0000"  >&lt;p&gt;One other thing in addition to Mark&apos;s note - the step where you link the config with zkcli isn&apos;t necessary, and at that point, the collection doesn&apos;t exist, so it can&apos;t be linked.&lt;/p&gt;

&lt;p&gt;The best-case scenario is that the linkconfig step isn&apos;t doing anything at all.  The worst-case scenario is that linkconfig puts something in zookeeper that prevents the CREATE from working properly.&lt;/p&gt;

&lt;p&gt;The CREATE action takes care of linking the config to the collection, via the collection.configName parameter.&lt;/p&gt;</comment>
                            <comment id="13658445" author="elyograg" created="Wed, 15 May 2013 15:20:19 +0000"  >&lt;p&gt;Another note: The linkconfig might in fact be failing, but you aren&apos;t seeing an error message because of &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4807&quot; title=&quot;zkcli - log4j is not configured, so no logging happens&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4807&quot;&gt;&lt;del&gt;SOLR-4807&lt;/del&gt;&lt;/a&gt;.  The fix for that problem will be in 4.3.1 when it gets released.  If you download the 4.3.1 source code (or a nightly build) and copy its cloud-scripts directory over to your 4.3.0 install, you&apos;ll have logging.&lt;/p&gt;</comment>
                            <comment id="13658459" author="markrmiller@gmail.com" created="Wed, 15 May 2013 15:30:31 +0000"  >&lt;blockquote&gt;&lt;p&gt;at that point, the collection doesn&apos;t exist, so it can&apos;t be linked.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You can link before the collection exists - this feature was added to support some more complicated scenarios. When the collection is actually created, it will find the link.&lt;/p&gt;</comment>
                            <comment id="13658478" author="elyograg" created="Wed, 15 May 2013 15:49:55 +0000"  >&lt;blockquote&gt;&lt;p&gt;You can link before the collection exists - this feature was added to support some more complicated scenarios. When the collection is actually created, it will find the link.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks, Mark.  I can always learn new things!  I think I can envision the scenario - upload the config, link it to the collection that doesn&apos;t exist yet, then skip the collections API and manually create each core with CoreAdmin.&lt;/p&gt;</comment>
                            <comment id="13659635" author="shalinmangar" created="Thu, 16 May 2013 15:26:09 +0000"  >&lt;p&gt;I&apos;ll backport this to 4.3.1 if there are no objections.&lt;/p&gt;</comment>
                            <comment id="13660404" author="shalinmangar" created="Fri, 17 May 2013 06:44:27 +0000"  >&lt;p&gt;Backported to 4.3.1 r1483669.&lt;/p&gt;

&lt;p&gt;Actually, this fix was already backported to 4.3.1 with &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4829&quot; title=&quot;transaction log reference leak&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4829&quot;&gt;&lt;del&gt;SOLR-4829&lt;/del&gt;&lt;/a&gt; so I just moved the change log entry to 4.3.1&lt;/p&gt;</comment>
                            <comment id="13660491" author="ae" created="Fri, 17 May 2013 08:58:34 +0000"  >&lt;p&gt;Thanks, yes the updateLog was the problem, sorry I did not see this.&lt;br/&gt;
Now the collection api calls work, but the cores will be created only on one node. &lt;br/&gt;
But this is another problem, posted to the users list.&lt;/p&gt;</comment>
                            <comment id="13686930" author="shalinmangar" created="Tue, 18 Jun 2013 16:52:40 +0000"  >&lt;p&gt;Bulk close after 4.3.1 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12579298" name="config-logs.zip" size="38917" author="ae" created="Thu, 18 Apr 2013 09:38:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>323578</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 23 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1jtsn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>323923</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>