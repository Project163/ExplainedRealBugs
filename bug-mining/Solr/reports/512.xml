<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:19:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-1469] TestReplicationHandler failure</title>
                <link>https://issues.apache.org/jira/browse/SOLR-1469</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;TestReplicationHandler seems to fail often.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12436721">SOLR-1469</key>
            <summary>TestReplicationHandler failure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="yseeley@gmail.com">Yonik Seeley</reporter>
                        <labels>
                    </labels>
                <created>Mon, 28 Sep 2009 01:40:52 +0000</created>
                <updated>Wed, 30 Mar 2011 15:45:47 +0000</updated>
                            <resolved>Mon, 2 Aug 2010 17:35:41 +0000</resolved>
                                                    <fixVersion>3.1</fixVersion>
                    <fixVersion>4.0-ALPHA</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12760133" author="yseeley@gmail.com" created="Mon, 28 Sep 2009 01:44:52 +0000"  >&lt;p&gt;Attaching one particular worrying failure.&lt;/p&gt;

&lt;p&gt;Testcase: testReplicateAfterWrite2Slave took 2.656 sec&lt;br/&gt;
        FAILED&lt;br/&gt;
expected:&amp;lt;1&amp;gt; but was:&amp;lt;0&amp;gt;&lt;br/&gt;
junit.framework.AssertionFailedError: expected:&amp;lt;1&amp;gt; but was:&amp;lt;0&amp;gt;&lt;br/&gt;
        at org.apache.solr.handler.TestReplicationHandler.testReplicateAfterWrite2Slave(TestReplicationHandler.java:424)&lt;/p&gt;

&lt;p&gt;So replication was disabled, a doc was added to the slave, but then the search for it failed.  How can that be?&lt;/p&gt;</comment>
                            <comment id="12760134" author="markrmiller@gmail.com" created="Mon, 28 Sep 2009 01:56:14 +0000"  >&lt;p&gt;Are you using Windows? Havn&apos;t gotten it to fail on Linux yet.&lt;/p&gt;

&lt;p&gt;Perhaps we should add a check of the status returned from index in there?&lt;/p&gt;</comment>
                            <comment id="12760146" author="yseeley@gmail.com" created="Mon, 28 Sep 2009 04:30:49 +0000"  >&lt;p&gt;OK, I think this particular one might be a bug in the test.&lt;br/&gt;
Replication is disabled only after the master commit - and in the test log provided it looks like the start of a replication sneeks in there, and finishes after the addDoc() on the slave.&lt;/p&gt;

&lt;p&gt;I&apos;ll leave the tests running in a loop tonight and see if moving the disableReplication before the master commit fixes things.&lt;/p&gt;</comment>
                            <comment id="12760236" author="yseeley@gmail.com" created="Mon, 28 Sep 2009 12:47:28 +0000"  >&lt;p&gt;I just committed the fix for the assertion failure above. &lt;br/&gt;
The failures left now are due to connection refused exceptions.&lt;/p&gt;</comment>
                            <comment id="12761947" author="yseeley@gmail.com" created="Sat, 3 Oct 2009 19:48:40 +0000"  >&lt;p&gt;Jetty still fails to come up occasionally, even after waiting 2 minutes.  I also tested with the latest Jetty 6.1.21 - same results.&lt;br/&gt;
At this point, it could still be a Solr bug or a Jetty bug.&lt;/p&gt;</comment>
                            <comment id="12894452" author="yseeley@gmail.com" created="Mon, 2 Aug 2010 03:12:36 +0000"  >&lt;p&gt;The Jetty bug has been fixed by &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2019&quot; title=&quot;Jetty sometimes randomly takes a long time to start&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2019&quot;&gt;&lt;del&gt;SOLR-2019&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The failures that Mark &amp;amp; I recently saw &lt;a href=&quot;http://search.lucidimagination.com/search/document/6d3f4d23cde4f1bd/solr_replication_test_case_failure&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://search.lucidimagination.com/search/document/6d3f4d23cde4f1bd/solr_replication_test_case_failure&lt;/a&gt;&lt;br/&gt;
looks due to sharing servers across test cases.&lt;/p&gt;

&lt;p&gt;setUp() cleans up inbetween, but that&apos;s part of the problem.  The commit from setup() can start replication before it can be disabled... and then it can complete right after the last add on the slave, wiping out the adds and causing the test to fail.&lt;/p&gt;</comment>
                            <comment id="12894551" author="yseeley@gmail.com" created="Mon, 2 Aug 2010 13:38:01 +0000"  >&lt;p&gt;Here&apos;s the log of the failure (fail1.txt)&lt;br/&gt;
The fix would seem to be simple.... but I&apos;m seeing some other strange stuff that looks off.&lt;/p&gt;

&lt;p&gt;Line 12818: you can see replication start right before it&apos;s disabled.&lt;br/&gt;
It&apos;s going after master index version 1280686155645.&lt;br/&gt;
&lt;b&gt;But&lt;/b&gt; if we look back to Line 16046, we see that that is not the newest master index!&lt;/p&gt;</comment>
                            <comment id="12894554" author="yseeley@gmail.com" created="Mon, 2 Aug 2010 14:23:46 +0000"  >&lt;p&gt;OK, it looks like the previous test method set up the master to only replicate on startup, and hence that would seem to be the reason why the wrong index version was being replicated.  The test only checked that when replication was enabled again that the doc added to the slave directly was gone - it did not check that it got the correct version of the index.&lt;/p&gt;</comment>
                            <comment id="12894556" author="yseeley@gmail.com" created="Mon, 2 Aug 2010 14:45:25 +0000"  >&lt;p&gt;OK, here&apos;s a patch that fixes some issues.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;To avoid the commit() in setUp() causing an unwanted replication event, it now first queries the master and if  there are any docs it deletes the index on the master and waits for that to replicate to the slave.&lt;/li&gt;
	&lt;li&gt;I moved testReplicateAfterWrite2Slave up in the file so it will run before anything that changes the default server configs (this gets around the problem where it was only replicating on startup)&lt;/li&gt;
	&lt;li&gt;I added some test code at the end of  testReplicateAfterWrite2Slave to ensure that the correct index was replicated&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12894612" author="yseeley@gmail.com" created="Mon, 2 Aug 2010 17:35:41 +0000"  >&lt;p&gt;committed to trunk and 3x.&lt;/p&gt;</comment>
                            <comment id="12894626" author="mikemccand" created="Mon, 2 Aug 2010 18:01:57 +0000"  >&lt;p&gt;Hmm TestReplicationHandler now takes much longer for me (~149 seconds).  Previously it was ~30 seconds.  Is this expected?&lt;/p&gt;</comment>
                            <comment id="12894630" author="yseeley@gmail.com" created="Mon, 2 Aug 2010 18:13:43 +0000"  >&lt;p&gt;grrr... no it&apos;s not expected.&lt;br/&gt;
I moved one testcase around (that shouldn&apos;t matter).&lt;br/&gt;
Only thing I can figure is it might be when I&apos;m waiting for the empty index to replicate to the slave.  I&apos;ll look into it.&lt;/p&gt;</comment>
                            <comment id="12894664" author="yseeley@gmail.com" created="Mon, 2 Aug 2010 19:28:02 +0000"  >&lt;p&gt;That was the problem.  I&apos;m making slow progress... the test methods have so many side effects it&apos;s hard to order them correctly and return things to enough of a correct state though.&lt;/p&gt;

&lt;p&gt;It&apos;s also the case that all of the methods indexed and tested for 500 docs, so it was also possible to get false passes.  I&apos;m changing this to use a different number for each test method.&lt;/p&gt;</comment>
                            <comment id="12894697" author="yseeley@gmail.com" created="Mon, 2 Aug 2010 20:32:19 +0000"  >&lt;p&gt;OK, here&apos;s a patch that removes setUp()... we can&apos;t really automatically clean the indexes with the servers in unknown states as they are at the end of many test methods.  The calls are now somewhat explicit.&lt;/p&gt;

&lt;p&gt;There were some tests that rearranging didn&apos;t fix and I had to add more server bounces to restore the correct state, so the test will be a few seconds longer than it was before.&lt;/p&gt;</comment>
                            <comment id="13013181" author="gsingers" created="Wed, 30 Mar 2011 15:45:47 +0000"  >&lt;p&gt;Bulk close for 3.1.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12451074" name="SOLR-1469.patch" size="16822" author="yseeley@gmail.com" created="Mon, 2 Aug 2010 20:32:19 +0000"/>
                            <attachment id="12451042" name="SOLR-1469.patch" size="6211" author="yseeley@gmail.com" created="Mon, 2 Aug 2010 14:45:25 +0000"/>
                            <attachment id="12420669" name="TestReplicationHandler.FAILED.210743" size="994745" author="yseeley@gmail.com" created="Mon, 28 Sep 2009 01:44:52 +0000"/>
                            <attachment id="12451041" name="fail1.txt" size="1075750" author="yseeley@gmail.com" created="Mon, 2 Aug 2010 13:38:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6188</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 34 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03qjr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19734</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>