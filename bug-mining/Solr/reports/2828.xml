<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:11:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-8461] CloudSolrStream and ParallelStream can choose replicas that are not active</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8461</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Currently CloudSolrStream and ParallelStream don&apos;t check the state of the replicas they route requests to. This can result in replicas that are not active receiving request.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12924039">SOLR-8461</key>
            <summary>CloudSolrStream and ParallelStream can choose replicas that are not active</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbernste">Joel Bernstein</assignee>
                                    <reporter username="jbernste">Joel Bernstein</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Dec 2015 17:14:16 +0000</created>
                <updated>Thu, 21 Nov 2019 00:41:59 +0000</updated>
                            <resolved>Thu, 11 Feb 2016 15:58:02 +0000</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                    <component>SolrCloud</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15070798" author="caomanhdat" created="Thu, 24 Dec 2015 09:20:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbernste&quot; class=&quot;user-hover&quot; rel=&quot;jbernste&quot;&gt;jbernste&lt;/a&gt; I will try to working on this issue. Can you assign it to me?&lt;/p&gt;</comment>
                            <comment id="15071096" author="joel.bernstein" created="Thu, 24 Dec 2015 15:48:32 +0000"  >&lt;p&gt;I&apos;m not sure if I can assign it to you. I believe a committer is typically the assignee. But feel free to post a patch and I&apos;ll review and commit when it&apos;s ready. You&apos;ll be referenced in CHANGES.txt.&lt;/p&gt;</comment>
                            <comment id="15071394" author="caomanhdat" created="Fri, 25 Dec 2015 07:35:01 +0000"  >&lt;p&gt;First attempt, &lt;br/&gt;
I just dont know how to write unit test for this issue. Any hint?&lt;/p&gt;</comment>
                            <comment id="15071610" author="joel.bernstein" created="Fri, 25 Dec 2015 13:29:49 +0000"  >&lt;p&gt;I think all needs to be done here is to check the state of replica before adding to the list of replicas to choose from.&lt;/p&gt;

&lt;p&gt;As long as all existing tests pass after this change then it should be committed.&lt;/p&gt;
</comment>
                            <comment id="15071617" author="caomanhdat" created="Fri, 25 Dec 2015 13:42:29 +0000"  >&lt;p&gt;It quite trivial patch if you said so. I just afraid of replica being down after create SolrStream and before open it.&lt;/p&gt;</comment>
                            <comment id="15071659" author="joel.bernstein" created="Fri, 25 Dec 2015 16:32:08 +0000"  >&lt;p&gt;Yes, this is a quick fix just to resolve the choosing of inactive replicas.&lt;/p&gt;

&lt;p&gt;From a testing standpoint we can investigate the Chaos Monkey behavior on the streaming tests.&lt;/p&gt;</comment>
                            <comment id="15074719" author="caomanhdat" created="Wed, 30 Dec 2015 07:23:52 +0000"  >&lt;p&gt;Added unit test.&lt;/p&gt;</comment>
                            <comment id="15074750" author="varunthacker" created="Wed, 30 Dec 2015 07:49:24 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat&quot; class=&quot;user-hover&quot; rel=&quot;caomanhdat&quot;&gt;caomanhdat&lt;/a&gt; ,&lt;/p&gt;

&lt;p&gt;Patch looks great! Couple of comments -&lt;br/&gt;
1. With the patch we check if the replica is active, we should also also check if the replica&apos;s nodeName belongs in the live nodes list. This is required for a scenario like this - Someone kills the node using &quot;kill -9 &amp;lt;pid&amp;gt;&quot; / OOM crash . In the cluster state that replica will still show us &quot;active&quot;. HttpSolrCall#getCoreByCollection does the same thing &lt;br/&gt;
2. Maybe move the code into a function - say &quot;getActiveReplicasForCollection&quot; ? The both CloudSolrStream and ParallelSteam can reuse it.&lt;/p&gt;</comment>
                            <comment id="15074759" author="caomanhdat" created="Wed, 30 Dec 2015 08:00:43 +0000"  >&lt;blockquote&gt;
&lt;p&gt;1. With the patch we check if the replica is active, we should also also check if the replica&apos;s nodeName belongs in the live nodes list. This is required for a scenario like this - Someone kills the node using &quot;kill -9 &amp;lt;pid&amp;gt;&quot; / OOM crash . In the cluster state that replica will still show us &quot;active&quot;. HttpSolrCall#getCoreByCollection does the same thing &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Very nice suggestion, I Will update it now.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;2. Maybe move the code into a function - say &quot;getActiveReplicasForCollection&quot; ? The both CloudSolrStream and ParallelSteam can reuse it.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Cant do that. In ParallelStream, we just wanna find enough workers, dont care about what collection/shard that replica belong to. In CloudSolrStream, for each collection we will randomly find a replica per shard.&lt;/p&gt;</comment>
                            <comment id="15074772" author="caomanhdat" created="Wed, 30 Dec 2015 08:17:32 +0000"  >&lt;p&gt;New patch based on &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt; suggestion.&lt;/p&gt;</comment>
                            <comment id="15074858" author="varunthacker" created="Wed, 30 Dec 2015 09:42:19 +0000"  >&lt;p&gt;How about we add this method to ClusterState.java and make use of this?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; List&amp;lt;Replica&amp;gt; getActiveReplicas(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; collection, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; sliceName) {
    Slice slice = getSlice(collection, sliceName);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (slice == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    List&amp;lt;Replica&amp;gt; activeReplicas = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;();
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Replica replica : slice.getReplicas()) {
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (liveNodes.contains(replica.getNodeName()) &amp;amp;&amp;amp; replica.getState() == Replica.State.ACTIVE) {
        activeReplicas.add(replica);
      }
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; activeReplicas;
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15074900" author="caomanhdat" created="Wed, 30 Dec 2015 10:14:12 +0000"  >&lt;p&gt;New patch based on the snippet of &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15125615" author="joel.bernstein" created="Mon, 1 Feb 2016 01:53:08 +0000"  >&lt;p&gt;Thanks for the patch &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat&quot; class=&quot;user-hover&quot; rel=&quot;caomanhdat&quot;&gt;caomanhdat&lt;/a&gt;. I&apos;ll start reviewing the patch shortly.  I&apos;m also considering adding an Executor to the StreamContext so each stream doesn&apos;t create an executer of it&apos;s own for connecting to the replicas. But I&apos;ll start from the patch provided by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat&quot; class=&quot;user-hover&quot; rel=&quot;caomanhdat&quot;&gt;caomanhdat&lt;/a&gt; and expand from there.&lt;/p&gt;</comment>
                            <comment id="15126330" author="stephlag" created="Mon, 1 Feb 2016 14:54:44 +0000"  >&lt;p&gt;I&apos;m trying to gather all issues related to SolrCloud that affects Solr 5.4. Can you affect SolrCloud component to this issue ?&lt;/p&gt;</comment>
                            <comment id="15126348" author="joel.bernstein" created="Mon, 1 Feb 2016 15:02:21 +0000"  >&lt;p&gt;This bug is only in trunk so it only effects the 6.0 release&lt;/p&gt;</comment>
                            <comment id="15126359" author="joel.bernstein" created="Mon, 1 Feb 2016 15:07:52 +0000"  >&lt;p&gt;Actually I&apos;m wrong. These classes are in 5x. I&apos;ll update the component.&lt;/p&gt;</comment>
                            <comment id="15142804" author="joel.bernstein" created="Thu, 11 Feb 2016 14:33:47 +0000"  >&lt;p&gt;Patch with minimal changes to address the issue. With Solr 6.0 coming very soon, I felt it made sense to make this patch as small as possible.&lt;/p&gt;

&lt;p&gt;I will open another ticket to explore some of the ideas in this ticket around the resiliency of streaming requests.&lt;/p&gt;</comment>
                            <comment id="15142924" author="jira-bot" created="Thu, 11 Feb 2016 15:55:09 +0000"  >&lt;p&gt;Commit 8eb58cc00015f65d120f4ebd921cc4be2ee4c30d in lucene-solr&apos;s branch refs/heads/master from jbernste&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8eb58cc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8eb58cc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8461&quot; title=&quot;CloudSolrStream and ParallelStream can choose replicas that are not active&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8461&quot;&gt;&lt;del&gt;SOLR-8461&lt;/del&gt;&lt;/a&gt;: CloudSolrStream and ParallelStream can choose replicas that are not active&lt;/p&gt;</comment>
                            <comment id="15142925" author="jira-bot" created="Thu, 11 Feb 2016 15:55:10 +0000"  >&lt;p&gt;Commit 35337e8cf278ab445c3a8d1b5d256d80fb23aa7e in lucene-solr&apos;s branch refs/heads/master from jbernste&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=35337e8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=35337e8&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8461&quot; title=&quot;CloudSolrStream and ParallelStream can choose replicas that are not active&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8461&quot;&gt;&lt;del&gt;SOLR-8461&lt;/del&gt;&lt;/a&gt;: Update CHANGES.txt&lt;/p&gt;</comment>
                            <comment id="15142928" author="joel.bernstein" created="Thu, 11 Feb 2016 15:57:47 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat&quot; class=&quot;user-hover&quot; rel=&quot;caomanhdat&quot;&gt;caomanhdat&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12902422">SOLR-8125</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12787475" name="SOLR-8461.patch" size="3218" author="jbernste" created="Thu, 11 Feb 2016 14:33:47 +0000"/>
                            <attachment id="12779944" name="SOLR-8461.patch" size="7531" author="caomanhdat" created="Wed, 30 Dec 2015 10:14:12 +0000"/>
                            <attachment id="12779921" name="SOLR-8461.patch" size="6488" author="caomanhdat" created="Wed, 30 Dec 2015 08:17:32 +0000"/>
                            <attachment id="12779918" name="SOLR-8461.patch" size="5405" author="caomanhdat" created="Wed, 30 Dec 2015 07:23:52 +0000"/>
                            <attachment id="12779515" name="SOLR-8461.patch" size="1635" author="caomanhdat" created="Fri, 25 Dec 2015 13:42:29 +0000"/>
                            <attachment id="12779498" name="SOLR-8461.patch" size="4879" author="caomanhdat" created="Fri, 25 Dec 2015 07:35:01 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 40 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2q9in:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>