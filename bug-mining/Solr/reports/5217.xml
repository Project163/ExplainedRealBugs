<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:10:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-17394] IndexFetcher should inspect HTTP status codes on its requests</title>
                <link>https://issues.apache.org/jira/browse/SOLR-17394</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Typically, SolrJ will look at the HTTP status code of a response and it will throw exceptions as appropriate (see &lt;a href=&quot;https://github.com/apache/solr/blob/988e9e3c2666784638475f4cd4827bc2fe77c707/solr/solrj/src/java/org/apache/solr/client/solrj/impl/HttpSolrClientBase.java#L187-L217&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;).  But it skips this logic if users have elected to parse the response themselves by use of an &quot;InputStreamResponseParser&quot;.&lt;/p&gt;

&lt;p&gt;Solr&apos;s IndexFetcher uses this &quot;InputStreamResponseParser&quot; so that it can access the binary index data in the HTTP response.  But it doesn&apos;t check the status code of responses as it should.&lt;/p&gt;

&lt;p&gt;IndexFetcher will typically notice that the response is unexpected and can retry and ultimately succeed, but this happens relatively late in the process.  And that delay can be very expensive in many cases.  For instance:&lt;/p&gt;

&lt;p&gt;When IndexFetcher gets a &quot;filecontent&quot; response, it expects the first few bytes to indicate the size of the binary response.  So it &lt;a href=&quot;https://github.com/apache/solr/blob/988e9e3c2666784638475f4cd4827bc2fe77c707/solr/core/src/java/org/apache/solr/handler/IndexFetcher.java#L1836C1-L1847&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;reads these bytes and instantiates a byte-array of the indicated size&lt;/a&gt;.  But if IndexFetcher happens to be reading a 404 response, the first few bytes of the response will be the &apos;&lt;b&gt;&amp;lt;&lt;/b&gt;&apos;, &apos;&lt;b&gt;h&lt;/b&gt;&apos;, &apos;&lt;b&gt;e&lt;/b&gt;&apos;, and &apos;&lt;b&gt;a&lt;/b&gt;&apos; characters from the &quot;&lt;b&gt;&amp;lt;head&lt;/b&gt;&amp;gt;&quot; tag that Solr uses to begin all its HTML errors.  This leads to IndexFetcher allocating a massive &amp;gt; 1GB byte-array!  This can cause GC churn in production and (for me at least) was causing test runs to frequently OOM on certain machines.&lt;/p&gt;

&lt;p&gt;We should have IndexFetcher (and other places that use InputStreamResponseParser) check the response status code as soon as its available and handle errors accordingly.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13588024">SOLR-17394</key>
            <summary>IndexFetcher should inspect HTTP status codes on its requests</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gerlowskija">Jason Gerlowski</assignee>
                                    <reporter username="gerlowskija">Jason Gerlowski</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 6 Aug 2024 14:06:41 +0000</created>
                <updated>Fri, 17 Oct 2025 20:05:31 +0000</updated>
                            <resolved>Thu, 8 Aug 2024 12:55:43 +0000</resolved>
                                    <version>9.6.1</version>
                    <version>10.0</version>
                                    <fixVersion>9.7</fixVersion>
                                    <component>replication (java)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="4800">1h 20m</timespent>
                                <comments>
                            <comment id="17871986" author="jira-bot" created="Thu, 8 Aug 2024 12:32:39 +0000"  >&lt;p&gt;Commit f33fc60febf549b937690e14be00f59d5015a5cf in solr&apos;s branch refs/heads/main from Jason Gerlowski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=f33fc60febf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=f33fc60febf&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17394&quot; title=&quot;IndexFetcher should inspect HTTP status codes on its requests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17394&quot;&gt;&lt;del&gt;SOLR-17394&lt;/del&gt;&lt;/a&gt;: Check response status in IndexFetcher (#2621)&lt;/p&gt;

&lt;p&gt;Prior to this commit, IndexFetcher would mis-read 404 responses from&lt;br/&gt;
other nodes.  It eventually catches this mistake and retries, but not&lt;br/&gt;
before it wastefully allocates a massive (&amp;gt; 1GB) byte array.&lt;/p&gt;

&lt;p&gt;These allocations were relatively infrequent, as they require out of&lt;br/&gt;
date leader information to occur.  But they are big enough to impact&lt;br/&gt;
performance in production, and were observed to cause OOM&apos;s when running&lt;br/&gt;
tests.&lt;/p&gt;

&lt;p&gt;This commit avoids this by checking the HTTP status code of all&lt;br/&gt;
IndexFetcher requests/responses, even those that utilize&lt;br/&gt;
InputStreamResponseParser.&lt;/p&gt;</comment>
                            <comment id="17871989" author="jira-bot" created="Thu, 8 Aug 2024 12:36:24 +0000"  >&lt;p&gt;Commit 249ee8eaaeaaf39aba71118a1386273f9b0a0ac1 in solr&apos;s branch refs/heads/branch_9x from Jason Gerlowski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=249ee8eaaea&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=249ee8eaaea&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17394&quot; title=&quot;IndexFetcher should inspect HTTP status codes on its requests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17394&quot;&gt;&lt;del&gt;SOLR-17394&lt;/del&gt;&lt;/a&gt;: Check response status in IndexFetcher (#2621)&lt;/p&gt;

&lt;p&gt;Prior to this commit, IndexFetcher would mis-read 404 responses from&lt;br/&gt;
other nodes.  It eventually catches this mistake and retries, but not&lt;br/&gt;
before it wastefully allocates a massive (&amp;gt; 1GB) byte array.&lt;/p&gt;

&lt;p&gt;These allocations were relatively infrequent, as they require out of&lt;br/&gt;
date leader information to occur.  But they are big enough to impact&lt;br/&gt;
performance in production, and were observed to cause OOM&apos;s when running&lt;br/&gt;
tests.&lt;/p&gt;

&lt;p&gt;This commit avoids this by checking the HTTP status code of all&lt;br/&gt;
IndexFetcher requests/responses, even those that utilize&lt;br/&gt;
InputStreamResponseParser.&lt;/p&gt;</comment>
                            <comment id="17871990" author="jira-bot" created="Thu, 8 Aug 2024 12:38:38 +0000"  >&lt;p&gt;Commit 734f53304786872e483189e566eef03b5687733c in solr&apos;s branch refs/heads/branch_9_7 from Jason Gerlowski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=734f5330478&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=734f5330478&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17394&quot; title=&quot;IndexFetcher should inspect HTTP status codes on its requests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17394&quot;&gt;&lt;del&gt;SOLR-17394&lt;/del&gt;&lt;/a&gt;: Check response status in IndexFetcher (#2621)&lt;/p&gt;

&lt;p&gt;Prior to this commit, IndexFetcher would mis-read 404 responses from&lt;br/&gt;
other nodes.  It eventually catches this mistake and retries, but not&lt;br/&gt;
before it wastefully allocates a massive (&amp;gt; 1GB) byte array.&lt;/p&gt;

&lt;p&gt;These allocations were relatively infrequent, as they require out of&lt;br/&gt;
date leader information to occur.  But they are big enough to impact&lt;br/&gt;
performance in production, and were observed to cause OOM&apos;s when running&lt;br/&gt;
tests.&lt;/p&gt;

&lt;p&gt;This commit avoids this by checking the HTTP status code of all&lt;br/&gt;
IndexFetcher requests/responses, even those that utilize&lt;br/&gt;
InputStreamResponseParser.&lt;/p&gt;</comment>
                            <comment id="17874202" author="jira-bot" created="Fri, 16 Aug 2024 11:30:35 +0000"  >&lt;p&gt;Commit 7df3eb5bddba4898d909f46d7b9af374d327a5cb in solr&apos;s branch refs/heads/main from Jason Gerlowski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=7df3eb5bddb&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=7df3eb5bddb&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17394&quot; title=&quot;IndexFetcher should inspect HTTP status codes on its requests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17394&quot;&gt;&lt;del&gt;SOLR-17394&lt;/del&gt;&lt;/a&gt;: Address review feedback&lt;/p&gt;

&lt;p&gt;Addresses some feedback from David Smiley regarding control flow and&lt;br/&gt;
Optional-usage that came in after the original PR was merged.&lt;/p&gt;</comment>
                            <comment id="17889859" author="dsmiley" created="Tue, 15 Oct 2024 22:38:08 +0000"  >&lt;p&gt;Maybe InputStreamResponseParser needs javadocs warnings to scare people away from using it given how fickle/hacky it is to work with, and given the status code issue that&apos;s so easy to forget? &#160;I&apos;d be happy to create an issue.&lt;/p&gt;

&lt;p&gt;CC &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sanjaydutt&quot; class=&quot;user-hover&quot; rel=&quot;sanjaydutt&quot;&gt;sanjaydutt&lt;/a&gt;&#160; At least for Json use-cases, JsonMapResponseParser (which uses Jackson) is the way to go.&lt;/p&gt;</comment>
                            <comment id="17892879" author="anshumg" created="Fri, 25 Oct 2024 17:18:48 +0000"  >&lt;p&gt;Closing after the 9.7.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 2 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1qpy0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>