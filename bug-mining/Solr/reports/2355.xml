<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:03:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-7113] Multiple calls to UpdateLog#init is not thread safe with respect to the HDFS FileSystem client object usage.</title>
                <link>https://issues.apache.org/jira/browse/SOLR-7113</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;I notice this issue while trying to do some heavy indexing into Solr. (700K docs  per minute)&lt;/p&gt;

&lt;p&gt;Solr log errors&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;15:42:47
ERROR
HdfsTransactionLog
Exception closing tlog.
java.io.IOException: Filesystem closed
	at org.apache.hadoop.hdfs.DFSClient.checkOpen(DFSClient.java:765)
	at org.apache.hadoop.hdfs.DFSOutputStream.flushOrSync(DFSOutputStream.java:1898)
	at org.apache.hadoop.hdfs.DFSOutputStream.hflush(DFSOutputStream.java:1859)
	at org.apache.hadoop.fs.FSDataOutputStream.hflush(FSDataOutputStream.java:130)
	at org.apache.solr.update.HdfsTransactionLog.close(HdfsTransactionLog.java:303)
	at org.apache.solr.update.TransactionLog.decref(TransactionLog.java:504)
	at org.apache.solr.update.UpdateLog.addOldLog(UpdateLog.java:335)
	at org.apache.solr.update.UpdateLog.postCommit(UpdateLog.java:628)
	at org.apache.solr.update.DirectUpdateHandler2.commit(DirectUpdateHandler2.java:600)
	at org.apache.solr.update.CommitTracker.run(CommitTracker.java:216)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)
	at java.util.concurrent.FutureTask.run(FutureTask.java:262)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:178)
	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:292)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
15:42:47
ERROR
CommitTracker
auto commit error...:org.apache.solr.common.SolrException: java.io.IOException: Filesystem closed
auto commit error...:org.apache.solr.common.SolrException: java.io.IOException: Filesystem closed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12775165">SOLR-7113</key>
            <summary>Multiple calls to UpdateLog#init is not thread safe with respect to the HDFS FileSystem client object usage.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="markrmiller@gmail.com">Mark Miller</assignee>
                                    <reporter username="vamsee">Vamsee K. Yarlagadda</reporter>
                        <labels>
                    </labels>
                <created>Sat, 14 Feb 2015 22:00:27 +0000</created>
                <updated>Tue, 14 Jun 2016 11:01:51 +0000</updated>
                            <resolved>Thu, 2 Apr 2015 16:14:16 +0000</resolved>
                                                    <fixVersion>5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14321729" author="markrmiller@gmail.com" created="Sat, 14 Feb 2015 22:06:17 +0000"  >&lt;p&gt;Thanks Vamsee - I have a test and patch for this.&lt;/p&gt;

&lt;p&gt;We are kind of jumping hoops to try and support the tlog location changing on a new call to init. This is not even something we need or want to support.&lt;/p&gt;

&lt;p&gt;So rather than try and deal with multiple Filesystem instances here (which would require some sort of reference counting at this point), we can simply fix the code to not accept a location change.&lt;/p&gt;</comment>
                            <comment id="14321736" author="markrmiller@gmail.com" created="Sat, 14 Feb 2015 22:37:35 +0000"  >&lt;p&gt;A quick first patch.&lt;/p&gt;</comment>
                            <comment id="14329795" author="markrmiller@gmail.com" created="Fri, 20 Feb 2015 23:55:40 +0000"  >&lt;p&gt;I&apos;m going to add an annotation to ignore resource close checks for this to work around &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7115&quot; title=&quot;UpdateLog can miss closing transaction log objects.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7115&quot;&gt;&lt;del&gt;SOLR-7115&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14337441" author="jira-bot" created="Wed, 25 Feb 2015 23:21:40 +0000"  >&lt;p&gt;Commit 1662324 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1662324&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1662324&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7113&quot; title=&quot;Multiple calls to UpdateLog#init is not thread safe with respect to the HDFS FileSystem client object usage.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7113&quot;&gt;&lt;del&gt;SOLR-7113&lt;/del&gt;&lt;/a&gt;: Multiple calls to UpdateLog#init is not thread safe with respect to the HDFS FileSystem client object usage.&lt;/p&gt;</comment>
                            <comment id="14337489" author="jira-bot" created="Wed, 25 Feb 2015 23:43:14 +0000"  >&lt;p&gt;Commit 1662330 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1662330&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1662330&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7113&quot; title=&quot;Multiple calls to UpdateLog#init is not thread safe with respect to the HDFS FileSystem client object usage.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7113&quot;&gt;&lt;del&gt;SOLR-7113&lt;/del&gt;&lt;/a&gt;: Multiple calls to UpdateLog#init is not thread safe with respect to the HDFS FileSystem client object usage.&lt;/p&gt;</comment>
                            <comment id="14495387" author="thelabdude" created="Wed, 15 Apr 2015 00:30:54 +0000"  >&lt;p&gt;Bulk close after 5.1 release&lt;/p&gt;</comment>
                            <comment id="15329314" author="mbm" created="Tue, 14 Jun 2016 11:01:51 +0000"  >&lt;p&gt;I&apos;m very confused about this. We&apos;re seeing that tlogs get held open (and in particular hold open datanode transceivers) on HDFS Solr:&lt;/p&gt;

&lt;p&gt;Using the github version of the commit (because I know how to link to it): &lt;a href=&quot;https://github.com/apache/lucene-solr/commit/f2c9067e59b81b3dea7903315431babcd2506167#diff-c796f1f2f2f362c18bd89a85688fbebfR295&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/commit/f2c9067e59b81b3dea7903315431babcd2506167#diff-c796f1f2f2f362c18bd89a85688fbebfR295&lt;/a&gt; we see the following lines:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;tlog = ntlog

&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (tlog != ntlog) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When is that if condition ever not true? What was this if condition supposed to do? This does appear one part of a reasonable explanation as to why the old rotated tlogs are being held open by the solr HDFS client.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12775169">SOLR-7115</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12698936" name="SOLR-7113.patch" size="8466" author="markrmiller@gmail.com" created="Sat, 14 Feb 2015 22:37:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 23 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i25n93:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>