<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:48:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-15706] After an incremental back up, the pugeUnused operation incorrectly deletes all backed up data</title>
                <link>https://issues.apache.org/jira/browse/SOLR-15706</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Reproduction Steps: # Create a collection&#160;&lt;em&gt;&apos;foo&apos;,&lt;/em&gt;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Insert small number of documents (&lt;em&gt;say 10&lt;/em&gt;) into collection&#160;&lt;em&gt;&apos;foo&apos;&lt;/em&gt;&lt;/li&gt;
	&lt;li&gt;Backup collection&#160;&lt;em&gt;&apos;foo&apos;&lt;/em&gt;&#160;using collections API (/admin/collections?action=BACKUP), this should result in creation of&#160;&lt;em&gt;backupId 0&lt;/em&gt;&lt;/li&gt;
	&lt;li&gt;Backup collection&#160;&lt;em&gt;&apos;foo&apos;&lt;/em&gt;&#160;again using collections API (/admin/collections?action=BACKUP), this should result in creation of&#160;&lt;em&gt;backupId 1&lt;/em&gt;&lt;/li&gt;
	&lt;li&gt;Delete&#160;&lt;em&gt;backupId 0&lt;/em&gt;&#160;for collection&#160;&lt;em&gt;&apos;foo&apos;&lt;/em&gt;&#160;(/admin/collections?action=DELETEBACKUP?backupId=0)&lt;/li&gt;
	&lt;li&gt;Run delete backup for collection&#160;&lt;em&gt;&apos;foo&apos;&lt;/em&gt;&#160;again, this time with&#160;&lt;em&gt;&apos;purgeUnused=true&apos;&lt;/em&gt;&#160;(/admin/collections?action=DELETEBACKUP?purgeUnused=true)&lt;/li&gt;
	&lt;li&gt;Restore from&#160;&lt;em&gt;backupId 1&lt;/em&gt;&#160;which still exists to collection&#160;&lt;em&gt;&apos;bar&apos;&lt;/em&gt;&#160;(/admin/collections?action=RESTORE)&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Expected Result: # Restored collection &apos;bar&apos; has 10 documents in it&lt;/p&gt;

&lt;p&gt;Actual Result: # Restored collection &apos;bar&apos; has 0 documents in it&lt;/p&gt;

&lt;p&gt;We found in our testing that when purge is used it incorrectly deletes all backup data instead of just the unused data as it supposed to.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13407613">SOLR-15706</key>
            <summary>After an incremental back up, the pugeUnused operation incorrectly deletes all backed up data</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gerlowskija">Jason Gerlowski</assignee>
                                    <reporter username="DonP">Don</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Oct 2021 19:04:38 +0000</created>
                <updated>Tue, 4 Jan 2022 08:22:44 +0000</updated>
                            <resolved>Fri, 5 Nov 2021 10:02:20 +0000</resolved>
                                    <version>8.9</version>
                                    <fixVersion>9.0</fixVersion>
                    <fixVersion>8.11</fixVersion>
                                    <component>Backup/Restore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17438166" author="gerlowskija" created="Wed, 3 Nov 2021 16:05:18 +0000"  >&lt;p&gt;I&apos;ve uploaded a script (based on Don&apos;s instructions, thanks!) to ease reproduction a bit.&lt;/p&gt;

&lt;p&gt;The root cause looks to be that a line in the &quot;purge&quot; code looks for &quot;shard metadata&quot; files in the wrong directory.&#160; Not finding the right shard metadata files causes valid, in-use index files to look &quot;orphaned&quot; (and ultimately be cleaned up by the purge).&lt;/p&gt;

&lt;p&gt;The fix is pretty trivial.&#160; I&apos;ll commit a fix soon, and look into why our existing tests didn&apos;t catch this.&lt;/p&gt;</comment>
                            <comment id="17438904" author="jira-bot" created="Thu, 4 Nov 2021 19:27:23 +0000"  >&lt;p&gt;Commit b532f4dc604d01dbddd8e45ee5cc16d3e3afe0b3 in solr&apos;s branch refs/heads/main from Jason Gerlowski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=b532f4d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=b532f4d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15706&quot; title=&quot;After an incremental back up, the pugeUnused operation incorrectly deletes all backed up data&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15706&quot;&gt;&lt;del&gt;SOLR-15706&lt;/del&gt;&lt;/a&gt;: Fix incorrect path in backup purging&lt;/p&gt;

&lt;p&gt;Prior to this commit the backup purging logic used an incorrect path to&lt;br/&gt;
lookup the &apos;shard_backup_metadata&apos; directory.  This caused it to not&lt;br/&gt;
find the right metadata files, and ultimately treat all &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/warning.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; index files&lt;br/&gt;
as &quot;orphaned&quot; and ready for deletion.&lt;/p&gt;

&lt;p&gt;This commit fixes this problem by correcting the path used in this path&lt;br/&gt;
of DeleteBackupCmd.  It also rewrites our PurgeGraphTest unit tests to&lt;br/&gt;
use real paths instead of relying heavily on mocks.  Bringing them more&lt;br/&gt;
closely into line with the actual file structure that appears in&lt;br/&gt;
production should make them more effective at detecting terrible bugs&lt;br/&gt;
like this one.&lt;/p&gt;</comment>
                            <comment id="17438978" author="jira-bot" created="Thu, 4 Nov 2021 23:33:00 +0000"  >&lt;p&gt;Commit ba2785bcc0f1951f6fdf999a0a96ca43a53de55d in lucene-solr&apos;s branch refs/heads/branch_8x from Jason Gerlowski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=ba2785b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=ba2785b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15706&quot; title=&quot;After an incremental back up, the pugeUnused operation incorrectly deletes all backed up data&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15706&quot;&gt;&lt;del&gt;SOLR-15706&lt;/del&gt;&lt;/a&gt;: Fix incorrect path in backup purging&lt;/p&gt;

&lt;p&gt;Prior to this commit the backup purging logic used an incorrect path to&lt;br/&gt;
lookup the &apos;shard_backup_metadata&apos; directory.  This caused it to not&lt;br/&gt;
find the right metadata files, and ultimately treat all &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/warning.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; index files&lt;br/&gt;
as &quot;orphaned&quot; and ready for deletion.&lt;/p&gt;

&lt;p&gt;This commit fixes this problem by correcting the path used in this path&lt;br/&gt;
of DeleteBackupCmd.  It also rewrites our PurgeGraphTest unit tests to&lt;br/&gt;
use real paths instead of relying heavily on mocks.  Bringing them more&lt;br/&gt;
closely into line with the actual file structure that appears in&lt;br/&gt;
production should make them more effective at detecting terrible bugs&lt;br/&gt;
like this one.&lt;/p&gt;</comment>
                            <comment id="17438981" author="jira-bot" created="Thu, 4 Nov 2021 23:43:26 +0000"  >&lt;p&gt;Commit 9d0c113b06c18f6e7027d571561141dfdcbbd636 in lucene-solr&apos;s branch refs/heads/branch_8_11 from Jason Gerlowski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=9d0c113&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=9d0c113&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15706&quot; title=&quot;After an incremental back up, the pugeUnused operation incorrectly deletes all backed up data&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15706&quot;&gt;&lt;del&gt;SOLR-15706&lt;/del&gt;&lt;/a&gt;: Fix incorrect path in backup purging&lt;/p&gt;

&lt;p&gt;Prior to this commit the backup purging logic used an incorrect path to&lt;br/&gt;
lookup the &apos;shard_backup_metadata&apos; directory.  This caused it to not&lt;br/&gt;
find the right metadata files, and ultimately treat all &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/warning.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; index files&lt;br/&gt;
as &quot;orphaned&quot; and ready for deletion.&lt;/p&gt;

&lt;p&gt;This commit fixes this problem by correcting the path used in this path&lt;br/&gt;
of DeleteBackupCmd.  It also rewrites our PurgeGraphTest unit tests to&lt;br/&gt;
use real paths instead of relying heavily on mocks.  Bringing them more&lt;br/&gt;
closely into line with the actual file structure that appears in&lt;br/&gt;
production should make them more effective at detecting terrible bugs&lt;br/&gt;
like this one.&lt;/p&gt;</comment>
                            <comment id="17439136" author="gerlowskija" created="Fri, 5 Nov 2021 10:02:20 +0000"  >&lt;p&gt;Alright, I finished backporting this yesterday and the tests still look clean, so going to close this out.&lt;/p&gt;</comment>
                            <comment id="17443997" author="donp" created="Mon, 15 Nov 2021 17:39:28 +0000"  >&lt;p&gt;Any idea when 8.11 will be released? This is a pretty serious bug and my team would like to get the fixed version of Solr, that has this bug fix in it, into our product ASAP.&lt;/p&gt;</comment>
                            <comment id="17444000" author="gerlowskija" created="Mon, 15 Nov 2021 17:48:40 +0000"  >&lt;p&gt;There&apos;s an 8.11 release currently underway, so hopefully in the next week or two.&lt;/p&gt;</comment>
                            <comment id="17445245" author="jpountz" created="Wed, 17 Nov 2021 14:22:48 +0000"  >&lt;p&gt;Closing after the 8.11 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13035659" name="reproduce.sh" size="1509" author="gerlowskija" created="Wed, 3 Nov 2021 15:52:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 51 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0w0xk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>