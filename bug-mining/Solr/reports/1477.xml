<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:38:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-5028] Incorrect ShardHandlerFactory creation</title>
                <link>https://issues.apache.org/jira/browse/SOLR-5028</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;It seems to me that there are two bugs in the ShardHandlerFactoryCreation that cancel each other and it seems to be working with the old style solr.xml, but not with the &quot;new style&quot;. ConfigSolrOldXml seems to be expecting the shardHandlerFactory with the xpath:&lt;br/&gt;
solr/shardHandlerFactory/@class&lt;br/&gt;
Instead of solr/&lt;b&gt;cores&lt;/b&gt;/shardHandlerFactory/@class as it used to be. This is never caught because in the CoreContainer the ShardHandlerFactory is initialized using &quot;configSolr.getConfig().getNode(&quot;solr/cores/shardHandlerFactory&quot;, false);&quot; instead of &quot;configSolr.get(CfgProp.SOLR_SHARDHANDLERFACTORY_CLASS, null);&quot; or something like that. However, if you use the &quot;new style&quot; xml, the CoreContainer will still try to initialize the factory like that, and won&apos;t find the  SHF. &lt;/p&gt;
</description>
                <environment></environment>
        <key id="12657117">SOLR-5028</key>
            <summary>Incorrect ShardHandlerFactory creation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="romseygeek">Alan Woodward</assignee>
                                    <reporter username="tflobbe">Tomas Eduardo Fernandez Lobbe</reporter>
                        <labels>
                    </labels>
                <created>Wed, 10 Jul 2013 17:51:52 +0000</created>
                <updated>Mon, 9 May 2016 18:44:16 +0000</updated>
                            <resolved>Thu, 11 Jul 2013 14:35:46 +0000</resolved>
                                    <version>4.4</version>
                    <version>6.0</version>
                                    <fixVersion>4.5</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="13704883" author="rjernst" created="Wed, 10 Jul 2013 18:33:50 +0000"  >&lt;p&gt;Looks like a lot has changed since I fixed this in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4543&quot; title=&quot;setting shardHandlerFactory in solr.xml/solr.properties does not work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4543&quot;&gt;&lt;del&gt;SOLR-4543&lt;/del&gt;&lt;/a&gt;...&lt;/p&gt;

&lt;p&gt;The attached patch &quot;fixes&quot; the issue here.  I don&apos;t understand why the test I had for SolrProperties was not ported over to the &quot;new&quot; xml when the former was removed (added back here).&lt;/p&gt;

&lt;p&gt;But there are still more problems.  Persistence right now assumes a flat hierarchy (the addAttrib function takes a single String-&amp;gt;String map to fill).  This looks like SolrProperties stuff all over again.  shardHandlerFactory is a plugin, and it has arbitrary children.  Persistence should be getting the Node for shardHandlerFactory and copying it.  There should be no need to look for specific children like connTimeout or socketTimeout.&lt;/p&gt;</comment>
                            <comment id="13704898" author="rjernst" created="Wed, 10 Jul 2013 18:40:49 +0000"  >&lt;p&gt;I opened another jira for the persistence issue: &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5029&quot; title=&quot;shardHandlerFactory is not properly persisted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5029&quot;&gt;&lt;del&gt;SOLR-5029&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13704913" author="tomasflobbe" created="Wed, 10 Jul 2013 18:54:48 +0000"  >&lt;p&gt;if we take this approach we should remove CfgProp.SOLR_SHARDHANDLERFACTORY_CLASS, SOLR_SHARDHANDLERFACTORY_CONNTIMEOUT, SOLR_SHARDHANDLERFACTORY_NAME, SOLR_SHARDHANDLERFACTORY_SOCKETTIMEOUT so that there is a unique way to access the SHF information. Specially in 4.x where the path to populate those properties is incorrect and using them would result in a bug.&lt;/p&gt;</comment>
                            <comment id="13704922" author="rjernst" created="Wed, 10 Jul 2013 19:00:44 +0000"  >&lt;p&gt;I didn&apos;t remove those enums only because persistence is using them, and it &quot;sort of&quot; works right now (with HttpShardHandlerFactory, for those specific settings).  I leave that to the other jira I opened to fix.&lt;/p&gt;</comment>
                            <comment id="13704939" author="tomasflobbe" created="Wed, 10 Jul 2013 19:16:41 +0000"  >&lt;blockquote&gt;&lt;p&gt;it &quot;sort of&quot; works right now&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;not with &quot;old style&quot; solr.xml, there the properties are being loaded with the wrong path:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    propMap.put(CfgProp.SOLR_SHARDHANDLERFACTORY_CLASS,
        config.getVal(&lt;span class=&quot;code-quote&quot;&gt;&quot;solr/shardHandlerFactory/@class&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;));
    propMap.put(CfgProp.SOLR_SHARDHANDLERFACTORY_NAME,
        config.getVal(&lt;span class=&quot;code-quote&quot;&gt;&quot;solr/shardHandlerFactory/@name&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;));
    propMap.put(CfgProp.SOLR_SHARDHANDLERFACTORY_CONNTIMEOUT,
        config.getVal(&lt;span class=&quot;code-quote&quot;&gt;&quot;solr/shardHandlerFactory/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;[@name=&lt;span class=&quot;code-quote&quot;&gt;&apos;connTimeout&apos;&lt;/span&gt;]&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;));
    propMap.put(CfgProp.SOLR_SHARDHANDLERFACTORY_SOCKETTIMEOUT,
        config.getVal(&lt;span class=&quot;code-quote&quot;&gt;&quot;solr/shardHandlerFactory/&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;[@name=&lt;span class=&quot;code-quote&quot;&gt;&apos;socketTimeout&apos;&lt;/span&gt;]&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;maybe replace those values with&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    propMap.put(CfgProp.SOLR_SHARDHANDLERFACTORY_CLASS,
        config.getVal(getShardHandlerFactoryPath() + &lt;span class=&quot;code-quote&quot;&gt;&quot;/@class&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;));
    ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="13705390" author="erickerickson" created="Thu, 11 Jul 2013 02:02:14 +0000"  >&lt;p&gt;Tom&#225;s: Don&apos;t quite get this. Those enums are just for use as key values in the map, not for the paths so I think they should stay.&lt;/p&gt;

&lt;p&gt;But getting the &lt;em&gt;values&lt;/em&gt; to assign to the maps keyed by things like CfgProp.SOLR_SHARDHANDLERFACTORY_SOCKETTIMEOUT by the getShardHandlerFactoryPath() trick is a different matter.&lt;/p&gt;
</comment>
                            <comment id="13705633" author="romseygeek" created="Thu, 11 Jul 2013 09:21:55 +0000"  >&lt;p&gt;A couple of tweaks to Ryan&apos;s patch, moving the creation logic into a static method on ShardHandlerInfo and adding getShardHandlerFactoryPluginInfo() methods to the ConfigSolr implementations.  Lovely lovely Java car-crash class names...&lt;/p&gt;

&lt;p&gt;Ryan, Tom&#225;s, could you try this out?  Will work on a persistence patch next.&lt;/p&gt;</comment>
                            <comment id="13705670" author="romseygeek" created="Thu, 11 Jul 2013 10:36:21 +0000"  >&lt;p&gt;Patch with persistence added.&lt;/p&gt;</comment>
                            <comment id="13705718" author="erickerickson" created="Thu, 11 Jul 2013 11:38:58 +0000"  >&lt;p&gt;Alan:&lt;/p&gt;

&lt;p&gt;I think the tag for 4.4 has been cut (check with sarowe), so when you merge this in to 4.x don&apos;t forget to add it into the 4.4 branch too.&lt;/p&gt;</comment>
                            <comment id="13705719" author="tomasflobbe" created="Thu, 11 Jul 2013 11:39:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;Tom&#225;s: Don&apos;t quite get this. Those enums are just for use as key values in the map, not for the paths so I think they should stay.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes, I know, but what I&apos;m saying is that as the SHF receives an unknown set of parameters (because it&apos;s a plugin) you can&apos;t generate enum keys for everything. Instead of that, when someone needs to get information about the SHF configuration it&apos;ll need to get the Node (or the PluginInfo with Alan&apos;s patch). &quot;connTimeout&quot; and &quot;socketTimeout&quot; are arguments specific to the HttpShardHandlerFactory that other SHF implementations may or may not use. Also, HttpShardHandlerFactory accepts lots of other arguments and we are not providing keys for all of them. So it gets confusing, some arbitrary init params can be get using cfg.get(...) and some can&apos;t. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Ryan, Tom&#225;s, could you try this out? Will work on a persistence patch next.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I haven&apos;t tested it yet, but +1 on the changes you did. ConfigSolrXmlOld still populates the map with the wrong paths though. &lt;/p&gt;</comment>
                            <comment id="13705733" author="erickerickson" created="Thu, 11 Jul 2013 11:52:14 +0000"  >&lt;p&gt;Tom&#225;s:&lt;/p&gt;

&lt;p&gt;Got it, thanks. Right, removing them is a Good Thing then.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;No one&lt;/em&gt; will be happier than me when we get rid of this persistence stuff. I hope I made it better with the first go-round. I&apos;m sure Alan&apos;s made it better with his refactoring. And it&apos;s still very hard to get everything right.&lt;/p&gt;</comment>
                            <comment id="13705742" author="romseygeek" created="Thu, 11 Jul 2013 12:08:49 +0000"  >&lt;p&gt;TBH, it would be nicest to just remove cfg.get() entirely, and make ConfigSolr a proper POJO.  But that&apos;s another issue.&lt;/p&gt;

&lt;p&gt;This is still not ideal, as I&apos;ve just noticed that my quick-n-dirty patch still assumes a single-level plugin info hierarchy and won&apos;t deal with &amp;lt;arr&amp;gt; or &amp;lt;lst&amp;gt; values properly.  Will try and fix that.&lt;/p&gt;</comment>
                            <comment id="13705780" author="romseygeek" created="Thu, 11 Jul 2013 13:08:05 +0000"  >&lt;p&gt;The first rule of XML processing is: never try and write your own XML processor.&lt;/p&gt;

&lt;p&gt;Updated patch, using dom Transformers to write out the plugin info Node.  Tests pass, I think this is good to commit.&lt;/p&gt;</comment>
                            <comment id="13705814" author="tomasflobbe" created="Thu, 11 Jul 2013 13:32:45 +0000"  >&lt;p&gt;I insist that the SHF properties in ConfigSolr should either be fixed or removed. I attach a patch removing them.&lt;/p&gt;

&lt;p&gt;Also, your patch seems to miss the file solr-shardhandler-old.xml, adding one. &lt;/p&gt;</comment>
                            <comment id="13705842" author="romseygeek" created="Thu, 11 Jul 2013 14:04:32 +0000"  >&lt;p&gt;Agreed, Tom&#225;s.  Final patch, with CHANGES entry as well.  Committing shortly.&lt;/p&gt;</comment>
                            <comment id="13705867" author="jira-bot" created="Thu, 11 Jul 2013 14:15:36 +0000"  >&lt;p&gt;Commit 1502231 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek&quot; class=&quot;user-hover&quot; rel=&quot;romseygeek&quot;&gt;romseygeek&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1502231&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1502231&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5028&quot; title=&quot;Incorrect ShardHandlerFactory creation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5028&quot;&gt;&lt;del&gt;SOLR-5028&lt;/del&gt;&lt;/a&gt;,&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5029&quot; title=&quot;shardHandlerFactory is not properly persisted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5029&quot;&gt;&lt;del&gt;SOLR-5029&lt;/del&gt;&lt;/a&gt;: Fix ShardHandlerFactory creation and persistence&lt;/p&gt;</comment>
                            <comment id="13705870" author="jira-bot" created="Thu, 11 Jul 2013 14:21:33 +0000"  >&lt;p&gt;Commit 1502233 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek&quot; class=&quot;user-hover&quot; rel=&quot;romseygeek&quot;&gt;romseygeek&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1502233&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1502233&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5028&quot; title=&quot;Incorrect ShardHandlerFactory creation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5028&quot;&gt;&lt;del&gt;SOLR-5028&lt;/del&gt;&lt;/a&gt;,&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5029&quot; title=&quot;shardHandlerFactory is not properly persisted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5029&quot;&gt;&lt;del&gt;SOLR-5029&lt;/del&gt;&lt;/a&gt;: Fix ShardHandlerFactory creation and persistence&lt;/p&gt;</comment>
                            <comment id="13705877" author="jira-bot" created="Thu, 11 Jul 2013 14:35:12 +0000"  >&lt;p&gt;Commit 1502235 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek&quot; class=&quot;user-hover&quot; rel=&quot;romseygeek&quot;&gt;romseygeek&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1502235&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1502235&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5028&quot; title=&quot;Incorrect ShardHandlerFactory creation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5028&quot;&gt;&lt;del&gt;SOLR-5028&lt;/del&gt;&lt;/a&gt;,&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5029&quot; title=&quot;shardHandlerFactory is not properly persisted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5029&quot;&gt;&lt;del&gt;SOLR-5029&lt;/del&gt;&lt;/a&gt;: Fix ShardHandlerFactory creation and persistence&lt;/p&gt;</comment>
                            <comment id="13705879" author="romseygeek" created="Thu, 11 Jul 2013 14:35:46 +0000"  >&lt;p&gt;Thanks all.&lt;/p&gt;</comment>
                            <comment id="13705936" author="rjernst" created="Thu, 11 Jul 2013 15:53:46 +0000"  >&lt;p&gt;Alan this is great, thanks so much!&lt;/p&gt;</comment>
                            <comment id="13705942" author="romseygeek" created="Thu, 11 Jul 2013 15:56:49 +0000"  >&lt;p&gt;No worries - it was lucky you raised this when you did, as I was about to completely screw it up by rewriting all the persistence logic &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13750833" author="jkrupan" created="Tue, 27 Aug 2013 00:57:22 +0000"  >&lt;p&gt;Does this issue have a fix version? Like, 4.5?&lt;/p&gt;</comment>
                            <comment id="13787120" author="jpountz" created="Sat, 5 Oct 2013 10:19:19 +0000"  >&lt;p&gt;4.5 release -&amp;gt; bulk close&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12657129">SOLR-5029</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12591851" name="SOLR-5028.patch" size="27337" author="romseygeek" created="Thu, 11 Jul 2013 14:04:32 +0000"/>
                            <attachment id="12591846" name="SOLR-5028.patch" size="24936" author="tflobbe" created="Thu, 11 Jul 2013 13:32:45 +0000"/>
                            <attachment id="12591842" name="SOLR-5028.patch" size="20829" author="romseygeek" created="Thu, 11 Jul 2013 13:08:05 +0000"/>
                            <attachment id="12591825" name="SOLR-5028.patch" size="20564" author="romseygeek" created="Thu, 11 Jul 2013 10:36:21 +0000"/>
                            <attachment id="12591814" name="SOLR-5028.patch" size="9102" author="romseygeek" created="Thu, 11 Jul 2013 09:21:55 +0000"/>
                            <attachment id="12591699" name="SOLR-5082.patch" size="4639" author="rjernst" created="Wed, 10 Jul 2013 18:33:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>337340</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 7 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1m6q7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>337663</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>