<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:06:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-7679] Schema API doesn&apos;t take similarity attribute into account when adding field types</title>
                <link>https://issues.apache.org/jira/browse/SOLR-7679</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;When using the request&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;curl -X POST -H &lt;span class=&quot;code-quote&quot;&gt;&apos;Content-type:application/json&apos;&lt;/span&gt; --data-binary &apos;{
  &lt;span class=&quot;code-quote&quot;&gt;&quot;add-field-type&quot;&lt;/span&gt;: {
    &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;fieldTypeWithSimilarity&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;class&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.solr.schema.TextField&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;analyzer&quot;&lt;/span&gt;: {
      &lt;span class=&quot;code-quote&quot;&gt;&quot;charFilters&quot;&lt;/span&gt;: [
        {
          &lt;span class=&quot;code-quote&quot;&gt;&quot;class&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;solr.PatternReplaceCharFilterFactory&quot;&lt;/span&gt;,
          &lt;span class=&quot;code-quote&quot;&gt;&quot;replacement&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;$1$1&quot;&lt;/span&gt;,
          &lt;span class=&quot;code-quote&quot;&gt;&quot;pattern&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;([a-zA-Z])\\\\1+&quot;&lt;/span&gt;
        }
      ],
      &lt;span class=&quot;code-quote&quot;&gt;&quot;tokenizer&quot;&lt;/span&gt;: {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;class&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;solr.WhitespaceTokenizerFactory&quot;&lt;/span&gt;
      }
    },
    &lt;span class=&quot;code-quote&quot;&gt;&quot;similarity&quot;&lt;/span&gt;: {
      &lt;span class=&quot;code-quote&quot;&gt;&quot;class&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.lucene.misc.SweetSpotSimilarity&quot;&lt;/span&gt;
    }
  }
}&apos; http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8983/solr/gettingstarted/schema
&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;can be seen in the updated schema.xml that the similarity attributes for the newly added field type doesn&apos;t contain a &lt;em&gt;similarity&lt;/em&gt; entry.&lt;br/&gt;
This is due to the fact that within FieldTypeXmlAdapter the similiarity element is not being added to the field type.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12837717">SOLR-7679</key>
            <summary>Schema API doesn&apos;t take similarity attribute into account when adding field types</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sarowe">Steven Rowe</assignee>
                                    <reporter username="mariusneo">Marius Grama</reporter>
                        <labels>
                    </labels>
                <created>Sun, 14 Jun 2015 21:48:09 +0000</created>
                <updated>Mon, 9 May 2016 18:46:39 +0000</updated>
                            <resolved>Fri, 19 Jun 2015 20:29:12 +0000</resolved>
                                    <version>5.2</version>
                                    <fixVersion>5.3</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>Schema and Analysis</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14585288" author="mariusneo" created="Sun, 14 Jun 2015 21:55:42 +0000"  >&lt;p&gt;Here is a patch fixing this issue.&lt;br/&gt;
Fix is done by creating the similarity element containing the sent attributes.&lt;br/&gt;
No unit test provided as part of this ticket, but within &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7182&quot; title=&quot;Make the Schema-API a first class citizen of SolrJ&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7182&quot;&gt;&lt;del&gt;SOLR-7182&lt;/del&gt;&lt;/a&gt; (work in progress) there is a unit test for this specific situation.&lt;/p&gt;</comment>
                            <comment id="14587160" author="steve_rowe" created="Mon, 15 Jun 2015 23:46:02 +0000"  >&lt;p&gt;+1, patch looks good to me.&lt;/p&gt;</comment>
                            <comment id="14588331" author="steve_rowe" created="Tue, 16 Jun 2015 16:31:39 +0000"  >&lt;blockquote&gt;&lt;p&gt;No unit test provided as part of this ticket, but within &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7182&quot; title=&quot;Make the Schema-API a first class citizen of SolrJ&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7182&quot;&gt;&lt;del&gt;SOLR-7182&lt;/del&gt;&lt;/a&gt; (work in progress) there is a unit test for this specific situation.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Marius, could you point out where the test is?  It would be preferable to commit a test with this ticket (which will almost certainly go in first).&lt;/p&gt;</comment>
                            <comment id="14591254" author="mariusneo" created="Thu, 18 Jun 2015 05:02:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt; I figured out that it is actualy easy to test the change I&apos;ve made through TestBulkSchemaAPI and I&apos;ve added in there a unit test.&lt;/p&gt;

&lt;p&gt;Attached a new version of the patch containing also a unit test for the changed functionality.&lt;/p&gt;</comment>
                            <comment id="14593764" author="steve_rowe" created="Fri, 19 Jun 2015 18:40:24 +0000"  >&lt;p&gt;Thanks Marius.&lt;/p&gt;

&lt;p&gt;I&apos;m attaching a modified patch:&lt;/p&gt;

&lt;p&gt;You switched &lt;tt&gt;TestBulkSchemaAPI&lt;/tt&gt; to using the to-be-deprecated (&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6594&quot; title=&quot;deprecate the one action only APIs for schema editing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6594&quot;&gt;&lt;del&gt;SOLR-6594&lt;/del&gt;&lt;/a&gt;) non-bulk API, via extra servlet setup in &lt;tt&gt;before()&lt;/tt&gt;, AFAICT so that you could get the &lt;tt&gt;showDefaults&lt;/tt&gt; behavior, which is not available with the bulk Schema API.  But this is a bug in &lt;tt&gt;FieldType.getNamedPropertyValues()&lt;/tt&gt;: it only outputs similarity when &lt;tt&gt;showDefaults=true&lt;/tt&gt;, but it should instead always do so.  My version of the patch fixes this bug.  (This is a round-tripping problem: manual testing shows that when managed schema is persisted, per-field-type similarity is currently dropped, which is bad.)&lt;/p&gt;

&lt;p&gt;I was then able to revert &lt;tt&gt;TestBulkSchemaAPI&lt;/tt&gt; to the previously used bulk schema API, since &lt;tt&gt;showDefaults&lt;/tt&gt; is no longer necessary to get the per-field-type similarity to show up in the schema api response.&lt;/p&gt;

&lt;p&gt;I think this is ready.  I&apos;ll commit after running Solr tests and precommit.&lt;/p&gt;

&lt;p&gt;In my testing I noticed that &lt;tt&gt;SchemaSimilarityFactory&lt;/tt&gt;, a prerequisite for setting per-field-type similarity, is not the default in any of Solr&apos;s example schemas.  See &lt;a href=&quot;http://markmail.org/message/7icpmwmdhfw4tmwv&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://markmail.org/message/7icpmwmdhfw4tmwv&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3577&quot; title=&quot;better javadocs and error messages related to global/fieldtype SimilarityFactory usage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3577&quot;&gt;&lt;del&gt;SOLR-3577&lt;/del&gt;&lt;/a&gt; for rationale.&lt;/p&gt;

&lt;p&gt;We need to let people know that in order to set per-field-type similarity, they need to first set the global similarity to &lt;tt&gt;SchemaSimilarityFactory&lt;/tt&gt; or something like it.  Unfortunately the Schema API can&apos;t yet set the global similarity - see &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7242&quot; title=&quot;Schema API: Edit remaining schema elements: Name, Version, Unique Key, and Global Similarity&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7242&quot;&gt;SOLR-7242&lt;/a&gt;.  I&apos;ll leave a comment there about the need to check/update the Solr Reference Guide for this.&lt;/p&gt;</comment>
                            <comment id="14593854" author="jira-bot" created="Fri, 19 Jun 2015 19:44:53 +0000"  >&lt;p&gt;Commit 1686491 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1686491&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1686491&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7679&quot; title=&quot;Schema API doesn&amp;#39;t take similarity attribute into account when adding field types&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7679&quot;&gt;&lt;del&gt;SOLR-7679&lt;/del&gt;&lt;/a&gt;: Schema API doesn&apos;t take similarity attribute into account when adding field types&lt;/p&gt;</comment>
                            <comment id="14593914" author="jira-bot" created="Fri, 19 Jun 2015 20:26:36 +0000"  >&lt;p&gt;Commit 1686498 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1686498&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1686498&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7679&quot; title=&quot;Schema API doesn&amp;#39;t take similarity attribute into account when adding field types&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7679&quot;&gt;&lt;del&gt;SOLR-7679&lt;/del&gt;&lt;/a&gt;: Schema API doesn&apos;t take similarity attribute into account when adding field types (merged trunk r1686491)&lt;/p&gt;</comment>
                            <comment id="14593917" author="steve_rowe" created="Fri, 19 Jun 2015 20:29:12 +0000"  >&lt;p&gt;Committed to trunk and branch_5x.&lt;/p&gt;

&lt;p&gt;Thanks Marius!&lt;/p&gt;</comment>
                            <comment id="14713099" author="shalinmangar" created="Wed, 26 Aug 2015 13:05:45 +0000"  >&lt;p&gt;Bulk close for 5.3.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12778755">SOLR-7182</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12740705" name="SOLR-7679.patch" size="5146" author="sarowe" created="Fri, 19 Jun 2015 18:40:24 +0000"/>
                            <attachment id="12740298" name="SOLR-7679.patch" size="5677" author="mariusneo" created="Thu, 18 Jun 2015 05:02:50 +0000"/>
                            <attachment id="12739521" name="SOLR-7679.patch" size="1476" author="mariusneo" created="Sun, 14 Jun 2015 21:55:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 12 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2g0zz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>