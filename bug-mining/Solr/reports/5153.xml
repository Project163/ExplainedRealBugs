<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:09:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-17120] NullPointerException in UpdateLog.applyOlderUpdates in solr 6.6-9.4 involving partial updates</title>
                <link>https://issues.apache.org/jira/browse/SOLR-17120</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;I mailed the solr-users mailing list about this issue, but didn&apos;t get any responses there, so am creating this issue. The subject of the email thread for additional context was &quot;NullPointerException in UpdateLog.applyOlderUpdates under solr 8&amp;amp;9 involving partial updates and high update load&quot; - link: &lt;a href=&quot;https://lists.apache.org/thread/n9zm4gocl7cf073syy1159dy6ojjrywl&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lists.apache.org/thread/n9zm4gocl7cf073syy1159dy6ojjrywl&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;m seeing a Solr HTTP 500 error when performing a partial update of a document that turns out to triggered by there having been a recent update of the same document that included a partial update that set a field to &lt;tt&gt;null&lt;/tt&gt;. I&apos;ve observed the behavior in versions 6.6.2, 8.11.2, and 9.4.0, which are the only 3 versions I&apos;ve tried.&lt;/p&gt;

&lt;p&gt;To give an example, an update doc like&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{
&#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;123&quot;&lt;/span&gt;,&#160;
&#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;camera_unit&quot;&lt;/span&gt;: {&lt;span class=&quot;code-quote&quot;&gt;&quot;set&quot;&lt;/span&gt;: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;followed shortly thereafter (not sure of exact timing, but I was using a &lt;tt&gt;commitWithin&lt;/tt&gt; of 600s and the subsequent updates were less than 20 seconds later), after some other updates had happened for different documents, there was another update of the same document, like&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{
&#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;123&quot;&lt;/span&gt;,&#160;
&#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;playlist&quot;&lt;/span&gt;: {
&#160; &#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;set&quot;&lt;/span&gt;: [
&#160; &#160; &#160; &#160; 12345
&#160; &#160; &#160; ]
&#160; &#160; },
&#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;playlist_index_321&quot;&lt;/span&gt;: {
&#160; &#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;set&quot;&lt;/span&gt;: 0
&#160; &#160; }
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This later update may, but doesn&apos;t always, cause the &lt;tt&gt;NullPointerException&lt;/tt&gt;, so there is some other factor such as the state of the &lt;tt&gt;tlog&lt;/tt&gt; that also has to be satisfied for the error to occur.&lt;/p&gt;

&lt;p&gt;The exception is thrown by the following code in &lt;tt&gt;UpdateLog.java&lt;/tt&gt; (&lt;tt&gt;org.apache.solr.update.UpdateLog&lt;/tt&gt;):&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;/** Add all fields from olderDoc into newerDoc &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; not already present in newerDoc */&lt;/span&gt;
&#160; &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void applyOlderUpdates(
&#160; &#160; &#160; SolrDocumentBase&amp;lt;?, ?&amp;gt; newerDoc, SolrInputDocument olderDoc, Set&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; mergeFields) {
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; fieldName : olderDoc.getFieldNames()) {
&#160; &#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the newerDoc has &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; field, then &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; field from olderDoc can be ignored
&lt;/span&gt;&#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!newerDoc.containsKey(fieldName)
&#160; &#160; &#160; &#160; &#160; &amp;amp;&amp;amp; (mergeFields == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || mergeFields.contains(fieldName))) {
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; val : olderDoc.getFieldValues(fieldName)) {
&#160; &#160; &#160; &#160; &#160; newerDoc.addField(fieldName, val);
&#160; &#160; &#160; &#160; }
&#160; &#160; &#160; }
&#160; &#160; }
&#160; }&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The exception is due to the inner for statement trying to iterate over the &lt;tt&gt;null&lt;/tt&gt; value being returned by &lt;tt&gt;olderDoc.getFieldValues(fieldName)&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;When I change that method to the following:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;/** Add all fields from olderDoc into newerDoc &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; not already present in newerDoc */&lt;/span&gt;
&#160; &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void applyOlderUpdates(
&#160; &#160; &#160; SolrDocumentBase&amp;lt;?, ?&amp;gt; newerDoc, SolrInputDocument olderDoc, Set&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; mergeFields) {
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; fieldName : olderDoc.getFieldNames()) {
&#160; &#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the newerDoc has &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; field, then &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; field from olderDoc can be ignored
&lt;/span&gt;&#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!newerDoc.containsKey(fieldName)
&#160; &#160; &#160; &#160; &#160; &amp;amp;&amp;amp; (mergeFields == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || mergeFields.contains(fieldName))) {
&#160; &#160; &#160; &#160; Collection&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; values = olderDoc.getFieldValues(fieldName);
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (values == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
&#160; &#160; &#160; &#160; &#160; &#160; newerDoc.addField(fieldName, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
&#160; &#160; &#160; &#160; } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; val : values) {
&#160; &#160; &#160; &#160; &#160; &#160; &#160; newerDoc.addField(fieldName, val);
&#160; &#160; &#160; &#160; &#160; &#160; }
&#160; &#160; &#160; &#160; }
&#160; &#160; &#160; }
&#160; &#160; }
&#160; }&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Then after rebuilding the solr-core JAR with &lt;tt&gt;./gradlew devFull&lt;/tt&gt; and restarting Solr with that custom jar file, I can no longer reproduce the error.&lt;/p&gt;

&lt;p&gt;I&apos;m not familiar with the Solr codebase though and am not at all sure that &lt;tt&gt;newerDoc.addField(fieldName, null)&lt;/tt&gt; is what should be done there.&lt;/p&gt;</description>
                <environment>&lt;p&gt;The issue occurred on Linux, CentOS 7.9, with the following JDK version:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;openjdk version &quot;11.0.20&quot; 2023-07-18 LTS
OpenJDK Runtime Environment (Red_Hat-11.0.20.0.8-1.el7_9) (build 11.0.20+8-LTS)
OpenJDK 64-Bit Server VM (Red_Hat-11.0.20.0.8-1.el7_9) (build 11.0.20+8-LTS, mixed mode, sharing)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</environment>
        <key id="13565176">SOLR-17120</key>
            <summary>NullPointerException in UpdateLog.applyOlderUpdates in solr 6.6-9.4 involving partial updates</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cpoerschke">Christine Poerschke</assignee>
                                    <reporter username="casmith">Calvin Smith</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 Jan 2024 01:55:03 +0000</created>
                <updated>Fri, 9 Feb 2024 16:38:20 +0000</updated>
                            <resolved>Wed, 24 Jan 2024 18:45:37 +0000</resolved>
                                    <version>6.6.2</version>
                    <version>8.11.2</version>
                    <version>9.4</version>
                                    <fixVersion>8.11.3</fixVersion>
                    <fixVersion>9.5</fixVersion>
                                    <component>update</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="5400">1.5h</timespent>
                                <comments>
                            <comment id="17808217" author="cpoerschke" created="Thu, 18 Jan 2024 13:50:40 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=casmith&quot; class=&quot;user-hover&quot; rel=&quot;casmith&quot;&gt;casmith&lt;/a&gt; for the detailed report on the user mailing list and for proactively proceeding to open this issue!&lt;/p&gt;

&lt;p&gt;Here&apos;s some notes from how I&apos;m reading/interpreting the issue and the code:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;You mentioned the stacktrace is 8.11.2 and we see the NPE at UpdateLog.java:962 i.e. &lt;a href=&quot;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/8.11.2/solr/core/src/java/org/apache/solr/update/UpdateLog.java#L962&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/8.11.2/solr/core/src/java/org/apache/solr/update/UpdateLog.java#L962&lt;/a&gt; and if &lt;tt&gt;olderDoc&lt;/tt&gt; was null then we&apos;d have gotten a NPE at line 959 already and therefore &lt;tt&gt;olderDoc.getFieldValues(fieldName)&lt;/tt&gt; must have returned null, as you mentioned.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;SolrInputDocument.getFieldValues&lt;/tt&gt; will return null if the field is not set&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/8.11.2/solr/solrj/src/java/org/apache/solr/common/SolrInputDocument.java#L121-L127&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/8.11.2/solr/solrj/src/java/org/apache/solr/common/SolrInputDocument.java#L121-L127&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://solr.apache.org/guide/solr/latest/indexing-guide/partial-document-updates.html#atomic-updates&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://solr.apache.org/guide/solr/latest/indexing-guide/partial-document-updates.html#atomic-updates&lt;/a&gt; documents about setting to null to remove a value.&lt;/li&gt;
	&lt;li&gt;You mention use of setting to null.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Here&apos;s some nearby code also calling &lt;tt&gt;SolrInputDocument.getFieldValues&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/8.11.2/solr/core/src/java/org/apache/solr/update/processor/AtomicUpdateDocumentMerger.java#L338-L339&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/8.11.2/solr/core/src/java/org/apache/solr/update/processor/AtomicUpdateDocumentMerger.java#L338-L339&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/8.11.2/solr/core/src/java/org/apache/solr/update/processor/CloneFieldUpdateProcessorFactory.java#L430-L431&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/8.11.2/solr/core/src/java/org/apache/solr/update/processor/CloneFieldUpdateProcessorFactory.java#L430-L431&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Based on the analysis above I think &lt;tt&gt;newerDoc.addField(fieldName, null)&lt;/tt&gt; would be incorrect i.e. &lt;tt&gt;newerDoc&lt;/tt&gt; doesn&apos;t have the field and it&apos;s not supposed to get it, hence skipping for &lt;tt&gt;fieldName&lt;/tt&gt; rather than adding of &lt;tt&gt;null&lt;/tt&gt; e.g.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
- &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; val : olderDoc.getFieldValues(fieldName)) {
+ Collection&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; values = olderDoc.getFieldValues(fieldName);
+ &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (values == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
+ &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; val : values) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Having said all that ... I&apos;m not very familiar with the partial update functionality and what puzzles me slightly is that &lt;tt&gt;olderDoc.getFieldNames()&lt;/tt&gt; returned the &lt;tt&gt;fieldName&lt;/tt&gt; but then &lt;tt&gt;olderDoc.getFieldValues()&lt;/tt&gt; returned no corresponding value ... though maybe that&apos;s something to do with multiple partial updates to the same document in succession and corresponding update log entries etc. etc. &#8211; would love to hear insights from others on this.&lt;/p&gt;</comment>
                            <comment id="17808335" author="JIRAUSER303825" created="Thu, 18 Jan 2024 18:07:57 +0000"  >&lt;p&gt;Thanks Christine for noting on the mailing list that I created the issue and for the very helpful summary and analysis above.&lt;/p&gt;

&lt;p&gt;My reasoning for setting the field to &lt;tt&gt;null&lt;/tt&gt; was that if the olderDoc for the first partial update doc that was added was&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{
&#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;123&quot;&lt;/span&gt;,&#160;
&#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;camera_unit&quot;&lt;/span&gt;: {&lt;span class=&quot;code-quote&quot;&gt;&quot;set&quot;&lt;/span&gt;: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Then the &lt;tt&gt;null&lt;/tt&gt; value reflects that it should be removed from the document (so that&apos;s why the name is returned by olderDoc.getFieldNames()&lt;tt&gt;).&lt;/tt&gt; The comment on the applyOlderUpdates method suggests that the purpose is to merge all the fields from the older doc to the newer one unless they&apos;re already present, so I thought that maybe the field that should be removed should also be merged in to the newer doc too, or else the fact that the field should be removed in the document that is ultimately saved might get lost. I don&apos;t know this code at all though, so it might be that the fields set to null in the older doc don&apos;t actually need to be merged in to the newer doc, like you suggested.&lt;/p&gt;

&lt;p&gt;I&apos;ll try with your change and see if I can confirm that the field is still removed like it&apos;s supposed to be, although it&apos;s a bit difficult to test because it&apos;s not reliably reproducible, and I&apos;ll have to catch it after it would have happened and before some other later update of the same document hasn&apos;t possibly set the field that was nulled to a non-null value, which may rely some luck.&lt;/p&gt;</comment>
                            <comment id="17808405" author="JIRAUSER303825" created="Fri, 19 Jan 2024 00:11:21 +0000"  >&lt;p&gt;I compared the effect of&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (values == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;versus calling &lt;tt&gt;addField&lt;/tt&gt; with &lt;tt&gt;null&lt;/tt&gt; like I had, and I wasn&apos;t able to observe any different outcome. In both cases, the old field values that were requested to be removed by the earlier updates that included &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{&lt;span class=&quot;code-quote&quot;&gt;&quot;set&quot;&lt;/span&gt;: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;were still processed successfully. Right after the update happened, but before the &lt;tt&gt;commitWithin&lt;/tt&gt; window had passed, I would still see the old value when querying the &lt;tt&gt;/select&lt;/tt&gt; endpoint, and using the{{ /get }}endpoint, I would not see the fields that were to have been removed, whether the later updates called addField with &lt;tt&gt;null&lt;/tt&gt; or not. Once the &lt;tt&gt;commitWindow&lt;/tt&gt; passed, then the &lt;tt&gt;/select&lt;/tt&gt; endpoint correctly showed the documents had been updated as they should have been and the fields had been removed (and other expected changes were applied).&lt;/p&gt;

&lt;p&gt;So it seems that the newerDoc definitely doesn&apos;t need the null, and maybe it&apos;s not having any effect when it is present, as things seem to work the same in both cases as far as I can tell by inspecting the state of the documents in the index after it happens.&lt;/p&gt;

&lt;p&gt;I&apos;ll stick with the version Christine suggested that does &lt;tt&gt;continue&lt;/tt&gt; while I&apos;m testing.&lt;/p&gt;</comment>
                            <comment id="17808705" author="cpoerschke" created="Fri, 19 Jan 2024 15:22:13 +0000"  >&lt;p&gt;Thanks Calvin for testing and sharing your findings!&lt;/p&gt;

&lt;p&gt;Couple of thinking out alouds and curiosity if I may, again with the caveat that I&apos;m not very familiar with the partial update functionality &#8211; about the puzzle of &lt;tt&gt;olderDoc.getFieldNames()&lt;/tt&gt; returning the &lt;tt&gt;fieldName&lt;/tt&gt; but then &lt;tt&gt;olderDoc.getFieldValues()&lt;/tt&gt; returned no corresponding value(s) &#8211; wondering&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;if the &lt;tt&gt;getFieldValues&lt;/tt&gt; return value of &lt;tt&gt;null&lt;/tt&gt; is due to the field being set to &lt;tt&gt;null&lt;/tt&gt; somehow or the field not being set &#8211; ref: &lt;a href=&quot;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/8.11.2/solr/solrj/src/java/org/apache/solr/common/SolrInputDocument.java#L121-L127&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/8.11.2/solr/solrj/src/java/org/apache/solr/common/SolrInputDocument.java#L121-L127&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;(to the extent that you are able to share) what is the field schema/definition e.g. does type make a difference or if the field is required or if the field is defaulted or multiValued etc.&lt;/li&gt;
	&lt;li&gt;about the sequence of events e.g. is it perhaps a case of a &quot;remove this field&quot; happening before there ever was an actual value for the field, or maybe there are two consecutive &quot;remove this field&quot; happenings, or variants on that theme in case of multiValued fields&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Context for my curiosity is sort of that if we understand more on how the name-but-no-value scenario arises then that could point to a different (complementary or alternative) code change and/or we might discover &apos;something else&apos; also being unexpected.&lt;/p&gt;</comment>
                            <comment id="17808791" author="JIRAUSER303825" created="Fri, 19 Jan 2024 19:39:52 +0000"  >&lt;p&gt;I can&apos;t share the full schema file or the docs unfortunately, and I&apos;m a bit pressed for time at the moment, but here&apos;s what I was able to determine:&lt;/p&gt;

&lt;p&gt;&#160;- the 8 fields that the error occurs for in my most easily reproducible case are all single-valued (I only know it is 8 fields due to modifying the code to skip the null and print to stdout when the error would have happened); 7 of them are a &apos;lowercase&apos; field type and the other is &apos;text_en_splitting_tight&apos; (as those are defined in the default schema); I wouldn&apos;t read much into that though, as those are common field types in our schema&lt;br/&gt;
&#160;- I was able to establish that all fields that the error would have happened for were not set in the doc version in the index (but this doesn&apos;t seem to matter, as I describe below), and all of them had a previous partial update in the same &lt;tt&gt;commitWithin&lt;/tt&gt; window that set the field to null&lt;/p&gt;

&lt;p&gt;So, for example, if the original full doc in the index contained:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{
&#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;123&quot;&lt;/span&gt;,
&#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;bar&quot;&lt;/span&gt;,
&#160; &#160; ...
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;it did not contain a &apos;field1&apos;, &apos;field2&apos;, ..., &apos;field8&apos;.&lt;/p&gt;

&lt;p&gt;Then there were multiple partial updates, one of which included:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{
&#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;123&quot;&lt;/span&gt;,
&#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;: {&lt;span class=&quot;code-quote&quot;&gt;&quot;set&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;baz&quot;&lt;/span&gt;},
&#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;field1&quot;&lt;/span&gt;: {&lt;span class=&quot;code-quote&quot;&gt;&quot;set&quot;&lt;/span&gt;: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;},
&#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;field2&quot;&lt;/span&gt;: {&lt;span class=&quot;code-quote&quot;&gt;&quot;set&quot;&lt;/span&gt;: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;},
&#160; &#160; ...
&#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;field8&quot;&lt;/span&gt;: {&lt;span class=&quot;code-quote&quot;&gt;&quot;set&quot;&lt;/span&gt;: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and then after some other updates (of both doc &quot;123&quot;, none of which set field1-field8), there was an update like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{
&#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;123&quot;&lt;/span&gt;,
&#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;differentfield1&quot;&lt;/span&gt;: {
&#160; &#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;set&quot;&lt;/span&gt;: [
&#160; &#160; &#160; &#160; 348459
&#160; &#160; &#160; ]
&#160; &#160; },
&#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;differentfield2&quot;&lt;/span&gt;: {
&#160; &#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;set&quot;&lt;/span&gt;: 2
&#160; &#160; }
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which does nothing with any of the &lt;tt&gt;field1-field8&lt;/tt&gt;, and the &lt;tt&gt;NullPointerException&lt;/tt&gt; is thrown then because the older doc returns &lt;tt&gt;null&lt;/tt&gt; for whichever of the &lt;tt&gt;field1-field8&lt;/tt&gt; is processed first.&lt;/p&gt;

&lt;p&gt;It doesn&apos;t appear to matter whether the document in the index originally has a value for field1-field8 or not though, as I was able to reproduce the problem with an identical stack trace even if all those fields had values originally.&lt;/p&gt;

&lt;p&gt;So to summarize,&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;it doesn&apos;t matter if the field in the doc in the index originally has a value or not&lt;/li&gt;
	&lt;li&gt;it happens when there was just 1 prior partial update that set the field to null&lt;/li&gt;
	&lt;li&gt;there are other updates of other fields on that doc (and unrelated updates of other docs) in between the partial update that sets the field to null and the doc that causes the &lt;tt&gt;NullPointerException&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;the update that causes the error included only updates to fields other than &lt;tt&gt;field1-field8&lt;/tt&gt; (the ones that were set to null in the earlier update)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Also, since I didn&apos;t include the stack trace here, and I originally gave the stack trace as for version 8.11.2, here&apos;s the stack trace for 9.4.0, which is the version I&apos;ve been using for most of my testing:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2024-01-19 18:33:10.160 ERROR (qtp726408598-34) [ x:app t:0.0.0.0-34] o.a.s.s.HttpSolrCall 500 Exception =&amp;gt; java.lang.NullPointerException
&#160; &#160; at org.apache.solr.update.UpdateLog.applyOlderUpdates(UpdateLog.java:1025)
java.lang.NullPointerException: null
&#160; &#160; at org.apache.solr.update.UpdateLog.applyOlderUpdates(UpdateLog.java:1025) ~[?:?]
&#160; &#160; at org.apache.solr.update.UpdateLog.applyPartialUpdates(UpdateLog.java:992) ~[?:?]
&#160; &#160; at org.apache.solr.handler.component.RealTimeGetComponent.resolveFullDocument(RealTimeGetComponent.java:476) ~[?:?]
&#160; &#160; at org.apache.solr.handler.component.RealTimeGetComponent.getInputDocumentFromTlog(RealTimeGetComponent.java:720) ~[?:?]
&#160; &#160; at org.apache.solr.handler.component.RealTimeGetComponent.getInputDocumentFromTlog(RealTimeGetComponent.java:657) ~[?:?]
&#160; &#160; at org.apache.solr.handler.component.RealTimeGetComponent.getInputDocument(RealTimeGetComponent.java:773) ~[?:?]
&#160; &#160; at org.apache.solr.update.processor.DistributedUpdateProcessor.getUpdatedDocument(DistributedUpdateProcessor.java:788) ~[?:?]
&#160; &#160; at org.apache.solr.update.processor.DistributedUpdateProcessor.doVersionAdd(DistributedUpdateProcessor.java:406) ~[?:?]
&#160; &#160; at org.apache.solr.update.processor.DistributedUpdateProcessor.lambda$versionAdd$0(DistributedUpdateProcessor.java:356) ~[?:?]
&#160; &#160; at org.apache.solr.update.VersionBucket.runWithLock(VersionBucket.java:51) ~[?:?]
&#160; &#160; at org.apache.solr.update.processor.DistributedUpdateProcessor.versionAdd(DistributedUpdateProcessor.java:353) ~[?:?]
&#160; &#160; at org.apache.solr.update.processor.DistributedUpdateProcessor.processAdd(DistributedUpdateProcessor.java:234) ~[?:?]
&#160; &#160; at org.apache.solr.update.processor.LogUpdateProcessorFactory$LogUpdateProcessor.processAdd(LogUpdateProcessorFactory.java:111) ~[?:?]
&#160; &#160; at org.apache.solr.handler.loader.JsonLoader$SingleThreadedJsonLoader.handleAdds(JsonLoader.java:553) ~[?:?]
&#160; &#160; at org.apache.solr.handler.loader.JsonLoader$SingleThreadedJsonLoader.processUpdate(JsonLoader.java:183) ~[?:?]
&#160; &#160; at org.apache.solr.handler.loader.JsonLoader$SingleThreadedJsonLoader.load(JsonLoader.java:151) ~[?:?]
&#160; &#160; at org.apache.solr.handler.loader.JsonLoader.load(JsonLoader.java:86) ~[?:?]
&#160; &#160; at org.apache.solr.handler.UpdateRequestHandler$1.load(UpdateRequestHandler.java:102) ~[?:?]
&#160; &#160; at org.apache.solr.handler.ContentStreamHandlerBase.handleRequestBody(ContentStreamHandlerBase.java:100) ~[?:?]
&#160; &#160; at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:226) ~[?:?]
&#160; &#160; at org.apache.solr.core.SolrCore.execute(SolrCore.java:2901) ~[?:?]
&#160; &#160; at org.apache.solr.servlet.HttpSolrCall.executeCoreRequest(HttpSolrCall.java:875) ~[?:?]
&#160; &#160; at org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:561) ~[?:?]
&#160; &#160; at org.apache.solr.servlet.SolrDispatchFilter.dispatch(SolrDispatchFilter.java:262) ~[?:?]
&#160; &#160; at org.apache.solr.servlet.SolrDispatchFilter.lambda$doFilter$0(SolrDispatchFilter.java:219) ~[?:?]
&#160; &#160; at org.apache.solr.servlet.ServletUtils.traceHttpRequestExecution2(ServletUtils.java:246) ~[?:?]
&#160; &#160; at org.apache.solr.servlet.ServletUtils.rateLimitRequest(ServletUtils.java:215) ~[?:?]
&#160; &#160; at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:213) ~[?:?]
&#160; &#160; at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:195) ~[?:?]
&#160; &#160; at org.eclipse.jetty.servlet.FilterHolder.doFilter(FilterHolder.java:210) ~[jetty-servlet-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.servlet.ServletHandler$Chain.doFilter(ServletHandler.java:1635) ~[jetty-servlet-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:527) ~[jetty-servlet-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:131) ~[jetty-server-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:598) ~[jetty-security-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:122) ~[jetty-server-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:223) ~[jetty-server-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1570) ~[jetty-server-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:221) ~[jetty-server-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1384) ~[jetty-server-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:176) ~[jetty-server-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:484) ~[jetty-servlet-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1543) ~[jetty-server-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:174) ~[jetty-server-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1306) ~[jetty-server-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:129) ~[jetty-server-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:149) ~[jetty-server-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.server.handler.InetAccessHandler.handle(InetAccessHandler.java:228) ~[jetty-server-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:141) ~[jetty-server-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:122) ~[jetty-server-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.rewrite.handler.RewriteHandler.handle(RewriteHandler.java:301) ~[jetty-rewrite-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:122) ~[jetty-server-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.server.handler.gzip.GzipHandler.handle(GzipHandler.java:822) ~[jetty-server-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:122) ~[jetty-server-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.server.Server.handle(Server.java:563) ~[jetty-server-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.server.HttpChannel$RequestDispatchable.dispatch(HttpChannel.java:1598) ~[jetty-server-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.server.HttpChannel.dispatch(HttpChannel.java:753) ~[jetty-server-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:501) ~[jetty-server-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:287) ~[jetty-server-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:314) ~[jetty-io-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:100) ~[jetty-io-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.io.SelectableChannelEndPoint$1.run(SelectableChannelEndPoint.java:53) ~[jetty-io-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy.runTask(AdaptiveExecutionStrategy.java:421) ~[jetty-util-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy.consumeTask(AdaptiveExecutionStrategy.java:390) ~[jetty-util-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy.tryProduce(AdaptiveExecutionStrategy.java:277) ~[jetty-util-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.util.thread.strategy.AdaptiveExecutionStrategy.run(AdaptiveExecutionStrategy.java:199) ~[jetty-util-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:411) ~[jetty-util-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:969) ~[jetty-util-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.util.thread.QueuedThreadPool$Runner.doRunJob(QueuedThreadPool.java:1194) ~[jetty-util-10.0.17.jar:10.0.17]
&#160; &#160; at org.eclipse.jetty.util.thread.QueuedThreadPool$Runner.run(QueuedThreadPool.java:1149) ~[jetty-util-10.0.17.jar:10.0.17]
&#160; &#160; at java.lang.Thread.run(Thread.java:829) [?:?]&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Thanks again for your help.&lt;/p&gt;</comment>
                            <comment id="17809399" author="cpoerschke" created="Mon, 22 Jan 2024 12:03:04 +0000"  >&lt;p&gt;Thanks Calvin for all the info above!&lt;/p&gt;

&lt;p&gt;Based on the info above, I was able to reproduce the NPE locally&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;by adding two extra fields to the &lt;tt&gt;films&lt;/tt&gt; example considering the &lt;a href=&quot;https://solr.apache.org/guide/solr/latest/indexing-guide/partial-document-updates.html#in-place-updates&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://solr.apache.org/guide/solr/latest/indexing-guide/partial-document-updates.html#in-place-updates&lt;/a&gt; info, and&lt;/li&gt;
	&lt;li&gt;by making &lt;tt&gt;/get&lt;/tt&gt; calls that exercise the code paths in question. Will attach the script to this JIRA item.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Having read more of the code in the process and also noting the &lt;a href=&quot;https://github.com/apache/solr/blob/releases/solr/9.4.1/solr/core/src/java/org/apache/solr/update/UpdateLog.java#L1017&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/solr/blob/releases/solr/9.4.1/solr/core/src/java/org/apache/solr/update/UpdateLog.java#L1017&lt;/a&gt; comment which reads&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;/** Add all fields from olderDoc into newerDoc &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; not already present in newerDoc */&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I&apos;m now then inclined to think that your original solution with the &lt;tt&gt;newerDoc.addField(fieldName, null);&lt;/tt&gt; is preferable.&lt;/p&gt;

&lt;p&gt;Would you like to open a pull request for the change, for &lt;tt&gt;main&lt;/tt&gt; branch?&lt;/p&gt;</comment>
                            <comment id="17809635" author="gerlowskija" created="Mon, 22 Jan 2024 20:34:09 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke&quot; class=&quot;user-hover&quot; rel=&quot;cpoerschke&quot;&gt;cpoerschke&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=casmith&quot; class=&quot;user-hover&quot; rel=&quot;casmith&quot;&gt;casmith&lt;/a&gt; - thanks for all your work so far figuring this out!  (I agree with Christine - one of the best JIRA writeups I&apos;ve seen lately!)&lt;/p&gt;

&lt;p&gt;I don&apos;t have much context here, but stumbled across this ticket in preparing for the upcoming 9.5.0 release.  I see it&apos;s not marked as a &quot;Blocker&quot;, but the Fix-Version is 9.5?  Is this high-impact enough that it should be a Blocker, or is it not worth holding up the 9.5 RC for?  My tentative target for RC1 was this Thursday the 25th or Friday the 26th. &lt;/p&gt;

&lt;p&gt;Thanks for clarifying!&lt;/p&gt;</comment>
                            <comment id="17809672" author="JIRAUSER303825" created="Mon, 22 Jan 2024 23:04:03 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke&quot; class=&quot;user-hover&quot; rel=&quot;cpoerschke&quot;&gt;cpoerschke&lt;/a&gt; , that&apos;s great that you were able to reproduce it. I&apos;ll start a pull request.&lt;/p&gt;

&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gerlowskija&quot; class=&quot;user-hover&quot; rel=&quot;gerlowskija&quot;&gt;gerlowskija&lt;/a&gt; , I don&apos;t know how the project decides on what&apos;s a blocker or not, but imho, it would be nice to get it in 9.5 if practical, but it shouldn&apos;t block the release, because it&apos;s not a regression or something that is likely to affect many users (I was able to reproduce it back as far as version 6.6.2 (as far back as I checked), but have never run into it through years of the same kinds of activity (at lower update rates) as triggers the exception).&lt;/p&gt;</comment>
                            <comment id="17809709" author="JIRAUSER303825" created="Tue, 23 Jan 2024 02:16:42 +0000"  >&lt;p&gt;I created a pull request: &lt;a href=&quot;https://github.com/apache/solr/pull/2214&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/solr/pull/2214&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The s3 tests failed for me. I&apos;ve tried getting rid of my existing ~/.aws/config and ~/.aws/credentials files in case there was anything unexpected in there, since the error seemed to be the same as one other people were getting when there were issues with one of those confs.&lt;/p&gt;

&lt;p&gt;EDIT: All the tests did pass after I renamed my aws config files, so there must have been something in them that the java sdk didn&apos;t tolerate but was okay for the aws cli and the python sdk that I usually use.&lt;/p&gt;</comment>
                            <comment id="17810521" author="jira-bot" created="Wed, 24 Jan 2024 18:29:15 +0000"  >&lt;p&gt;Commit 571c8871278bc14aea683420aea58ef64e38bbae in solr&apos;s branch refs/heads/main from Calvin Smith&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=571c8871278&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=571c8871278&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17120&quot; title=&quot;NullPointerException in UpdateLog.applyOlderUpdates in solr 6.6-9.4 involving partial updates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17120&quot;&gt;&lt;del&gt;SOLR-17120&lt;/del&gt;&lt;/a&gt;: handle null value when merging partials (#2214)&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17120&quot; title=&quot;NullPointerException in UpdateLog.applyOlderUpdates in solr 6.6-9.4 involving partial updates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17120&quot;&gt;&lt;del&gt;SOLR-17120&lt;/del&gt;&lt;/a&gt; handle null value when merging partials&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;this change avoids a `NullPointerException` that can occur&lt;br/&gt;
    under some circumstances when performing multiple partial&lt;br/&gt;
    updates of the same document&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17810523" author="jira-bot" created="Wed, 24 Jan 2024 18:38:47 +0000"  >&lt;p&gt;Commit e0ce8f60da8c97a765f598e9ee36438715e964f7 in solr&apos;s branch refs/heads/branch_9x from Calvin Smith&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=e0ce8f60da8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=e0ce8f60da8&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17120&quot; title=&quot;NullPointerException in UpdateLog.applyOlderUpdates in solr 6.6-9.4 involving partial updates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17120&quot;&gt;&lt;del&gt;SOLR-17120&lt;/del&gt;&lt;/a&gt;: handle null value when merging partials (#2214)&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17120&quot; title=&quot;NullPointerException in UpdateLog.applyOlderUpdates in solr 6.6-9.4 involving partial updates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17120&quot;&gt;&lt;del&gt;SOLR-17120&lt;/del&gt;&lt;/a&gt; handle null value when merging partials&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;this change avoids a `NullPointerException` that can occur&lt;br/&gt;
    under some circumstances when performing multiple partial&lt;br/&gt;
    updates of the same document&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;(cherry picked from commit 571c8871278bc14aea683420aea58ef64e38bbae)&lt;/p&gt;</comment>
                            <comment id="17810525" author="jira-bot" created="Wed, 24 Jan 2024 18:41:39 +0000"  >&lt;p&gt;Commit 0de8d70df0f2b5482ada41fb4479f74cda4c0d76 in solr&apos;s branch refs/heads/branch_9_5 from Calvin Smith&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=0de8d70df0f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=0de8d70df0f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17120&quot; title=&quot;NullPointerException in UpdateLog.applyOlderUpdates in solr 6.6-9.4 involving partial updates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17120&quot;&gt;&lt;del&gt;SOLR-17120&lt;/del&gt;&lt;/a&gt;: handle null value when merging partials (#2214)&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17120&quot; title=&quot;NullPointerException in UpdateLog.applyOlderUpdates in solr 6.6-9.4 involving partial updates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17120&quot;&gt;&lt;del&gt;SOLR-17120&lt;/del&gt;&lt;/a&gt; handle null value when merging partials&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;this change avoids a `NullPointerException` that can occur&lt;br/&gt;
    under some circumstances when performing multiple partial&lt;br/&gt;
    updates of the same document&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;(cherry picked from commit 571c8871278bc14aea683420aea58ef64e38bbae)&lt;br/&gt;
(cherry picked from commit e0ce8f60da8c97a765f598e9ee36438715e964f7)&lt;/p&gt;</comment>
                            <comment id="17810527" author="cpoerschke" created="Wed, 24 Jan 2024 18:45:37 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=casmith&quot; class=&quot;user-hover&quot; rel=&quot;casmith&quot;&gt;casmith&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="17810556" author="JIRAUSER303825" created="Wed, 24 Jan 2024 20:20:42 +0000"  >&lt;p&gt;My pleasure. Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cpoerschke&quot; class=&quot;user-hover&quot; rel=&quot;cpoerschke&quot;&gt;cpoerschke&lt;/a&gt;&#160; for all your help and for getting this into main so quickly.&lt;/p&gt;</comment>
                            <comment id="17811347" author="jira-bot" created="Fri, 26 Jan 2024 17:21:40 +0000"  >&lt;p&gt;Commit 78e618444690b9ddf285e416d8045a11dceb711b in lucene-solr&apos;s branch refs/heads/branch_8_11 from Christine Poerschke&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=78e61844469&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=78e61844469&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17120&quot; title=&quot;NullPointerException in UpdateLog.applyOlderUpdates in solr 6.6-9.4 involving partial updates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17120&quot;&gt;&lt;del&gt;SOLR-17120&lt;/del&gt;&lt;/a&gt;: handle null value when merging partials (backport of solr#2214) (#2683)&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17120&quot; title=&quot;NullPointerException in UpdateLog.applyOlderUpdates in solr 6.6-9.4 involving partial updates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17120&quot;&gt;&lt;del&gt;SOLR-17120&lt;/del&gt;&lt;/a&gt; handle null value when merging partials&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;this change avoids a `NullPointerException` that can occur&lt;br/&gt;
    under some circumstances when performing multiple partial&lt;br/&gt;
    updates of the same document&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Co-authored-by: Calvin Smith &amp;lt;eukaryote@users.noreply.github.com&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17811350" author="cpoerschke" created="Fri, 26 Jan 2024 17:25:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/lucene-solr/pull/2683&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/pull/2683&lt;/a&gt; as per above backported for the upcoming (as per &lt;a href=&quot;https://lists.apache.org/thread/6vl1t5bmqqym2w3kgvrdb7f71njc1moc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lists.apache.org/thread/6vl1t5bmqqym2w3kgvrdb7f71njc1moc&lt;/a&gt; mailing list thread) 8.11.3 release too.&lt;/p&gt;</comment>
                            <comment id="17812471" author="jira-bot" created="Tue, 30 Jan 2024 21:00:37 +0000"  >&lt;p&gt;Commit 571c8871278bc14aea683420aea58ef64e38bbae in solr&apos;s branch refs/heads/jira/&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16858&quot; title=&quot;Allow KnnQParser to selectively apply filters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16858&quot;&gt;&lt;del&gt;SOLR-16858&lt;/del&gt;&lt;/a&gt; from Calvin Smith&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=571c8871278&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=571c8871278&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17120&quot; title=&quot;NullPointerException in UpdateLog.applyOlderUpdates in solr 6.6-9.4 involving partial updates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17120&quot;&gt;&lt;del&gt;SOLR-17120&lt;/del&gt;&lt;/a&gt;: handle null value when merging partials (#2214)&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17120&quot; title=&quot;NullPointerException in UpdateLog.applyOlderUpdates in solr 6.6-9.4 involving partial updates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17120&quot;&gt;&lt;del&gt;SOLR-17120&lt;/del&gt;&lt;/a&gt; handle null value when merging partials&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;this change avoids a `NullPointerException` that can occur&lt;br/&gt;
    under some circumstances when performing multiple partial&lt;br/&gt;
    updates of the same document&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17816142" author="houston" created="Fri, 9 Feb 2024 16:38:20 +0000"  >&lt;p&gt;Closing after the 8.11.3 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13066184" name="demo.sh" size="1548" author="cpoerschke" created="Mon, 22 Jan 2024 12:03:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 39 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1mu0g:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>