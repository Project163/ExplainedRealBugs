<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:24:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-8392] SolrParam.get(String) returns String and shouldn&apos;t be used in other instanceof checks</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8392</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;There&apos;s a couple of places where we declare the return type of solrParams.get() as an Object and then do instanceof checks for other types. Since we know it will be a String, we can simplify this logic in several places.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12920148">SOLR-8392</key>
            <summary>SolrParam.get(String) returns String and shouldn&apos;t be used in other instanceof checks</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mdrob">Mike Drob</assignee>
                                    <reporter username="mdrob">Mike Drob</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Dec 2015 18:14:31 +0000</created>
                <updated>Thu, 12 May 2022 00:26:55 +0000</updated>
                            <resolved>Thu, 11 Jun 2020 19:22:46 +0000</resolved>
                                                    <fixVersion>9.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="15047179" author="mdrob" created="Tue, 8 Dec 2015 18:15:59 +0000"  >&lt;p&gt;&lt;tt&gt;patch -p0&lt;/tt&gt; attached against trunk.&lt;/p&gt;</comment>
                            <comment id="15048141" author="varunthacker" created="Wed, 9 Dec 2015 06:34:36 +0000"  >&lt;p&gt;Hi Mike,&lt;/p&gt;

&lt;p&gt;Instead of this in your patch - &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;-            &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; updateTimeoutSecsParam = getSolrRequest().getParams().get(UPDATE_TIMEOUT_SECS);
+            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; updateTimeoutSecsParam = getSolrRequest().getParams().get(UPDATE_TIMEOUT_SECS);
             &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (updateTimeoutSecsParam != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
-              updateTimeoutSecs = (updateTimeoutSecsParam &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Number&lt;/span&gt;)
-                  ? ((&lt;span class=&quot;code-object&quot;&gt;Number&lt;/span&gt;) updateTimeoutSecsParam).intValue()
-                  : &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.parseInt(updateTimeoutSecsParam.toString());
+              updateTimeoutSecs = &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.parseInt(updateTimeoutSecsParam);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It&apos;s okay if we just do &lt;tt&gt;updateTimeoutSecs = getSolrRequest().getParams().getInt(UPDATE_TIMEOUT_SECS);&lt;/tt&gt; right? SchemaManager#doOperations deals with the case of updateTimeoutSecs being null .&lt;/p&gt;

&lt;p&gt;On a side note, Why should MapSolrParams support the &lt;tt&gt;getParams&lt;/tt&gt; method. We have &lt;tt&gt;MultiMapSolrParams&lt;/tt&gt; if someone wants to have multiple values for a key. I tried playing around and have &lt;tt&gt;MapSolrParams#getParams&lt;/tt&gt; throw a &lt;tt&gt;UnsupportedOperationException&lt;/tt&gt; but looks like it will involve a fair amount of refactoring to get that working.&lt;/p&gt;</comment>
                            <comment id="15048203" author="mdrob" created="Wed, 9 Dec 2015 07:25:20 +0000"  >&lt;p&gt;I&apos;m not sure we can do that since updateTimeoutSecs is a class field. One request could set it, and the next request could not specify it and current behaviour would be to continue to use the first value. Indiscriminately overwriting it would be a change. However, I do think we can use getInt on the change in SchemaHandler.&lt;/p&gt;

&lt;p&gt;Regarding MapSolrParams, I suspect this class was created before Java introduced generics, so it might have some rough edges with type safety. I&apos;m not sure what to do about &lt;tt&gt;getParams&lt;/tt&gt; but it looks like &lt;tt&gt;get&lt;/tt&gt; can be simplified quite a bit. Some cursory analysis makes me think that returning a single-element array for &lt;tt&gt;getParams&lt;/tt&gt; is totally fine, and it meets the API contract to return an array with all (one) elements.&lt;/p&gt;</comment>
                            <comment id="15048306" author="varunthacker" created="Wed, 9 Dec 2015 08:44:09 +0000"  >&lt;p&gt;Hi Mike,&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;m not sure we can do that since updateTimeoutSecs is a class field. One request could set it, and the next request could not specify it and current behaviour would be to continue to use the first value. Indiscriminately overwriting it would be a change. However, I do think we can use getInt on the change in SchemaHandler.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;True&lt;/p&gt;

&lt;p&gt;New patch looks good!&lt;/p&gt;</comment>
                            <comment id="16037307" author="varunthacker" created="Mon, 5 Jun 2017 18:13:41 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mdrob&quot; class=&quot;user-hover&quot; rel=&quot;mdrob&quot;&gt;mdrob&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Do you want to assign this to yourself now and commit it?&lt;/p&gt;</comment>
                            <comment id="16047134" author="mdrob" created="Mon, 12 Jun 2017 22:10:21 +0000"  >&lt;p&gt;Yea, I&apos;ll take care of it.&lt;/p&gt;</comment>
                            <comment id="16047152" author="jira-bot" created="Mon, 12 Jun 2017 22:32:49 +0000"  >&lt;p&gt;Commit 94220a01e14f53e0632bfbc1678661ad9c67320a in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mdrob&quot; class=&quot;user-hover&quot; rel=&quot;mdrob&quot;&gt;mdrob&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=94220a0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=94220a0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8392&quot; title=&quot;SolrParam.get(String) returns String and shouldn&amp;#39;t be used in other instanceof checks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8392&quot;&gt;&lt;del&gt;SOLR-8392&lt;/del&gt;&lt;/a&gt;: Remove instanceof checks on return value of SolrParam::get&lt;/p&gt;</comment>
                            <comment id="16047738" author="shalinmangar" created="Tue, 13 Jun 2017 11:08:09 +0000"  >&lt;p&gt;I&apos;m seeing test failures (specifically TestSolrConfigHandlerCloud) related to this change with the following in the logs:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;25770 ERROR (qtp45094468-154) [n:127.0.0.1:39181_ c:collection1 s:shard1 r:core_node4 x:collection1] o.a.s.s.HttpSolrCall &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;:java.lang.ClassCastException: [Ljava.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;; cannot be &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; to java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;
	at org.apache.solr.common.params.MapSolrParams.getParams(MapSolrParams.java:39)
	at org.apache.solr.common.params.MultiMapSolrParams.asMultiMap(MultiMapSolrParams.java:103)
	at org.apache.solr.common.params.MultiMapSolrParams.asMultiMap(MultiMapSolrParams.java:81)
	at org.apache.solr.request.json.RequestUtil.processParams(RequestUtil.java:119)
	at org.apache.solr.util.SolrPluginUtils.setDefaults(SolrPluginUtils.java:177)
	at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:175)
	at org.apache.solr.core.SolrCore.execute(SolrCore.java:2487)
	at org.apache.solr.servlet.HttpSolrCall.execute(HttpSolrCall.java:722)
	at org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:528)
	at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:374)
	at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:318)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16047941" author="noble.paul" created="Tue, 13 Jun 2017 14:07:23 +0000"  >&lt;p&gt;Reopened because of test failures&lt;/p&gt;</comment>
                            <comment id="16048046" author="mdrob" created="Tue, 13 Jun 2017 15:41:40 +0000"  >&lt;p&gt;Sigh. Sorry about that, guys. I&apos;ll take care of this today.&lt;/p&gt;</comment>
                            <comment id="16048414" author="mdrob" created="Tue, 13 Jun 2017 21:18:26 +0000"  >&lt;p&gt;It looks like we use raw types somewhere to shove a &lt;tt&gt;String[]&lt;/tt&gt; value into a map that we later claim is &lt;tt&gt;String, String&lt;/tt&gt;. I&apos;m not able to actually find the place where it happens to fix that, so I&apos;ll revert to make tests happier and come back to it later.&lt;/p&gt;</comment>
                            <comment id="16048415" author="jira-bot" created="Tue, 13 Jun 2017 21:19:31 +0000"  >&lt;p&gt;Commit d1db5f7af9edb2125583c6c63fa322380ee57cf7 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mdrob&quot; class=&quot;user-hover&quot; rel=&quot;mdrob&quot;&gt;mdrob&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d1db5f7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d1db5f7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Revert &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8392&quot; title=&quot;SolrParam.get(String) returns String and shouldn&amp;#39;t be used in other instanceof checks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8392&quot;&gt;&lt;del&gt;SOLR-8392&lt;/del&gt;&lt;/a&gt;: Remove instanceof checks on return value of SolrParam::get&quot;&lt;/p&gt;

&lt;p&gt;This reverts commit 94220a01e14f53e0632bfbc1678661ad9c67320a.&lt;/p&gt;</comment>
                            <comment id="16048598" author="jira-bot" created="Wed, 14 Jun 2017 02:02:45 +0000"  >&lt;p&gt;Commit d1db5f7af9edb2125583c6c63fa322380ee57cf7 in lucene-solr&apos;s branch refs/heads/jira/&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10834&quot; title=&quot;test configs should be changed to stop using numeric based uniqueKey field&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10834&quot;&gt;&lt;del&gt;SOLR-10834&lt;/del&gt;&lt;/a&gt; from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mdrob&quot; class=&quot;user-hover&quot; rel=&quot;mdrob&quot;&gt;mdrob&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d1db5f7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d1db5f7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Revert &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8392&quot; title=&quot;SolrParam.get(String) returns String and shouldn&amp;#39;t be used in other instanceof checks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8392&quot;&gt;&lt;del&gt;SOLR-8392&lt;/del&gt;&lt;/a&gt;: Remove instanceof checks on return value of SolrParam::get&quot;&lt;/p&gt;

&lt;p&gt;This reverts commit 94220a01e14f53e0632bfbc1678661ad9c67320a.&lt;/p&gt;</comment>
                            <comment id="17128617" author="erickerickson" created="Mon, 8 Jun 2020 20:26:18 +0000"  >&lt;p&gt;Kudos for tackling this. This kind of thing is why I&apos;m afraid to do much code rearranging while getting the warnings out, each one is going to require thought....&lt;/p&gt;</comment>
                            <comment id="17128878" author="dsmiley" created="Tue, 9 Jun 2020 05:32:23 +0000"  >&lt;blockquote&gt;&lt;p&gt;It looks like we use raw types somewhere to shove a String[] value into a map that we later claim is String, String.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;OMG that&apos;s terrible; it&apos;s an embarrassment.&lt;/p&gt;</comment>
                            <comment id="17129220" author="erickerickson" created="Tue, 9 Jun 2020 12:28:15 +0000"  >&lt;p&gt;This is also why I&apos;m making the effort with warnings. What I&apos;m doing now will &lt;em&gt;NOT&lt;/em&gt; really help uncover this in existing code, but my hope is we&apos;ll be able to keep this kind of nonsense out of the code going forward. Or at least cause people to look.&lt;/p&gt;

&lt;p&gt;BTW, the changes I&apos;m making are aesthetically ugly. One key to where to look first in addressing will be the ugliest code &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17133615" author="jira-bot" created="Thu, 11 Jun 2020 19:22:13 +0000"  >&lt;p&gt;Commit fb98f30a61f929326105718d2d284d761ac1b6e3 in lucene-solr&apos;s branch refs/heads/master from Mike Drob&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=fb98f30&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=fb98f30&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8392&quot; title=&quot;SolrParam.get(String) returns String and shouldn&amp;#39;t be used in other instanceof checks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8392&quot;&gt;&lt;del&gt;SOLR-8392&lt;/del&gt;&lt;/a&gt; type safety on SolrParam (#1556)&lt;/p&gt;
</comment>
                            <comment id="17133616" author="mdrob" created="Thu, 11 Jun 2020 19:23:17 +0000"  >&lt;p&gt;Hopefully that fixes this, but if it doesn&apos;t then we should at least get a good idea of the failures that we can see.&lt;/p&gt;</comment>
                            <comment id="17133721" author="dsmiley" created="Thu, 11 Jun 2020 21:48:27 +0000"  >&lt;p&gt;Thanks Mike!  I like the assertions.&lt;/p&gt;

&lt;p&gt;I noticed a special case on the empty string that has me scratching my head (and yours too I see with the appropriate addition of the comment).  Git blame points to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt;  see &lt;a href=&quot;https://github.com/apache/lucene-solr/blob/fb98f30a61f929326105718d2d284d761ac1b6e3/solr/core/src/java/org/apache/solr/core/RequestParams.java#L91&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/fb98f30a61f929326105718d2d284d761ac1b6e3/solr/core/src/java/org/apache/solr/core/RequestParams.java#L91&lt;/a&gt;   What is that about?  We we copy the array for values when the key is non-empty, shouldn&apos;t we do the same when the key is empty?&lt;/p&gt;

&lt;p&gt;BTW as a small optimization, we might not copy the values array if the size is zero.  I&apos;m not sure if that would happen in practice though.&lt;/p&gt;</comment>
                            <comment id="17535693" author="janhoy" created="Thu, 12 May 2022 00:26:55 +0000"  >&lt;p&gt;Closing after the 9.0.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12776498" name="SOLR-8392.patch" size="3483" author="mdrob" created="Wed, 9 Dec 2015 07:25:20 +0000"/>
                            <attachment id="12776361" name="SOLR-8392.patch" size="2839" author="mdrob" created="Tue, 8 Dec 2015 18:15:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 26 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2pm1z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>