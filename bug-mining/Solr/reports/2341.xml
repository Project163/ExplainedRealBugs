<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:02:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-6214] Snapshots numberToKeep param only keeps n-1 backups</title>
                <link>https://issues.apache.org/jira/browse/SOLR-6214</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The numberToKeep param for snapshots doesn&apos;t work anymore. If you set the param to &apos;2&apos;, only &apos;1&apos; backup is kept.&lt;/p&gt;

&lt;p&gt;In the ReplicationHandler in line 377 snapShooter.validateCreateSnapshot(); creates an empty directory for the new snapshot. The deleteOldBackups() method in Snapshooter which will be executed before the backup is created, now sees the two directories an deletes the old one. But this is wrong because the empty directory for the new backup should not be considered.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12724398">SOLR-6214</key>
            <summary>Snapshots numberToKeep param only keeps n-1 backups</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shalin">Shalin Shekhar Mangar</assignee>
                                    <reporter username="maho">Maho NAKATA</reporter>
                        <labels>
                    </labels>
                <created>Mon, 30 Jun 2014 09:07:34 +0000</created>
                <updated>Mon, 9 May 2016 18:51:59 +0000</updated>
                            <resolved>Thu, 12 Feb 2015 09:38:43 +0000</resolved>
                                    <version>4.9</version>
                                    <fixVersion>5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="14069801" author="ramanaopensource" created="Tue, 22 Jul 2014 04:29:37 +0000"  >&lt;p&gt;Attached is the patch. Basically, &quot;numberToKeep&quot; is to indicate how many backups to retain (including this one). Reference &lt;a href=&quot;http://wiki.apache.org/solr/SolrReplication&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://wiki.apache.org/solr/SolrReplication&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Now, we are not considering the new snapshot directory while comparing &quot;numberToKeep&quot; parameter with existing directories size.&lt;/p&gt;

&lt;p&gt;if(numberToKeep &amp;gt; dirs.size()-1) &lt;/p&gt;
{
      return;
    }

&lt;p&gt;with the changes in the patch, always &quot;numbertokeep&quot; parameter will be satisfied.&lt;/p&gt;

&lt;p&gt;Please verify.&lt;/p&gt;

</comment>
                            <comment id="14069867" author="shalinmangar" created="Tue, 22 Jul 2014 05:50:08 +0000"  >&lt;p&gt;Thanks Mathias and Ramana. We need a test as well before it can be committed.&lt;/p&gt;</comment>
                            <comment id="14084290" author="ramanaopensource" created="Mon, 4 Aug 2014 04:34:54 +0000"  >&lt;p&gt;Shalin, Updated the patch with test case. Please verify.&lt;/p&gt;</comment>
                            <comment id="14317837" author="varunthacker" created="Thu, 12 Feb 2015 08:58:21 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;File dir = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(snapDir);
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!dir.exists())  dir.mkdirs();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is not needed because we call &lt;tt&gt;SimpleFSDirectory(destDir.toPath(), NoLockFactory.INSTANCE)&lt;/tt&gt; which creates the snapDir if not present.&lt;/p&gt;

&lt;p&gt;Secondly I moved deleteOldBackups after the snapshot gets created. That makes sense right?&lt;/p&gt;

&lt;p&gt;Fixed the test to catch this regression. If you just run the test without making the fix to SnapShooter the test will fail.&lt;/p&gt;</comment>
                            <comment id="14317848" author="varunthacker" created="Thu, 12 Feb 2015 09:06:40 +0000"  >&lt;p&gt;Correct patch.&lt;/p&gt;</comment>
                            <comment id="14317894" author="shalinmangar" created="Thu, 12 Feb 2015 09:38:43 +0000"  >&lt;p&gt;Thanks Mathias, Ramana and Varun!&lt;/p&gt;</comment>
                            <comment id="14317896" author="jira-bot" created="Thu, 12 Feb 2015 09:39:46 +0000"  >&lt;p&gt;Commit 1659180 from shalin@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1659180&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1659180&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6214&quot; title=&quot;Snapshots numberToKeep param only keeps n-1 backups&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6214&quot;&gt;&lt;del&gt;SOLR-6214&lt;/del&gt;&lt;/a&gt;: Snapshots numberToKeep param only keeps n-1 backups&lt;/p&gt;</comment>
                            <comment id="14317900" author="jira-bot" created="Thu, 12 Feb 2015 09:42:18 +0000"  >&lt;p&gt;Commit 1659181 from shalin@apache.org in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1659181&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1659181&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6214&quot; title=&quot;Snapshots numberToKeep param only keeps n-1 backups&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6214&quot;&gt;&lt;del&gt;SOLR-6214&lt;/del&gt;&lt;/a&gt;: Snapshots numberToKeep param only keeps n-1 backups&lt;/p&gt;</comment>
                            <comment id="14317954" author="varunthacker" created="Thu, 12 Feb 2015 10:22:42 +0000"  >&lt;p&gt;Small typo in line 235 of TestReplicationHandlerBackup - &lt;/p&gt;

&lt;p&gt;&lt;tt&gt;fail(&quot;Backup should have been cleaned up because &quot; + backupKeepParamName + &quot; was set to 2.&quot;);&lt;/tt&gt; should be&lt;br/&gt;
&lt;tt&gt;fail(&quot;Backup should have been cleaned up because &quot; + backupKeepParamName + &quot; was set to 1.&quot;);&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="14317971" author="shalinmangar" created="Thu, 12 Feb 2015 10:32:36 +0000"  >&lt;p&gt;Fixed, thanks!&lt;/p&gt;</comment>
                            <comment id="14317973" author="jira-bot" created="Thu, 12 Feb 2015 10:33:29 +0000"  >&lt;p&gt;Commit 1659203 from shalin@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1659203&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1659203&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6214&quot; title=&quot;Snapshots numberToKeep param only keeps n-1 backups&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6214&quot;&gt;&lt;del&gt;SOLR-6214&lt;/del&gt;&lt;/a&gt;: Fix mistake in failure message&lt;/p&gt;</comment>
                            <comment id="14317975" author="jira-bot" created="Thu, 12 Feb 2015 10:36:01 +0000"  >&lt;p&gt;Commit 1659204 from shalin@apache.org in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1659204&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1659204&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6214&quot; title=&quot;Snapshots numberToKeep param only keeps n-1 backups&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6214&quot;&gt;&lt;del&gt;SOLR-6214&lt;/del&gt;&lt;/a&gt;: Fix mistake in failure message&lt;/p&gt;</comment>
                            <comment id="14495298" author="thelabdude" created="Wed, 15 Apr 2015 00:30:28 +0000"  >&lt;p&gt;Bulk close after 5.1 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12698373" name="SOLR-6214.patch" size="6456" author="varun" created="Thu, 12 Feb 2015 09:06:40 +0000"/>
                            <attachment id="12698370" name="SOLR-6214.patch" size="5951" author="varun" created="Thu, 12 Feb 2015 08:58:21 +0000"/>
                            <attachment id="12659610" name="SOLR-6214.patch" size="9553" author="RamanaOpenSource" created="Mon, 4 Aug 2014 04:32:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>402581</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 32 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1xakf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>402648</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>