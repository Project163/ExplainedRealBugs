<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:12:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-17805] Transaction log constructor can fail and leave a file that blocks the update log.</title>
                <link>https://issues.apache.org/jira/browse/SOLR-17805</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;TransactionLog constructor can either open an existing log, or create a new log. When it is required to create a new log, it first creates a new empty log file and then opens an output stream on it.&lt;/p&gt;

&lt;p&gt;After the new empty log file is created, if an exception occurs when creating the output stream (e.g. disk full, encryption key not available), the TransactionLog object is not created, but the empty file is left. The problem is that UpdateLog does not update its &quot;id&quot; field which should point to the next (non-existing) transaction log id, instead it continues to point to the empty log file. This completely blocks the logic in UpdateLog.ensureLog() and TransactionLog constructor will always refuse to create a new transaction log, throwing &quot;New transaction log already exists&quot; for each update, effectively blocking all subsequent updates, until the Solr server is restarted.&lt;/p&gt;

&lt;p&gt;The proposed fix is to&lt;/p&gt;

&lt;p&gt;1- Delete the created empty log file is an exception is thrown inside the TransactionLog constructor.&lt;br/&gt;
2- Fix the error code inconsistency between DirectUpdateHandler2.addDoc() (which currently sets a 4xx code) and RequestHandlerBase.normalizeReceivedException() (which currently asserts a 5xx code).&lt;/p&gt;</description>
                <environment></environment>
        <key id="13622161">SOLR-17805</key>
            <summary>Transaction log constructor can fail and leave a file that blocks the update log.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="broustant">Bruno Roustant</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 30 Jun 2025 15:31:05 +0000</created>
                <updated>Thu, 24 Jul 2025 22:50:53 +0000</updated>
                            <resolved>Tue, 8 Jul 2025 17:18:30 +0000</resolved>
                                    <version>9.8.1</version>
                                    <fixVersion>9.9</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="8400">2h 20m</timespent>
                                <comments>
                            <comment id="17987369" author="jira-bot" created="Wed, 2 Jul 2025 08:23:16 +0000"  >&lt;p&gt;Commit a931e8a356c2378e49386ac3993516b3637a3c75 in solr&apos;s branch refs/heads/main from Bruno Roustant&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=a931e8a356c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=a931e8a356c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17805&quot; title=&quot;Transaction log constructor can fail and leave a file that blocks the update log.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17805&quot;&gt;&lt;del&gt;SOLR-17805&lt;/del&gt;&lt;/a&gt;: Exception in TransactionLog constructor deletes the file and does not block subsequent updates. (#3412)&lt;/p&gt;
</comment>
                            <comment id="17987892" author="jira-bot" created="Wed, 2 Jul 2025 12:56:54 +0000"  >&lt;p&gt;Commit 0410368dd13ff32b28cd74231596a83733f23da2 in solr&apos;s branch refs/heads/branch_9x from Bruno Roustant&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=0410368dd13&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=0410368dd13&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17805&quot; title=&quot;Transaction log constructor can fail and leave a file that blocks the update log.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17805&quot;&gt;&lt;del&gt;SOLR-17805&lt;/del&gt;&lt;/a&gt;: Exception in TransactionLog constructor deletes the file and does not block subsequent updates. (#3412)&lt;/p&gt;</comment>
                            <comment id="17993158" author="dsmiley" created="Thu, 3 Jul 2025 21:23:50 +0000"  >&lt;p&gt;When backporting, always run &quot;precommit&quot;.  Your backport doesn&apos;t compile &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=broustant&quot; class=&quot;user-hover&quot; rel=&quot;broustant&quot;&gt;broustant&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="18001237" author="jira-bot" created="Sun, 6 Jul 2025 14:49:43 +0000"  >&lt;p&gt;Commit 1758ea350aa7f977d18686cc96b04af022758294 in solr&apos;s branch refs/heads/branch_9x from David Smiley&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=1758ea350aa&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=1758ea350aa&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17805&quot; title=&quot;Transaction log constructor can fail and leave a file that blocks the update log.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17805&quot;&gt;&lt;del&gt;SOLR-17805&lt;/del&gt;&lt;/a&gt;: Fix backport (Path-&amp;gt;File)&lt;/p&gt;</comment>
                            <comment id="18002687" author="broustant" created="Mon, 7 Jul 2025 09:48:09 +0000"  >&lt;p&gt;Thank you David. I thought I had checked.&lt;/p&gt;</comment>
                            <comment id="18003860" author="houston" created="Tue, 8 Jul 2025 17:09:39 +0000"  >&lt;p&gt;Should this be resolved?&lt;/p&gt;</comment>
                            <comment id="18009741" author="houston" created="Thu, 24 Jul 2025 22:50:53 +0000"  >&lt;p&gt;Closing after the 9.9.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1wjnc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>