<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:28:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-3652] Range Faceting will infinite loop if gap is too small relative to lower bounds of range (underflow occurs on add)</title>
                <link>https://issues.apache.org/jira/browse/SOLR-3652</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Executing the following query will lock up the java process running solr.&lt;/p&gt;

&lt;p&gt;facet=true&amp;amp;facet.range=item_search_&lt;em&gt;creation_event_facet_range_ftm&amp;amp;f.item_search&lt;/em&gt;&lt;em&gt;creation_event_facet_range_ftm.facet.range.start=100000000000.0&amp;amp;f.item_search&lt;/em&gt;&lt;em&gt;creation_event_facet_range_ftm.facet.range.end=100000086200.0&amp;amp;f.item_search&lt;/em&gt;_creation_event_facet_range_ftm.facet.range.gap=2160.0&amp;amp;q=%2A%3A%2A&lt;/p&gt;

&lt;p&gt;But decreasing the size of the min and max works fine&lt;/p&gt;

&lt;p&gt;facet=true&amp;amp;facet.range=item_search_&lt;em&gt;creation_event_facet_range_ftm&amp;amp;f.item_search&lt;/em&gt;&lt;em&gt;creation_event_facet_range_ftm.facet.range.start=10000000000.0&amp;amp;f.item_search&lt;/em&gt;&lt;em&gt;creation_event_facet_range_ftm.facet.range.end=10000086200.0&amp;amp;f.item_search&lt;/em&gt;_creation_event_facet_range_ftm.facet.range.gap=2160.0&amp;amp;q=%2A%3A%2A&lt;/p&gt;

&lt;p&gt;And so does increasing the range gap&lt;/p&gt;

&lt;p&gt;facet=true&amp;amp;facet.range=item_search_&lt;em&gt;creation_event_facet_range_ftm&amp;amp;f.item_search&lt;/em&gt;&lt;em&gt;creation_event_facet_range_ftm.facet.range.start=100000000000.0&amp;amp;f.item_search&lt;/em&gt;&lt;em&gt;creation_event_facet_range_ftm.facet.range.end=100000086200.0&amp;amp;f.item_search&lt;/em&gt;_creation_event_facet_range_ftm.facet.range.gap=21600.0&amp;amp;q=%2A%3A%2A&lt;/p&gt;</description>
                <environment>&lt;p&gt;OSX Lion, Macbook Pro, 8GB Ram&lt;/p&gt;</environment>
        <key id="12599559">SOLR-3652</key>
            <summary>Range Faceting will infinite loop if gap is too small relative to lower bounds of range (underflow occurs on add)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="njakobsen">Nicholas Jakobsen</reporter>
                        <labels>
                            <label>facet</label>
                            <label>range</label>
                    </labels>
                <created>Fri, 20 Jul 2012 00:46:14 +0000</created>
                <updated>Mon, 9 May 2016 18:44:52 +0000</updated>
                            <resolved>Wed, 25 Jul 2012 00:30:18 +0000</resolved>
                                    <version>3.6.1</version>
                    <version>4.0-ALPHA</version>
                                    <fixVersion>4.0-BETA</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13421710" author="hossman" created="Tue, 24 Jul 2012 19:51:42 +0000"  >&lt;p&gt;Trivial to reproduce in the example (even with an empty index)&lt;/p&gt;

&lt;p&gt;Works fine...&lt;/p&gt;

&lt;p&gt;These (small gap w/ long and double) work fine...&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;http://localhost:8983/solr/select?q=*:*&amp;amp;facet=true&amp;amp;facet.range=foo_l&amp;amp;facet.range.start=100000000000&amp;amp;facet.range.end=100000086200&amp;amp;facet.range.gap=2160&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8983/solr/select?q=*:*&amp;amp;facet=true&amp;amp;facet.range=foo_l&amp;amp;facet.range.start=100000000000&amp;amp;facet.range.end=100000086200&amp;amp;facet.range.gap=2160&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://localhost:8983/solr/select?q=*:*&amp;amp;facet=true&amp;amp;facet.range=foo_d&amp;amp;facet.range.start=100000000000&amp;amp;facet.range.end=100000086200&amp;amp;facet.range.gap=2160&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8983/solr/select?q=*:*&amp;amp;facet=true&amp;amp;facet.range=foo_d&amp;amp;facet.range.start=100000000000&amp;amp;facet.range.end=100000086200&amp;amp;facet.range.gap=2160&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This (small gap w/ int) fails fast as expected because the value is too big to parse...&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;http://localhost:8983/solr/select?q=*:*&amp;amp;facet=true&amp;amp;facet.range=foo_i&amp;amp;facet.range.start=100000000000&amp;amp;facet.range.end=100000086200&amp;amp;facet.range.gap=21600&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8983/solr/select?q=*:*&amp;amp;facet=true&amp;amp;facet.range=foo_i&amp;amp;facet.range.start=100000000000&amp;amp;facet.range.end=100000086200&amp;amp;facet.range.gap=21600&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;this (small gap w/ float) seems to go into an infinite loop...&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;a href=&quot;http://localhost:8983/solr/select?q=*:*&amp;amp;facet=true&amp;amp;facet.range=foo_f&amp;amp;facet.range.start=100000000000&amp;amp;facet.range.end=100000086200&amp;amp;facet.range.gap=2160&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8983/solr/select?q=*:*&amp;amp;facet=true&amp;amp;facet.range=foo_f&amp;amp;facet.range.start=100000000000&amp;amp;facet.range.end=100000086200&amp;amp;facet.range.gap=2160&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;...i&apos;m pretty sure the problem is that we aren&apos;t checking for float/double underflow and adding the small gap to the large start value is equivilent to adding a gap of &quot;0&quot;  (Which is evidently also a problem ... facet.range.gap=0 isn&apos;t throwing an exception either)&lt;/p&gt;</comment>
                            <comment id="13421855" author="hossman" created="Tue, 24 Jul 2012 23:05:27 +0000"  >&lt;p&gt;patch that fixes both facet.date and facet.range to check that the computed &quot;high&quot; value of each range is not equal to the computed &quot;low&quot; value to ensure there is no underflow when adding the gap (there was already a check that &quot;high&quot; was not less then &quot;low&quot; in case of overflow adding the gap)&lt;/p&gt;

&lt;p&gt;patch includes test case - but all it realy does is ensure that if we return, we return an error (no special trickery in the test about interrupt the thread if it takes too long)&lt;/p&gt;</comment>
                            <comment id="13421858" author="njakobsen" created="Tue, 24 Jul 2012 23:11:55 +0000"  >&lt;p&gt;Looking at the patch, this seems to just raise an exception with large numbers, not actually support them. Would it be possible to support large ranges? If not, could you suggest a workaround? If I divided all the numbers by a known factor, and then multiplied them in my app, could that tie me over until the behaviour is actually fixed? Or is it a limitation with sig figs, and not the absolute value?&lt;/p&gt;</comment>
                            <comment id="13421882" author="hossman" created="Tue, 24 Jul 2012 23:58:04 +0000"  >&lt;blockquote&gt;&lt;p&gt;Looking at the patch, this seems to just raise an exception with large numbers, not actually support them. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;There isn&apos;t actually a problem with &quot;large&quot; numbers &amp;#8211; the real problem is actually with &quot;small&quot; numbers &amp;#8211; specifically the root cause of the infinite looping was when the &quot;gap&quot; was too small, &lt;em&gt;relative to the the start/end&lt;/em&gt;, for the field type in use (float), and became effectively the same as &quot;zero&quot;.  &lt;/p&gt;

&lt;p&gt;That&apos;s what this patch fixes.  If adding the gap to the lower bound of a range produces a value that is still equal to the lower bound, it fails rather the going into an infinite loop.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Would it be possible to support large ranges? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;large ranges can work fine &amp;#8211; use a &quot;big&quot; gap and you will never see this problem.  what doesn&apos;t work is having a range so small that for the field type being used, the lower and upper bounds are equivalent for some values.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;...could that tie me over until the behaviour is actually fixed? Or is it a limitation with sig figs, and not the absolute value?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is really a fundamental limitation based on the underlying data types being used.  If you use a &quot;float&quot; field type in Solr, the underlying representation is constrained by the valid values that can be represented by a java Float.  likewise for &quot;double&quot; ...&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://docs.oracle.com/javase/6/docs/api/java/lang/Float.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://docs.oracle.com/javase/6/docs/api/java/lang/Float.html&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://docs.oracle.com/javase/6/docs/api/java/lang/Double.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://docs.oracle.com/javase/6/docs/api/java/lang/Double.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;...if your field type is &quot;float&quot; and you ask for something like &lt;tt&gt;facet.range.start=100000000000&amp;amp;facet.range.end=100000086200&amp;amp;facet.range.gap=2160&lt;/tt&gt;} then eventually, as FacetComponent computes the individual ranges, it&apos;s going to try and compute a range where the lower bound is &quot;9.9999998E10&quot; &amp;#8211; but for float values, &quot;9.9999998E10 + 2160 = 9.9999998E10&quot; and that&apos;s where the infinite loop underflow error check will abort the request.  There&apos;s really nothing else it can do.&lt;/p&gt;

&lt;p&gt;If you try the same request with a &quot;double&quot; field or a &quot;long&quot; field and everything will work fine for this particular example, but a java &quot;float&quot; can&apos;t express a difference between &quot;9.9999998E10&quot; and &quot;9.9999998E10 + 2160&quot;&lt;/p&gt;</comment>
                            <comment id="13421894" author="hossman" created="Wed, 25 Jul 2012 00:30:18 +0000"  >&lt;p&gt;Committed revision 1365363. - trunk&lt;br/&gt;
Committed revision 1365365. - 4x&lt;/p&gt;
</comment>
                            <comment id="13421985" author="njakobsen" created="Wed, 25 Jul 2012 03:59:52 +0000"  >&lt;p&gt;Ah, I see, it&apos;s a problem of scale between the range and the gap. I&apos;ll try a double instead. The reason for the large numbers is I&apos;m storing UTC times for dates far in the past, e.g. 5000 BCE.&lt;/p&gt;

&lt;p&gt;Thanks for the quick response!&lt;/p&gt;</comment>
                            <comment id="13422005" author="hossman" created="Wed, 25 Jul 2012 05:04:19 +0000"  >&lt;p&gt;Nicholas: If you are working with ancient dates, double doesn&apos;t really make sense &amp;#8211; i would suggest using a &quot;long&quot; representing whatever precision you care about (year, day, minute, millisecond ... even at millisecond granularity you can go as far back as Dec 02, 292269055 BC)&lt;/p&gt;

&lt;p&gt;FWIW: not many people i&apos;ve talked to in the past have ever really cared about indexing years prior to 1AD and doing anything meaningful with them, but if you are interested in faceting dates going back that far, and being able to use DateField and DateMath, contributions to &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2773&quot; title=&quot;DateField parsing/formatting issues of years prior to 0001&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2773&quot;&gt;&lt;del&gt;SOLR-2773&lt;/del&gt;&lt;/a&gt; would certainly be appreciated.  (There&apos;s already a test demonstrating the problems, we just need someone to help write the code)&lt;/p&gt;</comment>
                            <comment id="13422051" author="njakobsen" created="Wed, 25 Jul 2012 07:13:26 +0000"  >&lt;p&gt;I have a more generic DSL that I use to specify fields for faceting. For simplicity, all the values from range facets (including dates, datetimes, integers, floats, doubles, etc...) are converted to a float for indexing. This is why I haven&apos;t explored other data types.&lt;/p&gt;

&lt;p&gt;As for &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2773&quot; title=&quot;DateField parsing/formatting issues of years prior to 0001&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2773&quot;&gt;&lt;del&gt;SOLR-2773&lt;/del&gt;&lt;/a&gt;, Ha! The amount of time I&apos;ve spent dealing with BCE to signed-year conversions, gregorian calendars, and far past dates. Jumping into the conversation in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1899&quot; title=&quot;dates prior to 1000AD are not formatted properly in responses&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1899&quot;&gt;&lt;del&gt;SOLR-1899&lt;/del&gt;&lt;/a&gt; is a little confusing. Why don&apos;t you email me and explain the issue, and I&apos;ll see if I can help.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12537764" name="SOLR-3652.patch" size="3958" author="hossman" created="Tue, 24 Jul 2012 23:05:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>243331</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 17 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03dfb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>17608</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>