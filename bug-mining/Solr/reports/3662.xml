<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:28:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-11426] TestLazyCores fails too often</title>
                <link>https://issues.apache.org/jira/browse/SOLR-11426</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Rather then re-opening &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10101&quot; title=&quot;TestLazyCores hangs.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10101&quot;&gt;&lt;del&gt;SOLR-10101&lt;/del&gt;&lt;/a&gt; I thought I&apos;d start a new issue. I may have to put some code up on Jenkins to test, last time I tried to get this to fail locally I couldn&apos;t&lt;/p&gt;</description>
                <environment></environment>
        <key id="13106451">SOLR-11426</key>
            <summary>TestLazyCores fails too often</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="erickerickson">Erick Erickson</assignee>
                                    <reporter username="erickerickson">Erick Erickson</reporter>
                        <labels>
                    </labels>
                <created>Mon, 2 Oct 2017 15:26:28 +0000</created>
                <updated>Wed, 2 Oct 2019 17:30:23 +0000</updated>
                            <resolved>Sun, 7 Jan 2018 04:28:48 +0000</resolved>
                                                    <fixVersion>7.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16189759" author="erickerickson" created="Tue, 3 Oct 2017 14:23:08 +0000"  >&lt;p&gt;Well, beasting 1,000 times on my mac pro and another 1,000 times on the server and zero failures. I may have to put some debugging code in master to make progress.&lt;/p&gt;</comment>
                            <comment id="16194851" author="jira-bot" created="Fri, 6 Oct 2017 16:59:43 +0000"  >&lt;p&gt;Commit 37fb60d0f1188c3399232fe0240f53d2f4743bb0 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=37fb60d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=37fb60d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11426&quot; title=&quot;TestLazyCores fails too often&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11426&quot;&gt;&lt;del&gt;SOLR-11426&lt;/del&gt;&lt;/a&gt;: TestLazyCores fails too often. Adding debugging code MASTER ONLY since I can&apos;t get it to fail locally&lt;/p&gt;</comment>
                            <comment id="16195466" author="erickerickson" created="Sat, 7 Oct 2017 00:21:21 +0000"  >&lt;p&gt;Well, rats. I was thinking that the issue might be related to &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11035&quot; title=&quot;(at least) 2 distinct failures possible when clients attempt searches during SolrCore reload&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11035&quot;&gt;&lt;del&gt;SOLR-11035&lt;/del&gt;&lt;/a&gt;, but apparently not so. The code I put in the method that&apos;s failing (check10) tries to add another document to the core if it doesn&apos;t find the 10 it should the first time. If it had come back with finding 11 documents I could (possibly) point to &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11035&quot; title=&quot;(at least) 2 distinct failures possible when clients attempt searches during SolrCore reload&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11035&quot;&gt;&lt;del&gt;SOLR-11035&lt;/del&gt;&lt;/a&gt; and the like.&lt;/p&gt;

&lt;p&gt;But the single doc that I added is the only one found, proving that the core is OK. That is I&apos;m able to see the new doc added to the core, but the 10 added before closing the core aren&apos;t there. Have to try something else...&lt;/p&gt;</comment>
                            <comment id="16195472" author="jira-bot" created="Sat, 7 Oct 2017 00:24:49 +0000"  >&lt;p&gt;Commit f0a4b2dafe13e2b372e33ce13d552f169187a44e in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f0a4b2d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f0a4b2d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Revert &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11426&quot; title=&quot;TestLazyCores fails too often&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11426&quot;&gt;&lt;del&gt;SOLR-11426&lt;/del&gt;&lt;/a&gt;: TestLazyCores fails too often. Adding debugging code MASTER ONLY since I can&apos;t get it to fail locally&quot;&lt;/p&gt;

&lt;p&gt;This reverts commit 37fb60d&lt;/p&gt;</comment>
                            <comment id="16198871" author="erickerickson" created="Tue, 10 Oct 2017 15:50:56 +0000"  >&lt;p&gt;OK, no failures on master since this latest info-gathering code was committed to master, which is kind of scary as this isn&apos;t a proper fix at all.&lt;/p&gt;

&lt;p&gt;All the latest test does is fire a commit whenever a transient core is aged out. I expected that just the normal core closing would issue a commit, and it seems to, just not all the time apparently Which means there&apos;s some circumstance where a core could lose documents that haven&apos;t been committed when it is closed.&lt;/p&gt;

&lt;p&gt;So the underlying issue is (apparently) there is some condition where uncommitted changes are not committed on a core close. I&apos;ll be looking some more, but would certainly welcome any ideas/help.&lt;/p&gt;

&lt;p&gt;Meanwhile I&apos;ll leave the code in for a bit just to see if I&apos;m getting (un)lucky with this test and happening to succeed for a few days. If it continues to succeed through tonight I&apos;ll revert tomorrow and insure it comes back.&lt;/p&gt;</comment>
                            <comment id="16206832" author="erickerickson" created="Tue, 17 Oct 2017 00:32:34 +0000"  >&lt;p&gt;Since changing this there haven&apos;t been any failures on master, and only two on 7x. My guess is that &quot;something changed&quot; in master to make this more frequent, but so far this seems to be on the right track.&lt;/p&gt;

&lt;p&gt;This isn&apos;t the proper fix, but I want to let it bake a bit more to be certain we&apos;re not just getting lucky with not having failures on master.&lt;/p&gt;</comment>
                            <comment id="16258334" author="erickerickson" created="Sun, 19 Nov 2017 05:10:59 +0000"  >&lt;p&gt;Now I&apos;m even more baffled. The current code running on Master and 7x is identical. Both have the @BadApple annotation removed for testNoCommit. 7x fails fairly regularly, master hasn&apos;t failed in a couple of months.&lt;/p&gt;

&lt;p&gt;Not quite sure what to try next.&lt;/p&gt;</comment>
                            <comment id="16261157" author="erickerickson" created="Tue, 21 Nov 2017 17:53:50 +0000"  >&lt;p&gt;Gathering more information, trunk only&lt;/p&gt;</comment>
                            <comment id="16261171" author="jira-bot" created="Tue, 21 Nov 2017 17:58:02 +0000"  >&lt;p&gt;Commit ab5fbad3d70f19e47ff71e0680dd7f6d6bc4f654 in lucene-solr&apos;s branch refs/heads/master from Erick&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ab5fbad&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ab5fbad&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11426&quot; title=&quot;TestLazyCores fails too often&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11426&quot;&gt;&lt;del&gt;SOLR-11426&lt;/del&gt;&lt;/a&gt;: TestLazyCores fails too often, debugging&lt;/p&gt;</comment>
                            <comment id="16299281" author="tomasflobbe" created="Wed, 20 Dec 2017 23:56:51 +0000"  >&lt;p&gt;I believe the problem here is that &lt;tt&gt;testNoCommit()&lt;/tt&gt; expects &lt;tt&gt;DirectUpdateHandler2.commitOnClose&lt;/tt&gt; to be &lt;tt&gt;true&lt;/tt&gt; (which it is by default), but some other test may be changing this property and not setting it back, and since it&apos;s static. That would explain why you can&apos;t reproduce the failure by beasting (just) it.&lt;br/&gt;
The test fails 100% of the times if you add &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
DirectUpdateHandler2.commitOnClose = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;at the beginning. I&apos;ll add&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
DirectUpdateHandler2.commitOnClose = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;at the beginning of the test and see if it fixes it.&lt;/p&gt;</comment>
                            <comment id="16299289" author="jira-bot" created="Thu, 21 Dec 2017 00:00:41 +0000"  >&lt;p&gt;Commit ba2ef4a894ca857ffe4a5ecb310363d315eef05f in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tflobbe&quot; class=&quot;user-hover&quot; rel=&quot;tflobbe&quot;&gt;tflobbe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ba2ef4a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ba2ef4a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11426&quot; title=&quot;TestLazyCores fails too often&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11426&quot;&gt;&lt;del&gt;SOLR-11426&lt;/del&gt;&lt;/a&gt;: Make sure commitOnClose is enabled before running testNoCommit&lt;/p&gt;</comment>
                            <comment id="16299297" author="jira-bot" created="Thu, 21 Dec 2017 00:10:22 +0000"  >&lt;p&gt;Commit 994f3295ec0be144d3e7fff7a651e818614c1cd0 in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tflobbe&quot; class=&quot;user-hover&quot; rel=&quot;tflobbe&quot;&gt;tflobbe&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=994f329&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=994f329&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11426&quot; title=&quot;TestLazyCores fails too often&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11426&quot;&gt;&lt;del&gt;SOLR-11426&lt;/del&gt;&lt;/a&gt;: Make sure commitOnClose is enabled before running testNoCommit&lt;/p&gt;</comment>
                            <comment id="16299309" author="erickerickson" created="Thu, 21 Dec 2017 00:24:51 +0000"  >&lt;p&gt;And here I&apos;ve been thinking I could &lt;em&gt;finally&lt;/em&gt; get to this after this week, thanks!&lt;/p&gt;

&lt;p&gt;Two things:&lt;br/&gt;
1&amp;gt; please don&apos;t close this ticket. We have to keep it open for a while anyway &apos;cause this doesn&apos;t happen all that frequently. But second, I still have infostream in master that I need to clean up before closing, I&apos;ll handle that.&lt;/p&gt;

&lt;p&gt;2&amp;gt; I do wonder if this is responsible for other test failures. I&apos;ll have something to check for some of these flaky tests. If this is some sort of test interaction I wonder if we could find a way to insure it&apos;s in know state.&lt;/p&gt;

&lt;p&gt;Thanks again!&lt;/p&gt;</comment>
                            <comment id="16299314" author="tomasflobbe" created="Thu, 21 Dec 2017 00:29:27 +0000"  >&lt;blockquote&gt;&lt;p&gt;1&amp;gt; please don&apos;t close this ticket. &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Sure, lets also wait to make sure there are no more failures&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;2&amp;gt; I do wonder if this is responsible for other test failures. I&apos;ll have something to check for some of these flaky tests. If this is some sort of test interaction I wonder if we could find a way to insure it&apos;s in know state.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It could certainly be the case. There is a TODO in DirectUpdateHandler2.commitOnClose:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// TODO: make &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; a real config option or move it to TestInjection&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We probably want to do that (TestInjection I mean, it sounds too low level for a config option, and nobody has asked for this, so...)&lt;/p&gt;</comment>
                            <comment id="16304675" author="jira-bot" created="Wed, 27 Dec 2017 17:08:00 +0000"  >&lt;p&gt;Commit 6b368c04846fbb7ae769da6bee4506dcbf26c278 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6b368c0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6b368c0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11426&quot; title=&quot;TestLazyCores fails too often&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11426&quot;&gt;&lt;del&gt;SOLR-11426&lt;/del&gt;&lt;/a&gt;: removed infostream debug logging from master&lt;/p&gt;</comment>
                            <comment id="16304676" author="erickerickson" created="Wed, 27 Dec 2017 17:09:23 +0000"  >&lt;p&gt;Since Tom&#225;s&apos; change we haven&apos;t seen any failures, so I took out the infostream logging (was there on master only). So we can close this whenever we want to, maybe sometime in early January?&lt;/p&gt;</comment>
                            <comment id="16315058" author="erickerickson" created="Sun, 7 Jan 2018 04:28:48 +0000"  >&lt;p&gt;No failures since Tom&#225;s&apos; fix, we can open a new ticket if it comes back.&lt;/p&gt;

&lt;p&gt;Thanks Tom&#225;s! I&apos;ll check some of the other tests I see failing due to what may be similar issues.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13040776">SOLR-10101</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12898696" name="SOLR-11426-take-2-debug.patch" size="5035" author="erickerickson" created="Tue, 21 Nov 2017 17:53:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 45 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ks87:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>