<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:17:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-4164] Result Grouping fails if no hits</title>
                <link>https://issues.apache.org/jira/browse/SOLR-4164</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;In SolrCloud, found a result grouping bug in the 4.0 release.&lt;br/&gt;
A distributed result grouping request under SolrCloud got this result:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Dec 10, 2012 10:32:07 PM org.apache.solr.common.SolrException log
SEVERE: null:java.lang.IllegalArgumentException: numHits must be &amp;gt; 0; please use TotalHitCountCollector if you just need the total hit count
        at org.apache.lucene.search.TopFieldCollector.create(TopFieldCollector.java:1120)
        at org.apache.lucene.search.TopFieldCollector.create(TopFieldCollector.java:1069)
        at org.apache.lucene.search.grouping.AbstractSecondPassGroupingCollector.&amp;lt;init&amp;gt;(AbstractSecondPassGroupingCollector.java:75)
        at org.apache.lucene.search.grouping.term.TermSecondPassGroupingCollector.&amp;lt;init&amp;gt;(TermSecondPassGroupingCollector.java:49)
        at org.apache.solr.search.grouping.distributed.command.TopGroupsFieldCommand.create(TopGroupsFieldCommand.java:128)
        at org.apache.solr.search.grouping.CommandHandler.execute(CommandHandler.java:132)
        at org.apache.solr.handler.component.QueryComponent.process(QueryComponent.java:339)
        at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:206)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12623325">SOLR-4164</key>
            <summary>Result Grouping fails if no hits</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                    <reporter username="lancenorskog">Lance Norskog</reporter>
                        <labels>
                    </labels>
                <created>Tue, 11 Dec 2012 03:55:38 +0000</created>
                <updated>Wed, 9 Nov 2016 08:38:51 +0000</updated>
                            <resolved>Wed, 26 Oct 2016 16:59:02 +0000</resolved>
                                    <version>4.0</version>
                                    <fixVersion>6.3</fixVersion>
                    <fixVersion>7.0</fixVersion>
                                    <component>SearchComponents - other</component>
                    <component>SolrCloud</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="13531454" author="hossman" created="Thu, 13 Dec 2012 20:42:12 +0000"  >&lt;p&gt;Lance: can you give us any more context into how you got this error? what did the request look like? what did the data look like?&lt;/p&gt;

&lt;p&gt;I tried writing a test to demonstrating the problem and failed to fail...&lt;/p&gt;

&lt;p&gt;Committed revision 1421505.&lt;br/&gt;
Committed revision 1421510.&lt;/p&gt;</comment>
                            <comment id="13531456" author="commit-tag-bot" created="Thu, 13 Dec 2012 20:44:17 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;trunk commit&amp;#93;&lt;/span&gt; Chris M. Hostetter&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1421505&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1421505&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;grouping tests of case where no docs match main query.  written while trying to repro &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4164&quot; title=&quot;Result Grouping fails if no hits&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4164&quot;&gt;&lt;del&gt;SOLR-4164&lt;/del&gt;&lt;/a&gt;, but something is still missing&lt;/p&gt;</comment>
                            <comment id="13531505" author="commit-tag-bot" created="Thu, 13 Dec 2012 21:10:09 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; Chris M. Hostetter&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1421510&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1421510&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;grouping tests of case where no docs match main query.  written while trying to repro &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4164&quot; title=&quot;Result Grouping fails if no hits&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4164&quot;&gt;&lt;del&gt;SOLR-4164&lt;/del&gt;&lt;/a&gt;, but something is still missing (merge r1421505)&lt;/p&gt;</comment>
                            <comment id="13533675" author="lancenorskog" created="Mon, 17 Dec 2012 06:30:53 +0000"  >&lt;p&gt;I can&apos;t recreate it. It may have been another problem I was having: a shard server ran out of memory during the query and threw an exception to the distributor. Maybe the group query collection code ignores these remote exceptions?&lt;/p&gt;</comment>
                            <comment id="13638724" author="estahn" created="Tue, 23 Apr 2013 02:27:18 +0000"  >&lt;p&gt;This issue is still not solved with 4.2.1.&lt;/p&gt;

&lt;p&gt;Add:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Known Limitations: The Grouping feature only works if groups are in the same shard.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We changed &lt;tt&gt;-DnumShards=2&lt;/tt&gt; to &lt;tt&gt;-DnumShards=1&lt;/tt&gt; and it&apos;s working since.&lt;/p&gt;</comment>
                            <comment id="15178532" author="webhomer" created="Thu, 3 Mar 2016 20:09:42 +0000"  >&lt;p&gt;Found that if you set group.limit to -1 it will give the same failure. We had code that did this with the intent of getting all the documents in the roll up. We limit it to 500 so setting group.limit=500 was a decent work around. Still this worked fine with normal solr, only solrcloud had a problem&lt;/p&gt;</comment>
                            <comment id="15541879" author="caomanhdat" created="Mon, 3 Oct 2016 08:35:38 +0000"  >&lt;p&gt;This problem can happen when we set group.limit = -1 in distributed case. This bug doesn&apos;t happen in non distributed mode because inside Grouping we have this check&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; groupedDocsToCollect = getMax(groupOffset, docsPerGroup, maxDoc);
groupedDocsToCollect = &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.max(groupedDocsToCollect, 1);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;But things will be much different in distributed case, so we should ask ourselves is group.limit = -1 is a valid value of group.limit in distributed mode?&lt;/p&gt;</comment>
                            <comment id="15542879" author="hossman" created="Mon, 3 Oct 2016 17:06:26 +0000"  >&lt;p&gt;At a minimum, if distributed grouping doesn&apos;t work with &lt;tt&gt;group.limit=-1&lt;/tt&gt; then we should give a clean error saying so rather than an obtuse error.&lt;/p&gt;

&lt;p&gt;IIUC though, what Dat has found is that even in single node solr, &lt;tt&gt;group.limit=-1&lt;/tt&gt; doesn&apos;t give you &quot;unlimited&quot; groupping results &amp;#8211; it silently re-writes the effective groupedDocsToCollect value to &apos;1&apos; ... I&apos;m not sure why it does that instead of just giving an error, but if we can make distributed grouping behave the exact same way (and i&apos;m not sure why we couldn&apos;t have the same &lt;tt&gt;Math.max(groupedDocsToCollect, 1);&lt;/tt&gt; in the distributed code path) then we should.&lt;/p&gt;</comment>
                            <comment id="15542906" author="webhomer" created="Mon, 3 Oct 2016 17:20:59 +0000"  >&lt;p&gt;I am certain that in Solr 4.10 non-cloud specifying -1 did roll up all matching documents. We certainly had more than 1 in the group.&lt;br/&gt;
I agree that at a minimum that solr should be consistent and either throw an error or do something reasonable.&lt;/p&gt;

&lt;p&gt;It would be nice to have a way to specify an unlimited roll up&lt;/p&gt;</comment>
                            <comment id="15543822" author="hossman" created="Tue, 4 Oct 2016 00:03:18 +0000"  >&lt;blockquote&gt;&lt;p&gt;I am certain that in Solr 4.10 non-cloud specifying -1 did roll up all matching documents. We certainly had more than 1 in the group.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ok .. weird.  &lt;/p&gt;

&lt;p&gt;I see now I missread what Dat was saying ... in single node more &lt;tt&gt;getMax&lt;/tt&gt; is returning maxDoc if docsPerGroup &amp;lt; 0 ... so that&apos;s where that unlimited behavior was coming from.&lt;/p&gt;

&lt;p&gt;In general this smells like a very bad idea to me ... i&apos;m really suprised/scared  &lt;tt&gt;group.limit=-1&lt;/tt&gt; has ever worked this way, because it would make it very easy to crash solr/clients depending on what how many docs are in each group being returned &amp;#8211; this is the precise reason &lt;tt&gt;rows=-1&lt;/tt&gt; has never been supported for non-grouping searches.&lt;/p&gt;

&lt;p&gt;In any case, since we can&apos;t support the same &quot;unlimited&quot; behavior in cloud mode, let&apos;s absolutely add a clear error message indicating that &lt;tt&gt;group.limit &amp;lt; 1&lt;/tt&gt; is the problem.&lt;/p&gt;</comment>
                            <comment id="15543928" author="yseeley@gmail.com" created="Tue, 4 Oct 2016 00:47:58 +0000"  >&lt;blockquote&gt;&lt;p&gt;I am certain that in Solr 4.10 non-cloud specifying -1 did roll up all matching documents.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yep, I remember group.limit=-1 being explicitly supported when the feature was implemented.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;IIUC though, what Dat has found is that even in single node solr, group.limit=-1 doesn&apos;t give you &quot;unlimited&quot; groupping results &#8211; it silently re-writes the effective groupedDocsToCollect value to &apos;1&apos; &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Look at the code for getMax()... it does map -1 to the max possible.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;i&apos;m really suprised/scared group.limit=-1 has ever worked this way, because it would make it very easy to crash solr/clients depending on what how many docs are in each group being returned&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;There&apos;s an argument against unlimited behavior &lt;b&gt;by default&lt;/b&gt;.  But if one asks for everything back, one should get it.  &quot;-1&quot; is a common way to ask for this... facets, the term component, and graph expressions all use &quot;-1&quot; as unlimited.&lt;/p&gt;

&lt;p&gt;The alternative is to pick a really high number out of a hat... which is more fragile since it may silently break applications in the future when they grow beyond that arbitrary number if it&apos;s not large enough (they will stop getting all the data, and that may not be an obvious error).&lt;/p&gt;



</comment>
                            <comment id="15544083" author="caomanhdat" created="Tue, 4 Oct 2016 02:10:59 +0000"  >&lt;p&gt;Hi Yonik,&lt;/p&gt;

&lt;p&gt;In this case group.limit kinda more like rows parameter in /select and we don&apos;t support for negative rows param now. Users should aware that get all documents from each group will be a problem ( especially when we have very few groups ). In opposite case when we have many groups so upper bound for group.limit to retrieve all the docs will be good enough?&lt;/p&gt;</comment>
                            <comment id="15544135" author="yseeley@gmail.com" created="Tue, 4 Oct 2016 02:40:11 +0000"  >&lt;blockquote&gt;&lt;p&gt;In this case group.limit kinda more like rows parameter in /select and we don&apos;t support for negative rows param now.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;group.limit=-1 does work (and has always worked) in non-distrib mode though (by design).  IIRC &quot;rows&quot; not supporting -1 was an oversight that I never got around to fixing.  A number of people have been surprised that this doesn&apos;t just work.&lt;/p&gt;

&lt;p&gt;If group.limit=-1 is difficult to support in distributed mode for some reason (I don&apos;t know that part of the code), then I guess we&apos;ll have to live with different behavior in non-distrib vs distrib for now.&lt;/p&gt;</comment>
                            <comment id="15605487" author="caomanhdat" created="Tue, 25 Oct 2016 14:38:10 +0000"  >&lt;p&gt;Initial patch for this issue.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt; Please kindly review this patch.&lt;/p&gt;</comment>
                            <comment id="15608571" author="yseeley@gmail.com" created="Wed, 26 Oct 2016 14:15:54 +0000"  >&lt;p&gt;+1, looks good to me!&lt;/p&gt;</comment>
                            <comment id="15609002" author="jira-bot" created="Wed, 26 Oct 2016 16:57:07 +0000"  >&lt;p&gt;Commit 7794fbd13f1a0edfff8f121fb1c6a01075eeef6a in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7794fbd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=7794fbd&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4164&quot; title=&quot;Result Grouping fails if no hits&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4164&quot;&gt;&lt;del&gt;SOLR-4164&lt;/del&gt;&lt;/a&gt;: fix group.limit=-1 in distributed mode&lt;/p&gt;</comment>
                            <comment id="15609003" author="jira-bot" created="Wed, 26 Oct 2016 16:57:17 +0000"  >&lt;p&gt;Commit 65f9b4dc4c209dfa06aa72386f6a9bbb67a5a667 in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=65f9b4d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=65f9b4d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4164&quot; title=&quot;Result Grouping fails if no hits&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4164&quot;&gt;&lt;del&gt;SOLR-4164&lt;/del&gt;&lt;/a&gt;: fix group.limit=-1 in distributed mode&lt;/p&gt;</comment>
                            <comment id="15609013" author="yseeley@gmail.com" created="Wed, 26 Oct 2016 16:59:02 +0000"  >&lt;p&gt;Committed.  Thanks Dat!&lt;/p&gt;</comment>
                            <comment id="15650296" author="shalinmangar" created="Wed, 9 Nov 2016 08:38:51 +0000"  >&lt;p&gt;Closing after 6.3.0 release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12835131" name="SOLR-4164.patch" size="17327" author="caomanhdat" created="Tue, 25 Oct 2016 14:38:10 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>297021</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 1 week, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i14kv3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>234843</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>