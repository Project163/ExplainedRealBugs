<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:44:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-5618] false query result cache hits possible when duplicate filter queries exist in one query -- discovered via: Reproducible failure from TestFiltering.testRandomFiltering</title>
                <link>https://issues.apache.org/jira/browse/SOLR-5618</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5057&quot; title=&quot;queryResultCache should not related with the order of fq&amp;#39;s list&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5057&quot;&gt;&lt;del&gt;SOLR-5057&lt;/del&gt;&lt;/a&gt; introduced a bug in queryResultCaching such that the following circumstances can result in a false cache hit...&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;identical main query in both requests&lt;/li&gt;
	&lt;li&gt;identical number of filter queries in both requests&lt;/li&gt;
	&lt;li&gt;filter query from one request exists multiple times in other request&lt;/li&gt;
	&lt;li&gt;sum of hashCodes for all filter queries is equal in both request&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Details of how this problem was initially uncovered listed below...&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;uwe&apos;s jenkins found this in java8...&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://jenkins.thetaphi.de/job/Lucene-Solr-trunk-Linux/9004/consoleText&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jenkins.thetaphi.de/job/Lucene-Solr-trunk-Linux/9004/consoleText&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestFiltering -Dtests.method=testRandomFiltering -Dtests.seed=C22042E80957AE3E -Dtests.multiplier=3 -Dtests.slow=true -Dtests.locale=ar_LY -Dtests.timezone=Asia/Katmandu -Dtests.file.encoding=UTF-8
   [junit4] FAILURE 16.9s J1 | TestFiltering.testRandomFiltering &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: FAILURE: iiter=11 qiter=336 request=[q, {!frange v=val_i l=0 u=1 cost=139 tag=t}, fq, {!frange v=val_i l=0 u=1}, fq, {! cost=92}-_query_:&quot;{!frange v=val_i l=1 u=1}&quot;, fq, {!frange v=val_i l=0 u=1 cache=true tag=t}, fq, {! cache=true tag=t}-_query_:&quot;{!frange v=val_i l=1 u=1}&quot;]
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([C22042E80957AE3E:DD43E12DEC70EE37]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.search.TestFiltering.testRandomFiltering(TestFiltering.java:327)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The seed fails consistently for me on trunk using java7, and on 4x using both java7 and java6 - details to follow in comment.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12687774">SOLR-5618</key>
            <summary>false query result cache hits possible when duplicate filter queries exist in one query -- discovered via: Reproducible failure from TestFiltering.testRandomFiltering</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Jan 2014 00:25:34 +0000</created>
                <updated>Mon, 9 May 2016 18:52:57 +0000</updated>
                            <resolved>Fri, 10 Jan 2014 01:36:06 +0000</resolved>
                                    <version>4.5</version>
                    <version>4.5.1</version>
                    <version>4.6</version>
                                    <fixVersion>4.6.1</fixVersion>
                    <fixVersion>4.7</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13864911" author="hossman" created="Wed, 8 Jan 2014 00:28:34 +0000"  >&lt;p&gt;Relevant log snipper from jenkins...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; 558586 T3202 C2360 oasc.SolrCore.execute [collection1] webapp=null path=null params={q={!frange+v%3Dval_i+l%3D0+u%3D1+cost%3D139+tag%3Dt}&amp;amp;fq={!frange+v%3Dval_i+l%3D0+u%3D1}&amp;amp;fq={!+cost%3D92}-_query_:&quot;{!frange+v%3Dval_i+l%3D1+u%3D1}&quot;&amp;amp;fq={!frange+v%3Dval_i+l%3D0+u%3D1+cache%3Dtrue+tag%3Dt}&amp;amp;fq={!+cache%3Dtrue+tag%3Dt}-_query_:&quot;{!frange+v%3Dval_i+l%3D1+u%3D1}&quot;} hits=0 status=0 QTime=1 
   [junit4]   2&amp;gt; 558586 T3202 oas.SolrTestCaseJ4.assertJQ ERROR query failed JSON validation. error=mismatch: &apos;1&apos;!=&apos;0&apos; @ response/numFound
   [junit4]   2&amp;gt; 	 expected =/response/numFound==1
   [junit4]   2&amp;gt; 	 response = {
   [junit4]   2&amp;gt; 	  &quot;responseHeader&quot;:{
   [junit4]   2&amp;gt; 	    &quot;status&quot;:0,
   [junit4]   2&amp;gt; 	    &quot;QTime&quot;:1},
   [junit4]   2&amp;gt; 	  &quot;response&quot;:{&quot;numFound&quot;:0,&quot;start&quot;:0,&quot;docs&quot;:[]
   [junit4]   2&amp;gt; 	  }}
   [junit4]   2&amp;gt; 	
   [junit4]   2&amp;gt; 	 request = q={!frange+v%3Dval_i+l%3D0+u%3D1+cost%3D139+tag%3Dt}&amp;amp;fq={!frange+v%3Dval_i+l%3D0+u%3D1}&amp;amp;fq={!+cost%3D92}-_query_:&quot;{!frange+v%3Dval_i+l%3D1+u%3D1}&quot;&amp;amp;fq={!frange+v%3Dval_i+l%3D0+u%3D1+cache%3Dtrue+tag%3Dt}&amp;amp;fq={!+cache%3Dtrue+tag%3Dt}-_query_:&quot;{!frange+v%3Dval_i+l%3D1+u%3D1}&quot;
   [junit4]   2&amp;gt; 558587 T3202 oasc.SolrException.log ERROR java.lang.RuntimeException: mismatch: &apos;1&apos;!=&apos;0&apos; @ response/numFound
   [junit4]   2&amp;gt; 		at org.apache.solr.SolrTestCaseJ4.assertJQ(SolrTestCaseJ4.java:732)
   [junit4]   2&amp;gt; 		at org.apache.solr.SolrTestCaseJ4.assertJQ(SolrTestCaseJ4.java:679)
   [junit4]   2&amp;gt; 		at org.apache.solr.search.TestFiltering.testRandomFiltering(TestFiltering.java:316)
...
   [junit4]   2&amp;gt; 558588 T3202 oass.TestFiltering.testRandomFiltering ERROR FAILURE: iiter=11 qiter=336 request=[q, {!frange v=val_i l=0 u=1 cost=139 tag=t}, fq, {!frange v=val_i l=0 u=1}, fq, {! cost=92}-_query_:&quot;{!frange v=val_i l=1 u=1}&quot;, fq, {!frange v=val_i l=0 u=1 cache=true tag=t}, fq, {! cache=true tag=t}-_query_:&quot;{!frange v=val_i l=1 u=1}&quot;]
   [junit4]   2&amp;gt; 558588 T3202 oas.SolrTestCaseJ4.tearDown ###Ending testRandomFiltering
   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestFiltering -Dtests.method=testRandomFiltering -Dtests.seed=C22042E80957AE3E -Dtests.multiplier=3 -Dtests.slow=true -Dtests.locale=ar_LY -Dtests.timezone=Asia/Katmandu -Dtests.file.encoding=UTF-8
   [junit4] FAILURE 16.9s J1 | TestFiltering.testRandomFiltering &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: FAILURE: iiter=11 qiter=336 request=[q, {!frange v=val_i l=0 u=1 cost=139 tag=t}, fq, {!frange v=val_i l=0 u=1}, fq, {! cost=92}-_query_:&quot;{!frange v=val_i l=1 u=1}&quot;, fq, {!frange v=val_i l=0 u=1 cache=true tag=t}, fq, {! cache=true tag=t}-_query_:&quot;{!frange v=val_i l=1 u=1}&quot;]
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([C22042E80957AE3E:DD43E12DEC70EE37]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.search.TestFiltering.testRandomFiltering(TestFiltering.java:327)
   [junit4]    &amp;gt; 	at java.lang.Thread.run(Thread.java:744)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="13864983" author="hossman" created="Wed, 8 Jan 2014 02:06:48 +0000"  >&lt;p&gt;This smells like a caching related bug ... but i have no idea why/where.&lt;/p&gt;

&lt;p&gt;The test does multiple iterations where in each iteration it builds an index of a random number of documents, each containing an incremented value for &quot;id&quot; and &quot;val_i&quot; &amp;#8211; the number of documents can range from 1 to 21, with the id and val_i fields starting at &quot;0&quot;.  Then it generates a bunch of random requests consisting of random q and fq params.&lt;/p&gt;

&lt;p&gt;This is what the failing request looks like...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;q  = {!frange v=val_i l=0 u=1 cost=139 tag=t}
fq = {!frange v=val_i l=0 u=1}
fq = {! cost=92}-_query_:&quot;{!frange v=val_i l=1 u=1}&quot; 
fq = {!frange v=val_i l=0 u=1 cache=true tag=t}
fq = {! cache=true tag=t}-_query_:&quot;{!frange v=val_i l=1 u=1}&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So basically: it will only ever match docs which have val_i==0 &amp;#8211; which given how the index is built means it should always match exactly 1 document: the 0th doc &amp;#8211; but in the failure message we can see that it doens&apos;t match any docs.&lt;/p&gt;

&lt;p&gt;(FWIW: adding some debugging indicates that in the iteration where this fails, the index only has 2 documents in it &amp;#8211; doc#0 and doc#1)&lt;/p&gt;

&lt;p&gt;In this patch i&apos;m attaching, I hacked the test to explicitly attempt the above query in every iteration, regardless of the num docs in the index, immediately after building the index &amp;#8211; and that new assertion never fails.  but then after it passes, it continues on with the existing logic, to generating a bunch of random requests and executing them &amp;#8211; and when it randomly generates the same query as above (that already succeeded in matching 1 doc against the current index) that query then fails to match any docs.&lt;/p&gt;

&lt;p&gt;which smells to me like some sort of filter caching glitch .. right?&lt;/p&gt;</comment>
                            <comment id="13865713" author="hossman" created="Wed, 8 Jan 2014 18:18:32 +0000"  >&lt;p&gt;I&apos;ve recreated the failure conditions in a non-randomized test.&lt;/p&gt;

&lt;p&gt;See &quot;testHossssSanity&quot; in the updated patch for the details, but the bottom line is after building up two sets of SolrParams (match_1 and match_0), we have a situation where the following test code fails on the last line (match_1 gets a numFound==0)...&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-comment&quot;&gt;// 1 then 0
&lt;/span&gt;    assertJQ(req(match_1), &lt;span class=&quot;code-quote&quot;&gt;&quot;/response/numFound==1&quot;&lt;/span&gt;);
    assertJQ(req(match_0), &lt;span class=&quot;code-quote&quot;&gt;&quot;/response/numFound==0&quot;&lt;/span&gt;);

    &lt;span class=&quot;code-comment&quot;&gt;// clear caches
&lt;/span&gt;    assertU(commit());

    &lt;span class=&quot;code-comment&quot;&gt;// 0 then 1
&lt;/span&gt;    assertJQ(req(match_0), &lt;span class=&quot;code-quote&quot;&gt;&quot;/response/numFound==0&quot;&lt;/span&gt;);
    assertJQ(req(match_1), &lt;span class=&quot;code-quote&quot;&gt;&quot;/response/numFound==1&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;...which definitely smells like a caching bug.&lt;/p&gt;

&lt;p&gt;Perhaps this is a Query.equals() problem with one of the query classes used in the test?  I&apos;ll investigate a bit more later today &amp;#8211; starting with trying to simplify the params to the barest case that still fails.&lt;/p&gt;
</comment>
                            <comment id="13866096" author="hossman" created="Thu, 9 Jan 2014 00:14:53 +0000"  >&lt;p&gt;Attaching the simplest possible test case i found that fails.  these are the two queries, as mentioned before executing &quot;match_1&quot; before &quot;match_0&quot; and they both return the correct number of results, but if you executed &quot;match_0&quot; first then &quot;match_1&quot; doesn&apos;t match any documents...&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    SolrParams match_0 
      = params(&lt;span class=&quot;code-quote&quot;&gt;&quot;q&quot;&lt;/span&gt;,  &lt;span class=&quot;code-quote&quot;&gt;&quot;{!frange v=val_i l=0 u=1}&quot;&lt;/span&gt;,
               &lt;span class=&quot;code-quote&quot;&gt;&quot;fq&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;{!frange v=val_i l=1 u=1}&quot;&lt;/span&gt;,
               &lt;span class=&quot;code-quote&quot;&gt;&quot;fq&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;{!frange v=val_i l=0 u=1}&quot;&lt;/span&gt;,
               &lt;span class=&quot;code-quote&quot;&gt;&quot;fq&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;-_query_:\&quot;&lt;/span&gt;{!frange v=val_i l=1 u=1}\&quot;&quot;,
               &lt;span class=&quot;code-quote&quot;&gt;&quot;fq&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;-_query_:\&quot;&lt;/span&gt;{!frange v=val_i l=0 u=1}\&quot;&quot;);
    
    SolrParams match_1
      = params(&lt;span class=&quot;code-quote&quot;&gt;&quot;q&quot;&lt;/span&gt;,  &lt;span class=&quot;code-quote&quot;&gt;&quot;{!frange v=val_i l=0 u=1}&quot;&lt;/span&gt;,
               &lt;span class=&quot;code-quote&quot;&gt;&quot;fq&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;{!frange v=val_i l=0 u=1}&quot;&lt;/span&gt;,
               &lt;span class=&quot;code-quote&quot;&gt;&quot;fq&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;{!frange v=val_i l=0 u=1}&quot;&lt;/span&gt;,
               &lt;span class=&quot;code-quote&quot;&gt;&quot;fq&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;-_query_:\&quot;&lt;/span&gt;{!frange v=val_i l=1 u=1}\&quot;&quot;,
               &lt;span class=&quot;code-quote&quot;&gt;&quot;fq&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;-_query_:\&quot;&lt;/span&gt;{!frange v=val_i l=1 u=1}\&quot;&quot;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2 important things i noticed while testing:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;if i removed duplicate &amp;amp; redundent &lt;tt&gt;fq={!frange v=val_i l=0 u=1&lt;/tt&gt;} (redundent because it&apos;s identical to the q param) then the test started to pass&lt;/li&gt;
	&lt;li&gt;if i change the &lt;em&gt;order&lt;/em&gt; of the fq&apos;s, then the test started to pass&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;That reminded me of &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5057&quot; title=&quot;queryResultCache should not related with the order of fq&amp;#39;s list&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5057&quot;&gt;&lt;del&gt;SOLR-5057&lt;/del&gt;&lt;/a&gt; which was included in 4.5.0.  I tried applying this patch to trunk, 4x, 4.6.0, 4.5.0, and 4.4.0 &amp;#8211; all of them failed except 4.4, leading me to the working hypothesis that the changes in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5057&quot; title=&quot;queryResultCache should not related with the order of fq&amp;#39;s list&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5057&quot;&gt;&lt;del&gt;SOLR-5057&lt;/del&gt;&lt;/a&gt; caused this problem.&lt;/p&gt;

&lt;p&gt;When i reverted &lt;a href=&quot;https://svn.apache.org/r1516299&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1516299&lt;/a&gt; on my trunk checkout, both my new test and the original failing test (with the above mentioned reproduce line) started to pass.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;So it seems pretty clear to me that something related to &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5057&quot; title=&quot;queryResultCache should not related with the order of fq&amp;#39;s list&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5057&quot;&gt;&lt;del&gt;SOLR-5057&lt;/del&gt;&lt;/a&gt; is causing false cache hits &amp;#8211; what isn&apos;t entirely clear to me yet is if the functionality added in &lt;a href=&quot;https://svn.apache.org/r1516299&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1516299&lt;/a&gt; is fundamentally flawed (and should be reverted), or if it&apos;s just exposing some less obvious problem with the hashCode/equals methods of these specific query types.&lt;/p&gt;

&lt;p&gt;I&apos;ll keep digging - but if anyone can lend a pair of eyes to the logic in &lt;a href=&quot;https://svn.apache.org/r1516299&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1516299&lt;/a&gt; and chime in if you spot any fallacies it would be appreciated. &lt;/p&gt;</comment>
                            <comment id="13866158" author="hossman" created="Thu, 9 Jan 2014 01:13:50 +0000"  >&lt;blockquote&gt;&lt;p&gt;So it seems pretty clear to me that something related to &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5057&quot; title=&quot;queryResultCache should not related with the order of fq&amp;#39;s list&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5057&quot;&gt;&lt;del&gt;SOLR-5057&lt;/del&gt;&lt;/a&gt; is causing false cache hits &#8211; what isn&apos;t entirely clear to me yet is if the functionality added in r1516299 is fundamentally flawed (and should be reverted), or if it&apos;s just exposing some less obvious problem with the hashCode/equals methods of these specific query types.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Bug is definitely in the QueryResultKey.isEqual &amp;amp; QueryResultKey.unorderedCompare method &amp;#8211; they ensure that fqList1 and fqList2 are the same size, and that every item from fqList1 exists in fqList2, but they don&apos;t ensure that there is a 1-to-1 set equivalence between the lists &amp;#8211; So in cases where fqList1 contains some query X duplicated N times, it only ensures that X is in fqList2, but not that it&apos;s duplicated N times, so having some other clauses which are not in fqList1 to keep the sizes the same causes false positives.&lt;/p&gt;

&lt;p&gt;Targeted test case attached ... i&apos;ll work on a more robust randomized test tomorrow and see if i can figure out an efficinet fix, or if we should just revert r1516299 completely.&lt;/p&gt;</comment>
                            <comment id="13866159" author="hossman" created="Thu, 9 Jan 2014 01:14:17 +0000"  >&lt;p&gt;Root cause of problem introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5057&quot; title=&quot;queryResultCache should not related with the order of fq&amp;#39;s list&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5057&quot;&gt;&lt;del&gt;SOLR-5057&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13866172" author="yseeley@gmail.com" created="Thu, 9 Jan 2014 01:28:27 +0000"  >&lt;p&gt;Ah, tricky.&lt;br/&gt;
One could do for every X in fqList1, find an equiv in fqList2 and then&lt;br/&gt;
for every X in fqList2, find an equiv in fqList1, but it&apos;s not particularly efficient.&lt;br/&gt;
Probably most efficient for small lists would be to make a copy of one list and then remove equivalent elements as they are found.  Not sure if it&apos;s worth it though...&lt;/p&gt;</comment>
                            <comment id="13867263" author="hossman" created="Thu, 9 Jan 2014 23:19:44 +0000"  >&lt;blockquote&gt;&lt;p&gt;Probably most efficient for small lists would be to make a copy of one list and then remove equivalent elements as they are found.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Attached patch fixes the bug and adds some randomized testng on the QueryResultKey equality comparisons ensuring that both the positive and negative situations are covered.&lt;/p&gt;

&lt;p&gt;(I&apos;m still running full tests, but unless there are any objections i&apos;ll probably commit &amp;amp; backport to 4.6.1 ASAP)&lt;/p&gt;</comment>
                            <comment id="13867305" author="jira-bot" created="Thu, 9 Jan 2014 23:56:05 +0000"  >&lt;p&gt;Commit 1556988 from hossman@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1556988&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1556988&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5618&quot; title=&quot;false query result cache hits possible when duplicate filter queries exist in one query -- discovered via: Reproducible failure from TestFiltering.testRandomFiltering&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5618&quot;&gt;&lt;del&gt;SOLR-5618&lt;/del&gt;&lt;/a&gt;: Fix false cache hits in queryResultCache when hashCodes are equal and duplicate filter queries exist in one of the requests&lt;/p&gt;</comment>
                            <comment id="13867325" author="jira-bot" created="Fri, 10 Jan 2014 00:18:35 +0000"  >&lt;p&gt;Commit 1556996 from hossman@apache.org in branch &apos;dev/branches/branch_4x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1556996&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1556996&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5618&quot; title=&quot;false query result cache hits possible when duplicate filter queries exist in one query -- discovered via: Reproducible failure from TestFiltering.testRandomFiltering&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5618&quot;&gt;&lt;del&gt;SOLR-5618&lt;/del&gt;&lt;/a&gt;: Fix false cache hits in queryResultCache when hashCodes are equal and duplicate filter queries exist in one of the requests (merge r1556988)&lt;/p&gt;</comment>
                            <comment id="13867398" author="jira-bot" created="Fri, 10 Jan 2014 01:33:05 +0000"  >&lt;p&gt;Commit 1557008 from hossman@apache.org in branch &apos;dev/branches/lucene_solr_4_6&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1557008&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1557008&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5618&quot; title=&quot;false query result cache hits possible when duplicate filter queries exist in one query -- discovered via: Reproducible failure from TestFiltering.testRandomFiltering&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5618&quot;&gt;&lt;del&gt;SOLR-5618&lt;/del&gt;&lt;/a&gt;: Fix false cache hits in queryResultCache when hashCodes are equal and duplicate filter queries exist in one of the requests (merge r1556988)&lt;/p&gt;</comment>
                            <comment id="13867507" author="jira-bot" created="Fri, 10 Jan 2014 05:09:25 +0000"  >&lt;p&gt;Commit 1557031 from hossman@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1557031&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1557031&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5618&quot; title=&quot;false query result cache hits possible when duplicate filter queries exist in one query -- discovered via: Reproducible failure from TestFiltering.testRandomFiltering&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5618&quot;&gt;&lt;del&gt;SOLR-5618&lt;/del&gt;&lt;/a&gt;: fix stupid test mistake&lt;/p&gt;</comment>
                            <comment id="13867509" author="jira-bot" created="Fri, 10 Jan 2014 05:13:41 +0000"  >&lt;p&gt;Commit 1557033 from hossman@apache.org in branch &apos;dev/branches/branch_4x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1557033&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1557033&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5618&quot; title=&quot;false query result cache hits possible when duplicate filter queries exist in one query -- discovered via: Reproducible failure from TestFiltering.testRandomFiltering&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5618&quot;&gt;&lt;del&gt;SOLR-5618&lt;/del&gt;&lt;/a&gt;: fix stupid test mistake (merge r1557031)&lt;/p&gt;</comment>
                            <comment id="13867510" author="jira-bot" created="Fri, 10 Jan 2014 05:14:16 +0000"  >&lt;p&gt;Commit 1557034 from hossman@apache.org in branch &apos;dev/branches/lucene_solr_4_6&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1557034&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1557034&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5618&quot; title=&quot;false query result cache hits possible when duplicate filter queries exist in one query -- discovered via: Reproducible failure from TestFiltering.testRandomFiltering&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5618&quot;&gt;&lt;del&gt;SOLR-5618&lt;/del&gt;&lt;/a&gt;: fix stupid test mistake (merge r1557031)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12659089">SOLR-5057</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12622287" name="SOLR-5618.patch" size="14341" author="hossman" created="Thu, 9 Jan 2014 23:19:44 +0000"/>
                            <attachment id="12622081" name="SOLR-5618.patch" size="5024" author="hossman" created="Thu, 9 Jan 2014 01:13:50 +0000"/>
                            <attachment id="12622075" name="SOLR-5618.patch" size="2621" author="hossman" created="Thu, 9 Jan 2014 00:14:53 +0000"/>
                            <attachment id="12622004" name="SOLR-5618.patch" size="2715" author="hossman" created="Wed, 8 Jan 2014 18:18:32 +0000"/>
                            <attachment id="12621907" name="SOLR-5618.patch" size="1491" author="hossman" created="Wed, 8 Jan 2014 02:06:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>366774</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 45 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1r7zz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>367085</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>