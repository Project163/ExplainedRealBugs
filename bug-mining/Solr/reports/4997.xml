<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:55:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-16531] Performance degradation due to introduction of JAX-RS</title>
                <link>https://issues.apache.org/jira/browse/SOLR-16531</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;During performance benchmarking on branch_9x, I observed a slowdown in restart performance since commits in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16347&quot; title=&quot;Add JAX-RS integration for defining v2 APIs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16347&quot;&gt;&lt;del&gt;SOLR-16347&lt;/del&gt;&lt;/a&gt;. See attached screenshot.&lt;br/&gt;
CC &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gerlowskija&quot; class=&quot;user-hover&quot; rel=&quot;gerlowskija&quot;&gt;gerlowskija&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://mostly.cool/cluster-test-with-patch.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://mostly.cool/cluster-test-with-patch.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The benchmark is here: &lt;a href=&quot;https://github.com/fullstorydev/solr-bench/blob/ishan/repeatable-jenkins/suites/cluster-test.json&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/fullstorydev/solr-bench/blob/ishan/repeatable-jenkins/suites/cluster-test.json&lt;/a&gt;. This suite was run after retro-actively applying the parallelStream patch from &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16414&quot; title=&quot;Race condition in PRS state updates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16414&quot;&gt;&lt;del&gt;SOLR-16414&lt;/del&gt;&lt;/a&gt;: &lt;a href=&quot;https://github.com/apache/solr/commit/b33161d0cdd976fc0c3dc78c4afafceb4db671cf.diff&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/solr/commit/b33161d0cdd976fc0c3dc78c4afafceb4db671cf.diff&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;Effort to automate these benchmarks is WIP and tracked here: &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16525&quot; title=&quot;Periodic performance benchmarking&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16525&quot;&gt;SOLR-16525&lt;/a&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13500617">SOLR-16531</key>
            <summary>Performance degradation due to introduction of JAX-RS</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ichattopadhyaya">Ishan Chattopadhyaya</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Nov 2022 06:03:16 +0000</created>
                <updated>Mon, 27 Mar 2023 18:04:25 +0000</updated>
                            <resolved>Wed, 8 Feb 2023 18:07:50 +0000</resolved>
                                                    <fixVersion>9.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>15</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3000">50m</timespent>
                                <comments>
                            <comment id="17630764" author="ichattopadhyaya" created="Wed, 9 Nov 2022 06:03:46 +0000"  >&lt;p&gt;Marking this as 9.2 blocker.&lt;/p&gt;</comment>
                            <comment id="17631072" author="gerlowskija" created="Wed, 9 Nov 2022 13:26:18 +0000"  >&lt;p&gt;Copying a relevant comment from &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16530&quot; title=&quot;Performance degradation due to eliminating noggit Writeable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16530&quot;&gt;&lt;del&gt;SOLR-16530&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ichattopadhyaya&quot; class=&quot;user-hover&quot; rel=&quot;ichattopadhyaya&quot;&gt;ichattopadhyaya&lt;/a&gt; would you mind adding a bit more context here for posterity/clarity?&lt;/p&gt;

&lt;p&gt;e.g. What are the red and blue lines on the graph you attached a screenshot of? What&apos;s the relationship between the &quot;screenshotted&quot; graph and the one at &quot;http://mostly.cool/cluster-test-with-patch.html&quot;? (I&apos;m assuming that the screenshot is just a static capture of the HTML page, that you took because the dates covered by the HTML page will shift as time passes, but an explicit confirmation there would be great.) What does this perf test do in a sentence or two?  Is the Y-axis on this graph in seconds?  How significant is this slowdown in amortized terms?&lt;/p&gt;

&lt;p&gt;I know some of this context is in Slack, but not everyone has access there.&lt;/p&gt;</comment>
                            <comment id="17631183" author="gerlowskija" created="Wed, 9 Nov 2022 17:45:37 +0000"  >&lt;p&gt;I can take a look at this sometime prior to 9.2.  Overall I&apos;d expect the introduction of JAX-RS to have at least some impact on core-load (which would affect restarts transitively).  I wouldn&apos;t&apos;ve expected it to be dramatic, but that shows what I know I guess.&lt;/p&gt;

&lt;p&gt;I&apos;m still a little unclear on what the performance test is actually doing here, and what the impact would be on an average cluster.  I have some guesses that I&apos;m not too sure of; I&apos;ll do a little &quot;thinking-out-loud&quot; below, and maybe &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ichattopadhyaya&quot; class=&quot;user-hover&quot; rel=&quot;ichattopadhyaya&quot;&gt;ichattopadhyaya&lt;/a&gt; or others can correct me where I err.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;So the screenshot and associated webpage show that the red line jumps from a little over 325-ish on the prior commit (3ceae7 - &quot;Pin OS of docker image...&quot;) to a little over 350-ish with the JAX-RS commit.  (Do you have access to the specific numbers there, Ishan?). So the delta of whatever this test is doing is ~25s.&lt;/li&gt;
	&lt;li&gt;The performance test involves two tasks.  According to the cluster-test.json file linked above, the first task involves collection creation (solely), and the second task is a restart of each node after all the collection creation is done.&lt;/li&gt;
	&lt;li&gt;Again, going from cluster-test.json, it looks like task 1 creates 1000 collections, but doesn&apos;t specify how many shards or replicas each collection has?  Does that mean 1s, 1r, or are there other defaults?&lt;/li&gt;
	&lt;li&gt;Going from cluster-test.json, the cluster either has 8 or 7 nodes (not sure how to understand/reconcile the properties &lt;a href=&quot;https://github.com/fullstorydev/solr-bench/blob/ishan/repeatable-jenkins/suites/cluster-test.json#L49&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; and &lt;a href=&quot;https://github.com/fullstorydev/solr-bench/blob/ishan/repeatable-jenkins/suites/cluster-test.json#L35&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.).&lt;/li&gt;
	&lt;li&gt;Assuming 8 nodes total going forward, each node would host roughly 1000 * replicasPerShard * shardsPerCollection / 8 cores.  Or 125 * replicasPerShard * shardsPerCollection.&lt;/li&gt;
	&lt;li&gt;Now, &quot;task 2&quot; itself involves restarting these loaded nodes 2 at a time and waiting for everything to be healthy between batches of restarts.  If each node is restarted once, that means &quot;task 2&quot; would kick off restarts 4 times (again, doing 2 in parallel each time).&lt;/li&gt;
	&lt;li&gt;So the &quot;before&quot; performance of ~325s translates to a restart of a node with 125 * replicasPerShard * shardsPerCollection total cores taking about 81s...&lt;/li&gt;
	&lt;li&gt;And the &quot;after&quot; performance of ~350s translates to a similar restart now taking about 87s&lt;/li&gt;
	&lt;li&gt;So, ultimately, this perf test is telling us that JAX-RS makes restarts of heavily loaded nodes take ~7-8% longer i.e. (87.5 - 81.25)/81.25&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;How much of that did I get right vs wrong?&lt;/p&gt;</comment>
                            <comment id="17631189" author="ichattopadhyaya" created="Wed, 9 Nov 2022 17:56:03 +0000"  >&lt;p&gt;Attaching the results folder during the runs with the parallelStream patch &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13052006/13052006_results-with-patch.tar.gz&quot; title=&quot;results-with-patch.tar.gz attached to SOLR-16531&quot;&gt;results-with-patch.tar.gz&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;. I&apos;ll reply to all your points inline shortly (going AFK for a bit).&lt;/p&gt;</comment>
                            <comment id="17631201" author="ichattopadhyaya" created="Wed, 9 Nov 2022 18:24:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;So the screenshot and associated webpage show that the red line jumps from a little over 325-ish on the prior commit (3ceae7 - &quot;Pin OS of docker image...&quot;) to a little over 350-ish with the JAX-RS commit. (Do you have access to the specific numbers there, Ishan?). So the delta of whatever this test is doing is ~25s.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, roughly. Attached the raw results above.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The performance test involves two tasks. According to the cluster-test.json file linked above, the first task involves collection creation (solely), and the second task is a restart of each node after all the collection creation is done.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Correct.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Again, going from cluster-test.json, it looks like task 1 creates 1000 collections, but doesn&apos;t specify how many shards or replicas each collection has? Does that mean 1s, 1r, or are there other defaults?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;There&apos;s a file that contains all the collections: &lt;a href=&quot;https://github.com/fullstorydev/solr-bench/blob/ishan/repeatable-jenkins/suites/cluster-test.json#L5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/fullstorydev/solr-bench/blob/ishan/repeatable-jenkins/suites/cluster-test.json#L5&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Going from cluster-test.json, the cluster either has 8 or 7 nodes (not sure how to understand/reconcile the properties here and here.).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;There are 8 nodes, but restarting just 7 of them (to avoid restarting the overseer node).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Assuming 8 nodes total going forward, each node would host roughly 1000 * replicasPerShard * shardsPerCollection / 8 cores. Or 125 * replicasPerShard * shardsPerCollection.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I remember there being around 750 cores/node in this test. It can be calculated from that cluster state file I linked to above.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Now, &quot;task 2&quot; itself involves restarting these loaded nodes 2 at a time and waiting for everything to be healthy between batches of restarts. If each node is restarted once, that means &quot;task 2&quot; would kick off restarts 4 times (again, doing 2 in parallel each time).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Right.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;So the &quot;before&quot; performance of ~325s translates to a restart of a node with 125 * replicasPerShard * shardsPerCollection total cores taking about 81s...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m not sure I follow. Here&apos;s how I think about this. 750 replicas/node, total time 325s, so approx around 81s to restart a node with ~750 replicas (assuming one more node is being restarted at the same time).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;And the &quot;after&quot; performance of ~350s translates to a similar restart now taking about 87s&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;So, ultimately, this perf test is telling us that JAX-RS makes restarts of heavily loaded nodes take ~7-8% longer i.e. (87.5 - 81.25)/81.25&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Assuming the 325 and 350 as correct, this seems right to me.&lt;/p&gt;</comment>
                            <comment id="17631216" author="ichattopadhyaya" created="Wed, 9 Nov 2022 18:36:43 +0000"  >&lt;p&gt;In order to run this, here are the steps (at the moment):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
git clone https:&lt;span class=&quot;code-comment&quot;&gt;//github.com/fullstorydev/solr-bench
&lt;/span&gt;cd solr-bench
git checkout ishan/repeatable-jenkins
# Install jq, maven, coreutils (&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Mac OS, via brew) etc.
mvn clean compile assembly:single

./cleanup.sh &amp;amp;&amp;amp; ./stress.sh -c 62e3686d196ed0bb7a95bc2b25d6f4cd42d04bdb suites/cluster-test.json
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Hopefully, the test will run properly and you&apos;ll get the results in suites/results folder.&lt;/p&gt;</comment>
                            <comment id="17631250" author="gerlowskija" created="Wed, 9 Nov 2022 19:48:15 +0000"  >&lt;p&gt;750 cores per node; holy cow!&lt;/p&gt;

&lt;p&gt;Is there a reason behind the benchmark parameters that end up contributing to that number?  I&apos;d expect the number of cores per node to be a pretty big driver of the overall restart duration.  750 cores per node feels like a bit of an edge use-case, doesn&apos;t it?&lt;/p&gt;

&lt;p&gt;Obviously a slowdown at any scale is less than ideal, and I&apos;m happy to look into potential improvements regardless.  But I&apos;d be curious to see how a less extreme use case is impacted before we call this a blocker.  Have you gathered any numbers from runs with fewer cores-per-node (say, 100)?&lt;/p&gt;</comment>
                            <comment id="17631254" author="ichattopadhyaya" created="Wed, 9 Nov 2022 19:56:45 +0000"  >&lt;blockquote&gt;&lt;p&gt;Is there a reason behind the benchmark parameters that end up contributing to that number?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;FullStory have massive Solr clusters, and some of them have 1000+ cores/node. It is working well for FullStory, but restart times, understandably, are a sensitive issue for ops there.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;d expect the number of cores per node to be a pretty big driver of the overall restart duration. 750 cores per node feels like a bit of an edge use-case, doesn&apos;t it?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, I think FullStory has one of the largest deployments of Solr in the world.&lt;/p&gt;</comment>
                            <comment id="17631255" author="ichattopadhyaya" created="Wed, 9 Nov 2022 19:57:56 +0000"  >&lt;blockquote&gt;&lt;p&gt;But I&apos;d be curious to see how a less extreme use case is impacted before we call this a blocker. Have you gathered any numbers from runs with fewer cores-per-node (say, 100)?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t have such numbers at the moment, but I&apos;ll try to benchmark/instrument this by early next week.&lt;/p&gt;</comment>
                            <comment id="17631269" author="noble.paul" created="Wed, 9 Nov 2022 20:25:02 +0000"  >&lt;p&gt;&#160;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;750 cores per node; holy cow!&lt;/p&gt;

&lt;p&gt;Is there a reason behind the benchmark parameters that end up contributing to that number?&#160;&lt;/p&gt;&lt;/blockquote&gt;


&lt;p&gt;Yes 750 cores is big number. But it doesn&apos;t matter if you have 750 or 75 the percentage slowdown is very similar. The perf test suite sets a large number to magnify the effects. In a way, it is very good that the benchmark tests with such large clusters or we will ignore most of the issues.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;There was a degradation in perf in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16530&quot; title=&quot;Performance degradation due to eliminating noggit Writeable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16530&quot;&gt;&lt;del&gt;SOLR-16530&lt;/del&gt;&lt;/a&gt; . I wouldn&apos;t have noticed it normally. But, I created a small cluster&#160; in my laptop to verify the claim. It was indeed a bit slow.&#160; I did it using a simple JUnit and logging. So, you should be able to observe similar numbers on your laptop.&lt;/p&gt;

&lt;p&gt;My test program just created a &lt;tt&gt;MiniSolrCloudCluster&lt;/tt&gt; with 2 nodes and and a single collection (shards=200, replicationFactor=1) and just stop and start nodes and measure the times and log them. There is usually some variability between the runs . So, if I am trying to make an improvement I run it at least 5 times and choose the best number with each change to confirm it. Also, I did some logging at the code paths where my changes were added and that corroborated the slowdown and subsequent improvements after I made changes.&lt;/p&gt;</comment>
                            <comment id="17631289" author="dsmiley" created="Wed, 9 Nov 2022 21:03:00 +0000"  >&lt;blockquote&gt;&lt;p&gt;750 cores per node; holy cow!&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hee hee hee :-D. for FullStory &amp;amp; Salesforce, yeah, this is the world we live in.  The numbers on some servers are orders of magnitude more; it&apos;s mind boggling.  Decisions like the use of a TreeMap to put some cores in merely for convenience of sorting become unwise (hence fixed/contributed) &amp;#8211; an example.  Likewise I appreciate recent improvements from Noble to speedup solrconfig.xml processing.  It matters.  Likewise I care about the overhead/weight of a SolrCore... where are we being wasteful (e.g. unused metrics for handlers not used).&lt;/p&gt;</comment>
                            <comment id="17631312" author="gerlowskija" created="Wed, 9 Nov 2022 21:58:47 +0000"  >&lt;p&gt;Absolutely - performance matters.  Like I said I&apos;m happy to look into it either way, exceptional use case or no.&lt;/p&gt;

&lt;p&gt;The question I&apos;m asking is whether this should be a blocker.  A 7% degradation that affects everyone - no question that&apos;s a blocker.  A 7% slowdown that affects the 0.1% of users deployed in a particular idiosyncratic way....I think there&apos;s a valid question there.&lt;/p&gt;

&lt;p&gt;But that&apos;s getting ahead of ourselves - this may still affect more than FullStory/Salesforce.  Let&apos;s hold off on the &quot;Blocker or Not&quot; question until we get some data on how this impacts less exceptional deployments (i.e. ones with 100 cores / node)&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Yes 750 cores is big number. But it doesn&apos;t matter if you have 750 or 75 the percentage slowdown is very similar. &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt; The perf test suite sets a large number to magnify the effects.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Assuming the underlying perf issue here is some delta on a per-core basis, the percentage slowdown should be constant &lt;b&gt;per-core&lt;/b&gt;.  But percentage slowdown per-node-restart will vary a lot based on the number of cores.&lt;/p&gt;

&lt;p&gt;Let&apos;s look at this from the perspective of a real lame dishwashing analogy, which is the only thing I can think of right now.  I&apos;m a dishwasher who just switched over to some crummy soap, and it slows down my washing: I used to be able to clean a plate every 5s, but now it takes me 6s.  That&apos;s a 20% slowdown &lt;b&gt;per-plate&lt;/b&gt;.  Additionally, there&apos;s other stuff that&apos;s part of dishwashing that&apos;s not per-plate: putting on gloves, filling the sink, etc.   That takes me 10s, no matter how many dishes I&apos;m washing.  The overall slowdown on doing a batch of dishes isn&apos;t always going to be 20% - it&apos;ll vary a lot based on how many dishes need washed.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;If you have two dishes, your old time would&apos;ve been 10+2*5 = 20s, your new time would be 10+2*6 = 22s, and your slowdown would be (22 - 20) / 20 = &lt;b&gt;10%&lt;/b&gt;&lt;/li&gt;
	&lt;li&gt;If you have forty dishes, your old time would&apos;ve been 10+40*5 = 210s, your new time would be 10+40*6 = 250s, and your slowdown would be (250 - 210) / 210 = &lt;b&gt;19%&lt;/b&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Now to get back to Solr&apos;s terms, just swap out the word &quot;dishes&quot; for &quot;cores&quot;, and &quot;filling the sink, etc.&quot; is the overhead of starting a Solr node that needs done regardless of the number of cores.&lt;/p&gt;

&lt;p&gt;This was super lame, but hopefully it illustrates the point I&apos;m shooting for?&lt;/p&gt;

&lt;p&gt;Either way - I guess we&apos;ll see for sure whether the percentage slowdown is constant if Ishan gets a chance to run those fewer-core tests early next week.&lt;/p&gt;</comment>
                            <comment id="17631331" author="noble.paul" created="Wed, 9 Nov 2022 23:04:00 +0000"  >&lt;blockquote&gt;&lt;p&gt;A 7% slowdown that affects the 0.1% of users deployed in a particular idiosyncratic way..&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t think we should dismiss it saying that it&apos;s 0.1% of the users . Solr is designed to deal with large datasets. There are so many tools if you just want to process a few GB of data that can be processed in a laptop. But, when we go to peta bytes of data there are very few tools and Solr is targeting that market. Most of the problems we are trying to solve in Solr stems from the fact that the design choices we made in the beginning were dictated by a few cores and a few GB of data. (e.g: monolithic &lt;tt&gt;clusterstate.json&lt;/tt&gt;) . &lt;/p&gt;

&lt;p&gt;Fullstory (or any big user) spends several millions just on GCP/AWS/Azure bills. A 5% slowdown usually means we need to spend 100&apos;s of thousands that much extra on GCP. So, they just refuse to upgrade to a newer version of Solr and they just keep patching their existing fork. Coincidentally, most of the developers are sponsored by these big users (apple,salesforce,fullstory etc). If the latest version of Solr is unusable for them, the developers will be asked to work on the custom fork and that is not what we want.&lt;/p&gt;

&lt;p&gt;We are trying to push the limits of what Solr can do and how much output we can squeeze out of a given hardware.  If we add a few KBs of heap usage to a core or if we use a few 100ms per core it adds up big time for us.  If Solr adds a new opt-in feature that is a bit slow, we don&apos;t care. But if it is not opt-in it hurts us&lt;/p&gt;

&lt;p&gt;TLDR: We are less concerned about per node overhead and we are more concerned about per core overhead. Solr has too much of unnecessary ovehead per core which needs to be eliminated. If possible more objects/threads should be shared/cached/eliminated/made optional&lt;/p&gt;</comment>
                            <comment id="17631638" author="gerlowskija" created="Thu, 10 Nov 2022 12:51:54 +0000"  >&lt;p&gt;I appreciate the extra explanation, but I feel like you&apos;re arguing against a point that no one&apos;s putting forward here.  We all agree this is important.  We all agree this is worth looking into.  And I&apos;ve said at least twice now that I plan to take a look personally.  I don&apos;t think that&apos;s &quot;dismissive&quot; by any stretch.&lt;/p&gt;

&lt;p&gt;No one&apos;s questioning whether this should get fixed: everyone&apos;s in agreement on that already.&lt;/p&gt;

&lt;p&gt;The open question is whether it should be a blocker.  And looking at the question with my &quot;Apache Hat&quot; on, I just don&apos;t see much case there.  We&apos;d (in theory) make tens of thousands of users the world over wait - not on a security fix, not on a stability issue, not even on a performance problem that&apos;s likely to impact them - but on a 7% slowdown of a less-common operation that impacts two companies &lt;b&gt;in the world&lt;/b&gt;?&lt;/p&gt;

&lt;p&gt;I value those companies and their role in our community.  And - as you alluded to - I even work at one of them!  So I&apos;m the furthest thing from dismissive here, believe me.  But we have a responsibility to make community decisions with the whole community in mind.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;So, they just refuse to upgrade to a newer version of Solr and they just keep patching their existing fork.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;d hate to think that this ticket would cause companies to fork, or invest more in their forks.  But &quot;No Blocker Tag = More Forks and Fewer Devs&quot; seems like a false choice to me.  There are plenty of paths to getting this in 9.2 that don&apos;t involve &quot;priority:Blocker&quot;.&lt;/p&gt;</comment>
                            <comment id="17631657" author="noble.paul" created="Thu, 10 Nov 2022 13:26:30 +0000"  >&lt;blockquote&gt;&lt;p&gt;No one&apos;s questioning whether this should get fixed: everyone&apos;s in agreement on that already.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;thanks.&lt;/p&gt;

&lt;p&gt;A blocker just means that we need to fix it before a release&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;We&apos;d (in theory) make tens of thousands of users the world over wait - not on a security fix, not on a stability issue, not even on a performance problem that&apos;s likely to impact them - but on a 7% slowdown of a less-common operation that impacts two companies in the world?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;If we discover a security hole, stability issue because of a new feature, would you sill go ahead with a release?&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;I&apos;d hate to think that this ticket would cause companies to fork&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Big companies usually do not upgrade to a newer version of Solr unless there is a compelling feature. They always use a forked older Solr version that works for them. If there is a perf penalty , they don&apos;t even bother to upgrade&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;but on a 7% slowdown of a less-common operation that impacts two companies in the world?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;what is less common operation for somebody is everyday operation for us. Honestly, It&apos;s disturbing when somebody says &lt;em&gt;Sorry if I broke your use-case, it&apos;s just your problem, but this new feature that I&apos;m working on is so important for everyone&lt;/em&gt; . I know you didn&apos;t mean it that way, but it came across to me like that&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;There are plenty of paths to getting this in 9.2 that don&apos;t involve &quot;priority:Blocker&quot;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;We are just debating semantics here. As long as 9.2 is as performant as 9.1 it&apos;s good enough&lt;/p&gt;</comment>
                            <comment id="17631716" author="gerlowskija" created="Thu, 10 Nov 2022 15:39:30 +0000"  >&lt;blockquote&gt;&lt;p&gt;Honestly, It&apos;s disturbing when somebody says Sorry if I broke your use-case, it&apos;s just your problem, but this new feature that I&apos;m working on is so important for everyone .&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, if it helps reassure you more, that&apos;s absolutely NOT what I&apos;m trying to say.  I want to get this fixed as much as you do.  I&apos;ve put tons of work into JAX-RS/Jersey specifically and v2 in general - I want to make this as easy to use and as fast as I can for everyone.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;As long as 9.2 is as performant as 9.1 it&apos;s good enough&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I mentioned this on Slack but really should&apos;ve raised this earlier here: but there&apos;s already a workaround for the perf issue if you&apos;re not using the v2 API, and that&apos;s to disable v2.  With the right system property, 9.2-SNAPSHOT should be &quot;as performant as 9.1&quot; today.  And like I said, I&apos;m very motivated to make even that workaround unnecessary - though more hands and eyes are always welcome.&lt;/p&gt;</comment>
                            <comment id="17631748" author="ichattopadhyaya" created="Thu, 10 Nov 2022 16:13:31 +0000"  >&lt;blockquote&gt;&lt;p&gt;workaround for the perf issue if you&apos;re not using the v2 API, and that&apos;s to disable v2&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;That would suck. A good perf out of the box with V2 is important. +1 to fixing the perf issue before the next release, I&apos;ll cooperate in every way possible to help in this.&lt;/p&gt;</comment>
                            <comment id="17631970" author="noble.paul" created="Thu, 10 Nov 2022 23:58:19 +0000"  >&lt;blockquote&gt;&lt;p&gt;but there&apos;s already a workaround for the perf issue if you&apos;re not using the v2 API, and that&apos;s to disable v2.&lt;/p&gt;&lt;/blockquote&gt;


&lt;p&gt;The V2 API as it exists today doesn&apos;t need to be disabled and it is fast enough. Going forward, we plan to cut over all usage (admin,SolrJ etc) to V2 . At that point,  we should not be disabling V2 at all. It&apos;s hard to explain to a user that &quot;hey, from 9.2, please disable V2 APIs because it is causing an overall system slowdown&quot; . The point is , the API itself is not the slow part, node restarts are&lt;/p&gt;</comment>
                            <comment id="17633745" author="gerlowskija" created="Mon, 14 Nov 2022 12:01:55 +0000"  >&lt;blockquote&gt;&lt;p&gt;Going forward, we plan to cut over all usage (admin,SolrJ etc) to V2 . At that point, we should not be disabling V2 at all&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Totally agree.  I&apos;m not putting that workaround forward as an ideal case or a long term solution, just as an option for anyone it might help while we work on the fix here.&lt;/p&gt;</comment>
                            <comment id="17634038" author="noble.paul" created="Mon, 14 Nov 2022 20:35:55 +0000"  >&lt;blockquote&gt;&lt;p&gt;&#160;just as an option for anyone it might help while we work on the fix here.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;If I were you, I would revert the commit before it gets harder and harder . I would iterate on a branch and commit this once the problem is fixed.&#160;&lt;/p&gt;

&lt;p&gt;The wrong thing to do is leaving the commit there and continuing to put duct tape fixes&#160;&lt;/p&gt;</comment>
                            <comment id="17634386" author="gerlowskija" created="Tue, 15 Nov 2022 14:40:19 +0000"  >&lt;p&gt;Noted - Ishan and you have both made your preference there pretty clear.  I remain open to different perspectives and will think it over.&lt;/p&gt;

&lt;p&gt;That said, for now I remain committed to &quot;progress-over-perfection&quot; in this as in most things.  As a community we&apos;ve seen way too many large promising efforts &quot;iterate on a branch&quot; so long that they become impossible to review, merge, or backport.  Avoiding that was one of my main goals when deciding how to structure this development.  That does open us up to certain risks, like unreleased builds seeing perf degradation as described in this ticket.  But everything has tradeoffs, and I remain confident that we can address these before a still-pretty-distant 9.2.&lt;/p&gt;</comment>
                            <comment id="17634399" author="ichattopadhyaya" created="Tue, 15 Nov 2022 15:08:37 +0000"  >&lt;p&gt;Why can&apos;t this be worked on in the main branch, and brought back to 9x once there is an improvement in performance? That way, other issues can be worked on in 9x branch without this performance deg masking the effect of those others.&lt;/p&gt;</comment>
                            <comment id="17634559" author="noble.paul" created="Tue, 15 Nov 2022 22:45:08 +0000"  >&lt;blockquote&gt;&lt;p&gt;I remain committed to &quot;progress-over-perfection&quot;&#160;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;true. but we cannot allow regression for progress&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;That does open us up to certain risks, like unreleased builds seeing perf degradation&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I wish to work on some performance improvements on 9x. That will be impossible as long as the branch is already slow &lt;/p&gt;</comment>
                            <comment id="17634866" author="gerlowskija" created="Wed, 16 Nov 2022 14:33:37 +0000"  >&lt;p&gt;Can you explain what about this slight slowdown makes work on other perf tickets &quot;impossible&quot;?  That&apos;s a concerning claim, but I&apos;ll admit I don&apos;t understand why that would be, especially when there&apos;s a feature flag to disable v2 for anyone that wants to do perf-benchmarking on branch_9x.  I don&apos;t see why this would &quot;mask&quot; anything, necessarily.&lt;/p&gt;</comment>
                            <comment id="17635003" author="noble.paul" created="Wed, 16 Nov 2022 20:28:40 +0000"  >&lt;blockquote&gt;&lt;p&gt;when there&apos;s a feature flag to disable v2 for anyone that wants to do perf-benchmarking on branch_9x&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;disabling v2 has no impact on the perf, you get the exact same numbers &lt;/p&gt;

&lt;p&gt;BTW, we normal practice is to undo any commit that causes regression on the stable branch.    This makes life easier for every developer who commits to the  branch. &lt;/p&gt;</comment>
                            <comment id="17635037" author="dsmiley" created="Wed, 16 Nov 2022 23:08:05 +0000"  >&lt;p&gt;A regression of a bug (failing tests) is a reason to revert.  A minor perf regression.... no.  Any way, let&apos;s productively think about solutions than needlessly debate this.  &lt;/p&gt;</comment>
                            <comment id="17635038" author="noble.paul" created="Wed, 16 Nov 2022 23:11:38 +0000"  >

&lt;blockquote&gt;&lt;p&gt;let&apos;s productively think about solutions than needlessly debate this.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;absolutely. But, that doesn&apos;t need to happen on a stable branch. We can fix the issues and reintroduce the changes&lt;/p&gt;</comment>
                            <comment id="17636317" author="ichattopadhyaya" created="Sun, 20 Nov 2022 16:57:10 +0000"  >&lt;p&gt;I re-ran the tests to report more granular time (startup and shutdown times) than just &quot;restart time&quot;. The graph is here: &lt;a href=&quot;http://mostly.cool/cluster-test.json.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://mostly.cool/cluster-test.json.html&lt;/a&gt; (as before). This has the patch for the parallel stream bugfix backported to earlier commits.&lt;/p&gt;

&lt;p&gt;The average startup time (that consists of node starting up and waiting until all replicas on it have become active) has degraded from 38 seconds to 51 seconds. &lt;b&gt;So, node startup is about 33% slower.&lt;/b&gt; The total time in restarting 7 nodes (2 at a time), similar to as reported earlier, degraded from 313 seconds to 372 seconds. &lt;b&gt;So, the series of node restarts is about 19% slower&lt;/b&gt;.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;A minor perf regression&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;In my opinion, this is not minor regression, but a significant one.&lt;/p&gt;</comment>
                            <comment id="17636318" author="ichattopadhyaya" created="Sun, 20 Nov 2022 17:12:54 +0000"  >&lt;blockquote&gt;&lt;p&gt;I can take a look at this sometime prior to 9.2. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I strongly recommend that we revert this from branch_9x now, iterate on it in main (once you get a chance), and backport to branch_9x only once the solution is performant.&lt;/p&gt;</comment>
                            <comment id="17642688" author="gerlowskija" created="Fri, 2 Dec 2022 20:55:57 +0000"  >&lt;blockquote&gt;&lt;p&gt;disabling v2 has no impact on the perf, you get the exact same numbers&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You&apos;re right, the feature flag wasn&apos;t ever pushed down to PluginBag so there was needless work being done both for JAX-RS and for the traditional ApiBag-based v2 APIs when v2 was disabled.  Working on a fix for that &lt;a href=&quot;https://github.com/apache/solr/pull/1210&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17642715" author="houston" created="Fri, 2 Dec 2022 23:02:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16347&quot; title=&quot;Add JAX-RS integration for defining v2 APIs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16347&quot;&gt;&lt;del&gt;SOLR-16347&lt;/del&gt;&lt;/a&gt; was a very big commit. Having it sit on &lt;tt&gt;main&lt;/tt&gt; without merging to &lt;tt&gt;branch_9x&lt;/tt&gt; is risky, because as you both have mentioned at a certain point after many people have touched files, backporting is very hard and there is much greater room for errors being introduced. It also makes backports much harder for all other commits, since 9x and main will be quite different. I don&apos;t think it was a bad idea for jason to merge it back then. This is the same for reverting, the longer we wait the more risky it will be. The difference for me is that this was going to have to be backported, while this might not necessarily have to be reverted. So basically we can push off having to make things hard only if the need REALLY arises. That time has not yet come because the code is not being released yet.&lt;/p&gt;

&lt;p&gt;It was backported to 9x before 9.1 was released, so it is being given a full minor release cycle to be developed/iterated on. I don&apos;t think it&apos;s unreasonable to give Jason more time to fix this before trying to revert it. Since noble wants to test other fixes without this performance issue in the meantime, Jason fixing the v2 disabling should allow for that. &lt;/p&gt;

&lt;p&gt;Overall the goal is for Solr to be better. Will reverting this get us there faster or will keeping it in do that? Obviously it depends on how hard the degradation is to fix, but to me keeping it in is more likely since I trust that this is the path forward and we can get around the performance issue (or at least lower it to an acceptable amount). I am willing to agree that by 9.2 release time, this should be reverted if the degradation is not reasonably fixed. But no one is pounding on the walls for a 9.2, and any security issues could easily go in a 9.1.1 release, if they arise. &lt;/p&gt;</comment>
                            <comment id="17642742" author="noble.paul" created="Sat, 3 Dec 2022 00:25:12 +0000"  >&lt;blockquote&gt;&lt;p&gt;&#160;Having it sit on&#160;&lt;tt&gt;main&lt;/tt&gt;&#160;without merging to&#160;&lt;tt&gt;branch_9x&lt;/tt&gt;&#160;is risky, because as you both have mentioned at a certain point after many people have touched files, backporting is very hard and there is much greater room for errors being introduced.&#160;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;True. it is desirable to revert from main as well in a committer PoV.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;but to me keeping it in is more likely since I trust that this is the path forward and we can get around the performance issue&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;When you say the &quot;path forward&quot;, I agree with the objectives. It is better to have nicer APIs. Is JAX-RS the best tool to achieve it? I don&apos;t know. What if we identify a different framework that can help us achieve our objectives without such serious perf overhead? In that case we will have to rewrite everything that we have already committed.&lt;/p&gt;

&lt;p&gt;The API framework sits in the critical path of any back end system. It is not something optional. We are so late in the stage of dev and we still do not know the performance parameters of something we will have to use in every single request/response of Solr.&lt;/p&gt;

&lt;p&gt;Did we measure the memory overhead yet? or did we compare the req/response performance of this compared to V1 V2 ?&lt;/p&gt;

&lt;p&gt;We haven&apos;t.&lt;/p&gt;</comment>
                            <comment id="17652100" author="gerlowskija" created="Tue, 27 Dec 2022 03:14:46 +0000"  >&lt;p&gt;Hey all, merry Christmas and happy holidays!&lt;/p&gt;

&lt;p&gt;I&apos;ve been too lax in posting updates here, but I have been working on this and have some results to share.&lt;/p&gt;
&lt;h3&gt;&lt;a name=&quot;SolrBenchStuff&quot;&gt;&lt;/a&gt;Solr-Bench Stuff&lt;/h3&gt;

&lt;p&gt;I&apos;ve run the solr-bench suite we&apos;ve been discussing a number of times, but haven&apos;t been able to reproduce anything in the &quot;33%&quot; ballpark that Ishan mentioned a few comments up. I do see a slowdown of around ~15% pretty reliably with the JAX-RS change, but obviously that&apos;s only about half of what Ishan observed. Maybe this is hardware related? I&apos;m running solr-bench &quot;locally&quot;. Maybe his performance trials use cloud VMs or containers and the different results make sense, but it seems like a large deviation... Anyway, my numbers are in the google sheet &lt;a href=&quot;https://docs.google.com/spreadsheets/d/1i_jAHNOhy-LxvjCJglQqsxJtW9pPnRjlA1U1hhi0rdY/edit?usp=sharing&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;On a maybe related note, there seems to be a bug in the &lt;tt&gt;ishan/repeatable-jenkins&lt;/tt&gt; solr-bench branch that I was pointed to in a comment pretty early-on in this thread. See &lt;a href=&quot;https://github.com/gerlowskija/solr-bench/commit/f94708148ff2a13fb010c323304c3b6b4015b382&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; for the details, but the gist: the start-time calculation on &quot;repeatable-jenkins&quot; accidentally subtracts the recovery time instead of adding it (at least, as of 1d1a36). I mentioned this in a &lt;tt&gt;fullstorydev/solr-bench&lt;/tt&gt; issue &lt;a href=&quot;https://github.com/fullstorydev/solr-bench/issues/31#issuecomment-1344667693&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; and asked for some clarification on how (or whether) to submit a fix. Take a look when you get a chance please!&lt;/p&gt;

&lt;p&gt;Additionally, on runs that create a large number of collections (i.e. sporadically with 700 but frequently with 800 or more colls) the &quot;clusterstatus&quot; task runs into problems creating these collections. The CREATE request times out and the Solr logs have a suspicious loooking error message about an expected overseer node being missing. Running with the full 1000 collections that Ishan and Noble&apos;s numbers were based on, it takes me somewhere between 5 and 10 benchmark attempts to get a clean, usable run. Again, maybe this is something specific to running &quot;locally&quot;? Curious if any of this rings a bell for anyone more familiar with running this suite, maybe Ishan can chime in.&lt;/p&gt;
&lt;h3&gt;&lt;a name=&quot;SomeImprovement%21&quot;&gt;&lt;/a&gt;Some Improvement!&lt;/h3&gt;

&lt;p&gt;I also spent some time with the &lt;a href=&quot;https://github.com/apache/solr/tree/main/solr/benchmark&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;benchmarking module already built into Solr&lt;/a&gt;, which relies heavily on JMH. As I gather, this is less suited for the sort of macro-testing that solr-bench offers, but it does offer the ability to profile the code being run and produce (e.g.) CPU flamegraphs and other visualizations that help determine where time is actually being spent. I created a JMH benchmark (see &lt;a href=&quot;https://github.com/gerlowskija/solr/blob/benchmark_attempt/solr/benchmark/src/java/org/apache/solr/bench/index/SolrStartup.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;) to cover Solr startup and collected flamegraphs with JAX-RS enabled and disabled, and with varying numbers of collections. From looking at those I was able to come up with some decent improvements, mostly consisting of some tweaks in how resources register and in disabling some unused Jersey features that were consuming CPU.&lt;/p&gt;

&lt;p&gt;Profiling &lt;a href=&quot;https://github.com/gerlowskija/solr/commit/d393f4d5f6d6eef78a4734edc44f6a1570d86680&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;those changes&lt;/a&gt; and comparing them to the original flamegraphs, the changes cut the CPU cycles spent in Jersey code in half! Cross-checking this against the solr-bench benchmark shows some improvement, though admittedly a good deal less than the CPU-cycle-halving initially dared me to hope. Again, see &lt;a href=&quot;https://docs.google.com/spreadsheets/d/1i_jAHNOhy-LxvjCJglQqsxJtW9pPnRjlA1U1hhi0rdY/edit?usp=sharing&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this Google Sheet&lt;/a&gt; for some details. I&apos;d love a sanity check from anyone else familiar with running these benchmarks (probably once the time-calculation bug on ishan/repeatable-jenkins is cleared up)!&lt;/p&gt;
&lt;h3&gt;&lt;a name=&quot;NextSteps&quot;&gt;&lt;/a&gt;Next Steps&lt;/h3&gt;

&lt;p&gt;I&apos;m optimistic that the improvements to our Jersey-integration take a good bite out of the perf degradation. But whatever the solr-bench results from others might show, I expect we probably still aren&apos;t quite &quot;there&quot; yet and more improvement will be needed. So let&apos;s talk next steps.&lt;/p&gt;

&lt;p&gt;My immediate goal in the next week or so is to try swapping out Jersey for a number of alternative libraries, to see if any of those offer any better performance. (Jersey is only one implementation of the &apos;JAX-RS spec&apos; much in the same way that log4j offers one implementation of the slf4j spec. Spiking out a switch should be do-able for perf testing.)&lt;/p&gt;

&lt;p&gt;If that doesn&apos;t pan out though, I&apos;ll turn my attention to the suggestion that&apos;s been made several times now to change our JAX-RS integration and existing v1 API handling to create an entity (i.e. JAX-RS application, PluginBag, etc.) on a per-configset basis instead of a per-core basis. IMO this has always been the most promising option. I haven&apos;t tried it yet because of the scope involved: it&apos;s a large change in its own right, and one that&apos;d need broader consensus from the community. But I&apos;ll at least try to spike it out in time for the January 11th date.&lt;/p&gt;</comment>
                            <comment id="17653826" author="ichattopadhyaya" created="Tue, 3 Jan 2023 07:03:43 +0000"  >&lt;blockquote&gt;&lt;p&gt;On a maybe related note, there seems to be a bug in the ishan/repeatable-jenkins solr-bench branch that I was pointed to in a comment pretty early-on in this thread. See here for the details, but the gist: the start-time calculation on &quot;repeatable-jenkins&quot; accidentally subtracts the recovery time instead of adding it (at least, as of 1d1a36). I mentioned this in a fullstorydev/solr-bench issue here and asked for some clarification on how (or whether) to submit a fix. Take a look when you get a chance please!&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;ll take a look.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Additionally, on runs that create a large number of collections (i.e. sporadically with 700 but frequently with 800 or more colls) the &quot;clusterstatus&quot; task runs into problems creating these collections. The CREATE request times out and the Solr logs have a suspicious loooking error message about an expected overseer node being missing. Running with the full 1000 collections that Ishan and Noble&apos;s numbers were based on, it takes me somewhere between 5 and 10 benchmark attempts to get a clean, usable run. Again, maybe this is something specific to running &quot;locally&quot;? Curious if any of this rings a bell for anyone more familiar with running this suite, maybe Ishan can chime in.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Looks like this could be an issue with hardware? Can you please post the specs of the machine where this was running?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;m optimistic that the improvements to our Jersey-integration take a good bite out of the perf degradation. But whatever the solr-bench results from others might show, I expect we probably still aren&apos;t quite &quot;there&quot; yet and more improvement will be needed. So let&apos;s talk next steps.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sounds good. Please let me know if you have a branch with the improvements ready that you want me to test (solr-bench) on the same hardware where I&apos;ve been running the tests till now.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;but haven&apos;t been able to reproduce anything in the &quot;33%&quot; ballpark that Ishan mentioned a few comments up&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Just to cross check, I think I should re-run the benchmark once again and see how it goes.&lt;/p&gt;</comment>
                            <comment id="17654184" author="gerlowskija" created="Tue, 3 Jan 2023 20:34:13 +0000"  >&lt;blockquote&gt;&lt;p&gt;Looks like this could be an issue with hardware? Can you please post the specs of the machine where this was running?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m not sure what to chalk it up to beyond hardware.  But my test machine is pretty beefy; it seems like it should be able to handle things, but who knows?  I&apos;m using a Mac Pro with a 14-core &quot;Intel Xeon&quot; processor, 128gb of RAM, and a SSD for disk.  What have you been using for your testing?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Please let me know if you have a branch with the improvements ready that you want me to test (solr-bench) on the same hardware where I&apos;ve been running the tests till now&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, that&apos;d be great, thanks!  The branch &lt;a href=&quot;https://github.com/gerlowskija/solr/tree/jaxrs-with-partial-fix&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; rewinds to the introduction of JAX-RS on main (8efed0) and adds a single commit (8d6052) that partially alleviates the perf regression.  (If you&apos;d prefer something based on the latest &lt;tt&gt;main&lt;/tt&gt; or &lt;tt&gt;branch_9x&lt;/tt&gt; etc, that single commit should be pretty cherry-pick-able, or I&apos;d be happy to make a branch with a different base if you lmk.)&lt;/p&gt;</comment>
                            <comment id="17655580" author="gerlowskija" created="Fri, 6 Jan 2023 20:50:17 +0000"  >&lt;p&gt;Alright, wanted to post another update on my progress to close out the week.&lt;/p&gt;
&lt;h3&gt;&lt;a name=&quot;Some%28Temporarily%29DeadEnds&quot;&gt;&lt;/a&gt;Some (Temporarily) Dead Ends&lt;/h3&gt;

&lt;p&gt;I&apos;ve spent most of the time since my last comment attempting to swap out Jersey for a different JAX-RS implementation like RESTEasy. The &quot;swap&quot; ended up being more time-consuming than anticipated, as our JAX-RS integration relies on some Jersey-specific classes that don&apos;t have clear counterparts in other JAX-RS impls. It should still be do-able, due to the increased scope and the limited time before the Jan 11th date, I&apos;m pausing my pursuit of this avenue for now.&lt;/p&gt;

&lt;p&gt;I&apos;d love other eyes on this though if anyone&apos;s willing in the meantime.&#160; The code is available on &lt;a href=&quot;https://github.com/gerlowskija/solr/tree/resteasy-trial-run&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this branch&lt;/a&gt;. The main holdup at this point is finding a replacement for the ApplicationHandler class used within CoreContainer and SolrCore to wrap Jersey applications.&lt;/p&gt;
&lt;h3&gt;&lt;a name=&quot;SomeProgress%21&quot;&gt;&lt;/a&gt;Some Progress!&lt;/h3&gt;

&lt;p&gt;On a more promising note, I had much more success spiking out a Jersey integration that creates an &quot;app&quot; for each unique configset (instead of for each and every Solr core). The code is nowhere near committable, but hacking an approach together ended up being pretty straightforward (see the code &lt;a href=&quot;https://github.com/gerlowskija/solr/tree/jaxrs-with-fix-and-appcaching&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;). And as we&apos;d guessed/hoped, creating a Jersey app-per-configset does show massive improvements in the time spent on Jersey init.&lt;/p&gt;

&lt;p&gt;As measured by a &lt;a href=&quot;https://github.com/gerlowskija/solr/blob/benchmark_attempt/solr/benchmark/src/java/org/apache/solr/bench/index/SolrStartup.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;JMH benchmark&lt;/a&gt;, node startup spends 28% of its CPU cycles on Jersey init when we create a Jersey app-per-core. When we switch to app-per-configset, this drops down to 0.24%! Of course, these numbers are all pretty dependent on the benchmark parameters (the number of cores, the number of configsets, etc.), but it definitely proves out app-per-configset idea. I&apos;ve attached flamegraphs below showing the results.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13054412/13054412_vanilla-jaxrs-integration-flamegraph.html&quot; title=&quot;vanilla-jaxrs-integration-flamegraph.html attached to SOLR-16531&quot;&gt;vanilla-jaxrs-integration-flamegraph.html&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; &lt;br/&gt;
&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13054413/13054413_jaxrs-integration-with-app-per-configset-flamegraph.html&quot; title=&quot;jaxrs-integration-with-app-per-configset-flamegraph.html attached to SOLR-16531&quot;&gt;jaxrs-integration-with-app-per-configset-flamegraph.html&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;&lt;a name=&quot;NextStepsandQuestions&quot;&gt;&lt;/a&gt;Next Steps and Questions&lt;/h3&gt;
&lt;ol&gt;
	&lt;li&gt;App-per-configset is definitely the most promising path forward IMO, and we now have some concrete proof for that.&#160; So my plan at this point is to continue working on that. Obviously this won&apos;t be done in time for the January 11th date we agreed to earlier. I remain willing to abide by that date since it&apos;s what we agreed to, but I wonder whether this approach (combined with the other bits and bobs of progress made so far) shows enough promise that it&apos;d make sense to extend the deadline a bit further, especially if the &quot;per-configset&quot; approach is do-able for 9.2 (which continues to appear far off, given the nascent 9.1.1 release in its early stages).&lt;/li&gt;
	&lt;li&gt;Ishan - any chance you were able to kick off a solr-bench run with the commits/branches I pointed you at in my comment above? No rush, but excited to get a sanity check from someone else&apos;s machine, since I&apos;ve had trouble locally with the benchmarks at higher &apos;numCollections&apos;.&lt;/li&gt;
	&lt;li&gt;Would love feedback from anyone on the RESTEasy and per-configset branches I shared links to above!&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="17655584" author="noble.paul" created="Fri, 6 Jan 2023 21:23:28 +0000"  >&lt;blockquote&gt;&lt;p&gt;shows enough promise that it&apos;d make sense to extend the deadline a bit further,&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think we should revert the changes and work on a branch. The problem is, as there is a known perf degradation , nobody can do any test of perf on any commits. So we are in the dark regarding perf degradations that might have happened due to other changes. for instance, we have upgraded jetty recently and we do not know if that is an improvement or degradation because the benchmarks are not run&lt;/p&gt;

&lt;p&gt;ideally , if there is a perf issue between 9.1 and 9.2 , we should be able to pin point it to a single commit. We are not unable to do that because of this . 9x branch should &lt;b&gt;always&lt;/b&gt; have performance closer to 9.1.&lt;/p&gt;</comment>
                            <comment id="17655640" author="dsmiley" created="Sat, 7 Jan 2023 04:49:48 +0000"  >&lt;p&gt;What are the gaps with app-per-ConfigSet?&lt;/p&gt;</comment>
                            <comment id="17656156" author="gerlowskija" created="Mon, 9 Jan 2023 15:34:34 +0000"  >&lt;blockquote&gt;&lt;p&gt;The problem is, as there is a known perf degradation , nobody can do any test of perf on any commits.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;As I said - if Ishan still holds his veto, I will roll back the changes whether I &quot;understand&quot; or not, because that&apos;s the timeline that was agreed to.&lt;/p&gt;

&lt;p&gt;But I have to admit that I&apos;ve never really understood this point about the JAX-RS integration making it somehow impossible to measure performance on branch_9x, and I would really like to.&lt;/p&gt;

&lt;p&gt;Performance measurement is inherently a relative exercise: take a baseline measurement, make a change, measure again, and compute the delta.  If the JAX-RS integration has introduced some slowdown - well that&apos;s accounted for in the baseline, so the measured &quot;delta&quot; is still meaningful. And if you&apos;re worried that the JAX-RS integration might obscure some other performance-impacting change - there&apos;s a feature flag to disable it in your perf testing.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;What are the gaps with app-per-ConfigSet?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think the gaps depend on what design/scope we want to shoot for.  For cores using the same configset: do we only want to share Jersey apps?  What about v2 ApiBags and v1 requestHandlers?  What about other solrconfig.xml-configured plugins?  If we want cores to share a set of requestHandlers, how would metrics be handled since those currently live at the requestHandler level? etc.&lt;/p&gt;

&lt;p&gt;I&apos;m going to start in on a more involved spike that attempts to share Jersey apps, ApiBags, and requestHandlers with the goal of flushing out any hangups/blockers and figuring out how metrics will need to be handled.  So hopefully that&apos;ll help inform some of those questions above. But the answers probably need to come from community-need too.  (e.g. Maybe some multi-tenant usecases don&apos;t want to share rH&apos;s across cores. etc.). I&apos;ll file a ticket for this effort today so we have a dedicated place for app-per-configset discussion. &lt;b&gt;EDIT&lt;/b&gt;: see &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16615&quot; title=&quot;Colocated cores with the same configset should share resources&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16615&quot;&gt;SOLR-16615&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17656172" author="epugh" created="Mon, 9 Jan 2023 16:00:54 +0000"  >&lt;p&gt;With a minimal app-per-configset setup, would that address the performance concerns that have been brought up?   Could we move forward with this effort if the impact of using Jersey turns out to be closer to the .24% versus the 28% before?   There is a lot of good to come in terms of improving Solr through eliminating a lot of other tech debt that we can move forward on once we get through this.&lt;/p&gt;</comment>
                            <comment id="17656185" author="ichattopadhyaya" created="Mon, 9 Jan 2023 16:33:49 +0000"  >&lt;blockquote&gt;&lt;p&gt;The branch here rewinds to the introduction of JAX-RS on main (8efed0) and adds a single commit (8d6052) that partially alleviates the perf regression. (If you&apos;d prefer something based on the latest main or branch_9x etc, that single commit should be pretty cherry-pick-able, or I&apos;d be happy to make a branch with a different base if you lmk.)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sorry, couldn&apos;t get a chance to run this yet. I&apos;ll try to do so by Tuesday EOD.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;m not sure what to chalk it up to beyond hardware. But my test machine is pretty beefy; it seems like it should be able to handle things, but who knows? I&apos;m using a Mac Pro with a 14-core &quot;Intel Xeon&quot; processor, 128gb of RAM, and a SSD for disk. What have you been using for your testing?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m using a Intel i7 7980XE 18 core (36 threads) machine with about 62GB ram, with NVME SSD.&lt;/p&gt;</comment>
                            <comment id="17656186" author="ichattopadhyaya" created="Mon, 9 Jan 2023 16:36:34 +0000"  >&lt;p&gt;From the comments above and based on concerns from Noble, my suggestion is that we revert all the changes now and start afresh once we&apos;ve discussed every tradeoff and aspect of the new approach (resteasy or per configset app or any other approach) in detail (possibly via SIP). It is a distinct possibility that there are regressions that have crept in recently, but no benchmarking is meaningful on that branch for the kinds of tests we&apos;re currently doing because of the JAX RS degradation.&lt;/p&gt;</comment>
                            <comment id="17656187" author="ichattopadhyaya" created="Mon, 9 Jan 2023 16:38:01 +0000"  >&lt;blockquote&gt;&lt;p&gt;it&apos;d make sense to extend the deadline a bit further, especially if the &quot;per-configset&quot; approach is do-able for 9.2&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;What is the hurry to have JAX RS by 9.2 (at any cost)?&lt;/p&gt;</comment>
                            <comment id="17656204" author="houston" created="Mon, 9 Jan 2023 17:12:37 +0000"  >&lt;blockquote&gt;&lt;p&gt;What is the hurry to have JAX RS by 9.2 (at any cost)?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I don&apos;t think it&apos;s a hurry, rather that it is a lot of work to revert, then keep everything in sync with the branches while the discussion happens so that it can eventually be re-committed. It is much less work to do this fix without reverting.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;From the comments above and based on concerns from Noble, my suggestion is that we revert all the changes now and start afresh once we&apos;ve discussed every tradeoff and aspect of the new approach (resteasy or per configset app or any other approach) in detail (possibly via SIP).&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I do want to say resteasy &amp;amp; per-configset are not mutually exclusive. So we don&apos;t necessarily need to make a &quot;choice&quot; here. We can implement per-configset now and fix the performance regression (actually make performance a whole lot faster as a whole), then consider resteasy separately.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;It is a distinct possibility that there are regressions that have crept in recently, but no benchmarking is meaningful on that branch for the kinds of tests we&apos;re currently doing because of the JAX RS degradation.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Can&apos;t this be tested by benchmarking with the JAX-RS feature flag disabled?&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;With a minimal app-per-configset setup, would that address the performance concerns that have been brought up?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This is a good question. Can we get a good performance out of just doing the app-per-configset? We can work on the rest separately, it doesn&apos;t need to be done all at once.&lt;/p&gt;</comment>
                            <comment id="17656252" author="noble.paul" created="Mon, 9 Jan 2023 19:15:01 +0000"  >&lt;blockquote&gt;&lt;p&gt;I don&apos;t think it&apos;s a hurry, rather that it is a lot of work to revert, then keep everything in sync with the branches while the discussion happens so that it can eventually be re-committed. It is much less work to do this fix without reverting.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This is an extremely bad development practice we should never follow. If there is a regression, just revert immediately, fix it and reintroduce the changes. We don&apos;t avoid housekeeping because &quot;it&apos;s difficult&quot;. We make it harder to revert tomorrow by not doing it today.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;Can&apos;t this be tested by benchmarking with the JAX-RS feature flag disabled? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The short answer is NO&lt;/p&gt;

&lt;p&gt;We don&apos;t need to keep useless code around and make life difficult for everyone else. No extra flag should be required to testing&lt;/p&gt;</comment>
                            <comment id="17656277" author="dsmiley" created="Mon, 9 Jan 2023 20:23:25 +0000"  >&lt;p&gt;The concern here is only for core level handlers; right?  Couldn&apos;t we revert this aspect but keep container level handlers?&lt;/p&gt;</comment>
                            <comment id="17656432" author="ichattopadhyaya" created="Tue, 10 Jan 2023 05:54:42 +0000"  >&lt;p&gt;I still believe revert and redo properly is the right way to go. My veto stands and a revert now (on all branches) is the best for the project, esp for those users that have large Solr clusters with lots of collections.&lt;/p&gt;</comment>
                            <comment id="17656992" author="gerlowskija" created="Tue, 10 Jan 2023 22:08:55 +0000"  >&lt;p&gt;Hey all!&lt;/p&gt;

&lt;p&gt;I&apos;m sorry it took so long - I know we&apos;re getting close to the &quot;11th hour&quot; on the date we set awhile back - but I finally have what I think is a &lt;a href=&quot;https://github.com/apache/solr/pull/1286&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;really promising PR&lt;/a&gt; to fix the startup perf regression here.  It takes the app-per-configset approach that we&apos;ve discussed previously, and succeeds in dramatically cutting the number of Jersey &apos;ApplicationHandler&apos;s needed in most scenarios.  It&apos;s not ready to commit just yet, but it should be a matter of &quot;days&quot; at this point and not &quot;weeks&quot;.&lt;/p&gt;

&lt;p&gt;Running the &lt;a href=&quot;https://github.com/gerlowskija/solr/blob/benchmark_attempt/solr/benchmark/src/java/org/apache/solr/bench/index/SolrStartup.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;SolrStartup JMH benchmark&lt;/a&gt; I wrote a few weeks back looks good; I&apos;m going to kick off a solr-bench run overnight and hopefully get some results.  (Still fighting the weird collection-creation errors in the setup step when I run solr-bench on my machine.) &lt;/p&gt;</comment>
                            <comment id="17657004" author="ishan" created="Tue, 10 Jan 2023 23:00:29 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m sorry it took so long&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Please don&apos;t be sorry; you&apos;re the one burning the midnight oil, all throughout the Christmas and New Year holidays, and doing a great job. We are all proud of what you&apos;ve done with the APIs, and what is to come.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I know we&apos;re getting close to the &quot;11th hour&quot; on the date we set awhile back - but I finally have what I think is a really promising PR to fix the startup perf&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t think we need any &quot;11th hour&quot; pressure to do anything. The best path forward is to revert the current changes, we go back to a clean baseline where performance benchmarking is unblocked (and we have a simple, sane and sensible baseline), and then re-introduce your &quot;promising PR&quot; a few days later. Please keep in mind, the veto was on process grounds, not on the merit of any of the implementations/solutions. We should set the right precedent for handling performance regressions going forward.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;It&apos;s not ready to commit just yet, but it should be a matter of &quot;days&quot; at this point and not &quot;weeks&quot;.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;How about we do this?&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;we revert all traces of JAX RS from main, branch_9x&lt;/li&gt;
	&lt;li&gt;get a performance baseline for us to identify impact of all other changes in last 4 months&lt;/li&gt;
	&lt;li&gt;all of us work together to make sure the per-configset-app solution works, introduce it back in one PR merge.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;That will give you breathing room to wrap everything up properly, and more scope for review (at leisure, as opposed to in a rush against the 11th hour). It will unblock us from perf testing other commits. It will set the right precedent going forward.&lt;/p&gt;

&lt;p&gt;If you&apos;re currently busy with the per-configset-app approach, I can take a stab at reverting the changes cleanly. I&apos;ve removed worse toxins from the codebase than this (CDCR, Autoscaling etc.), so I can volunteer as the janitor.&lt;/p&gt;</comment>
                            <comment id="17657007" author="noble.paul" created="Tue, 10 Jan 2023 23:13:37 +0000"  >&lt;p&gt;I think we are pretty close to a working solution and I&apos;m extremely confident that we will be able to make this to 9.2. Also, I agree with Ishan that the path forward is to revert everything from branch_9x and get the branch into a clean state and commit all the changes in one go (along with the per configset jersey app). &lt;/p&gt;

&lt;p&gt;This will give all of us enough time to review and iterate this solution properly. I can volunteer to do any help required (review, perf test, revert and create the necessary branches)&lt;/p&gt;

&lt;p&gt;As Ishan mentioned, there is no need take any unnecessary stress. We just need to set the right precedent on the process we need to follow when there is a regression. We are not working against each other, we are in this together.&lt;/p&gt;

&lt;p&gt;thanks again to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gerlowskija&quot; class=&quot;user-hover&quot; rel=&quot;gerlowskija&quot;&gt;gerlowskija&lt;/a&gt; for coming up with a solution for the perf regression during the holidays (and weekends). &lt;/p&gt;</comment>
                            <comment id="17675615" author="houston" created="Wed, 11 Jan 2023 15:05:36 +0000"  >&lt;blockquote&gt;&lt;p&gt;This is an extremely bad development practice we should never follow. If there is a regression, just revert immediately, fix it and reintroduce the changes. We don&apos;t avoid housekeeping because &quot;it&apos;s difficult&quot;. We make it harder to revert tomorrow by not doing it today.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This is not a bad development practice, it is pragmatic. We have had quite a lot of large &quot;development branches&quot; with awesome features get so out-of-sync over time that there was no way to merge them back in later. This ticket has a very large scope and its something the project has decided to prioritize. Since it is such a big initiative, its not surprising that it has been a bit messy along the way. I do not agree that the way to go is keep it on a development branch, making Jason keep it up to date for months until its reached the &quot;threshold&quot; for acceptability.&lt;/p&gt;

&lt;p&gt;Should this be the way every ticket is developed? No, but this is not every ticket.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;I think we are pretty close to a working solution and I&apos;m extremely confident that we will be able to make this to 9.2&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;If this is the case, then there is no reason to revert the code. It is an unreasonable expectation. The goal here was to make performance with JAXRS and without JAXRS similar. Jason went above and beyond to make this happen, even though to many people JAX-RS features outweighed the performance hit.&lt;/p&gt;

&lt;p&gt;I understand that y&apos;all want to know the performance of Solr without this feature, but there is nothing stopping you from reverting it on your own branch and running the performance tests there.&#160;&lt;/p&gt;

&lt;p&gt;As it stands, Jason has taken the steps that you have asked. There is no longer any reason behind your veto. We can move forward with Jason&apos;s new PR and put this all behind us.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;I&apos;ve removed worse toxins from the codebase than this (CDCR, Autoscaling etc.), so I can volunteer as the janitor.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This is not an acceptable way to talk about an agreed upon approach that took a contributor months to accomplish. It is all of our jobs to foster a healthy and supportive environment in the project and I ask to you to take that job more seriously.&lt;/p&gt;</comment>
                            <comment id="17675670" author="ichattopadhyaya" created="Wed, 11 Jan 2023 18:20:10 +0000"  >&lt;blockquote&gt;&lt;p&gt;We have had quite a lot of large &quot;development branches&quot; with awesome features get so out-of-sync over time that there was no way to merge them back in later.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;What you are arguing in favour of is a very bizzare practice: do incremental/iterative development of major features (that are potentially disruptive to the health of the project, if not done carefully) on stable branch. We moved to git, and development on feature branches is one of the most common practices followed world wide. I don&apos;t understand the rush and hurry to keep half baked commits in stable branch, and cause disruption to others who care about performance. I know that we have done this in the past, putting half baked commits disrupting tests etc. But, that doesn&apos;t mean it is not a &quot;bad development practice&quot;. In fact, I was enlightened about the merits of working on development branches inspired by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hossman&quot; class=&quot;user-hover&quot; rel=&quot;hossman&quot;&gt;hossman&lt;/a&gt;, when we worked together on &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5944&quot; title=&quot;Support updates of numeric DocValues&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5944&quot;&gt;&lt;del&gt;SOLR-5944&lt;/del&gt;&lt;/a&gt;. It took a long time to get right on a development branch, but it was solid once it was brought in master/branch_9x. Due diligence of perf testing, unit/integration/stress testing etc. was done on the branch first, and merged finally.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I do not agree that the way to go is keep it on a development branch, making Jason keep it up to date for months until its reached the &quot;threshold&quot; for acceptability.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I fail to understand the logic behind this. If many people are collaborating now on main / branch_9x now, why would they not collaborate on a development branch? No one is making Jason do anything, all of us can collectively contribute on the development branch. Regarding &quot;until its reached the &quot;threshold&quot; for acceptability&quot; , a massive performance degradation like this warrants the agreement that threshold was breached. What is wrong with working on a development branch until the threshold is no longer breached?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The goal here was to make performance with JAXRS and without JAXRS similar.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Without reverting the current code and getting a baseline measurement, how do you plan to measure that? Lets say performance benchmark (on some test) was X1 at the time of JAX RS integration, and after the fixes, the new performance benchmark is X2, can you attribute the difference | X1 - X2 | to the overall JAX RS integration alone, when you know there are hundreds of other commits that have happened in the past 4 months?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;There is no longer any reason behind your veto&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;When the veto was invoked, the ASF guidelines around immediate reverting was ignored. Even after the 1 month deadline, performance degradation is still there (which was the &quot;reason behind &lt;span class=&quot;error&quot;&gt;&amp;#91;my&amp;#93;&lt;/span&gt; veto&quot;). Please keep in mind that I&apos;ve prioritized my work schedule around this deadline such that I&apos;m able to start vetting other major commits that have been introduced in last 4 months. There should&apos;ve been no reason to keep me waiting, because we could&apos;ve easily reverted this when there was a veto, and everything could&apos;ve been brought back once fixed.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;We can move forward with Jason&apos;s new PR and put this all behind us.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Sure, we can. If you insist that we must, I&apos;ll go your way. Then, why even bother about keeping ourselves honest about anything to do with performance benchmarking, if that&apos;s what everyone wants here. A very respected member of our community once mentioned to me in private, &quot;If we hold performance above all else, many of us would feel a sense of &apos;don&#8217;t change it if it isn&#8217;t broken&apos; and then the project is on its death-bead IMO &#8212; fear of changing something and getting criticized&quot;. IOW, keeping ourselves accountable performance benchmarks wise might make Solr a dead project.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;This is not an acceptable way to talk about an agreed upon approach that took a contributor months to accomplish. It is all of our jobs to foster a healthy and supportive environment in the project and I ask to you to take that job more seriously.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Please point to whatever you feel is unacceptable. Any piece of code that is damaging the health of the project is a toxin that must be removed. Removing such code is the way to &quot;foster a healthy and supportive environment&quot;, which is something I&apos;m going to take seriously. As you know, presence of CDCR and Autoscaling were detrimental to our project in various ways. Presence of a JAX RS integration that slows down node startup by 30% is also detrimental. Please keep in mind, any users that want to maintain a large Solr cluster and not working in a trillion dollar company would be cost conscious regarding their operations, and performance degradations of any kind would be bad for them.&lt;/p&gt;</comment>
                            <comment id="17675677" author="ichattopadhyaya" created="Wed, 11 Jan 2023 18:39:06 +0000"  >&lt;blockquote&gt;&lt;p&gt;How about we do this?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;...&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If you&apos;re currently busy with the per-configset-app approach, I can take a stab at reverting the changes cleanly. I&apos;ve removed worse toxins from the codebase than this (CDCR, Autoscaling etc.), so I can volunteer as the janitor.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Anyway, I&apos;ll await Jason&apos;s word on what he thinks about my proposal. If he thinks me trying to revert (lets say in a separate PR) is something he&apos;s vehemently opposed to, then I&apos;ll leave it as it is. In any case, I&apos;m looking forward to the improvements with the per-configset-app approach.&lt;/p&gt;</comment>
                            <comment id="17675713" author="anshumg" created="Wed, 11 Jan 2023 20:35:30 +0000"  >&lt;p&gt;Let&apos;s try and make progress here.&lt;/p&gt;

&lt;p&gt;Considering this was a proposal and approach that was discussed for a reasonable amount of time, and received a lot of interest from users/contributors makes this something that is highly desirable, both in terms of the feature as well as the implementation. I think we are all on the same page here w.r.t. the feature here. As for the implementation, there are concerns around increased start-up times, and while that shouldn&apos;t be ignored, the amount of time a node spends restarting vs it&apos;s total life-time, is negligible. ~25% of that negligible time shouldn&apos;t be a blocker for us to make progress here. To be clear, we should continue to improve this however I don&apos;t see it as a blocker.&lt;/p&gt;

&lt;p&gt;The reason why I&apos;m suggesting we move forward instead of reverting this are:&lt;br/&gt;
1. This comes with a feature flag. Users who want to use the new APIs for testing, planning, contributing, etc. would be able to do so without having to download and build off a different branch that may be out of sync. Folks who don&apos;t want to consume this new feature can keep this disabled without slowing down the progress.&lt;br/&gt;
2. While feature branches are great, there&apos;s a point where it&apos;s essential to merge the code into the main development and release branch. This allows for folks to concentrate on building and improving rather than sync&apos;ing stuff. Divergence in such a situation makes it really difficult and less desirable for contributors. We must keep in mind that this is also not one of those features that people ask for, but eventually and hopefully love when they get it. Merging the code simplifies the process and reduces the effort required for folks to contribute.&lt;/p&gt;

&lt;p&gt;I completely agree with Houston&apos;s statement about not referring to other contributions as &apos;toxins&apos;. Sure, they may not have worked as intended, they may be dated, or whatever else the reason be but they were an effort by contributors who volunteer for this project. The contributions (I assume) were made in good faith and with the intention to make things better for our users. We may choose to deprecate and remove things that don&apos;t make sense any more but the language chosen should be thought about. We&apos;ve done a reasonable job in my opinion to clean up the project w.r.t. offensive language and should also stick to a similar standard when communicating with other folks and referring to other contributions. I don&apos;t think you intended for folks to feel that way, but let&apos;s all be mindful of what we say.&lt;/p&gt;</comment>
                            <comment id="17675736" author="gerlowskija" created="Wed, 11 Jan 2023 22:20:10 +0000"  >&lt;p&gt;(Writing this right in a bit of a rush, hope to add/clarify later this evening.)&lt;/p&gt;

&lt;p&gt;The Jan 11th deadline (as I understood it at least) was to come up with a solution that could help us avoid a revert, and only revert if we didn&apos;t have that in time.  But at this point it looks like we do have that solution.  So I&apos;d say: let&apos;s vet this thing.  If it fixes the performance, great.  If it doesn&apos;t, well then we&apos;ll know the solution wasn&apos;t enough and we can revisit the revert at that point based on what the remaining delta is.  That seems most in the spirit of the original agreement and should get everything resolved (and everyone unblocked!) quickly.&lt;/p&gt;

&lt;p&gt;In terms of vetting: I&apos;ll writeup some instructions or a script to run a little solr-bench comparison, so that other people can provide data points and to standardize our testing.  (Maybe this&apos;ll spark some solr-bench interest and improvements!)  Of course, &lt;a href=&quot;https://github.com/apache/solr/pull/1286&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR&lt;/a&gt; code review also needed.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;ve prioritized my work schedule around this deadline such that I&apos;m able to start vetting other major commits &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I hate that this has blocked other perf work that you&apos;ve had in mind.  If you can expand a little bit on the nature of that &quot;block&quot;, and why something like the v2 feature flag doesn&apos;t help, maybe it&apos;s something we could work through together?&lt;/p&gt;</comment>
                            <comment id="17675751" author="ichattopadhyaya" created="Thu, 12 Jan 2023 00:00:46 +0000"  >&lt;blockquote&gt;&lt;p&gt;why something like the v2 feature flag doesn&apos;t help, maybe it&apos;s something we could work through together?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;A generic performance benchmarking framework shouldn&apos;t be expected to keep applying hacks after hacks in order to bypass regressions that the authors refuse to remove (for the sake of their convenience). If every commit which introduces slowdown was to be kept around on the &quot;stable&quot; branch (stacked on top of each other), then the benchmarking framework would need to keep bypassing all of them individually and it would be a nightmare to maintain such testing. All of this hackery feels similar to our strategy of having failing tests around, but instead of fixing the causes of the failures, we keep applying BadApples to the tests.&lt;/p&gt;</comment>
                            <comment id="17675755" author="ichattopadhyaya" created="Thu, 12 Jan 2023 00:19:06 +0000"  >&lt;p&gt;I remove my veto. It has already served its purpose (of forcing us into a solution to the performance problem that was identified).&lt;/p&gt;

&lt;p&gt;In general, the bizzare defiance against following best practices amazes me. Adopting a bad development methodology, fighting against ASF safeguards (veto) etc. is very strange. If we revert now, come back few days later and put back the same feature with performance fixed, nothing is lost. But, seems like you all view the &quot;revert&quot; as some kind of defeat or concession, instead of seeing it as a healthy development practice.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I completely agree with Houston&apos;s statement about not referring to other contributions as &apos;toxins&apos;. Sure, they may not have worked as intended, they may be dated, or whatever else the reason be but they were an effort by contributors who volunteer for this project. The contributions (I assume) were made in good faith and with the intention to make things better for our users. We may choose to deprecate and remove things that don&apos;t make sense any more but the language chosen should be thought about. We&apos;ve done a reasonable job in my opinion to clean up the project w.r.t. offensive language and should also stick to a similar standard when communicating with other folks and referring to other contributions. I don&apos;t think you intended for folks to feel that way, but let&apos;s all be mindful of what we say.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Any code change that causes a negative effect to the project is a toxin that should be removed. It has nothing to do with feelings or intentions or motivations. I can offer an apple to someone with best intentions, but if the recipient develops an allergic reaction to it and dies, then it works like a toxin for him/her. It doesn&apos;t mean I was wrong in offering it, nor does it mean the autopsy should not call the apple as toxic. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17675757" author="ichattopadhyaya" created="Thu, 12 Jan 2023 00:37:26 +0000"  >&lt;blockquote&gt;&lt;p&gt;the amount of time a node spends restarting vs it&apos;s total life-time, is negligible. ~25% of that negligible time shouldn&apos;t be a blocker for us to make progress here. To be clear, we should continue to improve this however I don&apos;t see it as a blocker.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Just to be clear, I&apos;m withrawing my veto so that immediate revert isn&apos;t necessary. However, this continues to be a release blocker, and arguments that a 30% startup slowdown is acceptable are deeply condemnable.&lt;/p&gt;</comment>
                            <comment id="17675826" author="markrmiller" created="Thu, 12 Jan 2023 06:19:48 +0000"  >&lt;p&gt;It looks like there is a fair bit that is pluggable here Jason - if your current path doesn&apos;t get you quite what you need, have you eliminated most of the hotspots as out of reach?&lt;/p&gt;

&lt;p&gt;I wouldn&apos;t discount clawing back some headroom via simple stuff that&apos;s not likely to show up as a hotspot either - eg little things like not taking default collection initial sizes when you are guaranteed to require rehashes. You can&apos;t likely just ignore the hotspots you&apos;ve identified, but if the slowdown is not outrageous, we might be able to make a decent dent via cumulative unrelated speed-ups.&lt;/p&gt;

&lt;p&gt;I don&apos;t want to distract you from what sounds like a nice thing to do regardless, but if you end up a little short, happy to take a look at some additional boosts. &lt;/p&gt;</comment>
                            <comment id="17675833" author="ichattopadhyaya" created="Thu, 12 Jan 2023 06:33:15 +0000"  >&lt;p&gt;Thanks for pitching in and your insights, Mark. Solr would greatly benefit from your continued help in fixing performance problems across the board.&lt;/p&gt;</comment>
                            <comment id="17675865" author="janhoy" created="Thu, 12 Jan 2023 08:26:30 +0000"  >&lt;p&gt;I&apos;d like to express my gratitude for Jason&apos;s leadership on the JAX-RS refactoring. Super cool progress for the project. Next I also value Ishan&amp;amp;Noble&apos;s renewed focus on perf. testing; this is not a day too early, and looking forward to see some nightly benchmarks we can all pay attention to. In particular benchmark graphs for the most important metrics like querying, indexing, faceting, highlighting, parent/child queries, grouping, atomic updates and more, so we can catch regressions.&lt;/p&gt;

&lt;p&gt;Having said that, I choose to interpret Ishan&amp;amp;Noble&apos;s position and words on this topic with your FullStory hat on, not the committer hat. It is understandable that you care about the corner cases experienced at your day job. But with my PMC hat on, blocking this progress due to &quot;startup performance w/1000 collections per node&quot; is a wrong project prioritization. So I&apos;m glad you pulled your veto.&lt;/p&gt;

&lt;p&gt;I&apos;m in support of Jason, Houston and Anshum&apos;s take on this. The project needs to weigh various concerns, which means we&apos;ll often prioritize the benefit for 90% of the users. Sometimes that may mean a few iterations on a feature before it is fully up to speed across the board. Community over code.&lt;/p&gt;</comment>
                            <comment id="17676423" author="noble.paul" created="Fri, 13 Jan 2023 03:43:30 +0000"  >&lt;blockquote&gt;&lt;p&gt;But with my PMC hat on, blocking this progress due to &quot;startup performance w/1000 collections per node&quot; is a wrong project prioritization...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m grateful to the Lucene PMC for not wearing the same hat as Solr&lt;/p&gt;

&lt;p&gt;If you think the problem is with 1000 cores/code, probably you didn&apos;t go through the entire &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16347?focusedCommentId=17642700&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-17642700&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;thread&lt;/a&gt;.   &lt;/p&gt;

&lt;p&gt;Anyway, I do not have time or energy to repeat my points &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;m in support of Jason...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m in support too.. just that you choose to see it as a fight between 2 committers. &lt;/p&gt;</comment>
                            <comment id="17676586" author="markrmiller" created="Fri, 13 Jan 2023 11:13:06 +0000"  >&lt;blockquote&gt;&lt;p&gt;Curious if any of this rings a bell for anyone more familiar with running this suite, maybe Ishan can chime in.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If it&apos;s what id guess, I&apos;ve run some variation of it a few thousand times give or take. In which case it can be setup to be a long, heavy benchmark with a moving target that is both under test and part of the control / status plane that controls the benchmark. And it&apos;s meant to simulate a largish cluster with a challenging load. All on a single machine. In my experience, that means it wouldn&apos;t be surprising if on any given month, I could run it 5 times and see success and you could run it five times on twice the machine and have trouble on four of the runs. The reason could range from minor to not minor, from Solr to something that the driver should likely be more flexible about. You could tell me something doesn&apos;t seem right, I could run it 5 more times and not see it on my machine. Its somewhat the nature of that kind of test on this kind of system. Its a surmountable problem, maybe sometimes it&apos;s not even really a problem, it would be hard on average to really say given what it would take to say it and say it again next week and two weeks later and say it for you and me and someone else. For you to just jump in and likely get a warm experience you would likely need something at this level to look like the LuceneUtil benchmark that&apos;s auto run regularly, monitored by a variety of devs and responded to and used independently by devs working on new things. Outside that, some experience with it is basically required so that you have a feel for what to expect, what is likely not related to you or your work, and what you might do to get something productive in front of you. &lt;/p&gt;

&lt;p&gt;So yeah, I&apos;ll try and take a look at running it so you can have a reasonable and comparable data point, or so you can just avoid getting pulled into unrelated hassle and mystery if you&apos;d rather not unravel those current mysterious you mention. &lt;/p&gt;</comment>
                            <comment id="17676724" author="ichattopadhyaya" created="Fri, 13 Jan 2023 18:22:07 +0000"  >&lt;blockquote&gt;&lt;p&gt;Having said that, I choose to interpret Ishan&amp;amp;Noble&apos;s position and words on this topic with your FullStory hat on, not the committer hat. It is understandable that you care about the corner cases experienced at your day job. But with my PMC hat on, blocking this progress due to &quot;startup performance w/1000 collections per node&quot; is a wrong project prioritization.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Love you too, Jan &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; You are too sweet a person for me to get angry with you, no matter how hard you try.&lt;/p&gt;</comment>
                            <comment id="17680665" author="ichattopadhyaya" created="Wed, 25 Jan 2023 16:09:47 +0000"  >&lt;p&gt;Thanks for your work on &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16615&quot; title=&quot;Colocated cores with the same configset should share resources&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16615&quot;&gt;SOLR-16615&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gerlowskija&quot; class=&quot;user-hover&quot; rel=&quot;gerlowskija&quot;&gt;gerlowskija&lt;/a&gt;. I hope to resume the benchmarking on those restart suites soon. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
&lt;a href=&quot;https://youtu.be/pCSTFJiZefI&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://youtu.be/pCSTFJiZefI&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17684752" author="jira-bot" created="Mon, 6 Feb 2023 15:25:31 +0000"  >&lt;p&gt;Commit e446de3b86956e7508d92c98180cc8fa29becaa4 in solr&apos;s branch refs/heads/main from Jason Gerlowski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=e446de3b869&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=e446de3b869&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16531&quot; title=&quot;Performance degradation due to introduction of JAX-RS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16531&quot;&gt;&lt;del&gt;SOLR-16531&lt;/del&gt;&lt;/a&gt;: Disable unused Jersey features (#1335)&lt;/p&gt;

&lt;p&gt;These features incur a small cost at application startup time, so&lt;br/&gt;
disabling them helps keep our use of Jersey lean.&lt;/p&gt;</comment>
                            <comment id="17684781" author="jira-bot" created="Mon, 6 Feb 2023 15:58:36 +0000"  >&lt;p&gt;Commit 373f68f7ce23651c6ccd588f637323e67a61eaaa in solr&apos;s branch refs/heads/branch_9x from Jason Gerlowski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=373f68f7ce2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=373f68f7ce2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16531&quot; title=&quot;Performance degradation due to introduction of JAX-RS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16531&quot;&gt;&lt;del&gt;SOLR-16531&lt;/del&gt;&lt;/a&gt;: Disable unused Jersey features (#1335)&lt;/p&gt;

&lt;p&gt;These features incur a small cost at application startup time, so&lt;br/&gt;
disabling them helps keep our use of Jersey lean.&lt;/p&gt;</comment>
                            <comment id="17686017" author="ichattopadhyaya" created="Wed, 8 Feb 2023 18:05:14 +0000"  >&lt;p&gt; &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13055263/13055263_Screenshot+from+2023-02-08+23-31-18.png&quot; width=&quot;700&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/p&gt;

&lt;p&gt;From what I can see, after the recent fixes by Jason, performance is back to even better than what it was (when JAX RS was introduced). Not just restart times are better, but even collection creation times seem better.&lt;/p&gt;

&lt;p&gt;That means in the intervening ~4 months (from 21 October to last week), there could be some changes that made things better substantially. Unfortunately, because the JAX RS integration was not reverted when the performance degradation was first reported, it is difficult to exactly pin-point as to which commit(s) made the performance better now. Does anyone have a clue/guesses?&lt;/p&gt;</comment>
                            <comment id="17686020" author="ichattopadhyaya" created="Wed, 8 Feb 2023 18:07:50 +0000"  >&lt;p&gt;Thanks a lot to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gerlowskija&quot; class=&quot;user-hover&quot; rel=&quot;gerlowskija&quot;&gt;gerlowskija&lt;/a&gt; for his work on fixing the performance degradation.&lt;/p&gt;</comment>
                            <comment id="17686031" author="houston" created="Wed, 8 Feb 2023 18:19:05 +0000"  >&lt;p&gt;So from what I can see, the big performance gain didn&apos;t come from the per-config-set commit, it came from the &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16531&quot; title=&quot;Performance degradation due to introduction of JAX-RS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16531&quot;&gt;&lt;del&gt;SOLR-16531&lt;/del&gt;&lt;/a&gt;: Disable unused Jersey features&quot; commit. (The per-config-set commit happened before feb and the speedup came in early feb)&lt;/p&gt;

&lt;p&gt;Is there an interactive thing that says the commits where each of these results come from? I remember one of you previous links had that.&lt;/p&gt;</comment>
                            <comment id="17686051" author="ichattopadhyaya" created="Wed, 8 Feb 2023 18:43:31 +0000"  >&lt;blockquote&gt;&lt;p&gt;Is there an interactive thing that says the commits where each of these results come from? I remember one of you previous links had that.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes, here&apos;s the WIP one &lt;a href=&quot;http://mostly.cool&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://mostly.cool&lt;/a&gt; (branch_9x). To zoom into a particular region in the graph, click the drag horizontally should work (right click to zoom out). Also, clicking on the lines on the legend hide/show the lines on the graph.&lt;/p&gt;</comment>
                            <comment id="17686057" author="gerlowskija" created="Wed, 8 Feb 2023 19:06:30 +0000"  >&lt;p&gt;Hey, great news!&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;it is difficult to exactly pin-point as to which commit(s) made the performance better now. Does anyone have a clue/guesses?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Nothing in &lt;tt&gt;CHANGES.txt&lt;/tt&gt; jumps out as likely to directly impact startup time.  But who knows.  It could&apos;ve been an upgrade for one of the more important deps, like the bump to Jetty 10 that happened in November (&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15955&quot; title=&quot;Update Jetty dependency to 10&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15955&quot;&gt;&lt;del&gt;SOLR-15955&lt;/del&gt;&lt;/a&gt;) maybe?&lt;/p&gt;</comment>
                            <comment id="17686073" author="houston" created="Wed, 8 Feb 2023 19:15:40 +0000"  >&lt;p&gt;Thanks for the link, it looks like the 2 big winners before the per-config-set commit giant improvement (I was wrong before, the months in the graph were different) were:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15616&quot; title=&quot;Allow thread metrics to be cached&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15616&quot;&gt;&lt;del&gt;SOLR-15616&lt;/del&gt;&lt;/a&gt;: Allow thread metrics to be cached&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16593&quot; title=&quot;Redundant fields are present in the replica object of state.json&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16593&quot;&gt;&lt;del&gt;SOLR-16593&lt;/del&gt;&lt;/a&gt;: Redundant fields are present in the replica object of state.json&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;There&apos;s quite a bit of noise (as there would be without the jersey stuff), but those two look like the best matches for commit time and performance implication.&#160;&lt;/p&gt;</comment>
                            <comment id="17705611" author="houston" created="Mon, 27 Mar 2023 18:04:25 +0000"  >&lt;p&gt;Closing after the 9.2.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="13477645">SOLR-16347</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13517273">SOLR-16615</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13051978" name="Screenshot from 2022-11-09 11-20-44.png" size="128577" author="ichattopadhyaya" created="Wed, 9 Nov 2022 06:01:34 +0000"/>
                            <attachment id="13055263" name="Screenshot from 2023-02-08 23-31-18.png" size="90758" author="ichattopadhyaya" created="Wed, 8 Feb 2023 18:02:14 +0000"/>
                            <attachment id="13054413" name="jaxrs-integration-with-app-per-configset-flamegraph.html" size="4074126" author="gerlowskija" created="Fri, 6 Jan 2023 20:41:45 +0000"/>
                            <attachment id="13052006" name="results-with-patch.tar.gz" size="1852429" author="ichattopadhyaya" created="Wed, 9 Nov 2022 17:55:19 +0000"/>
                            <attachment id="13054412" name="vanilla-jaxrs-integration-flamegraph.html" size="7297527" author="gerlowskija" created="Fri, 6 Jan 2023 20:41:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 33 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1bth4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>