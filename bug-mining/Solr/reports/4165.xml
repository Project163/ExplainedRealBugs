<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:37:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-11959] CDCR unauthorized to replicate to a target collection that is update protected in security.json</title>
                <link>https://issues.apache.org/jira/browse/SOLR-11959</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Steps to reproduce:&#160;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Create a source and a target collection in their respective clusters.&#160;&lt;/li&gt;
	&lt;li&gt;Update security.json to require a non-admin role to read and write.&#160;&lt;/li&gt;
	&lt;li&gt;Index to source collection&#160;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Expected:&#160;&lt;/p&gt;

&lt;p&gt;The target collection should receive the update&lt;/p&gt;

&lt;p&gt;Actual:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.solr.client.solrj.impl.HttpSolrClient$RemoteSolrException: Error from server at http:&lt;span class=&quot;code-comment&quot;&gt;//redacted/solr/redacted: Expected mime type application/octet-stream but got text/html. &amp;lt;html&amp;gt;
&lt;/span&gt; &amp;lt;head&amp;gt;
 &amp;lt;meta http-equiv=&lt;span class=&quot;code-quote&quot;&gt;&quot;Content-Type&quot;&lt;/span&gt; content=&lt;span class=&quot;code-quote&quot;&gt;&quot;text/html;charset=utf-8&quot;&lt;/span&gt;/&amp;gt;
 &amp;lt;title&amp;gt;Error 401 Unauthorized request, Response code: 401&amp;lt;/title&amp;gt;
 &amp;lt;/head&amp;gt;
 &amp;lt;body&amp;gt;&amp;lt;h2&amp;gt;HTTP ERROR 401&amp;lt;/h2&amp;gt;
 &amp;lt;p&amp;gt;Problem accessing /solr/redacted/update. Reason:
 &amp;lt;pre&amp;gt; Unauthorized request, Response code: 401&amp;lt;/pre&amp;gt;&amp;lt;/p&amp;gt;
 &amp;lt;/body&amp;gt;
 &amp;lt;/html&amp;gt;at org.apache.solr.client.solrj.impl.HttpSolrClient.executeMethod(HttpSolrClient.java:607)
 at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:255)
 at org.apache.solr.client.solrj.impl.HttpSolrClient.request(HttpSolrClient.java:244)
 at org.apache.solr.client.solrj.impl.LBHttpSolrClient.doRequest(LBHttpSolrClient.java:483)
 at org.apache.solr.client.solrj.impl.LBHttpSolrClient.request(LBHttpSolrClient.java:413)
 at org.apache.solr.client.solrj.impl.CloudSolrClient.sendRequest(CloudSolrClient.java:1103)
 at org.apache.solr.client.solrj.impl.CloudSolrClient.requestWithRetryOnStaleState(CloudSolrClient.java:883)
 at org.apache.solr.client.solrj.impl.CloudSolrClient.request(CloudSolrClient.java:816)
 at org.apache.solr.client.solrj.SolrRequest.process(SolrRequest.java:194)
 at org.apache.solr.client.solrj.SolrRequest.process(SolrRequest.java:211)
 at org.apache.solr.handler.CdcrReplicator.sendRequest(CdcrReplicator.java:140)
 at org.apache.solr.handler.CdcrReplicator.run(CdcrReplicator.java:104)
 at org.apache.solr.handler.CdcrReplicatorScheduler.lambda$&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;$0(CdcrReplicatorScheduler.java:81)
 at org.apache.solr.common.util.ExecutorUtil$MDCAwareThreadPoolExecutor.lambda$execute$0(ExecutorUtil.java:188)
 at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
 at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
 at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13137306">SOLR-11959</key>
            <summary>CDCR unauthorized to replicate to a target collection that is update protected in security.json</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dandrews">Donny Andrews</reporter>
                        <labels>
                    </labels>
                <created>Fri, 9 Feb 2018 00:14:42 +0000</created>
                <updated>Wed, 28 Oct 2020 20:37:27 +0000</updated>
                            <resolved>Wed, 28 Oct 2020 20:37:27 +0000</resolved>
                                    <version>7.2</version>
                                                    <component>Authentication</component>
                    <component>CDCR</component>
                        <due></due>
                            <votes>6</votes>
                                    <watches>11</watches>
                                                                                                                <comments>
                            <comment id="16364672" author="sarkaramrit2@gmail.com" created="Wed, 14 Feb 2018 19:47:50 +0000"  >&lt;p&gt;I figured and faced the same issue and obviously we need to improve CDCR to support Basic Authentication and Authorization across clusters.&lt;/p&gt;

&lt;p&gt;Design model I see it happening: please checkout: &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8389&quot; title=&quot;Convert CDCR peer cluster and other configurations into collection properties modifiable via APIs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8389&quot;&gt;&lt;del&gt;SOLR-8389&lt;/del&gt;&lt;/a&gt;, we are introducing cdcr.json (cdcr configuration) in the zookeeper unlike solrconfig.xml. Is providing &lt;b&gt;username:password&lt;/b&gt; as a property value for each target configuration in cdcr.json will be safe way to do this? As we can direct to multiple clusters and multiple collections, the basic auth property will be target specific.&lt;/p&gt;

&lt;p&gt;Looking forward to feedback and recommendations, I can start with this once we agree on design.&lt;/p&gt;</comment>
                            <comment id="16371002" author="sarkaramrit2@gmail.com" created="Wed, 21 Feb 2018 06:21:18 +0000"  >&lt;p&gt;Uploaded patch will documentation changes reporting limitation of CDCR with Authentication plugins.&lt;/p&gt;</comment>
                            <comment id="16801661" author="jira-bot" created="Tue, 26 Mar 2019 13:00:48 +0000"  >&lt;p&gt;Commit 65165c7c8709ea3158b56c152bf8b3b71863a885 in lucene-solr&apos;s branch refs/heads/master from Cassandra Targett&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=65165c7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=65165c7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11959&quot; title=&quot;CDCR unauthorized to replicate to a target collection that is update protected in security.json&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11959&quot;&gt;&lt;del&gt;SOLR-11959&lt;/del&gt;&lt;/a&gt;: Add docs on CDCR limitation with Basic Auth&lt;/p&gt;</comment>
                            <comment id="16801664" author="jira-bot" created="Tue, 26 Mar 2019 13:01:17 +0000"  >&lt;p&gt;Commit 3d317ffbe2611f7ea37f73424c57dfcd1ae3a0a3 in lucene-solr&apos;s branch refs/heads/branch_8x from Cassandra Targett&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=3d317ff&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=3d317ff&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11959&quot; title=&quot;CDCR unauthorized to replicate to a target collection that is update protected in security.json&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11959&quot;&gt;&lt;del&gt;SOLR-11959&lt;/del&gt;&lt;/a&gt;: Add docs on CDCR limitation with Basic Auth&lt;/p&gt;</comment>
                            <comment id="16801665" author="jira-bot" created="Tue, 26 Mar 2019 13:01:41 +0000"  >&lt;p&gt;Commit 38e7173ea75db46f873d09e125a815162d694988 in lucene-solr&apos;s branch refs/heads/branch_8_0 from Cassandra Targett&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=38e7173&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=38e7173&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11959&quot; title=&quot;CDCR unauthorized to replicate to a target collection that is update protected in security.json&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11959&quot;&gt;&lt;del&gt;SOLR-11959&lt;/del&gt;&lt;/a&gt;: Add docs on CDCR limitation with Basic Auth&lt;/p&gt;</comment>
                            <comment id="16801666" author="ctargett" created="Tue, 26 Mar 2019 13:02:25 +0000"  >&lt;p&gt;Totally missed the doc patch on this, sorry. I applied it finally.&lt;/p&gt;</comment>
                            <comment id="16826114" author="sarkaramrit2@gmail.com" created="Thu, 25 Apr 2019 14:25:03 +0000"  >&lt;p&gt;Since &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8389&quot; title=&quot;Convert CDCR peer cluster and other configurations into collection properties modifiable via APIs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8389&quot;&gt;&lt;del&gt;SOLR-8389&lt;/del&gt;&lt;/a&gt; didn&apos;t get enough traction, I would like to complete this Jira with the existing design.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;CdcrReplicator&lt;/tt&gt; at the Source internally creates SolrClient for the target and issues UpdateRequest. We can pass details for Basic Auth in the classic manner, part of the Request Header.&lt;br/&gt;
For this to work &amp;#8211; &lt;br/&gt;
1. We can put Basic Auth &amp;#8211; username password details for the target at the source, which can result in more security issues since plain text password will be mentioned in solrconfig.xml which is exposed at multiple facets, unlike security.json.&lt;br/&gt;
2. Read security.json of the target collection at source (since source cluster has all access to all the files at target), unhash the password and pass it in the UpdateRequest. At the solrconfig.xml level at source, we need to provide the user only, whose password will be fetched. This is a better security solution than above, as reading security doc for a cluster is restricted to one module, Cdcr.&lt;/p&gt;

&lt;p&gt;Looking forward to feedback on this.&lt;/p&gt;</comment>
                            <comment id="16826146" author="janhoy" created="Thu, 25 Apr 2019 15:08:07 +0000"  >&lt;p&gt;Remember that the solution must also work with Kerberos, Hadoop, JWT and other Auth methods.&lt;/p&gt;

&lt;p&gt;So perhaps better would be to extend the PKI concept to work cross cluster. Right now PKI will only accept requests from nodes found in local ZK. I could imagine a pluggable thing here that could allow nodes from another cluster e.g. by providing zk addr(s) for external trusted clusters. This must of course also support zk ACL etc.&lt;/p&gt;</comment>
                            <comment id="16826256" author="sarkaramrit2@gmail.com" created="Thu, 25 Apr 2019 17:26:43 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=janhoy&quot; class=&quot;user-hover&quot; rel=&quot;janhoy&quot;&gt;janhoy&lt;/a&gt;, I see.&lt;br/&gt;
I will read the PKI concept in detail then, looks like the most viable solution for what we are trying to achieve here. I will try to bake a patch on the same.&lt;/p&gt;</comment>
                            <comment id="16826775" author="janhoy" created="Fri, 26 Apr 2019 08:41:28 +0000"  >&lt;p&gt;A perhaps simple starting point could be to avoid the zk magic and just find a place (security.json?) to configure list of host/node names (e.g. &lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;my-node:8983/solr&amp;quot;, &amp;quot;other-node:8983/solr&amp;quot;&amp;#93;&lt;/span&gt;&lt;/tt&gt;) that PKI should accept requests from in addition to the ones that are part of its own cluster. If you make it a plugin, we could later add e.g. &lt;tt&gt;PKIAuthZkWhitelistProvider&lt;/tt&gt;&#160;which generates the whitelist from live_nodes lists of one or more external Zookeepers?&lt;/p&gt;</comment>
                            <comment id="16829715" author="sarkaramrit2@gmail.com" created="Mon, 29 Apr 2019 21:00:56 +0000"  >&lt;p&gt;Thanks, Jan. I see the direction. &lt;/p&gt;

&lt;p&gt;Can we utilize JWTAuthPlugin (JWT basically) solely (written by you, and I was reading it to understand how auth works overall in Solr) to have secure communication cross clusters? And what&apos;s needed outside of it is just to have network access (ports open) to respective zookeeper and Solr ports (which are already part of instructions).&lt;/p&gt;

&lt;p&gt;I am not yet done with understanding the Auth module of Solr, and may suggest something doesn&apos;t make sense.&lt;/p&gt;</comment>
                            <comment id="16829770" author="janhoy" created="Mon, 29 Apr 2019 22:11:26 +0000"  >&lt;p&gt;PKI is special since it is always activated and Solr is always able to use PKI cross nodes no matter what plugin you have activated. JWT plugin is not like that, you either choose Basic or Kerberos or JWT. And if we wrote a special code path for using JWT cross cluster, you&apos;d still have to manage issuing and distributing those keys and tokens somehow, which in most cases means an external IdP software. I don&apos;t think we want to require such a complex 3rd party software for secure CDCR. That&apos;s why I propose to extend what PKI can do.&lt;/p&gt;</comment>
                            <comment id="16836758" author="sarkaramrit2@gmail.com" created="Thu, 9 May 2019 22:50:11 +0000"  >&lt;p&gt;Thank you, Jan for the guidance. I have cooked up a patch around the design you have stated. &lt;br/&gt;
I may have done this cleaner, and I intend to refactor accordingly. &lt;br/&gt;
Especially I don&apos;t like mentioning Cdcr in &lt;b&gt;&lt;tt&gt;PKIAuthPlugin&lt;/tt&gt;&lt;/b&gt; code, I am looking for a better way to do that.&lt;/p&gt;

&lt;p&gt;Looking forward to feedback. &lt;/p&gt;
</comment>
                            <comment id="16836929" author="janhoy" created="Fri, 10 May 2019 06:20:24 +0000"  >&lt;p&gt;Thanks for working on this &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&#160;I agree that we cannot have custom code in PKI for every plugin that wants to use it. So it would be better to try to force CDCR into using a &quot;solr thread pool&quot; for its communication in such a way that the existing code in path will classify it as a request that needs the header. Or it is OK to introduce another additional way of detecting need for header as you have begun, if that is a generic mechanism that is documented for other components to use as well. Wdyt?&lt;/p&gt;</comment>
                            <comment id="16839160" author="sarkaramrit2@gmail.com" created="Tue, 14 May 2019 07:10:44 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=janhoy&quot; class=&quot;user-hover&quot; rel=&quot;janhoy&quot;&gt;janhoy&lt;/a&gt;,&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;So it would be better to try to force CDCR into using a &quot;solr thread pool&quot; for its communication in such a way that the existing code in the path will classify it as a request that needs the header.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Probably, but cannot figure out a way until now. Since there are CDCR internal APIs are called at multiple levels, not sure where we can fit it and where not, should be easy. I moved the Cdcr check to Auth utils, for now, to clean it up.&lt;/p&gt;

&lt;p&gt;Also tried to write meaningful tests but some dangling references are limiting the tests to complete successfully. Some resources are getting leaked by MiniSolrCloudCluster.&lt;/p&gt;</comment>
                            <comment id="17222435" author="mdrob" created="Wed, 28 Oct 2020 20:37:27 +0000"  >&lt;p&gt;Resolving as &quot;Won&apos;t Fix&quot; in line with decision to deprecate/remove CDCR - &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14022&quot; title=&quot;Deprecate CDCR from Solr in 8.x&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14022&quot;&gt;&lt;del&gt;SOLR-14022&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14616&quot; title=&quot;Remove CDCR from 9.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14616&quot;&gt;&lt;del&gt;SOLR-14616&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12968641" name="SOLR-11959.patch" size="34676" author="sarkaramrit2@gmail.com" created="Tue, 14 May 2019 07:07:45 +0000"/>
                            <attachment id="12968335" name="SOLR-11959.patch" size="19333" author="sarkaramrit2@gmail.com" created="Thu, 9 May 2019 22:46:03 +0000"/>
                            <attachment id="12911346" name="SOLR-11959.patch" size="1280" author="sarkaramrit2@gmail.com" created="Wed, 21 Feb 2018 06:36:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 2 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3pz5b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>