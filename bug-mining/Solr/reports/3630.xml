<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:27:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-11278] Fix race in cdcr bootstrap process</title>
                <link>https://issues.apache.org/jira/browse/SOLR-11278</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;&lt;tt&gt;CdcrBootstrapTest&lt;/tt&gt; is failing while running beasts for significant iterations.&lt;/p&gt;

&lt;p&gt;The bootstrapping is failing in the test, after the first batch is indexed for each &lt;tt&gt;testmethod&lt;/tt&gt;, which results in documents mismatch ::&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  [beaster]   2&amp;gt; 39167 ERROR (updateExecutor-39-thread-1-processing-n:127.0.0.1:42155_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) [n:127.0.0.1:42155_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.CdcrRequestHandler Bootstrap operation failed
  [beaster]   2&amp;gt; java.util.concurrent.ExecutionException: java.lang.AssertionError
  [beaster]   2&amp;gt; 	at java.util.concurrent.FutureTask.report(FutureTask.java:122)
  [beaster]   2&amp;gt; 	at java.util.concurrent.FutureTask.get(FutureTask.java:192)
  [beaster]   2&amp;gt; 	at org.apache.solr.handler.CdcrRequestHandler.lambda$handleBootstrapAction$0(CdcrRequestHandler.java:654)
  [beaster]   2&amp;gt; 	at com.codahale.metrics.InstrumentedExecutorService$InstrumentedRunnable.run(InstrumentedExecutorService.java:176)
  [beaster]   2&amp;gt; 	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
  [beaster]   2&amp;gt; 	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
  [beaster]   2&amp;gt; 	at org.apache.solr.common.util.ExecutorUtil$MDCAwareThreadPoolExecutor.lambda$execute$0(ExecutorUtil.java:188)
  [beaster]   2&amp;gt; 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
  [beaster]   2&amp;gt; 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
  [beaster]   2&amp;gt; 	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
  [beaster]   2&amp;gt; Caused by: java.lang.AssertionError
  [beaster]   2&amp;gt; 	at org.apache.solr.handler.CdcrRequestHandler$BootstrapCallable.call(CdcrRequestHandler.java:813)
  [beaster]   2&amp;gt; 	at org.apache.solr.handler.CdcrRequestHandler$BootstrapCallable.call(CdcrRequestHandler.java:724)
  [beaster]   2&amp;gt; 	at com.codahale.metrics.InstrumentedExecutorService$InstrumentedCallable.call(InstrumentedExecutorService.java:197)
  [beaster]   2&amp;gt; 	... 5 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  [beaster] [01:37:16.282] FAILURE  153s | CdcrBootstrapTest.testBootstrapWithSourceCluster &amp;lt;&amp;lt;&amp;lt;
  [beaster]    &amp;gt; Throwable #1: java.lang.AssertionError: Document mismatch on target after sync expected:&amp;lt;2000&amp;gt; but was:&amp;lt;1000&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment></environment>
        <key id="13096857">SOLR-11278</key>
            <summary>Fix race in cdcr bootstrap process</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="varun">Varun Thacker</assignee>
                                    <reporter username="sarkaramrit2@gmail.com">Amrit Sarkar</reporter>
                        <labels>
                            <label>test</label>
                    </labels>
                <created>Tue, 22 Aug 2017 22:24:19 +0000</created>
                <updated>Thu, 21 Nov 2019 00:42:26 +0000</updated>
                            <resolved>Wed, 11 Oct 2017 04:41:44 +0000</resolved>
                                    <version>6.6.1</version>
                    <version>7.0</version>
                                    <fixVersion>7.1</fixVersion>
                                    <component>CDCR</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16138977" author="sarkaramrit2@gmail.com" created="Wed, 23 Aug 2017 20:00:06 +0000"  >&lt;p&gt;attached entire log: test_results&lt;/p&gt;</comment>
                            <comment id="16143436" author="sarkaramrit2@gmail.com" created="Mon, 28 Aug 2017 06:45:07 +0000"  >&lt;p&gt;In waitForTargetToSync(), we are issuing commit to &quot;targetCollection&quot; every second, making it close old searcher and open a new one. Not sure whether this is the best way to verify documents indexed in &quot;target&quot; collection.&lt;/p&gt;</comment>
                            <comment id="16143712" author="varunthacker" created="Mon, 28 Aug 2017 12:13:51 +0000"  >&lt;p&gt;Here&apos;s another fail on branch_6_6 : &lt;a href=&quot;https://jenkins.thetaphi.de/job/Lucene-Solr-6.6-Windows/40/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jenkins.thetaphi.de/job/Lucene-Solr-6.6-Windows/40/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16143926" author="sarkaramrit2@gmail.com" created="Mon, 28 Aug 2017 15:50:30 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; 
 [beaster] Tests with failures [seed: 8D740119BA9589F1]:
  [beaster]   - org.apache.solr.cloud.CdcrBootstrapTest.testConvertClusterToCdcrAndBootstrap
  [beaster]   - org.apache.solr.cloud.CdcrBootstrapTest.testBootstrapWithSourceCluster
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Safe to say, all the three tests are NOT passable at all the seeds.&lt;/p&gt;</comment>
                            <comment id="16143931" author="erickerickson" created="Mon, 28 Aug 2017 15:56:03 +0000"  >&lt;p&gt;My bet, and this would be for verification purposes only:&lt;/p&gt;

&lt;p&gt;If on failure we added a single document to the source and tried again we wouldn&apos;t fail. Which would implicate &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11034&quot; title=&quot;Redundent/Unneccessary SolrCore reload when ManagedIndexSchema changes are made in cloud mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11034&quot;&gt;SOLR-11034&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11035&quot; title=&quot;(at least) 2 distinct failures possible when clients attempt searches during SolrCore reload&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11035&quot;&gt;&lt;del&gt;SOLR-11035&lt;/del&gt;&lt;/a&gt;. Hmmm, let me give that a whirl. Those two JIRAs are holding up several other JIRAs,...&lt;/p&gt;</comment>
                            <comment id="16143949" author="sarkaramrit2@gmail.com" created="Mon, 28 Aug 2017 16:10:55 +0000"  >&lt;p&gt;Posting &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11003&quot; title=&quot;Enabling bi-directional CDCR on cluster for better failover&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11003&quot;&gt;&lt;del&gt;SOLR-11003&lt;/del&gt;&lt;/a&gt; discussion here:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;All the tests in this class fails where we stop CDCR, index docs in source and then turns on CDCR again and expect BOOTSTRAP to happen. If I debug on IDE, all tests passes successfully (as the steps slows down), suggesting the time to wait for target to sync is low. But increasing it to 5 minutes even, instead of default 2 minutes, doesn&apos;t work. I increased explicit commit issued while waiting from 1 to 3 second, doesn&apos;t work either.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Let me know if there are other tests which are failing too related to CDCR.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Though the tests which are constantly failing I mentioned above, do Solr Core reload every second when it waits for target to sync. It can very well be variant of &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11034&quot; title=&quot;Redundent/Unneccessary SolrCore reload when ManagedIndexSchema changes are made in cloud mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11034&quot;&gt;SOLR-11034&lt;/a&gt; and/or &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11035&quot; title=&quot;(at least) 2 distinct failures possible when clients attempt searches during SolrCore reload&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11035&quot;&gt;&lt;del&gt;SOLR-11035&lt;/del&gt;&lt;/a&gt;, as we can see occasional NPE at IndexFetcher.java:753.&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="16145007" author="sarkaramrit2@gmail.com" created="Tue, 29 Aug 2017 09:40:31 +0000"  >&lt;p&gt;Ok here&apos;s what I am able to diagnose and have some questions and observations:&lt;/p&gt;

&lt;p&gt;1. Bootstrap process runs in a seperate thread, then what happens we issue a commit when BOOTSTRAPPING, replication / fetchIndex is taking place. Something wrong? Solr core will reload when on the background index is getting copied.&lt;br/&gt;
2. I bumped up the time / sleep time b/w issuing CDCR and checking target collection for numDocs to 7 seconds, and lowered documents from 10K to 2K, since BOOTSTRAP will be issued anything above maxBatchSize: 1024.&lt;br/&gt;
3. The new patch uploaded successfully ran on my system, but it is not a full-proof solution, just like: &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10734&quot; title=&quot;Multithreaded test/support for AtomicURP broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10734&quot;&gt;&lt;del&gt;SOLR-10734&lt;/del&gt;&lt;/a&gt;, where we cannot agree on a batch / thread count. It may fail for a seed in future or now.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt;, requesting if you can apply the patch and verify whether the tests are passing successfully.&lt;/p&gt;</comment>
                            <comment id="16145011" author="sarkaramrit2@gmail.com" created="Tue, 29 Aug 2017 09:42:58 +0000"  >&lt;p&gt;I am running beasts of 100 rounds, if passed, we may very well be comfortable with these changes.&lt;/p&gt;</comment>
                            <comment id="16145012" author="varunthacker" created="Tue, 29 Aug 2017 09:47:26 +0000"  >&lt;p&gt;Hi Amrit,&lt;/p&gt;

&lt;p&gt;I removed 6.6 from the Affects Versions(s) as this test fails regularly on other branches too.&lt;/p&gt;

&lt;p&gt;In general this has failed quite a bit while building out an RC for 6.6.1 so it will be nice if we can figure out a fix for it&lt;/p&gt;</comment>
                            <comment id="16145066" author="varunthacker" created="Tue, 29 Aug 2017 10:17:26 +0000"  >&lt;p&gt;&amp;gt; 2. I bumped up the time / sleep time b/w issuing CDCR and checking target collection for numDocs to 7 seconds, &lt;/p&gt;

&lt;p&gt;I don&apos;t get the logic for this. Doesn&apos;t {[waitForTargetToSync}} already wait for 120 seconds ? Adding another 7 seconds shouldn&apos;t help much no?&lt;/p&gt;

&lt;p&gt;&amp;gt; and lowered documents from 10K to 2K&lt;/p&gt;

&lt;p&gt;I&apos;m guessing this will help but don&apos;t you think the bigger problem is why can&apos;t replicate 10k documents ( 2 fields ) in 120 seconds? Perhaps we can add some more logging to the test case like when the bootstrapping starts etc .&lt;/p&gt;


&lt;p&gt;Before we wait for the target cluster to catch up , we print the queue size from the source cluster in the test case.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[junit4]   1&amp;amp;gt; Cdcr queue response: {responseHeader={status=0,QTime=2},queues={127.0.0.1:64653/solr={cdcr-target={queueSize=2020,lastTimestamp=}}},tlogTotalSize=96279,tlogTotalCount=20,updateLogSynchronizer=stopped}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So this doesn&apos;t seem like a lot of documents to take 120 seconds to catch up?&lt;/p&gt;</comment>
                            <comment id="16145551" author="erickerickson" created="Tue, 29 Aug 2017 16:02:43 +0000"  >&lt;p&gt;bq: I&apos;m guessing this will help but don&apos;t you think the bigger problem is why can&apos;t replicate 10k documents ( 2 fields ) in 120 seconds? Perhaps we can add some more logging to the test case like when the bootstrapping starts etc .&lt;/p&gt;

&lt;p&gt;The evidence from a test I ran the other day (results in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11003&quot; title=&quot;Enabling bi-directional CDCR on cluster for better failover&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11003&quot;&gt;&lt;del&gt;SOLR-11003&lt;/del&gt;&lt;/a&gt;) is that these delays won&apos;t help. Or if they do let the test pass they just mask a more fundamental problem. I changed one of the tests so if waitForTargetToSync didn&apos;t return the proper number of docs I&apos;d add one more document to the source and call waitForTargetToSync again. Here&apos;s the important bits:&lt;/p&gt;

&lt;p&gt;At the initial mismatch in waitForTargetToSync&lt;br/&gt;
target: 1901&lt;br/&gt;
source: 2000&lt;/p&gt;

&lt;p&gt;After my new loop that adds a single doc to source then calls waitForTargetToSync again I see counts of&lt;br/&gt;
target: 1902&lt;br/&gt;
source: 2001&lt;/p&gt;

&lt;p&gt;Clearly my new doc is being indexed to the source and sent to the target so it&apos;s not just a matter of the docs getting to the target but somehow not being available to the currently-open searcher. They&apos;re just not on the target at all.&lt;/p&gt;

&lt;p&gt;I&apos;ll instrument the tests a little more. It&apos;s strange that the difference is 99 and the packet size is 100, kind of feels like an off-by-one error.&lt;/p&gt;</comment>
                            <comment id="16145553" author="sarkaramrit2@gmail.com" created="Tue, 29 Aug 2017 16:04:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt; :: This is on Solr Version: 6.3&lt;/p&gt;

&lt;p&gt;Yes you are right. This solution is not full-proofed.&lt;/p&gt;

&lt;p&gt;I am able to narrow down one problem, still no solution on the way:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;   [junit4]   2&amp;gt; 93761 ERROR (recoveryExecutor-5-thread-1-processing-n:127.0.0.1:55637_solr x:cdcr-target_shard1_replica1 s:shard1 c:cdcr-target r:core_node1) [n:127.0.0.1:55637_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.h.ReplicationHandler Index fetch failed :org.apache.solr.common.SolrException: Index fetch failed : 
   [junit4]   2&amp;gt; 	at org.apache.solr.handler.IndexFetcher.fetchLatestIndex(IndexFetcher.java:540)
   [junit4]   2&amp;gt; 	at org.apache.solr.handler.IndexFetcher.fetchLatestIndex(IndexFetcher.java:251)
   [junit4]   2&amp;gt; 	at org.apache.solr.handler.ReplicationHandler.doFetch(ReplicationHandler.java:397)
   [junit4]   2&amp;gt; 	at org.apache.solr.handler.CdcrRequestHandler$BootstrapCallable.call(CdcrRequestHandler.java:758)
   [junit4]   2&amp;gt; 	at org.apache.solr.handler.CdcrRequestHandler$BootstrapCallable.call(CdcrRequestHandler.java:713)
   [junit4]   2&amp;gt; 	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
   [junit4]   2&amp;gt; 	at org.apache.solr.common.util.ExecutorUtil$MDCAwareThreadPoolExecutor.lambda$execute$0(ExecutorUtil.java:229)
   [junit4]   2&amp;gt; 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
   [junit4]   2&amp;gt; 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
   [junit4]   2&amp;gt; 	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
   [junit4]   2&amp;gt; Caused by: java.lang.NullPointerException
   [junit4]   2&amp;gt; 	at org.apache.solr.handler.IndexFetcher.openNewSearcherAndUpdateCommitPoint(IndexFetcher.java:753)
   [junit4]   2&amp;gt; 	at org.apache.solr.handler.IndexFetcher.fetchLatestIndex(IndexFetcher.java:517)
   [junit4]   2&amp;gt; 	... 9 more
   [junit4]   2&amp;gt; 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The problem is with &lt;b&gt;&lt;tt&gt;target.shutdown&lt;/tt&gt;&lt;/b&gt;. While doing target shutdown, it doesn&apos;t shutdown properly.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;   [junit4]   2&amp;gt; 67512 INFO  (coreCloseExecutor-49-thread-1) [n:127.0.0.1:55637_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.h.CdcrRequestHandler Solr core is being closed - shutting down CDCR handler @ cdcr-target:shard1
   [junit4]   2&amp;gt; 67515 WARN  (updateExecutor-4-thread-1-processing-n:127.0.0.1:55637_solr x:cdcr-target_shard1_replica1 s:shard1 c:cdcr-target r:core_node1) [n:127.0.0.1:55637_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.h.CdcrRequestHandler Bootstrap was interrupted
   [junit4]   2&amp;gt; java.lang.InterruptedException
   [junit4]   2&amp;gt; 	at java.util.concurrent.FutureTask.awaitDone(FutureTask.java:404)
   [junit4]   2&amp;gt; 	at java.util.concurrent.FutureTask.get(FutureTask.java:191)
   [junit4]   2&amp;gt; 	at org.apache.solr.handler.CdcrRequestHandler.lambda$handleBootstrapAction$0(CdcrRequestHandler.java:644)
   [junit4]   2&amp;gt; 	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
   [junit4]   2&amp;gt; 	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
   [junit4]   2&amp;gt; 	at org.apache.solr.common.util.ExecutorUtil$MDCAwareThreadPoolExecutor.lambda$execute$0(ExecutorUtil.java:229)
   [junit4]   2&amp;gt; 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
   [junit4]   2&amp;gt; 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
   [junit4]   2&amp;gt; 	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and the core gets reloaded and throws NPE. I am diving into this properly, but it have a feeling this is a machine specific issue as we didn&apos;t see much of these in Jenkins failures as mentioned by Varun.&lt;/p&gt;</comment>
                            <comment id="16145564" author="erickerickson" created="Tue, 29 Aug 2017 16:10:52 +0000"  >&lt;p&gt;Now we&apos;re getting somewhere! I&apos;m re-running some tests and will see if I get the same error in failing cases.&lt;/p&gt;

&lt;p&gt;This starts to hang together with the close-to-packet-size difference in doc counts: my bet is there&apos;s a segment missing on the target. I&apos;ll think about how to test that.&lt;/p&gt;</comment>
                            <comment id="16145829" author="sarkaramrit2@gmail.com" created="Tue, 29 Aug 2017 18:19:09 +0000"  >&lt;p&gt;yeah! &lt;b&gt;I verified the bootstrap status comes out to be RUNNING instead of FINISHED even after all the operations are completed, assertions are true, and we are going to shut down both source and target next.&lt;/b&gt; &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;.......
.......
        foundDocs = waitForTargetToSync(numDocs, targetSolrClient);
        assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;Document mismatch on target after sync&quot;&lt;/span&gt;, numDocs, foundDocs);

        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot; bs status 1 :: &quot;&lt;/span&gt; + invokeCdcrAction(targetSolrClient, CdcrParams.CdcrAction.BOOTSTRAP_STATUS));

        cdcrStop(targetSolrClient);
        cdcrStop(sourceSolrClient);

        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot; bs status 2 :: &quot;&lt;/span&gt; + invokeCdcrAction(targetSolrClient, CdcrParams.CdcrAction.BOOTSTRAP_STATUS));

      } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
        source.shutdown();
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;source shutdown&quot;&lt;/span&gt;);
      }
    } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
      target.shutdown();
      &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;target shutdown&quot;&lt;/span&gt;);
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;something&apos;s off with bootstrap or bootstrap_status, they are not in sync.&lt;/p&gt;</comment>
                            <comment id="16146821" author="sarkaramrit2@gmail.com" created="Wed, 30 Aug 2017 07:40:43 +0000"  >&lt;p&gt;Ok here&apos;s what&apos;s happening :&lt;/p&gt;

&lt;p&gt;&lt;b&gt;BOOTSTRAP_STATUS&lt;/b&gt; is never calculated / comes to be &lt;b&gt;FINISHED&lt;/b&gt; in target cluster for all the three tests in the testClass.&lt;/p&gt;

&lt;p&gt;I need to confirm what happens if bootstrap is not completed and solrcore is requested to be closed.&lt;/p&gt;</comment>
                            <comment id="16147149" author="sarkaramrit2@gmail.com" created="Wed, 30 Aug 2017 12:30:54 +0000"  >&lt;p&gt;Still rambling:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  /**
   * This test start cdcr source, adds data,starts target cluster, verifies replication,
   * stops cdcr replication and buffering, adds more data, re-enables cdcr and verify replication
   */
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testBootstrapWithSourceCluster() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
    &lt;span class=&quot;code-comment&quot;&gt;// start the target first so that we know its zkhost
&lt;/span&gt;    MiniSolrCloudCluster target = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MiniSolrCloudCluster(1, createTempDir(&lt;span class=&quot;code-quote&quot;&gt;&quot;cdcr-target&quot;&lt;/span&gt;), buildJettyConfig(&lt;span class=&quot;code-quote&quot;&gt;&quot;/solr&quot;&lt;/span&gt;));
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
      target.waitForAllNodes(30);
      &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Target zkHost = &quot;&lt;/span&gt; + target.getZkServer().getZkAddress());
      &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.setProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;cdcr.target.zkHost&quot;&lt;/span&gt;, target.getZkServer().getZkAddress());

      MiniSolrCloudCluster source = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MiniSolrCloudCluster(1, createTempDir(&lt;span class=&quot;code-quote&quot;&gt;&quot;cdcr-source&quot;&lt;/span&gt;), buildJettyConfig(&lt;span class=&quot;code-quote&quot;&gt;&quot;/solr&quot;&lt;/span&gt;));
      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        source.waitForAllNodes(30);
        source.uploadConfigSet(configset(&lt;span class=&quot;code-quote&quot;&gt;&quot;cdcr-source&quot;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;cdcr-source&quot;&lt;/span&gt;);

        CollectionAdminRequest.createCollection(&lt;span class=&quot;code-quote&quot;&gt;&quot;cdcr-source&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;cdcr-source&quot;&lt;/span&gt;, 1, 1)
            .withProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.directoryFactory&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;solr.StandardDirectoryFactory&quot;&lt;/span&gt;)
            .process(source.getSolrClient());

        CloudSolrClient sourceSolrClient = source.getSolrClient();
        sourceSolrClient.setDefaultCollection(&lt;span class=&quot;code-quote&quot;&gt;&quot;cdcr-source&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; docs = (TEST_NIGHTLY ? 100 : 10);
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; numDocs = 0;
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; k = 0; k &amp;lt; docs; k++) {
          UpdateRequest req = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; UpdateRequest();
          &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (; numDocs &amp;lt; (k + 1) * 100; numDocs++) {
            SolrInputDocument doc = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SolrInputDocument();
            doc.addField(&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;source_&quot;&lt;/span&gt; + numDocs);
            doc.addField(&lt;span class=&quot;code-quote&quot;&gt;&quot;xyz&quot;&lt;/span&gt;, numDocs);
            req.add(doc);
          }
          req.setAction(AbstractUpdateRequest.ACTION.COMMIT, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
          &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Adding &quot;&lt;/span&gt; + docs + &lt;span class=&quot;code-quote&quot;&gt;&quot; docs with commit=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, numDocs=&quot;&lt;/span&gt; + numDocs);
          req.process(sourceSolrClient);
        }

        QueryResponse response = sourceSolrClient.query(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SolrQuery(&lt;span class=&quot;code-quote&quot;&gt;&quot;*:*&quot;&lt;/span&gt;));
        assertEquals(&quot;&quot;, numDocs, response.getResults().getNumFound());

        &lt;span class=&quot;code-comment&quot;&gt;// setup the target cluster
&lt;/span&gt;        target.uploadConfigSet(configset(&lt;span class=&quot;code-quote&quot;&gt;&quot;cdcr-target&quot;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;cdcr-target&quot;&lt;/span&gt;);
        CollectionAdminRequest.createCollection(&lt;span class=&quot;code-quote&quot;&gt;&quot;cdcr-target&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;cdcr-target&quot;&lt;/span&gt;, 1, 1)
            .process(target.getSolrClient());
        CloudSolrClient targetSolrClient = target.getSolrClient();
        targetSolrClient.setDefaultCollection(&lt;span class=&quot;code-quote&quot;&gt;&quot;cdcr-target&quot;&lt;/span&gt;);

        cdcrStart(targetSolrClient);
        cdcrStart(sourceSolrClient);

        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;bs status TX :: &quot;&lt;/span&gt; + invokeCdcrAction(targetSolrClient, CdcrParams.CdcrAction.BOOTSTRAP_STATUS));
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;bs status SX :: &quot;&lt;/span&gt; + invokeCdcrAction(sourceSolrClient, CdcrParams.CdcrAction.BOOTSTRAP_STATUS));

        response = getCdcrQueue(sourceSolrClient);
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Cdcr queue response: &quot;&lt;/span&gt; + response.getResponse());
        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; foundDocs = waitForTargetToSync(numDocs, targetSolrClient);

        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;bs status TY :: &quot;&lt;/span&gt; + invokeCdcrAction(targetSolrClient, CdcrParams.CdcrAction.BOOTSTRAP_STATUS));
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;bs status SY :: &quot;&lt;/span&gt; + invokeCdcrAction(sourceSolrClient, CdcrParams.CdcrAction.BOOTSTRAP_STATUS));

        assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;Document mismatch on target after sync&quot;&lt;/span&gt;, numDocs, foundDocs);

        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;bs status TZ :: &quot;&lt;/span&gt; + invokeCdcrAction(targetSolrClient, CdcrParams.CdcrAction.BOOTSTRAP_STATUS));
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;bs status SZ :: &quot;&lt;/span&gt; + invokeCdcrAction(sourceSolrClient, CdcrParams.CdcrAction.BOOTSTRAP_STATUS));

        cdcrStop(sourceSolrClient);
        cdcrDisableBuffer(sourceSolrClient);

        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;bs status TA :: &quot;&lt;/span&gt; + invokeCdcrAction(targetSolrClient, CdcrParams.CdcrAction.BOOTSTRAP_STATUS));
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;bs status SA :: &quot;&lt;/span&gt; + invokeCdcrAction(sourceSolrClient, CdcrParams.CdcrAction.BOOTSTRAP_STATUS));

        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; c = 0;
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; k = 0; k &amp;lt; 10; k++) {
          UpdateRequest req = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; UpdateRequest();
          &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (; c &amp;lt; (k + 1) * 100; c++, numDocs++) {
            SolrInputDocument doc = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SolrInputDocument();
            doc.addField(&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;source_&quot;&lt;/span&gt; + numDocs);
            doc.addField(&lt;span class=&quot;code-quote&quot;&gt;&quot;xyz&quot;&lt;/span&gt;, numDocs);
            req.add(doc);
          }
          req.setAction(AbstractUpdateRequest.ACTION.COMMIT, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
          &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Adding 100 docs with commit=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, numDocs=&quot;&lt;/span&gt; + numDocs);
          req.process(sourceSolrClient);
        }

        response = sourceSolrClient.query(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SolrQuery(&lt;span class=&quot;code-quote&quot;&gt;&quot;*:*&quot;&lt;/span&gt;));
        assertEquals(&quot;&quot;, numDocs, response.getResults().getNumFound());

        cdcrStart(sourceSolrClient);
        cdcrEnableBuffer(sourceSolrClient);

        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;bs status T1 :: &quot;&lt;/span&gt; + invokeCdcrAction(targetSolrClient, CdcrParams.CdcrAction.BOOTSTRAP_STATUS));
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;bs status S1 :: &quot;&lt;/span&gt; + invokeCdcrAction(sourceSolrClient, CdcrParams.CdcrAction.BOOTSTRAP_STATUS));

        foundDocs = waitForTargetToSync(numDocs, targetSolrClient);

        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;bs status T2 :: &quot;&lt;/span&gt; + invokeCdcrAction(targetSolrClient, CdcrParams.CdcrAction.BOOTSTRAP_STATUS));
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;bs status S2 :: &quot;&lt;/span&gt; + invokeCdcrAction(sourceSolrClient, CdcrParams.CdcrAction.BOOTSTRAP_STATUS));

        assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;Document mismatch on target after sync&quot;&lt;/span&gt;, numDocs, foundDocs);

        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;bs status T3 :: &quot;&lt;/span&gt; + invokeCdcrAction(targetSolrClient, CdcrParams.CdcrAction.BOOTSTRAP_STATUS));
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;bs status S3 :: &quot;&lt;/span&gt; + invokeCdcrAction(sourceSolrClient, CdcrParams.CdcrAction.BOOTSTRAP_STATUS));
      } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
        source.shutdown();
      }
    } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
      target.shutdown();
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;responses for BS ::&lt;/p&gt;

&lt;p&gt;T - target, S - source&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;   [junit4]   1&amp;gt; bs status TX :: {responseHeader={status=0,QTime=0},STATUS=notfound,msg=No bootstrap found in running, completed or failed states}
   [junit4]   1&amp;gt; bs status SX :: {responseHeader={status=0,QTime=0},STATUS=notfound,msg=No bootstrap found in running, completed or failed states}
   [junit4]   1&amp;gt; bs status TY :: {responseHeader={status=0,QTime=0},STATUS=running}
   [junit4]   1&amp;gt; bs status SY :: {responseHeader={status=0,QTime=0},STATUS=notfound,msg=No bootstrap found in running, completed or failed states}
   [junit4]   1&amp;gt; bs status TZ :: {responseHeader={status=0,QTime=0},STATUS=running}
   [junit4]   1&amp;gt; bs status SZ :: {responseHeader={status=0,QTime=0},STATUS=notfound,msg=No bootstrap found in running, completed or failed states}
   [junit4]   1&amp;gt; bs status TA :: {responseHeader={status=0,QTime=0},STATUS=running}
   [junit4]   1&amp;gt; bs status SA :: {responseHeader={status=0,QTime=0},STATUS=notfound,msg=No bootstrap found in running, completed or failed states}
   [junit4]   1&amp;gt; bs status T1 :: {responseHeader={status=0,QTime=0},STATUS=running}
   [junit4]   1&amp;gt; bs status S1 :: {responseHeader={status=0,QTime=0},STATUS=notfound,msg=No bootstrap found in running, completed or failed states}
   [junit4]   1&amp;gt; bs status T2 :: {responseHeader={status=0,QTime=0},STATUS=cancelled}
   [junit4]   1&amp;gt; bs status S2 :: {responseHeader={status=0,QTime=0},STATUS=notfound,msg=No bootstrap found in running, completed or failed states}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;tt&gt;bs status T3&lt;/tt&gt; was never written as assertion was failed. &lt;b&gt;But why is bootstrap cancelled after waiting for the target for 120 sec?&lt;/b&gt; &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[junit4]   1&amp;gt; bs status T2 :: {responseHeader={status=0,QTime=0},STATUS=cancelled}
   [junit4]   2&amp;gt; 167151 INFO  (qtp666966491-24) [n:127.0.0.1:62331_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.c.S.Request [cdcr-target_shard1_replica1]  webapp=/solr path=/cdcr params={qt=/cdcr&amp;amp;action=BOOTSTRAP_STATUS&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=0
   [junit4]   2&amp;gt; 167153 INFO  (qtp666966491-24) [n:127.0.0.1:62331_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.c.S.Request [cdcr-target_shard1_replica1]  webapp=/solr path=/cdcr params={qt=/cdcr&amp;amp;action=BOOTSTRAP_STATUS&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=0
   [junit4]   2&amp;gt; 167153 INFO  (qtp1588339772-65) [n:127.0.0.1:62339_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/cdcr params={qt=/cdcr&amp;amp;_stateVer_=cdcr-source:4&amp;amp;action=bootstrap_status&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=0
   [junit4]   1&amp;gt; bs status S2 :: {responseHeader={status=0,QTime=0},STATUS=notfound,msg=No bootstrap found in running, completed or failed states}
   [junit4]   2&amp;gt; 167155 INFO  (qtp666966491-23) [n:127.0.0.1:62331_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.c.S.Request [cdcr-target_shard1_replica1]  webapp=/solr path=/cdcr params={qt=/cdcr&amp;amp;action=BOOTSTRAP_STATUS&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=0
   [junit4]   2&amp;gt; 167161 INFO  (qtp666966491-30) [n:127.0.0.1:62331_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.c.S.Request [cdcr-target_shard1_replica1]  webapp=/solr path=/cdcr params={qt=/cdcr&amp;amp;action=BOOTSTRAP_STATUS&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=0
   [junit4]   2&amp;gt; 167163 INFO  (qtp666966491-29) [n:127.0.0.1:62331_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.c.S.Request [cdcr-target_shard1_replica1]  webapp=/solr path=/cdcr params={qt=/cdcr&amp;amp;action=BOOTSTRAP_STATUS&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=0
   [junit4]   2&amp;gt; 167166 INFO  (qtp666966491-29) [n:127.0.0.1:62331_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.c.S.Request [cdcr-target_shard1_replica1]  webapp=/solr path=/cdcr params={qt=/cdcr&amp;amp;action=BOOTSTRAP_STATUS&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=0
   [junit4]   2&amp;gt; 167168 INFO  (jetty-closer-14-thread-1) [    ] o.e.j.s.AbstractConnector Stopped ServerConnector@4b790cef{HTTP/1.1,[http/1.1]}{127.0.0.1:0}
   [junit4]   2&amp;gt; 167168 INFO  (qtp666966491-29) [n:127.0.0.1:62331_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.c.S.Request [cdcr-target_shard1_replica1]  webapp=/solr path=/cdcr params={qt=/cdcr&amp;amp;action=BOOTSTRAP_STATUS&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=0
   [junit4]   2&amp;gt; 167169 INFO  (jetty-closer-14-thread-1) [    ] o.a.s.c.CoreContainer Shutting down CoreContainer instance=820972786
   [junit4]   2&amp;gt; 167169 INFO  (jetty-closer-14-thread-1) [    ] o.a.s.m.SolrMetricManager Closing metric reporters &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;: solr.node
   [junit4]   2&amp;gt; 167170 INFO  (jetty-closer-14-thread-1) [    ] o.a.s.m.SolrMetricManager Closing metric reporters &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;: solr.jvm
   [junit4]   2&amp;gt; 167170 INFO  (jetty-closer-14-thread-1) [    ] o.a.s.m.SolrMetricManager Closing metric reporters &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;: solr.jetty
[junit4]   2&amp;gt; 167173 INFO  (qtp666966491-29) [n:127.0.0.1:62331_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.c.S.Request [cdcr-target_shard1_replica1]  webapp=/solr path=/cdcr params={qt=/cdcr&amp;amp;action=BOOTSTRAP_STATUS&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=0
   [junit4]   2&amp;gt; 167175 INFO  (qtp666966491-23) [n:127.0.0.1:62331_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.c.S.Request [cdcr-target_shard1_replica1]  webapp=/solr path=/cdcr params={qt=/cdcr&amp;amp;action=BOOTSTRAP_STATUS&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=0
   [junit4]   2&amp;gt; 167176 INFO  (coreCloseExecutor-44-thread-1) [n:127.0.0.1:62339_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.SolrCore [cdcr-source_shard1_replica1]  CLOSING SolrCore org.apache.solr.core.SolrCore@500834bb
   [junit4]   2&amp;gt; 167176 INFO  (coreCloseExecutor-44-thread-1) [n:127.0.0.1:62339_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.h.CdcrRequestHandler Solr core is being closed - shutting down CDCR handler @ cdcr-source:shard1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Source solr cluster shut down before bootstrap gets completed and issues CANCEL_BOOSTRAP. The assertions fail way before that. The question being why 1000 docs are not getting bootstrapped?&lt;/p&gt;

&lt;p&gt;If you look above, the CDCR Bootstrap status from the beginning is &quot;running&quot; and even if the first batch is successfully fetched to target and we shut down CDCR on source. , the status is still being &quot;running&quot;. &lt;/p&gt;

&lt;p&gt;I am running more tests, will update shortly. This is the crux of the problem, no solution on the way still.&lt;/p&gt;</comment>
                            <comment id="16147168" author="sarkaramrit2@gmail.com" created="Wed, 30 Aug 2017 12:51:04 +0000"  >&lt;p&gt;When I commented out the second set of documents getting indexed in source, I didn&apos;t receive assertion failure, instead NPE returned back ::&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;   [junit4]   2&amp;gt; 71670 ERROR (recoveryExecutor-6-thread-1-processing-n:127.0.0.1:62762_solr x:cdcr-target_shard1_replica1 s:shard1 c:cdcr-target r:core_node1) [n:127.0.0.1:62762_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.h.ReplicationHandler Index fetch failed :org.apache.solr.common.SolrException: Index fetch failed : 
   [junit4]   2&amp;gt; 	at org.apache.solr.handler.IndexFetcher.fetchLatestIndex(IndexFetcher.java:598)
   [junit4]   2&amp;gt; 	at org.apache.solr.handler.IndexFetcher.fetchLatestIndex(IndexFetcher.java:301)
   [junit4]   2&amp;gt; 	at org.apache.solr.handler.ReplicationHandler.doFetch(ReplicationHandler.java:400)
   [junit4]   2&amp;gt; 	at org.apache.solr.handler.CdcrRequestHandler$BootstrapCallable.call(CdcrRequestHandler.java:759)
   [junit4]   2&amp;gt; 	at org.apache.solr.handler.CdcrRequestHandler$BootstrapCallable.call(CdcrRequestHandler.java:714)
   [junit4]   2&amp;gt; 	at com.codahale.metrics.InstrumentedExecutorService$InstrumentedCallable.call(InstrumentedExecutorService.java:197)
   [junit4]   2&amp;gt; 	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
   [junit4]   2&amp;gt; 	at org.apache.solr.common.util.ExecutorUtil$MDCAwareThreadPoolExecutor.lambda$execute$0(ExecutorUtil.java:229)
   [junit4]   2&amp;gt; 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
   [junit4]   2&amp;gt; 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
   [junit4]   2&amp;gt; 	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
   [junit4]   2&amp;gt; Caused by: java.lang.NullPointerException
   [junit4]   2&amp;gt; 	at org.apache.solr.handler.IndexFetcher.openNewSearcherAndUpdateCommitPoint(IndexFetcher.java:823)
   [junit4]   2&amp;gt; 	at org.apache.solr.handler.IndexFetcher.fetchLatestIndex(IndexFetcher.java:575)
   [junit4]   2&amp;gt; 	... 10 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16147309" author="shalinmangar" created="Wed, 30 Aug 2017 14:30:28 +0000"  >&lt;p&gt;This attached &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11278&quot; title=&quot;Fix race in cdcr bootstrap process&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11278&quot;&gt;&lt;del&gt;SOLR-11278&lt;/del&gt;&lt;/a&gt;-cancel-bootstrap-on-stop.patch fixes the strange status messages seen in the logs by Amrit. What happens is that on stopping cdcr, we stop only the bootstrap status runnable (started on the source cluster) but we do not abort the bootstrap running on the target cluster. This causes the status to return RUNNING on the target even after cdcr is stopped. This patch cancels the running bootstrap on the target cluster.&lt;/p&gt;</comment>
                            <comment id="16147647" author="jira-bot" created="Wed, 30 Aug 2017 17:29:41 +0000"  >&lt;p&gt;Commit b4c6bfafdb32127316b334ffdd195270e1077fbe in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b4c6bfa&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b4c6bfa&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11278&quot; title=&quot;Fix race in cdcr bootstrap process&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11278&quot;&gt;&lt;del&gt;SOLR-11278&lt;/del&gt;&lt;/a&gt;: Stopping CDCR should cancel a running bootstrap operation&lt;/p&gt;</comment>
                            <comment id="16147654" author="jira-bot" created="Wed, 30 Aug 2017 17:35:43 +0000"  >&lt;p&gt;Commit 56ddf473bcf80d9a8f7c3c17d6869cdd3c674223 in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=56ddf47&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=56ddf47&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11278&quot; title=&quot;Fix race in cdcr bootstrap process&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11278&quot;&gt;&lt;del&gt;SOLR-11278&lt;/del&gt;&lt;/a&gt;: Stopping CDCR should cancel a running bootstrap operation&lt;/p&gt;

&lt;p&gt;(cherry picked from commit b4c6bfa)&lt;/p&gt;</comment>
                            <comment id="16148445" author="shalinmangar" created="Thu, 31 Aug 2017 04:56:21 +0000"  >&lt;p&gt;There are still failures in CdcrBootstrapTest.testBootstrapWithContinousIndexingOnSourceCluster after this fix. I don&apos;t have the time right now to dig but if someone is willing to do the investigation, I can help with reviews and fixes.&lt;/p&gt;</comment>
                            <comment id="16148468" author="sarkaramrit2@gmail.com" created="Thu, 31 Aug 2017 05:31:05 +0000"  >&lt;p&gt;Shalin, I am onto this. CdcrBootstrapTest.testBootstrapWithContinousIndexingOnSourceCluster is failing intermittently when Bootstrap gets failed due to unannounced SolrCore shutdown. This SolrCore shutdown may not be the root issue, but fetchIndex from source. Please see below:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  [beaster]   1&amp;gt; Adding 10 docs with commit=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, numDocs=1100
  [beaster]   2&amp;gt; 62998 INFO  (qtp358530981-503) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.u.DirectUpdateHandler2 start commit{,optimize=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,openSearcher=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,waitSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,expungeDeletes=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,softCommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,prepareCommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;}
  [beaster]   2&amp;gt; 62998 INFO  (qtp358530981-503) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.u.SolrIndexWriter Calling setCommitData with IW:org.apache.solr.update.SolrIndexWriter@10111fe6
  [beaster]   2&amp;gt; 63003 INFO  (qtp358530981-502) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/update params={_stateVer_=cdcr-source:3&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=10
  [beaster]   2&amp;gt; 63010 INFO  (qtp1081974557-457) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.c.S.Request [cdcr-target_shard1_replica1]  webapp=/solr path=/cdcr params={qt=/cdcr&amp;amp;masterUrl=http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:36872/solr/cdcr-source_shard1_replica1/&amp;amp;action=BOOTSTRAP&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=32
&lt;/span&gt;  [beaster]   2&amp;gt; 63012 INFO  (qtp1081974557-459) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.c.S.Request [cdcr-target_shard1_replica1]  webapp=/solr path=/cdcr params={qt=/cdcr&amp;amp;action=BOOTSTRAP_STATUS&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=0
  [beaster]   2&amp;gt; 63013 INFO  (cdcr-bootstrap-status-136-thread-1-processing-n:127.0.0.1:36872_solr x:cdcr-source_shard1_replica1 s:shard1 c:cdcr-source r:core_node1) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.h.CdcrReplicatorManager CDCR bootstrap running &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 1 seconds, sleeping &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 2000 ms
  [beaster]   2&amp;gt; 63171 INFO  (qtp358530981-503) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.s.SolrIndexSearcher Opening [Searcher@7cd86816[cdcr-source_shard1_replica1] realtime]
  [beaster]   2&amp;gt; 63171 INFO  (qtp358530981-503) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.u.DirectUpdateHandler2 end_commit_flush
  [beaster]   2&amp;gt; 63171 INFO  (qtp358530981-504) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.u.DirectUpdateHandler2 start commit{,optimize=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,openSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,waitSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,expungeDeletes=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,softCommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,prepareCommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;}
  [beaster]   2&amp;gt; 63171 INFO  (qtp358530981-504) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.u.SolrIndexWriter Calling setCommitData with IW:org.apache.solr.update.SolrIndexWriter@10111fe6
  [beaster]   2&amp;gt; 63172 INFO  (qtp358530981-503) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/update params={waitSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;openSearcher=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;commit=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;softCommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;commit_end_point=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=174
  [beaster]   2&amp;gt; 63175 INFO  (qtp358530981-497) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={qt=/replication&amp;amp;wt=javabin&amp;amp;version=2&amp;amp;command=indexversion} status=0 QTime=0
  [beaster]   2&amp;gt; 63176 INFO  (recoveryExecutor-110-thread-1-processing-n:127.0.0.1:36154_solr x:cdcr-target_shard1_replica1 s:shard1 c:cdcr-target r:core_node1) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.h.IndexFetcher Master&apos;s generation: 12
  [beaster]   2&amp;gt; 63176 INFO  (recoveryExecutor-110-thread-1-processing-n:127.0.0.1:36154_solr x:cdcr-target_shard1_replica1 s:shard1 c:cdcr-target r:core_node1) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.h.IndexFetcher Master&apos;s version: 1504153213504
  [beaster]   2&amp;gt; 63176 INFO  (recoveryExecutor-110-thread-1-processing-n:127.0.0.1:36154_solr x:cdcr-target_shard1_replica1 s:shard1 c:cdcr-target r:core_node1) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.h.IndexFetcher Slave&apos;s generation: 1
  [beaster]   2&amp;gt; 63176 INFO  (recoveryExecutor-110-thread-1-processing-n:127.0.0.1:36154_solr x:cdcr-target_shard1_replica1 s:shard1 c:cdcr-target r:core_node1) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.h.IndexFetcher Slave&apos;s version: 0
  [beaster]   2&amp;gt; 63176 INFO  (recoveryExecutor-110-thread-1-processing-n:127.0.0.1:36154_solr x:cdcr-target_shard1_replica1 s:shard1 c:cdcr-target r:core_node1) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.h.IndexFetcher Starting replication process
  [beaster]   2&amp;gt; 63205 INFO  (qtp358530981-497) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.h.ReplicationHandler Adding tlog files to list: [{size=4649, name=tlog.0000000000000000000.1577218955048648704}, {size=4770, name=tlog.0000000000000000001.1577218955134631936}, {size=4770, name=tlog.0000000000000000002.1577218955245780992}, {size=4770, name=tlog.0000000000000000003.1577218955347492864}, {size=4770, name=tlog.0000000000000000004.1577218955448156160}, {size=4770, name=tlog.0000000000000000005.1577218955573985280}, {size=4770, name=tlog.0000000000000000006.1577218955690377216}, {size=4770, name=tlog.0000000000000000007.1577218955795234816}, {size=4770, name=tlog.0000000000000000008.1577218955899043840}, {size=4770, name=tlog.0000000000000000009.1577218956028018688}]
  [beaster]   2&amp;gt; 63206 INFO  (qtp358530981-497) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;wt=javabin&amp;amp;version=2&amp;amp;command=filelist} status=0 QTime=28
  [beaster]   2&amp;gt; 63217 INFO  (recoveryExecutor-110-thread-1-processing-n:127.0.0.1:36154_solr x:cdcr-target_shard1_replica1 s:shard1 c:cdcr-target r:core_node1) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.h.IndexFetcher &lt;span class=&quot;code-object&quot;&gt;Number&lt;/span&gt; of files in latest index in master: 39
  [beaster]   2&amp;gt; 63217 INFO  (recoveryExecutor-110-thread-1-processing-n:127.0.0.1:36154_solr x:cdcr-target_shard1_replica1 s:shard1 c:cdcr-target r:core_node1) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.h.IndexFetcher &lt;span class=&quot;code-object&quot;&gt;Number&lt;/span&gt; of tlog files in master: 10
  [beaster]   2&amp;gt; 63228 INFO  (recoveryExecutor-110-thread-1-processing-n:127.0.0.1:36154_solr x:cdcr-target_shard1_replica1 s:shard1 c:cdcr-target r:core_node1) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.u.DefaultSolrCoreState New IndexWriter is ready to be used.
  [beaster]   2&amp;gt; 63229 INFO  (recoveryExecutor-110-thread-1-processing-n:127.0.0.1:36154_solr x:cdcr-target_shard1_replica1 s:shard1 c:cdcr-target r:core_node1) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.h.IndexFetcher Starting download (fullCopy=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;) to MockDirectoryWrapper(RAMDirectory@799f4d8d lockFactory=org.apache.lucene.store.SingleInstanceLockFactory@633c5d00)
  [beaster]   2&amp;gt; 63240 INFO  (qtp358530981-497) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_a_LuceneVarGapDocFreqInterval_0.tiv&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63246 INFO  (qtp358530981-502) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_a_Lucene50_0.pos&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63247 INFO  (qtp358530981-504) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.s.SolrIndexSearcher Opening [Searcher@3fed3b93[cdcr-source_shard1_replica1] main]
  [beaster]   2&amp;gt; 63248 INFO  (qtp358530981-504) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.u.DirectUpdateHandler2 end_commit_flush
  [beaster]   2&amp;gt; 63248 INFO  (searcherExecutor-170-thread-1-processing-n:127.0.0.1:36872_solr x:cdcr-source_shard1_replica1 s:shard1 c:cdcr-source r:core_node1) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.SolrCore [cdcr-source_shard1_replica1] Registered &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; searcher Searcher@3fed3b93[cdcr-source_shard1_replica1] main{ExitableDirectoryReader(UninvertingDirectoryReader(Uninverting(_a(6.6.1):C1000) Uninverting(_b(6.6.1):C1) Uninverting(_c(6.6.1):C99)))}
  [beaster]   2&amp;gt; 63249 INFO  (qtp358530981-500) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_a.fdt&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63254 INFO  (qtp358530981-500) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_a_Lucene50_0.doc&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63257 INFO  (qtp358530981-501) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_a_Lucene50_0.tim&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63260 INFO  (qtp358530981-497) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_a.si&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63265 INFO  (qtp358530981-502) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_a.fdx&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63269 INFO  (qtp358530981-503) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_a_LuceneVarGapDocFreqInterval_0.doc&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63273 INFO  (qtp358530981-500) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_a_Lucene50_0.tip&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63276 INFO  (qtp358530981-501) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_a_TestBloomFilteredLucenePostings_0.blm&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63279 INFO  (qtp358530981-497) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_a.nvm&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63282 INFO  (qtp358530981-502) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_a.fnm&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63286 INFO  (qtp358530981-503) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_a_TestBloomFilteredLucenePostings_0.doc&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63289 INFO  (qtp358530981-500) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_a_TestBloomFilteredLucenePostings_0.tim&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63293 INFO  (qtp358530981-501) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_a_LuceneVarGapDocFreqInterval_0.pos&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63296 INFO  (qtp358530981-497) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_a_TestBloomFilteredLucenePostings_0.tip&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63299 INFO  (qtp358530981-502) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_a.nvd&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63302 INFO  (qtp358530981-503) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_a_LuceneVarGapDocFreqInterval_0.tib&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63306 INFO  (qtp358530981-500) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_a_TestBloomFilteredLucenePostings_0.pos&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63309 INFO  (qtp358530981-501) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_b_LuceneVarGapDocFreqInterval_0.doc&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63312 INFO  (qtp358530981-497) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_b.nvd&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63316 INFO  (qtp358530981-502) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_b_TestBloomFilteredLucenePostings_0.blm&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63320 INFO  (qtp358530981-503) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_b.si&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63324 INFO  (qtp358530981-500) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_b.nvm&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63327 INFO  (qtp358530981-501) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_b.fnm&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63330 INFO  (qtp358530981-497) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_b_LuceneVarGapDocFreqInterval_0.tiv&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63334 INFO  (qtp358530981-502) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_b_TestBloomFilteredLucenePostings_0.tip&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63337 INFO  (qtp358530981-503) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_b_Lucene50_0.pos&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63340 INFO  (qtp358530981-500) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_b_Lucene50_0.tip&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63343 INFO  (qtp358530981-501) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_b_TestBloomFilteredLucenePostings_0.doc&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63347 INFO  (qtp358530981-497) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_b_TestBloomFilteredLucenePostings_0.tim&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63348 INFO  (qtp358530981-504) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/update params={_stateVer_=cdcr-source:3&amp;amp;waitSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;commit=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;softCommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=343
  [beaster]   1&amp;gt; Adding 10 docs with commit=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, numDocs=1200
  [beaster]   2&amp;gt; 63350 INFO  (qtp358530981-502) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_b_Lucene50_0.doc&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63354 INFO  (qtp358530981-503) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_b_Lucene50_0.tim&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63356 INFO  (qtp358530981-498) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/update params={_stateVer_=cdcr-source:3&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=5
  [beaster]   2&amp;gt; 63357 INFO  (qtp358530981-501) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_b.fdx&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63358 INFO  (qtp358530981-500) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.u.DirectUpdateHandler2 start commit{,optimize=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,openSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,waitSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,expungeDeletes=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,softCommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,prepareCommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;}
  [beaster]   2&amp;gt; 63358 INFO  (qtp358530981-500) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.u.SolrIndexWriter Calling setCommitData with IW:org.apache.solr.update.SolrIndexWriter@10111fe6
  [beaster]   2&amp;gt; 63361 INFO  (qtp358530981-497) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_b_TestBloomFilteredLucenePostings_0.pos&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63410 INFO  (qtp358530981-504) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_b_LuceneVarGapDocFreqInterval_0.tib&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63416 INFO  (qtp358530981-503) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_b.fdt&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63420 INFO  (qtp358530981-498) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_b_LuceneVarGapDocFreqInterval_0.pos&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63424 INFO  (qtp358530981-502) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=segments_c&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63425 INFO  (recoveryExecutor-110-thread-1-processing-n:127.0.0.1:36154_solr x:cdcr-target_shard1_replica1 s:shard1 c:cdcr-target r:core_node1) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.h.IndexFetcher Starting download of tlog files from master: [{size=4649, name=tlog.0000000000000000000.1577218955048648704}, {size=4770, name=tlog.0000000000000000001.1577218955134631936}, {size=4770, name=tlog.0000000000000000002.1577218955245780992}, {size=4770, name=tlog.0000000000000000003.1577218955347492864}, {size=4770, name=tlog.0000000000000000004.1577218955448156160}, {size=4770, name=tlog.0000000000000000005.1577218955573985280}, {size=4770, name=tlog.0000000000000000006.1577218955690377216}, {size=4770, name=tlog.0000000000000000007.1577218955795234816}, {size=4770, name=tlog.0000000000000000008.1577218955899043840}, {size=4770, name=tlog.0000000000000000009.1577218956028018688}]
  [beaster]   2&amp;gt; 63428 INFO  (qtp358530981-497) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;tlogFile=tlog.0000000000000000000.1577218955048648704&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63433 INFO  (qtp358530981-497) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;tlogFile=tlog.0000000000000000001.1577218955134631936&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63437 INFO  (qtp358530981-503) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;tlogFile=tlog.0000000000000000002.1577218955245780992&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63442 INFO  (qtp358530981-498) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;tlogFile=tlog.0000000000000000003.1577218955347492864&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63447 INFO  (qtp358530981-498) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;tlogFile=tlog.0000000000000000004.1577218955448156160&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63451 INFO  (qtp358530981-498) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;tlogFile=tlog.0000000000000000005.1577218955573985280&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63468 INFO  (qtp358530981-498) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;tlogFile=tlog.0000000000000000006.1577218955690377216&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63472 INFO  (qtp358530981-498) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;tlogFile=tlog.0000000000000000007.1577218955795234816&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63479 INFO  (qtp358530981-498) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;tlogFile=tlog.0000000000000000008.1577218955899043840&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63483 INFO  (qtp358530981-498) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;tlogFile=tlog.0000000000000000009.1577218956028018688&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 63484 INFO  (recoveryExecutor-110-thread-1-processing-n:127.0.0.1:36154_solr x:cdcr-target_shard1_replica1 s:shard1 c:cdcr-target r:core_node1) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.h.IndexFetcher Total time taken &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; download (fullCopy=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,bytesDownloaded=101357) : 0 secs (&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; bytes/sec) to MockDirectoryWrapper(RAMDirectory@799f4d8d lockFactory=org.apache.lucene.store.SingleInstanceLockFactory@633c5d00)
  [beaster]   2&amp;gt; 63506 INFO  (qtp358530981-500) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.s.SolrIndexSearcher Opening [Searcher@4db46823[cdcr-source_shard1_replica1] main]
  [beaster]   2&amp;gt; 63506 INFO  (qtp358530981-500) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.u.DirectUpdateHandler2 end_commit_flush
  [beaster]   2&amp;gt; 63508 INFO  (searcherExecutor-170-thread-1-processing-n:127.0.0.1:36872_solr x:cdcr-source_shard1_replica1 s:shard1 c:cdcr-source r:core_node1) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.SolrCore [cdcr-source_shard1_replica1] Registered &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; searcher Searcher@4db46823[cdcr-source_shard1_replica1] main{ExitableDirectoryReader(UninvertingDirectoryReader(Uninverting(_a(6.6.1):C1000) Uninverting(_b(6.6.1):C1) Uninverting(_c(6.6.1):C99) Uninverting(_d(6.6.1):C100)))}
  [beaster]   2&amp;gt; 63508 INFO  (qtp358530981-500) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/update params={_stateVer_=cdcr-source:3&amp;amp;waitSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;commit=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;softCommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=150
  [beaster]   1&amp;gt; Adding 10 docs with commit=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, numDocs=1300
  [beaster]   2&amp;gt; 63510 INFO  (recoveryExecutor-110-thread-1-processing-n:127.0.0.1:36154_solr x:cdcr-target_shard1_replica1 s:shard1 c:cdcr-target r:core_node1) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.u.DefaultSolrCoreState New IndexWriter is ready to be used.
  [beaster]   2&amp;gt; 63510 INFO  (recoveryExecutor-110-thread-1-processing-n:127.0.0.1:36154_solr x:cdcr-target_shard1_replica1 s:shard1 c:cdcr-target r:core_node1) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.h.IndexFetcher Reloading SolrCore cdcr-target_shard1_replica1
  [beaster]   2&amp;gt; 63517 INFO  (qtp358530981-501) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/update params={_stateVer_=cdcr-source:3&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=5
  [beaster]   2&amp;gt; 63520 INFO  (qtp358530981-503) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.u.DirectUpdateHandler2 start commit{,optimize=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,openSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,waitSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,expungeDeletes=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,softCommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,prepareCommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;}
  [beaster]   2&amp;gt; 63520 INFO  (qtp358530981-503) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.u.SolrIndexWriter Calling setCommitData with IW:org.apache.solr.update.SolrIndexWriter@10111fe6
  [beaster]   2&amp;gt; 63577 INFO  (&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-98) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.c.SolrConfig Using Lucene MatchVersion: 6.6.1
  [beaster]   2&amp;gt; 63614 INFO  (&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-98) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.s.IndexSchema [cdcr-target_shard1_replica1] Schema name=minimal
  [beaster]   2&amp;gt; 63621 INFO  (&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-98) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.s.IndexSchema Loaded schema minimal/1.1 with uniqueid field id
  [beaster]   2&amp;gt; 63621 INFO  (&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-98) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.c.CoreContainer Reloading SolrCore &lt;span class=&quot;code-quote&quot;&gt;&apos;cdcr-target_shard1_replica1&apos;&lt;/span&gt; using configuration from collection cdcr-target
  [beaster]   2&amp;gt; 63621 INFO  (qtp358530981-503) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.s.SolrIndexSearcher Opening [Searcher@5e7f193f[cdcr-source_shard1_replica1] main]
  [beaster]   2&amp;gt; 63622 INFO  (qtp358530981-503) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.u.DirectUpdateHandler2 end_commit_flush
  [beaster]   2&amp;gt; 63624 INFO  (searcherExecutor-170-thread-1-processing-n:127.0.0.1:36872_solr x:cdcr-source_shard1_replica1 s:shard1 c:cdcr-source r:core_node1) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.SolrCore [cdcr-source_shard1_replica1] Registered &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; searcher Searcher@5e7f193f[cdcr-source_shard1_replica1] main{ExitableDirectoryReader(UninvertingDirectoryReader(Uninverting(_a(6.6.1):C1000) Uninverting(_b(6.6.1):C1) Uninverting(_c(6.6.1):C99) Uninverting(_d(6.6.1):C100) Uninverting(_e(6.6.1):C100)))}
  [beaster]   2&amp;gt; 63625 INFO  (qtp358530981-503) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/update params={_stateVer_=cdcr-source:3&amp;amp;waitSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;commit=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;softCommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=104
  [beaster]   1&amp;gt; Adding 10 docs with commit=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, numDocs=1400
  [beaster]   2&amp;gt; 63629 INFO  (&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-98) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.c.SolrCore [[cdcr-target_shard1_replica1] ] Opening &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SolrCore at [/home/jenkins/lucene-solr/solr/build/solr-core/test/J0/temp/solr.cloud.CdcrBootstrapTest_20C3001E01E3B41B-001/cdcr-target-004/node1/cdcr-target_shard1_replica1], dataDir=[/home/jenkins/lucene-solr/solr/build/solr-core/test/J0/temp/solr.cloud.CdcrBootstrapTest_20C3001E01E3B41B-001/cdcr-target-004/node1/./cdcr-target_shard1_replica1/data/]
  [beaster]   2&amp;gt; 63634 INFO  (qtp358530981-502) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/update params={_stateVer_=cdcr-source:3&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=6
  [beaster]   2&amp;gt; 63636 INFO  (qtp358530981-504) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.u.DirectUpdateHandler2 start commit{,optimize=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,openSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,waitSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,expungeDeletes=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,softCommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,prepareCommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;}
  [beaster]   2&amp;gt; 63636 INFO  (qtp358530981-504) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.u.SolrIndexWriter Calling setCommitData with IW:org.apache.solr.update.SolrIndexWriter@10111fe6
  [beaster]   2&amp;gt; 63806 INFO  (qtp358530981-504) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.s.SolrIndexSearcher Opening [Searcher@48e60ebb[cdcr-source_shard1_replica1] main]
  [beaster]   2&amp;gt; 63806 INFO  (searcherExecutor-170-thread-1-processing-n:127.0.0.1:36872_solr x:cdcr-source_shard1_replica1 s:shard1 c:cdcr-source r:core_node1) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.SolrCore [cdcr-source_shard1_replica1] Registered &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; searcher Searcher@48e60ebb[cdcr-source_shard1_replica1] main{ExitableDirectoryReader(UninvertingDirectoryReader(Uninverting(_a(6.6.1):C1000) Uninverting(_b(6.6.1):C1) Uninverting(_c(6.6.1):C99) Uninverting(_d(6.6.1):C100) Uninverting(_e(6.6.1):C100) Uninverting(_f(6.6.1):C100)))}
  [beaster]   2&amp;gt; 63807 INFO  (&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-98) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.u.CommitTracker Hard AutoCommit: disabled
  [beaster]   2&amp;gt; 63807 INFO  (&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-98) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.u.CommitTracker Soft AutoCommit: disabled
  [beaster]   2&amp;gt; 63807 INFO  (qtp358530981-504) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.u.DirectUpdateHandler2 end_commit_flush
  [beaster]   2&amp;gt; 63808 INFO  (qtp358530981-504) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/update params={_stateVer_=cdcr-source:3&amp;amp;waitSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;commit=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;softCommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=171
  [beaster]   1&amp;gt; Adding 10 docs with commit=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, numDocs=1500
  [beaster]   2&amp;gt; 63810 INFO  (&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-98) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.s.SolrIndexSearcher Opening [Searcher@28386b90[cdcr-target_shard1_replica1] main]
  [beaster]   2&amp;gt; 63813 INFO  (&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-98) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.r.ManagedResourceStorage Configured ZooKeeperStorageIO with znodeBase: /configs/cdcr-target
  [beaster]   2&amp;gt; 63814 INFO  (&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-98) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.r.ManagedResourceStorage Loaded &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; at path _rest_managed.json using ZooKeeperStorageIO:path=/configs/cdcr-target
  [beaster]   2&amp;gt; 63814 INFO  (&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-98) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.s.ZkIndexSchemaReader Creating ZooKeeper watch &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the managed schema at /configs/cdcr-target/managed-schema
  [beaster]   2&amp;gt; 63815 INFO  (&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-98) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.s.ZkIndexSchemaReader Current schema version 0 is already the latest
  [beaster]   2&amp;gt; 63815 INFO  (&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-98) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.h.ReplicationHandler Commits will be reserved &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;  10000
  [beaster]   2&amp;gt; 63827 INFO  (qtp358530981-504) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.c.S.Request [cdcr-source_shard1_replica1]  webapp=/solr path=/update params={_stateVer_=cdcr-source:3&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=15
  [beaster]   2&amp;gt; 63832 INFO  (qtp358530981-497) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.u.DirectUpdateHandler2 start commit{,optimize=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,openSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,waitSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,expungeDeletes=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,softCommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,prepareCommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;}
  [beaster]   2&amp;gt; 63832 INFO  (qtp358530981-497) [n:127.0.0.1:36872_solr c:cdcr-source s:shard1 r:core_node1 x:cdcr-source_shard1_replica1] o.a.s.u.SolrIndexWriter Calling setCommitData with IW:org.apache.solr.update.SolrIndexWriter@10111fe6
  [beaster]   2&amp;gt; 63853 INFO  (searcherExecutor-188-thread-1-processing-n:127.0.0.1:36154_solr x:cdcr-target_shard1_replica1 s:shard1 c:cdcr-target r:core_node1) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.c.SolrCore [cdcr-target_shard1_replica1] Registered &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; searcher Searcher@28386b90[cdcr-target_shard1_replica1] main{ExitableDirectoryReader(UninvertingDirectoryReader(Uninverting(_a(6.6.1):C1000) Uninverting(_b(6.6.1):C1)))}
  [beaster]   2&amp;gt; 63860 INFO  (&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-98) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.u.DefaultSolrCoreState New IndexWriter is ready to be used.
  [beaster]   2&amp;gt; 63865 INFO  (&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-98) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.s.SolrIndexSearcher Opening [Searcher@4c22895c[cdcr-target_shard1_replica1] main]
  [beaster]   2&amp;gt; 63866 INFO  (&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-98) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.c.SolrCore [cdcr-target_shard1_replica1]  CLOSING SolrCore org.apache.solr.core.SolrCore@ebbd9dc
  [beaster]   2&amp;gt; 63866 INFO  (searcherExecutor-188-thread-1-processing-n:127.0.0.1:36154_solr x:cdcr-target_shard1_replica1 s:shard1 c:cdcr-target r:core_node1) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.c.SolrCore [cdcr-target_shard1_replica1] Registered &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; searcher Searcher@4c22895c[cdcr-target_shard1_replica1] main{ExitableDirectoryReader(UninvertingDirectoryReader(Uninverting(_a(6.6.1):C1000) Uninverting(_b(6.6.1):C1)))}
  [beaster]   2&amp;gt; 63866 INFO  (&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-98) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.h.CdcrRequestHandler Solr core is being closed - shutting down CDCR handler @ cdcr-target:shard1
  [beaster]   2&amp;gt; 63868 INFO  (&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-98) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.m.SolrMetricManager Closing metric reporters &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;: solr.core.cdcr-target.shard1.replica1
  [beaster]   2&amp;gt; 63869 INFO  (recoveryExecutor-110-thread-1-processing-n:127.0.0.1:36154_solr x:cdcr-target_shard1_replica1 s:shard1 c:cdcr-target r:core_node1) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.h.CdcrRequestHandler No replay needed.
  [beaster]   2&amp;gt; 63869 ERROR (updateExecutor-109-thread-1-processing-n:127.0.0.1:36154_solr x:cdcr-target_shard1_replica1 s:shard1 c:cdcr-target r:core_node1) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.h.CdcrRequestHandler Bootstrap operation failed
  [beaster]   2&amp;gt; java.util.concurrent.ExecutionException: java.lang.AssertionError
  [beaster]   2&amp;gt; 	at java.util.concurrent.FutureTask.report(FutureTask.java:122)
  [beaster]   2&amp;gt; 	at java.util.concurrent.FutureTask.get(FutureTask.java:192)
  [beaster]   2&amp;gt; 	at org.apache.solr.handler.CdcrRequestHandler.lambda$handleBootstrapAction$0(CdcrRequestHandler.java:644)
  [beaster]   2&amp;gt; 	at com.codahale.metrics.InstrumentedExecutorService$InstrumentedRunnable.run(InstrumentedExecutorService.java:176)
  [beaster]   2&amp;gt; 	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
  [beaster]   2&amp;gt; 	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
  [beaster]   2&amp;gt; 	at org.apache.solr.common.util.ExecutorUtil$MDCAwareThreadPoolExecutor.lambda$execute$0(ExecutorUtil.java:229)
  [beaster]   2&amp;gt; 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
  [beaster]   2&amp;gt; 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
  [beaster]   2&amp;gt; 	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
  [beaster]   2&amp;gt; Caused by: java.lang.AssertionError
  [beaster]   2&amp;gt; 	at org.apache.solr.handler.CdcrRequestHandler$BootstrapCallable.call(CdcrRequestHandler.java:787)
  [beaster]   2&amp;gt; 	at org.apache.solr.handler.CdcrRequestHandler$BootstrapCallable.call(CdcrRequestHandler.java:714)
  [beaster]   2&amp;gt; 	at com.codahale.metrics.InstrumentedExecutorService$InstrumentedCallable.call(InstrumentedExecutorService.java:197)
  [beaster]   2&amp;gt; 	... 5 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Replication takes place successfully once:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; [beaster]   2&amp;gt; 63860 INFO  (&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-98) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.u.DefaultSolrCoreState New IndexWriter is ready to be used.
  [beaster]   2&amp;gt; 63865 INFO  (&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-98) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.s.SolrIndexSearcher Opening [Searcher@4c22895c[cdcr-target_shard1_replica1] main]
  [beaster]   2&amp;gt; 63866 INFO  (&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-98) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.c.SolrCore [cdcr-target_shard1_replica1]  CLOSING SolrCore org.apache.solr.core.SolrCore@ebbd9dc
  [beaster]   2&amp;gt; 63866 INFO  (searcherExecutor-188-thread-1-processing-n:127.0.0.1:36154_solr x:cdcr-target_shard1_replica1 s:shard1 c:cdcr-target r:core_node1) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.c.SolrCore [cdcr-target_shard1_replica1] Registered &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; searcher Searcher@4c22895c[cdcr-target_shard1_replica1] main{ExitableDirectoryReader(UninvertingDirectoryReader(Uninverting(_a(6.6.1):C1000) Uninverting(_b(6.6.1):C1)))}
  [beaster]   2&amp;gt; 63484 INFO  (recoveryExecutor-110-thread-1-processing-n:127.0.0.1:36154_solr x:cdcr-target_shard1_replica1 s:shard1 c:cdcr-target r:core_node1) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.h.IndexFetcher Total time taken &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; download (fullCopy=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,bytesDownloaded=101357) : 0 secs (&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; bytes/sec) to MockDirectoryWrapper(RAMDirectory@799f4d8d lockFactory=org.apache.lucene.store.SingleInstanceLockFactory@633c5d00)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;then &lt;tt&gt;cdcr-target&lt;/tt&gt; abruptly closes, with bootstrap operation failed, giving status &quot;cancelled&quot;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[beaster]   2&amp;gt; 63866 INFO  (&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-98) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.h.CdcrRequestHandler Solr core is being closed - shutting down CDCR handler @ cdcr-target:shard1
  [beaster]   2&amp;gt; 63868 INFO  (&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-98) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.m.SolrMetricManager Closing metric reporters &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;: solr.core.cdcr-target.shard1.replica1
  [beaster]   2&amp;gt; 63869 INFO  (recoveryExecutor-110-thread-1-processing-n:127.0.0.1:36154_solr x:cdcr-target_shard1_replica1 s:shard1 c:cdcr-target r:core_node1) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.h.CdcrRequestHandler No replay needed.
  [beaster]   2&amp;gt; 63869 ERROR (updateExecutor-109-thread-1-processing-n:127.0.0.1:36154_solr x:cdcr-target_shard1_replica1 s:shard1 c:cdcr-target r:core_node1) [n:127.0.0.1:36154_solr c:cdcr-target s:shard1 r:core_node1 x:cdcr-target_shard1_replica1] o.a.s.h.CdcrRequestHandler Bootstrap operation failed
  [beaster]   2&amp;gt; java.util.concurrent.ExecutionException: java.lang.AssertionError
  .......
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I am adding addition logging in CdcrRequesHandler to catch and print the root problem of failed bootstrap operation. will post the results soon. &lt;/p&gt;</comment>
                            <comment id="16148943" author="sarkaramrit2@gmail.com" created="Thu, 31 Aug 2017 12:56:44 +0000"  >&lt;p&gt;Ok.&lt;/p&gt;

&lt;p&gt;I had three successful beast runs w/o any assertion failure :&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;branch_6_6&lt;/tt&gt; :: without applying Shalin&apos;s bootstrap status fix patch&lt;br/&gt;
1. ant beast -Dbeast.iters=50 -Dtestcase=CdcrBootstrapTest&lt;br/&gt;
2. ant beast -Dtests.dups=2 -Dtests.iters=2 -Dbeast.iters=35 -Dtestcase=CdcrBootstrapTest&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;master&lt;/tt&gt; :: patch is committed yesterday&lt;br/&gt;
1. ant beast -Dbeast.iters=50 -Dtestcase=CdcrBootstrapTest -Dtests.dups=2 -Dtests.iters=2&lt;/p&gt;

&lt;p&gt;Suddenly life&apos;s good. Will keep testing more.&lt;/p&gt;</comment>
                            <comment id="16150114" author="sarkaramrit2@gmail.com" created="Fri, 1 Sep 2017 06:35:34 +0000"  >&lt;p&gt;Rambling again:&lt;/p&gt;

&lt;p&gt;What is the use of bootstrapFuture essentially? to get status of the current operation, right?&lt;/p&gt;

&lt;p&gt;In CdcrRequestHandler.java :: there are some custom log lines, ignore them:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &lt;span class=&quot;code-object&quot;&gt;Runnable&lt;/span&gt; runnable = () -&amp;gt; {
      Lock recoveryLock = req.getCore().getSolrCoreState().getRecoveryLock();
      &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; locked = recoveryLock.tryLock();
      SolrCoreState coreState = core.getSolrCoreState();
      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!locked)  {
          log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;we reached &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; point :: CANCEL BOOTSTRAP, locked :: &quot;&lt;/span&gt; + locked);
          handleCancelBootstrap(req, rsp);
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (leaderStateManager.amILeader())  {
          coreState.setCdcrBootstrapRunning(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
          &lt;span class=&quot;code-comment&quot;&gt;//running.set(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
&lt;/span&gt;          &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; masterUrl = req.getParams().get(ReplicationHandler.MASTER_URL);
          BootstrapCallable bootstrapCallable = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BootstrapCallable(masterUrl, core);
          coreState.setCdcrBootstrapCallable(bootstrapCallable);
          Future&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;&amp;gt; bootstrapFuture = core.getCoreContainer().getUpdateShardHandler().getRecoveryExecutor()
              .submit(bootstrapCallable);
          &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;we reached &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; point :: all good, bootstrapFuture.get :: &quot;&lt;/span&gt; + bootstrapFuture.get());
          } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
            log.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;bootstrapFuture.get :: &quot;&lt;/span&gt;,e);
          }
          coreState.setCdcrBootstrapFuture(bootstrapFuture);
          &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            bootstrapFuture.get();
          } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) {
            &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread().interrupt();
            log.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Bootstrap was interrupted&quot;&lt;/span&gt;, e);
          } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (ExecutionException e) {
            log.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Bootstrap operation failed&quot;&lt;/span&gt;, e);
          }
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;  {
          log.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Action {} sent to non-leader replica @ {}:{}. Aborting bootstrap.&quot;&lt;/span&gt;, CdcrParams.CdcrAction.BOOTSTRAP, collectionName, shard);
        }
      } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (locked) {
          coreState.setCdcrBootstrapRunning(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
          recoveryLock.unlock();
        }
      }
    };
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;b&gt;bootstrapFuture.get()&lt;/b&gt; throws:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;  &lt;span class=&quot;error&quot;&gt;&amp;#91;beaster&amp;#93;&lt;/span&gt;   2&amp;gt; 43072 ERROR (updateExecutor-39-thread-1-processing-n:127.0.0.1:41488_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) &lt;span class=&quot;error&quot;&gt;&amp;#91;n:127.0.0.1:41488_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1&amp;#93;&lt;/span&gt; o.a.s.h.CdcrRequestHandler Bootstrap operation failed&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;beaster&amp;#93;&lt;/span&gt;   2&amp;gt; java.util.concurrent.ExecutionException: java.lang.AssertionError&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;beaster&amp;#93;&lt;/span&gt;   2&amp;gt; 	at java.util.concurrent.FutureTask.report(FutureTask.java:122)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;beaster&amp;#93;&lt;/span&gt;   2&amp;gt; 	at java.util.concurrent.FutureTask.get(FutureTask.java:192)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;beaster&amp;#93;&lt;/span&gt;   2&amp;gt; 	at org.apache.solr.handler.CdcrRequestHandler.lambda$handleBootstrapAction$0(CdcrRequestHandler.java:653)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;beaster&amp;#93;&lt;/span&gt;   2&amp;gt; 	at com.codahale.metrics.InstrumentedExecutorService$InstrumentedRunnable.run(InstrumentedExecutorService.java:176)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;beaster&amp;#93;&lt;/span&gt;   2&amp;gt; 	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;beaster&amp;#93;&lt;/span&gt;   2&amp;gt; 	at java.util.concurrent.FutureTask.run(FutureTask.java:266)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;beaster&amp;#93;&lt;/span&gt;   2&amp;gt; 	at org.apache.solr.common.util.ExecutorUtil$MDCAwareThreadPoolExecutor.lambda$execute$0(ExecutorUtil.java:188)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;beaster&amp;#93;&lt;/span&gt;   2&amp;gt; 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;beaster&amp;#93;&lt;/span&gt;   2&amp;gt; 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;beaster&amp;#93;&lt;/span&gt;   2&amp;gt; 	at java.lang.Thread.run(Thread.java:748)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;beaster&amp;#93;&lt;/span&gt;   2&amp;gt; Caused by: java.lang.AssertionError&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;beaster&amp;#93;&lt;/span&gt;   2&amp;gt; 	at org.apache.solr.handler.CdcrRequestHandler$BootstrapCallable.call(CdcrRequestHandler.java:804)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;beaster&amp;#93;&lt;/span&gt;   2&amp;gt; 	at org.apache.solr.handler.CdcrRequestHandler$BootstrapCallable.call(CdcrRequestHandler.java:723)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;beaster&amp;#93;&lt;/span&gt;   2&amp;gt; 	at com.codahale.metrics.InstrumentedExecutorService$InstrumentedCallable.call(InstrumentedExecutorService.java:197)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;beaster&amp;#93;&lt;/span&gt;   2&amp;gt; 	... 5 more&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;and bootstrap operation fails.&lt;/p&gt;

&lt;p&gt;FutureTask.java ::&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    /**
     * Returns result or &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; exception &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; completed task.
     * @param s completed state value
     */
    @SuppressWarnings(&lt;span class=&quot;code-quote&quot;&gt;&quot;unchecked&quot;&lt;/span&gt;)
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; V report(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; s) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; ExecutionException {
        &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; x = outcome;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (s == NORMAL)
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; (V)x;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (s &amp;gt;= CANCELLED)
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CancellationException();
        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ExecutionException((Throwable)x);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and the assertion failure is at BootstrapCallable call function &lt;tt&gt;finally&lt;/tt&gt; block ::&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (closed || !success) {
          &lt;span class=&quot;code-comment&quot;&gt;// we cannot apply the buffer in &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; because it will introduce newer versions in the
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// update log and then the source cluster will get those versions via collectioncheckpoint
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// causing the versions in between to be completely missed
&lt;/span&gt;          &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; dropped = ulog.dropBufferedUpdates();
          &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; dropped;
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;tt&gt;dropped&lt;/tt&gt; is false, &lt;tt&gt;bufferredUpdates&lt;/tt&gt; are not cleared / dropped?&lt;/p&gt;

&lt;p&gt;Earlier the assertion failure is for &lt;tt&gt;2000 to 1000 or 1001&lt;/tt&gt;, recently I got &lt;tt&gt;2000 to 1100&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I will test with disabled buffer and see if there&apos;s any change.&lt;/p&gt;</comment>
                            <comment id="16150247" author="sarkaramrit2@gmail.com" created="Fri, 1 Sep 2017 09:04:01 +0000"  >&lt;p&gt;Root cause of the assertion error ::&lt;/p&gt;

&lt;p&gt;In bootstrap process, in bootstrap callable process,&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        Future&amp;lt;UpdateLog.RecoveryInfo&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; = ulog.applyBufferedUpdates();
          ....................
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; success;
      } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (closed || !success) {
          ...................
          &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; dropped = ulog.dropBufferedUpdates();
          log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;boostrap callable dropped :: &quot;&lt;/span&gt; + dropped);
          &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; dropped;
        }
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;tt&gt;ulog.dropBufferedUpdates()&lt;/tt&gt; is getting calculated as &lt;tt&gt;false&lt;/tt&gt; at ::&lt;/p&gt;

&lt;p&gt;UpdateLog::dropBufferedUpdates::&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-comment&quot;&gt;/** Returns &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; we were able to drop buffered updates and &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; to the ACTIVE state */&lt;/span&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; dropBufferedUpdates() {
    versionInfo.blockUpdates();
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
      log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;dropBufferedUpdates :: state :: start &quot;&lt;/span&gt; + state);
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (state != State.BUFFERING){
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
      }
...............
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This state is assigned &lt;b&gt;&lt;tt&gt;ACTIVE&lt;/tt&gt;&lt;/b&gt; instead of buffering and it returns &lt;b&gt;&lt;tt&gt;false&lt;/tt&gt;&lt;/b&gt; and returns..&lt;/p&gt;

&lt;p&gt;in UpdateLog, I cannot figure out where exactly &lt;tt&gt;state&lt;/tt&gt; is getting assigned as &lt;b&gt;ACTIVE&lt;/b&gt; b/w &lt;tt&gt;applybufferedupdates&lt;/tt&gt; and &lt;tt&gt;dropbufferedupdates&lt;/tt&gt; and running test to detect the same. Ideally the initial value of &lt;tt&gt;state&lt;/tt&gt; is assigned &lt;tt&gt;ACTIVE&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="16150251" author="sarkaramrit2@gmail.com" created="Fri, 1 Sep 2017 09:06:54 +0000"  >&lt;p&gt;Due to this assertion error, the &lt;tt&gt;waitForTargetSync&lt;/tt&gt; emits the same 1000 / 1001 / 1100 numFound for target for 120 seconds, as bootstrap has failed due to &quot;UNABLE TO DROP BUFFER UPDATES&quot;. I am not sure what is the significance of dropping updates in &lt;tt&gt;finally&lt;/tt&gt; block in bootstrap process. Would appreciate some advice on this.&lt;/p&gt;</comment>
                            <comment id="16150469" author="sarkaramrit2@gmail.com" created="Fri, 1 Sep 2017 13:01:09 +0000"  >&lt;p&gt;Alright!&lt;/p&gt;

&lt;p&gt;There are two issues in the troubled CDCR test :&lt;/p&gt;

&lt;p&gt;1. Why bootstrap is called two seperate times in single life cycle&lt;/p&gt;

&lt;p&gt;-&amp;gt; first time bootstrap is called when we enable CDCR, and 1000 documents are boostrapped to target&lt;/p&gt;

&lt;p&gt;-&amp;gt; the second one is when bootstrapping is happening in background and new updates are getting shoved down to source. Once the first boostrap is successfully completed, target sees (I speculate) it is much behind and issues bootstrap again, which I don&apos;t really understand and putting extra logging doesn&apos;t really helps too. I am seeing more. OR all this is wrong, and boostrap is happening just one time in a weird manner.&lt;/p&gt;

&lt;p&gt;-&amp;gt; as above listed, the first bootstrap and indexing into source cluster happens simulteneouly at one point. How it is suppose to behave that time.&lt;/p&gt;

&lt;p&gt;according to code: CdcrRequestHandler:BootstrapCallable:call()::&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;........
 @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt; call() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
      &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; success = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
      Throwable exception = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
      UpdateLog ulog = core.getUpdateHandler().getUpdateLog();
      &lt;span class=&quot;code-comment&quot;&gt;// we start buffering updates as a safeguard however we &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; not expect
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// to receive any updates from the source during bootstrap
&lt;/span&gt;      ulog.bufferUpdates();
      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        commitOnLeader(masterUrl);
........
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2. Why bootstrap issues at the second time (if it is) fails miserably&lt;/p&gt;

&lt;p&gt;-&amp;gt; when the bootstrap is issued, it calls boostrapCallable to apply buffer updates and if &quot;fetchIndex is not successful OR boostrapCallable is closed&quot;, drop those updates from UpdateLog in &lt;tt&gt;finally&lt;/tt&gt; block&lt;/p&gt;

&lt;p&gt;-&amp;gt; in this case, when bootstrap gets issued :: it checks whether it can get the LOCK ::&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void handleBootstrapAction(SolrQueryRequest req, SolrQueryResponse rsp) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException, SolrServerException {
    .......................

    &lt;span class=&quot;code-object&quot;&gt;Runnable&lt;/span&gt; runnable = () -&amp;gt; {
      Lock recoveryLock = req.getCore().getSolrCoreState().getRecoveryLock();
      &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; locked = recoveryLock.tryLock();
      SolrCoreState coreState = core.getSolrCoreState();
      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!locked)  {
          log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;we reached &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; point :: CANCEL BOOTSTRAP, locked :: &quot;&lt;/span&gt; + locked);
          handleCancelBootstrap(req, rsp);
        } 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and if not, it issues CANCEL BOOTSTRAP, which happend exactly in this case. CANCEL_BOOSTRAP is issued and applied QUIETLY.&lt;/p&gt;

&lt;p&gt;-&amp;gt;  in the background within the bootstrap,  applyBufferUpdates, in ulog, &lt;tt&gt;tlog&lt;/tt&gt; is mysteriously NULL, suggesting no updates were recieved, umm why? and return bootstrapFuture as null and set the STATE of replication as ACTIVE.&lt;/p&gt;

&lt;p&gt;according to code :: UpdatesLog.java ::&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;/** Returns the Future to wait on, or &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; no replay was needed */&lt;/span&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Future&amp;lt;RecoveryInfo&amp;gt; applyBufferedUpdates() {
    &lt;span class=&quot;code-comment&quot;&gt;// recovery trips &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; under some race - even when
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// it checks the state first
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; state == State.BUFFERING;
&lt;/span&gt;
    &lt;span class=&quot;code-comment&quot;&gt;// block all updates to eliminate race conditions
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// reading state and acting on it in the update processor
&lt;/span&gt;    versionInfo.blockUpdates();
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
      cancelApplyBufferUpdate = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
      log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;applyBufferedUpdates :: state :: start :: &quot;&lt;/span&gt; + state);
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (state != State.BUFFERING){
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
      }
      operationFlags &amp;amp;= ~FLAG_GAP;

      &lt;span class=&quot;code-comment&quot;&gt;// handle &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; when no log was even created because no updates
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// were received.
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (tlog == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;applyBufferedUpdates :: state :: middle 1 :: &quot;&lt;/span&gt; + state);
        state = State.ACTIVE;
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
      }
      log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;applyBufferedUpdates :: state :: middle 2 :: &quot;&lt;/span&gt; + state);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;-&amp;gt; now in finally block, the fetchIndex is successfull but &quot;closed&quot; is true (DUE TO CANCEL BOOTSTRAP apprently) which is initialised to false:: it tries to drop the buffer updates from ulog where ::&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &lt;span class=&quot;code-comment&quot;&gt;/** Returns &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; we were able to drop buffered updates and &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; to the ACTIVE state */&lt;/span&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; dropBufferedUpdates() {
    versionInfo.blockUpdates();
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
      log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;dropBufferedUpdates :: state :: start &quot;&lt;/span&gt; + state);
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (state != State.BUFFERING){
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
      }
.......
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;STATE is ACTIVE and returns &lt;tt&gt;false&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;faling the &quot;assert dropped&quot; in BootstrapCallable and eventually emitting: &quot;bootstrap operation failed&quot;.&lt;/p&gt;

&lt;p&gt;Once bootstrap fails, in CdcrBootsrapTest::waitTargetToSync :: it waits for 120 seconds, and recieves constant numFound from target, == 1000 / 1001 / 1100, any number basically before boostrap failed and eventually Assertion at CdcrBootsrapTest fails.&lt;/p&gt;

&lt;p&gt;There are still some unanswered questions like:&lt;/p&gt;

&lt;p&gt;1. Why in the first place two boostrap command are issued OR we think we two are issued and it one wrapped up in an awkward life time. Why the conventional forwarding not happening?&lt;br/&gt;
2. When it tries to drop the buffer updates, why the tlog is null? It has recieved updates from source, but why it is NULL in target cluster. Is there a synchrnization issue?&lt;/p&gt;

&lt;p&gt;so the matter of the question is this lock ::&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Lock recoveryLock = req.getCore().getSolrCoreState().getRecoveryLock();
      &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; locked = recoveryLock.tryLock();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;More insights will be deeply appreciated. I believe we are very close.&lt;/p&gt;</comment>
                            <comment id="16150771" author="sarkaramrit2@gmail.com" created="Fri, 1 Sep 2017 16:01:08 +0000"  >&lt;p&gt;Confirmed there are two seperate bootstrap threads initiated, one acquires lock, one fails ::&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[beaster]   2&amp;gt; 34430 INFO  (updateExecutor-39-thread-1-processing-n:127.0.0.1:35690_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) [n:127.0.0.1:35690_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.CdcrRequestHandler what&apos; the lock &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; time :: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
  [beaster]   2&amp;gt; 34431 INFO  (qtp510024884-173) [n:127.0.0.1:35690_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.c.S.Request [cdcr-target_shard1_replica_n1]  webapp=/solr path=/cdcr params={qt=/cdcr&amp;amp;masterUrl=http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:38721/solr/cdcr-source_shard1_replica_n1/&amp;amp;action=BOOTSTRAP&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=10
&lt;/span&gt;  [beaster]   2&amp;gt; 34432 INFO  (qtp600983226-216) [n:127.0.0.1:38721_solr c:cdcr-source s:shard1 r:core_node2 x:cdcr-source_shard1_replica_n1] o.a.s.c.S.Request [cdcr-source_shard1_replica_n1]  webapp=/solr path=/update params={_stateVer_=cdcr-source:4&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=13
  [beaster]   2&amp;gt; 34433 INFO  (updateExecutor-39-thread-2-processing-n:127.0.0.1:35690_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) [n:127.0.0.1:35690_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.CdcrRequestHandler what&apos; the lock &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; time :: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;tt&gt;updateExecutor-39-thread-1-processing&lt;/tt&gt;.....&lt;br/&gt;
&lt;tt&gt;updateExecutor-39-thread-2-processing&lt;/tt&gt;.....&lt;/p&gt;

&lt;p&gt;There are only three lines printed (two added for extensive logging) for &lt;tt&gt;updateExecutor-39-thread-2-processing&lt;/tt&gt;, why? and why it is introduced at first place.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  [beaster]   2&amp;gt; 34433 INFO  (updateExecutor-39-thread-2-processing-n:127.0.0.1:35690_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) [n:127.0.0.1:35690_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.CdcrRequestHandler what&apos; the lock &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; time :: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
  [beaster]   2&amp;gt; 34433 INFO  (updateExecutor-39-thread-2-processing-n:127.0.0.1:35690_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) [n:127.0.0.1:35690_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.CdcrRequestHandler we reached &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; point :: CANCEL BOOTSTRAP, locked :: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
  [beaster]   2&amp;gt; 34433 INFO  (updateExecutor-39-thread-2-processing-n:127.0.0.1:35690_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) [n:127.0.0.1:35690_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.CdcrRequestHandler someone called me, yes they did
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;My best guess :&lt;/p&gt;

&lt;p&gt;See after &lt;tt&gt;updateExecutor-39-thread-1-processing&lt;/tt&gt; gets the lock and invoke BOOTSTRAP api. An update is received on &lt;tt&gt;source&lt;/tt&gt; collection and right after that another &lt;b&gt;&quot;updateExecutor-39-thread-2-processing&quot;&lt;/b&gt; is invoked trying to acquire the lock and eventually when it fails, invoke CANCEL_BOOTSTRAP, creating chaos.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;The fine time frame b/w INVOKING bootstrap, CHANGING bootstrap status to running and RECEIVING a new update on source is creating confusion/chaos, as handleBootrapStatus is runnable thread, so more than one can gets invoked.&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;Got the cause, need the solution.&lt;/p&gt;</comment>
                            <comment id="16150879" author="sarkaramrit2@gmail.com" created="Fri, 1 Sep 2017 17:32:48 +0000"  >&lt;p&gt;Another example, why two simultaneous threads are getting created to invoke BOOTSTRAP?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  [beaster]   2&amp;gt; 38858 INFO  (updateExecutor-39-thread-1-processing-n:127.0.0.1:42155_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) [n:127.0.0.1:42155_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.CdcrRequestHandler what&apos; the lock &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; time :: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; :: thread :: org.apache.solr.handler.CdcrRequestHandler@64d1ccf3
  [beaster]   2&amp;gt; 38858 INFO  (qtp1415866434-168) [n:127.0.0.1:42155_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.c.S.Request [cdcr-target_shard1_replica_n1]  webapp=/solr path=/cdcr params={qt=/cdcr&amp;amp;action=BOOTSTRAP_STATUS&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=0
  [beaster]   2&amp;gt; 38859 WARN  (cdcr-bootstrap-status-66-thread-1-processing-n:127.0.0.1:36193_solr x:cdcr-source_shard1_replica_n1 s:shard1 c:cdcr-source r:core_node2) [n:127.0.0.1:36193_solr c:cdcr-source s:shard1 r:core_node2 x:cdcr-source_shard1_replica_n1] o.a.s.h.CdcrReplicatorManager Bootstrap process was not found on target collection: cdcr-target shard: shard1, leader: http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:42155/solr/cdcr-target_shard1_replica_n1/
&lt;/span&gt;  [beaster]   2&amp;gt; 38860 INFO  (cdcr-bootstrap-status-66-thread-1-processing-n:127.0.0.1:36193_solr x:cdcr-source_shard1_replica_n1 s:shard1 c:cdcr-source r:core_node2) [n:127.0.0.1:36193_solr c:cdcr-source s:shard1 r:core_node2 x:cdcr-source_shard1_replica_n1] o.a.s.h.CdcrReplicatorManager Attempting to bootstrap target collection: cdcr-target shard: shard1 leader: http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:42155/solr/cdcr-target_shard1_replica_n1/
&lt;/span&gt;  [beaster]   2&amp;gt; 38860 INFO  (qtp1415866434-173) [n:127.0.0.1:42155_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.CdcrRequestHandler Boostrap is issued now. Request :: {action=BOOTSTRAP&amp;amp;qt=/cdcr&amp;amp;masterUrl=http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:36193/solr/cdcr-source_shard1_replica_n1/&amp;amp;wt=javabin&amp;amp;version=2} : collection : cdcr-target
&lt;/span&gt;  [beaster]   2&amp;gt; 38865 INFO  (recoveryExecutor-40-thread-1-processing-n:127.0.0.1:42155_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) [n:127.0.0.1:42155_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.u.UpdateLog Starting to buffer updates. FSUpdateLog{state=ACTIVE, tlog=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}
  [beaster]   2&amp;gt; 38865 INFO  (qtp1415866434-173) [n:127.0.0.1:42155_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.c.S.Request [cdcr-target_shard1_replica_n1]  webapp=/solr path=/cdcr params={qt=/cdcr&amp;amp;masterUrl=http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:36193/solr/cdcr-source_shard1_replica_n1/&amp;amp;action=BOOTSTRAP&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=4
&lt;/span&gt;  [beaster]   2&amp;gt; 38865 INFO  (updateExecutor-39-thread-2-processing-n:127.0.0.1:42155_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) [n:127.0.0.1:42155_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.CdcrRequestHandler what&apos; the lock &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; time :: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; :: thread :: org.apache.solr.handler.CdcrRequestHandler@64d1ccf3
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;the code is like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void handleBootstrapAction(SolrQueryRequest req, SolrQueryResponse rsp) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException, SolrServerException {
...................
...................
    &lt;span class=&quot;code-object&quot;&gt;Runnable&lt;/span&gt; runnable = () -&amp;gt; {
      Lock recoveryLock = req.getCore().getSolrCoreState().getRecoveryLock();
      &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; locked = recoveryLock.tryLock();
      log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;what&apos; the lock &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; time :: &quot;&lt;/span&gt; + locked + &lt;span class=&quot;code-quote&quot;&gt;&quot; :: thread :: &quot;&lt;/span&gt; + &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;);
      SolrCoreState coreState = core.getSolrCoreState();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16150889" author="sarkaramrit2@gmail.com" created="Fri, 1 Sep 2017 17:36:38 +0000"  >&lt;p&gt;Uploading patch I used for testing:: master-bs.patch&lt;/p&gt;</comment>
                            <comment id="16151552" author="erickerickson" created="Sat, 2 Sep 2017 17:40:37 +0000"  >&lt;p&gt;I just ran the patch against 7x with two different modes:&lt;/p&gt;

&lt;p&gt;1&amp;gt; the original patch x 100&lt;br/&gt;
2&amp;gt; removed the three second wait in the test case x 250&lt;/p&gt;

&lt;p&gt;&amp;lt;1&amp;gt; had no errors&lt;br/&gt;
&amp;lt;2&amp;gt; had one error, not the same one and I haven&apos;t pursued it yet, excerpt below. I have the full test case. I&apos;m going to put the 3 second wait back in and try 1,000 iterations to see if this error occurs again.&lt;/p&gt;

&lt;p&gt;NOTE: I don&apos;t think then sleep is something we &lt;em&gt;want&lt;/em&gt; to leave in the code, just seeing if it alters the results for a clue where to look next.&lt;/p&gt;

&lt;p&gt;This is good progress! Oh, I haven&apos;t reviewed the patch in detail yet either, just trying to get a sense of what the behavior is before diving in.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 49759 INFO  (Thread-83) &lt;span class=&quot;error&quot;&gt;&amp;#91;n:127.0.0.1:59962_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1&amp;#93;&lt;/span&gt; o.a.s.c.SolrCore &lt;span class=&quot;error&quot;&gt;&amp;#91;cdcr-target_shard1_replica_n1&amp;#93;&lt;/span&gt;  CLOSING SolrCore org.apache.solr.core.SolrCore@2fdc6dad&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 49759 INFO  (Thread-83) &lt;span class=&quot;error&quot;&gt;&amp;#91;n:127.0.0.1:59962_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1&amp;#93;&lt;/span&gt; o.a.s.m.SolrMetricManager Closing metric reporters for registry=solr.core.cdcr-target.shard1.replica_n1, tag=802975149&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 49759 INFO  (Thread-83) &lt;span class=&quot;error&quot;&gt;&amp;#91;n:127.0.0.1:59962_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1&amp;#93;&lt;/span&gt; o.a.s.m.r.SolrJmxReporter Closing reporter &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.solr.metrics.reporters.SolrJmxReporter@7b017431: rootName = solr_59962, domain = solr.core.cdcr-target.shard1.replica_n1, service url = null, agent id = null&amp;#93;&lt;/span&gt; for registry solr.core.cdcr-target.shard1.replica_n1 / com.codahale.metrics.MetricRegistry@67a56b63&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 49760 INFO  (searcherExecutor-150-thread-1-processing-n:127.0.0.1:59962_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) &lt;span class=&quot;error&quot;&gt;&amp;#91;n:127.0.0.1:59962_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1&amp;#93;&lt;/span&gt; o.a.s.c.SolrCore &lt;span class=&quot;error&quot;&gt;&amp;#91;cdcr-target_shard1_replica_n1&amp;#93;&lt;/span&gt; Registered new searcher Searcher@51a42485&lt;span class=&quot;error&quot;&gt;&amp;#91;cdcr-target_shard1_replica_n1&amp;#93;&lt;/span&gt; main&lt;/p&gt;
{ExitableDirectoryReader(UninvertingDirectoryReader(Uninverting(_k(7.1.0):C1900) Uninverting(_l(7.1.0):C100)))}
&lt;p&gt;   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 49774 INFO  (Thread-83) &lt;span class=&quot;error&quot;&gt;&amp;#91;n:127.0.0.1:59962_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1&amp;#93;&lt;/span&gt; o.a.s.m.SolrMetricManager Closing metric reporters for registry=solr.collection.cdcr-target.shard1.leader, tag=802975149&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 49775 INFO  (Thread-83) &lt;span class=&quot;error&quot;&gt;&amp;#91;n:127.0.0.1:59962_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1&amp;#93;&lt;/span&gt; o.a.s.h.CdcrRequestHandler Solr core is being closed - shutting down CDCR handler @ cdcr-target:shard1&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 62525 ERROR (Thread-83) &lt;span class=&quot;error&quot;&gt;&amp;#91;n:127.0.0.1:59962_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1&amp;#93;&lt;/span&gt; o.a.s.c.CachingDirectoryFactory Timeout waiting for all directory ref counts to be released - gave up waiting on CachedDir&amp;lt;&amp;lt;refCount=1;path=/Users/Erick/apache/solrJiras/beast/results/beast-tmp/203/J0/temp/solr.cloud.CdcrBootstrapTest_DCBEC103DFB44964-001/cdcr-target-003/node1/./cdcr-target_shard1_replica_n1/data/index.20170902102657976;done=false&amp;gt;&amp;gt;&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 62526 ERROR (Thread-83) &lt;span class=&quot;error&quot;&gt;&amp;#91;n:127.0.0.1:59962_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1&amp;#93;&lt;/span&gt; o.a.s.c.CachingDirectoryFactory Error closing directory:org.apache.solr.common.SolrException: Timeout waiting for all directory ref counts to be released - gave up waiting on CachedDir&amp;lt;&amp;lt;refCount=1;path=/Users/Erick/apache/solrJiras/beast/results/beast-tmp/203/J0/temp/solr.cloud.CdcrBootstrapTest_DCBEC103DFB44964-001/cdcr-target-003/node1/./cdcr-target_shard1_replica_n1/data/index.20170902102657976;done=false&amp;gt;&amp;gt;&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 	at org.apache.solr.core.CachingDirectoryFactory.close(CachingDirectoryFactory.java:178)&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 	at org.apache.solr.core.SolrCore.close(SolrCore.java:1613)&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 	at org.apache.solr.core.CoreContainer.registerCore(CoreContainer.java:859)&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 	at org.apache.solr.core.CoreContainer.reload(CoreContainer.java:1232)&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 	at org.apache.solr.handler.IndexFetcher.lambda$reloadCore$0(IndexFetcher.java:900)&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 	at java.lang.Thread.run(Thread.java:745)&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; &lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 75243 ERROR (Thread-83) &lt;span class=&quot;error&quot;&gt;&amp;#91;n:127.0.0.1:59962_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1&amp;#93;&lt;/span&gt; o.a.s.c.CachingDirectoryFactory Timeout waiting for all directory ref counts to be released - gave up waiting on CachedDir&amp;lt;&amp;lt;refCount=1;path=/Users/Erick/apache/solrJiras/beast/results/beast-tmp/203/J0/temp/solr.cloud.CdcrBootstrapTest_DCBEC103DFB44964-001/cdcr-target-003/node1/./cdcr-target_shard1_replica_n1/data/index;done=false&amp;gt;&amp;gt;&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 75243 ERROR (Thread-83) &lt;span class=&quot;error&quot;&gt;&amp;#91;n:127.0.0.1:59962_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1&amp;#93;&lt;/span&gt; o.a.s.c.CachingDirectoryFactory Error closing directory:org.apache.solr.common.SolrException: Timeout waiting for all directory ref counts to be released - gave up waiting on CachedDir&amp;lt;&amp;lt;refCount=1;path=/Users/Erick/apache/solrJiras/beast/results/beast-tmp/203/J0/temp/solr.cloud.CdcrBootstrapTest_DCBEC103DFB44964-001/cdcr-target-003/node1/./cdcr-target_shard1_replica_n1/data/index;done=false&amp;gt;&amp;gt;&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 	at org.apache.solr.core.CachingDirectoryFactory.close(CachingDirectoryFactory.java:178)&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 	at org.apache.solr.core.SolrCore.close(SolrCore.java:1613)&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 	at org.apache.solr.core.CoreContainer.registerCore(CoreContainer.java:859)&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 	at org.apache.solr.core.CoreContainer.reload(CoreContainer.java:1232)&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 	at org.apache.solr.handler.IndexFetcher.lambda$reloadCore$0(IndexFetcher.java:900)&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 	at java.lang.Thread.run(Thread.java:745)&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; &lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 75244 ERROR (Thread-83) &lt;span class=&quot;error&quot;&gt;&amp;#91;n:127.0.0.1:59962_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1&amp;#93;&lt;/span&gt; o.a.s.c.SolrCore java.lang.AssertionError: 1&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 	at org.apache.solr.core.CachingDirectoryFactory.close(CachingDirectoryFactory.java:192)&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 	at org.apache.solr.core.SolrCore.close(SolrCore.java:1613)&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 	at org.apache.solr.core.CoreContainer.registerCore(CoreContainer.java:859)&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 	at org.apache.solr.core.CoreContainer.reload(CoreContainer.java:1232)&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 	at org.apache.solr.handler.IndexFetcher.lambda$reloadCore$0(IndexFetcher.java:900)&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 	at java.lang.Thread.run(Thread.java:745)&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; &lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 75245 ERROR (recoveryExecutor-81-thread-1-processing-n:127.0.0.1:59962_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) &lt;span class=&quot;error&quot;&gt;&amp;#91;n:127.0.0.1:59962_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1&amp;#93;&lt;/span&gt; o.a.s.h.ReplicationHandler Index fetch failed :org.apache.solr.common.SolrException: Index fetch failed : &lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 	at org.apache.solr.handler.IndexFetcher.fetchLatestIndex(IndexFetcher.java:655)&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 	at org.apache.solr.handler.IndexFetcher.fetchLatestIndex(IndexFetcher.java:332)&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 	at org.apache.solr.handler.ReplicationHandler.doFetch(ReplicationHandler.java:419)&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 	at org.apache.solr.handler.CdcrRequestHandler$BootstrapCallable.call(CdcrRequestHandler.java:773)&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 	at org.apache.solr.handler.CdcrRequestHandler$BootstrapCallable.call(CdcrRequestHandler.java:724)&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 	at com.codahale.metrics.InstrumentedExecutorService$InstrumentedCallable.call(InstrumentedExecutorService.java:197)&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 	at java.util.concurrent.FutureTask.run(FutureTask.java:266)&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 	at org.apache.solr.common.util.ExecutorUtil$MDCAwareThreadPoolExecutor.lambda$execute$0(ExecutorUtil.java:188)&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 	at java.lang.Thread.run(Thread.java:745)&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; Caused by: java.lang.NullPointerException&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 	at org.apache.solr.handler.IndexFetcher.openNewSearcherAndUpdateCommitPoint(IndexFetcher.java:888)&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 	at org.apache.solr.handler.IndexFetcher.fetchLatestIndex(IndexFetcher.java:632)&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 	... 10 more&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; &lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;   2&amp;gt; 75245 INFO  (recoveryExecutor-81-thread-1-processing-n:127.0.0.1:59962_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) &lt;span class=&quot;error&quot;&gt;&amp;#91;n:127.0.0.1:59962_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1&amp;#93;&lt;/span&gt; o.a.s.h.CdcrRequestHandler boostrap cal&lt;/p&gt;
</comment>
                            <comment id="16151569" author="sarkaramrit2@gmail.com" created="Sat, 2 Sep 2017 19:35:15 +0000"  >&lt;p&gt;Thanks Erick, I was also seeing that NPE earlier, but after Shalin&apos;s patch I didn&apos;t came across it again.&lt;/p&gt;

&lt;p&gt;Meanwhile I am also running a beaster: &lt;tt&gt;ant beast -Dbeast.iters=100 -Dtestcase=CdcrBootstrapTest -Dtests.dups=2 -Dtests.iters=2&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;I think we should put &lt;tt&gt;AwaitsFix(...)&lt;/tt&gt; if the problem is only with: &lt;em&gt;testBootstrapWithContinousIndexingOnSourceCluster&lt;/em&gt; to give us some cushion to work upon it. if we are seeing the same issue with other testMethods, we can ignore the entire test, whatever&apos;s best. I have uploaded AwaitsFix patch. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt; please do the necessary.&lt;/p&gt;</comment>
                            <comment id="16152103" author="jira-bot" created="Mon, 4 Sep 2017 04:13:06 +0000"  >&lt;p&gt;Commit e782082e711286a4c1a6ca101a9fa11bafab7b0d in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e782082&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e782082&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11278&quot; title=&quot;Fix race in cdcr bootstrap process&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11278&quot;&gt;&lt;del&gt;SOLR-11278&lt;/del&gt;&lt;/a&gt;: Disable frequently failing method with AwaitsFix&lt;/p&gt;</comment>
                            <comment id="16152105" author="jira-bot" created="Mon, 4 Sep 2017 04:13:50 +0000"  >&lt;p&gt;Commit f8906b6533bc2c3f4aebe48d3caa93a9634f6a31 in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f8906b6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=f8906b6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11278&quot; title=&quot;Fix race in cdcr bootstrap process&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11278&quot;&gt;&lt;del&gt;SOLR-11278&lt;/del&gt;&lt;/a&gt;: Disable frequently failing method with AwaitsFix&lt;/p&gt;

&lt;p&gt;(cherry picked from commit e782082)&lt;/p&gt;</comment>
                            <comment id="16152106" author="jira-bot" created="Mon, 4 Sep 2017 04:14:30 +0000"  >&lt;p&gt;Commit b6cbf75d003bff603d8a2a5fe67de841be7b1e78 in lucene-solr&apos;s branch refs/heads/branch_7_0 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b6cbf75&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b6cbf75&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11278&quot; title=&quot;Fix race in cdcr bootstrap process&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11278&quot;&gt;&lt;del&gt;SOLR-11278&lt;/del&gt;&lt;/a&gt;: Disable frequently failing method with AwaitsFix&lt;/p&gt;

&lt;p&gt;(cherry picked from commit e782082)&lt;/p&gt;

&lt;p&gt;(cherry picked from commit f8906b6)&lt;/p&gt;</comment>
                            <comment id="16153335" author="sarkaramrit2@gmail.com" created="Tue, 5 Sep 2017 09:11:37 +0000"  >&lt;p&gt;More detailing,&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  [beaster]   2&amp;gt; 76078 INFO  (zkCallback-171-thread-1-processing-n:127.0.0.1:39903_solr) [n:127.0.0.1:39903_solr    ] o.a.s.h.CdcrProcessStateManager Received &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CDCR process state from watcher: STARTED @ cdcr-source:shard1
  [beaster]   2&amp;gt; 76079 INFO  (qtp499216332-625) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.CdcrRequestHandler Boostrap is issued now. Request :: {action=BOOTSTRAP&amp;amp;qt=/cdcr&amp;amp;masterUrl=http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:39903/solr/cdcr-source_shard1_replica_n1/&amp;amp;wt=javabin&amp;amp;version=2} : collection : cdcr-target
&lt;/span&gt;  [beaster]   2&amp;gt; 76079 INFO  (qtp499216332-625) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.CdcrRequestHandler bs runnable : org.apache.solr.handler.CdcrRequestHandler$$Lambda$256/1608384375@cfd51e6
  [beaster]   2&amp;gt; 76079 INFO  (qtp499216332-625) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.CdcrRequestHandler bs service : com.codahale.metrics.InstrumentedExecutorService@23aae09
  [beaster]   2&amp;gt; 76079 INFO  (qtp499216332-625) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.c.S.Request [cdcr-target_shard1_replica_n1]  webapp=/solr path=/cdcr params={qt=/cdcr&amp;amp;masterUrl=http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:39903/solr/cdcr-source_shard1_replica_n1/&amp;amp;action=BOOTSTRAP&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=0
&lt;/span&gt;  [beaster]   2&amp;gt; 76079 INFO  (qtp1089963867-718) [n:127.0.0.1:39903_solr c:cdcr-source s:shard1 r:core_node2 x:cdcr-source_shard1_replica_n1] o.a.s.c.S.Request [cdcr-source_shard1_replica_n1]  webapp=/solr path=/cdcr params={qt=/cdcr&amp;amp;_stateVer_=cdcr-source:7&amp;amp;action=queues&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=0
  [beaster]   1&amp;gt; Cdcr queue response: {responseHeader={status=0,QTime=0},queues={127.0.0.1:37043/solr={cdcr-target={queueSize=-1703936001,lastTimestamp=}}},tlogTotalSize=4773,tlogTotalCount=1,updateLogSynchronizer=stopped}
  [beaster]   2&amp;gt; 76081 INFO  (qtp499216332-629) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.u.DirectUpdateHandler2 start commit{_version_=1577620265858236416,optimize=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,openSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,waitSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,expungeDeletes=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,softCommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,prepareCommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;}
  [beaster]   2&amp;gt; 76082 INFO  (qtp499216332-629) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.u.DirectUpdateHandler2 No uncommitted changes. Skipping IW.commit.
  [beaster]   2&amp;gt; 76082 INFO  (updateExecutor-143-thread-1-processing-n:127.0.0.1:42370_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.CdcrRequestHandler what the fuck is happening :: &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[updateExecutor-143-thread-1-processing-n:127.0.0.1:42370_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2,5,TGRP-CdcrBootstrapTest]
  [beaster]   2&amp;gt; 76083 INFO  (updateExecutor-143-thread-1-processing-n:127.0.0.1:42370_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.CdcrRequestHandler what&apos; the lock &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; time :: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; :: thread :: org.apache.solr.handler.CdcrRequestHandler@259eac66
  [beaster]   2&amp;gt; 76083 INFO  (updateExecutor-143-thread-1-processing-n:127.0.0.1:42370_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.CdcrRequestHandler we reached &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; point :: BOOTSTRAP will go on, locked :: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
  [beaster]   2&amp;gt; 76083 INFO  (qtp499216332-628) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.c.S.Request [cdcr-target_shard1_replica_n1]  webapp=/solr path=/cdcr params={qt=/cdcr&amp;amp;action=BOOTSTRAP_STATUS&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=0
  [beaster]   2&amp;gt; 76082 INFO  (qtp499216332-629) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.u.DirectUpdateHandler2 end_commit_flush
  [beaster]   2&amp;gt; 76083 INFO  (qtp499216332-629) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.c.S.Request [cdcr-target_shard1_replica_n1]  webapp=/solr path=/update params={_stateVer_=cdcr-target:4&amp;amp;waitSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;commit=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;softCommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=2
  [beaster]   2&amp;gt; 76084 WARN  (cdcr-bootstrap-status-177-thread-1-processing-n:127.0.0.1:39903_solr x:cdcr-source_shard1_replica_n1 s:shard1 c:cdcr-source r:core_node2) [n:127.0.0.1:39903_solr c:cdcr-source s:shard1 r:core_node2 x:cdcr-source_shard1_replica_n1] o.a.s.h.CdcrReplicatorManager Bootstrap process was not found on target collection: cdcr-target shard: shard1, leader: http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:42370/solr/cdcr-target_shard1_replica_n1/
&lt;/span&gt;  [beaster]   2&amp;gt; 76085 INFO  (qtp499216332-623) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.c.S.Request [cdcr-target_shard1_replica_n1]  webapp=/solr path=/select params={q=*:*&amp;amp;_stateVer_=cdcr-target:4&amp;amp;wt=javabin&amp;amp;version=2} hits=0 status=0 QTime=0
  [beaster]   2&amp;gt; 76085 INFO  (TEST-CdcrBootstrapTest.testConvertClusterToCdcrAndBootstrap-seed#[950E76D71DFD418]) [    ] o.a.s.c.CdcrBootstrapTest numDocs found &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; now :: 1 :: 0
  [beaster]   2&amp;gt; 76085 INFO  (recoveryExecutor-144-thread-1-processing-n:127.0.0.1:42370_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.u.UpdateLog Starting to buffer updates. FSUpdateLog{state=ACTIVE, tlog=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}
  [beaster]   2&amp;gt; 76092 INFO  (cdcr-bootstrap-status-177-thread-1-processing-n:127.0.0.1:39903_solr x:cdcr-source_shard1_replica_n1 s:shard1 c:cdcr-source r:core_node2) [n:127.0.0.1:39903_solr c:cdcr-source s:shard1 r:core_node2 x:cdcr-source_shard1_replica_n1] o.a.s.h.CdcrReplicatorManager Attempting to bootstrap target collection: cdcr-target shard: shard1 leader: http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:42370/solr/cdcr-target_shard1_replica_n1/
&lt;/span&gt;  [beaster]   2&amp;gt; 76093 INFO  (qtp499216332-627) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.CdcrRequestHandler Boostrap is issued now. Request :: {action=BOOTSTRAP&amp;amp;qt=/cdcr&amp;amp;masterUrl=http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:39903/solr/cdcr-source_shard1_replica_n1/&amp;amp;wt=javabin&amp;amp;version=2} : collection : cdcr-target
&lt;/span&gt;  [beaster]   2&amp;gt; 76093 INFO  (qtp499216332-627) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.CdcrRequestHandler bs runnable : org.apache.solr.handler.CdcrRequestHandler$$Lambda$256/1608384375@785b9b5f
  [beaster]   2&amp;gt; 76093 INFO  (qtp499216332-627) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.CdcrRequestHandler bs service : com.codahale.metrics.InstrumentedExecutorService@23aae09
  [beaster]   2&amp;gt; 76094 INFO  (qtp1089963867-721) [n:127.0.0.1:39903_solr c:cdcr-source s:shard1 r:core_node2 x:cdcr-source_shard1_replica_n1] o.a.s.u.DirectUpdateHandler2 start commit{_version_=1577620265871867904,optimize=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,openSearcher=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,waitSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;,expungeDeletes=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,softCommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,prepareCommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;}
  [beaster]   2&amp;gt; 76094 INFO  (qtp499216332-627) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.c.S.Request [cdcr-target_shard1_replica_n1]  webapp=/solr path=/cdcr params={qt=/cdcr&amp;amp;masterUrl=http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:39903/solr/cdcr-source_shard1_replica_n1/&amp;amp;action=BOOTSTRAP&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=0
&lt;/span&gt;  [beaster]   2&amp;gt; 76100 INFO  (qtp1089963867-721) [n:127.0.0.1:39903_solr c:cdcr-source s:shard1 r:core_node2 x:cdcr-source_shard1_replica_n1] o.a.s.u.DirectUpdateHandler2 No uncommitted changes. Skipping IW.commit.
  [beaster]   2&amp;gt; 76101 INFO  (qtp1089963867-721) [n:127.0.0.1:39903_solr c:cdcr-source s:shard1 r:core_node2 x:cdcr-source_shard1_replica_n1] o.a.s.u.DirectUpdateHandler2 end_commit_flush
  [beaster]   2&amp;gt; 76102 INFO  (qtp1089963867-721) [n:127.0.0.1:39903_solr c:cdcr-source s:shard1 r:core_node2 x:cdcr-source_shard1_replica_n1] o.a.s.c.S.Request [cdcr-source_shard1_replica_n1]  webapp=/solr path=/update params={waitSearcher=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;openSearcher=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;commit=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;softCommit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;commit_end_point=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=8
  [beaster]   2&amp;gt; 76102 INFO  (recoveryExecutor-144-thread-1-processing-n:127.0.0.1:42370_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.CdcrRequestHandler boostrap callable closed :: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
  [beaster]   2&amp;gt; 76104 INFO  (updateExecutor-143-thread-2-processing-n:127.0.0.1:42370_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.CdcrRequestHandler what the fuck is happening :: &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[updateExecutor-143-thread-2-processing-n:127.0.0.1:42370_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2,5,TGRP-CdcrBootstrapTest]
  [beaster]   2&amp;gt; 76104 INFO  (updateExecutor-143-thread-2-processing-n:127.0.0.1:42370_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.CdcrRequestHandler what&apos; the lock &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; time :: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; :: thread :: org.apache.solr.handler.CdcrRequestHandler@259eac66
  [beaster]   2&amp;gt; 76104 INFO  (updateExecutor-143-thread-2-processing-n:127.0.0.1:42370_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.CdcrRequestHandler we reached &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; point :: CANCEL BOOTSTRAP, locked :: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
  [beaster]   2&amp;gt; 76104 INFO  (updateExecutor-143-thread-2-processing-n:127.0.0.1:42370_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.CdcrRequestHandler someone called me, yes they did
  [beaster]   2&amp;gt; 76104 INFO  (qtp1089963867-722) [n:127.0.0.1:39903_solr c:cdcr-source s:shard1 r:core_node2 x:cdcr-source_shard1_replica_n1] o.a.s.c.S.Request [cdcr-source_shard1_replica_n1]  webapp=/solr path=/replication params={qt=/replication&amp;amp;wt=javabin&amp;amp;version=2&amp;amp;command=indexversion} status=0 QTime=0
  [beaster]   2&amp;gt; 76104 INFO  (recoveryExecutor-144-thread-1-processing-n:127.0.0.1:42370_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.IndexFetcher Master&apos;s generation: 12
  [beaster]   2&amp;gt; 76104 INFO  (recoveryExecutor-144-thread-1-processing-n:127.0.0.1:42370_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.IndexFetcher Master&apos;s version: 1504535923111
  [beaster]   2&amp;gt; 76105 INFO  (recoveryExecutor-144-thread-1-processing-n:127.0.0.1:42370_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.IndexFetcher Slave&apos;s generation: 1
  [beaster]   2&amp;gt; 76105 INFO  (recoveryExecutor-144-thread-1-processing-n:127.0.0.1:42370_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.IndexFetcher Slave&apos;s version: 0
  [beaster]   2&amp;gt; 76105 INFO  (recoveryExecutor-144-thread-1-processing-n:127.0.0.1:42370_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.IndexFetcher Starting replication process
  [beaster]   2&amp;gt; 76111 INFO  (qtp1089963867-722) [n:127.0.0.1:39903_solr c:cdcr-source s:shard1 r:core_node2 x:cdcr-source_shard1_replica_n1] o.a.s.h.ReplicationHandler Adding tlog files to list: [{size=4773, name=tlog.0000000000000000009}]
  [beaster]   2&amp;gt; 76111 INFO  (qtp1089963867-722) [n:127.0.0.1:39903_solr c:cdcr-source s:shard1 r:core_node2 x:cdcr-source_shard1_replica_n1] o.a.s.c.S.Request [cdcr-source_shard1_replica_n1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;wt=javabin&amp;amp;version=2&amp;amp;command=filelist} status=0 QTime=5
  [beaster]   2&amp;gt; 76111 INFO  (recoveryExecutor-144-thread-1-processing-n:127.0.0.1:42370_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.IndexFetcher &lt;span class=&quot;code-object&quot;&gt;Number&lt;/span&gt; of files in latest index in master: 13
  [beaster]   2&amp;gt; 76111 INFO  (recoveryExecutor-144-thread-1-processing-n:127.0.0.1:42370_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.IndexFetcher &lt;span class=&quot;code-object&quot;&gt;Number&lt;/span&gt; of tlog files in master: 1
  [beaster]   2&amp;gt; 76112 INFO  (qtp499216332-622) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.c.S.Request [cdcr-target_shard1_replica_n1]  webapp=/solr path=/cdcr params={qt=/cdcr&amp;amp;action=BOOTSTRAP_STATUS&amp;amp;wt=javabin&amp;amp;version=2} status=0 QTime=0
  [beaster]   2&amp;gt; 76113 INFO  (cdcr-bootstrap-status-177-thread-1-processing-n:127.0.0.1:39903_solr x:cdcr-source_shard1_replica_n1 s:shard1 c:cdcr-source r:core_node2) [n:127.0.0.1:39903_solr c:cdcr-source s:shard1 r:core_node2 x:cdcr-source_shard1_replica_n1] o.a.s.h.CdcrReplicatorManager CDCR bootstrap running &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 1 seconds, sleeping &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 2000 ms
  [beaster]   2&amp;gt; 76119 INFO  (recoveryExecutor-144-thread-1-processing-n:127.0.0.1:42370_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.u.DefaultSolrCoreState New IndexWriter is ready to be used.
  [beaster]   2&amp;gt; 76119 INFO  (recoveryExecutor-144-thread-1-processing-n:127.0.0.1:42370_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.IndexFetcher Starting download (fullCopy=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;) to MockDirectoryWrapper(RAMDirectory@1ec60471 lockFactory=org.apache.lucene.store.SingleInstanceLockFactory@1b16e27d)
  [beaster]   2&amp;gt; 76120 INFO  (qtp1089963867-723) [n:127.0.0.1:39903_solr c:cdcr-source s:shard1 r:core_node2 x:cdcr-source_shard1_replica_n1] o.a.s.c.S.Request [cdcr-source_shard1_replica_n1]  webapp=/solr path=/replication params={generation=12&amp;amp;qt=/replication&amp;amp;file=_a_Lucene50_0.pos&amp;amp;checksum=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;wt=filestream&amp;amp;command=filecontent} status=0 QTime=0
  [beaster]   2&amp;gt; 76122 INFO  (recoveryExecutor-144-thread-1-processing-n:127.0.0.1:42370_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.u.DefaultSolrCoreState New IndexWriter is ready to be used.
  [beaster]   2&amp;gt; 76122 ERROR (recoveryExecutor-144-thread-1-processing-n:127.0.0.1:42370_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.IndexFetcher User aborted Replication
  [beaster]   2&amp;gt; 76122 INFO  (recoveryExecutor-144-thread-1-processing-n:127.0.0.1:42370_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.CdcrRequestHandler boostrap callable status :: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
  [beaster]   2&amp;gt; 76122 INFO  (recoveryExecutor-144-thread-1-processing-n:127.0.0.1:42370_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.CdcrRequestHandler boostrap callable closed :: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
  [beaster]   2&amp;gt; 76122 ERROR (recoveryExecutor-144-thread-1-processing-n:127.0.0.1:42370_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.CdcrRequestHandler fetch failed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; bootstrap :: org.apache.solr.handler.IndexFetcher$ReplicationHandlerException: User aborted replication
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;First time the Bootstrap is called, it checks whether the BOOTSTRAP is started or not.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[beaster]   2&amp;gt; 76084 WARN  (cdcr-bootstrap-status-177-thread-1-processing-n:127.0.0.1:39903_solr x:cdcr-source_shard1_replica_n1 s:shard1 c:cdcr-source r:core_node2) [n:127.0.0.1:39903_solr c:cdcr-source s:shard1 r:core_node2 x:cdcr-source_shard1_replica_n1] o.a.s.h.CdcrReplicatorManager Bootstrap process was not found on target collection: cdcr-target shard: shard1, leader: http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:42370/solr/cdcr-target_shard1_replica_n1/&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and then attempts to starts BOOTSTRAP again. Please MIND, the first call is still in play and second one is called too ::&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; [beaster]   2&amp;gt; 76092 INFO  (cdcr-bootstrap-status-177-thread-1-processing-n:127.0.0.1:39903_solr x:cdcr-source_shard1_replica_n1 s:shard1 c:cdcr-source r:core_node2) [n:127.0.0.1:39903_solr c:cdcr-source s:shard1 r:core_node2 x:cdcr-source_shard1_replica_n1] o.a.s.h.CdcrReplicatorManager Attempting to bootstrap target collection: cdcr-target shard: shard1 leader: http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:42370/solr/cdcr-target_shard1_replica_n1/&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Replication begins successfully:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  [beaster]   2&amp;gt; 76105 INFO  (recoveryExecutor-144-thread-1-processing-n:127.0.0.1:42370_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.IndexFetcher Starting replication process
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;but in the end: its gets aborted saying &quot;Uber aborted .......&quot;. THIS ABORT is due to CANCEL_BOOTSTRAP called by 2nd thread.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  [beaster]   2&amp;gt; 76122 ERROR (recoveryExecutor-144-thread-1-processing-n:127.0.0.1:42370_solr x:cdcr-target_shard1_replica_n1 s:shard1 c:cdcr-target r:core_node2) [n:127.0.0.1:42370_solr c:cdcr-target s:shard1 r:core_node2 x:cdcr-target_shard1_replica_n1] o.a.s.h.CdcrRequestHandler fetch failed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; bootstrap :: org.apache.solr.handler.IndexFetcher$ReplicationHandlerException: User aborted replication
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16170958" author="sarkaramrit2@gmail.com" created="Tue, 19 Sep 2017 00:43:13 +0000"  >&lt;p&gt;I had an offline discussion with Shalin and Varun and we are able to figure out what&apos;s wrong in the Cdcr Bootstrap.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;since issuing bootstrap is an asynchronous call, there is a probable race around condition where after issuing a bootstrap, it immediately checks for bootstrap status and if not found, another bootstrap gets issued.&lt;/li&gt;
	&lt;li&gt;this 2nd bootstrap fails to acquire lock issues cancel boostrap&lt;/li&gt;
	&lt;li&gt;since the bootstrap at target is now &quot;cancelled&quot;, the bootstrap status in CdcrReplicatorManager goes into rigorous infinite loop as the condition &quot;cancelled&quot; is not handled.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In the patch both &quot;&lt;b&gt;submitted&lt;/b&gt;&quot; and &quot;&lt;b&gt;cancelled&lt;/b&gt;&quot; bootstrap status conditions and &apos;what to do next&apos; is covered, which will nullify the extensive bootstrap calling and even the bootstrap should complete successfully. &lt;/p&gt;</comment>
                            <comment id="16171988" author="varunthacker" created="Tue, 19 Sep 2017 16:28:48 +0000"  >&lt;p&gt;I&apos;m going to commit this to master and see how Jenkins behaves for the next couple of days&lt;/p&gt;</comment>
                            <comment id="16171992" author="jira-bot" created="Tue, 19 Sep 2017 16:30:41 +0000"  >&lt;p&gt;Commit 8e12f201131d44034efe0cd97dee23df4b16b015 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8e12f20&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=8e12f20&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11278&quot; title=&quot;Fix race in cdcr bootstrap process&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11278&quot;&gt;&lt;del&gt;SOLR-11278&lt;/del&gt;&lt;/a&gt;: Fix race-condition in CDCR submitting a bootstrap call and checking it&apos;s status&lt;/p&gt;</comment>
                            <comment id="16172036" author="sarkaramrit2@gmail.com" created="Tue, 19 Sep 2017 17:13:33 +0000"  >&lt;p&gt;Thanks Varun, &lt;/p&gt;

&lt;p&gt;Successfully beasted: ant beast -Dtestcase=CdcrBootstrapTest -Dbeast.iters=500 -Dtests.iters=3 for the committed patch.&lt;/p&gt;</comment>
                            <comment id="16174015" author="sarkaramrit2@gmail.com" created="Wed, 20 Sep 2017 23:44:03 +0000"  >&lt;p&gt;Uploading another patch which makes sure if we request bootstrap status after submitting a bootstrap, we get the correct status: RUNNING. Used CountDownLatch internally in the function.&lt;/p&gt;</comment>
                            <comment id="16177106" author="sarkaramrit2@gmail.com" created="Fri, 22 Sep 2017 20:56:22 +0000"  >&lt;p&gt;Slight modifications on discussion with Shalin offline. Patch uploaded.&lt;/p&gt;</comment>
                            <comment id="16183297" author="jira-bot" created="Wed, 27 Sep 2017 21:34:53 +0000"  >&lt;p&gt;Commit 26677ab2b041a074fd984457677cbea8b58363ab in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=26677ab&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=26677ab&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11278&quot; title=&quot;Fix race in cdcr bootstrap process&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11278&quot;&gt;&lt;del&gt;SOLR-11278&lt;/del&gt;&lt;/a&gt;: Fix a race condition in the CDCR bootstrap process which could lead to bootstraps cancelling itself&lt;/p&gt;</comment>
                            <comment id="16183361" author="jira-bot" created="Wed, 27 Sep 2017 22:21:41 +0000"  >&lt;p&gt;Commit 1de25182370dec69a34a9999721127aee0ecc0fe in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1de2518&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1de2518&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11278&quot; title=&quot;Fix race in cdcr bootstrap process&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11278&quot;&gt;&lt;del&gt;SOLR-11278&lt;/del&gt;&lt;/a&gt;: Fix a race condition in the CDCR bootstrap process which could lead to bootstraps cancelling itself&lt;/p&gt;</comment>
                            <comment id="16183362" author="varunthacker" created="Wed, 27 Sep 2017 22:21:53 +0000"  >&lt;p&gt;Thanks Amrit and Shalin!&lt;/p&gt;</comment>
                            <comment id="16186578" author="steve_rowe" created="Fri, 29 Sep 2017 22:08:28 +0000"  >&lt;p&gt;Should the commits on this issue be backported to branch_7_0, to be included in Solr 7.0.1?&lt;/p&gt;</comment>
                            <comment id="16186592" author="varunthacker" created="Fri, 29 Sep 2017 22:20:24 +0000"  >&lt;p&gt;Looks like it was happy for 1 day but today I see a failure : &lt;a href=&quot;https://jenkins.thetaphi.de/job/Lucene-Solr-7.x-Linux/517/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jenkins.thetaphi.de/job/Lucene-Solr-7.x-Linux/517/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I won&apos;t get time to look at this for another till tuesday atleast . Let&apos;s not hold up 7.0.1 for this? &lt;/p&gt;

&lt;p&gt;People who hit this race condition in 7.0 can fix it by restarting the target cluster as the bootstrap will fail. Not the best experience but they are starting a new cluster so hopefully not a big deal.&lt;/p&gt;</comment>
                            <comment id="16187021" author="steve_rowe" created="Sat, 30 Sep 2017 10:45:12 +0000"  >&lt;blockquote&gt;&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt; today I see a failure &lt;span class=&quot;error&quot;&gt;&amp;#91;....&amp;#93;&lt;/span&gt; Let&apos;s not hold up 7.0.1 for this?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="16188903" author="varunthacker" created="Mon, 2 Oct 2017 21:44:11 +0000"  >&lt;p&gt;Still seeing failures on Jenkins&lt;/p&gt;</comment>
                            <comment id="16195690" author="sarkaramrit2@gmail.com" created="Sat, 7 Oct 2017 13:16:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Failure is very inconsistent. None of the failuers accessible at &lt;a href=&quot;https://jenkins.thetaphi.de/job/Lucene-Solr-7.x-Linux/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jenkins.thetaphi.de/job/Lucene-Solr-7.x-Linux/&lt;/a&gt; have the test failing and I am unable to produce it for 100 and 500 beasts. Not sure, how to proceed on this now.&lt;/p&gt;</comment>
                            <comment id="16195727" author="erickerickson" created="Sat, 7 Oct 2017 14:32:02 +0000"  >&lt;p&gt;Amrit:&lt;/p&gt;

&lt;p&gt;One strategy is to put debugging only code into master (not 7x) to test hypotheses. Be sure to track it carefully and take it out as soon as you can of course.&lt;/p&gt;</comment>
                            <comment id="16199800" author="varunthacker" created="Wed, 11 Oct 2017 04:41:44 +0000"  >&lt;p&gt;Closing this issue out as the fix will be part of the 7.1 release.&lt;/p&gt;

&lt;p&gt;Let&apos;s open a new Jira to fix the new failures&lt;/p&gt;</comment>
                            <comment id="16207379" author="shalinmangar" created="Tue, 17 Oct 2017 11:03:49 +0000"  >&lt;p&gt;Bulk close after 7.1.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12885097" name="SOLR-11278-awaits-fix.patch" size="749" author="sarkaramrit2@gmail.com" created="Sat, 2 Sep 2017 19:35:14 +0000"/>
                            <attachment id="12884483" name="SOLR-11278-cancel-bootstrap-on-stop.patch" size="1919" author="shalin" created="Wed, 30 Aug 2017 14:28:21 +0000"/>
                            <attachment id="12888567" name="SOLR-11278.patch" size="3353" author="sarkaramrit2@gmail.com" created="Fri, 22 Sep 2017 20:56:21 +0000"/>
                            <attachment id="12888164" name="SOLR-11278.patch" size="2505" author="sarkaramrit2@gmail.com" created="Wed, 20 Sep 2017 23:44:03 +0000"/>
                            <attachment id="12887794" name="SOLR-11278.patch" size="2709" author="sarkaramrit2@gmail.com" created="Tue, 19 Sep 2017 00:07:12 +0000"/>
                            <attachment id="12884217" name="SOLR-11278.patch" size="6783" author="sarkaramrit2@gmail.com" created="Tue, 29 Aug 2017 09:40:30 +0000"/>
                            <attachment id="12884984" name="master-bs.patch" size="11270" author="sarkaramrit2@gmail.com" created="Fri, 1 Sep 2017 17:36:30 +0000"/>
                            <attachment id="12883404" name="test_results" size="15104410" author="sarkaramrit2@gmail.com" created="Wed, 23 Aug 2017 20:00:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 5 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3j5vb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>