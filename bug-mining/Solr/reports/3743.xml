<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:30:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-11824] distributed json.facet &quot;type:range&quot; can return buckets out of order when mincount&gt;0</title>
                <link>https://issues.apache.org/jira/browse/SOLR-11824</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Discovered this while working on &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3218&quot; title=&quot;Range faceting support for CurrencyField&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3218&quot;&gt;&lt;del&gt;SOLR-3218&lt;/del&gt;&lt;/a&gt;, but it&apos;s a general problem with how the code is designed (and the existing code even has a TODO in FacetRangeMerger refering to the problem) ... this is essentially the same bug FacetComponent&apos;s &lt;tt&gt;facet.range&lt;/tt&gt; had that was fixed in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6154&quot; title=&quot;SolrCloud: facet range option f.&amp;lt;field&amp;gt;.facet.mincount=1 omits buckets on response&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6154&quot;&gt;&lt;del&gt;SOLR-6154&lt;/del&gt;&lt;/a&gt;: When he coordinator &quot;combines&quot; the response from each shard, the buckets can get out of order depending on which buckets were excluded by the first shard to respond.&lt;/p&gt;

&lt;p&gt;Depending on how many shards you have, it&apos;s fairly trivial to reproduce using &lt;tt&gt;bin/solr -e cloud&lt;/tt&gt; and the &lt;tt&gt;exampledocs/*.xml&lt;/tt&gt; files...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ curl http://localhost:8983/solr/techproducts/select -d &apos;q=*:*&amp;amp;rows=0&amp;amp;wt=xml&amp;amp;json.facet={
foo:{ type:range, field:price, start:0, end:2000, gap:100, other:all, mincount:1} }&apos;
&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;
&amp;lt;response&amp;gt;

&amp;lt;lst name=&quot;responseHeader&quot;&amp;gt;
  &amp;lt;bool name=&quot;zkConnected&quot;&amp;gt;true&amp;lt;/bool&amp;gt;
  &amp;lt;int name=&quot;status&quot;&amp;gt;0&amp;lt;/int&amp;gt;
  &amp;lt;int name=&quot;QTime&quot;&amp;gt;13&amp;lt;/int&amp;gt;
  &amp;lt;lst name=&quot;params&quot;&amp;gt;
    &amp;lt;str name=&quot;q&quot;&amp;gt;*:*&amp;lt;/str&amp;gt;
    &amp;lt;str name=&quot;json.facet&quot;&amp;gt;{
foo:{ type:range, field:price, start:0, end:2000, gap:100, other:all, mincount:1} }&amp;lt;/str&amp;gt;
    &amp;lt;str name=&quot;rows&quot;&amp;gt;0&amp;lt;/str&amp;gt;
    &amp;lt;str name=&quot;wt&quot;&amp;gt;xml&amp;lt;/str&amp;gt;
  &amp;lt;/lst&amp;gt;
&amp;lt;/lst&amp;gt;
&amp;lt;result name=&quot;response&quot; numFound=&quot;32&quot; start=&quot;0&quot; maxScore=&quot;1.0&quot;&amp;gt;
&amp;lt;/result&amp;gt;
&amp;lt;lst name=&quot;facets&quot;&amp;gt;
  &amp;lt;long name=&quot;count&quot;&amp;gt;32&amp;lt;/long&amp;gt;
  &amp;lt;lst name=&quot;foo&quot;&amp;gt;
    &amp;lt;arr name=&quot;buckets&quot;&amp;gt;
      &amp;lt;lst&amp;gt;
        &amp;lt;float name=&quot;val&quot;&amp;gt;0.0&amp;lt;/float&amp;gt;
        &amp;lt;long name=&quot;count&quot;&amp;gt;7&amp;lt;/long&amp;gt;
      &amp;lt;/lst&amp;gt;
      &amp;lt;lst&amp;gt;
        &amp;lt;float name=&quot;val&quot;&amp;gt;100.0&amp;lt;/float&amp;gt;
        &amp;lt;long name=&quot;count&quot;&amp;gt;2&amp;lt;/long&amp;gt;
      &amp;lt;/lst&amp;gt;
      &amp;lt;lst&amp;gt;
        &amp;lt;float name=&quot;val&quot;&amp;gt;300.0&amp;lt;/float&amp;gt;
        &amp;lt;long name=&quot;count&quot;&amp;gt;3&amp;lt;/long&amp;gt;
      &amp;lt;/lst&amp;gt;
      &amp;lt;lst&amp;gt;
        &amp;lt;float name=&quot;val&quot;&amp;gt;400.0&amp;lt;/float&amp;gt;
        &amp;lt;long name=&quot;count&quot;&amp;gt;1&amp;lt;/long&amp;gt;
      &amp;lt;/lst&amp;gt;
      &amp;lt;lst&amp;gt;
        &amp;lt;float name=&quot;val&quot;&amp;gt;200.0&amp;lt;/float&amp;gt;
        &amp;lt;long name=&quot;count&quot;&amp;gt;1&amp;lt;/long&amp;gt;
      &amp;lt;/lst&amp;gt;
      &amp;lt;lst&amp;gt;
        &amp;lt;float name=&quot;val&quot;&amp;gt;600.0&amp;lt;/float&amp;gt;
        &amp;lt;long name=&quot;count&quot;&amp;gt;1&amp;lt;/long&amp;gt;
      &amp;lt;/lst&amp;gt;
    &amp;lt;/arr&amp;gt;
    &amp;lt;lst name=&quot;before&quot;&amp;gt;
      &amp;lt;long name=&quot;count&quot;&amp;gt;0&amp;lt;/long&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&quot;after&quot;&amp;gt;
      &amp;lt;long name=&quot;count&quot;&amp;gt;1&amp;lt;/long&amp;gt;
    &amp;lt;/lst&amp;gt;
    &amp;lt;lst name=&quot;between&quot;&amp;gt;
      &amp;lt;long name=&quot;count&quot;&amp;gt;15&amp;lt;/long&amp;gt;
    &amp;lt;/lst&amp;gt;
  &amp;lt;/lst&amp;gt;
&amp;lt;/lst&amp;gt;
&amp;lt;/response&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13128904">SOLR-11824</key>
            <summary>distributed json.facet &quot;type:range&quot; can return buckets out of order when mincount&gt;0</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Fri, 5 Jan 2018 19:41:44 +0000</created>
                <updated>Sat, 8 Jun 2019 15:16:35 +0000</updated>
                            <resolved>Sat, 6 Jan 2018 22:52:46 +0000</resolved>
                                                    <fixVersion>7.3</fixVersion>
                    <fixVersion>8.0</fixVersion>
                                    <component>Facet Module</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="16313743" author="hossman" created="Fri, 5 Jan 2018 19:43:12 +0000"  >
&lt;p&gt;Here&apos;s a patch with beefed up testing to trigger this, and the simplest possible fix I know of (borrowing from &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6154&quot; title=&quot;SolrCloud: facet range option f.&amp;lt;field&amp;gt;.facet.mincount=1 omits buckets on response&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6154&quot;&gt;&lt;del&gt;SOLR-6154&lt;/del&gt;&lt;/a&gt;): the shards should ignore the mincount and allways return every bucket.  This way, regardless of which shard replies first, we always know all of the potential buckets (in the correct order) and the other shard responses can be merged in trivially.&lt;/p&gt;

&lt;p&gt;The other potential approach is to let the shards force a &lt;tt&gt;mincount=1&lt;/tt&gt; (like the existing broken code) and then re-sort the (out of order) buckets &amp;#8211; either as they arrive or after all shards have reponded &amp;#8211; but for things like CurrencyField &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3218&quot; title=&quot;Range faceting support for CurrencyField&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3218&quot;&gt;&lt;del&gt;SOLR-3218&lt;/del&gt;&lt;/a&gt; that&apos;s non trivial because the &lt;tt&gt;&quot;val&quot;&lt;/tt&gt; keys on the buckets aren&apos;t trivially sortable.  We&apos;d have to complicate the &lt;tt&gt;FacetRangeMerger&lt;/tt&gt; with knowledge of the &lt;tt&gt;FacetRange.Calc&lt;/tt&gt; ... this seems much simpler.&lt;/p&gt;

&lt;p&gt;&amp;#8212;&lt;/p&gt;

&lt;p&gt;Any concerns?&lt;/p&gt;</comment>
                            <comment id="16314984" author="jira-bot" created="Sat, 6 Jan 2018 22:52:14 +0000"  >&lt;p&gt;Commit db5d2d407fd35361b59f967c2b36ef49791e2b20 in lucene-solr&apos;s branch refs/heads/branch_7x from Chris Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=db5d2d4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=db5d2d4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11824&quot; title=&quot;distributed json.facet &amp;quot;type:range&amp;quot; can return buckets out of order when mincount&amp;gt;0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11824&quot;&gt;&lt;del&gt;SOLR-11824&lt;/del&gt;&lt;/a&gt;: Fixed bucket ordering in distributed json.facet type:range when mincount&amp;gt;0&lt;/p&gt;

&lt;p&gt;(cherry picked from commit d598517b965be2762d63dacf523352e393988e36)&lt;/p&gt;</comment>
                            <comment id="16314985" author="jira-bot" created="Sat, 6 Jan 2018 22:52:16 +0000"  >&lt;p&gt;Commit d598517b965be2762d63dacf523352e393988e36 in lucene-solr&apos;s branch refs/heads/master from Chris Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d598517&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d598517&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11824&quot; title=&quot;distributed json.facet &amp;quot;type:range&amp;quot; can return buckets out of order when mincount&amp;gt;0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11824&quot;&gt;&lt;del&gt;SOLR-11824&lt;/del&gt;&lt;/a&gt;: Fixed bucket ordering in distributed json.facet type:range when mincount&amp;gt;0&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12904848" name="SOLR-11824.patch" size="5894" author="hossman" created="Fri, 5 Jan 2018 19:42:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 45 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3okun:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>