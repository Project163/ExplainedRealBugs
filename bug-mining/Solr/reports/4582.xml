<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:46:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-14898] Proxied/Forwarded requests to other nodes wind up getting duplicate response headers</title>
                <link>https://issues.apache.org/jira/browse/SOLR-14898</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;When Solr receives a request for a collection not hosted on the current node, HttpSolrCall forwards/proxies that request - but the final response for the client can include duplicate response headers - one header from the remote node that ultimately handled the request, and a second copy of the header added by the current node...&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;# create a simple 2 node cluster...
$ ./bin/solr -e cloud -noprompt
# ...

$ curl &apos;http://localhost:8983/solr/admin/collections?action=CREATE&amp;amp;name=solo&amp;amp;numShards=1&amp;amp;nrtReplicas=1&apos;
# ...

# node 8983 is the node currently hosting the only replica of the &apos;solo&apos; collection, and responds to requests directly...
#
$ curl -S -s -D - -o /dev/null http://localhost:8983/solr/solo/select
HTTP/1.1 200 OK
Content-Security-Policy: default-src &apos;none&apos;; base-uri &apos;none&apos;; connect-src &apos;self&apos;; form-action &apos;self&apos;; font-src &apos;self&apos;; frame-ancestors &apos;none&apos;; img-src &apos;self&apos;; media-src &apos;self&apos;; style-src &apos;self&apos; &apos;unsafe-inline&apos;; script-src &apos;self&apos;; worker-src &apos;self&apos;;
X-Content-Type-Options: nosniff
X-Frame-Options: SAMEORIGIN
X-XSS-Protection: 1; mode=block
Content-Type: application/json;charset=utf-8
Content-Length: 169

# node 7574 does not host a replica, and forwards requests for it to 8983
# the response the client gets from 7574 has several security related headers duplicated...
#
$ curl -S -s -D - -o /dev/null http://localhost:7574/solr/solo/select
HTTP/1.1 200 OK
Content-Security-Policy: default-src &apos;none&apos;; base-uri &apos;none&apos;; connect-src &apos;self&apos;; form-action &apos;self&apos;; font-src &apos;self&apos;; frame-ancestors &apos;none&apos;; img-src &apos;self&apos;; media-src &apos;self&apos;; style-src &apos;self&apos; &apos;unsafe-inline&apos;; script-src &apos;self&apos;; worker-src &apos;self&apos;;
X-Content-Type-Options: nosniff
X-Frame-Options: SAMEORIGIN
X-XSS-Protection: 1; mode=block
Content-Security-Policy: default-src &apos;none&apos;; base-uri &apos;none&apos;; connect-src &apos;self&apos;; form-action &apos;self&apos;; font-src &apos;self&apos;; frame-ancestors &apos;none&apos;; img-src &apos;self&apos;; media-src &apos;self&apos;; style-src &apos;self&apos; &apos;unsafe-inline&apos;; script-src &apos;self&apos;; worker-src &apos;self&apos;;
X-Content-Type-Options: nosniff
X-Frame-Options: SAMEORIGIN
X-XSS-Protection: 1; mode=block
Content-Type: application/json;charset=utf-8
Content-Length: 197

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13329505">SOLR-14898</key>
            <summary>Proxied/Forwarded requests to other nodes wind up getting duplicate response headers</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Sat, 26 Sep 2020 00:51:42 +0000</created>
                <updated>Wed, 6 Jul 2022 07:34:10 +0000</updated>
                            <resolved>Tue, 29 Sep 2020 16:43:12 +0000</resolved>
                                                    <fixVersion>8.6.3</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17203249" author="munendrasn" created="Mon, 28 Sep 2020 14:03:50 +0000"  >&lt;p&gt;When a request is received by any node, security headers are set in the response by the Jetty&apos;s RewriteHandler. When there is no local core then request is forwarded/proxied to Node with core and the returned response is sent back to the user. Here, all the response headers from proxy request are &lt;a href=&quot;https://github.com/apache/lucene-solr/blob/c3f97fbdc11cf29e17a4e715981108dda7ba3aea/solr/core/src/java/org/apache/solr/servlet/HttpSolrCall.java#L731&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;b&gt;added&lt;/b&gt;&lt;/a&gt; to original response.&lt;/p&gt;

&lt;p&gt;addHeader could be replaced by setHeader, so that defaults are overwritten by the headers in response(which is the actual response we return to user).&lt;br/&gt;
Another approach is to add new filter to set security headers instead of RewriteHandler but we will still have the problem(again, we might need contains check or replace it with setHeader)&lt;/p&gt;

&lt;p&gt;Let me know which approach looks better, will attach a patch post that&lt;/p&gt;</comment>
                            <comment id="17203399" author="hossman" created="Mon, 28 Sep 2020 17:11:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=munendrasn&quot; class=&quot;user-hover&quot; rel=&quot;munendrasn&quot;&gt;munendrasn&lt;/a&gt; - I think you&apos;re right, in the case of HttpSolrCall.remoteQuery we should definitely &quot;set&quot; the response headers to match the remote node.  &lt;/p&gt;

&lt;p&gt;Ideally when as a &quot;proxy&quot; we shouldn&apos;t be &quot;adding&quot; anything to the response that didn&apos;t come from the proxied node, so we could/should in theory not let RewriteHandler (on nodeA) add those headers if when nodeA proxies to nodeB (leave it to nodeB to set them) but in practice since we aren&apos;t a generalized proxy we&apos;re a solr node handing off to another solr node it should be fine to leave that as is.&lt;/p&gt;

&lt;p&gt;I&apos;m going to work up a patch with a fix and (hopefully) a simple cloud test - i&apos;d like to get a fix into 8.6.3 for this given how it contributes to causing &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14896&quot; title=&quot;jetty &amp;quot;Bad Message 400&amp;quot; / &amp;quot;Illegal character&amp;quot; responses to sporadic requests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14896&quot;&gt;&lt;del&gt;SOLR-14896&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17203451" author="hossman" created="Mon, 28 Sep 2020 18:40:29 +0000"  >&lt;p&gt;writing a junit test proved (virutally) impossible due to &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14903&quot; title=&quot;SolrCloud tests should use the jetty.xml that we ship with&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14903&quot;&gt;&lt;del&gt;SOLR-14903&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Attached patch includes manually verified fix, as well as the starting point of my test currently marked AwaitsFix waiting on &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14903&quot; title=&quot;SolrCloud tests should use the jetty.xml that we ship with&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14903&quot;&gt;&lt;del&gt;SOLR-14903&lt;/del&gt;&lt;/a&gt; (which is a big enough ball of wax i don&apos;t think this issue should be held up waiting for it).&lt;/p&gt;

&lt;p&gt;I&apos;m still running full checks/tests to make sure i this doesn&apos;t break anything in some weird way ... Would appreciate review/eyeballs before committing &amp;amp; backporting in the meantime.&lt;/p&gt;</comment>
                            <comment id="17203985" author="munendrasn" created="Tue, 29 Sep 2020 14:37:08 +0000"  >&lt;p&gt;LGTM, +1 to committing this&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;writing a junit test proved (virutally) impossible due to &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14903&quot; title=&quot;SolrCloud tests should use the jetty.xml that we ship with&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14903&quot;&gt;&lt;del&gt;SOLR-14903&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;+1. In case, if we need to enable the new test without &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14903&quot; title=&quot;SolrCloud tests should use the jetty.xml that we ship with&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14903&quot;&gt;&lt;del&gt;SOLR-14903&lt;/del&gt;&lt;/a&gt;, we might need to hardcode headers &lt;a href=&quot;https://github.com/apache/lucene-solr/blob/3dcb19f88670b954e0956d0764853effedd923ef/solr/core/src/java/org/apache/solr/client/solrj/embedded/JettySolrRunner.java#L403&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17204107" author="jira-bot" created="Tue, 29 Sep 2020 16:19:18 +0000"  >&lt;p&gt;Commit 8c7502dfeb5bcc6c0d37f65220cd49f15efa0797 in lucene-solr&apos;s branch refs/heads/master from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=8c7502d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=8c7502d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14898&quot; title=&quot;Proxied/Forwarded requests to other nodes wind up getting duplicate response headers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14898&quot;&gt;&lt;del&gt;SOLR-14898&lt;/del&gt;&lt;/a&gt;: Stop returning duplicate HTTP response headers when requests are forward to another node&lt;/p&gt;</comment>
                            <comment id="17204116" author="jira-bot" created="Tue, 29 Sep 2020 16:29:16 +0000"  >&lt;p&gt;Commit 9b49512a11a27d5b0e6449b62c3910fbf119a73f in lucene-solr&apos;s branch refs/heads/branch_8x from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=9b49512&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=9b49512&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14898&quot; title=&quot;Proxied/Forwarded requests to other nodes wind up getting duplicate response headers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14898&quot;&gt;&lt;del&gt;SOLR-14898&lt;/del&gt;&lt;/a&gt;: Stop returning duplicate HTTP response headers when requests are forward to another node&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 8c7502dfeb5bcc6c0d37f65220cd49f15efa0797)&lt;/p&gt;</comment>
                            <comment id="17204121" author="ab" created="Tue, 29 Sep 2020 16:36:59 +0000"  >&lt;p&gt;I manually tested the scenario that you described, both without and with the fix, and indeed I was able to reproduce the problem without the fix, and with the fix the problem is gone. So it LGTM, +1.&lt;/p&gt;</comment>
                            <comment id="17204123" author="jira-bot" created="Tue, 29 Sep 2020 16:39:53 +0000"  >&lt;p&gt;Commit e41b18b2fade52ba5853a3102031b1f98d762202 in lucene-solr&apos;s branch refs/heads/branch_8_6 from Chris M. Hostetter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=e41b18b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=e41b18b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14898&quot; title=&quot;Proxied/Forwarded requests to other nodes wind up getting duplicate response headers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14898&quot;&gt;&lt;del&gt;SOLR-14898&lt;/del&gt;&lt;/a&gt;: Stop returning duplicate HTTP response headers when requests are forward to another node&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 8c7502dfeb5bcc6c0d37f65220cd49f15efa0797)&lt;/p&gt;</comment>
                            <comment id="17204125" author="hossman" created="Tue, 29 Sep 2020 16:43:13 +0000"  >&lt;blockquote&gt;&lt;p&gt;... In case, if we need to enable the new test without &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14903&quot; title=&quot;SolrCloud tests should use the jetty.xml that we ship with&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14903&quot;&gt;&lt;del&gt;SOLR-14903&lt;/del&gt;&lt;/a&gt;, we might need to hardcode headers here&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m not (personally) willing to spend any time adding more &quot;Fakery&quot; to JettySolrRunner, but if that&apos;s something you&apos;re interested in working on I certainly have no objections.&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;Patch committed to master &amp;amp; 8x and backported to branch_8_6 for inclusion in 8.6.3&lt;/p&gt;</comment>
                            <comment id="17211101" author="gerlowskija" created="Fri, 9 Oct 2020 15:45:37 +0000"  >&lt;p&gt;Closing after the 8.6.3 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310660">
                    <name>Completes</name>
                                            <outwardlinks description="fixes">
                                        <issuelink>
            <issuekey id="13329464">SOLR-14896</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13329502">SOLR-14897</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13329464">SOLR-14896</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13012258" name="SOLR-14898.patch" size="5064" author="hossman" created="Mon, 28 Sep 2020 18:38:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 5 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ixnk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>