<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:45:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-14782] QueryElevationComponent does not handle escaped query terms</title>
                <link>https://issues.apache.org/jira/browse/SOLR-14782</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;h1&gt;&lt;a name=&quot;Description&quot;&gt;&lt;/a&gt;Description&lt;/h1&gt;

&lt;p&gt;if the elevate.xml contains a entry with spaces:&lt;/p&gt;

&lt;p&gt;&amp;lt;&lt;font color=&quot;#0033b3&quot;&gt;query &lt;/font&gt;&lt;font color=&quot;#174ad4&quot;&gt;text&lt;/font&gt;&lt;font color=&quot;#067d17&quot;&gt;=&quot;aaa bbb&quot;&lt;/font&gt;&amp;gt;&amp;lt;&lt;font color=&quot;#0033b3&quot;&gt;doc &lt;/font&gt;&lt;font color=&quot;#174ad4&quot;&gt;id&lt;/font&gt;&lt;font color=&quot;#067d17&quot;&gt;=&quot;core2docId2&quot; &lt;/font&gt;/&amp;gt;&amp;lt;/&lt;font color=&quot;#0033b3&quot;&gt;query&lt;/font&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;and the Solr query term is escaped:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;?q=aaa&amp;#92;+bbb&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;the Solr search itself handels this correctly, but the elevate component &quot;QueryElevationComponent&quot; does not unescape the query term bevor the lookup in the elevate.xml.&lt;/p&gt;

&lt;p&gt;Result is that the entry is not elevated.&lt;/p&gt;

&lt;p&gt;A also valid (not escaped) query like:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;?q=aaa%20bbb&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;is working.&lt;/p&gt;
&lt;h1&gt;&lt;a name=&quot;TechnicalNotes&quot;&gt;&lt;/a&gt;Technical Notes&lt;/h1&gt;

&lt;p&gt;see:&lt;br/&gt;
org.apache.solr.handler.component.QueryElevationComponent.MapElevationProvider#getElevationForQuery&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13324851">SOLR-14782</key>
            <summary>QueryElevationComponent does not handle escaped query terms</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="broustant">Bruno Roustant</assignee>
                                    <reporter username="smk">Thomas Schmiereck</reporter>
                        <labels>
                            <label>elevation</label>
                    </labels>
                <created>Thu, 27 Aug 2020 14:06:54 +0000</created>
                <updated>Wed, 4 Nov 2020 15:21:57 +0000</updated>
                            <resolved>Wed, 2 Sep 2020 16:07:01 +0000</resolved>
                                    <version>8.2</version>
                                    <fixVersion>8.7</fixVersion>
                                    <component>query parsers</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="5400">1.5h</timespent>
                                <comments>
                            <comment id="17187479" author="broustant" created="Mon, 31 Aug 2020 06:39:02 +0000"  >&lt;p&gt;Looking into this.&lt;/p&gt;</comment>
                            <comment id="17187555" author="smk" created="Mon, 31 Aug 2020 08:26:51 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=broustant&quot; class=&quot;user-hover&quot; rel=&quot;broustant&quot;&gt;broustant&lt;/a&gt;,&lt;br/&gt;
I&apos;ve added my patch for this.&lt;/p&gt;</comment>
                            <comment id="17187563" author="broustant" created="Mon, 31 Aug 2020 08:44:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smk&quot; class=&quot;user-hover&quot; rel=&quot;smk&quot;&gt;smk&lt;/a&gt;&#160;could you retry to attach the patch? The current one seems empty.&lt;/p&gt;

&lt;p&gt;You can also create a Git PR.&lt;/p&gt;</comment>
                            <comment id="17187579" author="smk" created="Mon, 31 Aug 2020 09:01:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=broustant&quot; class=&quot;user-hover&quot; rel=&quot;broustant&quot;&gt;broustant&lt;/a&gt; Sorry, was the wrong file. Now it is the right one.&lt;/p&gt;</comment>
                            <comment id="17188251" author="broustant" created="Tue, 1 Sep 2020 08:15:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smk&quot; class=&quot;user-hover&quot; rel=&quot;smk&quot;&gt;smk&lt;/a&gt;&#160;what is the analyzer defined in your schema for the fieldType corresponding to the &quot;elevate&quot; searchComponent (value defined for the queryFieldType).&lt;/p&gt;

&lt;p&gt;This analyzer is used to tokenize/filter both the elevation rules and the search query in the&#160;QueryElevationComponent. So this analyzer could unescape characters.&lt;/p&gt;</comment>
                            <comment id="17188341" author="smk" created="Tue, 1 Sep 2020 10:10:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=broustant&quot; class=&quot;user-hover&quot; rel=&quot;broustant&quot;&gt;broustant&lt;/a&gt;&#160; I use:&lt;/p&gt;

&lt;p&gt;&amp;lt;&lt;font color=&quot;#0033b3&quot;&gt;searchComponent &lt;/font&gt;&lt;font color=&quot;#174ad4&quot;&gt;name&lt;/font&gt;&lt;font color=&quot;#067d17&quot;&gt;=&quot;elevator&quot; &lt;/font&gt;&lt;font color=&quot;#174ad4&quot;&gt;class&lt;/font&gt;&lt;font color=&quot;#067d17&quot;&gt;=&quot;solr.QueryElevationComponent&quot; &lt;/font&gt;&amp;gt;&lt;br/&gt;
&amp;lt;&lt;font color=&quot;#0033b3&quot;&gt;str &lt;/font&gt;&lt;font color=&quot;#174ad4&quot;&gt;name&lt;/font&gt;&lt;font color=&quot;#067d17&quot;&gt;=&quot;queryFieldType&quot;&lt;/font&gt;&amp;gt;lowercase&amp;lt;/&lt;font color=&quot;#0033b3&quot;&gt;str&lt;/font&gt;&amp;gt;&lt;br/&gt;
 &amp;lt;&lt;font color=&quot;#0033b3&quot;&gt;str &lt;/font&gt;&lt;font color=&quot;#174ad4&quot;&gt;name&lt;/font&gt;&lt;font color=&quot;#067d17&quot;&gt;=&quot;forceElevation&quot;&lt;/font&gt;&amp;gt;true&amp;lt;/&lt;font color=&quot;#0033b3&quot;&gt;str&lt;/font&gt;&amp;gt;&lt;br/&gt;
 &amp;lt;&lt;font color=&quot;#0033b3&quot;&gt;str &lt;/font&gt;&lt;font color=&quot;#174ad4&quot;&gt;name&lt;/font&gt;&lt;font color=&quot;#067d17&quot;&gt;=&quot;config-file&quot;&lt;/font&gt;&amp;gt;elevate.xml&amp;lt;/&lt;font color=&quot;#0033b3&quot;&gt;str&lt;/font&gt;&amp;gt;&lt;br/&gt;
&amp;lt;/&lt;font color=&quot;#0033b3&quot;&gt;searchComponent&lt;/font&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;with:&lt;/p&gt;

&lt;p&gt; &amp;lt;fieldType name=&quot;lowercase&quot; class=&quot;solr.TextField&quot; positionIncrementGap=&quot;100&quot;&amp;gt;&lt;br/&gt;
 &amp;lt;analyzer&amp;gt;&lt;br/&gt;
 &amp;lt;tokenizer class=&quot;solr.KeywordTokenizerFactory&quot;/&amp;gt;&lt;br/&gt;
 &amp;lt;filter class=&quot;solr.LowerCaseFilterFactory&quot;/&amp;gt;&lt;br/&gt;
 &amp;lt;/analyzer&amp;gt;&lt;br/&gt;
 &amp;lt;/fieldType&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17188353" author="broustant" created="Tue, 1 Sep 2020 10:37:15 +0000"  >&lt;p&gt;Ok, so I understand the expectation of unescaping in your use-case, but that&apos;s not always the case. For example someone else with a custom analyzer could handle differently: different way to escape/unescape, special logic when escaped characters are encountered.&lt;/p&gt;

&lt;p&gt;Maybe we should have a simple way to configure the escaping for simple use-cases. We could enhance the elevation config file (elevate.xml) to support an additional &amp;lt;config unescape=&quot;true&quot;/&amp;gt; tag. This unescaping would be false by default (for back compat) and could be enabled simply.&lt;/p&gt;

&lt;p&gt;What is your opinion &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="17188786" author="dsmiley" created="Tue, 1 Sep 2020 19:57:14 +0000"  >&lt;p&gt;A conundrum here is that QueryElevationComponent can&apos;t &amp;amp; shouldn&apos;t make assumptions about the particular query syntax used.  It doesn&apos;t know anything about escaping.  Depending on your query parser, you might have no escaping at all or maybe back-slash or who-knows-what rules in some complicated BNF grammar.  What is provided is a pluggable analyzer that you can configure as you like to do all sorts of things like a regexp to unescape.  I&apos;m skeptical Solr needs to do anything more here.&lt;/p&gt;</comment>
                            <comment id="17189079" author="smk" created="Wed, 2 Sep 2020 08:38:19 +0000"  >&lt;p&gt;For me it would be logical if the field type defined in &quot;&lt;font color=&quot;#067d17&quot;&gt;queryFieldType&lt;/font&gt;&quot; provided a function for the unescape which is then used automatically from the &quot;QueryElevationComponent&quot;.&lt;br/&gt;
But I am not sure whether the field-type is related to the query parser that is used.&lt;/p&gt;</comment>
                            <comment id="17189098" author="broustant" created="Wed, 2 Sep 2020 09:14:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smk&quot; class=&quot;user-hover&quot; rel=&quot;smk&quot;&gt;smk&lt;/a&gt;&#160;you should add a CharFilter to unescape for query elevation. Instead of using lowercase for the queryFieldType you could use unescapelowercase with the following definition:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;fieldType name=&lt;span class=&quot;code-quote&quot;&gt;&quot;unescapelowercase&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.TextField&quot;&lt;/span&gt; positionIncrementGap=&lt;span class=&quot;code-quote&quot;&gt;&quot;100&quot;&lt;/span&gt;&amp;gt;
  &amp;lt;analyzer&amp;gt;
    &amp;lt;charFilter class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.PatternReplaceCharFilterFactory&quot;&lt;/span&gt; pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;\\(.)&quot;&lt;/span&gt; replacement=&lt;span class=&quot;code-quote&quot;&gt;&quot;$1&quot;&lt;/span&gt;/&amp;gt;
    &amp;lt;tokenizer class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.KeywordTokenizerFactory&quot;&lt;/span&gt;/&amp;gt;
    &amp;lt;filter class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.LowerCaseFilterFactory&quot;&lt;/span&gt;/&amp;gt;
  &amp;lt;/analyzer&amp;gt;
&amp;lt;/fieldType&amp;gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt;&#160;this regex pattern replacement CharFilter is not easy. Should we have a new simpler and equivalent UnescapeCharFilterFactory? In any case I think it would be nice to add a paragraph to explain that in the QueryElevationComponent doc.&lt;/p&gt;</comment>
                            <comment id="17189123" author="broustant" created="Wed, 2 Sep 2020 10:00:38 +0000"  >&lt;p&gt;I added a PR for the doc improvement. I think it will be sufficient (no need for an UnescapeCharFilterFactory).&lt;/p&gt;

&lt;p&gt;Thomas, you should use a StandardTokenizerFactory because with 8.3 it becomes possible to match a subset of the query terms (not always a full match anymore), see&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11866&quot; title=&quot;Support efficient subset matching in query elevation rules&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11866&quot;&gt;&lt;del&gt;SOLR-11866&lt;/del&gt;&lt;/a&gt;. If you use a KeywordTokenizerFactory, it produces only the full query as a single token, so no subset matching possible.&lt;/p&gt;</comment>
                            <comment id="17189323" author="jira-bot" created="Wed, 2 Sep 2020 15:43:36 +0000"  >&lt;p&gt;Commit 56dbb6650356ba1292bd38aa5ad669fddd8ee50b in lucene-solr&apos;s branch refs/heads/master from Bruno Roustant&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=56dbb66&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=56dbb66&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14782&quot; title=&quot;QueryElevationComponent does not handle escaped query terms&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14782&quot;&gt;&lt;del&gt;SOLR-14782&lt;/del&gt;&lt;/a&gt;: Document how to unescape for the QueryElevationComponent.&lt;/p&gt;</comment>
                            <comment id="17189337" author="jira-bot" created="Wed, 2 Sep 2020 16:02:32 +0000"  >&lt;p&gt;Commit 838bd16b8442855303358834147e894c3ba84071 in lucene-solr&apos;s branch refs/heads/branch_8x from Bruno Roustant&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=838bd16&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=838bd16&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14782&quot; title=&quot;QueryElevationComponent does not handle escaped query terms&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14782&quot;&gt;&lt;del&gt;SOLR-14782&lt;/del&gt;&lt;/a&gt;: Document how to unescape for the QueryElevationComponent.&lt;/p&gt;</comment>
                            <comment id="17189342" author="broustant" created="Wed, 2 Sep 2020 16:07:01 +0000"  >&lt;p&gt;No code change. Fixed by adding an example of how to unescape for QueryElevationComponent in the doc.&lt;/p&gt;

&lt;p&gt;Thanks Thomas for pointing this.&lt;/p&gt;</comment>
                            <comment id="17226147" author="atri" created="Wed, 4 Nov 2020 15:21:57 +0000"  >&lt;p&gt;Closing after the 8.7.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13010761" name="SOLR-14782.patch" size="4915" author="smk" created="Mon, 31 Aug 2020 09:00:10 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 1 week, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0i4zc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>