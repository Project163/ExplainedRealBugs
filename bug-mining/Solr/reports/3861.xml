<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:31:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-12087] Deleting replicas sometimes fails and causes the replicas to exist in the down state</title>
                <link>https://issues.apache.org/jira/browse/SOLR-12087</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Sometimes when deleting&#160;replicas, the replica fails to be&#160;removed from the cluster state. This occurs especially when&#160;deleting replicas en mass; the resulting cause is that the data is deleted but the replicas aren&apos;t removed from the cluster state. Attempting to delete the downed replicas causes failures because the core does not exist anymore.&lt;/p&gt;

&lt;p&gt;This also occurs when trying&#160;to move replicas, since that move is an add and delete.&lt;/p&gt;

&lt;p&gt;Some more information regarding this issue; when the MOVEREPLICA command is issued, the new replica is created successfully but the replica to be deleted fails to be&#160;removed from state.json (the core is deleted though) and we see two logs spammed.&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;The node containing the leader&#160;replica&#160;continually (read every second) attempts to initiate recovery on the replica and fails to do so because the core does not exist. As a result it continually publishes a&#160;down state for the replica to zookeeper.&lt;/li&gt;
	&lt;li&gt;The deleted replica node spams that it cannot locate the core because it&apos;s been deleted.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;During this period of time, we see an increase in ZK network connectivity overall, until the&#160;replica is finally deleted (spamming&#160;DELETEREPLICA on the shard until its removed from the state)&lt;/p&gt;

&lt;p&gt;My guess is there&apos;s two issues at hand here:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;The&#160;leader continually attempts to recover a downed replica that is unrecoverable because the core does not exist.&lt;/li&gt;
	&lt;li&gt;The replica to be deleted is having trouble being deleted from state.json in ZK.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;This is mostly consistent for my use case. I&apos;m running 7.2.1 with 66 nodes.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13144888">SOLR-12087</key>
            <summary>Deleting replicas sometimes fails and causes the replicas to exist in the down state</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="caomanhdat">Cao Manh Dat</assignee>
                                    <reporter username="jerry.bao">Jerry Bao</reporter>
                        <labels>
                    </labels>
                <created>Tue, 13 Mar 2018 23:36:09 +0000</created>
                <updated>Wed, 2 Oct 2019 17:24:46 +0000</updated>
                            <resolved>Thu, 29 Mar 2018 11:39:58 +0000</resolved>
                                    <version>7.2</version>
                                    <fixVersion>7.3.1</fixVersion>
                                    <component>SolrCloud</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16397864" author="ausathya" created="Tue, 13 Mar 2018 23:44:34 +0000"  >&lt;p&gt;Deletes are done via DELETE Command.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Steps&lt;/b&gt;:&lt;/p&gt;

&lt;p&gt;1. Create a replica in new node.&lt;br/&gt;
2. Delete the existing replica in previous node.&lt;/p&gt;

&lt;p&gt;and Deletes fail (sometimes) leaving the zombie replicas in a down state.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16398058" author="varunthacker" created="Wed, 14 Mar 2018 03:47:25 +0000"  >&lt;p&gt;What&apos;s the error from the logs during the delete call?&#160;&lt;/p&gt;</comment>
                            <comment id="16402376" author="ausathya" created="Fri, 16 Mar 2018 19:25:28 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// 2018-03-14 22:11:29.965 ERROR (qtp959447386-273280) [ ] o.a.s.h.RequestHandlerBase org.apache.solr.common.SolrException: Unable to locate core subreddits_shard2_replica_n189 at org.apache.solr.handler.admin.CoreAdminOperation.lambda$&lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt;$5(CoreAdminOperation.java:150) at org.apache.solr.handler.admin.CoreAdminOperation.execute(CoreAdminOperation.java:384) at org.apache.solr.handler.admin.CoreAdminHandler$CallInfo.call(CoreAdminHandler.java:389) at org.apache.solr.handler.admin.CoreAdminHandler.handleRequestBody(CoreAdminHandler.java:174) at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:177) at org.apache.solr.servlet.HttpSolrCall.handleAdmin(HttpSolrCall.java:735) at org.apache.solr.servlet.HttpSolrCall.handleAdminRequest(HttpSolrCall.java:716) at org.apache.solr.servlet.HttpSolrCall.call(HttpSolrCall.java:497) at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:382) at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:326) at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1751) at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:582) at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143) at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:548) at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:226) at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1180) at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:512) at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185) at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1112) at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141) at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:213) at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:119) at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134) at org.eclipse.jetty.rewrite.handler.RewriteHandler.handle(RewriteHandler.java:335) at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134) at org.eclipse.jetty.server.Server.handle(Server.java:534) at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:320) at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:251) at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:283) at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:108) at org.eclipse.jetty.io.SelectChannelEndPoint$2.run(SelectChannelEndPoint.java:93) at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.executeProduceConsume(ExecuteProduceConsume.java:303) at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceConsume(ExecuteProduceConsume.java:148) at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:136) at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:671) at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:589) at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16402548" author="jerry.bao" created="Fri, 16 Mar 2018 21:19:28 +0000"  >&lt;p&gt;Adding some more potentially relevant information:&lt;/p&gt;

&lt;p&gt;We&apos;re constantly updating Solr&#160;collections via live&#160;streaming updates. I noticed that moving shards that don&apos;t have live indexing is much easier than those that do. Also heavy indexing seems to be a factor in whether or not zombie shards exist.&lt;/p&gt;

&lt;p&gt;EDIT: It seems that collections with indexing/querying consistently have zombie shards vs those that dont.&lt;/p&gt;</comment>
                            <comment id="16407442" author="caomanhdat" created="Wed, 21 Mar 2018 04:24:22 +0000"  >&lt;p&gt;I&apos;m not sure but this can be a race condition between delete replica and updates&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Many updates&#160;are coming to the leader&lt;/li&gt;
	&lt;li&gt;The leader forward these updates to replicaA&lt;/li&gt;
	&lt;li&gt;DeleteReplica is called for&#160;replicaA&lt;/li&gt;
	&lt;li&gt;There are several updates sent to replicaA failed ( because replicaA is closed )&#160;&lt;/li&gt;
	&lt;li&gt;Entry of replicaA is removed from &lt;tt&gt;states.json&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;The leader put replicaA into LIR by publishing replicaA state to DOWN which adds back the entry of replicaA to &lt;tt&gt;states.json&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerry.bao&quot; class=&quot;user-hover&quot; rel=&quot;jerry.bao&quot;&gt;jerry.bao&lt;/a&gt; If this is your case there must be some log like this&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;On replica node&#160;on time t :&#160;log.info(logid+&quot; CLOSING SolrCore &quot; + this);&lt;/li&gt;
	&lt;li&gt;On leader node on time t+delta : log.warn(&quot;Leader is publishing core={} coreNodeName ={} state={} on behalf of un-reachable replica {}&quot;,&lt;br/&gt;
replicaCoreName, replicaCoreNodeName, Replica.State.DOWN.toString(), replicaUrl);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;You wrote that&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Attempting to delete the downed replicas causes failures because the core does not exist anymore.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;But if the case that I described above is correct, you will still be able to delete the replica from clusterstate even when the replica does not exist in the node. Make sure that on the 2nd call of DeleteReplica (for removing zombie replica), parameters are correct because the name of the replica may get changed, ie: from core_node3 to core_node4.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ausathya&quot; class=&quot;user-hover&quot; rel=&quot;ausathya&quot;&gt;ausathya&lt;/a&gt;&#160;Your log seems relate to REQUEST_RECOVERY call, not DELETE call, right?&lt;br/&gt;
&#160;&lt;br/&gt;
&#160;&lt;br/&gt;
BTW: In theory, &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11702&quot; title=&quot;Redesign current LIR implementation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11702&quot;&gt;&lt;del&gt;SOLR-11702&lt;/del&gt;&lt;/a&gt; will be able to solve this problem ( by not calling old LIR code ). Unfortunately that because of the backward compatibility we&#160;still run through old LIR cause we cannot distinguish whether the replica is removed or not registered its term (had not upgraded to 7.3).&lt;/p&gt;</comment>
                            <comment id="16408143" author="caomanhdat" created="Wed, 21 Mar 2018 15:58:07 +0000"  >&lt;p&gt;I uploaded a test patch which simulates the above case and the test failed 50% in my pc (both in master and branch_7_2)&lt;/p&gt;</comment>
                            <comment id="16408177" author="jerry.bao" created="Wed, 21 Mar 2018 16:22:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat&quot; class=&quot;user-hover&quot; rel=&quot;caomanhdat&quot;&gt;caomanhdat&lt;/a&gt;&#160;That sounds exactly like the case I&apos;m running into. I can&apos;t verify that the logs you say I should see I saw but I did definitely see the leader logs you were mentioning.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;You wrote that&lt;/p&gt;

&lt;p&gt;Attempting to delete the downed replicas causes failures because the core does not exist anymore.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Sorry I should have been more clear here: It causes failures but not failures that block the&#160;deletion of the replica; the replica does eventually get deleted.&#160;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Make sure that on the 2nd call of DeleteReplica (for removing zombie replica), parameters are correct because the name of the replica may get changed, ie: from core_node3 to core_node4.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I wrote a small script to find all downed&#160;replicas and&#160;issue a delete command against them, which does take into account the name change.&lt;/p&gt;</comment>
                            <comment id="16408182" author="caomanhdat" created="Wed, 21 Mar 2018 16:26:00 +0000"  >&lt;p&gt;Uploaded a draft patch for fixing the problem. The idea here is when the leader publish state of a replica as DOWN in old LIR, if the replica cannot be found in current &lt;tt&gt;states.json&lt;/tt&gt;, do nothing.&#160;&lt;/p&gt;</comment>
                            <comment id="16408606" author="varunthacker" created="Wed, 21 Mar 2018 21:28:57 +0000"  >&lt;p&gt;Hi Dat,&lt;/p&gt;

&lt;p&gt;Great catch!&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;A couple of minor comments about the patch:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The log.warn in&#160;ReplicaMutator , should we just remove it? Like to a user going through the logs he will be confused when he sees it and there is no action to be taken anyways. Maybe it could be a DEBUG log entry?&lt;/li&gt;
	&lt;li&gt;In&#160;DeleteReplicaTest&#160; can we change &lt;tt&gt;e.printStackTrace();&lt;/tt&gt; to be written out with the logger ?&lt;/li&gt;
	&lt;li&gt;Just curious as to why is there a &lt;tt&gt;Thread.sleep(2000);&lt;/tt&gt; wait in the test code?&#160;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;For reference, I ran the test patch on master ( which has the new LIR code ) and all 10 runs passed&lt;/p&gt;

&lt;p&gt;A few things worth noting were these log lines&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
7471 INFO (qtp1388245618-49) [n:127.0.0.1:56141_solr ] o.a.s.s.HttpSolrCall [admin] webapp=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; path=/admin/cores params={deleteInstanceDir=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;core=deleteReplicaOnIndexing_shard1_replica_n1&amp;amp;qt=/admin/cores&amp;amp;deleteDataDir=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;action=UNLOAD&amp;amp;wt=javabin&amp;amp;version=2&amp;amp;deleteIndex=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;} status=0 QTime=85
7559 INFO (qtp1216387063-400) [n:127.0.0.1:56142_solr c:deleteReplicaOnIndexing s:shard1 r:core_node4 x:deleteReplicaOnIndexing_shard1_replica_n2] o.a.s.c.ZkShardTerms Successful update of terms at /collections/deleteReplicaOnIndexing/terms/shard1 to Terms{values={core_node4=1}, version=3}
7559 INFO (qtp1216387063-289) [n:127.0.0.1:56142_solr c:deleteReplicaOnIndexing s:shard1 r:core_node4 x:deleteReplicaOnIndexing_shard1_replica_n2] o.a.s.c.ZkShardTerms Failed to save terms, version is not a match, retrying
7559 INFO (qtp1216387063-57) [n:127.0.0.1:56142_solr c:deleteReplicaOnIndexing s:shard1 r:core_node4 x:deleteReplicaOnIndexing_shard1_replica_n2] o.a.s.c.ZkShardTerms Failed to save terms, version is not a match, retrying
7560 INFO (qtp1216387063-319) [n:127.0.0.1:56142_solr c:deleteReplicaOnIndexing s:shard1 r:core_node4 x:deleteReplicaOnIndexing_shard1_replica_n2] o.a.s.c.ZkShardTerms Failed to save terms, version is not a match, retrying
7560 INFO (qtp1216387063-476) [n:127.0.0.1:56142_solr c:deleteReplicaOnIndexing s:shard1 r:core_node4 x:deleteReplicaOnIndexing_shard1_replica_n2] o.a.s.c.ZkShardTerms Failed to save terms, version is not a match, retrying
7559 INFO (qtp1216387063-423) [n:127.0.0.1:56142_solr c:deleteReplicaOnIndexing s:shard1 r:core_node4 x:deleteReplicaOnIndexing_shard1_replica_n2] o.a.s.c.ZkShardTerms Failed to save terms, version is not a match, retrying
7561 INFO (qtp1216387063-444) [n:127.0.0.1:56142_solr c:deleteReplicaOnIndexing s:shard1 r:core_node4 x:deleteReplicaOnIndexing_shard1_replica_n2] o.a.s.c.ZkShardTerms Failed to save terms, version is not a match, retrying
7560 INFO (qtp1216387063-325) [n:127.0.0.1:56142_solr c:deleteReplicaOnIndexing s:shard1 r:core_node4 x:deleteReplicaOnIndexing_shard1_replica_n2] o.a.s.c.ZkShardTerms Failed to save terms, version is not a match, retrying
7563 INFO (qtp1216387063-324) [n:127.0.0.1:56142_solr c:deleteReplicaOnIndexing s:shard1 r:core_node4 x:deleteReplicaOnIndexing_shard1_replica_n2] o.a.s.c.ZkShardTerms Failed to save terms, version is not a match, retrying
7561 INFO (qtp1216387063-321) [n:127.0.0.1:56142_solr c:deleteReplicaOnIndexing s:shard1 r:core_node4 x:deleteReplicaOnIndexing_shard1_replica_n2] o.a.s.c.ZkShardTerms Failed to save terms, version is not a match, retrying

....

7705 ERROR (updateExecutor-16-thread-94-processing-https:&lt;span class=&quot;code-comment&quot;&gt;////127.0.0.1:56141//solr//deleteReplicaOnIndexing_shard1_replica_n1 x:deleteReplicaOnIndexing_shard1_replica_n2 r:core_node4 n:127.0.0.1:56142_solr s:shard1 c:deleteReplicaOnIndexing) [n:127.0.0.1:56142_solr c:deleteReplicaOnIndexing s:shard1 r:core_node4 x:deleteReplicaOnIndexing_shard1_replica_n2] o.a.s.u.ErrorReportingConcurrentUpdateSolrClient error
&lt;/span&gt;org.apache.solr.client.solrj.impl.HttpSolrClient$RemoteSolrException: Error from server at https:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:56141/solr/deleteReplicaOnIndexing_shard1_replica_n1: Can not find: /solr/deleteReplicaOnIndexing_shard1_replica_n1/update
&lt;/span&gt;


request: https:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:56141/solr/deleteReplicaOnIndexing_shard1_replica_n1/update?update.distrib=FROMLEADER&amp;amp;distrib.from=https%3A%2F%2F127.0.0.1%3A56142%2Fsolr%2FdeleteReplicaOnIndexing_shard1_replica_n2%2F&amp;amp;wt=javabin&amp;amp;version=2
&lt;/span&gt;
...

7751 WARN&#160; (qtp1216387063-326) [n:127.0.0.1:56142_solr c:deleteReplicaOnIndexing s:shard1 r:core_node4 x:deleteReplicaOnIndexing_shard1_replica_n2] o.a.s.u.p.DistributedUpdateProcessor Core core_node4 belonging to deleteReplicaOnIndexing shard1, does not have error&apos;d node https:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:56141/solr/deleteReplicaOnIndexing_shard1_replica_n1/ as a replica. No request recovery command will be sent!&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16408948" author="caomanhdat" created="Thu, 22 Mar 2018 02:34:22 +0000"  >&lt;p&gt;Hi Varun, all your points are valid. Thanks!&lt;/p&gt;

&lt;p&gt;Several points from the log you are mentioned are worth to concern&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Multiple&#160;log &lt;tt&gt;ZkShardTerms failed to save terms, version is not a match, retrying&lt;/tt&gt;, this is a ZK performance problem, all thread will try to fetch the latest term from ZK -&amp;gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12135&quot; title=&quot;ZK perfomance problem when multiple updates thread of leader trying to update term&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12135&quot;&gt;SOLR-12135&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;DistributedUpdateProcessor Core core_node4 belonging to deleteReplicaOnIndexing shard1, does not have error&apos;d node -&amp;gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12073&quot; title=&quot;Mismatch between getting replicas in DUP.finish() and DUP.setupRequest() can make an update fail&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12073&quot;&gt;SOLR-12073&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16408962" author="caomanhdat" created="Thu, 22 Mar 2018 02:44:28 +0000"  >&lt;p&gt;Uploaded the patch that&#160;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Follow Varun&apos;s hints above.&lt;/li&gt;
	&lt;li&gt;If the replica does not exist, LIR process will be skipped.&lt;/li&gt;
	&lt;li&gt;In case of LIRThread already created a LIR znode&#160;(lagging in update clusterstate of leader), remove that the node&#160;on final.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16409259" author="jira-bot" created="Thu, 22 Mar 2018 09:11:59 +0000"  >&lt;p&gt;Commit 92f1cdebfaff79867a6a65f9419fc0bba274c62b in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat&quot; class=&quot;user-hover&quot; rel=&quot;caomanhdat&quot;&gt;caomanhdat&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=92f1cde&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=92f1cde&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12087&quot; title=&quot;Deleting replicas sometimes fails and causes the replicas to exist in the down state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12087&quot;&gt;&lt;del&gt;SOLR-12087&lt;/del&gt;&lt;/a&gt;: Deleting replicas sometimes fails and causes the replicas to exist in the down state&lt;/p&gt;</comment>
                            <comment id="16409260" author="jira-bot" created="Thu, 22 Mar 2018 09:12:35 +0000"  >&lt;p&gt;Commit 137dc1df2e9d5b3c6053f0c98a7e1a7ea6206b00 in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat&quot; class=&quot;user-hover&quot; rel=&quot;caomanhdat&quot;&gt;caomanhdat&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=137dc1d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=137dc1d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12087&quot; title=&quot;Deleting replicas sometimes fails and causes the replicas to exist in the down state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12087&quot;&gt;&lt;del&gt;SOLR-12087&lt;/del&gt;&lt;/a&gt;: Deleting replicas sometimes fails and causes the replicas to exist in the down state&lt;/p&gt;</comment>
                            <comment id="16410578" author="lucenesolrqa" created="Thu, 22 Mar 2018 23:50:27 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;b&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;&lt;/b&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Vote &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Runtime &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Comment &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt; patch &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt;  0m  5s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12087&quot; title=&quot;Deleting replicas sometimes fails and causes the replicas to exist in the down state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12087&quot;&gt;&lt;del&gt;SOLR-12087&lt;/del&gt;&lt;/a&gt; does not apply to master. Rebase required? Wrong Branch? See &lt;a href=&quot;https://wiki.apache.org/solr/HowToContribute#Creating_the_patch_file&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://wiki.apache.org/solr/HowToContribute#Creating_the_patch_file&lt;/a&gt; for help. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Report/Notes &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Issue &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12087&quot; title=&quot;Deleting replicas sometimes fails and causes the replicas to exist in the down state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12087&quot;&gt;&lt;del&gt;SOLR-12087&lt;/del&gt;&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Patch URL &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12915636/SOLR-12087.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12915636/SOLR-12087.patch&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Console output &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/12/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/12/console&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Powered by &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Apache Yetus 0.7.0   &lt;a href=&quot;http://yetus.apache.org&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://yetus.apache.org&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;p&gt;This message was automatically generated.&lt;/p&gt;
</comment>
                            <comment id="16413707" author="jira-bot" created="Mon, 26 Mar 2018 11:29:06 +0000"  >&lt;p&gt;Commit b0f677c3834992ac87d98bc3a50bef2a2b019634 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b0f677c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b0f677c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12087&quot; title=&quot;Deleting replicas sometimes fails and causes the replicas to exist in the down state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12087&quot;&gt;&lt;del&gt;SOLR-12087&lt;/del&gt;&lt;/a&gt;: Fixed bug in TimeOut.waitFor that can cause an infinite loop and added javadocs&lt;/p&gt;</comment>
                            <comment id="16413709" author="jira-bot" created="Mon, 26 Mar 2018 11:29:50 +0000"  >&lt;p&gt;Commit 983a443b2fb72dfe08d1a0919ed7ac31ceb8a89f in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=983a443&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=983a443&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12087&quot; title=&quot;Deleting replicas sometimes fails and causes the replicas to exist in the down state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12087&quot;&gt;&lt;del&gt;SOLR-12087&lt;/del&gt;&lt;/a&gt;: Fixed bug in TimeOut.waitFor that can cause an infinite loop and added javadocs&lt;/p&gt;

&lt;p&gt;(cherry picked from commit b0f677c)&lt;/p&gt;</comment>
                            <comment id="16418534" author="shalinmangar" created="Thu, 29 Mar 2018 07:16:48 +0000"  >&lt;p&gt;I see frequent failures on jenkins (and locally) for DeleteReplicaTest.deleteReplicaOnIndexing added in this issue.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/job/Lucene-Solr-Tests-7.x/533/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Lucene-Solr-Tests-7.x/533/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://jenkins.thetaphi.de/job/Lucene-Solr-master-Solaris/1762/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jenkins.thetaphi.de/job/Lucene-Solr-master-Solaris/1762/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The first failure was on 2 days ago which is when I committed the fix to TimeOut.waitFor so they are probably related. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat&quot; class=&quot;user-hover&quot; rel=&quot;caomanhdat&quot;&gt;caomanhdat&lt;/a&gt; - can you please take a look?&lt;/p&gt;</comment>
                            <comment id="16418814" author="jira-bot" created="Thu, 29 Mar 2018 11:38:27 +0000"  >&lt;p&gt;Commit d7197b2565de4388d584065c8af5c622cb3a1c4f in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat&quot; class=&quot;user-hover&quot; rel=&quot;caomanhdat&quot;&gt;caomanhdat&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d7197b2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d7197b2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12087&quot; title=&quot;Deleting replicas sometimes fails and causes the replicas to exist in the down state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12087&quot;&gt;&lt;del&gt;SOLR-12087&lt;/del&gt;&lt;/a&gt;: Check for exception message of request recovery to remove LIR node&lt;/p&gt;</comment>
                            <comment id="16418816" author="jira-bot" created="Thu, 29 Mar 2018 11:39:24 +0000"  >&lt;p&gt;Commit 751adad5b16ba2cd343427556459427517a41aed in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat&quot; class=&quot;user-hover&quot; rel=&quot;caomanhdat&quot;&gt;caomanhdat&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=751adad&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=751adad&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12087&quot; title=&quot;Deleting replicas sometimes fails and causes the replicas to exist in the down state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12087&quot;&gt;&lt;del&gt;SOLR-12087&lt;/del&gt;&lt;/a&gt;: Check for exception message of request recovery to remove LIR node&lt;/p&gt;</comment>
                            <comment id="16418817" author="caomanhdat" created="Thu, 29 Mar 2018 11:39:43 +0000"  >&lt;p&gt;Thank &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shalin&quot; class=&quot;user-hover&quot; rel=&quot;shalin&quot;&gt;shalin&lt;/a&gt; , I committed the fix.&lt;/p&gt;</comment>
                            <comment id="16419464" author="jerry.bao" created="Thu, 29 Mar 2018 17:42:37 +0000"  >&lt;p&gt;Can we get this fix backported to 7.3 and have a 7.3.1?&lt;/p&gt;</comment>
                            <comment id="16443682" author="jira-bot" created="Thu, 19 Apr 2018 08:00:43 +0000"  >&lt;p&gt;Commit ec9ccb5cd07f54eacba2cf071281cc9c37b766c1 in lucene-solr&apos;s branch refs/heads/branch_7_3 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat&quot; class=&quot;user-hover&quot; rel=&quot;caomanhdat&quot;&gt;caomanhdat&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ec9ccb5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=ec9ccb5&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12087&quot; title=&quot;Deleting replicas sometimes fails and causes the replicas to exist in the down state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12087&quot;&gt;&lt;del&gt;SOLR-12087&lt;/del&gt;&lt;/a&gt;: Deleting replicas sometimes fails and causes the replicas to exist in the down state&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12915636" name="SOLR-12087.patch" size="13108" author="caomanhdat" created="Thu, 22 Mar 2018 09:02:06 +0000"/>
                            <attachment id="12915596" name="SOLR-12087.patch" size="12355" author="caomanhdat" created="Thu, 22 Mar 2018 02:44:54 +0000"/>
                            <attachment id="12915518" name="SOLR-12087.patch" size="7046" author="caomanhdat" created="Wed, 21 Mar 2018 16:24:29 +0000"/>
                            <attachment id="12915513" name="SOLR-12087.test.patch" size="2909" author="caomanhdat" created="Wed, 21 Mar 2018 15:56:58 +0000"/>
                            <attachment id="12914933" name="Screen Shot 2018-03-16 at 11.50.32 AM.png" size="123797" author="jerry.bao" created="Fri, 16 Mar 2018 21:18:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 30 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3r9fj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>