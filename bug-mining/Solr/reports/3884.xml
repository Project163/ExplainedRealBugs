<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:32:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-10513] CLONE - ConjunctionSolrSpellChecker wrong check for same string distance</title>
                <link>https://issues.apache.org/jira/browse/SOLR-10513</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;See ConjunctionSolrSpellChecker.java&lt;/p&gt;

&lt;p&gt;try {&lt;br/&gt;
      if (stringDistance == null) &lt;/p&gt;
{
        stringDistance = checker.getStringDistance();
      }
&lt;p&gt; else if (stringDistance != checker.getStringDistance()) &lt;/p&gt;
{
        throw new IllegalArgumentException(
            &quot;All checkers need to use the same StringDistance.&quot;);
      }
&lt;p&gt;    } catch (UnsupportedOperationException uoe) &lt;/p&gt;
{
      // ignore
    }

&lt;p&gt;In line stringDistance != checker.getStringDistance() there is comparing by references. So if you are using 2 or more spellcheckers with same distance algorithm, exception will be thrown anyway.&lt;/p&gt;


&lt;p&gt;&lt;b&gt;Update:&lt;/b&gt; As of Solr 6.5, this has been changed to &lt;b&gt;stringDistance.equals(checker.getStringDistance())&lt;/b&gt; .&lt;br/&gt;
However, &lt;b&gt;LuceneLevenshteinDistance&lt;/b&gt; does not even override equals method. &lt;/p&gt;

&lt;p&gt;This does not solve the problem yet, because the &lt;b&gt;default equals&lt;/b&gt; method anyway compares references.&lt;/p&gt;

&lt;p&gt;Hence unable to use &lt;b&gt;FileBasedSolrSpellChecker&lt;/b&gt; .  &lt;/p&gt;

&lt;p&gt;Moreover, Some check of similar sorts should also be in the init method. So that user does not have to wait for this error during query time. If the spellcheck components have been added &lt;b&gt;solrconfig.xml&lt;/b&gt; , it should throw error during core-reload itself.  &lt;/p&gt;</description>
                <environment></environment>
        <key id="13064766">SOLR-10513</key>
            <summary>CLONE - ConjunctionSolrSpellChecker wrong check for same string distance</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdyer">James Dyer</assignee>
                                    <reporter username="asingh2411">Abhishek Kumar Singh</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Apr 2017 16:08:59 +0000</created>
                <updated>Thu, 21 Nov 2019 00:41:51 +0000</updated>
                            <resolved>Fri, 13 Apr 2018 18:48:22 +0000</resolved>
                                    <version>4.9</version>
                                    <fixVersion>7.4</fixVersion>
                                    <component>spellchecker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15972987" author="asingh2411" created="Tue, 18 Apr 2017 16:13:41 +0000"  >&lt;p&gt;As of Solr 6.5, this has been changed to &lt;b&gt;stringDistance.equals(checker.getStringDistance())&lt;/b&gt; .&lt;br/&gt;
However, &lt;b&gt;LuceneLevenshteinDistance&lt;/b&gt; does not even override equals method. &lt;/p&gt;

&lt;p&gt;This does not solve the problem yet, because the &lt;b&gt;default equals&lt;/b&gt; method anyway compares references.&lt;/p&gt;

&lt;p&gt;Hence unable to use &lt;b&gt;FileBasedSolrSpellChecker&lt;/b&gt; .  &lt;/p&gt;</comment>
                            <comment id="16409825" author="sarkaramrit2@gmail.com" created="Thu, 22 Mar 2018 16:31:18 +0000"  >&lt;p&gt;We faced the same issue for the configuring multiple spell checkers, &lt;tt&gt;FileBasedSolrSpellChecker&lt;/tt&gt; specifically. Uploaded patch, tests awaited.&lt;/p&gt;</comment>
                            <comment id="16411582" author="sarkaramrit2@gmail.com" created="Fri, 23 Mar 2018 15:36:28 +0000"  >&lt;p&gt;Test added, patch updated. Awaiting feedback.&lt;/p&gt;</comment>
                            <comment id="16411954" author="varunthacker" created="Fri, 23 Mar 2018 19:51:40 +0000"  >&lt;p&gt;Thanks Amrit for the patch and&#160; Abhishek for the analysis!&lt;/p&gt;

&lt;p&gt;If I understand this correctly there are&#160;2 issues here:&lt;/p&gt;

&lt;p&gt;Issue1: If you add 2 spellcheckers and both are configured with&#160;LuceneLevenshteinDistance then an exception will be thrown but it shouldn&apos;t. This is because the equals method has not been overriden. So this will fail.&#160;&lt;/p&gt;

&lt;p&gt;The test doesn&apos;t need to add a third spell checker and also should probably implement toString in LuceneLevenshteinDistance ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
cssc = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ConjunctionSolrSpellChecker();
levenstein1 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MockSolrSpellChecker(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; LuceneLevenshteinDistance());
levenstein2 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MockSolrSpellChecker(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; LuceneLevenshteinDistance());

cssc.addChecker(levenstein1);
cssc.addChecker(levenstein2);

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Issue2:&#160;This should be an init failure and not during a query.&#160;Maybe&#160;ConjunctionSolrSpellChecker could have a constructor that takes a&#160;stringDistance and&#160;accuracy and avoids all these checks? Let&apos;s spin that off in other Jira and discuss there.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Also while we&apos;re working on this patch can we validate the&#160;accuracy/queryAnalyzer checks works as expected and have a test for that?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16412114" author="sarkaramrit2@gmail.com" created="Fri, 23 Mar 2018 21:32:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt;: thank you for the feedback.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The test doesn&apos;t need to add a third spell checker and also should probably implement toString in LuceneLevenshteinDistance ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Like &lt;tt&gt;LevenshteinDistance&lt;/tt&gt;. We want to prove here that A,A,B &lt;tt&gt;StringDistance&lt;/tt&gt; type will not go with each other, where A and B can be arbitrary. If we are verifying LuceneLevenshteinDistance of one spellchecker should match with other, it shouldn&apos;t with non-LuceneLevenshteinDistance stringDistance.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;This should be an init failure and not during a query. Maybe ConjunctionSolrSpellChecker could have a constructor that takes a stringDistance and accuracy and avoids all these checks? Let&apos;s spin that off in other Jira and discuss there.&lt;/p&gt;&lt;/blockquote&gt;

&lt;blockquote&gt;&lt;p&gt;Also while we&apos;re working on this patch can we validate the accuracy/queryAnalyzer checks works as expected and have a test for that?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;For both these points we need to extend / improve / diversify the ConjunctionSolrSpellCheckerTest which has MockSpellCheckers now. We can discuss.&lt;/p&gt;

&lt;p&gt;P.S. forgot, thank Abhishek, you analysis solved the problem anyway.&lt;/p&gt;</comment>
                            <comment id="16412129" author="varunthacker" created="Fri, 23 Mar 2018 21:41:59 +0000"  >&lt;blockquote&gt;&lt;p&gt;Like&#160;&lt;tt&gt;LevenshteinDistance&lt;/tt&gt;. We want to prove here that A,A,B&#160;&lt;tt&gt;StringDistance&lt;/tt&gt;&#160;type will not go with each other, where A and B can be arbitrary. If we are verifying LuceneLevenshteinDistance of one spellchecker should match with other, it shouldn&apos;t with non-LuceneLevenshteinDistance stringDistance.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;But today if we add two&#160;spell checkers both with&#160;LuceneLevenshteinDistance then&#160;ConjunctionSolrSpellChecker will fail. That&apos;s the Jira title and the fix but the test adds a third spell checker which makes it confusing as to what are we really testing&#160;&lt;/p&gt;</comment>
                            <comment id="16412135" author="jdyer" created="Fri, 23 Mar 2018 21:46:41 +0000"  >&lt;p&gt;Although I am away until w/o April 2, I might be able to help later on with this.&#160; My memory here is ConjunctionSpellChecker&#160; initially only worked for adding the WordBreakSpellchecker in with DirectSpellChecker.&#160; At the time, I thought a nice enhancement would eventually allow you to combine any spell checkers you wanted, say if you had multiple fields on a &quot;qf&quot; parameter, and you wanted individual spellcheckers for each.&#160; I am not so sure such general usage is possible at this time.&lt;/p&gt;</comment>
                            <comment id="16412175" author="sarkaramrit2@gmail.com" created="Fri, 23 Mar 2018 22:09:58 +0000"  >&lt;blockquote&gt;&lt;p&gt;But today if we add two spell checkers both with LuceneLevenshteinDistance then ConjunctionSolrSpellChecker will fail. That&apos;s the Jira title and the fix but the test adds a third spell checker which makes it confusing as to what are we really testing &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Makes sense. But since in the patch, we are overriding the &lt;tt&gt;equals&lt;/tt&gt; method of a class, we should test both assertions, equal and not equal, that was the motivation behind the test.&lt;/p&gt;

&lt;p&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jdyer&quot; class=&quot;user-hover&quot; rel=&quot;jdyer&quot;&gt;jdyer&lt;/a&gt; if I remember correctly, Abhishek was working on something similar, I will try to track down the jira.&lt;/p&gt;</comment>
                            <comment id="16419199" author="sarkaramrit2@gmail.com" created="Thu, 29 Mar 2018 15:30:04 +0000"  >&lt;p&gt;Final patch uploaded, with proper comments, &lt;tt&gt;ant precommit&lt;/tt&gt; is not working on my system some random JARs not found. Tests added based on recommendation,&lt;/p&gt;</comment>
                            <comment id="16427495" author="jdyer" created="Thu, 5 Apr 2018 19:43:49 +0000"  >&lt;p&gt;See my version of the patch.  This also adds an &quot;equals&quot; method to LuceneLevenshteinDistance and improves the test to check that known StringDistance&apos;s implement &quot;equals&quot; and behave properly with CSSC.  This is a bit less of a change than prior patches.  If this is deemed adequate, I can commit this soon.&lt;/p&gt;</comment>
                            <comment id="16427507" author="sarkaramrit2@gmail.com" created="Thu, 5 Apr 2018 19:54:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jdyer&quot; class=&quot;user-hover&quot; rel=&quot;jdyer&quot;&gt;jdyer&lt;/a&gt;, thank you for the updated one. In the prior patches I have included the included you have with the latest, along with verifying &lt;tt&gt;Analyzer&lt;/tt&gt; and &lt;tt&gt;Accuracy&lt;/tt&gt;. I also validate the correctness of CSSC in &lt;tt&gt;SpellCheckCollatorTest&lt;/tt&gt;. If you think we should open a new jira to add those correctness-tests, let me know I will do the same.&lt;/p&gt;</comment>
                            <comment id="16427580" author="jdyer" created="Thu, 5 Apr 2018 20:57:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sarkaramrit2%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;sarkaramrit2@gmail.com&quot;&gt;sarkaramrit2@gmail.com&lt;/a&gt;, will just checking for the StringDistance properly solve your problem?  If so, I think we should limit to this.  Beyond this simple fix, we likely need to re-think how we configure CSSC as suggested by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt;.  CSSC was put here to allow you to use WordBreakSolrSpellChecker with another spell checker, and as WBSSC does not use its own Analyzer, these checks are moot.  But I can see the use of expanding this to let you have any combinations of spell checkers, its just not robust enough to handle that as it exists now.&lt;/p&gt;</comment>
                            <comment id="16436080" author="sarkaramrit2@gmail.com" created="Thu, 12 Apr 2018 18:14:11 +0000"  >&lt;blockquote&gt;&lt;p&gt;will just checking for the StringDistance properly solve your problem?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It does and I agree with you. It is therefore another conversation I guess we can have on a seperate jira of extending CSSC capabilities. But will appreciate if at least we can get this into master, we can still work it out by using other &lt;tt&gt;distanceMeasure&lt;/tt&gt; available.&lt;/p&gt;</comment>
                            <comment id="16437504" author="jira-bot" created="Fri, 13 Apr 2018 16:13:01 +0000"  >&lt;p&gt;Commit 12bd5f9448f70b9fdc450dac916dbd1a83edafbc in lucene-solr&apos;s branch refs/heads/master from jdyer1&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=12bd5f9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=12bd5f9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10513&quot; title=&quot;CLONE - ConjunctionSolrSpellChecker wrong check for same string distance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10513&quot;&gt;&lt;del&gt;SOLR-10513&lt;/del&gt;&lt;/a&gt;: Implement .equals() for LuceneLevenshteinDistance.&lt;/p&gt;</comment>
                            <comment id="16437511" author="jira-bot" created="Fri, 13 Apr 2018 16:14:41 +0000"  >&lt;p&gt;Commit 6d771dcc9f0c6cbb33b1b5cf6c60f126713d9555 in lucene-solr&apos;s branch refs/heads/branch_7x from jdyer1&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6d771dc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=6d771dc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-10513&quot; title=&quot;CLONE - ConjunctionSolrSpellChecker wrong check for same string distance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-10513&quot;&gt;&lt;del&gt;SOLR-10513&lt;/del&gt;&lt;/a&gt;: Implement .equals() for LuceneLevenshteinDistance.&lt;/p&gt;</comment>
                            <comment id="16437742" author="jdyer" created="Fri, 13 Apr 2018 18:48:22 +0000"  >&lt;p&gt;Committed on master and branch_7x.  Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sarkaramrit2%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;sarkaramrit2@gmail.com&quot;&gt;sarkaramrit2@gmail.com&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=asingh2411&quot; class=&quot;user-hover&quot; rel=&quot;asingh2411&quot;&gt;asingh2411&lt;/a&gt; .&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10020">
                    <name>Cloners</name>
                                            <outwardlinks description="is a clone of">
                                        <issuelink>
            <issuekey id="12729385">SOLR-6271</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12917763" name="SOLR-10513.patch" size="4653" author="jdyer" created="Thu, 5 Apr 2018 19:40:26 +0000"/>
                            <attachment id="12916847" name="SOLR-10513.patch" size="11778" author="sarkaramrit2@gmail.com" created="Thu, 29 Mar 2018 15:28:33 +0000"/>
                            <attachment id="12916761" name="SOLR-10513.patch" size="12073" author="sarkaramrit2@gmail.com" created="Thu, 29 Mar 2018 07:39:04 +0000"/>
                            <attachment id="12916387" name="SOLR-10513.patch" size="10054" author="sarkaramrit2@gmail.com" created="Tue, 27 Mar 2018 12:04:54 +0000"/>
                            <attachment id="12916365" name="SOLR-10513.patch" size="4040" author="sarkaramrit2@gmail.com" created="Tue, 27 Mar 2018 09:33:44 +0000"/>
                            <attachment id="12915921" name="SOLR-10513.patch" size="3219" author="sarkaramrit2@gmail.com" created="Fri, 23 Mar 2018 15:36:13 +0000"/>
                            <attachment id="12915714" name="SOLR-10513.patch" size="1649" author="sarkaramrit2@gmail.com" created="Thu, 22 Mar 2018 16:27:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 31 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3dr7r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>