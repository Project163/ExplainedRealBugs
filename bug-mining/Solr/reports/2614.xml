<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:07:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-7876] Support disabling ExitableDirectory wrapper when not needed</title>
                <link>https://issues.apache.org/jira/browse/SOLR-7876</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;ExitableDirectoryReader can cause some overhead in Solr for some use cases, even when not really used. There should be a way of not using it when not needed.&lt;br/&gt;
See &lt;a href=&quot;http://search-lucene.com/m/l6pAi1HLrodLhNUd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://search-lucene.com/m/l6pAi1HLrodLhNUd&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12852304">SOLR-7876</key>
            <summary>Support disabling ExitableDirectory wrapper when not needed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yseeley@gmail.com">Yonik Seeley</assignee>
                                    <reporter username="tflobbe">Tomas Eduardo Fernandez Lobbe</reporter>
                        <labels>
                    </labels>
                <created>Wed, 5 Aug 2015 17:13:43 +0000</created>
                <updated>Mon, 9 May 2016 18:55:54 +0000</updated>
                            <resolved>Mon, 31 Aug 2015 16:44:27 +0000</resolved>
                                    <version>5.0</version>
                    <version>5.1</version>
                    <version>5.2</version>
                    <version>5.2.1</version>
                                    <fixVersion>6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14660230" author="yseeley@gmail.com" created="Thu, 6 Aug 2015 16:13:29 +0000"  >&lt;p&gt;Thanks for finding this Tomas! This is a pretty bad performance regression for certain cases (facet.method=enum should be hit pretty hard too I imagine, along with any code that un-inverts a field).&lt;/p&gt;

&lt;p&gt;We should try to fix this for 5.3!&lt;/p&gt;</comment>
                            <comment id="14660248" author="tomasflobbe" created="Thu, 6 Aug 2015 16:24:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;We should try to fix this for 5.3!&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;+1. I&apos;m looking at &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7875&quot; title=&quot;Speedup SolrQueryTimeoutImpl&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7875&quot;&gt;&lt;del&gt;SOLR-7875&lt;/del&gt;&lt;/a&gt; first, but if after improving SolrQueryTimeoutImpl the performance is not still as good as the un-wrapped version I think we should have a way to skip the wrapping. &lt;/p&gt;</comment>
                            <comment id="14662397" author="yseeley@gmail.com" created="Fri, 7 Aug 2015 20:36:54 +0000"  >&lt;p&gt;I tried implementing something that would use a different reader when a timeout isn&apos;t needed on a per-query basis, but I ran into issues&lt;br/&gt;
From TermQuery / TermWeight:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;      &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; termStates.topReaderContext == ReaderUtil.getTopLevelContext(context) : &lt;span class=&quot;code-quote&quot;&gt;&quot;The top-reader used to create Weight (&quot;&lt;/span&gt; + termStates.topReaderContext + &lt;span class=&quot;code-quote&quot;&gt;&quot;) is not the same as the current reader&apos;s top-reader (&quot;&lt;/span&gt; + ReaderUtil.getTopLevelContext(context);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;createWeight takes a searcher, and the TermWeight implementation remembers the top reader context from that searcher, later comparing it against the readers used for scoring.&lt;/p&gt;</comment>
                            <comment id="14662429" author="tomasflobbe" created="Fri, 7 Aug 2015 20:52:11 +0000"  >&lt;p&gt;I got into the exact same problem, query must be rewritten with the same reader as the one used to search. Is it a good idea to chose different readers based on parameters for search? Seems like o.a.l.s.IndexSearcher is not designed to do it.&lt;/p&gt;</comment>
                            <comment id="14680421" author="yseeley@gmail.com" created="Mon, 10 Aug 2015 17:38:44 +0000"  >&lt;p&gt;Only way I can think of to work around it is to use a thread local (like SolrRequestInfo) to return one reader or the other for searcher.getTopReaderContext().  I don&apos;t really like it, but it might be the only way.&lt;/p&gt;</comment>
                            <comment id="14713391" author="shalinmangar" created="Wed, 26 Aug 2015 13:14:27 +0000"  >&lt;p&gt;Bulk move to 5.4 after 5.3 release.&lt;/p&gt;</comment>
                            <comment id="14721347" author="yseeley@gmail.com" created="Sun, 30 Aug 2015 01:59:08 +0000"  >&lt;p&gt;Here&apos;s a generic patch that escapes the ExitableDirectoryReader wrapping as soon as possible (in the fields() call).  It should work, but I haven&apos;t had a chance to test the performance.&lt;/p&gt;</comment>
                            <comment id="14721349" author="erickerickson" created="Sun, 30 Aug 2015 02:12:07 +0000"  >&lt;p&gt;Interesting. This patch fixes one of the new tests I made for &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7990&quot; title=&quot;timeAllowed is returning wrong results on the same query submitted with different timeAllowed limits&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7990&quot;&gt;&lt;del&gt;SOLR-7990&lt;/del&gt;&lt;/a&gt;. TimeAllowedCachingTest.testQueryResults. Submitting a query that times out followed immediately by an identical one only with a bigger timeAllowed that does NOT time out used to still return partialResults=true but doesn&apos;t with this patch. Which makes some sense I think.&lt;/p&gt;</comment>
                            <comment id="14721352" author="yseeley@gmail.com" created="Sun, 30 Aug 2015 02:27:51 +0000"  >&lt;p&gt;Hmmm, that is interesting, and it raises red flags for me as I&apos;m not sure why this patch would affect caching.  ExitableDirectoryReader and friends delegate cache core keys to the underlying readers.  Any theories / clues?&lt;/p&gt;</comment>
                            <comment id="14721355" author="erickerickson" created="Sun, 30 Aug 2015 02:52:43 +0000"  >&lt;p&gt;The test that it cured was this sequence:&lt;/p&gt;

&lt;p&gt;&amp;gt; send a query that times out (no fq clauses)&lt;br/&gt;
&amp;gt; send the same query that does not time out (still no fq  clauses)&lt;br/&gt;
***&amp;gt;test the second response to see if partialResults==true&lt;/p&gt;

&lt;p&gt;It&apos;s the *** part the suddenly succeeded after this patch. Prior to this patch partialResults was true, now it&apos;s just not returned in the second response at all, which makes sense on the surface if your patch bails out from that wrapper earlier. This test was returning the correct number of docs before, it was just that the partialResults was incorrectly returned.&lt;/p&gt;

&lt;p&gt;The tests that go against the filterCache are &lt;em&gt;still&lt;/em&gt; failing though, so it&apos;s not like this patch magically fixed any of the caching problems.&lt;/p&gt;

&lt;p&gt;So I&apos;d guess not returning the partialResults flag makes more sense in terms of this patch?&lt;/p&gt;

&lt;p&gt;Haven&apos;t updated the test patch yet, just tried it locally.&lt;/p&gt;</comment>
                            <comment id="14721556" author="erickerickson" created="Sun, 30 Aug 2015 15:11:45 +0000"  >&lt;p&gt;OK, on a second look it was a bad test. &lt;/p&gt;

&lt;p&gt;copy/pasted the original code for the first call with timeAllowed=1 that looked at partialResults but didn&apos;t test for null. Just saw the error and didn&apos;t read it carefully.&lt;/p&gt;

&lt;p&gt;assertFalse(&quot;Should NOT have partial results&quot;, (Boolean) (header.get(&quot;partialResults&quot;));&lt;/p&gt;

&lt;p&gt;When timeAllowed=1000, get(&quot;partialResults&quot;) returns null.....&lt;/p&gt;

&lt;p&gt;So this patch has no effect whatsoever on the new tests I wrote. I removed the linked-to.&lt;/p&gt;</comment>
                            <comment id="14721603" author="yseeley@gmail.com" created="Sun, 30 Aug 2015 17:03:43 +0000"  >&lt;p&gt;OK, I did some ad-hoc performance testing on near worst case range query on id field and saw an 8% performance improvement on my box.&lt;br/&gt;
I&apos;ll plan on committing this shortly.&lt;/p&gt;</comment>
                            <comment id="14723662" author="jira-bot" created="Mon, 31 Aug 2015 16:43:58 +0000"  >&lt;p&gt;Commit 1700276 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1700276&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1700276&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7876&quot; title=&quot;Support disabling ExitableDirectory wrapper when not needed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7876&quot;&gt;&lt;del&gt;SOLR-7876&lt;/del&gt;&lt;/a&gt;: exit ExitableDirectoryReader wrapper if timeout is not enabled&lt;/p&gt;</comment>
                            <comment id="14737663" author="tomasflobbe" created="Wed, 9 Sep 2015 21:58:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yseeley%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;yseeley@gmail.com&quot;&gt;yseeley@gmail.com&lt;/a&gt;, Any reason why this couldn&apos;t be backported?&lt;/p&gt;</comment>
                            <comment id="14737746" author="yseeley@gmail.com" created="Wed, 9 Sep 2015 22:48:35 +0000"  >&lt;p&gt;The QueryTimeout interface was put into Lucene when this feature (&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5986&quot; title=&quot;Don&amp;#39;t allow runaway queries from harming Solr cluster health or search performance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5986&quot;&gt;&lt;del&gt;SOLR-5986&lt;/del&gt;&lt;/a&gt;) was committed, and I changed it&apos;s signature.&lt;/p&gt;</comment>
                            <comment id="14737850" author="tomasflobbe" created="Thu, 10 Sep 2015 00:08:56 +0000"  >&lt;p&gt;Oh, I didn&apos;t notice you where changing the interface. Makes sense then.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12753163" name="SOLR-7876.patch" size="1846" author="yseeley@gmail.com" created="Sun, 30 Aug 2015 01:59:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 10 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2idhj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>