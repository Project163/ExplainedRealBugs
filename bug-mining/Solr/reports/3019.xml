<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:14:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-9236] AutoAddReplicas feature with one replica loses some documents not committed during failover</title>
                <link>https://issues.apache.org/jira/browse/SOLR-9236</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;I need to index huge amount of logs, so I decide to use AutoAddReplica feature with only one replica.&lt;br/&gt;
When using AutoAddReplicas with one replica, some benefits are expected.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;no redundant data files for replicas
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;saving disk usage&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;best indexing performance&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I expected that Solr fails over just like HBase.&lt;br/&gt;
The feature worked almost as it was expected, except for some missing documents during failover.&lt;br/&gt;
I found two reasons for the missing.&lt;/p&gt;

&lt;p&gt;1. The leader replica does not replay any transaction logs. But when there is only one replica, it should be the leader.&lt;br/&gt;
So I made the leader replica replay the transaction logs when using AutoAddReplicas with on replica.&lt;/p&gt;

&lt;p&gt;But the above fix did not resolve the problem.&lt;/p&gt;

&lt;p&gt;2. As failover occurred, the transaction log directory had a deeper directory depth. Just like this, tlog/tlog/tlog/...&lt;br/&gt;
The transaction log could not be replayed, because the transaction log directory was changed during failover. &lt;br/&gt;
So I made the transaction log directory not changed during failover.&lt;/p&gt;

&lt;p&gt;After these fixes, AutoAddReplicas with one replica fails over well without losing any documents.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12981354">SOLR-9236</key>
            <summary>AutoAddReplicas feature with one replica loses some documents not committed during failover</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="markrmiller@gmail.com">Mark Miller</assignee>
                                    <reporter username="Eungsop Yoo">Eungsop Yoo</reporter>
                        <labels>
                    </labels>
                <created>Tue, 21 Jun 2016 13:52:19 +0000</created>
                <updated>Fri, 14 Apr 2017 14:03:10 +0000</updated>
                            <resolved>Thu, 11 Aug 2016 15:54:37 +0000</resolved>
                                                    <fixVersion>6.2</fixVersion>
                    <fixVersion>7.0</fixVersion>
                                    <component>hdfs</component>
                    <component>SolrCloud</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="15357508" author="markrmiller@gmail.com" created="Thu, 30 Jun 2016 17:25:46 +0000"  >&lt;blockquote&gt;&lt;p&gt;the leader does not replay any transaction logs&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think that may actually be a mistake.&lt;/p&gt;

&lt;p&gt;Here is a patch that uses your test additions and attempts to fix a bit differently.&lt;/p&gt;</comment>
                            <comment id="15358090" author="eungsop yoo" created="Fri, 1 Jul 2016 00:17:12 +0000"  >&lt;p&gt;LGTM&lt;/p&gt;</comment>
                            <comment id="15362772" author="markrmiller@gmail.com" created="Tue, 5 Jul 2016 16:57:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;the leader does not replay any transaction logs&lt;/p&gt;&lt;/blockquote&gt;

&lt;blockquote&gt;&lt;p&gt;I think that may actually be a mistake.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Actually, I guess I was reading it wrong. That should have no affect here. That isleader check is only taken into account when a slice is under construction for shard spitting or migration or something.&lt;/p&gt;

&lt;p&gt;I think we just need the extra /tlog appending fix.&lt;/p&gt;</comment>
                            <comment id="15366107" author="jira-bot" created="Thu, 7 Jul 2016 13:38:29 +0000"  >&lt;p&gt;Commit 546093812c34610075ee130f7466eca1979cfbeb in lucene-solr&apos;s branch refs/heads/master from markrmiller&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5460938&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=5460938&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9236&quot; title=&quot;AutoAddReplicas feature with one replica loses some documents not committed during failover&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9236&quot;&gt;&lt;del&gt;SOLR-9236&lt;/del&gt;&lt;/a&gt;: AutoAddReplicas will append an extra /tlog to the update log location on replica failover.&lt;/p&gt;</comment>
                            <comment id="15366110" author="jira-bot" created="Thu, 7 Jul 2016 13:39:15 +0000"  >&lt;p&gt;Commit dc763e383d4293f9dc235bcc63ae2fba582574ff in lucene-solr&apos;s branch refs/heads/branch_6x from markrmiller&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=dc763e3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=dc763e3&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9236&quot; title=&quot;AutoAddReplicas feature with one replica loses some documents not committed during failover&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9236&quot;&gt;&lt;del&gt;SOLR-9236&lt;/del&gt;&lt;/a&gt;: AutoAddReplicas will append an extra /tlog to the update log location on replica failover.&lt;/p&gt;</comment>
                            <comment id="15366253" author="steve_rowe" created="Thu, 7 Jul 2016 15:10:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt;, test compilation is broken on master &amp;amp; branch_6x, I think because of this issue - here&apos;s the branch_6x error I get:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;common.compile-test:
    [mkdir] Created dir: /Users/sarowe/git/lucene-solr-2/solr/build/solr-core/classes/test
    [javac] Compiling 675 source files to /Users/sarowe/git/lucene-solr-2/solr/build/solr-core/classes/test
    [javac] /Users/sarowe/git/lucene-solr-2/solr/core/src/test/org/apache/solr/cloud/SharedFSAutoReplicaFailoverTest.java:65: error: cannot find symbol
    [javac] @Nightly
    [javac]  ^
    [javac]   symbol: class Nightly
    [javac] Note: Some input files use or override a deprecated API.
    [javac] Note: Recompile with -Xlint:deprecation for details.
    [javac] Note: Some input files use unchecked or unsafe operations.
    [javac] Note: Recompile with -Xlint:unchecked for details.
    [javac] 1 error
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15366260" author="markrmiller@gmail.com" created="Thu, 7 Jul 2016 15:13:46 +0000"  >&lt;p&gt;Whoops. Removed commenting out the nightly annotation, but bringing back the missing import didn&apos;t make the commit. &lt;/p&gt;</comment>
                            <comment id="15366381" author="jira-bot" created="Thu, 7 Jul 2016 16:47:08 +0000"  >&lt;p&gt;Commit c58841558354c9b27fe502cad60907a62645bf3b in lucene-solr&apos;s branch refs/heads/master from markrmiller&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c588415&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c588415&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9236&quot; title=&quot;AutoAddReplicas feature with one replica loses some documents not committed during failover&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9236&quot;&gt;&lt;del&gt;SOLR-9236&lt;/del&gt;&lt;/a&gt;: Fix import.&lt;/p&gt;</comment>
                            <comment id="15366385" author="jira-bot" created="Thu, 7 Jul 2016 16:47:58 +0000"  >&lt;p&gt;Commit e91863b8e1b09c31e7b0c0e828b594ec9c022547 in lucene-solr&apos;s branch refs/heads/branch_6x from markrmiller&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e91863b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e91863b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9236&quot; title=&quot;AutoAddReplicas feature with one replica loses some documents not committed during failover&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9236&quot;&gt;&lt;del&gt;SOLR-9236&lt;/del&gt;&lt;/a&gt;: Fix import.&lt;/p&gt;</comment>
                            <comment id="15366992" author="steve_rowe" created="Fri, 8 Jul 2016 00:08:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt;, did you see the following Jenkins precommit failure?:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[forbidden-apis] Forbidden method invocation: java.lang.System#currentTimeMillis() [Use RTimer/TimeOut/System.nanoTime for time comparisons, and `new Date()` output/debugging/stats of timestamps. If for some miscellaneous reason, you absolutely need to use this, use a SuppressForbidden.]
[forbidden-apis]   in org.apache.solr.cloud.SharedFSAutoReplicaFailoverTest (SharedFSAutoReplicaFailoverTest.java:317)
[forbidden-apis] Forbidden method invocation: java.lang.System#currentTimeMillis() [Use RTimer/TimeOut/System.nanoTime for time comparisons, and `new Date()` output/debugging/stats of timestamps. If for some miscellaneous reason, you absolutely need to use this, use a SuppressForbidden.]
[forbidden-apis]   in org.apache.solr.cloud.SharedFSAutoReplicaFailoverTest (SharedFSAutoReplicaFailoverTest.java:321)
[forbidden-apis] Scanned 3254 (and 2112 related) class file(s) for forbidden API invocations (in 5.11s), 2 error(s).
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15367016" author="jira-bot" created="Fri, 8 Jul 2016 00:32:02 +0000"  >&lt;p&gt;Commit 91a9d96454c80f5f414170c4231c5b22fb094215 in lucene-solr&apos;s branch refs/heads/master from markrmiller&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=91a9d96&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=91a9d96&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9236&quot; title=&quot;AutoAddReplicas feature with one replica loses some documents not committed during failover&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9236&quot;&gt;&lt;del&gt;SOLR-9236&lt;/del&gt;&lt;/a&gt;: Don&apos;t use System.currentTimeMillis.&lt;/p&gt;</comment>
                            <comment id="15367017" author="jira-bot" created="Fri, 8 Jul 2016 00:32:21 +0000"  >&lt;p&gt;Commit b0386f0d643febdaed32575cccc84eb06af08f5c in lucene-solr&apos;s branch refs/heads/branch_6x from markrmiller&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b0386f0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=b0386f0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9236&quot; title=&quot;AutoAddReplicas feature with one replica loses some documents not committed during failover&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9236&quot;&gt;&lt;del&gt;SOLR-9236&lt;/del&gt;&lt;/a&gt;: Don&apos;t use System.currentTimeMillis.&lt;/p&gt;</comment>
                            <comment id="15402682" author="mdrob" created="Mon, 1 Aug 2016 19:33:18 +0000"  >&lt;p&gt;Is there work left on this or can we close? Looks done to me?&lt;/p&gt;</comment>
                            <comment id="15438971" author="mikemccand" created="Fri, 26 Aug 2016 13:59:05 +0000"  >&lt;p&gt;Bulk close resolved issues after 6.2.0 release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12815509" name="SOLR-9236.patch" size="12975" author="markrmiller@gmail.com" created="Thu, 30 Jun 2016 17:25:46 +0000"/>
                            <attachment id="12812178" name="SOLR-9236.patch" size="16302" author="Eungsop Yoo" created="Tue, 21 Jun 2016 13:53:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 12 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2zt9b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>