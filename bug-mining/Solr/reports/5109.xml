<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:07:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-16991] Concurrent requests failing JWT Auth intermittently</title>
                <link>https://issues.apache.org/jira/browse/SOLR-16991</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;There&apos;s an intermittent failure in JWT authentication, with a roughly 20% failure rate (depends on the network latency). Upon investigating, I identified a race condition due to simultaneous HTTP requests within the authentication process. Here&apos;s the chain of events:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;The user initiates the OAuth/IdProvider authentication process. Once completed, they are redirected back to Solr.&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;&lt;em&gt;LoginController&lt;/em&gt;&#160;is then activated to handle the response from the IdProvider.&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;&lt;em&gt;LoginController&lt;/em&gt; calls &quot;&lt;a href=&quot;https://github.com/apache/solr/blob/51c1a785c4611d0103f7b73c8adefa028d608bcd/solr/webapp/web/js/angular/controllers/login.js#L21&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;resetMenu&lt;/a&gt;&quot; method which triggers requests to the &quot;admin/info/system&quot; and &quot;admin/cores&quot; endpoints. These requests are bound to fail as the &lt;em&gt;auth.header&lt;/em&gt;&#160;hasn&apos;t been set yet.&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;The authentication process continues with the processing of the IdProvider&apos;s response. If successful, the&#160;&lt;em&gt;auth.header&lt;/em&gt;&#160;&lt;a href=&quot;https://github.com/apache/solr/blob/51c1a785c4611d0103f7b73c8adefa028d608bcd/solr/webapp/web/js/angular/controllers/login.js#L151&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;is set&lt;/a&gt;.&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;The response from step 3 is received and returns a 401 error, causing the&#160;&lt;em&gt;auth.header&lt;/em&gt;&#160;to be&#160;&lt;a href=&quot;https://github.com/apache/solr/blob/51c1a785c4611d0103f7b73c8adefa028d608bcd/solr/webapp/web/js/angular/app.js#L440&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;unset&lt;/a&gt;&#160;in&#160;&lt;em&gt;app&lt;/em&gt;.js.&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;This results in the session being terminated and the entire authentication process failing.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;This race condition, where requests are made before setting the authentication header and their subsequent failure clears an already set header, leads to the observed intermittent authentication issues.&lt;/p&gt;

&lt;p&gt;Is the &quot;resetMenu&quot; call necessary ? My inclination is that this is useless because why would you need to reset the menu in the middle of an authentication process? All we need is either show or hide the menu depending on the existence or not of an active&#160; user session. The menu would be reset after the user is authenticated.&lt;/p&gt;

&lt;p&gt;Replaced the call to &lt;em&gt;resetMenu&lt;/em&gt;&#160;with a call to a newly added method &lt;em&gt;showHideMenu&lt;/em&gt; and it worked nicely.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 $scope.showHideMenu = function() {
    $scope.http401 = sessionStorage.getItem(&lt;span class=&quot;code-quote&quot;&gt;&quot;http401&quot;&lt;/span&gt;);
  };
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13551559">SOLR-16991</key>
            <summary>Concurrent requests failing JWT Auth intermittently</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="janhoy">Jan H&#248;ydahl</assignee>
                                    <reporter username="Idjeraoui">Lamine</reporter>
                        <labels>
                    </labels>
                <created>Thu, 21 Sep 2023 16:46:22 +0000</created>
                <updated>Sun, 15 Oct 2023 20:13:54 +0000</updated>
                            <resolved>Sat, 23 Sep 2023 21:01:45 +0000</resolved>
                                                    <fixVersion>9.4</fixVersion>
                                    <component>Authentication</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3600">1h</timespent>
                                <comments>
                            <comment id="17767641" author="JIRAUSER282315" created="Thu, 21 Sep 2023 16:48:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=janhoy&quot; class=&quot;user-hover&quot; rel=&quot;janhoy&quot;&gt;janhoy&lt;/a&gt;&#160;&lt;br/&gt;
What are your thoughts on this?&lt;/p&gt;</comment>
                            <comment id="17767657" author="janhoy" created="Thu, 21 Sep 2023 17:33:03 +0000"  >&lt;p&gt;I believe the reset was to get the logged-in user&apos;s name into the left menu and also show/hide relevant menu items. So if the new method does exactly what&apos;s needed, then that sounds better!&lt;/p&gt;</comment>
                            <comment id="17768306" author="jira-bot" created="Sat, 23 Sep 2023 17:29:55 +0000"  >&lt;p&gt;Commit 4980fbd1dd89a44086e52b9950cf181585001343 in solr&apos;s branch refs/heads/main from Lamine&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=4980fbd1dd8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=4980fbd1dd8&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16991&quot; title=&quot;Concurrent requests failing JWT Auth intermittently&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16991&quot;&gt;&lt;del&gt;SOLR-16991&lt;/del&gt;&lt;/a&gt;: Fix bug: Concurrent requests failing JWT Auth intermittently (#1949)&lt;/p&gt;
</comment>
                            <comment id="17768307" author="jira-bot" created="Sat, 23 Sep 2023 17:38:48 +0000"  >&lt;p&gt;Commit db626d9b3a73c7a4ad22cdf50cd3e620ff513c3d in solr&apos;s branch refs/heads/branch_9x from Lamine&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=db626d9b3a7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=db626d9b3a7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16991&quot; title=&quot;Concurrent requests failing JWT Auth intermittently&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16991&quot;&gt;&lt;del&gt;SOLR-16991&lt;/del&gt;&lt;/a&gt;: Fix bug: Concurrent requests failing JWT Auth intermittently (#1949)&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 4980fbd1dd89a44086e52b9950cf181585001343)&lt;/p&gt;</comment>
                            <comment id="17775434" author="alex.parvulescu" created="Sun, 15 Oct 2023 19:57:03 +0000"  >&lt;p&gt;Closing after the 9.4.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 4 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1kidk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>