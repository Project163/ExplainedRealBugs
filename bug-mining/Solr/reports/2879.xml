<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:12:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-8449] Multiple restores on the same core does not work</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8449</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Hi all, I facing the following issue with Solr 5.2.1 and the ongoing version 5.4.&lt;br/&gt;
The restore functionality is not working under Linux and causing an exception on Windows machines each time you want to restore an existing backup twice or even more.&lt;/p&gt;

&lt;p&gt;Steps to reproduce:&lt;br/&gt;
1. Start a Solr instance pointing the solr_home to e.g. the example-DIH  folder.&lt;br/&gt;
2. Select a core, e.g. the &#8220;solr&#8221; core.&lt;br/&gt;
3. Switch to the &#8220;Documents&#8221; tab&lt;br/&gt;
4. Add a document &lt;/p&gt;
{&#8220;id&#8221;:&#8221;1&#8221;,&#8221;title&#8221;:&#8221;change.me&#8221;}
&lt;p&gt;5. Do a backup with the following API call &#8220;/solr/replication?command=backup&amp;amp;name=test&#8221;&lt;br/&gt;
The backup defaults to the location solr_home/solr/data/snapshot.test&lt;br/&gt;
6. Add a document to the index &lt;/p&gt;
{&#8220;id&#8221;:&#8221;2&#8221;,&#8221;title&#8221;:&#8221;change.me&#8221;}
&lt;p&gt;. Now there a two document in the index.&lt;br/&gt;
7. Restore the back with the following call &#8220;/solr/replication?command=restore&amp;amp;name=test&#8221;&lt;br/&gt;
New index location &#8220;solr_home/solr/data/restore.snapshot.test&#8221; is created without any physical file in it, except the file write.lock. Num Docs is now 1 as expected!&lt;br/&gt;
8. Add a document to the index &lt;/p&gt;
{&#8220;id&#8221;:&#8221;3&#8221;,&#8221;title&#8221;:&#8221;change.me&#8221;}
&lt;p&gt;. Now there a two document in the index.&lt;br/&gt;
9. Restore the same previous created back again with the following call &#8220;/solr/replication?command=restore&amp;amp;name=test&#8221;. Notice, there are still 2 docs in the index!!!&lt;br/&gt;
10. Try to restore again, but still the same, 2 docs in the index&#8230;&lt;br/&gt;
11. Shut down Solr, you will see the index folder &#8220;solr_home/solr/data/restore.snapshot.test&#8221; disappears.&lt;br/&gt;
12. Restart Solr. You will notice the following log entry &#8220;Solr index directory &#8216;solr_home/solr/data/restore.snapshot.test&#8217; doesn&#8217;t exist. Creating new index&#8221;, and indeed the Index is empty, showing 0 documents.&lt;br/&gt;
13. After the restart, I tried to restore the existing backup again without any results&#8230;&lt;/p&gt;

&lt;p&gt;I thing this behavior in not intended!!!&lt;/p&gt;

&lt;p&gt;Even more Problems arise when you run Solr on a Windows machine.&lt;br/&gt;
After step 10 a folder &#8220;index&#8221; is created under &#8220;solr_home/solr/data/&#8221; with a write.lock file in it. After that, the following exception is thrown: &lt;br/&gt;
&#8230;Error closing IndexWriter&lt;br/&gt;
java.lang.IllegalStateException: file: MMapDirectory@D:\solr\Solr_versions\solr-5.2.1\...restore.snapshot.test lockFactory=org.apache.lucene.store.Nat&lt;br/&gt;
iveFSLockFactory@3d3d7a0e appears both in delegate and in cache&lt;/p&gt;

&lt;p&gt;The log file from the Windows test is attached.&lt;/p&gt;

&lt;p&gt;Let me know if you have problems reproducing the same behavior,&lt;/p&gt;

&lt;p&gt;Regards Johannes&lt;/p&gt;</description>
                <environment>&lt;p&gt;SUSE Linux Enterprise Server 11 (64 bit) and Windows 7 Prof SP1&lt;/p&gt;</environment>
        <key id="12923415">SOLR-8449</key>
            <summary>Multiple restores on the same core does not work</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="varun">Varun Thacker</assignee>
                                    <reporter username="jomarley">Johannes Brucher</reporter>
                        <labels>
                            <label>Backup/Restore</label>
                    </labels>
                <created>Mon, 21 Dec 2015 12:40:42 +0000</created>
                <updated>Thu, 21 Nov 2019 00:41:42 +0000</updated>
                            <resolved>Fri, 22 Apr 2016 00:20:24 +0000</resolved>
                                    <version>5.2.1</version>
                    <version>5.4</version>
                                    <fixVersion>5.5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>replication (java)</component>
                    <component>replication (scripts)</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15066406" author="jomarley" created="Mon, 21 Dec 2015 12:44:09 +0000"  >&lt;p&gt;Exceptions from the windows 7 restore test attached...&lt;/p&gt;</comment>
                            <comment id="15108995" author="varunthacker" created="Wed, 20 Jan 2016 17:28:49 +0000"  >&lt;blockquote&gt;&lt;p&gt;4. Add a document&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Do you call commit after that?&lt;/p&gt;</comment>
                            <comment id="15110268" author="jomarley" created="Thu, 21 Jan 2016 08:27:06 +0000"  >&lt;p&gt;I uploaded the document via the Admin UI/Core/Documents tab.&lt;br/&gt;
I think using this tab will automatically perform a commit in the background I guess, because after adding the doc its in the index.&lt;/p&gt;

&lt;p&gt;But to answer your question, after step 4 i did not explicitly call a commit statment!&lt;/p&gt;</comment>
                            <comment id="15110881" author="varunthacker" created="Thu, 21 Jan 2016 16:46:53 +0000"  >&lt;p&gt;Patch which fixes the problem.&lt;/p&gt;

&lt;p&gt;Previously we never supported restoring the same backup . Hence this bug was found.&lt;/p&gt;

&lt;p&gt;I&apos;ve tried it manually and it works with the steps listed out here. Still need to write some tests before committing this&lt;/p&gt;</comment>
                            <comment id="15181616" author="varunthacker" created="Sat, 5 Mar 2016 07:38:54 +0000"  >&lt;p&gt;Patch which fixes the problem and updated test case which will fail without the fix .&lt;/p&gt;

&lt;p&gt;The patch is a low risk fix. So &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nknize&quot; class=&quot;user-hover&quot; rel=&quot;nknize&quot;&gt;nknize&lt;/a&gt; cool if we backport it to 6.0 as well?&lt;/p&gt;</comment>
                            <comment id="15181759" author="nknize" created="Sat, 5 Mar 2016 15:46:02 +0000"  >&lt;p&gt;+1 for 6.0 backport &lt;/p&gt;</comment>
                            <comment id="15181874" author="jira-bot" created="Sat, 5 Mar 2016 22:43:36 +0000"  >&lt;p&gt;Commit 4381018b77f019ce2c579240538177b546ff3d86 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4381018&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=4381018&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8449&quot; title=&quot;Multiple restores on the same core does not work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8449&quot;&gt;&lt;del&gt;SOLR-8449&lt;/del&gt;&lt;/a&gt;: Fix the core restore functionality to allow restoring multiple times on the same core&lt;/p&gt;</comment>
                            <comment id="15181875" author="jira-bot" created="Sat, 5 Mar 2016 22:44:12 +0000"  >&lt;p&gt;Commit cb4a91eb7c61678939cd65d739ed57c4335181a3 in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=cb4a91e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=cb4a91e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8449&quot; title=&quot;Multiple restores on the same core does not work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8449&quot;&gt;&lt;del&gt;SOLR-8449&lt;/del&gt;&lt;/a&gt;: Fix the core restore functionality to allow restoring multiple times on the same core&lt;/p&gt;</comment>
                            <comment id="15181876" author="jira-bot" created="Sat, 5 Mar 2016 22:45:07 +0000"  >&lt;p&gt;Commit be021fcf6f3c87ab5ed51fb0f5dbfd08d752a899 in lucene-solr&apos;s branch refs/heads/branch_6_0 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varun&quot; class=&quot;user-hover&quot; rel=&quot;varun&quot;&gt;varun&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=be021fc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=be021fc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8449&quot; title=&quot;Multiple restores on the same core does not work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8449&quot;&gt;&lt;del&gt;SOLR-8449&lt;/del&gt;&lt;/a&gt;: Fix the core restore functionality to allow restoring multiple times on the same core&lt;/p&gt;</comment>
                            <comment id="15181877" author="varunthacker" created="Sat, 5 Mar 2016 22:46:03 +0000"  >&lt;p&gt;Thanks Johannes! This is now fixed for 6.0&lt;/p&gt;</comment>
                            <comment id="15252968" author="anshumg" created="Thu, 21 Apr 2016 23:04:40 +0000"  >&lt;p&gt;back porting for 5.5.1&lt;/p&gt;</comment>
                            <comment id="15253071" author="anshumg" created="Fri, 22 Apr 2016 00:28:36 +0000"  >&lt;p&gt;branch_5x:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;commit 443fd2d29a4326a2d483c33bcbfeb7e2f636f250
Author: Varun Thacker &amp;lt;varunthacker1989@gmail.com&amp;gt;
Date:   Sat Mar 5 13:15:19 2016 +0530

    SOLR-8449: Fix the core restore functionality to allow restoring multiple times on the same core
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;branch_5_5&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;commit efb7d4463ee5f1146ee193a46f6a146ca3f48d67
Author: Varun Thacker &amp;lt;varunthacker1989@gmail.com&amp;gt;
Date:   Sat Mar 5 13:15:19 2016 +0530

    SOLR-8449: Fix the core restore functionality to allow restoring multiple times on the same core
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12791612" name="SOLR-8449.patch" size="3870" author="varun" created="Sat, 5 Mar 2016 07:38:54 +0000"/>
                            <attachment id="12783608" name="SOLR-8449.patch" size="1644" author="varun" created="Thu, 21 Jan 2016 16:46:53 +0000"/>
                            <attachment id="12778817" name="log_windows7_sp1.txt" size="46984" author="jomarley" created="Mon, 21 Dec 2015 12:44:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 30 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2q5o7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>