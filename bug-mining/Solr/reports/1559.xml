<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:40:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-5319] Collection ZK nodes do not reflect the correct router chosen</title>
                <link>https://issues.apache.org/jira/browse/SOLR-5319</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;In ZkController.createCollectionZkNode, the doc router is determined by this code snippet:&lt;/p&gt;

&lt;p&gt;if (collectionProps.get(DocCollection.DOC_ROUTER) == null) {&lt;br/&gt;
            Object numShards = collectionProps.get(ZkStateReader.NUM_SHARDS_PROP);&lt;br/&gt;
            if (numShards == null) &lt;/p&gt;
{
              numShards = System.getProperty(ZkStateReader.NUM_SHARDS_PROP);
            }
&lt;p&gt;            if (numShards == null) &lt;/p&gt;
{
              collectionProps.put(DocCollection.DOC_ROUTER, ImplicitDocRouter.NAME);
            }
&lt;p&gt; else &lt;/p&gt;
{
              collectionProps.put(DocCollection.DOC_ROUTER, DocRouter.DEFAULT_NAME);
            }
&lt;p&gt;          }&lt;/p&gt;

&lt;p&gt;Since OverseerCollectionProcessor never passes on any params prefixed with &quot;collection&quot; other than &quot;collection.configName&quot; in its create core commands, collectionProps.get(DocCollection.DOC_ROUTER) will never be non-null. Thus, it needs to figure out if the router is implicit or compositeID based on if numShards is passed in. However, collectionProps.get(ZkStateReader.NUM_SHARDS_PROP) will also always be null for the same reason collectionProps.get(DocCollection.DOC_ROUTER) is null, and it isn&apos;t explicitly set in the code above, so the only way for numShards not to be null is if it&apos;s passed in as a system property.&lt;/p&gt;

&lt;p&gt;As an example, here&apos;s a cluster state that&apos;s created as compositeId router, but the collection ZK node says it&apos;s implicit:&lt;/p&gt;

&lt;p&gt;in clusterstate.json:&lt;/p&gt;

&lt;p&gt;&quot;example&quot;:{&lt;br/&gt;
    &quot;shards&quot;:{&quot;shard1&quot;:{&lt;br/&gt;
        &quot;range&quot;:&quot;80000000-7fffffff&quot;,&lt;br/&gt;
        &quot;state&quot;:&quot;active&quot;,&lt;br/&gt;
        &quot;replicas&quot;:{&quot;core_node1&quot;:{&lt;br/&gt;
            &quot;state&quot;:&quot;active&quot;,&lt;br/&gt;
            &quot;core&quot;:&quot;example_shard1_replica1&quot;,&lt;br/&gt;
            &quot;node_name&quot;:&quot;localhost:8983_solr&quot;,&lt;br/&gt;
            &quot;base_url&quot;:&quot;http://localhost:8983/solr&quot;,&lt;br/&gt;
            &quot;leader&quot;:&quot;true&quot;}}}},&lt;br/&gt;
    &quot;router&quot;:&quot;compositeId&quot;},&lt;/p&gt;

&lt;p&gt;in /collections/example data:&lt;/p&gt;
{
  &quot;configName&quot;:&quot;myconf&quot;,
  &quot;router&quot;:&quot;implicit&quot;}

&lt;p&gt;I&apos;ve not sure if the collection ZK node router info is actually used anywhere, so it may not matter, but it&apos;s confusing.&lt;/p&gt;

&lt;p&gt;I think the best fix is for OverseerCollectionProcessor to pass on params prefixed with &quot;collection.&quot; to the core creation requests. Otherwise, ZkController.createCollectionZkNode can explicitly set the numShards collectionProps by cd.getNumShards() too.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12672925">SOLR-5319</key>
            <summary>Collection ZK nodes do not reflect the correct router chosen</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shalin">Shalin Shekhar Mangar</assignee>
                                    <reporter username="mewmewball">Jessica Cheng Mallet</reporter>
                        <labels>
                            <label>solrcloud</label>
                            <label>zookeeper</label>
                    </labels>
                <created>Tue, 8 Oct 2013 23:34:31 +0000</created>
                <updated>Mon, 9 May 2016 18:58:48 +0000</updated>
                            <resolved>Wed, 9 Oct 2013 08:20:39 +0000</resolved>
                                    <version>4.4</version>
                    <version>4.5</version>
                    <version>6.0</version>
                                    <fixVersion>4.6</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>SolrCloud</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13790153" author="shalinmangar" created="Wed, 9 Oct 2013 08:12:17 +0000"  >&lt;p&gt;The doc router stored in the collection zk node is not used anywhere. We should just remove that code.&lt;/p&gt;</comment>
                            <comment id="13790157" author="jira-bot" created="Wed, 9 Oct 2013 08:18:47 +0000"  >&lt;p&gt;Commit 1530521 from shalin@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1530521&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1530521&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5319&quot; title=&quot;Collection ZK nodes do not reflect the correct router chosen&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5319&quot;&gt;&lt;del&gt;SOLR-5319&lt;/del&gt;&lt;/a&gt;: Remove unused and incorrect router name from Collection ZK nodes&lt;/p&gt;</comment>
                            <comment id="13790158" author="jira-bot" created="Wed, 9 Oct 2013 08:19:45 +0000"  >&lt;p&gt;Commit 1530523 from shalin@apache.org in branch &apos;dev/branches/branch_4x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1530523&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1530523&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5319&quot; title=&quot;Collection ZK nodes do not reflect the correct router chosen&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5319&quot;&gt;&lt;del&gt;SOLR-5319&lt;/del&gt;&lt;/a&gt;: Remove unused and incorrect router name from Collection ZK nodes&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>352548</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 6 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1os7b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>352835</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>