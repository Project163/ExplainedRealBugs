<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:16:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-1398] PatternTokenizerFactory ignores offset corrections</title>
                <link>https://issues.apache.org/jira/browse/SOLR-1398</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;I have an analyzer with a MappingCharFilterFactory followed by a PatternTokenizerFactory. This causes wrong offsets, and thus wrong highlights.&lt;/p&gt;

&lt;p&gt;Replacing the tokenizer with WhitespaceTokenizerFactory gives correct offsets, so I expect the problem to be with PatternTokenizerFactory.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12434410">SOLR-1398</key>
            <summary>PatternTokenizerFactory ignores offset corrections</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="koji">Koji Sekiguchi</assignee>
                                    <reporter username="andersm">Anders Melchiorsen</reporter>
                        <labels>
                    </labels>
                <created>Mon, 31 Aug 2009 09:45:51 +0000</created>
                <updated>Tue, 10 Nov 2009 15:52:14 +0000</updated>
                            <resolved>Sun, 6 Sep 2009 03:47:22 +0000</resolved>
                                    <version>1.4</version>
                                    <fixVersion>1.4</fixVersion>
                                    <component>Schema and Analysis</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12749493" author="koji" created="Mon, 31 Aug 2009 13:38:38 +0000"  >&lt;p&gt;Anders, thank you for reporting the problem. Can you show a concrete case so I can reproduce the problem?&lt;/p&gt;</comment>
                            <comment id="12749510" author="andersm" created="Mon, 31 Aug 2009 14:21:34 +0000"  >&lt;p&gt;I used this slightly modified configuration from the example config:&lt;/p&gt;

&lt;p&gt;    &amp;lt;fieldType name=&quot;textCharNorm&quot; class=&quot;solr.TextField&quot; positionIncrementGap=&quot;100&quot; &amp;gt;&lt;br/&gt;
      &amp;lt;analyzer&amp;gt;&lt;br/&gt;
        &amp;lt;charFilter class=&quot;solr.MappingCharFilterFactory&quot; mapping=&quot;mapping.txt&quot;/&amp;gt;&lt;br/&gt;
        &amp;lt;tokenizer class=&quot;solr.PatternTokenizerFactory&quot; pattern=&quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;,;/\s&amp;#93;&lt;/span&gt;+&quot; /&amp;gt;&lt;br/&gt;
      &amp;lt;/analyzer&amp;gt;&lt;br/&gt;
    &amp;lt;/fieldType&amp;gt;&lt;/p&gt;

&lt;p&gt;with the file mapping.txt containing just:&lt;/p&gt;

&lt;p&gt;    &quot;&amp;amp; uuml;&quot; =&amp;gt; &quot;&#252;&quot;&lt;/p&gt;

&lt;p&gt;and analyzing the string &quot;G&amp;amp; uuml;nther G&amp;amp; uuml;nther is here&quot; with analysis.jsp (with verbose output) gives offsets:&lt;/p&gt;

&lt;p&gt;    5,12	13,20	21,23	24,28&lt;/p&gt;

&lt;p&gt;while they should be:&lt;/p&gt;

&lt;p&gt;    0,12	13,25	26,28	29,33&lt;/p&gt;

&lt;p&gt;(Note, I had to split the HTML entity into two parts to have it display in JIRA)&lt;/p&gt;</comment>
                            <comment id="12749726" author="koji" created="Tue, 1 Sep 2009 01:29:19 +0000"  >&lt;p&gt;Anders, can you apply the patch and see the highlighted result?&lt;/p&gt;</comment>
                            <comment id="12750325" author="andersm" created="Wed, 2 Sep 2009 08:18:55 +0000"  >&lt;p&gt;Thanks. The patch appears to work, in that analysis.jsp now gives correct results. However, I am still not able to get highlights in my actual application, due to the below error. There is the same problem with the WhitespaceTokenizer.&lt;/p&gt;

&lt;p&gt;I guess that this is a separate issue, where the highlighter is also not using offset corrections. Would you mind opening a ticket for that issue, as I am not quite sure what to put into it, or where to put it.&lt;/p&gt;


&lt;p&gt;SEVERE: org.apache.solr.common.SolrException: org.apache.lucene.search.highlight.InvalidTokenOffsetsException: Token teknisk exceeds length of provided text sized 803&lt;br/&gt;
	at org.apache.solr.highlight.DefaultSolrHighlighter.doHighlighting(DefaultSolrHighlighter.java:328)&lt;br/&gt;
	at org.apache.solr.handler.component.HighlightComponent.process(HighlightComponent.java:89)&lt;br/&gt;
	at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:195)&lt;br/&gt;
	at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:131)&lt;br/&gt;
	at org.apache.solr.core.SolrCore.execute(SolrCore.java:1299)&lt;br/&gt;
	at org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:338)&lt;br/&gt;
	at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:241)&lt;br/&gt;
	at org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1089)&lt;br/&gt;
	at org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:365)&lt;br/&gt;
	at org.mortbay.jetty.security.SecurityHandler.handle(SecurityHandler.java:216)&lt;br/&gt;
	at org.mortbay.jetty.servlet.SessionHandler.handle(SessionHandler.java:181)&lt;br/&gt;
	at org.mortbay.jetty.handler.ContextHandler.handle(ContextHandler.java:712)&lt;br/&gt;
	at org.mortbay.jetty.webapp.WebAppContext.handle(WebAppContext.java:405)&lt;br/&gt;
	at org.mortbay.jetty.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:211)&lt;br/&gt;
	at org.mortbay.jetty.handler.HandlerCollection.handle(HandlerCollection.java:114)&lt;br/&gt;
	at org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:139)&lt;br/&gt;
	at org.mortbay.jetty.Server.handle(Server.java:285)&lt;br/&gt;
	at org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:502)&lt;br/&gt;
	at org.mortbay.jetty.HttpConnection$RequestHandler.headerComplete(HttpConnection.java:821)&lt;br/&gt;
	at org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:513)&lt;br/&gt;
	at org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:208)&lt;br/&gt;
	at org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:378)&lt;br/&gt;
	at org.mortbay.jetty.bio.SocketConnector$Connection.run(SocketConnector.java:226)&lt;br/&gt;
	at org.mortbay.thread.BoundedThreadPool$PoolThread.run(BoundedThreadPool.java:442)&lt;br/&gt;
Caused by: org.apache.lucene.search.highlight.InvalidTokenOffsetsException: Token teknisk exceeds length of provided text sized 803&lt;br/&gt;
	at org.apache.lucene.search.highlight.Highlighter.getBestTextFragments(Highlighter.java:254)&lt;br/&gt;
	at org.apache.solr.highlight.DefaultSolrHighlighter.doHighlighting(DefaultSolrHighlighter.java:321)&lt;br/&gt;
	... 23 more&lt;/p&gt;
</comment>
                            <comment id="12750369" author="koji" created="Wed, 2 Sep 2009 10:02:48 +0000"  >&lt;p&gt;Anders, thank you for testing the patch and reporting the result. Yes, I think the error is a separate issue. Can you show the procedure (schema.xml, indexed data and request parameters) to reproduce the error? I tried to index &quot;G&amp;amp; uuml;nther G&amp;amp; uuml;nther is here&quot; and search &quot;G&#252;nther&quot;, but I could get a highlighted result successfully.&lt;/p&gt;</comment>
                            <comment id="12750457" author="andersm" created="Wed, 2 Sep 2009 14:40:47 +0000"  >&lt;p&gt;Koji, let us not mix up things. I will create a new ticket for that error once I figure out how to reproduce it reliably.&lt;/p&gt;</comment>
                            <comment id="12750876" author="andersm" created="Thu, 3 Sep 2009 08:01:20 +0000"  >&lt;p&gt;I created &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1404&quot; title=&quot;Random failures with highlighting&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1404&quot;&gt;&lt;del&gt;SOLR-1404&lt;/del&gt;&lt;/a&gt; for the above error. From my point of view, the PatternTokenizerFactory issue that the present ticket is about is resolved with the patch from Koji.&lt;/p&gt;</comment>
                            <comment id="12751818" author="koji" created="Sun, 6 Sep 2009 03:05:08 +0000"  >&lt;p&gt;a new patch with test case. Will commit shortly.&lt;/p&gt;</comment>
                            <comment id="12751820" author="koji" created="Sun, 6 Sep 2009 03:47:22 +0000"  >&lt;p&gt;Committed revision 811753.&lt;/p&gt;</comment>
                            <comment id="12775861" author="gsingers" created="Tue, 10 Nov 2009 15:52:14 +0000"  >&lt;p&gt;Bulk close for Solr 1.4&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12418730" name="SOLR-1398.patch" size="5736" author="koji" created="Sun, 6 Sep 2009 03:05:08 +0000"/>
                            <attachment id="12418202" name="SOLR-1398.patch" size="3594" author="koji" created="Tue, 1 Sep 2009 01:29:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6254</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 3 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03qz3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19803</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>