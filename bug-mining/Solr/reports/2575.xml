<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:06:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-3085] New edismax param mm.autoRelax to aid in fixing the dismax/edismax stopwords mm issue</title>
                <link>https://issues.apache.org/jira/browse/SOLR-3085</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;As discussed here &lt;a href=&quot;http://search-lucene.com/m/Wr7iz1a95jx&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://search-lucene.com/m/Wr7iz1a95jx&lt;/a&gt; and here &lt;a href=&quot;http://search-lucene.com/m/Yne042qEyCq1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://search-lucene.com/m/Yne042qEyCq1&lt;/a&gt; and here &lt;a href=&quot;http://search-lucene.com/m/RfAp82nSsla&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://search-lucene.com/m/RfAp82nSsla&lt;/a&gt; DisMax has an issue with stopwords if not all fields used in QF have exactly same stopword lists.&lt;/p&gt;

&lt;p&gt;Typical solution is to not use stopwords or harmonize stopword lists across all fields in your QF, or relax the MM to a lower percentag. Sometimes these are not acceptable workarounds, and we should find a better solution.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12540721">SOLR-3085</key>
            <summary>New edismax param mm.autoRelax to aid in fixing the dismax/edismax stopwords mm issue</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="janhoy">Jan H&#248;ydahl</assignee>
                                    <reporter username="janhoy">Jan H&#248;ydahl</reporter>
                        <labels>
                            <label>MinimumShouldMatch</label>
                            <label>dismax</label>
                            <label>edismax</label>
                            <label>stopwords</label>
                    </labels>
                <created>Wed, 1 Feb 2012 14:14:43 +0000</created>
                <updated>Mon, 9 May 2016 18:55:04 +0000</updated>
                            <resolved>Sun, 2 Aug 2015 22:42:47 +0000</resolved>
                                                    <fixVersion>6.0</fixVersion>
                                    <component>query parsers</component>
                        <due></due>
                            <votes>9</votes>
                                    <watches>19</watches>
                                                                                                                <comments>
                            <comment id="13197854" author="janhoy" created="Wed, 1 Feb 2012 14:22:45 +0000"  >&lt;p&gt;In this thread &lt;a href=&quot;http://search-lucene.com/m/Tzktd1a95jx&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://search-lucene.com/m/Tzktd1a95jx&lt;/a&gt; James Dyer suggests:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;I do wonder...what if (e)dismax had a flag you could set that would tell it that if any analyzers removed a term, then that term would become optional for any fields for which it remained?  I&apos;m not sure what the development effort would perhaps it would be a nice way to circumvent this problem in a future release...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I like the suggestion. Would this be possible?&lt;/p&gt;

&lt;p&gt;Take as example this parsed query (q=the contract&amp;amp;qf=alltags title_en&amp;amp;mm=100%defType=edismax)&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+((DisjunctionMaxQuery((alltags:the)~0.01) DisjunctionMaxQuery((title_en:contract | alltags:contract)~0.01))~2)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The field &quot;alltags&quot; does not use stopwords, but &quot;title_en&quot; does. So we get a required DisMax Query for alltags:the which does not match any docs. Is it possible in the (e)DisMax code to detect this and make the first DisMax query optional?&lt;/p&gt;</comment>
                            <comment id="13198104" author="hossman" created="Wed, 1 Feb 2012 20:08:37 +0000"  >&lt;blockquote&gt;&lt;p&gt;So we get a required DisMax Query for alltags:the which does not match any docs. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think you are missreading that output...&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;+( ( DisjunctionMaxQuery((alltags:the)~0.01) 
     DisjunctionMaxQuery((title_en:contract | alltags:contract)~0.01)
   )~2
 )
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &quot;DisjunctionMaxQuery((alltags:the)~0.01)&quot; clause is not required in that query.  it is one of two SHOULD clauses in a boolean query, and becomes subject to the same &quot;mm&quot; rule.  both clauses in that BooleanQuery are already SHOULD clauses, so i don&apos;t know what it would mean to make then more &quot;optional&quot;.&lt;/p&gt;
</comment>
                            <comment id="13198347" author="janhoy" created="Thu, 2 Feb 2012 00:04:12 +0000"  >&lt;p&gt;You&apos;re right that technically it&apos;s not marked as required, but in the context of this &quot;feature&quot; we&apos;re discussing, the reason why people get 0 hits is that mm=100%, counted from all (SHOULD) clauses. And that means effectively that alltags:the is required.&lt;/p&gt;

&lt;p&gt;What James suggested, and what most people tricked by this &quot;feature&quot; expects, is that if &quot;the&quot; is a stopword for one of the qf fields, it becomes optional in some way.&lt;/p&gt;

&lt;p&gt;So how can we get that end result? First we need a way to safely detect that we&apos;re in this scenario, perhaps by inspecting whether each DisMax clause contains a field query for every field listed in QF. If one or more is missing, we can assume that the query term is a stopword in one or more of the fields. Then, one way may be to subtract the MM count accordingly, so that in our case above, when we detect that the DisMax clause for &quot;the&quot; does not contain &quot;title_en&quot;, we do mm=mm-1 which will give us an MM of 1 instead of 2 and we&apos;ll get hits. This is probably the easiest solution.&lt;/p&gt;

&lt;p&gt;Another way would be to keep mm as is, and move the affected clause out of the BooleanQuery and add it as a BoostQuery instead?&lt;/p&gt;

&lt;p&gt;This behavior should be parameter driven, e.g. &lt;tt&gt;&amp;amp;mm.sw=false&lt;/tt&gt; reading &quot;Minimum should match does not require Stop Words&quot;&lt;/p&gt;</comment>
                            <comment id="13198361" author="hossman" created="Thu, 2 Feb 2012 00:18:56 +0000"  >&lt;blockquote&gt;&lt;p&gt;Then, one way may be to subtract the MM count accordingly, so that in our case above, when we detect that the DisMax clause for &quot;the&quot; does not contain &quot;title_en&quot;, we do mm=mm-1 which will give us an MM of 1 instead of 2 and we&apos;ll get hits. This is probably the easiest solution.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;that wouldn&apos;t make any sense ... in your example that would result in the query matching every doc containing &quot;alltags:the&quot; (or &quot;title_en:contract&quot;, or &quot;alltags:contract&quot;) which hardly seems like what the user is likely to expect if they used mm=100% (with or w/o a &quot;mm.sw=false&quot; param)&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Another way would be to keep mm as is, and move the affected clause out of the BooleanQuery and add it as a BoostQuery instead?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;something like that might work .. but i haven&apos;t thought it through very hard ... i have a nagging feeling that there are non-stopword cases that would be indistinguishable (to the parser) from this type of stopword case, and thus would also trigger this logic undesirably, but i can&apos;t articulate what they might be off the top of my head.&lt;/p&gt;</comment>
                            <comment id="13199147" author="janhoy" created="Thu, 2 Feb 2012 19:42:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;i have a nagging feeling that there are non-stopword cases that would be indistinguishable (to the parser) from this type of stopword case, and thus would also trigger this logic undesirably, but i can&apos;t articulate what they might be off the top of my head.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;A potential difficult one is this multi language example: &lt;tt&gt;&amp;amp;qf=title_no title_en tags&lt;/tt&gt;. Each of these fields may have their separate stopwords list, say title_no has a stopword &quot;men&quot; (norwegian for but) and title_en has stopword &quot;the&quot;. Then we query &lt;tt&gt;q=the men&lt;/tt&gt;. The user expectation would be that it would return ENGLISH docs matching &quot;men&quot;, since &quot;the&quot; is an english stopword.&lt;/p&gt;

&lt;p&gt;Today we&apos;d get:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+((DisjunctionMaxQuery((title_no:the | tags:the)~0.01) DisjunctionMaxQuery((title_en:men | tags:men)~0.01))~2)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In this case with mm=100% we&apos;d likely get 0 hits, given that &quot;the&quot; is not common in either of title_no or tags. However, the parser cannot know whether the user&apos;s real information need is &quot;the&quot; or &quot;men&quot; - since both are stopwords for different fields.&lt;/p&gt;

&lt;p&gt;Now, all DisMax clauses in this example have had at least one stopword pruned, so using the &quot;mm decrement&quot; strategy would change mm from 2 to 0 which would turn this into an OR query - and of course return results. This is a compromise, so a better option in this special case would probably be to use eDismax&apos;s &quot;smart&quot; conditional stopword removal &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;, but that requires change of fieldType.&lt;/p&gt;

&lt;p&gt;The &quot;convert to boost query&quot; approach would only work when we have at least one clause without stop words, since we cannot query ONLY with bq. Say two of my four query terms &lt;tt&gt;q=the best cheap holiday&lt;/tt&gt; are stop words, and mm=100%. So we remove the two stop clauses from the BooleanQuery and reduce mm accordingly from 4 (100%) to 2, and add the two stop clauses as BQs. This approach would also work for mm&amp;lt;100% cases, since we only count mm clauses from the non-stop clauses.&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; For the special case of all clauses being stop clauses, eDisMax&apos;s existing &quot;smart&quot; conditional stopword handling could perhaps be another solution? For those unfamiliar with it, you can specify &lt;tt&gt;&amp;amp;stopwords=true&lt;/tt&gt; (which is the default) and eDismax will remove stopwords for you instead of letting Analysis do it. It requires that you don&apos;t have StopFilterFactory in your Analysis. Now, if ALL query terms are stopwords, disMax will not remove them, to support queries like &quot;Who is the who?&quot;. (Q: How does edismax pick up which stopword dicationary(ies) to use?). It&apos;s of no use to those removing stop-words in their &quot;index&quot; analysis though.&lt;/p&gt;</comment>
                            <comment id="13228351" author="janhoy" created="Tue, 13 Mar 2012 12:17:27 +0000"  >&lt;p&gt;How about we add a new fieldType to exampel schema.xml &lt;tt&gt;text_general_smartstopwords&lt;/tt&gt; and in it document how to use eDisMax to conditionally remove stopwords on query side only?&lt;/p&gt;</comment>
                            <comment id="13228990" author="billnbell" created="Wed, 14 Mar 2012 05:36:48 +0000"  >&lt;p&gt;We also found another loophole. If we send &lt;span class=&quot;error&quot;&gt;&amp;#91;* TO *&amp;#93;&lt;/span&gt; to edismax we also can bring down the server.&lt;/p&gt;

&lt;p&gt;Some chars are not being escaped before being sent to SOLR.  Eg I can send queries like this to SOLR by searching on (&lt;span class=&quot;error&quot;&gt;&amp;#91;* TO *&amp;#93;&lt;/span&gt; OR &lt;span class=&quot;error&quot;&gt;&amp;#91;* TO *&amp;#93;&lt;/span&gt; OR &lt;span class=&quot;error&quot;&gt;&amp;#91;* TO *&amp;#93;&lt;/span&gt;) in the search box - it took 72 seconds to return:&lt;/p&gt;

&lt;p&gt;webapp=/solr path=/select params=&lt;/p&gt;
{d=160.9344&amp;amp;start=0&amp;amp;q=([*+TO+*]+OR+[*+TO+*]+OR+[*+TO+*])&amp;amp;pt=40.7146,-74.0071&amp;amp;qt=providersearchdist&amp;amp;wt=json&amp;amp;qq=city_state_lower:&quot;new+york,+ny&quot;&amp;amp;rows=20}
&lt;p&gt; hits=276442 status=0 QTime=72458&lt;/p&gt;</comment>
                            <comment id="13229083" author="janhoy" created="Wed, 14 Mar 2012 08:58:12 +0000"  >&lt;p&gt;@Bill, since this is a bit off topic, I moved your &quot;loophole&quot; to &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3243&quot; title=&quot;eDismax and non-fielded range query&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3243&quot;&gt;SOLR-3243&lt;/a&gt;. It is certainly something that is dangerous and I cannot see a single usecase for allowing an un-fielded range! Good catch.&lt;/p&gt;</comment>
                            <comment id="13237079" author="hossman" created="Fri, 23 Mar 2012 20:31:42 +0000"  >&lt;p&gt;Bulk changing fixVersion 3.6 to 4.0 for any open issues that are unassigned and have not been updated since March 19.&lt;/p&gt;

&lt;p&gt;Email spam suppressed for this bulk edit; search for hoss20120323nofix36 to identify all issues edited&lt;/p&gt;</comment>
                            <comment id="13251828" author="jrochkind" created="Wed, 11 Apr 2012 18:41:37 +0000"  >&lt;p&gt;Hoss says: i have a nagging feeling that there are non-stopword cases that would be indistinguishable (to the parser) from this type of stopword case, and thus would also trigger this logic undesirably, but i can&apos;t articulate what they might be off the top of my head.&lt;/p&gt;

&lt;p&gt;Indeed there are, pretty much anything where analysis differs between two fields in a way that can effect number of tokens produced. Punctuation stripping can sometimes do this, and I ran into such a case in my real world use.  More info &lt;a href=&quot;http://bibwild.wordpress.com/2011/06/15/more-dismax-gotchas-varying-field-analysis-and-mm/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bibwild.wordpress.com/2011/06/15/more-dismax-gotchas-varying-field-analysis-and-mm/&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;This is a difficult problem to fix in the general case, at one point I think there was a solr listserv discussion where I tried to brainstorm general case solutions, but they were all shot down by people who knew more about Solr than me. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I can&apos;t find the archive of that discussion now though. &lt;/p&gt;</comment>
                            <comment id="13251915" author="janhoy" created="Wed, 11 Apr 2012 20:53:55 +0000"  >&lt;p&gt;Good article, Jonathan. I agree that it may be very hard to completely fix this 100%, but an option to at least avoid the most common frustrations around this would be welcome, even if it is only fixing the symptoms. I.e. having a configuration parameter relaxMmHack=true which relaxes mm if one of the fields yields fewer tokens than the others would be fixing the felt effect of the problem for many peo, simply by adding a param.&lt;/p&gt;</comment>
                            <comment id="13412139" author="hossman" created="Wed, 11 Jul 2012 22:26:07 +0000"  >&lt;p&gt;bulk fixing the version info for 4.0-ALPHA and 4.0 all affected issues have &quot;hoss20120711-bulk-40-change&quot; in comment&lt;/p&gt;</comment>
                            <comment id="13429788" author="rcmuir" created="Tue, 7 Aug 2012 03:43:03 +0000"  >&lt;p&gt;rmuir20120906-bulk-40-change&lt;/p&gt;</comment>
                            <comment id="13451082" author="hossman" created="Fri, 7 Sep 2012 22:32:19 +0000"  >&lt;p&gt;removing fixVersion=4.0 since there is no evidence that anyone is currently working on this issue.  (this can certainly be revisited if volunteers step forward)&lt;/p&gt;
</comment>
                            <comment id="13558652" author="markus17" created="Mon, 21 Jan 2013 09:35:55 +0000"  >&lt;p&gt;Any progress with this one? Any smart ideas to share?&lt;/p&gt;</comment>
                            <comment id="13677709" author="ndushay" created="Fri, 7 Jun 2013 00:50:23 +0000"  >&lt;p&gt;We avoided this by adding stopwords to our string fields (and simultaneously dealing with whitespace around punctuation marks).  It&apos;s dumb, but it worked fine in dismax.  We no longer use stopwords in general.&lt;/p&gt;

&lt;p&gt;&amp;lt;!-- single token with punctuation terms removed so dismax doesn&apos;t look for punctuation terms in these fields --&amp;gt;&lt;br/&gt;
&amp;lt;!-- On client side, Lucene query parser breaks things up by whitespace &lt;b&gt;before&lt;/b&gt; field analysis for dismax --&amp;gt;&lt;br/&gt;
&amp;lt;!-- so punctuation terms (&amp;amp; : &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; are stopwords to allow results from other fields when these chars are surrounded by spaces in query --&amp;gt;&lt;br/&gt;
&amp;lt;fieldType name=&quot;string_punct_stop&quot; class=&quot;solr.TextField&quot; omitNorms=&quot;true&quot;&amp;gt;&lt;br/&gt;
   &amp;lt;analyzer type=&quot;index&quot;&amp;gt;&lt;br/&gt;
     &amp;lt;tokenizer class=&quot;solr.KeywordTokenizerFactory&quot; /&amp;gt;&lt;br/&gt;
     &amp;lt;filter class=&quot;solr.ICUNormalizer2FilterFactory&quot; name=&quot;nfkc&quot; mode=&quot;compose&quot; /&amp;gt;&lt;br/&gt;
   &amp;lt;/analyzer&amp;gt;&lt;br/&gt;
   &amp;lt;analyzer type=&quot;query&quot;&amp;gt;&lt;br/&gt;
     &amp;lt;tokenizer class=&quot;solr.KeywordTokenizerFactory&quot; /&amp;gt;&lt;br/&gt;
     &amp;lt;filter class=&quot;solr.ICUNormalizer2FilterFactory&quot; name=&quot;nfkc&quot; mode=&quot;compose&quot; /&amp;gt;&lt;br/&gt;
     &amp;lt;!-- removing punctuation for Lucene query parser issues --&amp;gt;&lt;br/&gt;
     &amp;lt;filter class=&quot;solr.StopFilterFactory&quot; ignoreCase=&quot;true&quot; words=&quot;stopwords_punctuation.txt&quot; enablePositionIncrements=&quot;true&quot; /&amp;gt;&lt;br/&gt;
   &amp;lt;/analyzer&amp;gt;&lt;br/&gt;
&amp;lt;/fieldType&amp;gt;&lt;/p&gt;</comment>
                            <comment id="13851634" author="janhoy" created="Wed, 18 Dec 2013 12:21:28 +0000"  >&lt;p&gt;This issue is still with us... How do people feel about a super-simple fix through a new optional param:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;mm.autoRelax=true|false&lt;/tt&gt; : Automatically relax number of MUST clauses when tokens are removed from some fields but not all&lt;/p&gt;

&lt;p&gt;It would count number of fields remaining for each clause and then adjust MM accordingly. I can attempt a patch.&lt;/p&gt;</comment>
                            <comment id="13851645" author="markus17" created="Wed, 18 Dec 2013 12:33:23 +0000"  >&lt;p&gt;I think that would be certainly better than the current situation. But there may be another issue; if you don&apos;t remove stopwords at all, like we do, there is a problem with mm and stop words too. For example: q=train from amsterdam to rotterdam&amp;amp;mm=2&amp;lt;-1 5&amp;lt;80%; ideally you would not want documents with only terms `from`, `to` and another non-stop word to match. In this case we would need mm to apply only on non-stop words but also need a query time stopwordfilter that doesn&apos;t remove them but marks them as stop words.&lt;/p&gt;</comment>
                            <comment id="13851667" author="janhoy" created="Wed, 18 Dec 2013 12:55:33 +0000"  >&lt;blockquote&gt;&lt;p&gt;ideally you would not want documents with only terms `from`, `to` and another non-stop word to match. In this case we would need mm to apply only on non-stop words but also need a query time stopwordfilter that doesn&apos;t remove them but marks them as stop words.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;What exactly would &quot;marks them as stop words&quot; mean if they are not to be removed?&lt;/p&gt;</comment>
                            <comment id="13851670" author="markus17" created="Wed, 18 Dec 2013 12:58:41 +0000"  >&lt;p&gt;As in not removed, we would still want to be able to query for stop words, but have mm only apply to non-stop words.&lt;/p&gt;</comment>
                            <comment id="13852247" author="janhoy" created="Wed, 18 Dec 2013 22:38:56 +0000"  >&lt;p&gt;This patch is a first shot at a new param &lt;tt&gt;mm.autoRelax&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;When set as &lt;tt&gt;&amp;amp;mm.autoRelax=true&lt;/tt&gt; on the request, it will adjust minShouldMatch to at most require the number of clauses with the max number of disjuncts.&lt;/p&gt;

&lt;p&gt;Have tested manually for some common cases, and it seems to work as expected, i.e. if you had a query &lt;tt&gt;q=A horse in a stable&lt;/tt&gt; that gave problems due to mm=100% =&amp;gt; minShouldMatch=5, applying autoRelax will adjust it to 2. Need to add some JUnit tests.&lt;/p&gt;</comment>
                            <comment id="13853875" author="janhoy" created="Fri, 20 Dec 2013 11:20:49 +0000"  >&lt;p&gt;New patch&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Adds tests&lt;/li&gt;
	&lt;li&gt;Now also works with the old dismax&lt;/li&gt;
	&lt;li&gt;No longer breaks mm for non-dismax boolean clauses&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13853912" author="janhoy" created="Fri, 20 Dec 2013 12:25:59 +0000"  >&lt;p&gt;Last patch had a bad import. This one now passes &lt;tt&gt;ant precommit&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="13853922" author="markus17" created="Fri, 20 Dec 2013 12:37:53 +0000"  >&lt;p&gt;Hi Jan - the SolrCore.java modification shouldnt be in the patch. Anyway, it looks like this fix does what it advertises. The problem i reported above, perhaps another issue, is still real. Environments without stopwords still have a problem with mm. Consider your q=A horse in a stable. With mm=2 we get all kinds of documents, usually all documents in the corpus (in and a). Ideally this or another parameter would only require horse and stable.&lt;/p&gt;

&lt;p&gt;edit, you already remove the import.&lt;/p&gt;</comment>
                            <comment id="13853940" author="janhoy" created="Fri, 20 Dec 2013 13:04:30 +0000"  >&lt;blockquote&gt;&lt;p&gt;Environments without stopwords still have a problem with mm. Consider your q=A horse in a stable. With mm=2 we get all kinds of documents, usually all documents in the corpus (in and a). Ideally this or another parameter would only require horse and stable.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The mm.autoRelax param is designed to tackle one of the most common situation where your qf includes a bunch of &quot;text&quot; fields with stopword removal plus one or more &quot;string&quot; fields like &quot;id&quot; or &quot;tags&quot; etc. Take the example of &lt;tt&gt;qf=title body tags&lt;/tt&gt; where title and body removes stopwords but tags does not. This would translate to something like&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;(DMQ(tags:a) DMQ(title:horse |&#160;body:horse |&#160;tags:horse) DMQ(tags:in) DMQ(tags:a) DMQ(title:stable |&#160;body:stable | tags:stable))~5
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Very often in these cases the &quot;tags&quot; field does not contain free-text, so tags:a, tags:in would not match, and we always get 0 hits &amp;#8211; thus mm=2 would help here.&lt;/p&gt;

&lt;p&gt;But for cases where you query multiple english analyzed text fields with different stopword lists, relaxation of mm is not the cure. The cure is rather to add the same stopword handling to all those text fieldTypes.&lt;/p&gt;

&lt;p&gt;Clearly mm.autoRelax is not a complete solution for all mm issues. For other cases we may need other cures. One idea I thought of the other day is a param &lt;tt&gt;mergeStopwords=true&lt;/tt&gt;, which modifies the analysis chain for each field in &lt;tt&gt;qf&lt;/tt&gt; to include all StopFilters on the &quot;query&quot; analysis of each field. I.e. if my field A has &lt;tt&gt;stopwords=&quot;a.txt&quot;&lt;/tt&gt; and field B has &lt;tt&gt;stopwords=&quot;b.txt&quot;&lt;/tt&gt;, then edismax would add those two stopword filters in a row for both fields, much the same way that edismax removes the StopFilter when doing smart stopword handling.&lt;/p&gt;</comment>
                            <comment id="13862324" author="janhoy" created="Sat, 4 Jan 2014 14:57:15 +0000"  >&lt;p&gt;As it seems there is no silver bullet for all kind of mm problems, I suggest to chop up the elephant, starting with &lt;tt&gt;mm.autoRelax&lt;/tt&gt; as the first tool. And then try to tackle other needs later. Thoughts?&lt;/p&gt;</comment>
                            <comment id="13946395" author="janhoy" created="Tue, 25 Mar 2014 11:30:46 +0000"  >&lt;p&gt;This keeps getting up on the users list. Any objections to adding params &lt;tt&gt;mm.autoRelax&lt;/tt&gt; and &lt;tt&gt;mergeStopwords&lt;/tt&gt; to start with, perhaps as experimental and then if they prove useful, promote them as permanent edismax citizens?&lt;/p&gt;</comment>
                            <comment id="13971219" author="thetaphi" created="Wed, 16 Apr 2014 12:57:29 +0000"  >&lt;p&gt;Move issue to Solr 4.9.&lt;/p&gt;</comment>
                            <comment id="14089239" author="markus17" created="Thu, 7 Aug 2014 14:04:59 +0000"  >&lt;p&gt;Yes, i think this should be added and possibly as experimental. The patch works for some cases although it is indeed not a silver bullet. Merging stop word lists might prove useful!&lt;/p&gt;</comment>
                            <comment id="14173329" author="dsmiley" created="Thu, 16 Oct 2014 04:09:03 +0000"  >&lt;p&gt;I like the &quot;convert to boost query&quot; approach.  I independently arrived at that solution, though I haven&apos;t put it into practice.  The all-stop-words case (e.g. &quot;who is the who&quot; or &quot;to be or not to be&quot;) could be special-cased to not convert these clauses to boost queries.  Granted it seems unlikely in this example you&apos;d find anything since the &apos;qf&apos; field you point to that is analyzed differently (e.g. string field) would need all of them.  But if you configure stop words then this is expected behavior &amp;#8211; it&apos;s the conscious trade-off you make by filtering them.  Another possibility is OR&apos;ing in the query as a phrase, giving an opportunity for common-grams/shingling to find matches.&lt;/p&gt;</comment>
                            <comment id="14642843" author="simon.endele" created="Mon, 27 Jul 2015 15:13:01 +0000"  >&lt;p&gt;We&apos;re currently experiencing the same issue with query terms that only contain non-alphanumerical characters, which are removed by the StandardTokenizer or WordDelimiterFilter, e.g. &quot;miles &amp;amp; more&quot;.&lt;br/&gt;
Will this case also be addressed by &lt;tt&gt;mm.autoRelax&lt;/tt&gt;?&lt;/p&gt;</comment>
                            <comment id="14643428" author="dsmiley" created="Mon, 27 Jul 2015 21:25:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=simon.endele&quot; class=&quot;user-hover&quot; rel=&quot;simon.endele&quot;&gt;simon.endele&lt;/a&gt; Yes it would.  So would the solution of converting these clauses to boost queries, which I did some months ago as part of a custom client-specific query parser, and it works fine.  &lt;/p&gt;

&lt;p&gt;One reason I like converting these clauses to boost queries is that from a Lucene internals/performance perspective, we separate out the clauses we know aren&apos;t a must-match into the boost, which is in a SHOULD position, and is thus secondary since the docs in the boost can be skipped past for docs that don&apos;t stand a chance.  I believe this is faster than one BooleanQuery with a smaller min-should-match.  &lt;/p&gt;

&lt;p&gt;Jan&apos;s patch for mm.autoRelax looks good to me.  I suggest another name however, one involving &quot;stopwords&quot;.  Perhaps &quot;mm.discountStopwords&quot;.&lt;/p&gt;</comment>
                            <comment id="14651234" author="janhoy" created="Sun, 2 Aug 2015 22:28:43 +0000"  >&lt;p&gt;Attaching new patch which applied to current trunk.&lt;/p&gt;

&lt;p&gt;I keep the param name mm.autoRelax since it will relax mm not only at &quot;uneven&quot; stopword removal but for all kind of analysis which ends up with different number of clauses between fields. This is easier to explain in documentation too.&lt;/p&gt;</comment>
                            <comment id="14651235" author="jira-bot" created="Sun, 2 Aug 2015 22:31:21 +0000"  >&lt;p&gt;Commit 1693833 from janhoy@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1693833&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1693833&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-3085&quot; title=&quot;New edismax param mm.autoRelax to aid in fixing the dismax/edismax stopwords mm issue&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-3085&quot;&gt;&lt;del&gt;SOLR-3085&lt;/del&gt;&lt;/a&gt;: New edismax param mm.autoRelax which helps in certain cases of the stopwords/zero-hits issue&lt;/p&gt;</comment>
                            <comment id="14651244" author="janhoy" created="Sun, 2 Aug 2015 22:41:17 +0000"  >&lt;p&gt;Due to popular demand, I committed the &lt;tt&gt;mm.autoRelax&lt;/tt&gt; logic to trunk only, for people to play with. After some broader exposure there we can consider porting to 5.x.&lt;/p&gt;

&lt;p&gt;The &lt;tt&gt;mergeStopwords&lt;/tt&gt; idea is spun off into &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7862&quot; title=&quot;Ability to merge stopword lists on the fly for eDisMax&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7862&quot;&gt;&lt;del&gt;SOLR-7862&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14651245" author="janhoy" created="Sun, 2 Aug 2015 22:42:47 +0000"  >&lt;p&gt;Resolving as fixed. Please re-open if back-porting to 5.x&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12746416">SOLR-6602</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12498784">SOLR-2368</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12599211">SOLR-3636</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12748378" name="SOLR-3085.patch" size="9899" author="janhoy" created="Sun, 2 Aug 2015 22:28:43 +0000"/>
                            <attachment id="12619808" name="SOLR-3085.patch" size="9605" author="janhoy" created="Fri, 20 Dec 2013 12:25:59 +0000"/>
                            <attachment id="12619795" name="SOLR-3085.patch" size="10145" author="janhoy" created="Fri, 20 Dec 2013 11:20:49 +0000"/>
                            <attachment id="12619427" name="SOLR-3085.patch" size="5621" author="janhoy" created="Wed, 18 Dec 2013 22:38:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>226116</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 16 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03grz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>18151</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>