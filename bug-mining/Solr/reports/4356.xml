<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:41:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-13941] Tests configure Jetty differently than when running via start.jar</title>
                <link>https://issues.apache.org/jira/browse/SOLR-13941</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Spinoff from &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13905&quot; title=&quot;Make findRequestType in AuditEvent more robust&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13905&quot;&gt;&lt;del&gt;SOLR-13905&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;There seems to be a slightly different configuration of our servlets when Solr is run from command line and through Test-runner for our tests.&lt;/p&gt;

&lt;p&gt;This causes different behavior of &lt;tt&gt;httpRequest.getPathInfo&lt;/tt&gt; and &lt;tt&gt;httpRequest.getServletPath()&lt;/tt&gt; in the two environments, making it hard to depend on these in critical code paths, such as &lt;a href=&quot;https://github.com/apache/lucene-solr/blob/f07998fc234c81ff956a84ee508b85f8d573ef38/solr/core/src/java/org/apache/solr/servlet/SolrDispatchFilter.java#L494-L499&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;SolrDispatchFilter&lt;/a&gt; and AuditEvent.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13269101">SOLR-13941</key>
            <summary>Tests configure Jetty differently than when running via start.jar</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="janhoy">Jan H&#248;ydahl</assignee>
                                    <reporter username="janhoy">Jan H&#248;ydahl</reporter>
                        <labels>
                    </labels>
                <created>Mon, 18 Nov 2019 15:17:35 +0000</created>
                <updated>Tue, 21 Jan 2020 16:58:35 +0000</updated>
                            <resolved>Wed, 20 Nov 2019 10:07:32 +0000</resolved>
                                                    <fixVersion>8.3.1</fixVersion>
                    <fixVersion>8.4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="10800">3h</timespent>
                                <comments>
                            <comment id="16976699" author="thetaphi" created="Mon, 18 Nov 2019 16:51:58 +0000"  >&lt;p&gt;OK, I see. I will check the test setup code to see how it binds the servlet/servletfilter and how the context path is setup.&lt;/p&gt;</comment>
                            <comment id="16976712" author="thetaphi" created="Mon, 18 Nov 2019 17:13:57 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
I do not see any serious problem in the embedded jetty, but there is actually one difference - which makes sense:&lt;/p&gt;

&lt;p&gt;in web.xml the SolrDispatchFilter is mount to path &quot;&lt;tt&gt;/&amp;#42;&lt;/tt&gt;&quot; while in the embedded jetty it&apos;s just &quot;&lt;tt&gt;&amp;#42;&lt;/tt&gt;&quot;. I have not much time to test it now, but maybe adding a &quot;&lt;tt&gt;/&lt;/tt&gt;&quot; in the class here is enough to fix this:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/lucene-solr/blob/cf21340294a52ad764deac7b9cdd38d06cfbc3da/solr/core/src/java/org/apache/solr/client/solrj/embedded/JettySolrRunner.java#L386&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/cf21340294a52ad764deac7b9cdd38d06cfbc3da/solr/core/src/java/org/apache/solr/client/solrj/embedded/JettySolrRunner.java#L386&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The reson for this is explained here and has to do with the servlet spec: &lt;a href=&quot;https://bluxte.net/musings/2006/03/29/servletpath-and-pathinfo-servlet-api-weirdness/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://bluxte.net/musings/2006/03/29/servletpath-and-pathinfo-servlet-api-weirdness/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Same applies for the debug servlet.&lt;/p&gt;</comment>
                            <comment id="16976944" author="janhoy" created="Mon, 18 Nov 2019 22:28:41 +0000"  >&lt;p&gt;I tested the attached patch. Had to remove the wiring of the dummy 404 servlet for it to work correctly. What happened then is that you suddenly got the path from the servletPath call instead of the pathInfo call - just like production. I&apos;ll try to run the full test suite and see if something breaks &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16976963" author="janhoy" created="Mon, 18 Nov 2019 23:09:19 +0000"  >&lt;p&gt;Took it a step further in &lt;a href=&quot;https://github.com/apache/lucene-solr/pull/1018&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;GitHub Pull Request #1018&lt;/a&gt;&#160;where I added the utility method and simplified all code paths I could find using &lt;tt&gt;getPathInfo&lt;/tt&gt;. There as a lot of duplication and different ways to concatenate those.&lt;/p&gt;

&lt;p&gt;I think it makes sense to commit this one first and then &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13905&quot; title=&quot;Make findRequestType in AuditEvent more robust&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13905&quot;&gt;&lt;del&gt;SOLR-13905&lt;/del&gt;&lt;/a&gt; after.&lt;/p&gt;</comment>
                            <comment id="16976967" author="thetaphi" created="Mon, 18 Nov 2019 23:14:27 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
You can also remove the obsolete servlet from source code. &lt;br/&gt;
The reason why the servlet was needed is caused by this binding without a slash: the container sees no matching servlet on Root path, because * is an invalid mapping, that should be used for file extensions only. So the 404 servlet is needed as a workaround to make container happy.&lt;/p&gt;

&lt;p&gt;Could you please also fix the DebugFilter mapping a few lines above? It has same issue.&lt;/p&gt;</comment>
                            <comment id="16976979" author="thetaphi" created="Mon, 18 Nov 2019 23:25:38 +0000"  >&lt;p&gt;I commented on PR, I was answering before seeing the PR.&lt;/p&gt;</comment>
                            <comment id="16977903" author="janhoy" created="Tue, 19 Nov 2019 22:55:10 +0000"  >&lt;p&gt;We have a working fix in the PR, plan to merge tomorrow.&lt;/p&gt;

&lt;p&gt;I don&apos;t know how we should encourage the use of the new &lt;tt&gt;ServletUtils&lt;/tt&gt; class instead of manually concatenating &lt;tt&gt;getServletPath + (getPathInfo() != null ? getPathInfo() : &quot;&quot;)&lt;/tt&gt; when you need it. Hopefully people will copy/paste.&lt;/p&gt;</comment>
                            <comment id="16977907" author="thetaphi" created="Tue, 19 Nov 2019 22:59:39 +0000"  >&lt;p&gt;Forbiddenapis. There is a servletapi.txt, where some methods like charset unsafe getParameter are listed. Just mention the replacement method to use instead.&lt;/p&gt;</comment>
                            <comment id="16978245" author="jira-bot" created="Wed, 20 Nov 2019 09:21:08 +0000"  >&lt;p&gt;Commit f00bcd560901ebed420c51e52fda788ae8654103 in lucene-solr&apos;s branch refs/heads/master from Jan H&#248;ydahl&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=f00bcd5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=f00bcd5&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13941&quot; title=&quot;Tests configure Jetty differently than when running via start.jar&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13941&quot;&gt;&lt;del&gt;SOLR-13941&lt;/del&gt;&lt;/a&gt;: Configure JettySolrRunner same as in web.xml (#1018)&lt;/p&gt;
</comment>
                            <comment id="16978276" author="jira-bot" created="Wed, 20 Nov 2019 09:54:44 +0000"  >&lt;p&gt;Commit 58d5680a90c860efb1cc5fc33c3f5b8201f84fe0 in lucene-solr&apos;s branch refs/heads/branch_8x from Jan H&#248;ydahl&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=58d5680&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=58d5680&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13941&quot; title=&quot;Tests configure Jetty differently than when running via start.jar&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13941&quot;&gt;&lt;del&gt;SOLR-13941&lt;/del&gt;&lt;/a&gt;: Configure JettySolrRunner same as in web.xml (#1018)&lt;/p&gt;

&lt;p&gt;(cherry picked from commit f00bcd560901ebed420c51e52fda788ae8654103)&lt;/p&gt;</comment>
                            <comment id="16978522" author="thetaphi" created="Wed, 20 Nov 2019 15:35:16 +0000"  >&lt;p&gt;Hi Jan,&lt;/p&gt;

&lt;p&gt;thanks! Should I add the forbiddenapis entries for getPathInfo() and getServletPath()?&lt;/p&gt;</comment>
                            <comment id="16978559" author="janhoy" created="Wed, 20 Nov 2019 16:15:38 +0000"  >&lt;p&gt;Not 100% sure, there may be legitimate uses of either, but then I guess folks can override with an annotation if they absolutely need to? Go ahead if you feel it is a good idea.&lt;/p&gt;</comment>
                            <comment id="16982816" author="jira-bot" created="Tue, 26 Nov 2019 20:04:25 +0000"  >&lt;p&gt;Commit d6bf8d22039ad408d41fbef9206ca185c49148d3 in lucene-solr&apos;s branch refs/heads/branch_8_3 from Jan H&#248;ydahl&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=d6bf8d2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=d6bf8d2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13941&quot; title=&quot;Tests configure Jetty differently than when running via start.jar&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13941&quot;&gt;&lt;del&gt;SOLR-13941&lt;/del&gt;&lt;/a&gt;: Configure JettySolrRunner same as in web.xml (#1018)&lt;/p&gt;

&lt;p&gt;(cherry picked from commit f00bcd560901ebed420c51e52fda788ae8654103)&lt;/p&gt;</comment>
                            <comment id="16984626" author="jira-bot" created="Thu, 28 Nov 2019 19:57:40 +0000"  >&lt;p&gt;Commit 48010ffc9f636831f2b931ba0c099f587e8e3850 in lucene-solr&apos;s branch refs/heads/master from Jan H&#248;ydahl&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=48010ff&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=48010ff&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Add 8.3.1 CHANGES entry for &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13465&quot; title=&quot;CoreContainer.auditloggerPlugin should be volatile&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13465&quot;&gt;&lt;del&gt;SOLR-13465&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13941&quot; title=&quot;Tests configure Jetty differently than when running via start.jar&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13941&quot;&gt;&lt;del&gt;SOLR-13941&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13905&quot; title=&quot;Make findRequestType in AuditEvent more robust&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13905&quot;&gt;&lt;del&gt;SOLR-13905&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13267077">SOLR-13905</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13273465">SOLR-14039</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12986159" name="SOLR-13941.patch" size="1198" author="janhoy" created="Mon, 18 Nov 2019 21:12:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 50 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z08qx4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>