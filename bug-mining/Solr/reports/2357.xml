<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:03:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-7139] SolrContentHandler for TIKA is broken by TikaOCR (caused by multiple startDocument events)</title>
                <link>https://issues.apache.org/jira/browse/SOLR-7139</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;While testing my large scale Tika/SolrCell indexing (great work on /extraction guys, really really appreciate it) on my 40M image dataset, I was pulling my frickin&apos; hair out trying to figure out why the TesseractOCR extracted content wasn&apos;t actually making it into the index. Well I figured it out lol (many many System.out.printlns later) - it&apos;s the disabling of div tags (=&amp;gt;ignored) in the default solrconfig.xml. This basically renders TesseractOCR output in SolrCell useless since it is surrounded by a div tag.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12776682">SOLR-7139</key>
            <summary>SolrContentHandler for TIKA is broken by TikaOCR (caused by multiple startDocument events)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="uschindler">Uwe Schindler</assignee>
                                    <reporter username="chrismattmann">Chris A. Mattmann</reporter>
                        <labels>
                    </labels>
                <created>Sun, 22 Feb 2015 03:56:49 +0000</created>
                <updated>Mon, 9 May 2016 18:47:14 +0000</updated>
                            <resolved>Thu, 26 Feb 2015 14:39:03 +0000</resolved>
                                    <version>4.10.3</version>
                                    <fixVersion>4.10.4</fixVersion>
                    <fixVersion>5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>contrib - Solr Cell (Tika extraction)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14332015" author="chrismattmann" created="Sun, 22 Feb 2015 04:11:11 +0000"  >&lt;p&gt;More info on this - apparently even removing the ignored default params in SolrCell doesn&apos;t fix it. I&apos;m debugging more will report more soon.&lt;/p&gt;</comment>
                            <comment id="14332031" author="chrismattmann" created="Sun, 22 Feb 2015 05:19:57 +0000"  >&lt;p&gt;OK here is some more info: apparently startDocument is invoked more than 1x on the TesseractOCR Tika output, causing the SolrContentHandler to reset builder fields, making the div field get stomped.&lt;/p&gt;</comment>
                            <comment id="14332034" author="chrismattmann" created="Sun, 22 Feb 2015 05:23:12 +0000"  >&lt;p&gt;Got it! It&apos;s because of &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1445&quot; title=&quot;Figure out how to add Image metadata extraction to Tesseract parser&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1445&quot;&gt;&lt;del&gt;TIKA-1445&lt;/del&gt;&lt;/a&gt; - to make sure we get ImageParser metadata, along with OCR text, we had to call the handler 2x. That&apos;s why startDocument is invoked 2x. There is probably a workaround though to be done in Solr, which is to flush the current field builder information if it hasn&apos;t been flushed yet. Going to whip up a patch, see if it fixes it, and if so, throw it up.&lt;/p&gt;</comment>
                            <comment id="14332035" author="chrismattmann" created="Sun, 22 Feb 2015 05:23:25 +0000"  >&lt;p&gt;You can see the relevant Tika code here: &lt;a href=&quot;http://svn.apache.org/repos/asf/tika/tags/1.7/tika-parsers/src/main/java/org/apache/tika/parser/ocr/TesseractOCRParser.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/repos/asf/tika/tags/1.7/tika-parsers/src/main/java/org/apache/tika/parser/ocr/TesseractOCRParser.java&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14332041" author="chrismattmann" created="Sun, 22 Feb 2015 05:41:49 +0000"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;trivial patch that fixes SolrCell for OCR in 4.10.3 branch.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14332042" author="chrismattmann" created="Sun, 22 Feb 2015 05:41:59 +0000"  >&lt;p&gt;ok all fixed, hope you find it useful! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14332326" author="thetaphi" created="Sun, 22 Feb 2015 19:40:44 +0000"  >&lt;p&gt;Hi Chris,&lt;br/&gt;
I understand the problem. We can add the workaround to SolrContentHandler until this double &quot;startDocument&quot; problem is solved in TIKA.&lt;/p&gt;</comment>
                            <comment id="14332348" author="thetaphi" created="Sun, 22 Feb 2015 20:39:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chrismattmann&quot; class=&quot;user-hover&quot; rel=&quot;chrismattmann&quot;&gt;chrismattmann&lt;/a&gt; pointed me to &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-1445&quot; title=&quot;Figure out how to add Image metadata extraction to Tesseract parser&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-1445&quot;&gt;&lt;del&gt;TIKA-1445&lt;/del&gt;&lt;/a&gt;. The problems described there are causing the duplicate startDocument events. For TIKA 1.7 we can only work around by filtering them.&lt;/p&gt;</comment>
                            <comment id="14338419" author="thetaphi" created="Thu, 26 Feb 2015 14:09:28 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
I analyzed the whole thing. Basically, the simplest fix is to remove the whole startDocument() method because it does not do anything useful. The whole setup ffor a new document is already done by the constructor.&lt;br/&gt;
The startDocument setup looks like the original code writer wanted to &quot;reuse&quot; instances. But in fact this is never done (I checked extraction and morphlines).&lt;br/&gt;
I will attach a patch that removes the startDocument() and adds documentation to javadocs that you can only process &lt;b&gt;one&lt;/b&gt; document.&lt;/p&gt;</comment>
                            <comment id="14338426" author="thetaphi" created="Thu, 26 Feb 2015 14:19:02 +0000"  >&lt;p&gt;Patch. This also makes the fields final to ensure no accidental reuse &amp;amp; co.&lt;/p&gt;

&lt;p&gt;I would like to get this also in 4.10.4, because Mattman set this fix version and set &quot;critical&quot;.&lt;/p&gt;</comment>
                            <comment id="14338458" author="jira-bot" created="Thu, 26 Feb 2015 14:29:11 +0000"  >&lt;p&gt;Commit 1662457 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi&quot; class=&quot;user-hover&quot; rel=&quot;thetaphi&quot;&gt;thetaphi&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1662457&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1662457&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7139&quot; title=&quot;SolrContentHandler for TIKA is broken by TikaOCR (caused by multiple startDocument events)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7139&quot;&gt;&lt;del&gt;SOLR-7139&lt;/del&gt;&lt;/a&gt;: Fix SolrContentHandler for TIKA to ignore multiple startDocument events&lt;/p&gt;</comment>
                            <comment id="14338463" author="jira-bot" created="Thu, 26 Feb 2015 14:33:02 +0000"  >&lt;p&gt;Commit 1662461 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi&quot; class=&quot;user-hover&quot; rel=&quot;thetaphi&quot;&gt;thetaphi&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1662461&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1662461&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merged revision(s) 1662457 from lucene/dev/trunk:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7139&quot; title=&quot;SolrContentHandler for TIKA is broken by TikaOCR (caused by multiple startDocument events)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7139&quot;&gt;&lt;del&gt;SOLR-7139&lt;/del&gt;&lt;/a&gt;: Fix SolrContentHandler for TIKA to ignore multiple startDocument events&lt;/p&gt;</comment>
                            <comment id="14338470" author="jira-bot" created="Thu, 26 Feb 2015 14:40:22 +0000"  >&lt;p&gt;Commit 1662462 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi&quot; class=&quot;user-hover&quot; rel=&quot;thetaphi&quot;&gt;thetaphi&lt;/a&gt; in branch &apos;dev/branches/lucene_solr_4_10&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1662462&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1662462&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merged revision(s) 1662457 from lucene/dev/trunk:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7139&quot; title=&quot;SolrContentHandler for TIKA is broken by TikaOCR (caused by multiple startDocument events)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7139&quot;&gt;&lt;del&gt;SOLR-7139&lt;/del&gt;&lt;/a&gt;: Fix SolrContentHandler for TIKA to ignore multiple startDocument events&lt;/p&gt;</comment>
                            <comment id="14338486" author="chrismattmann" created="Thu, 26 Feb 2015 14:57:34 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi&quot; class=&quot;user-hover&quot; rel=&quot;thetaphi&quot;&gt;thetaphi&lt;/a&gt;! You rock!&lt;/p&gt;</comment>
                            <comment id="14338502" author="thetaphi" created="Thu, 26 Feb 2015 15:05:51 +0000"  >&lt;p&gt;Can you also confirm this in your case?&lt;/p&gt;</comment>
                            <comment id="14342652" author="chrismattmann" created="Mon, 2 Mar 2015 03:09:57 +0000"  >&lt;p&gt;Sure I&apos;ll download the latest branch 4_10 and then test it out ASAP and report back.&lt;/p&gt;</comment>
                            <comment id="14342879" author="thetaphi" created="Mon, 2 Mar 2015 07:41:40 +0000"  >&lt;p&gt;There is already a RC: &lt;a href=&quot;http://people.apache.org/~mikemccand/staging_area/lucene-solr-4.10.4-RC0-rev1662817/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://people.apache.org/~mikemccand/staging_area/lucene-solr-4.10.4-RC0-rev1662817/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14343233" author="chrismattmann" created="Mon, 2 Mar 2015 15:06:29 +0000"  >&lt;p&gt;awesome thanks Uwe and Mike. Will report back.&lt;/p&gt;</comment>
                            <comment id="14348131" author="chrismattmann" created="Thu, 5 Mar 2015 04:54:26 +0000"  >&lt;p&gt;sorry haven&apos;t had a chance to test this yet. Hopefully tomorrow or Friday.&lt;/p&gt;</comment>
                            <comment id="14348913" author="mikemccand" created="Thu, 5 Mar 2015 15:36:28 +0000"  >&lt;p&gt;Bulk close for 4.10.4 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12747589">TIKA-1445</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12776673">SOLR-7137</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12700078" name="SOLR-7139.Mattmann.022115.patch.txt" size="1158" author="chrismattmann" created="Sun, 22 Feb 2015 05:41:49 +0000"/>
                            <attachment id="12701070" name="SOLR-7139.patch" size="5121" author="uschindler" created="Thu, 26 Feb 2015 14:19:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 37 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i25wbr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>