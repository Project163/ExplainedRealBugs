<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:11:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-8582] /update/json/docs is 4x slower than /update for indexing a list of json docs</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8582</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Indexing a ~650 MB json file containing a list of 2.2 million json documents, I found that bin/post had become 4x slower after &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7042&quot; title=&quot;Enhance bin/post&amp;#39;s JSON handling&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7042&quot;&gt;&lt;del&gt;SOLR-7042&lt;/del&gt;&lt;/a&gt;. Memory consumption has also gone up and I can no longer index this file with a 512mb heap.&lt;/p&gt;

&lt;p&gt;The difference is because we now default to /update/json/docs instead of /update. This can be verified on trunk:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;time curl &lt;span class=&quot;code-quote&quot;&gt;&apos;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8983/solr/gettingstarted/update&apos;&lt;/span&gt; --data-binary @/hdd/solr-data/imdb.json 
&lt;/span&gt;{&lt;span class=&quot;code-quote&quot;&gt;&quot;responseHeader&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;:0,&lt;span class=&quot;code-quote&quot;&gt;&quot;QTime&quot;&lt;/span&gt;:161869}}
&#8203;
real	2m42.044s
user	0m0.292s
sys	0m0.493s
&#8203;
time curl &lt;span class=&quot;code-quote&quot;&gt;&apos;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8983/solr/gettingstarted/update/json/docs&apos;&lt;/span&gt; --data-binary @/hdd/solr-data/imdb.json 
&lt;/span&gt;{&lt;span class=&quot;code-quote&quot;&gt;&quot;responseHeader&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;:0,&lt;span class=&quot;code-quote&quot;&gt;&quot;QTime&quot;&lt;/span&gt;:686264}}
&#8203;
real	11m26.478s
user	0m0.324s
sys	0m0.552s
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12933316">SOLR-8582</key>
            <summary>/update/json/docs is 4x slower than /update for indexing a list of json docs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="noble.paul">Noble Paul</assignee>
                                    <reporter username="shalin">Shalin Shekhar Mangar</reporter>
                        <labels>
                    </labels>
                <created>Fri, 22 Jan 2016 11:16:36 +0000</created>
                <updated>Mon, 9 May 2016 18:51:34 +0000</updated>
                            <resolved>Sat, 23 Jan 2016 18:58:51 +0000</resolved>
                                    <version>5.3.2</version>
                    <version>5.4.1</version>
                                    <fixVersion>5.5</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>update</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15112517" author="noble.paul" created="Fri, 22 Jan 2016 15:11:00 +0000"  >&lt;p&gt;JsonRecordReader keeps around all keys in a root object. In this case it happens to be a very large array . create a new Set for each object in the array &lt;/p&gt;</comment>
                            <comment id="15112530" author="shalinmangar" created="Fri, 22 Jan 2016 15:22:59 +0000"  >&lt;p&gt;Thanks Noble. Your patch fixes the slowdown:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;./bin/solr start -e schemaless -m 2g
time curl &lt;span class=&quot;code-quote&quot;&gt;&apos;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8983/solr/gettingstarted/update&apos;&lt;/span&gt; --data-binary @/solr-data/imdb.json    
&lt;/span&gt;{&lt;span class=&quot;code-quote&quot;&gt;&quot;responseHeader&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;:0,&lt;span class=&quot;code-quote&quot;&gt;&quot;QTime&quot;&lt;/span&gt;:195917}}

real	3m16.231s
user	0m0.274s
sys	0m0.681s

./bin/solr stop
rm -r example/schemaless
./bin/solr start -e schemaless -m 2g
time curl &lt;span class=&quot;code-quote&quot;&gt;&apos;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8983/solr/gettingstarted/update/json/docs&apos;&lt;/span&gt; --data-binary @/solr-data/imdb.json
&lt;/span&gt;{&lt;span class=&quot;code-quote&quot;&gt;&quot;responseHeader&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;:0,&lt;span class=&quot;code-quote&quot;&gt;&quot;QTime&quot;&lt;/span&gt;:192269}}

real	3m12.596s
user	0m0.268s
sys	0m0.721s
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Memory consumption has also reduced. I can now index the same document with 512m of heap. I think there&apos;s still some memory pressure but it is not that bad e.g. the following is with 512m of heap:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;./bin/solr start -e schemaless
time curl &lt;span class=&quot;code-quote&quot;&gt;&apos;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8983/solr/gettingstarted/update/json/docs&apos;&lt;/span&gt; --data-binary @/solr-data/imdb.json
&lt;/span&gt;{&lt;span class=&quot;code-quote&quot;&gt;&quot;responseHeader&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;:0,&lt;span class=&quot;code-quote&quot;&gt;&quot;QTime&quot;&lt;/span&gt;:244608}}

real	4m4.924s
user	0m0.294s
sys	0m0.780s

./bin/solr stop
rm -r example/schemaless
./bin/solr start -e schemaless
time curl &lt;span class=&quot;code-quote&quot;&gt;&apos;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8983/solr/gettingstarted/update&apos;&lt;/span&gt; --data-binary @/solr-data/imdb.json
&lt;/span&gt;{&lt;span class=&quot;code-quote&quot;&gt;&quot;responseHeader&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;:0,&lt;span class=&quot;code-quote&quot;&gt;&quot;QTime&quot;&lt;/span&gt;:231332}}

real	3m51.638s
user	0m0.291s
sys	0m0.745s
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Minor nit - JsonRecordReader#handleObjectStart has an unused argument childrenFound&lt;/p&gt;</comment>
                            <comment id="15112643" author="shalinmangar" created="Fri, 22 Jan 2016 16:40:07 +0000"  >&lt;p&gt;I think there was some underlying bug with JsonRecordReader that affects json-line files which is also solved by your patch. Without your patch, I was not able to index a 549MB json-line (one json per line) even with a 2g heap. I had to bump the heap upto 4g to succeed. But with your patch I am able to index the same file with a 512m heap. Too bad we missed 5.3.2 and 5.4.1 releases.&lt;/p&gt;

&lt;p&gt;+1 to commit&lt;/p&gt;</comment>
                            <comment id="15112710" author="noble.paul" created="Fri, 22 Jan 2016 17:14:34 +0000"  >&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="15112738" author="jira-bot" created="Fri, 22 Jan 2016 17:28:28 +0000"  >&lt;p&gt;Commit 1726261 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1726261&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1726261&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8582&quot; title=&quot;/update/json/docs is 4x slower than /update for indexing a list of json docs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8582&quot;&gt;&lt;del&gt;SOLR-8582&lt;/del&gt;&lt;/a&gt; : memory leak in JsonRecordReader affecting /update/json/docs. Large payloads&lt;br/&gt;
  cause OOM&lt;/p&gt;</comment>
                            <comment id="15112821" author="jira-bot" created="Fri, 22 Jan 2016 18:26:02 +0000"  >&lt;p&gt;Commit 1726271 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt; in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1726271&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1726271&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8582&quot; title=&quot;/update/json/docs is 4x slower than /update for indexing a list of json docs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8582&quot;&gt;&lt;del&gt;SOLR-8582&lt;/del&gt;&lt;/a&gt; : memory leak in JsonRecordReader affecting /update/json/docs. Large payloads&lt;br/&gt;
cause OOM&lt;/p&gt;</comment>
                            <comment id="15113901" author="shalinmangar" created="Sat, 23 Jan 2016 18:58:51 +0000"  >&lt;p&gt;Thanks Noble!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12783820" name="SOLR-8582.patch" size="3707" author="noble.paul" created="Fri, 22 Jan 2016 12:07:19 +0000"/>
                            <attachment id="12783815" name="SOLR-8582.patch" size="1970" author="noble.paul" created="Fri, 22 Jan 2016 11:51:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 43 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ru9b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>