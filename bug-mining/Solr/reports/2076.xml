<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:56:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-5322] core discovery can fail w/NPE and no explanation if a non-readable directory exists</title>
                <link>https://issues.apache.org/jira/browse/SOLR-5322</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Core discovery doesn&apos;t behave well if it encounters a directory it can&apos;t read.  We should either make core discover log &amp;amp; ignore directories such as this, or improve the error message in such a situation if we think it should be fatale.&lt;/p&gt;

&lt;p&gt;steps to reproduce...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;hossman@frisbee:~/lucene/4x_dev/solr/example$ mkdir solr/NO_READ
hossman@frisbee:~/lucene/4x_dev/solr/example$ chmod a-r solr/NO_READ/
hossman@frisbee:~/lucene/4x_dev/solr/example$ java -jar start.jar 
...
1434 [main] ERROR org.apache.solr.servlet.SolrDispatchFilter  &#8211; Could not start Solr. Check solr/home property and the logs
1452 [main] ERROR org.apache.solr.core.SolrCore  &#8211; null:java.lang.NullPointerException
	at org.apache.solr.core.CorePropertiesLocator.discoverUnder(CorePropertiesLocator.java:131)
	at org.apache.solr.core.CorePropertiesLocator.discoverUnder(CorePropertiesLocator.java:140)
	at org.apache.solr.core.CorePropertiesLocator.discover(CorePropertiesLocator.java:123)
	at org.apache.solr.core.CoreContainer.load(CoreContainer.java:240)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;&quot;original bug report&quot;&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;p&gt;Hello.&lt;/p&gt;

&lt;p&gt;When in solr/home directory exists directory to which solr do not have rights, then solr failed to start with exception&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2108 [main] INFO org.apache.solr.core.CoresLocator - Looking for core definitions underneath /var/lib/solr
2109 [main] ERROR org.apache.solr.servlet.SolrDispatchFilter - Could not start Solr. Check solr/home property and the logs
2138 [main] ERROR org.apache.solr.core.SolrCore - null:java.lang.NullPointerException
        at org.apache.solr.core.CorePropertiesLocator.discoverUnder(CorePropertiesLocator.java:121)
        at org.apache.solr.core.CorePropertiesLocator.discoverUnder(CorePropertiesLocator.java:130)
        at org.apache.solr.core.CorePropertiesLocator.discover(CorePropertiesLocator.java:113)
        at org.apache.solr.core.CoreContainer.load(CoreContainer.java:226)
        at org.apache.solr.servlet.SolrDispatchFilter.createCoreContainer(SolrDispatchFilter.java:177)
        at org.apache.solr.servlet.SolrDispatchFilter.init(SolrDispatchFilter.java:127)
        at org.apache.catalina.core.ApplicationFilterConfig.getFilter(ApplicationFilterConfig.java:295)
        at org.apache.catalina.core.ApplicationFilterConfig.setFilterDef(ApplicationFilterConfig.java:422)
        at org.apache.catalina.core.ApplicationFilterConfig.&amp;lt;init&amp;gt;(ApplicationFilterConfig.java:115)
        at org.apache.catalina.core.StandardContext.filterStart(StandardContext.java:3838)
        at org.apache.catalina.core.StandardContext.start(StandardContext.java:4488)
        at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:791)
        at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:771)
        at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:526)
        at org.apache.catalina.startup.HostConfig.deployDescriptor(HostConfig.java:637)
        at org.apache.catalina.startup.HostConfig.deployDescriptors(HostConfig.java:563)
        at org.apache.catalina.startup.HostConfig.deployApps(HostConfig.java:498)
        at org.apache.catalina.startup.HostConfig.start(HostConfig.java:1277)
        at org.apache.catalina.startup.HostConfig.lifecycleEvent(HostConfig.java:321)
        at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:119)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1053)
        at org.apache.catalina.core.StandardHost.start(StandardHost.java:722)
        at org.apache.catalina.core.ContainerBase.start(ContainerBase.java:1045)
        at org.apache.catalina.core.StandardEngine.start(StandardEngine.java:443)
        at org.apache.catalina.core.StandardService.start(StandardService.java:516)
        at org.apache.catalina.core.StandardServer.start(StandardServer.java:710)
        at org.apache.catalina.startup.Catalina.start(Catalina.java:593)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:616)
        at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:289)
        at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:414)

2138 [main] INFO org.apache.solr.servlet.SolrDispatchFilter - SolrDispatchFilter.init() done
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For example:&lt;br/&gt;
solr home located on /var/lib/solr&lt;br/&gt;
/var/lib/solr is another file system, it has lost+found directory.&lt;br/&gt;
As result solr can&apos;t to star.&lt;/p&gt;

&lt;p&gt;Yours faithfully.&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Centos 6.4&lt;br/&gt;
tomcat6&lt;/p&gt;</environment>
        <key id="12673001">SOLR-5322</key>
            <summary>core discovery can fail w/NPE and no explanation if a non-readable directory exists</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="erickerickson">Erick Erickson</assignee>
                                    <reporter username="said">Said Chavkin</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Oct 2013 10:43:49 +0000</created>
                <updated>Mon, 9 May 2016 18:58:33 +0000</updated>
                            <resolved>Fri, 5 Sep 2014 18:44:31 +0000</resolved>
                                    <version>4.5</version>
                                    <fixVersion>5.0</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="13790273" author="erickerickson" created="Wed, 9 Oct 2013 11:55:05 +0000"  >&lt;p&gt;Please raise this kind of issue on the user&apos;s list before raising a JIRA to see if it&apos;s really a but in Solr or a configuration issue.&lt;/p&gt;

&lt;p&gt;You can reopen this is you think it&apos;s something Solr should manage.&lt;/p&gt;

&lt;p&gt;What would you have Solr do? If it&apos;s not being run as a process that has permissions to a necessary directory what can it do &lt;em&gt;but&lt;/em&gt; fail on startup? You as the sysadmin are responsible for permissions....&lt;/p&gt;</comment>
                            <comment id="14107303" author="cott@internetstaff.com" created="Fri, 22 Aug 2014 19:05:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt; - It&apos;s not the home directory permissions. If any subdirectory of the home directory isn&apos;t readable, Solr fails as indicated above.&lt;/p&gt;

&lt;p&gt;Here&apos;s an example:&lt;/p&gt;

&lt;p&gt;drwxr-xr-x 3 solr solr  4096 Aug 20 21:25 collection1&lt;br/&gt;
drwx------ 2 root root 49152 Aug 21 22:02 lost+found&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 solr solr 1715 Jun 18 11:59 solr.xml&lt;/p&gt;

&lt;p&gt;Despite this otherwise being an otherwise healthy Solr home directory, Solr fails because it can&apos;t read lost+found. &lt;/p&gt;</comment>
                            <comment id="14107665" author="hossman" created="Fri, 22 Aug 2014 23:11:59 +0000"  >&lt;blockquote&gt;&lt;p&gt;If any subdirectory of the home directory isn&apos;t readable, Solr fails as indicated above.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah ... that part really wasn&apos;t clear from the initial bug report.&lt;/p&gt;

&lt;p&gt;The issue here is that in core-discover mode, solr really can&apos;t tell if a non-readable directory is a sign of a problem or not.  The flip side of ignoring non-readable directories is that it would mean solr might happily startup w/o some core you are expecting to be there if the permissions are set wrong.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;...Despite this otherwise being an otherwise healthy Solr home directory, Solr fails because it can&apos;t read lost+found. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The specific situation you show is a great example of why i would argue that the presense of a non-readable directory like &lt;tt&gt;lost+found&lt;/tt&gt; is in fact a serious problem and you might not want thi solr node to startup because of it.  what if lost+found contains your entire collection?&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;regardless of wether we think solr should ignore non-readbale files, we should at least generate a better error message then NullPointerException&lt;/p&gt;

</comment>
                            <comment id="14107743" author="erickerickson" created="Sat, 23 Aug 2014 00:17:24 +0000"  >&lt;p&gt;Hmmm, for comparison, I just ran an experiment with the multicore setup where I changed core1/data/index to a-r permissions. Solr starts up, albeit with some warnings, which are way more informative. But core0 is still available. Here&apos;s the error:&lt;/p&gt;

&lt;p&gt;directory &apos;/Users/Erick/apache/4x/solr/example/multicore/core1/data/index&apos; exists and is a directory, but cannot be listed: list() returned null&lt;/p&gt;

&lt;p&gt;Which is much more informative than the core discovery bits. So it seems consistent to log an error and drive on.&lt;/p&gt;</comment>
                            <comment id="14108144" author="erickerickson" created="Sat, 23 Aug 2014 20:58:24 +0000"  >&lt;p&gt;As I thought about various file permissions, there are several things that could be tested/warned about. What is the right thing to do here?&lt;/p&gt;

&lt;p&gt;1&amp;gt; What if SolrHome isn&apos;t readable (but exists)? I&apos;m testing code that throws a runtime error in this case. Is this too harsh? The code already dies a horrible death if the directory just doesn&apos;t exist.&lt;/p&gt;

&lt;p&gt;2&amp;gt; What about files as opposed to directories being unreadable? Should that print a warning too? The code does currently.&lt;/p&gt;

&lt;p&gt;Should have a patch up later today.&lt;/p&gt;</comment>
                            <comment id="14118495" author="erickerickson" created="Tue, 2 Sep 2014 18:36:56 +0000"  >&lt;p&gt;Oops, kinda forgot.&lt;/p&gt;

&lt;p&gt;This patch throws a runtime exception if SOLR_HOME is not readable, and logs a warning if any file or directory in the tree is unreadable and drives on.&lt;/p&gt;

&lt;p&gt;I&apos;ll commit this tomorrow unless there are objections.&lt;/p&gt;</comment>
                            <comment id="14123165" author="erickerickson" created="Fri, 5 Sep 2014 17:03:59 +0000"  >&lt;p&gt;Final patch, including CHANGES.txt. Will commit shortly.&lt;/p&gt;</comment>
                            <comment id="14123199" author="erickerickson" created="Fri, 5 Sep 2014 17:30:44 +0000"  >&lt;p&gt;Siiigh. precommit caught a forbidden API (File.delete if you must know)....&lt;/p&gt;</comment>
                            <comment id="14123201" author="jira-bot" created="Fri, 5 Sep 2014 17:31:36 +0000"  >&lt;p&gt;Commit 1622745 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickoerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickoerickson&quot;&gt;erickoerickson&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1622745&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1622745&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5322&quot; title=&quot;core discovery can fail w/NPE and no explanation if a non-readable directory exists&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5322&quot;&gt;&lt;del&gt;SOLR-5322&lt;/del&gt;&lt;/a&gt;: core discovery can fail w/NPE and no explanation if a non-readable directory exists&lt;/p&gt;</comment>
                            <comment id="14123360" author="jira-bot" created="Fri, 5 Sep 2014 18:43:50 +0000"  >&lt;p&gt;Commit 1622756 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickoerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickoerickson&quot;&gt;erickoerickson&lt;/a&gt; in branch &apos;dev/branches/branch_4x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1622756&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1622756&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5322&quot; title=&quot;core discovery can fail w/NPE and no explanation if a non-readable directory exists&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5322&quot;&gt;&lt;del&gt;SOLR-5322&lt;/del&gt;&lt;/a&gt;: core discovery can fail w/NPE and no explanation if a non-readable directory exists&lt;/p&gt;</comment>
                            <comment id="14123363" author="erickerickson" created="Fri, 5 Sep 2014 18:44:31 +0000"  >&lt;p&gt;Thanks Said!&lt;/p&gt;</comment>
                            <comment id="14332823" author="anshumg" created="Mon, 23 Feb 2015 05:02:07 +0000"  >&lt;p&gt;Bulk close after 5.0 release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12666826" name="SOLR-5322.patch" size="7787" author="erickerickson" created="Fri, 5 Sep 2014 17:30:44 +0000"/>
                            <attachment id="12666823" name="SOLR-5322.patch" size="7559" author="erickerickson" created="Fri, 5 Sep 2014 17:03:59 +0000"/>
                            <attachment id="12665945" name="SOLR-5322.patch" size="6496" author="erickerickson" created="Tue, 2 Sep 2014 18:36:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>352624</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 39 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1oso7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>352911</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>