<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:20:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-2307] PHPSerialized fails with sharded queries</title>
                <link>https://issues.apache.org/jira/browse/SOLR-2307</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Solr throws a &quot;java.lang.IllegalArgumentException: Map size must not be negative exception&quot; when using the PHP Serialized response writer with sharded queries. &lt;br/&gt;
To reproduce the issue start your preferred example and try the following query:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://localhost:8983/solr/select/?q=*:*&amp;amp;wt=phps&amp;amp;shards=localhost:8983/solr,localhost:8983/solr&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8983/solr/select/?q=*:*&amp;amp;wt=phps&amp;amp;shards=localhost:8983/solr,localhost:8983/solr&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It is caused by the JSONWriter implementation of writeSolrDocumentList and writeSolrDocument. Overriding this two methods in the PHPSerializedResponseWriter to handle the SolrDocument size seems to solve the issue.&lt;br/&gt;
Attached my patch made against trunk rev 1055588.&lt;/p&gt;

&lt;p&gt;cheers,&lt;br/&gt;
Antonio&lt;/p&gt;</description>
                <environment></environment>
        <key id="12494760">SOLR-2307</key>
            <summary>PHPSerialized fails with sharded queries</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="anto">Antonio Verni</reporter>
                        <labels>
                    </labels>
                <created>Wed, 5 Jan 2011 19:54:40 +0000</created>
                <updated>Wed, 30 Mar 2011 15:45:32 +0000</updated>
                            <resolved>Wed, 19 Jan 2011 01:20:29 +0000</resolved>
                                    <version>1.3</version>
                    <version>1.4.1</version>
                                    <fixVersion>3.1</fixVersion>
                    <fixVersion>4.0-ALPHA</fixVersion>
                                    <component>Response Writers</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12979665" author="anto" created="Mon, 10 Jan 2011 17:57:42 +0000"  >&lt;p&gt;Patch update to handle single values in multi valued fields. Added a junit test case just to test the issue.&lt;/p&gt;</comment>
                            <comment id="12979683" author="iorixxx" created="Mon, 10 Jan 2011 18:55:31 +0000"  >&lt;p&gt;This patch solves this problem &lt;a href=&quot;http://search-lucene.com/m/lr7t42uWp4g&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://search-lucene.com/m/lr7t42uWp4g&lt;/a&gt; , right?&lt;/p&gt;</comment>
                            <comment id="12979715" author="anto" created="Mon, 10 Jan 2011 19:54:26 +0000"  >&lt;p&gt;yes, exactly, and it could also fix &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2278&quot; title=&quot;PHPSerialized fails with Solr spatial&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2278&quot;&gt;&lt;del&gt;SOLR-2278&lt;/del&gt;&lt;/a&gt; but I didn&apos;t tested it.&lt;br/&gt;
As I discovered reading your &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2291&quot; title=&quot;JSONWriter.writeSolrDocument() does not respect its Set&amp;lt;String&amp;gt; returnFields parameter.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2291&quot;&gt;&lt;del&gt;SOLR-2291&lt;/del&gt;&lt;/a&gt;, the current patch I uploaded does not respect returnFields parameter. I&apos;ve fixed it but I need to upload a third version of the patch (so please, sorry the mess) and a new test file.&lt;br/&gt;
In detail, to fix the issue I&apos;ve added a numeric index to the &quot;response&quot; array of documents in writeSolrDocumentList as requested by the php serialization protocol and handled the field count in writeSolrDocument.&lt;/p&gt;</comment>
                            <comment id="12979737" author="iorixxx" created="Mon, 10 Jan 2011 20:24:35 +0000"  >&lt;p&gt;By the way, I think you should call  req.close(); at the end the test.&lt;/p&gt;</comment>
                            <comment id="12983384" author="hossman" created="Tue, 18 Jan 2011 21:27:56 +0000"  >&lt;p&gt;path looks good &amp;#8211; includes a test that fails (horrificly) w/o patch applied.&lt;/p&gt;

&lt;p&gt;new attachment just merges the Antonio&apos;s two files (FYI: Antonio, if you do an &quot;svn add&quot; to your local copy, then &quot;svn diff&quot; will generate a unified patch even for new files); moves some existing PHPS test out of JSONWriterTest into the new test class, and adds the request closing that Ahmet mentioned.&lt;/p&gt;

&lt;p&gt;committing soon&lt;/p&gt;</comment>
                            <comment id="12983396" author="hossman" created="Tue, 18 Jan 2011 21:44:55 +0000"  >&lt;p&gt;Committed revision 1060585. &amp;#8211; trunk&lt;/p&gt;


&lt;p&gt;Committed revision 1060589. - 3x.&lt;/p&gt;

&lt;p&gt;thanks again for the great patch Antonio&lt;/p&gt;</comment>
                            <comment id="12983461" author="hossman" created="Wed, 19 Jan 2011 00:40:20 +0000"  >&lt;p&gt;Uwe noticed a bug on some VMs ... the test assumes consistent iteration order of fields but that is not guaranteed by the code ... reopening to fix (should be straight forward)&lt;/p&gt;</comment>
                            <comment id="12983468" author="hossman" created="Wed, 19 Jan 2011 00:59:06 +0000"  >&lt;p&gt;code/test fixes to use predictable field order...&lt;/p&gt;

&lt;p&gt;Committed revision 1060641. - trunk&lt;br/&gt;
Committed revision 1060642. - 3x&lt;/p&gt;</comment>
                            <comment id="12983477" author="hossman" created="Wed, 19 Jan 2011 01:17:45 +0000"  >&lt;p&gt;more fixes because the test itself also uses a HashMap that i didn&apos;t notice...&lt;/p&gt;

&lt;p&gt;Committed revision 1060645. trunk&lt;br/&gt;
Committed revision 1060646. 3x&lt;/p&gt;</comment>
                            <comment id="12983481" author="hossman" created="Wed, 19 Jan 2011 01:20:29 +0000"  >&lt;p&gt;i think we&apos;re all good here now&lt;/p&gt;</comment>
                            <comment id="12983505" author="iorixxx" created="Wed, 19 Jan 2011 02:38:26 +0000"  >&lt;p&gt;Hoss, can you attach committed patch? I was wondering about predictable field order solution.&lt;/p&gt;</comment>
                            <comment id="13013099" author="gsingers" created="Wed, 30 Mar 2011 15:45:32 +0000"  >&lt;p&gt;Bulk close for 3.1.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12492831">SOLR-2278</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12467914" name="PHPSerializedResponseWriter.java.patch" size="3537" author="anto" created="Mon, 10 Jan 2011 20:02:45 +0000"/>
                            <attachment id="12467899" name="PHPSerializedResponseWriter.java.patch" size="3093" author="anto" created="Mon, 10 Jan 2011 17:57:42 +0000"/>
                            <attachment id="12467575" name="PHPSerializedResponseWriter.java.patch" size="3344" author="anto" created="Wed, 5 Jan 2011 19:56:23 +0000"/>
                            <attachment id="12468685" name="SOLR-2307.patch" size="8829" author="hossman" created="Tue, 18 Jan 2011 21:27:55 +0000"/>
                            <attachment id="12467915" name="TestPHPSerializedResponseWriter.java" size="3096" author="anto" created="Mon, 10 Jan 2011 20:02:45 +0000"/>
                            <attachment id="12467900" name="TestPHPSerializedResponseWriter.java" size="3096" author="anto" created="Mon, 10 Jan 2011 17:57:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5213</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 34 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03lk7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>18926</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>