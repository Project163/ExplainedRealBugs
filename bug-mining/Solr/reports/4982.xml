<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:53:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-16605] CPU in UI cloud-&gt;nodes is always 0%, even when Solr is very busy.</title>
                <link>https://issues.apache.org/jira/browse/SOLR-16605</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The Cloud-&amp;gt;Nodes section of the admin UI is always reporting 0% CPU even on very busy Solr nodes.  I thought the attached patch would fix t, but it doesn&apos;t seem to be working.  Instead of always 0%, it now shows an occasional 50% or 100%... and even rarer is a different percentage like 84% or 17%.  The Solr process at that time was usng about 180% CPU (two CPUs in AWS instance).&lt;/p&gt;

&lt;p&gt;Using OperatingSystemMXBean from com.sun instead of java.lang seemed to work fine in a quick test program, but it&apos;s not working in Solr.  I am trying this on Ubuntu Linux with OpenJDK 17 and 11.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13516212">SOLR-16605</key>
            <summary>CPU in UI cloud-&gt;nodes is always 0%, even when Solr is very busy.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="elyograg">Shawn Heisey</assignee>
                                    <reporter username="elyograg">Shawn Heisey</reporter>
                        <labels>
                    </labels>
                <created>Mon, 2 Jan 2023 19:41:03 +0000</created>
                <updated>Sat, 1 Apr 2023 00:16:22 +0000</updated>
                            <resolved>Sat, 1 Apr 2023 00:16:22 +0000</resolved>
                                    <version>9.1</version>
                                    <fixVersion>9.2</fixVersion>
                                    <component>Admin UI</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17653689" author="elyograg" created="Mon, 2 Jan 2023 20:40:12 +0000"  >&lt;p&gt;If I just do the javascript change, that seems to produce the same results as the whole patch.&#160; Sometimes it shows a nonzero CPU usage, mostly it shows 0%.&#160; I will go ahead and commit the javascript change shortly, because what&apos;s there currently is wrong, as the returned value from the bean is in the range of 0-1, not 0-100.&lt;/p&gt;

&lt;p&gt;My little test program looks like the processCpuLoad method is returning the correct value on every run, so I am very confused about why Solr is reporting 0% most of the time.&lt;br/&gt;
&#160;&lt;/p&gt;</comment>
                            <comment id="17653690" author="elyograg" created="Mon, 2 Jan 2023 20:43:33 +0000"  >&lt;p&gt;Test program:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; org.elyograg.misc;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.lang.management.ManagementFactory;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.springframework.boot.autoconfigure.SpringBootApplication;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.sun.management.OperatingSystemMXBean;

@SpringBootApplication
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;OsbeantestApplication {

	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
&lt;span class=&quot;code-comment&quot;&gt;//		SpringApplication.run(OsbeantestApplication.class, args);
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;//		OperatingSystemMXBean osb2;
&lt;/span&gt;		OperatingSystemMXBean osb1 = (OperatingSystemMXBean) ManagementFactory.getOperatingSystemMXBean();
		&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; t = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CpuStressThread();
		t.setDaemon(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
		t.start();

		&lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;) {
			&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;process: &quot;&lt;/span&gt; + osb1.getProcessCpuLoad() * 100);
			&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;system: &quot;&lt;/span&gt; + osb1.getSystemCpuLoad() * 100);
			&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
				&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(3000);
			} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Throwable e) {
				e.printStackTrace();
			}
		}
	}

	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;CpuStressThread &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; {
		&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; load = 0.8;
		&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; duration = 100000;

		&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; CpuStressThread() {
		}

		/**
		 * Generates the load when run
		 */
		@Override
		&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void run() {
			&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; startTime = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis();
			&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
				&lt;span class=&quot;code-comment&quot;&gt;// Loop &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the given duration
&lt;/span&gt;				&lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis() - startTime &amp;lt; duration) {
					&lt;span class=&quot;code-comment&quot;&gt;// Every 100ms, sleep &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the percentage of unladen time
&lt;/span&gt;					&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis() % 100 == 0) {
						&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep((&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;) &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.floor((1 - load) * 100));
					}
				}
			} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) {
				e.printStackTrace();
			}
		}
	}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17653691" author="elyograg" created="Mon, 2 Jan 2023 20:48:09 +0000"  >&lt;p&gt;Switching to UnixOperatingSystemMXBean in my test program produces the same results.&lt;/p&gt;</comment>
                            <comment id="17653693" author="jira-bot" created="Mon, 2 Jan 2023 21:03:06 +0000"  >&lt;p&gt;Commit 5884467f49024e2fa15eb51f77f04d21f626e367 in solr&apos;s branch refs/heads/main from Shawn Heisey&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=5884467f490&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=5884467f490&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16605&quot; title=&quot;CPU in UI cloud-&amp;gt;nodes is always 0%, even when Solr is very busy.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16605&quot;&gt;&lt;del&gt;SOLR-16605&lt;/del&gt;&lt;/a&gt;: fix CPU calculaton in cloud-&amp;gt;nodes UI tab&lt;/p&gt;</comment>
                            <comment id="17653694" author="jira-bot" created="Mon, 2 Jan 2023 21:05:13 +0000"  >&lt;p&gt;Commit 47f11da34e9889717c11177d985385023fb86a4c in solr&apos;s branch refs/heads/branch_9x from Shawn Heisey&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=47f11da34e9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=47f11da34e9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16605&quot; title=&quot;CPU in UI cloud-&amp;gt;nodes is always 0%, even when Solr is very busy.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16605&quot;&gt;&lt;del&gt;SOLR-16605&lt;/del&gt;&lt;/a&gt;: fix CPU calculaton in cloud-&amp;gt;nodes UI tab&lt;/p&gt;</comment>
                            <comment id="17653696" author="elyograg" created="Mon, 2 Jan 2023 21:12:19 +0000"  >&lt;p&gt;The committed change fixes the percentage calculation in the javascript, but it still mostly reports 0%.&#160; The method in OperatingSystemMXBean seems to be working correctly in a different program than Solr.&#160;&#160; I will try adding some logging to the metrics code in Solr.&lt;/p&gt;</comment>
                            <comment id="17653734" author="elyograg" created="Tue, 3 Jan 2023 02:36:42 +0000"  >&lt;p&gt;I have not been able to figure out what is happening.&#160; Added some logging to the MetricsUtil class, and the metrics processCpuLoad entry in the metrics bean does not match when the admin UI says something other than 0%.&#160; When the UI says 0%, the value is 0.0.&#160; Have to reload the page several times to get it saying anything other than 0%.&lt;/p&gt;

&lt;p&gt;In my test program, the mx bean&apos;s processCpuLoad and systemCpuLoad entries appear to be correct.&#160; But for some reason when Solr does it the value is wrong.&#160; I suspect that something happens deep within Solr&apos;s metrics classes that I don&apos;t understand.&lt;/p&gt;</comment>
                            <comment id="17707456" author="janhoy" created="Sat, 1 Apr 2023 00:16:22 +0000"  >&lt;p&gt;Since the commit was released in 9.2, I&apos;ll go ahead and resolve this. Please open another Jira if you feel there is a better way to pick up CPU load from Java.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13054258" name="fixcpuadminui-1.patch" size="3497" author="elyograg" created="Mon, 2 Jan 2023 19:25:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 32 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1ehg0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>