<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:48:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-5423] CSV output doesn&apos;t include function field</title>
                <link>https://issues.apache.org/jira/browse/SOLR-5423</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Given a schema with &lt;/p&gt;

&lt;p&gt;   &amp;lt;field name=&quot;price&quot;  type=&quot;float&quot; indexed=&quot;true&quot; stored=&quot;true&quot;/&amp;gt;&lt;br/&gt;
   &amp;lt;field name=&apos;numpages&apos; type=&apos;int&apos; indexed=&apos;true&apos; stored=&apos;true&apos;/&amp;gt;&lt;/p&gt;

&lt;p&gt;the following query returns no rows:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://localhost:8983/solr/collection1/select?q=*%3A*&amp;amp;rows=30&amp;amp;fl=div(price%2Cnumpages)&amp;amp;wt=csv&amp;amp;indent=true&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8983/solr/collection1/select?q=*%3A*&amp;amp;rows=30&amp;amp;fl=div(price%2Cnumpages)&amp;amp;wt=csv&amp;amp;indent=true&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;However, setting wt=json or wt=xml, it works.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12677541">SOLR-5423</key>
            <summary>CSV output doesn&apos;t include function field</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sarowe">Steven Rowe</assignee>
                                    <reporter username="jwilson_shutterstock">James Wilson</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 Nov 2013 10:12:17 +0000</created>
                <updated>Mon, 9 May 2016 18:44:32 +0000</updated>
                            <resolved>Tue, 25 Feb 2014 04:36:01 +0000</resolved>
                                    <version>4.4</version>
                                    <fixVersion>4.7.1</fixVersion>
                    <fixVersion>4.8</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due></due>
                            <votes>2</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13889470" author="arun_mist" created="Mon, 3 Feb 2014 13:33:37 +0000"  >&lt;p&gt;Fix for the csv output doesn&apos;t work for function fields&lt;/p&gt;</comment>
                            <comment id="13889471" author="arun_mist" created="Mon, 3 Feb 2014 13:33:47 +0000"  >&lt;p&gt;I have fixed this issue. Attached the patch file for the fix.&lt;/p&gt;</comment>
                            <comment id="13893715" author="hossman" created="Thu, 6 Feb 2014 19:47:54 +0000"  >&lt;p&gt;Hey Arun, some comments about your patch:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;please generate patches against he entire code base so they are easier to apply &amp;amp; review: &lt;a href=&quot;https://wiki.apache.org/solr/HowToContribute#Generating_a_patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://wiki.apache.org/solr/HowToContribute#Generating_a_patch&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;can you explain what&apos;s going on with the getOriginalNameForFunctionField function in your patch? ... it seems extremely sketchy.  if the problem is just that ValueSourceAugmenter&apos;s &quot;getName&quot; doesn&apos;t match the actual fieldname the transformer puts in the modified documents, we should fix that in ValueSourceAugmenter&lt;/li&gt;
	&lt;li&gt;in general, the amount of instanceof checking going on in your patch seems really brittle, and i&apos;m not exactly sure why it&apos;s neccessary.  As I understand it the CSVResponseWriter already loops over all of the field names in the documents to be returned to get the list of column names it should output &amp;#8211; so as long as the transformer logic is applied before that, then won&apos;t the field names be picked up automatically?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;independent of any of the above questions about this patch, we shouldn&apos;t move forward with committing support for transformers to the csv repsonse writer w/o having some tests that prove it works.&lt;/p&gt;
</comment>
                            <comment id="13894474" author="arun_mist" created="Fri, 7 Feb 2014 12:55:02 +0000"  >&lt;p&gt;Generated the patch at the project root level with proper naming convention&lt;/p&gt;</comment>
                            <comment id="13894495" author="arun_mist" created="Fri, 7 Feb 2014 13:14:58 +0000"  >&lt;p&gt;Hi Hoss,&lt;/p&gt;

&lt;p&gt;Thanks for your review. I have attached the patch generated at the root level and followed the naming convention for the file.&lt;/p&gt;

&lt;p&gt;Here are my inputs on your other comments:&lt;/p&gt;

&lt;p&gt;The reason for including a new method getOriginalNameForFunctionField is the ValueSourceAugmenter.getName() returns the name with a function prefix to it, as like this. &lt;/p&gt;

&lt;p&gt; public String getName()&lt;/p&gt;
  {
    return &quot;function(&quot;+name+&quot;)&quot;;
  }

&lt;p&gt;We can&apos;t change this method directly as it has been referred in few other places in the code, it may break other places. Even I thought of including a new method in ValueSourceAugmenter as getOriginalName()&lt;/p&gt;
{return name;}
&lt;p&gt; but for this we have to change the abstract class DocTransformer and should implement this new method in all the child classes which are extending DocTransformer. So I dropped this option and wrote a method specific to CSVResponseWriter.&lt;/p&gt;

&lt;p&gt;On number of instanceof used, in writeResponse method of CSVResponseWriter the responseObj type is coming as ResultContext only when we have functions in the query. so I am filtering the ResultContext instance and then the other two instanceof is required when one function is present in the query then the transformer type is of ValueSourceAugmenter and if we have multiple functions in the same query then the transformer type is DocTransformers (array of ValueSourceAugmenter) so we need to check these instanceof to process accordingly. In general the transformer logic followed for xml/json is different than the csv. In csv we don&apos;t have headers and the format also simple. Because of this difference the transformers are not considering the function field as a field for the csv type. Please let me know if there are any other better way to handle this.&lt;/p&gt;

&lt;p&gt;On the test case, yes I can write a unit test case to prove this fix works. &lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Arun&lt;/p&gt;</comment>
                            <comment id="13898049" author="arun_mist" created="Tue, 11 Feb 2014 17:25:00 +0000"  >&lt;p&gt;Attached the updated patch with a supporting unit test to test the fix.&lt;/p&gt;</comment>
                            <comment id="13900808" author="steve_rowe" created="Thu, 13 Feb 2014 22:22:48 +0000"  >&lt;p&gt;Hi Arun,&lt;/p&gt;

&lt;p&gt;1. About  &lt;tt&gt;getOriginalNameForFunctionField()&lt;/tt&gt; - Hoss wrote:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;if the problem is just that ValueSourceAugmenter&apos;s &quot;getName&quot; doesn&apos;t match the actual fieldname the transformer puts in the modified documents, we should fix that in ValueSourceAugmenter&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;and then you wrote:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;We can&apos;t change this method directly as it has been referred in few other places in the code, it may break other places.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s not a problem, you can fix them in those other places.&lt;/p&gt;

&lt;p&gt;2. About instanceof - Hoss wrote:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;in general, the amount of instanceof checking going on in your patch seems really brittle, and i&apos;m not exactly sure why it&apos;s neccessary. As I understand it the CSVResponseWriter already loops over all of the field names in the documents to be returned to get the list of column names it should output &#8211; so as long as the transformer logic is applied before that, then won&apos;t the field names be picked up automatically?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If you look at the loop Hoss describes, where &lt;tt&gt;fields&lt;/tt&gt; are pulled from the response documents (starting at line #244 in your patched version of &lt;tt&gt;CSVResponseWriter.java&lt;/tt&gt;), you shouldn&apos;t need to do any of the transformer interrogation you&apos;re doing at all.  Maybe the condition around the loop needs to be expanded to include cases when there are function fields (&lt;tt&gt;returnFields.getTransformer() != null&lt;/tt&gt; or something like that)?&lt;/p&gt;

&lt;p&gt;3. Unit tests: you added one case, but I&apos;d suggest you add a few more, e.g. the one in this issue&apos;s description, where there is no field renaming.&lt;/p&gt;</comment>
                            <comment id="13902446" author="arun_mist" created="Sat, 15 Feb 2014 16:01:44 +0000"  >&lt;p&gt;Hi Steve,&lt;/p&gt;

&lt;p&gt;Thanks for your review, I have attached an updated patch.&lt;/p&gt;

&lt;p&gt;1. I removed the new method getOriginalNameForFunctionField() instead as you suggested I updated the getName() of ValueSourceAugmenter. There are no impacts because of this change, I tested the unit test case&lt;br/&gt;
covering this ValueSourceAugmenter.&lt;/p&gt;

&lt;p&gt;2. Made correction as you &amp;amp; Hoss suggested&lt;/p&gt;

&lt;p&gt;3. Covered additional unit test without alias names and single/multiple functions in query&lt;/p&gt;

&lt;p&gt;-Arun&lt;/p&gt;</comment>
                            <comment id="13908547" author="steve_rowe" created="Fri, 21 Feb 2014 17:24:00 +0000"  >&lt;p&gt;Hi Arun,&lt;/p&gt;

&lt;p&gt;When you post patches, you don&apos;t need to remove older versions - in fact, you shouldn&apos;t - JIRA will gray out older same-named files, and people can see the evolution of proposed changes.  You can see that with the patch file I&apos;m attaching now - your most recent one and mine are both there.  If you hover your mouse pointer over an attachment file name, you can see some metadata about it in the tooltip: who posted it and when.&lt;/p&gt;

&lt;p&gt;In looking at your patch, I noticed that your solution of appending fields by getting their names from the corresponding transformers would put fields in the wrong order if a function pseudofield is not last in the requested fields list.  I reordered the requested fields in one of your tests to illustrate this problem.&lt;/p&gt;

&lt;p&gt;Hoss&apos;s and my comments about the get-all-fields-from-the-docs loop already having access to all fields was wrong, because the transformation logic happens later, at the end of &lt;tt&gt;CSVResponseWriter.writeResponse()&lt;/tt&gt;, in the call to &lt;tt&gt;TextResponseWriter.writeDocuments()&lt;/tt&gt;.  Even if we had been right, appending fields in an order different from the requested order would have been wrong.  &lt;/p&gt;

&lt;p&gt;So the field ordering problem has to be fixed based on the actual requested fields list.  The attached patch handles this in &lt;tt&gt;SolrReturnFields&lt;/tt&gt;, where the requested fields list is parsed, by putting function pseudofields into the (ordered) requested field names - at present, the only consumer of this is &lt;tt&gt;CSVWriter.writeResponse()&lt;/tt&gt;.  This solution doesn&apos;t need to change &lt;tt&gt;CSVResponseWriter&lt;/tt&gt; itself at all.  I also added a test to &lt;tt&gt;ReturnFieldsTest&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I think this is ready to go.&lt;/p&gt;</comment>
                            <comment id="13911072" author="jira-bot" created="Tue, 25 Feb 2014 01:03:08 +0000"  >&lt;p&gt;Commit 1571505 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1571505&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1571505&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5423&quot; title=&quot;CSV output doesn&amp;#39;t include function field&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5423&quot;&gt;&lt;del&gt;SOLR-5423&lt;/del&gt;&lt;/a&gt;: CSV output doesn&apos;t include function field&lt;/p&gt;</comment>
                            <comment id="13911238" author="jira-bot" created="Tue, 25 Feb 2014 04:33:45 +0000"  >&lt;p&gt;Commit 1571559 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt; in branch &apos;dev/branches/branch_4x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1571559&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1571559&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5423&quot; title=&quot;CSV output doesn&amp;#39;t include function field&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5423&quot;&gt;&lt;del&gt;SOLR-5423&lt;/del&gt;&lt;/a&gt;: CSV output doesn&apos;t include function field (merged trunk r1571505)&lt;/p&gt;</comment>
                            <comment id="13911243" author="steve_rowe" created="Tue, 25 Feb 2014 04:36:01 +0000"  >&lt;p&gt;Committed to trunk and branch_4x.&lt;/p&gt;</comment>
                            <comment id="13945253" author="steve_rowe" created="Mon, 24 Mar 2014 15:51:05 +0000"  >&lt;p&gt;I&apos;ll backport this to 4.7.1&lt;/p&gt;</comment>
                            <comment id="13945455" author="jira-bot" created="Mon, 24 Mar 2014 18:19:15 +0000"  >&lt;p&gt;Commit 1580965 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt; in branch &apos;dev/branches/lucene_solr_4_7&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1580965&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1580965&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5423&quot; title=&quot;CSV output doesn&amp;#39;t include function field&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5423&quot;&gt;&lt;del&gt;SOLR-5423&lt;/del&gt;&lt;/a&gt;: CSV output doesn&apos;t include function field (merged branch_4x r1571559)&lt;/p&gt;</comment>
                            <comment id="13945461" author="jira-bot" created="Mon, 24 Mar 2014 18:20:00 +0000"  >&lt;p&gt;Commit 1580967 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1580967&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1580967&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5423&quot; title=&quot;CSV output doesn&amp;#39;t include function field&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5423&quot;&gt;&lt;del&gt;SOLR-5423&lt;/del&gt;&lt;/a&gt;: move CHANGES.txt entry to 4.7.1 section&lt;/p&gt;</comment>
                            <comment id="13945465" author="jira-bot" created="Mon, 24 Mar 2014 18:21:34 +0000"  >&lt;p&gt;Commit 1580969 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=steve_rowe&quot; class=&quot;user-hover&quot; rel=&quot;steve_rowe&quot;&gt;steve_rowe&lt;/a&gt; in branch &apos;dev/branches/branch_4x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1580969&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1580969&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-5423&quot; title=&quot;CSV output doesn&amp;#39;t include function field&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-5423&quot;&gt;&lt;del&gt;SOLR-5423&lt;/del&gt;&lt;/a&gt;: move CHANGES.txt entry to 4.7.1 section (merged trunk r1580967)&lt;/p&gt;</comment>
                            <comment id="13957747" author="steve_rowe" created="Wed, 2 Apr 2014 15:03:39 +0000"  >&lt;p&gt;Bulk close 4.7.1 issues&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12431022">SOLR-1298</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12630340" name="SOLR-5423.patch" size="8984" author="sarowe" created="Fri, 21 Feb 2014 17:24:00 +0000"/>
                            <attachment id="12629222" name="SOLR-5423.patch" size="3766" author="arun_mist" created="Sat, 15 Feb 2014 16:01:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>356916</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 33 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1pj2v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>357206</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>