<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:11:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-17587] Prometheus Writer duplicate TYPE information in exposition format</title>
                <link>https://issues.apache.org/jira/browse/SOLR-17587</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Solr&apos;s Prometheus writer duplicates `# TYPE &amp;lt;metric name&amp;gt; &amp;lt;prometheus metric type&amp;gt;` in it&apos;s exposition format for core registry metrics.&lt;/p&gt;

&lt;p&gt;For example this appears twice in it&apos;s output:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
# TYPE solr_metrics_core_average_request_time gauge
solr_metrics_core_average_request_time{category=&lt;span class=&quot;code-quote&quot;&gt;&quot;ADMIN&quot;&lt;/span&gt;,collection=&lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;,core=&lt;span class=&quot;code-quote&quot;&gt;&quot;core_foo_shard9_replica_t351&quot;&lt;/span&gt;,handler=&lt;span class=&quot;code-quote&quot;&gt;&quot;/admin/file&quot;&lt;/span&gt;,replica=&lt;span class=&quot;code-quote&quot;&gt;&quot;replica_t351&quot;&lt;/span&gt;,shard=&lt;span class=&quot;code-quote&quot;&gt;&quot;shard9&quot;&lt;/span&gt;} 0.0 
...
# TYPE solr_metrics_core_average_request_time gauge&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This is technically not allowed per &lt;a href=&quot;https://github.com/prometheus/docs/blob/main/content/docs/instrumenting/exposition_formats.md#:~:text=Only%20one%20TYPE%20line%20may%20exist%20for%20a%20given%20metric%20name.&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Prometheus Exposition format&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This happens because each Dropwizard registry is per core, but for Prometheus compatible exposition format upon exporting, it needs to be 1 registry for all cores on a single host, otherwise there will be duplicate `TYPE` formats even though all metrics are unique for its tags/attributes.&lt;/p&gt;

&lt;p&gt;Funnily enough, prometheus upstream collector does not do this verification and accepts the metrics anyways just fine Solr -&amp;gt; Prometheus -&amp;gt; Grafana.&lt;/p&gt;

&lt;p&gt;But depending on the technologies prometheus exposition verification, this will fail. For example &lt;a href=&quot;https://github.com/influxdata/telegraf/blob/master/plugins/inputs/prometheus/README.md&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Telegraf&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-12-09T16:56:01Z E! [inputs.prometheus] Error in plugin: error reading metrics &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:8983/solr/admin/metrics?wt=prometheus&quot;&lt;/span&gt;: decoding response failed: text format parsing error in line 568: second TYPE line &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; metric name &lt;span class=&quot;code-quote&quot;&gt;&quot;solr_metrics_core_average_request_time&quot;&lt;/span&gt;, or TYPE reported after samples &lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This shouldn&apos;t be a blocker if you are pushing metrics to prometheus collector directly.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13601421">SOLR-17587</key>
            <summary>Prometheus Writer duplicate TYPE information in exposition format</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mbiscocho">Matthew Biscocho</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 9 Dec 2024 18:27:46 +0000</created>
                <updated>Tue, 11 Mar 2025 23:42:56 +0000</updated>
                            <resolved>Fri, 10 Jan 2025 04:54:04 +0000</resolved>
                                    <version>9.7</version>
                                    <fixVersion>9.9</fixVersion>
                    <fixVersion>9.8.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="10800">3h</timespent>
                                <comments>
                            <comment id="17904242" author="JIRAUSER300090" created="Mon, 9 Dec 2024 18:30:41 +0000"  >&lt;p&gt;Working on a fix for this now. Going to try and get a PR out for this soon.&lt;/p&gt;</comment>
                            <comment id="17911324" author="jira-bot" created="Thu, 9 Jan 2025 04:59:12 +0000"  >&lt;p&gt;Commit 796b788ce8567cd21a89d1d58f715b65fda6ecc5 in solr&apos;s branch refs/heads/main from Matthew Biscocho&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=796b788ce85&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=796b788ce85&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17587&quot; title=&quot;Prometheus Writer duplicate TYPE information in exposition format&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17587&quot;&gt;&lt;del&gt;SOLR-17587&lt;/del&gt;&lt;/a&gt;: wt=prometheus fix duplicate TYPE information (#2902)&lt;/p&gt;

&lt;p&gt;Metrics: Prometheus response writer fix for non-compliant exposition format containing duplicate TYPE lines&lt;/p&gt;</comment>
                            <comment id="17911637" author="jira-bot" created="Thu, 9 Jan 2025 20:03:12 +0000"  >&lt;p&gt;Commit 13ba24eab0eec81cb7e6d99961da1144a4a0c44e in solr&apos;s branch refs/heads/branch_9x from Matthew Biscocho&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=13ba24eab0e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=13ba24eab0e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17587&quot; title=&quot;Prometheus Writer duplicate TYPE information in exposition format&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17587&quot;&gt;&lt;del&gt;SOLR-17587&lt;/del&gt;&lt;/a&gt;: wt=prometheus fix duplicate TYPE information  (#3006)&lt;/p&gt;

&lt;p&gt;Metrics: Prometheus response writer fix for non-compliant exposition format containing duplicate TYPE lines&lt;/p&gt;

&lt;p&gt;9x backport of main:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17587&quot; title=&quot;Prometheus Writer duplicate TYPE information in exposition format&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17587&quot;&gt;&lt;del&gt;SOLR-17587&lt;/del&gt;&lt;/a&gt;: wt=prometheus fix duplicate TYPE information (#2902)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17911771" author="dsmiley" created="Fri, 10 Jan 2025 04:54:04 +0000"  >&lt;p&gt;Thanks for the contribution Mathew!&lt;/p&gt;</comment>
                            <comment id="17928258" author="jira-bot" created="Wed, 19 Feb 2025 03:58:40 +0000"  >&lt;p&gt;Commit cc2112f93d65eef29881c1efae76db3cbef85cbf in solr&apos;s branch refs/heads/branch_9_8 from Matthew Biscocho&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=cc2112f93d6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=cc2112f93d6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17587&quot; title=&quot;Prometheus Writer duplicate TYPE information in exposition format&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17587&quot;&gt;&lt;del&gt;SOLR-17587&lt;/del&gt;&lt;/a&gt;: wt=prometheus fix duplicate TYPE information  (#3006)&lt;/p&gt;

&lt;p&gt;Metrics: Prometheus response writer fix for non-compliant exposition format containing duplicate TYPE lines&lt;/p&gt;

&lt;p&gt;9x backport of main:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-17587&quot; title=&quot;Prometheus Writer duplicate TYPE information in exposition format&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-17587&quot;&gt;&lt;del&gt;SOLR-17587&lt;/del&gt;&lt;/a&gt;: wt=prometheus fix duplicate TYPE information (#2902)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17934374" author="houston" created="Tue, 11 Mar 2025 23:42:56 +0000"  >&lt;p&gt;Closing after the 9.8.1 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            35 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1t074:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>