<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:03:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-7171] BaseDistributedSearchTestCase.getSolrXml() not used consistently - multiple divergent ways a JettySolrRunner may be inited</title>
                <link>https://issues.apache.org/jira/browse/SOLR-7171</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;As part of &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6349&quot; title=&quot;LocalParams for enabling/disabling individual stats&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6349&quot;&gt;&lt;del&gt;SOLR-6349&lt;/del&gt;&lt;/a&gt;, i wanted to take advantage of the new features in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7147&quot; title=&quot;Introduce new TrackingShardHandlerFactory for monitoring what requests are sent to shards during tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7147&quot;&gt;&lt;del&gt;SOLR-7147&lt;/del&gt;&lt;/a&gt; to inspect shard requests in TestDistributedSearch, but even though i added a proper override of getSolrXml...&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  @Override
  &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getSolrXml() {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;solr-trackingshardhandler.xml&quot;&lt;/span&gt;; 
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;...that value was being ignored, and i was never getting an instance of TrackingShardHandlerFactory.&lt;/p&gt;

&lt;p&gt;I poked around a bit and confirmed that getSolrXml() is used by &quot;setupJettySolrHome(File)&quot; but that method is never called by BaseDistributedSearchTestCase - it&apos;s only called in framework subclasses like AbstractDistribZkTestBase and AbstractFullDistribZkTestBase.  Instead, for simple subclasses of BaseDistributedSearchTestCase the jetty instances seem to be coming from createServers(int)&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;I don&apos;t really understand why there are so many diff ways for a shard instance to be inited, and presumably that should be refactored? .. but a more immediate concern is that subclasses of BaseDistributedSearchTestCase which attempt to override the solr.xml file used can&apos;t (unless they are actually a subclass of AbstractDistribZkTestBase of AbstractFullDistribZkTestBase)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12778070">SOLR-7171</key>
            <summary>BaseDistributedSearchTestCase.getSolrXml() not used consistently - multiple divergent ways a JettySolrRunner may be inited</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="hossman">Chris M. Hostetter</reporter>
                        <labels>
                    </labels>
                <created>Thu, 26 Feb 2015 23:57:47 +0000</created>
                <updated>Mon, 9 May 2016 18:54:07 +0000</updated>
                            <resolved>Mon, 2 Mar 2015 20:41:58 +0000</resolved>
                                                    <fixVersion>5.1</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14340843" author="hossman" created="Fri, 27 Feb 2015 21:29:31 +0000"  >&lt;p&gt;here&apos;s a patch i&apos;m currently hammering on ... doesn&apos;t completley eliminate all the code/logic duplication, but at least gets us consistently using getSolrXml() (as far as i can tell)&lt;/p&gt;

&lt;p&gt;Part of making this work, was to change &lt;tt&gt;createControlJetty()&lt;/tt&gt; and &lt;tt&gt;createServers(int numShards)&lt;/tt&gt; to clone the &lt;tt&gt;getSolrHome()&lt;/tt&gt; dir ... previously (if you subclassed BaseDistributedSearchTestCase) these methods would just re-use the same &lt;tt&gt;getSolrHome()&lt;/tt&gt; dir for all the jetty instances, and only override the cores &amp;amp; data dirs.&lt;/p&gt;

&lt;p&gt;Not sure if folks have any strong opinion against this?  it seems like a &quot;fix&quot; to the previous awkward hoops, and makes these simple distrib test work more like the cloud tests .. but it would certainly be &lt;em&gt;possible&lt;/em&gt; to add more awkwards hoops to only clone &lt;tt&gt;getSolrHome()&lt;/tt&gt; in the event that we need to override the solr.xml.&lt;/p&gt;</comment>
                            <comment id="14340991" author="hossman" created="Fri, 27 Feb 2015 23:07:21 +0000"  >
&lt;p&gt;the previous patch broke &lt;tt&gt;DistributedClusteringComponentTest&lt;/tt&gt; - which is evidently the only contrib test we have that test distributed queries.&lt;/p&gt;

&lt;p&gt;Once i got logs enabled for the test, it was clear thatthe problem was that in the contrib test, where &lt;tt&gt;getSolrHome()&lt;/tt&gt; was overridden to point to the contrib test directory with a collection1 that had all the clustering configs enabled, Solr was failing to init because there were do directories under the &lt;tt&gt;coreRootDirectory&lt;/tt&gt; that both had a &lt;tt&gt;core.properties&lt;/tt&gt; claiming they were &lt;tt&gt;collection1&lt;/tt&gt; ... there was the &lt;em&gt;real&lt;/em&gt; collection1 that the test wanted, but there was also an empty &lt;tt&gt;cores&lt;/tt&gt; directory that contained nothing but a &lt;tt&gt;core.properties&lt;/tt&gt; file (claiming to be &lt;tt&gt;name=collection1&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I spent a while trying to figure out how the hell this was working before my patch, before finally giving up &amp;#8211; because whatever it was &lt;em&gt;actually&lt;/em&gt; doing, it seems pretty clear this was some kind of mistake &amp;#8211; the core.properties file being created was directly in a &lt;tt&gt;./cores/&lt;/tt&gt; directory that lookd like it was intended to be the &lt;tt&gt;coreRootDirectory&lt;/tt&gt; &amp;#8211; except the &lt;tt&gt;coreRootDirectory&lt;/tt&gt; was always getting set to be the same as &lt;tt&gt;getSolrHome()&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;In any case: here&apos;s an updated patch where the (previously) odd &lt;tt&gt;./cores/&lt;/tt&gt; directory is no longer created; the (now cloned) &lt;tt&gt;getSolrHome()&lt;/tt&gt; directory is still used as the &lt;tt&gt;coreRootDirectory&lt;/tt&gt;; a &lt;tt&gt;./collection1/core.properties&lt;/tt&gt; file is created if and only if it does not exist.&lt;/p&gt;

&lt;p&gt;This fixes the problem with &lt;tt&gt;DistributedClusteringComponentTest&lt;/tt&gt; in a way that also keeps my &lt;tt&gt;TestSimpleTrackingShardHandler&lt;/tt&gt; working w/o modifications to either &amp;#8211; so hopefully it should work for any end-user subclasses as well.&lt;/p&gt;

&lt;p&gt;Still hammering on the full test suite, but i&apos;d really appreciate it if &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek&quot; class=&quot;user-hover&quot; rel=&quot;romseygeek&quot;&gt;romseygeek&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erickerickson&quot; class=&quot;user-hover&quot; rel=&quot;erickerickson&quot;&gt;erickerickson&lt;/a&gt; could review this since it seems like a lot of this &quot;&lt;tt&gt;./cores/&lt;/tt&gt; dir as collection1&quot; weirdness came about as a result of &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6840&quot; title=&quot;Remove legacy solr.xml mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6840&quot;&gt;&lt;del&gt;SOLR-6840&lt;/del&gt;&lt;/a&gt; (and perhaps &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6902&quot; title=&quot;Use JUnit rules instead of inheritance with distributed Solr tests to allow for multiple tests without the same class&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6902&quot;&gt;&lt;del&gt;SOLR-6902&lt;/del&gt;&lt;/a&gt;? ... not certain)&lt;/p&gt;</comment>
                            <comment id="14341799" author="romseygeek" created="Sat, 28 Feb 2015 22:03:49 +0000"  >&lt;p&gt;Oh God, I spent days trying to refactor this before I gave up and used the hacky &quot;just create a damn core.properties file&quot; solution.  The issue with &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6840&quot; title=&quot;Remove legacy solr.xml mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6840&quot;&gt;&lt;del&gt;SOLR-6840&lt;/del&gt;&lt;/a&gt; was that there were a bunch of solr.xml files that defined a core called collection1, and the tests assumed that this core would exist when they started.  But the new format doesn&apos;t allow for that, so the tests now had to create core.properties files instead.&lt;/p&gt;

&lt;p&gt;Anyway, your fix looks good Hoss.  I like that it makes it explicit that it&apos;s creating a new solr.xml and empty core.&lt;/p&gt;</comment>
                            <comment id="14342441" author="erickerickson" created="Sun, 1 Mar 2015 20:20:24 +0000"  >&lt;p&gt;What Alan said.&lt;/p&gt;

&lt;p&gt;It looks fine to me too. One quick note is that it&apos;s not even necessary (in non-cloud mode at least) for anything to be &lt;em&gt;in&lt;/em&gt; the core.properties file if all the defaults are acceptable, its mere existence is all that&apos;s absolutely required. Then the core name is taken from the directory core.properties is found in, the data dir is expected to be a directory in at the same level as core.properties etc..&lt;/p&gt;

&lt;p&gt;On a side note, it&apos;d be nice, sometime, to get all traces of &quot;collection1&quot; out of there, but that&apos;s not something for the faint of heart, nor should it be conflated with this issue...&lt;/p&gt;</comment>
                            <comment id="14343510" author="jira-bot" created="Mon, 2 Mar 2015 18:10:27 +0000"  >&lt;p&gt;Commit 1663381 from hossman@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1663381&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1663381&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7171&quot; title=&quot;BaseDistributedSearchTestCase.getSolrXml() not used consistently - multiple divergent ways a JettySolrRunner may be inited&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7171&quot;&gt;&lt;del&gt;SOLR-7171&lt;/del&gt;&lt;/a&gt;: BaseDistributedSearchTestCase now clones getSolrHome() for each subclass, and consistently uses getSolrXml()&lt;/p&gt;</comment>
                            <comment id="14343711" author="jira-bot" created="Mon, 2 Mar 2015 20:33:51 +0000"  >&lt;p&gt;Commit 1663421 from hossman@apache.org in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1663421&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1663421&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-7171&quot; title=&quot;BaseDistributedSearchTestCase.getSolrXml() not used consistently - multiple divergent ways a JettySolrRunner may be inited&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-7171&quot;&gt;&lt;del&gt;SOLR-7171&lt;/del&gt;&lt;/a&gt;: BaseDistributedSearchTestCase now clones getSolrHome() for each subclass, and consistently uses getSolrXml() (merge r1663381)&lt;/p&gt;</comment>
                            <comment id="14495227" author="thelabdude" created="Wed, 15 Apr 2015 00:30:09 +0000"  >&lt;p&gt;Bulk close after 5.1 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12701481" name="SOLR-7171.patch" size="10472" author="hossman" created="Fri, 27 Feb 2015 23:07:21 +0000"/>
                            <attachment id="12701455" name="SOLR-7171.patch" size="7387" author="hossman" created="Fri, 27 Feb 2015 21:29:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 32 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i264hz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>