<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:09:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-8295] collapse parser can trigger NPE when a segment has empty DocValues for collapse field (ie: no doc in segment has a value)</title>
                <link>https://issues.apache.org/jira/browse/SOLR-8295</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;When collapsing on a field that doesn&apos;t exist for all documents, the existence of a segment that does not contain any documents that have a value can cause an NPE as the collapse parser assumes the DocValues for a segment will always be non-null.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12913361">SOLR-8295</key>
            <summary>collapse parser can trigger NPE when a segment has empty DocValues for collapse field (ie: no doc in segment has a value)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hossman">Chris M. Hostetter</assignee>
                                    <reporter username="sarowe">Steven Rowe</reporter>
                        <labels>
                    </labels>
                <created>Mon, 16 Nov 2015 16:38:12 +0000</created>
                <updated>Mon, 9 May 2016 18:53:45 +0000</updated>
                            <resolved>Mon, 16 Nov 2015 23:28:51 +0000</resolved>
                                                    <fixVersion>5.4</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15007514" author="hossman" created="Mon, 16 Nov 2015 22:37:11 +0000"  >&lt;p&gt;Updated summary &amp;amp; description to clarify root cause.  &lt;br/&gt;
The underlying bug predates &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6168&quot; title=&quot;enhance collapse QParser so that &amp;quot;group head&amp;quot; documents can be selected by more complex sort options&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6168&quot;&gt;&lt;del&gt;SOLR-6168&lt;/del&gt;&lt;/a&gt;, (i think it has been arround for as long as the collapse parser has existed?) but was uncovered due to random testing added by that issue.&lt;/p&gt;

&lt;p&gt;Initial report...&lt;/p&gt;

&lt;div class=&quot;panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;p&gt;From &lt;a href=&quot;https://builds.apache.org/job/Lucene-Solr-Tests-trunk-Java8/629/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Lucene-Solr-Tests-trunk-Java8/629/&lt;/a&gt; - reproduces for me:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestRandomCollapseQParserPlugin -Dtests.method=testRandomCollpaseWithSort -Dtests.seed=EB40CE4410753BB -Dtests.multiplier=2 -Dtests.slow=true -Dtests.locale=es_PY -Dtests.timezone=Asia/Oral -Dtests.asserts=true -Dtests.file.encoding=US-ASCII
   [junit4] ERROR   11.7s J2 | TestRandomCollapseQParserPlugin.testRandomCollpaseWithSort &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: org.apache.solr.client.solrj.SolrServerException: org.apache.solr.client.solrj.SolrServerException: java.lang.NullPointerException
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([EB40CE4410753BB:B097F2D6AAF6048]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.embedded.EmbeddedSolrServer.request(EmbeddedSolrServer.java:240)
   [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.SolrRequest.process(SolrRequest.java:150)
   [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.SolrClient.query(SolrClient.java:943)
   [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.SolrClient.query(SolrClient.java:958)
   [junit4]    &amp;gt; 	at org.apache.solr.search.TestRandomCollapseQParserPlugin.testRandomCollpaseWithSort(TestRandomCollapseQParserPlugin.java:164)
   [junit4]    &amp;gt; 	at java.lang.Thread.run(Thread.java:745)
   [junit4]    &amp;gt; Caused by: org.apache.solr.client.solrj.SolrServerException: java.lang.NullPointerException
   [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.embedded.EmbeddedSolrServer.checkForExceptions(EmbeddedSolrServer.java:252)
   [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.embedded.EmbeddedSolrServer.request(EmbeddedSolrServer.java:180)
   [junit4]    &amp;gt; 	... 43 more
   [junit4]    &amp;gt; Caused by: java.lang.NullPointerException
   [junit4]    &amp;gt; 	at org.apache.solr.search.CollapsingQParserPlugin$IntFieldValueCollector.collect(CollapsingQParserPlugin.java:1109)
   [junit4]    &amp;gt; 	at org.apache.lucene.search.MatchAllDocsQuery$1$1.score(MatchAllDocsQuery.java:56)
   [junit4]    &amp;gt; 	at org.apache.lucene.search.BulkScorer.score(BulkScorer.java:39)
   [junit4]    &amp;gt; 	at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:670)
   [junit4]    &amp;gt; 	at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:474)
   [junit4]    &amp;gt; 	at org.apache.solr.search.SolrIndexSearcher.buildAndRunCollectorChain(SolrIndexSearcher.java:203)
   [junit4]    &amp;gt; 	at org.apache.solr.search.SolrIndexSearcher.getDocListNC(SolrIndexSearcher.java:1692)
   [junit4]    &amp;gt; 	at org.apache.solr.search.SolrIndexSearcher.getDocListC(SolrIndexSearcher.java:1508)
   [junit4]    &amp;gt; 	at org.apache.solr.search.SolrIndexSearcher.search(SolrIndexSearcher.java:562)
   [junit4]    &amp;gt; 	at org.apache.solr.handler.component.QueryComponent.process(QueryComponent.java:519)
   [junit4]    &amp;gt; 	at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:276)
   [junit4]    &amp;gt; 	at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:151)
   [junit4]    &amp;gt; 	at org.apache.solr.core.SolrCore.execute(SolrCore.java:2079)
   [junit4]    &amp;gt; 	at org.apache.solr.client.solrj.embedded.EmbeddedSolrServer.request(EmbeddedSolrServer.java:179)
   [junit4]    &amp;gt; 	... 43 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15007525" author="hossman" created="Mon, 16 Nov 2015 22:40:00 +0000"  >&lt;p&gt;patch that:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;adds specific tests for this situation that fails&lt;/li&gt;
	&lt;li&gt;improves the error reporting for the randomized test to make it easier to identify what the params were that caused an error&lt;/li&gt;
	&lt;li&gt;fixes all of the above failures by using the helper method DocValues.getNumeric (which returns an empty NumericDocValues object instead of null like IndexReader..getNumericDocValues)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15007533" author="jira-bot" created="Mon, 16 Nov 2015 22:42:26 +0000"  >&lt;p&gt;Commit 1714701 from hossman@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1714701&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1714701&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8295&quot; title=&quot;collapse parser can trigger NPE when a segment has empty DocValues for collapse field (ie: no doc in segment has a value)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8295&quot;&gt;&lt;del&gt;SOLR-8295&lt;/del&gt;&lt;/a&gt;: Fix NPE in collapse QParser when collapse field is missing from all docs in a segment&lt;/p&gt;</comment>
                            <comment id="15007619" author="jira-bot" created="Mon, 16 Nov 2015 23:28:41 +0000"  >&lt;p&gt;Commit 1714709 from hossman@apache.org in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1714709&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1714709&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8295&quot; title=&quot;collapse parser can trigger NPE when a segment has empty DocValues for collapse field (ie: no doc in segment has a value)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8295&quot;&gt;&lt;del&gt;SOLR-8295&lt;/del&gt;&lt;/a&gt;: Fix NPE in collapse QParser when collapse field is missing from all docs in a segment (merge r1714701)&lt;/p&gt;</comment>
                            <comment id="15009170" author="jira-bot" created="Tue, 17 Nov 2015 18:18:06 +0000"  >&lt;p&gt;Commit 1714843 from hossman@apache.org in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1714843&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1714843&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8295&quot; title=&quot;collapse parser can trigger NPE when a segment has empty DocValues for collapse field (ie: no doc in segment has a value)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8295&quot;&gt;&lt;del&gt;SOLR-8295&lt;/del&gt;&lt;/a&gt;: fix buggy test assumption&lt;/p&gt;</comment>
                            <comment id="15009210" author="jira-bot" created="Tue, 17 Nov 2015 18:36:21 +0000"  >&lt;p&gt;Commit 1714848 from hossman@apache.org in branch &apos;dev/branches/branch_5x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1714848&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1714848&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8295&quot; title=&quot;collapse parser can trigger NPE when a segment has empty DocValues for collapse field (ie: no doc in segment has a value)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8295&quot;&gt;&lt;del&gt;SOLR-8295&lt;/del&gt;&lt;/a&gt;: fix buggy test assumption (merge r1714843)&lt;/p&gt;</comment>
                            <comment id="15092768" author="joel.bernstein" created="Mon, 11 Jan 2016 22:03:11 +0000"  >&lt;p&gt;Ah, this is already fixed. I was looking into a bug report today on the users list for 5.3.1. This bug was introduced in the 5x branch when the numeric docValues support was added. I suspect it took a long time to surface because many people are still using the 4x line of code. In the 4x line of code everything was based on a top level field cache which couldn&apos;t have this problem. I&apos;ll report back to the users list about this.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12721235">SOLR-6168</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12772599" name="SOLR-8295.patch" size="13255" author="hossman" created="Mon, 16 Nov 2015 22:40:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 45 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2og8f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>