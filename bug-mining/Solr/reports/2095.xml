<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:56:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-6519] In trunk change Solr&apos;s DirectoryFactory.create method to take LockFactory</title>
                <link>https://issues.apache.org/jira/browse/SOLR-6519</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Because of NIO2 changes and the corresponding workaround, it is impossible now to create a Directory and &quot;hope&quot; that the lock factory directory is not created. Especially if you want some non-standard lock factory, this blows up.&lt;/p&gt;

&lt;p&gt;The problem is: The lock dir is now created in ctor. As workaround I made all factories set NoLockFactory initially through ctor (see &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6518&quot; title=&quot;CachingDirectoryFactory subclasses must init directory with NoLockFactory, because the real lock factory gets set later via injectLockFactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6518&quot;&gt;&lt;del&gt;SOLR-6518&lt;/del&gt;&lt;/a&gt;), but this is just a workaround for incorrect API design.&lt;/p&gt;

&lt;p&gt;In fact the main problem is just stupid: Why does protected CachingDirectoryFactory.create() not take the lock factory? I think its because of backwards compatibility, but with Solr 5.0 we can change this.&lt;/p&gt;

&lt;p&gt;In future we want to make the lock factory non-mutable in Directory, so this is an important change. In addition, injectLockFactory looks horrible, this code is a h&#228;ckidy-hick-hack!&lt;/p&gt;</description>
                <environment></environment>
        <key id="12741373">SOLR-6519</key>
            <summary>In trunk change Solr&apos;s DirectoryFactory.create method to take LockFactory</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="uschindler">Uwe Schindler</assignee>
                                    <reporter username="uschindler">Uwe Schindler</reporter>
                        <labels>
                    </labels>
                <created>Mon, 15 Sep 2014 00:54:09 +0000</created>
                <updated>Mon, 9 May 2016 18:53:52 +0000</updated>
                            <resolved>Wed, 17 Sep 2014 18:31:50 +0000</resolved>
                                                    <fixVersion>5.0</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14133836" author="thetaphi" created="Mon, 15 Sep 2014 12:29:30 +0000"  >&lt;p&gt;Attached is a patch refactoring DirectoryFactory in Solr 5.0:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;injectLockFactory was removed, it was a very ugly hack&lt;/li&gt;
	&lt;li&gt;the abstract create() method now takes a LockFactory instance, that is used to pass to ctor. Some directory implementations may ignore it.&lt;/li&gt;
	&lt;li&gt;I added createLockFactory(9 protected method, that has a default implementation for standard file systems lock factories. It only does not allow HdfsLockFactory, instead throws an Exception. HdfsDirectory ofverrides this method and allows to create one with correct configuration. RAMDirectoryFactory only allows &quot;single&quot; as lock factory, other settings are refused.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Just one Question: If you don&apos;t configure a lock type, it currently falls back to &quot;simple&quot; as default (for backwards compatibility). For Solr 5, we should change this default to &quot;native&quot;. Any comments?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markrmiller%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;markrmiller@gmail.com&quot;&gt;markrmiller@gmail.com&lt;/a&gt;: Can you look at the HDFS stuff, I was not able to test this on Windows.&lt;/p&gt;

&lt;p&gt;All tests pass.&lt;/p&gt;</comment>
                            <comment id="14133860" author="thetaphi" created="Mon, 15 Sep 2014 12:55:38 +0000"  >&lt;p&gt;New patch with more refactorings...&lt;/p&gt;

&lt;p&gt;All test pass. I changed the default lockfactory for FS-based directories to &quot;native&quot;.&lt;/p&gt;</comment>
                            <comment id="14135198" author="thetaphi" created="Tue, 16 Sep 2014 09:38:03 +0000"  >&lt;p&gt;New patch: The last one missed to set the lock factory on HDFSDirectory.&lt;/p&gt;

&lt;p&gt;It&apos;s ready to commit.&lt;/p&gt;</comment>
                            <comment id="14137498" author="jira-bot" created="Wed, 17 Sep 2014 16:30:48 +0000"  >&lt;p&gt;Commit 1625644 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi&quot; class=&quot;user-hover&quot; rel=&quot;thetaphi&quot;&gt;thetaphi&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1625644&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1625644&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6519&quot; title=&quot;In trunk change Solr&amp;#39;s DirectoryFactory.create method to take LockFactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6519&quot;&gt;&lt;del&gt;SOLR-6519&lt;/del&gt;&lt;/a&gt;: Make DirectoryFactory#create() take LockFactory&lt;/p&gt;</comment>
                            <comment id="14137651" author="hossman" created="Wed, 17 Sep 2014 18:00:56 +0000"  >&lt;p&gt;I&apos;m seeing reproducible test failures on trunk that seem related to this change...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=CoreMergeIndexesAdminHandlerTest -Dtests.method=testMergeIndexesCoreAdminHandler -Dtests.seed=A61E329DCBF0FF41 -Dtests.slow=true -Dtests.locale=pt -Dtests.timezone=Pacific/Pago_Pago -Dtests.file.encoding=UTF-8
   [junit4] ERROR   0.05s | CoreMergeIndexesAdminHandlerTest.testMergeIndexesCoreAdminHandler &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: org.apache.solr.common.SolrException: SolrCore &apos;collection1&apos; is not available due to init failure: Unrecognized lockType: single
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([A61E329DCBF0FF41:6374CDE1159B9BFA]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.core.CoreContainer.getCore(CoreContainer.java:745)
   [junit4]    &amp;gt; 	at org.apache.solr.handler.admin.CoreMergeIndexesAdminHandlerTest.testMergeIndexesCoreAdminHandler(CoreMergeIndexesAdminHandlerTest.java:81)
   [junit4]    &amp;gt; 	at java.lang.Thread.run(Thread.java:745)
   [junit4]    &amp;gt; Caused by: org.apache.solr.common.SolrException: Unrecognized lockType: single
   [junit4]    &amp;gt; 	at org.apache.solr.core.SolrCore.&amp;lt;init&amp;gt;(SolrCore.java:889)
   [junit4]    &amp;gt; 	at org.apache.solr.core.SolrCore.&amp;lt;init&amp;gt;(SolrCore.java:651)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14137667" author="hossman" created="Wed, 17 Sep 2014 18:09:40 +0000"  >&lt;p&gt;another seed, full stack...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=CoreMergeIndexesAdminHandlerTest -Dtests.method=testMergeIndexesCoreAdminHandler -Dtests.seed=CD7BE4551EE0F637 -Dtests.slow=true -Dtests.locale=zh_SG -Dtests.timezone=Asia/Calcutta -Dtests.file.encoding=US-ASCII
   [junit4] ERROR   0.05s | CoreMergeIndexesAdminHandlerTest.testMergeIndexesCoreAdminHandler &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: org.apache.solr.common.SolrException: SolrCore &apos;collection1&apos; is not available due to init failure: Unrecognized lockType: single
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([CD7BE4551EE0F637:8111B29C08B928C]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.core.CoreContainer.getCore(CoreContainer.java:745)
   [junit4]    &amp;gt; 	at org.apache.solr.handler.admin.CoreMergeIndexesAdminHandlerTest.testMergeIndexesCoreAdminHandler(CoreMergeIndexesAdminHandlerTest.java:81)
   [junit4]    &amp;gt; 	at java.lang.Thread.run(Thread.java:745)
   [junit4]    &amp;gt; Caused by: org.apache.solr.common.SolrException: Unrecognized lockType: single
   [junit4]    &amp;gt; 	at org.apache.solr.core.SolrCore.&amp;lt;init&amp;gt;(SolrCore.java:889)
   [junit4]    &amp;gt; 	at org.apache.solr.core.SolrCore.&amp;lt;init&amp;gt;(SolrCore.java:651)
   [junit4]    &amp;gt; 	at org.apache.solr.core.CoreContainer.create(CoreContainer.java:491)
   [junit4]    &amp;gt; 	at org.apache.solr.core.CoreContainer$1.call(CoreContainer.java:255)
   [junit4]    &amp;gt; 	at org.apache.solr.core.CoreContainer$1.call(CoreContainer.java:249)
   [junit4]    &amp;gt; 	at java.util.concurrent.FutureTask.run(FutureTask.java:262)
   [junit4]    &amp;gt; 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
   [junit4]    &amp;gt; 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
   [junit4]    &amp;gt; 	... 1 more
   [junit4]    &amp;gt; Caused by: org.apache.solr.common.SolrException: Unrecognized lockType: single
   [junit4]    &amp;gt; 	at org.apache.solr.core.StandardDirectoryFactory.createLockFactory(StandardDirectoryFactory.java:73)
   [junit4]    &amp;gt; 	at org.apache.solr.core.CachingDirectoryFactory.get(CachingDirectoryFactory.java:350)
   [junit4]    &amp;gt; 	at org.apache.solr.core.SolrCore.getNewIndexDir(SolrCore.java:275)
   [junit4]    &amp;gt; 	at org.apache.solr.core.SolrCore.initIndex(SolrCore.java:487)
   [junit4]    &amp;gt; 	at org.apache.solr.core.SolrCore.&amp;lt;init&amp;gt;(SolrCore.java:793)
   [junit4]    &amp;gt; 	... 8 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14137692" author="thetaphi" created="Wed, 17 Sep 2014 18:23:13 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
I know why this happens:&lt;br/&gt;
In the new impl (after removing the hacky) injectLockFactory, I only added the &quot;useful&quot; ones to each DirectoryFactory:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;HDFS only supports &quot;none&quot; or &quot;hdfs&quot;&lt;/li&gt;
	&lt;li&gt;StandardDirectoryFactory only supports &quot;simple&quot;, &quot;native&quot;, &quot;none&quot;&lt;/li&gt;
	&lt;li&gt;RAMDirectoryFactory only supports &quot;single&quot;&lt;/li&gt;
	&lt;li&gt;MockDirectoryFactory ignores the factory completely, it uses what test framework chooses&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I did not know that there was some additional randomization! For me the tests passed - strange. We have 2 opinions:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Add back &quot;single&quot; to StandardDirectoryFactory (which is a bit strange), but Hoss mentioned on IRC, if somebody has a separate directory for every solr instance. It is still risky!&lt;/li&gt;
	&lt;li&gt;Change the randomization&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14137706" author="jira-bot" created="Wed, 17 Sep 2014 18:29:23 +0000"  >&lt;p&gt;Commit 1625724 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi&quot; class=&quot;user-hover&quot; rel=&quot;thetaphi&quot;&gt;thetaphi&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1625724&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1625724&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6519&quot; title=&quot;In trunk change Solr&amp;#39;s DirectoryFactory.create method to take LockFactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6519&quot;&gt;&lt;del&gt;SOLR-6519&lt;/del&gt;&lt;/a&gt;: Add back &quot;single&quot; lock factory type to StandardDirectoryFactory (to prevent test randomization from failing). Should be discussed in separate issue.&lt;/p&gt;</comment>
                            <comment id="14137708" author="thetaphi" created="Wed, 17 Sep 2014 18:30:08 +0000"  >&lt;p&gt;For now I will support &quot;single&quot; again for StandardDirectoryFactory, so tests don&apos;t fail. Its a risky setting, but if we want to keep it for now, I am fine.&lt;/p&gt;

&lt;p&gt;I committed this. I will open anther issue to circulate about &quot;single&quot; vs. disk based directory.&lt;/p&gt;</comment>
                            <comment id="14137713" author="jira-bot" created="Wed, 17 Sep 2014 18:36:13 +0000"  >&lt;p&gt;Commit 1625731 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi&quot; class=&quot;user-hover&quot; rel=&quot;thetaphi&quot;&gt;thetaphi&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1625731&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1625731&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6519&quot; title=&quot;In trunk change Solr&amp;#39;s DirectoryFactory.create method to take LockFactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6519&quot;&gt;&lt;del&gt;SOLR-6519&lt;/del&gt;&lt;/a&gt;: Also allow &quot;single&quot; for HDFS&lt;/p&gt;</comment>
                            <comment id="14332976" author="anshumg" created="Mon, 23 Feb 2015 05:02:54 +0000"  >&lt;p&gt;Bulk close after 5.0 release.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12741616">LUCENE-5953</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                            <outwardlinks description="supercedes">
                                        <issuelink>
            <issuekey id="12741371">SOLR-6518</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12669015" name="SOLR-6519.patch" size="30229" author="uschindler" created="Tue, 16 Sep 2014 09:38:03 +0000"/>
                            <attachment id="12668760" name="SOLR-6519.patch" size="25119" author="uschindler" created="Mon, 15 Sep 2014 12:55:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 39 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2011r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>