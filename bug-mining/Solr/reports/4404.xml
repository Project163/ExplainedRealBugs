<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:42:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-14106] SSL with SOLR_SSL_NEED_CLIENT_AUTH not working since v8.2.0</title>
                <link>https://issues.apache.org/jira/browse/SOLR-14106</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;For a client we use SSL certificate authentication with Solr through the &lt;tt&gt;SOLR_SSL_NEED_CLIENT_AUTH=true&lt;/tt&gt; setting. The client must then prove through a local pem file that it has the correct client certificate.&lt;/p&gt;

&lt;p&gt;This works well until Solr 8.1.1, but fails with Solr 8.2 and also 8.3.1. There has been a Jetty upgrade from from jetty-9.4.14 to jetty-9.4.19 and I see some deprecation warnings in the log of 8.3.1:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;o.e.j.x.XmlConfiguration Deprecated method public void org.eclipse.jetty.util.ssl.SslContextFactory.setWantClientAuth(boolean) in file:///opt/solr-8.3.1/server/etc/jetty-ssl.xml
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I have made a simple reproduction script using Docker to reproduce first the 8.1.1 behaviour that succeeds, then 8.3.1 which fails:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
wget https:&lt;span class=&quot;code-comment&quot;&gt;//www.dropbox.com/s/fkjcez1i5anh42i/tls.tgz
&lt;/span&gt;tar -xvzf tls.tgz
cd tls
./repro.sh
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13275040">SOLR-14106</key>
            <summary>SSL with SOLR_SSL_NEED_CLIENT_AUTH not working since v8.2.0</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="krisden">Kevin Risden</assignee>
                                    <reporter username="janhoy">Jan H&#248;ydahl</reporter>
                        <labels>
                            <label>jetty</label>
                            <label>ssl</label>
                    </labels>
                <created>Tue, 17 Dec 2019 15:20:56 +0000</created>
                <updated>Wed, 9 Feb 2022 17:02:26 +0000</updated>
                            <resolved>Mon, 30 Dec 2019 21:43:39 +0000</resolved>
                                    <version>8.2</version>
                    <version>8.3</version>
                    <version>8.3.1</version>
                    <version>8.4</version>
                                    <fixVersion>8.4.1</fixVersion>
                    <fixVersion>8.5</fixVersion>
                                    <component>Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="16998321" author="janhoy" created="Tue, 17 Dec 2019 15:26:10 +0000"  >&lt;p&gt;Note that even 8.1.1 docker img runs with Java11, so there is no difference there. Only change between the two tests is solr version.&lt;/p&gt;</comment>
                            <comment id="16998572" author="risdenk" created="Tue, 17 Dec 2019 20:48:45 +0000"  >&lt;p&gt;FYI might be caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13541&quot; title=&quot;Upgrade Jetty to 9.4.19.v20190610&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13541&quot;&gt;&lt;del&gt;SOLR-13541&lt;/del&gt;&lt;/a&gt; which is a Jetty upgrade in 8.2.0. &lt;/p&gt;</comment>
                            <comment id="16998576" author="ichattopadhyaya" created="Tue, 17 Dec 2019 21:00:10 +0000"  >&lt;p&gt;Shall we mark this as a 8.4 blocker, downgrade Jetty and request &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpountz&quot; class=&quot;user-hover&quot; rel=&quot;jpountz&quot;&gt;jpountz&lt;/a&gt; for a re-spin?&lt;/p&gt;</comment>
                            <comment id="16998589" author="risdenk" created="Tue, 17 Dec 2019 21:16:21 +0000"  >&lt;p&gt;I have no idea if its safe to roll back the Jetty change. There are a lot of JDK 11+ fixes in Jetty lately. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/eclipse/jetty.project/releases/tag/jetty-9.4.16.v20190411&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/eclipse/jetty.project/releases/tag/jetty-9.4.16.v20190411&lt;/a&gt; introduced the Client/Server difference that might be causing &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14106&quot; title=&quot;SSL with SOLR_SSL_NEED_CLIENT_AUTH not working since v8.2.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14106&quot;&gt;&lt;del&gt;SOLR-14106&lt;/del&gt;&lt;/a&gt; as well.&lt;/p&gt;

&lt;p&gt;The specific change and details are here:&lt;br/&gt;
&lt;a href=&quot;https://github.com/eclipse/jetty.project/issues/3464&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/eclipse/jetty.project/issues/3464&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It would be better to actually fix the issue than try to just revert with a bunch of things linked off of &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13541&quot; title=&quot;Upgrade Jetty to 9.4.19.v20190610&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13541&quot;&gt;&lt;del&gt;SOLR-13541&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16998595" author="risdenk" created="Tue, 17 Dec 2019 21:18:48 +0000"  >&lt;p&gt;For client auth, most likely looks like running into &lt;a href=&quot;https://github.com/eclipse/jetty.project/issues/3554&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/eclipse/jetty.project/issues/3554&lt;/a&gt; where using the .Server() option is more correct anyway. I&apos;ll see what is necessary to make this change.&lt;/p&gt;</comment>
                            <comment id="16998597" author="risdenk" created="Tue, 17 Dec 2019 21:22:23 +0000"  >&lt;p&gt;From &lt;a href=&quot;https://github.com/eclipse/jetty.project/blob/jetty-9.4.x/jetty-server/src/main/config/etc/jetty-ssl-context.xml#L10&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/eclipse/jetty.project/blob/jetty-9.4.x/jetty-server/src/main/config/etc/jetty-ssl-context.xml#L10&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Looks like we want to set &lt;a href=&quot;https://github.com/apache/lucene-solr/blob/master/solr/server/etc/jetty-ssl.xml#L9:&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/master/solr/server/etc/jetty-ssl.xml#L9:&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;to &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;Configure id=&lt;span class=&quot;code-quote&quot;&gt;&quot;sslContextFactory&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.eclipse.jetty.util.ssl.SslContextFactory$Server&quot;&lt;/span&gt;&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

</comment>
                            <comment id="16998602" author="risdenk" created="Tue, 17 Dec 2019 21:30:52 +0000"  >&lt;p&gt;Here are all the references to SslContextFactory:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
git grep -F org.eclipse.jetty.util.ssl.SslContextFactory | cat
core/src/java/org/apache/solr/client/solrj/embedded/JettySolrRunner.java:&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.eclipse.jetty.util.ssl.SslContextFactory;
core/src/test/org/apache/hadoop/http/HttpServer2.java:&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.eclipse.jetty.util.ssl.SslContextFactory;
server/etc/jetty-ssl.xml:&amp;lt;Configure id=&lt;span class=&quot;code-quote&quot;&gt;&quot;sslContextFactory&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.eclipse.jetty.util.ssl.SslContextFactory$Server&quot;&lt;/span&gt;&amp;gt;
solrj/src/java/org/apache/solr/client/solrj/embedded/SSLConfig.java:&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.eclipse.jetty.util.ssl.SslContextFactory;
solrj/src/java/org/apache/solr/client/solrj/impl/Http2SolrClient.java:&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.eclipse.jetty.util.ssl.SslContextFactory;
test-framework/src/java/org/apache/solr/util/SSLTestConfig.java:&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.eclipse.jetty.util.ssl.SslContextFactory;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16998606" author="risdenk" created="Tue, 17 Dec 2019 21:36:01 +0000"  >&lt;p&gt;Most of the .Client() usage has already been fixed. Looking through the above, there are a few .Server() missing. I&apos;ll address those with this patch. Working on creating and patch and running a test locally.&lt;/p&gt;</comment>
                            <comment id="16998617" author="janhoy" created="Tue, 17 Dec 2019 21:54:01 +0000"  >&lt;p&gt;Thanks for digging Kevin.&lt;/p&gt;

&lt;p&gt;So I checked out branch_8_4 and reverted just that one commit from &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13541&quot; title=&quot;Upgrade Jetty to 9.4.19.v20190610&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13541&quot;&gt;&lt;del&gt;SOLR-13541&lt;/del&gt;&lt;/a&gt; (&lt;a href=&quot;https://github.com/apache/lucene-solr/commit/22fca67bfe3b35c1c6818ed0fcce08086db987c9)&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/commit/22fca67bfe3b35c1c6818ed0fcce08086db987c9)&lt;/a&gt;&#160; and guess what, SSL client auth now started working again...&lt;/p&gt;

&lt;p&gt;Looks like the move to .Server and .Client was not fully completed...&lt;/p&gt;</comment>
                            <comment id="16998624" author="janhoy" created="Tue, 17 Dec 2019 21:58:13 +0000"  >&lt;p&gt;Whether it should be a 8.4 blocker is another question. Given that 8.2.0 has been out since end of July there are likely not too many other serious issues. We can always do a quick 8.4.1.&lt;/p&gt;</comment>
                            <comment id="16998635" author="ichattopadhyaya" created="Tue, 17 Dec 2019 22:24:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;We can always do a quick 8.4.1.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;+1, and thanks for volunteering! This issue seems serious enough to warrant a quick fix.&lt;/p&gt;</comment>
                            <comment id="16998637" author="risdenk" created="Tue, 17 Dec 2019 22:27:06 +0000"  >&lt;p&gt;Sooo this is a interesting from a SAN perspective. Java/Jetty looks to be blowing up if SAN is not supplied.&lt;/p&gt;

&lt;p&gt;generate localhost cert&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
openssl req -x509 -newkey rsa:4096 -sha256 -days 30 -nodes -keyout solr-ssl.key -out solr-ssl.pem -subj &lt;span class=&quot;code-quote&quot;&gt;&apos;/CN=localhost&apos;&lt;/span&gt; -extensions san -config &amp;lt;(echo &lt;span class=&quot;code-quote&quot;&gt;&apos;[req]&apos;&lt;/span&gt;; echo &lt;span class=&quot;code-quote&quot;&gt;&apos;distinguished_name=req&apos;&lt;/span&gt;; echo &lt;span class=&quot;code-quote&quot;&gt;&apos;[san]&apos;&lt;/span&gt;; echo &lt;span class=&quot;code-quote&quot;&gt;&apos;subjectAltName=DNS:localhost&apos;&lt;/span&gt;; echo &lt;span class=&quot;code-quote&quot;&gt;&apos;subjectAltName=IP:127.0.0.1&apos;&lt;/span&gt;;)
openssl pkcs12 -export -in solr-ssl.pem -inkey solr-ssl.key -out solr-ssl.p12 -passout pass:secret
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;then configure Solr ./bin/solr.in.sh&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
SOLR_SSL_KEY_STORE=/Users/krisden/Downloads/tls/cert/solr-ssl.p12
SOLR_SSL_KEY_STORE_PASSWORD=secret
SOLR_SSL_KEY_STORE_TYPE=PKCS12
SOLR_SSL_TRUST_STORE=/Users/krisden/Downloads/tls/cert/solr-ssl.p12
SOLR_SSL_TRUST_STORE_PASSWORD=secret
SOLR_SSL_TRUST_STORE_TYPE=PKCS12

SOLR_SSL_CHECK_PEER_NAME=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
SOLR_SSL_NEED_CLIENT_AUTH=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;

# Avoid IPV6 ip address
SOLR_OPTS=&lt;span class=&quot;code-quote&quot;&gt;&quot;$SOLR_OPTS -Djava.net.preferIPv4Stack=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;

# Debugging
#SOLR_OPTS=&lt;span class=&quot;code-quote&quot;&gt;&quot;$SOLR_OPTS -Djavax.net.debug=all&quot;&lt;/span&gt;
# SOLR_LOG_LEVEL=DEBUG
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then test with the following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
curl -k -i --cert cert/solr-ssl.pem --key cert/solr-ssl.key &lt;span class=&quot;code-quote&quot;&gt;&quot;https:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8983/solr/admin/cores?action=STATUS&quot;&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I need to try to reconcile this with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=janhoy&quot; class=&quot;user-hover&quot; rel=&quot;janhoy&quot;&gt;janhoy&lt;/a&gt;&apos;s example that I started from. I&apos;ll go back and see how 8.2+ works.&lt;/p&gt;</comment>
                            <comment id="16998642" author="risdenk" created="Tue, 17 Dec 2019 22:38:21 +0000"  >&lt;p&gt;The error is:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
javax.net.ssl.SSLHandshakeException: No subject alternative names matching IP address 127.0.0.1 found
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If you don&apos;t have SAN in your certificate. &lt;/p&gt;


&lt;p&gt;I checked w/ &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=janhoy&quot; class=&quot;user-hover&quot; rel=&quot;janhoy&quot;&gt;janhoy&lt;/a&gt;&apos;s example and even after regenerating the certificates with SAN, still need to have .Server() in the right places.&lt;/p&gt;</comment>
                            <comment id="16998647" author="risdenk" created="Tue, 17 Dec 2019 22:41:46 +0000"  >&lt;p&gt;PR &lt;a href=&quot;https://github.com/apache/lucene-solr/pull/1094&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/pull/1094&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I attached a patch too just in case that is easier to review.&lt;/p&gt;</comment>
                            <comment id="16998654" author="risdenk" created="Tue, 17 Dec 2019 22:57:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=janhoy&quot; class=&quot;user-hover&quot; rel=&quot;janhoy&quot;&gt;janhoy&lt;/a&gt; can you check the patch/PR and see if you see any issues? It should also fix &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14105&quot; title=&quot;Http2SolrClient SSL not working in branch_8x&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14105&quot;&gt;&lt;del&gt;SOLR-14105&lt;/del&gt;&lt;/a&gt; at the same time.&lt;/p&gt;</comment>
                            <comment id="16998673" author="janhoy" created="Tue, 17 Dec 2019 23:30:04 +0000"  >&lt;p&gt;See comment in PR. I only tested on master, and I ran into the same &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14105&quot; title=&quot;Http2SolrClient SSL not working in branch_8x&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14105&quot;&gt;&lt;del&gt;SOLR-14105&lt;/del&gt;&lt;/a&gt; issue.&lt;/p&gt;</comment>
                            <comment id="16998678" author="janhoy" created="Tue, 17 Dec 2019 23:42:04 +0000"  >&lt;p&gt;With this change to the PR I get it running:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Index: solr/solrj/src/java/org/apache/solr/client/solrj/impl/Http2SolrClient.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
&amp;lt;+&amp;gt;UTF-8
===================================================================
--- solr/solrj/src/java/org/apache/solr/client/solrj/impl/Http2SolrClient.java	(revision 49a0bd5ebf2a76ff94cf8e322121883ecd19796f)
+++ solr/solrj/src/java/org/apache/solr/client/solrj/impl/Http2SolrClient.java	(date 1576625574674)
@@ -180,13 +180,13 @@
     ThreadPoolExecutor httpClientExecutor = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ExecutorUtil.MDCAwareThreadPoolExecutor(32,
         256, 60, TimeUnit.SECONDS, queue, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SolrjNamedThreadFactory(&lt;span class=&quot;code-quote&quot;&gt;&quot;h2sc&quot;&lt;/span&gt;));
 
-    SslContextFactory sslContextFactory;
+    SslContextFactory.Server sslContextFactory;
     &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; ssl;
     &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (builder.sslConfig == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
       sslContextFactory = getDefaultSslContextFactory();
       ssl = sslContextFactory.getTrustStore() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || sslContextFactory.getTrustStorePath() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
     } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
-      sslContextFactory = builder.sslConfig.createContextFactory();
+      sslContextFactory = (SslContextFactory.Server) builder.sslConfig.createContextFactory();
       ssl = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
     }
 
@@ -921,14 +921,15 @@
     Http2SolrClient.defaultSSLConfig = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
   }
 
-  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; SslContextFactory getDefaultSslContextFactory() {
+  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; SslContextFactory.Server getDefaultSslContextFactory() {
     &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; checkPeerNameStr = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.getProperty(HttpClientUtil.SYS_PROP_CHECK_PEER_NAME);
     &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; sslCheckPeerName = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
     &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (checkPeerNameStr == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;.equalsIgnoreCase(checkPeerNameStr)) {
       sslCheckPeerName = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
     }
 
-    SslContextFactory.Client sslContextFactory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SslContextFactory.Client(!sslCheckPeerName);
+    SslContextFactory.Server sslContextFactory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SslContextFactory.Server();
+    sslContextFactory.setTrustAll(!sslCheckPeerName);
 
     &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; != &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.getProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;javax.net.ssl.keyStore&quot;&lt;/span&gt;)) {
       sslContextFactory.setKeyStorePath
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16998687" author="janhoy" created="Wed, 18 Dec 2019 00:01:46 +0000"  >&lt;p&gt;Also while we&apos;re at it, we can get rid of this deprecation warning&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2019-12-18 00:00:26.698 WARN&#160; (main) [ &#160; ] o.e.j.x.XmlConfiguration Deprecated method public void org.eclipse.jetty.rewrite.handler.RedirectRegexRule.setReplacement(java.lang.String) in file:///Users/janhoy/git/lucene-solr/solr/server/etc/jetty.xml &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;See&#160;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12989052/12989052_deprecation-warning.patch&quot; title=&quot;deprecation-warning.patch attached to SOLR-14106&quot;&gt;deprecation-warning.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="16998690" author="risdenk" created="Wed, 18 Dec 2019 00:13:43 +0000"  >&lt;p&gt;I&apos;ll fix the deprecation warning.&lt;/p&gt;

&lt;p&gt;Regarding the Http2SolrClient change... the class is a client, so why should it be returning a server??? That just seems wrong on so many levels. I&apos;ll take another look but on the surface that makes no sense.&lt;/p&gt;</comment>
                            <comment id="16998697" author="risdenk" created="Wed, 18 Dec 2019 00:25:31 +0000"  >&lt;p&gt;Sigh the whole Http2SolrClient tries to reuse what was originally a server side SslContextFactory. I&apos;ll have to look at it more in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14105&quot; title=&quot;Http2SolrClient SSL not working in branch_8x&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14105&quot;&gt;&lt;del&gt;SOLR-14105&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16998808" author="rcmuir" created="Wed, 18 Dec 2019 04:46:41 +0000"  >&lt;blockquote&gt;
&lt;p&gt;The error is:&lt;/p&gt;

&lt;p&gt;javax.net.ssl.SSLHandshakeException: No subject alternative names matching IP address 127.0.0.1 found&lt;/p&gt;

&lt;p&gt;If you don&apos;t have SAN in your certificate. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;browsers and okhttp and others do the hostname verification this way too. if i remember its because CN is ambiguous whereas SAN declares its type: &lt;a href=&quot;https://groups.google.com/a/chromium.org/forum/#!topic/security-dev/IGT2fLJrAeo&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://groups.google.com/a/chromium.org/forum/#!topic/security-dev/IGT2fLJrAeo&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16998964" author="janhoy" created="Wed, 18 Dec 2019 09:03:00 +0000"  >&lt;p&gt;This proves that the upgrade to jetty 9.4.19 was premature and incomplete. I think the safest action would be to quickly after 8.4.0 release a 8.4.1 with the only change being a revert of &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13541&quot; title=&quot;Upgrade Jetty to 9.4.19.v20190610&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13541&quot;&gt;&lt;del&gt;SOLR-13541&lt;/del&gt;&lt;/a&gt;, i.e. go back to jetty 9.4.14. The revert applies cleanly and works here, need some full test suite runs of course.&lt;/p&gt;

&lt;p&gt;And then the 8.5 release will upgrade to jetty 9.4.24 in one go, including fixing all the Server/Client stuff, replace deprecated methods etc.&lt;/p&gt;

&lt;p&gt;Actually, the project should pay more attention to deprecation warnings. That would have caught this mess during development of &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13541&quot; title=&quot;Upgrade Jetty to 9.4.19.v20190610&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13541&quot;&gt;&lt;del&gt;SOLR-13541&lt;/del&gt;&lt;/a&gt;, because Jetty has been spitting out deprecation warnings ever since 8.2.0 which was a warning sign that the upgrade was not complete. I&apos;ll flag this on the dev list.&lt;/p&gt;</comment>
                            <comment id="16999125" author="risdenk" created="Wed, 18 Dec 2019 12:55:35 +0000"  >&lt;p&gt;Closed &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14105&quot; title=&quot;Http2SolrClient SSL not working in branch_8x&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14105&quot;&gt;&lt;del&gt;SOLR-14105&lt;/del&gt;&lt;/a&gt; and will fix them both here since they are intertwined. Will upload a new patch/PR shortly.&lt;/p&gt;</comment>
                            <comment id="16999132" author="risdenk" created="Wed, 18 Dec 2019 13:01:01 +0000"  >&lt;p&gt;Uploaded new version of the patch and pushed update to PR.&lt;/p&gt;</comment>
                            <comment id="16999406" author="lucenesolrqa" created="Wed, 18 Dec 2019 18:10:33 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;b&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;&lt;/b&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Vote &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Runtime &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Comment &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Prechecks &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; test4tests &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  0m  0s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; The patch appears to include 2 new or modified test files. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; master Compile Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; compile &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m 39s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; master passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Patch Compile Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; compile &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m 34s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; javac &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m 34s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Release audit (RAT) &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m 19s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Check forbidden APIs &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m  9s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Validate source patterns &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m  9s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Other Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt; unit &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt; 45m 41s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt; core in the patch failed. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt; unit &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt;121m  9s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt; solrj in the patch failed. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; unit &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  0m 28s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; test-framework in the patch passed. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt;&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt; &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt;172m 48s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt; &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Reason &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Tests &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Failed junit tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; solr.cloud.ZkFailoverTest &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; solr.cloud.DocValuesNotIndexedTest &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; solr.cloud.api.collections.CollectionTooManyReplicasTest &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; solr.cloud.TestSSLRandomization &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; solr.cloud.LeaderVoteWaitTimeoutTest &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; solr.handler.component.CustomTermsComponentTest &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; solr.cloud.TestExactStatsCacheCloud &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; solr.cloud.DeleteNodeTest &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; solr.handler.TestSystemCollAutoCreate &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; solr.client.solrj.impl.ConcurrentUpdateHttp2SolrClientTest &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; solr.client.solrj.io.stream.MathExpressionTest &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; solr.client.solrj.io.sql.JdbcTest &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Report/Notes &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Issue &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14106&quot; title=&quot;SSL with SOLR_SSL_NEED_CLIENT_AUTH not working since v8.2.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14106&quot;&gt;&lt;del&gt;SOLR-14106&lt;/del&gt;&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Patch URL &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12989104/SOLR-14106.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12989104/SOLR-14106.patch&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Optional Tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  compile  javac  unit  ratsources  checkforbiddenapis  validatesourcepatterns  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; uname &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Linux lucene2-us-west.apache.org 4.4.0-112-generic #135-Ubuntu SMP Fri Jan 19 11:48:36 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Build tool &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; ant &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Personality &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; /home/jenkins/jenkins-slave/workspace/PreCommit-SOLR-Build/sourcedir/dev-tools/test-patch/lucene-solr-yetus-personality.sh &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; git revision &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; master / 56839f6 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; ant &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; version: Apache Ant(TM) version 1.9.6 compiled on July 20 2018 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Default Java &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; LTS &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; unit &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/634/artifact/out/patch-unit-solr_core.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/634/artifact/out/patch-unit-solr_core.txt&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; unit &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/634/artifact/out/patch-unit-solr_solrj.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/634/artifact/out/patch-unit-solr_solrj.txt&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  Test Results &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/634/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/634/testReport/&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; modules &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; C: solr/core solr/server solr/solrj solr/test-framework U: solr &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Console output &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/634/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/634/console&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Powered by &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Apache Yetus 0.7.0   &lt;a href=&quot;http://yetus.apache.org&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://yetus.apache.org&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;p&gt;This message was automatically generated.&lt;/p&gt;
</comment>
                            <comment id="16999664" author="risdenk" created="Thu, 19 Dec 2019 02:02:24 +0000"  >&lt;p&gt;Uploaded a new version that leaves a lot of the Http2Client stuff the way it used to work.&lt;/p&gt;</comment>
                            <comment id="16999853" author="janhoy" created="Thu, 19 Dec 2019 08:54:05 +0000"  >&lt;p&gt;I tested the previous PR and for me it still crashed as before. But I could have missed something. Will try this new one with my client auth setup later today.&lt;/p&gt;</comment>
                            <comment id="17000076" author="janhoy" created="Thu, 19 Dec 2019 13:40:34 +0000"  >&lt;p&gt;So with your latest patch I still get the exception, see &lt;a href=&quot;https://gist.github.com/085cafb645f11eaa2a91bd2114a71692&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/085cafb645f11eaa2a91bd2114a71692&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;That&apos;s why I changed the &lt;tt&gt;createHttpClient()&lt;/tt&gt; method in my patch &lt;a href=&quot;#comment-16998678&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;above&lt;/a&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17000095" author="janhoy" created="Thu, 19 Dec 2019 14:06:12 +0000"  >&lt;p&gt;Others had same problems &lt;a href=&quot;https://github.com/eclipse/jetty.project/issues/4425&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/eclipse/jetty.project/issues/4425&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;HttpShardHandler is not a server, so why does it fail this way?&lt;/p&gt;

&lt;p&gt;I see also &lt;a href=&quot;https://github.com/eclipse/jetty.project/issues/4385&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/eclipse/jetty.project/issues/4385&lt;/a&gt;&#160;related. Here they change the error text to&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&quot;KeyStores with multiple certificates are not supported on the base class %s. (Use %s or %s instead)&quot;,&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&#160;So could it be that since I have more than one cert in the JKS, it is not possible to create a &lt;tt&gt;SslContextFactory.Client&lt;/tt&gt;? Solr is both a client and a server at the same time and both will use the same keystore. Do I understand it correctly that we&apos;d need to provision a different jks for client than for server? Or am I just confused?&lt;/p&gt;</comment>
                            <comment id="17000110" author="risdenk" created="Thu, 19 Dec 2019 14:36:53 +0000"  >&lt;p&gt;Hmmmmm I&apos;ll have to look closer then. Thanks for checking Jan.&lt;/p&gt;</comment>
                            <comment id="17000121" author="janhoy" created="Thu, 19 Dec 2019 14:55:26 +0000"  >&lt;p&gt;My client uses SSL client auth between Solr clients and Solr, and custom plugins inside Solr also reach out to external services that need SSL client auth, so there need to be more than one cert in the keystore.. I thought TLS had built-in handshake to select a certificate based on host or something.&lt;/p&gt;

&lt;p&gt;I just tested with my other keystore that only has 1 cert, and that one works...&lt;/p&gt;

&lt;p&gt;Is it possible to provide different keystores for SslContextFactory.Client and .Server through Jetty configuration? Or do we need to hand code it?&lt;/p&gt;</comment>
                            <comment id="17000139" author="risdenk" created="Thu, 19 Dec 2019 15:37:33 +0000"  >&lt;blockquote&gt;&lt;p&gt;My client uses SSL client auth between Solr clients and Solr, and custom plugins inside Solr also reach out to external services that need SSL client auth, so there need to be more than one cert in the keystore.. I thought TLS had built-in handshake to select a certificate based on host or something.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;In the case above, the client/plugin is trying to reuse the HttpClient that Solr already created? I think it would be cleaner for the plugin to create and use a specific HttpClient configured for its use case?&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;In my head, each client should be identified by one clientAuth certificate. I don&apos;t know of any mechanism that will select a client certificate to present based on the target. So having multiple clientAuth certificates to choose from definitely seems wrong on the client side.&lt;/p&gt;

&lt;p&gt;On the server side, the server needs to present a certificate for the hostname involved. This is SNI where the server side will choose which certificate to serve up to the client. There can be multiple certificates in a keystore on the server side.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;So I think the error message is actually correct. I think the custom plugin needs to have a separate HttpClient instance that is configured with a different keystore. This would avoid having to put multiple clientAuth certificates in the one keystore and reusing the Solr HttpClient.&lt;/p&gt;

&lt;p&gt;PS - I think prior to the recent Jetty changes if I read the issues you linked correctly, that Jetty would just choose one of the clientAuth certificates if there were multiple in the client keystore. At least now Jetty httpclient is saying hey this isn&apos;t what we expected you to be trying to do.&lt;/p&gt;</comment>
                            <comment id="17000145" author="risdenk" created="Thu, 19 Dec 2019 15:53:59 +0000"  >&lt;p&gt;Some references where multiple clientAuth certificates for a single Java httpclient doesn&apos;t really seem to be supported:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/questions/23527426/how-is-the-ssl-client-certificate-chosen-when-there-are-multiple-matching-certif&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://stackoverflow.com/questions/23527426/how-is-the-ssl-client-certificate-chosen-when-there-are-multiple-matching-certif&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/questions/3712366/choosing-ssl-client-certificate-in-java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://stackoverflow.com/questions/3712366/choosing-ssl-client-certificate-in-java&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/questions/57519442/how-to-create-a-pool-of-apache-httpclients-with-varying-ssl-client-auth-certific&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://stackoverflow.com/questions/57519442/how-to-create-a-pool-of-apache-httpclients-with-varying-ssl-client-auth-certific&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;From a quick read of the above, it looks like it might technically be possible to have multiple clientAuth certificates, but most implementations don&apos;t have a good way of dealing with it.&lt;/p&gt;

&lt;p&gt;So yea multiple HttpClients each configured with separate clientAuth keystores I think is the way to go for any external client. &lt;/p&gt;</comment>
                            <comment id="17000198" author="risdenk" created="Thu, 19 Dec 2019 16:48:39 +0000"  >&lt;p&gt;FYI &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rrockenbaugh&quot; class=&quot;user-hover&quot; rel=&quot;rrockenbaugh&quot;&gt;rrockenbaugh&lt;/a&gt; since you reported this on the solr-user mailing list back in September.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://lists.apache.org/thread.html/567d763f389c5e0ce16308f1396de1d2eb14cf91e03a98b68a57d915%40%3Csolr-user.lucene.apache.org%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lists.apache.org/thread.html/567d763f389c5e0ce16308f1396de1d2eb14cf91e03a98b68a57d915%40%3Csolr-user.lucene.apache.org%3E&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17000294" author="lucenesolrqa" created="Thu, 19 Dec 2019 18:41:36 +0000"  >&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;b&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;&lt;/b&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Vote &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Runtime &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Comment &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Prechecks &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; test4tests &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  0m  0s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; The patch appears to include 2 new or modified test files. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; master Compile Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; compile &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m 37s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; master passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Patch Compile Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; compile &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m 38s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; javac &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  1m 38s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Release audit (RAT) &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  0m 28s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Check forbidden APIs &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  0m 18s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; Validate source patterns &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  0m 18s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; the patch passed &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; &lt;font color=&quot;brown&quot;&gt; Other Tests &lt;/font&gt; &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; unit &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  0m 20s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; replicator in the patch passed. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt; unit &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt; 46m 35s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt; core in the patch failed. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; unit &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  5m 37s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; solrj in the patch passed. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; unit &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;  0m 20s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; test-framework in the patch passed. &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt;&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt; &lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt; 58m 39s&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;black&quot;&gt; &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Reason &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Tests &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Failed junit tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; solr.search.FuzzySearchTest &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Report/Notes &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Issue &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14106&quot; title=&quot;SSL with SOLR_SSL_NEED_CLIENT_AUTH not working since v8.2.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14106&quot;&gt;&lt;del&gt;SOLR-14106&lt;/del&gt;&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; JIRA Patch URL &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12989153/SOLR-14106.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12989153/SOLR-14106.patch&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Optional Tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  compile  javac  unit  ratsources  checkforbiddenapis  validatesourcepatterns  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; uname &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Linux lucene1-us-west 4.15.0-54-generic #58-Ubuntu SMP Mon Jun 24 10:55:24 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Build tool &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; ant &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Personality &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; /home/jenkins/jenkins-slave/workspace/PreCommit-SOLR-Build/sourcedir/dev-tools/test-patch/lucene-solr-yetus-personality.sh &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; git revision &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; master / 93585ba1d33 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; ant &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; version: Apache Ant(TM) version 1.10.5 compiled on March 28 2019 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Default Java &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; LTS &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; unit &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/635/artifact/out/patch-unit-solr_core.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/635/artifact/out/patch-unit-solr_core.txt&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  Test Results &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/635/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/635/testReport/&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; modules &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; C: lucene/replicator solr/core solr/server solr/solrj solr/test-framework U: . &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Console output &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SOLR-Build/635/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SOLR-Build/635/console&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Powered by &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Apache Yetus 0.7.0   &lt;a href=&quot;http://yetus.apache.org&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://yetus.apache.org&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;p&gt;This message was automatically generated.&lt;/p&gt;
</comment>
                            <comment id="17000496" author="janhoy" created="Fri, 20 Dec 2019 00:07:37 +0000"  >&lt;p&gt;I backported the fix to branch_8_4 and it actually worked ootb. So I&apos;ll add 8.4.1 as fix-version as well.&lt;/p&gt;</comment>
                            <comment id="17000609" author="jira-bot" created="Fri, 20 Dec 2019 04:18:17 +0000"  >&lt;p&gt;Commit aab3c5faa338e158bcab2fb5f09b309ee455a4c5 in lucene-solr&apos;s branch refs/heads/master from Kevin Risden&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=aab3c5f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=aab3c5f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14106&quot; title=&quot;SSL with SOLR_SSL_NEED_CLIENT_AUTH not working since v8.2.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14106&quot;&gt;&lt;del&gt;SOLR-14106&lt;/del&gt;&lt;/a&gt;: Cleanup Jetty SslContextFactory usage&lt;/p&gt;

&lt;p&gt;Jetty 9.4.16.v20190411 and up introduced separate&lt;br/&gt;
client and server SslContextFactory implementations.&lt;br/&gt;
This split requires the proper use of of&lt;br/&gt;
SslContextFactory in clients and server configs.&lt;/p&gt;

&lt;p&gt;This fixes the following&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;SSL with SOLR_SSL_NEED_CLIENT_AUTH not working since v8.2.0&lt;/li&gt;
	&lt;li&gt;Http2SolrClient SSL not working in branch_8x&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Signed-off-by: Kevin Risden &amp;lt;krisden@apache.org&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17000610" author="jira-bot" created="Fri, 20 Dec 2019 04:19:44 +0000"  >&lt;p&gt;Commit 3f23002456f7b991dd51601e3228ddbc033eb6b7 in lucene-solr&apos;s branch refs/heads/branch_8x from Kevin Risden&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=3f23002&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=3f23002&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14106&quot; title=&quot;SSL with SOLR_SSL_NEED_CLIENT_AUTH not working since v8.2.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14106&quot;&gt;&lt;del&gt;SOLR-14106&lt;/del&gt;&lt;/a&gt;: Cleanup Jetty SslContextFactory usage&lt;/p&gt;

&lt;p&gt;Jetty 9.4.16.v20190411 and up introduced separate&lt;br/&gt;
client and server SslContextFactory implementations.&lt;br/&gt;
This split requires the proper use of of&lt;br/&gt;
SslContextFactory in clients and server configs.&lt;/p&gt;

&lt;p&gt;This fixes the following&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;SSL with SOLR_SSL_NEED_CLIENT_AUTH not working since v8.2.0&lt;/li&gt;
	&lt;li&gt;Http2SolrClient SSL not working in branch_8x&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Signed-off-by: Kevin Risden &amp;lt;krisden@apache.org&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17000611" author="risdenk" created="Fri, 20 Dec 2019 04:24:29 +0000"  >&lt;p&gt;This is currently committed to master and branch_8x for 8.5. It is NOT backported to branch_8_4 yet. The release of 8.4 is ongoing. I emailed Adrien to see when its safe to commit to branch_8_4.&lt;/p&gt;</comment>
                            <comment id="17000735" author="janhoy" created="Fri, 20 Dec 2019 08:56:20 +0000"  >&lt;p&gt;Thanks Kevin, you did a huge job here! If there is an RC3 we should get it in, else I&apos;ll probably volunteer as RM 8.4.1&lt;/p&gt;</comment>
                            <comment id="17000962" author="risdenk" created="Fri, 20 Dec 2019 15:27:45 +0000"  >&lt;p&gt;Yea need to hold off on committing to branch_8_4 right now. If this gets committed to branch_8_4, need to move the changes entires around in master / branch_8x.&lt;/p&gt;</comment>
                            <comment id="17001009" author="jira-bot" created="Fri, 20 Dec 2019 16:38:43 +0000"  >&lt;p&gt;Commit aab3c5faa338e158bcab2fb5f09b309ee455a4c5 in lucene-solr&apos;s branch refs/heads/gradle-master from Kevin Risden&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=aab3c5f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=aab3c5f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14106&quot; title=&quot;SSL with SOLR_SSL_NEED_CLIENT_AUTH not working since v8.2.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14106&quot;&gt;&lt;del&gt;SOLR-14106&lt;/del&gt;&lt;/a&gt;: Cleanup Jetty SslContextFactory usage&lt;/p&gt;

&lt;p&gt;Jetty 9.4.16.v20190411 and up introduced separate&lt;br/&gt;
client and server SslContextFactory implementations.&lt;br/&gt;
This split requires the proper use of of&lt;br/&gt;
SslContextFactory in clients and server configs.&lt;/p&gt;

&lt;p&gt;This fixes the following&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;SSL with SOLR_SSL_NEED_CLIENT_AUTH not working since v8.2.0&lt;/li&gt;
	&lt;li&gt;Http2SolrClient SSL not working in branch_8x&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Signed-off-by: Kevin Risden &amp;lt;krisden@apache.org&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17001287" author="jira-bot" created="Fri, 20 Dec 2019 23:14:42 +0000"  >&lt;p&gt;Commit aab3c5faa338e158bcab2fb5f09b309ee455a4c5 in lucene-solr&apos;s branch refs/heads/jira/&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13984&quot; title=&quot;Solr should run inside a SecurityManager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13984&quot;&gt;&lt;del&gt;SOLR-13984&lt;/del&gt;&lt;/a&gt; from Kevin Risden&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=aab3c5f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=aab3c5f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14106&quot; title=&quot;SSL with SOLR_SSL_NEED_CLIENT_AUTH not working since v8.2.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14106&quot;&gt;&lt;del&gt;SOLR-14106&lt;/del&gt;&lt;/a&gt;: Cleanup Jetty SslContextFactory usage&lt;/p&gt;

&lt;p&gt;Jetty 9.4.16.v20190411 and up introduced separate&lt;br/&gt;
client and server SslContextFactory implementations.&lt;br/&gt;
This split requires the proper use of of&lt;br/&gt;
SslContextFactory in clients and server configs.&lt;/p&gt;

&lt;p&gt;This fixes the following&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;SSL with SOLR_SSL_NEED_CLIENT_AUTH not working since v8.2.0&lt;/li&gt;
	&lt;li&gt;Http2SolrClient SSL not working in branch_8x&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Signed-off-by: Kevin Risden &amp;lt;krisden@apache.org&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17005376" author="jira-bot" created="Mon, 30 Dec 2019 14:59:53 +0000"  >&lt;p&gt;Commit b6ea9919442bbf8ef506434ca668967d2e7cabcf in lucene-solr&apos;s branch refs/heads/branch_8_4 from Kevin Risden&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=b6ea991&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=b6ea991&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14106&quot; title=&quot;SSL with SOLR_SSL_NEED_CLIENT_AUTH not working since v8.2.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14106&quot;&gt;&lt;del&gt;SOLR-14106&lt;/del&gt;&lt;/a&gt;: Cleanup Jetty SslContextFactory usage&lt;/p&gt;

&lt;p&gt;Jetty 9.4.16.v20190411 and up introduced separate&lt;br/&gt;
client and server SslContextFactory implementations.&lt;br/&gt;
This split requires the proper use of of&lt;br/&gt;
SslContextFactory in clients and server configs.&lt;/p&gt;

&lt;p&gt;This fixes the following&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;SSL with SOLR_SSL_NEED_CLIENT_AUTH not working since v8.2.0&lt;/li&gt;
	&lt;li&gt;Http2SolrClient SSL not working in branch_8x&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;(Cherry-picked from 3f23002456f7b991dd51601e3228ddbc033eb6b7)&lt;/p&gt;</comment>
                            <comment id="17005494" author="janhoy" created="Mon, 30 Dec 2019 17:49:27 +0000"  >&lt;p&gt;I merged to branch_8_4 today, only change in cherry-pick is changes entry. You may now resolve this jira.&lt;/p&gt;</comment>
                            <comment id="17005827" author="risdenk" created="Mon, 30 Dec 2019 21:43:40 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=janhoy&quot; class=&quot;user-hover&quot; rel=&quot;janhoy&quot;&gt;janhoy&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17007669" author="janhoy" created="Fri, 3 Jan 2020 18:02:19 +0000"  >&lt;p&gt;This whole issue is fairly complex. I was testing branch_8_4 with this fix merged and I get it working with my sample certificate.&lt;/p&gt;

&lt;p&gt;But then I wanted to test again with my &lt;tt&gt;repo.sh&lt;/tt&gt;&#160;script to validate that the newly released 8.4.0 docker image fails too. But it did not. I was able to do client auth towards 8.4.0. A little digging revealed a difference from my earlier repro tests. As long as I set env.var &lt;tt&gt;SOLR_SSL_CLIENT_HOSTNAME_VERIFICATION=false&lt;/tt&gt; I get it working on both 8.3.1, 8.4.0 (but not 8.2.0 since that env.var was introduced in 8.3.0). Conversely, If I &lt;b&gt;don&apos;t&lt;/b&gt; set the variable (i.e. let it default to &lt;tt&gt;HTTPS&lt;/tt&gt;), then even &lt;tt&gt;branch_8_4&lt;/tt&gt; fails on me.&lt;/p&gt;

&lt;p&gt;This got me confused. I know that this Jira fixes other things and removes deprecations, I was surprised by the findings above. Have not tried to generate a client cert with a proper host name to check this validation yet. I&apos;m not generating certs..&lt;/p&gt;

&lt;p&gt;I discussed this with Kevin in ASF slack today. He&apos;d take another look.&lt;/p&gt;</comment>
                            <comment id="17007735" author="risdenk" created="Fri, 3 Jan 2020 20:07:21 +0000"  >&lt;p&gt;Ok so looked into this a bit. The split from one ssl context into Server to Client definitely applies here. I need to double check the logic, but it could very well be that right now after this change, SOLR_SSL_CLIENT_HOSTNAME_VERIFICATION doesn&apos;t work correctly anymore.&lt;/p&gt;

&lt;p&gt;When Jetty Server ssl context is used, endpoint verification is forced to be null. It doesn&apos;t make sense on the server side. &lt;/p&gt;

&lt;p&gt;When Jetty Client ssl context is used, endpoint verification should be enabled by default and should only be disabled if you don&apos;t want verification. &lt;/p&gt;

&lt;p&gt;So what this means is we need to slightly change how SOLR_SSL_CLIENT_HOSTNAME_VERIFICATION is implemented to apply only to the client ssl context it looks like. I opened &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-14163&quot; title=&quot;SOLR_SSL_CLIENT_HOSTNAME_VERIFICATION needs to work with Jetty server/client SSL contexts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-14163&quot;&gt;&lt;del&gt;SOLR-14163&lt;/del&gt;&lt;/a&gt; for this.&lt;/p&gt;

&lt;p&gt;References:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/eclipse/jetty.project/issues/3454&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/eclipse/jetty.project/issues/3454&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/eclipse/jetty.project/issues/3633&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/eclipse/jetty.project/issues/3633&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310060">
                    <name>Container</name>
                                            <outwardlinks description="contains">
                                        <issuelink>
            <issuekey id="13275030">SOLR-14105</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13275257">SOLR-14111</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13277422">SOLR-14163</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13239076">SOLR-13541</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13427469">SOLR-15999</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12989153" name="SOLR-14106.patch" size="10841" author="krisden" created="Thu, 19 Dec 2019 02:00:25 +0000"/>
                            <attachment id="12989104" name="SOLR-14106.patch" size="20567" author="krisden" created="Wed, 18 Dec 2019 13:00:11 +0000"/>
                            <attachment id="12989046" name="SOLR-14106.patch" size="3256" author="krisden" created="Tue, 17 Dec 2019 22:41:00 +0000"/>
                            <attachment id="12989052" name="deprecation-warning.patch" size="622" author="janhoy" created="Wed, 18 Dec 2019 00:01:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 45 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z09rk8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>