<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:52:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-16363] DirectUpdateHandler2 should not throw UnknownFormatConversionException</title>
                <link>https://issues.apache.org/jira/browse/SOLR-16363</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;In certain situation, to handle IllegalArgumentException while adding doc to solr is linked below&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/8.11.2/solr/core/src/java/org/apache/solr/update/DirectUpdateHandler2.java#L250&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/blob/releases/lucene-solr/8.11.2/solr/core/src/java/org/apache/solr/update/DirectUpdateHandler2.java#L249&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;EDIT: Adding Code piece for current main branch: &lt;a href=&quot;https://github.com/apache/solr/blob/main/solr/core/src/java/org/apache/solr/update/DirectUpdateHandler2.java#L314&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/solr/blob/main/solr/core/src/java/org/apache/solr/update/DirectUpdateHandler2.java#L314&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This can be problematic if IllegalArgumentException (of the following format) is thrown during processing of docs (in my case it was via Filters to URL-Decode a string)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#160;java.lang.IllegalArgumentException: URLDecoder: Illegal hex characters in escape (%) pattern - Error at index 0 in: &lt;span class=&quot;code-quote&quot;&gt;&quot;sy&quot;&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The &lt;em&gt;iae.getMessage()&lt;/em&gt; in this case contains &quot;&lt;b&gt;%)&lt;/b&gt;&quot; which conflicts with String.format which would further throw&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.util.UnknownFormatConversionException: Conversion = &lt;span class=&quot;code-quote&quot;&gt;&apos;)&apos;&lt;/span&gt;
&#160; &#160; &#160; &#160; at java.util.Formatter.checkText(Unknown Source) ~[?:?]
&#160; &#160; &#160; &#160; at java.util.Formatter.parse(Unknown Source) ~[?:?]
&#160; &#160; &#160; &#160; at java.util.Formatter.format(Unknown Source) ~[?:?]
&#160; &#160; &#160; &#160; at java.util.Formatter.format(Unknown Source) ~[?:?]
&#160; &#160; &#160; &#160; at java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.format(Unknown Source) ~[?:?]
  &#160; &#160; &#160; at org.apache.solr.update.DirectUpdateHandler2.addDoc(DirectUpdateHandler2.java:249)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This particular exception is not caught and as a result the BAD_REQUEST was never returned to the client along with failure point in the chain.&lt;/p&gt;

&lt;p&gt;The ticket is a proposal to make this more robust i.e., in this particular situation either getMessage() could replaceAll &quot;%&quot; or perhaps another try?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13479389">SOLR-16363</key>
            <summary>DirectUpdateHandler2 should not throw UnknownFormatConversionException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="krisden">Kevin Risden</assignee>
                                    <reporter username="averma">Aman Verma</reporter>
                        <labels>
                    </labels>
                <created>Wed, 31 Aug 2022 01:22:10 +0000</created>
                <updated>Fri, 17 Oct 2025 20:04:58 +0000</updated>
                            <resolved>Wed, 26 Oct 2022 02:43:54 +0000</resolved>
                                    <version>9.0</version>
                    <version>8.11.2</version>
                    <version>9.1</version>
                                    <fixVersion>9.2</fixVersion>
                    <fixVersion>10.0</fixVersion>
                                    <component>UpdateRequestProcessors</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="5400">1.5h</timespent>
                                <comments>
                            <comment id="17622460" author="risdenk" created="Fri, 21 Oct 2022 19:55:36 +0000"  >&lt;p&gt;This looks valid. need to do something like `.replace(&quot;%&quot;, &quot;%%&quot;);` on the message string. We should check the rest of the Solr codebase for similar issues. String.format is used in a bunch of places :/&lt;/p&gt;</comment>
                            <comment id="17623541" author="risdenk" created="Tue, 25 Oct 2022 03:35:30 +0000"  >&lt;p&gt;Ah so this is the only place in Solr code based on Intellij analysis that uses String concatenation in a String.format call. This shouldn&apos;t be an issue if the String.format was used properly. I&apos;m putting up a PR soon.&lt;/p&gt;</comment>
                            <comment id="17623839" author="risdenk" created="Tue, 25 Oct 2022 13:48:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=averma&quot; class=&quot;user-hover&quot; rel=&quot;averma&quot;&gt;averma&lt;/a&gt; what request processors were you using? one of the built in ones listed here? &lt;a href=&quot;https://solr.apache.org/guide/solr/latest/configuration-guide/update-request-processors.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://solr.apache.org/guide/solr/latest/configuration-guide/update-request-processors.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;m trying to write a test for this and not sure how you ended up getting IllegalArgumentException thrown in the first place &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17623876" author="JIRAUSER295167" created="Tue, 25 Oct 2022 14:38:41 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krisden&quot; class=&quot;user-hover&quot; rel=&quot;krisden&quot;&gt;krisden&lt;/a&gt;&#160; Thanks to taking it up. We are using a custom UpdateRequestHandler. For us, it was the solr.TextField incoming field where we had analyzer for index to &quot;URL-decode the string&quot;. The decoding was failing because the inbound string sometimes was like &quot;cmd.exe /c echo jj1 &amp;gt; %SystemDrive%\temp\jjj.txt&quot; (The URLDecoder did not like that &#8211; a bug in our implementation here, however, the stacktrace like you see was deceiving). On receiving /update with this field containing strings that could not be URLDecoded, we would fail to addDocs().&lt;/p&gt;

&lt;p&gt;As our bug fix, we ended up manipulating inbound string similar to following (i.e., replace what could impact URLDecoding).&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; s2 = s.replaceAll(&lt;span class=&quot;code-quote&quot;&gt;&quot;%(?![0-9a-fA-F]\{2})&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;%25&quot;&lt;/span&gt;);
 s2 = s2.replaceAll(&lt;span class=&quot;code-quote&quot;&gt;&quot;\\+&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;%2B&quot;&lt;/span&gt;);
 &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; decodedText = URLDecoder.decode(s2, &lt;span class=&quot;code-quote&quot;&gt;&quot;utf-8&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17623888" author="risdenk" created="Tue, 25 Oct 2022 15:00:25 +0000"  >&lt;p&gt;Ah thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=averma&quot; class=&quot;user-hover&quot; rel=&quot;averma&quot;&gt;averma&lt;/a&gt; - based on digging through the code base was able to find a path that calls this without custom code. See &lt;a href=&quot;https://github.com/apache/solr/pull/1121&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/solr/pull/1121&lt;/a&gt; with added test.&lt;/p&gt;</comment>
                            <comment id="17623889" author="JIRAUSER295167" created="Tue, 25 Oct 2022 15:05:47 +0000"  >&lt;p&gt;Awesome, looks clean, Thank you.&#160;&lt;/p&gt;</comment>
                            <comment id="17623934" author="jira-bot" created="Tue, 25 Oct 2022 17:04:04 +0000"  >&lt;p&gt;Commit ff494dd12b14e0f5ea40c3011a2da146250f0f4f in solr&apos;s branch refs/heads/main from Kevin Risden&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=ff494dd12b1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=ff494dd12b1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16363&quot; title=&quot;DirectUpdateHandler2 should not throw UnknownFormatConversionException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16363&quot;&gt;&lt;del&gt;SOLR-16363&lt;/del&gt;&lt;/a&gt;: DirectUpdateHandler2 should not throw UnknownFormatConversionException (#1121)&lt;/p&gt;
</comment>
                            <comment id="17624142" author="jira-bot" created="Wed, 26 Oct 2022 02:35:12 +0000"  >&lt;p&gt;Commit 57719fedef7148c311b07c8ac246e98268ab9707 in solr&apos;s branch refs/heads/main from Kevin Risden&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=57719fedef7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=57719fedef7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16363&quot; title=&quot;DirectUpdateHandler2 should not throw UnknownFormatConversionException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16363&quot;&gt;&lt;del&gt;SOLR-16363&lt;/del&gt;&lt;/a&gt;: DirectUpdateHandler2 remove String.format from error logging (#1124)&lt;/p&gt;
</comment>
                            <comment id="17624146" author="risdenk" created="Wed, 26 Oct 2022 02:43:54 +0000"  >&lt;p&gt;Thanks for the nice error report &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=averma&quot; class=&quot;user-hover&quot; rel=&quot;averma&quot;&gt;averma&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17624147" author="jira-bot" created="Wed, 26 Oct 2022 02:44:02 +0000"  >&lt;p&gt;Commit b4afb37e1abcb24a2910f41e55fddcf6d5459586 in solr&apos;s branch refs/heads/branch_9x from Kevin Risden&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=b4afb37e1ab&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=b4afb37e1ab&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16363&quot; title=&quot;DirectUpdateHandler2 should not throw UnknownFormatConversionException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16363&quot;&gt;&lt;del&gt;SOLR-16363&lt;/del&gt;&lt;/a&gt;: DirectUpdateHandler2 should not throw UnknownFormatConversionException (#1121)&lt;/p&gt;
</comment>
                            <comment id="17624148" author="jira-bot" created="Wed, 26 Oct 2022 02:44:02 +0000"  >&lt;p&gt;Commit fd55c602a85ba259e58b25a3068e41ce40b9a79e in solr&apos;s branch refs/heads/branch_9x from Kevin Risden&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=fd55c602a85&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=fd55c602a85&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-16363&quot; title=&quot;DirectUpdateHandler2 should not throw UnknownFormatConversionException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-16363&quot;&gt;&lt;del&gt;SOLR-16363&lt;/del&gt;&lt;/a&gt;: DirectUpdateHandler2 remove String.format from error logging (#1124)&lt;/p&gt;
</comment>
                            <comment id="17705529" author="houston" created="Mon, 27 Mar 2023 18:04:16 +0000"  >&lt;p&gt;Closing after the 9.2.0 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 33 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z18720:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>