<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:29:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-11078] Solr query performance degradation since Solr 6.4.2</title>
                <link>https://issues.apache.org/jira/browse/SOLR-11078</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;We are currently running 2 separate Solr servers - refer to screenshots:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;zasolrm02 is running on Solr 6.4.2&lt;/li&gt;
	&lt;li&gt;zasolrm03 is running on Solr 6.6.0&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Both servers have the same OS / JVM configuration and are using their own indexes. We round-robin load-balance through our Tomcats and notice that Since Solr 6.4.2 performance has dropped. We have two indices per server &quot;searchsuggestions&quot; and &quot;tradesearch&quot;. There is a noticeable drop in performance since Solr 6.4.2.&lt;/p&gt;

&lt;p&gt;I am not sure if this is perhaps related to metric collation or other underlying changes. I am not sure if other high transaction users have noticed similar issues.&lt;/p&gt;


&lt;p&gt;&lt;b&gt;1) zasolrm03 (6.6.0) is almost twice as slow on the tradesearch index:&lt;/b&gt;&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12877239/12877239_compare-6.4.2-6.6.0.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;2) This is also visible in the searchsuggestion index:&lt;/b&gt;&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12877240/12877240_screenshot-1.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;3) The Tradesearch index shows the biggest difference:&lt;/b&gt;&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12877241/12877241_screenshot-2.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;
</description>
                <environment>&lt;ul&gt;
	&lt;li&gt;CentOS 7.3 (Linux zasolrm03 3.10.0-514.26.2.el7.x86_64 #1 SMP Tue Jul 4 15:04:05 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux)&lt;/li&gt;
	&lt;li&gt;Java HotSpot(TM) 64-Bit Server VM (build 25.121-b13, mixed mode)&lt;/li&gt;
	&lt;li&gt;4 CPU, 10GB RAM&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Running Solr 6.6.0 with the following JVM settings:&lt;br/&gt;
java -server -Xms4G -Xmx4G -XX:NewRatio=3 -XX:SurvivorRatio=4 -XX:TargetSurvivorRatio=90 -XX:MaxTenuringThreshold=8 -XX:+UseConcMarkSweepGC -XX:+UseParNewGC -XX:ConcGCThreads=4 -XX:ParallelGCThreads=4 -XX:+CMSScavengeBeforeRemark -XX:PretenureSizeThreshold=64m -XX:+UseCMSInitiatingOccupancyOnly -XX:CMSInitiatingOccupancyFraction=50 -XX:CMSMaxAbortablePrecleanTime=6000 -XX:+CMSParallelRemarkEnabled -XX:+ParallelRefProcEnabled -verbose:gc -XX:+PrintHeapAtGC -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCTimeStamps -XX:+PrintTenuringDistribution -XX:+PrintGCApplicationStoppedTime -Xloggc:/home/prodza/solrserver/../logs/solr_gc.log -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles=9 -XX:GCLogFileSize=20M -Dsolr.log.dir=/home/prodza/solrserver/../logs -Djetty.port=8983 -DSTOP.PORT=7983 -DSTOP.KEY=solrrocks -Duser.timezone=SAST -Djetty.home=/home/prodza/solrserver/server -Dsolr.solr.home=/home/prodza/solrserver/../solr -Dsolr.install.dir=/home/prodza/solrserver -Dlog4j.configuration=&lt;a href=&quot;file:/home/prodza/solrserver/../config/log4j.properties&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:/home/prodza/solrserver/../config/log4j.properties&lt;/a&gt; -Xss256k -Xss256k -Dsolr.log.muteconsole -XX:OnOutOfMemoryError=/home/prodza/solrserver/bin/oom_solr.sh 8983 /home/prodza/solrserver/../logs -jar start.jar --module=http&lt;/p&gt;</environment>
        <key id="13087096">SOLR-11078</key>
            <summary>Solr query performance degradation since Solr 6.4.2</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="tech@bidorbuy.co.za">bidorbuy</reporter>
                        <labels>
                    </labels>
                <created>Fri, 14 Jul 2017 06:31:13 +0000</created>
                <updated>Sat, 8 Jun 2019 15:24:15 +0000</updated>
                            <resolved>Wed, 8 Aug 2018 20:24:57 +0000</resolved>
                                    <version>6.6</version>
                    <version>7.1</version>
                                                    <component>search</component>
                    <component>Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>20</watches>
                                                                                                                <comments>
                            <comment id="16086934" author="tech@bidorbuy.co.za" created="Fri, 14 Jul 2017 06:41:34 +0000"  >&lt;p&gt;Sample of warnings in log file&lt;/p&gt;</comment>
                            <comment id="16086935" author="tech@bidorbuy.co.za" created="Fri, 14 Jul 2017 06:43:58 +0000"  >&lt;p&gt;Schema and solrconfig of 6.6.0 instance (is identical to our 6.4.2 instance with the difference of the luceneMatchVersion&lt;/p&gt;</comment>
                            <comment id="16235224" author="tech@bidorbuy.co.za" created="Thu, 2 Nov 2017 05:52:53 +0000"  >&lt;p&gt;We have 3 identical production servers. Two are running Solr 6.4.2 where the schema is still using Trie* fields. The 3rd server where we have the performance degradation running any version of Solr since 6.4.2 has now been upgraded to Solr 7.1.0 where Trie*-fields have been changed to *Point-fields. Index has been rebuild and Solr performance is worse compared to Solr 6.4.2.&lt;/p&gt;

&lt;p&gt;All servers are running:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;10 GB RAM, 4 CPUs&lt;/li&gt;
	&lt;li&gt;CentOS 7.3.1611&lt;/li&gt;
	&lt;li&gt;Java HotSpot(TM) 64-Bit Server VM (build 25.121-b13, mixed mode)&lt;/li&gt;
	&lt;li&gt;Solr Heap -Xms/Xmx is set to 4GB. GC tuning as per attached solr.in.sh (the settings are the same between 6.4.2 and 7.1.0)&lt;/li&gt;
	&lt;li&gt;Two Solr indices: tradesearch (5.5m documents and 3,4GB size) and searchsuggestions (2.7m documents and 700MB size)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Switching Solr 7.1.0 into production load:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Load average (via top) shot to 19 and after a few minutes &quot;settled&quot; at 12 (on 6.4.2 it is about 2.2 - 4)&lt;/li&gt;
	&lt;li&gt;Average query time is about 230ms - this is 4 times slower compared to 6.4.2 (on 6.4.2 it is about 50ms)&lt;/li&gt;
	&lt;li&gt;A specific query (we know it is generally slow) runs between 8-10 seconds (on 6.4.2 it would that about 1.3 seconds)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I can switch 7.1.0 into parallel production tests to collate more data. Any help is appreciated.&lt;/p&gt;</comment>
                            <comment id="16235225" author="tech@bidorbuy.co.za" created="Thu, 2 Nov 2017 05:53:38 +0000"  >&lt;p&gt;Config files attached to show 7.1.0 vs 6.4.2 configuration&lt;/p&gt;</comment>
                            <comment id="16235350" author="markus17" created="Thu, 2 Nov 2017 08:09:24 +0000"  >&lt;p&gt;We have observed it too, and immediately went back to Trie* fields! The difference is huge, one of our collections dropped from many hundreds (~600 to 800) QPS to a mere handful.&lt;/p&gt;

&lt;p&gt;7.1.0 is fine, and faster than  6.x. Just don&apos;t use Point for the time being.&lt;/p&gt;</comment>
                            <comment id="16235359" author="tech@bidorbuy.co.za" created="Thu, 2 Nov 2017 08:15:01 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markus17&quot; class=&quot;user-hover&quot; rel=&quot;markus17&quot;&gt;markus17&lt;/a&gt;. I am going to revert schemas back to Trie* fields, rebuild indexes and do another test. I am hoping to provide feedback in 24 hours.&lt;/p&gt;</comment>
                            <comment id="16235815" author="dsmiley" created="Thu, 2 Nov 2017 14:30:03 +0000"  >&lt;p&gt;Are your queries searching for exact values, e.g. &lt;tt&gt;myNumericField:12345&lt;/tt&gt;?  Points are designed for range queries, not tuned for single value lookup.  The Trie fields are efficient at single-value lookups because it has a full-precision encoded term for each input.   If you only search by exact value, then try using StrField (or if you must, Trie with precisionStep=0).  If you need both, then an optimally tuned system will include both StrField and Point.  What Solr lacks is typed numeric variants to StrField (which is a convenience; it&apos;s not going to stop you from meeting your requirements today).  The deprecated Trie fields played double duty as that, configurable with precisionStep for indexing for efficient ranges.  I suspect there&apos;s no such info/advise in the Solr ref guide but I didn&apos;t check.&lt;/p&gt;

&lt;p&gt;In Solr&apos;s future, it&apos;d be awesome if we could configure logical fields in the schema based on our requirements, and then internally it&apos;d add the appropriate index/disk structures to support it.  Today, we are accustomed to mapping one logical input to potentially many Solr fields (using naming conventions, suffixes) for various use-cases (retrieval, keyword search, sorting, lookup, range-query, variations of keyword search (multi-lingual, or toggled options)).&lt;/p&gt;</comment>
                            <comment id="16235991" author="elyograg" created="Thu, 2 Nov 2017 15:50:12 +0000"  >&lt;p&gt;Possibly dumb question:  Can a term be added to Point fields so they have the full capability that Trie has, or would doing that destroy the advantages that led Lucene to deprecate all other numeric types?&lt;/p&gt;</comment>
                            <comment id="16236026" author="erickerickson" created="Thu, 2 Nov 2017 16:08:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt; Any chance you could add that to the docs? I think that would close this JIRA, no?&lt;/p&gt;</comment>
                            <comment id="16236036" author="yseeley@gmail.com" created="Thu, 2 Nov 2017 16:14:44 +0000"  >&lt;p&gt;Seems like deprecation of trie fields may have been premature and we should rethink when to deprecate / remove them given that people are (and will continue to) use them in the 7x line.&lt;/p&gt;</comment>
                            <comment id="16236123" author="dsmiley" created="Thu, 2 Nov 2017 17:01:35 +0000"  >&lt;blockquote&gt;&lt;p&gt;Possibly dumb question: Can a term be added to Point fields so they have the full capability that Trie has&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Not a dumb question Shawn!  From what I can see in Lucene Field &amp;amp; DefaultIndexingChain classes, it appears it&apos;s okay to have a field that both has a terms index and a points index, just as it&apos;s okay for it to have other things (docValues, etc.).  So what we might want to do is index full-precision terms in Solr PointField base class so that it has both. Non-range queries would use the terms index. Certain faceting features, like facet.method=enum could then leverage the terms index as well.  I think this is a good idea!  Of course it should be toggle-able.  &lt;em&gt;I&apos;ll file an issue if people like this idea.&lt;/em&gt;  I wonder how much total overhead there is in adding the terms index.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;David Smiley Any chance you could add that to the docs? I think that would close this JIRA, no?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Docs: Ooookay.  Lets hear back from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tech%40bidorbuy.co.za&quot; class=&quot;user-hover&quot; rel=&quot;tech@bidorbuy.co.za&quot;&gt;tech@bidorbuy.co.za&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markus17&quot; class=&quot;user-hover&quot; rel=&quot;markus17&quot;&gt;markus17&lt;/a&gt; on what their queries were like before closing the issue so that we can be sure we know what the cause is.&lt;/p&gt;</comment>
                            <comment id="16236150" author="markus17" created="Thu, 2 Nov 2017 17:16:21 +0000"  >&lt;p&gt;Hello David, &lt;/p&gt;

&lt;p&gt;The particular index we reverted does range queries, facets, json-facets and value look-ups. Some indexes we haven&apos;t reverted use Point for boosting only. Another index we won&apos;t move to Point does facets.&lt;/p&gt;</comment>
                            <comment id="16236242" author="elyograg" created="Thu, 2 Nov 2017 17:47:03 +0000"  >&lt;blockquote&gt;&lt;p&gt;So what we might want to do is index full-precision terms in Solr PointField base class so that it has both.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If it doesn&apos;t destroy the advanatages, I like that idea.  That would also make point fields usable as uniqueKey, wouldn&apos;t it?&lt;/p&gt;</comment>
                            <comment id="16236296" author="elyograg" created="Thu, 2 Nov 2017 18:09:57 +0000"  >&lt;p&gt;Adding the full-precision terms to increase performance and capability is a good idea, but we do need to think about the situation where somebody has an existing index with a point field that is upgraded to a new release with this capability.  Anything reliant on the new data won&apos;t work correctly on that index.  I would hope for any related error messages to not be cryptic, so that it will be clear that they need to reindex.&lt;/p&gt;</comment>
                            <comment id="16236299" author="jpountz" created="Thu, 2 Nov 2017 18:10:40 +0000"  >&lt;p&gt;Adding points and terms to the same field would work, but also hurt indexing throughput and increase disk usage.&lt;/p&gt;

&lt;p&gt;Maybe we should update recommendations instead so that id fields would use StrField while true numbers would use point fields?&lt;/p&gt;</comment>
                            <comment id="16236792" author="yseeley@gmail.com" created="Thu, 2 Nov 2017 23:12:11 +0000"  >&lt;blockquote&gt;&lt;p&gt;. Some indexes we haven&apos;t reverted use Point for boosting only.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You only need docValues for that (so index should probably be &quot;false&quot;).   When index=true, point fields are added to a BKD index and trie fields add to a full-text index.&lt;/p&gt;</comment>
                            <comment id="16236794" author="yseeley@gmail.com" created="Thu, 2 Nov 2017 23:16:12 +0000"  >&lt;blockquote&gt;&lt;p&gt;Maybe we should update recommendations instead so that id fields would use StrField while true numbers would use point fields?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That would break a few things that expect numeric order (faceting tiebreaks, etc).  There&apos;s no reason not to just use the trie-field method of manipulating the value such that the lexical order is equal to the numeric order.  Range queries would then also still work and people could choose if the BKD overhead is worth it for better range query performance.  For some usecases with smaller numbers of unique numeric values, just using the postings will still be faster anyway. &lt;/p&gt;</comment>
                            <comment id="16237115" author="tech@bidorbuy.co.za" created="Fri, 3 Nov 2017 05:24:22 +0000"  >&lt;p&gt;Just some more feedback - we still need to run a few more tests to get an conclusive answer, but on the surface it does look that &lt;b&gt;Point fields degrade performance over Trie&lt;/b&gt; fields with precision steps.&lt;/p&gt;

&lt;p&gt;On Solr 6.4.2 we used &quot;primitive&quot; fieldTypes without precisionSteps and we also used fieldTypes with precisionSteps - i.e.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;fieldType name=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.TrieIntField&quot;&lt;/span&gt; precisionStep=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; omitNorms=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; positionIncrementGap=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;fieldType name=&lt;span class=&quot;code-quote&quot;&gt;&quot;tint&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.TrieIntField&quot;&lt;/span&gt; precisionStep=&lt;span class=&quot;code-quote&quot;&gt;&quot;8&quot;&lt;/span&gt; omitNorms=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; positionIncrementGap=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We used precisionSteps=&quot;8&quot; in fields where we could have range queries and we used precisionSteps=&quot;0&quot; where fields contained an id or enum.&lt;/p&gt;

&lt;p&gt;When switching to Solr 7.1.0 we migrated those fieldTypes to *Point-definitions - i.e. instead of using &quot;int&quot; and &quot;tint&quot; we created just one definition using Point:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;fieldType name=&lt;span class=&quot;code-quote&quot;&gt;&quot;pint&quot;&lt;/span&gt; class=&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.IntPointField&quot;&lt;/span&gt; docValues=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;/&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Last night we reverted back to the 6.4.2 schema-definition using TrieIntFields with precisionSteps and initial tests looked better. We are now rebuilding the index one more time using Trie-fields with Precision-Step and will run the 7.1.0 Solr server in parallel to the current 6.4.2 in a loadbalanced fashion to get a proper comparison. In preliminary tests it does appear that 7.1.0 using Trie-fields and precision-steps is faster than 7.1.0 with Point-fields.&lt;/p&gt;

&lt;p&gt;We will also revisit our current schema and the way we build queries/facets to perhaps see if we have other issues.&lt;/p&gt;</comment>
                            <comment id="16237239" author="tech@bidorbuy.co.za" created="Fri, 3 Nov 2017 07:55:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpountz&quot; class=&quot;user-hover&quot; rel=&quot;jpountz&quot;&gt;jpountz&lt;/a&gt; could you perhaps point me to Solr documentation where this is explained?&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Maybe we should update recommendations instead so that id fields would use StrField while true numbers would use point fields?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I thought that in Java terms it would be more efficient to use solr.TrieIntField (primitive types) over Strings.&lt;/p&gt;</comment>
                            <comment id="16237257" author="jpountz" created="Fri, 3 Nov 2017 08:18:28 +0000"  >&lt;blockquote&gt;&lt;p&gt;Maybe we should update recommendations instead so that id fields would use StrField while true numbers would use point fields?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tech%40bidorbuy.co.za&quot; class=&quot;user-hover&quot; rel=&quot;tech@bidorbuy.co.za&quot;&gt;tech@bidorbuy.co.za&lt;/a&gt; I made that comment based on the assumption that there is no such recommendation today. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I thought that in Java terms it would be more efficient to use solr.TrieIntField (primitive types) over Strings.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;In that case the high-level types don&apos;t really matter. Both strings and numerics are handled as a byte[] internally for searching, and as a long internally for faceting (we use ordinals to identify strings). The thing here is that trie fields are based on terms, which precompute the result set for every unique term, which makes exact queries fast (my_numeric_field:42) but merging result sets of multiple values expensive (my_numeric_field:&lt;span class=&quot;error&quot;&gt;&amp;#91;100 TO 10000&amp;#93;&lt;/span&gt;) while points do not deduplicate data but organize it in a way that make ranges faster.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;There&apos;s no reason not to just use the trie-field method of manipulating the value such that the lexical order is equal to the numeric order.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Having a StrField variant that would only accepts numbers, use an encoding that preserves order and use numeric doc values sounds good to me as well. We might want to forbid range queries entirely in that case though as they could be very slow.&lt;/p&gt;
</comment>
                            <comment id="16237277" author="tech@bidorbuy.co.za" created="Fri, 3 Nov 2017 08:37:55 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpountz&quot; class=&quot;user-hover&quot; rel=&quot;jpountz&quot;&gt;jpountz&lt;/a&gt; for the explanation. We have now been running Solr 7.1.0 and Solr 6.4.0 loadbalanced for about an hour of production load and I can confirm that response time on 7.1.0 using TrieFields (i.e. the same schema we use on Solr 6.4.0) is about 10-20% faster on Solr 7.1.0.&lt;/p&gt;

&lt;p&gt;Also interesting to note is that on Solr 6.4.0 the load-average sites at 2.26 (4 cores) and Cpu is at 50-73%. On Solr 7.1.0 load-average is at 1.4 and CPU is around 20-30%.&lt;/p&gt;

&lt;p&gt;You can see this in the graph below (zasolrm03 = Solr 7.1.0 / zasolrm02 = Solr 6.4.0) - weswitched zasolrm03/7.1.0 into the load-balancer at 09:44 - hence the initial warmup spike:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12895593/12895593_solr-71-vs-64.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="16237574" author="dsmiley" created="Fri, 3 Nov 2017 13:04:44 +0000"  >&lt;p&gt;@bidorbuy Thanks so much for sharing your real world results, and being willing to try some different configurations.&lt;/p&gt;

&lt;p&gt;I think it would be most helpful to us here if we could focus on the same Solr version (say 7.1) and only vary the schema use of field types.  Because of the many references to 6.4.2 in your past comments, I&apos;m not 100% clear if you have found Points vs Trie (with precisionStep&amp;gt;0) shows Points to win on &lt;em&gt;range queries&lt;/em&gt;.  Based on what I know, I expect Points to be faster at this task, while also using less memory and disk.  If you are finding to the contrary, perhaps &lt;em&gt;some&lt;/em&gt; of your queries are actually doing lookups on these fields sometimes?  Or as Yonik pointed out, perhaps might have extremely low cardinality within the bounds of the range query sometimes (i.e. tight ranges matching few values)?&lt;/p&gt;

&lt;p&gt;For now, I suggest using Trie with precisionStep=0 on fields you only use for lookups (no range queries).  Or use StrField if that suits you; it&apos;s almost the same.&lt;/p&gt;</comment>
                            <comment id="16239384" author="tech@bidorbuy.co.za" created="Sun, 5 Nov 2017 04:20:10 +0000"  >&lt;p&gt;Will will switch 7.1 into full production load tonight and monitor. From the stats over the last two days I can confidently say that 7.1 performs better using the same schema we used since 6.4.0. I think this is important, as I did not have the same level of performance on 6.4.2, 6.5.1 and 6.6.0.&lt;/p&gt;

&lt;p&gt;Our plan is to upgrade our cluster of servers from 6.4.0 to 7.1.0 using the same schema as we use in 6.4.0. Once we have done this, we will revisit the schema.&lt;/p&gt;

&lt;p&gt;My takeway from your suggestions is that we should change Trie* fields to StrField where we only do lookups and change to *Point fields where we do range-queries.&lt;/p&gt;

&lt;p&gt;Is there more documentation available about *Point-types? I could only find Java docs and some info in the solr-user-group but I am unsure what it means from a performance perspective that Point-types do not support FieldCache and as such we need to use doc-values for faceting to be supported.&lt;/p&gt;

&lt;p&gt;We certainly have range queries (as an example price-ranges, or numeric ranges for storage-sizes returned as facets) which would also require faceting.&lt;/p&gt;

&lt;p&gt;One idea we had is to change all non-range fields to StrField (one by one) and measure performance impact and then start switching *Point-fields. I am not sure if there is a better/scientific way to go about this (analysing the query performance is difficult as queries are typically some text-search with filtering/faceting - so not many unique queries where it is easy to show some trends).&lt;/p&gt;</comment>
                            <comment id="16240871" author="dsmiley" created="Mon, 6 Nov 2017 20:53:01 +0000"  >&lt;blockquote&gt;&lt;p&gt;Is there more documentation available about *Point-types?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m not sure.  I&apos;ll update the ref guide after you take the changes for a whirl to confirm what I expect will happen.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I am unsure what it means from a performance perspective that Point-types do not support FieldCache and as such we need to use doc-values for faceting to be supported.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Curious; can you provide a reference to where you&apos;ve read that about the FieldCache?  It&apos;s right but just wanted to see where that advise is; I didn&apos;t notice it in the ref guide.  Any way... I suspect you&apos;ve &lt;em&gt;already&lt;/em&gt; (in 6.x) been using docValues=true on appropriate fields since you didn&apos;t mention to the contrary.  So there&apos;s no change for you in this respect.  Basically, know that Solr needs fast access to values on a doc/field basis for certain non-search features.  Generally, the ideal way to make that available is to set docValues=true on the field.  Alternatively if you don&apos;t, and if the field type supports &quot;uninversion&quot; (Trie fields &amp;amp; StrField do, Point fields don&apos;t) then Solr will use it&apos;s so-called FieldCache which un-inverts the index=true data into memory.  Lets say you weren&apos;t using docValues at all and now you do.  The net perceived change is&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;smaller java heap requirements; this data is accessed off-heap in memory mapped IO instead.  So you still need same RAM roughly but Java GC can have an easier time.&lt;/li&gt;
	&lt;li&gt;better realtime search.  The warmup queries (generally user-configured to run after commit in solrconfig) should be faster to complete if they use faceting, sorting etc. since they won&apos;t need to trigger the uninversion of index structures into memory.  If you don&apos;t have warmup, then the first user&apos;s search query to come along after a commit used to be hit with the uninversion penalty and now it won&apos;t (so faster queries at this 99 percentile).&lt;/li&gt;
	&lt;li&gt;larger disk requirements to hold the docValues data&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;General access performance isn&apos;t necessarily better though; in some cases it has been shown to be worse :-/&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;One idea we had is to change all non-range fields to StrField (one by one) and measure performance impact and then start switching *Point-fields. I am not sure if there is a better/scientific way to go about this (analysing the query performance is difficult as queries are typically some text-search with filtering/faceting - so not many unique queries where it is easy to show some trends).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Benchmarking/analysis can be a real time sink; I suppose what you should do depends on what you hope to get out of it.  Assuming you hope to not use deprecated Trie fields... then yes moving away from them is one goal.  And getting equal or better performance is another goal.  I doubt you need to get any more precise than that unless you are digging deeper to discover why one of those goals isn&apos;t met (gets slower).  As you&apos;ve indicated switching the &quot;non-range&quot; usages to StrField is one step.  My expectation of the result is that it&apos;ll be a non-event.  StrField loses the typed ergonomics of Trie but otherwise should be very similar for non-range use.  I wouldn&apos;t bother changing one field at a time and measuring in-between... that seems like a lot of time; although if you discover some unexpected bad results then you could do this to help deduce which field &amp;amp; query exhibits the problem.  RE the range fields, yep, them from TrieFields to PointFields (all at once) is the next step.  This one may be interesting; hopefully nothing gets worse.  If it&apos;s better than declare success and move on!&lt;/p&gt;</comment>
                            <comment id="16241467" author="dsmiley" created="Tue, 7 Nov 2017 04:28:51 +0000"  >&lt;p&gt;Minor correction: Some Point fields can be uninverted to the FieldCache when docValues isn&apos;t enabled and even then, not always.  Essentially single value ones can, multi-valued ones can&apos;t.  Oddly however, even then it may only work for sorting but not faceting; I&apos;m not certain.  Any way, we recommend docValues=true for these features so it kinda doesn&apos;t matter too much when you can get away without it.&lt;/p&gt;</comment>
                            <comment id="16241563" author="tech@bidorbuy.co.za" created="Tue, 7 Nov 2017 06:14:18 +0000"  >&lt;p&gt;Thanks for the detailed responses &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt;. We have switched 7.1.0 into production about 24 hours ago with full production load and although resource utilisation (compare zasolrm03=7.1.0 vs zasolrm02=6.4.0) is higher, response time on queries and QPS is generally faster/higher:&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12896346/12896346_screenshot-3.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;The above is based on using the 6.4.0 schema with Trie* fields on a 7.1.0 installation. The next step is to rebuild a server running 7.1.0, but then switching to StrFields and *Point-fields as mentioned. This will probably take at least a week before we have results, but I will feed back once I have them.&lt;/p&gt;</comment>
                            <comment id="16241830" author="markus17" created="Tue, 7 Nov 2017 10:58:30 +0000"  >&lt;p&gt;To be clear, what is the official recommendation going to be?&lt;/p&gt;

&lt;p&gt;I have numbers and, intuitively, put them a type representing a number, not a string type. No new user will put numbers in strings. But new users using Point have a good change of a very bad performing search engine.&lt;/p&gt;

&lt;p&gt;Also, if we put numbers in string (docValues=true), can we still use them a numbers in function queries?&lt;/p&gt;</comment>
                            <comment id="16242068" author="dsmiley" created="Tue, 7 Nov 2017 14:12:51 +0000"  >&lt;blockquote&gt;&lt;p&gt;To be clear, what is the official recommendation going to be?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m not going to sugar coat the fact that we have a shortcoming here.  Perhaps, for the moment, there really is no change in recommendation since many users for various reasons simply won&apos;t notice this deficiency with Point fields.  This  becomes more about a performance tip/warning.  It could go in the ref guide... and retroactively we could adjust the upgrade notes in CHANGES.txt for 7.0.  I propose this note in CHANGES.txt for 7.0:&lt;/p&gt;

&lt;p&gt;&quot;All Trie* numeric and date field types have been deprecated in favor of *Point field types.  Point field types are better at range queries (speed, memory, disk), however simple field:value queries underperform relative to Trie.  Either accept this, or continue to use Trie fields, or use StrField. This shortcoming may be addressed in a future release.&quot;&lt;/p&gt;

&lt;p&gt;Similar language cold be added to the ref guide.  And it can be added to the next release announcement text so that people notice.  Does this sound good?  &quot;good&quot; not being you like this newfound revelation of course &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Also, if we put numbers in string (docValues=true), can we still use them a numbers in function queries?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No.&lt;/p&gt;</comment>
                            <comment id="16242096" author="tech@bidorbuy.co.za" created="Tue, 7 Nov 2017 14:28:56 +0000"  >&lt;p&gt;My experience about the CHANGES.TXT (and I typically read them in detail and look at referenced JIRA tasks where I feel that a change could impact us) was that the Trie* change was very vaguely documented - i.e. for me I had:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;All Trie* numeric and date field types have been deprecated in favor of *Point field types.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I struggled finding any reference to what I need to do and what the possible consequences will be. I am not sure if other users would bother changing schemas or adjusting LUCENE_VERSION, but for me I could literally only throw Solr 7.1 against production to see what happens.&lt;/p&gt;

&lt;p&gt;Seeing that Solr 8.0 seems to get rid of Trie* fields, I do think it would be important for adopters / new users to fully understand the impact. Perhaps most users are not Java guys (the thought of changing a primitive integer to a StrField still somehow makes me feel a bit awkward).&lt;/p&gt;</comment>
                            <comment id="16242115" author="yseeley@gmail.com" created="Tue, 7 Nov 2017 14:42:59 +0000"  >&lt;blockquote&gt;&lt;p&gt;however simple field:value queries underperform relative to Trie&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This also has implications for faceting and facet refinement (which look up a whole series of field:value)&lt;br/&gt;
I wonder what the difference is for TermsQuery vs PointInSetQuery... that would be used in fq=field:(val1 val2 val3 val4 ...) type scenarios as well as graph/join queries.&lt;/p&gt;</comment>
                            <comment id="16279297" author="dsmiley" created="Tue, 5 Dec 2017 22:32:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpountz&quot; class=&quot;user-hover&quot; rel=&quot;jpountz&quot;&gt;jpountz&lt;/a&gt; as the RM for 7.2, do you think we could get in a note here to CHANGES.txt and/or the ref guide?  If not at the very least we cold add a notice/warning to the release notes.  I guess the ref-guide change isn&apos;t a blocker for the release artifacts since it&apos;s released separately?&lt;/p&gt;

&lt;p&gt;I suggest in CHANGES.txt I append further information to the first bullet to the &quot;Upgrading from Solr 6.x&quot; section under 7.0.  It&apos;s the same language I suggested a few comments ago but I&apos;ll repeat:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;All Trie* numeric and date field types have been deprecated in favor of *Point field types. Point field types are better at range queries (speed, memory, disk), however simple field:value queries underperform relative to Trie. Either accept this, or continue to use Trie fields, or use StrField. This shortcoming may be addressed in a future release.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I could repeat this in the ref guide, field-types-included-with-solr.adoc&lt;/p&gt;

&lt;p&gt;What do you think of the wording &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;yonik@apache.org&quot;&gt;yonik@apache.org&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="16279312" author="yseeley@gmail.com" created="Tue, 5 Dec 2017 22:46:25 +0000"  >&lt;p&gt;I would either leave out the &quot;or use StrField&quot;, as it&apos;s not a substitute for a numeric field in any general sense.&lt;/p&gt;</comment>
                            <comment id="16280414" author="jira-bot" created="Wed, 6 Dec 2017 16:23:55 +0000"  >&lt;p&gt;Commit d84c92ed113721247938bb88680e01c888b65a77 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d84c92e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d84c92e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11078&quot; title=&quot;Solr query performance degradation since Solr 6.4.2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11078&quot;&gt;&lt;del&gt;SOLR-11078&lt;/del&gt;&lt;/a&gt;: Add note about the trade-off between Point and Trie fields.&lt;/p&gt;</comment>
                            <comment id="16280417" author="jira-bot" created="Wed, 6 Dec 2017 16:25:36 +0000"  >&lt;p&gt;Commit 292b30e697fedcc304981fe00be2537f071cb1e1 in lucene-solr&apos;s branch refs/heads/branch_7x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=292b30e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=292b30e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11078&quot; title=&quot;Solr query performance degradation since Solr 6.4.2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11078&quot;&gt;&lt;del&gt;SOLR-11078&lt;/del&gt;&lt;/a&gt;: Add note about the trade-off between Point and Trie fields.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit d84c92e)&lt;/p&gt;</comment>
                            <comment id="16280422" author="jira-bot" created="Wed, 6 Dec 2017 16:26:36 +0000"  >&lt;p&gt;Commit 12cd2a4352f4851abd88c7e1db7db5a0bd92aaa9 in lucene-solr&apos;s branch refs/heads/branch_7_2 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=12cd2a4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=12cd2a4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11078&quot; title=&quot;Solr query performance degradation since Solr 6.4.2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11078&quot;&gt;&lt;del&gt;SOLR-11078&lt;/del&gt;&lt;/a&gt;: Add note about the trade-off between Point and Trie fields.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 292b30e)&lt;/p&gt;</comment>
                            <comment id="16280457" author="jpountz" created="Wed, 6 Dec 2017 16:40:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;I would either leave out the &quot;or use StrField&quot;, as it&apos;s not a substitute for a numeric field in any general sense.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;To me this was the most important part of the note. When exact queries are performed on a numeric field, this is very often because this field is more of an identifier than a quantity. Users used a number probably because it was a number too in their MySQL database or in theirJava object, but they do not really care about the ordering and would be equally happy with a string.&lt;/p&gt;</comment>
                            <comment id="16280813" author="markus17" created="Wed, 6 Dec 2017 20:04:12 +0000"  >&lt;p&gt;I agree with Yonik, Strings are no substitute for numbers in some or many cases. We have numeric fields that we use for exact queries, ranges and in some cases arithmetic in boosts.&lt;/p&gt;

&lt;p&gt;It would be bad if in the future, with Trie* definitively gone, we would have to index the same value as Point, and as String.&lt;/p&gt;

&lt;p&gt;We know about this, novice users don&apos;t. &lt;/p&gt;</comment>
                            <comment id="16369768" author="sachingoyal" created="Tue, 20 Feb 2018 06:56:56 +0000"  >&lt;p&gt;Do we know why the point fields are less performant when it comes to simple field:value queries?&#160;Following &lt;a href=&quot;https://lucene.apache.org/solr/guide/7_0/spatial-search.html#spatial-search&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this thread&lt;/a&gt;,&#160;it seems that the point-fields are using some sort of &lt;a href=&quot;https://en.wikipedia.org/wiki/K-D-B-tree&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;KD-trees&lt;/a&gt;&#160;and trie-fields use tries. So at a theoretical level, why are the point fields not performing in simple field:value queries, but doing great on the range side? (I did try to read some stuff on KD trees but could not gather much. Hence I am hoping to avoid reading more docs and code myself if someone more knowledgeable than me can share this part).&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Also, when trie-fields were first deprecated in favor of point-fields, what was the thought process at that time? I am just curious to know the initial chain of thought behind point-fields. So any Jira link etc would also be good to link with this issue. It would be good to&#160;link&#160;any performance tests done at that time and perhaps re-visit them?&lt;/p&gt;</comment>
                            <comment id="16369787" author="elyograg" created="Tue, 20 Feb 2018 07:50:28 +0000"  >&lt;blockquote&gt;&lt;p&gt;Also, when trie-fields were first deprecated in favor of point-fields, what was the thought process at that time?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Solr has merely been reacting to realities forced on it by changes in Lucene.&lt;/p&gt;

&lt;p&gt;Points were introduced to Lucene in the 6.x timeframe, I think it was relatively early.  Shortly afterwards, Lucene deprecated the legacy numeric code used by virtually every Lucene-based software in the world up through early 6.x, including Solr.  That legacy numeric code is completely gone from Lucene 7.0 and later.&lt;/p&gt;

&lt;p&gt;Solr was a little bit slow to add support for point field types.  It didn&apos;t happen until late in the 6.x series.&lt;/p&gt;

&lt;p&gt;In 7.0, Solr incorporated the legacy numeric code from Lucene necessary for Trie fields to function, because without it, Solr 7.0 would not have been able to read most existing 6.x indexes.  This is a temporary band-aid, which is expected to be removed in 8.0.  I&apos;m really hoping that we can restore the performance of numeric field searching in some way before 8.0 comes out.  I do not know if the issues with Points can be fixed without reducing the performance of the things Points &lt;b&gt;are&lt;/b&gt; good at.&lt;/p&gt;</comment>
                            <comment id="16369875" author="jpountz" created="Tue, 20 Feb 2018 10:05:54 +0000"  >&lt;blockquote&gt;&lt;p&gt;Do we know why the point fields are less performant when it comes to simple field:value queries?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes. You are right that both the terms dictionary and the BKD tree have a tree-like structure. The important difference is that terms store postings lists on the leaves, while BKD trees store (blocks of) (docId, value) pairs. If you run a query on a single field, BKD trees need to sort the list of matching doc ids in order to return an iterator. If the query matches few documents, this doesn&apos;t matter, but if it matches many documents it does. Also postings include skip data, so if your query is intersected with another query, then Lucene will be able skip sections of the postings that don&apos;t matter. BKD trees don&apos;t have any way to make query execution more efficient with intersections, even though &lt;tt&gt;IndexOrDocValueQuery&lt;/tt&gt; mitigates the issue.&lt;/p&gt;

&lt;p&gt;To be clear, single-value queries are slower with BKD trees, but only if this query matches many documents. If it matches few documents, it&apos;s fast in both cases.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Points were introduced to Lucene in the 6.x timeframe, I think it was relatively early.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Points were introduced in Lucene 6.0, it was the main release highlight with the switch to BM25 by default. They made high-cardinality numeric fields much better: often 30% faster range queries, 70% faster indexing, 60% less disk usage and 80% less memory usage.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Solr has merely been reacting to realities forced on it by changes in Lucene.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Solr could have stayed on legacy numerics, this is something that can be supported on top of Lucene, it doesn&apos;t need to be in Lucene. But in this particular case, I do think that the right decision was made to deprecate trie fields and recommend users to switch to points instead. I hope that Solr will soon stop using other legacy Lucene APIs like SlowCompositeReaderWrapper. This might make faceting a bit slower in some cases, but this would also make Solr perform &lt;em&gt;much&lt;/em&gt; better in the NRT case.&lt;/p&gt;

&lt;p&gt;In my opinion we should just update documentation to say that id/enum fields that never need ranges should use StrField instead. I know it&apos;s not popular (see above comments) but in that case then let&apos;s just fill the gap with a new field, something like NumericIdField, that works exactly like StrField but uses an encoding that preserves the numeric order.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;I do not know if the issues with Points can be fixed without reducing the performance of the things Points are good at.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;One easy way to do this would be to index both with points and terms. But in my opinion this would be wasteful, it&apos;s easier to make the decision when designing the schema of whether a field stores quantities/measures or ids/enums.&lt;/p&gt;

&lt;p&gt;As a final note, some of these slow queries could be mitigated with &lt;tt&gt;IndexOrDocValueQuery&lt;/tt&gt;, maybe we should add support for it in Solr&apos;s point fields? It allows to use doc values rather than points when the query on the BKD tree is not the one that would lead iteration.&lt;/p&gt;</comment>
                            <comment id="16370116" author="jpountz" created="Tue, 20 Feb 2018 14:48:48 +0000"  >&lt;p&gt;Actually Tomas just let me know that Solr already uses IndexOrDocValuesQuery, so there is nothing more to do.&lt;/p&gt;</comment>
                            <comment id="16370239" author="elyograg" created="Tue, 20 Feb 2018 16:33:29 +0000"  >&lt;p&gt;If there are things we can do in Solr to improve the situation, we should absolutely be doing them.  I personally do not know enough about Lucene code writing to do anything.  If I did know enough, I would be doing everything I could to improve it.&lt;/p&gt;</comment>
                            <comment id="16370472" author="sachingoyal" created="Tue, 20 Feb 2018 19:08:40 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpountz&quot; class=&quot;user-hover&quot; rel=&quot;jpountz&quot;&gt;jpountz&lt;/a&gt; for a good detailed reply.&lt;/p&gt;

&lt;p&gt;So it seems that point-fields are great for range-searches and few-document-matching single-field queries.&lt;/p&gt;

&lt;p&gt;What about faceting/pivoting and what about sorting? If there are some insights into their performance with point-fields, that would be great to know as well.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Also, do we know Lucene&apos;s response for this performance hit? If Solr is just catching up to Lucene&apos;s deprecation/adoption of types, then I would imagine them&#160;knowing this already and maybe having some fix or a recommendation?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16370568" author="elyograg" created="Tue, 20 Feb 2018 20:18:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;What about faceting/pivoting and what about sorting? If there are some insights into their performance with point-fields, that would be great to know as well.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;For these operations, the field should have docValues defined for best performance.  This would be the case for any field type &amp;#8211; string, Trie, Point, etc.  At the moment, it&apos;s not possible to enable docValues on a TextField type (the one used in Solr for tokenized terms).  But this is generally not a problem, as that type of field is normally not very useful for facets/groups/sorts.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Also, do we know Lucene&apos;s response for this performance hit?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpountz&quot; class=&quot;user-hover&quot; rel=&quot;jpountz&quot;&gt;jpountz&lt;/a&gt; probably qualifies as somebody who can comment here.  And I think what he wrote does serve as a response, but I would like more detail.  I&apos;m not really familiar with how Solr actually leverages Lucene for its field types.  I have &lt;b&gt;VERY&lt;/b&gt; little understanding of the Lucene API &amp;#8211; have never actually written a program that uses Lucene.  I&apos;m not opposed to learning, but every time I have started descending the rabbit hole, I have found myself getting lost and unable to figure out how it all fits together.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;something like NumericIdField, that works exactly like StrField but uses an encoding that preserves the numeric order.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Adrien, I couldn&apos;t find any info on this. Can you point me at some relevant javadocs, or other documentation?  Hopefully it&apos;s not the old &quot;zero-padded string&quot; idea, which as far as I knew, wasn&apos;t used any more.&lt;/p&gt;</comment>
                            <comment id="16370625" author="thetaphi" created="Tue, 20 Feb 2018 21:32:40 +0000"  >&lt;p&gt;I&apos;d use the good old numericfield encoding. Or create a bytesref with the raw bytes of the long, just applying the usual bitmagic to make negatives sort correct. For floats do the other bitshifts from NunericUtils. There are methods for it.&lt;/p&gt;</comment>
                            <comment id="16390763" author="sachingoyal" created="Thu, 8 Mar 2018 05:05:12 +0000"  >&lt;p&gt;This degradation in query performance can be a big problem with Solr 7 adoption.&lt;/p&gt;

&lt;p&gt;Especially the new-comers to Solr will not know about this and will straight away migrate to other search-engines.&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Would be it good to put back trie-fields in 7.3 release until issue with point-fields is fixed? Point-fields should not be made a default until they are atleast as performant as trie-fields?&lt;/li&gt;
	&lt;li&gt;Secondly, we should link this ticket to the corresponding ticket in Lucene and create one in Lucene if there is none. Because AFAIK, there is nothing much that can be done from the Solr side to fix the point fields.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16390798" author="elyograg" created="Thu, 8 Mar 2018 06:16:12 +0000"  >&lt;blockquote&gt;&lt;p&gt;Would be it good to put back trie-fields in 7.3 release until issue with point-fields is fixed? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Trie fields are already slated to remain available for all 7.x versions.  You can still use them even now.  A deprecation warning is logged when they are used, but it is not an error.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;d use the good old numericfield encoding.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thetaphi&quot; class=&quot;user-hover&quot; rel=&quot;thetaphi&quot;&gt;thetaphi&lt;/a&gt;, I have no idea what&apos;s involved to do this.  Are there already fieldType classes in Solr that do this?  Or would some need to be created?  If it needs to be created, is there something available that shows how to code it, so we can create new types for Solr?&lt;/p&gt;</comment>
                            <comment id="16392390" author="dsmiley" created="Fri, 9 Mar 2018 04:26:14 +0000"  >&lt;p&gt;I filed &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12074&quot; title=&quot;Add numeric typed equivalents to StrField&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12074&quot;&gt;SOLR-12074&lt;/a&gt; (linked to this one).  At this point I think we&apos;re waiting for someone to have the time/motivation to add numeric typed equivalents to StrField.  I signed up to mentor some junior developers (students?) for an event that occurs in about a month so perhaps this may happen then.  We&apos;ll see.&lt;/p&gt;</comment>
                            <comment id="16573813" author="dsmiley" created="Wed, 8 Aug 2018 20:24:57 +0000"  >&lt;p&gt;Closing as Won&apos;t Fix &amp;#8211; that&apos;s the effective reality.  It can be re-opened if appropriate.&lt;/p&gt;</comment>
                            <comment id="16686856" author="dsmiley" created="Wed, 14 Nov 2018 16:50:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpountz&quot; class=&quot;user-hover&quot; rel=&quot;jpountz&quot;&gt;jpountz&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mikemccand&quot; class=&quot;user-hover&quot; rel=&quot;mikemccand&quot;&gt;mikemccand&lt;/a&gt; are you aware of any Lucene benchmarking we have (or had done once and reported somewhere) on the performance difference for exact lookup queries on a Points field compared to the Trie fields?&lt;/p&gt;</comment>
                            <comment id="16686873" author="jpountz" created="Wed, 14 Nov 2018 17:04:45 +0000"  >&lt;p&gt;I&apos;m not aware of such benchmarks, but I&apos;ve had a couple Elasticsearch users who reported slowdowns after we changed numeric fields to be backed by points rather than the inverted index. If your exact query doesn&apos;t match many documents, performance would be mostly the same, but otherwise the fact that points need to collect all doc IDs into an array and sort them when the inverted index has a ready-to-use DISI thanks to postings makes them slower.&lt;/p&gt;</comment>
                            <comment id="16686906" author="tech@bidorbuy.co.za" created="Wed, 14 Nov 2018 17:44:30 +0000"  >&lt;p&gt;Hi all,&lt;/p&gt;

&lt;p&gt;ex CTO from bidorbuy here. I had planned to migrate to 7.5 before I am leaving the company end of November, but other priorities took over.&lt;/p&gt;

&lt;p&gt;Curiosity still got the better of me and over the last week I pulled up three 7.5. instances running on 8 cores, 10GB RAM (the Solr- and JVM tuning is unchanged from the 2017 configs I attached in the original post).&lt;/p&gt;

&lt;p&gt;I apologise for the lack of depth of the analysis - it is not how I typically work, but instead of not providing a follow-up I thought &quot;better little than nothing&quot;. I am sure that my successor / team will follow up when they have an in-depth analysis by January 2019.&lt;/p&gt;

&lt;p&gt;The test was done by&#160;replaying Solr queries from an existing 7.4. Solr install across the 7.5 nodes&#160;and replayed the same production-load on different schemas using the main-index which consists of 7,5m documents and a size of 4GB:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Green: Now deprecated Trie*-fields (this is what we currently running in production)&lt;/li&gt;
	&lt;li&gt;Orange: Point*-fields&lt;/li&gt;
	&lt;li&gt;Blue: StrField&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Trie*-fields (Green or bottom line) still produce overall lowest CPU and memory utilisation. Throughput:&#160;19,5m queries, 21ms avg query time, 7.3sec max query time&lt;/p&gt;

&lt;p&gt;Point*-fields (Orange or middle line) consumed more resources.&#160;Throughput:&#160;18,6m queries, 35ms avg query time, 10sec max query time&lt;/p&gt;

&lt;p&gt;StrField (Blue or top-line) was visibly using more resources. GC was also more frequent.&#160;Throughput:&#160;17,6m queries, 42ms avg query time, 13sec max query time&lt;/p&gt;

&lt;p&gt;Admittedly, I did not tune JVM (using G1) and I am sure that if I had the time I could have tuned resource utilisation better. I doubt that such tuning would have dramatically improved throughput or query time.&lt;/p&gt;

&lt;p&gt;Perhaps I misunderstood this, but I thought Point-field types would outperform Trie*fields in range queries. In my tests I did not notice a dramatic difference for range queries when using Point*fields. I did however notice that some simple field/value queries underperformed when using Point*-fields over Trie*fields.&lt;/p&gt;

&lt;p&gt;I know it was mentioned that if Point-fields are not performing we should use StrFields, and maybe I missed a fundamental configuration step, but StrField generally performed worse than Point or Trie fields.&lt;/p&gt;

&lt;p&gt;I wish I had more time to analyse queries in more detail and perhaps play with variations in the schema to possibly assist with an improvement in this. As you can see from our schema, it is pretty much &quot;vanilla&quot; and I am surprised that other users have not raised issues - in our business (ecommerce) a difference of 14ms in average queries (or a variance of a good 2.7 seconds in poor performing queries) has a dramatic result on performance. Perhaps in other use cases such small variances between field-types do not matter.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12948187/12948187_image-2018-11-14-19-02-20-216.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;I am unfortunately not going to be able to contribute to this issue any more as I will not have access to the Solr environments.&lt;/p&gt;

&lt;p&gt;I would like to thank all Solr contributors for your outstanding work and deep level of knowledge and commitment as well as the helping hand you lend in assisting us with questions, issues and patches. I am grateful to have had the opportunity to use Solr when it started &quot;becoming mainstream&quot; as version 3.6 and thank you all for your contributions! All the best ~ Gerd Naschenweng.&lt;/p&gt;</comment>
                            <comment id="16686997" author="dsmiley" created="Wed, 14 Nov 2018 19:01:10 +0000"  >&lt;p&gt;Thanks Gerd; you are welcome!  It&apos;s not every day that we get such nice analysis, so I&apos;m appreciative of your efforts too.&lt;/p&gt;

&lt;p&gt;I suspect the slower performance on StrField might be because you are using it for all functions (range queries) in addition to lookups, whereas my recommendation is to use StrField only for lookups.  Also it doesn&apos;t help matters that the terms are longer (bigger) with a decimal encoding instead of 4-8 bytes that we&apos;d get with &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12074&quot; title=&quot;Add numeric typed equivalents to StrField&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12074&quot;&gt;SOLR-12074&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13143794">SOLR-12074</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12877239" name="compare-6.4.2-6.6.0.png" size="62536" author="tech@bidorbuy.co.za" created="Fri, 14 Jul 2017 06:31:42 +0000"/>
                            <attachment id="12877244" name="core-admin-tradesearch.png" size="214146" author="tech@bidorbuy.co.za" created="Fri, 14 Jul 2017 06:42:26 +0000"/>
                            <attachment id="12948186" name="image-2018-11-14-19-00-39-395.png" size="173828" author="tech@bidorbuy.co.za" created="Wed, 14 Nov 2018 17:00:42 +0000"/>
                            <attachment id="12948187" name="image-2018-11-14-19-02-20-216.png" size="169234" author="tech@bidorbuy.co.za" created="Wed, 14 Nov 2018 17:02:23 +0000"/>
                            <attachment id="12877242" name="jvm-stats.png" size="235973" author="tech@bidorbuy.co.za" created="Fri, 14 Jul 2017 06:38:04 +0000"/>
                            <attachment id="12877246" name="schema.xml" size="11253" author="tech@bidorbuy.co.za" created="Fri, 14 Jul 2017 06:43:15 +0000"/>
                            <attachment id="12877240" name="screenshot-1.png" size="296163" author="tech@bidorbuy.co.za" created="Fri, 14 Jul 2017 06:33:30 +0000"/>
                            <attachment id="12877241" name="screenshot-2.png" size="230674" author="tech@bidorbuy.co.za" created="Fri, 14 Jul 2017 06:34:38 +0000"/>
                            <attachment id="12896346" name="screenshot-3.png" size="124797" author="tech@bidorbuy.co.za" created="Tue, 7 Nov 2017 06:12:57 +0000"/>
                            <attachment id="12895351" name="solr-6-4-2-schema.xml" size="11298" author="tech@bidorbuy.co.za" created="Thu, 2 Nov 2017 05:53:24 +0000"/>
                            <attachment id="12895350" name="solr-6-4-2-solrconfig.xml" size="9747" author="tech@bidorbuy.co.za" created="Thu, 2 Nov 2017 05:53:25 +0000"/>
                            <attachment id="12895349" name="solr-7-1-0-managed-schema" size="10888" author="tech@bidorbuy.co.za" created="Thu, 2 Nov 2017 05:53:25 +0000"/>
                            <attachment id="12895348" name="solr-7-1-0-solrconfig.xml" size="10750" author="tech@bidorbuy.co.za" created="Thu, 2 Nov 2017 05:53:25 +0000"/>
                            <attachment id="12895593" name="solr-71-vs-64.png" size="140897" author="tech@bidorbuy.co.za" created="Fri, 3 Nov 2017 08:36:25 +0000"/>
                            <attachment id="12877243" name="solr-sample-warning-log.txt" size="9389" author="tech@bidorbuy.co.za" created="Fri, 14 Jul 2017 06:41:27 +0000"/>
                            <attachment id="12895347" name="solr.in.sh" size="4678" author="tech@bidorbuy.co.za" created="Thu, 2 Nov 2017 05:53:25 +0000"/>
                            <attachment id="12877245" name="solrconfig.xml" size="10603" author="tech@bidorbuy.co.za" created="Fri, 14 Jul 2017 06:43:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>17.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3hik7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>