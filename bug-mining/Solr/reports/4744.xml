<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:48:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-15762] IllegalStateException: Recursive update thrown when executing complex Join queries</title>
                <link>https://issues.apache.org/jira/browse/SOLR-15762</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;When running complex Join queries (maybe others effected too) an IllegalStateException: Recursive update is thrown because of recursive up of the FastLRUCache triggered by FastLRUCache.computeIfAbsent used by SolrIndexSearcher.&lt;/p&gt;

&lt;p&gt;The issue is caused by changes due to &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15555&quot; title=&quot;Use filterCache.computeIfAbsent in SolrIndexSearcher&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15555&quot;&gt;&lt;del&gt;SOLR-15555&lt;/del&gt;&lt;/a&gt; by commit &lt;a href=&quot;https://github.com/apache/lucene-solr/commit/fd9631f59d03500dbde31f7d7ae23b10d364d80d#diff-99978700f1c69d6a5f6c2190f89c98cfe20c441161db5a183ec002e15cb1be28&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/commit/fd9631f59d03500dbde31f7d7ae23b10d364d80d#diff-99978700f1c69d6a5f6c2190f89c98cfe20c441161db5a183ec002e15cb1be28&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Following Join Query causes the exception:&lt;/p&gt;

&lt;p&gt;new JsonQueryRequest().setQuery(&quot;{!join from=&lt;em&gt;id&lt;/em&gt; to=standorte.&lt;em&gt;id&lt;/em&gt; v=$q1}&quot;)&lt;br/&gt;
 .withParam(&quot;q1&quot;, &quot;type:standort AND &lt;em&gt;id&lt;/em&gt;:{!join from=&lt;em&gt;id&lt;/em&gt; to=beziehungen.&lt;em&gt;id&lt;/em&gt; v=$q2}&quot;)&lt;br/&gt;
 .withParam(&quot;q2&quot;, &quot;type:beziehung AND &lt;em&gt;id&lt;/em&gt;:{!join from=&lt;em&gt;id&lt;/em&gt; to=person.&lt;em&gt;id&lt;/em&gt; v=&apos;type:person&apos;}&quot;)&lt;/p&gt;

&lt;p&gt;The stack trace shows the recusive call:&lt;/p&gt;

&lt;p&gt;08:29:43,569][ ]&lt;span class=&quot;error&quot;&gt;&amp;#91;Thread:main&amp;#93;&lt;/span&gt; ERROR java.lang.IllegalStateException: Recursive update&lt;br/&gt;
 at java.base/java.util.concurrent.ConcurrentHashMap.computeIfAbsent(ConcurrentHashMap.java:1760)&lt;br/&gt;
 at org.apache.solr.util.ConcurrentLRUCache.computeIfAbsent(ConcurrentLRUCache.java:226)&lt;br/&gt;
 at org.apache.solr.search.FastLRUCache.computeIfAbsent(FastLRUCache.java:259)&lt;br/&gt;
 at org.apache.solr.search.SolrIndexSearcher.getDocSet(SolrIndexSearcher.java:1122)&lt;br/&gt;
 at org.apache.solr.search.JoinQuery$JoinQueryWeight.getDocSetEnumerate(JoinQParserPlugin.java:591)&lt;br/&gt;
 at org.apache.solr.search.JoinQuery$JoinQueryWeight.getDocSet(JoinQParserPlugin.java:452)&lt;br/&gt;
 at org.apache.solr.search.JoinQuery$JoinQueryWeight.scorer(JoinQParserPlugin.java:381)&lt;br/&gt;
 at org.apache.lucene.search.Weight.scorerSupplier(Weight.java:148)&lt;br/&gt;
 at org.apache.lucene.search.BooleanWeight.scorerSupplier(BooleanWeight.java:379)&lt;br/&gt;
 at org.apache.lucene.search.BooleanWeight.scorer(BooleanWeight.java:344)&lt;br/&gt;
 at org.apache.lucene.search.Weight.bulkScorer(Weight.java:182)&lt;br/&gt;
 at org.apache.lucene.search.BooleanWeight.bulkScorer(BooleanWeight.java:338)&lt;br/&gt;
 at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:656)&lt;br/&gt;
 at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:443)&lt;br/&gt;
 at org.apache.solr.search.DocSetUtil.createDocSetGeneric(DocSetUtil.java:145)&lt;br/&gt;
 at org.apache.solr.search.DocSetUtil.createDocSet(DocSetUtil.java:134)&lt;br/&gt;
 at org.apache.solr.search.SolrIndexSearcher.getDocSetNC(SolrIndexSearcher.java:1197)&lt;br/&gt;
 at org.apache.solr.search.SolrIndexSearcher.lambda$getAndCacheDocSet$1(SolrIndexSearcher.java:876)&lt;br/&gt;
 at org.apache.solr.search.FastLRUCache.lambda$computeIfAbsent$1(FastLRUCache.java:261)&lt;br/&gt;
 at org.apache.solr.util.ConcurrentLRUCache.lambda$computeIfAbsent$1(ConcurrentLRUCache.java:227)&lt;br/&gt;
 at java.base/java.util.concurrent.ConcurrentHashMap.computeIfAbsent(ConcurrentHashMap.java:1705)&lt;br/&gt;
 at org.apache.solr.util.ConcurrentLRUCache.computeIfAbsent(ConcurrentLRUCache.java:226)&lt;br/&gt;
 at org.apache.solr.search.FastLRUCache.computeIfAbsent(FastLRUCache.java:259)&lt;br/&gt;
 at org.apache.solr.search.SolrIndexSearcher.getAndCacheDocSet(SolrIndexSearcher.java:876)&lt;br/&gt;
 at org.apache.solr.search.SolrIndexSearcher.getDocSet(SolrIndexSearcher.java:825)&lt;br/&gt;
 at org.apache.solr.search.JoinQuery$JoinQueryWeight.getDocSetEnumerate(JoinQParserPlugin.java:476)&lt;br/&gt;
 at org.apache.solr.search.JoinQuery$JoinQueryWeight.getDocSet(JoinQParserPlugin.java:452)&lt;br/&gt;
 at org.apache.solr.search.JoinQuery$JoinQueryWeight.scorer(JoinQParserPlugin.java:381)&lt;br/&gt;
 at org.apache.lucene.search.Weight.scorerSupplier(Weight.java:148)&lt;br/&gt;
 at org.apache.lucene.search.BooleanWeight.scorerSupplier(BooleanWeight.java:379)&lt;br/&gt;
 at org.apache.lucene.search.BooleanWeight.scorer(BooleanWeight.java:344)&lt;br/&gt;
 at org.apache.lucene.search.Weight.bulkScorer(Weight.java:182)&lt;br/&gt;
 at org.apache.lucene.search.BooleanWeight.bulkScorer(BooleanWeight.java:338)&lt;br/&gt;
 at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:656)&lt;br/&gt;
 at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:443)&lt;br/&gt;
 at org.apache.solr.search.DocSetUtil.createDocSetGeneric(DocSetUtil.java:145)&lt;br/&gt;
 at org.apache.solr.search.DocSetUtil.createDocSet(DocSetUtil.java:134)&lt;br/&gt;
 at org.apache.solr.search.SolrIndexSearcher.getDocSetNC(SolrIndexSearcher.java:1197)&lt;br/&gt;
 at org.apache.solr.search.SolrIndexSearcher.lambda$getAndCacheDocSet$1(SolrIndexSearcher.java:876)&lt;br/&gt;
 at org.apache.solr.search.FastLRUCache.lambda$computeIfAbsent$1(FastLRUCache.java:261)&lt;br/&gt;
 at org.apache.solr.util.ConcurrentLRUCache.lambda$computeIfAbsent$1(ConcurrentLRUCache.java:227)&lt;br/&gt;
 at java.base/java.util.concurrent.ConcurrentHashMap.computeIfAbsent(ConcurrentHashMap.java:1705)&lt;br/&gt;
 at org.apache.solr.util.ConcurrentLRUCache.computeIfAbsent(ConcurrentLRUCache.java:226)&lt;br/&gt;
 at org.apache.solr.search.FastLRUCache.computeIfAbsent(FastLRUCache.java:259)&lt;br/&gt;
 at org.apache.solr.search.SolrIndexSearcher.getAndCacheDocSet(SolrIndexSearcher.java:876)&lt;br/&gt;
 at org.apache.solr.search.SolrIndexSearcher.getDocSet(SolrIndexSearcher.java:825)&lt;br/&gt;
 at org.apache.solr.search.JoinQuery$JoinQueryWeight.getDocSetEnumerate(JoinQParserPlugin.java:476)&lt;br/&gt;
 at org.apache.solr.search.JoinQuery$JoinQueryWeight.getDocSet(JoinQParserPlugin.java:452)&lt;br/&gt;
 at org.apache.solr.search.JoinQuery$JoinQueryWeight.scorer(JoinQParserPlugin.java:381)&lt;br/&gt;
 at org.apache.lucene.search.Weight.bulkScorer(Weight.java:182)&lt;br/&gt;
 at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:656)&lt;br/&gt;
 at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:443)&lt;br/&gt;
 at org.apache.solr.search.SolrIndexSearcher.buildAndRunCollectorChain(SolrIndexSearcher.java:211)&lt;br/&gt;
 at org.apache.solr.search.SolrIndexSearcher.getDocListNC(SolrIndexSearcher.java:1622)&lt;br/&gt;
 at org.apache.solr.search.SolrIndexSearcher.getDocListC(SolrIndexSearcher.java:1439)&lt;br/&gt;
 at org.apache.solr.search.SolrIndexSearcher.search(SolrIndexSearcher.java:596)&lt;br/&gt;
 at org.apache.solr.handler.component.QueryComponent.doProcessUngroupedSearch(QueryComponent.java:1511)&lt;br/&gt;
 at org.apache.solr.handler.component.QueryComponent.process(QueryComponent.java:390)&lt;br/&gt;
 at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:368)&lt;br/&gt;
 at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:216)&lt;br/&gt;
 at org.apache.solr.core.SolrCore.execute(SolrCore.java:2637)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13409805">SOLR-15762</key>
            <summary>IllegalStateException: Recursive update thrown when executing complex Join queries</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mdrob">Mike Drob</assignee>
                                    <reporter username="thomas.woeckinger">Thomas W&#246;ckinger</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 3 Nov 2021 08:34:45 +0000</created>
                <updated>Tue, 4 Jan 2022 08:22:44 +0000</updated>
                            <resolved>Tue, 9 Nov 2021 06:04:21 +0000</resolved>
                                    <version>9.0</version>
                    <version>8.10</version>
                    <version>8.11</version>
                    <version>8.10.1</version>
                                    <fixVersion>9.0</fixVersion>
                    <fixVersion>8.11</fixVersion>
                                    <component>search</component>
                    <component>Server</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="10200">2h 50m</timespent>
                                <comments>
                            <comment id="17437846" author="thomas.woeckinger" created="Wed, 3 Nov 2021 09:12:25 +0000"  >&lt;p&gt;As FastLRUCache is deprecated, i removed the class attribute from the cache config to select the default implementation.&lt;/p&gt;

&lt;p&gt;It is not that easy to force the exception when using CaffeineCache (may because it is faster), but the API documents using `get`(which is called in&#160;computeIfAbsent) on the CaffeineCache can also throw an IllegalStateException during recursion detection.&lt;/p&gt;

&lt;p&gt;Only catching the IllegalStateException when using computeIfAbsent in SolrIndexSearcher seems to be not a good solution.&lt;/p&gt;</comment>
                            <comment id="17438114" author="thomas.woeckinger" created="Wed, 3 Nov 2021 14:50:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mdrob%40cloudera.com&quot; class=&quot;user-hover&quot; rel=&quot;mdrob@cloudera.com&quot;&gt;mdrob@cloudera.com&lt;/a&gt; you may have a look.&lt;/p&gt;</comment>
                            <comment id="17438171" author="thomas.woeckinger" created="Wed, 3 Nov 2021 16:17:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpountz&quot; class=&quot;user-hover&quot; rel=&quot;jpountz&quot;&gt;jpountz&lt;/a&gt; just to inform you about this issue, i think when releasing 8.11 this should be part of it.&lt;/p&gt;</comment>
                            <comment id="17438208" author="jpountz" created="Wed, 3 Nov 2021 17:25:01 +0000"  >&lt;p&gt;Thanks for the ping, I&apos;m making it a blocker then.&lt;/p&gt;</comment>
                            <comment id="17438261" author="mdrob" created="Wed, 3 Nov 2021 19:12:45 +0000"  >&lt;p&gt;Looking.&lt;/p&gt;

&lt;p&gt;&amp;gt; It is not that easy to force the exception when using CaffeineCache&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomas.woeckinger&quot; class=&quot;user-hover&quot; rel=&quot;thomas.woeckinger&quot;&gt;thomas.woeckinger&lt;/a&gt; - Does this mean that you were able to reproduce, but not reliably, or you did not see this with CaffeineCache at all?&lt;/p&gt;</comment>
                            <comment id="17438350" author="joel.bernstein" created="Wed, 3 Nov 2021 23:59:49 +0000"  >&lt;p&gt;I don&apos;t think we can keep this as a blocker for the release. I don&apos;t think this is far enough along to make it into 8.11.&lt;/p&gt;</comment>
                            <comment id="17438555" author="thomas.woeckinger" created="Thu, 4 Nov 2021 08:30:22 +0000"  >&lt;p&gt;Now i found the reason why it was very hard to reproduce when using CaffeineCache:&lt;/p&gt;

&lt;p&gt;The async option is set to true by default, if changed to false following StackTrace will occur:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;09:26:17,623&amp;#93;&lt;/span&gt;[ ]&lt;span class=&quot;error&quot;&gt;&amp;#91;Thread:main&amp;#93;&lt;/span&gt; ERROR java.lang.IllegalStateException: Recursive update&lt;br/&gt;
 at java.base/java.util.concurrent.ConcurrentHashMap.compute(ConcurrentHashMap.java:1983)&lt;br/&gt;
 at com.github.benmanes.caffeine.cache.BoundedLocalCache.doComputeIfAbsent(BoundedLocalCache.java:2411)&lt;br/&gt;
 at com.github.benmanes.caffeine.cache.BoundedLocalCache.computeIfAbsent(BoundedLocalCache.java:2394)&lt;br/&gt;
 at com.github.benmanes.caffeine.cache.LocalCache.computeIfAbsent(LocalCache.java:108)&lt;br/&gt;
 at com.github.benmanes.caffeine.cache.LocalManualCache.get(LocalManualCache.java:62)&lt;br/&gt;
 at org.apache.solr.search.CaffeineCache.computeIfAbsent(CaffeineCache.java:245)&lt;br/&gt;
 at org.apache.solr.search.SolrIndexSearcher.getDocSet(SolrIndexSearcher.java:1122)&lt;br/&gt;
 at org.apache.solr.search.JoinQuery$JoinQueryWeight.getDocSetEnumerate(JoinQParserPlugin.java:591)&lt;br/&gt;
 at org.apache.solr.search.JoinQuery$JoinQueryWeight.getDocSet(JoinQParserPlugin.java:452)&lt;br/&gt;
 at org.apache.solr.search.JoinQuery$JoinQueryWeight.scorer(JoinQParserPlugin.java:381)&lt;br/&gt;
 at org.apache.lucene.search.Weight.scorerSupplier(Weight.java:148)&lt;br/&gt;
 at org.apache.lucene.search.BooleanWeight.scorerSupplier(BooleanWeight.java:379)&lt;br/&gt;
 at org.apache.lucene.search.BooleanWeight.scorer(BooleanWeight.java:344)&lt;br/&gt;
 at org.apache.lucene.search.Weight.bulkScorer(Weight.java:182)&lt;br/&gt;
 at org.apache.lucene.search.BooleanWeight.bulkScorer(BooleanWeight.java:338)&lt;br/&gt;
 at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:656)&lt;br/&gt;
 at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:443)&lt;br/&gt;
 at org.apache.solr.search.DocSetUtil.createDocSetGeneric(DocSetUtil.java:145)&lt;br/&gt;
 at org.apache.solr.search.DocSetUtil.createDocSet(DocSetUtil.java:134)&lt;br/&gt;
 at org.apache.solr.search.SolrIndexSearcher.getDocSetNC(SolrIndexSearcher.java:1197)&lt;br/&gt;
 at org.apache.solr.search.SolrIndexSearcher.lambda$getAndCacheDocSet$1(SolrIndexSearcher.java:876)&lt;br/&gt;
 at org.apache.solr.search.CaffeineCache.lambda$computeIfAbsent$1(CaffeineCache.java:248)&lt;br/&gt;
 at com.github.benmanes.caffeine.cache.LocalCache.lambda$statsAware$0(LocalCache.java:139)&lt;br/&gt;
 at com.github.benmanes.caffeine.cache.BoundedLocalCache.lambda$doComputeIfAbsent$14(BoundedLocalCache.java:2413)&lt;br/&gt;
 at java.base/java.util.concurrent.ConcurrentHashMap.compute(ConcurrentHashMap.java:1947)&lt;br/&gt;
 at com.github.benmanes.caffeine.cache.BoundedLocalCache.doComputeIfAbsent(BoundedLocalCache.java:2411)&lt;br/&gt;
 at com.github.benmanes.caffeine.cache.BoundedLocalCache.computeIfAbsent(BoundedLocalCache.java:2394)&lt;br/&gt;
 at com.github.benmanes.caffeine.cache.LocalCache.computeIfAbsent(LocalCache.java:108)&lt;br/&gt;
 at com.github.benmanes.caffeine.cache.LocalManualCache.get(LocalManualCache.java:62)&lt;br/&gt;
 at org.apache.solr.search.CaffeineCache.computeIfAbsent(CaffeineCache.java:245)&lt;br/&gt;
 at org.apache.solr.search.SolrIndexSearcher.getAndCacheDocSet(SolrIndexSearcher.java:876)&lt;br/&gt;
 at org.apache.solr.search.SolrIndexSearcher.getDocSet(SolrIndexSearcher.java:825)&lt;br/&gt;
 at org.apache.solr.search.JoinQuery$JoinQueryWeight.getDocSetEnumerate(JoinQParserPlugin.java:476)&lt;br/&gt;
 at org.apache.solr.search.JoinQuery$JoinQueryWeight.getDocSet(JoinQParserPlugin.java:452)&lt;br/&gt;
 at org.apache.solr.search.JoinQuery$JoinQueryWeight.scorer(JoinQParserPlugin.java:381)&lt;br/&gt;
 at org.apache.lucene.search.Weight.scorerSupplier(Weight.java:148)&lt;br/&gt;
 at org.apache.lucene.search.BooleanWeight.scorerSupplier(BooleanWeight.java:379)&lt;br/&gt;
 at org.apache.lucene.search.BooleanWeight.scorer(BooleanWeight.java:344)&lt;br/&gt;
 at org.apache.lucene.search.Weight.bulkScorer(Weight.java:182)&lt;br/&gt;
 at org.apache.lucene.search.BooleanWeight.bulkScorer(BooleanWeight.java:338)&lt;br/&gt;
 at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:656)&lt;br/&gt;
 at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:443)&lt;br/&gt;
 at org.apache.solr.search.DocSetUtil.createDocSetGeneric(DocSetUtil.java:145)&lt;br/&gt;
 at org.apache.solr.search.DocSetUtil.createDocSet(DocSetUtil.java:134)&lt;br/&gt;
 at org.apache.solr.search.SolrIndexSearcher.getDocSetNC(SolrIndexSearcher.java:1197)&lt;br/&gt;
 at org.apache.solr.search.SolrIndexSearcher.lambda$getAndCacheDocSet$1(SolrIndexSearcher.java:876)&lt;br/&gt;
 at org.apache.solr.search.CaffeineCache.lambda$computeIfAbsent$1(CaffeineCache.java:248)&lt;br/&gt;
 at com.github.benmanes.caffeine.cache.LocalCache.lambda$statsAware$0(LocalCache.java:139)&lt;br/&gt;
 at com.github.benmanes.caffeine.cache.BoundedLocalCache.lambda$doComputeIfAbsent$14(BoundedLocalCache.java:2413)&lt;br/&gt;
 at java.base/java.util.concurrent.ConcurrentHashMap.compute(ConcurrentHashMap.java:1908)&lt;br/&gt;
 at com.github.benmanes.caffeine.cache.BoundedLocalCache.doComputeIfAbsent(BoundedLocalCache.java:2411)&lt;br/&gt;
 at com.github.benmanes.caffeine.cache.BoundedLocalCache.computeIfAbsent(BoundedLocalCache.java:2394)&lt;br/&gt;
 at com.github.benmanes.caffeine.cache.LocalCache.computeIfAbsent(LocalCache.java:108)&lt;br/&gt;
 at com.github.benmanes.caffeine.cache.LocalManualCache.get(LocalManualCache.java:62)&lt;br/&gt;
 at org.apache.solr.search.CaffeineCache.computeIfAbsent(CaffeineCache.java:245)&lt;br/&gt;
 at org.apache.solr.search.SolrIndexSearcher.getAndCacheDocSet(SolrIndexSearcher.java:876)&lt;br/&gt;
 at org.apache.solr.search.SolrIndexSearcher.getDocSet(SolrIndexSearcher.java:825)&lt;br/&gt;
 at org.apache.solr.search.JoinQuery$JoinQueryWeight.getDocSetEnumerate(JoinQParserPlugin.java:476)&lt;br/&gt;
 at org.apache.solr.search.JoinQuery$JoinQueryWeight.getDocSet(JoinQParserPlugin.java:452)&lt;br/&gt;
 at org.apache.solr.search.JoinQuery$JoinQueryWeight.scorer(JoinQParserPlugin.java:381)&lt;br/&gt;
 at org.apache.lucene.search.Weight.bulkScorer(Weight.java:182)&lt;br/&gt;
 at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:656)&lt;br/&gt;
 at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:443)&lt;br/&gt;
 at org.apache.solr.search.SolrIndexSearcher.buildAndRunCollectorChain(SolrIndexSearcher.java:211)&lt;br/&gt;
 at org.apache.solr.search.SolrIndexSearcher.getDocListNC(SolrIndexSearcher.java:1622)&lt;br/&gt;
 at org.apache.solr.search.SolrIndexSearcher.getDocListC(SolrIndexSearcher.java:1439)&lt;br/&gt;
 at org.apache.solr.search.SolrIndexSearcher.search(SolrIndexSearcher.java:596)&lt;br/&gt;
 at org.apache.solr.handler.component.QueryComponent.doProcessUngroupedSearch(QueryComponent.java:1511)&lt;br/&gt;
 at org.apache.solr.handler.component.QueryComponent.process(QueryComponent.java:390)&lt;br/&gt;
 at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:368)&lt;br/&gt;
 at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:216)&lt;br/&gt;
 at org.apache.solr.core.SolrCore.execute(SolrCore.java:2637)&lt;/p&gt;</comment>
                            <comment id="17438588" author="jpountz" created="Thu, 4 Nov 2021 09:31:37 +0000"  >&lt;p&gt;Based on &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbernste&quot; class=&quot;user-hover&quot; rel=&quot;jbernste&quot;&gt;jbernste&lt;/a&gt;&apos;s above comment, I&apos;m removing the blocker label.&lt;/p&gt;</comment>
                            <comment id="17438681" author="dsmiley" created="Thu, 4 Nov 2021 12:23:22 +0000"  >&lt;p&gt;If we assume CaffeineCache and async (as is the default), I suspect this can&apos;t happen. &#160;This seems like an upgrade problem for existing configSets that reference deprecated caches? &#160;Something for us to document but probably can&apos;t fundamentally fix.&lt;/p&gt;</comment>
                            <comment id="17438780" author="thomas.woeckinger" created="Thu, 4 Nov 2021 15:14:03 +0000"  >&lt;p&gt;Then async option should be removed, cause otherwise IllegalStateException can be thrown, depending on the query.&lt;/p&gt;</comment>
                            <comment id="17438877" author="mdrob" created="Thu, 4 Nov 2021 18:24:08 +0000"  >&lt;blockquote&gt;&lt;p&gt;Then async option should be removed&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Or rather, only the async mode should remain.&lt;/p&gt;

&lt;p&gt;Let&apos;s take a moment to think about what we can do for folks already using LRUCache on Solr 8... Should we remove it from 8.x entirely? Probably can&apos;t do that. Warn on startup that it will not work with Join queries? Revert &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15555&quot; title=&quot;Use filterCache.computeIfAbsent in SolrIndexSearcher&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15555&quot;&gt;&lt;del&gt;SOLR-15555&lt;/del&gt;&lt;/a&gt;? Investigate if LRUCache can have an async mode as well?&lt;/p&gt;</comment>
                            <comment id="17438901" author="dsmiley" created="Thu, 4 Nov 2021 19:17:39 +0000"  >&lt;p&gt;I seriously doubt anyone that is using our deprecated caches is doing so because they truly need them. &#160;They are using them because our configs don&apos;t have good blank defaults, so lots of things need to be specified and thus get out of sync with changes in Solr. &#160;I propose we detect that one of the two deprecated caches was specified AND that async==true. &#160;In this case, log a warning and use Caffeine because those caches are known not to support async==true.&lt;/p&gt;</comment>
                            <comment id="17438907" author="thomas.woeckinger" created="Thu, 4 Nov 2021 19:48:14 +0000"  >&lt;p&gt;CaffeineCache is not deprecated it is the default implementation, and if async mode is switched off the problem still exists.&lt;/p&gt;

&lt;p&gt;I am very close to provide a reproducer unit test, debugging shows that it also depends on the cache size, stay tuned.&lt;/p&gt;</comment>
                            <comment id="17438926" author="mdrob" created="Thu, 4 Nov 2021 20:45:40 +0000"  >&lt;p&gt;There are a lot of comments around &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15555&quot; title=&quot;Use filterCache.computeIfAbsent in SolrIndexSearcher&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15555&quot;&gt;&lt;del&gt;SOLR-15555&lt;/del&gt;&lt;/a&gt; about how join queries won&apos;t work with async=false (the default is true). There are comments about it in the ref guide too. I think the highlights about LRUCache not working with join queries now is important, probably something we need to let users know about in more strong terms.&lt;/p&gt;

&lt;p&gt;Which cache impl are you using for your reproducer?&lt;/p&gt;</comment>
                            <comment id="17438971" author="thomas.woeckinger" created="Thu, 4 Nov 2021 22:50:56 +0000"  >&lt;p&gt;CaffeineCache is used. Attached is a junit test which fails 90% of time, I developed it against 8_10 branch. &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13035709/13035709_ParameterizedJoinQueryTest.java&quot; title=&quot;ParameterizedJoinQueryTest.java attached to SOLR-15762&quot;&gt;ParameterizedJoinQueryTest.java&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;If preferred i can provide a patch too.&lt;/p&gt;</comment>
                            <comment id="17438975" author="thomas.woeckinger" created="Thu, 4 Nov 2021 23:02:55 +0000"  >&lt;p&gt;The main issue seems to be caused by running out of cache space, which leads to extra recursion while fetching DocSets.&lt;/p&gt;

&lt;p&gt;Using async=true prevents the recursion. &#160;&lt;/p&gt;</comment>
                            <comment id="17438999" author="mdrob" created="Fri, 5 Nov 2021 02:53:23 +0000"  >&lt;p&gt;We already have this line in our documentation: &lt;a href=&quot;https://solr.apache.org/guide/8_10/query-settings-in-solrconfig.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://solr.apache.org/guide/8_10/query-settings-in-solrconfig.html&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If your queries include child documents or join queries, then async cache must be enabled to function properly.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I would be sympathetic to making that a more stern warning. I would be less sympathetic to coming up with a way to make sync cache work with join queries, since I have already spent many many hours on this and the solution would be to essentially implement an async cache anyway.&lt;/p&gt;</comment>
                            <comment id="17439057" author="thomas.woeckinger" created="Fri, 5 Nov 2021 06:57:47 +0000"  >&lt;blockquote&gt;&lt;p&gt;We already have this line in our documentation: &lt;a href=&quot;https://solr.apache.org/guide/8_10/query-settings-in-solrconfig.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://solr.apache.org/guide/8_10/query-settings-in-solrconfig.html&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Maybe it is sufficient to mention the possibility of IllegalStateException: Recursive update. And also document it at &lt;a href=&quot;https://solr.apache.org/guide/8_10/other-parsers.html#join-query-parser&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://solr.apache.org/guide/8_10/other-parsers.html#join-query-parser&lt;/a&gt; .&lt;/p&gt;

&lt;p&gt;Another solution would be to catch the exception at line 591 of JoinQParserPlugin&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      DocSet toTermSet = toSearcher.getDocSet(toDeState);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and throw a meaningful exception instead.&lt;/p&gt;

&lt;p&gt;But clean code is something else.&lt;/p&gt;</comment>
                            <comment id="17439255" author="mdrob" created="Fri, 5 Nov 2021 13:21:57 +0000"  >&lt;p&gt;I think those are both great solutions. Unfortunately, I don&#8217;t have time today to put together a patch, would you be able to do it? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomas.woeckinger&quot; class=&quot;user-hover&quot; rel=&quot;thomas.woeckinger&quot;&gt;thomas.woeckinger&lt;/a&gt; ?&lt;/p&gt;

&lt;p&gt;FYI &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpountz&quot; class=&quot;user-hover&quot; rel=&quot;jpountz&quot;&gt;jpountz&lt;/a&gt; this should be a small fix and I would still like to see it in 8.11 if possible. &lt;/p&gt;</comment>
                            <comment id="17439260" author="thomas.woeckinger" created="Fri, 5 Nov 2021 13:31:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mdrob&quot; class=&quot;user-hover&quot; rel=&quot;mdrob&quot;&gt;mdrob&lt;/a&gt; For sure, so you want to catch the ISE and throw a meaningful SolrException?&lt;/p&gt;

&lt;p&gt;Should i also add the test (expecting a excption)?&lt;/p&gt;</comment>
                            <comment id="17439269" author="mdrob" created="Fri, 5 Nov 2021 13:41:41 +0000"  >&lt;p&gt;I think both the exception translation and then additional docs would be nice. The exception message could point people at the docs too!&lt;/p&gt;

&lt;p&gt;A test for them right kind of exception makes sense, but might be difficult to be precise because Solr responses are not always the clearest. &lt;/p&gt;</comment>
                            <comment id="17439279" author="jpountz" created="Fri, 5 Nov 2021 13:59:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mdrob&quot; class=&quot;user-hover&quot; rel=&quot;mdrob&quot;&gt;mdrob&lt;/a&gt; Pleas go ahead and merge this small fix.&lt;/p&gt;</comment>
                            <comment id="17439349" author="jpountz" created="Fri, 5 Nov 2021 15:49:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mdrob&quot; class=&quot;user-hover&quot; rel=&quot;mdrob&quot;&gt;mdrob&lt;/a&gt; Do you know when I can expect this small fix to be merged?&lt;/p&gt;</comment>
                            <comment id="17439360" author="thomas.woeckinger" created="Fri, 5 Nov 2021 16:10:01 +0000"  >&lt;p&gt;Pull Request create just a second ago, ready to review.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/lucene-solr/pull/2605&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/pull/2605&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17439404" author="dsmiley" created="Fri, 5 Nov 2021 17:53:09 +0000"  >&lt;p&gt;If SolrCache had a isAsync() method, then JoinQuery could interrogate SolrIndexSearcher.getFilterCache to check this method and throw. This would allow for repeatability and eager/early reporting of the problem. WDYT?&lt;/p&gt;</comment>
                            <comment id="17439555" author="thomas.woeckinger" created="Fri, 5 Nov 2021 22:58:22 +0000"  >&lt;p&gt;From the design point of view SolrCache should have the isAsync() method anyway.&lt;/p&gt;

&lt;p&gt;As I mention on the PR, it will change runtime behavior because such queries will always fail.&lt;/p&gt;

&lt;p&gt;But yes, I think it would result in cleaner code, on both sides, runtime code and test code.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mdrob&quot; class=&quot;user-hover&quot; rel=&quot;mdrob&quot;&gt;mdrob&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt; we simply should make decision.&lt;/p&gt;</comment>
                            <comment id="17440463" author="thomas.woeckinger" created="Mon, 8 Nov 2021 13:37:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mdrob&quot; class=&quot;user-hover&quot; rel=&quot;mdrob&quot;&gt;mdrob&lt;/a&gt; , &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt; : Do we have a decision?&lt;/p&gt;</comment>
                            <comment id="17440516" author="jpountz" created="Mon, 8 Nov 2021 14:46:38 +0000"  >&lt;p&gt;I&apos;d like to avoid delaying 8.11 for too long. This issue doesn&apos;t seem critical, so I plan to move forward with building a RC tomorrow morning EU time even if the fix hasn&apos;t been merged by then. Please let me know if you think that we should absolutely have a fix for this in 8.11.&lt;/p&gt;</comment>
                            <comment id="17440765" author="mdrob" created="Mon, 8 Nov 2021 22:18:43 +0000"  >&lt;blockquote&gt;&lt;p&gt;If SolrCache had a isAsync() method, then JoinQuery could interrogate SolrIndexSearcher.getFilterCache to check this method and throw. This would allow for repeatability and eager/early reporting of the problem. WDYT?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, maybe? Probably not for 8.11 though.&lt;/p&gt;

&lt;p&gt;I think the PR as is would be good with minor change around the scope of the try/catch (if the tests passed, which they currently don&apos;t for me).&lt;/p&gt;</comment>
                            <comment id="17440806" author="mdrob" created="Mon, 8 Nov 2021 22:47:47 +0000"  >&lt;p&gt;When I run the test in IntelliJ it gets stuck at&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
getObjectVolatile:-1, Unsafe (sun.misc)
tabAt:755, ConcurrentHashMap (java.util.concurrent)
compute:1869, ConcurrentHashMap (java.util.concurrent)
doComputeIfAbsent:2411, BoundedLocalCache (com.github.benmanes.caffeine.cache)
computeIfAbsent:2394, BoundedLocalCache (com.github.benmanes.caffeine.cache)
computeIfAbsent:108, LocalCache (com.github.benmanes.caffeine.cache)
get:62, LocalManualCache (com.github.benmanes.caffeine.cache)
computeIfAbsent:245, CaffeineCache (org.apache.solr.search)
getDocSet:1122, SolrIndexSearcher (org.apache.solr.search)
getDocSetEnumerate:592, JoinQuery$JoinQueryWeight (org.apache.solr.search)
getDocSet:452, JoinQuery$JoinQueryWeight (org.apache.solr.search)
scorer:381, JoinQuery$JoinQueryWeight (org.apache.solr.search)
scorerSupplier:148, Weight (org.apache.lucene.search)
scorerSupplier:379, BooleanWeight (org.apache.lucene.search)
scorer:344, BooleanWeight (org.apache.lucene.search)
bulkScorer:182, Weight (org.apache.lucene.search)
bulkScorer:338, BooleanWeight (org.apache.lucene.search)
search:656, IndexSearcher (org.apache.lucene.search)
search:443, IndexSearcher (org.apache.lucene.search)
createDocSetGeneric:145, DocSetUtil (org.apache.solr.search)
createDocSet:134, DocSetUtil (org.apache.solr.search)
getDocSetNC:1197, SolrIndexSearcher (org.apache.solr.search)
lambda$getAndCacheDocSet$1:876, SolrIndexSearcher (org.apache.solr.search)
apply:-1, 90732694 (org.apache.solr.search.SolrIndexSearcher$$Lambda$381)
lambda$computeIfAbsent$1:248, CaffeineCache (org.apache.solr.search)
apply:-1, 1070251965 (org.apache.solr.search.CaffeineCache$$Lambda$382)
lambda$statsAware$0:139, LocalCache (com.github.benmanes.caffeine.cache)
apply:-1, 1702294965 (com.github.benmanes.caffeine.cache.LocalCache$$Lambda$383)
lambda$doComputeIfAbsent$14:2413, BoundedLocalCache (com.github.benmanes.caffeine.cache)
apply:-1, 609127023 (com.github.benmanes.caffeine.cache.BoundedLocalCache$$Lambda$384)
compute:1853, ConcurrentHashMap (java.util.concurrent)
doComputeIfAbsent:2411, BoundedLocalCache (com.github.benmanes.caffeine.cache)
computeIfAbsent:2394, BoundedLocalCache (com.github.benmanes.caffeine.cache)
computeIfAbsent:108, LocalCache (com.github.benmanes.caffeine.cache)
get:62, LocalManualCache (com.github.benmanes.caffeine.cache)
computeIfAbsent:245, CaffeineCache (org.apache.solr.search)
getAndCacheDocSet:876, SolrIndexSearcher (org.apache.solr.search)
getDocSet:825, SolrIndexSearcher (org.apache.solr.search)
getDocSetEnumerate:476, JoinQuery$JoinQueryWeight (org.apache.solr.search)
getDocSet:452, JoinQuery$JoinQueryWeight (org.apache.solr.search)
scorer:381, JoinQuery$JoinQueryWeight (org.apache.solr.search)
bulkScorer:182, Weight (org.apache.lucene.search)
search:656, IndexSearcher (org.apache.lucene.search)
search:443, IndexSearcher (org.apache.lucene.search)
buildAndRunCollectorChain:211, SolrIndexSearcher (org.apache.solr.search)
getDocListNC:1622, SolrIndexSearcher (org.apache.solr.search)
getDocListC:1439, SolrIndexSearcher (org.apache.solr.search)
search:596, SolrIndexSearcher (org.apache.solr.search)
doProcessUngroupedSearch:1511, QueryComponent (org.apache.solr.handler.component)
process:390, QueryComponent (org.apache.solr.handler.component)
handleRequestBody:368, SearchHandler (org.apache.solr.handler.component)
handleRequest:216, RequestHandlerBase (org.apache.solr.handler)
execute:2637, SolrCore (org.apache.solr.core)
query:346, TestHarness (org.apache.solr.util)
query:328, TestHarness (org.apache.solr.util)
assertJQ:1107, SolrTestCaseJ4 (org.apache.solr)
assertJQ:1076, SolrTestCaseJ4 (org.apache.solr)
testInvalidFilterConfig:55, InvalidConfigJoinQueryTest (org.apache.solr.search.join)
invoke0:-1, NativeMethodAccessorImpl (sun.reflect)
invoke:62, NativeMethodAccessorImpl (sun.reflect)
invoke:43, DelegatingMethodAccessorImpl (sun.reflect)
invoke:498, Method (java.lang.reflect)
invoke:1750, RandomizedRunner (com.carrotsearch.randomizedtesting)
evaluate:938, RandomizedRunner$8 (com.carrotsearch.randomizedtesting)
evaluate:1035, RandomizedRunner$11 (com.carrotsearch.randomizedtesting)
evaluate:974, RandomizedRunner$9 (com.carrotsearch.randomizedtesting)
evaluate:988, RandomizedRunner$10 (com.carrotsearch.randomizedtesting)
evaluate:57, SystemPropertiesRestoreRule$1 (com.carrotsearch.randomizedtesting.rules)
evaluate:20, RunRules (org.junit.rules)
evaluate:49, TestRuleSetupTeardownChained$1 (org.apache.lucene.util)
evaluate:45, AbstractBeforeAfterRule$1 (org.apache.lucene.util)
evaluate:48, TestRuleThreadAndTestName$1 (org.apache.lucene.util)
evaluate:64, TestRuleIgnoreAfterMaxFailures$1 (org.apache.lucene.util)
evaluate:47, TestRuleMarkFailure$1 (org.apache.lucene.util)
evaluate:20, RunRules (org.junit.rules)
evaluate:36, StatementAdapter (com.carrotsearch.randomizedtesting.rules)
run:368, ThreadLeakControl$StatementRunner (com.carrotsearch.randomizedtesting)
forkTimeoutingTask:817, ThreadLeakControl (com.carrotsearch.randomizedtesting)
evaluate:468, ThreadLeakControl$3 (com.carrotsearch.randomizedtesting)
runSingleTest:947, RandomizedRunner (com.carrotsearch.randomizedtesting)
evaluate:832, RandomizedRunner$5 (com.carrotsearch.randomizedtesting)
evaluate:883, RandomizedRunner$6 (com.carrotsearch.randomizedtesting)
evaluate:894, RandomizedRunner$7 (com.carrotsearch.randomizedtesting)
evaluate:36, StatementAdapter (com.carrotsearch.randomizedtesting.rules)
evaluate:57, SystemPropertiesRestoreRule$1 (com.carrotsearch.randomizedtesting.rules)
evaluate:20, RunRules (org.junit.rules)
evaluate:45, AbstractBeforeAfterRule$1 (org.apache.lucene.util)
evaluate:36, StatementAdapter (com.carrotsearch.randomizedtesting.rules)
evaluate:41, TestRuleStoreClassName$1 (org.apache.lucene.util)
evaluate:40, NoShadowingOrOverridesOnMethodsRule$1 (com.carrotsearch.randomizedtesting.rules)
evaluate:40, NoShadowingOrOverridesOnMethodsRule$1 (com.carrotsearch.randomizedtesting.rules)
evaluate:36, StatementAdapter (com.carrotsearch.randomizedtesting.rules)
evaluate:36, StatementAdapter (com.carrotsearch.randomizedtesting.rules)
evaluate:36, StatementAdapter (com.carrotsearch.randomizedtesting.rules)
evaluate:53, TestRuleAssertionsRequired$1 (org.apache.lucene.util)
evaluate:47, TestRuleMarkFailure$1 (org.apache.lucene.util)
evaluate:64, TestRuleIgnoreAfterMaxFailures$1 (org.apache.lucene.util)
evaluate:54, TestRuleIgnoreTestSuites$1 (org.apache.lucene.util)
evaluate:20, RunRules (org.junit.rules)
evaluate:36, StatementAdapter (com.carrotsearch.randomizedtesting.rules)
run:368, ThreadLeakControl$StatementRunner (com.carrotsearch.randomizedtesting)
run:748, &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; (java.lang)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Which looks like a recursive update that we&apos;re trying to trigger but for some reason it&apos;s not an ISE. Investigating further, but I&apos;m not sure what causes the difference in behavior here.&lt;/p&gt;</comment>
                            <comment id="17440807" author="mdrob" created="Mon, 8 Nov 2021 22:49:52 +0000"  >&lt;p&gt;Wait, was the test supposed to be with CaffeineCache or with FastLRUCache?&lt;/p&gt;</comment>
                            <comment id="17440815" author="mdrob" created="Mon, 8 Nov 2021 23:36:04 +0000"  >&lt;p&gt;I get the same hang-not-failure behavior when switching the test to use FastLRUCache. Chatting with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dsmiley&quot; class=&quot;user-hover&quot; rel=&quot;dsmiley&quot;&gt;dsmiley&lt;/a&gt;, I think I&apos;m coming around to `isAsync` solution.&lt;/p&gt;</comment>
                            <comment id="17440825" author="mdrob" created="Tue, 9 Nov 2021 00:12:34 +0000"  >&lt;p&gt;can this only happen with &lt;tt&gt;toSearcher.getDocSet&lt;/tt&gt; or do we suspect it is also possible on &lt;tt&gt;fromSearcher.getDocSet&lt;/tt&gt;?&lt;/p&gt;</comment>
                            <comment id="17440866" author="jira-bot" created="Tue, 9 Nov 2021 03:06:39 +0000"  >&lt;p&gt;Commit 4b1ceaabf9afae9a117b3d67f975c6587e3f97ec in lucene-solr&apos;s branch refs/heads/branch_8x from Mike Drob&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=4b1ceaa&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=4b1ceaa&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15762&quot; title=&quot;IllegalStateException: Recursive update thrown when executing complex Join queries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15762&quot;&gt;&lt;del&gt;SOLR-15762&lt;/del&gt;&lt;/a&gt; Error on Join Query with sync cache (#2606)&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15762&quot; title=&quot;IllegalStateException: Recursive update thrown when executing complex Join queries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15762&quot;&gt;&lt;del&gt;SOLR-15762&lt;/del&gt;&lt;/a&gt; Error on Join Query with sync cache&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;When attempting to run a join query using a synchronous filtercache,&lt;br/&gt;
throw an error early with a link to docs rather than a mysterious&lt;br/&gt;
IllegalStateException.&lt;/p&gt;

&lt;p&gt;Co-authored-by: Thomas W&#246;ckinger &amp;lt;two@silbergrau.com&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17440869" author="jira-bot" created="Tue, 9 Nov 2021 03:09:32 +0000"  >&lt;p&gt;Commit f16cc6914bca2a82c2f7967dd41dc6072ab883b2 in lucene-solr&apos;s branch refs/heads/branch_8_11 from Mike Drob&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=f16cc69&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=f16cc69&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15762&quot; title=&quot;IllegalStateException: Recursive update thrown when executing complex Join queries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15762&quot;&gt;&lt;del&gt;SOLR-15762&lt;/del&gt;&lt;/a&gt; Error on Join Query with sync cache (#2606)&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15762&quot; title=&quot;IllegalStateException: Recursive update thrown when executing complex Join queries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15762&quot;&gt;&lt;del&gt;SOLR-15762&lt;/del&gt;&lt;/a&gt; Error on Join Query with sync cache&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;When attempting to run a join query using a synchronous filtercache,&lt;br/&gt;
throw an error early with a link to docs rather than a mysterious&lt;br/&gt;
IllegalStateException.&lt;/p&gt;

&lt;p&gt;Co-authored-by: Thomas W&#246;ckinger &amp;lt;two@silbergrau.com&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17440870" author="jira-bot" created="Tue, 9 Nov 2021 03:10:08 +0000"  >&lt;p&gt;Commit 2d395989017cc28473dbe60d9a1e9e9301bf9112 in solr&apos;s branch refs/heads/main from Mike Drob&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=2d39598&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=2d39598&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15762&quot; title=&quot;IllegalStateException: Recursive update thrown when executing complex Join queries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15762&quot;&gt;&lt;del&gt;SOLR-15762&lt;/del&gt;&lt;/a&gt; Error on Join Query with sync cache&lt;/p&gt;

&lt;p&gt;When attempting to run a join query using a synchronous filtercache,&lt;br/&gt;
throw an error early with a link to docs rather than a mysterious&lt;br/&gt;
IllegalStateException.&lt;/p&gt;

&lt;p&gt;Co-Authored-By: Thomas W&#246;ckinger &amp;lt;two@silbergrau.com&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17440871" author="mdrob" created="Tue, 9 Nov 2021 03:11:18 +0000"  >&lt;p&gt;Thanks for the investigation and getting the patch started, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomas.woeckinger&quot; class=&quot;user-hover&quot; rel=&quot;thomas.woeckinger&quot;&gt;thomas.woeckinger&lt;/a&gt;! Committed to 8x and 9x.&lt;/p&gt;</comment>
                            <comment id="17440877" author="mdrob" created="Tue, 9 Nov 2021 03:30:25 +0000"  >&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  [beaster]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=TestJoin -Dtests.method=testRandomJoin -Dtests.seed=9A51A586CE0AFE54 -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=da-DK -Dtests.timezone=Pacific/Auckland -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1
  [beaster] [21:27:51.257] ERROR   1.15s | TestJoin.testRandomJoin &amp;lt;&amp;lt;&amp;lt;
  [beaster]    &amp;gt; Throwable #1: org.apache.solr.common.SolrException: Using join queries with synchronous filterCache is not supported! Details can be found in Solr Reference Guide under &apos;query-settings-in-solrconfig&apos;.
  [beaster]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([9A51A586CE0AFE54:E3DB6932DC2D50B4]:0)
  [beaster]    &amp;gt; 	at org.apache.solr.search.JoinQuery$JoinQueryWeight.getDocSetEnumerate(JoinQParserPlugin.java:593)
  [beaster]    &amp;gt; 	at org.apache.solr.search.JoinQuery$JoinQueryWeight.getDocSet(JoinQParserPlugin.java:452)
  [beaster]    &amp;gt; 	at org.apache.solr.search.JoinQuery$JoinQueryWeight.scorer(JoinQParserPlugin.java:381)
  [beaster]    &amp;gt; 	at org.apache.lucene.search.Weight.bulkScorer(Weight.java:182)
  [beaster]    &amp;gt; 	at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:656)
  [beaster]    &amp;gt; 	at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:443)
  [beaster]    &amp;gt; 	at org.apache.solr.search.SolrIndexSearcher.buildAndRunCollectorChain(SolrIndexSearcher.java:211)
  [beaster]    &amp;gt; 	at org.apache.solr.search.SolrIndexSearcher.getDocListNC(SolrIndexSearcher.java:1622)
  [beaster]    &amp;gt; 	at org.apache.solr.search.SolrIndexSearcher.getDocListC(SolrIndexSearcher.java:1439)
  [beaster]    &amp;gt; 	at org.apache.solr.search.SolrIndexSearcher.search(SolrIndexSearcher.java:596)
  [beaster]    &amp;gt; 	at org.apache.solr.handler.component.QueryComponent.doProcessUngroupedSearch(QueryComponent.java:1511)
  [beaster]    &amp;gt; 	at org.apache.solr.handler.component.QueryComponent.process(QueryComponent.java:390)
  [beaster]    &amp;gt; 	at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:368)
  [beaster]    &amp;gt; 	at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:216)
  [beaster]    &amp;gt; 	at org.apache.solr.core.SolrCore.execute(SolrCore.java:2637)
  [beaster]    &amp;gt; 	at org.apache.solr.util.TestHarness.query(TestHarness.java:346)
  [beaster]    &amp;gt; 	at org.apache.solr.util.TestHarness.query(TestHarness.java:328)
  [beaster]    &amp;gt; 	at org.apache.solr.TestJoin.testRandomJoin(TestJoin.java:268)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17440910" author="jira-bot" created="Tue, 9 Nov 2021 05:45:53 +0000"  >&lt;p&gt;Commit d362977b58359f64cb2ba9180bb960e5b9c0c822 in lucene-solr&apos;s branch refs/heads/branch_8_11 from Mike Drob&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=d362977&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=d362977&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15762&quot; title=&quot;IllegalStateException: Recursive update thrown when executing complex Join queries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15762&quot;&gt;&lt;del&gt;SOLR-15762&lt;/del&gt;&lt;/a&gt; Always async cache for join query tests&lt;/p&gt;</comment>
                            <comment id="17440911" author="jira-bot" created="Tue, 9 Nov 2021 05:46:10 +0000"  >&lt;p&gt;Commit 9aec87b7d52f628fdb3ed2f46259d0cd0677e4d1 in lucene-solr&apos;s branch refs/heads/branch_8x from Mike Drob&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=9aec87b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=9aec87b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15762&quot; title=&quot;IllegalStateException: Recursive update thrown when executing complex Join queries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15762&quot;&gt;&lt;del&gt;SOLR-15762&lt;/del&gt;&lt;/a&gt; Always async cache for join query tests&lt;/p&gt;</comment>
                            <comment id="17440915" author="jira-bot" created="Tue, 9 Nov 2021 06:03:39 +0000"  >&lt;p&gt;Commit 9fe0ce4b79913606ade3d0f16cd434f5d3fad9c8 in solr&apos;s branch refs/heads/main from Mike Drob&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=9fe0ce4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=9fe0ce4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15762&quot; title=&quot;IllegalStateException: Recursive update thrown when executing complex Join queries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15762&quot;&gt;&lt;del&gt;SOLR-15762&lt;/del&gt;&lt;/a&gt; Always async cache for join query tests&lt;/p&gt;</comment>
                            <comment id="17440916" author="mdrob" created="Tue, 9 Nov 2021 06:04:21 +0000"  >&lt;p&gt;Fixed up the solr join query tests, should be good now.&lt;/p&gt;</comment>
                            <comment id="17441013" author="jpountz" created="Tue, 9 Nov 2021 09:30:46 +0000"  >&lt;p&gt;Thanks all!&lt;/p&gt;</comment>
                            <comment id="17445222" author="jpountz" created="Wed, 17 Nov 2021 14:22:46 +0000"  >&lt;p&gt;Closing after the 8.11 release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13035709" name="ParameterizedJoinQueryTest.java" size="3960" author="thomas.woeckinger" created="Thu, 4 Nov 2021 22:54:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 51 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0wegg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>