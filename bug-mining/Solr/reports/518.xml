<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:19:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-2051] analysis.jsp is incorrect for protWords etc</title>
                <link>https://issues.apache.org/jira/browse/SOLR-2051</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Analysis.jsp gives the incorrect results if you use &quot;protwords.txt&quot; or &quot;stemdict.txt&quot; or the like.&lt;/p&gt;

&lt;p&gt;This is because this is now implemented with KeywordAttribute (so you can easily override any stemmer etc).&lt;/p&gt;

&lt;p&gt;For example, if your schema had &quot;foobars&quot; in protwords.txt, analysis.jsp would show it being stemmed to &quot;foobar&quot;, even though this doesnt actually happen.&lt;/p&gt;

&lt;p&gt;The problem is that this jsp is downconverting the entire tokenstream to Token in between processing, so it silently discards KeywordAttribute and you get the wrong result.&lt;/p&gt;

&lt;p&gt;Note: this issue isnt about &lt;b&gt;displaying&lt;/b&gt; other attributes such as KeywordAttribute (which would be a new feature). Its about not throwing them away so that the analysis actually represents what happens.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12471729">SOLR-2051</key>
            <summary>analysis.jsp is incorrect for protWords etc</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Mon, 16 Aug 2010 17:59:25 +0000</created>
                <updated>Thu, 16 Feb 2017 15:55:03 +0000</updated>
                            <resolved>Mon, 16 Aug 2010 23:25:52 +0000</resolved>
                                    <version>3.1</version>
                    <version>4.0-ALPHA</version>
                                                    <component>Admin UI</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12899023" author="rcmuir" created="Mon, 16 Aug 2010 18:36:44 +0000"  >&lt;p&gt;attached is a patch that uses AttributeSource.copyTo to preserve any custom attributes that might be in the stream.&lt;/p&gt;

&lt;p&gt;additionally i added some logic for non-stringable terms (it will just print the bytes in hex)&lt;/p&gt;</comment>
                            <comment id="12899028" author="rcmuir" created="Mon, 16 Aug 2010 18:42:34 +0000"  >&lt;p&gt;you can reproduce this easily / verify it is now correct by going to the analysis.jsp, turning on verbose output, and entering &quot;dontstems&quot; for field type &quot;text&quot;, as its already in the protwords.txt&lt;/p&gt;

&lt;p&gt;without the patch you will see it being stemmed.&lt;/p&gt;</comment>
                            <comment id="12899100" author="rcmuir" created="Mon, 16 Aug 2010 21:26:30 +0000"  >&lt;p&gt;here is a slightly improved patch, but still this jsp file is scary.&lt;/p&gt;

&lt;p&gt;i wonder if we can use tee/sinks to do this cleaner?&lt;/p&gt;</comment>
                            <comment id="12899109" author="yseeley@gmail.com" created="Mon, 16 Aug 2010 21:45:02 +0000"  >&lt;p&gt;Ah, yeah, good catch!&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;i wonder if we can use tee/sinks to do this cleaner?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Insert a tap after each filter?  Yeah, might be safer by more closely emulating how the analysis actually works.&lt;br/&gt;
For example, if someone develops some whacky filters that rely on thread locals to pass info or something.&lt;/p&gt;

&lt;p&gt;Since it looks like you&apos;ve fixed it already, I&apos;d just commit that though.&lt;/p&gt;</comment>
                            <comment id="12899115" author="rcmuir" created="Mon, 16 Aug 2010 21:56:05 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Insert a tap after each filter? Yeah, might be safer by more closely emulating how the analysis actually works.&lt;br/&gt;
For example, if someone develops some whacky filters that rely on thread locals to pass info or something.&lt;/p&gt;

&lt;p&gt;Since it looks like you&apos;ve fixed it already, I&apos;d just commit that though.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well, Uwe suggested CachingTokenFilter as one idea, we could keep the same overall flow. &lt;/p&gt;

&lt;p&gt;A &apos;printing tap&apos; after each filter seems even better though... lemme try it and worse case we have this as the fix for now.&lt;/p&gt;</comment>
                            <comment id="12899133" author="thetaphi" created="Mon, 16 Aug 2010 22:14:55 +0000"  >&lt;p&gt;After a discussion with Robert, I also think that a Tap would be an elegant and less intrusive aproach (from the TokenStreams point of view). The Whole thing would simply create the Tokenizer, wrap the tap-filter around then add the next filter in chain, again add the tap again, and so on.&lt;/p&gt;

&lt;p&gt;The filter simply calls input.increametToken() and then prints the current attributes. It can also hold a local &quot;pos&quot; field that is updated with positionIncrement to do formatting right. The code to resort tokens when negative position increments occur is useless, as Lucene no longer allows negative position increments (from what I know). The whole JSP would use no caching lists of tokens, no iterators, no array copy, no copyTo(). It just builds a tokenstream and consumes it. The Tap filter can also be added around the generic (non TokenizerChain Lucene Analyzer). The main code would simply do &quot;while (ts.incrementToken())&quot; - nothing more. All printout is done in the filters added between each chain step (or after the generic lucene analyzer).&lt;/p&gt;</comment>
                            <comment id="12899178" author="rcmuir" created="Mon, 16 Aug 2010 23:16:27 +0000"  >&lt;p&gt;ok, i had a look at reworking this as we discussed, but its more complicated&lt;br/&gt;
due to &quot;highlight matches&quot; etc.&lt;/p&gt;

&lt;p&gt;So for now, heres the bugfix (same as before except it creates the fake tokenstream with the same factory as what the filter uses)&lt;/p&gt;

&lt;p&gt;i&apos;ll commit this and we should open another issue for reworking this, and probably printing all attributes when we do that.&lt;/p&gt;</comment>
                            <comment id="12899183" author="rcmuir" created="Mon, 16 Aug 2010 23:25:52 +0000"  >&lt;p&gt;Committed revision 986158, 986160&lt;/p&gt;</comment>
                            <comment id="12899358" author="thetaphi" created="Tue, 17 Aug 2010 09:36:12 +0000"  >&lt;p&gt;For performance reasons, I would move&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; AttributeSource token = iter.next();
Iterator&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;? &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Attribute&amp;gt;&amp;gt; atts = token.getAttributeClassesIterator();
&lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (atts.hasNext()) &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.addAttribute(atts.next());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;to the ctor of the helper tokenstream. This is the same how TeeSink and all other tokenstreams work. Adding attributes later in the tokenstreams incrementToken() is not allowed, so you can be sure that after the original tokenstreams ctor was executed all attributes are available. Doing this on each incrementToken is the same like if indexer would do this on each incrementToken call.&lt;/p&gt;</comment>
                            <comment id="12899363" author="thetaphi" created="Tue, 17 Aug 2010 10:08:05 +0000"  >&lt;p&gt;Ah, I understand the problem. So ignore my last message: The printTokens method adds attributes that may not exist to the cloned AttributeSources. After that copyTo to the original stream does not work.&lt;/p&gt;

&lt;p&gt;Just an idea: Would it make sense, to let copyTo() automatically add missing target attributes? copyTo() is new in 3.x and trunk, so we can still change how it works.&lt;/p&gt;</comment>
                            <comment id="12899367" author="thetaphi" created="Tue, 17 Aug 2010 10:28:02 +0000"  >&lt;p&gt;Here the more dynamic AS, that adds missing attribute impls on restoreState() and copyTo(). This is just an idea, the AS test does not pass, as it checks for the exception previously thrown.&lt;/p&gt;

&lt;p&gt;I changed analysis.jsp to use this. Sorry for formatting changes, but my editor fixed the tabs.&lt;/p&gt;

&lt;p&gt;I am not sure, if this is good, as it may add tokenstreams attributes after the ctor which is discouraged and can lead to unexspected behaviour on the consumer, especially if factories dont match correct between source and target (in both cases, copyTo and restoreState). Ideally on copyTo(), the AS should check that AF is identical.&lt;/p&gt;</comment>
                            <comment id="12899415" author="rcmuir" created="Tue, 17 Aug 2010 14:15:43 +0000"  >&lt;blockquote&gt;&lt;p&gt;Just an idea: Would it make sense, to let copyTo() automatically add missing target attributes&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Not sure, this wouldn&apos;t help the typical buffering case like SynonymFilter? I think this analysis.jsp&lt;br/&gt;
that crosses the tokenstreams is an extremely special case.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12452228" name="SOLR-2051.patch" size="8714" author="rcmuir" created="Mon, 16 Aug 2010 23:16:27 +0000"/>
                            <attachment id="12452216" name="SOLR-2051.patch" size="8629" author="rcmuir" created="Mon, 16 Aug 2010 21:26:29 +0000"/>
                            <attachment id="12452197" name="SOLR-2051.patch" size="8622" author="rcmuir" created="Mon, 16 Aug 2010 18:36:44 +0000"/>
                            <attachment id="12452274" name="dynamic-AttributeSource.patch" size="6325" author="uschindler" created="Tue, 17 Aug 2010 10:28:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5441</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 15 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03n33:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19173</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>