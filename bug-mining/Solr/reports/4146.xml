<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:37:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-13234] Prometheus Metric Exporter Not Threadsafe</title>
                <link>https://issues.apache.org/jira/browse/SOLR-13234</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;The Solr Prometheus Exporter collects metrics when it receives a HTTP request from Prometheus. Prometheus sends this request, on its &lt;a href=&quot;https://prometheus.io/docs/prometheus/latest/configuration/configuration/#scrape_config&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;scrape interval&lt;/a&gt;. When the time taken to collect the Solr metrics is greater than the scrape interval of the Prometheus server, this results in concurrent metric collection occurring in this &lt;a href=&quot;https://github.com/apache/lucene-solr/blob/master/solr/contrib/prometheus-exporter/src/java/org/apache/solr/prometheus/collector/SolrCollector.java#L86&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;method&lt;/a&gt;. This method doesn&#8217;t appear to be thread safe, for instance you could have concurrent modifications of a &lt;a href=&quot;https://github.com/apache/lucene-solr/blob/master/solr/contrib/prometheus-exporter/src/java/org/apache/solr/prometheus/collector/SolrCollector.java#L119&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;map&lt;/a&gt;. After a while the Solr Exporter processes becomes nondeterministic, we&apos;ve observed NPE and loss of metrics.&lt;/p&gt;

&lt;p&gt;To address this, I&apos;m proposing the following fixes:&lt;/p&gt;

&lt;p&gt;1. Read/parse the configuration at startup and make it immutable.&#160;&lt;br/&gt;
 2. Collect metrics from Solr on an interval which is controlled by the Solr Exporter and cache the metric samples to return during Prometheus scraping. Metric collection can be expensive, for example executing arbitrary Solr searches, it&apos;s not ideal to allow for concurrent metric collection and on an interval which is not defined by the Solr Exporter.&lt;/p&gt;

&lt;p&gt;There are also a few other performance improvements that we&apos;ve made while fixing this, for example using the ClusterStateProvider instead of sending multiple HTTP requests to each Solr node to lookup all the cores.&lt;/p&gt;

&lt;p&gt;I&apos;m currently finishing up these changes which I&apos;ll submit as a PR.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13214654">SOLR-13234</key>
            <summary>Prometheus Metric Exporter Not Threadsafe</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shalin">Shalin Shekhar Mangar</assignee>
                                    <reporter username="danyal">Danyal Prout</reporter>
                        <labels>
                            <label>metric-collector</label>
                    </labels>
                <created>Fri, 8 Feb 2019 15:52:42 +0000</created>
                <updated>Wed, 11 Sep 2024 20:49:51 +0000</updated>
                            <resolved>Thu, 14 Mar 2019 05:48:27 +0000</resolved>
                                    <version>7.6</version>
                    <version>8.0</version>
                                    <fixVersion>7.7.2</fixVersion>
                    <fixVersion>8.1</fixVersion>
                    <fixVersion>9.0</fixVersion>
                                    <component>contrib - prometheus-exporter</component>
                    <component>metrics</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="16767459" author="danyal" created="Wed, 13 Feb 2019 18:48:02 +0000"  >&lt;p&gt;Ran ant precommit on the linked PR last night. Had a few small issues which I pushed a fix for and now it&apos;s passing successfully.&lt;/p&gt;

&lt;p&gt;ant test from the root of the repo, appears to have a few flaky tests, that don&apos;t seem to be linked to the solr-prometheus-exporter. (just running the exporter tests seems to be fine).&lt;/p&gt;</comment>
                            <comment id="16767538" author="erickerickson" created="Wed, 13 Feb 2019 19:58:30 +0000"  >&lt;p&gt;FWIW, you can see historically test results here:&lt;br/&gt;
&lt;a href=&quot;http://fucit.org/solr-jenkins-reports/failure-report.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://fucit.org/solr-jenkins-reports/failure-report.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16769623" author="danyal" created="Fri, 15 Feb 2019 19:30:17 +0000"  >&lt;p&gt;Thanks Erick. That&apos;s good to know &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/thumbs_up.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16775717" author="shalinmangar" created="Sat, 23 Feb 2019 00:28:58 +0000"  >&lt;p&gt;Thanks Danyal, great stuff!&lt;/p&gt;

&lt;p&gt;A few comments:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;In SolrCloudScraper.pingAllCores and metricsForAllHosts methods, any exception thrown during the ping (inside the function passed to the sendRequestsInParallel method) will cause the http clients to leak. The call to closeAll should be in a try-finally clause.&lt;/li&gt;
	&lt;li&gt;We should have some sane defaults for connection and read timeout on the HttpSolrClient that is created. Even better if we can set a value through the configuration.&lt;/li&gt;
	&lt;li&gt;Related to the above, it&apos;d be nice to create an HttpClient instance using values loaded from the configuration and use it across all the different CloudSolrClient and HttpSolrClient instances that are created. That way, the http connections can be re-used during ping and fetching metrics.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="16779756" author="shalinmangar" created="Wed, 27 Feb 2019 20:53:48 +0000"  >&lt;p&gt;Thanks for the updates to the PR Danyal. It looks good to me. If there are no objections, I&apos;ll merge it tomorrow.&lt;/p&gt;</comment>
                            <comment id="16782977" author="jira-bot" created="Mon, 4 Mar 2019 05:33:03 +0000"  >&lt;p&gt;Commit 1f9c767aac76ac1618ccaffce42524e109335fe8 in lucene-solr&apos;s branch refs/heads/master from Shalin Shekhar Mangar&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=1f9c767&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=1f9c767&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13234&quot; title=&quot;Prometheus Metric Exporter Not Threadsafe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13234&quot;&gt;&lt;del&gt;SOLR-13234&lt;/del&gt;&lt;/a&gt;: Prometheus Metric Exporter not threadsafe.&lt;/p&gt;

&lt;p&gt;This changes the prometheus exporter to collect metrics from Solr on a fixed interval controlled by this tool and prevents concurrent collections. This change also improves performance slightly by using the cluster state instead of sending multiple HTTP requests to each node to lookup all the cores.&lt;/p&gt;

&lt;p&gt;This closes #571.&lt;/p&gt;</comment>
                            <comment id="16782979" author="jira-bot" created="Mon, 4 Mar 2019 05:34:53 +0000"  >&lt;p&gt;Commit 02eb9d34404b8fc7225ee7c5c867e194afae17a0 in lucene-solr&apos;s branch refs/heads/branch_8x from Shalin Shekhar Mangar&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=02eb9d3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=02eb9d3&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13234&quot; title=&quot;Prometheus Metric Exporter Not Threadsafe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13234&quot;&gt;&lt;del&gt;SOLR-13234&lt;/del&gt;&lt;/a&gt;: Prometheus Metric Exporter not threadsafe.&lt;/p&gt;

&lt;p&gt;This changes the prometheus exporter to collect metrics from Solr on a fixed interval controlled by this tool and prevents concurrent collections. This change also improves performance slightly by using the cluster state instead of sending multiple HTTP requests to each node to lookup all the cores.&lt;/p&gt;

&lt;p&gt;This closes #571.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 1f9c767aac76ac1618ccaffce42524e109335fe8)&lt;/p&gt;</comment>
                            <comment id="16782984" author="shalinmangar" created="Mon, 4 Mar 2019 05:43:58 +0000"  >&lt;p&gt;Thanks Danyal. I added a blurb about the scrape interval to the reference guide as well. I&apos;ll try to backport this to branch_7x and branch_7_7 as well.&lt;/p&gt;</comment>
                            <comment id="16784016" author="shalinmangar" created="Tue, 5 Mar 2019 03:07:20 +0000"  >&lt;p&gt;Here is a patch that applies on branch_7x. I&apos;ll commit after running precommit and tests.&lt;/p&gt;</comment>
                            <comment id="16784057" author="jira-bot" created="Tue, 5 Mar 2019 04:40:13 +0000"  >&lt;p&gt;Commit e1eeafb5dc077976646b06f4cba4d77534963fa9 in lucene-solr&apos;s branch refs/heads/branch_7x from Shalin Shekhar Mangar&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=e1eeafb&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=e1eeafb&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13234&quot; title=&quot;Prometheus Metric Exporter Not Threadsafe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13234&quot;&gt;&lt;del&gt;SOLR-13234&lt;/del&gt;&lt;/a&gt;: Prometheus Metric Exporter not threadsafe.&lt;/p&gt;

&lt;p&gt;This changes the prometheus exporter to collect metrics from Solr on a fixed interval controlled by this tool and prevents concurrent collections. This change also improves performance slightly by using the cluster state instead of sending multiple HTTP requests to each node to lookup all the cores.&lt;/p&gt;

&lt;p&gt;This closes #571.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 1f9c767aac76ac1618ccaffce42524e109335fe8)&lt;/p&gt;</comment>
                            <comment id="16784058" author="jira-bot" created="Tue, 5 Mar 2019 04:41:00 +0000"  >&lt;p&gt;Commit 9f9d65d6ec9b54bf903702620c41acc75b481809 in lucene-solr&apos;s branch refs/heads/branch_7x from Shalin Shekhar Mangar&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=9f9d65d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=9f9d65d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13234&quot; title=&quot;Prometheus Metric Exporter Not Threadsafe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13234&quot;&gt;&lt;del&gt;SOLR-13234&lt;/del&gt;&lt;/a&gt;: Adding CHANGES.txt entry under 7.8.0 section&lt;/p&gt;</comment>
                            <comment id="16784061" author="jira-bot" created="Tue, 5 Mar 2019 04:42:55 +0000"  >&lt;p&gt;Commit 2726c8ce8e80f4b51498410eb212fb8d8066ca5e in lucene-solr&apos;s branch refs/heads/branch_7_7 from Shalin Shekhar Mangar&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=2726c8c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=2726c8c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13234&quot; title=&quot;Prometheus Metric Exporter Not Threadsafe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13234&quot;&gt;&lt;del&gt;SOLR-13234&lt;/del&gt;&lt;/a&gt;: Prometheus Metric Exporter not threadsafe.&lt;/p&gt;

&lt;p&gt;This changes the prometheus exporter to collect metrics from Solr on a fixed interval controlled by this tool and prevents concurrent collections. This change also improves performance slightly by using the cluster state instead of sending multiple HTTP requests to each node to lookup all the cores.&lt;/p&gt;

&lt;p&gt;This closes #571.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 1f9c767aac76ac1618ccaffce42524e109335fe8)&lt;/p&gt;</comment>
                            <comment id="16784067" author="shalinmangar" created="Tue, 5 Mar 2019 04:50:22 +0000"  >&lt;p&gt;The fix will be released with Solr 8.1.0 and 7.7.2 releases.&lt;/p&gt;

&lt;p&gt;Thanks Danyal!&lt;/p&gt;</comment>
                            <comment id="16784225" author="jira-bot" created="Tue, 5 Mar 2019 08:56:55 +0000"  >&lt;p&gt;Commit b15dfbc7a90bc49e8d27daf0d96e5c7fb6b63578 in lucene-solr&apos;s branch refs/heads/branch_8x from Adrien Grand&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=b15dfbc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=b15dfbc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13234&quot; title=&quot;Prometheus Metric Exporter Not Threadsafe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13234&quot;&gt;&lt;del&gt;SOLR-13234&lt;/del&gt;&lt;/a&gt;: Remove 9.0 from Solr changes.&lt;/p&gt;</comment>
                            <comment id="16784277" author="shalinmangar" created="Tue, 5 Mar 2019 10:03:26 +0000"  >&lt;p&gt;Thanks for fixing the CHANGES.txt, Adrien!&lt;/p&gt;</comment>
                            <comment id="16784553" author="danyal" created="Tue, 5 Mar 2019 15:15:55 +0000"  >&lt;p&gt;Thanks for all the help Shalin! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16788187" author="hossman" created="Fri, 8 Mar 2019 18:51:46 +0000"  >&lt;p&gt;Shalin: several jenkins failures from SolrExporterIntegrationTest.jvmMetrics in the few days since you&apos;ve committed this, including this seed that reproduces reliably for me on master...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=SolrExporterIntegrationTest -Dtests.method=jvmMetrics -Dtests.seed=D0408796D2DB58EC -Dtests.multiplier=3 -Dtests.slow=true -Dtests.badapples=true -Dtests.locale=tr-TR -Dtests.timezone=America/Argentina/Mendoza -Dtests.asserts=true -Dtests.file.encoding=ISO-8859-1
   [junit4] FAILURE 3.92s | SolrExporterIntegrationTest.jvmMetrics &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: expected:&amp;lt;4&amp;gt; but was:&amp;lt;0&amp;gt;
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([D0408796D2DB58EC:3F4BA79C7359478]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.prometheus.exporter.SolrExporterIntegrationTest.jvmMetrics(SolrExporterIntegrationTest.java:68)
   [junit4]    &amp;gt; 	at java.lang.Thread.run(Thread.java:748)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and this seed which was reported by 8.x jenkins but also reproduces on master...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   [junit4]   2&amp;gt; NOTE: reproduce with: ant test  -Dtestcase=SolrExporterIntegrationTest -Dtests.method=jvmMetrics -Dtests.seed=62880F3B9F140C89 -Dtests.multiplier=2 -Dtests.nightly=true -Dtests.slow=true -Dtests.badapples=true -Dtests.linedocsfile=/home/jenkins/jenkins-slave/workspace/Lucene-Solr-NightlyTests-8.x/test-data/enwiki.random.lines.txt -Dtests.locale=tr-TR -Dtests.timezone=Asia/Novokuznetsk -Dtests.asserts=true -Dtests.file.encoding=US-ASCII
   [junit4] FAILURE 3.40s | SolrExporterIntegrationTest.jvmMetrics &amp;lt;&amp;lt;&amp;lt;
   [junit4]    &amp;gt; Throwable #1: java.lang.AssertionError: expected:&amp;lt;4&amp;gt; but was:&amp;lt;0&amp;gt;
   [junit4]    &amp;gt; 	at __randomizedtesting.SeedInfo.seed([62880F3B9F140C89:B13C32D48AFAC01D]:0)
   [junit4]    &amp;gt; 	at org.apache.solr.prometheus.exporter.SolrExporterIntegrationTest.jvmMetrics(SolrExporterIntegrationTest.java:68)
   [junit4]    &amp;gt; 	at java.lang.Thread.run(Thread.java:748)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16788237" author="danyal" created="Fri, 8 Mar 2019 19:37:37 +0000"  >&lt;p&gt;Thanks for finding this Hoss. My bad, I&apos;ve just looked at the test and the intent is to see if there are any Solr JVM metrics for each node being reported by the exporter. However it specifically looks for the count of terminated threads, I suspect in this case no threads have currently been terminated.&lt;/p&gt;

&lt;p&gt;It should be a pretty simple update to fix this test. I can send a PR tonight/tomorrow morning to address this. However I&apos;m not sure if it&apos;s best to open a new PR or add an additional commit to the original one.&lt;/p&gt;</comment>
                            <comment id="16788438" author="shalinmangar" created="Sat, 9 Mar 2019 01:49:34 +0000"  >&lt;p&gt;Thanks Hoss.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=danyal&quot; class=&quot;user-hover&quot; rel=&quot;danyal&quot;&gt;danyal&lt;/a&gt; - I am not sure either but a new PR will probably be easier to merge.&lt;/p&gt;</comment>
                            <comment id="16790020" author="danyal" created="Mon, 11 Mar 2019 22:24:02 +0000"  >&lt;p&gt;Sorry for the delay in looking at this. Just pushed a PR which fixes this test case here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/lucene-solr/pull/605&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/lucene-solr/pull/605&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It was due to the Prometheus label &quot;terminated&quot; in the test not being localized, but the label from Solr being localized to &quot;term&#305;nated&quot; {{}} on a JVM with Turkish locale. I&apos;ve removed checking the actual label as these could change based on JVM config and instead checked that we get the correct number of labels back for JVM thread settings (which I think is potentially a more complete test).&lt;/p&gt;</comment>
                            <comment id="16792358" author="jira-bot" created="Thu, 14 Mar 2019 05:41:02 +0000"  >&lt;p&gt;Commit 6d0386c901b9d14c7464c7cf286d4a005eb9c72c in lucene-solr&apos;s branch refs/heads/master from Shalin Shekhar Mangar&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=6d0386c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=6d0386c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13234&quot; title=&quot;Prometheus Metric Exporter Not Threadsafe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13234&quot;&gt;&lt;del&gt;SOLR-13234&lt;/del&gt;&lt;/a&gt;: Fix for turkish locales&lt;/p&gt;

&lt;p&gt;WhenSolrExporterIntegrationTest.jvmMetrics ran on a JVM with the Turkish locale, (test seed: 62880F3B9F140C89). The JVM metric for terminated thread-count has a dotless-i e.g. term&#305;nated.&lt;br/&gt;
This causes the check for matching metrics to fail.&lt;/p&gt;

&lt;p&gt;We could normalize the text in this case, however I think it&apos;s better to ensure we have the correct total number of JVM thread metrics rather than looking at Prometheus labels which maybe localized.&lt;/p&gt;

&lt;p&gt;This closes #605.&lt;/p&gt;</comment>
                            <comment id="16792359" author="jira-bot" created="Thu, 14 Mar 2019 05:42:47 +0000"  >&lt;p&gt;Commit cedff86aaaee70a28bd56372666b88f21381c975 in lucene-solr&apos;s branch refs/heads/branch_8x from Shalin Shekhar Mangar&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=cedff86&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=cedff86&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13234&quot; title=&quot;Prometheus Metric Exporter Not Threadsafe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13234&quot;&gt;&lt;del&gt;SOLR-13234&lt;/del&gt;&lt;/a&gt;: Fix for turkish locales&lt;/p&gt;

&lt;p&gt;WhenSolrExporterIntegrationTest.jvmMetrics ran on a JVM with the Turkish locale, (test seed: 62880F3B9F140C89). The JVM metric for terminated thread-count has a dotless-i e.g. term&#305;nated.&lt;br/&gt;
This causes the check for matching metrics to fail.&lt;/p&gt;

&lt;p&gt;We could normalize the text in this case, however I think it&apos;s better to ensure we have the correct total number of JVM thread metrics rather than looking at Prometheus labels which maybe localized.&lt;/p&gt;

&lt;p&gt;This closes #605.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 6d0386c901b9d14c7464c7cf286d4a005eb9c72c)&lt;/p&gt;</comment>
                            <comment id="16792360" author="jira-bot" created="Thu, 14 Mar 2019 05:46:08 +0000"  >&lt;p&gt;Commit 5507d77e01b0f90700d8b760a703f09a94f587eb in lucene-solr&apos;s branch refs/heads/branch_7x from Shalin Shekhar Mangar&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=5507d77&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=5507d77&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13234&quot; title=&quot;Prometheus Metric Exporter Not Threadsafe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13234&quot;&gt;&lt;del&gt;SOLR-13234&lt;/del&gt;&lt;/a&gt;: Fix for turkish locales&lt;/p&gt;

&lt;p&gt;WhenSolrExporterIntegrationTest.jvmMetrics ran on a JVM with the Turkish locale, (test seed: 62880F3B9F140C89). The JVM metric for terminated thread-count has a dotless-i e.g. term&#305;nated.&lt;br/&gt;
This causes the check for matching metrics to fail.&lt;/p&gt;

&lt;p&gt;We could normalize the text in this case, however I think it&apos;s better to ensure we have the correct total number of JVM thread metrics rather than looking at Prometheus labels which maybe localized.&lt;/p&gt;

&lt;p&gt;This closes #605.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 6d0386c901b9d14c7464c7cf286d4a005eb9c72c)&lt;/p&gt;</comment>
                            <comment id="16792361" author="jira-bot" created="Thu, 14 Mar 2019 05:46:47 +0000"  >&lt;p&gt;Commit 29179f448abaa57e7eceabbbbeb881f39a5e1edd in lucene-solr&apos;s branch refs/heads/branch_7_7 from Shalin Shekhar Mangar&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=29179f4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=29179f4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13234&quot; title=&quot;Prometheus Metric Exporter Not Threadsafe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13234&quot;&gt;&lt;del&gt;SOLR-13234&lt;/del&gt;&lt;/a&gt;: Fix for turkish locales&lt;/p&gt;

&lt;p&gt;WhenSolrExporterIntegrationTest.jvmMetrics ran on a JVM with the Turkish locale, (test seed: 62880F3B9F140C89). The JVM metric for terminated thread-count has a dotless-i e.g. term&#305;nated.&lt;br/&gt;
This causes the check for matching metrics to fail.&lt;/p&gt;

&lt;p&gt;We could normalize the text in this case, however I think it&apos;s better to ensure we have the correct total number of JVM thread metrics rather than looking at Prometheus labels which maybe localized.&lt;/p&gt;

&lt;p&gt;This closes #605.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 6d0386c901b9d14c7464c7cf286d4a005eb9c72c)&lt;/p&gt;</comment>
                            <comment id="16792363" author="shalinmangar" created="Thu, 14 Mar 2019 05:48:20 +0000"  >&lt;p&gt;Thanks for fixing Danyal!&lt;/p&gt;</comment>
                            <comment id="16822903" author="jira-bot" created="Mon, 22 Apr 2019 06:49:11 +0000"  >&lt;p&gt;Commit 4571a2d66687cca6670885a94414c7a8c02c0bbc in lucene-solr&apos;s branch refs/heads/master from Shalin Shekhar Mangar&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=4571a2d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=4571a2d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13392&quot; title=&quot;Unable to start prometheus-exporter in 7x branch&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13392&quot;&gt;&lt;del&gt;SOLR-13392&lt;/del&gt;&lt;/a&gt;: Add all solr dependencies to prometheus exporter classpath to make sure that it can start.&lt;/p&gt;

&lt;p&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13234&quot; title=&quot;Prometheus Metric Exporter Not Threadsafe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13234&quot;&gt;&lt;del&gt;SOLR-13234&lt;/del&gt;&lt;/a&gt; broke prometheus exporter startup from the startup scripts because there was a mismatch between the dependency list in ant/ivy and those actually added to the classpath by the script. This commit changes the script to add all solr dependencies to the classpath.&lt;/p&gt;</comment>
                            <comment id="16822905" author="jira-bot" created="Mon, 22 Apr 2019 06:50:03 +0000"  >&lt;p&gt;Commit fe02666d5445db51c1d34aef925042a81c7eff69 in lucene-solr&apos;s branch refs/heads/branch_8x from Shalin Shekhar Mangar&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=fe02666&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=fe02666&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13392&quot; title=&quot;Unable to start prometheus-exporter in 7x branch&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13392&quot;&gt;&lt;del&gt;SOLR-13392&lt;/del&gt;&lt;/a&gt;: Add all solr dependencies to prometheus exporter classpath to make sure that it can start.&lt;/p&gt;

&lt;p&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13234&quot; title=&quot;Prometheus Metric Exporter Not Threadsafe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13234&quot;&gt;&lt;del&gt;SOLR-13234&lt;/del&gt;&lt;/a&gt; broke prometheus exporter startup from the startup scripts because there was a mismatch between the dependency list in ant/ivy and those actually added to the classpath by the script. This commit changes the script to add all solr dependencies to the classpath.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 4571a2d66687cca6670885a94414c7a8c02c0bbc)&lt;/p&gt;</comment>
                            <comment id="16822908" author="jira-bot" created="Mon, 22 Apr 2019 06:51:01 +0000"  >&lt;p&gt;Commit a5f75c62c33738bfbbabb439ebbfc1b143b0c4b9 in lucene-solr&apos;s branch refs/heads/branch_7x from Shalin Shekhar Mangar&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=a5f75c6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=a5f75c6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13392&quot; title=&quot;Unable to start prometheus-exporter in 7x branch&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13392&quot;&gt;&lt;del&gt;SOLR-13392&lt;/del&gt;&lt;/a&gt;: Add all solr dependencies to prometheus exporter classpath to make sure that it can start.&lt;/p&gt;

&lt;p&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13234&quot; title=&quot;Prometheus Metric Exporter Not Threadsafe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13234&quot;&gt;&lt;del&gt;SOLR-13234&lt;/del&gt;&lt;/a&gt; broke prometheus exporter startup from the startup scripts because there was a mismatch between the dependency list in ant/ivy and those actually added to the classpath by the script. This commit changes the script to add all solr dependencies to the classpath.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 4571a2d66687cca6670885a94414c7a8c02c0bbc)&lt;/p&gt;</comment>
                            <comment id="16822910" author="jira-bot" created="Mon, 22 Apr 2019 06:52:23 +0000"  >&lt;p&gt;Commit 111aa6a820b1cf70ba33192e9615a219187965a4 in lucene-solr&apos;s branch refs/heads/branch_7_7 from Shalin Shekhar Mangar&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=111aa6a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=111aa6a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13392&quot; title=&quot;Unable to start prometheus-exporter in 7x branch&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13392&quot;&gt;&lt;del&gt;SOLR-13392&lt;/del&gt;&lt;/a&gt;: Add all solr dependencies to prometheus exporter classpath to make sure that it can start.&lt;/p&gt;

&lt;p&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-13234&quot; title=&quot;Prometheus Metric Exporter Not Threadsafe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-13234&quot;&gt;&lt;del&gt;SOLR-13234&lt;/del&gt;&lt;/a&gt; broke prometheus exporter startup from the startup scripts because there was a mismatch between the dependency list in ant/ivy and those actually added to the classpath by the script. This commit changes the script to add all solr dependencies to the classpath.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 4571a2d66687cca6670885a94414c7a8c02c0bbc)&lt;/p&gt;</comment>
                            <comment id="16839293" author="mdp" created="Tue, 14 May 2019 10:17:06 +0000"  >&lt;p&gt;Wouldn&apos;t it be worth noting somewhere that this goes against the best practices for writing exporters given in &lt;a href=&quot;https://prometheus.io/docs/instrumenting/writing_exporters/#scheduling&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Prometheus documentation&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="16857067" author="janhoy" created="Wed, 5 Jun 2019 21:30:47 +0000"  >&lt;p&gt;Closing after the 7.7.2 release&lt;/p&gt;</comment>
                            <comment id="17881123" author="dsmiley" created="Wed, 11 Sep 2024 20:49:51 +0000"  >&lt;p&gt;Years later, observing this PR creates an Http SolrClient per node.  This isn&apos;t necessary; one can be used for all the nodes.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13227355">SOLR-13392</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12961106" name="SOLR-13234-branch_7x.patch" size="423619" author="shalin" created="Tue, 5 Mar 2019 04:22:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 8 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|yi0spc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>