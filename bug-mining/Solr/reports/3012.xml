<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:14:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-9181] ZkStateReaderTest failure</title>
                <link>https://issues.apache.org/jira/browse/SOLR-9181</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/job/Lucene-Solr-Tests-6.x/243/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Lucene-Solr-Tests-6.x/243/&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12975144">SOLR-9181</key>
            <summary>ZkStateReaderTest failure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="romseygeek">Alan Woodward</assignee>
                                    <reporter username="romseygeek">Alan Woodward</reporter>
                        <labels>
                    </labels>
                <created>Thu, 2 Jun 2016 12:22:17 +0000</created>
                <updated>Fri, 26 Aug 2016 14:00:26 +0000</updated>
                            <resolved>Fri, 1 Jul 2016 15:14:36 +0000</resolved>
                                                    <fixVersion>6.2</fixVersion>
                    <fixVersion>7.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15312222" author="romseygeek" created="Thu, 2 Jun 2016 12:24:48 +0000"  >&lt;p&gt;This is a test bug, I think.  There&apos;s a race when a collection is migrated from state format 1 to state format 2, where the state reader may briefly see the collection removed from collectionstate.json before it sees the new collection/state.json znode.  The test fails to take that into account, and assumes that clusterState.getCollection() will always return a DocCollection object.  It can be fixed by using waitForState() instead of polling.  I&apos;ll put up a patch shortly.&lt;/p&gt;</comment>
                            <comment id="15312320" author="romseygeek" created="Thu, 2 Jun 2016 13:48:22 +0000"  >&lt;p&gt;Patch.  This also uncovered a couple of bugs in the collection state watcher API to do with collections in state format 1:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;format-1-collections wouldn&apos;t trigger notifications on updates if they hadn&apos;t already been registered&lt;/li&gt;
	&lt;li&gt;registering a watcher on a format-1 collection wouldn&apos;t check the current state if the collection wasn&apos;t already watched&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15314162" author="jira-bot" created="Fri, 3 Jun 2016 14:13:03 +0000"  >&lt;p&gt;Commit 950fd913354912f9c84a07dcf60258726d6d6f4f in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek&quot; class=&quot;user-hover&quot; rel=&quot;romseygeek&quot;&gt;romseygeek&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=950fd91&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=950fd91&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9181&quot; title=&quot;ZkStateReaderTest failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9181&quot;&gt;&lt;del&gt;SOLR-9181&lt;/del&gt;&lt;/a&gt;: Fix test bug in ZkStateReaderTest&lt;/p&gt;</comment>
                            <comment id="15314163" author="jira-bot" created="Fri, 3 Jun 2016 14:13:38 +0000"  >&lt;p&gt;Commit 0cfe43164a95de530907de4818b32891f62a95f8 in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek&quot; class=&quot;user-hover&quot; rel=&quot;romseygeek&quot;&gt;romseygeek&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0cfe431&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0cfe431&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9181&quot; title=&quot;ZkStateReaderTest failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9181&quot;&gt;&lt;del&gt;SOLR-9181&lt;/del&gt;&lt;/a&gt;: Fix test bug in ZkStateReaderTest&lt;/p&gt;</comment>
                            <comment id="15314662" author="romseygeek" created="Fri, 3 Jun 2016 19:37:35 +0000"  >&lt;p&gt;I&apos;m seeing a whole bunch of failures after this, and can reproduce via beasting locally - digging now.&lt;/p&gt;</comment>
                            <comment id="15315440" author="jira-bot" created="Sat, 4 Jun 2016 10:05:58 +0000"  >&lt;p&gt;Commit 1e2ba9fe9be84f0b5defe4965735eae892fabf7b in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek&quot; class=&quot;user-hover&quot; rel=&quot;romseygeek&quot;&gt;romseygeek&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1e2ba9f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1e2ba9f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Revert &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9181&quot; title=&quot;ZkStateReaderTest failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9181&quot;&gt;&lt;del&gt;SOLR-9181&lt;/del&gt;&lt;/a&gt;: Fix test bug in ZkStateReaderTest&quot;&lt;/p&gt;

&lt;p&gt;This reverts commit 950fd913354912f9c84a07dcf60258726d6d6f4f.&lt;/p&gt;</comment>
                            <comment id="15315441" author="jira-bot" created="Sat, 4 Jun 2016 10:06:41 +0000"  >&lt;p&gt;Commit 3595b9ab2e51a6e040915db98d48d242197c151e in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek&quot; class=&quot;user-hover&quot; rel=&quot;romseygeek&quot;&gt;romseygeek&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3595b9a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=3595b9a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Revert &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9181&quot; title=&quot;ZkStateReaderTest failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9181&quot;&gt;&lt;del&gt;SOLR-9181&lt;/del&gt;&lt;/a&gt;: Fix test bug in ZkStateReaderTest&quot;&lt;/p&gt;

&lt;p&gt;This reverts commit 0cfe43164a95de530907de4818b32891f62a95f8.&lt;/p&gt;</comment>
                            <comment id="15315442" author="romseygeek" created="Sat, 4 Jun 2016 10:07:13 +0000"  >&lt;p&gt;Reverting this while I work out what&apos;s broken.&lt;/p&gt;</comment>
                            <comment id="15318276" author="romseygeek" created="Tue, 7 Jun 2016 10:44:50 +0000"  >&lt;p&gt;Turns out that ZkStateReaderTest is very helpful for finding bugs and races in the collection state watcher implementation!  This patch fixes the following:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;notifications were being run before constructState() was called, which meant that threads waiting on notifications could see stale state if they then called .getClusterState().  Notifications are now always run afterwards.&lt;/li&gt;
	&lt;li&gt;DocCollection.equals() didn&apos;t take into account state formats, so a migration from state format 1 to state format 2 could sometimes not fire a notification&lt;/li&gt;
	&lt;li&gt;When choosing which state format 1 collections should be notified, the code checked to see if there was a watcher on the collection.  This lead to a race, where a watch could be set after the legacy state change had fired, but before constructState() was called, so that it would check against stale state but not be notified of the new state.  The code now just raises notifications for all changed collections.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Beasting ZkStateReaderTest for several thousand iterations now passes consistently, so I think this should sort out the issues.  I&apos;m pretty sure that the final point above is also the reason for the failures in &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9189&quot; title=&quot;explosion of timeout related failures in jenkins the past few days&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9189&quot;&gt;&lt;del&gt;SOLR-9189&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15319107" author="dragonsinth" created="Tue, 7 Jun 2016 18:49:37 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek&quot; class=&quot;user-hover&quot; rel=&quot;romseygeek&quot;&gt;romseygeek&lt;/a&gt;!  I&apos;m about to upload a slightly different patch to fix a few nits, but I did notice a potential problem:  most callers of refreshLegacyClusterState() throw away the results.  In certain code paths, observers of collections in the legacy format won&apos;t see any changes even though our in-memory rep is updated.&lt;/p&gt;</comment>
                            <comment id="15319140" author="dragonsinth" created="Tue, 7 Jun 2016 19:06:09 +0000"  >&lt;p&gt;Patch updated, just a few tweaks.&lt;/p&gt;</comment>
                            <comment id="15321505" author="romseygeek" created="Wed, 8 Jun 2016 21:53:13 +0000"  >&lt;p&gt;Here&apos;s an attempt to clean this up a bit.  Notifications are now fired from constructState(), which takes a map of changed collections.  This should ensure that a) we always take into account what has changed, and b) we fire notifications on every state updated.  Tests pass under beasting.&lt;/p&gt;</comment>
                            <comment id="15322310" author="romseygeek" created="Thu, 9 Jun 2016 10:20:25 +0000"  >&lt;p&gt;Given that we&apos;re still finding timing-related bugs in this code, I think it might be a good idea to remove the .waitForState() and .registerCollectionStateWatcher() methods from 6.1, and push it all back to 6.2?&lt;/p&gt;</comment>
                            <comment id="15322917" author="dragonsinth" created="Thu, 9 Jun 2016 17:28:13 +0000"  >&lt;p&gt;I think I&apos;d probably leave the APIs there, but maybe mark them experimental in 6.1 and just not have the rest of Solr rely on them yet?&lt;/p&gt;</comment>
                            <comment id="15323283" author="dragonsinth" created="Thu, 9 Jun 2016 20:31:26 +0000"  >&lt;p&gt;BTW, I have to admit I&apos;m stalling on reviewing the update because there&apos;s no easy way to compare two patch files except to patch each one in turn and diff the result...&lt;/p&gt;</comment>
                            <comment id="15359113" author="jira-bot" created="Fri, 1 Jul 2016 15:13:58 +0000"  >&lt;p&gt;Commit 057c317a9d781a15eb9b47341d247d9a98902f24 in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek&quot; class=&quot;user-hover&quot; rel=&quot;romseygeek&quot;&gt;romseygeek&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=057c317&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=057c317&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9181&quot; title=&quot;ZkStateReaderTest failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9181&quot;&gt;&lt;del&gt;SOLR-9181&lt;/del&gt;&lt;/a&gt;: Fix some races in ZkStateReader collection watch updates&lt;/p&gt;</comment>
                            <comment id="15359115" author="jira-bot" created="Fri, 1 Jul 2016 15:14:02 +0000"  >&lt;p&gt;Commit cefab1dffc514309734699d0031e7e08aac24dfc in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek&quot; class=&quot;user-hover&quot; rel=&quot;romseygeek&quot;&gt;romseygeek&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=cefab1d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=cefab1d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9181&quot; title=&quot;ZkStateReaderTest failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9181&quot;&gt;&lt;del&gt;SOLR-9181&lt;/del&gt;&lt;/a&gt;: Fix some races in ZkStateReader collection watch updates&lt;/p&gt;</comment>
                            <comment id="15359117" author="romseygeek" created="Fri, 1 Jul 2016 15:14:37 +0000"  >&lt;p&gt;Meant to commit this for 6.1, and it completely dropped off my radar.  Oh well...&lt;/p&gt;</comment>
                            <comment id="15360671" author="steve_rowe" created="Sun, 3 Jul 2016 20:33:53 +0000"  >&lt;p&gt;Around the cefab1dfff commit under this issue, my Jenkins master Lucene/Solr test job went from about 50% overall job failure rate (i.e. at least one test failure in a run - this unfortunately has been the case for quite some time) to nearly 100% failures (28 runs with at least one failure out of 29 runs) - see the trend here &amp;lt;&lt;a href=&quot;http://jenkins.sarowe.net/job/Lucene-Solr-tests-master/buildTimeTrend&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jenkins.sarowe.net/job/Lucene-Solr-tests-master/buildTimeTrend&lt;/a&gt;&amp;gt;.  I think Policeman and ASF Jenkins are seeing increases in failure rates too but I haven&apos;t counted yet. The few failing tests I attempted with don&apos;t reproduce.  The ZK reader and writer tests seem to be failing quite a bit more often now, but that&apos;s anecdotal; I didn&apos;t look at the numbers.  &lt;/p&gt;

&lt;p&gt;So I stopped all other jobs on my Jenkins and did a brute force search for which commit to blame, by pinning 7 jobs each at a different non-trivial commit in the suspect time frame - you can see these jobs here: &amp;lt;&lt;a href=&quot;http://jenkins.sarowe.net/view/Enabled/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jenkins.sarowe.net/view/Enabled/&lt;/a&gt;&amp;gt;.  Each job has run about 20 times now, and c3fab1dfff stands out as failing signficantly more often:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;push date/time (UTC)&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;issue&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;commit&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;failures&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;runs&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;% failures&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;29 Jun 18:27&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9246&quot; title=&quot;Errors for Streaming Expressions using JDBC (Oracle) stream source&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9246&quot;&gt;&lt;del&gt;SOLR-9246&lt;/del&gt;&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1ae0d8d6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;1ae0d8d6&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;6&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;19&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;32%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;30 Jun 06:40&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9216&quot; title=&quot;Support collection.configName in MODIFYCOLLECTION request&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9216&quot;&gt;&lt;del&gt;SOLR-9216&lt;/del&gt;&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1dc7480b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;1dc7480b&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;10&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;19&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;53%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;30 Jun 09:52&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9264&quot; title=&quot;Optimize ZkController.publishAndWaitForDownStates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9264&quot;&gt;&lt;del&gt;SOLR-9264&lt;/del&gt;&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=015e0fc1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;015e0fc1&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;10&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;19&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;53%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;30 Jun 17:02&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-8787&quot; title=&quot;TestAuthenticationFramework should not extend TestMiniSolrCloudCluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-8787&quot;&gt;&lt;del&gt;SOLR-8787&lt;/del&gt;&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=0a15699c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;0a15699c&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;11&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;20&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;55%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;01 Jul 07:46&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9262&quot; title=&quot;Connection and read timeouts are being ignored by UpdateShardHandler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9262&quot;&gt;&lt;del&gt;SOLR-9262&lt;/del&gt;&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=51fde1cb&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;51fde1cb&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;11&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;20&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;55%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;01 Jul 13:07&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9076&quot; title=&quot;Update to Hadoop 2.7.2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9076&quot;&gt;&lt;del&gt;SOLR-9076&lt;/del&gt;&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=2c96c91d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2c96c91d&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;9&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;19&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;47%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;01 Jul 15:13&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9181&quot; title=&quot;ZkStateReaderTest failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9181&quot;&gt;&lt;del&gt;SOLR-9181&lt;/del&gt;&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=cefab1df&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cefab1df&lt;/a&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;13&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;19&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;68%&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="15360672" author="romseygeek" created="Sun, 3 Jul 2016 20:35:58 +0000"  >&lt;p&gt;Thanks Steve.  I&apos;ll take a look at this tomorrow.&lt;/p&gt;</comment>
                            <comment id="15360995" author="romseygeek" created="Mon, 4 Jul 2016 08:09:51 +0000"  >&lt;p&gt;OK, I&apos;ve gone through the logs for a number of these test failures, and what they all have in common is a ZK session expiry causing the cluster state to not be properly updated.  What I can&apos;t work out though is why these expiries are happening - the timestamps on the logs don&apos;t show any pauses, and there&apos;s nothing as far as I can tell that&apos;s changed in the zk code itself.&lt;/p&gt;</comment>
                            <comment id="15361002" author="romseygeek" created="Mon, 4 Jul 2016 08:15:39 +0000"  >&lt;p&gt;Also, I get no failures on local beasting, so it&apos;s presumably something to do with contention on the slow-ish Jenkins machines.&lt;/p&gt;</comment>
                            <comment id="15362296" author="jira-bot" created="Tue, 5 Jul 2016 09:47:12 +0000"  >&lt;p&gt;Commit e6e0765e864132185549e91a64d76fcac63f7335 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek&quot; class=&quot;user-hover&quot; rel=&quot;romseygeek&quot;&gt;romseygeek&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e6e0765&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=e6e0765&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9181&quot; title=&quot;ZkStateReaderTest failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9181&quot;&gt;&lt;del&gt;SOLR-9181&lt;/del&gt;&lt;/a&gt;: Add some logging to ZkStateReader to try and debug test failures&lt;/p&gt;</comment>
                            <comment id="15362540" author="jira-bot" created="Tue, 5 Jul 2016 14:17:34 +0000"  >&lt;p&gt;Commit 521764ffa572650f9e8c8b4ac5c0dba7ba5ee5e3 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek&quot; class=&quot;user-hover&quot; rel=&quot;romseygeek&quot;&gt;romseygeek&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=521764f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=521764f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9181&quot; title=&quot;ZkStateReaderTest failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9181&quot;&gt;&lt;del&gt;SOLR-9181&lt;/del&gt;&lt;/a&gt;: More logging&lt;/p&gt;</comment>
                            <comment id="15362541" author="romseygeek" created="Tue, 5 Jul 2016 14:18:39 +0000"  >&lt;p&gt;I&apos;ve added some logging, and I think that this is a race somewhere between refreshCollectionList() and forceUpdateCollection(), where a new lazy collection is being added halfway through the update.  Still digging...&lt;/p&gt;</comment>
                            <comment id="15362555" author="romseygeek" created="Tue, 5 Jul 2016 14:28:04 +0000"  >&lt;p&gt;Got it - if I stick a Thread.sleep() in refreshCollectionList() then the ZkStateWriterTest errors reproduce for me.  It looks as though forceUpdateCollection() needs to hold both the general update lock and the collections list update lock, although I&apos;m going to beast this for a while to make sure that this doesn&apos;t deadlock anywhere.&lt;/p&gt;

&lt;p&gt;This still leaves the ZkStateReaderTest failures.  I think these are caused by notifications using potentially stale DocCollection states, rather than the the latest state available.  I&apos;m beasting tests locally now, and will commit the fix to master shortly and see if  it actually works.&lt;/p&gt;</comment>
                            <comment id="15362611" author="erickerickson" created="Tue, 5 Jul 2016 15:10:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek&quot; class=&quot;user-hover&quot; rel=&quot;romseygeek&quot;&gt;romseygeek&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I was looking at this too fearing that my recent changes might have introduced yet another problem (insert rant about windows here) and found that the NPE in testExternalCollectionWatchedNotWatched could be avoided by adding a wait if any of these were null around line 166&lt;/p&gt;

&lt;p&gt;assertTrue(reader.getClusterState().getCollectionRef(&quot;c1&quot;).isLazilyLoaded()&lt;/p&gt;

&lt;p&gt;FYI. Didn&apos;t log &lt;em&gt;which&lt;/em&gt; of the above, but I assume the getCollectionRef(&quot;c1&quot;) returned null. Not pursuing this further, but the NPE is quite reproducible on my machine. I can beast your patch if that&apos;d help, let me know.&lt;/p&gt;</comment>
                            <comment id="15363184" author="romseygeek" created="Tue, 5 Jul 2016 20:37:58 +0000"  >&lt;p&gt;Here&apos;s a patch which should solve the issue - if you could beast it Erick that would be great!  Am travelling the next couple of days, but I&apos;ll commit it if I get half-decent wifi anywhere.&lt;/p&gt;</comment>
                            <comment id="15363403" author="erickerickson" created="Tue, 5 Jul 2016 22:38:33 +0000"  >&lt;p&gt;Besting now.&lt;/p&gt;

&lt;p&gt;I&apos;m assuming I should just apply your most recent patch (&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9181&quot; title=&quot;ZkStateReaderTest failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9181&quot;&gt;&lt;del&gt;SOLR-9181&lt;/del&gt;&lt;/a&gt;-2) to a current master...&lt;/p&gt;</comment>
                            <comment id="15363561" author="erickerickson" created="Wed, 6 Jul 2016 00:57:28 +0000"  >&lt;p&gt;No luck, still getting:&lt;br/&gt;
ERROR   0.32s | ZkStateReaderTest.testExternalCollectionWatchedNotWatched &amp;lt;&amp;lt;&amp;lt;&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;    &amp;gt; Throwable #1: java.lang.NullPointerException&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;    &amp;gt; 	at __randomizedtesting.SeedInfo.seed(&lt;span class=&quot;error&quot;&gt;&amp;#91;D27D8A51F09E7A68:D9C67B7DA1C78CC1&amp;#93;&lt;/span&gt;:0)&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;    &amp;gt; 	at org.apache.solr.cloud.overseer.ZkStateReaderTest.testExternalCollectionWatchedNotWatched(ZkStateReaderTest.java:167)&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;junit4&amp;#93;&lt;/span&gt;    &amp;gt; 	at java.lang.Thread.run(Thread.java:745)&lt;/p&gt;

&lt;p&gt;Full log attached in a minute.&lt;/p&gt;</comment>
                            <comment id="15367373" author="romseygeek" created="Fri, 8 Jul 2016 08:00:15 +0000"  >&lt;p&gt;Think I&apos;ve got it now - there was one case in forceUpdateCollection() where constructState() wasn&apos;t being called.  I&apos;m going to commit this to master and watch for the next few hours, and then backport.&lt;/p&gt;</comment>
                            <comment id="15367420" author="jira-bot" created="Fri, 8 Jul 2016 09:02:07 +0000"  >&lt;p&gt;Commit be8d56ada69c885342bfae80d73f9f5b89c11504 in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek&quot; class=&quot;user-hover&quot; rel=&quot;romseygeek&quot;&gt;romseygeek&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=be8d56a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=be8d56a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9181&quot; title=&quot;ZkStateReaderTest failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9181&quot;&gt;&lt;del&gt;SOLR-9181&lt;/del&gt;&lt;/a&gt;: Fix race in constructState() and missing call in forceUpdateCollection()&lt;/p&gt;</comment>
                            <comment id="15367672" author="jira-bot" created="Fri, 8 Jul 2016 13:30:03 +0000"  >&lt;p&gt;Commit 60232cd028e41c427b686a6cab720ac3989ba289 in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek&quot; class=&quot;user-hover&quot; rel=&quot;romseygeek&quot;&gt;romseygeek&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=60232cd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=60232cd&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9181&quot; title=&quot;ZkStateReaderTest failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9181&quot;&gt;&lt;del&gt;SOLR-9181&lt;/del&gt;&lt;/a&gt;: Add some logging to ZkStateReader to try and debug test failures&lt;/p&gt;</comment>
                            <comment id="15367674" author="jira-bot" created="Fri, 8 Jul 2016 13:30:04 +0000"  >&lt;p&gt;Commit 86d8d3a937802f47add8408bdd05117ec0fc2137 in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek&quot; class=&quot;user-hover&quot; rel=&quot;romseygeek&quot;&gt;romseygeek&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=86d8d3a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=86d8d3a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9181&quot; title=&quot;ZkStateReaderTest failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9181&quot;&gt;&lt;del&gt;SOLR-9181&lt;/del&gt;&lt;/a&gt;: More logging&lt;/p&gt;</comment>
                            <comment id="15367675" author="jira-bot" created="Fri, 8 Jul 2016 13:30:06 +0000"  >&lt;p&gt;Commit fda3d8b7c2069d9cbd2445b397e9cceb38851be6 in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romseygeek&quot; class=&quot;user-hover&quot; rel=&quot;romseygeek&quot;&gt;romseygeek&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=fda3d8b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=fda3d8b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-9181&quot; title=&quot;ZkStateReaderTest failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-9181&quot;&gt;&lt;del&gt;SOLR-9181&lt;/del&gt;&lt;/a&gt;: Fix race in constructState() and missing call in forceUpdateCollection()&lt;/p&gt;</comment>
                            <comment id="15439039" author="mikemccand" created="Fri, 26 Aug 2016 14:00:26 +0000"  >&lt;p&gt;Bulk close resolved issues after 6.2.0 release.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12976153">SOLR-9189</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12816783" name="SOLR-9181-2.patch" size="9921" author="romseygeek" created="Fri, 8 Jul 2016 08:00:15 +0000"/>
                            <attachment id="12816297" name="SOLR-9181-2.patch" size="9855" author="romseygeek" created="Tue, 5 Jul 2016 20:37:58 +0000"/>
                            <attachment id="12809043" name="SOLR-9181.patch" size="20816" author="romseygeek" created="Wed, 8 Jun 2016 21:53:13 +0000"/>
                            <attachment id="12808737" name="SOLR-9181.patch" size="19555" author="dragonsinth" created="Tue, 7 Jun 2016 19:05:46 +0000"/>
                            <attachment id="12808645" name="SOLR-9181.patch" size="18843" author="romseygeek" created="Tue, 7 Jun 2016 10:44:50 +0000"/>
                            <attachment id="12807720" name="SOLR-9181.patch" size="7463" author="romseygeek" created="Thu, 2 Jun 2016 13:48:22 +0000"/>
                            <attachment id="12816347" name="stderr" size="557" author="erickerickson" created="Wed, 6 Jul 2016 00:58:33 +0000"/>
                            <attachment id="12816348" name="stdout" size="69366" author="erickerickson" created="Wed, 6 Jul 2016 00:58:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 12 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2yvxb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>