<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:33:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-11665] Improve SplitShardCmd error handling</title>
                <link>https://issues.apache.org/jira/browse/SOLR-11665</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;I do see some problems when doing split shard but there are no available nodes for creating replicas ( due to policy framework )&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The patch contains a test, in which sub shard stay in CONSTRUCTION state forever.&lt;/li&gt;
	&lt;li&gt;Shard which get split, stay in inactive state forever and subshards are not created&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="13120162">SOLR-11665</key>
            <summary>Improve SplitShardCmd error handling</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ab">Andrzej Bialecki</assignee>
                                    <reporter username="caomanhdat">Cao Manh Dat</reporter>
                        <labels>
                    </labels>
                <created>Wed, 22 Nov 2017 08:37:38 +0000</created>
                <updated>Sat, 8 Jun 2019 15:16:25 +0000</updated>
                            <resolved>Wed, 27 Jun 2018 10:57:04 +0000</resolved>
                                                    <fixVersion>7.5</fixVersion>
                    <fixVersion>8.0</fixVersion>
                                    <component>AutoScaling</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16264251" author="ab" created="Thu, 23 Nov 2017 12:12:09 +0000"  >&lt;p&gt;I noticed a couple other issues in SplitShardCmd:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// Remove the node that hosts the parent shard &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; replica creation.
&lt;/span&gt;      nodeList.remove(nodeName);

      &lt;span class=&quot;code-comment&quot;&gt;// TODO: change &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; to handle sharding a slice into &amp;gt; 2 sub-shards.
&lt;/span&gt;
      List&amp;lt;ReplicaPosition&amp;gt; replicaPositions = Assign.identifyNodes(ocmh.cloudManager,
          clusterState,
          &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;(clusterState.getLiveNodes()),
          collectionName,
          &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ZkNodeProps(collection.getProperties()),
          subSlices, repFactor - 1, 0, 0);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;ul&gt;
	&lt;li&gt;In this section, the call to &lt;tt&gt;Assign.identifyNodes&lt;/tt&gt; should use the &lt;tt&gt;nodeList&lt;/tt&gt; prepared above, and not all live nodes.&lt;/li&gt;
	&lt;li&gt;this call also uses &lt;tt&gt;repFactor - 1&lt;/tt&gt; for NRT replicas, ignoring other types of replicas specified in the collection config.&lt;/li&gt;
	&lt;li&gt;further down, this section also assumes all replicas are NRT:
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; subRanges.size(); i++) {
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; subSlice = slice + &lt;span class=&quot;code-quote&quot;&gt;&quot;_&quot;&lt;/span&gt; + i;
        subSlices.add(subSlice);
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; subShardName = Assign.buildSolrCoreName(ocmh.cloudManager.getDistribStateManager(), collection, subSlice, Replica.Type.NRT);
        subShardNames.add(subShardName);
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This results in incorrect names being created for SolrCore-s.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16523548" author="ab" created="Tue, 26 Jun 2018 10:47:08 +0000"  >&lt;p&gt;This patch contains the following improvements and fixes:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;failures at any&#160;phase in the process are followed by an explicit cleanup, which removes partially constructed shards&lt;/li&gt;
	&lt;li&gt;sub-shards are now created with the same number of replicas per replica type as the parent type - previously only NRT replicas would be created.&lt;/li&gt;
	&lt;li&gt;fixed a bug in coreName construction so that the new cores follow the same naming pattern per replica type as the parent shards&lt;/li&gt;
	&lt;li&gt;SplitShardCmd now first checks the amount of available disk space on the parent shard leader&apos;s node to ensure that the actual index splitting has enough disk space to proceed.&lt;/li&gt;
	&lt;li&gt;unit test changes, and a test that verifies the correct number of replicas per type in the new sub-shards.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16523864" author="ab" created="Tue, 26 Jun 2018 15:28:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=caomanhdat&quot; class=&quot;user-hover&quot; rel=&quot;caomanhdat&quot;&gt;caomanhdat&lt;/a&gt; - the test in your patch no longer fails with these changes.&lt;/p&gt;</comment>
                            <comment id="16524100" author="jira-bot" created="Tue, 26 Jun 2018 18:36:18 +0000"  >&lt;p&gt;Commit 1023b839aeda4f4688103995051b727d7ca4fdce in lucene-solr&apos;s branch refs/heads/master from Andrzej Bialecki&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1023b83&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=1023b83&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11665&quot; title=&quot;Improve SplitShardCmd error handling&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11665&quot;&gt;&lt;del&gt;SOLR-11665&lt;/del&gt;&lt;/a&gt;: Improve error handling of shard splitting. Fix splitting of mixed replica types.&lt;/p&gt;</comment>
                            <comment id="16524169" author="jira-bot" created="Tue, 26 Jun 2018 20:10:27 +0000"  >&lt;p&gt;Commit c0853200f20e3dd874e025418f6919fd913c5523 in lucene-solr&apos;s branch refs/heads/branch_7x from Andrzej Bialecki&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c085320&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=c085320&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-11665&quot; title=&quot;Improve SplitShardCmd error handling&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-11665&quot;&gt;&lt;del&gt;SOLR-11665&lt;/del&gt;&lt;/a&gt;: Improve error handling of shard splitting. Fix splitting of mixed replica types.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12929177" name="SOLR-11665.patch" size="31607" author="ab" created="Tue, 26 Jun 2018 10:41:32 +0000"/>
                            <attachment id="12898817" name="SOLR-11665.test.patch" size="2897" author="caomanhdat" created="Wed, 22 Nov 2017 08:39:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 21 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3n35r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>