<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:49:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-15587] Replicas end up with base_url as http on client side even if cluster state says https when using the HttpClusterStateProvider</title>
                <link>https://issues.apache.org/jira/browse/SOLR-15587</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;Assuming you have a SolrCloud cluster with TLS enabled and are instantiating a CloudSolrClient using a Solr URL vs. ZK connection string, then the changes made for &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-12182&quot; title=&quot;Can not switch urlScheme in 7x if there are any cores in the cluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-12182&quot;&gt;SOLR-12182&lt;/a&gt; in 8.8.0 have introduced a bug where the &lt;tt&gt;base_url&lt;/tt&gt; for replicas in the &lt;tt&gt;ClusterState&lt;/tt&gt; returned by the &lt;tt&gt;HttpClusterStateProvider&lt;/tt&gt; have url scheme &lt;tt&gt;http&lt;/tt&gt; instead of &lt;tt&gt;https&lt;/tt&gt; when the global singleton &lt;tt&gt;UrlScheme.INSTANCE&lt;/tt&gt; is not set to &lt;tt&gt;https&lt;/tt&gt;. This does NOT impact &lt;tt&gt;ClusterState&lt;/tt&gt; returned by the &lt;tt&gt;ZkClusterStateProvider&lt;/tt&gt; because the &lt;tt&gt;ZkStateReader&lt;/tt&gt; calls &lt;tt&gt;UrlScheme.INSTANCE.setUrlScheme(&quot;https&quot;)&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;The easiest work-around for now is for client applications to call:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
UrlScheme.INSTANCE.setUrlScheme(UrlScheme.HTTPS);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Before creating SolrJ client objects such as CloudSolrClient.&lt;/p&gt;

&lt;p&gt;I think the proper fix would be to call putIfAbsent in Replica ctor:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    propMap.putIfAbsent(BASE_URL_PROP, UrlScheme.INSTANCE.getBaseUrlForNodeName(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.nodeName));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;but need to run all existing tests and create a new unit test for this situation.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13395550">SOLR-15587</key>
            <summary>Replicas end up with base_url as http on client side even if cluster state says https when using the HttpClusterStateProvider</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thelabdude">Timothy Potter</assignee>
                                    <reporter username="thelabdude">Timothy Potter</reporter>
                        <labels>
                    </labels>
                <created>Mon, 16 Aug 2021 20:06:31 +0000</created>
                <updated>Thu, 12 May 2022 00:26:49 +0000</updated>
                            <resolved>Tue, 8 Feb 2022 00:34:36 +0000</resolved>
                                    <version>8.8</version>
                    <version>8.8.1</version>
                    <version>8.8.2</version>
                    <version>8.9</version>
                    <version>8.10</version>
                    <version>8.11</version>
                    <version>8.10.1</version>
                    <version>8.11.1</version>
                                    <fixVersion>9.0</fixVersion>
                    <fixVersion>8.11.2</fixVersion>
                                    <component>SolrJ</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="9000">2.5h</timespent>
                                <comments>
                            <comment id="17486085" author="janhoy" created="Wed, 2 Feb 2022 20:33:36 +0000"  >&lt;p&gt;What&apos;s the state of this blocker? Looks like the PR is mostly done?&lt;/p&gt;</comment>
                            <comment id="17486090" author="thelabdude" created="Wed, 2 Feb 2022 20:42:58 +0000"  >&lt;p&gt;needs a little more work based on review comments ... will get this merged to 9 and 8_11 by end of day Friday Feb 4&lt;/p&gt;</comment>
                            <comment id="17487384" author="jira-bot" created="Sat, 5 Feb 2022 00:45:32 +0000"  >&lt;p&gt;Commit 79189717d45f69d54f99a327c0a8155207d75e0a in solr&apos;s branch refs/heads/main from Timothy Potter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=7918971&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=7918971&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15587&quot; title=&quot;Replicas end up with base_url as http on client side even if cluster state says https when using the HttpClusterStateProvider&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15587&quot;&gt;&lt;del&gt;SOLR-15587&lt;/del&gt;&lt;/a&gt;: Don&apos;t use the UrlScheme singleton on the client-side (#460)&lt;/p&gt;
</comment>
                            <comment id="17488239" author="jira-bot" created="Mon, 7 Feb 2022 16:33:42 +0000"  >&lt;p&gt;Commit 3714f10943cdbb56b413b5868565bce20a4e70af in solr&apos;s branch refs/heads/branch_9x from Timothy Potter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=3714f10&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=3714f10&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15587&quot; title=&quot;Replicas end up with base_url as http on client side even if cluster state says https when using the HttpClusterStateProvider&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15587&quot;&gt;&lt;del&gt;SOLR-15587&lt;/del&gt;&lt;/a&gt;: Don&apos;t use the UrlScheme singleton on the client-side (#460) (#600)&lt;/p&gt;
</comment>
                            <comment id="17488263" author="jira-bot" created="Mon, 7 Feb 2022 17:01:00 +0000"  >&lt;p&gt;Commit 733c36a775f54e8ad00fcb198eca5796a2fab57e in solr&apos;s branch refs/heads/branch_9_0 from Timothy Potter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=solr.git;h=733c36a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=solr.git;h=733c36a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15587&quot; title=&quot;Replicas end up with base_url as http on client side even if cluster state says https when using the HttpClusterStateProvider&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15587&quot;&gt;&lt;del&gt;SOLR-15587&lt;/del&gt;&lt;/a&gt;: Don&apos;t use the UrlScheme singleton on the client-side (#460) (#600) (#602)&lt;/p&gt;
</comment>
                            <comment id="17488512" author="jira-bot" created="Tue, 8 Feb 2022 00:36:15 +0000"  >&lt;p&gt;Commit 9a1138018f2080b893d7cfbf1c8be866d9ecbcda in lucene-solr&apos;s branch refs/heads/branch_8_11 from Timothy Potter&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=9a11380&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=lucene-solr.git;h=9a11380&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-15587&quot; title=&quot;Replicas end up with base_url as http on client side even if cluster state says https when using the HttpClusterStateProvider&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-15587&quot;&gt;&lt;del&gt;SOLR-15587&lt;/del&gt;&lt;/a&gt;: Don&apos;t use the UrlScheme singleton on the client-side (#2639)&lt;/p&gt;
</comment>
                            <comment id="17535637" author="janhoy" created="Thu, 12 May 2022 00:26:49 +0000"  >&lt;p&gt;Closing after the 9.0.0 release&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310660">
                    <name>Completes</name>
                                            <outwardlinks description="fixes">
                                        <issuelink>
            <issuekey id="13374199">SOLR-15364</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13149801">SOLR-12182</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 26 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0tyjk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>