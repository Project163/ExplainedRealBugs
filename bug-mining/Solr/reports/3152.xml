<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 04:17:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-2094] When using a XPathEntityProcessor nested within another entity, the xpathReader isn&apos;t reinitilized for each new document </title>
                <link>https://issues.apache.org/jira/browse/SOLR-2094</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;I have a dih config with a SqlEntityProcessor that retrives a table. I then have a sub-entity with the XPathEntityProcessor type, this takes a value from the table as input to parse through an xml doc. &lt;br/&gt;
I find that the first document is created correctly, but then the xpathReader of the XPathEntityProcessor does not reinitialize for the following documents so the initial documents input is used. &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&amp;lt;dataSource name=&lt;span class=&quot;code-quote&quot;&gt;&quot;hivseqdb&quot;&lt;/span&gt; driver=&lt;span class=&quot;code-quote&quot;&gt;&quot;com.mysql.jdbc.Driver&quot;&lt;/span&gt;
	   url=&lt;span class=&quot;code-quote&quot;&gt;&quot;l&quot;&lt;/span&gt;
           user=&lt;span class=&quot;code-quote&quot;&gt;&quot;hivseqdb&quot;&lt;/span&gt; password=&lt;span class=&quot;code-quote&quot;&gt;&quot;hivseqdb&quot;&lt;/span&gt; batchSize=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;/&amp;gt;
           
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dataSource name=&lt;span class=&quot;code-quote&quot;&gt;&quot;xmlFile&quot;&lt;/span&gt; type=&lt;span class=&quot;code-quote&quot;&gt;&quot;FileDataSource&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
    
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;document&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;entity name=&lt;span class=&quot;code-quote&quot;&gt;&quot;Sequence&quot;&lt;/span&gt; dataSource=&lt;span class=&quot;code-quote&quot;&gt;&quot;hivseqdb&quot;&lt;/span&gt; pk=&lt;span class=&quot;code-quote&quot;&gt;&quot;se_id&quot;&lt;/span&gt; query=&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT * FROM hivseqdb.sequenceentry where se_id != &lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
			
            &amp;lt;entity name=&lt;span class=&quot;code-quote&quot;&gt;&quot;FMA_Tissue_Hierarchy&quot;&lt;/span&gt; 
            		dataSource=&lt;span class=&quot;code-quote&quot;&gt;&quot;xmlFile&quot;&lt;/span&gt;
            		pk=&lt;span class=&quot;code-quote&quot;&gt;&quot;fma-id&quot;&lt;/span&gt;
            		forEach=&lt;span class=&quot;code-quote&quot;&gt;&quot;/tissue-samples&quot;&lt;/span&gt; 
            		processor=&lt;span class=&quot;code-quote&quot;&gt;&quot;XPathEntityProcessor&quot;&lt;/span&gt; 
            		url=&lt;span class=&quot;code-quote&quot;&gt;&quot;/opt/hivseqdb/solr/conf/sub_ontology_translated.xml&quot;&lt;/span&gt; 
            		stream=&lt;span class=&quot;code-quote&quot;&gt;&quot;true&quot;&lt;/span&gt;&amp;gt;
                &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;field column=&lt;span class=&quot;code-quote&quot;&gt;&quot;tissue-antology-parent-path&quot;&lt;/span&gt; xpath=&lt;span class=&quot;code-quote&quot;&gt;&quot;/tissue-samples/tissue[@fma-id=&lt;span class=&quot;code-quote&quot;&gt;&apos;${Sequence.sampleTissueCode}&apos;&lt;/span&gt;]/parent-path&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/entity&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;DocBuilder dose call init on the XPathEntityProcessor but there is a conditional in the init method to check if the xpathReader is null:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void init(Context context) {
    &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.init(context);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (xpathReader == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
      initXpathReader();
    pk = context.getEntityAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;pk&quot;&lt;/span&gt;);
    dataSource = context.getDataSource();
    rowIterator = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;

  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So the xPathReader is used again and again. Is there away to reinitialize the xPathReader for every document? Or what is the specific design reason for preserving it?&lt;/p&gt;



</description>
                <environment>&lt;p&gt;Solr 1.4&lt;/p&gt;</environment>
        <key id="12472742">SOLR-2094</key>
            <summary>When using a XPathEntityProcessor nested within another entity, the xpathReader isn&apos;t reinitilized for each new document </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="noble.paul">Noble Paul</assignee>
                                    <reporter username="nialloc">Niall O&apos;Connor</reporter>
                        <labels>
                    </labels>
                <created>Fri, 27 Aug 2010 20:36:24 +0000</created>
                <updated>Wed, 9 Nov 2016 08:39:13 +0000</updated>
                            <resolved>Thu, 27 Oct 2016 09:24:48 +0000</resolved>
                                    <version>1.4.1</version>
                                    <fixVersion>6.3</fixVersion>
                                    <component>contrib - DataImportHandler</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="13224714" author="daanbiere@gmail.com" created="Wed, 7 Mar 2012 21:17:21 +0000"  >&lt;p&gt;I&apos;ve got exactly the same problem (SOLR 3.6).&lt;br/&gt;
Is there any way to avoid this behaviour?&lt;/p&gt;</comment>
                            <comment id="13224735" author="nialloc" created="Wed, 7 Mar 2012 21:36:02 +0000"  >&lt;p&gt;in dataimporthandler/src/main/java/org/apache/solr/handler/dataimport/XPathEntityProcessor.java&lt;/p&gt;

&lt;p&gt;I removed the &quot;if (xpathReader == null)&quot; from the XPathEntityProcessor and rebuilt the package so that the XPathReader was re-initialized.&lt;/p&gt;

&lt;p&gt;I didn&apos;t commit this change since there was no activity on this issue. &lt;/p&gt;
</comment>
                            <comment id="13224753" author="daanbiere@gmail.com" created="Wed, 7 Mar 2012 21:53:13 +0000"  >&lt;p&gt;Hi Niall,&lt;/p&gt;

&lt;p&gt;Thank you for your quick reply....&lt;br/&gt;
That was exactly what i just did, checked out the 3.5 branch and removed the line in:&lt;br/&gt;
./solr/contrib/dataimporthandler/src/java/org/apache/solr/handler/dataimport/XPathEntityProcessor.java&lt;br/&gt;
so now i have:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void init(Context context) {
    &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.init(context);
    initXpathReader();
    pk = context.getEntityAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;pk&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;but problem persists...&lt;br/&gt;
My configuration is exactly like yours, in fact i&apos;ve copied your config and changed xpaths and database parameters&lt;/p&gt;</comment>
                            <comment id="13420972" author="sejbot" created="Mon, 23 Jul 2012 21:22:22 +0000"  >&lt;p&gt;I&apos;m having the same issue in 3.6. If there is a reason not to re-initialize the XPathReader every time, maybe the variable resolvement part could be moved from the initalization to readRow()&lt;/p&gt;</comment>
                            <comment id="15593900" author="caomanhdat" created="Fri, 21 Oct 2016 04:04:28 +0000"  >&lt;p&gt;In this patch, I solved the problem by resolve &amp;amp; cached variables when read rows (not resolve variables on the init of XPathRecordReader like before).&lt;/p&gt;</comment>
                            <comment id="15608212" author="noble.paul" created="Wed, 26 Oct 2016 11:42:24 +0000"  >&lt;p&gt;Diagnosis:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;XPathRecordReader&lt;/tt&gt; objects are cached and reused between XMLs. It&apos;s OK as long as the xpaths themselves don&apos;t have any variables. If the xpath has a variable such as &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; 
xpath=&lt;span class=&quot;code-quote&quot;&gt;&quot;/tissue-samples/tissue[@fma-id=&lt;span class=&quot;code-quote&quot;&gt;&apos;${Sequence.sampleTissueCode}&apos;&lt;/span&gt;]/parent-path&quot;&lt;/span&gt; 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;then it needs to be recreated before starting with each XML file.&lt;/p&gt;

&lt;p&gt; Solutions:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;make &lt;tt&gt;XPathRecordReader&lt;/tt&gt; aware of the templates and recompute them before each XML&lt;/li&gt;
	&lt;li&gt;If templates are present in  &lt;tt&gt;xpath&lt;/tt&gt; or &lt;tt&gt;forEach&lt;/tt&gt; , discard the &lt;tt&gt;XPathRecordReader&lt;/tt&gt; instance before every XML&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;For sake of simplicity I would recommend #2&lt;/p&gt;</comment>
                            <comment id="15608680" author="caomanhdat" created="Wed, 26 Oct 2016 14:46:52 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt;&lt;br/&gt;
This is the patch based on solutions #2, the patch is much cleaner and simpler.&lt;/p&gt;</comment>
                            <comment id="15611239" author="noble.paul" created="Thu, 27 Oct 2016 08:57:01 +0000"  >&lt;p&gt;there was a bug&lt;/p&gt;</comment>
                            <comment id="15611314" author="jira-bot" created="Thu, 27 Oct 2016 09:22:37 +0000"  >&lt;p&gt;Commit d6b6e74703d5f2d29c110d3a7d9491306af9be2c in lucene-solr&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d6b6e74&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=d6b6e74&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2094&quot; title=&quot;When using a XPathEntityProcessor nested within another entity, the xpathReader isn&amp;#39;t reinitilized for each new document &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2094&quot;&gt;&lt;del&gt;SOLR-2094&lt;/del&gt;&lt;/a&gt;: XPathEntityProcessor should reinitialize the XPathRecordReader instance if the &apos;forEach&apos; or &apos;xpath&apos; attributes are templates &amp;amp; it is not a root entity&lt;/p&gt;</comment>
                            <comment id="15611319" author="jira-bot" created="Thu, 27 Oct 2016 09:24:43 +0000"  >&lt;p&gt;Commit fa6fbc08342da5b4e4a4073e587f40892297a9f7 in lucene-solr&apos;s branch refs/heads/branch_6x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noble.paul&quot; class=&quot;user-hover&quot; rel=&quot;noble.paul&quot;&gt;noble.paul&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=fa6fbc0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=lucene-solr.git;h=fa6fbc0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-2094&quot; title=&quot;When using a XPathEntityProcessor nested within another entity, the xpathReader isn&amp;#39;t reinitilized for each new document &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-2094&quot;&gt;&lt;del&gt;SOLR-2094&lt;/del&gt;&lt;/a&gt;: XPathEntityProcessor should reinitialize the XPathRecordReader instance if the &apos;forEach&apos; or &apos;xpath&apos; attributes are templates &amp;amp; it is not a root entity&lt;/p&gt;</comment>
                            <comment id="15650320" author="shalinmangar" created="Wed, 9 Nov 2016 08:39:13 +0000"  >&lt;p&gt;Closing after 6.3.0 release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12835530" name="SOLR-2094.patch" size="12039" author="noble.paul" created="Thu, 27 Oct 2016 09:10:19 +0000"/>
                            <attachment id="12835524" name="SOLR-2094.patch" size="11767" author="noble.paul" created="Thu, 27 Oct 2016 08:57:01 +0000"/>
                            <attachment id="12835352" name="SOLR-2094.patch" size="11416" author="caomanhdat" created="Wed, 26 Oct 2016 14:48:06 +0000"/>
                            <attachment id="12834601" name="SOLR-2094.patch" size="14743" author="caomanhdat" created="Fri, 21 Oct 2016 04:04:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5410</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 1 week, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03mu7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19133</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>