<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:34:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-4426] NRTCachingDirectoryFactory does not initialize maxCachedMB and maxMergeSizeMB if &lt;directoryFactory&gt; is not present in solrconfig.xml</title>
                <link>https://issues.apache.org/jira/browse/SOLR-4426</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;SolrCore correctly defaults to a NRTCachingDirectoryFactory if no &amp;lt;cirectoryFactory&amp;gt; is explicitly specified in solrconfig.xml, but the maxCachedMB and maxMergeSizeMB parameters are not initialized with the same default values as when an explicit directory factory is specified with no argument values given.&lt;/p&gt;

&lt;p&gt;Repro:&lt;/p&gt;

&lt;p&gt;Remove the explicit directory factory from the Solr 4.1 example solrconfig.xml:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &amp;lt;directoryFactory name=&lt;span class=&quot;code-quote&quot;&gt;&quot;DirectoryFactory&quot;&lt;/span&gt; 
                    class=&lt;span class=&quot;code-quote&quot;&gt;&quot;${solr.directoryFactory:solr.NRTCachingDirectoryFactory}&quot;&lt;/span&gt;/&amp;gt; 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Start Solr.&lt;/p&gt;

&lt;p&gt;In the console output you will see:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Feb 10, 2013 7:28:55 PM org.apache.solr.core.SolrDeletionPolicy onCommit
INFO: SolrDeletionPolicy.onCommit: commits:num=1
        commit{dir=NRTCachingDirectory(org.apache.lucene.store.SimpleFSDirectory@C:\cygwin\home\projects\solr-4.1.0\solr-4.1.0\example-solrconfig\solr\collection1\data\index lockFactory=org.apache.lucene.store.NativeFSLockFactory@a93430; maxCacheMB=0.0 maxMergeSizeMB=0.0),segFN=segments_1,generation=1,filenames=[segments_1]
F&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note the &quot;maxCacheMB=0.0&quot; and &quot;maxMergeSizeMB=0.0&quot;. These should be defaulting to values of 48.0 and  4.0, respectively.&lt;/p&gt;

&lt;p&gt;In SolrCore.java we have:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;   &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void initDirectoryFactory() {
    DirectoryFactory dirFactory;
    PluginInfo info = solrConfig.getPluginInfo(DirectoryFactory.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getName());
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (info != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      log.info(info.className);
      dirFactory = getResourceLoader().newInstance(info.className, DirectoryFactory.class);
      dirFactory.init(info.initArgs);
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
      log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;solr.NRTCachingDirectoryFactory&quot;&lt;/span&gt;);
      dirFactory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NRTCachingDirectoryFactory();
    }
    &lt;span class=&quot;code-comment&quot;&gt;// And set it
&lt;/span&gt;    directoryFactory = dirFactory;
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The difference between an explicit directory factory with no arguments and the implicit directory factory default is that the &quot;init&quot; method is not called for the latter. It is only in the init method that the default values are set.&lt;/p&gt;

&lt;p&gt;I suggest changing NRTCachingDirectoryFactory.java from:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;NRTCachingDirectoryFactory &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; StandardDirectoryFactory {
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; maxMergeSizeMB;
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; maxCachedMB;

  @Override
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void init(NamedList args) {
    &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.init(args);
    SolrParams params = SolrParams.toSolrParams(args);
    maxMergeSizeMB = params.getDouble(&lt;span class=&quot;code-quote&quot;&gt;&quot;maxMergeSizeMB&quot;&lt;/span&gt;, 4);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (maxMergeSizeMB &amp;lt;= 0){
      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalArgumentException(&lt;span class=&quot;code-quote&quot;&gt;&quot;maxMergeSizeMB must be greater than 0&quot;&lt;/span&gt;);
    }
    maxCachedMB = params.getDouble(&lt;span class=&quot;code-quote&quot;&gt;&quot;maxCachedMB&quot;&lt;/span&gt;, 48);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (maxCachedMB &amp;lt;= 0){
      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalArgumentException(&lt;span class=&quot;code-quote&quot;&gt;&quot;maxCachedMB must be greater than 0&quot;&lt;/span&gt;);
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;to:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;NRTCachingDirectoryFactory &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; StandardDirectoryFactory {
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; DEFAULT_MAX_MERGE_SIZE_MB = 4;
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; maxMergeSizeMB = DEFAULT_MAX_MERGE_SIZE_MB;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; DEFAULT_MAX_CACHED_MB = 48;
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; maxCachedMB = DEFAULT_MAX_CACHED_MB;

  @Override
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void init(NamedList args) {
    &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.init(args);
    SolrParams params = SolrParams.toSolrParams(args);
    maxMergeSizeMB = params.getDouble(&lt;span class=&quot;code-quote&quot;&gt;&quot;maxMergeSizeMB&quot;&lt;/span&gt;, DEFAULT_MAX_MERGE_SIZE_MB);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (maxMergeSizeMB &amp;lt;= 0){
      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalArgumentException(&lt;span class=&quot;code-quote&quot;&gt;&quot;maxMergeSizeMB must be greater than 0&quot;&lt;/span&gt;);
    }
    maxCachedMB = params.getDouble(&lt;span class=&quot;code-quote&quot;&gt;&quot;maxCachedMB&quot;&lt;/span&gt;, DEFAULT_MAX_CACHED_MB);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (maxCachedMB &amp;lt;= 0){
      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalArgumentException(&lt;span class=&quot;code-quote&quot;&gt;&quot;maxCachedMB must be greater than 0&quot;&lt;/span&gt;);
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note: This issue is not present in Solr 4.0 since the two parameters were hardwired in the NRTCachingDirectoryFactory.create method.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12631681">SOLR-4426</key>
            <summary>NRTCachingDirectoryFactory does not initialize maxCachedMB and maxMergeSizeMB if &lt;directoryFactory&gt; is not present in solrconfig.xml</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shalin">Shalin Shekhar Mangar</assignee>
                                    <reporter username="jkrupan">Jack Krupansky</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 Feb 2013 00:39:39 +0000</created>
                <updated>Mon, 9 May 2016 18:57:32 +0000</updated>
                            <resolved>Mon, 11 Feb 2013 14:33:07 +0000</resolved>
                                    <version>4.1</version>
                                    <fixVersion>4.2</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                    <component>Schema and Analysis</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13575807" author="commit-tag-bot" created="Mon, 11 Feb 2013 14:30:12 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;trunk commit&amp;#93;&lt;/span&gt; Shalin Shekhar Mangar&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1444782&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1444782&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4426&quot; title=&quot;NRTCachingDirectoryFactory does not initialize maxCachedMB and maxMergeSizeMB if &amp;lt;directoryFactory&amp;gt; is not present in solrconfig.xml&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4426&quot;&gt;&lt;del&gt;SOLR-4426&lt;/del&gt;&lt;/a&gt;: NRTCachingDirectoryFactory does not initialize maxCachedMB and maxMergeSizeMB if &amp;lt;directoryFactory&amp;gt; is not present in solrconfig.xml&lt;/p&gt;</comment>
                            <comment id="13575814" author="commit-tag-bot" created="Mon, 11 Feb 2013 14:40:11 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;branch_4x commit&amp;#93;&lt;/span&gt; Shalin Shekhar Mangar&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1444786&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1444786&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-4426&quot; title=&quot;NRTCachingDirectoryFactory does not initialize maxCachedMB and maxMergeSizeMB if &amp;lt;directoryFactory&amp;gt; is not present in solrconfig.xml&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-4426&quot;&gt;&lt;del&gt;SOLR-4426&lt;/del&gt;&lt;/a&gt;: NRTCachingDirectoryFactory does not initialize maxCachedMB and maxMergeSizeMB if &amp;lt;directoryFactory&amp;gt; is not present in solrconfig.xml&lt;/p&gt;</comment>
                            <comment id="13654122" author="thetaphi" created="Fri, 10 May 2013 10:34:06 +0000"  >&lt;p&gt;Closed after release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12568823" name="SOLR-4426.patch" size="2475" author="shalin" created="Mon, 11 Feb 2013 14:27:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>312177</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 28 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1hvg7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>312523</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>