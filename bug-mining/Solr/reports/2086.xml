<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 03:56:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SOLR-6452] StatsComponent &quot;missing&quot; stat won&apos;t work with docValues=true and indexed=false</title>
                <link>https://issues.apache.org/jira/browse/SOLR-6452</link>
                <project id="12310230" key="SOLR">Solr</project>
                    <description>&lt;p&gt;StatsComponent can work with DocValues, but it still required to use indexed=true for the &quot;missing&quot; stat to work. Missing values should be obtained from the docValues too.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12737856">SOLR-6452</key>
            <summary>StatsComponent &quot;missing&quot; stat won&apos;t work with docValues=true and indexed=false</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tflobbe">Tomas Eduardo Fernandez Lobbe</assignee>
                                    <reporter username="tflobbe">Tomas Eduardo Fernandez Lobbe</reporter>
                        <labels>
                    </labels>
                <created>Fri, 29 Aug 2014 17:38:54 +0000</created>
                <updated>Wed, 2 Oct 2019 17:30:42 +0000</updated>
                            <resolved>Fri, 12 Sep 2014 04:45:13 +0000</resolved>
                                    <version>4.10</version>
                    <version>6.0</version>
                                    <fixVersion>4.10.2</fixVersion>
                    <fixVersion>5.0</fixVersion>
                    <fixVersion>6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14115991" author="simplebread" created="Fri, 29 Aug 2014 22:48:29 +0000"  >&lt;p&gt;Looks like this bug is only for multi-valued field. &lt;/p&gt;</comment>
                            <comment id="14120316" author="simplebread" created="Wed, 3 Sep 2014 19:45:56 +0000"  >&lt;p&gt;Upload my first fix for &quot;missing&quot; stat. &lt;br/&gt;
Still working on it and need some suggestions.&lt;/p&gt;

&lt;p&gt;My first patch &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/tongue.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;</comment>
                            <comment id="14123392" author="simplebread" created="Fri, 5 Sep 2014 19:01:23 +0000"  >&lt;p&gt;I talked with Tomas, new to fix the bug based on Tomas&apos;s comment.&lt;/p&gt;

&lt;p&gt;Right now, for multi-value stats field, we only test stats.facet on String fieldtype. I add another simple test case testing stats.facet on int type. Looks like this part is still buggy.&lt;/p&gt;</comment>
                            <comment id="14127542" author="tomasflobbe" created="Tue, 9 Sep 2014 21:00:26 +0000"  >&lt;p&gt;Thanks for the patch &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=simpleBread&quot; class=&quot;user-hover&quot; rel=&quot;simpleBread&quot;&gt;simpleBread&lt;/a&gt;. As an optimization, why don&apos;t you make the &lt;tt&gt;missingStats&lt;/tt&gt; a &lt;tt&gt;Map&amp;lt;Integer, Integer&amp;gt;&lt;/tt&gt; and use the ords as keys instead of the terms. That way you don&apos;t need to do the lookupOrd for all docs, and you do it only once per term in the &lt;tt&gt;accumulateMissing()&lt;/tt&gt; method. &lt;/p&gt;</comment>
                            <comment id="14127614" author="simplebread" created="Tue, 9 Sep 2014 21:48:48 +0000"  >&lt;p&gt;Update based on the comments.&lt;/p&gt;

&lt;p&gt;Thanks Tomas&lt;/p&gt;</comment>
                            <comment id="14127797" author="tomasflobbe" created="Tue, 9 Sep 2014 23:39:26 +0000"  >&lt;p&gt;I think the patch looks good, I&apos;ll commit it shortly&lt;/p&gt;</comment>
                            <comment id="14127859" author="tomasflobbe" created="Wed, 10 Sep 2014 00:35:16 +0000"  >&lt;p&gt;New patch against trunk plus minor changes&lt;/p&gt;</comment>
                            <comment id="14128895" author="jira-bot" created="Wed, 10 Sep 2014 18:36:28 +0000"  >&lt;p&gt;Commit 1624091 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tflobbe&quot; class=&quot;user-hover&quot; rel=&quot;tflobbe&quot;&gt;tflobbe&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1624091&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1624091&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6452&quot; title=&quot;StatsComponent &amp;quot;missing&amp;quot; stat won&amp;#39;t work with docValues=true and indexed=false&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6452&quot;&gt;&lt;del&gt;SOLR-6452&lt;/del&gt;&lt;/a&gt;: StatsComponent&apos;s stat &apos;missing&apos; will work on fields with docValues=true and indexed=false&lt;/p&gt;</comment>
                            <comment id="14129050" author="jira-bot" created="Wed, 10 Sep 2014 20:38:19 +0000"  >&lt;p&gt;Commit 1624117 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tflobbe&quot; class=&quot;user-hover&quot; rel=&quot;tflobbe&quot;&gt;tflobbe&lt;/a&gt; in branch &apos;dev/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1624117&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1624117&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6452&quot; title=&quot;StatsComponent &amp;quot;missing&amp;quot; stat won&amp;#39;t work with docValues=true and indexed=false&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6452&quot;&gt;&lt;del&gt;SOLR-6452&lt;/del&gt;&lt;/a&gt;: CHANGES.txt entry&lt;/p&gt;</comment>
                            <comment id="14129124" author="vzhovtiuk" created="Wed, 10 Sep 2014 21:17:18 +0000"  >&lt;p&gt;There are few issues in committed code addressed in attached patch:&lt;br/&gt;
1. Accumulate methods should not return stats specific numbers (it is generic calculation).&lt;br/&gt;
Attached solution with nested container class.&lt;br/&gt;
Also made them private scoped.&lt;/p&gt;

&lt;p&gt;2. Reduced visibility of fields in FieldFacetStats.&lt;br/&gt;
Created getter to expose FieldFacetStats.facetStatsValues.&lt;/p&gt;

&lt;p&gt;3. Methods FieldFacetStats#accumulateMissing and FieldFacetStats#accumulateTermNum does not throw any IO exception&lt;/p&gt;

&lt;p&gt;4. Why missing facet counters cant work on StatsValues directly without intermediate maps. They have all required required methods that look like &lt;br/&gt;
duplicated in org.apache.solr.handler.component.FieldFacetStats#facetMissingNum and org.apache.solr.handler.component.AbstractStatsValues#missing?&lt;br/&gt;
Will try to unite it.&lt;/p&gt;</comment>
                            <comment id="14129192" author="tomasflobbe" created="Wed, 10 Sep 2014 21:52:50 +0000"  >&lt;blockquote&gt;&lt;p&gt;1. Accumulate methods should not return stats specific numbers (it is generic calculation).&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I don&apos;t see the issue here. Can you provide a test that exposes the bug?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;2. Reduced visibility of fields in FieldFacetStats.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think this should be done in trunk only&lt;/p&gt;</comment>
                            <comment id="14130550" author="tomasflobbe" created="Thu, 11 Sep 2014 19:19:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vzhovtiuk&quot; class=&quot;user-hover&quot; rel=&quot;vzhovtiuk&quot;&gt;vzhovtiuk&lt;/a&gt; Do you have that test? or a pointer to what it would fail? Otherwise I&apos;m going to merge the code to branch_4x and mark this Jira as resolved. I liked the code refactor you did, but the way I see it that&apos;s not necessary to fix this bug.&lt;/p&gt;</comment>
                            <comment id="14130802" author="jira-bot" created="Thu, 11 Sep 2014 22:05:28 +0000"  >&lt;p&gt;Commit 1624406 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tflobbe&quot; class=&quot;user-hover&quot; rel=&quot;tflobbe&quot;&gt;tflobbe&lt;/a&gt; in branch &apos;dev/branches/branch_4x&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1624406&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1624406&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6452&quot; title=&quot;StatsComponent &amp;quot;missing&amp;quot; stat won&amp;#39;t work with docValues=true and indexed=false&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6452&quot;&gt;&lt;del&gt;SOLR-6452&lt;/del&gt;&lt;/a&gt;: StatsComponent&apos;s stat &apos;missing&apos; will work on fields with docValues=true and indexed=false&lt;/p&gt;</comment>
                            <comment id="14132990" author="vzhovtiuk" created="Sat, 13 Sep 2014 22:07:12 +0000"  >&lt;p&gt;Added patch based on trunk.&lt;br/&gt;
Added facet fields tests for integer and double types, and facet value stats is not available. Does it require new issue or reopen &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6452&quot; title=&quot;StatsComponent &amp;quot;missing&amp;quot; stat won&amp;#39;t work with docValues=true and indexed=false&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6452&quot;&gt;&lt;del&gt;SOLR-6452&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;

&lt;p&gt;Implementation of this issue can be improved in few cases:&lt;br/&gt;
1. Accumulate methods should not return stats specific numbers (it is generic). Attached solution with container class. Also made them private scoped.&lt;br/&gt;
Returning just missing fields from accumulate methods does not allow you to extend it with additional counts field, therefore i propose to leave void.&lt;/p&gt;

&lt;p&gt;2. Reduced visibility of fields in FieldFacetStats.&lt;br/&gt;
Created getter to expose FieldFacetStats.facetStatsValues.&lt;/p&gt;

&lt;p&gt;3. Methods FieldFacetStats#accumulateMissing and FieldFacetStats#accumulateTermNum does not throw any IO exception&lt;/p&gt;

&lt;p&gt;4. We don&apos;t need intermediate maps to accumulate missing counts. Changed org.apache.solr.handler.component.FieldFacetStats#facetMissingNum &lt;br/&gt;
to work directly on StatsValues structure and removed  org.apache.solr.handler.component.FieldFacetStats#accumulateMissing. &lt;br/&gt;
We don&apos;t need to have it in 2 phases.&lt;/p&gt;</comment>
                            <comment id="14133461" author="simplebread" created="Mon, 15 Sep 2014 00:45:49 +0000"  >&lt;p&gt;This is a known issue, facet value stats only works for string type right now, tracked in: &lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-1782&quot; title=&quot;stats.facet assumes FieldCache.StringIndex - fails horribly on multivalued fields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-1782&quot;&gt;&lt;del&gt;SOLR-1782&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This Jira is only for &quot;missing&quot; stat.&lt;/p&gt;</comment>
                            <comment id="14136634" author="tomasflobbe" created="Wed, 17 Sep 2014 01:24:48 +0000"  >&lt;p&gt;I think the fix for this issue was correct. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vzhovtiuk&quot; class=&quot;user-hover&quot; rel=&quot;vzhovtiuk&quot;&gt;vzhovtiuk&lt;/a&gt;, please open a new Jira for your suggested refactor. &lt;/p&gt;</comment>
                            <comment id="14181016" author="jira-bot" created="Thu, 23 Oct 2014 04:55:57 +0000"  >&lt;p&gt;Commit 1633741 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tflobbe&quot; class=&quot;user-hover&quot; rel=&quot;tflobbe&quot;&gt;tflobbe&lt;/a&gt; in branch &apos;dev/branches/lucene_solr_4_10&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1633741&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1633741&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SOLR-6452&quot; title=&quot;StatsComponent &amp;quot;missing&amp;quot; stat won&amp;#39;t work with docValues=true and indexed=false&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SOLR-6452&quot;&gt;&lt;del&gt;SOLR-6452&lt;/del&gt;&lt;/a&gt;: StatsComponent&apos;s stat &apos;missing&apos; will work on fields with docValues=true and indexed=false&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12710788">SOLR-6024</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12742665">SOLR-6541</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12668611" name="SOLR-6452-trunk.patch" size="19198" author="vzhovtiuk" created="Sat, 13 Sep 2014 22:07:12 +0000"/>
                            <attachment id="12666865" name="SOLR-6452-trunk.patch" size="18586" author="simpleBread" created="Fri, 5 Sep 2014 19:01:23 +0000"/>
                            <attachment id="12666300" name="SOLR-6452-trunk.patch" size="27859" author="simpleBread" created="Wed, 3 Sep 2014 19:45:56 +0000"/>
                            <attachment id="12667853" name="SOLR-6452.patch" size="9301" author="vzhovtiuk" created="Wed, 10 Sep 2014 21:17:18 +0000"/>
                            <attachment id="12667553" name="SOLR-6452.patch" size="19808" author="tflobbe" created="Wed, 10 Sep 2014 00:35:16 +0000"/>
                            <attachment id="12667499" name="SOLR-6452.patch" size="18499" author="simpleBread" created="Tue, 9 Sep 2014 21:48:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 4 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1zhuv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12313321" key="com.atlassian.jira.toolkit:message">
                        <customfieldname>Solr Mailing List Info</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>