<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 19:29:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[JAMES-2253] addFooter mailet doesn&apos;t work for multipart mail</title>
                <link>https://issues.apache.org/jira/browse/JAMES-2253</link>
                <project id="10411" key="JAMES">James Server</project>
                    <description>&lt;p&gt;The addFooter mailet doesn&apos;t work for multipart mail, though It works for text mail. (Tested with 3.0.1.)&lt;/p&gt;

&lt;p&gt;The addFooterTest ends successfully but the mailet doesn&apos;t work on the real James server.&lt;br/&gt;
The addFooterTest uses javax.mail.internet.MimeMessage, but the real mailet uses org.apache.james.server.core.MimeMessageCopyOnWriteProxy which extends MimeMessage.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13123393">JAMES-2253</key>
            <summary>addFooter mailet doesn&apos;t work for multipart mail</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="apptaro">Taro App</reporter>
                        <labels>
                    </labels>
                <created>Thu, 7 Dec 2017 08:35:48 +0000</created>
                <updated>Thu, 4 Jan 2018 02:36:25 +0000</updated>
                            <resolved>Thu, 4 Jan 2018 02:36:18 +0000</resolved>
                                    <version>3.0.0-beta5</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16281522" author="apptaro" created="Thu, 7 Dec 2017 09:00:36 +0000"  >&lt;p&gt;Attached is the patch to fix the issue by modifying AddFooter.java.&lt;br/&gt;
This approach may be the same way which is discussed in &lt;a href=&quot;https://issues.apache.org/jira/browse/JAMES-1910&quot; title=&quot;can&amp;#39;t add footer when use email client (ex:foxmail)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JAMES-1910&quot;&gt;JAMES-1910&lt;/a&gt; &amp;amp; &lt;a href=&quot;https://issues.apache.org/jira/browse/JAMES-443&quot; title=&quot;AddFooter and Encoding issues&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JAMES-443&quot;&gt;&lt;del&gt;JAMES-443&lt;/del&gt;&lt;/a&gt;,&lt;br/&gt;
but I wonder if this is the right approach.&lt;/p&gt;

&lt;p&gt;Maybe it&apos;s better to make a modification to MimeMessageCopyOnWriteProxy.java.&lt;/p&gt;

&lt;p&gt;I&apos;m also concerned if other similar mailets which modify contents have the same issue with multipart mail, because the issue here is essentially that MimeBodyPart.setContent(String) is not effective unless you call MimePart.setContent(Multipart) on its ancestor.&lt;/p&gt;</comment>
                            <comment id="16292127" author="btellier" created="Fri, 15 Dec 2017 06:59:38 +0000"  >&lt;p&gt;Hi, Sorry for the answer delay.&lt;/p&gt;

&lt;p&gt;I first wanted to thank you for your work and the contribution to the James project. Your issue is well detailed and the fix looks good to me.&lt;/p&gt;

&lt;p&gt;Would it be possible for you to open this pull request on GitHub? &lt;a href=&quot;https://github.com/apache/james-project&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project&lt;/a&gt; This will makes exchanging on it easier.&lt;/p&gt;

&lt;p&gt;Thanks, and best regards,&lt;/p&gt;

&lt;p&gt;Benoit&lt;/p&gt;</comment>
                            <comment id="16294549" author="githubbot" created="Mon, 18 Dec 2017 06:20:59 +0000"  >&lt;p&gt;GitHub user apptaro opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/james-project/pull/88&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/88&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/JAMES-2253&quot; title=&quot;addFooter mailet doesn&amp;#39;t work for multipart mail&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JAMES-2253&quot;&gt;&lt;del&gt;JAMES-2253&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/apptaro/james-project&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apptaro/james-project&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/JAMES-2253&quot; title=&quot;addFooter mailet doesn&amp;#39;t work for multipart mail&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JAMES-2253&quot;&gt;&lt;del&gt;JAMES-2253&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/james-project/pull/88.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/88.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #88&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 8fdadb05822af91dbb0bca64ecaa3ba24ef58fc6&lt;br/&gt;
Author: apptaro &amp;lt;apptaro@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-12-18T06:20:18Z&lt;/p&gt;

&lt;p&gt;    Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/JAMES-2253&quot; title=&quot;addFooter mailet doesn&amp;#39;t work for multipart mail&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JAMES-2253&quot;&gt;&lt;del&gt;JAMES-2253&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16294550" author="apptaro" created="Mon, 18 Dec 2017 06:21:29 +0000"  >&lt;p&gt;Created the PR: &lt;a href=&quot;https://github.com/apache/james-project/pull/88&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/88&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16294585" author="githubbot" created="Mon, 18 Dec 2017 07:11:00 +0000"  >&lt;p&gt;Github user chibenwa commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/james-project/pull/88#discussion_r157411809&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/88#discussion_r157411809&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: mailet/standard/src/main/java/org/apache/james/transport/mailets/AddFooter.java &amp;#8212;&lt;br/&gt;
    @@ -94,11 +94,18 @@ private boolean attachFooter(MimePart part) throws MessagingException, IOExcepti&lt;br/&gt;
             if (part.isMimeType(&quot;multipart/mixed&quot;)&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; part.isMimeType(&quot;multipart/related&quot;)) {&lt;br/&gt;
                 MimeMultipart multipart = (MimeMultipart) part.getContent();
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return attachFooterToFirstPart(multipart);&lt;br/&gt;
    +            boolean added = attachFooterToFirstPart(multipart);&lt;br/&gt;
    +            if (added) 
{
    +            	part.setContent(multipart);
    +            }&lt;br/&gt;
    +            return added;&lt;br/&gt;
     &lt;br/&gt;
             } else if (part.isMimeType(&quot;multipart/alternative&quot;)) {&lt;br/&gt;
                 MimeMultipart multipart = (MimeMultipart) part.getContent();&lt;br/&gt;
    -            return attachFooterToAllSubparts(multipart);&lt;br/&gt;
    +            boolean added = attachFooterToAllSubparts(multipart);&lt;br/&gt;
    +            if (added) {    +            	part.setContent(multipart);    +            }
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
&lt;/th&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;    I guess you forgot the `return added` stuff here...&lt;/p&gt;

&lt;p&gt;    That would cause `multipart/alternative` to not be well handled anymore...&lt;/p&gt;

&lt;p&gt;    By the way forgetting this return breaks tests.&lt;/p&gt;</comment>
                            <comment id="16294590" author="githubbot" created="Mon, 18 Dec 2017 07:20:51 +0000"  >&lt;p&gt;Github user chibenwa commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/james-project/pull/88&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/88&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I will duplicate the PR for unit testing, and handle further remarks. If interrested follow this &lt;span class=&quot;error&quot;&gt;&amp;#91;soon to be provided&amp;#93;&lt;/span&gt; link.&lt;/p&gt;

&lt;p&gt;    Thanks again for this contribution.&lt;/p&gt;

&lt;p&gt;    Best regard,&lt;/p&gt;

&lt;p&gt;    Benoit Tellier&lt;/p&gt;</comment>
                            <comment id="16294591" author="githubbot" created="Mon, 18 Dec 2017 07:22:24 +0000"  >&lt;p&gt;Github user apptaro commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/james-project/pull/88&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/88&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Hi, thank you for incorporating my fix!&lt;/p&gt;</comment>
                            <comment id="16294594" author="githubbot" created="Mon, 18 Dec 2017 07:26:45 +0000"  >&lt;p&gt;Github user chibenwa commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/james-project/pull/88&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/88&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    You are very welcome.&lt;/p&gt;

&lt;p&gt;    Might you have any question / need any support using the James server, feel free to ask us using the mailing list or the gitter channel.&lt;/p&gt;</comment>
                            <comment id="16310640" author="githubbot" created="Thu, 4 Jan 2018 02:32:14 +0000"  >&lt;p&gt;Github user chibenwa commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/james-project/pull/88&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/88&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Hi!&lt;/p&gt;

&lt;p&gt;    This contribution had been merged. Thanks again for your support to the James project, your help is both useful and appreciable. Might you encounter any additional issues or want new features please feel free to contribute it.&lt;/p&gt;

&lt;p&gt;    Futhermore, while merging this pull request I had been asked to write an integration test for this PR. If you are interested, you can take a look here: &lt;a href=&quot;https://github.com/linagora/james-project/pull/1198/commits/c785e20a7a4a68d764d9afa8f5d142fc93a4d524&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/linagora/james-project/pull/1198/commits/c785e20a7a4a68d764d9afa8f5d142fc93a4d524&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    As always, wouldn&apos;t you mind closing this pull request?&lt;/p&gt;

&lt;p&gt;    Best regards,&lt;/p&gt;

&lt;p&gt;    Benoit&lt;/p&gt;</comment>
                            <comment id="16310647" author="btellier" created="Thu, 4 Jan 2018 02:36:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/james-project/pull/88&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/88&lt;/a&gt; solved the issue. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apptaro&quot; class=&quot;user-hover&quot; rel=&quot;apptaro&quot;&gt;apptaro&lt;/a&gt; for the fix&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                            <outwardlinks description="supercedes">
                                        <issuelink>
            <issuekey id="13035158">JAMES-1910</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12901024" name="AddFooter.patch" size="1031" author="apptaro" created="Thu, 7 Dec 2017 08:46:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 45 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3nmzb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>