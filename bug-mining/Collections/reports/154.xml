<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sun Nov 09 05:54:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COLLECTIONS-661] Intermittent test failures in Windows for HashSetValuedHashMap</title>
                <link>https://issues.apache.org/jira/browse/COLLECTIONS-661</link>
                <project id="12310465" key="COLLECTIONS">Commons Collections</project>
                    <description>&lt;p&gt;The collection HashSetValuedHashMap was added in 4.1. On Windows, test failures are not so common on JVM 8. But on Linux they are harder to happen (but still do &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;).&lt;/p&gt;

&lt;p&gt;When using Windows and JVM 8, running tests on Eclipse, or Maven fail. But debugging on Windows with Eclipse sometimes work. Indicating it may be due to a concurrency issue, where debugging adds some extra time hiding the real issue.&lt;/p&gt;

&lt;p&gt;I have a few ideas of where/why it could be happening, but am without a Windows box for a few days as I&apos;m travelling. I&apos;m reading the codebase in the meantime, but if anybody feels like working on it, feel free to chime in and suggest a fix/patch.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://travis-ci.org/apache/commons-collections/jobs/282169803&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/apache/commons-collections/jobs/282169803&lt;/a&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://markmail.org/thread/exwm7ggjtxzbtlkd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://markmail.org/thread/exwm7ggjtxzbtlkd&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13106660">COLLECTIONS-661</key>
            <summary>Intermittent test failures in Windows for HashSetValuedHashMap</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kinow">Bruno P. Kinoshita</assignee>
                                    <reporter username="kinow">Bruno P. Kinoshita</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 Oct 2017 09:54:08 +0000</created>
                <updated>Thu, 12 Oct 2017 06:31:44 +0000</updated>
                            <resolved>Thu, 12 Oct 2017 06:31:44 +0000</resolved>
                                    <version>4.1</version>
                                    <fixVersion>4.2</fixVersion>
                                    <component>Map</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16190118" author="garydgregory" created="Tue, 3 Oct 2017 18:37:16 +0000"  >&lt;p&gt;Could this be related to this note in &lt;tt&gt;Object.hashCode(Object)&lt;/tt&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;     * &amp;lt;li&amp;gt;It is &amp;lt;em&amp;gt;not&amp;lt;/em&amp;gt; required that &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; two objects are unequal
     *     according to the {@link java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;#equals(java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;)}
     *     method, then calling the {@code hashCode} method on each of the
     *     two objects must produce distinct integer results.  However, the
     *     programmer should be aware that producing distinct integer results
     *     &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; unequal objects may improve the performance of hash tables.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16199913" author="githubbot" created="Wed, 11 Oct 2017 07:37:48 +0000"  >&lt;p&gt;GitHub user kinow opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-collections/pull/28&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-collections/pull/28&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/COLLECTIONS-661&quot; title=&quot;Intermittent test failures in Windows for HashSetValuedHashMap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COLLECTIONS-661&quot;&gt;&lt;del&gt;COLLECTIONS-661&lt;/del&gt;&lt;/a&gt;: fix for concurrency issue in HashSetValuedHashMapTest&lt;/p&gt;

&lt;p&gt;    The `getMap()` method, when testing a `HashSetValuedHashMap`, would return an object of this type. Which is an instance of `SetValuedMap`.&lt;/p&gt;

&lt;p&gt;    Running it in debug mode would - most of the times - run the tests and succeed. Running normally - especially on Windows - would result in intermittent, but very frequent, failures.&lt;/p&gt;

&lt;p&gt;    The `getMap()` method sometimes, depending on the order and execution of tests, will be null. So the collection added to the map will be either a `Hashset`, or a `Arrays$ArrayList`. When the types are different, `hashCode()` and `equals()` calls return incorrect values, resulting in the errors we have seen in &lt;a href=&quot;https://issues.apache.org/jira/browse/COLLECTIONS-661&quot; title=&quot;Intermittent test failures in Windows for HashSetValuedHashMap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COLLECTIONS-661&quot;&gt;&lt;del&gt;COLLECTIONS-661&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;    A good solution would be to re-design the tests. The `TestMultiValuedMapAsMap` is testing `MultiValuedMap`&apos;s, which include `HashSetValuedHashMap`. However, some of its methods contain extra logic for when the type under test has some characteristics like being an instance of `SetValuedMap`.&lt;/p&gt;

&lt;p&gt;    It might be possible to come up with a better design, where there are multiple test classes, for `MultiValuedMap`&apos;s that use `SetValuedMap`&apos;s; `MultieValuedMap`&apos;s that use `List`&apos;s, and so it goes.&lt;/p&gt;

&lt;p&gt;    Or we could add a class to the parent class, with a flag defining the type under test. For now, I have used the `makeObject()` method, which returns the collection under test. Then I validate its instance type. There is also a comment above the code to indicate why we are using `makeObject()` and not `getMap()`.&lt;/p&gt;

&lt;p&gt;    It was a fun ticket. Happy to get feedback on better solutions, or feel free to edit this pull request if you have right to it, or merge if you are happy and it has gathered some consensus.&lt;/p&gt;

&lt;p&gt;    Cheers,&lt;br/&gt;
    Bruno&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/kinow/commons-collections&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/kinow/commons-collections&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/COLLECTIONS-661&quot; title=&quot;Intermittent test failures in Windows for HashSetValuedHashMap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COLLECTIONS-661&quot;&gt;&lt;del&gt;COLLECTIONS-661&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-collections/pull/28.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-collections/pull/28.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #28&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 6e8951ed0325abe3e07e32aded0b27aacdbc1011&lt;br/&gt;
Author: Bruno P. Kinoshita &amp;lt;brunodepaulak@yahoo.com.br&amp;gt;&lt;br/&gt;
Date:   2017-10-11T07:27:25Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/COLLECTIONS-661&quot; title=&quot;Intermittent test failures in Windows for HashSetValuedHashMap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COLLECTIONS-661&quot;&gt;&lt;del&gt;COLLECTIONS-661&lt;/del&gt;&lt;/a&gt;: fix for concurrency issue in HashSetValuedHashMapTest&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16199914" author="githubbot" created="Wed, 11 Oct 2017 07:37:48 +0000"  >&lt;p&gt;GitHub user kinow opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-collections/pull/28&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-collections/pull/28&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/COLLECTIONS-661&quot; title=&quot;Intermittent test failures in Windows for HashSetValuedHashMap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COLLECTIONS-661&quot;&gt;&lt;del&gt;COLLECTIONS-661&lt;/del&gt;&lt;/a&gt;: fix for concurrency issue in HashSetValuedHashMapTest&lt;/p&gt;

&lt;p&gt;    The `getMap()` method, when testing a `HashSetValuedHashMap`, would return an object of this type. Which is an instance of `SetValuedMap`.&lt;/p&gt;

&lt;p&gt;    Running it in debug mode would - most of the times - run the tests and succeed. Running normally - especially on Windows - would result in intermittent, but very frequent, failures.&lt;/p&gt;

&lt;p&gt;    The `getMap()` method sometimes, depending on the order and execution of tests, will be null. So the collection added to the map will be either a `Hashset`, or a `Arrays$ArrayList`. When the types are different, `hashCode()` and `equals()` calls return incorrect values, resulting in the errors we have seen in &lt;a href=&quot;https://issues.apache.org/jira/browse/COLLECTIONS-661&quot; title=&quot;Intermittent test failures in Windows for HashSetValuedHashMap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COLLECTIONS-661&quot;&gt;&lt;del&gt;COLLECTIONS-661&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;    A good solution would be to re-design the tests. The `TestMultiValuedMapAsMap` is testing `MultiValuedMap`&apos;s, which include `HashSetValuedHashMap`. However, some of its methods contain extra logic for when the type under test has some characteristics like being an instance of `SetValuedMap`.&lt;/p&gt;

&lt;p&gt;    It might be possible to come up with a better design, where there are multiple test classes, for `MultiValuedMap`&apos;s that use `SetValuedMap`&apos;s; `MultieValuedMap`&apos;s that use `List`&apos;s, and so it goes.&lt;/p&gt;

&lt;p&gt;    Or we could add a class to the parent class, with a flag defining the type under test. For now, I have used the `makeObject()` method, which returns the collection under test. Then I validate its instance type. There is also a comment above the code to indicate why we are using `makeObject()` and not `getMap()`.&lt;/p&gt;

&lt;p&gt;    It was a fun ticket. Happy to get feedback on better solutions, or feel free to edit this pull request if you have right to it, or merge if you are happy and it has gathered some consensus.&lt;/p&gt;

&lt;p&gt;    Cheers,&lt;br/&gt;
    Bruno&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/kinow/commons-collections&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/kinow/commons-collections&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/COLLECTIONS-661&quot; title=&quot;Intermittent test failures in Windows for HashSetValuedHashMap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COLLECTIONS-661&quot;&gt;&lt;del&gt;COLLECTIONS-661&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-collections/pull/28.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-collections/pull/28.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #28&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 6e8951ed0325abe3e07e32aded0b27aacdbc1011&lt;br/&gt;
Author: Bruno P. Kinoshita &amp;lt;brunodepaulak@yahoo.com.br&amp;gt;&lt;br/&gt;
Date:   2017-10-11T07:27:25Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/COLLECTIONS-661&quot; title=&quot;Intermittent test failures in Windows for HashSetValuedHashMap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COLLECTIONS-661&quot;&gt;&lt;del&gt;COLLECTIONS-661&lt;/del&gt;&lt;/a&gt;: fix for concurrency issue in HashSetValuedHashMapTest&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16199917" author="githubbot" created="Wed, 11 Oct 2017 07:40:32 +0000"  >&lt;p&gt;Github user coveralls commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-collections/pull/28&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-collections/pull/28&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;    [!&lt;span class=&quot;error&quot;&gt;&amp;#91;Coverage Status&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://coveralls.io/builds/13663731/badge)](https://coveralls.io/builds/13663731&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://coveralls.io/builds/13663731/badge)](https://coveralls.io/builds/13663731&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;    Coverage increased (+0.008%) to 85.126% when pulling *&lt;b&gt;6e8951ed0325abe3e07e32aded0b27aacdbc1011 on kinow:&lt;a href=&quot;https://issues.apache.org/jira/browse/COLLECTIONS-661&quot; title=&quot;Intermittent test failures in Windows for HashSetValuedHashMap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COLLECTIONS-661&quot;&gt;&lt;del&gt;COLLECTIONS-661&lt;/del&gt;&lt;/a&gt;&lt;/b&gt;* into *&lt;b&gt;1d21a49c27d9eab8d02785a783fcfba387a3e8e1 on apache:master&lt;/b&gt;*.&lt;/p&gt;
</comment>
                            <comment id="16201516" author="githubbot" created="Thu, 12 Oct 2017 06:29:56 +0000"  >&lt;p&gt;Github user kinow commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-collections/pull/28&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-collections/pull/28&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Merged inhttps://github.com/apache/commons-collections/commit/eed8a7adb3de7441751e846f4a75d110dd205f23. Closing it.&lt;/p&gt;</comment>
                            <comment id="16201517" author="githubbot" created="Thu, 12 Oct 2017 06:29:56 +0000"  >&lt;p&gt;Github user kinow closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-collections/pull/28&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-collections/pull/28&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16201518" author="githubbot" created="Thu, 12 Oct 2017 06:29:56 +0000"  >&lt;p&gt;Github user kinow closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-collections/pull/28&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-collections/pull/28&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 5 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3kthr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>