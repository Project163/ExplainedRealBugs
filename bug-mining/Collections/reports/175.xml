<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sun Nov 09 05:55:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COLLECTIONS-747] MultiKey.getKeys class cast exception</title>
                <link>https://issues.apache.org/jira/browse/COLLECTIONS-747</link>
                <project id="12310465" key="COLLECTIONS">Commons Collections</project>
                    <description>&lt;p&gt;When using an non-array constructor of MultiKey, an Object[] is created, which cannot be cast to a K[]&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.collections4.keyvalue.MultiKey;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MultiKeyClassCastException {

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
        MultiKeyClassCastException key1 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MultiKeyClassCastException();
        MultiKeyClassCastException key2 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MultiKeyClassCastException();
        MultiKeyClassCastException[] keys = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MultiKey&amp;lt;&amp;gt;(key1, key2).getKeys();
    }
}

&lt;span class=&quot;code-comment&quot;&gt;// running gives (same error &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; in module):
&lt;/span&gt;
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.ClassCastException: class [Ljava.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;; cannot be &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; to class [LMultiKeyClassCastException; ([Ljava.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;; is in module java.base of loader &lt;span class=&quot;code-quote&quot;&gt;&apos;bootstrap&apos;&lt;/span&gt;; [LMultiKeyClassCastException; is in unnamed module of loader &lt;span class=&quot;code-quote&quot;&gt;&apos;app&apos;&lt;/span&gt;)
	at MultiKeyClassCastException.main(MultiKeyClassCastException.java:8)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;AFAIK, the only way to fix this (with source compatibility), is to only have a varargs constructors. but I think this breaks binary compatibility though and cannot be used with the existing constructors.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    @SafeVarargs
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; MultiKey(K... keys) {
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.keys = keys;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Workaround is to use array constructor with correct typed array or &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[] keys = multiKey.getKeys();&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; explicitly.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13284335">COLLECTIONS-747</key>
            <summary>MultiKey.getKeys class cast exception</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggregory">Gary D. Gregory</assignee>
                                    <reporter username="wlaan">Walter Laan</reporter>
                        <labels>
                    </labels>
                <created>Mon, 10 Feb 2020 14:49:10 +0000</created>
                <updated>Mon, 17 Feb 2020 09:00:55 +0000</updated>
                            <resolved>Sun, 16 Feb 2020 21:28:04 +0000</resolved>
                                    <version>4.4</version>
                                    <fixVersion>4.5.0-M1</fixVersion>
                                    <component>KeyValue</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17034192" author="guoping" created="Tue, 11 Feb 2020 07:29:21 +0000"  >&lt;p&gt;Can you using it follow the JAVADoc ?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://commons.apache.org/proper/commons-collections/apidocs/org/apache/commons/collections4/keyvalue/MultiKey.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://commons.apache.org/proper/commons-collections/apidocs/org/apache/commons/collections4/keyvalue/MultiKey.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;K[] getKeys()K[] getKeys()Gets a clone of the array of keys.&lt;/p&gt;</comment>
                            <comment id="17034241" author="wlaan" created="Tue, 11 Feb 2020 08:34:38 +0000"  >&lt;p&gt;No, you will need the actual array Class to make a copy. See java.util.ArrayList#toArray() which return Object[] and toArray(T[]) which creates a copy. Or you could use the class from a key value, but that won&apos;t work if all of them are null, which is not forbidden as far as I checked.&lt;/p&gt;

&lt;p&gt;For example, if want to keep the minimum of two keys, you have to do:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    @SafeVarargs
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; MultiKey(K key1, K key2, K... keys) {
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; length = keys.length + 2;
        @SuppressWarnings(&lt;span class=&quot;code-quote&quot;&gt;&quot;unchecked&quot;&lt;/span&gt;) &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; is correct because K[].getClass() is passed
&lt;/span&gt;        K[] tmpKeys = (K[]) Arrays.copyOf(keys, keys.length + 2, keys.getClass());
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = length - 1; i &amp;gt; 1; i--) {
            tmpKeys[i] = tmpKeys[i - 2];
        }
        tmpKeys[0] = key1;
        tmpKeys[1] = key2;

        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.keys = tmpKeys;
    }

&lt;span class=&quot;code-comment&quot;&gt;// which then allows &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; keys, though need to specify type instead of just diamond (&amp;lt;&amp;gt;)
&lt;/span&gt;
MultiKeyClassCastException[] keys = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MultiKey&amp;lt;&amp;gt;(key1, key2).getKeys();
MultiKeyClassCastException[] keys2 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MultiKey&amp;lt;&amp;gt;(key1, key2, key3).getKeys();
MultiKeyClassCastException[] keys3 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MultiKey&amp;lt;MultiKeyClassCastException&amp;gt;(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;).getKeys();
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;https://stackoverflow.com/questions/529085/how-to-create-a-generic-array-in-java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://stackoverflow.com/questions/529085/how-to-create-a-generic-array-in-java&lt;/a&gt;&lt;br/&gt;
 &lt;a href=&quot;https://softwareengineering.stackexchange.com/a/331109&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://softwareengineering.stackexchange.com/a/331109&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17037977" author="garydgregory" created="Sun, 16 Feb 2020 21:28:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wlaan&quot; class=&quot;user-hover&quot; rel=&quot;wlaan&quot;&gt;wlaan&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Please checkout git master and check that the fix works for you,&lt;/p&gt;

&lt;p&gt;Thank you!&lt;/p&gt;</comment>
                            <comment id="17038168" author="wlaan" created="Mon, 17 Feb 2020 09:00:55 +0000"  >&lt;p&gt;Thanks, works for me.&lt;/p&gt;

&lt;p&gt;The only issue is the all-null case, which maybe could have a warning in the javadoc of getKeys:&lt;br/&gt;
@throws ClassCastException if all keys are &lt;/p&gt;
{@code null}
&lt;p&gt;, and an &lt;/p&gt;
{@link Object}
&lt;p&gt; array was constructed.&lt;br/&gt;
MultiKeyMap does not use the method, so should be fine.&lt;/p&gt;

&lt;p&gt;Nitpicks:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// can add @SafeVarargs here
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &amp;lt;T&amp;gt; &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;? &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; T&amp;gt; getComponentType(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; T... values) {


assertNotNull(keys);
&lt;span class=&quot;code-comment&quot;&gt;// bit more comprehensive test would be
&lt;/span&gt;assertEquals(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MultiKeyTest[] { key1, key2 }, keys);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 38 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0bbwg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>