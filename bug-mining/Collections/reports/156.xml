<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sun Nov 09 05:54:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COLLECTIONS-599] HashEntry array object naming data initialized with double the size during deserialization</title>
                <link>https://issues.apache.org/jira/browse/COLLECTIONS-599</link>
                <project id="12310465" key="COLLECTIONS">Commons Collections</project>
                    <description>&lt;p&gt;Common collections 3.1 and 3.2 are used at many places and frameworks including struts2. &lt;br/&gt;
Supose a LinkedMap object it is created and have size greater than zero is serialized. While deserializing this object , array of HashEntry naming data delacred in AbstractHashedMap always initialises with a new capacity of double its double of the serialized object. &lt;/p&gt;

&lt;p&gt;Please see the below API declared in AbstractHashedMap class :&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void checkCapacity()
  {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.size &amp;gt;= &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.threshold)
    {
      &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; newCapacity = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.data.length * 2;
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (newCapacity &amp;lt;= 1073741824) {
        ensureCapacity(newCapacity);
      }
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13025071">COLLECTIONS-599</key>
            <summary>HashEntry array object naming data initialized with double the size during deserialization</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="tejast5">Tejas Patel</reporter>
                        <labels>
                    </labels>
                <created>Fri, 2 Dec 2016 11:58:48 +0000</created>
                <updated>Fri, 5 Jul 2019 15:47:14 +0000</updated>
                            <resolved>Fri, 5 Jul 2019 15:47:14 +0000</resolved>
                                    <version>3.1</version>
                                    <fixVersion>4.1</fixVersion>
                                    <component>Collection</component>
                    <component>Map</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15714952" author="tejast5" created="Fri, 2 Dec 2016 12:05:02 +0000"  >&lt;p&gt;Possible fix would be calculating threshold before putting the data in doReadObject API. &lt;br/&gt;
Calculating threshold would not initialize the array by double.&lt;br/&gt;
Please find the code below : &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void doReadObject(ObjectInputStream in)
    &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException, ClassNotFoundException
  {
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.loadFactor = in.readFloat();
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; capacity = in.readInt();
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; size = in.readInt();
    init();
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.data = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashEntry[capacity];
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.threshold = calculateThreshold(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.data.length, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.loadFactor);
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; size; i++)
    {
      &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; key = in.readObject();
      &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; value = in.readObject();
      put(key, value);
    }
    
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Why these is critical because this version of jar are been used by struts 2 . &lt;br/&gt;
I saw these been changed in version 4.1 , but if you classes in 4.1 are declared in different package.&lt;br/&gt;
We should have provide fix for these version as we cant change jars which is internally using these stuff. &lt;/p&gt;
</comment>
                            <comment id="16239959" author="mingleizhang" created="Mon, 6 Nov 2017 06:16:19 +0000"  >&lt;p&gt;Does anyone give me a permission that can contribute code to apache/commons ? Thank you very much! Minglei.&lt;/p&gt;</comment>
                            <comment id="16240470" author="garydgregory" created="Mon, 6 Nov 2017 15:55:26 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mingleizhang&quot; class=&quot;user-hover&quot; rel=&quot;mingleizhang&quot;&gt;mingleizhang&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Please feel free to provide a pull request on GitHub with a unit test.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/commons-collections&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-collections&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Are you expecting that such a change would be in the 3.x AND 4.x (master) branches?&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="16241304" author="mingleizhang" created="Tue, 7 Nov 2017 01:30:23 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt; I would think this change should be in 3.X, then 4.X master branches can rebase code from 3.X. As I found its affects versions is 3.1.&lt;/p&gt;</comment>
                            <comment id="16241347" author="mingleizhang" created="Tue, 7 Nov 2017 02:09:36 +0000"  >&lt;p&gt;I suspect that whether this issue belongs to a bug, instead, I think it should be a performance issue.&lt;/p&gt;</comment>
                            <comment id="16241348" author="mingleizhang" created="Tue, 7 Nov 2017 02:09:43 +0000"  >&lt;p&gt;I suspect that whether this issue belongs to a bug, instead, I think it should be a performance issue.&lt;/p&gt;</comment>
                            <comment id="16348998" author="saleem-akbar" created="Thu, 1 Feb 2018 17:50:36 +0000"  >&lt;p&gt;I also came across this problem (in my scenario I ended up with an out-of-memory error using non-sticky session replication) and also figured out the same solution, which was to to calculate the threshold before populating the data.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Anyway, I&apos;ve submitted the following PR&apos;s for 3.2.x (we&apos;re currently using 3.2.2) and master.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/commons-collections/pull/34&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-collections/pull/34&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/commons-collections/pull/35&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-collections/pull/35&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;If approved, could we please have an official 3.2.x release (at this point 3.2.3) asap?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Cheers&lt;/p&gt;

&lt;p&gt;Saleem&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16349105" author="garydgregory" created="Thu, 1 Feb 2018 18:51:00 +0000"  >&lt;p&gt;The fix has been committed to git master. I re-wrote the unit test method to use Java 7 idioms.&lt;/p&gt;</comment>
                            <comment id="16350096" author="saleem-akbar" created="Fri, 2 Feb 2018 10:10:00 +0000"  >&lt;p&gt;Thanks &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 41 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i372nr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>