<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sun Nov 09 05:55:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[COLLECTIONS-855] Update the EnhancedDoubleHasher to correct the cube component of the hash</title>
                <link>https://issues.apache.org/jira/browse/COLLECTIONS-855</link>
                <project id="12310465" key="COLLECTIONS">Commons Collections</project>
                    <description>&lt;p&gt;The EnhancedDoubleHasher currently computes the hash with the cube component lagging by 1:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;hash[i] = ( h1(x) - i*h2(x) - ((i-1)^3 - (i-1))/6 ) wrapped in [0, bits)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Correct this to the intended:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;hash[i] = ( h1(x) - i*h2(x) - (i*i*i - i)/6 ) wrapped in [0, bits)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This is a simple change in the current controlling loop from:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; k; i++) { &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;to:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 1; i &amp;lt;= k; i++) { &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Issue notified by Juan Manuel Gimeno Illa on the Commons dev mailing list (see &lt;a href=&quot;https://lists.apache.org/thread/wjmwxzozrtf41ko9r0g7pzrrg11o923o&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lists.apache.org/thread/wjmwxzozrtf41ko9r0g7pzrrg11o923o&lt;/a&gt;).&lt;br/&gt;
Pull request: &lt;a href=&quot;https://github.com/apache/commons-collections/pull/501&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-collections/pull/501&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13579736">COLLECTIONS-855</key>
            <summary>Update the EnhancedDoubleHasher to correct the cube component of the hash</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="3" iconUrl="https://issues.apache.org/jira/images/icons/statuses/inprogress.png" description="This issue is being actively worked on at the moment by the assignee.">In Progress</status>
                    <statusCategory id="4" key="indeterminate" colorName="yellow"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="claude">Claude Warren</assignee>
                                    <reporter username="aherbert">Alex Herbert</reporter>
                        <labels>
                    </labels>
                <created>Sat, 18 May 2024 07:49:10 +0000</created>
                <updated>Wed, 12 Jun 2024 17:17:37 +0000</updated>
                                            <version>4.5.0-M1</version>
                                                    <component>Bloomfilter</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17850337" author="claudenw" created="Wed, 29 May 2024 11:58:39 +0000"  >&lt;p&gt;This is a breaking API change and should be fixed before 4.5.0-M2 or release.&lt;/p&gt;

&lt;p&gt;The effect is that the values generated from the 4.5.0-M1 EnhancedDoubleHasher will not be the same as values generated after this fix.&lt;/p&gt;</comment>
                            <comment id="17850338" author="garydgregory" created="Wed, 29 May 2024 12:02:27 +0000"  >&lt;p&gt;PRs welcome &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I&apos;d like to go for an M2 release next, which I can cut anytime.&#160;&lt;/p&gt;</comment>
                            <comment id="17850343" author="claudenw" created="Wed, 29 May 2024 12:15:00 +0000"  >&lt;p&gt;With c/c Eu next week i am a bit slammed but I wanted to make sure this was&lt;br/&gt;
on the radar before we cut the next candidate.&lt;/p&gt;

&lt;p&gt;If it is not resolved by the end of next week i will take a look at it&lt;/p&gt;

&lt;p&gt;Claude&lt;/p&gt;

</comment>
                            <comment id="17850349" author="alexherbert" created="Wed, 29 May 2024 12:34:47 +0000"  >&lt;p&gt;It is not a breaking API change. It is a functional change. This may break code that relies on the output sequence. But this should be treated as a black box. Users should not be relying on the output, just like they should not rely on the hash code of an object being a specific value.&lt;/p&gt;

&lt;p&gt;I already made the change locally. It only breaks the EnhancedDoubleHasher tests due to their hard coded expected sequence.&lt;/p&gt;

&lt;p&gt;IIUC there are two ways to do it. The change with the extra test outside the loop will probably not have coverage:&lt;/p&gt;

&lt;p&gt;Change the loop to:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
                    &lt;span class=&quot;code-comment&quot;&gt;// Old:
&lt;/span&gt;                    &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; k; i++) {
&lt;/span&gt;                    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 1; i &amp;lt;= k; i++) {
                        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!consumer.test(index)) {
                            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
                        }
                        &lt;span class=&quot;code-comment&quot;&gt;// Update index and handle wrapping
&lt;/span&gt;                        index -= inc;
                        index = index &amp;lt; 0 ? index + bits : index;

                        &lt;span class=&quot;code-comment&quot;&gt;// Incorporate the counter into the increment to create a
&lt;/span&gt;                        &lt;span class=&quot;code-comment&quot;&gt;// tetrahedral number additional term, and handle wrapping.
&lt;/span&gt;                        inc -= i;
                        inc = inc &amp;lt; 0 ? inc + bits : inc;
                    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Change the loop to only compute an update if it is to be consumed:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!consumer.test(index)) {
                        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
                    }
                    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 1; i &amp;lt; k; i++) {
                        &lt;span class=&quot;code-comment&quot;&gt;// Update index and handle wrapping
&lt;/span&gt;                        index -= inc;
                        index = index &amp;lt; 0 ? index + bits : index;

                        &lt;span class=&quot;code-comment&quot;&gt;// Incorporate the counter into the increment to create a
&lt;/span&gt;                        &lt;span class=&quot;code-comment&quot;&gt;// tetrahedral number additional term, and handle wrapping.
&lt;/span&gt;                        inc -= i;
                        inc = inc &amp;lt; 0 ? inc + bits : inc;

                        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!consumer.test(index)) {
                            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
                        }
                    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17850427" author="claudenw" created="Wed, 29 May 2024 16:41:00 +0000"  >&lt;p&gt;Users are expected to rely on the output.  They are expected to use it to&lt;br/&gt;
calculate hashes for the filters.  So any stored filters will not match if&lt;br/&gt;
there is a change.  If this code had been released this change would be&lt;br/&gt;
like the breaking change in the murmur3 hash in commons codec awhile back.&lt;/p&gt;



</comment>
                            <comment id="17850490" author="garydgregory" created="Wed, 29 May 2024 20:12:01 +0000"  >&lt;p&gt;There is no compatibility to worry about:&lt;/p&gt;

&lt;p&gt;The code was part of the first milestone release, we can change it.&lt;/p&gt;

&lt;p&gt;We are not even talking about a binary or source compatibility issue.&lt;/p&gt;

&lt;p&gt;IMO, we should do what is best for the long term.&lt;/p&gt;</comment>
                            <comment id="17850493" author="claudenw" created="Wed, 29 May 2024 20:22:00 +0000"  >&lt;p&gt;I agree.  I was just pointing out that it sorta falls into that space where&lt;br/&gt;
we have to think about if the change would break something in the wild.  Do&lt;br/&gt;
we have a marker for such things?  An annotation of something like that to&lt;br/&gt;
inform other developers going forward?&lt;/p&gt;

&lt;p&gt;On Wed, May 29, 2024 at 10:13&#8239;PM Gary D. Gregory (Jira) &amp;lt;jira@apache.org&amp;gt;&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 23 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1pauo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>