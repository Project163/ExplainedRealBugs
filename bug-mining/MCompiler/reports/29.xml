<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 07:21:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MCOMPILER-170] Regression: Compiler Plugin fails when building with multiple threads (-T...)</title>
                <link>https://issues.apache.org/jira/browse/MCOMPILER-170</link>
                <project id="12317225" key="MCOMPILER">Maven Compiler Plugin (Moved to GitHub Issues)</project>
                    <description>&lt;p&gt;I just tried building my current project which is rather large and has many sub-modules.&lt;/p&gt;

&lt;p&gt;With version 2.3.2 (and below) of the plugin I was able to build the whole project with multiple threads, let&apos;s say:&lt;br/&gt;
&lt;tt&gt;mvn clean compile -T4&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Version 2.4 fails with random errors when using this command line!&lt;br/&gt;
Errors include missing closing brackets, &quot;cannot find symbol&quot; and so on. It&apos;s also not always the same module where the errors occur.&lt;/p&gt;

&lt;p&gt;A single-threaded build with:&lt;br/&gt;
&lt;tt&gt;mvn clean compile&lt;/tt&gt;&lt;br/&gt;
&lt;b&gt;completes just fine&lt;/b&gt;!&lt;/p&gt;

&lt;p&gt;Unfortunately I cannot upload my project for copyright reasons.&lt;/p&gt;

&lt;p&gt;So for me it looks like a &quot;classic&quot; concurrency problem. Maybe side effect of &lt;a href=&quot;https://issues.apache.org/jira/browse/MCOMPILER-166&quot; title=&quot;Use plexus-compiler 1.8.6 for performance improvement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MCOMPILER-166&quot;&gt;&lt;del&gt;MCOMPILER-166&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</description>
                <environment>Windows 7 x64, JDK 1.6.0_31, Maven 3.0.4</environment>
        <key id="12800449">MCOMPILER-170</key>
            <summary>Regression: Compiler Plugin fails when building with multiple threads (-T...)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="olamy">Olivier Lamy</assignee>
                                    <reporter username="famod">Falko Modler</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 May 2012 05:53:22 +0000</created>
                <updated>Mon, 16 Jun 2025 11:12:17 +0000</updated>
                            <resolved>Mon, 7 May 2012 04:57:46 +0000</resolved>
                                    <version>2.4</version>
                                    <fixVersion>2.5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14428732" author="olamy" created="Fri, 4 May 2012 12:04:59 +0000"  >&lt;p&gt;The unique compiler instance used is not thread safe (maybe we could ask sun/oracle to fix that &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; )&lt;br/&gt;
forking compiler can be a solution: use mojo configuration or -Dmaven.compiler.fork=true&lt;/p&gt;</comment>
                            <comment id="14428810" author="famod" created="Fri, 4 May 2012 12:23:08 +0000"  >&lt;p&gt;Thanks for the pointer, but I don&apos;t know whether I understood you correctly:&lt;/p&gt;

&lt;p&gt;You mean this is a general problem and it is not specific for the changes that have been made for 2.4?&lt;br/&gt;
But why does everything work as expected in 2.3.2 then?&lt;/p&gt;

&lt;p&gt;There was also no note of switching on the forking when @threadSafe was introduced, see: &lt;a href=&quot;https://issues.apache.org/jira/browse/MCOMPILER-127&quot; title=&quot;Mark compiler plugin as @threadSafe for maven3&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MCOMPILER-127&quot;&gt;&lt;del&gt;MCOMPILER-127&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Btw: Switching on forking does indeed work around this issue but it also slows down the build a bit. And of course it can&apos;t benefit from &lt;a href=&quot;https://issues.apache.org/jira/browse/MCOMPILER-166&quot; title=&quot;Use plexus-compiler 1.8.6 for performance improvement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MCOMPILER-166&quot;&gt;&lt;del&gt;MCOMPILER-166&lt;/del&gt;&lt;/a&gt; either (which was the main reason for me to try 2.4).&lt;/p&gt;</comment>
                            <comment id="14428832" author="olamy" created="Fri, 4 May 2012 14:35:00 +0000"  >&lt;p&gt;The optimization introduces by &lt;a href=&quot;https://issues.apache.org/jira/browse/MCOMPILER-166&quot; title=&quot;Use plexus-compiler 1.8.6 for performance improvement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MCOMPILER-166&quot;&gt;&lt;del&gt;MCOMPILER-166&lt;/del&gt;&lt;/a&gt; means we only use 1 instance of Javac class instead of rebuild it for all compilation.&lt;br/&gt;
This Javac instance is not thread safe (euh we cannot fix that &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ).&lt;br/&gt;
So sure the compiler plugin is not threadSafe if you don&apos;t fork compiler.&lt;/p&gt;</comment>
                            <comment id="14428846" author="famod" created="Fri, 4 May 2012 16:56:24 +0000"  >&lt;p&gt;Ok, so in my opinion that means:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;the plugin is &lt;b&gt;not threadsafe by default&lt;/b&gt; anymore which means 2.4 breaks backward compatibility to some extend&lt;/li&gt;
	&lt;li&gt;the documentation should clearly point out that fork needs to be turned on (default is off/false) when using the parallel build feature&lt;br/&gt;
  see also: &lt;a href=&quot;http://maven.apache.org/plugins/maven-compiler-plugin/compile-mojo.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://maven.apache.org/plugins/maven-compiler-plugin/compile-mojo.html&lt;/a&gt; -&amp;gt; &quot;The goal is thread-safe and supports parallel builds.&quot;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/MCOMPILER-166&quot; title=&quot;Use plexus-compiler 1.8.6 for performance improvement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MCOMPILER-166&quot;&gt;&lt;del&gt;MCOMPILER-166&lt;/del&gt;&lt;/a&gt; brings a &lt;b&gt;performance gain for single threaded builds only&lt;/b&gt; but results in a &lt;b&gt;performance hit for parallel builds&lt;/b&gt; because the forking causes more overhead&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Seriously, medium to large scale projects &lt;b&gt;will&lt;/b&gt; have many sub-modules (at least that&apos;s what I have seen in many projects where I work) so it is more than probable that the parallel build feature will be used. In my current project we save a lot of valuable time by using this feature.&lt;br/&gt;
With that in mind, it is rather disappointing that version 2.4. of the plugin will actually slow down parallel builds.&lt;/p&gt;

&lt;p&gt;Please reconsider the changes made by &lt;a href=&quot;https://issues.apache.org/jira/browse/MCOMPILER-166&quot; title=&quot;Use plexus-compiler 1.8.6 for performance improvement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MCOMPILER-166&quot;&gt;&lt;del&gt;MCOMPILER-166&lt;/del&gt;&lt;/a&gt;!&lt;br/&gt;
You could at least introduce a switch to enable/disable the caching introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/MCOMPILER-166&quot; title=&quot;Use plexus-compiler 1.8.6 for performance improvement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MCOMPILER-166&quot;&gt;&lt;del&gt;MCOMPILER-166&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
Personally, I think this caching should be off by default to ensure backward compatibility for parallel builds.&lt;/p&gt;

&lt;p&gt;Edit:&lt;br/&gt;
Just realized that above-mentioned flag would have to be passed to that &quot;external&quot; plexus component which means this will be harder achieve.&lt;br/&gt;
But still - as outlined above - the current situation is really not satisfactory.&lt;/p&gt;</comment>
                            <comment id="14428785" author="olamy" created="Sat, 5 May 2012 14:33:44 +0000"  >&lt;p&gt;I&apos;d like to introduce something like (pseudo code):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Enum CompilerStrategy {
  &lt;span class=&quot;code-comment&quot;&gt;/** &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; option same today but adding a log warning in console &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the current build use -T option */&lt;/span&gt;
  ReuseSame();
  &lt;span class=&quot;code-comment&quot;&gt;/** create a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; compiler &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; each use */&lt;/span&gt;
  AlwaysNew();
  &lt;span class=&quot;code-comment&quot;&gt;/** a kind of pool to reuse created compiler */&lt;/span&gt;
  ReuseCreated()
   
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14428870" author="olamy" created="Sat, 5 May 2012 17:15:51 +0000"  >&lt;p&gt;You can try with compiler plugin 2.5-SNAPSHOT.&lt;br/&gt;
The field to configure is compilerReuseStrategy. Possible values are: reuseCreated, reuseSame or alwaysNew&lt;br/&gt;
Default value is reuseSame.&lt;br/&gt;
reuseCreated strategy will try to reuse previously created Javacc classes.&lt;/p&gt;</comment>
                            <comment id="14428884" author="famod" created="Sun, 6 May 2012 17:41:47 +0000"  >&lt;p&gt;Thanks for the quick response/implementation!&lt;/p&gt;

&lt;p&gt;I carried out some tests with 2.5-SNAPSHOT and 2.3.2. Project contains ~160 modules and ~3600 java files. Built with &lt;tt&gt;mvn clean install&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Format: &lt;tt&gt;&amp;lt;total build time&amp;gt;, &amp;lt;compiler-plugin&apos;s proportion of the execution time of all plugins in percent&amp;gt; (&amp;lt;as before but in minutes&amp;gt;)&lt;/tt&gt;&lt;br/&gt;
The last two figures have been recorded by a special maven build extension I wrote some time ago.&lt;/p&gt;

&lt;p&gt;The results:&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Single-threaded build&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;reuseSame&lt;br/&gt;
02:53, 75,4% (2:00)&lt;/p&gt;

&lt;p&gt;reuseCreated&lt;br/&gt;
02:53, 75,5% (2:00)&lt;/p&gt;

&lt;p&gt;alwaysNew&lt;br/&gt;
03:49, 81,7% (2:56)&lt;/p&gt;

&lt;p&gt;2.3.2&lt;br/&gt;
03:45, 81,3% (2:52)&lt;/p&gt;


&lt;p&gt;&lt;b&gt;Multi-threaded build (-T4)&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;reuseSame&lt;br/&gt;
Errors as expected&lt;/p&gt;

&lt;p&gt;reuseCreated&lt;br/&gt;
01:30, 74,1% (2:52)&lt;/p&gt;

&lt;p&gt;alwaysNew&lt;br/&gt;
02:00, 82,3% (4:35)&lt;/p&gt;

&lt;p&gt;2.3.2&lt;br/&gt;
01:57, 81,7% (4:27)&lt;/p&gt;


&lt;p&gt;Just for the records: &lt;b&gt;-Dmaven.compiler.fork=true&lt;/b&gt; with 2.5-SNAPSHOT&lt;/p&gt;

&lt;p&gt;Single-threaded&lt;br/&gt;
04:20, 84,1% (3:26)&lt;/p&gt;

&lt;p&gt;-T4&lt;br/&gt;
02:12, 84,0% (5:12)&lt;/p&gt;


&lt;p&gt;As you can see, reuseCreated yields the same results for single-threaded builds as reuseSame while still maintaining backwards-compatibility for parallel builds.&lt;br/&gt;
So the question is: Do we really need reuseSame? If yes: Why? And in case reuseSame needs to stay, I&apos;m very much in favor of having reuseCreated as the default.&lt;/p&gt;</comment>
                            <comment id="14428858" author="olamy" created="Sun, 6 May 2012 17:49:23 +0000"  >&lt;p&gt;Thanks for the figures.&lt;br/&gt;
I agree reuseCreated and reuseSame are same for single thread build.&lt;br/&gt;
But reuseSame works for me on multi thread build with jdk 1.7 on linux or osx (sorry I don&apos;t have windauze to test).&lt;/p&gt;</comment>
                            <comment id="14428678" author="olamy" created="Sun, 6 May 2012 17:57:01 +0000"  >&lt;p&gt;oops my bad I agree reuseCreated must be default. I just made a typo in code &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14428734" author="olamy" created="Sun, 6 May 2012 18:00:52 +0000"  >&lt;p&gt;fixed&lt;/p&gt;</comment>
                            <comment id="14428762" author="famod" created="Sun, 6 May 2012 18:16:56 +0000"  >&lt;p&gt;Forgot to add that I did not see the warning message mentioned in the description of the ReuseSame enum instance. What is the wording I should look for?&lt;/p&gt;

&lt;p&gt;And that reuseSame is working for you on a multi-threaded build might be related to the very &quot;volatile&quot; nature of concurrency problems. Seems like your setup/test just doesn&apos;t &quot;provoke&quot; that situation. I don&apos;t think it is related to JDK 1.7 but I might be wrong.&lt;/p&gt;</comment>
                            <comment id="14428811" author="olamy" created="Sun, 6 May 2012 18:19:46 +0000"  >&lt;p&gt;reopen as wording not implemented.&lt;/p&gt;</comment>
                            <comment id="14428763" author="olamy" created="Sun, 6 May 2012 18:20:46 +0000"  >&lt;p&gt;my test is same build: fail with 1.6 but works with 1.7.&lt;br/&gt;
Previously I was using fork compiler.&lt;/p&gt;</comment>
                            <comment id="14428812" author="olamy" created="Mon, 7 May 2012 04:57:47 +0000"  >&lt;p&gt;implemented.&lt;br/&gt;
Warning will be&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[WARNING] You are in a multi thread build and use reuseSame strategy &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; can issues on some os/jdk, consider using reuseCreated strategy
If you env is fine with that, you can skip &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; warning with the configuration field skipMultiThreadWarning or -Dmaven.compiler.skipMultiThreadWarning=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14428733" author="famod" created="Mon, 7 May 2012 08:11:40 +0000"  >&lt;p&gt;Ok, warning message now appears.&lt;/p&gt;

&lt;p&gt;May I suggest some typo corrections and wording adjustments?&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[WARNING] You are in a multi-thread build and compilerReuseStrategy is set to reuseSame. This can cause issues in some environments (os/jdk)! Consider using reuseCreated strategy.
If your env is fine with reuseSame, you can skip this warning with the configuration field skipMultiThreadWarning or -Dmaven.compiler.skipMultiThreadWarning=true
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="14428679" author="olamy" created="Mon, 7 May 2012 08:19:33 +0000"  >&lt;p&gt;great thanks.&lt;/p&gt;</comment>
                            <comment id="17978834" author="olamy" created="Mon, 16 Jun 2025 11:12:17 +0000"  >&lt;p&gt;This project has moved from Jira to GitHub Issues. This issue was migrated to &lt;a href=&quot;https://github.com/apache/maven-compiler-plugin/issues/829&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;apache/maven-compiler-plugin#829&lt;/a&gt;. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            21 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i29t3b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>