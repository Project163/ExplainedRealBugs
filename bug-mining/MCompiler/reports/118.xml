<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 07:22:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MCOMPILER-485] Incorrect internal string format in generated package-info.class files on Windows</title>
                <link>https://issues.apache.org/jira/browse/MCOMPILER-485</link>
                <project id="12317225" key="MCOMPILER">Maven Compiler Plugin (Moved to GitHub Issues)</project>
                    <description>&lt;p&gt;In 3.10.0, a new feature to generate package-info classes was added in&#160;&lt;a href=&quot;https://github.com/apache/maven-compiler-plugin/pull/88&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;[MCOMPILER-205] &lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Unfortunately, the binary class file is incorrectly generated using Java&apos;s file toString() which uses a platform dependent file separator character: on Windows, these Strings contain a backslash.&#160; See &lt;a href=&quot;https://github.com/gnodet/maven-compiler-plugin/blob/8521ef8fdd12cc0b85c1ace17114ed3d3ffd0b0c/src/main/java/org/apache/maven/plugin/compiler/AbstractCompilerMojo.java#L1356&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this line&lt;/a&gt; which passes the platform-dependent file name (minus the root path and .java extension) to the ClassWriter.&lt;/p&gt;

&lt;p&gt;The Java class file specification (4.2.1) specifies the internal format: &quot;In this internal form, the ASCII periods (.) that normally separate the identifiers which make up the binary name are replaced by ASCII forward slashes &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/check.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&quot;&lt;/p&gt;

&lt;p&gt;This invalid class file format causes problems in downstream plugins, e.g.,&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The bnd-maven-plugin fails with an error: Classes found in the wrong directory: {oshi/jna/platform/unix/package-info.class=oshi\jna\platform\unix\package-info ... (and hundreds more) ... }&lt;/li&gt;
	&lt;li&gt;The JDK&apos;s &lt;a href=&quot;https://github.com/openjdk/jdk17/blob/74007890bb9a3fa3a65683a3f480e399f2b1a0b6/src/hotspot/share/classfile/classFileParser.cpp#L5797&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;classFileParser&lt;/a&gt; will throw java.lang.NoClassDefFoundError: com\puppycrawl\tools\checkstyle\ant\package-info (wrong name: com/puppycrawl/tools/checkstyle/ant/package-info&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Steps to reproduce:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Perform a build on any Windows machine using maven-compiler-plugin 3.10.0&lt;/li&gt;
	&lt;li&gt;Inspect any of the generated package-info.class files in target/classes using a text editor&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Expected behavior:&lt;/p&gt;

&lt;p&gt;Internal strings representing package names use forward slashes&lt;/p&gt;

&lt;p&gt;Observed behavior:&lt;/p&gt;

&lt;p&gt;Internal strings representing package names use backward slashes&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>Windows, or any operating system with a file separator character other than a forward slash</environment>
        <key id="13428448">MCOMPILER-485</key>
            <summary>Incorrect internal string format in generated package-info.class files on Windows</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="olamy">Olivier Lamy</assignee>
                                    <reporter username="dbwiddis">Daniel Widdis</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Feb 2022 00:28:12 +0000</created>
                <updated>Mon, 16 Jun 2025 11:23:30 +0000</updated>
                            <resolved>Tue, 22 Feb 2022 06:48:43 +0000</resolved>
                                    <version>3.10.0</version>
                                    <fixVersion>3.10.1</fixVersion>
                                        <due></due>
                            <votes>3</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="17492289" author="olamy" created="Tue, 15 Feb 2022 00:34:21 +0000"  >&lt;p&gt;good catch. by chance can you provide a simple project to reproduce it? so we can easily integrate this as an IT test and work faster on this issue. thanks&lt;/p&gt;</comment>
                            <comment id="17492303" author="dbwiddis" created="Tue, 15 Feb 2022 01:06:54 +0000"  >&lt;p&gt;I&apos;ll give it a shot on a day that&apos;s not Valentine&apos;s day.&#160;&#160;&lt;/p&gt;

&lt;p&gt;Also for anyone stumbling on this, a workaround is to disable the on-by-default behavior, e.g.,&lt;/p&gt;

&lt;p&gt;mvn clean test &quot;-Dmaven.compiler.createMissingPackageInfoClass=false&quot;&lt;/p&gt;</comment>
                            <comment id="17492304" author="olamy" created="Tue, 15 Feb 2022 01:10:49 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;ll give it a shot on a day that&apos;s not Valentine&apos;s day.&#160;&#160;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;oh yes definitely not the good day, we definitely don&apos;t want to cause such huge trouble!!&lt;/p&gt;</comment>
                            <comment id="17492318" author="dbwiddis" created="Tue, 15 Feb 2022 01:54:56 +0000"  >&lt;p&gt;Here&apos;s a quick reproducer project: &#160;&lt;a href=&quot;https://github.com/dbwiddis/foo&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;dbwiddis/foo: Minimal repository for reproducing bugs (github.com)&lt;/a&gt;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Clone the project&lt;/li&gt;
	&lt;li&gt;On windows, run ./mvnw.cmd clean verify&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Result:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; maven-compiler-plugin:3.10.0:compile (default-compile) @ foo &amp;#8212;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Changes detected - recompiling the module!&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Compiling 2 source files to C:\Users\dawiddis.REDMOND\git\foo\target\classes&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &amp;#8212; bnd-maven-plugin:6.1.0:bnd-process (default) @ foo &amp;#8212;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; C:\Users\dawiddis.REDMOND\git\foo\pom.xml &lt;span class=&quot;error&quot;&gt;&amp;#91;0:0&amp;#93;&lt;/span&gt;: Classes found in the wrong directory: {foo/bar/package-info.class=foo\bar\package-info}&lt;br/&gt;
[&lt;/p&gt;</comment>
                            <comment id="17492339" author="dbwiddis" created="Tue, 15 Feb 2022 03:49:20 +0000"  >&lt;p&gt;Added a class reading the bytes from the object file:&lt;br/&gt;
&lt;tt&gt;Path packageInfo = Paths.get(&quot;target/classes/foo/bar/package-info.class&quot;);&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;byte[] binaryObject = Files.readAllBytes(packageInfo);&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;String s = new String(binaryObject, StandardCharsets.US_ASCII);&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;System.out.println(&quot;Bad class format:&quot; + s.contains(&quot;foo\\bar&lt;br class=&quot;atl-forced-newline&quot; /&gt;package-info&quot;));&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;System.out.println(&quot;Look at the evil backslashes: &quot; + s);&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Output:&lt;br/&gt;
Bad class format: true&lt;br/&gt;
Look at the evil backslashes: ???? 4 ?? ?package-info.java? ?foo\bar\package-info? ?? ?java/lang/Object? ??SourceFile? ? ?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17492349" author="dbwiddis" created="Tue, 15 Feb 2022 04:05:18 +0000"  >&lt;p&gt;Suggested fix (possibly wrapped in a conditional):&#160;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;javaFile.replaceAll(File.separator, &quot;/&quot;);&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17492358" author="olamy" created="Tue, 15 Feb 2022 04:26:19 +0000"  >&lt;p&gt;OMG it looks you&apos;ve trashed a Valentine&apos;s day &#129315;&lt;/p&gt;</comment>
                            <comment id="17492359" author="dbwiddis" created="Tue, 15 Feb 2022 04:28:15 +0000"  >&lt;p&gt;I had a few hours&apos; break for a romantic dinner. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17492368" author="dbwiddis" created="Tue, 15 Feb 2022 05:35:10 +0000"  >&lt;p&gt;A few other comments and then I think I&apos;ll leave it to the experts:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Existing IT just has &quot;assert packageInfoClassFile.exists()&quot;.&#160; Could probably be modified to check the contents of the file for the expected dummy/package-info and not dummy\package-info.&lt;/li&gt;
	&lt;li&gt;Docs for &lt;a href=&quot;https://asm.ow2.io/javadoc/org/objectweb/asm/ClassVisitor.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://asm.ow2.io/javadoc/org/objectweb/asm/ClassVisitor.html&lt;/a&gt; indicate the the visit() call should be before visitSource(). I have no idea if this has any impact on this issue, but was one thing I noted in my debugging tour.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="17492371" author="olamy" created="Tue, 15 Feb 2022 05:43:43 +0000"  >&lt;p&gt;thanks for your help, comments and provided test&lt;/p&gt;

&lt;p&gt;And enjoy your romantic dinner &#128540;&lt;/p&gt;</comment>
                            <comment id="17492743" author="dbwiddis" created="Tue, 15 Feb 2022 17:27:19 +0000"  >&lt;p&gt;Submitted a PR with proposed fix: &#160;&lt;a href=&quot;https://github.com/apache/maven-compiler-plugin/pull/95&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;[MCOMPILER-485] Fixes internal string format in generated package-info.class by dbwiddis &#183; Pull Request #95 &#183; apache/maven-compiler-plugin (github.com)&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17495887" author="olamy" created="Tue, 22 Feb 2022 06:48:43 +0000"  >&lt;p&gt;PR merged.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="17495896" author="hudson" created="Tue, 22 Feb 2022 07:03:56 +0000"  >&lt;p&gt;Build succeeded in Jenkins: Maven &#187; Maven TLP &quot;new&quot; &#187; maven-compiler-plugin &#187; master #31&lt;/p&gt;

&lt;p&gt;See &lt;a href=&quot;https://ci-maven.apache.org/job/Maven/job/maven-box/job/maven-compiler-plugin/job/master/31/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-maven.apache.org/job/Maven/job/maven-box/job/maven-compiler-plugin/job/master/31/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17502454" author="jglick@netbeans.org" created="Mon, 7 Mar 2022 17:28:31 +0000"  >&lt;p&gt;Will there be some notification when the fix is released to Central?&lt;/p&gt;</comment>
                            <comment id="17502657" author="olamy" created="Tue, 8 Mar 2022 00:57:04 +0000"  >&lt;p&gt;Yes I have to plan to do it this week.&lt;/p&gt;

&lt;p&gt;need to release and wait for the required vote period.&lt;/p&gt;

&lt;p&gt;But the hope is to have dependabot triggering thousands of PRs by the end of the week (maybe for the weekend &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;)&lt;/p&gt;</comment>
                            <comment id="17570379" author="hudson" created="Sat, 23 Jul 2022 22:15:37 +0000"  >&lt;p&gt;Build failed in Jenkins: Maven &#187; Maven TLP &#187; maven &#187; maven-3.8.x-resolver-1.8.x #2&lt;/p&gt;

&lt;p&gt;See &lt;a href=&quot;https://ci-maven.apache.org/job/Maven/job/maven-box/job/maven/job/maven-3.8.x-resolver-1.8.x/2/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-maven.apache.org/job/Maven/job/maven-box/job/maven/job/maven-3.8.x-resolver-1.8.x/2/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17574296" author="kriegaex" created="Tue, 2 Aug 2022 15:45:03 +0000"  >&lt;p&gt;Just in case other AspectJ users also get weird errors due to this problem: I never would have expected this to be an MCOMPILER problem, unaware of the fact that the plugin actually creates byte code for package infos using ASM instead of relying on Javac or ECJ functionality. I even implemented a woraround in the AspectJ compiler for this, because I thought that Javac itself creates bogus byte code for this corner case. Only later I noticed that Maven Compiler itself was the culprit. See &lt;a href=&quot;https://github.com/eclipse/org.aspectj/issues/176&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/eclipse/org.aspectj/issues/176&lt;/a&gt;. This was an expensive bug.&lt;/p&gt;

&lt;p&gt;Lesson learned (I hope): I think you should have used Java compiler functionality in order to create those files, namely &lt;tt&gt;-Xpkginfo:always&lt;/tt&gt; on Javac and rely on ECJ to create those class files by default anyway. No own implementation, no own bug.&lt;/p&gt;</comment>
                            <comment id="17574527" author="olamy" created="Wed, 3 Aug 2022 06:32:52 +0000"  >&lt;p&gt;ah yes this option -Xpkginfo:always sounds good to replace all the code with simply adding the arg to compiler call.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gnodet&quot; class=&quot;user-hover&quot; rel=&quot;gnodet&quot;&gt;gnodet&lt;/a&gt; wdyt? we could get rid of some code&lt;/p&gt;</comment>
                            <comment id="17575191" author="kriegaex" created="Thu, 4 Aug 2022 10:11:32 +0000"  >&lt;p&gt;Before messaging here, I did of course notice &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gnodet&quot; class=&quot;user-hover&quot; rel=&quot;gnodet&quot;&gt;gnodet&lt;/a&gt;&apos;s &lt;a href=&quot;https://github.com/apache/maven-compiler-plugin/pull/88#issue-1124280483&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;statement in the PR for MCOMIPLER-205&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;This PR provides an option (turned on by default) to generate class files for missing &lt;tt&gt;package-info&lt;/tt&gt; classes. This happens when the &lt;tt&gt;package-info.java&lt;/tt&gt; source file only contains a javadoc and no annotations on the package.&lt;br/&gt;
This can be turned on some JDK using &lt;tt&gt;-Xpkginfo:always&lt;/tt&gt;, but that may not work on all JDKs.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Therefore, of course I understand the idea to generate the class files manually, but as we have painfully experienced, it is a possible source of errors. Now, it seems to be fixed, but anyway, I believe that each compiler which can be used with Maven Compiler Plugin has one or another way to enforce package info class file creation. Javac has &lt;tt&gt;-Xpkginfo&lt;/tt&gt;, ECJ seems to always create those files anyway (thus probably also ECJ forks like GrEclipse and AspectJ). I do not know which other compiler back-ends MCompiler / Plexus supports, but hopefully one of you committers can say more about that.&lt;/p&gt;</comment>
                            <comment id="17979107" author="olamy" created="Mon, 16 Jun 2025 11:23:30 +0000"  >&lt;p&gt;This project has moved from Jira to GitHub Issues. This issue was migrated to &lt;a href=&quot;https://github.com/apache/maven-compiler-plugin/issues/703&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;apache/maven-compiler-plugin#703&lt;/a&gt;. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="12800565">MCOMPILER-205</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            21 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0zklc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>