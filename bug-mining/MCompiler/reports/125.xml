<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 07:22:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MCOMPILER-503] Unexpected dependency resolution of `annotationProcessorPaths`</title>
                <link>https://issues.apache.org/jira/browse/MCOMPILER-503</link>
                <project id="12317225" key="MCOMPILER">Maven Compiler Plugin (Moved to GitHub Issues)</project>
                    <description>&lt;p&gt;This issue relates to &lt;a href=&quot;https://issues.apache.org/jira/browse/MCOMPILER-272&quot; title=&quot;When annotationProcessorPaths has multiple entries, only the transitive dependencies of the first entry are added&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MCOMPILER-272&quot;&gt;&lt;del&gt;MCOMPILER-272&lt;/del&gt;&lt;/a&gt;. That ticket improved annotation processor classpath construction, but as of version 3.10.1 the constructed classpath is still highly unintuitive.&lt;/p&gt;

&lt;p&gt;In a nutshell, the generated annotation processor classpath does not match Maven&apos;s &quot;general&quot; dependency resolution logic, leading to (at least) the following issues:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The classpath may contain multiple versions of the same dependency.&lt;/li&gt;
	&lt;li&gt;Indirect dependencies may take precedence over explicitly declared&#160;dependencies.&lt;/li&gt;
&lt;/ul&gt;


&lt;h1&gt;&lt;a name=&quot;Reproductioncase&quot;&gt;&lt;/a&gt;Reproduction case&lt;/h1&gt;

&lt;p&gt;Consider a &lt;tt&gt;pom.xml&lt;/tt&gt; with a &lt;tt&gt;maven-compiler-plugin&lt;/tt&gt; configuration as follows:&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;annotationProcessorPaths&amp;gt;&lt;/span&gt;
&#160; &#160; &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;path&amp;gt;&lt;/span&gt;
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;com.google.auto.service&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;auto-service&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;1.0&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
&#160; &#160; &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/path&amp;gt;&lt;/span&gt;
&#160; &#160; &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;path&amp;gt;&lt;/span&gt;
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;com.google.guava&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;guava&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;31.0.1-jre&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
&#160; &#160; &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/path&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/annotationProcessorPaths&amp;gt;&lt;/span&gt; &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Note that &lt;tt&gt;com.google.auto.service:auto-service&lt;/tt&gt; 1.0 depends on Guava 30.1.1-jre, which is a different version of Guava than the one explicitly specified.&#160;&lt;/p&gt;

&lt;p&gt;The generated annotation processor classpath is output when executing &lt;tt&gt;mvn clean install -X&lt;/tt&gt;. We can extract it as follows:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sh&quot;&gt;
mvn clean install -X | grep -oP &lt;span class=&quot;code-quote-red&quot;&gt;&apos;(?&amp;lt;=-processorpath )\S+&apos;&lt;/span&gt; | xargs -d: -l1 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As of version 3.9.0+ this outputs:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sh&quot;&gt;
/home/user/.m2/repository/com/google/auto/service/auto-service/1.0/auto-service-1.0.jar
/home/user/.m2/repository/com/google/auto/service/auto-service-annotations/1.0/auto-service-annotations-1.0.jar
/home/user/.m2/repository/com/google/auto/auto-common/1.0/auto-common-1.0.jar
/home/user/.m2/repository/com/google/guava/guava/30.1.1-jre/guava-30.1.1-jre.jar
/home/user/.m2/repository/com/google/guava/failureaccess/1.0.1/failureaccess-1.0.1.jar
/home/user/.m2/repository/com/google/guava/listenablefuture/9999.0-empty-to-avoid-conflict-with-guava/listenablefuture-9999.0-empty-to-avoid-conflict-with-guava.jar
/home/user/.m2/repository/com/google/code/findbugs/jsr305/3.0.2/jsr305-3.0.2.jar
/home/user/.m2/repository/org/checkerframework/checker-qual/3.8.0/checker-qual-3.8.0.jar
/home/user/.m2/repository/com/google/errorprone/error_prone_annotations/2.5.1/error_prone_annotations-2.5.1.jar
/home/user/.m2/repository/com/google/j2objc/j2objc-annotations/1.3/j2objc-annotations-1.3.jar
/home/user/.m2/repository/com/google/guava/guava/31.0.1-jre/guava-31.0.1-jre.jar
/home/user/.m2/repository/org/checkerframework/checker-qual/3.12.0/checker-qual-3.12.0.jar
/home/user/.m2/repository/com/google/errorprone/error_prone_annotations/2.7.1/error_prone_annotations-2.7.1.jar&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Note the following:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Some dependencies are duplicated, with &lt;em&gt;different versions&lt;/em&gt; listed (&lt;tt&gt;guava&lt;/tt&gt;, &lt;tt&gt;checker-qual&lt;/tt&gt;, and &lt;tt&gt;error_prone_annotations&lt;/tt&gt;).&lt;/li&gt;
	&lt;li&gt;Even though the &lt;tt&gt;pom.xml&lt;/tt&gt; explicitly declares a dependency on Guava 31.0.1-jre, the classpath lists version 30.1.1-jre first, meaning that de&lt;br/&gt;
&#160; facto the latter will be used.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In practice this means that:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;One cannot rely on &quot;common Maven dependency resolution knowledge&quot;.&lt;/li&gt;
	&lt;li&gt;One must be very careful with the order in which dependencies are listed.&lt;/li&gt;
	&lt;li&gt;The need to carefully order the dependencies may mean that a certain configuration cannot be factored out to a Maven profile.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Ideally &lt;tt&gt;annotationProcessorPaths&lt;/tt&gt; follows the same dependency resolution logic as &quot;regular&quot; project dependencies. That is, ideally the classpath would be constructed as follows (this is what &lt;tt&gt;mvn dependency:build-classpath&lt;/tt&gt; would output if the aforementioned artifacts were declared as &quot;regular&quot; build dependencies):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sh&quot;&gt;
/home/user/.m2/repository/com/google/auto/service/auto-service/1.0/auto-service-1.0.jar
/home/user/.m2/repository/com/google/auto/service/auto-service-annotations/1.0/auto-service-annotations-1.0.jar
/home/user/.m2/repository/com/google/auto/auto-common/1.0/auto-common-1.0.jar
/home/user/.m2/repository/com/google/guava/guava/31.0.1-jre/guava-31.0.1-jre.jar
/home/user/.m2/repository/com/google/guava/failureaccess/1.0.1/failureaccess-1.0.1.jar
/home/user/.m2/repository/com/google/guava/listenablefuture/9999.0-empty-to-avoid-conflict-with-guava/listenablefuture-9999.0-empty-to-avoid-conflict-with-guava.jar
/home/user/.m2/repository/com/google/code/findbugs/jsr305/3.0.2/jsr305-3.0.2.jar
/home/user/.m2/repository/org/checkerframework/checker-qual/3.12.0/checker-qual-3.12.0.jar
/home/user/.m2/repository/com/google/errorprone/error_prone_annotations/2.7.1/error_prone_annotations-2.7.1.jar
/home/user/.m2/repository/com/google/j2objc/j2objc-annotations/1.3/j2objc-annotations-1.3.jar&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#8212;&lt;br/&gt;
We would like your input on this issue. &lt;a href=&quot;https://github.com/PicnicSupermarket/maven-compiler-plugin-issue-503&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;This&lt;/a&gt; GitHub project contains a minimal reproduction case. We are open to feedback and willing to propose a PR to resolve this issue.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13474535">MCOMPILER-503</key>
            <summary>Unexpected dependency resolution of `annotationProcessorPaths`</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="olamy">Olivier Lamy</assignee>
                                    <reporter username="476rick">Rick Ossendrijver</reporter>
                        <labels>
                    </labels>
                <created>Mon, 1 Aug 2022 13:15:37 +0000</created>
                <updated>Mon, 16 Jun 2025 11:23:36 +0000</updated>
                            <resolved>Mon, 30 Jan 2023 00:52:28 +0000</resolved>
                                    <version>3.10.1</version>
                                    <fixVersion>3.11.0</fixVersion>
                                        <due></due>
                            <votes>2</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17578650" author="stephan202" created="Thu, 11 Aug 2022 20:22:22 +0000"  >&lt;p&gt;Additionally, contrary to regular dependency resolution, indirect &lt;tt&gt;&amp;lt;optional&amp;gt;true&amp;lt;/optional&amp;gt;&lt;/tt&gt; dependencies seem to be pulled in unconditionally (see &lt;a href=&quot;https://github.com/palantir/gradle-baseline/issues/2362&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;palantir/gradle-baseline#2362&lt;/a&gt; for an example). And since there&apos;s no support for &lt;tt&gt;&amp;lt;exclusions&amp;gt;&lt;/tt&gt; (see &lt;a href=&quot;https://issues.apache.org/jira/browse/MCOMPILER-395&quot; title=&quot;annotationProcessorPaths should accept exclusions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MCOMPILER-395&quot;&gt;&lt;del&gt;MCOMPILER-395&lt;/del&gt;&lt;/a&gt;), there does not appear to be a way to prevent this.&lt;/p&gt;</comment>
                            <comment id="17681819" author="olamy" created="Mon, 30 Jan 2023 00:52:28 +0000"  >&lt;p&gt;PR merged. Thanks!&lt;/p&gt;</comment>
                            <comment id="17979120" author="olamy" created="Mon, 16 Jun 2025 11:23:36 +0000"  >&lt;p&gt;This project has moved from Jira to GitHub Issues. This issue was migrated to &lt;a href=&quot;https://github.com/apache/maven-compiler-plugin/issues/720&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;apache/maven-compiler-plugin#720&lt;/a&gt;. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13250723">MCOMPILER-395</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            21 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z17d9s:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>