diff --git a/src/it/MCOMPILER-203-processorpath/annotation-processor/pom.xml b/src/it/MCOMPILER-203-processorpath/annotation-processor/pom.xml
index 1047e76..9c3e8d0 100644
--- a/src/it/MCOMPILER-203-processorpath/annotation-processor/pom.xml
+++ b/src/it/MCOMPILER-203-processorpath/annotation-processor/pom.xml
@@ -31,4 +31,12 @@ under the License.
   </parent>
 
   <artifactId>annotation-processor</artifactId>
+
+  <dependencies>
+    <dependency>
+      <groupId>org.apache.commons</groupId>
+      <artifactId>commons-lang3</artifactId>
+      <version>3.4</version>
+    </dependency>
+  </dependencies>
 </project>
diff --git a/src/it/MCOMPILER-203-processorpath/annotation-processor/src/main/java/org/issue/SimpleAnnotationProcessor.java b/src/it/MCOMPILER-203-processorpath/annotation-processor/src/main/java/org/issue/SimpleAnnotationProcessor.java
index 002e74a..a3dcbf9 100644
--- a/src/it/MCOMPILER-203-processorpath/annotation-processor/src/main/java/org/issue/SimpleAnnotationProcessor.java
+++ b/src/it/MCOMPILER-203-processorpath/annotation-processor/src/main/java/org/issue/SimpleAnnotationProcessor.java
@@ -52,6 +52,29 @@ public class SimpleAnnotationProcessor
             return true;
         }
 
+        // assert that commons-lang3 is on the classpath
+        try
+        {
+            getClass().getClassLoader().loadClass( "org.apache.commons.lang3.StringUtils" );
+        }
+        catch ( ClassNotFoundException expected )
+        {
+            throw new RuntimeException( "Expected org.apache.commons.lang3.StringUtils to be on the processorpath,"
+                + "because it is a declared dependency of the annotation processor." );
+        }
+
+        // assert that commons-io is NOT on the classpath, as it is only a project dependency in "annotation-user"
+        try
+        {
+            getClass().getClassLoader().loadClass( "org.apache.commons.io.IOUtils" );
+            throw new RuntimeException( "Expected a ClassNotFoundException because "
+                + "org.apache.commons.io.IOUtils is not supposed to be on the processorpath." );
+        }
+        catch ( ClassNotFoundException expected )
+        {
+            // expected.
+        }
+
         Filer filer = processingEnv.getFiler();
 
         Elements elementUtils = processingEnv.getElementUtils();
diff --git a/src/it/MCOMPILER-203-processorpath/annotation-user/pom.xml b/src/it/MCOMPILER-203-processorpath/annotation-user/pom.xml
index 98b6a85..117ac09 100644
--- a/src/it/MCOMPILER-203-processorpath/annotation-user/pom.xml
+++ b/src/it/MCOMPILER-203-processorpath/annotation-user/pom.xml
@@ -32,6 +32,11 @@ under the License.
   <artifactId>annotation-user</artifactId>
 
   <dependencies>
+    <dependency>
+      <groupId>commons-io</groupId>
+      <artifactId>commons-io</artifactId>
+      <version>2.4</version>
+    </dependency>
     <dependency>
       <groupId>junit</groupId>
       <artifactId>junit</artifactId>
diff --git a/src/main/java/org/apache/maven/plugin/compiler/AbstractCompilerMojo.java b/src/main/java/org/apache/maven/plugin/compiler/AbstractCompilerMojo.java
index 87143e8..4ec073a 100644
--- a/src/main/java/org/apache/maven/plugin/compiler/AbstractCompilerMojo.java
+++ b/src/main/java/org/apache/maven/plugin/compiler/AbstractCompilerMojo.java
@@ -64,6 +64,7 @@ import java.util.ArrayList;
 import java.util.Date;
 import java.util.HashSet;
 import java.util.LinkedHashMap;
+import java.util.LinkedHashSet;
 import java.util.List;
 import java.util.Map;
 import java.util.Set;
@@ -1356,7 +1357,7 @@ public abstract class AbstractCompilerMojo
 
         try
         {
-            Set<Artifact> requiredArtifacts = new HashSet<Artifact>();
+            Set<Artifact> requiredArtifacts = new LinkedHashSet<Artifact>();
 
             for ( DependencyCoordinate coord : annotationProcessorPaths )
             {
@@ -1376,8 +1377,8 @@ public abstract class AbstractCompilerMojo
             }
 
             ArtifactResolutionRequest request = new ArtifactResolutionRequest()
-                            .setArtifact( project.getArtifact() )
-                            .setResolveRoot( false )
+                            .setArtifact( requiredArtifacts.iterator().next() )
+                            .setResolveRoot( true )
                             .setResolveTransitively( true )
                             .setArtifactDependencies( requiredArtifacts )
                             .setLocalRepository( session.getLocalRepository() )
@@ -1387,14 +1388,14 @@ public abstract class AbstractCompilerMojo
 
             resolutionErrorHandler.throwErrors( request, resolutionResult );
 
-            List<String> classpathElements = new ArrayList<String>( resolutionResult.getArtifacts().size() );
+            List<String> elements = new ArrayList<String>( resolutionResult.getArtifacts().size() );
 
             for ( Object resolved : resolutionResult.getArtifacts() )
             {
-                classpathElements.add( ( (Artifact) resolved ).getFile().getAbsolutePath() );
+                elements.add( ( (Artifact) resolved ).getFile().getAbsolutePath() );
             }
 
-            return classpathElements;
+            return elements;
         }
         catch ( Exception e )
         {
