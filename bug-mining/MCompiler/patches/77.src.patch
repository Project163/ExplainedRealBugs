diff --git a/pom.xml b/pom.xml
index 606b670..ab40b63 100644
--- a/pom.xml
+++ b/pom.xml
@@ -63,7 +63,7 @@ under the License.
       ! The following property is used in the integration tests MCOMPILER-157
     -->
     <mavenPluginPluginVersion>3.5</mavenPluginPluginVersion>
-    <plexusCompilerVersion>2.8</plexusCompilerVersion>
+    <plexusCompilerVersion>2.8.1-SNAPSHOT</plexusCompilerVersion>
     <groovyVersion>1.8.0</groovyVersion>
     <groovyEclipseCompilerVersion>2.7.0-01</groovyEclipseCompilerVersion>
     <groovy-eclipse-batch>2.0.4-04</groovy-eclipse-batch>
diff --git a/src/it/MCOMPILER-268_modulepath/pom.xml b/src/it/MCOMPILER-268_modulepath/pom.xml
index 30be2cf..82bf9f2 100644
--- a/src/it/MCOMPILER-268_modulepath/pom.xml
+++ b/src/it/MCOMPILER-268_modulepath/pom.xml
@@ -49,7 +49,8 @@
         <artifactId>maven-compiler-plugin</artifactId>
         <version>@project.version@</version>
         <configuration>
-          <release>9</release>
+          <source>9</source>
+          <target>9</target>
         </configuration>
       </plugin>
     </plugins>
diff --git a/src/it/MCOMPILER-268_modulepath/verify.groovy b/src/it/MCOMPILER-268_modulepath/verify.groovy
index fc9c702..bef3790 100644
--- a/src/it/MCOMPILER-268_modulepath/verify.groovy
+++ b/src/it/MCOMPILER-268_modulepath/verify.groovy
@@ -18,8 +18,4 @@
  */
 def log = new File( basedir, 'build.log').text
 
-assert log.count( " -release" ) == 2
-
-assert !( log =~  /\s-source\s/ )
-assert !( log =~  /\s-target\s/ )
-
+assert log.count( " --module-path" ) == 2
diff --git a/src/it/MCOMPILER-270_release/verify.groovy b/src/it/MCOMPILER-270_release/verify.groovy
index fc9c702..8db63f2 100644
--- a/src/it/MCOMPILER-270_release/verify.groovy
+++ b/src/it/MCOMPILER-270_release/verify.groovy
@@ -18,7 +18,7 @@
  */
 def log = new File( basedir, 'build.log').text
 
-assert log.count( " -release" ) == 2
+assert log.count( " --release" ) == 2
 
 assert !( log =~  /\s-source\s/ )
 assert !( log =~  /\s-target\s/ )
diff --git a/src/it/MCOMPILER-275_separate-moduleinfo/invoker.properties b/src/it/MCOMPILER-275_separate-moduleinfo/invoker.properties
new file mode 100644
index 0000000..9511718
--- /dev/null
+++ b/src/it/MCOMPILER-275_separate-moduleinfo/invoker.properties
@@ -0,0 +1,18 @@
+# Licensed to the Apache Software Foundation (ASF) under one
+# or more contributor license agreements.  See the NOTICE file
+# distributed with this work for additional information
+# regarding copyright ownership.  The ASF licenses this file
+# to you under the Apache License, Version 2.0 (the
+# "License"); you may not use this file except in compliance
+# with the License.  You may obtain a copy of the License at
+# 
+#   http://www.apache.org/licenses/LICENSE-2.0
+# 
+# Unless required by applicable law or agreed to in writing,
+# software distributed under the License is distributed on an
+# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
+# KIND, either express or implied.  See the License for the
+# specific language governing permissions and limitations
+# under the License.
+
+invoker.java.version = 9+
diff --git a/src/it/MCOMPILER-275_separate-moduleinfo/pom.xml b/src/it/MCOMPILER-275_separate-moduleinfo/pom.xml
new file mode 100644
index 0000000..111dee6
--- /dev/null
+++ b/src/it/MCOMPILER-275_separate-moduleinfo/pom.xml
@@ -0,0 +1,84 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!--
+  ~ Licensed to the Apache Software Foundation (ASF) under one
+  ~ or more contributor license agreements.  See the NOTICE file
+  ~ distributed with this work for additional information
+  ~ regarding copyright ownership.  The ASF licenses this file
+  ~ to you under the Apache License, Version 2.0 (the
+  ~ "License"); you may not use this file except in compliance
+  ~ with the License.  You may obtain a copy of the License at
+  ~
+  ~   http://www.apache.org/licenses/LICENSE-2.0
+  ~
+  ~ Unless required by applicable law or agreed to in writing,
+  ~ software distributed under the License is distributed on an
+  ~ "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
+  ~ KIND, either express or implied.  See the License for the
+  ~ specific language governing permissions and limitations
+  ~ under the License.
+  -->
+
+<project xmlns="http://maven.apache.org/POM/4.0.0"
+         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
+  <modelVersion>4.0.0</modelVersion>
+
+  <groupId>org.apache.maven.plugins.compiler.it</groupId>
+  <artifactId>mcompiler270</artifactId>
+  <version>1.0-SNAPSHOT</version>
+
+  <url>https://issues.apache.org/jira/browse/MCOMPILER-270</url>
+
+  <properties>
+    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
+  </properties>
+
+  <dependencies>
+    <dependency>
+      <groupId>junit</groupId>
+      <artifactId>junit</artifactId>
+      <version>3.8.2</version>
+      <scope>test</scope>
+    </dependency>
+  </dependencies>
+
+  <build>
+    <plugins>
+      <plugin>
+        <groupId>org.apache.maven.plugins</groupId>
+        <artifactId>maven-compiler-plugin</artifactId>
+        <version>@project.version@</version>
+        <executions>
+          <execution>
+            <id>default-compile</id>
+            <configuration>
+              <excludes>
+                <exclude>module-info.java</exclude>
+              </excludes>
+              <!-- ideally this would be 1.5, but with CI's it is hard to have a proper toolchains.xml in place -->
+              <source>1.6</source>
+              <target>1.6</target>
+            </configuration>
+          </execution>
+          <execution>
+            <id>moduleinfo-compile</id>
+            <goals>
+              <goal>compile</goal>
+            </goals>
+            <configuration>
+              <includes>
+                <include>module-info.java</include>
+              </includes>
+              <jdkToolchain>
+                <version>9</version>
+              </jdkToolchain>
+              <fork>true</fork>
+              <release>9</release>
+            </configuration>
+          </execution>
+        </executions>
+      </plugin>
+    </plugins>
+  </build>
+
+</project>
diff --git a/src/it/MCOMPILER-275_separate-moduleinfo/src/main/java/com/foo/MyClass.java b/src/it/MCOMPILER-275_separate-moduleinfo/src/main/java/com/foo/MyClass.java
new file mode 100644
index 0000000..dae085a
--- /dev/null
+++ b/src/it/MCOMPILER-275_separate-moduleinfo/src/main/java/com/foo/MyClass.java
@@ -0,0 +1,25 @@
+package com.foo;
+
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ * 
+ *   http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ * Unless required by applicable law or agreed to in writing,
+ * software distributed under the License is distributed on an
+ * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
+ * KIND, either express or implied.  See the License for the
+ * specific language governing permissions and limitations
+ * under the License.
+ */
+
+public class MyClass
+{
+
+}
diff --git a/src/it/MCOMPILER-275_separate-moduleinfo/src/main/java/module-info.java b/src/it/MCOMPILER-275_separate-moduleinfo/src/main/java/module-info.java
new file mode 100644
index 0000000..c0e023a
--- /dev/null
+++ b/src/it/MCOMPILER-275_separate-moduleinfo/src/main/java/module-info.java
@@ -0,0 +1,22 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ * 
+ *   http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ * Unless required by applicable law or agreed to in writing,
+ * software distributed under the License is distributed on an
+ * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
+ * KIND, either express or implied.  See the License for the
+ * specific language governing permissions and limitations
+ * under the License.
+ */
+
+module M.N {
+    
+}
\ No newline at end of file
diff --git a/src/it/MCOMPILER-275_separate-moduleinfo/src/test/java/com/foo/MyTest.java b/src/it/MCOMPILER-275_separate-moduleinfo/src/test/java/com/foo/MyTest.java
new file mode 100644
index 0000000..efb936e
--- /dev/null
+++ b/src/it/MCOMPILER-275_separate-moduleinfo/src/test/java/com/foo/MyTest.java
@@ -0,0 +1,28 @@
+package com.foo;
+
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ * 
+ *   http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ * Unless required by applicable law or agreed to in writing,
+ * software distributed under the License is distributed on an
+ * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
+ * KIND, either express or implied.  See the License for the
+ * specific language governing permissions and limitations
+ * under the License.
+ */
+
+import junit.framework.TestCase;
+
+public class MyTest
+    extends TestCase
+{
+    private MyClass myClass = new MyClass();
+}
diff --git a/src/main/java/org/apache/maven/plugin/compiler/AbstractCompilerMojo.java b/src/main/java/org/apache/maven/plugin/compiler/AbstractCompilerMojo.java
index 3b937a4..04664b6 100644
--- a/src/main/java/org/apache/maven/plugin/compiler/AbstractCompilerMojo.java
+++ b/src/main/java/org/apache/maven/plugin/compiler/AbstractCompilerMojo.java
@@ -84,6 +84,13 @@ public abstract class AbstractCompilerMojo
     extends AbstractMojo
 {
 
+    static final String DEFAULT_SOURCE = "1.5";
+    
+    static final String DEFAULT_TARGET = "1.5";
+    
+    // Used to compare with older targets
+    static final String MODULE_INFO_TARGET = "1.9";
+    
     // ----------------------------------------------------------------------
     // Configurables
     // ----------------------------------------------------------------------
@@ -129,13 +136,13 @@ public abstract class AbstractCompilerMojo
     /**
      * The -source argument for the Java compiler.
      */
-    @Parameter( property = "maven.compiler.source", defaultValue = "1.5" )
+    @Parameter( property = "maven.compiler.source", defaultValue = DEFAULT_SOURCE )
     protected String source;
 
     /**
      * The -target argument for the Java compiler.
      */
-    @Parameter( property = "maven.compiler.target", defaultValue = "1.5" )
+    @Parameter( property = "maven.compiler.target", defaultValue = DEFAULT_TARGET )
     protected String target;
 
     /**
@@ -459,6 +466,8 @@ public abstract class AbstractCompilerMojo
     protected abstract List<String> getModulepathElements();
 
     protected abstract List<String> getCompileSourceRoots();
+    
+    protected abstract void preparePaths( Set<File> sourceFiles );
 
     protected abstract File getOutputDirectory();
 
@@ -532,14 +541,6 @@ public abstract class AbstractCompilerMojo
             return;
         }
 
-        if ( getLog().isDebugEnabled() )
-        {
-            getLog().debug( "Source directories: " + compileSourceRoots.toString().replace( ',', '\n' ) );
-            getLog().debug( "Classpath: " + getClasspathElements().toString().replace( ',', '\n' ) );
-            getLog().debug( "Modulepath: " + getModulepathElements().toString().replace( ',', '\n' ) );
-            getLog().debug( "Output directory: " + getOutputDirectory() );
-        }
-
         // ----------------------------------------------------------------------
         // Create the compiler configuration
         // ----------------------------------------------------------------------
@@ -548,10 +549,6 @@ public abstract class AbstractCompilerMojo
 
         compilerConfiguration.setOutputLocation( getOutputDirectory().getAbsolutePath() );
 
-        compilerConfiguration.setClasspathEntries( getClasspathElements() );
-
-        compilerConfiguration.setModulepathEntries( getModulepathElements() );
-
         compilerConfiguration.setOptimize( optimize );
 
         compilerConfiguration.setDebug( debug );
@@ -628,49 +625,6 @@ public abstract class AbstractCompilerMojo
 
         compilerConfiguration.setSourceEncoding( encoding );
 
-        Map<String, String> effectiveCompilerArguments = getCompilerArguments();
-
-        String effectiveCompilerArgument = getCompilerArgument();
-
-        if ( ( effectiveCompilerArguments != null ) || ( effectiveCompilerArgument != null )
-                        || ( compilerArgs != null ) )
-        {
-            LinkedHashMap<String, String> cplrArgsCopy = new LinkedHashMap<String, String>();
-            if ( effectiveCompilerArguments != null )
-            {
-                for ( Map.Entry<String, String> me : effectiveCompilerArguments.entrySet() )
-                {
-                    String key = me.getKey();
-                    String value = me.getValue();
-                    if ( !key.startsWith( "-" ) )
-                    {
-                        key = "-" + key;
-                    }
-
-                    if ( key.startsWith( "-A" ) && StringUtils.isNotEmpty( value ) )
-                    {
-                        cplrArgsCopy.put( key + "=" + value, null );
-                    }
-                    else
-                    {
-                        cplrArgsCopy.put( key, value );
-                    }
-                }
-            }
-            if ( !StringUtils.isEmpty( effectiveCompilerArgument ) )
-            {
-                cplrArgsCopy.put( effectiveCompilerArgument, null );
-            }
-            if ( compilerArgs != null )
-            {
-                for ( String arg : compilerArgs )
-                {
-                    cplrArgsCopy.put( arg, null );
-                }
-            }
-            compilerConfiguration.setCustomCompilerArguments( cplrArgsCopy );
-        }
-
         compilerConfiguration.setFork( fork );
 
         if ( fork )
@@ -762,6 +716,8 @@ public abstract class AbstractCompilerMojo
                 canUpdateTarget = compiler.canUpdateTarget( compilerConfiguration );
 
                 sources = getCompileSources( compiler, compilerConfiguration );
+                
+                preparePaths( sources );
 
                 incrementalBuildHelperRequest = new IncrementalBuildHelperRequest().inputFiles( sources );
 
@@ -815,6 +771,8 @@ public abstract class AbstractCompilerMojo
                 {
                     compilerConfiguration.setSourceFiles( staleSources );
                 }
+                
+                preparePaths( compilerConfiguration.getSourceFiles() );
             }
             catch ( CompilerException e )
             {
@@ -828,10 +786,58 @@ public abstract class AbstractCompilerMojo
                 return;
             }
         }
+        
+        // Dividing pathElements of classPath and modulePath is based on sourceFiles
+        compilerConfiguration.setClasspathEntries( getClasspathElements() );
+
+        compilerConfiguration.setModulepathEntries( getModulepathElements() );
+        
+        Map<String, String> effectiveCompilerArguments = getCompilerArguments();
+
+        String effectiveCompilerArgument = getCompilerArgument();
+
+        if ( ( effectiveCompilerArguments != null ) || ( effectiveCompilerArgument != null )
+                        || ( compilerArgs != null ) )
+        {
+            LinkedHashMap<String, String> cplrArgsCopy = new LinkedHashMap<String, String>();
+            if ( effectiveCompilerArguments != null )
+            {
+                for ( Map.Entry<String, String> me : effectiveCompilerArguments.entrySet() )
+                {
+                    String key = me.getKey();
+                    String value = me.getValue();
+                    if ( !key.startsWith( "-" ) )
+                    {
+                        key = "-" + key;
+                    }
+
+                    if ( key.startsWith( "-A" ) && StringUtils.isNotEmpty( value ) )
+                    {
+                        cplrArgsCopy.put( key + "=" + value, null );
+                    }
+                    else
+                    {
+                        cplrArgsCopy.put( key, value );
+                    }
+                }
+            }
+            if ( !StringUtils.isEmpty( effectiveCompilerArgument ) )
+            {
+                cplrArgsCopy.put( effectiveCompilerArgument, null );
+            }
+            if ( compilerArgs != null )
+            {
+                for ( String arg : compilerArgs )
+                {
+                    cplrArgsCopy.put( arg, null );
+                }
+            }
+            compilerConfiguration.setCustomCompilerArguments( cplrArgsCopy );
+        }
+
         // ----------------------------------------------------------------------
         // Dump configuration
         // ----------------------------------------------------------------------
-
         if ( getLog().isDebugEnabled() )
         {
             getLog().debug( "Classpath:" );
@@ -869,7 +875,7 @@ public abstract class AbstractCompilerMojo
                 }
 
                 String[] cl = compiler.createCommandLine( compilerConfiguration );
-                if ( cl != null && cl.length > 0 )
+                if ( getLog().isDebugEnabled() && cl != null && cl.length > 0 )
                 {
                     StringBuilder sb = new StringBuilder();
                     sb.append( cl[0] );
diff --git a/src/main/java/org/apache/maven/plugin/compiler/CompilerMojo.java b/src/main/java/org/apache/maven/plugin/compiler/CompilerMojo.java
index c9f34f0..272d03a 100644
--- a/src/main/java/org/apache/maven/plugin/compiler/CompilerMojo.java
+++ b/src/main/java/org/apache/maven/plugin/compiler/CompilerMojo.java
@@ -20,7 +20,6 @@ package org.apache.maven.plugin.compiler;
  */
 
 import org.apache.maven.artifact.Artifact;
-import org.apache.maven.artifact.DependencyResolutionRequiredException;
 import org.apache.maven.plugin.MojoExecutionException;
 import org.apache.maven.plugins.annotations.LifecyclePhase;
 import org.apache.maven.plugins.annotations.Parameter;
@@ -98,6 +97,9 @@ public class CompilerMojo
     @Parameter ( property = "maven.main.skip" )
     private boolean skipMain;
 
+    @Parameter( defaultValue = "${project.compileClasspathElements}", readonly = true, required = true )
+    private List<String> compilePath;
+    
     private List<String> classpathElements;
 
     private List<String> modulepathElements;
@@ -132,15 +134,6 @@ public class CompilerMojo
             return;
         }
 
-        try
-        {
-            preparePaths();
-        }
-        catch ( DependencyResolutionRequiredException e )
-        {
-            throw new MojoExecutionException( e.getMessage() );
-        }
-
         super.execute();
 
         if ( outputDirectory.isDirectory() )
@@ -149,26 +142,33 @@ public class CompilerMojo
         }
     }
     
-    private void preparePaths() throws DependencyResolutionRequiredException
+    @Override
+    protected void preparePaths( Set<File> sourceFiles )
     {
+        assert compilePath != null;
+        
         boolean hasModuleDescriptor = false;
-        for ( String sourceRoot : getProject().getCompileSourceRoots() )
+        for ( File sourceFile : sourceFiles )
         {
-            hasModuleDescriptor |= new File( sourceRoot, "module-info.java" ).exists();
+            if ( "module-info.java".equals( sourceFile.getName() ) )
+            {
+                hasModuleDescriptor = true;
+                break;
+            }
         }
 
-        List<String> pathElements = getProject().getCompileClasspathElements();
-        
         if ( hasModuleDescriptor )
         {
-            modulepathElements = pathElements;
+            modulepathElements = compilePath;
             classpathElements = Collections.emptyList();
         }
         else
         {
-            classpathElements = pathElements;
+            classpathElements = compilePath;
             modulepathElements = Collections.emptyList();
         }
+        
+        getLog().debug( "classpathElements: " + getClasspathElements() );
     }
 
     protected SourceInclusionScanner getSourceInclusionScanner( int staleMillis )
diff --git a/src/main/java/org/apache/maven/plugin/compiler/TestCompilerMojo.java b/src/main/java/org/apache/maven/plugin/compiler/TestCompilerMojo.java
index 6ca9d98..be66b9f 100644
--- a/src/main/java/org/apache/maven/plugin/compiler/TestCompilerMojo.java
+++ b/src/main/java/org/apache/maven/plugin/compiler/TestCompilerMojo.java
@@ -19,7 +19,6 @@ package org.apache.maven.plugin.compiler;
  * under the License.
  */
 
-import org.apache.maven.artifact.DependencyResolutionRequiredException;
 import org.apache.maven.plugin.MojoExecutionException;
 import org.apache.maven.plugins.annotations.LifecyclePhase;
 import org.apache.maven.plugins.annotations.Mojo;
@@ -145,6 +144,12 @@ public class TestCompilerMojo
     @Parameter ( defaultValue = "${project.build.directory}/generated-test-sources/test-annotations" )
     private File generatedTestSourcesDirectory;
 
+    @Parameter( defaultValue = "${project.compileClasspathElements}", readonly = true )
+    private List<String> compilePath;
+
+    @Parameter( defaultValue = "${project.testClasspathElements}", readonly = true )
+    private List<String> testPath;
+
     private List<String> classpathElements;
 
     private List<String> modulepathElements;
@@ -156,19 +161,7 @@ public class TestCompilerMojo
         {
             getLog().info( "Not compiling test sources" );
         }
-        else
-        {
-            try
-            {
-                preparePaths();
-            }
-            catch ( DependencyResolutionRequiredException e )
-            {
-                throw new MojoExecutionException( e.getMessage() );
-            }
-            
-            super.execute();
-        }
+        super.execute();
     }
 
     protected List<String> getCompileSourceRoots()
@@ -192,8 +185,8 @@ public class TestCompilerMojo
         return outputDirectory;
     }
 
-    private void preparePaths()
-        throws DependencyResolutionRequiredException
+    @Override
+    protected void preparePaths( Set<File> sourceFiles )
     {
         File mainOutputDirectory = new File( getProject().getBuild().getOutputDirectory() );
 
@@ -202,20 +195,38 @@ public class TestCompilerMojo
         boolean hasMainModuleDescriptor = mainModuleInfo.exists();
         
         boolean hasTestModuleDescriptor = false;
-        for ( String sourceRoot : getProject().getTestCompileSourceRoots() )
+        for ( File sourceFile : sourceFiles )
         {
-            hasTestModuleDescriptor |= new File( sourceRoot, "module-info.java" ).exists();
+            // @todo verify if it is the root of a sourcedirectory?
+            if ( "module-info.java".equals( sourceFile.getName() ) ) 
+            {
+                hasTestModuleDescriptor = true;
+                break;
+            }
         }
         
-        List<String> compilePathElements = getProject().getCompileClasspathElements();
-        List<String> testPathElements = getProject().getTestClasspathElements();
-
-        List<String> testScopedElements = new ArrayList<String>( testPathElements );
-        testScopedElements.removeAll( compilePathElements );
+        List<String> testScopedElements = new ArrayList<String>( testPath );
+        testScopedElements.removeAll( compilePath );
         
+        if ( release != null )
+        {
+            if ( Integer.valueOf( release ) < 9 )
+            {
+                modulepathElements = Collections.emptyList();
+                classpathElements = testPath;
+                return;
+            }
+        }
+        else if ( Double.valueOf( getTarget() ) < Double.valueOf( MODULE_INFO_TARGET ) )
+        {
+            modulepathElements = Collections.emptyList();
+            classpathElements = testPath;
+            return;
+        }
+            
         if ( hasTestModuleDescriptor )
         {
-            modulepathElements = testPathElements;
+            modulepathElements = testPath;
             classpathElements = Collections.emptyList();
 
             if ( hasMainModuleDescriptor )
@@ -236,7 +247,7 @@ public class TestCompilerMojo
         {
             if ( hasMainModuleDescriptor )
             {
-                modulepathElements = compilePathElements;
+                modulepathElements = compilePath;
                 classpathElements = testScopedElements;
                 if ( compilerArgs == null )
                 {
@@ -249,6 +260,8 @@ public class TestCompilerMojo
                     compilerArgs.add( "-Xmodule:" + moduleName );
                     compilerArgs.add( "--add-modules" );
                     compilerArgs.add( moduleName );
+                    compilerArgs.add( "--add-reads" );
+                    compilerArgs.add( moduleName + "=ALL-UNNAMED" );
                 }
                 catch ( IOException e )
                 {
@@ -258,7 +271,7 @@ public class TestCompilerMojo
             else
             {
                 modulepathElements = Collections.emptyList();
-                classpathElements = testPathElements;
+                classpathElements = testPath;
             }
         }
     }
diff --git a/src/test/java/org/apache/maven/plugin/compiler/CompilerMojoTestCase.java b/src/test/java/org/apache/maven/plugin/compiler/CompilerMojoTestCase.java
index f948cb1..759e7e0 100644
--- a/src/test/java/org/apache/maven/plugin/compiler/CompilerMojoTestCase.java
+++ b/src/test/java/org/apache/maven/plugin/compiler/CompilerMojoTestCase.java
@@ -47,9 +47,9 @@ public class CompilerMojoTestCase
     extends AbstractMojoTestCase
 {
     
-    private String source;
-    
-    private String target;
+    private String source = AbstractCompilerMojo.DEFAULT_SOURCE;
+
+    private String target = AbstractCompilerMojo.DEFAULT_TARGET;
     
     @Override
     protected void setUp()
@@ -321,7 +321,7 @@ public class CompilerMojoTestCase
 
         setVariableValueToObject( mojo, "log", new DebugEnabledLog() );
         setVariableValueToObject( mojo, "projectArtifact", new ArtifactStub() );
-        setVariableValueToObject( mojo, "classpathElements", Collections.EMPTY_LIST );
+        setVariableValueToObject( mojo, "compilePath", Collections.EMPTY_LIST );
         setVariableValueToObject( mojo, "session", getMockMavenSession() );
         setVariableValueToObject( mojo, "project", getMockMavenProject() );
         setVariableValueToObject( mojo, "mojoExecution", getMockMojoExecution() );
@@ -366,6 +366,7 @@ public class CompilerMojoTestCase
         }
         when ( junitArtifact.getFile() ).thenReturn( artifactFile );
         
+        testClasspathList.add( artifactFile.getAbsolutePath() );
         testClasspathList.add( compilerMojo.getOutputDirectory().getPath() );
 
         String testSourceRoot = testPom.getParent() + "/src/test/java";
@@ -375,6 +376,8 @@ public class CompilerMojoTestCase
         project.setArtifacts( Collections.singleton( junitArtifact )  );
         project.getBuild().setOutputDirectory( new File( buildDir, "classes" ).getAbsolutePath() );
         setVariableValueToObject( mojo, "project", project );
+        setVariableValueToObject( mojo, "compilePath", Collections.EMPTY_LIST );
+        setVariableValueToObject( mojo, "testPath", testClasspathList );
         setVariableValueToObject( mojo, "session", getMockMavenSession() );
         setVariableValueToObject( mojo, "mojoExecution", getMockMojoExecution() );
         setVariableValueToObject( mojo, "source", source );
@@ -382,7 +385,7 @@ public class CompilerMojoTestCase
 
         return mojo;
     }
-
+    
     private MavenProject getMockMavenProject()
     {
         MavenProject mp = new MavenProject();
