{"url":"https://api.github.com/repos/goreleaser/goreleaser/issues/2704","repository_url":"https://api.github.com/repos/goreleaser/goreleaser","labels_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/2704/labels{/name}","comments_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/2704/comments","events_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/2704/events","html_url":"https://github.com/goreleaser/goreleaser/issues/2704","id":1064900081,"node_id":"I_kwDOBJgEXs4_eRXx","number":2704,"title":"[Bug]: Incorrect parsing of Gitea URL with port number","user":{"login":"indistinctTalk","id":5284181,"node_id":"MDQ6VXNlcjUyODQxODE=","avatar_url":"https://avatars.githubusercontent.com/u/5284181?v=4","gravatar_id":"","url":"https://api.github.com/users/indistinctTalk","html_url":"https://github.com/indistinctTalk","followers_url":"https://api.github.com/users/indistinctTalk/followers","following_url":"https://api.github.com/users/indistinctTalk/following{/other_user}","gists_url":"https://api.github.com/users/indistinctTalk/gists{/gist_id}","starred_url":"https://api.github.com/users/indistinctTalk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/indistinctTalk/subscriptions","organizations_url":"https://api.github.com/users/indistinctTalk/orgs","repos_url":"https://api.github.com/users/indistinctTalk/repos","events_url":"https://api.github.com/users/indistinctTalk/events{/privacy}","received_events_url":"https://api.github.com/users/indistinctTalk/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":504976497,"node_id":"MDU6TGFiZWw1MDQ5NzY0OTc=","url":"https://api.github.com/repos/goreleaser/goreleaser/labels/bug","name":"bug","color":"ee0701","default":true,"description":"Something isn't working"}],"state":"closed","locked":true,"assignee":{"login":"caarlos0","id":245435,"node_id":"MDQ6VXNlcjI0NTQzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/245435?v=4","gravatar_id":"","url":"https://api.github.com/users/caarlos0","html_url":"https://github.com/caarlos0","followers_url":"https://api.github.com/users/caarlos0/followers","following_url":"https://api.github.com/users/caarlos0/following{/other_user}","gists_url":"https://api.github.com/users/caarlos0/gists{/gist_id}","starred_url":"https://api.github.com/users/caarlos0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caarlos0/subscriptions","organizations_url":"https://api.github.com/users/caarlos0/orgs","repos_url":"https://api.github.com/users/caarlos0/repos","events_url":"https://api.github.com/users/caarlos0/events{/privacy}","received_events_url":"https://api.github.com/users/caarlos0/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"caarlos0","id":245435,"node_id":"MDQ6VXNlcjI0NTQzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/245435?v=4","gravatar_id":"","url":"https://api.github.com/users/caarlos0","html_url":"https://github.com/caarlos0","followers_url":"https://api.github.com/users/caarlos0/followers","following_url":"https://api.github.com/users/caarlos0/following{/other_user}","gists_url":"https://api.github.com/users/caarlos0/gists{/gist_id}","starred_url":"https://api.github.com/users/caarlos0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caarlos0/subscriptions","organizations_url":"https://api.github.com/users/caarlos0/orgs","repos_url":"https://api.github.com/users/caarlos0/repos","events_url":"https://api.github.com/users/caarlos0/events{/privacy}","received_events_url":"https://api.github.com/users/caarlos0/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/goreleaser/goreleaser/milestones/3","html_url":"https://github.com/goreleaser/goreleaser/milestone/3","labels_url":"https://api.github.com/repos/goreleaser/goreleaser/milestones/3/labels","id":7409240,"node_id":"MI_kwDOBJgEXs4AcQ5Y","number":3,"title":"v1.1.0","description":"","creator":{"login":"caarlos0","id":245435,"node_id":"MDQ6VXNlcjI0NTQzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/245435?v=4","gravatar_id":"","url":"https://api.github.com/users/caarlos0","html_url":"https://github.com/caarlos0","followers_url":"https://api.github.com/users/caarlos0/followers","following_url":"https://api.github.com/users/caarlos0/following{/other_user}","gists_url":"https://api.github.com/users/caarlos0/gists{/gist_id}","starred_url":"https://api.github.com/users/caarlos0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caarlos0/subscriptions","organizations_url":"https://api.github.com/users/caarlos0/orgs","repos_url":"https://api.github.com/users/caarlos0/repos","events_url":"https://api.github.com/users/caarlos0/events{/privacy}","received_events_url":"https://api.github.com/users/caarlos0/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":31,"state":"closed","created_at":"2021-11-18T17:35:02Z","updated_at":"2022-01-10T14:00:58Z","due_on":null,"closed_at":"2022-01-10T14:00:58Z"},"comments":0,"created_at":"2021-11-27T04:27:33Z","updated_at":"2022-11-28T14:04:09Z","closed_at":"2021-11-28T13:35:02Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### What happened?\r\n\r\nI found a few other closed issues regarding 404's at this stage but none seemed quite the same.\r\n\r\nWhen using the following block in a goreleaser config, goreleaser fails to release with an error.\r\n\r\n```yaml\r\ngitea_urls:\r\n  api: http://gitea:3000/api/v1/\r\n  download: http://gitea:3000\r\n```\r\n\r\n```log\r\n         • token type                type=gitea\r\n         • creating or updating release repo= tag=v0.1\r\n         ⨯ release failed after 1.54s error=scm releases: failed to publish artifacts: 404 Not Found\r\n```\r\n\r\nHowever, after adding the release config block below the release is successful.\r\n\r\n```yaml\r\nrelease:\r\n  gitea:\r\n    owner: gitea\r\n    name: crimp-city\r\n```\r\n\r\nI think this relates to the port number as I have a separate Gitea instance that doesn't have a port number in the URL and it works without having to supply the release block.\r\n\r\n### How can we reproduce this?\r\n\r\nCurrentl config, obviously you'd need a Gitea server available at that path.\r\n\r\n```yaml\r\nbefore:\r\n  hooks:\r\n    - go mod tidy\r\nbuilds:\r\n  - env:\r\n      - CGO_ENABLED=0\r\n    goos:\r\n      - linux\r\n    goarch:\r\n      - amd64\r\narchives:\r\n  - replacements:\r\n      linux: Linux\r\n      amd64: x86_64\r\nchecksum:\r\n  name_template: 'checksums.txt'\r\nsnapshot:\r\n  name_template: \"{{ incpatch .Version }}-next\"\r\nchangelog:\r\n  sort: asc\r\n  filters:\r\n    exclude:\r\n      - '^docs:'\r\n      - '^test:'\r\ngitea_urls:\r\n  api: http://gitea:3000/api/v1/\r\n  download: http://gitea:3000\r\n## uncomment for success\r\n# release:\r\n#   gitea:\r\n#     owner: gitea\r\n#     name: crimp-city\r\n```\r\n\r\n\r\n### goreleaser version\r\n\r\n```bash\r\n$ goreleaser --version\r\ngoreleaser version dev\r\nmodule version: v1.0.0, checksum: h1:83h1R0Y6K4JegTI3K4/koFoAjK14lJ716f0vS6/6ABg=\r\n\r\nhttps://goreleaser.com\r\n```\r\n\r\n\r\n### GoReleaser Check\r\n\r\n- [X] goreleaser check shows no errors\r\n\r\n### Search\r\n\r\n- [X] I did search for other open and closed issues before opening this.\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow this project's Code of Conduct\r\n\r\n### Additional context\r\n\r\nGit remote.\r\n\r\n```sh\r\n$ git ls-remote --get-url\r\nhttp://gitea:3000/gitea/crimp-city.git\r\n```\r\n\r\nComplete debug output from failing release.\r\n\r\n```log\r\n$ goreleaser release --skip-validate --rm-dist --debug\r\n   • debug logs enabled       \r\n   • releasing...     \r\n   • loading config file       file=.goreleaser.yml\r\n   • loaded config file        config={ [] {   false false   [] []   } [] [] [] [] { {   }  { }      []  [] []} [{ [linux] [amd64] [] [] [] []   [] [] []  {[] []} [CGO_ENABLED=0]  [] []  false  false  }] [{ []  map[amd64:x86_64 linux:Linux]  []  [] false}] [] [] {{{ incpatch .Version }}-next} {checksums.txt  [] false []} [] [] [] [] [] [] {{[^docs: ^test:]} asc false }  [] [] {  } {[go mod tidy]} {  false } {false [] } { {false } {false     } {false     } {false    } {false    } {false  0   []   false} {false       } {false } {false  0}} [] { [] [] [] [] [] []   [] [] []  {[] []} []  [] []  false  false  } {   false} {  false} {http://gitea:3000/api/v1/ http://gitea:3000 false}}\r\n   • parallelism: 12          \r\n   • loading environment variables\r\n      • token type: gitea        \r\n   • getting and validating git state\r\n      • running git               args=[-c log.showSignature=false rev-parse --is-inside-work-tree]\r\n      • git result                stderr= stdout=true\r\n\r\n      • running git               args=[-c log.showSignature=false rev-parse --is-inside-work-tree]\r\n      • git result                stderr= stdout=true\r\n\r\n      • running git               args=[-c log.showSignature=false rev-parse --abbrev-ref HEAD --quiet]\r\n      • git result                stderr= stdout=master\r\n\r\n      • running git               args=[-c log.showSignature=false show --format='%h' HEAD --quiet]\r\n      • git result                stderr= stdout='f467af6'\r\n\r\n      • running git               args=[-c log.showSignature=false show --format='%H' HEAD --quiet]\r\n      • git result                stderr= stdout='f467af67831623acf8ad6a86cf52bfd065b1618d'\r\n\r\n      • running git               args=[-c log.showSignature=false show --format='%ct' HEAD --quiet]\r\n      • git result                stderr= stdout='1637977638'\r\n\r\n      • running git               args=[-c log.showSignature=false ls-remote --get-url]\r\n      • git result                stderr= stdout=http://gitea:3000/gitea/crimp-city.git\r\n\r\n      • running git               args=[-c log.showSignature=false tag --points-at HEAD --sort -version:refname]\r\n      • git result                stderr= stdout=v0.1\r\n\r\n      • building...               commit=f467af67831623acf8ad6a86cf52bfd065b1618d latest tag=v0.1\r\n      • pipe skipped              error=validation is disabled\r\n   • parsing tag      \r\n   • running before hooks\r\n         • running                   hook=go mod tidy\r\n         • setting defaults \r\n         • snapshotting     \r\n         • scm releases     \r\n         • running git               args=[-c log.showSignature=false rev-parse --is-inside-work-tree]\r\n         • git result                stderr= stdout=true\r\n\r\n         • running git               args=[-c log.showSignature=false ls-remote --get-url]\r\n         • git result                stderr= stdout=http://gitea:3000/gitea/crimp-city.git\r\n\r\n         • got git url               rawurl=http://gitea:3000/gitea/crimp-city.git\r\n\r\n         • parsed url                name=crimp-city owner=/gitea:3000/gitea\r\n         • pre-release for tag v0.1 set to false\r\n         • project name     \r\n         • loading go mod information\r\n         • building binaries\r\n         • universal binaries\r\n         • creating source archive\r\n         • archives         \r\n         • linux packages   \r\n         • snapcraft packages\r\n         • calculating checksums\r\n         • signing artifacts\r\n         • signing docker images\r\n         • docker images    \r\n         • docker manifests \r\n         • artifactory      \r\n         • blobs            \r\n         • homebrew tap formula\r\n         • krew plugin manifest\r\n         • gofish fish food cookbook\r\n         • scoop manifests  \r\n         • discord          \r\n         • reddit           \r\n         • slack            \r\n         • teams            \r\n         • twitter          \r\n         • smtp             \r\n         • mattermost       \r\n         • milestones       \r\n         • linkedin         \r\n         • telegram         \r\n         • skipped snapshotting     \r\n         • checking ./dist  \r\n         • --rm-dist is set, cleaning it up\r\n         • loading go mod information\r\n         • skipped proxying go module\r\n         • writing effective config file\r\n         • writing                   config=dist/config.yaml\r\n         • generating changelog\r\n         • running git               args=[-c log.showSignature=false describe --tags --abbrev=0 tags/v0.1^]\r\n         • git result                stderr=fatal: No tags can describe 'f2fc2702acecd92adec48342c1ab8f8ffe96e3e4'.\r\nTry --always, or create some tags.\r\n stdout=\r\n         • running git               args=[-c log.showSignature=false rev-list --max-parents=0 HEAD]\r\n         • git result                stderr= stdout=9dac672bfae18f00162a9c96a6bc87197c652d4b\r\n\r\n         • running git               args=[-c log.showSignature=false log --pretty=oneline --abbrev-commit --no-decorate --no-color 9dac672bfae18f00162a9c96a6bc87197c652d4b v0.1]\r\n         • git result                stderr= stdout=f467af6 Add gitea to goreleaser\r\nf2fc270 Add goreleaser config\r\n9dac672 initial commit\r\n\r\n         • is gitlab or gitea changelog\r\n         • writing                   changelog=dist/CHANGELOG.md\r\n         • building binaries\r\n         • building                  build={crimp-city [linux] [amd64] [6] [hardfloat] [linux_amd64] [] . . [-s -w -X main.version={{.Version}} -X main.commit={{.Commit}} -X main.date={{.Date}} -X main.builtBy=goreleaser] [] [] crimp-city {[] []} [CGO_ENABLED=0] go [] []  false go false  }\r\n         • building                  binary=/workspaces/go-goreleaser-drone-example/crimp-city/dist/crimp-city_linux_amd64/crimp-city\r\n         • running                   cmd=[go build -ldflags=-s -w -X main.version=0.1 -X main.commit=f467af67831623acf8ad6a86cf52bfd065b1618d -X main.date=2021-11-27T04:18:59Z -X main.builtBy=goreleaser -o /workspaces/go-goreleaser-drone-example/crimp-city/dist/crimp-city_linux_amd64/crimp-city .] env=[TERM_PROGRAM_VERSION=1.62.3 VSCODE_GIT_ASKPASS_EXTRA_ARGS= NVM_RC_VERSION= GITEA_TOKEN=6eaaf98331b410cfacc5e7123d963669506d23d8 GOPATH=/go PROMPT_DIRTRIM=4 SSH_AUTH_SOCK=/tmp/vscode-ssh-auth-67bfd901f3d0eeaebaa8a9ce45b65c3efc843c78.sock TERM_PROGRAM=vscode VSCODE_GIT_ASKPASS_MAIN=/vscode/vscode-server/bin/linux-x64/ccbaa2d27e38e5afa3e5c21c1c7bef4657064247/extensions/git/dist/askpass-main.js OLDPWD=/tmp USER=vscode REMOTE_CONTAINERS_IPC=/tmp/vscode-remote-containers-ipc-67bfd901f3d0eeaebaa8a9ce45b65c3efc843c78.sock PATH=/usr/local/go/bin:/vscode/vscode-server/bin/linux-x64/ccbaa2d27e38e5afa3e5c21c1c7bef4657064247/bin:/usr/local/share/nvm/current/bin:/go/bin:/usr/local/go/bin:/usr/local/share/nvm/current/bin:/go/bin:/usr/local/go/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/home/vscode/.local/bin REMOTE_CONTAINERS=true VSCODE_GIT_IPC_HANDLE=/tmp/vscode-git-8d023da5e1.sock LESS=-R NVM_SYMLINK_CURRENT=true COLORTERM=truecolor GIT_ASKPASS=/vscode/vscode-server/bin/linux-x64/ccbaa2d27e38e5afa3e5c21c1c7bef4657064247/extensions/git/dist/askpass.sh VSCODE_IPC_HOOK_CLI=/tmp/vscode-ipc-d1ae6e0d-ee23-49e8-adc3-da871eec115e.sock TERM=xterm-256color PAGER=less GO111MODULE=auto PWD=/workspaces/go-goreleaser-drone-example/crimp-city GOLANG_VERSION=1.17.2 VSCODE_GIT_ASKPASS_NODE=/vscode/vscode-server/bin/linux-x64/ccbaa2d27e38e5afa3e5c21c1c7bef4657064247/node NVM_CD_FLAGS=-q LS_COLORS=rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=00:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc=01;31:*.arj=01;31:*.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.tzo=01;31:*.t7z=01;31:*.zip=01;31:*.z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:*.zst=01;31:*.tzst=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.cab=01;31:*.wim=01;31:*.swm=01;31:*.dwm=01;31:*.esd=01;31:*.jpg=01;35:*.jpeg=01;35:*.mjpg=01;35:*.mjpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.webp=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=00;36:*.au=00;36:*.flac=00;36:*.m4a=00;36:*.mid=00;36:*.midi=00;36:*.mka=00;36:*.mp3=00;36:*.mpc=00;36:*.ogg=00;36:*.ra=00;36:*.wav=00;36:*.oga=00;36:*.opus=00;36:*.spx=00;36:*.xspf=00;36: SHELL=/bin/bash HOME=/home/vscode NVM_DIR=/usr/local/share/nvm LANG=en_US.UTF-8 LOGNAME=vscode HOSTNAME=dbadbfdb45ea REMOTE_CONTAINERS_SOCKETS=[\"/tmp/vscode-ssh-auth-67bfd901f3d0eeaebaa8a9ce45b65c3efc843c78.sock\",\"/home/vscode/.gnupg/S.gpg-agent\"] SHLVL=1 _=/go/bin/goreleaser GIT_EDITOR=code --wait LSCOLORS=Gxfxcxdxbxegedabagacad DOCKER_BUILDKIT=1 ZSH=/home/vscode/.oh-my-zsh BROWSER=/vscode/vscode-server/bin/linux-x64/ccbaa2d27e38e5afa3e5c21c1c7bef4657064247/bin/helpers/browser.sh CGO_ENABLED=0 GOOS=linux GOARCH=amd64 GOARM= GOMIPS= GOMIPS64=]\r\n         • added new artifact        name=crimp-city path=/workspaces/go-goreleaser-drone-example/crimp-city/dist/crimp-city_linux_amd64/crimp-city type=Binary\r\n         • skipped universal binaries\r\n         • archives         \r\n         • group linuxamd64 has 1 binaries\r\n         • creating                  archive=dist/crimp-city_0.1_Linux_x86_64.tar.gz\r\n         • adding file: /workspaces/go-goreleaser-drone-example/crimp-city/dist/crimp-city_linux_amd64/crimp-city as crimp-city\r\n         • added new artifact        name=crimp-city_0.1_Linux_x86_64.tar.gz path=dist/crimp-city_0.1_Linux_x86_64.tar.gz type=Archive\r\n         • skipped creating source archive\r\n         • skipped linux packages   \r\n         • skipped snapcraft packages\r\n         • skipped homebrew tap formula\r\n         • skipped gofish fish food cookbook\r\n         • skipped krew plugin manifest\r\n         • skipped scoop manifests  \r\n         • calculating checksums\r\n         • checksumming              file=crimp-city_0.1_Linux_x86_64.tar.gz\r\n         • calculating checksum for dist/crimp-city_0.1_Linux_x86_64.tar.gz\r\n         • added new artifact        name=checksums.txt path=dist/checksums.txt type=Checksum\r\n         • skipped signing artifacts\r\n         • skipped docker images    \r\n         • publishing       \r\n         • skipped blobs            \r\n         • skipped http upload      \r\n         • skipped custom publisher \r\n         • skipped artifactory      \r\n         • skipped docker images    \r\n         • skipped docker manifests \r\n         • skipped signing docker images\r\n         • skipped snapcraft packages\r\n         • scm releases     \r\n         • token type                type=gitea\r\n         • creating or updating release repo= tag=v0.1\r\n         ⨯ release failed after 1.54s error=scm releases: failed to publish artifacts: 404 Not Found\r\n```","closed_by":{"login":"caarlos0","id":245435,"node_id":"MDQ6VXNlcjI0NTQzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/245435?v=4","gravatar_id":"","url":"https://api.github.com/users/caarlos0","html_url":"https://github.com/caarlos0","followers_url":"https://api.github.com/users/caarlos0/followers","following_url":"https://api.github.com/users/caarlos0/following{/other_user}","gists_url":"https://api.github.com/users/caarlos0/gists{/gist_id}","starred_url":"https://api.github.com/users/caarlos0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caarlos0/subscriptions","organizations_url":"https://api.github.com/users/caarlos0/orgs","repos_url":"https://api.github.com/users/caarlos0/repos","events_url":"https://api.github.com/users/caarlos0/events{/privacy}","received_events_url":"https://api.github.com/users/caarlos0/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/goreleaser/goreleaser/issues/2704/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/2704/timeline","performed_via_github_app":null,"state_reason":"completed"}