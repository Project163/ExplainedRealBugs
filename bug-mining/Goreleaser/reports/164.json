{"url":"https://api.github.com/repos/goreleaser/goreleaser/issues/3053","repository_url":"https://api.github.com/repos/goreleaser/goreleaser","labels_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/3053/labels{/name}","comments_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/3053/comments","events_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/3053/events","html_url":"https://github.com/goreleaser/goreleaser/issues/3053","id":1208651272,"node_id":"I_kwDOBJgEXs5ICo4I","number":3053,"title":"support Go first class ports as targets","user":{"login":"mvdan","id":3576549,"node_id":"MDQ6VXNlcjM1NzY1NDk=","avatar_url":"https://avatars.githubusercontent.com/u/3576549?v=4","gravatar_id":"","url":"https://api.github.com/users/mvdan","html_url":"https://github.com/mvdan","followers_url":"https://api.github.com/users/mvdan/followers","following_url":"https://api.github.com/users/mvdan/following{/other_user}","gists_url":"https://api.github.com/users/mvdan/gists{/gist_id}","starred_url":"https://api.github.com/users/mvdan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mvdan/subscriptions","organizations_url":"https://api.github.com/users/mvdan/orgs","repos_url":"https://api.github.com/users/mvdan/repos","events_url":"https://api.github.com/users/mvdan/events{/privacy}","received_events_url":"https://api.github.com/users/mvdan/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":504976499,"node_id":"MDU6TGFiZWw1MDQ5NzY0OTk=","url":"https://api.github.com/repos/goreleaser/goreleaser/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":"New feature or request"}],"state":"closed","locked":true,"assignee":{"login":"caarlos0","id":245435,"node_id":"MDQ6VXNlcjI0NTQzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/245435?v=4","gravatar_id":"","url":"https://api.github.com/users/caarlos0","html_url":"https://github.com/caarlos0","followers_url":"https://api.github.com/users/caarlos0/followers","following_url":"https://api.github.com/users/caarlos0/following{/other_user}","gists_url":"https://api.github.com/users/caarlos0/gists{/gist_id}","starred_url":"https://api.github.com/users/caarlos0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caarlos0/subscriptions","organizations_url":"https://api.github.com/users/caarlos0/orgs","repos_url":"https://api.github.com/users/caarlos0/repos","events_url":"https://api.github.com/users/caarlos0/events{/privacy}","received_events_url":"https://api.github.com/users/caarlos0/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"caarlos0","id":245435,"node_id":"MDQ6VXNlcjI0NTQzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/245435?v=4","gravatar_id":"","url":"https://api.github.com/users/caarlos0","html_url":"https://github.com/caarlos0","followers_url":"https://api.github.com/users/caarlos0/followers","following_url":"https://api.github.com/users/caarlos0/following{/other_user}","gists_url":"https://api.github.com/users/caarlos0/gists{/gist_id}","starred_url":"https://api.github.com/users/caarlos0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caarlos0/subscriptions","organizations_url":"https://api.github.com/users/caarlos0/orgs","repos_url":"https://api.github.com/users/caarlos0/repos","events_url":"https://api.github.com/users/caarlos0/events{/privacy}","received_events_url":"https://api.github.com/users/caarlos0/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/goreleaser/goreleaser/milestones/11","html_url":"https://github.com/goreleaser/goreleaser/milestone/11","labels_url":"https://api.github.com/repos/goreleaser/goreleaser/milestones/11/labels","id":7901406,"node_id":"MI_kwDOBJgEXs4AeJDe","number":11,"title":"v1.9.0","description":"","creator":{"login":"caarlos0","id":245435,"node_id":"MDQ6VXNlcjI0NTQzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/245435?v=4","gravatar_id":"","url":"https://api.github.com/users/caarlos0","html_url":"https://github.com/caarlos0","followers_url":"https://api.github.com/users/caarlos0/followers","following_url":"https://api.github.com/users/caarlos0/following{/other_user}","gists_url":"https://api.github.com/users/caarlos0/gists{/gist_id}","starred_url":"https://api.github.com/users/caarlos0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caarlos0/subscriptions","organizations_url":"https://api.github.com/users/caarlos0/orgs","repos_url":"https://api.github.com/users/caarlos0/repos","events_url":"https://api.github.com/users/caarlos0/events{/privacy}","received_events_url":"https://api.github.com/users/caarlos0/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":48,"state":"closed","created_at":"2022-04-22T01:06:04Z","updated_at":"2022-07-04T18:23:22Z","due_on":null,"closed_at":"2022-05-18T23:40:01Z"},"comments":4,"created_at":"2022-04-19T17:29:10Z","updated_at":"2022-12-05T14:15:13Z","closed_at":"2022-04-26T01:07:28Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Is your feature request related to a problem? Please describe.\n\nGo has a notion of first class ports; it's the GOOS/GOARCH combinations for which upstream Go publishes binary releases. Since https://github.com/golang/go/issues/38874, this information is also provided by cmd/go itself:\r\n\r\n```\r\n$ go version\r\ngo version go1.18.1 linux/amd64\r\n$ go tool dist list -json | jq -r '.[] | select(.FirstClass) | [.GOOS, .GOARCH] | @tsv'\r\ndarwin\tamd64\r\ndarwin\tarm64\r\nlinux\t386\r\nlinux\tamd64\r\nlinux\tarm\r\nlinux\tarm64\r\nwindows\t386\r\nwindows\tamd64\r\n```\r\n\r\nI can manually copy this table over to the `builsd.targets` section as follows:\r\n\r\n```\r\nbuilds:\r\n- targets:\r\n  - darwin_amd64\r\n  - darwin_arm64\r\n  - linux_386\r\n  - linux_amd64\r\n  - linux_arm\r\n  - linux_arm64\r\n  - windows_386\r\n  - windows_amd64\r\n```\r\n\r\nHowever, this is verbose and cumbersome - especially as Go's first-class ports can change with each Go version. I wouldn't be surprised if `windows_arm64` was added in a future Go release, for example. Hard-coding a list is also not great, as a first class port might be added in e.g. Go 1.19 but isn't yet ready in e.g. Go 1.18.x.\r\n\r\nIt's worth noting that first class ports are a bit of a fuzzy concept, but as described in https://github.com/golang/go/wiki/PortingPolicy#first-class-ports, they are a good starting point for Go projects to release binaries. If upstream Go treats these ports as important and well tested, then they are less likely to break and more likely to be popular among users. \n\n### Describe the solution you'd like\n\nSome way to ask goreleaser to build with the first class GOOS/GOARCH targets. I'm not very experienced with YAML or how goreleaser configs work, so I'll leave the design a bit vague in that respect. As a strawman proposal, one could imagine:\r\n\r\n```\r\nbuilds:\r\n- targets:\r\n  - go_first_class\r\n  - windows_arm64 # Windows on ARM64 isn't first class yet, but we think it's important\r\n```\n\n### Describe alternatives you've considered\n\nManually listing the targets, as described; too verbose and can easily get stale over the years.\r\n\r\nA GOOS/GOARCH matrix doesn't work either, because the first class ports are not a simple product of GOOS and GOARCH values. For example, `darwin` and `linux` have `arm64` but `windows` does not, and `linux` and `windows` have `386` but `darwin` does not.\n\n### Search\n\n- [X] I did search for other open and closed issues before opening this.\n\n### Code of Conduct\n\n- [X] I agree to follow this project's Code of Conduct\n\n### Additional context\n\nThe catalyst here is the goreleaser config used in CUE: https://github.com/cue-lang/cue/blob/5127136cfc8c6b695c9d663bee8cb89f4c5df6ad/.goreleaser.yml#L13-L19\r\n\r\nNote how it lacks multiple first class ports, which is unfortunate. `linux/386` is still popular, for example.","closed_by":{"login":"caarlos0","id":245435,"node_id":"MDQ6VXNlcjI0NTQzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/245435?v=4","gravatar_id":"","url":"https://api.github.com/users/caarlos0","html_url":"https://github.com/caarlos0","followers_url":"https://api.github.com/users/caarlos0/followers","following_url":"https://api.github.com/users/caarlos0/following{/other_user}","gists_url":"https://api.github.com/users/caarlos0/gists{/gist_id}","starred_url":"https://api.github.com/users/caarlos0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caarlos0/subscriptions","organizations_url":"https://api.github.com/users/caarlos0/orgs","repos_url":"https://api.github.com/users/caarlos0/repos","events_url":"https://api.github.com/users/caarlos0/events{/privacy}","received_events_url":"https://api.github.com/users/caarlos0/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/goreleaser/goreleaser/issues/3053/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/3053/timeline","performed_via_github_app":null,"state_reason":"completed"}