{"url":"https://api.github.com/repos/goreleaser/goreleaser/issues/5147","repository_url":"https://api.github.com/repos/goreleaser/goreleaser","labels_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/5147/labels{/name}","comments_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/5147/comments","events_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/5147/events","html_url":"https://github.com/goreleaser/goreleaser/issues/5147","id":2540195402,"node_id":"I_kwDOBJgEXs6XaE5K","number":5147,"title":"Custom signature template in `binary_signs` leads to release upload failure","user":{"login":"jamestelfer","id":792299,"node_id":"MDQ6VXNlcjc5MjI5OQ==","avatar_url":"https://avatars.githubusercontent.com/u/792299?v=4","gravatar_id":"","url":"https://api.github.com/users/jamestelfer","html_url":"https://github.com/jamestelfer","followers_url":"https://api.github.com/users/jamestelfer/followers","following_url":"https://api.github.com/users/jamestelfer/following{/other_user}","gists_url":"https://api.github.com/users/jamestelfer/gists{/gist_id}","starred_url":"https://api.github.com/users/jamestelfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamestelfer/subscriptions","organizations_url":"https://api.github.com/users/jamestelfer/orgs","repos_url":"https://api.github.com/users/jamestelfer/repos","events_url":"https://api.github.com/users/jamestelfer/events{/privacy}","received_events_url":"https://api.github.com/users/jamestelfer/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":504976497,"node_id":"MDU6TGFiZWw1MDQ5NzY0OTc=","url":"https://api.github.com/repos/goreleaser/goreleaser/labels/bug","name":"bug","color":"ee0701","default":true,"description":"Something isn't working"},{"id":3668917352,"node_id":"LA_kwDOBJgEXs7arzxo","url":"https://api.github.com/repos/goreleaser/goreleaser/labels/triage","name":"triage","color":"F3079A","default":false,"description":"Issue pending triage by one of the maintainers"}],"state":"closed","locked":false,"assignee":{"login":"caarlos0","id":245435,"node_id":"MDQ6VXNlcjI0NTQzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/245435?v=4","gravatar_id":"","url":"https://api.github.com/users/caarlos0","html_url":"https://github.com/caarlos0","followers_url":"https://api.github.com/users/caarlos0/followers","following_url":"https://api.github.com/users/caarlos0/following{/other_user}","gists_url":"https://api.github.com/users/caarlos0/gists{/gist_id}","starred_url":"https://api.github.com/users/caarlos0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caarlos0/subscriptions","organizations_url":"https://api.github.com/users/caarlos0/orgs","repos_url":"https://api.github.com/users/caarlos0/repos","events_url":"https://api.github.com/users/caarlos0/events{/privacy}","received_events_url":"https://api.github.com/users/caarlos0/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"caarlos0","id":245435,"node_id":"MDQ6VXNlcjI0NTQzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/245435?v=4","gravatar_id":"","url":"https://api.github.com/users/caarlos0","html_url":"https://github.com/caarlos0","followers_url":"https://api.github.com/users/caarlos0/followers","following_url":"https://api.github.com/users/caarlos0/following{/other_user}","gists_url":"https://api.github.com/users/caarlos0/gists{/gist_id}","starred_url":"https://api.github.com/users/caarlos0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caarlos0/subscriptions","organizations_url":"https://api.github.com/users/caarlos0/orgs","repos_url":"https://api.github.com/users/caarlos0/repos","events_url":"https://api.github.com/users/caarlos0/events{/privacy}","received_events_url":"https://api.github.com/users/caarlos0/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":3,"created_at":"2024-09-21T11:23:16Z","updated_at":"2024-09-23T12:14:27Z","closed_at":"2024-09-23T12:14:27Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### What happened?\n\nI'm trying to get cosign working via goreleaser. Mostly it's been straightforward (and pretty neat actually).\r\n\r\nI'm not sure if this is a problem that I've caused or a problem with GoReleaser.\r\n\r\nWhen creating the release, the signing process is called, showing the expected `signature` name being passed in:\r\n\r\n```\r\nsigning cmd=./ci-only.sh artifact=chinmina-bridge signature=dist/release_linux_amd64_v1/chinmina-bridge_linux_amd64.cosign.bundle\r\n```\r\n[ref](https://github.com/jamestelfer/chinmina-bridge/actions/runs/10971683689/job/30467096527#step:6:187)\r\n\r\nAfter the signing process completes, it indicates the addition of the signature artifact:\r\n\r\n```\r\nadded new artifact name=chinmina-bridge_ type=Signature path=dist/release_linux_amd64_v1/chinmina-bridge_linux_amd64.cosign.bundle\r\n```\r\n[ref](https://github.com/jamestelfer/chinmina-bridge/actions/runs/10971683689/job/30467096527#step:6:286)\r\n\r\nNote the `name=chinmina-bridge_` there.\r\n\r\nWhen the release uploads occur, there are two signatures (one per arch), but they both have the same `name`, resulting in errors.\r\n\r\n```\r\n      • uploading to release                         file=dist/release_linux_amd64_v1/chinmina-bridge_linux_amd64.cosign.bundle name=chinmina-bridge_\r\n      • uploading to release                         file=dist/release_linux_arm64/chinmina-bridge_linux_arm64.cosign.bundle name=chinmina-bridge_\r\n      • uploading to release                         file=dist/checksums.txt name=checksums.txt\r\n      • upload failed                                request-id=4143:58730:F8FD43:10F5ACC:66EE9A4B error=POST https://uploads.github.com/repos/jamestelfer/chinmina-bridge/releases/176226441/assets?name=chinmina-bridge_: 404 Not Found [] name=chinmina-bridge_ release-id=176226441\r\n      • failed to upload artifact, will retry        try=1 artifact=chinmina-bridge_ error=POST https://uploads.github.com/repos/jamestelfer/chinmina-bridge/releases/176226441/assets?name=chinmina-bridge_: 404 Not Found []\r\n      • uploading to release                         file=dist/release_linux_amd64_v1/chinmina-bridge_linux_amd64.cosign.bundle name=chinmina-bridge_\r\n      • upload failed                                request-id=4142:16EE:712634:7CC6D4:66EE9A4B error=POST https://uploads.github.com/repos/jamestelfer/chinmina-bridge/releases/176226441/assets?name=chinmina-bridge_: 422 Validation Failed [{Resource:ReleaseAsset Field:name Code:already_exists Message:}] name=chinmina-bridge_ release-id=176226441\r\n      • failed to upload artifact, will retry        try=2 artifact=chinmina-bridge_ error=POST https://uploads.github.com/repos/jamestelfer/chinmina-bridge/releases/176226441/assets?name=chinmina-bridge_: 422 Validation Failed [{Resource:ReleaseAsset Field:name Code:already_exists Message:}]\r\n  ⨯ release failed after 56s                 error=scm releases: failed to publish artifacts: failed to upload chinmina-bridge_ after 2 tries: POST https://uploads.github.com/repos/jamestelfer/chinmina-bridge/releases/176226441/assets?name=chinmina-bridge_: 422 Validation Failed [{Resource:ReleaseAsset Field:name Code:already_exists Message:}]\r\n```\r\n[ref](https://github.com/jamestelfer/chinmina-bridge/actions/runs/10971683689/job/30467096527#step:6:370)\r\n\r\nI did try this without setting the `signature`, but it is defaulted and the release fails if the file can't be found.\r\n\r\nMy preference would be to include the bundle in the tar.gz, but I don't mind it being separate as well.\n\n### How can we reproduce this?\n\nFailing run: https://github.com/jamestelfer/chinmina-bridge/actions/runs/10971683689/job/30467096527#step:6:15\r\n\r\nGit ref: refs/tags/v0.6.1-alpha2 (1aebe98a1f9593d720a580636a60b0b7f02ba3d4)\r\n\r\nConfiguration: https://github.com/jamestelfer/chinmina-bridge/blob/1aebe98a1f9593d720a580636a60b0b7f02ba3d4/.goreleaser.yaml#L24-L34\r\n\r\nIf I'm looking at this correctly:\r\n\r\n1. Create a simple multi-arch go binary\r\n2. Configure the binary to be signed with cosign\r\n3. Configure the `signature` template to include template variables; e.g. `'${artifact}_{{ .Os }}_{{ .Arch }}.cosign.bundle'`\r\n\r\nThe result will be two `signature` type files in the release with the `name` equal to the expansion of `${artifact}_`\r\n\r\nThis will fail on release upload.\n\n### goreleaser version\n\n```bash\nv2.3.2\r\n\r\nSee https://github.com/jamestelfer/chinmina-bridge/actions/runs/10971683689/job/30467096527#step:6:15\n```\n\n\n### GoReleaser Check\n\n- [X] goreleaser check shows no errors\n\n### Search\n\n- [X] I did search for other open and closed issues before opening this\n\n### Supporter\n\n- [ ] I am a [sponsor](https://github.com/sponsors/caarlos0/) or a [Pro](https://goreleaser.com/pro) customer\n\n### Code of Conduct\n\n- [X] I agree to follow this project's Code of Conduct\n\n### Additional context\n\nI had a look around and narrowed down here, immediately after the signing call:\r\n\r\nhttps://github.com/goreleaser/goreleaser/blob/main/internal/pipe/sign/sign.go#L257-L270\r\n\r\nAs far as I can tell, the `name` here isn't evaluating the template properly, and is returning a partial result.","closed_by":{"login":"caarlos0","id":245435,"node_id":"MDQ6VXNlcjI0NTQzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/245435?v=4","gravatar_id":"","url":"https://api.github.com/users/caarlos0","html_url":"https://github.com/caarlos0","followers_url":"https://api.github.com/users/caarlos0/followers","following_url":"https://api.github.com/users/caarlos0/following{/other_user}","gists_url":"https://api.github.com/users/caarlos0/gists{/gist_id}","starred_url":"https://api.github.com/users/caarlos0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caarlos0/subscriptions","organizations_url":"https://api.github.com/users/caarlos0/orgs","repos_url":"https://api.github.com/users/caarlos0/repos","events_url":"https://api.github.com/users/caarlos0/events{/privacy}","received_events_url":"https://api.github.com/users/caarlos0/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/goreleaser/goreleaser/issues/5147/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/5147/timeline","performed_via_github_app":null,"state_reason":"completed"}