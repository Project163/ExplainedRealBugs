{"url":"https://api.github.com/repos/goreleaser/goreleaser/issues/4453","repository_url":"https://api.github.com/repos/goreleaser/goreleaser","labels_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/4453/labels{/name}","comments_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/4453/comments","events_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/4453/events","html_url":"https://github.com/goreleaser/goreleaser/issues/4453","id":2018772194,"node_id":"I_kwDOBJgEXs54VATi","number":4453,"title":"Further configuration for GoBinary in builds","user":{"login":"SgtCoDFish","id":1972547,"node_id":"MDQ6VXNlcjE5NzI1NDc=","avatar_url":"https://avatars.githubusercontent.com/u/1972547?v=4","gravatar_id":"","url":"https://api.github.com/users/SgtCoDFish","html_url":"https://github.com/SgtCoDFish","followers_url":"https://api.github.com/users/SgtCoDFish/followers","following_url":"https://api.github.com/users/SgtCoDFish/following{/other_user}","gists_url":"https://api.github.com/users/SgtCoDFish/gists{/gist_id}","starred_url":"https://api.github.com/users/SgtCoDFish/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SgtCoDFish/subscriptions","organizations_url":"https://api.github.com/users/SgtCoDFish/orgs","repos_url":"https://api.github.com/users/SgtCoDFish/repos","events_url":"https://api.github.com/users/SgtCoDFish/events{/privacy}","received_events_url":"https://api.github.com/users/SgtCoDFish/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":504976499,"node_id":"MDU6TGFiZWw1MDQ5NzY0OTk=","url":"https://api.github.com/repos/goreleaser/goreleaser/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":"New feature or request"}],"state":"closed","locked":false,"assignee":{"login":"caarlos0","id":245435,"node_id":"MDQ6VXNlcjI0NTQzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/245435?v=4","gravatar_id":"","url":"https://api.github.com/users/caarlos0","html_url":"https://github.com/caarlos0","followers_url":"https://api.github.com/users/caarlos0/followers","following_url":"https://api.github.com/users/caarlos0/following{/other_user}","gists_url":"https://api.github.com/users/caarlos0/gists{/gist_id}","starred_url":"https://api.github.com/users/caarlos0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caarlos0/subscriptions","organizations_url":"https://api.github.com/users/caarlos0/orgs","repos_url":"https://api.github.com/users/caarlos0/repos","events_url":"https://api.github.com/users/caarlos0/events{/privacy}","received_events_url":"https://api.github.com/users/caarlos0/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"caarlos0","id":245435,"node_id":"MDQ6VXNlcjI0NTQzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/245435?v=4","gravatar_id":"","url":"https://api.github.com/users/caarlos0","html_url":"https://github.com/caarlos0","followers_url":"https://api.github.com/users/caarlos0/followers","following_url":"https://api.github.com/users/caarlos0/following{/other_user}","gists_url":"https://api.github.com/users/caarlos0/gists{/gist_id}","starred_url":"https://api.github.com/users/caarlos0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caarlos0/subscriptions","organizations_url":"https://api.github.com/users/caarlos0/orgs","repos_url":"https://api.github.com/users/caarlos0/repos","events_url":"https://api.github.com/users/caarlos0/events{/privacy}","received_events_url":"https://api.github.com/users/caarlos0/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":1,"created_at":"2023-11-30T14:22:15Z","updated_at":"2024-01-19T13:57:43Z","closed_at":"2023-12-05T02:00:13Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Is your feature request related to a problem? Please describe.\n\nAs a way of minimising the tooling required on developer machines, we like to download a Go tarball locally on a per-project basis and use the untarred binary and GOROOT for all development work in that project. That means for a given project GOROOT is `project/_bin/go-$GOVERSION/go` and the Go binary can be found inside that GOROOT at `project/_bin/go-$GOVERSION/go/bin/go`.\r\n\r\nWe'd like to use the same flags for all builds of our projects, and we want to define those flags in `goreleaser.yaml`\r\n\r\nWe can set the GOROOT for a goreleaser build using environment variables and that works as expected.\r\n\r\nHowever, it seems environment variable expansion doesn't work inside the `goBinary` field and there doesn't appear to be any other way to set this field, so we end up having to hack around the problem.\r\n\r\nOur hack currently is to create a copy of `_bin/go-1.21.4/go/bin/go` to `_bin/go-vendored` which we update whenever our `GO_VERSION` variable changes. That means we have `gobinary: _bin/go-vendored` set in `goreleaser.yaml`, which in turn means that the only way to use goreleaser in this project is through the Makefile.\r\n\r\nIf we were able to set GOROOT and it were to be searched for the `bin/go` path, people would be able to use their system go for development if desired while our CI would still use our vendored go.\n\n### Describe the solution you'd like\n\nWe only need one version of Go per `goreleaser.yaml`, but others might want a different setup. We would be fine with any solution which lets us have more flexibility around customising the `gobinary` field. Some examples:\r\n\r\n- Some global env var we can set when we run goreleaser (e.g. `GORELEASER_GO_BINARY=_bin/go-1.21.4/bin/go GOROOT=_bin/go-1.21.4/go goreleaser build ...`)\r\n- Environment variable expansion inside the `gobinary` field, e.g.:\r\n\r\n   ```yaml\r\n   builds:\r\n   - ...\r\n     gobinary: {{ .Env.GO_BINARY_LOCATION }}\r\n   ```\r\n- (My personal favourite, I think): Some flag which tells goreleaser to look for the go binary in GOROOT rather than defaulting to `go`, e.g.: \r\n\r\n    ```yaml\r\n    goBinaryFromGoRoot: true # there'd probably be a better name\r\n    env:\r\n    - GOROOT=.../project/_bin/go-1.21.4/go # since .../project/_bin/go-1.21.4/go/bin/go exists, we use that\r\n    ```\r\n\r\n    This change might not need a flag, although I suppose it could be breaking for users who set GOROOT today but who for some reason don't have `bin/go` in their GOROOT.\n\n### Describe alternatives you've considered\n\nI can't really see an alternative in our use case but I'd be interested in discussing it!\n\n### Search\n\n- [X] I did search for other open and closed issues before opening this\n\n### Supporter\n\n- [ ] I am a [sponsor](https://github.com/sponsors/caarlos0/) or a [Pro](https://goreleaser.com/pro) customer\n\n### Code of Conduct\n\n- [X] I agree to follow this project's Code of Conduct\n\n### Additional context\n\n_No response_","closed_by":{"login":"caarlos0","id":245435,"node_id":"MDQ6VXNlcjI0NTQzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/245435?v=4","gravatar_id":"","url":"https://api.github.com/users/caarlos0","html_url":"https://github.com/caarlos0","followers_url":"https://api.github.com/users/caarlos0/followers","following_url":"https://api.github.com/users/caarlos0/following{/other_user}","gists_url":"https://api.github.com/users/caarlos0/gists{/gist_id}","starred_url":"https://api.github.com/users/caarlos0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caarlos0/subscriptions","organizations_url":"https://api.github.com/users/caarlos0/orgs","repos_url":"https://api.github.com/users/caarlos0/repos","events_url":"https://api.github.com/users/caarlos0/events{/privacy}","received_events_url":"https://api.github.com/users/caarlos0/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/goreleaser/goreleaser/issues/4453/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/4453/timeline","performed_via_github_app":null,"state_reason":"completed"}