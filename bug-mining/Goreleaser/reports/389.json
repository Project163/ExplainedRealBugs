{"url":"https://api.github.com/repos/goreleaser/goreleaser/issues/5824","repository_url":"https://api.github.com/repos/goreleaser/goreleaser","labels_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/5824/labels{/name}","comments_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/5824/comments","events_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/5824/events","html_url":"https://github.com/goreleaser/goreleaser/issues/5824","id":3136668724,"node_id":"I_kwDOBJgEXs669cQ0","number":5824,"title":"Allow building docker manifests having empty template values","user":{"login":"caarlos0","id":245435,"node_id":"MDQ6VXNlcjI0NTQzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/245435?v=4","gravatar_id":"","url":"https://api.github.com/users/caarlos0","html_url":"https://github.com/caarlos0","followers_url":"https://api.github.com/users/caarlos0/followers","following_url":"https://api.github.com/users/caarlos0/following{/other_user}","gists_url":"https://api.github.com/users/caarlos0/gists{/gist_id}","starred_url":"https://api.github.com/users/caarlos0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caarlos0/subscriptions","organizations_url":"https://api.github.com/users/caarlos0/orgs","repos_url":"https://api.github.com/users/caarlos0/repos","events_url":"https://api.github.com/users/caarlos0/events{/privacy}","received_events_url":"https://api.github.com/users/caarlos0/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":504976499,"node_id":"MDU6TGFiZWw1MDQ5NzY0OTk=","url":"https://api.github.com/repos/goreleaser/goreleaser/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":"New feature or request"},{"id":1980618944,"node_id":"MDU6TGFiZWwxOTgwNjE4OTQ0","url":"https://api.github.com/repos/goreleaser/goreleaser/labels/good-first-issue","name":"good-first-issue","color":"0a8757","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2025-06-11T12:35:12Z","updated_at":"2025-06-12T09:31:59Z","closed_at":"2025-06-12T09:31:59Z","author_association":"MEMBER","type":{"id":5584135,"node_id":"IT_kwDOAXjZGM4AVTUH","name":"Feature","description":"A request, idea, or new functionality","color":"blue","created_at":"2024-01-30T07:57:26Z","updated_at":"2024-10-08T12:12:30Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"\n### Discussed in https://github.com/orgs/goreleaser/discussions/5822\n\n<div type='discussions-op-text'>\n\n<sup>Originally posted by **zerospiel** June 10, 2025</sup>\nHi all,\r\n\r\nI am trying to build a new configuration for my CI, and I'd like to keep everything within a single config file instead of producing boilerplates. Having that said, I am struggling to implement something close to a conditional expression within the `docker_manifests` package section, having the following (simplified/trimmed) `.goreleaser.yaml`:\r\n\r\n```yaml\r\nbuilds:\r\n  - id: amd64\r\n    env:\r\n      - CGO_ENABLED=0\r\n      - GO111MODULE=on\r\n    goos:\r\n      - linux\r\n    goarch:\r\n      - amd64\r\n  - id: arm_and_arm64\r\n    env:\r\n      - CGO_ENABLED=0\r\n      - GO111MODULE=on\r\n    goos:\r\n      - linux\r\n    goarch:\r\n      - arm\r\n      - arm64\r\n    goarm:\r\n      - \"7\"\r\n    builder: go\r\n    # Here is the conditional skip\r\n    skip: >-\r\n      {{ if isEnvSet \"SKIP_ARM\" }}{{ true }}{{ else }}false{{ end }}\r\n\r\ndockers:\r\n  - id: linux-amd64\r\n    goos: linux\r\n    goarch: amd64\r\n    image_templates:\r\n      - \"{{ .Env.REGISTRY }}/{{ .Env.IMAGE_NAME }}:{{ .Version }}-amd64\"\r\n    skip_push: false\r\n    dockerfile: \"goreleaser.dockerfile\"\r\n    use: buildx\r\n    ids:\r\n      - amd64\r\n    build_flag_templates:\r\n      - --platform=linux/amd64\r\n  - id: linux-arm64\r\n    goos: linux\r\n    goarch: arm64\r\n    image_templates:\r\n      - \"{{ .Env.REGISTRY }}/{{ .Env.IMAGE_NAME }}:{{ .Version }}-arm64v8\"\r\n    skip_push: false\r\n    dockerfile: \"goreleaser.dockerfile\"\r\n    use: buildx\r\n    ids:\r\n      - arm_and_arm64\r\n    build_flag_templates:\r\n      - --platform=linux/arm64/v8\r\n\r\ndocker_manifests:\r\n  - name_template: '{{ .Env.REGISTRY }}/{{ .Env.IMAGE_NAME }}:{{ .Version }}'\r\n    image_templates:\r\n      - '{{ .Env.REGISTRY }}/{{ .Env.IMAGE_NAME }}:{{ .Version }}-amd64'\r\n      # Here is my attempt to skip these images from being added to the manifest\r\n      - >- \r\n        {{ if isEnvSet \"SKIP_ARM\" }}{{\"\"}}{{ else }}{{ .Env.REGISTRY }}/{{ .Env.IMAGE_NAME }}:{{ .Version }}-arm64v8{{ end }}\r\n      - >- \r\n        {{ if isEnvSet \"SKIP_ARM\" }}{{\"\"}}{{ else }}{{ .Env.REGISTRY }}/{{ .Env.IMAGE_NAME }}:{{ .Version }}-armv7{{ end }}\r\n    skip_push: false\r\n    use: docker\r\n```\r\n\r\nSo, here at the last lines, I have a list with `if`s, what I want to achieve is to skip creating a manifest from non-existent digests (because the images from `dockers` will be skipped due to set `ids` section, which is done on purpose), but unfortunately, the current implementation [does not skip empty image names](https://github.com/goreleaser/goreleaser/blob/3e58f11fdaadeaac2061fb3296105a71e1efa3a0/internal/pipe/docker/manifest.go#L146) after evaluating a template name.\r\n\r\nHence, my question is: am I doing it wrong, or is it worth adding an extra `if` statement to the line of code mentioned above?\r\n\r\nWould appreciate any tips!</div>","closed_by":{"login":"caarlos0","id":245435,"node_id":"MDQ6VXNlcjI0NTQzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/245435?v=4","gravatar_id":"","url":"https://api.github.com/users/caarlos0","html_url":"https://github.com/caarlos0","followers_url":"https://api.github.com/users/caarlos0/followers","following_url":"https://api.github.com/users/caarlos0/following{/other_user}","gists_url":"https://api.github.com/users/caarlos0/gists{/gist_id}","starred_url":"https://api.github.com/users/caarlos0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caarlos0/subscriptions","organizations_url":"https://api.github.com/users/caarlos0/orgs","repos_url":"https://api.github.com/users/caarlos0/repos","events_url":"https://api.github.com/users/caarlos0/events{/privacy}","received_events_url":"https://api.github.com/users/caarlos0/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/goreleaser/goreleaser/issues/5824/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/5824/timeline","performed_via_github_app":null,"state_reason":"completed"}