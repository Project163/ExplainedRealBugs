{"url":"https://api.github.com/repos/goreleaser/goreleaser/issues/1980","repository_url":"https://api.github.com/repos/goreleaser/goreleaser","labels_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/1980/labels{/name}","comments_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/1980/comments","events_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/1980/events","html_url":"https://github.com/goreleaser/goreleaser/issues/1980","id":776144320,"node_id":"MDU6SXNzdWU3NzYxNDQzMjA=","number":1980,"title":"Missing extra files in deb/rpm packages.","user":{"login":"jwhitcraft","id":26738,"node_id":"MDQ6VXNlcjI2NzM4","avatar_url":"https://avatars.githubusercontent.com/u/26738?v=4","gravatar_id":"","url":"https://api.github.com/users/jwhitcraft","html_url":"https://github.com/jwhitcraft","followers_url":"https://api.github.com/users/jwhitcraft/followers","following_url":"https://api.github.com/users/jwhitcraft/following{/other_user}","gists_url":"https://api.github.com/users/jwhitcraft/gists{/gist_id}","starred_url":"https://api.github.com/users/jwhitcraft/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jwhitcraft/subscriptions","organizations_url":"https://api.github.com/users/jwhitcraft/orgs","repos_url":"https://api.github.com/users/jwhitcraft/repos","events_url":"https://api.github.com/users/jwhitcraft/events{/privacy}","received_events_url":"https://api.github.com/users/jwhitcraft/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":504976497,"node_id":"MDU6TGFiZWw1MDQ5NzY0OTc=","url":"https://api.github.com/repos/goreleaser/goreleaser/labels/bug","name":"bug","color":"ee0701","default":true,"description":"Something isn't working"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2020-12-30T00:32:02Z","updated_at":"2021-01-29T13:25:45Z","closed_at":"2020-12-30T12:23:22Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Describe the bug**\r\n\r\nWhen building a new rpm or deb package with extra files defined in the config, the files are not placed in the package.\r\n\r\n**To Reproduce**\r\n\r\nSteps to reproduce the behavior:\r\n\r\n```yaml\r\nproject_name: my-login-metrics\r\n\r\nrelease:\r\n  prerelease: auto\r\n\r\nbefore:\r\n  hooks:\r\n    - go mod tidy\r\n\r\nbuilds:\r\n  -\r\n    id: my-login-metrics\r\n    goos:\r\n      - linux\r\n    goarch:\r\n      - amd64\r\n\r\nblobs:\r\n  - provider: s3\r\n    bucket: my-packages\r\n    folder: \"{{ .ProjectName }}/{{.Tag}}\"\r\n\r\nnfpms:\r\n  -\r\n    # ID of the nfpm config, must be unique.\r\n    # Defaults to \"default\".\r\n    id: my-login-metrics\r\n\r\n    # Name of the package.\r\n    # Defaults to `ProjectName`.\r\n    package_name: my-login-metrics\r\n\r\n    # You can change the file name of the package.\r\n    # Default: `{{ .ProjectName }}_{{ .Version }}_{{ .Os }}_{{ .Arch }}{{ if .Arm }}v{{ .Arm }}{{ end }}{{ if .Mips }}_{{ .Mips }}{{ end }}`\r\n    file_name_template: \"{{ .ProjectName }}_{{ .Version }}_{{ .Os }}_{{ .Arch }}\"\r\n\r\n    # Build IDs for the builds you want to create NFPM packages for.\r\n    # Defaults to all builds.\r\n    builds:\r\n      - my-login-metrics\r\n\r\n    # Replacements for GOOS and GOARCH in the package name.\r\n    # Keys should be valid GOOSs or GOARCHs.\r\n    # Values are the respective replacements.\r\n    # Default is empty.\r\n    replacements:\r\n      amd64: x64\r\n\r\n    # Your app's description.\r\n    # Default is empty.\r\n    description: Scrape Metrics from the Login Attempts Database\r\n\r\n    # Formats to be generated.\r\n    formats:\r\n      - deb\r\n      - rpm\r\n\r\n    scripts:\r\n      postinstall: \"scripts/postinstall.sh\"\r\n\r\n    contents:\r\n      - src: ./my-login-metrics.service\r\n        dst: /etc/systemd/system/my-login-metrics.service\r\n        type: config\r\n\r\n    # Package release.\r\n    # Defaults to empty.\r\n    release: 1\r\n\r\n```\r\n\r\n> Make sure your config file is valid by running\r\n> `goreleaser check -f path-to-config-file`.\r\n\r\n**Expected behavior**\r\n\r\nA clear and concise description of what you expected to happen.\r\n\r\nWhen the deb and/or the rpm files are created, they only contain the go binary, not the, postinstall.sh script or the .service file\r\n\r\n\r\ndeb package contents:\r\n```sh\r\ndpkg -c dist/my-login-metrics_v0.0.6-SNAPSHOT-2b0cc04_linux_x64.deb\r\ndrwxr-xr-x 0/0               0 2020-12-29 19:20 ./usr/\r\ndrwxr-xr-x 0/0               0 2020-12-29 19:20 ./usr/local/\r\ndrwxr-xr-x 0/0               0 2020-12-29 19:20 ./usr/local/bin/\r\n-rwxr-xr-x 0/0        11931648 2020-12-29 19:20 ./usr/local/bin/my-login-metrics\r\n```\r\n\r\nrpm package contents:\r\n```sh\r\nrpm -qlp dist/my-login-metrics_v0.0.6-SNAPSHOT-2b0cc04_linux_x64.rpm\r\n/usr/local/bin/my-login-metrics\r\n```\r\n\r\n\r\n**Environment (please complete the following information):**\r\n\r\n- OS: linux\r\n- OS version: Linux <ec2 hostname> 5.4.0-1029-aws #30~18.04.1-Ubuntu SMP Tue Oct 20 11:09:25 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux\r\n- GoReleaser Version `goreleaser version 0.150.0`\r\n- GitLab version (if using a private hosted one)\r\n\r\n**Additional context**\r\nAdd any other context about the problem here. Full output log with debug on\r\nis probably a helpful thing to add here.\r\n\r\n<details>\r\n<summary>Debug Output</summary>\r\n\r\n   • debug logs enabled\r\n   • releasing...\r\n   • loading config file       file=.goreleaser.yml\r\n   • loaded config file        config={my-login-metrics [] {   false false auto  [] []} [] [] { {  } { }      []  [] []} [{my-login-metrics [linux] [amd64] [] [] [] []   [] []  {[] []} []  [] []  false }] [] [{{{{ .ProjectName }}_{{ .Version }}_{{ .Os }}_{{ .Arch }} my-login-metrics  1   map[amd64:x64] [] [] [] [] [] [] [0xc00019c140] map[] map[] map[] { scripts/postinstall.sh  } {   map[] [] { }} {{ } {[] [] [] [] [] []} []  {  }} {{  }}} map[] my-login-metrics [my-login-metrics] [deb rpm]  Scrape Metrics from the Login Attpemts Database   false}] [] {} {  [] false} [] [] [] [] [{my-packages s3  false {{ .ProjectName }}/{{.Tag}}  []  []}] [] {{[]}  false}  [] {  } {[go mod tidy]} {  false} { [] [] [] [] [] []   [] []  {[] []} []  [] []  false } {   false} {  false} {  false}}\r\n   • parallelism: 4\r\n   • loading environment variables\r\n      • token type: github\r\n   • getting and validating git state\r\n      • running git               args=[-c log.showSignature=false rev-parse --is-inside-work-tree]\r\n      • git result                stderr= stdout=true\r\n\r\n      • running git               args=[-c log.showSignature=false rev-parse --is-inside-work-tree]\r\n      • git result                stderr= stdout=true\r\n\r\n      • running git               args=[-c log.showSignature=false rev-parse --abbrev-ref HEAD --quiet]\r\n      • git result                stderr= stdout=master\r\n\r\n      • running git               args=[-c log.showSignature=false show --format='%h' HEAD --quiet]\r\n      • git result                stderr= stdout='2b0cc04'\r\n\r\n      • running git               args=[-c log.showSignature=false show --format='%H' HEAD --quiet]\r\n      • git result                stderr= stdout='2b0cc04be39f232b52a4d8240a7a95d20d26d968'\r\n\r\n      • running git               args=[-c log.showSignature=false show --format='%ct' HEAD --quiet]\r\n      • git result                stderr= stdout='1609270872'\r\n\r\n      • running git               args=[-c log.showSignature=false ls-remote --get-url]\r\n      • git result                stderr= stdout=<git repo here>\r\n\r\n      • running git               args=[-c log.showSignature=false tag --points-at HEAD --sort -version:creatordate]\r\n      • git result                stderr= stdout=v0.0.6\r\n\r\n      • releasing v0.0.6, commit 2b0cc04be39f232b52a4d8240a7a95d20d26d968\r\n      • pipe skipped              error=disabled during snapshot mode\r\n   • parsing tag\r\n   • running before hooks\r\n      • running go mod tidy\r\n      •                           cmd=go mod tidy\r\n   • setting defaults\r\n      • snapshotting\r\n      • github/gitlab/gitea releases\r\n         • running git               args=[-c log.showSignature=false rev-parse --is-inside-work-tree]\r\n         • git result                stderr= stdout=true\r\n\r\n         • running git               args=[-c log.showSignature=false config --get remote.origin.url]\r\n         • git result                stderr= stdout=<git repo here>\r\n\r\n         • pre-release was detected for tag v0.0.6: false\r\n         • pre-release for tag v0.0.6 set to false\r\n      • project name\r\n      • building binaries\r\n      • creating source archive\r\n      • archives\r\n      • linux packages\r\n      • snapcraft packages\r\n      • calculating checksums\r\n      • signing artifacts\r\n      • docker images\r\n      • artifactory\r\n      • blobs\r\n      • homebrew tap formula\r\n      • scoop manifests\r\n      • milestones\r\n         • running git               args=[-c log.showSignature=false rev-parse --is-inside-work-tree]\r\n         • git result                stderr= stdout=true\r\n\r\n         • running git               args=[-c log.showSignature=false config --get remote.origin.url]\r\n         • git result                stderr= stdout=<git repo here>\r\n\r\n   • snapshotting\r\n   • checking ./dist\r\n      • --rm-dist is set, cleaning it up\r\n   • writing effective config file\r\n      • writing                   config=dist/config.yaml\r\n   • generating changelog\r\n      • pipe skipped              error=not available for snapshots\r\n   • building binaries\r\n      • building                  build={my-login-metrics [linux] [amd64] [6] [] [linux_amd64] [] . . [-s -w -X main.version={{.Version}} -X main.commit={{.Commit}} -X main.date={{.Date}} -X main.builtBy=goreleaser] [] my-login-metrics {[] []} [] go [] []  false go}\r\n      • building                  binary=/Users/jwhitcraft/Projects/go-my-login-metrics/dist/my-login-metrics_linux_amd64/my-login-metrics\r\n      • running                   cmd=[go build -ldflags=-s -w -X main.version=v0.0.6-SNAPSHOT-2b0cc04 -X main.commit=2b0cc04be39f232b52a4d8240a7a95d20d26d968 -X main.date=2020-12-30T00:29:18Z -X main.builtBy=goreleaser -o /Users/jwhitcraft/Projects/go-my-login-metrics/dist/my-login-metrics_linux_amd64/my-login-metrics .] env=[TERM_SESSION_ID=w0t1p0:A3AA3127-A8CF-45F0-AE50-FCC9FA9A5C79 LANG=en_US.UTF-8 TERM=xterm-256color LaunchInstanceID=EB8EF4A8-1FAF-4101-967E-75B772DA9D04 LESS=-R RBENV_SHELL=zsh SSH_AUTH_SOCK=/private/tmp/com.apple.launchd.6854s3DRM1/Listeners P9K_SSH=0 NVM_DIR=/Users/jwhitcraft/.nvm ITERM_PROFILE=Default __CFBundleIdentifier=com.googlecode.iterm2 LSCOLORS=Gxfxcxdxbxegedabagacad GITHUB_TOKEN=99dc1f512542a991e218d42d4da7f5bdcb1da154 PWD=/Users/jwhitcraft/Projects/go-my-login-metrics SHELL=/usr/local/bin/zsh OLDPWD=/Users/jwhitcraft COLORFGBG=15;0 TERM_PROGRAM_VERSION=3.4.3beta1 TMPDIR=/var/folders/7_/czhqzt9n62j1vw_1nbr_h39c0000gn/T/ XPC_SERVICE_NAME=0 ASDF_DIR=/usr/local/opt/asdf GOPATH=/Users/jwhitcraft/GoProjects OBJC_DISABLE_INITIALIZE_FORK_SAFETY=YES P9K_TTY=old LC_TERMINAL_VERSION=3.4.3beta1 SECURITYSESSIONID=18850 COLORTERM=truecolor __CF_USER_TEXT_ENCODING=0x1F5:0x0:0x0 LS_COLORS=rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=00:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc=01;31:*.arj=01;31:*.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.tzo=01;31:*.t7z=01;31:*.zip=01;31:*.z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:*.zst=01;31:*.tzst=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.cab=01;31:*.wim=01;31:*.swm=01;31:*.dwm=01;31:*.esd=01;31:*.jpg=01;35:*.jpeg=01;35:*.mjpg=01;35:*.mjpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.webp=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=00;36:*.au=00;36:*.flac=00;36:*.m4a=00;36:*.mid=00;36:*.midi=00;36:*.mka=00;36:*.mp3=00;36:*.mpc=00;36:*.ogg=00;36:*.ra=00;36:*.wav=00;36:*.oga=00;36:*.opus=00;36:*.spx=00;36:*.xspf=00;36: MANPAGER=sh -c 'col -bx | bat -l man -p' _=/usr/local/bin/goreleaser TERM_PROGRAM=iTerm.app LC_TERMINAL=iTerm2 ITERM_SESSION_ID=w0t1p0:A3AA3127-A8CF-45F0-AE50-FCC9FA9A5C79 XDG_CONFIG_DIRS=/Users/jwhitcraft/.config SHLVL=1 ZSH=/Users/jwhitcraft/.oh-my-zsh XPC_FLAGS=0x0 PATH=/Users/jwhitcraft/.krew/bin:/Users/jwhitcraft/Library/Python/3.7/bin:/Users/jwhitcraft/GoProjects/bin:/usr/local/sbin:/usr/local/opt/coreutils/libexec/gnubin:/Users/jwhitcraft/bin:/usr/local/bin:/Users/jwhitcraft/.yarn/bin:/Users/jwhitcraft/.rbenv/shims:/Users/jwhitcraft/.asdf/shims:/usr/local/opt/asdf/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/MacGPG2/bin:/usr/local/opt/fzf/bin COMMAND_MODE=unix2003 HOME=/Users/jwhitcraft USER=jwhitcraft LOGNAME=jwhitcraft PAGER=less _P9K_TTY=/dev/ttys001 GOOS=linux GOARCH=amd64 GOARM= GOMIPS= GOMIPS64=]\r\n      • added new artifact        name=my-login-metrics path=/Users/jwhitcraft/Projects/go-my-login-metrics/dist/my-login-metrics_linux_amd64/my-login-metrics type=Binary\r\n   • archives\r\n      • group linuxamd64 has 1 binaries\r\n      • creating                  archive=dist/my-login-metrics_v0.0.6-SNAPSHOT-2b0cc04_linux_amd64.tar.gz\r\n      • adding file: /Users/jwhitcraft/Projects/go-my-login-metrics/dist/my-login-metrics_linux_amd64/my-login-metrics as my-login-metrics\r\n      • added new artifact        name=my-login-metrics_v0.0.6-SNAPSHOT-2b0cc04_linux_amd64.tar.gz path=dist/my-login-metrics_v0.0.6-SNAPSHOT-2b0cc04_linux_amd64.tar.gz type=Archive\r\n   • creating source archive\r\n      • pipe skipped              error=source pipe is disabled\r\n   • linux packages\r\n      • adding binary to package  arch=amd64 dst=/usr/local/bin/my-login-metrics package=my-login-metrics_v0.0.6-SNAPSHOT-2b0cc04_linux_x64.deb src=/Users/jwhitcraft/Projects/go-my-login-metrics/dist/my-login-metrics_linux_amd64/my-login-metrics\r\n      • all archive files         files=[0xc000108050]\r\n      • adding binary to package  arch=amd64 dst=/usr/local/bin/my-login-metrics package=my-login-metrics_v0.0.6-SNAPSHOT-2b0cc04_linux_x64.rpm src=/Users/jwhitcraft/Projects/go-my-login-metrics/dist/my-login-metrics_linux_amd64/my-login-metrics\r\n      • all archive files         files=[0xc0002fa000]\r\n      • creating                  file=dist/my-login-metrics_v0.0.6-SNAPSHOT-2b0cc04_linux_x64.deb\r\n      • creating                  file=dist/my-login-metrics_v0.0.6-SNAPSHOT-2b0cc04_linux_x64.rpm\r\n      • added new artifact        name=my-login-metrics_v0.0.6-SNAPSHOT-2b0cc04_linux_x64.deb path=dist/my-login-metrics_v0.0.6-SNAPSHOT-2b0cc04_linux_x64.deb type=Linux Package\r\n      • added new artifact        name=my-login-metrics_v0.0.6-SNAPSHOT-2b0cc04_linux_x64.rpm path=dist/my-login-metrics_v0.0.6-SNAPSHOT-2b0cc04_linux_x64.rpm type=Linux Package\r\n   • snapcraft packages\r\n   • calculating checksums\r\n      • checksumming              file=my-login-metrics_v0.0.6-SNAPSHOT-2b0cc04_linux_x64.rpm\r\n      • checksumming              file=my-login-metrics_v0.0.6-SNAPSHOT-2b0cc04_linux_x64.deb\r\n      • calculating checksum for dist/my-login-metrics_v0.0.6-SNAPSHOT-2b0cc04_linux_x64.deb\r\n      • calculating checksum for dist/my-login-metrics_v0.0.6-SNAPSHOT-2b0cc04_linux_x64.rpm\r\n      • checksumming              file=my-login-metrics_v0.0.6-SNAPSHOT-2b0cc04_linux_amd64.tar.gz\r\n      • calculating checksum for dist/my-login-metrics_v0.0.6-SNAPSHOT-2b0cc04_linux_amd64.tar.gz\r\n      • added new artifact        name=my-login-metrics_v0.0.6-SNAPSHOT-2b0cc04_checksums.txt path=dist/my-login-metrics_v0.0.6-SNAPSHOT-2b0cc04_checksums.txt type=Checksum\r\n   • signing artifacts\r\n   • docker images\r\n      • pipe skipped              error=docker section is not configured\r\n   • publishing\r\n      • blobs\r\n         • upload skipped because skip-publish is set path=my-login-metrics/v0.0.6/my-login-metrics_v0.0.6-SNAPSHOT-2b0cc04_checksums.txt\r\n         • upload skipped because skip-publish is set path=my-login-metrics/v0.0.6/my-login-metrics_v0.0.6-SNAPSHOT-2b0cc04_linux_x64.rpm\r\n         • upload skipped because skip-publish is set path=my-login-metrics/v0.0.6/my-login-metrics_v0.0.6-SNAPSHOT-2b0cc04_linux_amd64.tar.gz\r\n         • upload skipped because skip-publish is set path=my-login-metrics/v0.0.6/my-login-metrics_v0.0.6-SNAPSHOT-2b0cc04_linux_x64.deb\r\n      • http upload\r\n         • pipe skipped              error=uploads section is not configured\r\n      • custom publisher\r\n         • pipe skipped              error=publishers section is not configured\r\n      • artifactory\r\n         • pipe skipped              error=artifactory section is not configured\r\n      • docker images\r\n         • pipe skipped              error=publishing is disabled\r\n      • docker manifests\r\n         • pipe skipped              error=publishing is disabled\r\n      • snapcraft packages\r\n         • pipe skipped              error=publishing is disabled\r\n      • github/gitlab/gitea releases\r\n         • pipe skipped              error=publishing is disabled\r\n      • homebrew tap formula\r\n         • token type                type=github\r\n      • scoop manifests\r\n         • pipe skipped              error=publishing is disabled\r\n      • milestones\r\n         • pipe skipped              error=publishing is disabled\r\n   • release succeeded after 5.76s\r\n\r\n</details>\r\n","closed_by":{"login":"caarlos0","id":245435,"node_id":"MDQ6VXNlcjI0NTQzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/245435?v=4","gravatar_id":"","url":"https://api.github.com/users/caarlos0","html_url":"https://github.com/caarlos0","followers_url":"https://api.github.com/users/caarlos0/followers","following_url":"https://api.github.com/users/caarlos0/following{/other_user}","gists_url":"https://api.github.com/users/caarlos0/gists{/gist_id}","starred_url":"https://api.github.com/users/caarlos0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caarlos0/subscriptions","organizations_url":"https://api.github.com/users/caarlos0/orgs","repos_url":"https://api.github.com/users/caarlos0/repos","events_url":"https://api.github.com/users/caarlos0/events{/privacy}","received_events_url":"https://api.github.com/users/caarlos0/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/goreleaser/goreleaser/issues/1980/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/1980/timeline","performed_via_github_app":null,"state_reason":"completed"}