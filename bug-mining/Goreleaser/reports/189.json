{"url":"https://api.github.com/repos/goreleaser/goreleaser/issues/3383","repository_url":"https://api.github.com/repos/goreleaser/goreleaser","labels_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/3383/labels{/name}","comments_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/3383/comments","events_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/3383/events","html_url":"https://github.com/goreleaser/goreleaser/issues/3383","id":1376164771,"node_id":"I_kwDOBJgEXs5SBpuj","number":3383,"title":"invalid archive error when using goreleaser-pro","user":{"login":"ryancurrah","id":6209771,"node_id":"MDQ6VXNlcjYyMDk3NzE=","avatar_url":"https://avatars.githubusercontent.com/u/6209771?v=4","gravatar_id":"","url":"https://api.github.com/users/ryancurrah","html_url":"https://github.com/ryancurrah","followers_url":"https://api.github.com/users/ryancurrah/followers","following_url":"https://api.github.com/users/ryancurrah/following{/other_user}","gists_url":"https://api.github.com/users/ryancurrah/gists{/gist_id}","starred_url":"https://api.github.com/users/ryancurrah/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ryancurrah/subscriptions","organizations_url":"https://api.github.com/users/ryancurrah/orgs","repos_url":"https://api.github.com/users/ryancurrah/repos","events_url":"https://api.github.com/users/ryancurrah/events{/privacy}","received_events_url":"https://api.github.com/users/ryancurrah/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":504976497,"node_id":"MDU6TGFiZWw1MDQ5NzY0OTc=","url":"https://api.github.com/repos/goreleaser/goreleaser/labels/bug","name":"bug","color":"ee0701","default":true,"description":"Something isn't working"}],"state":"closed","locked":true,"assignee":{"login":"caarlos0","id":245435,"node_id":"MDQ6VXNlcjI0NTQzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/245435?v=4","gravatar_id":"","url":"https://api.github.com/users/caarlos0","html_url":"https://github.com/caarlos0","followers_url":"https://api.github.com/users/caarlos0/followers","following_url":"https://api.github.com/users/caarlos0/following{/other_user}","gists_url":"https://api.github.com/users/caarlos0/gists{/gist_id}","starred_url":"https://api.github.com/users/caarlos0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caarlos0/subscriptions","organizations_url":"https://api.github.com/users/caarlos0/orgs","repos_url":"https://api.github.com/users/caarlos0/repos","events_url":"https://api.github.com/users/caarlos0/events{/privacy}","received_events_url":"https://api.github.com/users/caarlos0/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"caarlos0","id":245435,"node_id":"MDQ6VXNlcjI0NTQzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/245435?v=4","gravatar_id":"","url":"https://api.github.com/users/caarlos0","html_url":"https://github.com/caarlos0","followers_url":"https://api.github.com/users/caarlos0/followers","following_url":"https://api.github.com/users/caarlos0/following{/other_user}","gists_url":"https://api.github.com/users/caarlos0/gists{/gist_id}","starred_url":"https://api.github.com/users/caarlos0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caarlos0/subscriptions","organizations_url":"https://api.github.com/users/caarlos0/orgs","repos_url":"https://api.github.com/users/caarlos0/repos","events_url":"https://api.github.com/users/caarlos0/events{/privacy}","received_events_url":"https://api.github.com/users/caarlos0/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":5,"created_at":"2022-09-16T16:25:22Z","updated_at":"2022-12-05T13:23:18Z","closed_at":"2022-09-17T02:47:07Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### What happened?\r\n\r\nWhen using goreleaser-pro's `includes` feature and generating multiple binaries and a single archive we get an error.\r\n\r\n```\r\n╰─ goreleaser release --skip-publish --rm-dist\r\n  • by using this software you agree with its EULA, available at https://goreleaser.com/eula\r\n  • running goreleaser v1.11.3-pro (outdated, latest is v1.11.2-pro)\r\n  • starting release...\r\n  • loading config file                              file=.goreleaser.yaml\r\n  • importing .goreleaser.common.yml\r\n  • loading environment variables\r\n  • getting and validating git state\r\n    • couldn't find any tags before \"v0.1.1\"\r\n    • building...                                    commit=e1282a48bb70ae920118492137d979f0a18317e7 latest tag=v0.1.1\r\n  • parsing tag\r\n  • setting defaults\r\n  • checking distribution directory\r\n    • --rm-dist is set, cleaning it up\r\n  • loading go mod information\r\n  • build prerequisites\r\n  • writing effective config file\r\n    • writing                                        config=dist/config.yaml\r\n  • generating changelog\r\n    • writing                                        changelog=dist/CHANGELOG.md\r\n  • building binaries\r\n    • building                                       binary=dist/cli_darwin_amd64_v1/helloworld\r\n    • building                                       binary=dist/worker_linux_amd64_v1/helloworld\r\n    • building                                       binary=dist/api_linux_amd64_v1/helloworld\r\n    • took: 5s\r\n  • archives\r\n  ⨯ release failed after 5s                  error=invalid archive: 1: archive has different count of built binaries for each platform, which may cause your users confusion. Please make sure all builds used have the same set of goos/goarch/etc or split it into multiple archives\r\n```\r\n\r\nThe error is `invalid archive: 1: archive has different count of built binaries for each platform, which may cause your users confusion. Please make sure all builds used have the same set of goos/goarch/etc or split it into multiple archives`.\r\n\r\nAt our company we use a common `.goreleaser.common.yml` file across all modules with sane defaults for us. One of those common configs is to not generate any archives (we do not need them generally and creating archives increases the build times due to time spent compressing the binaries).\r\n\r\nYou can see how we configure that here in my replication of the issue: https://github.com/ryancurrah/goreleaser-pro-bug/blob/main/.goreleaser.common.yml.\r\n\r\nUsing that common config and then creating an archive in the `.goreleaser.yml` for a CLI we get the above error. Example `.goreleaser.yml` here: https://github.com/ryancurrah/goreleaser-pro-bug/blob/main/.goreleaser.yaml.\r\n\r\nImportant note it is only when there is more than two builds this error occurs. If you comment out the `api` build in my example we will not run in to the error.\r\n\r\n### How can we reproduce this?\r\n\r\nI have created simple replication of the issue in a git repository located here: https://github.com/ryancurrah/goreleaser-pro-bug.\r\n\r\nRun the following commands to reproduce the error.\r\n\r\n```\r\nexport GORELEASER_KEY=\"<YOUR_PRO_KEY_HERE>\"\r\ngit clone https://github.com/ryancurrah/goreleaser-pro-bug.git\r\ncd goreleaser-pro-bug\r\ngoreleaser release --skip-publish --rm-dist\r\n```\r\n\r\n\r\n### goreleaser version\r\n\r\n```bash\r\nv1.11.3-pro\r\n```\r\n\r\n\r\n### GoReleaser Check\r\n\r\n- [X] goreleaser check shows no errors\r\n\r\n### Search\r\n\r\n- [X] I did search for other open and closed issues before opening this.\r\n\r\n### Code of Conduct\r\n\r\n- [X] I agree to follow this project's Code of Conduct\r\n\r\n### Additional context\r\n\r\nThis has been an issue for a while I just haven't had the time to report it. So it's not something new that broke.","closed_by":{"login":"caarlos0","id":245435,"node_id":"MDQ6VXNlcjI0NTQzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/245435?v=4","gravatar_id":"","url":"https://api.github.com/users/caarlos0","html_url":"https://github.com/caarlos0","followers_url":"https://api.github.com/users/caarlos0/followers","following_url":"https://api.github.com/users/caarlos0/following{/other_user}","gists_url":"https://api.github.com/users/caarlos0/gists{/gist_id}","starred_url":"https://api.github.com/users/caarlos0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caarlos0/subscriptions","organizations_url":"https://api.github.com/users/caarlos0/orgs","repos_url":"https://api.github.com/users/caarlos0/repos","events_url":"https://api.github.com/users/caarlos0/events{/privacy}","received_events_url":"https://api.github.com/users/caarlos0/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/goreleaser/goreleaser/issues/3383/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/3383/timeline","performed_via_github_app":null,"state_reason":"completed"}