{"url":"https://api.github.com/repos/goreleaser/goreleaser/issues/1229","repository_url":"https://api.github.com/repos/goreleaser/goreleaser","labels_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/1229/labels{/name}","comments_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/1229/comments","events_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/1229/events","html_url":"https://github.com/goreleaser/goreleaser/issues/1229","id":517500409,"node_id":"MDU6SXNzdWU1MTc1MDA0MDk=","number":1229,"title":"packagecloud.io http 500 error on RPMs built with v0.120.x","user":{"login":"joemiller","id":377603,"node_id":"MDQ6VXNlcjM3NzYwMw==","avatar_url":"https://avatars.githubusercontent.com/u/377603?v=4","gravatar_id":"","url":"https://api.github.com/users/joemiller","html_url":"https://github.com/joemiller","followers_url":"https://api.github.com/users/joemiller/followers","following_url":"https://api.github.com/users/joemiller/following{/other_user}","gists_url":"https://api.github.com/users/joemiller/gists{/gist_id}","starred_url":"https://api.github.com/users/joemiller/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joemiller/subscriptions","organizations_url":"https://api.github.com/users/joemiller/orgs","repos_url":"https://api.github.com/users/joemiller/repos","events_url":"https://api.github.com/users/joemiller/events{/privacy}","received_events_url":"https://api.github.com/users/joemiller/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":504976497,"node_id":"MDU6TGFiZWw1MDQ5NzY0OTc=","url":"https://api.github.com/repos/goreleaser/goreleaser/labels/bug","name":"bug","color":"ee0701","default":true,"description":"Something isn't working"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":28,"created_at":"2019-11-05T01:40:38Z","updated_at":"2020-11-18T21:10:46Z","closed_at":"2019-11-06T15:11:57Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Describe the bug**\r\n\r\nSince the new RPM code in nfpm and goreleaser 0.120.x was introduced it is no longer possible to push RPMs to packagecloud.io.\r\n\r\nPackagecloud support response:\r\n\r\n> This package is missing a lot of required RPM headers that *must* appear in the YUM metadata so that YUM can find this package and install it from a repository.\r\n>\r\n> I would suggest that the maintainer of this package spend some time reviewing the RPM documentation and/or requesting the tool they use for generating the RPM automatically all required RPM headers. There's lots of possible malformed RPM packages that will make our system 500; we catch a lot of the cases, but we do miss a few and will still 500 in some rare, isolated cases (like this package, which is significantly malformed).\r\n\r\n**To Reproduce**\r\n\r\nSteps to reproduce the behavior:\r\n\r\nIt should be possible to reproduce this bug locally from the https://github.com/pantheon-systems/pauditd project:\r\n\r\n```console\r\ngit clone git@github.com:pantheon-systems/pauditd.git\r\ncd pauditd\r\n\r\ncurl -sL https://git.io/goreleaser | bash -s -- --snapshot --rm-dist\r\n```\r\n\r\npush to an existing packagecloud.io repo:\r\n\r\n```console\r\n$ package_cloud push xxx/xxx/el/8 dist/*rpm\r\n\r\nLooking for repository at xxx/xxx... success!\r\nPushing dist/pauditd-v1.1.11-next-1572710235-x86_64.rpm... Traceback (most recent call last):\r\n        23: from /usr/local/bin/package_cloud:22:in `<main>'\r\n        22: from /usr/local/bin/package_cloud:22:in `load'\r\n        21: from /usr/local/lib/ruby/gems/2.6.0/gems/package_cloud-0.3.05/bin/package_cloud:4:in `<top (required)>'\r\n        20: from /usr/local/lib/ruby/gems/2.6.0/gems/thor-0.20.3/lib/thor/base.rb:466:in `start'\r\n        19: from /usr/local/lib/ruby/gems/2.6.0/gems/thor-0.20.3/lib/thor.rb:387:in `dispatch'\r\n        18: from /usr/local/lib/ruby/gems/2.6.0/gems/thor-0.20.3/lib/thor/invocation.rb:126:in `invoke_command'\r\n        17: from /usr/local/lib/ruby/gems/2.6.0/gems/thor-0.20.3/lib/thor/command.rb:27:in `run'\r\n        16: from /usr/local/lib/ruby/gems/2.6.0/gems/package_cloud-0.3.05/lib/package_cloud/cli/entry.rb:108:in `push'\r\n        15: from /usr/local/Cellar/ruby/2.6.5/lib/ruby/2.6.0/benchmark.rb:293:in `measure'\r\n        14: from /usr/local/lib/ruby/gems/2.6.0/gems/package_cloud-0.3.05/lib/package_cloud/cli/entry.rb:168:in `block in push'\r\n        13: from /usr/local/lib/ruby/gems/2.6.0/gems/package_cloud-0.3.05/lib/package_cloud/cli/entry.rb:168:in `each'\r\n        12: from /usr/local/lib/ruby/gems/2.6.0/gems/package_cloud-0.3.05/lib/package_cloud/cli/entry.rb:178:in `block (2 levels) in push'\r\n        11: from /usr/local/Cellar/ruby/2.6.5/lib/ruby/2.6.0/benchmark.rb:293:in `measure'\r\n        10: from /usr/local/lib/ruby/gems/2.6.0/gems/package_cloud-0.3.05/lib/package_cloud/cli/entry.rb:182:in `block (3 levels) in push'\r\n         9: from /usr/local/lib/ruby/gems/2.6.0/gems/package_cloud-0.3.05/lib/package_cloud/cli/entry.rb:242:in `create_package'\r\n         8: from /usr/local/lib/ruby/gems/2.6.0/gems/package_cloud-0.3.05/lib/package_cloud/repository.rb:52:in `create_package'\r\n         7: from /usr/local/lib/ruby/gems/2.6.0/gems/rest-client-2.0.2/lib/restclient/request.rb:52:in `execute'\r\n         6: from /usr/local/lib/ruby/gems/2.6.0/gems/rest-client-2.0.2/lib/restclient/request.rb:145:in `execute'\r\n         5: from /usr/local/lib/ruby/gems/2.6.0/gems/rest-client-2.0.2/lib/restclient/request.rb:715:in `transmit'\r\n         4: from /usr/local/Cellar/ruby/2.6.5/lib/ruby/2.6.0/net/http.rb:920:in `start'\r\n         3: from /usr/local/lib/ruby/gems/2.6.0/gems/rest-client-2.0.2/lib/restclient/request.rb:725:in `block in transmit'\r\n         2: from /usr/local/lib/ruby/gems/2.6.0/gems/rest-client-2.0.2/lib/restclient/request.rb:809:in `process_result'\r\n         1: from /usr/local/lib/ruby/gems/2.6.0/gems/rest-client-2.0.2/lib/restclient/abstract_response.rb:103:in `return!'\r\n/usr/local/lib/ruby/gems/2.6.0/gems/rest-client-2.0.2/lib/restclient/abstract_response.rb:223:in `exception_with_response': 500 Internal Server Error (RestClient::InternalServerError)\r\n```\r\n\r\n\r\n**Additional context**\r\n\r\nWorkaround is to use goreleaser v0.119.3, the last release before the nfpm rpm refactor.\r\n\r\nApologies I cannot provide more details at this time. If I am able to determine anything helpful I'll update this thread.\r\n","closed_by":{"login":"caarlos0","id":245435,"node_id":"MDQ6VXNlcjI0NTQzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/245435?v=4","gravatar_id":"","url":"https://api.github.com/users/caarlos0","html_url":"https://github.com/caarlos0","followers_url":"https://api.github.com/users/caarlos0/followers","following_url":"https://api.github.com/users/caarlos0/following{/other_user}","gists_url":"https://api.github.com/users/caarlos0/gists{/gist_id}","starred_url":"https://api.github.com/users/caarlos0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caarlos0/subscriptions","organizations_url":"https://api.github.com/users/caarlos0/orgs","repos_url":"https://api.github.com/users/caarlos0/repos","events_url":"https://api.github.com/users/caarlos0/events{/privacy}","received_events_url":"https://api.github.com/users/caarlos0/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/goreleaser/goreleaser/issues/1229/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/1229/timeline","performed_via_github_app":null,"state_reason":"completed"}