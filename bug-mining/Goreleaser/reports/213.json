{"url":"https://api.github.com/repos/goreleaser/goreleaser/issues/3580","repository_url":"https://api.github.com/repos/goreleaser/goreleaser","labels_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/3580/labels{/name}","comments_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/3580/comments","events_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/3580/events","html_url":"https://github.com/goreleaser/goreleaser/issues/3580","id":1458844848,"node_id":"I_kwDOBJgEXs5W9DSw","number":3580,"title":"Allow templating for env vars within build, and build overrides","user":{"login":"HenryNguyen5","id":6404866,"node_id":"MDQ6VXNlcjY0MDQ4NjY=","avatar_url":"https://avatars.githubusercontent.com/u/6404866?v=4","gravatar_id":"","url":"https://api.github.com/users/HenryNguyen5","html_url":"https://github.com/HenryNguyen5","followers_url":"https://api.github.com/users/HenryNguyen5/followers","following_url":"https://api.github.com/users/HenryNguyen5/following{/other_user}","gists_url":"https://api.github.com/users/HenryNguyen5/gists{/gist_id}","starred_url":"https://api.github.com/users/HenryNguyen5/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HenryNguyen5/subscriptions","organizations_url":"https://api.github.com/users/HenryNguyen5/orgs","repos_url":"https://api.github.com/users/HenryNguyen5/repos","events_url":"https://api.github.com/users/HenryNguyen5/events{/privacy}","received_events_url":"https://api.github.com/users/HenryNguyen5/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":504976499,"node_id":"MDU6TGFiZWw1MDQ5NzY0OTk=","url":"https://api.github.com/repos/goreleaser/goreleaser/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":"New feature or request"}],"state":"closed","locked":false,"assignee":{"login":"caarlos0","id":245435,"node_id":"MDQ6VXNlcjI0NTQzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/245435?v=4","gravatar_id":"","url":"https://api.github.com/users/caarlos0","html_url":"https://github.com/caarlos0","followers_url":"https://api.github.com/users/caarlos0/followers","following_url":"https://api.github.com/users/caarlos0/following{/other_user}","gists_url":"https://api.github.com/users/caarlos0/gists{/gist_id}","starred_url":"https://api.github.com/users/caarlos0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caarlos0/subscriptions","organizations_url":"https://api.github.com/users/caarlos0/orgs","repos_url":"https://api.github.com/users/caarlos0/repos","events_url":"https://api.github.com/users/caarlos0/events{/privacy}","received_events_url":"https://api.github.com/users/caarlos0/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"caarlos0","id":245435,"node_id":"MDQ6VXNlcjI0NTQzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/245435?v=4","gravatar_id":"","url":"https://api.github.com/users/caarlos0","html_url":"https://github.com/caarlos0","followers_url":"https://api.github.com/users/caarlos0/followers","following_url":"https://api.github.com/users/caarlos0/following{/other_user}","gists_url":"https://api.github.com/users/caarlos0/gists{/gist_id}","starred_url":"https://api.github.com/users/caarlos0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caarlos0/subscriptions","organizations_url":"https://api.github.com/users/caarlos0/orgs","repos_url":"https://api.github.com/users/caarlos0/repos","events_url":"https://api.github.com/users/caarlos0/events{/privacy}","received_events_url":"https://api.github.com/users/caarlos0/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":4,"created_at":"2022-11-22T01:24:37Z","updated_at":"2022-11-29T16:57:23Z","closed_at":"2022-11-25T18:26:30Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Is your feature request related to a problem? Please describe.\n\nCurrently, im using cross-platform builds via `zig`, for an example you can see: https://dev.to/kristoff/zig-makes-go-cross-compilation-just-work-29ho\r\n\r\nWhat ends up happening is that I have a very long `CC` and `CXX` env var that gets mostly reused across builds, but with minor changes per platform. \r\n\r\nEx. This is what my build script looks like right now:\r\n\r\n```sh\r\nmacos_compiler_flags=\" \\\r\n-isysroot$sdk_dir \\\r\n-F$sdk_dir$framework_search_path \\\r\n-iframeworkwithsysroot$framework_search_path \\\r\n-iwithsysroot$include_search_path \\\r\n-mmacosx-version-min=11.7.1\"\r\n\r\nmain_ld_flags=\"-s -w -X 'main.Version=${VERSION-}'\"\r\n\r\n# We set system-dependent relative paths here so we can store the lib within ./libs\r\n# https://dev.my-gate.net/2021/08/04/understanding-rpath-with-cmake/\r\nmac_ld_flags=\"$main_ld_flags -r=@executable_path/libs\"\r\nlinux_ld_flags=\"$main_ld_flags -r=\\$ORIGIN/libs\"\r\n\r\nbuild_flags=(-trimpath -buildmode=pie)\r\ncc=\"zig cc -target\"\r\ncxx=\"zig c++ -target\"\r\n\r\nexport CGO_ENABLED=1\r\n\r\nmkdir -p ./dist\r\n\r\nexport GOOS=darwin\r\nGOARCH=arm64 \\\r\n  CC=\"$cc aarch64-macos $macos_compiler_flags\" \\\r\n  CCX=\"$cxx aarch64-macos $macos_compiler_flags\" \\\r\n  go build \"${build_flags[@]}\" -ldflags=\"$mac_ld_flags\" -o dist/myprogram-macos-m1 ./cmd\r\n\r\nGOARCH=amd64 \\\r\n  CC=\"$cc x86_64-macos $macos_compiler_flags\" \\\r\n  CCX=\"$cxx x86_64-macos $macos_compiler_flags\" \\\r\n  go build \"${build_flags[@]}\" -ldflags=\"$mac_ld_flags\" -o dist/myprogram-macos-x86_64 ./cmd\r\n\r\nexport GOOS=linux\r\nGOARCH=arm64 \\\r\n  CC=\"$cc aarch64-linux-gnu\" \\\r\n  CCX=\"$cxx aarch64-linux-gnu\" \\\r\n  go build \"${build_flags[@]}\" -ldflags=\"$linux_ld_flags\" -o dist/myprogram-linux-aarch64 ./cmd\r\n\r\nGOARCH=amd64 \\\r\n  CC=\"$cc x86_64-linux-gnu\" \\\r\n  CCX=\"$cxx x86_64-linux-gnu\" \\\r\n  go build \"${build_flags[@]}\" -ldflags=\"$linux_ld_flags\" -o dist/myprogram-linux-x86_64 ./cmd\r\n```\r\n\r\nI previously found https://github.com/goreleaser/goreleaser/issues/2829#issuecomment-1030697442 which states that it might not be possible, but it was awhile ago, so maybe that situation is better now.\n\n### Describe the solution you'd like\n\nIt would be nice to be able to write something like the following:\r\n\r\n```sh\r\nbuilds:\r\n  - main: ./cmd\r\n    ldflags: -X \"main.Version={{ .Version }}\"\r\n    id: mac\r\n    env:\r\n      - CC=zig cc -v -target {{ if eq .Arch \"arm64\" }}aarch64{{else}}x86_64{{end}}-macos\r\n      - CCX=zig c++ -v  -target {{ if eq .Arch \"arm64\" }}aarch64{{else}}x86_64{{end}}-macos\r\n    goarch:\r\n      - arm64\r\n      - amd64\r\n    flags:\r\n      - -trimpath\r\n      - -buildmode=pie\r\n    goos:\r\n      - darwin\r\n```\r\n\r\nor/and be able to do the same with env fields within overrides.\r\n\r\nAnother possible solution would be to expose `CC` and `CXX` as their own specific fields like `ldflags` which supports templating, since they are frequently used for cross platform builds with CGO enabled.\n\n### Describe alternatives you've considered\n\nI considered this: https://github.com/goreleaser/goreleaser/issues/459\r\n\r\nBut with the amount of flags i am maintaining for `CXX` and `CC`, it would result in a lot of duplication, and I am better off just using shell scripts instead which let me compose the env vars. \n\n### Search\n\n- [X] I did search for other open and closed issues before opening this.\n\n### Code of Conduct\n\n- [X] I agree to follow this project's Code of Conduct\n\n### Additional context\n\n_No response_","closed_by":{"login":"caarlos0","id":245435,"node_id":"MDQ6VXNlcjI0NTQzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/245435?v=4","gravatar_id":"","url":"https://api.github.com/users/caarlos0","html_url":"https://github.com/caarlos0","followers_url":"https://api.github.com/users/caarlos0/followers","following_url":"https://api.github.com/users/caarlos0/following{/other_user}","gists_url":"https://api.github.com/users/caarlos0/gists{/gist_id}","starred_url":"https://api.github.com/users/caarlos0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caarlos0/subscriptions","organizations_url":"https://api.github.com/users/caarlos0/orgs","repos_url":"https://api.github.com/users/caarlos0/repos","events_url":"https://api.github.com/users/caarlos0/events{/privacy}","received_events_url":"https://api.github.com/users/caarlos0/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/goreleaser/goreleaser/issues/3580/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/3580/timeline","performed_via_github_app":null,"state_reason":"completed"}