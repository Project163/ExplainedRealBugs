{"url":"https://api.github.com/repos/goreleaser/goreleaser/issues/3061","repository_url":"https://api.github.com/repos/goreleaser/goreleaser","labels_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/3061/labels{/name}","comments_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/3061/comments","events_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/3061/events","html_url":"https://github.com/goreleaser/goreleaser/issues/3061","id":1212422945,"node_id":"I_kwDOBJgEXs5IRBsh","number":3061,"title":"Universal binaries clash between multiple ids when using the same name_template","user":{"login":"lowdewijk","id":8807942,"node_id":"MDQ6VXNlcjg4MDc5NDI=","avatar_url":"https://avatars.githubusercontent.com/u/8807942?v=4","gravatar_id":"","url":"https://api.github.com/users/lowdewijk","html_url":"https://github.com/lowdewijk","followers_url":"https://api.github.com/users/lowdewijk/followers","following_url":"https://api.github.com/users/lowdewijk/following{/other_user}","gists_url":"https://api.github.com/users/lowdewijk/gists{/gist_id}","starred_url":"https://api.github.com/users/lowdewijk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lowdewijk/subscriptions","organizations_url":"https://api.github.com/users/lowdewijk/orgs","repos_url":"https://api.github.com/users/lowdewijk/repos","events_url":"https://api.github.com/users/lowdewijk/events{/privacy}","received_events_url":"https://api.github.com/users/lowdewijk/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":504976497,"node_id":"MDU6TGFiZWw1MDQ5NzY0OTc=","url":"https://api.github.com/repos/goreleaser/goreleaser/labels/bug","name":"bug","color":"ee0701","default":true,"description":"Something isn't working"}],"state":"closed","locked":true,"assignee":{"login":"caarlos0","id":245435,"node_id":"MDQ6VXNlcjI0NTQzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/245435?v=4","gravatar_id":"","url":"https://api.github.com/users/caarlos0","html_url":"https://github.com/caarlos0","followers_url":"https://api.github.com/users/caarlos0/followers","following_url":"https://api.github.com/users/caarlos0/following{/other_user}","gists_url":"https://api.github.com/users/caarlos0/gists{/gist_id}","starred_url":"https://api.github.com/users/caarlos0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caarlos0/subscriptions","organizations_url":"https://api.github.com/users/caarlos0/orgs","repos_url":"https://api.github.com/users/caarlos0/repos","events_url":"https://api.github.com/users/caarlos0/events{/privacy}","received_events_url":"https://api.github.com/users/caarlos0/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"caarlos0","id":245435,"node_id":"MDQ6VXNlcjI0NTQzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/245435?v=4","gravatar_id":"","url":"https://api.github.com/users/caarlos0","html_url":"https://github.com/caarlos0","followers_url":"https://api.github.com/users/caarlos0/followers","following_url":"https://api.github.com/users/caarlos0/following{/other_user}","gists_url":"https://api.github.com/users/caarlos0/gists{/gist_id}","starred_url":"https://api.github.com/users/caarlos0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caarlos0/subscriptions","organizations_url":"https://api.github.com/users/caarlos0/orgs","repos_url":"https://api.github.com/users/caarlos0/repos","events_url":"https://api.github.com/users/caarlos0/events{/privacy}","received_events_url":"https://api.github.com/users/caarlos0/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/goreleaser/goreleaser/milestones/11","html_url":"https://github.com/goreleaser/goreleaser/milestone/11","labels_url":"https://api.github.com/repos/goreleaser/goreleaser/milestones/11/labels","id":7901406,"node_id":"MI_kwDOBJgEXs4AeJDe","number":11,"title":"v1.9.0","description":"","creator":{"login":"caarlos0","id":245435,"node_id":"MDQ6VXNlcjI0NTQzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/245435?v=4","gravatar_id":"","url":"https://api.github.com/users/caarlos0","html_url":"https://github.com/caarlos0","followers_url":"https://api.github.com/users/caarlos0/followers","following_url":"https://api.github.com/users/caarlos0/following{/other_user}","gists_url":"https://api.github.com/users/caarlos0/gists{/gist_id}","starred_url":"https://api.github.com/users/caarlos0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caarlos0/subscriptions","organizations_url":"https://api.github.com/users/caarlos0/orgs","repos_url":"https://api.github.com/users/caarlos0/repos","events_url":"https://api.github.com/users/caarlos0/events{/privacy}","received_events_url":"https://api.github.com/users/caarlos0/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":48,"state":"closed","created_at":"2022-04-22T01:06:04Z","updated_at":"2022-07-04T18:23:22Z","due_on":null,"closed_at":"2022-05-18T23:40:01Z"},"comments":3,"created_at":"2022-04-22T14:17:23Z","updated_at":"2022-12-05T14:15:09Z","closed_at":"2022-04-26T01:07:14Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### What happened?\n\nI have a config that specifies two different builds of the same binary (one with full capabilities and one with limited capabiities). When I use `universal_binaries` with two different ids, referencing the two different build ids, but with the same `name_template` the file paths clash. The result is that one binary overwrites the other and that I get two archives with the same build in it (the one that was specified last). \r\n\r\nE.g.:\r\n\r\n```\r\nuniversal_binaries:\r\n-\r\n  id: my-cli-full\r\n  ids:\r\n  - my-cli-full\r\n  name_template: 'cli'\r\n  replace: true\r\n-\r\n  id: my-cli-limited\r\n  ids:\r\n  - my-cli-limited\r\n  name_template: 'cli'\r\n  replace: true\r\n```\r\n\r\nWill result in two universal binary artifacts, one named full and one named limited, with both only the limited binary in it. You can see why this is happening in the output of `goreleaser`:\r\n\r\n```\r\n   • universal binaries\r\n      • creating from 2 binaries  binary=dist/cli_darwin_all/cli\r\n      • creating from 2 binaries  binary=dist/cli_darwin_all/cli\r\n```\n\n### How can we reproduce this?\n\nTake any two builds and create two respective universal binary ids for them. Then give them the same `name_template`.\n\n### goreleaser version\n\n```bash\n1.8.3\n```\n\n\n### GoReleaser Check\n\n- [X] goreleaser check shows no errors\n\n### Search\n\n- [X] I did search for other open and closed issues before opening this.\n\n### Code of Conduct\n\n- [X] I agree to follow this project's Code of Conduct\n\n### Additional context\n\nI've narrowed this down to:\r\n\r\nhttps://github.com/goreleaser/goreleaser/blob/02595554de30243792f4ec803338258e23bf5702/internal/pipe/universalbinary/universalbinary.go \r\n\r\nLine 143 says:\t`path := filepath.Join(ctx.Config.Dist, name+\"_darwin_all\", name)`\r\n\r\nI believe it should say `path := filepath.Join(ctx.Config.Dist, unibin.Id +\"_darwin_all\", name)`\r\n\r\n","closed_by":{"login":"caarlos0","id":245435,"node_id":"MDQ6VXNlcjI0NTQzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/245435?v=4","gravatar_id":"","url":"https://api.github.com/users/caarlos0","html_url":"https://github.com/caarlos0","followers_url":"https://api.github.com/users/caarlos0/followers","following_url":"https://api.github.com/users/caarlos0/following{/other_user}","gists_url":"https://api.github.com/users/caarlos0/gists{/gist_id}","starred_url":"https://api.github.com/users/caarlos0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caarlos0/subscriptions","organizations_url":"https://api.github.com/users/caarlos0/orgs","repos_url":"https://api.github.com/users/caarlos0/repos","events_url":"https://api.github.com/users/caarlos0/events{/privacy}","received_events_url":"https://api.github.com/users/caarlos0/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/goreleaser/goreleaser/issues/3061/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/3061/timeline","performed_via_github_app":null,"state_reason":"completed"}