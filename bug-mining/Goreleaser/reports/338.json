{"url":"https://api.github.com/repos/goreleaser/goreleaser/issues/4986","repository_url":"https://api.github.com/repos/goreleaser/goreleaser","labels_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/4986/labels{/name}","comments_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/4986/comments","events_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/4986/events","html_url":"https://github.com/goreleaser/goreleaser/issues/4986","id":2403489165,"node_id":"I_kwDOBJgEXs6PQlWN","number":4986,"title":"Windows x64 could not have its enviroment variable overriden","user":{"login":"LucasSnatiago","id":24521882,"node_id":"MDQ6VXNlcjI0NTIxODgy","avatar_url":"https://avatars.githubusercontent.com/u/24521882?v=4","gravatar_id":"","url":"https://api.github.com/users/LucasSnatiago","html_url":"https://github.com/LucasSnatiago","followers_url":"https://api.github.com/users/LucasSnatiago/followers","following_url":"https://api.github.com/users/LucasSnatiago/following{/other_user}","gists_url":"https://api.github.com/users/LucasSnatiago/gists{/gist_id}","starred_url":"https://api.github.com/users/LucasSnatiago/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/LucasSnatiago/subscriptions","organizations_url":"https://api.github.com/users/LucasSnatiago/orgs","repos_url":"https://api.github.com/users/LucasSnatiago/repos","events_url":"https://api.github.com/users/LucasSnatiago/events{/privacy}","received_events_url":"https://api.github.com/users/LucasSnatiago/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":518897945,"node_id":"MDU6TGFiZWw1MTg4OTc5NDU=","url":"https://api.github.com/repos/goreleaser/goreleaser/labels/docs","name":"docs","color":"5319e7","default":false,"description":"A problem or enhancement in documentation"}],"state":"closed","locked":false,"assignee":{"login":"caarlos0","id":245435,"node_id":"MDQ6VXNlcjI0NTQzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/245435?v=4","gravatar_id":"","url":"https://api.github.com/users/caarlos0","html_url":"https://github.com/caarlos0","followers_url":"https://api.github.com/users/caarlos0/followers","following_url":"https://api.github.com/users/caarlos0/following{/other_user}","gists_url":"https://api.github.com/users/caarlos0/gists{/gist_id}","starred_url":"https://api.github.com/users/caarlos0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caarlos0/subscriptions","organizations_url":"https://api.github.com/users/caarlos0/orgs","repos_url":"https://api.github.com/users/caarlos0/repos","events_url":"https://api.github.com/users/caarlos0/events{/privacy}","received_events_url":"https://api.github.com/users/caarlos0/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"caarlos0","id":245435,"node_id":"MDQ6VXNlcjI0NTQzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/245435?v=4","gravatar_id":"","url":"https://api.github.com/users/caarlos0","html_url":"https://github.com/caarlos0","followers_url":"https://api.github.com/users/caarlos0/followers","following_url":"https://api.github.com/users/caarlos0/following{/other_user}","gists_url":"https://api.github.com/users/caarlos0/gists{/gist_id}","starred_url":"https://api.github.com/users/caarlos0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caarlos0/subscriptions","organizations_url":"https://api.github.com/users/caarlos0/orgs","repos_url":"https://api.github.com/users/caarlos0/repos","events_url":"https://api.github.com/users/caarlos0/events{/privacy}","received_events_url":"https://api.github.com/users/caarlos0/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/goreleaser/goreleaser/milestones/30","html_url":"https://github.com/goreleaser/goreleaser/milestone/30","labels_url":"https://api.github.com/repos/goreleaser/goreleaser/milestones/30/labels","id":11161531,"node_id":"MI_kwDOBJgEXs4Aqk-7","number":30,"title":"v2.1.0","description":"","creator":{"login":"caarlos0","id":245435,"node_id":"MDQ6VXNlcjI0NTQzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/245435?v=4","gravatar_id":"","url":"https://api.github.com/users/caarlos0","html_url":"https://github.com/caarlos0","followers_url":"https://api.github.com/users/caarlos0/followers","following_url":"https://api.github.com/users/caarlos0/following{/other_user}","gists_url":"https://api.github.com/users/caarlos0/gists{/gist_id}","starred_url":"https://api.github.com/users/caarlos0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caarlos0/subscriptions","organizations_url":"https://api.github.com/users/caarlos0/orgs","repos_url":"https://api.github.com/users/caarlos0/repos","events_url":"https://api.github.com/users/caarlos0/events{/privacy}","received_events_url":"https://api.github.com/users/caarlos0/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":1,"closed_issues":56,"state":"closed","created_at":"2024-06-09T22:43:12Z","updated_at":"2024-07-13T18:09:44Z","due_on":null,"closed_at":"2024-07-13T18:09:44Z"},"comments":4,"created_at":"2024-07-11T15:30:15Z","updated_at":"2024-07-12T01:21:20Z","closed_at":"2024-07-12T01:20:46Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### What happened?\n\nI have a ebiten game project being automatic built by goreleaser. Linux version and Windows 32 bit is building fine, but when it comes to Windows amd64, that I need to have some environment variables overridden it is ignored.\n\n### How can we reproduce this?\n\nIf you want to take a look at the repository: [PongEbiten](https://github.com/Captain-Santiago/PongEbiten).\r\nBuild with the bug: [PongEbiten Action](https://github.com/Captain-Santiago/PongEbiten/actions/runs/9894061842/job/27330690303)\r\n\r\nMy .goreleaser.yml:\r\n```\r\nversion: 2\r\n\r\nbefore:\r\n  hooks:\r\n    - go mod tidy\r\n    - go generate ./...\r\n\r\nbuilds:\r\n  - env:\r\n      - CGO_ENABLED=1\r\n    goos:\r\n      - linux\r\n      - windows\r\n    goarch:\r\n      - amd64\r\n      - '386'\r\n    ldflags:\r\n      - -s -w\r\n\r\n    overrides:\r\n      - goos: windows\r\n        goarch: amd64\r\n        env:\r\n          - CC=x86_64-w64-mingw32-gcc\r\n          - CXX=x86_64-w64-mingw32-g++\r\n          - CGO_ENABLED=1\r\n        ldflags:\r\n          - -s -w -extldflags \"-static\"\r\n\r\n      - goos: windows\r\n        goarch: '386'\r\n        env:\r\n          - CC=i686-w64-mingw32-gcc\r\n          - CXX=i686-w64-mingw32-g++\r\n          - CGO_ENABLED=1\r\n        ldflags:\r\n          - -s -w -extldflags \"-static\"\r\n\r\narchives:\r\n  - format: binary\r\n    name_template: >-\r\n      {{ .ProjectName }}_\r\n      {{- title .Os }}_\r\n      {{- if eq .Arch \"amd64\" }}x86_64\r\n      {{- else if eq .Arch \"386\" }}i386\r\n      {{- else }}{{ .Arch }}{{ end }}\r\n      {{- if .Arm }}v{{ .Arm }}{{ end }}\r\n\r\nchangelog:\r\n  sort: asc\r\n  filters:\r\n    exclude:\r\n      - \"^docs:\"\r\n      - \"^test:\"\r\n\r\nupx:\r\n  - enabled: true\r\n    compress: best\r\n    lzma: true\r\n    brute: true\r\n```\r\n\r\nError message from Github CI. It does not say Windows amd64 is being overridden. Also, this error message ```gcc: error: unrecognized command-line option ‘-mthreads’; did you mean ‘-pthread’?``` only happens when it is in fact no being overridden.\r\n```\r\nRun goreleaser/goreleaser-action@v6\r\n  with:\r\n    distribution: goreleaser\r\n    version: ~> v2\r\n    args: release --clean\r\n    workdir: .\r\n    install-only: false\r\n  env:\r\n    GITHUB_TOKEN: ***\r\nDownloading https://github.com/goreleaser/goreleaser/releases/download/v2.0.1/goreleaser_Linux_x86_64.tar.gz\r\nExtracting GoReleaser\r\n/usr/bin/tar xz --warning=no-unknown-keyword --overwrite -C /home/runner/work/_temp/27bcd62c-8b34-4261-b442-41b406b77069 -f /home/runner/work/_temp/c91c4e2c-092d-4484-b85d-eb6a35e57746\r\nGoReleaser ~> v2 installed successfully\r\n/opt/hostedtoolcache/goreleaser-action/2.0.1/x64/goreleaser release --clean\r\n  • starting release...\r\n  • loading                                          path=.goreleaser.yaml\r\n  • loading environment variables\r\n    • using token from  $GITHUB_TOKEN \r\n  • getting and validating git state\r\n    • git state                                      commit=df5190fa03ba30a9750df59d310fddabc3a76b44 branch=HEAD current_tag=v1.0.7 previous_tag=v1.0.6 dirty=false\r\n  • parsing tag\r\n  • setting defaults\r\n  • running before hooks\r\n    • running                                        hook=go mod tidy\r\n    • running                                        hook=go generate ./...\r\n    • took: 3s\r\n  • checking distribution directory\r\n  • setting up metadata\r\n  • storing release metadata\r\n    • writing                                        file=dist/metadata.json\r\n  • loading go mod information\r\n  • build prerequisites\r\n  • writing effective config file\r\n    • writing                                        config=dist/config.yaml\r\n  • building binaries\r\n    • building                                       binary=dist/PongEbiten_windows_386/PongEbiten.exe\r\n    • building                                       binary=dist/PongEbiten_linux_amd64_v1/PongEbiten\r\n    • overridden build details for windows386        details={ [-s -w -extldflags \"-static\"] [] [] [] [] [CGO_ENABLED=1 CC=i686-w64-mingw32-gcc CXX=i686-w64-mingw32-g++]}\r\n    • building                                       binary=dist/PongEbiten_windows_amd64_v1/PongEbiten.exe\r\n    • building                                       binary=dist/PongEbiten_linux_386/PongEbiten\r\n    • took: 1m8s\r\n  ⨯ release failed after 1m11s               error=failed to build for windows_amd64_v1: exit status 1: # runtime/cgo\r\ngcc: error: unrecognized command-line option ‘-mthreads’; did you mean ‘-pthread’?\r\n\r\nError: The process '/opt/hostedtoolcache/goreleaser-action/2.0.1/x64/goreleaser' failed with exit code 1\r\n```\n\n### goreleaser version\n\n```bash\nI don't know how to run it inside Github CI, but that's the version specified there: \r\n\r\nRun goreleaser/goreleaser-action@v6\r\n  with:\r\n    distribution: goreleaser\r\n    version: ~> v2\n```\n\n\n### GoReleaser Check\n\n- [X] goreleaser check shows no errors\n\n### Search\n\n- [X] I did search for other open and closed issues before opening this\n\n### Supporter\n\n- [ ] I am a [sponsor](https://github.com/sponsors/caarlos0/) or a [Pro](https://goreleaser.com/pro) customer\n\n### Code of Conduct\n\n- [X] I agree to follow this project's Code of Conduct\n\n### Additional context\n\n_No response_","closed_by":{"login":"caarlos0","id":245435,"node_id":"MDQ6VXNlcjI0NTQzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/245435?v=4","gravatar_id":"","url":"https://api.github.com/users/caarlos0","html_url":"https://github.com/caarlos0","followers_url":"https://api.github.com/users/caarlos0/followers","following_url":"https://api.github.com/users/caarlos0/following{/other_user}","gists_url":"https://api.github.com/users/caarlos0/gists{/gist_id}","starred_url":"https://api.github.com/users/caarlos0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caarlos0/subscriptions","organizations_url":"https://api.github.com/users/caarlos0/orgs","repos_url":"https://api.github.com/users/caarlos0/repos","events_url":"https://api.github.com/users/caarlos0/events{/privacy}","received_events_url":"https://api.github.com/users/caarlos0/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/goreleaser/goreleaser/issues/4986/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/4986/timeline","performed_via_github_app":null,"state_reason":"completed"}