{"url":"https://api.github.com/repos/goreleaser/goreleaser/issues/1264","repository_url":"https://api.github.com/repos/goreleaser/goreleaser","labels_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/1264/labels{/name}","comments_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/1264/comments","events_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/1264/events","html_url":"https://github.com/goreleaser/goreleaser/issues/1264","id":529614787,"node_id":"MDU6SXNzdWU1Mjk2MTQ3ODc=","number":1264,"title":"ldflags default includes Commit instead of ShortCommit","user":{"login":"leighmcculloch","id":351529,"node_id":"MDQ6VXNlcjM1MTUyOQ==","avatar_url":"https://avatars.githubusercontent.com/u/351529?v=4","gravatar_id":"","url":"https://api.github.com/users/leighmcculloch","html_url":"https://github.com/leighmcculloch","followers_url":"https://api.github.com/users/leighmcculloch/followers","following_url":"https://api.github.com/users/leighmcculloch/following{/other_user}","gists_url":"https://api.github.com/users/leighmcculloch/gists{/gist_id}","starred_url":"https://api.github.com/users/leighmcculloch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leighmcculloch/subscriptions","organizations_url":"https://api.github.com/users/leighmcculloch/orgs","repos_url":"https://api.github.com/users/leighmcculloch/repos","events_url":"https://api.github.com/users/leighmcculloch/events{/privacy}","received_events_url":"https://api.github.com/users/leighmcculloch/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":504976497,"node_id":"MDU6TGFiZWw1MDQ5NzY0OTc=","url":"https://api.github.com/repos/goreleaser/goreleaser/labels/bug","name":"bug","color":"ee0701","default":true,"description":"Something isn't working"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2019-11-27T23:22:34Z","updated_at":"2020-11-18T21:10:31Z","closed_at":"2019-11-28T00:38:22Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Describe the bug**\r\n\r\nWhen building using the default `ldflags` the `commit` variable is set with a long full commit SHA (`Commit`) instead of the truncated short commit sha. The docs say that the default ldflags sets `main.commit` to the `ShortCommit`.\r\n\r\nThe docs at https://goreleaser.com/build/ state that this is the default ldflags:\r\n```yaml\r\n    # Custom ldflags templates.\r\n    # Default is `-s -w -X main.version={{.Version}} -X main.commit={{.ShortCommit}} -X main.date={{.Date}} -X main.builtBy=goreleaser`.\r\n    ldflags:\r\n     - -s -w -X main.build={{.Version}}\r\n     - ./usemsan=-msan\r\n```\r\n\r\nThe commit that first introduced the default value for the `main.commit` variable is 4af2cb00ea49d9b4544ea42becb741d2cde00d8d from 3 years ago. It was introduced using `Commit` and not `ShortCommit`.\r\n\r\nThis appears to be either a long-lived bug that has existed since the default was introduced, or incorrect documentation.\r\n\r\n**To Reproduce**\r\n\r\nYou can reproduce this behavior with a simple repository with little code:\r\n\r\n```\r\n$ mkdir test\r\n$ cd test\r\n$ git init\r\n$ git remote add origin git@github.com:leighmcculloch/test\r\n$ cat <<-EOF >main.go\r\npackage main\r\nimport \"fmt\"\r\nvar commit = \"\"\r\nfunc main() {\r\n        fmt.Println(commit)\r\n}\r\nEOF\r\n$ cat <<-EOF >.goreleaser.yml\r\nbuilds:\r\n  - binary: test\r\n    goos:\r\n      - linux\r\n    goarch:\r\n      - amd64\r\nEOF\r\n$ git add . && git commit -m 'Initial commit' && git tag v0.0.1\r\n$ goreleaser --skip-publish\r\n$ ./dist/test_linux_amd64/test \r\n004db4679806fa69a57bb6a27f693d0c632e5fcd\r\n```\r\nWhen configuring the ldflags manually with `ShortCommit` it appears to work as intended:\r\n```\r\n$ cat <<-EOF >>.goreleaser.yml\r\n    ldflags:\r\n      -s -w -X main.commit={{.ShortCommit}}\r\nEOF\r\n$ git add . && git commit -m 'Add custom ldflags' && git tag v0.0.2\r\n$ goreleaser --skip-publish\r\n$ ./dist/test_linux_amd64/test \r\n6b4e614\r\n```\r\n\r\n**Expected behavior**\r\n\r\nThe value set for the `commit` global variable be a short commit sha as implied by the name of the template variable `.ShortCommit`. e.g. `004db46`.\r\n\r\n**Environment (please complete the following information):**\r\n\r\n- OS: [e.g. mac, linux]\r\n   ```\r\n   Linux\r\n   ```\r\n- OS version\r\n   ```\r\n   Linux devenv-0 4.9.184-linuxkit #1 SMP Tue Jul 2 22:58:16 UTC 2019 x86_64 GNU/Linux`\r\n   ```\r\n- GoReleaser Version\r\n   ```\r\n   version: 0.117.2\r\n   commit: 2c08ab87a13ce4a70cf89a691fbbc46c7da6c2e6\r\n   built at: 2019-09-06T18:55:02Z\r\n   built by: goreleaser\r\n   ```\r\n\r\n**Additional context**\r\nI discovered the issue in this CI build where the final output of the version included a long commit instead of a short commit:\r\n```\r\ngas 3.0.2 6e47159666eebcfea2e1226c3efb44993a211305 2019-11-27T20:34:34Z\r\n```\r\nhttps://github.com/leighmcculloch/gas/commit/6e47159666eebcfea2e1226c3efb44993a211305/checks?check_suite_id=332155089\r\n","closed_by":{"login":"caarlos0","id":245435,"node_id":"MDQ6VXNlcjI0NTQzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/245435?v=4","gravatar_id":"","url":"https://api.github.com/users/caarlos0","html_url":"https://github.com/caarlos0","followers_url":"https://api.github.com/users/caarlos0/followers","following_url":"https://api.github.com/users/caarlos0/following{/other_user}","gists_url":"https://api.github.com/users/caarlos0/gists{/gist_id}","starred_url":"https://api.github.com/users/caarlos0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caarlos0/subscriptions","organizations_url":"https://api.github.com/users/caarlos0/orgs","repos_url":"https://api.github.com/users/caarlos0/repos","events_url":"https://api.github.com/users/caarlos0/events{/privacy}","received_events_url":"https://api.github.com/users/caarlos0/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/goreleaser/goreleaser/issues/1264/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/1264/timeline","performed_via_github_app":null,"state_reason":"completed"}