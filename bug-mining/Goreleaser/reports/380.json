{"url":"https://api.github.com/repos/goreleaser/goreleaser/issues/5508","repository_url":"https://api.github.com/repos/goreleaser/goreleaser","labels_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/5508/labels{/name}","comments_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/5508/comments","events_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/5508/events","html_url":"https://github.com/goreleaser/goreleaser/issues/5508","id":2824377050,"node_id":"I_kwDOBJgEXs6oWJLa","number":5508,"title":"docker_signs does not seem to be using artifact with digest","user":{"login":"scop","id":109152,"node_id":"MDQ6VXNlcjEwOTE1Mg==","avatar_url":"https://avatars.githubusercontent.com/u/109152?v=4","gravatar_id":"","url":"https://api.github.com/users/scop","html_url":"https://github.com/scop","followers_url":"https://api.github.com/users/scop/followers","following_url":"https://api.github.com/users/scop/following{/other_user}","gists_url":"https://api.github.com/users/scop/gists{/gist_id}","starred_url":"https://api.github.com/users/scop/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scop/subscriptions","organizations_url":"https://api.github.com/users/scop/orgs","repos_url":"https://api.github.com/users/scop/repos","events_url":"https://api.github.com/users/scop/events{/privacy}","received_events_url":"https://api.github.com/users/scop/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":true,"assignee":{"login":"caarlos0","id":245435,"node_id":"MDQ6VXNlcjI0NTQzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/245435?v=4","gravatar_id":"","url":"https://api.github.com/users/caarlos0","html_url":"https://github.com/caarlos0","followers_url":"https://api.github.com/users/caarlos0/followers","following_url":"https://api.github.com/users/caarlos0/following{/other_user}","gists_url":"https://api.github.com/users/caarlos0/gists{/gist_id}","starred_url":"https://api.github.com/users/caarlos0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caarlos0/subscriptions","organizations_url":"https://api.github.com/users/caarlos0/orgs","repos_url":"https://api.github.com/users/caarlos0/repos","events_url":"https://api.github.com/users/caarlos0/events{/privacy}","received_events_url":"https://api.github.com/users/caarlos0/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"caarlos0","id":245435,"node_id":"MDQ6VXNlcjI0NTQzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/245435?v=4","gravatar_id":"","url":"https://api.github.com/users/caarlos0","html_url":"https://github.com/caarlos0","followers_url":"https://api.github.com/users/caarlos0/followers","following_url":"https://api.github.com/users/caarlos0/following{/other_user}","gists_url":"https://api.github.com/users/caarlos0/gists{/gist_id}","starred_url":"https://api.github.com/users/caarlos0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caarlos0/subscriptions","organizations_url":"https://api.github.com/users/caarlos0/orgs","repos_url":"https://api.github.com/users/caarlos0/repos","events_url":"https://api.github.com/users/caarlos0/events{/privacy}","received_events_url":"https://api.github.com/users/caarlos0/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":0,"created_at":"2025-01-31T20:54:00Z","updated_at":"2025-02-01T14:19:07Z","closed_at":"2025-02-01T14:19:07Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### What happened?\n\nhttps://goreleaser.com/customization/docker_sign/#available-variable-names states\n> `${artifact}`: the path to the artifact that will be signed (including the digest)\n\n...and the footnote about the digest:\n> those are extracted automatically when running Docker push from within GoReleaser. Using the digest helps making sure you're signing the right image and avoid concurrency issues.\n\nHowever, when referencing `${artifact}` in a `docker_signs` block, cosign (2.4.1) gives a warning like\n> WARNING: Image reference ghcr.io/scop/upcloud-cli/upctl:v42.42.6 uses a tag, not a digest, to identify the image to sign.\n\nNote that there is no digest in the image identifier passed to cosign (assuming the warning message is accurate about it), just the image tag is. So it seems goreleaser is not behaving according to the documentation.\n\ncosign warning is emitted from: https://github.com/sigstore/cosign/blob/a25bb31f78edbc263e7fd2d0867ad27d194c1e38/cmd/cosign/cli/sign/sign.go#L126\n\n\n### How can we reproduce this?\n\nhttps://github.com/scop/upcloud-cli/blob/fce68eb3cd8897127c0ff6849fb3ab5969469d91/.goreleaser.yaml (in the `chore/cosign` branch)\n\nhttps://github.com/scop/upcloud-cli/blob/fce68eb3cd8897127c0ff6849fb3ab5969469d91/.github/workflows/publish.yml  (also in the `chore/cosign` branch)\n\nhttps://github.com/scop/upcloud-cli/actions/runs/13080302588/job/36502128776\n> WARNING: Image reference ghcr.io/scop/upcloud-cli/upctl:latest uses a tag, not a digest, to identify the image to sign.\n>    This can lead you to sign a different image than the intended one. Please use a\n>    digest (example.com/ubuntu@sha256:abc123...) rather than tag\n>    (example.com/ubuntu:latest) for the input to cosign. The ability to refer to\n>    images by tag will be removed in a future release.\n\n\n\n### goreleaser version\n\n```bash\n2.6.1\n```\n\n### GoReleaser Check\n\n- [x] goreleaser check shows no errors\n\n### Search\n\n- [x] I did search for other open and closed issues before opening this\n\n### Supporter\n\n- [ ] I am a [sponsor](https://github.com/sponsors/caarlos0/) or a [Pro](https://goreleaser.com/pro) customer\n\n### Code of Conduct\n\n- [x] I agree to follow this project's Code of Conduct\n\n### Additional context\n\n_No response_","closed_by":null,"reactions":{"url":"https://api.github.com/repos/goreleaser/goreleaser/issues/5508/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/goreleaser/goreleaser/issues/5508/timeline","performed_via_github_app":null,"state_reason":"completed"}