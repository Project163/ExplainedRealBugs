diff --git a/internal/tmpl/tmpl.go b/internal/tmpl/tmpl.go
index e420fac8..24f9fe4c 100644
--- a/internal/tmpl/tmpl.go
+++ b/internal/tmpl/tmpl.go
@@ -151,7 +151,7 @@ func (t *Template) WithEnvS(envs []string) *Template {
 
 // WithEnv overrides template's env field with the given environment map.
 func (t *Template) WithEnv(e map[string]string) *Template {
-	t.fields[env] = e
+	t.fields[env] = context.Env(e)
 	return t
 }
 
diff --git a/internal/tmpl/tmpl_test.go b/internal/tmpl/tmpl_test.go
index c2145cf2..d679d504 100644
--- a/internal/tmpl/tmpl_test.go
+++ b/internal/tmpl/tmpl_test.go
@@ -178,7 +178,7 @@ func TestEnv(t *testing.T) {
 	}
 }
 
-func TestWithEnv(t *testing.T) {
+func TestWithEnvS(t *testing.T) {
 	ctx := testctx.New(
 		testctx.WithEnv(map[string]string{"FOO": "BAR"}),
 		testctx.WithCurrentTag("v1.2.3"),
@@ -198,6 +198,14 @@ func TestWithEnv(t *testing.T) {
 	out, err = tpl.Apply(`{{ range $idx, $key := .Env }}{{ $idx }},{{ end }}`)
 	require.NoError(t, err)
 	require.Equal(t, "BAR,FOO,NOVAL,", out)
+
+	out, err = tpl.Apply(`{{ envOrDefault "NOPE" "no" }}`)
+	require.NoError(t, err)
+	require.Equal(t, "no", out)
+
+	out, err = tpl.Apply(`{{ isEnvSet "NOPE" }}`)
+	require.NoError(t, err)
+	require.Equal(t, "false", out)
 }
 
 func TestFuncMap(t *testing.T) {
