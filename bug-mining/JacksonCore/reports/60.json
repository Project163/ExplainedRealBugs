{"url":"https://api.github.com/repos/FasterXML/jackson-core/issues/437","repository_url":"https://api.github.com/repos/FasterXML/jackson-core","labels_url":"https://api.github.com/repos/FasterXML/jackson-core/issues/437/labels{/name}","comments_url":"https://api.github.com/repos/FasterXML/jackson-core/issues/437/comments","events_url":"https://api.github.com/repos/FasterXML/jackson-core/issues/437/events","html_url":"https://github.com/FasterXML/jackson-core/issues/437","id":288137471,"node_id":"MDU6SXNzdWUyODgxMzc0NzE=","number":437,"title":"`ArrayIndexOutOfBoundsException` in `UTF8StreamJsonParser`","user":{"login":"lislon","id":5708360,"node_id":"MDQ6VXNlcjU3MDgzNjA=","avatar_url":"https://avatars.githubusercontent.com/u/5708360?v=4","gravatar_id":"","url":"https://api.github.com/users/lislon","html_url":"https://github.com/lislon","followers_url":"https://api.github.com/users/lislon/followers","following_url":"https://api.github.com/users/lislon/following{/other_user}","gists_url":"https://api.github.com/users/lislon/gists{/gist_id}","starred_url":"https://api.github.com/users/lislon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lislon/subscriptions","organizations_url":"https://api.github.com/users/lislon/orgs","repos_url":"https://api.github.com/users/lislon/repos","events_url":"https://api.github.com/users/lislon/events{/privacy}","received_events_url":"https://api.github.com/users/lislon/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/FasterXML/jackson-core/milestones/38","html_url":"https://github.com/FasterXML/jackson-core/milestone/38","labels_url":"https://api.github.com/repos/FasterXML/jackson-core/milestones/38/labels","id":3050029,"node_id":"MDk6TWlsZXN0b25lMzA1MDAyOQ==","number":38,"title":"2.9.4","description":null,"creator":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":2,"state":"open","created_at":"2018-01-20T04:59:02Z","updated_at":"2018-01-20T05:55:55Z","due_on":null,"closed_at":null},"comments":4,"created_at":"2018-01-12T14:34:01Z","updated_at":"2018-01-22T15:51:57Z","closed_at":"2018-01-20T05:55:55Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Using of UTF8StreamJsonParser#nextToken for closed JsonParser causes unmeaningfull ArrayIndexOutOfBoundsException exception. \r\n\r\n```\r\nCaused by: java.lang.ArrayIndexOutOfBoundsException: 0\r\n\tat com.fasterxml.jackson.core.json.UTF8StreamJsonParser._skipWSOrEnd(UTF8StreamJsonParser.java:2940)\r\n\tat com.fasterxml.jackson.core.json.UTF8StreamJsonParser.nextFieldName(UTF8StreamJsonParser.java:968)\r\n\tat com.fasterxml.jackson.core.json.UTF8StreamJsonParserTest.testExceptionOnClosedParserOnNextFieldName(UTF8StreamJsonParserTest.java:19)\r\n```\r\n\r\nI spent quite a lot of time to debug this and propose to add a meaningfull exception for this case. The code that causes this exception looks like this\r\n```java\r\n// pseudocode\r\nIterable<SomeData> getData() {\r\n  try {\r\n      jsonParser = jsonFactory.createParser(stream)\r\n      return jsonParser.readValuesAs(SomeData.class);\r\n  } finally {\r\n     jsonParser.close();\r\n  }\r\n}\r\n```\r\nWhat do you think if we could add a check for this case and throw meaningfull exception?\r\n","closed_by":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/FasterXML/jackson-core/issues/437/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/FasterXML/jackson-core/issues/437/timeline","performed_via_github_app":null,"state_reason":"completed"}