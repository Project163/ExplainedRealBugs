{"url":"https://api.github.com/repos/FasterXML/jackson-core/issues/372","repository_url":"https://api.github.com/repos/FasterXML/jackson-core","labels_url":"https://api.github.com/repos/FasterXML/jackson-core/issues/372/labels{/name}","comments_url":"https://api.github.com/repos/FasterXML/jackson-core/issues/372/comments","events_url":"https://api.github.com/repos/FasterXML/jackson-core/issues/372/events","html_url":"https://github.com/FasterXML/jackson-core/issues/372","id":224856006,"node_id":"MDU6SXNzdWUyMjQ4NTYwMDY=","number":372,"title":"JsonParserSequence#skipChildren() throws exception when current delegate is TokenBuffer.Parser with \"incomplete\" JSON","user":{"login":"MichaelSims","id":604999,"node_id":"MDQ6VXNlcjYwNDk5OQ==","avatar_url":"https://avatars.githubusercontent.com/u/604999?v=4","gravatar_id":"","url":"https://api.github.com/users/MichaelSims","html_url":"https://github.com/MichaelSims","followers_url":"https://api.github.com/users/MichaelSims/followers","following_url":"https://api.github.com/users/MichaelSims/following{/other_user}","gists_url":"https://api.github.com/users/MichaelSims/gists{/gist_id}","starred_url":"https://api.github.com/users/MichaelSims/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MichaelSims/subscriptions","organizations_url":"https://api.github.com/users/MichaelSims/orgs","repos_url":"https://api.github.com/users/MichaelSims/repos","events_url":"https://api.github.com/users/MichaelSims/events{/privacy}","received_events_url":"https://api.github.com/users/MichaelSims/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/FasterXML/jackson-core/milestones/31","html_url":"https://github.com/FasterXML/jackson-core/milestone/31","labels_url":"https://api.github.com/repos/FasterXML/jackson-core/milestones/31/labels","id":2489022,"node_id":"MDk6TWlsZXN0b25lMjQ4OTAyMg==","number":31,"title":"2.9.0.rc4","description":null,"creator":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":1,"state":"open","created_at":"2017-04-28T21:03:46Z","updated_at":"2017-04-28T21:03:46Z","due_on":null,"closed_at":null},"comments":4,"created_at":"2017-04-27T17:23:50Z","updated_at":"2017-04-28T21:03:46Z","closed_at":"2017-04-28T21:03:02Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"`JsonParserSequence` subclasses `JsonParserDelegate` but does not override `skipChildren()`. The default implementation of this just calls current delegate's `skipChildren()` method, which bypasses `JsonParserSequence#nextToken()`. When the current delegate is a `TokenBuffer.Parser `and the buffer contains \"unbalanced\" JSON (i.e. an incomplete JSON object where the number of start object tokens is more than the number of end object tokens), this violates an invariant of `ParserMinimalBase#skipChildren()` and results in an exception like the following:\r\n\r\n```\r\njava.lang.RuntimeException: Internal error: this code path should never get executed\r\n\tat com.fasterxml.jackson.core.util.VersionUtil.throwInternal(VersionUtil.java:179)\r\n\tat com.fasterxml.jackson.core.base.ParserMinimalBase._throwInternal(ParserMinimalBase.java:566)\r\n\tat com.fasterxml.jackson.databind.util.TokenBuffer$Parser._handleEOF(TokenBuffer.java:1662)\r\n\tat com.fasterxml.jackson.core.base.ParserMinimalBase.skipChildren(ParserMinimalBase.java:156)\r\n\tat com.fasterxml.jackson.core.util.JsonParserDelegate.skipChildren(JsonParserDelegate.java:222)\r\n```\r\nOne possible fix for this is to have `JsonParserSequence` override `skipChildren()` in much the same way `FilteringParserDelegate` does, so that its `nextToken()` logic is not bypassed. I can submit a PR if this would be helpful, just let me know.\r\n\r\nThanks!","closed_by":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/FasterXML/jackson-core/issues/372/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/FasterXML/jackson-core/issues/372/timeline","performed_via_github_app":null,"state_reason":"completed"}