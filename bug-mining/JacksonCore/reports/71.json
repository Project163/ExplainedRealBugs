{"url":"https://api.github.com/repos/FasterXML/jackson-core/issues/531","repository_url":"https://api.github.com/repos/FasterXML/jackson-core","labels_url":"https://api.github.com/repos/FasterXML/jackson-core/issues/531/labels{/name}","comments_url":"https://api.github.com/repos/FasterXML/jackson-core/issues/531/comments","events_url":"https://api.github.com/repos/FasterXML/jackson-core/issues/531/events","html_url":"https://github.com/FasterXML/jackson-core/issues/531","id":429524633,"node_id":"MDU6SXNzdWU0Mjk1MjQ2MzM=","number":531,"title":"Non-blocking parser reports incorrect locations when fed with non-zero offset","user":{"login":"dnault","id":9012551,"node_id":"MDQ6VXNlcjkwMTI1NTE=","avatar_url":"https://avatars.githubusercontent.com/u/9012551?v=4","gravatar_id":"","url":"https://api.github.com/users/dnault","html_url":"https://github.com/dnault","followers_url":"https://api.github.com/users/dnault/followers","following_url":"https://api.github.com/users/dnault/following{/other_user}","gists_url":"https://api.github.com/users/dnault/gists{/gist_id}","starred_url":"https://api.github.com/users/dnault/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnault/subscriptions","organizations_url":"https://api.github.com/users/dnault/orgs","repos_url":"https://api.github.com/users/dnault/repos","events_url":"https://api.github.com/users/dnault/events{/privacy}","received_events_url":"https://api.github.com/users/dnault/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-04-04T23:27:29Z","updated_at":"2019-04-06T03:43:44Z","closed_at":"2019-04-06T03:43:44Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"When feeding a non-blocking parser, the input array offset leaks into the offsets reported by `getCurrentLocation()` and `getTokenLocation()`.\r\n\r\nFor example, feeding with an offset of 7 yields tokens whose reported locations are 7 greater than they should be. Likewise the current location reported by the parser is 7 greater than the correct location.\r\n\r\nIt's not possible for a user to work around this issue by subtracting 7 from the reported locations, because the token location may have been established by an earlier feeding with a different offset.\r\n\r\nJackson version: 2.9.8\r\n\r\nUnit test:\r\n```java\r\nimport com.fasterxml.jackson.core.JsonFactory;\r\nimport com.fasterxml.jackson.core.JsonParser;\r\nimport com.fasterxml.jackson.core.JsonToken;\r\nimport com.fasterxml.jackson.core.async.ByteArrayFeeder;\r\nimport org.junit.Test;\r\n\r\nimport static java.nio.charset.StandardCharsets.UTF_8;\r\nimport static org.junit.Assert.assertEquals;\r\n\r\npublic class FeedingOffsetTest {\r\n\r\n  @Test\r\n  public void inputOffsetShouldNotAffectLocations() throws Exception {\r\n    JsonFactory jsonFactory = new JsonFactory();\r\n    JsonParser parser = jsonFactory.createNonBlockingByteArrayParser();\r\n    ByteArrayFeeder feeder = (ByteArrayFeeder) parser.getNonBlockingInputFeeder();\r\n\r\n    byte[] input = \"[[[\".getBytes(UTF_8);\r\n\r\n    feeder.feedInput(input, 2, 3);\r\n    assertEquals(JsonToken.START_ARRAY, parser.nextToken());\r\n    assertEquals(1, parser.getCurrentLocation().getByteOffset()); // ACTUAL = 3\r\n    assertEquals(1, parser.getTokenLocation().getByteOffset());   // ACTUAL = 3\r\n\r\n    feeder.feedInput(input, 0, 1);\r\n    assertEquals(JsonToken.START_ARRAY, parser.nextToken());\r\n    assertEquals(2, parser.getCurrentLocation().getByteOffset());\r\n    assertEquals(2, parser.getTokenLocation().getByteOffset());\r\n  }\r\n}\r\n```","closed_by":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/FasterXML/jackson-core/issues/531/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/FasterXML/jackson-core/issues/531/timeline","performed_via_github_app":null,"state_reason":"completed"}