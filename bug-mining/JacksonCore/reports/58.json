{"url":"https://api.github.com/repos/FasterXML/jackson-core/issues/414","repository_url":"https://api.github.com/repos/FasterXML/jackson-core","labels_url":"https://api.github.com/repos/FasterXML/jackson-core/issues/414/labels{/name}","comments_url":"https://api.github.com/repos/FasterXML/jackson-core/issues/414/comments","events_url":"https://api.github.com/repos/FasterXML/jackson-core/issues/414/events","html_url":"https://github.com/FasterXML/jackson-core/issues/414","id":264472493,"node_id":"MDU6SXNzdWUyNjQ0NzI0OTM=","number":414,"title":"Base64 MIME variant does not ignore white space chars as per RFC2045","user":{"login":"tmoschou","id":5567550,"node_id":"MDQ6VXNlcjU1Njc1NTA=","avatar_url":"https://avatars.githubusercontent.com/u/5567550?v=4","gravatar_id":"","url":"https://api.github.com/users/tmoschou","html_url":"https://github.com/tmoschou","followers_url":"https://api.github.com/users/tmoschou/followers","following_url":"https://api.github.com/users/tmoschou/following{/other_user}","gists_url":"https://api.github.com/users/tmoschou/gists{/gist_id}","starred_url":"https://api.github.com/users/tmoschou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tmoschou/subscriptions","organizations_url":"https://api.github.com/users/tmoschou/orgs","repos_url":"https://api.github.com/users/tmoschou/repos","events_url":"https://api.github.com/users/tmoschou/events{/privacy}","received_events_url":"https://api.github.com/users/tmoschou/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2017-10-11T06:38:23Z","updated_at":"2017-12-15T22:32:26Z","closed_at":"2017-12-15T22:32:26Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hello,\r\n\r\nThe Base64 Mime variant is non compliant as per RFC2045 Section 6.8.  Base64 Content-Transfer-Encoding, which specifies\r\n\r\n>    Any characters outside of the base64 alphabet are to be ignored in\r\n>    base64-encoded data.\r\n\r\nWith this regard, any character including newline characters and whitespace should not be required to fall on 4 character boundaries.\r\n\r\nSample test case that demonstrates the issues (Note I'm using the Yaml dataformat, since base64 mime encoded documents in json strings with (escaped) newlines seems completely broken regardless of whether newlines fall on 4 char boundary or not).\r\n\r\nInput document from \"Example 2.23. Various Explicit Tags\" from spec (1.1 and 1.2) - http://www.yaml.org/spec/1.2/spec.html\r\n```yaml\r\n---\r\npicture: !!binary |\r\n R0lGODlhDAAMAIQAAP//9/X\r\n 17unp5WZmZgAAAOfn515eXv\r\n Pz7Y6OjuDg4J+fn5OTk6enp\r\n 56enmleECcgggoBADs=\r\n```\r\n\r\n```java\r\n@Test\r\npublic void testBinaryDecoder() throws IOException {\r\n    final ObjectMapper mapper = new ObjectMapper(new YAMLFactory());\r\n    mapper.setBase64Variant(Base64Variants.MIME);\r\n    try (final InputStream inputStream = getClass().getResourceAsStream(\"yaml1.3-example2.23.yaml\")) {\r\n        final JsonNode bean = mapper.readTree(inputStream);\r\n        final JsonNode picture = bean.get(\"picture\");\r\n        java.util.Base64.getMimeDecoder().decode(picture.asText()); // works fine\r\n        final byte[] gif = picture.binaryValue(); // fails\r\n        assertEquals(65, gif.length);\r\n        final byte[] actualFileHeader = Arrays.copyOfRange(gif, 0, 6);\r\n        final byte[] expectedFileHeader = new byte[]{'G', 'I', 'F', '8', '9', 'a'};\r\n        assertArrayEquals(expectedFileHeader, actualFileHeader);\r\n    }\r\n}\r\n```\r\n\r\nNote that `java.util.Base64.getMimeDecoder()` has no issues decoding this document. \r\n\r\nAlso note that technically speaking the YAML codec should be not using the MIME decoder but another variant, not covered in core. http://yaml.org/type/binary.html specifies that\r\n\r\n> Binary data is serialized using the base64 format as defined by RFC2045 (MIME), with the following notes:\r\n> \r\n> * The content is not restricted to lines of 76 characters or less.\r\n> * Characters other than the base64 alphabet, line breaks and white space are considered an error.\r\n\r\nHowever the current API does not allow specifying such a custom variant as far as I am aware. This should not have any baring on the test case provided (since the document **only** consists on the base64 alphabet/whitespace and the document lines are not more than 76 characters).\r\n","closed_by":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/FasterXML/jackson-core/issues/414/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/FasterXML/jackson-core/issues/414/timeline","performed_via_github_app":null,"state_reason":"completed"}