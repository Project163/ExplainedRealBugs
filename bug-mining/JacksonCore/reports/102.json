{"url":"https://api.github.com/repos/FasterXML/jackson-core/issues/700","repository_url":"https://api.github.com/repos/FasterXML/jackson-core","labels_url":"https://api.github.com/repos/FasterXML/jackson-core/issues/700/labels{/name}","comments_url":"https://api.github.com/repos/FasterXML/jackson-core/issues/700/comments","events_url":"https://api.github.com/repos/FasterXML/jackson-core/issues/700/events","html_url":"https://github.com/FasterXML/jackson-core/issues/700","id":897646842,"node_id":"MDU6SXNzdWU4OTc2NDY4NDI=","number":700,"title":"Unable to ignore properties when deserializing. TokenFilter seems broken","user":{"login":"xiazuojie","id":25221069,"node_id":"MDQ6VXNlcjI1MjIxMDY5","avatar_url":"https://avatars.githubusercontent.com/u/25221069?v=4","gravatar_id":"","url":"https://api.github.com/users/xiazuojie","html_url":"https://github.com/xiazuojie","followers_url":"https://api.github.com/users/xiazuojie/followers","following_url":"https://api.github.com/users/xiazuojie/following{/other_user}","gists_url":"https://api.github.com/users/xiazuojie/gists{/gist_id}","starred_url":"https://api.github.com/users/xiazuojie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xiazuojie/subscriptions","organizations_url":"https://api.github.com/users/xiazuojie/orgs","repos_url":"https://api.github.com/users/xiazuojie/repos","events_url":"https://api.github.com/users/xiazuojie/events{/privacy}","received_events_url":"https://api.github.com/users/xiazuojie/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/FasterXML/jackson-core/milestones/60","html_url":"https://github.com/FasterXML/jackson-core/milestone/60","labels_url":"https://api.github.com/repos/FasterXML/jackson-core/milestones/60/labels","id":6962702,"node_id":"MI_kwDOAC5a084Aaj4O","number":60,"title":"2.13.0-rc2","description":null,"creator":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":1,"state":"open","created_at":"2021-07-20T00:13:18Z","updated_at":"2021-07-20T00:18:10Z","due_on":null,"closed_at":null},"comments":6,"created_at":"2021-05-21T03:38:59Z","updated_at":"2021-07-20T02:24:02Z","closed_at":"2021-07-20T00:18:09Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"We have the following JSON generated by another JSON library that includes property ``@type`` to indicate value types. We want Jackson to ignore ``@type`` properties (both root and inner ones) when deserializing the data to ``Map<Long, Map<Long, Long>>``.\r\n```\r\n{\r\n   \"@type\":\"java.util.LinkedHashMap\",\r\n   \"111\":{\r\n      \"@type\":\"java.util.LinkedHashMap\",\r\n      \"1\":11,\r\n      \"2\":22\r\n   }\r\n}\r\n```\r\nWhat we have tried so far:\r\n* ``ObjectReader.withoutAttribute(\"@type\")``\r\n* ``ObjectMapper.addMixIn``\r\n* ``TokenFilter``\r\n* upgrade Jackson to latest version 2.12.3\r\n\r\nNone of the above gets what we want. \r\nThe closest result we've got is by using ``TokenFilter``. However, there's always something broker no matter what combination of TokenFilter options we choose:\r\n* ``TokenFilter#includeProperty`` returning ``this`` or ``TokenFilter#INCLUDE_ALL``\r\n* all ``TokenFilter.Inclusion`` enums for ``FilteringParserDelegate#_inclusion``\r\n* ``FilteringParserDelegate#_allowMultipleMatches`` true or false\r\n\r\nIt seems TokenFilter is broken. The following is our test case. \r\n\r\n```java\r\nimport com.fasterxml.jackson.annotation.JsonIgnoreProperties;\r\nimport com.fasterxml.jackson.core.JsonParser;\r\nimport com.fasterxml.jackson.core.filter.FilteringParserDelegate;\r\nimport com.fasterxml.jackson.core.filter.TokenFilter;\r\nimport com.fasterxml.jackson.core.type.TypeReference;\r\nimport com.fasterxml.jackson.databind.ObjectMapper;\r\nimport com.fasterxml.jackson.databind.ObjectReader;\r\nimport org.junit.Test;\r\n\r\nimport java.util.Map;\r\n\r\nimport static org.junit.Assert.assertEquals;\r\n\r\npublic class IgnorePropertyTest {\r\n    private final ObjectMapper mapper = new ObjectMapper();\r\n    private final String LONG_INNER_MAP_WITH_AUTO_TYPE = \"{\\\"@type\\\":\\\"java.util.LinkedHashMap\\\",\\\"111\\\":{\\\"@type\\\":\\\"java.util.LinkedHashMap\\\",\\\"1\\\":11,\\\"2\\\":22}}\";\r\n\r\n    @Test\r\n    public void testTokenFilter() throws Exception {\r\n        final TokenFilter tokenFilter = new TokenFilter() {\r\n            @Override\r\n            public TokenFilter includeProperty(String name) {\r\n                if (\"@type\".equals(name)) {\r\n                    return null;\r\n                }\r\n                return this;\r\n            }\r\n        };\r\n        JsonParser jsonParser = new FilteringParserDelegate(\r\n                mapper.createParser(LONG_INNER_MAP_WITH_AUTO_TYPE),\r\n                tokenFilter,\r\n                TokenFilter.Inclusion.INCLUDE_ALL_AND_PATH,\r\n                true);\r\n        Map<Long, Map<Long, Long>> data = mapper.readValue(jsonParser, new TypeReference<Map<Long, Map<Long, Long>>>() {});\r\n        check(data);\r\n    }\r\n\r\n    @Test\r\n    public void testReader() throws Exception {\r\n        ObjectReader reader = mapper.readerFor(new TypeReference<Map<Long, Map<Long, Long>>>() {});\r\n        Map<Long, Map<Long, Long>> data = reader.withoutAttribute(\"@type\").readValue(LONG_INNER_MAP_WITH_AUTO_TYPE);\r\n        check(data);\r\n    }\r\n\r\n    @Test\r\n    public void testMixin() throws Exception {\r\n        ObjectMapper mp = mapper.addMixIn(Map.class, MixIn.class);\r\n        Map<Long, Map<Long, Long>> data = mp.readValue(LONG_INNER_MAP_WITH_AUTO_TYPE, new TypeReference<Map<Long, Map<Long, Long>>>() {});\r\n        check(data);\r\n    }\r\n\r\n    @JsonIgnoreProperties({\"@kind\"})\r\n    private static abstract class MixIn {\r\n    }\r\n\r\n    private void check(Map<Long, Map<Long, Long>> data) {\r\n        assertEquals(1, data.size());\r\n        assertEquals(2, data.get(111L).size());\r\n        assertEquals(11L, (long)data.get(111L).get(1L));\r\n        assertEquals(22L, (long)data.get(111L).get(2L));\r\n    }\r\n}\r\n```\r\n\r\nJackson version: 2.12.3\r\n","closed_by":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/FasterXML/jackson-core/issues/700/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/FasterXML/jackson-core/issues/700/timeline","performed_via_github_app":null,"state_reason":"completed"}