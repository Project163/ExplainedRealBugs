{"url":"https://api.github.com/repos/FasterXML/jackson-core/issues/382","repository_url":"https://api.github.com/repos/FasterXML/jackson-core","labels_url":"https://api.github.com/repos/FasterXML/jackson-core/issues/382/labels{/name}","comments_url":"https://api.github.com/repos/FasterXML/jackson-core/issues/382/comments","events_url":"https://api.github.com/repos/FasterXML/jackson-core/issues/382/events","html_url":"https://github.com/FasterXML/jackson-core/issues/382","id":233103364,"node_id":"MDU6SXNzdWUyMzMxMDMzNjQ=","number":382,"title":"ArrayIndexOutOfBoundsException from UTF32Reader.read on invalid input","user":{"login":"emilyselwood","id":645622,"node_id":"MDQ6VXNlcjY0NTYyMg==","avatar_url":"https://avatars.githubusercontent.com/u/645622?v=4","gravatar_id":"","url":"https://api.github.com/users/emilyselwood","html_url":"https://github.com/emilyselwood","followers_url":"https://api.github.com/users/emilyselwood/followers","following_url":"https://api.github.com/users/emilyselwood/following{/other_user}","gists_url":"https://api.github.com/users/emilyselwood/gists{/gist_id}","starred_url":"https://api.github.com/users/emilyselwood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/emilyselwood/subscriptions","organizations_url":"https://api.github.com/users/emilyselwood/orgs","repos_url":"https://api.github.com/users/emilyselwood/repos","events_url":"https://api.github.com/users/emilyselwood/events{/privacy}","received_events_url":"https://api.github.com/users/emilyselwood/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2017-06-02T07:49:09Z","updated_at":"2017-10-20T20:58:56Z","closed_at":"2017-06-02T20:34:16Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"We are doing some fuzz testing on internal projects and found some input that causes an unexpected exception from JsonParser. While it is throwing an exception and stopping on this, it should probably be some kind of IOException rather than an ArrayIndexOutOfBoundsException.\r\n\r\nIn our case we are catching the three exception types listed in ObjectMapper.readTree  (JsonParseException | JsonProcessingException | IOException) and this managed to escape.\r\n\r\nSimple test case follows\r\n```java\r\npublic void testInvalidInput() throws IOException {\r\n\r\n        byte[] data = {\r\n                0x00,\r\n                0x00,\r\n                0x00,\r\n                0x20,\r\n                (byte) 0xFE,\r\n                (byte) 0xFF,\r\n                0x00,\r\n                0x01,\r\n                (byte) 0xFB\r\n        };\r\n\r\n        JsonFactory FACTORY = new JsonFactory();\r\n        JsonParser parser = FACTORY.createParser(data);\r\n\r\n        parser.nextToken();\r\n\r\n\r\n    }\r\n```\r\n\r\nstack trace:\r\n```\r\njava.lang.ArrayIndexOutOfBoundsException: 9\r\n\r\n\tat com.fasterxml.jackson.core.io.UTF32Reader.read(UTF32Reader.java:138)\r\n\tat com.fasterxml.jackson.core.json.ReaderBasedJsonParser._loadMore(ReaderBasedJsonParser.java:243)\r\n\tat com.fasterxml.jackson.core.json.ReaderBasedJsonParser._skipWSOrEnd(ReaderBasedJsonParser.java:2331)\r\n\tat com.fasterxml.jackson.core.json.ReaderBasedJsonParser.nextToken(ReaderBasedJsonParser.java:646)\r\n\tat com.fasterxml.jackson.core.io.TestUTF32Reader.testInvalidInput(TestUTF32Reader.java:32)\r\n```\r\n","closed_by":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/FasterXML/jackson-core/issues/382/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/FasterXML/jackson-core/issues/382/timeline","performed_via_github_app":null,"state_reason":"completed"}