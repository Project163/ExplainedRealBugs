{"url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml/issues/491","repository_url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml","labels_url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml/issues/491/labels{/name}","comments_url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml/issues/491/comments","events_url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml/issues/491/events","html_url":"https://github.com/FasterXML/jackson-dataformat-xml/issues/491","id":980243889,"node_id":"MDU6SXNzdWU5ODAyNDM4ODk=","number":491,"title":"`XmlMapper` 2.12 regression: no default no-arg ctor found","user":{"login":"vy","id":72137,"node_id":"MDQ6VXNlcjcyMTM3","avatar_url":"https://avatars.githubusercontent.com/u/72137?v=4","gravatar_id":"","url":"https://api.github.com/users/vy","html_url":"https://github.com/vy","followers_url":"https://api.github.com/users/vy/followers","following_url":"https://api.github.com/users/vy/following{/other_user}","gists_url":"https://api.github.com/users/vy/gists{/gist_id}","starred_url":"https://api.github.com/users/vy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vy/subscriptions","organizations_url":"https://api.github.com/users/vy/orgs","repos_url":"https://api.github.com/users/vy/repos","events_url":"https://api.github.com/users/vy/events{/privacy}","received_events_url":"https://api.github.com/users/vy/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml/milestones/50","html_url":"https://github.com/FasterXML/jackson-dataformat-xml/milestone/50","labels_url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml/milestones/50/labels","id":8366620,"node_id":"MI_kwDOABJ3ss4Af6oc","number":50,"title":"2.14.0","description":null,"creator":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":1,"closed_issues":4,"state":"open","created_at":"2022-08-31T00:14:06Z","updated_at":"2022-10-25T01:27:09Z","due_on":null,"closed_at":null},"comments":18,"created_at":"2021-08-26T13:24:11Z","updated_at":"2022-09-27T07:56:35Z","closed_at":"2022-09-07T02:06:06Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"As described first in FasterXML/jackson-module-kotlin#396, 2.12.0 has introduced a regression to the `XmlMapper`. I have managed to reproduce the regression in the below Java snippet, which works on 2.11.4, but fails on 2.12.{0..4}:\r\n```java\r\npackage com.vlkan.jackson;\r\n\r\nimport com.fasterxml.jackson.annotation.JsonCreator;\r\nimport com.fasterxml.jackson.annotation.JsonInclude;\r\nimport com.fasterxml.jackson.annotation.JsonProperty;\r\nimport com.fasterxml.jackson.annotation.JsonRootName;\r\nimport com.fasterxml.jackson.annotation.JsonTypeInfo;\r\nimport com.fasterxml.jackson.databind.ObjectMapper;\r\nimport com.fasterxml.jackson.databind.module.SimpleModule;\r\nimport com.fasterxml.jackson.dataformat.xml.XmlMapper;\r\nimport org.junit.jupiter.api.Test;\r\n\r\nimport java.io.IOException;\r\nimport java.nio.charset.StandardCharsets;\r\n\r\nimport static org.junit.jupiter.api.Assertions.assertEquals;\r\n\r\nclass MixinTest {\r\n\r\n    interface Problem {\r\n\r\n        String DEFAULT_TYPE = \"about:blank\";\r\n\r\n        int DEFAULT_STATUS = 500;\r\n\r\n        String getType();\r\n\r\n        int getStatus();\r\n\r\n    }\r\n\r\n    static class DefaultProblem implements Problem {\r\n\r\n        private final String type;\r\n\r\n        private final int status;\r\n\r\n        /**\r\n         * This is required to workaround Jackson's missing support for static\r\n         * {@link JsonCreator}s in mix-ins. That is, we need to define the\r\n         * creator on a constructor in the mix-in that is matching with a\r\n         * constructor here too.\r\n         *\r\n         * @see <a href=\"https://github.com/FasterXML/jackson-databind/issues/1820\">jackson-databind issue 1820</a>\r\n         */\r\n        DefaultProblem(String type, Integer status) {\r\n            this.type = type != null ? type : Problem.DEFAULT_TYPE;\r\n            this.status = status != null ? status : Problem.DEFAULT_STATUS;\r\n        }\r\n\r\n        @Override\r\n        public String getType() {\r\n            return type;\r\n        }\r\n\r\n        @Override\r\n        public int getStatus() {\r\n            return status;\r\n        }\r\n\r\n    }\r\n\r\n    @JsonTypeInfo(\r\n            use = JsonTypeInfo.Id.NAME,\r\n            include = JsonTypeInfo.As.EXISTING_PROPERTY,\r\n            property = \"type\",\r\n            defaultImpl = DefaultProblem.class,\r\n            visible = true)\r\n    @JsonInclude(JsonInclude.Include.NON_EMPTY)\r\n    @JsonRootName(\"problem\")\r\n    interface ProblemMixIn extends Problem {\r\n\r\n        @Override\r\n        @JsonProperty(\"type\")\r\n        String getType();\r\n\r\n        @Override\r\n        @JsonProperty(\"status\")\r\n        int getStatus();\r\n\r\n    }\r\n\r\n    abstract static class DefaultProblemMixIn extends DefaultProblem {\r\n\r\n        @JsonCreator\r\n        DefaultProblemMixIn(\r\n                @JsonProperty(\"type\") String type,\r\n                @JsonProperty(\"status\") Integer status) {\r\n            super(type, status);\r\n            throw new IllegalStateException(\r\n                    \"mix-in constructor is there only for extracting the JSON mapping, \" +\r\n                            \"it should not have been called\");\r\n        }\r\n\r\n    }\r\n\r\n    static class ProblemModule extends SimpleModule {\r\n\r\n        @Override\r\n        public void setupModule(SetupContext context) {\r\n            super.setupModule(context);\r\n            registerMixIns(context);\r\n        }\r\n\r\n        private static void registerMixIns(SetupContext context) {\r\n            context.setMixInAnnotations(DefaultProblem.class, DefaultProblemMixIn.class);\r\n            context.setMixInAnnotations(Problem.class, ProblemMixIn.class);\r\n        }\r\n\r\n    }\r\n\r\n    private static final ProblemModule MODULE = new ProblemModule();\r\n\r\n    private static final ObjectMapper JSON_MAPPER = new ObjectMapper().registerModule(MODULE);\r\n\r\n    private static final XmlMapper XML_MAPPER = (XmlMapper) new XmlMapper().registerModule(MODULE);\r\n\r\n    @Test\r\n    void test_empty_Problem_JSON_deserialization() throws IOException {\r\n        byte[] problemJsonBytes = \"{}\".getBytes(StandardCharsets.UTF_8);\r\n        Problem problem = JSON_MAPPER.readValue(problemJsonBytes, Problem.class);\r\n        assertEquals(Problem.DEFAULT_TYPE, problem.getType());\r\n        assertEquals(Problem.DEFAULT_STATUS, problem.getStatus());\r\n    }\r\n\r\n    @Test\r\n    void test_empty_Problem_XML_deserialization() throws IOException {\r\n        byte[] problemXmlBytes = \"<problem/>\".getBytes(StandardCharsets.UTF_8);\r\n        Problem problem = XML_MAPPER.readValue(problemXmlBytes, Problem.class);\r\n        assertEquals(Problem.DEFAULT_TYPE, problem.getType());\r\n        assertEquals(Problem.DEFAULT_STATUS, problem.getStatus());\r\n    }\r\n\r\n}\r\n```\r\nBoth tests pass on 2.11.4, whereas, on 2.12.{0..4}, `test_empty_Problem_JSON_deserialization()` passes and \r\n`test_empty_Problem_XML_deserialization()` fails with the following message:\r\n```\r\ncom.fasterxml.jackson.databind.exc.MismatchedInputException: Cannot construct instance of `com.vlkan.jackson.MixinTest$DefaultProblem` (although at least one Creator exists): no default no-arguments constructor found\r\n at [Source: (byte[])\"<problem/>\"; line: 1, column: 1]\r\n\r\n\tat com.fasterxml.jackson.databind.exc.MismatchedInputException.from(MismatchedInputException.java:63)\r\n\tat com.fasterxml.jackson.databind.DeserializationContext.reportInputMismatch(DeserializationContext.java:1588)\r\n\tat com.fasterxml.jackson.databind.DeserializationContext.handleMissingInstantiator(DeserializationContext.java:1213)\r\n\tat com.fasterxml.jackson.databind.deser.ValueInstantiator.createUsingDefault(ValueInstantiator.java:248)\r\n\tat com.fasterxml.jackson.databind.deser.std.StdValueInstantiator.createUsingDefault(StdValueInstantiator.java:275)\r\n\tat com.fasterxml.jackson.databind.deser.BeanDeserializerBase.getEmptyValue(BeanDeserializerBase.java:1042)\r\n\tat com.fasterxml.jackson.databind.deser.std.StdDeserializer._deserializeFromEmptyString(StdDeserializer.java:322)\r\n\tat com.fasterxml.jackson.databind.deser.std.StdDeserializer._deserializeFromString(StdDeserializer.java:270)\r\n\tat com.fasterxml.jackson.databind.deser.BeanDeserializerBase.deserializeFromString(BeanDeserializerBase.java:1495)\r\n\tat com.fasterxml.jackson.databind.deser.BeanDeserializer._deserializeOther(BeanDeserializer.java:207)\r\n\tat com.fasterxml.jackson.databind.deser.BeanDeserializer.deserialize(BeanDeserializer.java:197)\r\n\tat com.fasterxml.jackson.databind.jsontype.impl.AsPropertyTypeDeserializer._deserializeTypedUsingDefaultImpl(AsPropertyTypeDeserializer.java:194)\r\n\tat com.fasterxml.jackson.databind.jsontype.impl.AsPropertyTypeDeserializer.deserializeTypedFromObject(AsPropertyTypeDeserializer.java:96)\r\n\tat com.fasterxml.jackson.databind.deser.AbstractDeserializer.deserializeWithType(AbstractDeserializer.java:263)\r\n\tat com.fasterxml.jackson.databind.deser.impl.TypeWrappedDeserializer.deserialize(TypeWrappedDeserializer.java:74)\r\n\tat com.fasterxml.jackson.dataformat.xml.deser.XmlDeserializationContext.readRootValue(XmlDeserializationContext.java:91)\r\n\tat com.fasterxml.jackson.databind.ObjectMapper._readMapAndClose(ObjectMapper.java:4593)\r\n\tat com.fasterxml.jackson.databind.ObjectMapper.readValue(ObjectMapper.java:3609)\r\n\tat com.vlkan.jackson.MixinTest.test_empty_Problem_XML_deserialization(MixinTest.java:129)\r\n        ...\r\n```\r\nIn order to make `test_empty_Problem_XML_deserialization()` pass on 2.12.{0..4}, one needs to add a no-arg ctor to `DefaultProblem`.","closed_by":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml/issues/491/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml/issues/491/timeline","performed_via_github_app":null,"state_reason":"completed"}