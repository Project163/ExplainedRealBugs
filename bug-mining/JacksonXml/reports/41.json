{"url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml/issues/273","repository_url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml","labels_url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml/issues/273/labels{/name}","comments_url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml/issues/273/comments","events_url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml/issues/273/events","html_url":"https://github.com/FasterXML/jackson-dataformat-xml/issues/273","id":279435808,"node_id":"MDU6SXNzdWUyNzk0MzU4MDg=","number":273,"title":"Input mismatch with case-insensitive properties ('MapperFeature.ACCEPT_CASE_INSENSITIVE_PROPERTIES')","user":{"login":"jetersen","id":1661688,"node_id":"MDQ6VXNlcjE2NjE2ODg=","avatar_url":"https://avatars.githubusercontent.com/u/1661688?v=4","gravatar_id":"","url":"https://api.github.com/users/jetersen","html_url":"https://github.com/jetersen","followers_url":"https://api.github.com/users/jetersen/followers","following_url":"https://api.github.com/users/jetersen/following{/other_user}","gists_url":"https://api.github.com/users/jetersen/gists{/gist_id}","starred_url":"https://api.github.com/users/jetersen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jetersen/subscriptions","organizations_url":"https://api.github.com/users/jetersen/orgs","repos_url":"https://api.github.com/users/jetersen/repos","events_url":"https://api.github.com/users/jetersen/events{/privacy}","received_events_url":"https://api.github.com/users/jetersen/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml/milestones/33","html_url":"https://github.com/FasterXML/jackson-dataformat-xml/milestone/33","labels_url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml/milestones/33/labels","id":5370091,"node_id":"MDk6TWlsZXN0b25lNTM3MDA5MQ==","number":33,"title":"2.12.0","description":null,"creator":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":24,"state":"open","created_at":"2020-05-01T05:23:41Z","updated_at":"2020-11-14T03:45:00Z","due_on":null,"closed_at":null},"comments":7,"created_at":"2017-12-05T16:16:01Z","updated_at":"2020-11-20T00:37:44Z","closed_at":"2020-05-12T05:49:06Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Besides the #252 I tried to adapt my XML to nonself-closing, some preprocessing is always good üÉè \r\nIssue is somewhat similar to #255 \r\n\r\nMy XML provider, accurev is not very friendly.\r\nI would very much like to abstract as much XML as possible.\r\nSadly when case insensitivity is turned on the XML mapper it seems to add a rogue element.\r\nIn this case, it treats a \"/\" as an Element that then needs to chuck through to Depot class but chokes because of a null pointer.\r\n\r\nI can easily treat the symptom by adding a null pointer check for JsonToken however I would like to know the root cause.\r\n\r\nFirst element is detected like this:\r\n![image](https://user-images.githubusercontent.com/1661688/33617218-78283b2c-d9df-11e7-8d45-2e3e0e3377b5.png)\r\n\r\nSecond element, notice the nextToken is null\r\n![image](https://user-images.githubusercontent.com/1661688/33617282-9f5b7006-d9df-11e7-82c0-5996a17cde67.png)\r\n\r\nThird rogue context who is apparently child to Element üòï \r\n![image](https://user-images.githubusercontent.com/1661688/33617381-d201d6bc-d9df-11e7-998e-70db53711570.png)\r\n\r\n\r\n\r\n```\r\nCaused by: java.lang.NullPointerException\r\n\tat com.fasterxml.jackson.databind.deser.BeanDeserializer._deserializeOther(BeanDeserializer.java:168)\r\n\tat com.fasterxml.jackson.databind.deser.BeanDeserializer.deserialize(BeanDeserializer.java:161)\r\n\tat com.fasterxml.jackson.databind.deser.std.CollectionDeserializer.deserialize(CollectionDeserializer.java:285)\r\n```\r\n\r\n```\r\nfun main(args : Array<String>) {\r\n    val bob = \"hello world\"\r\n    val xml = \"\"\"\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<AcResponse\r\n    Command=\"show depots\"\r\n    TaskId=\"1260\">\r\n  <Element\r\n      Number=\"1\"\r\n      Name=\"accurev\"\r\n      Slice=\"1\"\r\n      exclusiveLocking=\"false\"\r\n      case=\"insensitive\"\r\n      locWidth=\"128\"></Element>\r\n  <Element\r\n      Number=\"2\"\r\n      Name=\"second accurev\"\r\n      Slice=\"2\"\r\n      exclusiveLocking=\"false\"\r\n      case=\"insensitive\"\r\n      locWidth=\"128\"></Element>\r\n</AcResponse>\"\"\".trimIndent()\r\n    val mapper : ObjectMapper = XmlMapper()\r\n    mapper.registerModule(KotlinModule())\r\n    mapper.configure(MapperFeature.ACCEPT_CASE_INSENSITIVE_PROPERTIES, true)\r\n    val response : Depots = mapper.readValue(xml)\r\n\r\n    println(response)\r\n}\r\n\r\ndata class Depots(\r\n    val command: String,\r\n    val taskId: String,\r\n    @JacksonXmlElementWrapper(useWrapping = false)\r\n    var element: ArrayList<Depot>\r\n)\r\n\r\n@JsonIgnoreProperties(ignoreUnknown = true)\r\ndata class Depot(\r\n    @JacksonXmlProperty(isAttribute = true)\r\n    val number : String = \"\",\r\n    @JacksonXmlProperty(isAttribute = true)\r\n    val name : String = \"\"\r\n)\r\n```\r\n\r\nFull stack trace\r\n```\r\nCaused by: com.fasterxml.jackson.databind.JsonMappingException: (was java.lang.NullPointerException) (through reference chain: org.jenkinsci.plugins.accurevclient.model.Depots[\"element\"]->java.util.ArrayList[2])\r\n\tat com.fasterxml.jackson.databind.JsonMappingException.wrapWithPath(JsonMappingException.java:391)\r\n\tat com.fasterxml.jackson.databind.JsonMappingException.wrapWithPath(JsonMappingException.java:363)\r\n\tat com.fasterxml.jackson.databind.deser.std.CollectionDeserializer.deserialize(CollectionDeserializer.java:306)\r\n\tat com.fasterxml.jackson.databind.deser.std.CollectionDeserializer.deserialize(CollectionDeserializer.java:244)\r\n\tat com.fasterxml.jackson.databind.deser.std.CollectionDeserializer.deserialize(CollectionDeserializer.java:27)\r\n\tat com.fasterxml.jackson.databind.deser.SettableBeanProperty.deserialize(SettableBeanProperty.java:519)\r\n\tat com.fasterxml.jackson.databind.deser.BeanDeserializer._deserializeWithErrorWrapping(BeanDeserializer.java:527)\r\n\tat com.fasterxml.jackson.databind.deser.BeanDeserializer._deserializeUsingPropertyBased(BeanDeserializer.java:416)\r\n\tat com.fasterxml.jackson.databind.deser.BeanDeserializerBase.deserializeFromObjectUsingNonDefault(BeanDeserializerBase.java:1265)\r\n\tat com.fasterxml.jackson.databind.deser.BeanDeserializer.deserializeFromObject(BeanDeserializer.java:325)\r\n\tat com.fasterxml.jackson.databind.deser.BeanDeserializer.deserialize(BeanDeserializer.java:159)\r\n\tat com.fasterxml.jackson.dataformat.xml.deser.WrapperHandlingDeserializer.deserialize(WrapperHandlingDeserializer.java:113)\r\n\tat com.fasterxml.jackson.databind.ObjectMapper._readMapAndClose(ObjectMapper.java:4001)\r\n\tat com.fasterxml.jackson.databind.ObjectMapper.readValue(ObjectMapper.java:3011)\r\n\tat org.jenkinsci.plugins.accurevclient.PlayGroundKt.main(PlayGround.kt:40)\r\n\t... 5 more\r\nCaused by: java.lang.NullPointerException\r\n\tat com.fasterxml.jackson.databind.deser.BeanDeserializer._deserializeOther(BeanDeserializer.java:168)\r\n\tat com.fasterxml.jackson.databind.deser.BeanDeserializer.deserialize(BeanDeserializer.java:161)\r\n\tat com.fasterxml.jackson.databind.deser.std.CollectionDeserializer.deserialize(CollectionDeserializer.java:285)\r\n\t... 17 more\r\n```","closed_by":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml/issues/273/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml/issues/273/timeline","performed_via_github_app":null,"state_reason":"completed"}