{"url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml/issues/117","repository_url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml","labels_url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml/issues/117/labels{/name}","comments_url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml/issues/117/comments","events_url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml/issues/117/events","html_url":"https://github.com/FasterXML/jackson-dataformat-xml/issues/117","id":35544825,"node_id":"MDU6SXNzdWUzNTU0NDgyNQ==","number":117,"title":"@JsonAnyGetter + @JsonTypeInfo combination prevents serialization of properties as elements","user":{"login":"gawi","id":813371,"node_id":"MDQ6VXNlcjgxMzM3MQ==","avatar_url":"https://avatars.githubusercontent.com/u/813371?v=4","gravatar_id":"","url":"https://api.github.com/users/gawi","html_url":"https://github.com/gawi","followers_url":"https://api.github.com/users/gawi/followers","following_url":"https://api.github.com/users/gawi/following{/other_user}","gists_url":"https://api.github.com/users/gawi/gists{/gist_id}","starred_url":"https://api.github.com/users/gawi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gawi/subscriptions","organizations_url":"https://api.github.com/users/gawi/orgs","repos_url":"https://api.github.com/users/gawi/repos","events_url":"https://api.github.com/users/gawi/events{/privacy}","received_events_url":"https://api.github.com/users/gawi/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml/milestones/2","html_url":"https://github.com/FasterXML/jackson-dataformat-xml/milestone/2","labels_url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml/milestones/2/labels","id":521407,"node_id":"MDk6TWlsZXN0b25lNTIxNDA3","number":2,"title":"2,","description":null,"creator":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":2,"state":"open","created_at":"2013-12-26T03:54:48Z","updated_at":"2025-01-20T18:57:25Z","due_on":null,"closed_at":null},"comments":2,"created_at":"2014-06-12T02:07:52Z","updated_at":"2014-06-12T05:25:22Z","closed_at":"2014-06-12T05:23:06Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"For the following class:\n\n``` .java\n@JacksonXmlRootElement(localName = \"dynaBean\", namespace = \"\")\n@JsonTypeInfo(use = Id.NAME, property = \"class\", include = As.PROPERTY)\npublic class DynaBean {\n\n    private final Map<String, String> _properties = new TreeMap<String, String>();\n\n    public DynaBean(Map<String, String> values) {\n        _properties.putAll(values);\n    }\n\n    @JsonAnyGetter\n    @JacksonXmlProperty(isAttribute = false)\n    public Map<String, String> getProperties() {\n        return _properties;\n    }\n}\n```\n\nFor the code:\n\n``` .java\nXmlMapper xmlMapper = new XmlMapper();\nMap<String, String> values = new HashMap<String, String>();\nvalues.put(\"prop1\", \"val1\");\nvalues.put(\"prop2\", \"val2\");\nSystem.out.println(xmlMapper.writeValueAsString(new DynaBean(values)));\n```\n\nSince we have `@JacksonXmlProperty(isAttribute = false)`, we expect:\n\n``` .xml\n<dynaBean xmlns=\"\" class=\"TestSerializationAttr$DynaBean\">\n  <prop1>val1</prop1>\n  <prop2>val2</prop2>\n</dynaBean>\n```\n\nBut we have:\n\n``` .xml\n<dynaBean xmlns=\"\" class=\"TestSerializationAttr$DynaBean\" prop1=\"val1\" prop2=\"val2\">\n</dynaBean>\n```\n\n---\n\nTest case to add in `com.fasterxml.jackson.dataformat.xml.ser.TestSerializationAttr`\n\n``` .java\n @JacksonXmlRootElement(localName = \"dynaBean\", namespace = \"\")\n    @JsonTypeInfo(use = Id.NAME, property = \"class\", include = As.PROPERTY)\n    public class DynaBean {\n\n        private final Map<String, String> _properties = new TreeMap<String, String>();\n\n        public DynaBean(Map<String, String> values) {\n            _properties.putAll(values);\n        }\n\n        @JsonAnyGetter\n        @JacksonXmlProperty(isAttribute = false)\n        public Map<String, String> getProperties() {\n            return _properties;\n        }\n    }\n\n    public void testIssue117() throws JsonProcessingException {\n        Map<String, String> values = new HashMap<String, String>();\n        values.put(\"prop1\", \"val1\");\n        values.put(\"prop2\", \"val2\");\n\n        assertEquals(\"<dynaBean xmlns=\\\"\\\" class=\\\"TestSerializationAttr$DynaBean\\\"><prop1>val1</prop1><prop2>val2</prop2></dynaBean>\",\n                     _xmlMapper.writeValueAsString(new DynaBean(values)));\n    }\n```\n\n---\n\nI believe the problem resides somewhere in XmlSerializerBase constructor where the _attributeCount does not take into account the @JsonAnyGetter.\n","closed_by":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml/issues/117/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml/issues/117/timeline","performed_via_github_app":null,"state_reason":"completed"}