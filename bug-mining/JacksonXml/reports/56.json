{"url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml/issues/469","repository_url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml","labels_url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml/issues/469/labels{/name}","comments_url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml/issues/469/comments","events_url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml/issues/469/events","html_url":"https://github.com/FasterXML/jackson-dataformat-xml/issues/469","id":863675223,"node_id":"MDU6SXNzdWU4NjM2NzUyMjM=","number":469,"title":"Empty tags cause incorrect deserialization of unwrapped lists","user":{"login":"jackson-code1","id":82931871,"node_id":"MDQ6VXNlcjgyOTMxODcx","avatar_url":"https://avatars.githubusercontent.com/u/82931871?v=4","gravatar_id":"","url":"https://api.github.com/users/jackson-code1","html_url":"https://github.com/jackson-code1","followers_url":"https://api.github.com/users/jackson-code1/followers","following_url":"https://api.github.com/users/jackson-code1/following{/other_user}","gists_url":"https://api.github.com/users/jackson-code1/gists{/gist_id}","starred_url":"https://api.github.com/users/jackson-code1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jackson-code1/subscriptions","organizations_url":"https://api.github.com/users/jackson-code1/orgs","repos_url":"https://api.github.com/users/jackson-code1/repos","events_url":"https://api.github.com/users/jackson-code1/events{/privacy}","received_events_url":"https://api.github.com/users/jackson-code1/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml/milestones/45","html_url":"https://github.com/FasterXML/jackson-dataformat-xml/milestone/45","labels_url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml/milestones/45/labels","id":6723492,"node_id":"MDk6TWlsZXN0b25lNjcyMzQ5Mg==","number":45,"title":"2.12.4","description":null,"creator":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":3,"state":"open","created_at":"2021-05-03T21:04:52Z","updated_at":"2021-07-04T01:48:15Z","due_on":null,"closed_at":null},"comments":15,"created_at":"2021-04-21T09:39:00Z","updated_at":"2021-07-29T15:53:38Z","closed_at":"2021-05-03T21:09:26Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"We spotted an issue when trying to deserialize an empty tag followed by a list property.\r\n\r\nBeans:\r\n```\r\nimport java.util.ArrayList;\r\nimport java.util.List;\r\nimport javax.xml.bind.annotation.XmlAccessType;\r\nimport javax.xml.bind.annotation.XmlAccessorType;\r\nimport javax.xml.bind.annotation.XmlAttribute;\r\nimport javax.xml.bind.annotation.XmlElement;\r\nimport javax.xml.bind.annotation.XmlRootElement;\r\nimport javax.xml.bind.annotation.XmlType;\r\n\r\n@XmlAccessorType(XmlAccessType.FIELD)\r\n@XmlType(name = \"\", propOrder = {\"middle\"})\r\n@XmlRootElement(name = \"OuterBean\", namespace = \"http://jackson.test.model\")\r\n\r\npublic class OuterBean\r\n{\r\n    @XmlElement(name = \"Middle\", namespace = \"http://jackson.test.model\")\r\n    public OuterBean.MiddleBean middle;\r\n    \r\n    @XmlAccessorType(XmlAccessType.FIELD)\r\n    @XmlType(name = \"\", propOrder = {\"inner1\", \"inner2\"})\r\n    \r\n    public static class MiddleBean\r\n    {\r\n        @XmlElement(name = \"Inner1\", namespace = \"http://jackson.test.model\")\r\n        public OuterBean.MiddleBean.InnerBean1 inner1;\r\n        @XmlElement(name = \"Inner2\", namespace = \"http://jackson.test.model\")\r\n        private List <OuterBean.MiddleBean.InnerBean2> inner2;\r\n\r\n        @XmlAccessorType(XmlAccessType.FIELD)\r\n        @XmlType(name = \"\", propOrder = {})\r\n        public static class InnerBean1\r\n        {\r\n            @XmlAttribute(name = \"Str\")\r\n            public String str;\r\n            \r\n            @XmlElement(name = \"InnerBean1Item\", namespace = \"http://jackson.test.model\")\r\n            public List <OuterBean.MiddleBean.InnerBean1.InnerBean1Item> item;\r\n          \r\n            @XmlAccessorType(XmlAccessType.FIELD)\r\n            @XmlType(name = \"\", propOrder = {})\r\n            public static class InnerBean1Item\r\n            {\r\n                @XmlAttribute(name = \"Id\")\r\n                protected String id;\r\n            }\r\n        }\r\n        @XmlAccessorType(XmlAccessType.FIELD)\r\n        @XmlType(name = \"\", propOrder = {})\r\n        public static class InnerBean2\r\n        {\r\n            @XmlAttribute(name = \"Str2\")\r\n            public String str2;\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nTest case:\r\n```\r\nimport org.junit.Before;\r\nimport org.junit.Test;\r\nimport com.fasterxml.jackson.annotation.JsonInclude.Include;\r\nimport com.fasterxml.jackson.databind.SerializationFeature;\r\nimport com.fasterxml.jackson.dataformat.xml.XmlMapper;\r\nimport com.fasterxml.jackson.module.jaxb.JaxbAnnotationIntrospector;\r\n\r\npublic class EmptyElementsTest\r\n{\r\n    XmlMapper mapper;\r\n\r\n    @Before\r\n    public void before()\r\n    {\r\n        mapper = new XmlMapper();\r\n        mapper.setSerializationInclusion(Include.NON_NULL);\r\n        mapper.enable(SerializationFeature.INDENT_OUTPUT);\r\n\r\n        mapper.setAnnotationIntrospector(new JaxbAnnotationIntrospector());\r\n    }\r\n\r\n    @Test\r\n    public void testEmptyElements() throws Exception\r\n    {\r\n\r\n        String xmlInput = \"<OuterBean xmlns='http://jackson.test.model'>\" +\r\n            \"  <Middle>\" +\r\n            \"    <Inner1/>\" +\r\n            \"    <Inner2 Str2='aaaa'/>\" +\r\n            \"  </Middle>\" +\r\n            \"</OuterBean>\";\r\n\r\n        OuterBean deserializedBean = mapper.readValue(xmlInput, OuterBean.class);\r\n        String actual = mapper.writeValueAsString(deserializedBean);\r\n        System.out.println(actual);\r\n    }\r\n}\r\n```\r\n\r\nActual output:\r\n```\r\n<OuterBean xmlns=\"http://jackson.test.model\">\r\n  <Middle>\r\n    <Inner1/>\r\n  </Middle>\r\n</OuterBean>\r\n```\r\nExpected output:\r\n```\r\n<OuterBean xmlns=\"http://jackson.test.model\">\r\n  <Middle>\r\n    <Inner1/>\r\n    <Inner2 Str2=\"aaaa\"/>\r\n  </Middle>\r\n</OuterBean>\r\n```\r\n\r\nThe problem seems to be related to deserialization, because deserializedBean has the Inner1 field value (populated with null values) but the Inner2 field does not deserialize correctly. (the deserialized Inner2 field is an empty list)\r\n\r\nIt is worth mentioning, that, if you remove the <Inner1/>from the xmlInput or if Inner1 is a non-empty tag with a valid value then the Inner2 field gets deserialized correctly. \r\n\r\nLibrary versions:\r\njackson-annotations-2.12.3.jar,\r\n jackson-core-2.12.3.jar,\r\n jackson-databind-2.12.3.jar,\r\n jackson-dataformat-xml-2.12.3.jar,\r\n jackson-module-jaxb-annotations-2.12.3.jar,\r\n\r\n","closed_by":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml/issues/469/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/FasterXML/jackson-dataformat-xml/issues/469/timeline","performed_via_github_app":null,"state_reason":"completed"}