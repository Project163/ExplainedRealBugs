{"url":"https://api.github.com/repos/typeorm/typeorm/issues/8810","repository_url":"https://api.github.com/repos/typeorm/typeorm","labels_url":"https://api.github.com/repos/typeorm/typeorm/issues/8810/labels{/name}","comments_url":"https://api.github.com/repos/typeorm/typeorm/issues/8810/comments","events_url":"https://api.github.com/repos/typeorm/typeorm/issues/8810/events","html_url":"https://github.com/typeorm/typeorm/issues/8810","id":1182025313,"node_id":"I_kwDOAyVBJc5GdEZh","number":8810,"title":"Generating migrations with cli","user":{"login":"SleeveShirtholes","id":34148154,"node_id":"MDQ6VXNlcjM0MTQ4MTU0","avatar_url":"https://avatars.githubusercontent.com/u/34148154?v=4","gravatar_id":"","url":"https://api.github.com/users/SleeveShirtholes","html_url":"https://github.com/SleeveShirtholes","followers_url":"https://api.github.com/users/SleeveShirtholes/followers","following_url":"https://api.github.com/users/SleeveShirtholes/following{/other_user}","gists_url":"https://api.github.com/users/SleeveShirtholes/gists{/gist_id}","starred_url":"https://api.github.com/users/SleeveShirtholes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SleeveShirtholes/subscriptions","organizations_url":"https://api.github.com/users/SleeveShirtholes/orgs","repos_url":"https://api.github.com/users/SleeveShirtholes/repos","events_url":"https://api.github.com/users/SleeveShirtholes/events{/privacy}","received_events_url":"https://api.github.com/users/SleeveShirtholes/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":333605711,"node_id":"MDU6TGFiZWwzMzM2MDU3MTE=","url":"https://api.github.com/repos/typeorm/typeorm/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":2454823078,"node_id":"MDU6TGFiZWwyNDU0ODIzMDc4","url":"https://api.github.com/repos/typeorm/typeorm/labels/requires%20triage","name":"requires triage","color":"f9aeb0","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":52,"created_at":"2022-03-26T19:53:08Z","updated_at":"2023-10-03T21:35:01Z","closed_at":"2023-08-19T15:39:18Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\n  Please follow the template.  If you don't, your issue may be closed.\r\n\r\n  Have a question?  This is the TypeORM issue tracker - and not the right place\r\n  for general support or questions.  Instead, check the \"Support\" Documentation\r\n  on the best places to ask questions!\r\n\r\n  https://github.com/typeorm/typeorm/blob/master/docs/support.md\r\n-->\r\n\r\n## Issue Description\r\n\r\n### Expected Behavior\r\n\r\nMigrations get generated using the cli\r\n\r\n### Actual Behavior\r\n\r\nI am following the documentation outlined here https://typeorm.io/migrations and I feel like the documentation is way different then what is actually happening in the cli. I have tried just running the following command:\r\n\r\n`typeorm migration:generate -n PostRefactoring`\r\n\r\nWhen I run this command I get the following:\r\n\r\n`Not enough non-option arguments: got 0, need at least 1`\r\n\r\nSo then I modify the command to something like this:\r\n\r\n`Missing required argument: dataSource`\r\n\r\nSo then from there I add the datasource since that is what it is asking for:\r\n\r\n`npx typeorm migration:generate test -d app-data-source.ts` (I found the -d somewhere online  while investigating this issue)\r\n\r\nBut once I run that command I get the following error:\r\n\r\n`File must contain a TypeScript / JavaScript code and export a DataSource instance.`\r\n\r\nI have been trying to get this to work for days and I am about ready to throw the towl in and use a different ORM...which I don't want to do. I know that everything is working fine because I can start up the app and the app connects to the database and creates rows in the database. So it is just something with the cli and trying to generate the migrations.\r\n\r\nHere is what is in my app-data-source.ts file:\r\n\r\n```\r\nimport { DataSource } from \"typeorm\";\r\nimport { User } from \"./entitiy/User\";\r\n\r\nconst myDataSource = new DataSource({\r\n  type: \"postgres\",\r\n  host: \"localhost\",\r\n  port: 5432,\r\n  username: \"postgres\",\r\n  password: \"\",\r\n  database: \"postgres\",\r\n  entities: [User],\r\n  migrations: [\"/migrations/\"],\r\n  logging: true,\r\n  synchronize: true,\r\n});\r\n\r\n\r\nexport default myDataSource;\r\n```\r\n\r\nThis is the contents of my app.ts file:\r\n\r\n```\r\nimport * as express from \"express\";\r\nimport { Request, Response } from \"express\";\r\nimport myDataSource from \"./app-data-source\";\r\nimport { User } from \"./entitiy/User\";\r\n\r\n// establish database connection\r\nmyDataSource\r\n  .initialize()\r\n  .then(() => {\r\n    console.log(\"Data Source has been initialized!\");\r\n  })\r\n  .catch((err) => {\r\n    console.error(\"Error during Data Source initialization:\", err);\r\n  });\r\n\r\n// create and setup express app\r\nconst app = express();\r\napp.use(express.json());\r\n\r\n// register routes\r\napp.get(\"/users\", async function (req: Request, res: Response) {\r\n  const users = await myDataSource.getRepository(User).find();\r\n  res.json(users);\r\n});\r\n\r\napp.get(\"/users/:id\", async function (req: Request, res: Response) {\r\n  const results = await myDataSource.getRepository(User).findOneBy({\r\n    id: +req.params.id,\r\n  });\r\n  return res.send(results);\r\n});\r\n\r\napp.post(\"/users\", async function (req: Request, res: Response) {\r\n  const user = await myDataSource.getRepository(User).create(req.body);\r\n  const results = await myDataSource.getRepository(User).save(user);\r\n  return res.send(results);\r\n});\r\n\r\napp.put(\"/users/:id\", async function (req: Request, res: Response) {\r\n  const user = await myDataSource.getRepository(User).findOneBy({\r\n    id: +req.params.id,\r\n  });\r\n  myDataSource.getRepository(User).merge(user, req.body);\r\n  const results = await myDataSource.getRepository(User).save(user);\r\n  return res.send(results);\r\n});\r\n\r\napp.delete(\"/users/:id\", async function (req: Request, res: Response) {\r\n  const results = await myDataSource.getRepository(User).delete(req.params.id);\r\n  return res.send(results);\r\n});\r\n\r\n// start express server\r\napp.listen(3000);\r\n```\r\n\r\nAll these files were setup using the instructions outlined in the express typeorm documentation:\r\n[Example with Express](https://typeorm.io/example-with-express)\r\n\r\nWhich BTW, this also has issues and doesn't run from what is outlined in the directions. I had to make some modifications to actually make the app run compared to what is outlined in that guide. One of the changes I made in the data source file was putting the actual Entity name in the entity property of the datasource compared to the guide that has you put the path in.\r\n\r\nAnyway, am I crazy...am I doing something wrong? You guys might not have enough information to answer the first question but can you at least help with trying to figure out how to make the migrations work?\r\n\r\n### Steps to Reproduce\r\n\r\nSet up you app using the guide outlined above to use express\r\n\r\n### My Environment\r\n\r\n| Dependency          | Version  |\r\n| ---                 | ---      |\r\n| Operating System    |  MAC OS Monterrey         |\r\n| Node.js version     | v16.14.2  | <!-- run `node -v` to obtain this -->\r\n| Typescript version  | 4.5.2  | <!-- run `npm list typescript` to obtain this -->\r\n| TypeORM version     | 0.3.4  | <!-- run `npm list typeorm` to obtain this -->\r\n\r\n### Relevant Database Driver(s)\r\n\r\n<!-- Put \"yes\" instead of \"no\" to your issue's relevant databases -->\r\n\r\n| DB Type           | Reproducible  |\r\n|-------------------| ---           |\r\n| `aurora-mysql`    | no            |\r\n| `aurora-postgres` | no            |\r\n| `better-sqlite3`  | no            |\r\n| `cockroachdb`     | no            |\r\n| `cordova`         | no            |\r\n| `expo`            | no            |\r\n| `mongodb`         | no            |\r\n| `mysql`           | no            |\r\n| `nativescript`    | no            |\r\n| `oracle`          | no            |\r\n| `postgres`        | yes            |\r\n| `react-native`    | no            |\r\n| `sap`             | no            |\r\n| `sqlite`          | no            |\r\n| `sqlite-abstract` | no            |\r\n| `sqljs`           | no            |\r\n| `sqlserver`       | no            |\r\n\r\n\r\n### Are you willing to resolve this issue by submitting a Pull Request?\r\n\r\n<!-- Put \"‚úÖ\" (:white_check_mark:) to one of these options, left \"‚úñÔ∏è\" (:heavy_multiplication_x:) others: -->\r\n\r\n - ‚úñÔ∏è Yes, I have the time, and I know how to start.\r\n - ‚úñÔ∏è Yes, I have the time, but I don't know how to start. I would need guidance.\r\n - ‚úñÔ∏è No, I don‚Äôt have the time, but I can support (using donations) development.\r\n - ‚úÖ No, I don‚Äôt have the time and I‚Äôm okay to wait for the community / maintainers to resolve this issue.\r\n\r\n\r\n<!--\r\n  Remember that first-time contributors are welcome! üôå\r\n  üëã Have a great day and thank you for the bug report!\r\n-->\r\n","closed_by":{"login":"pleerock","id":1753397,"node_id":"MDQ6VXNlcjE3NTMzOTc=","avatar_url":"https://avatars.githubusercontent.com/u/1753397?v=4","gravatar_id":"","url":"https://api.github.com/users/pleerock","html_url":"https://github.com/pleerock","followers_url":"https://api.github.com/users/pleerock/followers","following_url":"https://api.github.com/users/pleerock/following{/other_user}","gists_url":"https://api.github.com/users/pleerock/gists{/gist_id}","starred_url":"https://api.github.com/users/pleerock/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pleerock/subscriptions","organizations_url":"https://api.github.com/users/pleerock/orgs","repos_url":"https://api.github.com/users/pleerock/repos","events_url":"https://api.github.com/users/pleerock/events{/privacy}","received_events_url":"https://api.github.com/users/pleerock/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/typeorm/typeorm/issues/8810/reactions","total_count":41,"+1":41,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/typeorm/typeorm/issues/8810/timeline","performed_via_github_app":null,"state_reason":"completed"}