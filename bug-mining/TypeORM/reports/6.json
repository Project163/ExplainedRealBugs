{"url":"https://api.github.com/repos/typeorm/typeorm/issues/1883","repository_url":"https://api.github.com/repos/typeorm/typeorm","labels_url":"https://api.github.com/repos/typeorm/typeorm/issues/1883/labels{/name}","comments_url":"https://api.github.com/repos/typeorm/typeorm/issues/1883/comments","events_url":"https://api.github.com/repos/typeorm/typeorm/issues/1883/events","html_url":"https://github.com/typeorm/typeorm/issues/1883","id":311194478,"node_id":"MDU6SXNzdWUzMTExOTQ0Nzg=","number":1883,"title":"Synchronization error with default value","user":{"login":"RDeluxe","id":2767681,"node_id":"MDQ6VXNlcjI3Njc2ODE=","avatar_url":"https://avatars.githubusercontent.com/u/2767681?v=4","gravatar_id":"","url":"https://api.github.com/users/RDeluxe","html_url":"https://github.com/RDeluxe","followers_url":"https://api.github.com/users/RDeluxe/followers","following_url":"https://api.github.com/users/RDeluxe/following{/other_user}","gists_url":"https://api.github.com/users/RDeluxe/gists{/gist_id}","starred_url":"https://api.github.com/users/RDeluxe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RDeluxe/subscriptions","organizations_url":"https://api.github.com/users/RDeluxe/orgs","repos_url":"https://api.github.com/users/RDeluxe/repos","events_url":"https://api.github.com/users/RDeluxe/events{/privacy}","received_events_url":"https://api.github.com/users/RDeluxe/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"AlexMesser","id":17142628,"node_id":"MDQ6VXNlcjE3MTQyNjI4","avatar_url":"https://avatars.githubusercontent.com/u/17142628?v=4","gravatar_id":"","url":"https://api.github.com/users/AlexMesser","html_url":"https://github.com/AlexMesser","followers_url":"https://api.github.com/users/AlexMesser/followers","following_url":"https://api.github.com/users/AlexMesser/following{/other_user}","gists_url":"https://api.github.com/users/AlexMesser/gists{/gist_id}","starred_url":"https://api.github.com/users/AlexMesser/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlexMesser/subscriptions","organizations_url":"https://api.github.com/users/AlexMesser/orgs","repos_url":"https://api.github.com/users/AlexMesser/repos","events_url":"https://api.github.com/users/AlexMesser/events{/privacy}","received_events_url":"https://api.github.com/users/AlexMesser/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"AlexMesser","id":17142628,"node_id":"MDQ6VXNlcjE3MTQyNjI4","avatar_url":"https://avatars.githubusercontent.com/u/17142628?v=4","gravatar_id":"","url":"https://api.github.com/users/AlexMesser","html_url":"https://github.com/AlexMesser","followers_url":"https://api.github.com/users/AlexMesser/followers","following_url":"https://api.github.com/users/AlexMesser/following{/other_user}","gists_url":"https://api.github.com/users/AlexMesser/gists{/gist_id}","starred_url":"https://api.github.com/users/AlexMesser/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlexMesser/subscriptions","organizations_url":"https://api.github.com/users/AlexMesser/orgs","repos_url":"https://api.github.com/users/AlexMesser/repos","events_url":"https://api.github.com/users/AlexMesser/events{/privacy}","received_events_url":"https://api.github.com/users/AlexMesser/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/typeorm/typeorm/milestones/1","html_url":"https://github.com/typeorm/typeorm/milestone/1","labels_url":"https://api.github.com/repos/typeorm/typeorm/milestones/1/labels","id":2843035,"node_id":"MDk6TWlsZXN0b25lMjg0MzAzNQ==","number":1,"title":"0.2.0","description":"","creator":{"login":"pleerock","id":1753397,"node_id":"MDQ6VXNlcjE3NTMzOTc=","avatar_url":"https://avatars.githubusercontent.com/u/1753397?v=4","gravatar_id":"","url":"https://api.github.com/users/pleerock","html_url":"https://github.com/pleerock","followers_url":"https://api.github.com/users/pleerock/followers","following_url":"https://api.github.com/users/pleerock/following{/other_user}","gists_url":"https://api.github.com/users/pleerock/gists{/gist_id}","starred_url":"https://api.github.com/users/pleerock/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pleerock/subscriptions","organizations_url":"https://api.github.com/users/pleerock/orgs","repos_url":"https://api.github.com/users/pleerock/repos","events_url":"https://api.github.com/users/pleerock/events{/privacy}","received_events_url":"https://api.github.com/users/pleerock/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":149,"state":"closed","created_at":"2017-10-17T12:17:45Z","updated_at":"2025-09-18T18:17:52Z","due_on":"2018-04-01T07:00:00Z","closed_at":"2018-06-19T08:57:33Z"},"comments":5,"created_at":"2018-04-04T11:42:00Z","updated_at":"2024-01-09T07:18:39Z","closed_at":"2018-04-12T08:04:26Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Issue type:**\r\n\r\n[ ] question\r\n[x] bug report\r\n[ ] feature request\r\n[ ] documentation issue\r\n\r\n**Database system/driver:**\r\n\r\n[ ] `cordova`\r\n[ ] `mongodb`\r\n[ ] `mssql`\r\n[ ] `mysql` / `mariadb`\r\n[ ] `oracle`\r\n[x] `postgres`\r\n[ ] `sqlite`\r\n[ ] `sqljs`\r\n[ ] `websql`\r\n\r\n**TypeORM version:**\r\n\r\n[ ] `latest`\r\n[x] `@next`\r\n[ ] `0.x.x` (or put your version here)\r\n\r\n**Steps to reproduce or a small repository showing the problem:**\r\n\r\nHere is my entity : \r\n\r\n```ts\r\n@Entity()\r\n@Index(['alliance', 'user'], { unique: true })\r\nexport class AlliancePendingEntity extends BaseEntity {\r\n  @PrimaryGeneratedColumn('uuid')\r\n  public id: string\r\n\r\n  @JoinColumn({ name: 'userId' })\r\n  @ManyToOne(type => UserEntity)\r\n  public user: UserEntity\r\n\r\n  @JoinColumn({ name: 'allianceId' })\r\n  @ManyToOne(type => AllianceEntity)\r\n  public alliance: AllianceEntity\r\n\r\n  @Column('enum', { enum: PendingStatuses, default: PendingStatuses[PendingStatuses.Applicant] })\r\n  public status: PendingStatuses\r\n}\r\n```\r\n\r\nIf I have no schema created, everything is fine (well, not totally, there is still the problem of non-string enum but that's another opened issue). However, if I relaunch the server I encounter an error : \r\n\r\n```bash\r\n[1] ci-server     | query: ALTER TABLE \"user_entity\" ALTER COLUMN \"avatarId\" SET DEFAULT 'AgileHooligan1_1'\r\n[1] ci-server     | query: ALTER TYPE \"alliance_pending_entity_status_enum\" RENAME TO \"alliance_pending_entity_status_enum_old\"\r\n[1] ci-server     | query: CREATE TYPE \"alliance_pending_entity_status_enum\" AS ENUM('Invited', 'Applicant', '0', '1')\r\n[1] ci-server     | query: ALTER TABLE \"alliance_pending_entity\" ALTER COLUMN \"status\" TYPE \"alliance_pending_entity_status_enum\" USING \"status\"::\"text\"::\"alliance_pending_entity_status_enum\"\r\n[1] ci-db-new     | ERROR:  default for column \"status\" cannot be cast automatically to type alliance_pending_entity_status_enum\r\n[1] ci-db-new     | STATEMENT:  ALTER TABLE \"alliance_pending_entity\" ALTER COLUMN \"status\" TYPE \"alliance_pending_entity_status_enum\" USING \"status\"::\"text\"::\"alliance_pending_entity_status_enum\"\r\n[1] ci-server     |  query failed: ALTER TABLE \"alliance_pending_entity\" ALTER COLUMN \"status\" TYPE \"alliance_pending_entity_status_enum\" USING \"status\"::\"text\"::\"alliance_pending_entity_status_enum\"\r\n[1] ci-server     | error: { error: default for column \"status\" cannot be cast automatically to type alliance_pending_entity_status_enum\r\n[1] ci-server     |     at Connection.parseE (/home/node/app/node_modules/pg/lib/connection.js:546:11)\r\n[1] ci-server     |     at Connection.parseMessage (/home/node/app/node_modules/pg/lib/connection.js:371:19)\r\n[1] ci-server     |     at Socket.<anonymous> (/home/node/app/node_modules/pg/lib/connection.js:114:22)\r\n[1] ci-server     |     at Socket.emit (events.js:127:13)\r\n[1] ci-server     |     at Socket.emit (domain.js:421:20)\r\n[1] ci-server     |     at addChunk (_stream_readable.js:269:12)\r\n[1] ci-server     |     at readableAddChunk (_stream_readable.js:256:11)\r\n[1] ci-server     |     at Socket.Readable.push (_stream_readable.js:213:10)\r\n[1] ci-server     |     at TCP.onread (net.js:590:20)\r\n[1] ci-server     |   name: 'error',\r\n[1] ci-server     |   length: 170,\r\n[1] ci-server     |   severity: 'ERROR',\r\n[1] ci-server     |   code: '42804',\r\n[1] ci-server     |   detail: undefined,\r\n[1] ci-server     |   hint: undefined,\r\n[1] ci-server     |   position: undefined,\r\n[1] ci-server     |   internalPosition: undefined,\r\n[1] ci-server     |   internalQuery: undefined,\r\n[1] ci-server     |   where: undefined,\r\n[1] ci-server     |   schema: undefined,\r\n[1] ci-server     |   table: undefined,\r\n[1] ci-server     |   column: undefined,\r\n[1] ci-server     |   dataType: undefined,\r\n[1] ci-server     |   constraint: undefined,\r\n[1] ci-server     |   file: 'tablecmds.c',\r\n[1] ci-server     |   line: '8238',\r\n[1] ci-server     |   routine: 'ATExecAlterColumnType' }\r\n[1] ci-server     | query: ROLLBACK\r\n[1] ci-server     | { QueryFailedError: default for column \"status\" cannot be cast automatically to type alliance_pending_entity_status_enum\r\n[1] ci-server     |     at new QueryFailedError (/home/node/app/src/error/QueryFailedError.ts:7:9)\r\n[1] ci-server     |     at Query.callback (/home/node/app/src/driver/postgres/PostgresQueryRunner.ts:171:26)\r\n[1] ci-server     |     at Query.handleError (/home/node/app/node_modules/pg/lib/query.js:143:17)\r\n[1] ci-server     |     at Connection.connectedErrorHandler (/home/node/app/node_modules/pg/lib/client.js:132:26)\r\n[1] ci-server     |     at Connection.emit (events.js:127:13)\r\n[1] ci-server     |     at Connection.emit (domain.js:421:20)\r\n[1] ci-server     |     at Socket.<anonymous> (/home/node/app/node_modules/pg/lib/connection.js:118:12)\r\n[1] ci-server     |     at Socket.emit (events.js:127:13)\r\n[1] ci-server     |     at Socket.emit (domain.js:421:20)\r\n[1] ci-server     |     at addChunk (_stream_readable.js:269:12)\r\n[1] ci-server     |   message: 'default for column \"status\" cannot be cast automatically to type alliance_pending_entity_status_enum',\r\n[1] ci-server     |   name: 'QueryFailedError',\r\n[1] ci-server     |   length: 170,\r\n[1] ci-server     |   severity: 'ERROR',\r\n[1] ci-server     |   code: '42804',\r\n[1] ci-server     |   detail: undefined,\r\n[1] ci-server     |   hint: undefined,\r\n[1] ci-server     |   position: undefined,\r\n[1] ci-server     |   internalPosition: undefined,\r\n[1] ci-server     |   internalQuery: undefined,\r\n[1] ci-server     |   where: undefined,\r\n[1] ci-server     |   schema: undefined,\r\n[1] ci-server     |   table: undefined,\r\n[1] ci-server     |   column: undefined,\r\n[1] ci-server     |   dataType: undefined,\r\n[1] ci-server     |   constraint: undefined,\r\n[1] ci-server     |   file: 'tablecmds.c',\r\n[1] ci-server     |   line: '8238',\r\n[1] ci-server     |   routine: 'ATExecAlterColumnType',\r\n[1] ci-server     |   query: 'ALTER TABLE \"alliance_pending_entity\" ALTER COLUMN \"status\" TYPE \"alliance_pending_entity_status_enum\" USING \"status\"::\"text\"::\"alliance_pending_entity_status_enum\"',\r\n[1] ci-server     |   parameters: [] }\r\n```\r\n\r\nI'm not 100% sure of what is happening here, is the default value changed before the column type ? ","closed_by":{"login":"AlexMesser","id":17142628,"node_id":"MDQ6VXNlcjE3MTQyNjI4","avatar_url":"https://avatars.githubusercontent.com/u/17142628?v=4","gravatar_id":"","url":"https://api.github.com/users/AlexMesser","html_url":"https://github.com/AlexMesser","followers_url":"https://api.github.com/users/AlexMesser/followers","following_url":"https://api.github.com/users/AlexMesser/following{/other_user}","gists_url":"https://api.github.com/users/AlexMesser/gists{/gist_id}","starred_url":"https://api.github.com/users/AlexMesser/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlexMesser/subscriptions","organizations_url":"https://api.github.com/users/AlexMesser/orgs","repos_url":"https://api.github.com/users/AlexMesser/repos","events_url":"https://api.github.com/users/AlexMesser/events{/privacy}","received_events_url":"https://api.github.com/users/AlexMesser/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/typeorm/typeorm/issues/1883/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/typeorm/typeorm/issues/1883/timeline","performed_via_github_app":null,"state_reason":"completed"}