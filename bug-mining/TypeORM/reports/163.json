{"url":"https://api.github.com/repos/typeorm/typeorm/issues/9600","repository_url":"https://api.github.com/repos/typeorm/typeorm","labels_url":"https://api.github.com/repos/typeorm/typeorm/issues/9600/labels{/name}","comments_url":"https://api.github.com/repos/typeorm/typeorm/issues/9600/comments","events_url":"https://api.github.com/repos/typeorm/typeorm/issues/9600/events","html_url":"https://github.com/typeorm/typeorm/issues/9600","id":1480809801,"node_id":"I_kwDOAyVBJc5YQ11J","number":9600,"title":"[BUG]: if set closure-table primary key unsigned, it occurs FK error","user":{"login":"shkangr","id":9126488,"node_id":"MDQ6VXNlcjkxMjY0ODg=","avatar_url":"https://avatars.githubusercontent.com/u/9126488?v=4","gravatar_id":"","url":"https://api.github.com/users/shkangr","html_url":"https://github.com/shkangr","followers_url":"https://api.github.com/users/shkangr/followers","following_url":"https://api.github.com/users/shkangr/following{/other_user}","gists_url":"https://api.github.com/users/shkangr/gists{/gist_id}","starred_url":"https://api.github.com/users/shkangr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shkangr/subscriptions","organizations_url":"https://api.github.com/users/shkangr/orgs","repos_url":"https://api.github.com/users/shkangr/repos","events_url":"https://api.github.com/users/shkangr/events{/privacy}","received_events_url":"https://api.github.com/users/shkangr/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":333605711,"node_id":"MDU6TGFiZWwzMzM2MDU3MTE=","url":"https://api.github.com/repos/typeorm/typeorm/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":2454823078,"node_id":"MDU6TGFiZWwyNDU0ODIzMDc4","url":"https://api.github.com/repos/typeorm/typeorm/labels/requires%20triage","name":"requires triage","color":"f9aeb0","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2022-12-07T03:19:02Z","updated_at":"2025-06-16T21:08:09Z","closed_at":"2025-06-16T21:08:09Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Issue description\r\n\r\nI want to use closure-table and if I set primary key ( unsigned ) , error comes out when migrate shcema\r\n\r\n### Expected Behavior\r\n\r\n```\r\n@Entity()\r\n@Tree('closure-table', {\r\n  closureTableName: 'category',\r\n  ancestorColumnName: (column) => 'ancestor_' + column.propertyName,\r\n  descendantColumnName: (column) => 'descendant_' + column.propertyName,\r\n})\r\nexport class CategoryEntity {\r\n  @PrimaryGeneratedColumn('increment', { type: 'bigint', unsigned: true })\r\n  id: string\r\n}\r\n```\r\nI defined CategoryEntity like this.\r\nAnd I expected closure-table is created successfully when create table by typeorm migration\r\n\r\n### Actual Behavior\r\n\r\nwhen migrate schema, error occures below\r\n```\r\nerror: Error: Referencing column 'ancestor_id' and referenced column 'id' in foreign key constraint 'FK_ab837edaafe1cd64a7efb216db1' are incompatible.\r\nmigration-file         |     at Packet.asError (/usr/src/app/node_modules/mysql2/lib/packets/packet.js:728:17)\r\nmigration-file         |     at Query.execute (/usr/src/app/node_modules/mysql2/lib/commands/command.js:29:26)\r\nmigration-file         |     at PoolConnection.handlePacket (/usr/src/app/node_modules/mysql2/lib/connection.js:456:32)\r\nmigration-file         |     at PacketParser.onPacket (/usr/src/app/node_modules/mysql2/lib/connection.js:85:12)\r\nmigration-file         |     at PacketParser.executeStart (/usr/src/app/node_modules/mysql2/lib/packet_parser.js:75:16)\r\nmigration-file         |     at Socket.<anonymous> (/usr/src/app/node_modules/mysql2/lib/connection.js:92:25)\r\nmigration-file         |     at Socket.emit (events.js:400:28)\r\nmigration-file         |     at Socket.emit (domain.js:475:12)\r\nmigration-file         |     at addChunk (internal/streams/readable.js:293:12)\r\nmigration-file         |     at readableAddChunk (internal/streams/readable.js:267:9) {\r\nmigration-file         |   code: undefined,\r\nmigration-file         |   errno: 3780,\r\nmigration-file         |   sqlState: 'HY000',\r\nmigration-file         |   sqlMessage: \"Referencing column 'ancestor_id' and referenced column 'id' in foreign key constraint 'FK_ab837edaafe1cd64a7efb216db1' are incompatible.\",\r\nmigration-file         |   sql: 'ALTER TABLE `category_closure` ADD CONSTRAINT `FK_ab837edaafe1cd64a7efb216db1` FOREIGN KEY (`ancestor_id`) REFERENCES `category`(`id`) ON DELETE CASCADE ON UPDATE NO ACTION'\r\n```\r\n\r\n\r\n\r\n### Steps to reproduce\r\n\r\nset primary column option unsigned\r\n@PrimaryGeneratedColumn('increment', { type: 'bigint', unsigned: true })\r\n\r\nand do migraion. can reproduce\r\n\r\n### My Environment\r\n\r\n| Dependency          | Version  |\r\n| ---                 | ---      |\r\n| Node.js version     | 16.4.0  |\r\n| TypeORM version     | 0.3.11 |\r\n\r\n\r\n### Additional Context\r\n\r\nhow can I resolve this issue?\r\n\r\ncan't set any options at closure-table except tableName, ancestorColumnName, descendantColumnName\r\n\r\n\r\n### Are you willing to resolve this issue by submitting a Pull Request?\r\n\r\nYes, I have the time, and I know how to start.","closed_by":{"login":"sgarner","id":904004,"node_id":"MDQ6VXNlcjkwNDAwNA==","avatar_url":"https://avatars.githubusercontent.com/u/904004?v=4","gravatar_id":"","url":"https://api.github.com/users/sgarner","html_url":"https://github.com/sgarner","followers_url":"https://api.github.com/users/sgarner/followers","following_url":"https://api.github.com/users/sgarner/following{/other_user}","gists_url":"https://api.github.com/users/sgarner/gists{/gist_id}","starred_url":"https://api.github.com/users/sgarner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgarner/subscriptions","organizations_url":"https://api.github.com/users/sgarner/orgs","repos_url":"https://api.github.com/users/sgarner/repos","events_url":"https://api.github.com/users/sgarner/events{/privacy}","received_events_url":"https://api.github.com/users/sgarner/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/typeorm/typeorm/issues/9600/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/typeorm/typeorm/issues/9600/timeline","performed_via_github_app":null,"state_reason":"completed"}