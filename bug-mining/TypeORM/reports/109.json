{"url":"https://api.github.com/repos/typeorm/typeorm/issues/3991","repository_url":"https://api.github.com/repos/typeorm/typeorm","labels_url":"https://api.github.com/repos/typeorm/typeorm/issues/3991/labels{/name}","comments_url":"https://api.github.com/repos/typeorm/typeorm/issues/3991/comments","events_url":"https://api.github.com/repos/typeorm/typeorm/issues/3991/events","html_url":"https://github.com/typeorm/typeorm/issues/3991","id":432990363,"node_id":"MDU6SXNzdWU0MzI5OTAzNjM=","number":3991,"title":"Migration keeps changing @CreateDateColumn/@UpdateDateColumn timestamp column to same definition","user":{"login":"cowpewter","id":330175,"node_id":"MDQ6VXNlcjMzMDE3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/330175?v=4","gravatar_id":"","url":"https://api.github.com/users/cowpewter","html_url":"https://github.com/cowpewter","followers_url":"https://api.github.com/users/cowpewter/followers","following_url":"https://api.github.com/users/cowpewter/following{/other_user}","gists_url":"https://api.github.com/users/cowpewter/gists{/gist_id}","starred_url":"https://api.github.com/users/cowpewter/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowpewter/subscriptions","organizations_url":"https://api.github.com/users/cowpewter/orgs","repos_url":"https://api.github.com/users/cowpewter/repos","events_url":"https://api.github.com/users/cowpewter/events{/privacy}","received_events_url":"https://api.github.com/users/cowpewter/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":333605711,"node_id":"MDU6TGFiZWwzMzM2MDU3MTE=","url":"https://api.github.com/repos/typeorm/typeorm/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":628495539,"node_id":"MDU6TGFiZWw2Mjg0OTU1Mzk=","url":"https://api.github.com/repos/typeorm/typeorm/labels/comp:%20migrations","name":"comp: migrations","color":"1d76db","default":false,"description":null},{"id":628502779,"node_id":"MDU6TGFiZWw2Mjg1MDI3Nzk=","url":"https://api.github.com/repos/typeorm/typeorm/labels/comp:%20schema%20sync","name":"comp: schema sync","color":"1d76db","default":false,"description":null},{"id":712054471,"node_id":"MDU6TGFiZWw3MTIwNTQ0NzE=","url":"https://api.github.com/repos/typeorm/typeorm/labels/driver:%20mysql","name":"driver: mysql","color":"0052cc","default":false,"description":null},{"id":712054626,"node_id":"MDU6TGFiZWw3MTIwNTQ2MjY=","url":"https://api.github.com/repos/typeorm/typeorm/labels/driver:%20mariadb","name":"driver: mariadb","color":"0052cc","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2019-04-14T15:14:32Z","updated_at":"2024-07-22T09:36:25Z","closed_at":"2021-04-01T13:19:07Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Issue type:**\r\n\r\n[ ] question\r\n[x] bug report\r\n[ ] feature request\r\n[ ] documentation issue\r\n\r\n**Database system/driver:**\r\n\r\n[ ] `cordova`\r\n[ ] `mongodb`\r\n[ ] `mssql`\r\n[x] `mysql` / `mariadb`\r\n[ ] `oracle`\r\n[ ] `postgres`\r\n[ ] `cockroachdb`\r\n[ ] `sqlite`\r\n[ ] `sqljs`\r\n[ ] `react-native`\r\n[ ] `expo`\r\n\r\n**TypeORM version:**\r\n\r\n[ ] `latest`\r\n[ ] `@next`\r\n[x] `0.2.16` (or put your version here)\r\n\r\n**Steps to reproduce or a small repository showing the problem:**\r\n\r\nI have a bunch of tables with my create- and updateTimestamp columns defined as follows:\r\n```ts\r\n  @CreateDateColumn({ type: 'timestamp', precision: null, default: () => 'CURRENT_TIMESTAMP' })\r\n  createTimestamp: Date;\r\n\r\n  @UpdateDateColumn({ type: 'timestamp', precision: null, default: () => 'CURRENT_TIMESTAMP' })\r\n  updateTimestamp: Date;\r\n```\r\n\r\nWhen I run `migration:generate`, typeorm is repeatedly (even after running it) generating a migration file that changes the column definition to the same definition it already has. You can tell because the `up` and `down` methods do the exact same thing. I would expect the migration to be empty.\r\n\r\nExample migration file\r\n```ts\r\nimport {MigrationInterface, QueryRunner} from \"typeorm\";\r\n\r\nexport class TestTimestamps1555253092006 implements MigrationInterface {\r\n\r\n    public async up(queryRunner: QueryRunner): Promise<any> {\r\n        await queryRunner.query(\"ALTER TABLE `album` CHANGE `createTimestamp` `createTimestamp` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP\");\r\n        await queryRunner.query(\"ALTER TABLE `album` CHANGE `updateTimestamp` `updateTimestamp` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP\");\r\n    }\r\n\r\n    public async down(queryRunner: QueryRunner): Promise<any> {\r\n        await queryRunner.query(\"ALTER TABLE `album` CHANGE `updateTimestamp` `updateTimestamp` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP\");\r\n        await queryRunner.query(\"ALTER TABLE `album` CHANGE `createTimestamp` `createTimestamp` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP\");\r\n    }\r\n\r\n}\r\n```\r\n\r\nI can work around it by defining my create- and updateTimestamp columns as follows\r\n```ts\r\n  @Column('timestamp', {\r\n    default: () => 'CURRENT_TIMESTAMP',\r\n  })\r\n  createTimestamp: Date;\r\n\r\n  @Column('timestamp', {\r\n    default: () => 'CURRENT_TIMESTAMP',\r\n    onUpdate: 'CURRENT_TIMESTAMP',\r\n  })\r\n  updateTimestamp: Date;\r\n```\r\n\r\nBut it's a shame that it's not working with the `@CreateDateColumn` and `@UpdateDateColumn` decorators.\r\n\r\n<!--\r\n    To answer those questions you need to put \"x\" inside the square brackets, for example:\r\n    [x] `mysql`\r\n    [ ] `postgres`\r\n\r\n    Also, please format your code properly (by taking code blocks into ```ts .... ```)\r\n!>\r\n","closed_by":{"login":"AlexMesser","id":17142628,"node_id":"MDQ6VXNlcjE3MTQyNjI4","avatar_url":"https://avatars.githubusercontent.com/u/17142628?v=4","gravatar_id":"","url":"https://api.github.com/users/AlexMesser","html_url":"https://github.com/AlexMesser","followers_url":"https://api.github.com/users/AlexMesser/followers","following_url":"https://api.github.com/users/AlexMesser/following{/other_user}","gists_url":"https://api.github.com/users/AlexMesser/gists{/gist_id}","starred_url":"https://api.github.com/users/AlexMesser/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlexMesser/subscriptions","organizations_url":"https://api.github.com/users/AlexMesser/orgs","repos_url":"https://api.github.com/users/AlexMesser/repos","events_url":"https://api.github.com/users/AlexMesser/events{/privacy}","received_events_url":"https://api.github.com/users/AlexMesser/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/typeorm/typeorm/issues/3991/reactions","total_count":10,"+1":10,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/typeorm/typeorm/issues/3991/timeline","performed_via_github_app":null,"state_reason":"completed"}