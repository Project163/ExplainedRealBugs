{"url":"https://api.github.com/repos/typeorm/typeorm/issues/5989","repository_url":"https://api.github.com/repos/typeorm/typeorm","labels_url":"https://api.github.com/repos/typeorm/typeorm/issues/5989/labels{/name}","comments_url":"https://api.github.com/repos/typeorm/typeorm/issues/5989/comments","events_url":"https://api.github.com/repos/typeorm/typeorm/issues/5989/events","html_url":"https://github.com/typeorm/typeorm/issues/5989","id":610844310,"node_id":"MDU6SXNzdWU2MTA4NDQzMTA=","number":5989,"title":"Count returns incorrect results for multiple primary keys","user":{"login":"dsbert","id":1320090,"node_id":"MDQ6VXNlcjEzMjAwOTA=","avatar_url":"https://avatars.githubusercontent.com/u/1320090?v=4","gravatar_id":"","url":"https://api.github.com/users/dsbert","html_url":"https://github.com/dsbert","followers_url":"https://api.github.com/users/dsbert/followers","following_url":"https://api.github.com/users/dsbert/following{/other_user}","gists_url":"https://api.github.com/users/dsbert/gists{/gist_id}","starred_url":"https://api.github.com/users/dsbert/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dsbert/subscriptions","organizations_url":"https://api.github.com/users/dsbert/orgs","repos_url":"https://api.github.com/users/dsbert/repos","events_url":"https://api.github.com/users/dsbert/events{/privacy}","received_events_url":"https://api.github.com/users/dsbert/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":333605711,"node_id":"MDU6TGFiZWwzMzM2MDU3MTE=","url":"https://api.github.com/repos/typeorm/typeorm/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":712055178,"node_id":"MDU6TGFiZWw3MTIwNTUxNzg=","url":"https://api.github.com/repos/typeorm/typeorm/labels/driver:%20mssql","name":"driver: mssql","color":"0052cc","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"imnotjames","id":1551593,"node_id":"MDQ6VXNlcjE1NTE1OTM=","avatar_url":"https://avatars.githubusercontent.com/u/1551593?v=4","gravatar_id":"","url":"https://api.github.com/users/imnotjames","html_url":"https://github.com/imnotjames","followers_url":"https://api.github.com/users/imnotjames/followers","following_url":"https://api.github.com/users/imnotjames/following{/other_user}","gists_url":"https://api.github.com/users/imnotjames/gists{/gist_id}","starred_url":"https://api.github.com/users/imnotjames/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imnotjames/subscriptions","organizations_url":"https://api.github.com/users/imnotjames/orgs","repos_url":"https://api.github.com/users/imnotjames/repos","events_url":"https://api.github.com/users/imnotjames/events{/privacy}","received_events_url":"https://api.github.com/users/imnotjames/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"imnotjames","id":1551593,"node_id":"MDQ6VXNlcjE1NTE1OTM=","avatar_url":"https://avatars.githubusercontent.com/u/1551593?v=4","gravatar_id":"","url":"https://api.github.com/users/imnotjames","html_url":"https://github.com/imnotjames","followers_url":"https://api.github.com/users/imnotjames/followers","following_url":"https://api.github.com/users/imnotjames/following{/other_user}","gists_url":"https://api.github.com/users/imnotjames/gists{/gist_id}","starred_url":"https://api.github.com/users/imnotjames/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imnotjames/subscriptions","organizations_url":"https://api.github.com/users/imnotjames/orgs","repos_url":"https://api.github.com/users/imnotjames/repos","events_url":"https://api.github.com/users/imnotjames/events{/privacy}","received_events_url":"https://api.github.com/users/imnotjames/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":2,"created_at":"2020-05-01T16:36:39Z","updated_at":"2020-10-09T06:22:08Z","closed_at":"2020-10-09T06:22:08Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"When using an entity with multiple primary keys, `count()` can return an incorrect result. \r\n\r\nThe current behavior of count with primary keys is to `concat` the two keys together and then count the distinct result of that. If the primary keys are of the same data type and can contain the same values, this will result in an incorrect count. See below for an example.\r\n\r\nThere are other reasons why the current method of `concat` is not desirable, particular regarding performance as it causes indexes to be ignored.\r\n\r\nSome related issues\r\n\r\n- #5314 \r\n- #4550\r\n- #2535\r\n\r\n**Issue type:**\r\n\r\n[ ] question\r\n[X] bug report\r\n[ ] feature request\r\n[ ] documentation issue\r\n\r\n**Database system/driver:**\r\n\r\n[ ] `cordova`\r\n[ ] `mongodb`\r\n[X] `mssql`\r\n[ ] `mysql` / `mariadb`\r\n[ ] `oracle`\r\n[ ] `postgres`\r\n[ ] `cockroachdb`\r\n[ ] `sqlite`\r\n[ ] `sqljs`\r\n[ ] `react-native`\r\n[ ] `expo`\r\n\r\n**TypeORM version:**\r\n\r\n[X] `latest`\r\n[ ] `@next`\r\n[ ] `0.x.x` (or put your version here)\r\n\r\n**Steps to reproduce or a small repository showing the problem:**\r\n\r\nThe following example incorrectly returns a count of `1` when there are `2` records\r\n\r\n```ts\r\n@Entity()\r\nexport class MyEntity {\r\n\t@PrimaryColumn()\r\n\tfield1: number;\r\n\r\n\t@PrimaryColumn()\r\n\tfield2: number;\r\n}\r\n```\r\n\r\n```js\r\n{\r\n\tfield1: 11,\r\n\tfield2: 101\r\n\t// concat(field1, field2) = '11101'\r\n},\r\n{\r\n\tfield1: 1,\r\n\tfield2: 1101\r\n\t// concat(field1, field2) = '11101'\r\n},\r\n```\r\n\r\n<!--\r\n    To answer those questions you need to put \"x\" inside the square brackets, for example:\r\n    [x] `mysql`\r\n    [ ] `postgres`\r\n\r\n    Also, please format your code properly (by taking code blocks into ```ts .... ```)\r\n--!>\r\n","closed_by":{"login":"pleerock","id":1753397,"node_id":"MDQ6VXNlcjE3NTMzOTc=","avatar_url":"https://avatars.githubusercontent.com/u/1753397?v=4","gravatar_id":"","url":"https://api.github.com/users/pleerock","html_url":"https://github.com/pleerock","followers_url":"https://api.github.com/users/pleerock/followers","following_url":"https://api.github.com/users/pleerock/following{/other_user}","gists_url":"https://api.github.com/users/pleerock/gists{/gist_id}","starred_url":"https://api.github.com/users/pleerock/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pleerock/subscriptions","organizations_url":"https://api.github.com/users/pleerock/orgs","repos_url":"https://api.github.com/users/pleerock/repos","events_url":"https://api.github.com/users/pleerock/events{/privacy}","received_events_url":"https://api.github.com/users/pleerock/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/typeorm/typeorm/issues/5989/reactions","total_count":3,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"timeline_url":"https://api.github.com/repos/typeorm/typeorm/issues/5989/timeline","performed_via_github_app":null,"state_reason":"completed"}