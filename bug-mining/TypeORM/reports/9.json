{"url":"https://api.github.com/repos/typeorm/typeorm/issues/1972","repository_url":"https://api.github.com/repos/typeorm/typeorm","labels_url":"https://api.github.com/repos/typeorm/typeorm/issues/1972/labels{/name}","comments_url":"https://api.github.com/repos/typeorm/typeorm/issues/1972/comments","events_url":"https://api.github.com/repos/typeorm/typeorm/issues/1972/events","html_url":"https://github.com/typeorm/typeorm/issues/1972","id":315985116,"node_id":"MDU6SXNzdWUzMTU5ODUxMTY=","number":1972,"title":"[Bug][MySQL][Entity] STI problem - empty columns","user":{"login":"rootsher","id":4412263,"node_id":"MDQ6VXNlcjQ0MTIyNjM=","avatar_url":"https://avatars.githubusercontent.com/u/4412263?v=4","gravatar_id":"","url":"https://api.github.com/users/rootsher","html_url":"https://github.com/rootsher","followers_url":"https://api.github.com/users/rootsher/followers","following_url":"https://api.github.com/users/rootsher/following{/other_user}","gists_url":"https://api.github.com/users/rootsher/gists{/gist_id}","starred_url":"https://api.github.com/users/rootsher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rootsher/subscriptions","organizations_url":"https://api.github.com/users/rootsher/orgs","repos_url":"https://api.github.com/users/rootsher/repos","events_url":"https://api.github.com/users/rootsher/events{/privacy}","received_events_url":"https://api.github.com/users/rootsher/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":333605711,"node_id":"MDU6TGFiZWwzMzM2MDU3MTE=","url":"https://api.github.com/repos/typeorm/typeorm/labels/bug","name":"bug","color":"fc2929","default":true,"description":null}],"state":"closed","locked":false,"assignee":{"login":"pleerock","id":1753397,"node_id":"MDQ6VXNlcjE3NTMzOTc=","avatar_url":"https://avatars.githubusercontent.com/u/1753397?v=4","gravatar_id":"","url":"https://api.github.com/users/pleerock","html_url":"https://github.com/pleerock","followers_url":"https://api.github.com/users/pleerock/followers","following_url":"https://api.github.com/users/pleerock/following{/other_user}","gists_url":"https://api.github.com/users/pleerock/gists{/gist_id}","starred_url":"https://api.github.com/users/pleerock/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pleerock/subscriptions","organizations_url":"https://api.github.com/users/pleerock/orgs","repos_url":"https://api.github.com/users/pleerock/repos","events_url":"https://api.github.com/users/pleerock/events{/privacy}","received_events_url":"https://api.github.com/users/pleerock/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"pleerock","id":1753397,"node_id":"MDQ6VXNlcjE3NTMzOTc=","avatar_url":"https://avatars.githubusercontent.com/u/1753397?v=4","gravatar_id":"","url":"https://api.github.com/users/pleerock","html_url":"https://github.com/pleerock","followers_url":"https://api.github.com/users/pleerock/followers","following_url":"https://api.github.com/users/pleerock/following{/other_user}","gists_url":"https://api.github.com/users/pleerock/gists{/gist_id}","starred_url":"https://api.github.com/users/pleerock/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pleerock/subscriptions","organizations_url":"https://api.github.com/users/pleerock/orgs","repos_url":"https://api.github.com/users/pleerock/repos","events_url":"https://api.github.com/users/pleerock/events{/privacy}","received_events_url":"https://api.github.com/users/pleerock/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":4,"created_at":"2018-04-19T18:13:46Z","updated_at":"2018-04-24T09:55:25Z","closed_at":"2018-04-24T09:52:17Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Issue type:**\r\n\r\n[x] question\r\n[x] bug report\r\n[ ] feature request\r\n[ ] documentation issue\r\n\r\n**Database system/driver:**\r\n\r\n[ ] `cordova`\r\n[ ] `mongodb`\r\n[ ] `mssql`\r\n[x] `mysql` / `mariadb`\r\n[ ] `oracle`\r\n[ ] `postgres`\r\n[ ] `sqlite`\r\n[ ] `sqljs`\r\n[ ] `react-native`\r\n\r\n**TypeORM version:**\r\n\r\n[ ] `latest`\r\n[x] `@next`\r\n[ ] `0.x.x` (or put your version here)\r\n\r\n**Explanation:**\r\n\r\nWe have the following entities:\r\n\r\n```ts\r\n// ~/src/Entity/User.ts\r\n\r\n@Entity()\r\nexport class User {\r\n    @PrimaryGeneratedColumn()\r\n    public id: number;\r\n\r\n    @Column()\r\n    public name: string;\r\n\r\n    constructor(user?: { name: string }) {\r\n        if (user) {\r\n            this.name = user.name;\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n```ts\r\n// ~/src/Entity/Tournament/Participant/TournamentParticipant.ts\r\n\r\n@Entity()\r\n@TableInheritance({\r\n    pattern: \"STI\",\r\n    column: {\r\n        name: \"type\",\r\n        type: \"varchar\",\r\n    },\r\n})\r\nexport abstract class TournamentParticipant {\r\n    @PrimaryGeneratedColumn()\r\n    public id: number;\r\n}\r\n```\r\n\r\n```ts\r\n// ~/src/Entity/Tournament/Participant/TournamentUserParticipant.ts\r\n\r\n@ChildEntity()\r\nexport class TournamentUserParticipant extends TournamentParticipant {\r\n    @OneToOne(type => User, {\r\n        eager: true,\r\n    })\r\n    @JoinColumn()\r\n    public user: User;\r\n\r\n    constructor(tournamentUserParticipant?: { user: User }) {\r\n        super();\r\n\r\n        if (tournamentUserParticipant) {\r\n            this.user = tournamentUserParticipant.user;\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n```ts\r\n// ~/src/Entity/Tournament/Participant/TournamentSquadParticipant.ts\r\n\r\n@ChildEntity()\r\nexport class TournamentSquadParticipant extends TournamentParticipant {\r\n    @OneToOne(type => User, {\r\n        eager: true,\r\n    })\r\n    @JoinColumn()\r\n    public owner: User;\r\n\r\n    @ManyToMany(type => User, {\r\n        eager: true,\r\n    })\r\n    @JoinTable({name: \"tournament_squad_participants\"})\r\n    public users: User[];\r\n\r\n    constructor(tournamentSquadParticipant?: { users: User[], owner: User }) {\r\n        super();\r\n\r\n        if (tournamentSquadParticipant) {\r\n            this.users = tournamentSquadParticipant.users;\r\n            this.owner = tournamentSquadParticipant.owner;\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nWith these entities, the following tables are created for us:\r\n\r\n* user (`id;name`)\r\n* tournament_participant (`id;type;user_id;owner_id`)\r\n* tournament_squad_participants (`tournament_participant_id;user_id`)\r\n\r\nBelow is a code that creates a record in the `user` and `tournament_participant` table:\r\n\r\n```ts\r\nconst user = new User({\r\n    name: 'example user',\r\n});\r\nawait connection.manager.save(user);\r\n\r\nconst tournamentUserParticipant = new TournamentUserParticipant({ user });\r\nawait connection.manager.save(tournamentUserParticipant);\r\n\r\nconst tournamentSquadParticipant = new TournamentSquadParticipant({\r\n    users: [ user ],\r\n    owner: user,\r\n});\r\nawait connection.manager.save(tournamentSquadParticipant);\r\n```\r\n\r\nAfter setting the property `{ logging: true }` in `ormconfig.json`, we have the possibility to see the transaction that is making the recording. Below you will find the generated log:\r\n\r\n```\r\nquery: START TRANSACTION\r\nquery: INSERT INTO `user`(`name`) VALUES (?) -- PARAMETERS: [\"example user\"]\r\nquery: COMMIT\r\nquery: START TRANSACTION\r\nquery: INSERT INTO `tournament_participant`(`type`) VALUES (?) -- PARAMETERS: [\"TournamentUserParticipant\"]\r\nquery: COMMIT\r\nquery: START TRANSACTION\r\nquery: INSERT INTO `tournament_participant`(`type`) VALUES (?) -- PARAMETERS: [\"TournamentSquadParticipant\"]\r\nquery: INSERT INTO `tournament_squad_participants`(`tournamentParticipantId`, `userId`) VALUES (?, ?) -- PARAMETERS: [2,1]\r\n``` \r\n\r\nHowever, in the `tournament_participant` table, the `userId` and `ownerId` columns are empty. Why?","closed_by":{"login":"pleerock","id":1753397,"node_id":"MDQ6VXNlcjE3NTMzOTc=","avatar_url":"https://avatars.githubusercontent.com/u/1753397?v=4","gravatar_id":"","url":"https://api.github.com/users/pleerock","html_url":"https://github.com/pleerock","followers_url":"https://api.github.com/users/pleerock/followers","following_url":"https://api.github.com/users/pleerock/following{/other_user}","gists_url":"https://api.github.com/users/pleerock/gists{/gist_id}","starred_url":"https://api.github.com/users/pleerock/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pleerock/subscriptions","organizations_url":"https://api.github.com/users/pleerock/orgs","repos_url":"https://api.github.com/users/pleerock/repos","events_url":"https://api.github.com/users/pleerock/events{/privacy}","received_events_url":"https://api.github.com/users/pleerock/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/typeorm/typeorm/issues/1972/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/typeorm/typeorm/issues/1972/timeline","performed_via_github_app":null,"state_reason":"completed"}