{"url":"https://api.github.com/repos/typeorm/typeorm/issues/7276","repository_url":"https://api.github.com/repos/typeorm/typeorm","labels_url":"https://api.github.com/repos/typeorm/typeorm/issues/7276/labels{/name}","comments_url":"https://api.github.com/repos/typeorm/typeorm/issues/7276/comments","events_url":"https://api.github.com/repos/typeorm/typeorm/issues/7276/events","html_url":"https://github.com/typeorm/typeorm/issues/7276","id":786271759,"node_id":"MDU6SXNzdWU3ODYyNzE3NTk=","number":7276,"title":"Schema sync not able to find diff correctly and executes same queries on every run","user":{"login":"codeslayer1","id":11829647,"node_id":"MDQ6VXNlcjExODI5NjQ3","avatar_url":"https://avatars.githubusercontent.com/u/11829647?v=4","gravatar_id":"","url":"https://api.github.com/users/codeslayer1","html_url":"https://github.com/codeslayer1","followers_url":"https://api.github.com/users/codeslayer1/followers","following_url":"https://api.github.com/users/codeslayer1/following{/other_user}","gists_url":"https://api.github.com/users/codeslayer1/gists{/gist_id}","starred_url":"https://api.github.com/users/codeslayer1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codeslayer1/subscriptions","organizations_url":"https://api.github.com/users/codeslayer1/orgs","repos_url":"https://api.github.com/users/codeslayer1/repos","events_url":"https://api.github.com/users/codeslayer1/events{/privacy}","received_events_url":"https://api.github.com/users/codeslayer1/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":333605711,"node_id":"MDU6TGFiZWwzMzM2MDU3MTE=","url":"https://api.github.com/repos/typeorm/typeorm/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":628502779,"node_id":"MDU6TGFiZWw2Mjg1MDI3Nzk=","url":"https://api.github.com/repos/typeorm/typeorm/labels/comp:%20schema%20sync","name":"comp: schema sync","color":"1d76db","default":false,"description":null},{"id":2454823078,"node_id":"MDU6TGFiZWwyNDU0ODIzMDc4","url":"https://api.github.com/repos/typeorm/typeorm/labels/requires%20triage","name":"requires triage","color":"f9aeb0","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"AlexMesser","id":17142628,"node_id":"MDQ6VXNlcjE3MTQyNjI4","avatar_url":"https://avatars.githubusercontent.com/u/17142628?v=4","gravatar_id":"","url":"https://api.github.com/users/AlexMesser","html_url":"https://github.com/AlexMesser","followers_url":"https://api.github.com/users/AlexMesser/followers","following_url":"https://api.github.com/users/AlexMesser/following{/other_user}","gists_url":"https://api.github.com/users/AlexMesser/gists{/gist_id}","starred_url":"https://api.github.com/users/AlexMesser/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlexMesser/subscriptions","organizations_url":"https://api.github.com/users/AlexMesser/orgs","repos_url":"https://api.github.com/users/AlexMesser/repos","events_url":"https://api.github.com/users/AlexMesser/events{/privacy}","received_events_url":"https://api.github.com/users/AlexMesser/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"AlexMesser","id":17142628,"node_id":"MDQ6VXNlcjE3MTQyNjI4","avatar_url":"https://avatars.githubusercontent.com/u/17142628?v=4","gravatar_id":"","url":"https://api.github.com/users/AlexMesser","html_url":"https://github.com/AlexMesser","followers_url":"https://api.github.com/users/AlexMesser/followers","following_url":"https://api.github.com/users/AlexMesser/following{/other_user}","gists_url":"https://api.github.com/users/AlexMesser/gists{/gist_id}","starred_url":"https://api.github.com/users/AlexMesser/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlexMesser/subscriptions","organizations_url":"https://api.github.com/users/AlexMesser/orgs","repos_url":"https://api.github.com/users/AlexMesser/repos","events_url":"https://api.github.com/users/AlexMesser/events{/privacy}","received_events_url":"https://api.github.com/users/AlexMesser/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":0,"created_at":"2021-01-14T19:50:32Z","updated_at":"2021-04-17T13:57:03Z","closed_at":"2021-04-17T13:57:03Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\n  Please follow the template.  If you don't, your issue may be closed.\r\n\r\n  Have a question?  This is the TypeORM issue tracker - and not the right place\r\n  for general support or questions.  Instead, check the \"Support\" Documentation\r\n  on the best places to ask questions!\r\n\r\n  https://github.com/typeorm/typeorm/blob/master/docs/support.md\r\n-->\r\n\r\n## Issue Description\r\nI am migrating an existing Postgres DB to Typeorm. I generated the entities using this [package](https://www.npmjs.com/package/typeorm-model-generator). My entities were generated correctly and schema sync was also able to recreate all my tables on a fresh instance. But the problem is that if I try to run schema:sync again, it starts executing the same queries again even though all the tables & constraints are already there. \r\n\r\nAttaching one of my entity files\r\n```\r\nimport { Column, Entity, Index } from 'typeorm';\r\n\r\n@Index('cluster_clu_created_fef900_idx', ['created_at'], {})\r\n@Index('cluster_cluster_pkey', ['uuid'], { unique: true })\r\n@Entity('cluster_cluster', { schema: 'public' })\r\nexport class ClusterCluster {\r\n  @Column('uuid', { primary: true, name: 'uuid' })\r\n  uuid: string;\r\n\r\n  @Column('timestamp with time zone', { name: 'created_at' })\r\n  created_at: Date;\r\n\r\n  @Column('timestamp with time zone', { name: 'updated_at' })\r\n  updated_at: Date;\r\n\r\n  @Column('character varying', { name: 'category', length: 30 })\r\n  category: string;\r\n\r\n  @Column('character varying', { name: 'parent', length: 255 })\r\n  parent: string;\r\n\r\n  @Column('varchar', { name: 'children', array: true })\r\n  children: string[];\r\n}\r\n```\r\n\r\nI tried to look into existing issues and found one similar issue #3907 . On removing the `{ schema: 'public' }` from my entities, the create table queries were fixed & not getting recreated but the indexes and constraints are still getting dropped & recreated. Also I don't think removing schema is a permanent solution since I wish to use multiple schemas. Could someone point me in the right direction here. Thanks.\r\n\r\n### Expected Behavior\r\n\r\n<!--\r\n  A clear and concise description of what you expected to happen.\r\n-->\r\nThe create table/indexes/constraints queries to be executed on first schema sync and thereafter no queries should be executed if no entity changes are present\r\n\r\n### Actual Behavior\r\nCheck issue description\r\n<!--\r\n  A clear and concise description of what actually happened.\r\n\r\n  Please wrap any error messages or output in code tags, instead of images.\r\n-->\r\n\r\n### Steps to Reproduce\r\nNot sure. I guess creating any entity with schema decorator could result in this issue.\r\n<!--\r\n  Your bug will be investigated much faster if we can run your code and it doesn't\r\n  have dependencies other than TypeORM. Issues without reproduction steps or\r\n  code examples may be closed as not actionable.\r\n\r\n  Please try to provide a Minimal, Complete, and Verifiable example.\r\n  http://stackoverflow.com/help/mcve\r\n-->\r\n\r\n### My Environment\r\n\r\n<!--\r\n  Please add any other relevant dependencies to this table at the end.\r\n  For example: Electron, React Native, or NestJS.\r\n-->\r\n| Dependency          | Version  |\r\n| ---                 | ---      |\r\n| Operating System    |  Mac   |\r\n| Node.js version     | v12.16.3 | <!-- run `node -v` to obtain this -->\r\n| Typescript version  | v4.1.3  | <!-- run `npm list typescript` to obtain this -->\r\n| TypeORM version     | v0.2.29 | <!-- run `npm list typeorm` to obtain this -->\r\n| Project    |    Nest.js      |\r\n\r\n### Additional Context\r\n\r\n<!--\r\n  Add any other context about the bug report here.\r\n-->\r\n\r\n\r\n### Relevant Database Driver(s)\r\n\r\n<!--\r\n  Please include the relevant database drivers to your issue.\r\n\r\n  Please include an `x` inside the brackets like so:\r\n\r\n  - [ ] `cockroachdb`\r\n  - [x] `cordova`\r\n  - [ ] `expo`\r\n-->\r\n\r\n- [ ] `aurora-data-api`\r\n- [ ] `aurora-data-api-pg`\r\n- [ ] `better-sqlite3`\r\n- [ ] `cockroachdb`\r\n- [ ] `cordova`\r\n- [ ] `expo`\r\n- [ ] `mongodb`\r\n- [ ] `mysql`\r\n- [ ] `nativescript`\r\n- [ ] `oracle`\r\n- [x] `postgres`\r\n- [ ] `react-native`\r\n- [ ] `sap`\r\n- [ ] `sqlite`\r\n- [ ] `sqlite-abstract`\r\n- [ ] `sqljs`\r\n- [ ] `sqlserver`\r\n\r\n\r\n### Are you willing to resolve this issue by submitting a Pull Request?\r\n\r\n<!--\r\n  Remember that first-time contributors are welcome! ðŸ™Œ\r\n-->\r\n\r\n- [ ] Yes, I have the time, and I know how to start.\r\n- [x] Yes, I have the time, but I don't know how to start. I would need guidance.\r\n- [ ] No, I don't have the time, although I believe I could do it if I had the time...\r\n- [ ] No, I don't have the time and I wouldn't even know how to start.\r\n\r\n\r\n<!--\r\n  ðŸ‘‹ Have a great day and thank you for the bug report!\r\n-->\r\n","closed_by":{"login":"AlexMesser","id":17142628,"node_id":"MDQ6VXNlcjE3MTQyNjI4","avatar_url":"https://avatars.githubusercontent.com/u/17142628?v=4","gravatar_id":"","url":"https://api.github.com/users/AlexMesser","html_url":"https://github.com/AlexMesser","followers_url":"https://api.github.com/users/AlexMesser/followers","following_url":"https://api.github.com/users/AlexMesser/following{/other_user}","gists_url":"https://api.github.com/users/AlexMesser/gists{/gist_id}","starred_url":"https://api.github.com/users/AlexMesser/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlexMesser/subscriptions","organizations_url":"https://api.github.com/users/AlexMesser/orgs","repos_url":"https://api.github.com/users/AlexMesser/repos","events_url":"https://api.github.com/users/AlexMesser/events{/privacy}","received_events_url":"https://api.github.com/users/AlexMesser/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/typeorm/typeorm/issues/7276/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/typeorm/typeorm/issues/7276/timeline","performed_via_github_app":null,"state_reason":"completed"}