{"url":"https://api.github.com/repos/typeorm/typeorm/issues/2518","repository_url":"https://api.github.com/repos/typeorm/typeorm","labels_url":"https://api.github.com/repos/typeorm/typeorm/issues/2518/labels{/name}","comments_url":"https://api.github.com/repos/typeorm/typeorm/issues/2518/comments","events_url":"https://api.github.com/repos/typeorm/typeorm/issues/2518/events","html_url":"https://github.com/typeorm/typeorm/issues/2518","id":341202526,"node_id":"MDU6SXNzdWUzNDEyMDI1MjY=","number":2518,"title":"TreeRepository.findDescendantsTree does not load descendants when relationship id property exist","user":{"login":"csapinoso","id":5817734,"node_id":"MDQ6VXNlcjU4MTc3MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/5817734?v=4","gravatar_id":"","url":"https://api.github.com/users/csapinoso","html_url":"https://github.com/csapinoso","followers_url":"https://api.github.com/users/csapinoso/followers","following_url":"https://api.github.com/users/csapinoso/following{/other_user}","gists_url":"https://api.github.com/users/csapinoso/gists{/gist_id}","starred_url":"https://api.github.com/users/csapinoso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/csapinoso/subscriptions","organizations_url":"https://api.github.com/users/csapinoso/orgs","repos_url":"https://api.github.com/users/csapinoso/repos","events_url":"https://api.github.com/users/csapinoso/events{/privacy}","received_events_url":"https://api.github.com/users/csapinoso/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":628519714,"node_id":"MDU6TGFiZWw2Mjg1MTk3MTQ=","url":"https://api.github.com/repos/typeorm/typeorm/labels/comp:%20tree%20tables","name":"comp: tree tables","color":"1d76db","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2018-07-14T02:45:15Z","updated_at":"2018-11-29T21:24:28Z","closed_at":"2018-10-27T17:24:27Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Issue type:**\r\n\r\n[ ] question\r\n[x] bug report\r\n[ ] feature request\r\n[ ] documentation issue\r\n\r\n**Database system/driver:**\r\n\r\n[ ] `cordova`\r\n[ ] `mongodb`\r\n[ ] `mssql`\r\n[ ] `mysql` / `mariadb`\r\n[ ] `oracle`\r\n[x] `postgres`\r\n[ ] `sqlite`\r\n[ ] `sqljs`\r\n[ ] `react-native`\r\n[ ] `expo`\r\n\r\n**TypeORM version:**\r\n\r\n[x] `latest`\r\n[ ] `@next`\r\n[ ] `0.x.x` (or put your version here)\r\n\r\n**Steps to reproduce or a small repository showing the problem:**\r\nCreate a tree entity like so, having a property for the parentId causes the findDescendantsTree not to load the children. The query executes correctly but TreeRepository.createRelationMaps() fails to grab the parentId since givenDatabaseName property on the on the joinColumn instance does not exist.\r\n\r\n```ts \r\n@Entity()\r\n@Tree('closure-table')\r\nexport class File {\r\n  @PrimaryGeneratedColumn() id: number;\r\n\r\n  @Column('text', {\r\n    nullable: false,\r\n    name: 'name',\r\n  })\r\n  name: string;\r\n\r\n  @Column('integer', {\r\n    nullable: true,\r\n  })\r\n  parentId: number;\r\n\r\n  @TreeParent() parent: File;\r\n\r\n  @TreeChildren() children: File[];\r\n}\r\n```\r\nIf you remove the parentId property on the entity, the issue disappears, but having that parentId property accessible is a valid use case in my opinion similar to how the ManyToOne relationship allows it. \r\n\r\nI tried fixing the issue by changing line 253 of TreeRepository from\r\n```ts\r\nparentId: rawResult[alias + \"_\" + this.metadata.treeParentRelation!.joinColumns[0].givenDatabaseName]\r\n```\r\nto\r\n```ts\r\nparentId: rawResult[alias + \"_\" + this.metadata.treeParentRelation!.joinColumns[0].databaseName]\r\n```\r\nbut I am uncertain how this affects other features especially when using a different naming strategy.\r\n\r\nPlease confirm if this is a bug or am I doing something wrong with my Tree Entity. Thank you!","closed_by":{"login":"pleerock","id":1753397,"node_id":"MDQ6VXNlcjE3NTMzOTc=","avatar_url":"https://avatars.githubusercontent.com/u/1753397?v=4","gravatar_id":"","url":"https://api.github.com/users/pleerock","html_url":"https://github.com/pleerock","followers_url":"https://api.github.com/users/pleerock/followers","following_url":"https://api.github.com/users/pleerock/following{/other_user}","gists_url":"https://api.github.com/users/pleerock/gists{/gist_id}","starred_url":"https://api.github.com/users/pleerock/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pleerock/subscriptions","organizations_url":"https://api.github.com/users/pleerock/orgs","repos_url":"https://api.github.com/users/pleerock/repos","events_url":"https://api.github.com/users/pleerock/events{/privacy}","received_events_url":"https://api.github.com/users/pleerock/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/typeorm/typeorm/issues/2518/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/typeorm/typeorm/issues/2518/timeline","performed_via_github_app":null,"state_reason":"completed"}