{"url":"https://api.github.com/repos/typeorm/typeorm/issues/3685","repository_url":"https://api.github.com/repos/typeorm/typeorm","labels_url":"https://api.github.com/repos/typeorm/typeorm/issues/3685/labels{/name}","comments_url":"https://api.github.com/repos/typeorm/typeorm/issues/3685/comments","events_url":"https://api.github.com/repos/typeorm/typeorm/issues/3685/events","html_url":"https://github.com/typeorm/typeorm/issues/3685","id":412871520,"node_id":"MDU6SXNzdWU0MTI4NzE1MjA=","number":3685,"title":"Brackets syntax failed when use where with object literal","user":{"login":"vietthang","id":1080481,"node_id":"MDQ6VXNlcjEwODA0ODE=","avatar_url":"https://avatars.githubusercontent.com/u/1080481?v=4","gravatar_id":"","url":"https://api.github.com/users/vietthang","html_url":"https://github.com/vietthang","followers_url":"https://api.github.com/users/vietthang/followers","following_url":"https://api.github.com/users/vietthang/following{/other_user}","gists_url":"https://api.github.com/users/vietthang/gists{/gist_id}","starred_url":"https://api.github.com/users/vietthang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vietthang/subscriptions","organizations_url":"https://api.github.com/users/vietthang/orgs","repos_url":"https://api.github.com/users/vietthang/repos","events_url":"https://api.github.com/users/vietthang/events{/privacy}","received_events_url":"https://api.github.com/users/vietthang/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":333605711,"node_id":"MDU6TGFiZWwzMzM2MDU3MTE=","url":"https://api.github.com/repos/typeorm/typeorm/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":628504132,"node_id":"MDU6TGFiZWw2Mjg1MDQxMzI=","url":"https://api.github.com/repos/typeorm/typeorm/labels/comp:%20query%20builder","name":"comp: query builder","color":"1d76db","default":false,"description":null},{"id":712054568,"node_id":"MDU6TGFiZWw3MTIwNTQ1Njg=","url":"https://api.github.com/repos/typeorm/typeorm/labels/driver:%20postgres","name":"driver: postgres","color":"0052cc","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":12,"created_at":"2019-02-21T11:12:28Z","updated_at":"2023-09-19T18:02:06Z","closed_at":"2020-10-08T06:29:52Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Issue type:**\r\n\r\n[ ] question\r\n[x ] bug report\r\n[ ] feature request\r\n[ ] documentation issue\r\n\r\n**Database system/driver:**\r\n\r\n[ ] `cordova`\r\n[ ] `mongodb`\r\n[ ] `mssql`\r\n[ ] `mysql` / `mariadb`\r\n[ ] `oracle`\r\n[x ] `postgres`\r\n[ ] `sqlite`\r\n[ ] `sqljs`\r\n[ ] `react-native`\r\n[ ] `expo`\r\n\r\n**TypeORM version:**\r\n\r\n[ ] `latest`\r\n[ ] `@next`\r\n[ x] `0.2.12` (or put your version here)\r\n\r\n**Steps to reproduce or a small repository showing the problem:**\r\n\r\nWhen I use Brackets syntax with object literal as below:\r\n\r\n```ts\r\nconst generatedSql = entityManager\r\n    .createQueryBuilder()\r\n    .from(Product, 'Product')\r\n    .where(new Brackets(qb => qb.where({ id: 1 })))\r\n```\r\n\r\nI got exception:\r\n\r\n```\r\n(node:97360) UnhandledPromiseRejectionWarning: TypeError: Cannot read property 'hasMetadata' of undefined\r\n    at SelectQueryBuilder.QueryBuilder.computeWhereParameter (/Users/thangnv/Develop/typeorm-report/src/query-builder/QueryBuilder.ts:763:47)\r\n    at SelectQueryBuilder.where (/Users/thangnv/Develop/typeorm-report/src/query-builder/SelectQueryBuilder.ts:690:32)\r\n    at Brackets.entityManager.createQueryBuilder.from.where.typeorm_1.Brackets.qb [as whereFactory] (/Users/thangnv/Develop/typeorm-report/src/test.ts:27:34)\r\n    at SelectQueryBuilder.QueryBuilder.computeWhereParameter (/Users/thangnv/Develop/typeorm-report/src/query-builder/QueryBuilder.ts:750:19)\r\n    at SelectQueryBuilder.where (/Users/thangnv/Develop/typeorm-report/src/query-builder/SelectQueryBuilder.ts:690:32)\r\n    at test (/Users/thangnv/Develop/typeorm-report/src/test.ts:27:6)\r\n    at process._tickCallback (internal/process/next_tick.js:68:7)\r\n```\r\n\r\nFrom my quick research, the issue come from this line:\r\n\r\n```ts\r\nif (this.expressionMap.mainAlias!.hasMetadata) {\r\n```\r\n\r\nSeem like omit null check in `mainAlias` causes this issue.\r\n\r\nThanks,","closed_by":{"login":"imnotjames","id":1551593,"node_id":"MDQ6VXNlcjE1NTE1OTM=","avatar_url":"https://avatars.githubusercontent.com/u/1551593?v=4","gravatar_id":"","url":"https://api.github.com/users/imnotjames","html_url":"https://github.com/imnotjames","followers_url":"https://api.github.com/users/imnotjames/followers","following_url":"https://api.github.com/users/imnotjames/following{/other_user}","gists_url":"https://api.github.com/users/imnotjames/gists{/gist_id}","starred_url":"https://api.github.com/users/imnotjames/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imnotjames/subscriptions","organizations_url":"https://api.github.com/users/imnotjames/orgs","repos_url":"https://api.github.com/users/imnotjames/repos","events_url":"https://api.github.com/users/imnotjames/events{/privacy}","received_events_url":"https://api.github.com/users/imnotjames/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/typeorm/typeorm/issues/3685/reactions","total_count":14,"+1":14,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/typeorm/typeorm/issues/3685/timeline","performed_via_github_app":null,"state_reason":"completed"}