diff --git a/src/main/java/org/eluder/coveralls/maven/plugin/CoverallsReportMojo.java b/src/main/java/org/eluder/coveralls/maven/plugin/CoverallsReportMojo.java
index b5c54e2..ebc2537 100644
--- a/src/main/java/org/eluder/coveralls/maven/plugin/CoverallsReportMojo.java
+++ b/src/main/java/org/eluder/coveralls/maven/plugin/CoverallsReportMojo.java
@@ -53,6 +53,7 @@ import org.eluder.coveralls.maven.plugin.service.Shippable;
 import org.eluder.coveralls.maven.plugin.service.Travis;
 import org.eluder.coveralls.maven.plugin.source.SourceCallback;
 import org.eluder.coveralls.maven.plugin.source.SourceLoader;
+import org.eluder.coveralls.maven.plugin.source.UniqueSourceCallback;
 import org.eluder.coveralls.maven.plugin.util.CoverageParsersFactory;
 import org.eluder.coveralls.maven.plugin.util.SourceLoaderFactory;
 
@@ -221,13 +222,13 @@ public class CoverallsReportMojo extends AbstractMojo {
             List<CoverageParser> parsers = createCoverageParsers(sourceLoader);
             JsonWriter writer = createJsonWriter(job);
             CoverallsClient client = createCoverallsClient();
-            List<Logger> reporters = new ArrayList<Logger>();
+            List<Logger> reporters = new ArrayList<>();
             reporters.add(new JobLogger(job));
             SourceCallback sourceCallback = createSourceCallbackChain(writer, reporters);
             reporters.add(new DryRunLogger(job.isDryRun(), writer.getCoverallsFile()));
             
             report(reporters, Position.BEFORE);
-            writeCoveralls(writer, sourceLoader, sourceCallback, parsers);
+            writeCoveralls(writer, sourceCallback, parsers);
             report(reporters, Position.AFTER);
             
             if (!job.isDryRun()) {
@@ -281,7 +282,7 @@ public class CoverallsReportMojo extends AbstractMojo {
      */
     protected List<ServiceSetup> getServices() {
         Map<String, String> env = System.getenv();
-        List<ServiceSetup> services = new ArrayList<ServiceSetup>();
+        List<ServiceSetup> services = new ArrayList<>();
         services.add(new Shippable(env));
         services.add(new Travis(env));
         services.add(new Circle(env));
@@ -339,19 +340,20 @@ public class CoverallsReportMojo extends AbstractMojo {
             chain = coverageTracingReporter;
             reporters.add(coverageTracingReporter);
         }
+        chain = new UniqueSourceCallback(chain);
         return chain;
     }
     
-    protected void writeCoveralls(final JsonWriter writer, final SourceLoader sourceLoader, final SourceCallback sourceCallback, final List<CoverageParser> parsers) throws ProcessingException, IOException {
+    protected void writeCoveralls(final JsonWriter writer, final SourceCallback sourceCallback, final List<CoverageParser> parsers) throws ProcessingException, IOException {
         try {
             getLog().info("Writing Coveralls data to " + writer.getCoverallsFile().getAbsolutePath() + "...");
             long now = System.currentTimeMillis();
-            writer.writeStart();
+            sourceCallback.onBegin();
             for (CoverageParser parser : parsers) {
                 getLog().info("Processing coverage report from " + parser.getCoverageFile().getAbsolutePath());
                 parser.parse(sourceCallback);
             }
-            writer.writeEnd();
+            sourceCallback.onComplete();
             long duration = System.currentTimeMillis() - now;
             getLog().info("Successfully wrote Coveralls data in " + duration + "ms");
         } finally {
diff --git a/src/main/java/org/eluder/coveralls/maven/plugin/json/JsonWriter.java b/src/main/java/org/eluder/coveralls/maven/plugin/json/JsonWriter.java
index 37a45fd..ef0da2d 100644
--- a/src/main/java/org/eluder/coveralls/maven/plugin/json/JsonWriter.java
+++ b/src/main/java/org/eluder/coveralls/maven/plugin/json/JsonWriter.java
@@ -41,8 +41,6 @@ import java.io.File;
 import java.io.IOException;
 import java.text.SimpleDateFormat;
 import java.util.Date;
-import java.util.LinkedHashMap;
-import java.util.Map;
 import java.util.Map.Entry;
 import java.util.Properties;
 
@@ -53,7 +51,6 @@ public class JsonWriter implements SourceCallback, Closeable {
     private final Job job;
     private final File coverallsFile;
     private final JsonGenerator generator;
-    private final Map<Source, Source> sources;
     
     public JsonWriter(final Job job, final File coverallsFile) throws IOException {
         File directory = coverallsFile.getParentFile();
@@ -63,7 +60,6 @@ public class JsonWriter implements SourceCallback, Closeable {
         this.job = job;
         this.coverallsFile = coverallsFile;
         this.generator = new MappingJsonFactory().createGenerator(coverallsFile, JsonEncoding.UTF8);
-        this.sources = new LinkedHashMap<>();
     }
     
     public final Job getJob() {
@@ -73,8 +69,9 @@ public class JsonWriter implements SourceCallback, Closeable {
     public final File getCoverallsFile() {
         return coverallsFile;
     }
-    
-    public void writeStart() throws ProcessingException, IOException {
+
+    @Override
+    public void onBegin() throws ProcessingException, IOException {
         try {
             generator.writeStartObject();
             writeOptionalString("repo_token", job.getRepoToken());
@@ -92,15 +89,18 @@ public class JsonWriter implements SourceCallback, Closeable {
             throw new ProcessingException(ex);
         }
     }
-    
-    public void writeEnd() throws ProcessingException, IOException {
-        for (Source source : sources.values()) {
-            try {
-                generator.writeObject(source);
-            } catch (JsonProcessingException ex) {
-                throw new ProcessingException(ex);
-            }
+
+    @Override
+    public void onSource(final Source source) throws ProcessingException, IOException {
+        try {
+            generator.writeObject(source);
+        } catch (JsonProcessingException ex) {
+            throw new ProcessingException(ex);
         }
+    }
+
+    @Override
+    public void onComplete() throws ProcessingException, IOException {
         try {
             generator.writeEndArray();
             generator.writeEndObject();
@@ -108,13 +108,7 @@ public class JsonWriter implements SourceCallback, Closeable {
             throw new ProcessingException(ex);
         }
     }
-    
-    @Override
-    public void onSource(final Source source) throws ProcessingException, IOException {
-        Source merged = source.merge(sources.get(source));
-        sources.put(merged, merged);
-    }
-    
+
     @Override
     public void close() throws IOException {
         generator.close();
diff --git a/src/main/java/org/eluder/coveralls/maven/plugin/logging/CoverageTracingLogger.java b/src/main/java/org/eluder/coveralls/maven/plugin/logging/CoverageTracingLogger.java
index 380e290..cdb9e5b 100644
--- a/src/main/java/org/eluder/coveralls/maven/plugin/logging/CoverageTracingLogger.java
+++ b/src/main/java/org/eluder/coveralls/maven/plugin/logging/CoverageTracingLogger.java
@@ -26,13 +26,13 @@ package org.eluder.coveralls.maven.plugin.logging;
  * %[license]
  */
 
-import java.io.IOException;
-
 import org.apache.maven.plugin.logging.Log;
-import org.eluder.coveralls.maven.plugin.source.ChainingSourceCallback;
 import org.eluder.coveralls.maven.plugin.ProcessingException;
-import org.eluder.coveralls.maven.plugin.source.SourceCallback;
 import org.eluder.coveralls.maven.plugin.domain.Source;
+import org.eluder.coveralls.maven.plugin.source.ChainingSourceCallback;
+import org.eluder.coveralls.maven.plugin.source.SourceCallback;
+
+import java.io.IOException;
 
 public class CoverageTracingLogger extends ChainingSourceCallback implements Logger {
 
@@ -77,7 +77,7 @@ public class CoverageTracingLogger extends ChainingSourceCallback implements Log
         log.info("- " + getCovered() + " covered lines");
         log.info("- " + getMissed() + " missed lines");
     }
-    
+
     @Override
     protected void onSourceInternal(final Source source) throws ProcessingException, IOException {
         if (source.getClassifier() == null) {
diff --git a/src/main/java/org/eluder/coveralls/maven/plugin/parser/AbstractXmlEventParser.java b/src/main/java/org/eluder/coveralls/maven/plugin/parser/AbstractXmlEventParser.java
index 6484e5d..13937d8 100644
--- a/src/main/java/org/eluder/coveralls/maven/plugin/parser/AbstractXmlEventParser.java
+++ b/src/main/java/org/eluder/coveralls/maven/plugin/parser/AbstractXmlEventParser.java
@@ -26,15 +26,6 @@ package org.eluder.coveralls.maven.plugin.parser;
  * %[license]
  */
 
-import java.io.File;
-import java.io.IOException;
-import java.io.Reader;
-import javax.xml.stream.FactoryConfigurationError;
-import javax.xml.stream.XMLInputFactory;
-import javax.xml.stream.XMLStreamConstants;
-import javax.xml.stream.XMLStreamException;
-import javax.xml.stream.XMLStreamReader;
-
 import org.codehaus.plexus.util.IOUtil;
 import org.codehaus.plexus.util.ReaderFactory;
 import org.codehaus.plexus.util.xml.XmlStreamReader;
@@ -44,6 +35,15 @@ import org.eluder.coveralls.maven.plugin.domain.Source;
 import org.eluder.coveralls.maven.plugin.source.SourceCallback;
 import org.eluder.coveralls.maven.plugin.source.SourceLoader;
 
+import javax.xml.stream.FactoryConfigurationError;
+import javax.xml.stream.XMLInputFactory;
+import javax.xml.stream.XMLStreamConstants;
+import javax.xml.stream.XMLStreamException;
+import javax.xml.stream.XMLStreamReader;
+import java.io.File;
+import java.io.IOException;
+import java.io.Reader;
+
 public abstract class AbstractXmlEventParser implements CoverageParser {
 
     private final File coverageFile;
diff --git a/src/main/java/org/eluder/coveralls/maven/plugin/source/ChainingSourceCallback.java b/src/main/java/org/eluder/coveralls/maven/plugin/source/ChainingSourceCallback.java
index 71de7b7..ef9455e 100644
--- a/src/main/java/org/eluder/coveralls/maven/plugin/source/ChainingSourceCallback.java
+++ b/src/main/java/org/eluder/coveralls/maven/plugin/source/ChainingSourceCallback.java
@@ -26,11 +26,11 @@ package org.eluder.coveralls.maven.plugin.source;
  * %[license]
  */
 
-import java.io.IOException;
-
 import org.eluder.coveralls.maven.plugin.ProcessingException;
 import org.eluder.coveralls.maven.plugin.domain.Source;
 
+import java.io.IOException;
+
 /**
  * Source callback handler that allows chaining multiple callback handlers. Chained callback
  * handler is executed after this callback.
@@ -45,13 +45,37 @@ public abstract class ChainingSourceCallback implements SourceCallback {
         }
         this.chained = chained;
     }
-    
+
+    @Override
+    public final void onBegin() throws ProcessingException, IOException {
+        onBeginInternal();
+        chained.onBegin();
+    }
+
     @Override
     public final void onSource(final Source source) throws ProcessingException, IOException {
         onSourceInternal(source);
         chained.onSource(source);
     }
-    
+
+    @Override
+    public final void onComplete() throws ProcessingException, IOException {
+        onCompleteInternal();
+        chained.onComplete();
+    }
+
+    /**
+     * Defaults to no-op implementation.
+     *
+     * @see #onBegin()
+     *
+     * @throws ProcessingException if processing fails
+     * @throws IOException if an I/O error occurs
+     */
+    protected void onBeginInternal() throws ProcessingException, IOException {
+
+    }
+
     /**
      * @see #onSource(Source)
      * 
@@ -60,4 +84,16 @@ public abstract class ChainingSourceCallback implements SourceCallback {
      * @throws IOException if an I/O error occurs
      */
     protected abstract void onSourceInternal(final Source source) throws ProcessingException, IOException;
+
+    /**
+     * Defaults to no-op implementation.
+     *
+     * @see #onComplete()
+     *
+     * @throws ProcessingException if processing fails
+     * @throws IOException if an I/O error occurs
+     */
+    protected void onCompleteInternal() throws ProcessingException, IOException {
+
+    }
 }
diff --git a/src/main/java/org/eluder/coveralls/maven/plugin/source/SourceCallback.java b/src/main/java/org/eluder/coveralls/maven/plugin/source/SourceCallback.java
index 8339373..3702706 100644
--- a/src/main/java/org/eluder/coveralls/maven/plugin/source/SourceCallback.java
+++ b/src/main/java/org/eluder/coveralls/maven/plugin/source/SourceCallback.java
@@ -26,16 +26,24 @@ package org.eluder.coveralls.maven.plugin.source;
  * %[license]
  */
 
-import java.io.IOException;
-
 import org.eluder.coveralls.maven.plugin.ProcessingException;
 import org.eluder.coveralls.maven.plugin.domain.Source;
 
+import java.io.IOException;
+
 /**
  * Source callback handles parsed source files from coverage reports.
  */
 public interface SourceCallback {
 
+    /**
+     * Called before source parsing has started.
+     *
+     * @throws ProcessingException if processing fails
+     * @throws IOException if an I/O error occurs
+     */
+    void onBegin() throws ProcessingException, IOException;
+
     /**
      * Handles a parsed source file.
      * 
@@ -44,5 +52,13 @@ public interface SourceCallback {
      * @throws IOException if an I/O error occurs
      */
     void onSource(Source source) throws ProcessingException, IOException;
+
+    /**
+     * Called after all sources are handled.
+     *
+     * @throws ProcessingException if processing fails
+     * @throws IOException if an I/O error occurs
+     */
+    void onComplete() throws ProcessingException, IOException;
     
 }
diff --git a/src/main/java/org/eluder/coveralls/maven/plugin/source/UniqueSourceCallback.java b/src/main/java/org/eluder/coveralls/maven/plugin/source/UniqueSourceCallback.java
index 7c565f4..7248a05 100644
--- a/src/main/java/org/eluder/coveralls/maven/plugin/source/UniqueSourceCallback.java
+++ b/src/main/java/org/eluder/coveralls/maven/plugin/source/UniqueSourceCallback.java
@@ -30,8 +30,8 @@ import org.eluder.coveralls.maven.plugin.ProcessingException;
 import org.eluder.coveralls.maven.plugin.domain.Source;
 
 import java.io.IOException;
-import java.util.HashSet;
-import java.util.Set;
+import java.util.LinkedHashMap;
+import java.util.Map;
 
 /**
  * Source callback that tracks passed by source files and provides only unique
@@ -40,19 +40,31 @@ import java.util.Set;
  * can be called only from single thread concurrently.
  */
 public class UniqueSourceCallback implements SourceCallback {
-    
-    private final Set<Source> cache = new HashSet<>();
+
+    private final Map<Source, Source> cache;
     private final SourceCallback delegate;
 
     public UniqueSourceCallback(final SourceCallback delegate) {
+        this.cache = new LinkedHashMap<>();
         this.delegate = delegate;
     }
 
+    @Override
+    public void onBegin() throws ProcessingException, IOException {
+        delegate.onBegin();
+    }
+
     @Override
     public void onSource(final Source source) throws ProcessingException, IOException {
-        if (!cache.contains(source)) {
-            cache.add(source);
+        Source merged = source.merge(cache.get(source));
+        cache.put(merged, merged);
+    }
+
+    @Override
+    public void onComplete() throws ProcessingException, IOException {
+        for (Source source : cache.values()) {
             delegate.onSource(source);
         }
+        delegate.onComplete();
     }
 }
diff --git a/src/test/java/org/eluder/coveralls/maven/plugin/json/JsonWriterTest.java b/src/test/java/org/eluder/coveralls/maven/plugin/json/JsonWriterTest.java
index b8265ef..10585cf 100644
--- a/src/test/java/org/eluder/coveralls/maven/plugin/json/JsonWriterTest.java
+++ b/src/test/java/org/eluder/coveralls/maven/plugin/json/JsonWriterTest.java
@@ -93,8 +93,8 @@ public class JsonWriterTest {
     public void testWriteStartAndEnd() throws Exception {
         JsonWriter writer = new JsonWriter(job(), file);
         try {
-            writer.writeStart();
-            writer.writeEnd();
+            writer.onBegin();
+            writer.onComplete();
         } finally {
             writer.close();
         }
@@ -117,9 +117,9 @@ public class JsonWriterTest {
     public void testOnSource() throws Exception {
         JsonWriter writer = new JsonWriter(job(), file);
         try {
-            writer.writeStart();
+            writer.onBegin();
             writer.onSource(source());
-            writer.writeEnd();
+            writer.onComplete();
         } finally {
             writer.close();
         }
diff --git a/src/test/java/org/eluder/coveralls/maven/plugin/source/UniqueSourceCallbackTest.java b/src/test/java/org/eluder/coveralls/maven/plugin/source/UniqueSourceCallbackTest.java
index 62ebaa4..354212a 100644
--- a/src/test/java/org/eluder/coveralls/maven/plugin/source/UniqueSourceCallbackTest.java
+++ b/src/test/java/org/eluder/coveralls/maven/plugin/source/UniqueSourceCallbackTest.java
@@ -49,9 +49,13 @@ public class UniqueSourceCallbackTest {
         Source s2 = createSource("Bar.java", "{\n  bar();\n}\n", 2);
         
         UniqueSourceCallback cb = createUniqueSourceCallback();
+        cb.onBegin();
         cb.onSource(s1);
         cb.onSource(s2);
+        cb.onComplete();
+        verify(sourceCallbackMock).onBegin();
         verify(sourceCallbackMock, times(2)).onSource(Mockito.any(Source.class));
+        verify(sourceCallbackMock).onComplete();
     }
 
     @Test
@@ -60,9 +64,13 @@ public class UniqueSourceCallbackTest {
         Source s2 = createSource("Foo.java", "{\n  void();\n}\n", 2);
 
         UniqueSourceCallback cb = createUniqueSourceCallback();
+        cb.onBegin();
         cb.onSource(s1);
         cb.onSource(s2);
+        cb.onComplete();
+        verify(sourceCallbackMock).onBegin();
         verify(sourceCallbackMock, times(1)).onSource(Mockito.any(Source.class));
+        verify(sourceCallbackMock).onComplete();
     }
 
     @Test
@@ -71,9 +79,13 @@ public class UniqueSourceCallbackTest {
         Source s2 = createSource("Foo.java", "{\n  void();\n  func();\n}\n", 2, 3);
 
         UniqueSourceCallback cb = createUniqueSourceCallback();
+        cb.onBegin();
         cb.onSource(s1);
         cb.onSource(s2);
+        cb.onComplete();
+        verify(sourceCallbackMock).onBegin();
         verify(sourceCallbackMock, times(2)).onSource(Mockito.any(Source.class));
+        verify(sourceCallbackMock).onComplete();
     }
 
     private UniqueSourceCallback createUniqueSourceCallback() {
