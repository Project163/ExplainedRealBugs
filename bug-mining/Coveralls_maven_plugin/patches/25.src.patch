diff --git a/src/main/java/org/eluder/coveralls/maven/plugin/CoverallsReportMojo.java b/src/main/java/org/eluder/coveralls/maven/plugin/CoverallsReportMojo.java
index f6a941f..b5c54e2 100644
--- a/src/main/java/org/eluder/coveralls/maven/plugin/CoverallsReportMojo.java
+++ b/src/main/java/org/eluder/coveralls/maven/plugin/CoverallsReportMojo.java
@@ -1,13 +1,5 @@
 package org.eluder.coveralls.maven.plugin;
 
-import java.io.File;
-import java.io.IOException;
-import java.util.ArrayList;
-import java.util.Date;
-import java.util.List;
-import java.util.Map;
-import java.util.Properties;
-
 /*
  * #[license]
  * coveralls-maven-plugin
@@ -64,6 +56,14 @@ import org.eluder.coveralls.maven.plugin.source.SourceLoader;
 import org.eluder.coveralls.maven.plugin.util.CoverageParsersFactory;
 import org.eluder.coveralls.maven.plugin.util.SourceLoaderFactory;
 
+import java.io.File;
+import java.io.IOException;
+import java.util.ArrayList;
+import java.util.Date;
+import java.util.List;
+import java.util.Map;
+import java.util.Properties;
+
 @Mojo(name = "report", threadSafe = false, aggregator = true)
 public class CoverallsReportMojo extends AbstractMojo {
 
diff --git a/src/main/java/org/eluder/coveralls/maven/plugin/domain/Source.java b/src/main/java/org/eluder/coveralls/maven/plugin/domain/Source.java
index 1359d88..59dd09b 100644
--- a/src/main/java/org/eluder/coveralls/maven/plugin/domain/Source.java
+++ b/src/main/java/org/eluder/coveralls/maven/plugin/domain/Source.java
@@ -29,6 +29,7 @@ package org.eluder.coveralls.maven.plugin.domain;
 import com.fasterxml.jackson.annotation.JsonIgnore;
 import com.fasterxml.jackson.annotation.JsonProperty;
 
+import java.util.Objects;
 import java.util.regex.Matcher;
 import java.util.regex.Pattern;
 
@@ -43,14 +44,14 @@ public final class Source implements JsonObject {
     private String classifier;
     
     public Source(final String name, final String source, final String digest) {
-        int lines = 1;
-        Matcher matcher = NEWLINE.matcher(source);
-        while (matcher.find()) {
-            lines++;
-        }
+        this(name, getLines(source), digest, null);
+    }
+
+    protected Source(final String name, final int lines, final String digest, String classifier) {
+        this.name = name;
         this.digest = digest;
         this.coverage = new Integer[lines];
-        this.name = name;
+        this.classifier = classifier;
     }
     
     @JsonIgnore
@@ -93,13 +94,43 @@ public final class Source implements JsonObject {
         this.coverage[lineNumber - 1] = coverage;
     }
 
-    public void merge(final Source source) {
-        for (int i = 0; i < this.coverage.length && i < source.coverage.length; i++) {
-            if (this.coverage[i] == null && source.coverage[i] != null) {
-                this.coverage[i] = source.coverage[i];
-            } else if (this.coverage[i] != null && source.coverage[i] != null) {
-                this.coverage[i] += source.coverage[i];
+    public Source merge(final Source source) {
+        Source copy = new Source(this.name, this.coverage.length, this.digest, this.classifier);
+        System.arraycopy(this.coverage, 0, copy.coverage, 0, this.coverage.length);
+        if (copy.equals(source)) {
+            for (int i = 0; i < copy.coverage.length; i++) {
+                if (source.coverage[i] != null) {
+                    int base = copy.coverage[i] != null ? copy.coverage[i] : 0;
+                    copy.coverage[i] = base + source.coverage[i];
+                }
             }
         }
+        return copy;
+    }
+
+    @Override
+    public boolean equals(final Object obj) {
+        if (!(obj instanceof Source)) {
+            return false;
+        }
+        Source other = (Source) obj;
+        return (Objects.equals(this.name, other.name) &&
+                Objects.equals(this.digest, other.digest) &&
+                Objects.equals(this.classifier, other.classifier) &&
+                Objects.equals(this.coverage.length, other.coverage.length));
+    }
+
+    @Override
+    public int hashCode() {
+        return Objects.hash(this.name, this.digest, this.classifier, this.coverage.length);
+    }
+    
+    private static int getLines(final String source) {
+        int lines = 1;
+        Matcher matcher = NEWLINE.matcher(source);
+        while (matcher.find()) {
+            lines++;
+        }
+        return lines;
     }
 }
diff --git a/src/main/java/org/eluder/coveralls/maven/plugin/json/JsonWriter.java b/src/main/java/org/eluder/coveralls/maven/plugin/json/JsonWriter.java
index c7c8a09..37a45fd 100644
--- a/src/main/java/org/eluder/coveralls/maven/plugin/json/JsonWriter.java
+++ b/src/main/java/org/eluder/coveralls/maven/plugin/json/JsonWriter.java
@@ -26,6 +26,16 @@ package org.eluder.coveralls.maven.plugin.json;
  * %[license]
  */
 
+import com.fasterxml.jackson.core.JsonEncoding;
+import com.fasterxml.jackson.core.JsonGenerator;
+import com.fasterxml.jackson.core.JsonProcessingException;
+import com.fasterxml.jackson.databind.MappingJsonFactory;
+import org.codehaus.plexus.util.StringUtils;
+import org.eluder.coveralls.maven.plugin.ProcessingException;
+import org.eluder.coveralls.maven.plugin.domain.Job;
+import org.eluder.coveralls.maven.plugin.domain.Source;
+import org.eluder.coveralls.maven.plugin.source.SourceCallback;
+
 import java.io.Closeable;
 import java.io.File;
 import java.io.IOException;
@@ -36,17 +46,6 @@ import java.util.Map;
 import java.util.Map.Entry;
 import java.util.Properties;
 
-import org.codehaus.plexus.util.StringUtils;
-import org.eluder.coveralls.maven.plugin.ProcessingException;
-import org.eluder.coveralls.maven.plugin.source.SourceCallback;
-import org.eluder.coveralls.maven.plugin.domain.Job;
-import org.eluder.coveralls.maven.plugin.domain.Source;
-
-import com.fasterxml.jackson.core.JsonEncoding;
-import com.fasterxml.jackson.core.JsonGenerator;
-import com.fasterxml.jackson.core.JsonProcessingException;
-import com.fasterxml.jackson.databind.MappingJsonFactory;
-
 public class JsonWriter implements SourceCallback, Closeable {
 
     protected static final String TIMESTAMP_FORMAT = "yyyy-MM-dd HH:mm:ss Z";
@@ -54,7 +53,7 @@ public class JsonWriter implements SourceCallback, Closeable {
     private final Job job;
     private final File coverallsFile;
     private final JsonGenerator generator;
-    private final Map<String, Source> sources = new LinkedHashMap<String, Source>();
+    private final Map<Source, Source> sources;
     
     public JsonWriter(final Job job, final File coverallsFile) throws IOException {
         File directory = coverallsFile.getParentFile();
@@ -64,6 +63,7 @@ public class JsonWriter implements SourceCallback, Closeable {
         this.job = job;
         this.coverallsFile = coverallsFile;
         this.generator = new MappingJsonFactory().createGenerator(coverallsFile, JsonEncoding.UTF8);
+        this.sources = new LinkedHashMap<>();
     }
     
     public final Job getJob() {
@@ -111,11 +111,8 @@ public class JsonWriter implements SourceCallback, Closeable {
     
     @Override
     public void onSource(final Source source) throws ProcessingException, IOException {
-        if (sources.get(source.getName()) != null) {
-            sources.get(source.getName()).merge(source);
-        } else {
-            sources.put(source.getName(), source);
-        }
+        Source merged = source.merge(sources.get(source));
+        sources.put(merged, merged);
     }
     
     @Override
diff --git a/src/main/java/org/eluder/coveralls/maven/plugin/source/AbstractSourceLoader.java b/src/main/java/org/eluder/coveralls/maven/plugin/source/AbstractSourceLoader.java
index a4a4d69..53f7bc7 100644
--- a/src/main/java/org/eluder/coveralls/maven/plugin/source/AbstractSourceLoader.java
+++ b/src/main/java/org/eluder/coveralls/maven/plugin/source/AbstractSourceLoader.java
@@ -26,6 +26,10 @@ package org.eluder.coveralls.maven.plugin.source;
  * %[license]
  */
 
+import org.codehaus.plexus.util.IOUtil;
+import org.eluder.coveralls.maven.plugin.domain.Source;
+import org.eluder.coveralls.maven.plugin.util.Md5DigestInputStream;
+
 import java.io.IOException;
 import java.io.InputStream;
 import java.io.InputStreamReader;
@@ -33,10 +37,6 @@ import java.net.URI;
 import java.nio.charset.Charset;
 import java.security.NoSuchAlgorithmException;
 
-import org.codehaus.plexus.util.IOUtil;
-import org.eluder.coveralls.maven.plugin.domain.Source;
-import org.eluder.coveralls.maven.plugin.util.MD5SumInputStream;
-
 public abstract class AbstractSourceLoader implements SourceLoader {
 
     private final Charset sourceEncoding;
@@ -51,12 +51,12 @@ public abstract class AbstractSourceLoader implements SourceLoader {
     public Source load(final String sourceFile) throws IOException {
         InputStream stream = locate(sourceFile);
         if (stream != null) {
-            try (MD5SumInputStream digestStream = new MD5SumInputStream(stream);
-                    InputStreamReader reader = new InputStreamReader(digestStream, getSourceEncoding())) {
+            try (Md5DigestInputStream ds = new Md5DigestInputStream(stream);
+                    InputStreamReader reader = new InputStreamReader(ds, getSourceEncoding())) {
                 String source = IOUtil.toString(reader);
-                return new Source(getFileName(sourceFile), source, digestStream.digest());
-            } catch (NoSuchAlgorithmException e) {
-                throw new IOException("MD5 Algorithm not available", e);
+                return new Source(getFileName(sourceFile), source, ds.getDigestHex());
+            } catch (NoSuchAlgorithmException ex) {
+                throw new IOException("MD5 algorithm not available", ex);
             }
         } else {
             return null;
diff --git a/src/main/java/org/eluder/coveralls/maven/plugin/source/UniqueSourceCallback.java b/src/main/java/org/eluder/coveralls/maven/plugin/source/UniqueSourceCallback.java
index f6268a1..7c565f4 100644
--- a/src/main/java/org/eluder/coveralls/maven/plugin/source/UniqueSourceCallback.java
+++ b/src/main/java/org/eluder/coveralls/maven/plugin/source/UniqueSourceCallback.java
@@ -26,13 +26,13 @@ package org.eluder.coveralls.maven.plugin.source;
  * %[license]
  */
 
+import org.eluder.coveralls.maven.plugin.ProcessingException;
+import org.eluder.coveralls.maven.plugin.domain.Source;
+
 import java.io.IOException;
 import java.util.HashSet;
 import java.util.Set;
 
-import org.eluder.coveralls.maven.plugin.ProcessingException;
-import org.eluder.coveralls.maven.plugin.domain.Source;
-
 /**
  * Source callback that tracks passed by source files and provides only unique
  * source files to the delegate. Note that the implementation is not thread
@@ -41,9 +41,7 @@ import org.eluder.coveralls.maven.plugin.domain.Source;
  */
 public class UniqueSourceCallback implements SourceCallback {
     
-    private static final String LINES_SEPARATOR = "#";
-    
-    private final Set<String> cache = new HashSet<String>();
+    private final Set<Source> cache = new HashSet<>();
     private final SourceCallback delegate;
 
     public UniqueSourceCallback(final SourceCallback delegate) {
@@ -52,24 +50,9 @@ public class UniqueSourceCallback implements SourceCallback {
 
     @Override
     public void onSource(final Source source) throws ProcessingException, IOException {
-        String key = getKey(source);
-        if (!cache.contains(key)) {
-            cache.add(key);
+        if (!cache.contains(source)) {
+            cache.add(source);
             delegate.onSource(source);
         }
     }
-    
-    private String getKey(final Source source) {
-        return source.getFullName() + LINES_SEPARATOR + getRelevantLines(source);
-    }
-    
-    private int getRelevantLines(final Source source) {
-        int relevant = 0;
-        for (Integer cov : source.getCoverage()) {
-            if (cov != null) {
-                relevant++;
-            }
-        }
-        return relevant;
-    }
 }
diff --git a/src/main/java/org/eluder/coveralls/maven/plugin/util/MD5SumInputStream.java b/src/main/java/org/eluder/coveralls/maven/plugin/util/MD5SumInputStream.java
deleted file mode 100644
index 0e87d37..0000000
--- a/src/main/java/org/eluder/coveralls/maven/plugin/util/MD5SumInputStream.java
+++ /dev/null
@@ -1,40 +0,0 @@
-package org.eluder.coveralls.maven.plugin.util;
-
-import java.io.FilterInputStream;
-import java.io.IOException;
-import java.io.InputStream;
-import java.security.MessageDigest;
-import java.security.NoSuchAlgorithmException;
-
-public class MD5SumInputStream extends FilterInputStream {
-  private final MessageDigest digest;
-  private static final int BYTE_MASK = 0xFF;
-  public MD5SumInputStream(final InputStream in) throws NoSuchAlgorithmException {
-    super(in);
-    digest = MessageDigest.getInstance("MD5");
-  }
-  @Override
-  public int read() throws IOException {
-    int ret = super.read();
-    if (ret > -1) {
-      digest.update((byte) (ret & BYTE_MASK));
-    }
-    return ret;
-  }
-  @Override
-  public int read(final byte[] buff, final int off, final int len) throws IOException {
-    int ret = super.read(buff, off, len);
-    if (ret > 0) {
-      digest.update(buff, off, ret);
-    }
-    return ret;
-  }
-  public String digest() {
-      byte[] ret = digest.digest();
-      StringBuilder sb = new StringBuilder(ret.length * 2);
-      for (byte b : ret) {
-         sb.append(String.format("%02x", b & BYTE_MASK));
-      }
-      return sb.toString();
-  }
-}
diff --git a/src/main/java/org/eluder/coveralls/maven/plugin/util/Md5DigestInputStream.java b/src/main/java/org/eluder/coveralls/maven/plugin/util/Md5DigestInputStream.java
new file mode 100644
index 0000000..59e7a00
--- /dev/null
+++ b/src/main/java/org/eluder/coveralls/maven/plugin/util/Md5DigestInputStream.java
@@ -0,0 +1,18 @@
+package org.eluder.coveralls.maven.plugin.util;
+
+import javax.xml.bind.DatatypeConverter;
+import java.io.InputStream;
+import java.security.DigestInputStream;
+import java.security.MessageDigest;
+import java.security.NoSuchAlgorithmException;
+
+public class Md5DigestInputStream extends DigestInputStream {
+
+    public Md5DigestInputStream(InputStream stream) throws NoSuchAlgorithmException {
+        super(stream, MessageDigest.getInstance("MD5"));
+    }
+
+    public String getDigestHex() {
+        return DatatypeConverter.printHexBinary(getMessageDigest().digest());
+    }
+}
diff --git a/src/test/java/org/eluder/coveralls/maven/plugin/CoverallsReportMojoTest.java b/src/test/java/org/eluder/coveralls/maven/plugin/CoverallsReportMojoTest.java
index a4cbd54..d9b7f08 100644
--- a/src/test/java/org/eluder/coveralls/maven/plugin/CoverallsReportMojoTest.java
+++ b/src/test/java/org/eluder/coveralls/maven/plugin/CoverallsReportMojoTest.java
@@ -113,7 +113,7 @@ public class CoverallsReportMojoTest {
             public Source answer(final InvocationOnMock invocation) throws Throwable {
                 String sourceFile = invocation.getArguments()[0].toString();
                 String content = readFileContent(sourceFile);
-                return new Source(sourceFile, content, "asdfasdf1234asfasdf2345");
+                return new Source(sourceFile, content, TestIoUtil.getMd5DigestHex(content));
             }
         });
         when(logMock.isInfoEnabled()).thenReturn(true);
diff --git a/src/test/java/org/eluder/coveralls/maven/plugin/domain/SourceTest.java b/src/test/java/org/eluder/coveralls/maven/plugin/domain/SourceTest.java
index 31311d1..b3aa8a4 100644
--- a/src/test/java/org/eluder/coveralls/maven/plugin/domain/SourceTest.java
+++ b/src/test/java/org/eluder/coveralls/maven/plugin/domain/SourceTest.java
@@ -29,14 +29,13 @@ package org.eluder.coveralls.maven.plugin.domain;
 import org.junit.Ignore;
 import org.junit.Test;
 
-import static org.junit.Assert.assertArrayEquals;
-import static org.junit.Assert.assertEquals;
+import static org.junit.Assert.*;
 
 public class SourceTest {
 
     @Test
     public void testAddCoverage() {
-        Source source = new Source("src/main/java/Hello.java", "public class Hello {\n    \n}\n", "asdfasdf1234asfasdf2345");
+        Source source = new Source("src/main/java/Hello.java", "public class Hello {\n  \n}\n", "E8BD88CF0BDB77A6408234FD91FD22C3");
         source.addCoverage(1, 3);
         source.addCoverage(3, 3);
         assertArrayEquals(new Integer[] { 3, null, 3, null }, source.getCoverage());
@@ -44,16 +43,72 @@ public class SourceTest {
 
     @Test(expected = IllegalArgumentException.class)
     public void testAddCoverageForSourceOutOfBounds() {
-        Source source = new Source("src/main/java/Hello.java", "public class Hello {\n    \n}\n", "asdfasdf1234asfasdf2345");
+        Source source = new Source("src/main/java/Hello.java", "public class Hello {\n  \n}\n", "E8BD88CF0BDB77A6408234FD91FD22C3");
         source.addCoverage(5, 1);
     }
     
     @Test
     @Ignore("#45: https://github.com/trautonen/coveralls-maven-plugin/issues/45")
     public void testGetNameWithClassifier() throws Exception {
-        Source source = new Source("src/main/java/Hello.java", "public class Hello {\n    \n}\n", "asdfasdf1234asfasdf2345");
+        Source source = new Source("src/main/java/Hello.java", "public class Hello {\n  \n}\n", "E8BD88CF0BDB77A6408234FD91FD22C3");
         source.setClassifier("Inner");
         assertEquals("src/main/java/Hello.java", source.getName());
         assertEquals("src/main/java/Hello.java#Inner", source.getFullName());
     }
+
+    @Test
+    public void testMerge() {
+        Source source1 = new Source("src/main/java/Hello.java", "public class Hello {\n  \n}\n", "E8BD88CF0BDB77A6408234FD91FD22C3");
+        source1.addCoverage(1, 2);
+        source1.addCoverage(3, 4);
+        Source source2 = new Source("src/main/java/Hello.java", "public class Hello {\n  \n}\n", "E8BD88CF0BDB77A6408234FD91FD22C3");
+        source2.addCoverage(2, 1);
+        source2.addCoverage(3, 3);
+
+        Source merged = source1.merge(source2);
+        assertFalse(source1 == merged);
+        assertFalse(source2 == merged);
+        assertEquals(source1.getName(), merged.getName());
+        assertEquals(source1.getDigest(), merged.getDigest());
+        assertEquals(source1.getClassifier(), merged.getClassifier());
+        assertEquals(new Integer(2), merged.getCoverage()[0]);
+        assertEquals(new Integer(1), merged.getCoverage()[1]);
+        assertEquals(new Integer(7), merged.getCoverage()[2]);
+        assertNull(merged.getCoverage()[3]);
+    }
+
+    @Test
+    public void testMergeDifferent() {
+        Source source1 = new Source("src/main/java/Hello.java", "public class Hello {\n  \n}\n", "E8BD88CF0BDB77A6408234FD91FD22C3");
+        source1.addCoverage(1, 3);
+        Source source2 = new Source("src/main/java/Hello.java", "public class Hello {\n  void();\n}\n", "CBA7831606B51D1499349451B70758E3");
+        source2.addCoverage(2, 4);
+        Source merged = source1.merge(source2);
+        assertFalse(source1 == merged);
+        assertFalse(source2 == merged);
+        assertArrayEquals(source1.getCoverage(), merged.getCoverage());
+    }
+
+    @Test
+    public void testEqualsForNull() {
+        Source source = new Source("src/main/java/Hello.java", "public class Hello {\n  \n}\n", "E8BD88CF0BDB77A6408234FD91FD22C3");
+        assertFalse(source.equals(null));
+    }
+
+    @Test
+    public void testEqualsForDifferentSources() throws Exception {
+        Source source1 = new Source("src/main/java/Hello.java", "public class Hello {\n  \n}\n", "E8BD88CF0BDB77A6408234FD91FD22C3");
+        Source source2 = new Source("src/main/java/Hello.java", "public class Hello {\n  void();\n}\n", "CBA7831606B51D1499349451B70758E3");
+        assertFalse(source1.equals(source2));
+    }
+
+    @Test
+    public void testHashCode() {
+        Source source1 = new Source("src/main/java/Hello.java", "public class Hello {\n  \n}\n", "E8BD88CF0BDB77A6408234FD91FD22C3");
+        Source source2 = new Source("src/main/java/Hello.java", "public class Hello {\n  \n}\n", "E8BD88CF0BDB77A6408234FD91FD22C3");
+        Source source3 = new Source("src/main/java/Hello.java", "public class Hello {\n  void();\n}\n", "CBA7831606B51D1499349451B70758E3");
+        assertTrue(source1.hashCode() == source2.hashCode());
+        assertFalse(source1.hashCode() == source3.hashCode());
+        assertFalse(source2.hashCode() == source3.hashCode());
+    }
 }
diff --git a/src/test/java/org/eluder/coveralls/maven/plugin/json/JsonWriterTest.java b/src/test/java/org/eluder/coveralls/maven/plugin/json/JsonWriterTest.java
index 960c54f..b8265ef 100644
--- a/src/test/java/org/eluder/coveralls/maven/plugin/json/JsonWriterTest.java
+++ b/src/test/java/org/eluder/coveralls/maven/plugin/json/JsonWriterTest.java
@@ -127,7 +127,7 @@ public class JsonWriterTest {
         Map<String, Object> jsonMap = stringToJsonMap(content);
         jsonMap = ((List<Map<String, Object>>)jsonMap.get("source_files")).get(0);
         assertEquals("Foo.java", jsonMap.get("name"));
-        assertEquals("asdfasdf1234asfasdf2345", jsonMap.get("source_digest"));
+        assertEquals("6E0F89B516198DC6AB743EA5FBFB3108", jsonMap.get("source_digest"));
         assertEquals(1, ((Collection<?>) jsonMap.get("coverage")).size());
     }
     
@@ -149,7 +149,7 @@ public class JsonWriterTest {
     }
     
     private Source source() {
-        return new Source("Foo.java", "public class Foo { }", "asdfasdf1234asfasdf2345");
+        return new Source("Foo.java", "public class Foo { }", "6E0F89B516198DC6AB743EA5FBFB3108");
     }
     
     private Map<String, Object> stringToJsonMap(final String content) throws Exception {
diff --git a/src/test/java/org/eluder/coveralls/maven/plugin/logging/CoverageTracingLoggerTest.java b/src/test/java/org/eluder/coveralls/maven/plugin/logging/CoverageTracingLoggerTest.java
index 9274122..970d677 100644
--- a/src/test/java/org/eluder/coveralls/maven/plugin/logging/CoverageTracingLoggerTest.java
+++ b/src/test/java/org/eluder/coveralls/maven/plugin/logging/CoverageTracingLoggerTest.java
@@ -26,20 +26,20 @@ package org.eluder.coveralls.maven.plugin.logging;
  * %[license]
  */
 
-import static org.junit.Assert.assertEquals;
-import static org.mockito.Matchers.any;
-import static org.mockito.Mockito.times;
-import static org.mockito.Mockito.verify;
-
 import org.apache.maven.plugin.logging.Log;
-import org.eluder.coveralls.maven.plugin.source.SourceCallback;
 import org.eluder.coveralls.maven.plugin.domain.Source;
 import org.eluder.coveralls.maven.plugin.logging.Logger.Position;
+import org.eluder.coveralls.maven.plugin.source.SourceCallback;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.mockito.Mock;
 import org.mockito.runners.MockitoJUnitRunner;
 
+import static org.junit.Assert.assertEquals;
+import static org.mockito.Matchers.any;
+import static org.mockito.Mockito.times;
+import static org.mockito.Mockito.verify;
+
 @RunWith(MockitoJUnitRunner.class)
 public class CoverageTracingLoggerTest {
 
@@ -61,15 +61,15 @@ public class CoverageTracingLoggerTest {
     
     @Test
     public void testLogForSources() throws Exception {
-        Source source1 = new Source("Source1.java", "public class Source1 {\n    \n}\n", "asdfasdf1234asfasdf2345");
+        Source source1 = new Source("Source1.java", "public class Source1 {\n    \n}\n", "0ABCEBD0C34F82CA8CF631A48BDBC941");
         source1.addCoverage(1, 0);
         source1.addCoverage(2, 0);
         source1.addCoverage(3, 0);
-        Source source2 = new Source("Source2.java", "public class Source2 {\n    new Interface() { public void run() { } };\n}\n", "asdfasdf1234asfasdf2345");
+        Source source2 = new Source("Source2.java", "public class Source2 {\n    new Interface() { public void run() { } };\n}\n", "34BD6501A6D1CE5181AECEA688C7D382");
         source2.addCoverage(1, 1);
         source2.addCoverage(2, 1);
         source2.addCoverage(3, 1);
-        Source source2inner = new Source("Source2.java", "public class Source2 {\n    new Interface() { public void run() { } };\n}\n", "asdfasdf1234asfasdf2345");
+        Source source2inner = new Source("Source2.java", "public class Source2 {\n    new Interface() { public void run() { } };\n}\n", "34BD6501A6D1CE5181AECEA688C7D382");
         source2inner.setClassifier("$1");
         source2inner.addCoverage(2, 1);
         
diff --git a/src/test/java/org/eluder/coveralls/maven/plugin/source/DirectorySourceLoaderTest.java b/src/test/java/org/eluder/coveralls/maven/plugin/source/DirectorySourceLoaderTest.java
index e562c72..a3bec6a 100644
--- a/src/test/java/org/eluder/coveralls/maven/plugin/source/DirectorySourceLoaderTest.java
+++ b/src/test/java/org/eluder/coveralls/maven/plugin/source/DirectorySourceLoaderTest.java
@@ -26,10 +26,6 @@ package org.eluder.coveralls.maven.plugin.source;
  * %[license]
  */
 
-import static org.junit.Assert.*;
-
-import java.io.File;
-
 import org.eluder.coveralls.maven.plugin.domain.Source;
 import org.eluder.coveralls.maven.plugin.util.TestIoUtil;
 import org.junit.Rule;
@@ -39,6 +35,11 @@ import org.junit.runner.RunWith;
 import org.mockito.Mock;
 import org.mockito.runners.MockitoJUnitRunner;
 
+import java.io.File;
+
+import static org.junit.Assert.assertEquals;
+import static org.junit.Assert.assertNull;
+
 @RunWith(MockitoJUnitRunner.class)
 public class DirectorySourceLoaderTest {
 
@@ -71,7 +72,7 @@ public class DirectorySourceLoaderTest {
         DirectorySourceLoader sourceLoader = new DirectorySourceLoader(folder.getRoot(), folder.getRoot(), "UTF-8");
         Source source = sourceLoader.load(file.getName());
         assertEquals(file.getName(), source.getName());
-        assertEquals("2ac359c9a152fd7cd79c4eb147069224", source.getDigest());
+        assertEquals("2AC359C9A152FD7CD79C4EB147069224", source.getDigest());
         assertEquals(4, source.getCoverage().length);
     }
 }
diff --git a/src/test/java/org/eluder/coveralls/maven/plugin/source/MultiSourceLoaderTest.java b/src/test/java/org/eluder/coveralls/maven/plugin/source/MultiSourceLoaderTest.java
index 6a49963..c0f17ce 100644
--- a/src/test/java/org/eluder/coveralls/maven/plugin/source/MultiSourceLoaderTest.java
+++ b/src/test/java/org/eluder/coveralls/maven/plugin/source/MultiSourceLoaderTest.java
@@ -26,17 +26,17 @@ package org.eluder.coveralls.maven.plugin.source;
  * %[license]
  */
 
-import static org.junit.Assert.assertSame;
-import static org.mockito.Mockito.when;
-
-import java.io.IOException;
-
 import org.eluder.coveralls.maven.plugin.domain.Source;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.mockito.Mock;
 import org.mockito.runners.MockitoJUnitRunner;
 
+import java.io.IOException;
+
+import static org.junit.Assert.assertSame;
+import static org.mockito.Mockito.when;
+
 @RunWith(MockitoJUnitRunner.class)
 public class MultiSourceLoaderTest {
 
@@ -46,9 +46,9 @@ public class MultiSourceLoaderTest {
     @Mock
     private SourceLoader sl2;
     
-    private Source s1 = new Source("source", "{ 1 }", "asdfasdf1234asfasdf2345");
+    private Source s1 = new Source("source", "{ 1 }", "9A0174D3A5B8D202C6E404601FC260D1");
     
-    private Source s2 = new Source("source", "{ 2 }", "asdfasdf1234asfasdf2345");
+    private Source s2 = new Source("source", "{ 2 }", "849409F24F4BCAAC904F3B142447D65D");
     
     @Test(expected = IOException.class)
     public void testMissingSource() throws Exception {
diff --git a/src/test/java/org/eluder/coveralls/maven/plugin/source/ScanSourceLoaderTest.java b/src/test/java/org/eluder/coveralls/maven/plugin/source/ScanSourceLoaderTest.java
index 7d5460e..5106efa 100644
--- a/src/test/java/org/eluder/coveralls/maven/plugin/source/ScanSourceLoaderTest.java
+++ b/src/test/java/org/eluder/coveralls/maven/plugin/source/ScanSourceLoaderTest.java
@@ -26,10 +26,6 @@ package org.eluder.coveralls.maven.plugin.source;
  * %[license]
  */
 
-import static org.junit.Assert.*;
-
-import java.io.File;
-
 import org.eluder.coveralls.maven.plugin.domain.Source;
 import org.eluder.coveralls.maven.plugin.util.TestIoUtil;
 import org.junit.Rule;
@@ -39,6 +35,11 @@ import org.junit.runner.RunWith;
 import org.mockito.Mock;
 import org.mockito.runners.MockitoJUnitRunner;
 
+import java.io.File;
+
+import static org.junit.Assert.assertEquals;
+import static org.junit.Assert.assertNull;
+
 @RunWith(MockitoJUnitRunner.class)
 public class ScanSourceLoaderTest {
 
@@ -66,7 +67,7 @@ public class ScanSourceLoaderTest {
 
     @Test
     public void testLoadSource() throws Exception {
-        File dir = folder.newFolder( "level1", "level2", "level3");
+        File dir = folder.newFolder("level1", "level2", "level3");
         File fileA = new File(dir, "AFile.java");
         File fileB = new File(dir, "BFile.java");
         TestIoUtil.writeFileContent("public class Foo {\r\n    \n}\r", fileA);
@@ -74,11 +75,11 @@ public class ScanSourceLoaderTest {
         ScanSourceLoader sourceLoader = new ScanSourceLoader(folder.getRoot(), folder.getRoot(), "UTF-8");
         Source sourceA = sourceLoader.load(fileA.getName());
         assertEquals("level1/level2/level3/AFile.java", sourceA.getName());
-        assertEquals("2ac359c9a152fd7cd79c4eb147069224", sourceA.getDigest());
+        assertEquals("2AC359C9A152FD7CD79C4EB147069224", sourceA.getDigest());
         assertEquals(4, sourceA.getCoverage().length);
         Source sourceB = sourceLoader.load(fileB.getName());
         assertEquals("level1/level2/level3/BFile.java", sourceB.getName());
-        assertEquals("2ac359c9a152fd7cd79c4eb147069224", sourceB.getDigest());
+        assertEquals("2AC359C9A152FD7CD79C4EB147069224", sourceB.getDigest());
         assertEquals(4, sourceB.getCoverage().length);
     }
 }
diff --git a/src/test/java/org/eluder/coveralls/maven/plugin/source/UniqueSourceCallbackTest.java b/src/test/java/org/eluder/coveralls/maven/plugin/source/UniqueSourceCallbackTest.java
index 85b65f3..62ebaa4 100644
--- a/src/test/java/org/eluder/coveralls/maven/plugin/source/UniqueSourceCallbackTest.java
+++ b/src/test/java/org/eluder/coveralls/maven/plugin/source/UniqueSourceCallbackTest.java
@@ -26,16 +26,17 @@ package org.eluder.coveralls.maven.plugin.source;
  * %[license]
  */
 
-import static org.mockito.Mockito.times;
-import static org.mockito.Mockito.verify;
-
 import org.eluder.coveralls.maven.plugin.domain.Source;
+import org.eluder.coveralls.maven.plugin.util.TestIoUtil;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.mockito.Mock;
 import org.mockito.Mockito;
 import org.mockito.runners.MockitoJUnitRunner;
 
+import static org.mockito.Mockito.times;
+import static org.mockito.Mockito.verify;
+
 @RunWith(MockitoJUnitRunner.class)
 public class UniqueSourceCallbackTest {
 
@@ -43,7 +44,7 @@ public class UniqueSourceCallbackTest {
     private SourceCallback sourceCallbackMock;
     
     @Test
-    public void testOnSourceWithUniqueSources() throws Exception {
+    public void testOnSourceWithUniqueFiles() throws Exception {
         Source s1 = createSource("Foo.java", "{\n  void();\n}\n", 2);
         Source s2 = createSource("Bar.java", "{\n  bar();\n}\n", 2);
         
@@ -56,17 +57,18 @@ public class UniqueSourceCallbackTest {
     @Test
     public void testOnSourceWithDuplicateSources() throws Exception {
         Source s1 = createSource("Foo.java", "{\n  void();\n}\n", 2);
+        Source s2 = createSource("Foo.java", "{\n  void();\n}\n", 2);
 
         UniqueSourceCallback cb = createUniqueSourceCallback();
         cb.onSource(s1);
-        cb.onSource(s1);
+        cb.onSource(s2);
         verify(sourceCallbackMock, times(1)).onSource(Mockito.any(Source.class));
     }
 
     @Test
-    public void testOnSourceWithUniqueRelevantLines() throws Exception {
+    public void testOnSourceWithUniqueSources() throws Exception {
         Source s1 = createSource("Foo.java", "{\n  void();\n}\n", 2);
-        Source s2 = createSource("Foo.java", "{\n  void();\n}\n", 1, 3);
+        Source s2 = createSource("Foo.java", "{\n  void();\n  func();\n}\n", 2, 3);
 
         UniqueSourceCallback cb = createUniqueSourceCallback();
         cb.onSource(s1);
@@ -78,8 +80,8 @@ public class UniqueSourceCallbackTest {
         return new UniqueSourceCallback(sourceCallbackMock);
     }
     
-    private Source createSource(final String name, final String source, final int... relevant) {
-        Source s = new Source(name, source, "asdfasdf1234asfasdf2345");
+    private Source createSource(final String name, final String source, final int... relevant) throws Exception {
+        Source s = new Source(name, source, TestIoUtil.getMd5DigestHex(source));
         for (int i : relevant) {
             s.addCoverage(i, 1);
         }
diff --git a/src/test/java/org/eluder/coveralls/maven/plugin/source/UrlSourceLoaderTest.java b/src/test/java/org/eluder/coveralls/maven/plugin/source/UrlSourceLoaderTest.java
index 13d5dbc..a344f4d 100644
--- a/src/test/java/org/eluder/coveralls/maven/plugin/source/UrlSourceLoaderTest.java
+++ b/src/test/java/org/eluder/coveralls/maven/plugin/source/UrlSourceLoaderTest.java
@@ -26,11 +26,6 @@ package org.eluder.coveralls.maven.plugin.source;
  * %[license]
  */
 
-import static org.junit.Assert.*;
-
-import java.io.File;
-import java.net.URL;
-
 import org.eluder.coveralls.maven.plugin.domain.Source;
 import org.eluder.coveralls.maven.plugin.util.TestIoUtil;
 import org.junit.Rule;
@@ -40,6 +35,12 @@ import org.junit.runner.RunWith;
 import org.mockito.Mock;
 import org.mockito.runners.MockitoJUnitRunner;
 
+import java.io.File;
+import java.net.URL;
+
+import static org.junit.Assert.assertEquals;
+import static org.junit.Assert.assertNull;
+
 @RunWith(MockitoJUnitRunner.class)
 public class UrlSourceLoaderTest {
 
@@ -71,7 +72,7 @@ public class UrlSourceLoaderTest {
         Source source = sourceLoader.load(fileName);
 
         assertEquals(fileName, source.getName());
-        assertEquals("9897a4bb0467180d3c6acd95475dd77d", source.getDigest());
+        assertEquals("9897A4BB0467180D3C6ACD95475DD77D", source.getDigest());
         assertEquals(3, source.getCoverage().length);
     }
 
diff --git a/src/test/java/org/eluder/coveralls/maven/plugin/util/MD5SumInputStreamTest.java b/src/test/java/org/eluder/coveralls/maven/plugin/util/Md5DigestInputStreamTest.java
similarity index 50%
rename from src/test/java/org/eluder/coveralls/maven/plugin/util/MD5SumInputStreamTest.java
rename to src/test/java/org/eluder/coveralls/maven/plugin/util/Md5DigestInputStreamTest.java
index 307aee2..cf384e3 100644
--- a/src/test/java/org/eluder/coveralls/maven/plugin/util/MD5SumInputStreamTest.java
+++ b/src/test/java/org/eluder/coveralls/maven/plugin/util/Md5DigestInputStreamTest.java
@@ -1,37 +1,37 @@
 package org.eluder.coveralls.maven.plugin.util;
 
-import static org.junit.Assert.*;
+import org.junit.Test;
 
 import java.io.ByteArrayInputStream;
 
-import org.junit.Test;
+import static org.junit.Assert.assertEquals;
 
-public class MD5SumInputStreamTest {
+public class Md5DigestInputStreamTest {
 
     @Test
     public void testRead() throws Exception {
-        byte[] data = new byte[] { (byte)0xAA, (byte)0xBB, (byte)0xCC, (byte)0xDD };
-        try (MD5SumInputStream is = new MD5SumInputStream(new ByteArrayInputStream(data))) {
+        byte[] data = new byte[] { (byte) 0xAA, (byte) 0xBB, (byte) 0xCC, (byte) 0xDD };
+        try (Md5DigestInputStream is = new Md5DigestInputStream(new ByteArrayInputStream(data))) {
             assertEquals(0xAA, is.read());
             assertEquals(0xBB, is.read());
             assertEquals(0xCC, is.read());
             assertEquals(0xDD, is.read());
             assertEquals(-1, is.read());
-            assertEquals("ca6ffbf95b47864fd4e73f2601326304", is.digest());
+            assertEquals("CA6FFBF95B47864FD4E73F2601326304", is.getDigestHex());
         }
     }
 
     @Test
     public void testReadArray() throws Exception {
-        byte[] data = new byte[] { (byte)0xAA, (byte)0xBB, (byte)0xCC, (byte)0xDD };
-        try (MD5SumInputStream is = new MD5SumInputStream(new ByteArrayInputStream(data))) {
-            byte[] buff = new byte [5];
+        byte[] data = new byte[] { (byte) 0xAA, (byte) 0xBB, (byte) 0xCC, (byte) 0xDD };
+        try (Md5DigestInputStream is = new Md5DigestInputStream(new ByteArrayInputStream(data))) {
+            byte[] buff = new byte[5];
             assertEquals(4, is.read(buff));
             assertEquals(-1, is.read());
             for (int i = 0; i < data.length; i++) {
                 assertEquals(data[i], buff[i]);
             }
-            assertEquals("ca6ffbf95b47864fd4e73f2601326304", is.digest());
+            assertEquals("CA6FFBF95B47864FD4E73F2601326304", is.getDigestHex());
         }
     }
 }
diff --git a/src/test/java/org/eluder/coveralls/maven/plugin/util/TestIoUtil.java b/src/test/java/org/eluder/coveralls/maven/plugin/util/TestIoUtil.java
index f91e1ba..4627dd1 100644
--- a/src/test/java/org/eluder/coveralls/maven/plugin/util/TestIoUtil.java
+++ b/src/test/java/org/eluder/coveralls/maven/plugin/util/TestIoUtil.java
@@ -26,6 +26,9 @@ package org.eluder.coveralls.maven.plugin.util;
  * %[license]
  */
 
+import org.codehaus.plexus.util.IOUtil;
+
+import javax.xml.bind.DatatypeConverter;
 import java.io.File;
 import java.io.FileInputStream;
 import java.io.FileNotFoundException;
@@ -35,8 +38,8 @@ import java.io.PrintWriter;
 import java.net.URISyntaxException;
 import java.net.URL;
 import java.nio.charset.Charset;
-
-import org.codehaus.plexus.util.IOUtil;
+import java.security.MessageDigest;
+import java.security.NoSuchAlgorithmException;
 
 public class TestIoUtil {
 
@@ -72,7 +75,13 @@ public class TestIoUtil {
             throw new IllegalArgumentException(ex);
         }
     }
-    
+
+    public static String getMd5DigestHex(final String content) throws NoSuchAlgorithmException {
+        MessageDigest md = MessageDigest.getInstance("MD5");
+        byte[] digest = md.digest(content.getBytes());
+        return DatatypeConverter.printHexBinary(digest);
+    }
+
     private static URL getResourceUrl(final String resource) {
         return TestIoUtil.class.getResource(resource);
     }
