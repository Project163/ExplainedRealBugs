diff --git a/pom.xml b/pom.xml
index a293791..fc29b41 100644
--- a/pom.xml
+++ b/pom.xml
@@ -190,9 +190,6 @@
 				<groupId>org.eluder.coveralls</groupId>
 				<artifactId>coveralls-maven-plugin</artifactId>
 				<version>${project.version}</version>
-				<configuration>
-					<serviceName>travis-ci</serviceName>
-				</configuration>
 			</plugin>
 		</plugins>
 
diff --git a/src/main/java/org/eluder/coveralls/maven/plugin/AbstractCoverallsMojo.java b/src/main/java/org/eluder/coveralls/maven/plugin/AbstractCoverallsMojo.java
index f47bb58..f586c86 100644
--- a/src/main/java/org/eluder/coveralls/maven/plugin/AbstractCoverallsMojo.java
+++ b/src/main/java/org/eluder/coveralls/maven/plugin/AbstractCoverallsMojo.java
@@ -29,9 +29,10 @@ package org.eluder.coveralls.maven.plugin;
 import java.io.File;
 import java.io.IOException;
 import java.util.ArrayList;
-import java.util.Arrays;
 import java.util.Date;
 import java.util.List;
+import java.util.Map;
+import java.util.Properties;
 
 import org.apache.maven.plugin.AbstractMojo;
 import org.apache.maven.plugin.MojoExecutionException;
@@ -51,6 +52,7 @@ import org.eluder.coveralls.maven.plugin.logging.DryRunLogger;
 import org.eluder.coveralls.maven.plugin.logging.JobLogger;
 import org.eluder.coveralls.maven.plugin.logging.Logger;
 import org.eluder.coveralls.maven.plugin.logging.Logger.Position;
+import org.eluder.coveralls.maven.plugin.service.General;
 import org.eluder.coveralls.maven.plugin.service.ServiceSetup;
 import org.eluder.coveralls.maven.plugin.service.Travis;
 
@@ -92,6 +94,15 @@ public abstract class AbstractCoverallsMojo extends AbstractMojo {
     @Parameter(property = "serviceJobId")
     protected String serviceJobId;
     
+    @Parameter(property = "serviceBuildNumber")
+    protected String serviceBuildNumber;
+    
+    @Parameter(property = "serviceBuildUrl")
+    protected String serviceBuildUrl;
+    
+    @Parameter(property = "serviceEnvironment")
+    protected Properties serviceEnvironment;
+    
     /**
      * Coveralls repository token.
      */
@@ -104,6 +115,9 @@ public abstract class AbstractCoverallsMojo extends AbstractMojo {
     @Parameter(property = "branch")
     protected String branch;
 
+    @Parameter(property = "pullRequest")
+    protected String pullRequest;
+    
     /**
      * Build timestamp. Must be in 'yyyy-MM-dd HH:mm:ssa' format.
      */
@@ -173,7 +187,15 @@ public abstract class AbstractCoverallsMojo extends AbstractMojo {
      * @return environment to setup mojo and service specific mojo properties
      */
     protected Environment createEnvironment() {
-        return new Environment(this, Arrays.asList((ServiceSetup) new Travis()));
+        return new Environment(this, getServices());
+    }
+    
+    protected List<ServiceSetup> getServices() {
+        Map<String, String> env = System.getenv();
+        List<ServiceSetup> services = new ArrayList<ServiceSetup>();
+        services.add(new Travis(this.serviceName, env));
+        services.add(new General(this.serviceName, env));
+        return services;
     }
     
     /**
@@ -181,13 +203,18 @@ public abstract class AbstractCoverallsMojo extends AbstractMojo {
      * @throws IOException if an I/O error occurs
      */
     protected Job createJob() throws IOException {
-        Git git = new GitRepository(project.getBasedir(), branch).load();
+        Git git = new GitRepository(project.getBasedir()).load();
         return new Job()
             .withRepoToken(repoToken)
             .withServiceName(serviceName)
             .withServiceJobId(serviceJobId)
+            .withServiceBuildNumber(serviceBuildNumber)
+            .withServiceBuildUrl(serviceBuildUrl)
+            .withServiceEnvironment(serviceEnvironment)
             .withTimestamp(timestamp)
             .withDryRun(dryRun)
+            .withBranch(branch)
+            .withPullRequest(pullRequest)
             .withGit(git);
     }
     
diff --git a/src/main/java/org/eluder/coveralls/maven/plugin/Environment.java b/src/main/java/org/eluder/coveralls/maven/plugin/Environment.java
index 6fd5187..b650af5 100644
--- a/src/main/java/org/eluder/coveralls/maven/plugin/Environment.java
+++ b/src/main/java/org/eluder/coveralls/maven/plugin/Environment.java
@@ -29,6 +29,7 @@ package org.eluder.coveralls.maven.plugin;
 import java.io.File;
 import java.util.ArrayList;
 import java.util.List;
+import java.util.Properties;
 
 import org.apache.maven.project.MavenProject;
 import org.codehaus.plexus.util.StringUtils;
@@ -81,7 +82,7 @@ public final class Environment {
     
     private void setupService() {
         for (ServiceSetup service : services) {
-            if (service.isSelected(mojo.serviceName)) {
+            if (service.isSelected()) {
                 setupEnvironment(service);
                 break;
             }
@@ -89,20 +90,41 @@ public final class Environment {
     }
     
     private void setupEnvironment(final ServiceSetup service) {
-        String serviceJobId = service.getServiceJobId();
-        if (StringUtils.isNotBlank(serviceJobId)) {
-            mojo.serviceJobId = serviceJobId;
+        String name = service.getName();
+        if (StringUtils.isBlank(mojo.serviceName) && StringUtils.isNotBlank(name)) {
+            mojo.serviceName = name;
         }
         
-        String repoToken = service.getRepoToken();
-        if (StringUtils.isNotBlank(repoToken)) {
-            mojo.repoToken = repoToken;
+        String jobId = service.getJobId();
+        if (StringUtils.isBlank(mojo.serviceJobId) && StringUtils.isNotBlank(jobId)) {
+            mojo.serviceJobId = jobId;
+        }
+        
+        String buildNumber = service.getBuildNumber();
+        if (StringUtils.isBlank(mojo.serviceBuildNumber) && StringUtils.isNotBlank(buildNumber)) {
+            mojo.serviceBuildNumber = buildNumber;
+        }
+        
+        String buildUrl = service.getBuildUrl();
+        if (StringUtils.isBlank(mojo.serviceBuildUrl) && StringUtils.isNotBlank(buildUrl)) {
+            mojo.serviceBuildUrl = buildUrl;
         }
         
         String branch = service.getBranch();
-        if (StringUtils.isNotBlank(branch)) {
+        if (StringUtils.isBlank(mojo.branch) && StringUtils.isNotBlank(branch)) {
             mojo.branch = branch;
         }
+        
+        String pullRequest = service.getPullRequest();
+        if (StringUtils.isBlank(mojo.pullRequest) && StringUtils.isNotBlank(pullRequest)) {
+            mojo.pullRequest = pullRequest;
+        }
+        
+        Properties environment = service.getEnvironment();
+        if ((mojo.serviceEnvironment == null || mojo.serviceEnvironment.isEmpty()) &&
+                (environment != null && !environment.isEmpty())) {
+            mojo.serviceEnvironment = environment;
+        }
     }
     
     private void logSourceDirectories() {
diff --git a/src/main/java/org/eluder/coveralls/maven/plugin/domain/GitRepository.java b/src/main/java/org/eluder/coveralls/maven/plugin/domain/GitRepository.java
index 85b22d7..a5fff22 100644
--- a/src/main/java/org/eluder/coveralls/maven/plugin/domain/GitRepository.java
+++ b/src/main/java/org/eluder/coveralls/maven/plugin/domain/GitRepository.java
@@ -42,11 +42,9 @@ import org.eclipse.jgit.revwalk.RevWalk;
 public class GitRepository {
     
     private final File sourceDirectory;
-    private final String branch;
     
-    public GitRepository(final File sourceDirectory, final String branch) {
+    public GitRepository(final File sourceDirectory) {
         this.sourceDirectory = sourceDirectory;
-        this.branch = branch;
     }
     
     public Git load() throws IOException {
@@ -76,11 +74,7 @@ public class GitRepository {
     }
     
     private String getBranch(final Repository repository) throws IOException {
-        if (this.branch != null) {
-            return this.branch;
-        } else {
-            return repository.getBranch();
-        }
+        return repository.getBranch();
     }
     
     private List<Git.Remote> getRemotes(final Repository repository) {
diff --git a/src/main/java/org/eluder/coveralls/maven/plugin/domain/Job.java b/src/main/java/org/eluder/coveralls/maven/plugin/domain/Job.java
index 5ff0774..9c669fe 100644
--- a/src/main/java/org/eluder/coveralls/maven/plugin/domain/Job.java
+++ b/src/main/java/org/eluder/coveralls/maven/plugin/domain/Job.java
@@ -1,6 +1,7 @@
 package org.eluder.coveralls.maven.plugin.domain;
 
 import java.util.Date;
+import java.util.Properties;
 
 import org.eluder.coveralls.maven.plugin.validation.JobValidator;
 import org.eluder.coveralls.maven.plugin.validation.ValidationErrors;
@@ -36,8 +37,13 @@ public class Job {
     private String repoToken;
     private String serviceName;
     private String serviceJobId;
+    private String serviceBuildNumber;
+    private String serviceBuildUrl;
+    private Properties serviceEnvironment;
     private Date timestamp;
     private boolean dryRun;
+    private String branch;
+    private String pullRequest;
     private Git git;
     
     public Job() {
@@ -59,6 +65,21 @@ public class Job {
         return this;
     }
     
+    public Job withServiceBuildNumber(final String serviceBuildNumber) {
+        this.serviceBuildNumber = serviceBuildNumber;
+        return this;
+    }
+    
+    public Job withServiceBuildUrl(final String serviceBuildUrl) {
+        this.serviceBuildUrl = serviceBuildUrl;
+        return this;
+    }
+    
+    public Job withServiceEnvironment(final Properties serviceEnvironment) {
+        this.serviceEnvironment = serviceEnvironment;
+        return this;
+    }
+    
     public Job withTimestamp(final Date timestamp) {
         this.timestamp = timestamp;
         return this;
@@ -69,6 +90,16 @@ public class Job {
         return this;
     }
     
+    public Job withBranch(final String branch) {
+        this.branch = branch;
+        return this;
+    }
+    
+    public Job withPullRequest(final String pullRequest) {
+        this.pullRequest = pullRequest;
+        return this;
+    }
+    
     public Job withGit(final Git git) {
         this.git = git;
         return this;
@@ -86,6 +117,18 @@ public class Job {
         return serviceJobId;
     }
     
+    public String getServiceBuildNumber() {
+        return serviceBuildNumber;
+    }
+    
+    public String getServiceBuildUrl() {
+        return serviceBuildUrl;
+    }
+    
+    public Properties getServiceEnvironment() {
+        return serviceEnvironment;
+    }
+    
     public Date getTimestamp() {
         return timestamp;
     }
@@ -94,6 +137,14 @@ public class Job {
         return dryRun;
     }
     
+    public String getBranch() {
+        return branch;
+    }
+    
+    public String getPullRequest() {
+        return pullRequest;
+    }
+    
     public Git getGit() {
         return git;
     }
diff --git a/src/main/java/org/eluder/coveralls/maven/plugin/json/JsonWriter.java b/src/main/java/org/eluder/coveralls/maven/plugin/json/JsonWriter.java
index 52abb8a..89d0394 100644
--- a/src/main/java/org/eluder/coveralls/maven/plugin/json/JsonWriter.java
+++ b/src/main/java/org/eluder/coveralls/maven/plugin/json/JsonWriter.java
@@ -31,6 +31,8 @@ import java.io.File;
 import java.io.IOException;
 import java.text.SimpleDateFormat;
 import java.util.Date;
+import java.util.Map.Entry;
+import java.util.Properties;
 
 import org.codehaus.plexus.util.StringUtils;
 import org.eluder.coveralls.maven.plugin.ProcessingException;
@@ -68,10 +70,15 @@ public class JsonWriter implements SourceCallback, Closeable {
     public void writeStart() throws ProcessingException, IOException {
         try {
             generator.writeStartObject();
+            writeOptionalString("repo_token", job.getRepoToken());
             writeOptionalString("service_name", job.getServiceName());
             writeOptionalString("service_job_id", job.getServiceJobId());
-            writeOptionalString("repo_token", job.getRepoToken());
+            writeOptionalString("service_number", job.getServiceBuildNumber());
+            writeOptionalString("service_build_url", job.getServiceBuildUrl());
+            writeOptionalString("service_branch", job.getBranch());
+            writeOptionalString("service_pull_request", job.getPullRequest());
             writeOptionalTimestamp("run_at", job.getTimestamp());
+            writeOptionalEnvironment("environment", job.getServiceEnvironment());
             writeOptionalObject("git", job.getGit());
             generator.writeArrayFieldStart("source_files");
         } catch (JsonProcessingException ex) {
@@ -120,4 +127,14 @@ public class JsonWriter implements SourceCallback, Closeable {
             writeOptionalString(field, format.format(value));
         }
     }
+    
+    private void writeOptionalEnvironment(final String field, final Properties properties) throws ProcessingException, IOException {
+        if (properties != null) {
+            generator.writeObjectFieldStart(field);
+            for (Entry<Object, Object> property : properties.entrySet()) {
+                writeOptionalString(property.getKey().toString(), property.getValue().toString());
+            }
+            generator.writeEndObject();
+        }
+    }
 }
diff --git a/src/main/java/org/eluder/coveralls/maven/plugin/service/AbstractServiceSetup.java b/src/main/java/org/eluder/coveralls/maven/plugin/service/AbstractServiceSetup.java
new file mode 100644
index 0000000..3e9b804
--- /dev/null
+++ b/src/main/java/org/eluder/coveralls/maven/plugin/service/AbstractServiceSetup.java
@@ -0,0 +1,65 @@
+package org.eluder.coveralls.maven.plugin.service;
+
+import java.util.Map;
+import java.util.Properties;
+
+import org.codehaus.plexus.util.StringUtils;
+
+public abstract class AbstractServiceSetup implements ServiceSetup {
+
+    private final String serviceName;
+    private final Map<String, String> env;
+    
+    public AbstractServiceSetup(final String serviceName, final Map<String, String> env) {
+        this.serviceName = serviceName;
+        this.env = env;
+    }
+    
+    @Override
+    public String getName() {
+        return serviceName;
+    }
+
+    @Override
+    public String getJobId() {
+        return null;
+    }
+
+    @Override
+    public String getBuildNumber() {
+        return null;
+    }
+
+    @Override
+    public String getBuildUrl() {
+        return null;
+    }
+
+    @Override
+    public String getBranch() {
+        return null;
+    }
+
+    @Override
+    public String getPullRequest() {
+        return null;
+    }
+
+    @Override
+    public Properties getEnvironment() {
+        return null;
+    }
+    
+    protected final String getProperty(final String name) {
+        return env.get(name);
+    }
+    
+    protected final void addProperty(final Properties properties, final String name, final String value) {
+        if (StringUtils.isBlank(name)) {
+            throw new IllegalArgumentException("name must be defined");
+        }
+        if (StringUtils.isNotBlank(value)) {
+            properties.setProperty(name, value);
+        }
+    }
+}
diff --git a/src/main/java/org/eluder/coveralls/maven/plugin/service/General.java b/src/main/java/org/eluder/coveralls/maven/plugin/service/General.java
new file mode 100644
index 0000000..edeb6f9
--- /dev/null
+++ b/src/main/java/org/eluder/coveralls/maven/plugin/service/General.java
@@ -0,0 +1,46 @@
+package org.eluder.coveralls.maven.plugin.service;
+
+import java.util.Map;
+
+public class General extends AbstractServiceSetup {
+
+    public static final String CI_NAME = "CI_NAME";
+    public static final String CI_BUILD_NUMBER = "CI_BUILD_NUMBER";
+    public static final String CI_BUILD_URL = "CI_BUILD_URL";
+    public static final String CI_BRANCH = "CI_BRANCH";
+    public static final String CI_PULL_REQUEST = "CI_PULL_REQUEST";
+    
+    public General(final String serviceName, final Map<String, String> env) {
+        super(serviceName, env);
+    }
+
+    @Override
+    public boolean isSelected() {
+        return (getProperty(CI_NAME) != null);
+    }
+
+    @Override
+    public String getName() {
+        return getProperty(CI_NAME);
+    }
+
+    @Override
+    public String getBuildNumber() {
+        return getProperty(CI_BUILD_NUMBER);
+    }
+    
+    @Override
+    public String getBuildUrl() {
+        return getProperty(CI_BUILD_URL);
+    }
+    
+    @Override
+    public String getBranch() {
+        return getProperty(CI_BRANCH);
+    }
+    
+    @Override
+    public String getPullRequest() {
+        return getProperty(CI_PULL_REQUEST);
+    }
+}
diff --git a/src/main/java/org/eluder/coveralls/maven/plugin/service/ServiceSetup.java b/src/main/java/org/eluder/coveralls/maven/plugin/service/ServiceSetup.java
index 73ddaf8..521120d 100644
--- a/src/main/java/org/eluder/coveralls/maven/plugin/service/ServiceSetup.java
+++ b/src/main/java/org/eluder/coveralls/maven/plugin/service/ServiceSetup.java
@@ -1,5 +1,7 @@
 package org.eluder.coveralls.maven.plugin.service;
 
+import java.util.Properties;
+
 /*
  * #[license]
  * coveralls-maven-plugin
@@ -32,24 +34,42 @@ package org.eluder.coveralls.maven.plugin.service;
 public interface ServiceSetup {
 
     /**
-     * @param name the service name
      * @return <code>true</code> if this service is selected, otherwise <code>false</code>
      */
-    boolean isSelected(String name);
+    boolean isSelected();
+    
+    /**
+     * @return service name
+     */
+    String getName();
+    
+    /**
+     * @return service job id, or <code>null</code> if not defined
+     */
+    String getJobId();
     
     /**
-     * @return coveralls service job id, or <code>null</code> if not defined
+     * @return service build number, or <code>null</code> if not defined
      */
-    String getServiceJobId();
+    String getBuildNumber();
     
     /**
-     * @return coveralls repository token, or <code>null</code> if not defined
+     * @return service build url, or <code>null</code> if not defined
      */
-    String getRepoToken();
+    String getBuildUrl();
     
     /**
      * @return git branch name, or <code>null</code> if not defined
      */
     String getBranch();
     
+    /**
+     * @return pull request identifier, or <code>null</code> if not defined
+     */
+    String getPullRequest();
+    
+    /**
+     * @return environment related to service, or <code>null</code> if not defined
+     */
+    Properties getEnvironment();
 }
diff --git a/src/main/java/org/eluder/coveralls/maven/plugin/service/Travis.java b/src/main/java/org/eluder/coveralls/maven/plugin/service/Travis.java
index 67a5e43..0f9bd31 100644
--- a/src/main/java/org/eluder/coveralls/maven/plugin/service/Travis.java
+++ b/src/main/java/org/eluder/coveralls/maven/plugin/service/Travis.java
@@ -1,5 +1,10 @@
 package org.eluder.coveralls.maven.plugin.service;
 
+import java.util.Map;
+import java.util.Properties;
+
+import org.codehaus.plexus.util.StringUtils;
+
 /*
  * #[license]
  * coveralls-maven-plugin
@@ -26,27 +31,53 @@ package org.eluder.coveralls.maven.plugin.service;
  * %[license]
  */
 
-public class Travis implements ServiceSetup {
+public class Travis extends AbstractServiceSetup {
 
-    @Override
-    public boolean isSelected(final String name) {
-        return ("travis-ci".equals(name) ||
-                "travis-pro".equals(name));
+    public static final String TRAVIS_CI = "travis-ci";
+    public static final String TRAVIS_PRO = "travis-pro";
+    public static final String TRAVIS = "TRAVIS";
+    public static final String TRAVIS_JOB_ID = "TRAVIS_JOB_ID";
+    public static final String TRAVIS_BRANCH = "TRAVIS_BRANCH";
+    public static final String TRAVIS_PULL_REQUEST = "TRAVIS_PULL_REQUEST";
+    
+    public Travis(final String serviceName, final Map<String, String> env) {
+        super(serviceName, env);
     }
 
     @Override
-    public String getServiceJobId() {
-        return System.getenv("TRAVIS_JOB_ID");
+    public boolean isSelected() {
+        String serviceName = super.getName();
+        return (TRAVIS_CI.equals(serviceName) ||
+                TRAVIS_PRO.equals(serviceName) ||
+                "true".equalsIgnoreCase(getProperty(TRAVIS)));
     }
 
     @Override
-    public String getRepoToken() {
-        return null;
+    public String getName() {
+        String serviceName = super.getName();
+        return (StringUtils.isNotBlank(serviceName) ? serviceName : TRAVIS_CI);
+    }
+    
+    @Override
+    public String getJobId() {
+        return getProperty(TRAVIS_JOB_ID);
     }
 
     @Override
     public String getBranch() {
-        return System.getenv("TRAVIS_BRANCH");
+        return getProperty(TRAVIS_BRANCH);
+    }
+    
+    @Override
+    public String getPullRequest() {
+        return getProperty(TRAVIS_PULL_REQUEST);
+    }
+    
+    @Override
+    public Properties getEnvironment() {
+        Properties environment = new Properties();
+        addProperty(environment, "travis_job_id", getProperty(TRAVIS_JOB_ID));
+        addProperty(environment, "travis_pull_request", getProperty(TRAVIS_PULL_REQUEST));
+        return environment;
     }
-
 }
diff --git a/src/main/java/org/eluder/coveralls/maven/plugin/validation/JobValidator.java b/src/main/java/org/eluder/coveralls/maven/plugin/validation/JobValidator.java
index cf10458..4105806 100644
--- a/src/main/java/org/eluder/coveralls/maven/plugin/validation/JobValidator.java
+++ b/src/main/java/org/eluder/coveralls/maven/plugin/validation/JobValidator.java
@@ -57,7 +57,7 @@ public class JobValidator {
         if (hasValue(job.getRepoToken())) {
             return Collections.emptyList();
         }
-        if (new Travis().isSelected(job.getServiceName()) && hasValue(job.getServiceJobId())) {
+        if (new Travis(job.getServiceName(), System.getenv()).isSelected() && hasValue(job.getServiceJobId())) {
             return Collections.emptyList();
         }
         Level level = (job.isDryRun() ? Level.WARN : Level.ERROR);
diff --git a/src/test/java/org/eluder/coveralls/maven/plugin/EnvironmentTest.java b/src/test/java/org/eluder/coveralls/maven/plugin/EnvironmentTest.java
index a818f6d..a90880b 100644
--- a/src/test/java/org/eluder/coveralls/maven/plugin/EnvironmentTest.java
+++ b/src/test/java/org/eluder/coveralls/maven/plugin/EnvironmentTest.java
@@ -28,6 +28,7 @@ package org.eluder.coveralls.maven.plugin;
 
 import static org.hamcrest.Matchers.contains;
 import static org.junit.Assert.assertEquals;
+import static org.junit.Assert.assertNull;
 import static org.junit.Assert.assertThat;
 import static org.mockito.Mockito.mock;
 import static org.mockito.Mockito.verify;
@@ -37,6 +38,7 @@ import java.io.File;
 import java.util.ArrayList;
 import java.util.Arrays;
 import java.util.Collections;
+import java.util.Properties;
 
 import org.apache.maven.plugin.logging.Log;
 import org.apache.maven.project.MavenProject;
@@ -104,7 +106,7 @@ public class EnvironmentTest {
         mojo.project = mavenProjectMock;
         when(logMock.isDebugEnabled()).thenReturn(true);
         when(logMock.isInfoEnabled()).thenReturn(true);
-        when(serviceMock.isSelected("service")).thenReturn(true);
+        when(serviceMock.isSelected()).thenReturn(true);
         when(mavenProjectMock.getCollectedProjects()).thenReturn(Arrays.asList(mavenProjectMock2, mavenProjectMock3));
         when(mavenProjectMock3.getCollectedProjects()).thenReturn(Arrays.asList(mavenProjectMock4, mavenProjectMock5));
         when(mavenProjectMock2.getCompileSourceRoots()).thenReturn(Arrays.asList(folder2.getAbsolutePath()));
@@ -113,12 +115,12 @@ public class EnvironmentTest {
     }
     
     @Test(expected = IllegalArgumentException.class)
-    public void testConstructorWithoutMojo() {
+    public void testMissingMojo() {
         new Environment(null, Arrays.asList(serviceMock));
     }
     
     @Test(expected = IllegalArgumentException.class)
-    public void testConstructorWithoutServices() {
+    public void testMissingServices() {
         new Environment(mojo, null);
     }
     
@@ -129,7 +131,7 @@ public class EnvironmentTest {
     }
     
     @Test
-    public void testSetupWithoutMojoSourceDirectories() {
+    public void testSetupWithProjectSourceDirectories() {
         create(Collections.<ServiceSetup>emptyList()).setup();
         assertThat(mojo.sourceDirectories, contains(folder2.getAbsoluteFile(), folder4.getAbsoluteFile(), folder5.getAbsoluteFile()));
         verify(logMock).debug("Using 3 source directories to scan source files:");
@@ -146,36 +148,79 @@ public class EnvironmentTest {
     @Test
     public void testSetupWithoutServices() {
         create(Collections.<ServiceSetup>emptyList()).setup();
-        assertProperties(null, null, null);
+        assertEquals("service", mojo.serviceName);
     }
     
     @Test
-    public void testSetupWithoutValues() {
-        when(serviceMock.getServiceJobId()).thenReturn("");
-        when(serviceMock.getRepoToken()).thenReturn(null);
-        when(serviceMock.getBranch()).thenReturn(null);
+    public void testSetupWithIncompleteJob() {
+        when(serviceMock.getJobId()).thenReturn("");
+        when(serviceMock.getBuildUrl()).thenReturn("  ");
         
         create(Arrays.asList(serviceMock)).setup();
-        assertProperties(null, null, null);
+        assertEquals("service", mojo.serviceName);
+        assertNull(mojo.serviceJobId);
+        assertNull(mojo.serviceBuildNumber);
+        assertNull(mojo.serviceBuildUrl);
+        assertNull(mojo.branch);
+        assertNull(mojo.pullRequest);
+        assertNull(mojo.serviceEnvironment);
     }
     
     @Test
-    public void testSetupWithValues() {
-        when(serviceMock.getServiceJobId()).thenReturn("123");
-        when(serviceMock.getRepoToken()).thenReturn("abcde");
+    public void testSetupWithCompleteJob() {
+        mojo.serviceName = null;
+        Properties environment = new Properties();
+        environment.setProperty("env", "true");
+        when(serviceMock.getName()).thenReturn("defined service");
+        when(serviceMock.getJobId()).thenReturn("123");
+        when(serviceMock.getBuildNumber()).thenReturn("456");
+        when(serviceMock.getBuildUrl()).thenReturn("http://ci.com/project");
         when(serviceMock.getBranch()).thenReturn("master");
+        when(serviceMock.getPullRequest()).thenReturn("111");
+        when(serviceMock.getEnvironment()).thenReturn(environment);
         
         create(Arrays.asList(mock(ServiceSetup.class), serviceMock)).setup();
-        assertProperties("123", "abcde", "master");
+        assertEquals("defined service", mojo.serviceName);
+        assertEquals("123", mojo.serviceJobId);
+        assertEquals("456", mojo.serviceBuildNumber);
+        assertEquals("http://ci.com/project", mojo.serviceBuildUrl);
+        assertEquals("master", mojo.branch);
+        assertEquals("111", mojo.pullRequest);
+        assertEquals("true", mojo.serviceEnvironment.get("env"));
     }
     
-    private Environment create(final Iterable<ServiceSetup> services) {
-        return new Environment(mojo, services);
+    @Test
+    public void testSetupWithoutJobOverride() {
+        Properties environment = new Properties();
+        environment.setProperty("env", "true");
+        Properties serviceEnvironment = new Properties();
+        serviceEnvironment.setProperty("env", "setProperty");
+        when(serviceMock.getName()).thenReturn("defined service");
+        when(serviceMock.getJobId()).thenReturn("123");
+        when(serviceMock.getBuildNumber()).thenReturn("456");
+        when(serviceMock.getBuildUrl()).thenReturn("http://ci.com/project");
+        when(serviceMock.getBranch()).thenReturn("master");
+        when(serviceMock.getPullRequest()).thenReturn("111");
+        when(serviceMock.getEnvironment()).thenReturn(environment);
+        mojo.serviceJobId = "setJobId";
+        mojo.serviceBuildNumber = "setBuildNumber";
+        mojo.serviceBuildUrl = "setBuildUrl";
+        mojo.serviceEnvironment = serviceEnvironment;
+        mojo.branch = "setBranch";
+        mojo.pullRequest = "setPullRequest";
+        
+        create(Arrays.asList(serviceMock)).setup();
+        
+        assertEquals("service", mojo.serviceName);
+        assertEquals("setJobId", mojo.serviceJobId);
+        assertEquals("setBuildNumber", mojo.serviceBuildNumber);
+        assertEquals("setBuildUrl", mojo.serviceBuildUrl);
+        assertEquals("setBranch", mojo.branch);
+        assertEquals("setPullRequest", mojo.pullRequest);
+        assertEquals("setProperty", mojo.serviceEnvironment.get("env"));        
     }
     
-    private void assertProperties(final String serviceJobId, final String repoToken, final String branch) {
-        assertEquals(serviceJobId, mojo.serviceJobId);
-        assertEquals(repoToken, mojo.repoToken);
-        assertEquals(branch, mojo.branch);
+    private Environment create(final Iterable<ServiceSetup> services) {
+        return new Environment(mojo, services);
     }
 }
diff --git a/src/test/java/org/eluder/coveralls/maven/plugin/ProcessingExceptionTest.java b/src/test/java/org/eluder/coveralls/maven/plugin/ProcessingExceptionTest.java
new file mode 100644
index 0000000..9a6a3c5
--- /dev/null
+++ b/src/test/java/org/eluder/coveralls/maven/plugin/ProcessingExceptionTest.java
@@ -0,0 +1,43 @@
+package org.eluder.coveralls.maven.plugin;
+
+import static org.junit.Assert.assertEquals;
+import static org.junit.Assert.assertNull;
+import static org.junit.Assert.assertSame;
+
+import org.junit.Test;
+
+public class ProcessingExceptionTest {
+
+    private static final String MESSAGE = "message";
+    private static final RuntimeException CAUSE = new RuntimeException();
+    
+    @Test
+    public void testException() {
+        ProcessingException exception = new ProcessingException();
+        assertNull(exception.getMessage());
+        assertNull(exception.getCause());
+    }
+    
+    @Test
+    public void testExceptionWithMessage() {
+        ProcessingException exception = new ProcessingException(MESSAGE);
+        assertEquals(MESSAGE, exception.getMessage());
+        assertNull(exception.getCause());
+    }
+
+    @Test
+    public void testExceptionWithCause() {
+        ProcessingException exception = new ProcessingException(CAUSE);
+        assertEquals(CAUSE.toString(), exception.getMessage());
+        assertSame(CAUSE, exception.getCause());
+    }
+    
+    @Test
+    public void testExceptionWithMessageAndCause() {
+        ProcessingException exception = new ProcessingException(MESSAGE, CAUSE);
+        assertEquals(MESSAGE, exception.getMessage());
+        assertSame(CAUSE, exception.getCause());
+
+    }
+    
+}
diff --git a/src/test/java/org/eluder/coveralls/maven/plugin/domain/GitRepositoryTest.java b/src/test/java/org/eluder/coveralls/maven/plugin/domain/GitRepositoryTest.java
index dada85e..a1370f8 100644
--- a/src/test/java/org/eluder/coveralls/maven/plugin/domain/GitRepositoryTest.java
+++ b/src/test/java/org/eluder/coveralls/maven/plugin/domain/GitRepositoryTest.java
@@ -26,7 +26,6 @@ package org.eluder.coveralls.maven.plugin.domain;
  * %[license]
  */
 
-import static org.junit.Assert.assertEquals;
 import static org.junit.Assert.assertNotNull;
 
 import org.eluder.coveralls.maven.plugin.util.TestIoUtil;
@@ -39,14 +38,7 @@ public class GitRepositoryTest {
      */
     @Test
     public void testLoad() throws Exception {
-        Git git = new GitRepository(TestIoUtil.getFile("/"), null).load();
+        Git git = new GitRepository(TestIoUtil.getFile("/")).load();
         assertNotNull(git.getHead().getId());
     }
-    
-    @Test
-    public void testLoadWithPredefinedBranch() throws Exception {
-        Git git = new GitRepository(TestIoUtil.getFile("/"), "funnybranch").load();
-        assertNotNull(git.getHead().getId());
-        assertEquals("funnybranch", git.getBranch());
-    }
 }
diff --git a/src/test/java/org/eluder/coveralls/maven/plugin/json/JsonWriterTest.java b/src/test/java/org/eluder/coveralls/maven/plugin/json/JsonWriterTest.java
index e15abc3..24439c8 100644
--- a/src/test/java/org/eluder/coveralls/maven/plugin/json/JsonWriterTest.java
+++ b/src/test/java/org/eluder/coveralls/maven/plugin/json/JsonWriterTest.java
@@ -27,7 +27,6 @@ package org.eluder.coveralls.maven.plugin.json;
  */
 
 import static org.junit.Assert.assertEquals;
-import static org.junit.Assert.assertNotNull;
 import static org.junit.Assert.assertSame;
 
 import java.io.File;
@@ -38,6 +37,7 @@ import java.util.Arrays;
 import java.util.Collection;
 import java.util.HashMap;
 import java.util.Map;
+import java.util.Properties;
 
 import org.eluder.coveralls.maven.plugin.domain.Git;
 import org.eluder.coveralls.maven.plugin.domain.Job;
@@ -80,6 +80,7 @@ public class JsonWriterTest {
         
     }
     
+    @SuppressWarnings("rawtypes")
     @Test
     public void testWriteStartAndEnd() throws Exception {
         JsonWriter writer = new JsonWriter(job(), file);
@@ -93,8 +94,14 @@ public class JsonWriterTest {
         Map<String, Object> jsonMap = stringToJsonMap(content);
         assertEquals("service", jsonMap.get("service_name"));
         assertEquals("job123", jsonMap.get("service_job_id"));
+        assertEquals("build5", jsonMap.get("service_number"));
+        assertEquals("http://ci.com/build5", jsonMap.get("service_build_url"));
+        assertEquals("foobar", ((Map) jsonMap.get("environment")).get("custom_property"));
+        assertEquals("master", jsonMap.get("service_branch"));
+        assertEquals("pull10", jsonMap.get("service_pull_request"));
         assertEquals(new SimpleDateFormat(JsonWriter.TIMESTAMP_FORMAT).format(new Date(TEST_TIME)), jsonMap.get("run_at"));
-        assertNotNull(jsonMap.get("git"));
+        assertEquals("af456fge34acd", ((Map) jsonMap.get("git")).get("branch"));
+        assertEquals("aefg837fge", ((Map) ((Map) jsonMap.get("git")).get("head")).get("id"));
         assertEquals(0, ((Collection<?>) jsonMap.get("source_files")).size());
     }
     
@@ -116,11 +123,18 @@ public class JsonWriterTest {
     private Job job() {
         Git.Head head = new Git.Head("aefg837fge", "john", "john@mail.com", "john", "john@mail.com", "test commit");
         Git.Remote remote = new Git.Remote("origin", "git@git.com:foo.git");
+        Properties environment = new Properties();
+        environment.setProperty("custom_property", "foobar");
         return new Job()
             .withServiceName("service")
             .withServiceJobId("job123")
-            .withTimestamp(new Date(1357009200000l))
-            .withGit(new Git(head, "master", Arrays.asList(remote)));
+            .withServiceBuildNumber("build5")
+            .withServiceBuildUrl("http://ci.com/build5")
+            .withServiceEnvironment(environment)
+            .withBranch("master")
+            .withPullRequest("pull10")
+            .withTimestamp(new Date(TEST_TIME))
+            .withGit(new Git(head, "af456fge34acd", Arrays.asList(remote)));
     }
     
     private Source source() {
diff --git a/src/test/java/org/eluder/coveralls/maven/plugin/service/AbstractServiceSetupTest.java b/src/test/java/org/eluder/coveralls/maven/plugin/service/AbstractServiceSetupTest.java
new file mode 100644
index 0000000..07e8b66
--- /dev/null
+++ b/src/test/java/org/eluder/coveralls/maven/plugin/service/AbstractServiceSetupTest.java
@@ -0,0 +1,67 @@
+package org.eluder.coveralls.maven.plugin.service;
+
+import static org.junit.Assert.assertEquals;
+import static org.junit.Assert.assertNull;
+
+import java.util.HashMap;
+import java.util.Map;
+import java.util.Properties;
+
+import org.junit.Test;
+
+public class AbstractServiceSetupTest {
+
+    @Test
+    public void testGetMissingProperty() {
+        AbstractServiceSetup serviceSetup = create(null, new HashMap<String, String>());
+        assertNull(serviceSetup.getProperty("property"));
+    }
+    
+    @Test
+    public void testGetProperty() {
+        Map<String, String> env = new HashMap<String, String>();
+        env.put("CI_NAME", "bamboo");
+        assertEquals("bamboo", create(null, env).getProperty("CI_NAME"));
+    }
+    
+    @Test(expected = IllegalArgumentException.class)
+    public void testAddPropertyWithoutName() {
+        create(null, new HashMap<String, String>()).addProperty(new Properties(), null, "value");
+    }
+    
+    @Test
+    public void testAddPropertyWithoutValue() {
+        Properties properties = new Properties();
+        create(null, new HashMap<String, String>()).addProperty(properties, "prop", " ");
+        assertNull(properties.getProperty("prop"));
+    }
+    
+    @Test
+    public void testAddPropertyWithValue() {
+        Properties properties = new Properties();
+        create(null, new HashMap<String, String>()).addProperty(properties, "prop", "value");
+        assertEquals("value", properties.getProperty("prop"));
+    }
+    
+    @Test
+    public void testGetDefaultValues() {
+        AbstractServiceSetup serviceSetup = create(null, new HashMap<String, String>());
+        assertNull(serviceSetup.getName());
+        assertNull(serviceSetup.getJobId());
+        assertNull(serviceSetup.getBuildNumber());
+        assertNull(serviceSetup.getBuildUrl());
+        assertNull(serviceSetup.getBranch());
+        assertNull(serviceSetup.getPullRequest());
+        assertNull(serviceSetup.getEnvironment());
+    }
+    
+    private AbstractServiceSetup create(final String serviceName, final Map<String, String> env) {
+        return new AbstractServiceSetup(serviceName, env) {
+            @Override
+            public boolean isSelected() {
+                return true;
+            }
+        };
+    }
+    
+}
diff --git a/src/test/java/org/eluder/coveralls/maven/plugin/service/GeneralTest.java b/src/test/java/org/eluder/coveralls/maven/plugin/service/GeneralTest.java
new file mode 100644
index 0000000..e275793
--- /dev/null
+++ b/src/test/java/org/eluder/coveralls/maven/plugin/service/GeneralTest.java
@@ -0,0 +1,60 @@
+package org.eluder.coveralls.maven.plugin.service;
+
+import static org.junit.Assert.assertEquals;
+import static org.junit.Assert.assertFalse;
+import static org.junit.Assert.assertTrue;
+
+import java.util.HashMap;
+import java.util.Map;
+
+import org.junit.Test;
+
+public class GeneralTest {
+
+    @Test
+    public void testIsSelectedForNothing() {
+        assertFalse(new General(null, new HashMap<String, String>()).isSelected());
+    }
+    
+    @Test
+    public void testIsSelectedForCi() {
+        Map<String, String> env = new HashMap<String, String>();
+        env.put("CI_NAME", "bamboo");
+        assertTrue(new General(null, env).isSelected());
+    }
+    
+    @Test
+    public void testGetName() {
+        Map<String, String> env = new HashMap<String, String>();
+        env.put("CI_NAME", "bamboo");
+        assertEquals("bamboo", new General(null, env).getName());
+    }
+    
+    @Test
+    public void testGetBuildNumber() {
+        Map<String, String> env = new HashMap<String, String>();
+        env.put("CI_BUILD_NUMBER", "build123");
+        assertEquals("build123", new General(null, env).getBuildNumber());
+    }
+    
+    @Test
+    public void testGetBuildUrl() {
+        Map<String, String> env = new HashMap<String, String>();
+        env.put("CI_BUILD_URL", "http://bamboo.ci/build123");
+        assertEquals("http://bamboo.ci/build123", new General(null, env).getBuildUrl());
+    }
+    
+    @Test
+    public void testGetBranch() {
+        Map<String, String> env = new HashMap<String, String>();
+        env.put("CI_BRANCH", "master");
+        assertEquals("master", new General(null, env).getBranch());
+    }
+    
+    @Test
+    public void testGetPullRequest() {
+        Map<String, String> env = new HashMap<String, String>();
+        env.put("CI_PULL_REQUEST", "pull10");
+        assertEquals("pull10", new General(null, env).getPullRequest());
+    }
+}
diff --git a/src/test/java/org/eluder/coveralls/maven/plugin/service/TravisTest.java b/src/test/java/org/eluder/coveralls/maven/plugin/service/TravisTest.java
index 0b7a226..a9f4a7b 100644
--- a/src/test/java/org/eluder/coveralls/maven/plugin/service/TravisTest.java
+++ b/src/test/java/org/eluder/coveralls/maven/plugin/service/TravisTest.java
@@ -26,43 +26,79 @@ package org.eluder.coveralls.maven.plugin.service;
  * %[license]
  */
 
+import static org.junit.Assert.assertEquals;
 import static org.junit.Assert.assertFalse;
-import static org.junit.Assert.assertNotNull;
-import static org.junit.Assert.assertNull;
 import static org.junit.Assert.assertTrue;
 
-import org.junit.Before;
+import java.util.HashMap;
+import java.util.Map;
+import java.util.Properties;
+
 import org.junit.Test;
 
 public class TravisTest {
-
-    private boolean travis;
     
-    @Before
-    public void init() {
-        travis = Boolean.valueOf(System.getenv("TRAVIS")).booleanValue();
+    @Test
+    public void testIsSelectedForTravisCi() {
+        assertTrue(new Travis("travis-ci", new HashMap<String, String>()).isSelected());
+    }
+    
+    @Test
+    public void testIsSelectedForTravisPro() {
+        assertTrue(new Travis("travis-pro", new HashMap<String, String>()).isSelected());
+    }
+    
+    @Test
+    public void testIsSelectedForEnvironment() {
+        Map<String, String> env = new HashMap<String, String>();
+        env.put("TRAVIS", "true");
+        assertTrue(new Travis(null, env).isSelected());
+    }
+    
+    @Test
+    public void testIsSelectedForNothing() {
+        assertFalse(new Travis(null, new HashMap<String, String>()).isSelected());
+    }
+    
+    @Test
+    public void testGetNameForServiceName() {
+        assertEquals("travis-pro", new Travis("travis-pro", new HashMap<String, String>()).getName());
+    }
+    
+    @Test
+    public void testGetNameForDefault() {
+        assertEquals("travis-ci", new Travis(null, new HashMap<String, String>()).getName());
+    }
+    
+    @Test
+    public void testGetJobId() {
+        Map<String, String> env = new HashMap<String, String>();
+        env.put("TRAVIS_JOB_ID", "job123");
+        assertEquals("job123", new Travis(null, env).getJobId());
+    }
+
+    @Test
+    public void testGetBranch() {
+        Map<String, String> env = new HashMap<String, String>();
+        env.put("TRAVIS_BRANCH", "master");
+        assertEquals("master", new Travis(null, env).getBranch());
     }
     
     @Test
-    public void testIsSelected() {
-        Travis service = new Travis();
-        assertTrue(service.isSelected("travis-ci"));
-        assertTrue(service.isSelected("travis-pro"));
-        assertFalse(service.isSelected("travis"));
-        assertFalse(service.isSelected(""));
-        assertFalse(service.isSelected(null));
+    public void testGetPullRequest() {
+        Map<String, String> env = new HashMap<String, String>();
+        env.put("TRAVIS_PULL_REQUEST", "pull10");
+        assertEquals("pull10", new Travis(null, env).getPullRequest());
     }
     
     @Test
-    public void testValues() {
-        Travis service = new Travis();
-        if (travis) {
-            assertNotNull(service.getServiceJobId());
-            assertNotNull(service.getBranch());
-        } else {
-            assertNull(service.getServiceJobId());
-            assertNull(service.getBranch());
-        }
-        assertNull(service.getRepoToken());
+    public void testGetCustomProperties() {
+        Map<String, String> env = new HashMap<String, String>();
+        env.put("TRAVIS_JOB_ID", "123");
+        env.put("TRAVIS_PULL_REQUEST", "999");
+        Properties properties = new Travis(null, env).getEnvironment();
+        assertEquals(2, properties.size());
+        assertEquals("123", properties.getProperty("travis_job_id"));
+        assertEquals("999", properties.getProperty("travis_pull_request"));
     }
 }
