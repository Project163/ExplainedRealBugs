{"url":"https://api.github.com/repos/hashicorp/vagrant/issues/11403","repository_url":"https://api.github.com/repos/hashicorp/vagrant","labels_url":"https://api.github.com/repos/hashicorp/vagrant/issues/11403/labels{/name}","comments_url":"https://api.github.com/repos/hashicorp/vagrant/issues/11403/comments","events_url":"https://api.github.com/repos/hashicorp/vagrant/issues/11403/events","html_url":"https://github.com/hashicorp/vagrant/issues/11403","id":566799945,"node_id":"MDU6SXNzdWU1NjY3OTk5NDU=","number":11403,"title":"`read_dhcp_servers` function is not compatible with Virtualbox 6.1","user":{"login":"mathiasaerts","id":2611439,"node_id":"MDQ6VXNlcjI2MTE0Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/2611439?v=4","gravatar_id":"","url":"https://api.github.com/users/mathiasaerts","html_url":"https://github.com/mathiasaerts","followers_url":"https://api.github.com/users/mathiasaerts/followers","following_url":"https://api.github.com/users/mathiasaerts/following{/other_user}","gists_url":"https://api.github.com/users/mathiasaerts/gists{/gist_id}","starred_url":"https://api.github.com/users/mathiasaerts/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mathiasaerts/subscriptions","organizations_url":"https://api.github.com/users/mathiasaerts/orgs","repos_url":"https://api.github.com/users/mathiasaerts/repos","events_url":"https://api.github.com/users/mathiasaerts/events{/privacy}","received_events_url":"https://api.github.com/users/mathiasaerts/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":25816,"node_id":"MDU6TGFiZWwyNTgxNg==","url":"https://api.github.com/repos/hashicorp/vagrant/labels/bug","name":"bug","color":"e11d21","default":true,"description":null},{"id":46586,"node_id":"MDU6TGFiZWw0NjU4Ng==","url":"https://api.github.com/repos/hashicorp/vagrant/labels/upstream","name":"upstream","color":"ededed","default":false,"description":null},{"id":139180666,"node_id":"MDU6TGFiZWwxMzkxODA2NjY=","url":"https://api.github.com/repos/hashicorp/vagrant/labels/provider/virtualbox","name":"provider/virtualbox","color":"bfe5bf","default":false,"description":null}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2020-02-18T10:37:22Z","updated_at":"2020-03-20T01:50:25Z","closed_at":"2020-02-18T20:14:36Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"We've been encountering similar issues as in #3083 and we've traced the DHCP server creation in the Vagrant codebase. It seems that the `read_dhcp_servers` function parses the output of `VBoxManage list dhcpservers` which has changed between VirtualBox 6.0 and 6.1.\r\n\r\n**VirtualBox 6.0 output:**\r\n```\r\nNetworkName:    HostInterfaceNetworking-vboxnet0\r\nIP:             172.28.128.2\r\nNetworkMask:    255.255.255.0\r\nlowerIPAddress: 172.28.128.3\r\nupperIPAddress: 172.28.128.254\r\nEnabled:        Yes\r\nGlobal options:\r\n   1:255.255.255.0\r\n\r\n```\r\n\r\n**VirtualBox 6.1 output:**\r\n```\r\nNetworkName:    HostInterfaceNetworking-vboxnet0\r\nDhcpd IP:       172.28.128.2\r\nLowerIPAddress: 172.28.128.3\r\nUpperIPAddress: 172.28.128.254\r\nNetworkMask:    255.255.255.0\r\nEnabled:        Yes\r\nGlobal Configuration:\r\n    minLeaseTime:     default\r\n    defaultLeaseTime: default\r\n    maxLeaseTime:     default\r\n    Forced options:   None\r\n    Suppressed opts.: None\r\n        1/legacy: 255.255.255.0\r\nGroups:               None\r\nIndividual Configs:   None\r\n\r\n```\r\n\r\nIt is obvious that the output is different and this line for example will not match the new output from VirtualBox 6.1: https://github.com/hashicorp/vagrant/blob/ac268e26382c17057a20cd24fb1dccd59cc0d9e2/plugins/providers/virtualbox/driver/version_5_0.rb#L441\r\n\r\n### Vagrant version\r\n```\r\n$ vagrant --version\r\nVagrant 2.2.7\r\n```\r\n\r\n### Host operating system\r\n```\r\nDescription:\tManjaro Linux\r\nRelease:\t18.1.5\r\nCodename:\tJuhraya\r\n```\r\nBut this also occurs on Ubuntu 18.04 and Windows 10 with the same version of Vagrant and VirtualBox 6.1\r\n\r\n### Guest operating system\r\nUbuntu 16.04 (although this seems irrelevant) \r\n\r\n### Vagrantfile\r\nIt appears to affect any Vagrantfile that uses DHCP and not a fixed IP address.\r\n```ruby\r\nVagrant.configure(\"2\") do |config|\r\n...\r\n  config.vm.network \"private_network\", type: \"dhcp\"\r\n...\r\nend\r\n```\r\n\r\n### Debug output\r\nhttps://gist.github.com/mathiasaerts/404bf35332ffe57f6706bc5f3b3ae145\r\n\r\n### Expected behavior\r\nVagrant should not try to create a new DHCP server when one already exists, or properly increment the counter in the dhcpserver name.\r\n\r\n### Actual behavior\r\nVagrant fails to start the VirtualBox VM with the following error:\r\n```\r\nA host only network interface you're attempting to configure via DHCP\r\nalready has a conflicting host only adapter with DHCP enabled. The\r\nDHCP on this adapter is incompatible with the DHCP settings. Two\r\nhost only network interfaces are not allowed to overlap, and each\r\nhost only network interface can have only one DHCP server. Please\r\nreconfigure your host only network or remove the virtual machine\r\nusing the other host only network.\r\n```\r\n\r\n### Steps to reproduce\r\n1. Ensure you're using VirtualBox 6.1 and Vagrant 2.2.7\r\n2. Create a Vagrantfile with the configuration mentioned above\r\n3. Run `vagrant up`\r\n4. Run `vagrant halt`\r\n5. Run `vagrant up` again and the error above will be displayed.\r\n\r\n### References\r\n- #3083 seems to report the same issue, other people have commented there as well after upgrading to a new VirtualBox version.\r\n","closed_by":{"login":"jbonhag","id":6937257,"node_id":"MDQ6VXNlcjY5MzcyNTc=","avatar_url":"https://avatars.githubusercontent.com/u/6937257?v=4","gravatar_id":"","url":"https://api.github.com/users/jbonhag","html_url":"https://github.com/jbonhag","followers_url":"https://api.github.com/users/jbonhag/followers","following_url":"https://api.github.com/users/jbonhag/following{/other_user}","gists_url":"https://api.github.com/users/jbonhag/gists{/gist_id}","starred_url":"https://api.github.com/users/jbonhag/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbonhag/subscriptions","organizations_url":"https://api.github.com/users/jbonhag/orgs","repos_url":"https://api.github.com/users/jbonhag/repos","events_url":"https://api.github.com/users/jbonhag/events{/privacy}","received_events_url":"https://api.github.com/users/jbonhag/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/hashicorp/vagrant/issues/11403/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/hashicorp/vagrant/issues/11403/timeline","performed_via_github_app":null,"state_reason":"completed"}