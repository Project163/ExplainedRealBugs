{"url":"https://api.github.com/repos/hashicorp/vagrant/issues/10438","repository_url":"https://api.github.com/repos/hashicorp/vagrant","labels_url":"https://api.github.com/repos/hashicorp/vagrant/issues/10438/labels{/name}","comments_url":"https://api.github.com/repos/hashicorp/vagrant/issues/10438/comments","events_url":"https://api.github.com/repos/hashicorp/vagrant/issues/10438/events","html_url":"https://github.com/hashicorp/vagrant/issues/10438","id":383506452,"node_id":"MDU6SXNzdWUzODM1MDY0NTI=","number":10438,"title":"Powershell exit code 4294770688 (‭FFFD0000‬) during vagrant up","user":{"login":"czukowski","id":186792,"node_id":"MDQ6VXNlcjE4Njc5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/186792?v=4","gravatar_id":"","url":"https://api.github.com/users/czukowski","html_url":"https://github.com/czukowski","followers_url":"https://api.github.com/users/czukowski/followers","following_url":"https://api.github.com/users/czukowski/following{/other_user}","gists_url":"https://api.github.com/users/czukowski/gists{/gist_id}","starred_url":"https://api.github.com/users/czukowski/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/czukowski/subscriptions","organizations_url":"https://api.github.com/users/czukowski/orgs","repos_url":"https://api.github.com/users/czukowski/repos","events_url":"https://api.github.com/users/czukowski/events{/privacy}","received_events_url":"https://api.github.com/users/czukowski/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":218286867,"node_id":"MDU6TGFiZWwyMTgyODY4Njc=","url":"https://api.github.com/repos/hashicorp/vagrant/labels/host/windows","name":"host/windows","color":"d4c5f9","default":false,"description":null},{"id":545815065,"node_id":"MDU6TGFiZWw1NDU4MTUwNjU=","url":"https://api.github.com/repos/hashicorp/vagrant/labels/encoding","name":"encoding","color":"fbca04","default":false,"description":null}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2018-11-22T12:04:35Z","updated_at":"2020-03-28T02:16:26Z","closed_at":"2018-12-08T00:28:38Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Vagrant version\r\nVagrant 2.2.1, (actually noticed the issue on 2.2.0 and upgraded in hope for a quick fix)\r\n\r\n### Host operating system\r\nWindows 10.\r\n\r\n### Expected behavior\r\n`vagrant up` should have started successfully, as it has for a long time before today.\r\n\r\n### Actual behavior\r\nError message is displayed (excerpts from debug output):\r\n\r\n```\r\nVagrant requires administrator access to create SMB shares and\r\nmay request access to complete setup of configured shares.\r\n INFO subprocess: Starting process: [\"C:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\/powershell.EXE\", \"-NoLogo\", \"-NoProfile\", \"-NonInteractive\", \"-ExecutionPolicy\", \"Bypass\", \"-Command\", \"$p = Start-Process -FilePath powershell -ArgumentList @('-NoLogo', '-NoProfile', '-NonInteractive', '-ExecutionPolicy', 'Bypass', '-EncodedCommand', 'JABwACAAPQAgAFMAdABhAHIAdAAtAFAAcgBvAGMAZQBzAHMAIAAtAEYAaQBsAGUAUABhAHQAaAAgAHAAbwB3AGUAcgBzAGgAZQBsAGwAIAAtAEEAcgBnAHUAbQBlAG4AdABMAGkAcwB0ACAAQAAoACcALQBOAG8ATABvAGcAbwAnACwAIAAnAC0ATgBvAFAAcgBvAGYAaQBsAGUAJwAsACAAJwAtAE4AbwBuAEkAbgB0AGUAcgBhAGMAdABpAHYAZQAnACwAIAAnAC0ARQB4AGUAYwB1AHQAaQBvAG4AUABvAGwAaQBjAHkAJwAsACAAJwBCAHkAcABhAHMAcwAnACwAIAAnAC0ARQBuAGMAbwBkAGUAZABDAG8AbQBtAGEAbgBkACcALAAgACcASgBnAEEAZwBBAEMASQBBAFEAdwBBADYAQQBDADgAQQBVAEEAQgB5AEEARwA4AEEAWgB3AEIAeQBBAEcARQBBAGIAUQBCAHoAQQBDADgAQQBWAGcAQgBoAEEARwBjAEEAYwBnAEIAaABBAEcANABBAGQAQQBBAHYAQQBHAFUAQQBiAFEAQgBpAEEARwBVAEEAWgBBAEIAawBBAEcAVQBBAFoAQQBBAHYAQQBHAGMAQQBaAFEAQgB0AEEASABNAEEATAB3AEEAeQBBAEMANABBAE0AZwBBAHUAQQBEAEUAQQBMAHcAQgBuAEEARwBVAEEAYgBRAEIAegBBAEMAOABBAGQAZwBCAGgAQQBHAGMAQQBjAGcAQgBoAEEARwA0AEEAZABBAEEAdABBAEQASQBBAEwAZwBBAHkAQQBDADQAQQBNAFEAQQB2AEEASABBAEEAYgBBAEIAMQBBAEcAYwBBAGEAUQBCAHUAQQBIAE0AQQBMAHcAQgBvAEEARwA4AEEAYwB3AEIAMABBAEgATQBBAEwAdwBCADMAQQBHAGsAQQBiAGcAQgBrAEEARwA4AEEAZAB3AEIAegBBAEMAOABBAGMAdwBCAGoAQQBIAEkAQQBhAFEAQgB3AEEASABRAEEAYwB3AEEAdgBBAEgATQBBAFoAUQBCADAAQQBGADgAQQBjAHcAQgBvAEEARwBFAEEAYwBnAEIAbABBAEMANABBAGMAQQBCAHoAQQBEAEUAQQBJAGcAQQBnAEEAQwBJAEEAUQB3AEEANgBBAEYAdwBBAFYAdwBCAHYAQQBIAEkAQQBhAHcAQgB6AEEASABBAEEAWQBRAEIAagBBAEcAVQBBAFgAQQBCAFMAQQBHAFUAQQBZAGcAQgBsAEEARwB3AEEAUQBRAEIAdQBBAEcAUQBBAFIAdwBCAHMAQQBHADgAQQBjAGcAQgA1AEEARgB3AEEAZABnAEIAdgBBAEcAdwBBAFkAZwBCADUAQQBGAHcAQQBkAHcAQgBsAEEARwBJAEEASQBnAEEAZwBBAEMASQBBAGQAZwBCAG4AQQBIAFEAQQBMAFEAQgBtAEEARABrAEEAWQBRAEIAaQBBAEQARQBBAFkAdwBBADAAQQBEAFUAQQBaAFEAQQAyAEEARABJAEEAWgBRAEIAbABBAEcAUQBBAFkAUQBCAGgAQQBHAFkAQQBaAEEAQQAwAEEARABrAEEAWQBnAEEANQBBAEcAWQBBAFoAQQBBAHgAQQBHAEkAQQBNAGcAQgBtAEEARABRAEEATgBBAEEAdwBBAEcATQBBAEwAUQBBADIAQQBEAEEAQQBZAHcAQgBoAEEARABrAEEATQB3AEEAdwBBAEQAWQBBAE8AUQBBADQAQQBEAGcAQQBZAGcAQQAwAEEARwBRAEEAWgBRAEEAMQBBAEcARQBBAFoAUQBBADAAQQBHAEkAQQBZAGcAQQB5AEEARABZAEEATQB3AEIAagBBAEQAWQBBAE0AQQBCAGgAQQBEAEEAQQBOAFEAQQB4AEEARwBVAEEASQBnAEEAZwBBAEMASQBBAGQAZwBCAG4AQQBIAFEAQQBMAFEAQgBtAEEARABrAEEAWQBRAEIAaQBBAEQARQBBAFkAdwBBADAAQQBEAFUAQQBaAFEAQQAyAEEARABJAEEAWgBRAEIAbABBAEcAUQBBAFkAUQBCAGgAQQBHAFkAQQBaAEEAQQAwAEEARABrAEEAWQBnAEEANQBBAEcAWQBBAFoAQQBBAHgAQQBHAEkAQQBNAGcAQgBtAEEARABRAEEATgBBAEEAdwBBAEcATQBBAEwAUQBBADIAQQBEAEEAQQBZAHcAQgBoAEEARABrAEEATQB3AEEAdwBBAEQAWQBBAE8AUQBBADQAQQBEAGcAQQBZAGcAQQAwAEEARwBRAEEAWgBRAEEAMQBBAEcARQBBAFoAUQBBADAAQQBHAEkAQQBZAGcAQQB5AEEARABZAEEATQB3AEIAagBBAEQAWQBBAE0AQQBCAGgAQQBEAEEAQQBOAFEAQQB4AEEARwBVAEEASQBnAEEAZwBBAEMASQBBAFEAdwBBADYAQQBGAHcAQQBWAHcAQgB2AEEASABJAEEAYQB3AEIAegBBAEgAQQBBAFkAUQBCAGoAQQBHAFUAQQBYAEEAQgBTAEEARwBVAEEAWQBnAEIAbABBAEcAdwBBAFEAUQBCAHUAQQBHAFEAQQBSAHcAQgBzAEEARwA4AEEAYwBnAEIANQBBAEYAdwBBAGQAZwBCAHYAQQBHAHcAQQBZAGcAQgA1AEEARgB3AEEAWgBBAEIAaABBAEgAUQBBAFkAUQBBAGkAQQBDAEEAQQBJAGcAQgAyAEEARwBjAEEAZABBAEEAdABBAEcAWQBBAE8AUQBCAGgAQQBHAEkAQQBNAFEAQgBqAEEARABRAEEATgBRAEIAbABBAEQAWQBBAE0AZwBCAGwAQQBHAFUAQQBaAEEAQgBoAEEARwBFAEEAWgBnAEIAawBBAEQAUQBBAE8AUQBCAGkAQQBEAGsAQQBaAGcAQgBrAEEARABFAEEAWQBnAEEAeQBBAEcAWQBBAE4AQQBBADAAQQBEAEEAQQBZAHcAQQB0AEEARABVAEEATgBBAEEAegBBAEQAQQBBAE0AQQBBADAAQQBHAEUAQQBNAGcAQQA1AEEARwBVAEEATwBRAEIAaQBBAEQAQQBBAFkAdwBBAHcAQQBEAGMAQQBaAEEAQQA0AEEARwBRAEEATgBBAEEAMgBBAEQAWQBBAE4AZwBCAG0AQQBEAEEAQQBOAGcAQQAxAEEARABRAEEAWgBnAEIAaABBAEcARQBBAE0AQQBBAGkAQQBDAEEAQQBJAGcAQgAyAEEARwBjAEEAZABBAEEAdABBAEcAWQBBAE8AUQBCAGgAQQBHAEkAQQBNAFEAQgBqAEEARABRAEEATgBRAEIAbABBAEQAWQBBAE0AZwBCAGwAQQBHAFUAQQBaAEEAQgBoAEEARwBFAEEAWgBnAEIAawBBAEQAUQBBAE8AUQBCAGkAQQBEAGsAQQBaAGcAQgBrAEEARABFAEEAWQBnAEEAeQBBAEcAWQBBAE4AQQBBADAAQQBEAEEAQQBZAHcAQQB0AEEARABVAEEATgBBAEEAegBBAEQAQQBBAE0AQQBBADAAQQBHAEUAQQBNAGcAQQA1AEEARwBVAEEATwBRAEIAaQBBAEQAQQBBAFkAdwBBAHcAQQBEAGMAQQBaAEEAQQA0AEEARwBRAEEATgBBAEEAMgBBAEQAWQBBAE4AZwBCAG0AQQBEAEEAQQBOAGcAQQAxAEEARABRAEEAWgBnAEIAaABBAEcARQBBAE0AQQBBAGkAQQBDAEEAQQBPAHcAQQBnAEEARwBVAEEAZQBBAEIAcABBAEgAUQBBAEkAQQBBAGsAQQBFAHcAQQBRAFEAQgBUAEEARgBRAEEAUgBRAEIAWQBBAEUAawBBAFYAQQBCAEQAQQBFADgAQQBSAEEAQgBGAEEARABzAEEAJwApACAALQBQAGEAcwBzAFQAaAByAHUAIAAtAFcAaQBuAGQAbwB3AFMAdAB5AGwAZQAgAEgAaQBkAGQAZQBuACAALQBXAGEAaQB0ACAALQBSAGUAZABpAHIAZQBjAHQAUwB0AGEAbgBkAGEAcgBkAE8AdQB0AHAAdQB0ACAAJwBDADoALwBVAHMAZQByAHMALwBDAFoAVQBLAE8AVwB-ADEALwBBAHAAcABEAGEAdABhAC8ATABvAGMAYQBsAC8AVABlAG0AcAAvAHYAYQBnAHIAYQBuAHQAMgAwADEAOAAxADEAMgAyAC0AMQA1ADcAMgAtADEAaQBiAHgAdABqAG8ALwBzAHQAZABvAHUAdAAuAHQAeAB0ACcAIAAtAFIAZQBkAGkAcgBlAGMAdABTAHQAYQBuAGQAYQByAGQARQByAHIAbwByACAAJwBDADoALwBVAHMAZQByAHMALwBDAFoAVQBLAE8AVwB-ADEALwBBAHAAcABEAGEAdABhAC8ATABvAGMAYQBsAC8AVABlAG0AcAAvAHYAYQBnAHIAYQBuAHQAMgAwADEAOAAxADEAMgAyAC0AMQA1ADcAMgAtADEAaQBiAHgAdABqAG8ALwBzAHQAZABlAHIAcgAuAHQAeAB0ACcAOwAgAGkAZgAoACQAcAApAHsAIABlAHgAaQB0ACAAJABwAC4ARQB4AGkAdABDAG8AZABlADsAIAB9AGUAbABzAGUAewAgAGUAeABpAHQAIAAxACAAfQA=') -PassThru -WindowStyle Hidden -Wait -Verb RunAs; if($p){ exit $p.ExitCode; }else{ exit 1 }\"]\r\n INFO subprocess: Command not in installer, restoring original environment...DEBUG subprocess: Selecting on IO\r\nDEBUG subprocess: Waiting for process to exit. Remaining to timeout: 31999\r\nDEBUG subprocess: Exit status: 4294770688\r\n```\r\n\r\nand later:\r\n\r\n```\r\n INFO interface: error: Exporting an SMB share failed! Details about the failure are shown\r\nbelow. Please inspect the error message and correct any problems.\r\n\r\nHost path:\r\n\r\nStderr:\r\n\r\nStdout:\r\nExporting an SMB share failed! Details about the failure are shown\r\nbelow. Please inspect the error message and correct any problems.\r\n```\r\n\r\n### My research\r\nI think the error code indicates the command has not been executed because it was malformed. I tried to debug `Vagrant::Util::PowerShell` around here:\r\n\r\nhttps://github.com/hashicorp/vagrant/blob/45766ad00e5567fe6706a84fe07ba922b442dc34/lib/vagrant/util/powershell.rb#L216-L227\r\n\r\nI found that the `EncodedCommand` it has produced what appears to be a broken base64 string, see gist: https://gist.github.com/czukowski/9dba0e991ae3515a730ad13ef58f9411\r\n\r\nNote how the decoded version breaks near `-RedirectStandardOutput 'C:/Users/CZUKOWీୀჀ᱀ᰀᄀ᠀ᵀ᠀ୀᏀᬀᣀ`\r\n\r\nThe content of `dpath`  variable was: `C:/Users/CZUKOW~1/AppData/Local/Temp/vagrant20181122-10048-pj7qli`\r\n\r\nIt breaks exactly at the tilde char in short path. The user directory name (czukowski) does not have any weird characters in it. Everything was working perfectly just yesterday. \r\n\r\nI'm not very familiar with Ruby, but I suppose `Dir.mktmpdir(\"vagrant\")` is a built-in method?\r\n\r\n### Steps to reproduce\r\nThis must be something in my system. I am a long time Vagrant user, but today was the 1st time I encountered the issue, now it happens consistently on SMB share creation or pruning :(","closed_by":{"login":"chrisroberts","id":266674,"node_id":"MDQ6VXNlcjI2NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/266674?v=4","gravatar_id":"","url":"https://api.github.com/users/chrisroberts","html_url":"https://github.com/chrisroberts","followers_url":"https://api.github.com/users/chrisroberts/followers","following_url":"https://api.github.com/users/chrisroberts/following{/other_user}","gists_url":"https://api.github.com/users/chrisroberts/gists{/gist_id}","starred_url":"https://api.github.com/users/chrisroberts/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chrisroberts/subscriptions","organizations_url":"https://api.github.com/users/chrisroberts/orgs","repos_url":"https://api.github.com/users/chrisroberts/repos","events_url":"https://api.github.com/users/chrisroberts/events{/privacy}","received_events_url":"https://api.github.com/users/chrisroberts/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/hashicorp/vagrant/issues/10438/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/hashicorp/vagrant/issues/10438/timeline","performed_via_github_app":null,"state_reason":"completed"}