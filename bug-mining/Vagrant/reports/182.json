{"url":"https://api.github.com/repos/hashicorp/vagrant/issues/10914","repository_url":"https://api.github.com/repos/hashicorp/vagrant","labels_url":"https://api.github.com/repos/hashicorp/vagrant/issues/10914/labels{/name}","comments_url":"https://api.github.com/repos/hashicorp/vagrant/issues/10914/comments","events_url":"https://api.github.com/repos/hashicorp/vagrant/issues/10914/events","html_url":"https://github.com/hashicorp/vagrant/issues/10914","id":456685744,"node_id":"MDU6SXNzdWU0NTY2ODU3NDQ=","number":10914,"title":"ansible_local hangs at interactive prompt","user":{"login":"ghost","id":10137,"node_id":"MDQ6VXNlcjEwMTM3","avatar_url":"https://avatars.githubusercontent.com/u/10137?v=4","gravatar_id":"","url":"https://api.github.com/users/ghost","html_url":"https://github.com/ghost","followers_url":"https://api.github.com/users/ghost/followers","following_url":"https://api.github.com/users/ghost/following{/other_user}","gists_url":"https://api.github.com/users/ghost/gists{/gist_id}","starred_url":"https://api.github.com/users/ghost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ghost/subscriptions","organizations_url":"https://api.github.com/users/ghost/orgs","repos_url":"https://api.github.com/users/ghost/repos","events_url":"https://api.github.com/users/ghost/events{/privacy}","received_events_url":"https://api.github.com/users/ghost/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":46586,"node_id":"MDU6TGFiZWw0NjU4Ng==","url":"https://api.github.com/repos/hashicorp/vagrant/labels/upstream","name":"upstream","color":"ededed","default":false,"description":null},{"id":207420987,"node_id":"MDU6TGFiZWwyMDc0MjA5ODc=","url":"https://api.github.com/repos/hashicorp/vagrant/labels/guest/ubuntu","name":"guest/ubuntu","color":"5319e7","default":false,"description":null},{"id":386516153,"node_id":"MDU6TGFiZWwzODY1MTYxNTM=","url":"https://api.github.com/repos/hashicorp/vagrant/labels/provisioner/ansible_local","name":"provisioner/ansible_local","color":"bfdadc","default":false,"description":null}],"state":"closed","locked":true,"assignee":{"login":"gildegoma","id":434654,"node_id":"MDQ6VXNlcjQzNDY1NA==","avatar_url":"https://avatars.githubusercontent.com/u/434654?v=4","gravatar_id":"","url":"https://api.github.com/users/gildegoma","html_url":"https://github.com/gildegoma","followers_url":"https://api.github.com/users/gildegoma/followers","following_url":"https://api.github.com/users/gildegoma/following{/other_user}","gists_url":"https://api.github.com/users/gildegoma/gists{/gist_id}","starred_url":"https://api.github.com/users/gildegoma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gildegoma/subscriptions","organizations_url":"https://api.github.com/users/gildegoma/orgs","repos_url":"https://api.github.com/users/gildegoma/repos","events_url":"https://api.github.com/users/gildegoma/events{/privacy}","received_events_url":"https://api.github.com/users/gildegoma/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"gildegoma","id":434654,"node_id":"MDQ6VXNlcjQzNDY1NA==","avatar_url":"https://avatars.githubusercontent.com/u/434654?v=4","gravatar_id":"","url":"https://api.github.com/users/gildegoma","html_url":"https://github.com/gildegoma","followers_url":"https://api.github.com/users/gildegoma/followers","following_url":"https://api.github.com/users/gildegoma/following{/other_user}","gists_url":"https://api.github.com/users/gildegoma/gists{/gist_id}","starred_url":"https://api.github.com/users/gildegoma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gildegoma/subscriptions","organizations_url":"https://api.github.com/users/gildegoma/orgs","repos_url":"https://api.github.com/users/gildegoma/repos","events_url":"https://api.github.com/users/gildegoma/events{/privacy}","received_events_url":"https://api.github.com/users/gildegoma/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":6,"created_at":"2019-06-16T21:49:38Z","updated_at":"2020-01-28T01:56:43Z","closed_at":"2019-12-17T19:30:49Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Vagrant version\r\n\r\nVagrant 2.2.4\r\n\r\n### Host operating system\r\n\r\nArch Linux\r\n\r\n### Guest operating system\r\n\r\nUbuntu 18.10.\r\n\r\n### Vagrantfile\r\n```ruby\r\nVagrant.configure('2') do |config|\r\n  config.ssh.forward_agent = true\r\n\r\n  config.vm.provision 'ansible_local' do |ansible|\r\n    ansible.playbook = 'provisioning/ansible/setup-development-vm.yml'\r\n    ansible.compatibility_mode = '2.0'\r\n  end\r\nend\r\n```\r\n\r\n### Debug output\r\n\r\n[Gist](https://gist.github.com/dms-cat/52109e84a972adb0abca901e1880af27)\r\n\r\n### Expected behavior\r\n\r\nAnsible installation should succeed.\r\n\r\n### Actual behavior\r\n\r\nThe install process gets stuck forever. `ps` shows this command tree:\r\n\r\n```\r\n/usr/bin/dpkg --status-fd 38 --configure --pending\r\n \\_ /usr/bin/perl -w /usr/share/debconf/frontend /var/lib/dpkg/info/libssl1.1:amd64.postinst configure 1.1.0g-2ubuntu4.3\r\n     \\_ /bin/sh /var/lib/dpkg/info/libssl1.1:amd64.postinst configure 1.1.0g-2ubuntu4.3\r\n     \\_ whiptail --backtitle Package configuration --title Configuring libssl1.1:amd64 --output-fd 11 --defaultno --yesno -- There are services installed on your system which need to be restarted  when certain libraries, such as libpam, libc, and libssl, are upgraded.  Since these restarts may cause interruptions of service for the system,  you will normally be prompted on each upgrade for the list of services  you wish to restart.  You can choose this option to avoid being  prompted; instead, all necessary restarts will be done for you  automatically so you can avoid being asked questions on each library  upgrade.  Restart services during package upgrades without asking? 16 77\r\n```\r\n\r\nI assume the `whiptail` command is keeping the script from completing.\r\n\r\n### Steps to reproduce\r\n\r\n1. Use the  Ansible Local Provisioner\r\n2. `vagrant destroy -f`\r\n3. `vagrant up`\r\n\r\n### Workaround\r\n\r\nUse the `shell` provisioner to run a script containing this:\r\n\r\n```\r\nsudo apt-get update -y -qq\r\nsudo DEBIAN_FRONTEND=noninteractive apt-get install -y -qq software-properties-common\r\nsudo add-apt-repository ppa:ansible/ansible -y\r\nsudo apt-get update -y -qq\r\nsudo DEBIAN_FRONTEND=noninteractive apt-get install -y -qq ansible\r\n```","closed_by":{"login":"briancain","id":810277,"node_id":"MDQ6VXNlcjgxMDI3Nw==","avatar_url":"https://avatars.githubusercontent.com/u/810277?v=4","gravatar_id":"","url":"https://api.github.com/users/briancain","html_url":"https://github.com/briancain","followers_url":"https://api.github.com/users/briancain/followers","following_url":"https://api.github.com/users/briancain/following{/other_user}","gists_url":"https://api.github.com/users/briancain/gists{/gist_id}","starred_url":"https://api.github.com/users/briancain/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/briancain/subscriptions","organizations_url":"https://api.github.com/users/briancain/orgs","repos_url":"https://api.github.com/users/briancain/repos","events_url":"https://api.github.com/users/briancain/events{/privacy}","received_events_url":"https://api.github.com/users/briancain/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/hashicorp/vagrant/issues/10914/reactions","total_count":12,"+1":12,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/hashicorp/vagrant/issues/10914/timeline","performed_via_github_app":null,"state_reason":"completed"}