{"url":"https://api.github.com/repos/hashicorp/vagrant/issues/4104","repository_url":"https://api.github.com/repos/hashicorp/vagrant","labels_url":"https://api.github.com/repos/hashicorp/vagrant/issues/4104/labels{/name}","comments_url":"https://api.github.com/repos/hashicorp/vagrant/issues/4104/comments","events_url":"https://api.github.com/repos/hashicorp/vagrant/issues/4104/events","html_url":"https://github.com/hashicorp/vagrant/issues/4104","id":36536284,"node_id":"MDU6SXNzdWUzNjUzNjI4NA==","number":4104,"title":"Vagrant doesn't work on Fedora 20 with libvirt","user":{"login":"purpleidea","id":135091,"node_id":"MDQ6VXNlcjEzNTA5MQ==","avatar_url":"https://avatars.githubusercontent.com/u/135091?v=4","gravatar_id":"","url":"https://api.github.com/users/purpleidea","html_url":"https://github.com/purpleidea","followers_url":"https://api.github.com/users/purpleidea/followers","following_url":"https://api.github.com/users/purpleidea/following{/other_user}","gists_url":"https://api.github.com/users/purpleidea/gists{/gist_id}","starred_url":"https://api.github.com/users/purpleidea/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/purpleidea/subscriptions","organizations_url":"https://api.github.com/users/purpleidea/orgs","repos_url":"https://api.github.com/users/purpleidea/repos","events_url":"https://api.github.com/users/purpleidea/events{/privacy}","received_events_url":"https://api.github.com/users/purpleidea/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2014-06-26T00:58:46Z","updated_at":"2020-04-10T02:33:13Z","closed_at":"2014-08-06T00:17:00Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"After building a Fedora 20 base box, and testing it with vagrant-libvirt, I would see this error:\n\n<pre>\nThe following SSH command responded with a non-zero exit status.\nVagrant assumes that this means the command failed!\n\n/sbin/ifdown \n\nStdout from the command:\n\n\n\nStderr from the command:\n\nusage: ifdown <configuration>\n\n</pre>\n\n\nIt seemed weird that vagrant was getting the syntax wrong. Tracing this, got me:\n\n<pre>\n INFO interface: info: Configuring and enabling network interfaces...\n INFO interface: info: ==> annex1: Configuring and enabling network interfaces...\n INFO ssh: SSH is ready!\n INFO guest: Execute capability: configure_networks [#<Vagrant::Machine: annex1 (VagrantPlugins::ProviderLibvirt::Provider)>, [{:type=>:static, :ip=>\"192.168.143.3\", :netmask=>\"255.255.255.0\", :interface=>1}, {:type=>:static, :ip=>\"192.168.142.101\", :netmask=>\"255.255.255.0\", :interface=>2}]] (fedora)\n INFO ssh: SSH is ready!\n INFO guest: Execute capability: network_scripts_dir [#<Vagrant::Machine: annex1 (VagrantPlugins::ProviderLibvirt::Provider)>] (fedora)\n INFO ssh: Execute: /usr/sbin/biosdevname -d | grep Kernel | cut -f2 -d: | sed -e 's/ //;' (sudo=true)\n INFO ssh: Execute: touch /etc/sysconfig/network-scripts/ifcfg- (sudo=true)\n INFO ssh: Execute: sed -e '/^#VAGRANT-BEGIN/,/^#VAGRANT-END/ d' /etc/sysconfig/network-scripts/ifcfg- > /tmp/vagrant-ifcfg- (sudo=true)\n INFO ssh: Execute: cat /tmp/vagrant-ifcfg- > /etc/sysconfig/network-scripts/ifcfg- (sudo=true)\n INFO ssh: Execute: rm /tmp/vagrant-ifcfg- (sudo=true)\n INFO ssh: Execute: touch /etc/sysconfig/network-scripts/ifcfg- (sudo=true)\n INFO ssh: Execute: sed -e '/^#VAGRANT-BEGIN/,/^#VAGRANT-END/ d' /etc/sysconfig/network-scripts/ifcfg- > /tmp/vagrant-ifcfg- (sudo=true)\n INFO ssh: Execute: cat /tmp/vagrant-ifcfg- > /etc/sysconfig/network-scripts/ifcfg- (sudo=true)\n INFO ssh: Execute: rm /tmp/vagrant-ifcfg- (sudo=true)\n INFO ssh: Execute: cat /tmp/vagrant-network-entry_ >> /etc/sysconfig/network-scripts/ifcfg- (sudo=true)\n INFO ssh: Execute: /sbin/ifdown  (sudo=true)\n INFO retryable: Retryable exception raised: #<Vagrant::Errors::VagrantError: The following SSH command responded with a non-zero exit status.\nVagrant assumes that this means the command failed!\n\n/sbin/ifdown \n\nStdout from the command:\n\n\n\nStderr from the command:\n\nusage: ifdown <configuration>\n\n...\n</pre>\n\n\nWhich shows: ifcfg-\nwhich is missing something.\n\nI traced this down to the following command in the configure_networks.rb file:\n\n<pre>\nmachine.communicate.sudo(\"/usr/sbin/biosdevname -d | grep Kernel | cut -f2 -d: | sed -e 's/ //;'\") do |_, result|\n</pre>\n\n\nwhich if you run, you'll see that it doesn't work in a kvm powered virtual machine. Why? The man page of biosdevname has the answer:\n\n<pre>\nReturns 4 if running in a virtual machine.\n</pre>\n\n\nWhich means that this script is bogus when running in a real virtual machine that knows it is one.\n\nI haven't worked out how to patch this yet, since I'm not as familiar with the vagrant source, so if someone else could step up this would be appreciated. Of worthy mention: running CentOS 6.5 works fine. I think this is because there doesn't seem to be a specific capability with this bug in it, and whatever the default is, works great. If someone has more info on this, that would be great too. Workarounds are appreciated.\n\nCheers,\nJames\n","closed_by":{"login":"mitchellh","id":1299,"node_id":"MDQ6VXNlcjEyOTk=","avatar_url":"https://avatars.githubusercontent.com/u/1299?v=4","gravatar_id":"","url":"https://api.github.com/users/mitchellh","html_url":"https://github.com/mitchellh","followers_url":"https://api.github.com/users/mitchellh/followers","following_url":"https://api.github.com/users/mitchellh/following{/other_user}","gists_url":"https://api.github.com/users/mitchellh/gists{/gist_id}","starred_url":"https://api.github.com/users/mitchellh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mitchellh/subscriptions","organizations_url":"https://api.github.com/users/mitchellh/orgs","repos_url":"https://api.github.com/users/mitchellh/repos","events_url":"https://api.github.com/users/mitchellh/events{/privacy}","received_events_url":"https://api.github.com/users/mitchellh/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/hashicorp/vagrant/issues/4104/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/hashicorp/vagrant/issues/4104/timeline","performed_via_github_app":null,"state_reason":"completed"}