{"url":"https://api.github.com/repos/hashicorp/vagrant/issues/11396","repository_url":"https://api.github.com/repos/hashicorp/vagrant","labels_url":"https://api.github.com/repos/hashicorp/vagrant/issues/11396/labels{/name}","comments_url":"https://api.github.com/repos/hashicorp/vagrant/issues/11396/comments","events_url":"https://api.github.com/repos/hashicorp/vagrant/issues/11396/events","html_url":"https://github.com/hashicorp/vagrant/issues/11396","id":565364302,"node_id":"MDU6SXNzdWU1NjUzNjQzMDI=","number":11396,"title":"Systemd process not detected with hidepid enabled for /proc","user":{"login":"richard-scott","id":5149834,"node_id":"MDQ6VXNlcjUxNDk4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/5149834?v=4","gravatar_id":"","url":"https://api.github.com/users/richard-scott","html_url":"https://github.com/richard-scott","followers_url":"https://api.github.com/users/richard-scott/followers","following_url":"https://api.github.com/users/richard-scott/following{/other_user}","gists_url":"https://api.github.com/users/richard-scott/gists{/gist_id}","starred_url":"https://api.github.com/users/richard-scott/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/richard-scott/subscriptions","organizations_url":"https://api.github.com/users/richard-scott/orgs","repos_url":"https://api.github.com/users/richard-scott/repos","events_url":"https://api.github.com/users/richard-scott/events{/privacy}","received_events_url":"https://api.github.com/users/richard-scott/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":455273145,"node_id":"MDU6TGFiZWw0NTUyNzMxNDU=","url":"https://api.github.com/repos/hashicorp/vagrant/labels/guest/linux","name":"guest/linux","color":"5319e7","default":false,"description":null},{"id":867284247,"node_id":"MDU6TGFiZWw4NjcyODQyNDc=","url":"https://api.github.com/repos/hashicorp/vagrant/labels/task-small","name":"task-small","color":"d8dd3b","default":false,"description":""}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-02-14T14:35:04Z","updated_at":"2020-03-16T01:50:31Z","closed_at":"2020-02-14T17:11:02Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I use [debops.proc_hidepid](https://docs.debops.org/en/master/ansible/roles/proc_hidepid/index.html) on a [bento/debian](https://app.vagrantup.com/bento/boxes/debian-10.2) box and when I try and use systemd-networkd vagrant fails to detect the root owned systemd process. This is because the systemd process isn't owned by the vagrant user, and the hidepid mount option stops the vagrant user from seeing other users processes.\r\n\r\nIt looks to be due to this command not being performed by sudo.\r\n\r\nhttps://github.com/hashicorp/vagrant/blob/114775475c50e6f1025cbec5eef3ab1da328a372/lib/vagrant/util/guest_inspection.rb#L14-L16\r\n\r\nActually, I've just tested it two ways:\r\n\r\n1. Withouth using proc_hidepid, and it creates the 50-vagrant-eth1.network file.\r\n2. Also, by enabling proc_hidepid and editing the Host systems vagrant files, specifically:\r\n/opt/vagrant/embedded/gems/2.2.7/gems/vagrant-2.2.7/lib/vagrant/util/guest_inspection.rb\r\n\r\nand updating L15 to this:\r\n> comm.test(\"ps -o comm= 1 | grep systemd\", sudo: true)\r\n\r\nand it now works as expected.","closed_by":{"login":"jbonhag","id":6937257,"node_id":"MDQ6VXNlcjY5MzcyNTc=","avatar_url":"https://avatars.githubusercontent.com/u/6937257?v=4","gravatar_id":"","url":"https://api.github.com/users/jbonhag","html_url":"https://github.com/jbonhag","followers_url":"https://api.github.com/users/jbonhag/followers","following_url":"https://api.github.com/users/jbonhag/following{/other_user}","gists_url":"https://api.github.com/users/jbonhag/gists{/gist_id}","starred_url":"https://api.github.com/users/jbonhag/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbonhag/subscriptions","organizations_url":"https://api.github.com/users/jbonhag/orgs","repos_url":"https://api.github.com/users/jbonhag/repos","events_url":"https://api.github.com/users/jbonhag/events{/privacy}","received_events_url":"https://api.github.com/users/jbonhag/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/hashicorp/vagrant/issues/11396/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/hashicorp/vagrant/issues/11396/timeline","performed_via_github_app":null,"state_reason":"completed"}