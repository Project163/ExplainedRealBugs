{"url":"https://api.github.com/repos/hashicorp/vagrant/issues/8328","repository_url":"https://api.github.com/repos/hashicorp/vagrant","labels_url":"https://api.github.com/repos/hashicorp/vagrant/issues/8328/labels{/name}","comments_url":"https://api.github.com/repos/hashicorp/vagrant/issues/8328/comments","events_url":"https://api.github.com/repos/hashicorp/vagrant/issues/8328/events","html_url":"https://github.com/hashicorp/vagrant/issues/8328","id":211904221,"node_id":"MDU6SXNzdWUyMTE5MDQyMjE=","number":8328,"title":"Unable to set Salt pillar on Windows guest","user":{"login":"mtkennerly","id":4934192,"node_id":"MDQ6VXNlcjQ5MzQxOTI=","avatar_url":"https://avatars.githubusercontent.com/u/4934192?v=4","gravatar_id":"","url":"https://api.github.com/users/mtkennerly","html_url":"https://github.com/mtkennerly","followers_url":"https://api.github.com/users/mtkennerly/followers","following_url":"https://api.github.com/users/mtkennerly/following{/other_user}","gists_url":"https://api.github.com/users/mtkennerly/gists{/gist_id}","starred_url":"https://api.github.com/users/mtkennerly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mtkennerly/subscriptions","organizations_url":"https://api.github.com/users/mtkennerly/orgs","repos_url":"https://api.github.com/users/mtkennerly/repos","events_url":"https://api.github.com/users/mtkennerly/events{/privacy}","received_events_url":"https://api.github.com/users/mtkennerly/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":85736679,"node_id":"MDU6TGFiZWw4NTczNjY3OQ==","url":"https://api.github.com/repos/hashicorp/vagrant/labels/provisioner/salt","name":"provisioner/salt","color":"bfdadc","default":false,"description":null},{"id":283683436,"node_id":"MDU6TGFiZWwyODM2ODM0MzY=","url":"https://api.github.com/repos/hashicorp/vagrant/labels/has-pr","name":"has-pr","color":"fef2c0","default":false,"description":null}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/hashicorp/vagrant/milestones/37","html_url":"https://github.com/hashicorp/vagrant/milestone/37","labels_url":"https://api.github.com/repos/hashicorp/vagrant/milestones/37/labels","id":3646695,"node_id":"MDk6TWlsZXN0b25lMzY0NjY5NQ==","number":37,"title":"2.1.6","description":"","creator":{"login":"chrisroberts","id":266674,"node_id":"MDQ6VXNlcjI2NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/266674?v=4","gravatar_id":"","url":"https://api.github.com/users/chrisroberts","html_url":"https://github.com/chrisroberts","followers_url":"https://api.github.com/users/chrisroberts/followers","following_url":"https://api.github.com/users/chrisroberts/following{/other_user}","gists_url":"https://api.github.com/users/chrisroberts/gists{/gist_id}","starred_url":"https://api.github.com/users/chrisroberts/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chrisroberts/subscriptions","organizations_url":"https://api.github.com/users/chrisroberts/orgs","repos_url":"https://api.github.com/users/chrisroberts/repos","events_url":"https://api.github.com/users/chrisroberts/events{/privacy}","received_events_url":"https://api.github.com/users/chrisroberts/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":35,"state":"closed","created_at":"2018-09-11T22:50:40Z","updated_at":"2018-10-16T23:43:48Z","due_on":null,"closed_at":"2018-10-16T23:43:48Z"},"comments":1,"created_at":"2017-03-04T20:17:47Z","updated_at":"2020-03-29T02:27:09Z","closed_at":"2018-09-20T16:17:33Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Vagrant version\r\n1.9.2\r\n\r\n### Host operating system\r\nWindows 10\r\n\r\n### Guest operating system\r\nWindows Server 2012 R2\r\n\r\n### Vagrantfile\r\n```ruby\r\nVagrant.configure(\"2\") do |config|\r\n  config.vm.box = \"opentable/win-2012r2-standard-amd64-nocm\"\r\n  config.vm.synced_folder \"salt_srv/salt\", \"/srv/salt\"\r\n\r\n  config.vm.provider :virtualbox do |vb|\r\n    vb.gui = true\r\n  end\r\n\r\n  config.vm.provision :salt do |salt|\r\n    salt.masterless = true\r\n    salt.minion_config = \"salt_srv/minion\"\r\n    salt.run_highstate = true\r\n    salt.version = \"2016.3.5\"\r\n\r\n    salt.pillar({\r\n      :demo => \"it worked\"\r\n    })\r\n  end\r\nend\r\n```\r\n\r\n### Debug output\r\n[vagrant up --debug > vagrant.log 2>&1](https://gist.github.com/mtkennerly/d93254e620df20b4a381c3cf321c157e)\r\n\r\n### Expected behavior\r\nSalt should accept the pillar data and write it to <C:/demo.txt>.\r\n\r\n### Actual behavior\r\nVagrant displays this error from Salt:\r\n\r\n```\r\nC:\\salt\\salt-call.bat state.highstate --retcode-passthrough  --local --log-level=debug --no-color pillar='{\"demo\":\"it worked\"}'\r\n\r\n[...]\r\n\r\nPassed invalid arguments: Pillar data must be formatted as a dictionary, unless pillar_enc is specified..\r\n\r\nUsage:\r\nTraceback (most recent call last):\r\n  File \"C:\\salt\\bin\\lib\\site-packages\\salt\\cli\\caller.py\", line 197, in call\r\n    ret['return'] = func(*args, **kwargs)\r\n  File \"C:\\salt\\bin\\lib\\site-packages\\salt\\modules\\state.py\", line 693, in highstate\r\n    'Pillar data must be formatted as a dictionary, unless pillar_enc '\r\nSaltInvocationError: Pillar data must be formatted as a dictionary, unless pillar_enc is specified.\r\n```\r\n\r\nThe first line above shows how the command looks going into Salt, but not how it looks to Salt after receiving it. The issue has to do with how the Windows command line handles quotes:\r\n\r\n```\r\n>>> pillar='{\"X\":\"Y\"}'\r\npillar='{X:Y}'\r\n\r\n# Caret escapes it, but it still doesn't show up\r\n>>> pillar='{^\"X^\":^\"Y^\"}'\r\npillar='{X:Y}'\r\n\r\n# Triple quotes will escape and retain\r\n>>> pillar='{\"\"\"X\"\"\":\"\"\"Y\"\"\"}'\r\npillar='{\"X\":\"Y\"}'\r\n```\r\n\r\nEven with the triple option, though, single quotes aren't special like they are in Bash, so Vagrant is passing literal single quotes around the pillar dictionary, which Salt doesn't like. Salt can also accept inner single quotes, which works more easily for Windows:\r\n\r\n```\r\n>>> salt-call state.highstate pillar=\"{'demo': 'it worked'}\"\r\n```\r\n\r\n### Steps to reproduce\r\nCreate this directory structure:\r\n\r\n```\r\n- salt_srv:\r\n  - salt:\r\n    - top.sls\r\n    - demo.sls\r\n  - minion\r\n- Vagrantfile\r\n```\r\n\r\nContent of top.sls:\r\n```\r\nbase:\r\n  '*':\r\n    - demo\r\n```\r\n\r\nContent of demo.sls:\r\n```\r\n/demo.txt:\r\n  file.managed:\r\n    - contents: {{ pillar['demo'] }}\r\n```\r\n\r\nContent of minion:\r\n```\r\nfile_client: local\r\n\r\nfile_roots:\r\n  base:\r\n    - /srv/salt\r\n```\r\n\r\nThen run \"vagrant up\".\r\n\r\n### References\r\nN/A","closed_by":{"login":"briancain","id":810277,"node_id":"MDQ6VXNlcjgxMDI3Nw==","avatar_url":"https://avatars.githubusercontent.com/u/810277?v=4","gravatar_id":"","url":"https://api.github.com/users/briancain","html_url":"https://github.com/briancain","followers_url":"https://api.github.com/users/briancain/followers","following_url":"https://api.github.com/users/briancain/following{/other_user}","gists_url":"https://api.github.com/users/briancain/gists{/gist_id}","starred_url":"https://api.github.com/users/briancain/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/briancain/subscriptions","organizations_url":"https://api.github.com/users/briancain/orgs","repos_url":"https://api.github.com/users/briancain/repos","events_url":"https://api.github.com/users/briancain/events{/privacy}","received_events_url":"https://api.github.com/users/briancain/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/hashicorp/vagrant/issues/8328/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/hashicorp/vagrant/issues/8328/timeline","performed_via_github_app":null,"state_reason":"completed"}