{"url":"https://api.github.com/repos/hashicorp/vagrant/issues/10609","repository_url":"https://api.github.com/repos/hashicorp/vagrant","labels_url":"https://api.github.com/repos/hashicorp/vagrant/issues/10609/labels{/name}","comments_url":"https://api.github.com/repos/hashicorp/vagrant/issues/10609/comments","events_url":"https://api.github.com/repos/hashicorp/vagrant/issues/10609/events","html_url":"https://github.com/hashicorp/vagrant/issues/10609","id":401578116,"node_id":"MDU6SXNzdWU0MDE1NzgxMTY=","number":10609,"title":"NFS BSD automatic /etc/exports file incorrect","user":{"login":"jcrben","id":5614134,"node_id":"MDQ6VXNlcjU2MTQxMzQ=","avatar_url":"https://avatars.githubusercontent.com/u/5614134?v=4","gravatar_id":"","url":"https://api.github.com/users/jcrben","html_url":"https://github.com/jcrben","followers_url":"https://api.github.com/users/jcrben/followers","following_url":"https://api.github.com/users/jcrben/following{/other_user}","gists_url":"https://api.github.com/users/jcrben/gists{/gist_id}","starred_url":"https://api.github.com/users/jcrben/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jcrben/subscriptions","organizations_url":"https://api.github.com/users/jcrben/orgs","repos_url":"https://api.github.com/users/jcrben/repos","events_url":"https://api.github.com/users/jcrben/events{/privacy}","received_events_url":"https://api.github.com/users/jcrben/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":25816,"node_id":"MDU6TGFiZWwyNTgxNg==","url":"https://api.github.com/repos/hashicorp/vagrant/labels/bug","name":"bug","color":"e11d21","default":true,"description":null},{"id":218284866,"node_id":"MDU6TGFiZWwyMTgyODQ4NjY=","url":"https://api.github.com/repos/hashicorp/vagrant/labels/synced-folders/nfs","name":"synced-folders/nfs","color":"fef2c0","default":false,"description":null},{"id":218286803,"node_id":"MDU6TGFiZWwyMTgyODY4MDM=","url":"https://api.github.com/repos/hashicorp/vagrant/labels/host/bsd","name":"host/bsd","color":"d4c5f9","default":false,"description":null},{"id":867284247,"node_id":"MDU6TGFiZWw4NjcyODQyNDc=","url":"https://api.github.com/repos/hashicorp/vagrant/labels/task-small","name":"task-small","color":"d8dd3b","default":false,"description":""}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/hashicorp/vagrant/milestones/43","html_url":"https://github.com/hashicorp/vagrant/milestone/43","labels_url":"https://api.github.com/repos/hashicorp/vagrant/milestones/43/labels","id":4093855,"node_id":"MDk6TWlsZXN0b25lNDA5Mzg1NQ==","number":43,"title":"2.2.5","description":"","creator":{"login":"chrisroberts","id":266674,"node_id":"MDQ6VXNlcjI2NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/266674?v=4","gravatar_id":"","url":"https://api.github.com/users/chrisroberts","html_url":"https://github.com/chrisroberts","followers_url":"https://api.github.com/users/chrisroberts/followers","following_url":"https://api.github.com/users/chrisroberts/following{/other_user}","gists_url":"https://api.github.com/users/chrisroberts/gists{/gist_id}","starred_url":"https://api.github.com/users/chrisroberts/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chrisroberts/subscriptions","organizations_url":"https://api.github.com/users/chrisroberts/orgs","repos_url":"https://api.github.com/users/chrisroberts/repos","events_url":"https://api.github.com/users/chrisroberts/events{/privacy}","received_events_url":"https://api.github.com/users/chrisroberts/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":31,"state":"closed","created_at":"2019-02-27T18:22:57Z","updated_at":"2019-12-01T10:29:03Z","due_on":null,"closed_at":"2019-07-10T21:53:34Z"},"comments":2,"created_at":"2019-01-22T02:53:23Z","updated_at":"2020-01-28T02:37:22Z","closed_at":"2019-06-17T15:21:36Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I've been having trouble with NFS permissions errors so I tested NFS exports with a Linux laptop that I've got and noticed that the Vagrant entry wasn't properly evaluating `maproot` there either. \r\n\r\nCareful reading of the manpage https://www.freebsd.org/cgi/man.cgi?query=exports revealed that the options need to be before the host.\r\n\r\nNote that there's another bug - the options are not completely overriden: the docs https://www.vagrantup.com/docs/synced-folders/nfs.html say:\r\n> tweak the arguments specified in the /etc/exports ... bsd__nfs_options keys. Note that these options completely override the default arguments that are added by Vagrant automatically...\r\n\r\nThe automatic one below doesn't do that - also, I realize that my leading dashes are my user error.\r\n\r\nIt's important that these options be entirely replaced because `maproot` and `mapall` are mutually exclusive.\r\n\r\n### Vagrant version\r\n`Vagrant 2.2.3`\r\n\r\n### Host operating system\r\nmacOS High Sierra 10.13.6\r\n\r\n### Guest operating system\r\n`config.vm.box = \"hashicorp/precise32\"` - i.e., Ubuntu 14.04\r\n\r\n### Vagrantfile\r\n```ruby\r\nVAGRANTFILE_API_VERSION = \"2\"\r\n\r\nVagrant.configure(VAGRANTFILE_API_VERSION) do |config|\r\n  # All Vagrant configuration is done here. The most common configuration\r\n  # options are documented and commented below. For a complete reference,\r\n  # please see the online documentation at vagrantup.com.\r\n\r\n  # Every Vagrant virtual environment requires a box to build off of.\r\n  config.vm.box = \"hashicorp/precise32\"\r\n  config.vm.define \"some-name\"\r\n\r\n  # Disable automatic box update checking. If you disable this, then\r\n  # boxes will only be checked for updates when the user runs\r\n  # `vagrant box outdated`. This is not recommended.\r\n  config.vm.box_check_update = false\r\n\r\n  for i in 8000..8009\r\n    config.vm.network \"forwarded_port\", guest: i, host: i\r\n  end\r\n\r\n  config.vm.network \"private_network\", ip: \"192.168.57.10\"\r\n\r\n  # If true, then any SSH connections made will enable agent forwarding.\r\n  # Default value: false\r\n  config.ssh.forward_agent = true\r\n  config.ssh.forward_x11 = true\r\n\r\n  config.vm.synced_folder \"./\", \"/var/www/twweb\", type: \"nfs\", bsd__nfs_options: [\"-maproot=0:0\"]\r\n    # nfs_export: false\r\n    # mount_options: ['rw', 'vers=3', 'tcp', 'fsc', 'actimeo=2'],\r\n\r\n  config.vm.provider \"virtualbox\" do |vb|\r\n    vb.customize [\r\n      \"modifyvm\", :id,\r\n      \"--memory\", \"1024\",\r\n      \"--cpus\", \"1\"\r\n    ]\r\n  end\r\n\r\nconfig.vm.provision \"shell\", path: \"scripts/vagrant/init_environment_minimal.sh\"\r\n```\r\n\r\nFull version is probably at https://github.com/jcrben/inthe.am/tree/nfs-experimentation\r\n\r\n### Debug output\r\nN/A\r\n\r\n### Expected behavior\r\nThe `/etc/exports` should abide by the rules for the file on BSD https://www.freebsd.org/cgi/man.cgi?query=exports&sektion=5&manpath=freebsd-release-ports:\r\n`The secondcomponent of a line specifies how the file system is to be exported to the host set. The option flags ... third component of a line specifies the host set to which the line  applies.` Proper entry would look something like this:\r\n`\"/Users/bencreasy/code/open-source/taskwarrior-group/inthe.am\" -maproot=root 192.168.57.10`\r\n\r\n\r\n### Actual behavior\r\nMeanwhile, the automatically added `/etc/exports` looks like this:\r\n\r\n```\r\n# VAGRANT-BEGIN: 503 7db477f2-fac6-45b7-b605-c178588f9db7\r\n\"/Users/bencreasy/code/open-source/taskwarrior-group/inthe.am\" 192.168.57.10 --maproot=0:0 --mapall=1000:1000 -mapall=503:20\r\n# VAGRANT-END: 503 7db477f2-fac6-45b7-b605-c178588f9db7\r\n```\r\n\r\n### Steps to reproduce\r\n1. `vagrant up` with above Vagrantfile\r\n2. `mount`, notice the nfs share - I don't think it is supposed to show options like maproot, however\r\n3. `sudo -i` to become root, `chown root:root` and see `Permission denied` errors.\r\n4. Bring it up again with the proper configuration, and try again. No errors.\r\n\r\n### Manual setup tips\r\nTutorials which helped in testing via manual setup include https://www.ev3dev.org/docs/tutorials/setting-up-an-nfs-file-share/ and https://www.tecmint.com/how-to-setup-nfs-server-in-linux/ for mounting the share on my linux box - also used `nfs-ls -D nfs://<ip>`, `sudo nfsd restart` on mac, etc).","closed_by":{"login":"briancain","id":810277,"node_id":"MDQ6VXNlcjgxMDI3Nw==","avatar_url":"https://avatars.githubusercontent.com/u/810277?v=4","gravatar_id":"","url":"https://api.github.com/users/briancain","html_url":"https://github.com/briancain","followers_url":"https://api.github.com/users/briancain/followers","following_url":"https://api.github.com/users/briancain/following{/other_user}","gists_url":"https://api.github.com/users/briancain/gists{/gist_id}","starred_url":"https://api.github.com/users/briancain/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/briancain/subscriptions","organizations_url":"https://api.github.com/users/briancain/orgs","repos_url":"https://api.github.com/users/briancain/repos","events_url":"https://api.github.com/users/briancain/events{/privacy}","received_events_url":"https://api.github.com/users/briancain/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/hashicorp/vagrant/issues/10609/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/hashicorp/vagrant/issues/10609/timeline","performed_via_github_app":null,"state_reason":"completed"}