{"url":"https://api.github.com/repos/hashicorp/vagrant/issues/8862","repository_url":"https://api.github.com/repos/hashicorp/vagrant","labels_url":"https://api.github.com/repos/hashicorp/vagrant/issues/8862/labels{/name}","comments_url":"https://api.github.com/repos/hashicorp/vagrant/issues/8862/comments","events_url":"https://api.github.com/repos/hashicorp/vagrant/issues/8862/events","html_url":"https://github.com/hashicorp/vagrant/issues/8862","id":248776673,"node_id":"MDU6SXNzdWUyNDg3NzY2NzM=","number":8862,"title":"Hyper-V Provider Fails when PowerCLI is Installed","user":{"login":"michaeltlombardi","id":14190564,"node_id":"MDQ6VXNlcjE0MTkwNTY0","avatar_url":"https://avatars.githubusercontent.com/u/14190564?v=4","gravatar_id":"","url":"https://api.github.com/users/michaeltlombardi","html_url":"https://github.com/michaeltlombardi","followers_url":"https://api.github.com/users/michaeltlombardi/followers","following_url":"https://api.github.com/users/michaeltlombardi/following{/other_user}","gists_url":"https://api.github.com/users/michaeltlombardi/gists{/gist_id}","starred_url":"https://api.github.com/users/michaeltlombardi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/michaeltlombardi/subscriptions","organizations_url":"https://api.github.com/users/michaeltlombardi/orgs","repos_url":"https://api.github.com/users/michaeltlombardi/repos","events_url":"https://api.github.com/users/michaeltlombardi/events{/privacy}","received_events_url":"https://api.github.com/users/michaeltlombardi/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":140639873,"node_id":"MDU6TGFiZWwxNDA2Mzk4NzM=","url":"https://api.github.com/repos/hashicorp/vagrant/labels/provider/hyperv","name":"provider/hyperv","color":"bfe5bf","default":false,"description":null}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2017-08-08T16:40:53Z","updated_at":"2020-03-31T02:04:42Z","closed_at":"2018-01-04T18:27:10Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Vagrant version\r\n`1.9.7`\r\n\r\n### Host operating system\r\nWindows `10.0.14393`\r\n\r\n### Guest operating system\r\nCentOS 7\r\n\r\n### Vagrantfile\r\n```ruby\r\n# -*- mode: ruby -*-\r\n# vi: set ft=ruby :\r\n\r\nVagrant.configure(\"2\") do |config|\r\n  config.vm.box = \"centos/7\"\r\n  config.vm.provider \"hyperv\"\r\n  config.vm.network \"public_network\", bridge: \"Guest\"\r\n  config.vm.synced_folder \".\", \"/vagrant\", disabled: true\r\n  config.vm.provider \"hyperv\" do |h|\r\n    h.enable_virtualization_extensions = true\r\n    h.differencing_disk = true\r\n  end\r\nend\r\n```\r\n\r\n### Debug output\r\nThe full [debug output can be found in this gist](https://gist.github.com/michaeltlombardi/439dea9a254093799b811ea60658818c), but the relevant part is below:\r\n\r\n```\r\nDEBUG subprocess: stderr: Get-VM : 8/8/2017 11:28:54 AM\tGet-VM\t\tYou are not currently connected to any servers. Please connect first using a \r\nConnect cmdlet.\t\r\nAt C:\\HashiCorp\\Vagrant\\embedded\\gems\\gems\\vagrant-1.9.7\\plugins\\providers\\hyperv\\scripts\\import_vm_xml.ps1:40 char:5\r\n+     Get-VM | ForEach-Object -Process {\r\n+     ~~~~~~\r\n    + CategoryInfo          : ResourceUnavailable: (:) [Get-VM], ViServerConnectionException\r\n    + FullyQualifiedErrorId : Core_BaseCmdlet_NotConnectedError,VMware.VimAutomation.ViCore.Cmdlets.Commands.GetVM\r\n```\r\n\r\nNotice in this case that the cmdlet that failed is a VMware cmdlet, not from the Hyper-V module.\r\n\r\n### Expected behavior\r\nThe VM should have launched as expected.\r\n\r\n### Actual behavior\r\nA failure occurred because the command `Get-VM` is ambiguous when both the PowerCLI and Hyper-V modules are available on a system.\r\n\r\n### Steps to reproduce\r\n1. Ensure Hyper-V is installed\r\n2. Install the PowerCLI module (`Install-Module PowerCLI`)\r\n3. Launch a vagrant box using the Hyper-V provider.\r\n\r\n### Possible Fix\r\nFully qualify the Hyper-V commands in the script files to disambiguate the calls. I can submit a PR for this. for example instead of:\r\n\r\n```powershell\r\nGet-VM | ForEach-Object -Process {\r\n    ...\r\n}\r\n```\r\n\r\nWe would include the Module name prior to the the function or cmdlet call:\r\n\r\n```powershell\r\nHyper-V\\Get-VM | ForEach-Object -Process {\r\n    ...\r\n}\r\n```","closed_by":{"login":"briancain","id":810277,"node_id":"MDQ6VXNlcjgxMDI3Nw==","avatar_url":"https://avatars.githubusercontent.com/u/810277?v=4","gravatar_id":"","url":"https://api.github.com/users/briancain","html_url":"https://github.com/briancain","followers_url":"https://api.github.com/users/briancain/followers","following_url":"https://api.github.com/users/briancain/following{/other_user}","gists_url":"https://api.github.com/users/briancain/gists{/gist_id}","starred_url":"https://api.github.com/users/briancain/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/briancain/subscriptions","organizations_url":"https://api.github.com/users/briancain/orgs","repos_url":"https://api.github.com/users/briancain/repos","events_url":"https://api.github.com/users/briancain/events{/privacy}","received_events_url":"https://api.github.com/users/briancain/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/hashicorp/vagrant/issues/8862/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/hashicorp/vagrant/issues/8862/timeline","performed_via_github_app":null,"state_reason":"completed"}