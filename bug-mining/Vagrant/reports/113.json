{"url":"https://api.github.com/repos/hashicorp/vagrant/issues/9679","repository_url":"https://api.github.com/repos/hashicorp/vagrant","labels_url":"https://api.github.com/repos/hashicorp/vagrant/issues/9679/labels{/name}","comments_url":"https://api.github.com/repos/hashicorp/vagrant/issues/9679/comments","events_url":"https://api.github.com/repos/hashicorp/vagrant/issues/9679/events","html_url":"https://github.com/hashicorp/vagrant/issues/9679","id":313280876,"node_id":"MDU6SXNzdWUzMTMyODA4NzY=","number":9679,"title":"Hyper-V switch selection does not work with non ascii names.","user":{"login":"kmpm","id":96618,"node_id":"MDQ6VXNlcjk2NjE4","avatar_url":"https://avatars.githubusercontent.com/u/96618?v=4","gravatar_id":"","url":"https://api.github.com/users/kmpm","html_url":"https://github.com/kmpm","followers_url":"https://api.github.com/users/kmpm/followers","following_url":"https://api.github.com/users/kmpm/following{/other_user}","gists_url":"https://api.github.com/users/kmpm/gists{/gist_id}","starred_url":"https://api.github.com/users/kmpm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kmpm/subscriptions","organizations_url":"https://api.github.com/users/kmpm/orgs","repos_url":"https://api.github.com/users/kmpm/repos","events_url":"https://api.github.com/users/kmpm/events{/privacy}","received_events_url":"https://api.github.com/users/kmpm/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":140639873,"node_id":"MDU6TGFiZWwxNDA2Mzk4NzM=","url":"https://api.github.com/repos/hashicorp/vagrant/labels/provider/hyperv","name":"provider/hyperv","color":"bfe5bf","default":false,"description":null},{"id":218286867,"node_id":"MDU6TGFiZWwyMTgyODY4Njc=","url":"https://api.github.com/repos/hashicorp/vagrant/labels/host/windows","name":"host/windows","color":"d4c5f9","default":false,"description":null},{"id":545815065,"node_id":"MDU6TGFiZWw1NDU4MTUwNjU=","url":"https://api.github.com/repos/hashicorp/vagrant/labels/encoding","name":"encoding","color":"fbca04","default":false,"description":null},{"id":867284764,"node_id":"MDU6TGFiZWw4NjcyODQ3NjQ=","url":"https://api.github.com/repos/hashicorp/vagrant/labels/task-medium","name":"task-medium","color":"f7c709","default":false,"description":""}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2018-04-11T11:20:28Z","updated_at":"2020-03-30T02:06:11Z","closed_at":"2018-05-02T14:47:32Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"\r\n### Vagrant version\r\n```powershell\r\n> vagrant -v\r\nVagrant 2.0.2\r\n```\r\n\r\n\r\n### Host operating system\r\nWindows 10 Pro, Version 1709, Swedish UI, Locale and Input\r\n\r\n### Guest operating system\r\nThis fails before getting this far but I was trying with Windows Server 2016 Standard\r\n\r\n### Vagrantfile\r\n```ruby\r\n# -*- mode: ruby -*-\r\n# vi: set ft=ruby :\r\nVagrant.configure(2) do |config|\r\n  config.vm.define \"dev01\"\r\n  config.vm.box = \"windows_2016\"\r\n  config.vm.hostname = \"mu01-dev01\"\r\n  config.vm.communicator = \"winrm\"\r\n  config.vm.guest = :windows\r\n  config.winrm.username = \"vagrant\"\r\n  config.winrm.password = \"vagrant\"\r\n  config.vm.network \"forwarded_port\", guest: 3389, host: 13389, auto_correct: true\r\n  config.vm.network \"forwarded_port\", guest: 5985, host: 15985, id: \"winrm\", auto_correct:true\r\n  #config.vm.network \"private_network\", ip: \"192.168.56.60\"\r\n  \r\n  config.vm.provider 'parallels' do |prl|\r\n    prl.linked_clone = true\r\n  end\r\n  \r\n  config.vm.provider \"virtualbox\" do |v|\r\n    v.linked_clone = true\r\n    v.memory = 4096\r\n    v.cpus = 4\r\n    v.gui = false\r\n  end\r\nend\r\n```\r\n### Debug output\r\nhttps://gist.github.com/kmpm/d5a44847741180f96615da3fc0057264\r\n\r\n### Expected behavior\r\nThe chosen switch called \"Standardväxel\" should have been used.\r\n\r\n### Actual behavior\r\nIt tries to use the right name but with wrong encoding and hyper-v does not accept that.\r\n```\r\nHyper-V\\Connect-VMNetworkAdapter : Hyper-V was unable to find a virtual switch with name \"StandardvÃ¤xel\".\r\nAt C:\\HashiCorp\\Vagrant\\embedded\\gems\\gems\\vagrant-2.0.2\\plugins\\providers\\hyperv\\scripts\\import_vm_vmcx.ps1:96 char:1\r\n+ Hyper-V\\Connect-VMNetworkAdapter -VMNetworkAdapter $vmNetworkAdapter  ...\r\n+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n    + CategoryInfo          : InvalidArgument: (:) [Connect-VMNetworkAdapter], VirtualizationException\r\n    + FullyQualifiedErrorId : InvalidParameter,Microsoft.HyperV.PowerShell.Commands.ConnectVMNetworkAdapter\r\n```\r\n\r\n### Steps to reproduce\r\n1. Use a host installed with Hyper-V and Swedish as language (or my guess any language that creates a default switch\r\n  with non US-ASCII characters in name).\r\n2. Open a command prompt and run `vagrant up`\r\n3. When asked about virtual switch to use, select \"Standardväxel\"\r\n\r\n### Notes\r\nWhen running vagrant in debug mode it prompts the switch as `StandardvÃ¤xel` (see linked log at about line 914) but running without debug shows the correct name `Standardväxel` but seems to use the other internally.\r\nI can not change name on this switch since it is the default switch always created in newer hyper-v installations on Windows 10. On an English machine it's called \"Default Switch\". See https://blogs.technet.microsoft.com/virtualization/2017/11/13/whats-new-in-hyper-v-for-windows-10-fall-creators-update/\r\n\r\nIn packer I can configure the switch to use with the `switch_name` argument and enter the string as \"Standardväxel\" but I can't find such a workaround in vagrant.\r\n\r\n\r\n\r\n## normal output\r\n```powershell\r\nPS> vagrant up --provider hyperv\r\nBringing machine 'dev01' up with 'hyperv' provider...\r\n==> dev01: Verifying Hyper-V is enabled...\r\n==> dev01: Importing a Hyper-V instance\r\n    dev01: Please choose a switch to attach to your Hyper-V instance.\r\n    dev01: If none of these are appropriate, please open the Hyper-V manager\r\n    dev01: to create a new virtual switch.\r\n    dev01:\r\n    dev01: 1) LAN\r\n    dev01: 2) Standardväxel\r\n    dev01:\r\n    dev01: What switch would you like to use? 2\r\n    dev01: Cloning virtual hard drive...\r\n    dev01: Creating and registering the VM...\r\nAn error occurred while executing a PowerShell script. This error\r\nis shown below. Please read the error message and see if this is\r\na configuration error with your system. If it is not, then please\r\nreport a bug.\r\n\r\nScript: import_vm_vmcx.ps1\r\nError:\r\n\r\nHyper-V\\Connect-VMNetworkAdapter : Hyper-V was unable to find a virtual switch with name \"StandardvÃ¤xel\".\r\nAt C:\\HashiCorp\\Vagrant\\embedded\\gems\\gems\\vagrant-2.0.2\\plugins\\providers\\hyperv\\scripts\\import_vm_vmcx.ps1:96 char:1\r\n+ Hyper-V\\Connect-VMNetworkAdapter -VMNetworkAdapter $vmNetworkAdapter  ...\r\n+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n    + CategoryInfo          : InvalidArgument: (:) [Connect-VMNetworkAdapter], VirtualizationException\r\n    + FullyQualifiedErrorId : InvalidParameter,Microsoft.HyperV.PowerShell.Commands.ConnectVMNetworkAdapter\r\n```","closed_by":{"login":"chrisroberts","id":266674,"node_id":"MDQ6VXNlcjI2NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/266674?v=4","gravatar_id":"","url":"https://api.github.com/users/chrisroberts","html_url":"https://github.com/chrisroberts","followers_url":"https://api.github.com/users/chrisroberts/followers","following_url":"https://api.github.com/users/chrisroberts/following{/other_user}","gists_url":"https://api.github.com/users/chrisroberts/gists{/gist_id}","starred_url":"https://api.github.com/users/chrisroberts/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chrisroberts/subscriptions","organizations_url":"https://api.github.com/users/chrisroberts/orgs","repos_url":"https://api.github.com/users/chrisroberts/repos","events_url":"https://api.github.com/users/chrisroberts/events{/privacy}","received_events_url":"https://api.github.com/users/chrisroberts/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/hashicorp/vagrant/issues/9679/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/hashicorp/vagrant/issues/9679/timeline","performed_via_github_app":null,"state_reason":"completed"}