{"url":"https://api.github.com/repos/hashicorp/vagrant/issues/9546","repository_url":"https://api.github.com/repos/hashicorp/vagrant","labels_url":"https://api.github.com/repos/hashicorp/vagrant/issues/9546/labels{/name}","comments_url":"https://api.github.com/repos/hashicorp/vagrant/issues/9546/comments","events_url":"https://api.github.com/repos/hashicorp/vagrant/issues/9546/events","html_url":"https://github.com/hashicorp/vagrant/issues/9546","id":303647381,"node_id":"MDU6SXNzdWUzMDM2NDczODE=","number":9546,"title":"Private network IP assigned to wrong interface on vagrant reload","user":{"login":"jamiejackson","id":479475,"node_id":"MDQ6VXNlcjQ3OTQ3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/479475?v=4","gravatar_id":"","url":"https://api.github.com/users/jamiejackson","html_url":"https://github.com/jamiejackson","followers_url":"https://api.github.com/users/jamiejackson/followers","following_url":"https://api.github.com/users/jamiejackson/following{/other_user}","gists_url":"https://api.github.com/users/jamiejackson/gists{/gist_id}","starred_url":"https://api.github.com/users/jamiejackson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamiejackson/subscriptions","organizations_url":"https://api.github.com/users/jamiejackson/orgs","repos_url":"https://api.github.com/users/jamiejackson/repos","events_url":"https://api.github.com/users/jamiejackson/events{/privacy}","received_events_url":"https://api.github.com/users/jamiejackson/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":54083443,"node_id":"MDU6TGFiZWw1NDA4MzQ0Mw==","url":"https://api.github.com/repos/hashicorp/vagrant/labels/waiting-reply","name":"waiting-reply","color":"5319e7","default":false,"description":null},{"id":425128607,"node_id":"MDU6TGFiZWw0MjUxMjg2MDc=","url":"https://api.github.com/repos/hashicorp/vagrant/labels/networking","name":"networking","color":"0e8a16","default":false,"description":null},{"id":443900816,"node_id":"MDU6TGFiZWw0NDM5MDA4MTY=","url":"https://api.github.com/repos/hashicorp/vagrant/labels/needs-repro","name":"needs-repro","color":"fef2c0","default":false,"description":null},{"id":867284764,"node_id":"MDU6TGFiZWw4NjcyODQ3NjQ=","url":"https://api.github.com/repos/hashicorp/vagrant/labels/task-medium","name":"task-medium","color":"f7c709","default":false,"description":""}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":15,"created_at":"2018-03-08T21:58:27Z","updated_at":"2020-03-28T02:06:22Z","closed_at":"2018-12-20T22:00:35Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"# Short story\r\n\r\n* vagrant up: everything looks good, private network ip assigned to eth1, as expected\r\n* vagrant reload: can still reach the guest by private ip (everything still _behaves_ normally), but the nic configs show that eth0 also has the ip that eth1 has\r\n* vagrant reload 2: eth0 still has the ip that eth1 is supposed to have, but the private interface (eth1) is down, so the private network is non-functional\r\n\r\n# Info\r\n\r\n* I don't know if this is relevant, but I'm using the docker provisioner (not the provider) and the stack has multiple overlay networks defined.\r\n* Vagrant 2.0.2\r\n* VirtualBox 5.2.8\r\n* Guest Box: `ubuntu/trusty64 (virtualbox, 20180222.1.1)` with updated guest extensions\r\n* Host: Mac 10.12.6\r\n* Vagrantfile private network definition: `config.vm.network \"private_network\", ip: 192.168.56.10`\r\n\r\n# Other info\r\n\r\n* My team cannot reproduce this problem in Windows 10\r\n\r\n# Repeatable experiment\r\n\r\n## initial vagrant up\r\n\r\nsite up. nics look as expected, and so does `/etc/network/interfaces`\r\n\r\n```\r\n$ vagrant ssh -- ip a\r\n\r\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\r\n    link/ether 08:00:27:d1:30:c3 brd ff:ff:ff:ff:ff:ff\r\n    inet 10.0.2.15/24 brd 10.0.2.255 scope global eth0\r\n       valid_lft forever preferred_lft forever\r\n    inet6 fe80::a00:27ff:fed1:30c3/64 scope link\r\n       valid_lft forever preferred_lft forever\r\n3: eth1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\r\n    link/ether 08:00:27:82:2b:6b brd ff:ff:ff:ff:ff:ff\r\n    inet 192.168.56.10/24 brd 192.168.56.255 scope global eth1\r\n       valid_lft forever preferred_lft forever\r\n    inet6 fe80::a00:27ff:fe82:2b6b/64 scope link\r\n       valid_lft forever preferred_lft forever\r\n```\r\n\r\n```\r\n$ vagrant ssh -- cat /etc/network/interfaces\r\n\r\n...\r\n#VAGRANT-BEGIN\r\n# The contents below are automatically generated by Vagrant. Do not modify.\r\nauto eth1\r\niface eth1 inet static\r\n      address 192.168.56.10\r\n      netmask 255.255.255.0\r\n#VAGRANT-END\r\n```\r\n\r\n## vagrant reload\r\n\r\nsite up. nics don't look as expected (now eth0 has the ip, too), and `/etc/network/interfaces` has the wrong nic specified.\r\n\r\n```\r\n$ vagrant ssh -- ip a\r\n\r\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\r\n    link/ether 08:00:27:d1:30:c3 brd ff:ff:ff:ff:ff:ff\r\n    inet 10.0.2.15/24 brd 10.0.2.255 scope global eth0\r\n       valid_lft forever preferred_lft forever\r\n    inet 192.168.56.10/24 brd 192.168.56.255 scope global eth0\r\n       valid_lft forever preferred_lft forever\r\n    inet6 fe80::a00:27ff:fed1:30c3/64 scope link\r\n       valid_lft forever preferred_lft forever\r\n3: eth1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\r\n    link/ether 08:00:27:82:2b:6b brd ff:ff:ff:ff:ff:ff\r\n    inet 192.168.56.10/24 brd 192.168.56.255 scope global eth1\r\n       valid_lft forever preferred_lft forever\r\n    inet6 fe80::a00:27ff:fe82:2b6b/64 scope link\r\n       valid_lft forever preferred_lft forever\r\n```\r\n\r\n```\r\n#VAGRANT-BEGIN\r\n# The contents below are automatically generated by Vagrant. Do not modify.\r\nauto eth0\r\niface eth0 inet static\r\n      address 192.168.56.10\r\n      netmask 255.255.255.0\r\n#VAGRANT-END\r\n```\r\n\r\n## vagrant reload 2\r\n\r\nsite unavailable; pings fail. `/etc/network/interfaces` looks right, but eth0 still has the ip and the nic is now completely disabled in vbox (shows as disabled in vbox gui)\r\n\r\n```\r\n$ vagrant ssh -- ip a\r\n\r\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default\r\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\r\n    inet 127.0.0.1/8 scope host lo\r\n       valid_lft forever preferred_lft forever\r\n    inet6 ::1/128 scope host\r\n       valid_lft forever preferred_lft forever\r\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\r\n    link/ether 08:00:27:d1:30:c3 brd ff:ff:ff:ff:ff:ff\r\n    inet 10.0.2.15/24 brd 10.0.2.255 scope global eth0\r\n       valid_lft forever preferred_lft forever\r\n    inet 192.168.56.10/24 brd 192.168.56.255 scope global eth0\r\n       valid_lft forever preferred_lft forever\r\n    inet6 fe80::a00:27ff:fed1:30c3/64 scope link\r\n       valid_lft forever preferred_lft forever\r\n3: eth1: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN group default qlen 1000\r\n    link/ether 08:00:27:82:2b:6b brd ff:ff:ff:ff:ff:ff\r\n```\r\n\r\n```\r\n$ vagrant ssh -- cat /etc/network/interfaces\r\n\r\n#VAGRANT-BEGIN\r\n# The contents below are automatically generated by Vagrant. Do not modify.\r\nauto eth0\r\niface eth0 inet static\r\n      address 192.168.56.10\r\n      netmask 255.255.255.0\r\n#VAGRANT-END\r\n```\r\n\r\n## vagrant reload 3\r\n\r\ncan't ping guest\r\n\r\n```\r\n$ vagrant ssh -- ip a\r\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default\r\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\r\n    inet 127.0.0.1/8 scope host lo\r\n       valid_lft forever preferred_lft forever\r\n    inet6 ::1/128 scope host\r\n       valid_lft forever preferred_lft forever\r\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\r\n    link/ether 08:00:27:d1:30:c3 brd ff:ff:ff:ff:ff:ff\r\n    inet 10.0.2.15/24 brd 10.0.2.255 scope global eth0\r\n       valid_lft forever preferred_lft forever\r\n    inet 192.168.56.10/24 brd 192.168.56.255 scope global eth0\r\n       valid_lft forever preferred_lft forever\r\n    inet6 fe80::a00:27ff:fed1:30c3/64 scope link\r\n       valid_lft forever preferred_lft forever\r\n3: eth1: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN group default qlen 1000\r\n    link/ether 08:00:27:82:2b:6b brd ff:ff:ff:ff:ff:ff\r\n```\r\n\r\n```\r\n$ vagrant ssh -- cat /etc/network/interfaces\r\n\r\n...\r\n#VAGRANT-BEGIN\r\n# The contents below are automatically generated by Vagrant. Do not modify.\r\nauto eth0\r\niface eth0 inet static\r\n      address 192.168.56.10\r\n      netmask 255.255.255.0\r\n#VAGRANT-END\r\n```\r\n\r\n","closed_by":{"login":"chrisroberts","id":266674,"node_id":"MDQ6VXNlcjI2NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/266674?v=4","gravatar_id":"","url":"https://api.github.com/users/chrisroberts","html_url":"https://github.com/chrisroberts","followers_url":"https://api.github.com/users/chrisroberts/followers","following_url":"https://api.github.com/users/chrisroberts/following{/other_user}","gists_url":"https://api.github.com/users/chrisroberts/gists{/gist_id}","starred_url":"https://api.github.com/users/chrisroberts/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chrisroberts/subscriptions","organizations_url":"https://api.github.com/users/chrisroberts/orgs","repos_url":"https://api.github.com/users/chrisroberts/repos","events_url":"https://api.github.com/users/chrisroberts/events{/privacy}","received_events_url":"https://api.github.com/users/chrisroberts/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/hashicorp/vagrant/issues/9546/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/hashicorp/vagrant/issues/9546/timeline","performed_via_github_app":null,"state_reason":"completed"}