{"url":"https://api.github.com/repos/hashicorp/vagrant/issues/10798","repository_url":"https://api.github.com/repos/hashicorp/vagrant","labels_url":"https://api.github.com/repos/hashicorp/vagrant/issues/10798/labels{/name}","comments_url":"https://api.github.com/repos/hashicorp/vagrant/issues/10798/comments","events_url":"https://api.github.com/repos/hashicorp/vagrant/issues/10798/events","html_url":"https://github.com/hashicorp/vagrant/issues/10798","id":434222698,"node_id":"MDU6SXNzdWU0MzQyMjI2OTg=","number":10798,"title":"Unable to mount nfs volume in docker compose (vagrant) ","user":{"login":"abhaynahar","id":2629250,"node_id":"MDQ6VXNlcjI2MjkyNTA=","avatar_url":"https://avatars.githubusercontent.com/u/2629250?v=4","gravatar_id":"","url":"https://api.github.com/users/abhaynahar","html_url":"https://github.com/abhaynahar","followers_url":"https://api.github.com/users/abhaynahar/followers","following_url":"https://api.github.com/users/abhaynahar/following{/other_user}","gists_url":"https://api.github.com/users/abhaynahar/gists{/gist_id}","starred_url":"https://api.github.com/users/abhaynahar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abhaynahar/subscriptions","organizations_url":"https://api.github.com/users/abhaynahar/orgs","repos_url":"https://api.github.com/users/abhaynahar/repos","events_url":"https://api.github.com/users/abhaynahar/events{/privacy}","received_events_url":"https://api.github.com/users/abhaynahar/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":25816,"node_id":"MDU6TGFiZWwyNTgxNg==","url":"https://api.github.com/repos/hashicorp/vagrant/labels/bug","name":"bug","color":"e11d21","default":true,"description":null},{"id":139181043,"node_id":"MDU6TGFiZWwxMzkxODEwNDM=","url":"https://api.github.com/repos/hashicorp/vagrant/labels/provider/docker","name":"provider/docker","color":"bfe5bf","default":false,"description":null},{"id":867284247,"node_id":"MDU6TGFiZWw4NjcyODQyNDc=","url":"https://api.github.com/repos/hashicorp/vagrant/labels/task-small","name":"task-small","color":"d8dd3b","default":false,"description":""}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/hashicorp/vagrant/milestones/43","html_url":"https://github.com/hashicorp/vagrant/milestone/43","labels_url":"https://api.github.com/repos/hashicorp/vagrant/milestones/43/labels","id":4093855,"node_id":"MDk6TWlsZXN0b25lNDA5Mzg1NQ==","number":43,"title":"2.2.5","description":"","creator":{"login":"chrisroberts","id":266674,"node_id":"MDQ6VXNlcjI2NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/266674?v=4","gravatar_id":"","url":"https://api.github.com/users/chrisroberts","html_url":"https://github.com/chrisroberts","followers_url":"https://api.github.com/users/chrisroberts/followers","following_url":"https://api.github.com/users/chrisroberts/following{/other_user}","gists_url":"https://api.github.com/users/chrisroberts/gists{/gist_id}","starred_url":"https://api.github.com/users/chrisroberts/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chrisroberts/subscriptions","organizations_url":"https://api.github.com/users/chrisroberts/orgs","repos_url":"https://api.github.com/users/chrisroberts/repos","events_url":"https://api.github.com/users/chrisroberts/events{/privacy}","received_events_url":"https://api.github.com/users/chrisroberts/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":31,"state":"closed","created_at":"2019-02-27T18:22:57Z","updated_at":"2019-12-01T10:29:03Z","due_on":null,"closed_at":"2019-07-10T21:53:34Z"},"comments":21,"created_at":"2019-04-17T11:04:17Z","updated_at":"2020-01-28T02:15:58Z","closed_at":"2019-05-08T16:14:39Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Vagrant 2.2.0\r\n### Host operating system\r\nMacOs Mojave 10.14.2\r\n\r\n### Guest operating system\r\n\r\n### Vagrantfile\r\n```\r\nVagrant.configure(2) do |config|\r\nconfig.vm.define \"iceland\" do |iceland|\r\n    iceland.vm.provider \"docker\" do |docker|\r\n      docker.build_dir = \"/iceland/server/vagrant\"\r\n      docker.create_args = [\"--add-host=iceland:127.0.0.1\"]\r\n      docker.name = \"iceland\"\r\n      docker.compose=true\r\n      docker.compose_configuration={\r\n          \"volumes\" => {\r\n              'iceland_data_volume' => {\r\n                  \"driver\" => \"local\",\r\n                  \"driver_opts\" => {\r\n                      \"type\" => \"nfs\",\r\n                      \"o\" => \"addr=host.docker.internal,nolock\",\r\n                      \"device\" => \":/iceland/data\"\r\n                  }\r\n              }\r\n          },\r\n      }\r\n      docker.volumes =['iceland_data_volume:/temp_directory/data']\r\n      docker.ports =\r\n          [\r\n              \"1000:1000\",\r\n          ]\r\n    end\r\n  end\r\n  end\r\n```\r\n### Dockerfile in the build_dir\r\n```FROM ubuntu:18.04```\r\n\r\n### Expected behavior\r\nRunning vagrant up should have generated a docker-compose.yml that looks like this \r\n```---\r\nversion: '2'\r\nvolumes:\r\n  iceland_data_volume:\r\n    driver: local\r\n    driver_opts:\r\n      type: nfs\r\n      o: addr=host.docker.internal,nolock\r\n      device: \":/iceland/data\"\r\nservices:\r\n  iceland:\r\n    build:\r\n      context: \"/iceland/server/vagrant/\"\r\n    environment: {}\r\n    expose: []\r\n    ports:\r\n    - 1000:1000\r\n    volumes:\r\n    - \"iceland_data_volume:/temp_directory/data\"\r\n    - \"/iceland/server/vagrant:/vagrant\"\r\n    links: []\r\n    command: []\r\n```\r\n\r\n### Actual behavior\r\nWhat actually happened?\r\n```\r\n---\r\nversion: '2'\r\nvolumes:\r\n  iceland_data_volume:\r\n    driver: local\r\n    driver_opts:\r\n      type: nfs\r\n      o: addr=host.docker.internal,nolock\r\n      device: \":/iceland/data\"\r\nservices:\r\n  iceland:\r\n    build:\r\n      context: \"/iceland/server/vagrant\"\r\n    environment: {}\r\n    expose: []\r\n    ports:\r\n    - 1000:1000\r\n    volumes:\r\n    - \"/iceland/server/vagrant/iceland_data_volume:/temp_directory/data\"\r\n    - \"/iceland/server/vagrant:/vagrant\"\r\n    links: []\r\n    command: []\r\n```\r\n### Steps to reproduce\r\nUse the above vagrant and docker (vagrant up) file to generate the following docker-compose.yml inside of `.vagrant/docker-compose` directory\r\n\r\n### The bug\r\nvolumes explicitly created in docker compose are appended with the current path \r\n`\"/iceland/server/vagrant/iceland_data_volume:/temp_directory/data\" ` where as in my case it should have been only `\"iceland_data_volume:/temp_directory/data\"` where `iceland_data_volume` is a nfs volume.\r\nThis behaviour is happening because of https://github.com/hashicorp/vagrant/blob/85acf0cac724ef4bfda593a66e0c17f7e4110da0/plugins/providers/docker/driver/compose.rb#L105 line of code I think.","closed_by":{"login":"briancain","id":810277,"node_id":"MDQ6VXNlcjgxMDI3Nw==","avatar_url":"https://avatars.githubusercontent.com/u/810277?v=4","gravatar_id":"","url":"https://api.github.com/users/briancain","html_url":"https://github.com/briancain","followers_url":"https://api.github.com/users/briancain/followers","following_url":"https://api.github.com/users/briancain/following{/other_user}","gists_url":"https://api.github.com/users/briancain/gists{/gist_id}","starred_url":"https://api.github.com/users/briancain/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/briancain/subscriptions","organizations_url":"https://api.github.com/users/briancain/orgs","repos_url":"https://api.github.com/users/briancain/repos","events_url":"https://api.github.com/users/briancain/events{/privacy}","received_events_url":"https://api.github.com/users/briancain/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/hashicorp/vagrant/issues/10798/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/hashicorp/vagrant/issues/10798/timeline","performed_via_github_app":null,"state_reason":"completed"}