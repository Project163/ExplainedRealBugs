{"url":"https://api.github.com/repos/hashicorp/vagrant/issues/10483","repository_url":"https://api.github.com/repos/hashicorp/vagrant","labels_url":"https://api.github.com/repos/hashicorp/vagrant/issues/10483/labels{/name}","comments_url":"https://api.github.com/repos/hashicorp/vagrant/issues/10483/comments","events_url":"https://api.github.com/repos/hashicorp/vagrant/issues/10483/events","html_url":"https://github.com/hashicorp/vagrant/issues/10483","id":387907531,"node_id":"MDU6SXNzdWUzODc5MDc1MzE=","number":10483,"title":"\"The parameter is incorrect (87)\" Windows powershell command length limit","user":{"login":"DaWolfey","id":611672,"node_id":"MDQ6VXNlcjYxMTY3Mg==","avatar_url":"https://avatars.githubusercontent.com/u/611672?v=4","gravatar_id":"","url":"https://api.github.com/users/DaWolfey","html_url":"https://github.com/DaWolfey","followers_url":"https://api.github.com/users/DaWolfey/followers","following_url":"https://api.github.com/users/DaWolfey/following{/other_user}","gists_url":"https://api.github.com/users/DaWolfey/gists{/gist_id}","starred_url":"https://api.github.com/users/DaWolfey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaWolfey/subscriptions","organizations_url":"https://api.github.com/users/DaWolfey/orgs","repos_url":"https://api.github.com/users/DaWolfey/repos","events_url":"https://api.github.com/users/DaWolfey/events{/privacy}","received_events_url":"https://api.github.com/users/DaWolfey/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":54082731,"node_id":"MDU6TGFiZWw1NDA4MjczMQ==","url":"https://api.github.com/repos/hashicorp/vagrant/labels/enhancement","name":"enhancement","color":"207de5","default":true,"description":null},{"id":218286867,"node_id":"MDU6TGFiZWwyMTgyODY4Njc=","url":"https://api.github.com/repos/hashicorp/vagrant/labels/host/windows","name":"host/windows","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":true,"assignee":{"login":"chrisroberts","id":266674,"node_id":"MDQ6VXNlcjI2NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/266674?v=4","gravatar_id":"","url":"https://api.github.com/users/chrisroberts","html_url":"https://github.com/chrisroberts","followers_url":"https://api.github.com/users/chrisroberts/followers","following_url":"https://api.github.com/users/chrisroberts/following{/other_user}","gists_url":"https://api.github.com/users/chrisroberts/gists{/gist_id}","starred_url":"https://api.github.com/users/chrisroberts/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chrisroberts/subscriptions","organizations_url":"https://api.github.com/users/chrisroberts/orgs","repos_url":"https://api.github.com/users/chrisroberts/repos","events_url":"https://api.github.com/users/chrisroberts/events{/privacy}","received_events_url":"https://api.github.com/users/chrisroberts/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"chrisroberts","id":266674,"node_id":"MDQ6VXNlcjI2NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/266674?v=4","gravatar_id":"","url":"https://api.github.com/users/chrisroberts","html_url":"https://github.com/chrisroberts","followers_url":"https://api.github.com/users/chrisroberts/followers","following_url":"https://api.github.com/users/chrisroberts/following{/other_user}","gists_url":"https://api.github.com/users/chrisroberts/gists{/gist_id}","starred_url":"https://api.github.com/users/chrisroberts/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chrisroberts/subscriptions","organizations_url":"https://api.github.com/users/chrisroberts/orgs","repos_url":"https://api.github.com/users/chrisroberts/repos","events_url":"https://api.github.com/users/chrisroberts/events{/privacy}","received_events_url":"https://api.github.com/users/chrisroberts/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/hashicorp/vagrant/milestones/40","html_url":"https://github.com/hashicorp/vagrant/milestone/40","labels_url":"https://api.github.com/repos/hashicorp/vagrant/milestones/40/labels","id":3822546,"node_id":"MDk6TWlsZXN0b25lMzgyMjU0Ng==","number":40,"title":"2.2.3","description":"","creator":{"login":"chrisroberts","id":266674,"node_id":"MDQ6VXNlcjI2NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/266674?v=4","gravatar_id":"","url":"https://api.github.com/users/chrisroberts","html_url":"https://github.com/chrisroberts","followers_url":"https://api.github.com/users/chrisroberts/followers","following_url":"https://api.github.com/users/chrisroberts/following{/other_user}","gists_url":"https://api.github.com/users/chrisroberts/gists{/gist_id}","starred_url":"https://api.github.com/users/chrisroberts/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chrisroberts/subscriptions","organizations_url":"https://api.github.com/users/chrisroberts/orgs","repos_url":"https://api.github.com/users/chrisroberts/repos","events_url":"https://api.github.com/users/chrisroberts/events{/privacy}","received_events_url":"https://api.github.com/users/chrisroberts/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":34,"state":"closed","created_at":"2018-11-14T19:23:29Z","updated_at":"2019-01-10T17:37:46Z","due_on":null,"closed_at":"2019-01-10T17:37:46Z"},"comments":1,"created_at":"2018-12-05T19:23:21Z","updated_at":"2020-03-28T02:16:14Z","closed_at":"2018-12-08T00:29:57Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"If there are a large number of SMB shares defined - in this specific case, more than 22, I get the following error:\r\nhttps://gist.github.com/DaWolfey/74e3f5fefe802078366759a38519077d\r\n\r\nMy investigation leads me to believe that this is an error being produced by Windows due to the command being executed that creates all the SMB shares exceeding the windows command line character limit of 32768 characters. See here: https://blogs.msdn.microsoft.com/oldnewthing/20031210-00/?p=41553 and https://support.thoughtworks.com/hc/en-us/articles/213248526-Getting-around-maximum-command-line-length-is-32767-characters-on-Windows which identifies this limitation.\r\n\r\nVagrant debug logs show that a command is executed after entering an administrative windows login which creates all the shares. This is a single massive command that invokes powershell and uses the EncodedCommand parameter with a long base64 encoded string. In this failure case, this string is 33256 characters in length and the entire command is 33658 characters.\r\nDecoding this string, which reduces it to a mere 12260 characters in length, reveals that it calls the Start-Process function, with a second EncodedCommand. Decoding _this_ reveals that it is calling: C:/HashiCorp/Vagrant/embedded/gems/2.2.2/gems/vagrant-2.2.2/plugins/hosts/windows/scripts/set_share.ps1 with all the SMB share parameters (a measly 4434 characters in total!). Executing this manually works correctly and all the SMB shares are created.\r\n\r\nIf I remove one share from my vagrantfile, the first EncodedCommand parameter string length is 31940, and the entire command is just under the limit at 32343 characters, and everything works correctly, which suggests that it is this character limit that is the problem.\r\n\r\n\r\n### Vagrant version\r\n2.2.2\r\n\r\n### Host operating system\r\nWindows 10 Pro 1803\r\n\r\n### Guest operating system\r\nLaravel Homestead 6.3.0, which uses Ubuntu.\r\nThe box is running under Hyper-V\r\n\r\n### Expected behavior\r\nAll SMB shares should be created\r\n\r\n### Actual behavior\r\nI receive the error above in the gist and no shares are created.\r\n","closed_by":{"login":"chrisroberts","id":266674,"node_id":"MDQ6VXNlcjI2NjY3NA==","avatar_url":"https://avatars.githubusercontent.com/u/266674?v=4","gravatar_id":"","url":"https://api.github.com/users/chrisroberts","html_url":"https://github.com/chrisroberts","followers_url":"https://api.github.com/users/chrisroberts/followers","following_url":"https://api.github.com/users/chrisroberts/following{/other_user}","gists_url":"https://api.github.com/users/chrisroberts/gists{/gist_id}","starred_url":"https://api.github.com/users/chrisroberts/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chrisroberts/subscriptions","organizations_url":"https://api.github.com/users/chrisroberts/orgs","repos_url":"https://api.github.com/users/chrisroberts/repos","events_url":"https://api.github.com/users/chrisroberts/events{/privacy}","received_events_url":"https://api.github.com/users/chrisroberts/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/hashicorp/vagrant/issues/10483/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/hashicorp/vagrant/issues/10483/timeline","performed_via_github_app":null,"state_reason":"completed"}