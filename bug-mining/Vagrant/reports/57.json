{"url":"https://api.github.com/repos/hashicorp/vagrant/issues/7610","repository_url":"https://api.github.com/repos/hashicorp/vagrant","labels_url":"https://api.github.com/repos/hashicorp/vagrant/issues/7610/labels{/name}","comments_url":"https://api.github.com/repos/hashicorp/vagrant/issues/7610/comments","events_url":"https://api.github.com/repos/hashicorp/vagrant/issues/7610/events","html_url":"https://github.com/hashicorp/vagrant/issues/7610","id":166384790,"node_id":"MDU6SXNzdWUxNjYzODQ3OTA=","number":7610,"title":"Authentication failure after inserting new key with Vagrant 1.8.5. [PATCH]","user":{"login":"breisig","id":7527307,"node_id":"MDQ6VXNlcjc1MjczMDc=","avatar_url":"https://avatars.githubusercontent.com/u/7527307?v=4","gravatar_id":"","url":"https://api.github.com/users/breisig","html_url":"https://github.com/breisig","followers_url":"https://api.github.com/users/breisig/followers","following_url":"https://api.github.com/users/breisig/following{/other_user}","gists_url":"https://api.github.com/users/breisig/gists{/gist_id}","starred_url":"https://api.github.com/users/breisig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/breisig/subscriptions","organizations_url":"https://api.github.com/users/breisig/orgs","repos_url":"https://api.github.com/users/breisig/repos","events_url":"https://api.github.com/users/breisig/events{/privacy}","received_events_url":"https://api.github.com/users/breisig/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":25816,"node_id":"MDU6TGFiZWwyNTgxNg==","url":"https://api.github.com/repos/hashicorp/vagrant/labels/bug","name":"bug","color":"e11d21","default":true,"description":null},{"id":157557761,"node_id":"MDU6TGFiZWwxNTc1NTc3NjE=","url":"https://api.github.com/repos/hashicorp/vagrant/labels/guest/debian","name":"guest/debian","color":"5319e7","default":false,"description":null}],"state":"closed","locked":true,"assignee":{"login":"sethvargo","id":408570,"node_id":"MDQ6VXNlcjQwODU3MA==","avatar_url":"https://avatars.githubusercontent.com/u/408570?v=4","gravatar_id":"","url":"https://api.github.com/users/sethvargo","html_url":"https://github.com/sethvargo","followers_url":"https://api.github.com/users/sethvargo/followers","following_url":"https://api.github.com/users/sethvargo/following{/other_user}","gists_url":"https://api.github.com/users/sethvargo/gists{/gist_id}","starred_url":"https://api.github.com/users/sethvargo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sethvargo/subscriptions","organizations_url":"https://api.github.com/users/sethvargo/orgs","repos_url":"https://api.github.com/users/sethvargo/repos","events_url":"https://api.github.com/users/sethvargo/events{/privacy}","received_events_url":"https://api.github.com/users/sethvargo/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"sethvargo","id":408570,"node_id":"MDQ6VXNlcjQwODU3MA==","avatar_url":"https://avatars.githubusercontent.com/u/408570?v=4","gravatar_id":"","url":"https://api.github.com/users/sethvargo","html_url":"https://github.com/sethvargo","followers_url":"https://api.github.com/users/sethvargo/followers","following_url":"https://api.github.com/users/sethvargo/following{/other_user}","gists_url":"https://api.github.com/users/sethvargo/gists{/gist_id}","starred_url":"https://api.github.com/users/sethvargo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sethvargo/subscriptions","organizations_url":"https://api.github.com/users/sethvargo/orgs","repos_url":"https://api.github.com/users/sethvargo/repos","events_url":"https://api.github.com/users/sethvargo/events{/privacy}","received_events_url":"https://api.github.com/users/sethvargo/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/hashicorp/vagrant/milestones/18","html_url":"https://github.com/hashicorp/vagrant/milestone/18","labels_url":"https://api.github.com/repos/hashicorp/vagrant/milestones/18/labels","id":1891230,"node_id":"MDk6TWlsZXN0b25lMTg5MTIzMA==","number":18,"title":"1.8.6","description":"","creator":{"login":"sethvargo","id":408570,"node_id":"MDQ6VXNlcjQwODU3MA==","avatar_url":"https://avatars.githubusercontent.com/u/408570?v=4","gravatar_id":"","url":"https://api.github.com/users/sethvargo","html_url":"https://github.com/sethvargo","followers_url":"https://api.github.com/users/sethvargo/followers","following_url":"https://api.github.com/users/sethvargo/following{/other_user}","gists_url":"https://api.github.com/users/sethvargo/gists{/gist_id}","starred_url":"https://api.github.com/users/sethvargo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sethvargo/subscriptions","organizations_url":"https://api.github.com/users/sethvargo/orgs","repos_url":"https://api.github.com/users/sethvargo/repos","events_url":"https://api.github.com/users/sethvargo/events{/privacy}","received_events_url":"https://api.github.com/users/sethvargo/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":21,"state":"closed","created_at":"2016-07-19T04:38:36Z","updated_at":"2016-09-28T12:59:25Z","due_on":"2016-09-01T07:00:00Z","closed_at":"2016-09-28T12:59:25Z"},"comments":17,"created_at":"2016-07-19T17:10:55Z","updated_at":"2016-07-22T17:47:02Z","closed_at":"2016-07-20T22:22:07Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I have upgraded to the latest Vagrant v1.8.5 and now running Virtualbox 5.1 on Windows and I have noticed that when setting up a new vagrant instance (aka 'vagrant up'), It seems its keeps displaying over and over \"Warning: Authentication failure. Retrying...\". The Vagrant VM is a CentOS 7.2 (64bit) VM.\n\nExample:\n==> default: Preparing network interfaces based on configuration...\n    default: Adapter 1: nat\n    default: Adapter 2: hostonly\n==> default: Forwarding ports...\n    default: 22 (guest) => 2222 (host) (adapter 1)\n==> default: Running 'pre-boot' VM customizations...\n==> default: Booting VM...\n==> default: Waiting for machine to boot. This may take a few minutes...\n    default: SSH address: 127.0.0.1:2222\n    default: SSH username: vagrant\n    default: SSH auth method: private key\n    default: Warning: Remote connection disconnect. Retrying...\n    default:\n    default: Vagrant insecure key detected. Vagrant will automatically replace\n    default: this with a newly generated keypair for better security.\n    default:\n    default: Inserting generated public key within guest...\n    default: Removing insecure key from the guest if it's present...\n    default: Key inserted! Disconnecting and reconnecting using new SSH key...\n    default: Warning: Authentication failure. Retrying...\n    default: Warning: Authentication failure. Retrying...\n    default: Warning: Authentication failure. Retrying...\n    default: Warning: Authentication failure. Retrying...\n    default: Warning: Authentication failure. Retrying...\n    default: Warning: Authentication failure. Retrying...\n    default: Warning: Authentication failure. Retrying...\n    default: Warning: Authentication failure. Retrying...\n    default: Warning: Authentication failure. Retrying...\n    default: Warning: Authentication failure. Retrying...\n    default: Warning: Authentication failure. Retrying...\n    default: Warning: Authentication failure. Retrying...\n    default: Warning: Authentication failure. Retrying...\n    default: Warning: Authentication failure. Retrying...\n    default: Warning: Authentication failure. Retrying...\n    default: Warning: Authentication failure. Retrying...\n    default: Warning: Authentication failure. Retrying...\n    default: Warning: Authentication failure. Retrying...\n    default: Warning: Authentication failure. Retrying...\n    default: Warning: Authentication failure. Retrying...\n    default: Warning: Authentication failure. Retrying...\n    default: Warning: Authentication failure. Retrying...\n    default: Warning: Authentication failure. Retrying...\n    default: Warning: Authentication failure. Retrying...\n    default: Warning: Authentication failure. Retrying...\nTimed out while waiting for the machine to boot. This means that\nVagrant was unable to communicate with the guest machine within\nthe configured (\"config.vm.boot_timeout\" value) time period.\n\nIf you look above, you should be able to see the error(s) that\nVagrant had when attempting to connect to the machine. These errors\nare usually good hints as to what may be wrong.\n\nIf you're using a custom box, make sure that networking is properly\nworking and you're able to connect to the machine. It is a common\nproblem that networking isn't setup properly in these boxes.\nVerify that authentication configurations are also setup properly,\nas well.\n\nIf the box appears to be booting properly, you may want to increase\nthe timeout (\"config.vm.boot_timeout\") value.\nC:\\vagrant\n\nWhen I log onto the VM manually, I noticed the updated authorized_keys file permission that vagrant installed is incorrect. When I 'chmod 0600 ~/.ssh/authorized_keys' that file, it then starts to work.\n\nAfter reviewing the git history, I noticed some code changes related to Git commit ( https://github.com/mitchellh/vagrant/commit/4aaa600bd6c677b5476ab47ed1cd1d8a04b35a95 ) caused the issue. It seems a missing \"chmod 0600 ~/.ssh/authorized_keys\" was forgotten.\n\nHere's a quick fix for git\n\n```\ndiff -uNr vagrant-original/plugins/guests/linux/cap/public_key.rb vagrant/plugins/guests/linux/cap/public_key.rb\n--- vagrant-original/plugins/guests/linux/cap/public_key.rb     2016-07-19 12:06:56.575045974 -0500\n+++ vagrant/plugins/guests/linux/cap/public_key.rb      2016-07-19 12:07:34.303376009 -0500\n@@ -54,6 +54,7 @@\n             if test -f ~/.ssh/authorized_keys; then\n               grep -v -x -f '#{remote_path}' ~/.ssh/authorized_keys > ~/.ssh/authorized_keys.tmp\n               mv ~/.ssh/authorized_keys.tmp ~/.ssh/authorized_keys\n+              chmod 0600 ~/.ssh/authorized_keys\n             fi\n\n             rm -f '#{remote_path}'\n\n```\n\nor on Windows I could add the fix directly to ( C:\\HashiCorp\\vagrant\\embedded\\gems\\gems\\vagrant-1.8.5\\plugins\\guests\\linux\\cap\\public_key.rb) which fixes the issue.\n\nOne alternative (which I didn't want to use) was setting in Vagrantfile \"config.ssh.insert_key = false\" but that just seemed more like a workaround.\n","closed_by":{"login":"sethvargo","id":408570,"node_id":"MDQ6VXNlcjQwODU3MA==","avatar_url":"https://avatars.githubusercontent.com/u/408570?v=4","gravatar_id":"","url":"https://api.github.com/users/sethvargo","html_url":"https://github.com/sethvargo","followers_url":"https://api.github.com/users/sethvargo/followers","following_url":"https://api.github.com/users/sethvargo/following{/other_user}","gists_url":"https://api.github.com/users/sethvargo/gists{/gist_id}","starred_url":"https://api.github.com/users/sethvargo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sethvargo/subscriptions","organizations_url":"https://api.github.com/users/sethvargo/orgs","repos_url":"https://api.github.com/users/sethvargo/repos","events_url":"https://api.github.com/users/sethvargo/events{/privacy}","received_events_url":"https://api.github.com/users/sethvargo/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/hashicorp/vagrant/issues/7610/reactions","total_count":12,"+1":12,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/hashicorp/vagrant/issues/7610/timeline","performed_via_github_app":null,"state_reason":"completed"}