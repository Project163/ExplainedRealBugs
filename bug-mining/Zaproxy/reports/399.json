{"url":"https://api.github.com/repos/zaproxy/zaproxy/issues/8631","repository_url":"https://api.github.com/repos/zaproxy/zaproxy","labels_url":"https://api.github.com/repos/zaproxy/zaproxy/issues/8631/labels{/name}","comments_url":"https://api.github.com/repos/zaproxy/zaproxy/issues/8631/comments","events_url":"https://api.github.com/repos/zaproxy/zaproxy/issues/8631/events","html_url":"https://github.com/zaproxy/zaproxy/issues/8631","id":2518653013,"node_id":"I_kwDOAjHKnc6WH5hV","number":8631,"title":"Concurrent access to Graal.js Proxy scripts with latest ZAP versions","user":{"login":"rtpt-alexanderneumann","id":62751754,"node_id":"MDQ6VXNlcjYyNzUxNzU0","avatar_url":"https://avatars.githubusercontent.com/u/62751754?v=4","gravatar_id":"","url":"https://api.github.com/users/rtpt-alexanderneumann","html_url":"https://github.com/rtpt-alexanderneumann","followers_url":"https://api.github.com/users/rtpt-alexanderneumann/followers","following_url":"https://api.github.com/users/rtpt-alexanderneumann/following{/other_user}","gists_url":"https://api.github.com/users/rtpt-alexanderneumann/gists{/gist_id}","starred_url":"https://api.github.com/users/rtpt-alexanderneumann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rtpt-alexanderneumann/subscriptions","organizations_url":"https://api.github.com/users/rtpt-alexanderneumann/orgs","repos_url":"https://api.github.com/users/rtpt-alexanderneumann/repos","events_url":"https://api.github.com/users/rtpt-alexanderneumann/events{/privacy}","received_events_url":"https://api.github.com/users/rtpt-alexanderneumann/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":220063774,"node_id":"MDU6TGFiZWwyMjAwNjM3NzQ=","url":"https://api.github.com/repos/zaproxy/zaproxy/labels/bug","name":"bug","color":"fc2929","default":true,"description":null}],"state":"closed","locked":true,"assignee":{"login":"thc202","id":4639210,"node_id":"MDQ6VXNlcjQ2MzkyMTA=","avatar_url":"https://avatars.githubusercontent.com/u/4639210?v=4","gravatar_id":"","url":"https://api.github.com/users/thc202","html_url":"https://github.com/thc202","followers_url":"https://api.github.com/users/thc202/followers","following_url":"https://api.github.com/users/thc202/following{/other_user}","gists_url":"https://api.github.com/users/thc202/gists{/gist_id}","starred_url":"https://api.github.com/users/thc202/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/thc202/subscriptions","organizations_url":"https://api.github.com/users/thc202/orgs","repos_url":"https://api.github.com/users/thc202/repos","events_url":"https://api.github.com/users/thc202/events{/privacy}","received_events_url":"https://api.github.com/users/thc202/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"thc202","id":4639210,"node_id":"MDQ6VXNlcjQ2MzkyMTA=","avatar_url":"https://avatars.githubusercontent.com/u/4639210?v=4","gravatar_id":"","url":"https://api.github.com/users/thc202","html_url":"https://github.com/thc202","followers_url":"https://api.github.com/users/thc202/followers","following_url":"https://api.github.com/users/thc202/following{/other_user}","gists_url":"https://api.github.com/users/thc202/gists{/gist_id}","starred_url":"https://api.github.com/users/thc202/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/thc202/subscriptions","organizations_url":"https://api.github.com/users/thc202/orgs","repos_url":"https://api.github.com/users/thc202/repos","events_url":"https://api.github.com/users/thc202/events{/privacy}","received_events_url":"https://api.github.com/users/thc202/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/zaproxy/zaproxy/milestones/12","html_url":"https://github.com/zaproxy/zaproxy/milestone/12","labels_url":"https://api.github.com/repos/zaproxy/zaproxy/milestones/12/labels","id":10780624,"node_id":"MI_kwDOAjHKnc4ApH_Q","number":12,"title":"2.16.0","description":"","creator":{"login":"thc202","id":4639210,"node_id":"MDQ6VXNlcjQ2MzkyMTA=","avatar_url":"https://avatars.githubusercontent.com/u/4639210?v=4","gravatar_id":"","url":"https://api.github.com/users/thc202","html_url":"https://github.com/thc202","followers_url":"https://api.github.com/users/thc202/followers","following_url":"https://api.github.com/users/thc202/following{/other_user}","gists_url":"https://api.github.com/users/thc202/gists{/gist_id}","starred_url":"https://api.github.com/users/thc202/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/thc202/subscriptions","organizations_url":"https://api.github.com/users/thc202/orgs","repos_url":"https://api.github.com/users/thc202/repos","events_url":"https://api.github.com/users/thc202/events{/privacy}","received_events_url":"https://api.github.com/users/thc202/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":38,"state":"closed","created_at":"2024-04-05T13:57:53Z","updated_at":"2025-01-21T15:18:42Z","due_on":null,"closed_at":"2025-01-21T15:18:42Z"},"comments":5,"created_at":"2024-09-11T06:28:23Z","updated_at":"2024-12-12T01:33:06Z","closed_at":"2024-09-11T15:12:23Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\nScripts (especially Proxy scripts) do not work any more on recent Java versions (21). They are terminated and disabled with the following error message in the console:\r\n```\r\nproxyRequest called for url=https://www.heise.de/\r\nproxyResponse called for url=https://www.heise.de/\r\nproxyRequest called for url=https://www.heise.de/assets/styles/fonts/ss3vf.d8a.ltc.woff2\r\nproxyRequest called for url=https://www.heise.de/assets/styles/index.css\r\nproxyResponse called for url=https://www.heise.de/assets/styles/fonts/ss3vf.d8a.ltc.woff2\r\njava.lang.IllegalStateException: Multi threaded access requested by thread Thread[#237,ZAP-IO-Server-1-6,10,main] but is not allowed for language(s) js.proxyRequest called for url=https://www.heise.de/assets/akwa/v24/js/akwa.js\r\njava.lang.IllegalStateException: Multi threaded access requested by thread Thread[#237,ZAP-IO-Server-1-6,10,main] but is not allowed for language(s) js.\r\n```\n\n### Steps to reproduce the behavior\n\n1. In the top left box click `+`, then add the `Scripts` tab\r\n2. Right-click on \"Proxy\" -> \"New Script\"\r\n3. Give the script a name, e.g. \"test\"\r\n4. Choose \"Script Engine\" \"ECMAScript : Graal.js\", Template is auto-filled with the \"Proxy default template\"\r\n5. Click \"Save\"\r\n6. In the \"Scripts\" tab on the left, right-click on the script and select \"Enable\"\r\n7. Access a non-trivial website which does a few requests\r\n8. Observe that the script has been disabled an the console below the script contains the error mentioned above\n\n### Expected behavior\n\nI expect Proxy scripts to be called and not be terminated.\n\n### Software versions\n\nZAP weekly:\r\n```\r\nZAP\r\nVersion: D-2024-09-02\r\n\r\nInstalled Add-ons: [[id=accessControl, version=11.0.0],\r\n[id=alertFilters, version=22.0.0], [id=ascanrules,\r\nversion=68.0.0], [id=ascanrulesBeta, version=55.0.0],\r\n[id=authhelper, version=0.15.1], [id=automation,\r\nversion=0.42.0], [id=bruteforce, version=17.0.0],\r\n[id=callhome, version=0.13.0], [id=commonlib,\r\nversion=1.27.0], [id=coreLang, version=16.0.0],\r\n[id=custompayloads, version=0.9.0], [id=database,\r\nversion=0.6.0], [id=diff, version=16.0.0],\r\n[id=directorylistv1, version=9.0.0], [id=domxss,\r\nversion=20.0.0], [id=encoder, version=1.6.0], [id=exim,\r\nversion=0.11.0], [id=formhandler, version=6.7.0], [id=fuzz,\r\nversion=13.14.0], [id=gettingStarted, version=18.0.0],\r\n[id=graaljs, version=0.8.0], [id=graphql, version=0.25.0],\r\n[id=grpc, version=0.3.0], [id=help, version=19.0.0],\r\n[id=hud, version=0.20.0], [id=invoke, version=16.0.0],\r\n[id=network, version=0.17.0], [id=oast, version=0.20.0],\r\n[id=onlineMenu, version=14.0.0], [id=openapi,\r\nversion=43.0.0], [id=plugnhack, version=14.0.0],\r\n[id=postman, version=0.5.0], [id=pscan, version=0.0.1],\r\n[id=pscanrules, version=60.0.0], [id=pscanrulesBeta,\r\nversion=41.0.0], [id=quickstart, version=49.0.0],\r\n[id=replacer, version=19.0.0], [id=reports, version=0.33.0],\r\n[id=requester, version=7.8.0], [id=retest, version=0.10.0],\r\n[id=retire, version=0.40.0], [id=reveal, version=9.0.0],\r\n[id=scripts, version=45.6.0], [id=selenium,\r\nversion=15.29.0], [id=sequence, version=8.0.0], [id=soap,\r\nversion=24.0.0], [id=spider, version=0.12.0],\r\n[id=spiderAjax, version=23.21.0], [id=tips, version=14.0.0],\r\n[id=webdriverlinux, version=102.0.0], [id=webdrivermacos,\r\nversion=102.0.0], [id=webdriverwindows, version=102.0.0],\r\n[id=websocket, version=32.0.0], [id=zest, version=47.0.0]]\r\n\r\nOperating System: Linux\r\nArchitecture: amd64\r\nCPU Cores: 16\r\nMax Memory: 6 GB\r\nJava Version: Red Hat, Inc. 21.0.4\r\nSystem's Locale: en_US\r\nDisplay Locale: en_GB\r\nFormat Locale: en_US\r\nDefault Charset: UTF-8\r\nZAP Home Directory: /home/user/.ZAP_D/\r\nZAP Installation Directory: /usr/share/zap-weekly/./\r\nLook and Feel: FlatLaf Light (com.formdev.flatlaf.FlatLightLaf)\r\n```\r\n\r\nZAP 2.15.0:\r\n\r\n```\r\nZAP\r\nVersion: 2.15.0\r\n\r\nInstalled Add-ons: [[id=alertFilters, version=21.0.0],\r\n[id=ascanrules, version=67.0.0], [id=authhelper,\r\nversion=0.15.1], [id=automation, version=0.42.0],\r\n[id=bruteforce, version=16.0.0], [id=callhome,\r\nversion=0.13.0], [id=commonlib, version=1.27.0],\r\n[id=database, version=0.5.0], [id=diff, version=15.0.0],\r\n[id=directorylistv1, version=8.0.0], [id=domxss,\r\nversion=19.0.0], [id=encoder, version=1.5.0], [id=exim,\r\nversion=0.10.0], [id=formhandler, version=6.6.0], [id=fuzz,\r\nversion=13.13.0], [id=gettingStarted, version=17.0.0],\r\n[id=graaljs, version=0.7.0], [id=graphql, version=0.24.0],\r\n[id=help, version=18.0.0], [id=hud, version=0.19.0],\r\n[id=invoke, version=15.0.0], [id=jsonview, version=3.0.0],\r\n[id=network, version=0.17.0], [id=oast, version=0.19.0],\r\n[id=onlineMenu, version=13.0.0], [id=openapi,\r\nversion=42.0.0], [id=postman, version=0.4.0], [id=pscan,\r\nversion=0.0.1], [id=pscanrules, version=60.0.0],\r\n[id=quickstart, version=49.0.0], [id=replacer,\r\nversion=18.0.0], [id=reports, version=0.33.0],\r\n[id=requester, version=7.7.0], [id=retest, version=0.10.0],\r\n[id=retire, version=0.39.0], [id=reveal, version=8.0.0],\r\n[id=scripts, version=45.6.0], [id=selenium,\r\nversion=15.29.0], [id=soap, version=23.0.0], [id=spider,\r\nversion=0.11.0], [id=spiderAjax, version=23.21.0], [id=tips,\r\nversion=13.0.0], [id=webdriverlinux, version=102.0.0],\r\n[id=websocket, version=31.0.0], [id=zest, version=46.0.0]]\r\n\r\nOperating System: Linux\r\nArchitecture: amd64\r\nCPU Cores: 16\r\nMax Memory: 6 GB\r\nJava Version: Red Hat, Inc. 21.0.4\r\nSystem's Locale: en_US\r\nDisplay Locale: en_GB\r\nFormat Locale: en_US\r\nDefault Charset: UTF-8\r\nZAP Home Directory: /home/user/.ZAP/\r\nZAP Installation Directory: /usr/share/zap/./\r\nLook and Feel: FlatLaf Light (com.formdev.flatlaf.FlatLightLaf)\r\n```\n\n### Screenshots\n\n_No response_\n\n### Errors from the zap.log file\n\nNo errors in the log file.\n\n### Additional context\n\nThis issue looks similar to https://github.com/zaproxy/zaproxy/issues/6992. I've spent some time looking around for commits in this repo and the extensions repo, but did not see anything that has changed since then. I'm not sure why the workaround introduced to resolve #6992 does not work any more.\r\n\r\nIs there anything I can do to help? Please let me know!\r\n\r\nThanks a lot for ZAP!\n\n### Would you like to help fix this issue?\n\n- [X] Yes","closed_by":{"login":"psiinon","id":1081115,"node_id":"MDQ6VXNlcjEwODExMTU=","avatar_url":"https://avatars.githubusercontent.com/u/1081115?v=4","gravatar_id":"","url":"https://api.github.com/users/psiinon","html_url":"https://github.com/psiinon","followers_url":"https://api.github.com/users/psiinon/followers","following_url":"https://api.github.com/users/psiinon/following{/other_user}","gists_url":"https://api.github.com/users/psiinon/gists{/gist_id}","starred_url":"https://api.github.com/users/psiinon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/psiinon/subscriptions","organizations_url":"https://api.github.com/users/psiinon/orgs","repos_url":"https://api.github.com/users/psiinon/repos","events_url":"https://api.github.com/users/psiinon/events{/privacy}","received_events_url":"https://api.github.com/users/psiinon/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/zaproxy/zaproxy/issues/8631/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/zaproxy/zaproxy/issues/8631/timeline","performed_via_github_app":null,"state_reason":"completed"}