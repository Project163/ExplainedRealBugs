{"url":"https://api.github.com/repos/zaproxy/zaproxy/issues/4979","repository_url":"https://api.github.com/repos/zaproxy/zaproxy","labels_url":"https://api.github.com/repos/zaproxy/zaproxy/issues/4979/labels{/name}","comments_url":"https://api.github.com/repos/zaproxy/zaproxy/issues/4979/comments","events_url":"https://api.github.com/repos/zaproxy/zaproxy/issues/4979/events","html_url":"https://github.com/zaproxy/zaproxy/issues/4979","id":360370268,"node_id":"MDU6SXNzdWUzNjAzNzAyNjg=","number":4979,"title":"Dockerfile hangs in Concourse-CI since Xvfb never terminates","user":{"login":"northdpole","id":1583262,"node_id":"MDQ6VXNlcjE1ODMyNjI=","avatar_url":"https://avatars.githubusercontent.com/u/1583262?v=4","gravatar_id":"","url":"https://api.github.com/users/northdpole","html_url":"https://github.com/northdpole","followers_url":"https://api.github.com/users/northdpole/followers","following_url":"https://api.github.com/users/northdpole/following{/other_user}","gists_url":"https://api.github.com/users/northdpole/gists{/gist_id}","starred_url":"https://api.github.com/users/northdpole/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/northdpole/subscriptions","organizations_url":"https://api.github.com/users/northdpole/orgs","repos_url":"https://api.github.com/users/northdpole/repos","events_url":"https://api.github.com/users/northdpole/events{/privacy}","received_events_url":"https://api.github.com/users/northdpole/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":382856034,"node_id":"MDU6TGFiZWwzODI4NTYwMzQ=","url":"https://api.github.com/repos/zaproxy/zaproxy/labels/historic","name":"historic","color":"c2e0c6","default":false,"description":null},{"id":678291375,"node_id":"MDU6TGFiZWw2NzgyOTEzNzU=","url":"https://api.github.com/repos/zaproxy/zaproxy/labels/Docker","name":"Docker","color":"8B4513","default":false,"description":null}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2018-09-14T16:20:09Z","updated_at":"2020-02-03T03:26:47Z","closed_at":"2018-09-17T12:54:53Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hey everyone, when running any python script in the dockerized version of ZAP in Concourse CI the container will never terminate.\r\nHere's why: Concourse by design, expects all processes in a container to exit cleanly otherwise it assumes there's some long running task and it keeps waiting for task output.\r\n\r\nThis task is Xvfb which even after ZAP and the python scripts have finished keeps running.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. With this [file](https://github.com/concourse/concourse-docker/blob/master/docker-compose.yml) in your current dir run docker-compose up -d to setup a local concourse environment. (default credentials being test:test)\r\n2. Download and install fly either from 127.0.0.1:8080 with concourse running or from your package manager of choice\r\n3. You can use the pipeline file below to setup a basic pipeline \r\n3. run the following commands to associate fly with your local concourse: \r\n`fly -t test login --concourse-url http://127.0.0.1:8080\r\nfly -t test sync\r\nfly -t test execute -c pipeline.yml\r\n`\r\n4. Observe that it never finishes. \r\n\r\n**Expected behavior**\r\nAll processes exit cleanly.\r\n\r\n**Software versions**\r\n - ZAP: latest zap-weekly\r\n - OS:  Latest Ubuntu\r\n\r\n**Errors from the zap.log file**\r\nN/A\r\n\r\n**Additional context**\r\nThere's a quick solution to separately kill Xvfb at the end of execution.\r\nAlso, since this issue is very specific to one use case, I'm not sure how interested you are in fixing this.\r\nIf you're not but there's an easy way to execute zap without zap-x.sh or Xvfb please let me know.\r\n//Update: It's the zap-x.sh file, it exits if the file is commented out except the last line.\r\n// I guess you need this file to launch graphical zap from docker, what if a --no-graphics or similar switch is added to the script to make it bypassable?\r\n\r\n`--- pipeline.yml ---\r\nplatform: linux\r\nimage_resource:\r\n        type: docker-image\r\n        source: { repository: owasp/zap2docker-weekly }\r\nrun:\r\n        path: zap-baseline.py\r\n        args: [-t, '<Some Target you want>', -d]`\r\n\r\n\r\n","closed_by":{"login":"kingthorin","id":7570458,"node_id":"MDQ6VXNlcjc1NzA0NTg=","avatar_url":"https://avatars.githubusercontent.com/u/7570458?v=4","gravatar_id":"","url":"https://api.github.com/users/kingthorin","html_url":"https://github.com/kingthorin","followers_url":"https://api.github.com/users/kingthorin/followers","following_url":"https://api.github.com/users/kingthorin/following{/other_user}","gists_url":"https://api.github.com/users/kingthorin/gists{/gist_id}","starred_url":"https://api.github.com/users/kingthorin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kingthorin/subscriptions","organizations_url":"https://api.github.com/users/kingthorin/orgs","repos_url":"https://api.github.com/users/kingthorin/repos","events_url":"https://api.github.com/users/kingthorin/events{/privacy}","received_events_url":"https://api.github.com/users/kingthorin/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/zaproxy/zaproxy/issues/4979/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/zaproxy/zaproxy/issues/4979/timeline","performed_via_github_app":null,"state_reason":"completed"}