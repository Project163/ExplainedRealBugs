{"url":"https://api.github.com/repos/zaproxy/zaproxy/issues/6138","repository_url":"https://api.github.com/repos/zaproxy/zaproxy","labels_url":"https://api.github.com/repos/zaproxy/zaproxy/issues/6138/labels{/name}","comments_url":"https://api.github.com/repos/zaproxy/zaproxy/issues/6138/comments","events_url":"https://api.github.com/repos/zaproxy/zaproxy/issues/6138/events","html_url":"https://github.com/zaproxy/zaproxy/issues/6138","id":684135219,"node_id":"MDU6SXNzdWU2ODQxMzUyMTk=","number":6138,"title":"Persistent growing high CPU usage with proxy","user":{"login":"wadim-al","id":29713984,"node_id":"MDQ6VXNlcjI5NzEzOTg0","avatar_url":"https://avatars.githubusercontent.com/u/29713984?v=4","gravatar_id":"","url":"https://api.github.com/users/wadim-al","html_url":"https://github.com/wadim-al","followers_url":"https://api.github.com/users/wadim-al/followers","following_url":"https://api.github.com/users/wadim-al/following{/other_user}","gists_url":"https://api.github.com/users/wadim-al/gists{/gist_id}","starred_url":"https://api.github.com/users/wadim-al/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wadim-al/subscriptions","organizations_url":"https://api.github.com/users/wadim-al/orgs","repos_url":"https://api.github.com/users/wadim-al/repos","events_url":"https://api.github.com/users/wadim-al/events{/privacy}","received_events_url":"https://api.github.com/users/wadim-al/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":220063774,"node_id":"MDU6TGFiZWwyMjAwNjM3NzQ=","url":"https://api.github.com/repos/zaproxy/zaproxy/labels/bug","name":"bug","color":"fc2929","default":true,"description":null}],"state":"closed","locked":true,"assignee":{"login":"thc202","id":4639210,"node_id":"MDQ6VXNlcjQ2MzkyMTA=","avatar_url":"https://avatars.githubusercontent.com/u/4639210?v=4","gravatar_id":"","url":"https://api.github.com/users/thc202","html_url":"https://github.com/thc202","followers_url":"https://api.github.com/users/thc202/followers","following_url":"https://api.github.com/users/thc202/following{/other_user}","gists_url":"https://api.github.com/users/thc202/gists{/gist_id}","starred_url":"https://api.github.com/users/thc202/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/thc202/subscriptions","organizations_url":"https://api.github.com/users/thc202/orgs","repos_url":"https://api.github.com/users/thc202/repos","events_url":"https://api.github.com/users/thc202/events{/privacy}","received_events_url":"https://api.github.com/users/thc202/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"thc202","id":4639210,"node_id":"MDQ6VXNlcjQ2MzkyMTA=","avatar_url":"https://avatars.githubusercontent.com/u/4639210?v=4","gravatar_id":"","url":"https://api.github.com/users/thc202","html_url":"https://github.com/thc202","followers_url":"https://api.github.com/users/thc202/followers","following_url":"https://api.github.com/users/thc202/following{/other_user}","gists_url":"https://api.github.com/users/thc202/gists{/gist_id}","starred_url":"https://api.github.com/users/thc202/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/thc202/subscriptions","organizations_url":"https://api.github.com/users/thc202/orgs","repos_url":"https://api.github.com/users/thc202/repos","events_url":"https://api.github.com/users/thc202/events{/privacy}","received_events_url":"https://api.github.com/users/thc202/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/zaproxy/zaproxy/milestones/6","html_url":"https://github.com/zaproxy/zaproxy/milestone/6","labels_url":"https://api.github.com/repos/zaproxy/zaproxy/milestones/6/labels","id":4805929,"node_id":"MDk6TWlsZXN0b25lNDgwNTkyOQ==","number":6,"title":"2.10.0","description":"","creator":{"login":"psiinon","id":1081115,"node_id":"MDQ6VXNlcjEwODExMTU=","avatar_url":"https://avatars.githubusercontent.com/u/1081115?v=4","gravatar_id":"","url":"https://api.github.com/users/psiinon","html_url":"https://github.com/psiinon","followers_url":"https://api.github.com/users/psiinon/followers","following_url":"https://api.github.com/users/psiinon/following{/other_user}","gists_url":"https://api.github.com/users/psiinon/gists{/gist_id}","starred_url":"https://api.github.com/users/psiinon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/psiinon/subscriptions","organizations_url":"https://api.github.com/users/psiinon/orgs","repos_url":"https://api.github.com/users/psiinon/repos","events_url":"https://api.github.com/users/psiinon/events{/privacy}","received_events_url":"https://api.github.com/users/psiinon/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":62,"state":"closed","created_at":"2019-11-01T17:40:02Z","updated_at":"2020-12-18T14:30:28Z","due_on":null,"closed_at":"2020-12-18T14:30:28Z"},"comments":13,"created_at":"2020-08-23T07:46:11Z","updated_at":"2021-07-12T11:01:08Z","closed_at":"2020-08-25T15:56:21Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Describe the bug**\r\nHigh CPU usage 25% (1 full core) is observed after ZAP starts and proxies a WebSocket request from Firefox.\r\nWith passive scan configured to scan only in-scope objects, and none domains added to scope, after fuzzer scan finishes, 50% constant CPU usage is observed.\r\nAfter a while, CPU utilization rises to 75% (3 full cores out of 4)\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Start ZAP \r\n2. Configure Passive scanner to scan only in-scope objects\r\n3. Close ZAP\r\n4. Restart ZAP\r\n5. Open Firefox\r\n6. Observe Firefox calls a WebSocket and gets response\r\n7. Check ZAP CPU utilization\r\n8. Fuzz some site with 2000 payloads\r\n9. After fuzzing finishes, check CPU utilization\r\n10. Wait 10 minutes.\r\n11. Check CPU utilization\r\n\r\n**Expected behavior**\r\nZAP when there is no active|passive jobs to do shouldn't utilize full cores of CPU.\r\n\r\n**Screenshots**\r\n![Taskmgr-2020-08-23-10-37-44](https://user-images.githubusercontent.com/29713984/90973654-c387cc80-e52c-11ea-85f2-e89a6fee32ff.png)\r\n\r\n\r\n**Software versions**\r\n - ZAP 2.9.0 Release, ZAP_WEEKLY_D-2020-06-15, w2020-08-17\r\n - OS: Windows 10 x64 2004\r\n - Java: Oracle JRE 1.8.0_251 both x32 x64\r\n - Browser: Firefox 79 x64\r\n\r\n**Errors from the zap.log file**\r\nNo errors in log, but uploading it for the purpose of identifying the running plugins\r\n[log.txt](https://github.com/zaproxy/zaproxy/files/5113656/log.txt)\r\n\r\nHere are 5 dump traces for 25% CPU Ut., 5 other for 50% and 5 for 75%.\r\n[traces.txt](https://github.com/zaproxy/zaproxy/files/5113657/traces.txt)\r\n\r\n**Additional context**\r\nOccures on 3 different 2.9.0 builds including latest weekly.\r\nFurther testing showed that this doesn't occur with freshly installed ZAP with fresh configuration. I will add further info if I find the problematic plugin/configuration.\r\n\r\n**Would you like to help fix this issue?**\r\nYes.","closed_by":{"login":"kingthorin","id":7570458,"node_id":"MDQ6VXNlcjc1NzA0NTg=","avatar_url":"https://avatars.githubusercontent.com/u/7570458?v=4","gravatar_id":"","url":"https://api.github.com/users/kingthorin","html_url":"https://github.com/kingthorin","followers_url":"https://api.github.com/users/kingthorin/followers","following_url":"https://api.github.com/users/kingthorin/following{/other_user}","gists_url":"https://api.github.com/users/kingthorin/gists{/gist_id}","starred_url":"https://api.github.com/users/kingthorin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kingthorin/subscriptions","organizations_url":"https://api.github.com/users/kingthorin/orgs","repos_url":"https://api.github.com/users/kingthorin/repos","events_url":"https://api.github.com/users/kingthorin/events{/privacy}","received_events_url":"https://api.github.com/users/kingthorin/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/zaproxy/zaproxy/issues/6138/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/zaproxy/zaproxy/issues/6138/timeline","performed_via_github_app":null,"state_reason":"completed"}