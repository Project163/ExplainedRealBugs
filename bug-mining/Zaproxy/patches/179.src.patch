diff --git a/.classpath b/.classpath
index d11775167..98e222dca 100644
--- a/.classpath
+++ b/.classpath
@@ -47,5 +47,6 @@
 	<classpathentry kind="lib" path="lib/commons-codec-1.9.jar"/>
 	<classpathentry kind="lib" path="lib/commons-logging-1.2.jar"/>
 	<classpathentry kind="lib" path="lib/httpcore-4.4.1.jar"/>
+	<classpathentry kind="lib" path="lib/ice4j-1.0.jar"/>
 	<classpathentry kind="output" path="bin"/>
 </classpath>
diff --git a/LEGALNOTICE.md b/LEGALNOTICE.md
index 7bfbf300a..df91c3de3 100644
--- a/LEGALNOTICE.md
+++ b/LEGALNOTICE.md
@@ -54,6 +54,7 @@ and subject to their respective licenses.
 | hsqldb.jar                    | BSD                       |
 | httpclient-4.5.jar            | Apache 2.0                |
 | httpcore-4.4.1.jar            | Apache 2.0                |
+| ice4j-1.0.jar                 | Apache 2.0                |
 | java-semver-0.8.0.jar         | MIT                       |
 | jcommon-1.0.23.jar            | LGPL                      |
 | jdom.jar                      | BSD                       |
diff --git a/lib/ice4j-1.0.jar b/lib/ice4j-1.0.jar
new file mode 100644
index 000000000..f899c283c
Binary files /dev/null and b/lib/ice4j-1.0.jar differ
diff --git a/src/lang/Messages.properties b/src/lang/Messages.properties
index f96393a2b..ef059a986 100644
--- a/src/lang/Messages.properties
+++ b/src/lang/Messages.properties
@@ -1642,6 +1642,7 @@ options.lang.label.restart                        = <html><body><p>Changes to th
 options.lang.selector.label                       = Language:
 options.lang.title                                = Language
 options.proxy.local.label.alwaysDecodeGzip = Always unzip gzipped content
+options.proxy.local.label.behindnat = Behind NAT
 options.proxy.local.label.browser     = <html><body><br><p>Set your browser proxy setting using the above.  The HTTP port and HTTPS port must be the same port as above.</p></body></html>
 options.proxy.local.label.local       = Local Proxy
 options.proxy.local.label.misc        = Miscellaneous
@@ -1657,6 +1658,7 @@ options.proxy.local.title             = Local Proxy
 options.proxy.local.tooltip.alwaysDecodeGzip = <html>Always automatically unzip gzipped content. This option is needed for applications that ignore the modified \"Accept-Encoding\" header<br>\
 This option should be always enabled unless the decoding breaks the application being tested.<br>\
 The messages encoded will not be correctly scanned (either by passive and active scanners).</html>
+options.proxy.local.tooltip.behindnat = <html>Indicates that the Local Proxy (ZAP) is behind NAT.<br>When selected ZAP will attempt to determine the public IP address,<br>to properly detect and handle requests with the public IP address.<br>Refer to the help page for more details.</html>
 options.proxy.local.tooltip.removeUnsupportedEncodings = <html>Allows the Local Proxy to remove unsupported encodings from the \"Accept-Encoding\" request-header field, <br>\
 so no (unsupported) encoding transformations are done to the response.<br>\
 This option should be always enabled unless when testing the encoding transformations.<br>\
diff --git a/src/org/parosproxy/paros/core/proxy/ProxyParam.java b/src/org/parosproxy/paros/core/proxy/ProxyParam.java
index 3e81c8eb1..32166f340 100644
--- a/src/org/parosproxy/paros/core/proxy/ProxyParam.java
+++ b/src/org/parosproxy/paros/core/proxy/ProxyParam.java
@@ -31,6 +31,7 @@
 // ZAP: 2014/03/23 Issue 1017: Proxy set to 0.0.0.0 causes incorrect PAC file to be generated
 // ZAP: 2015/11/04 Issue 1920: Report the host:port ZAP is listening on in daemon mode, or exit if it cant
 // ZAP: 2016/06/13 Change option "Accept-Encoding" request-header to Remove Unsupported Encodings
+// ZAP: 2017/03/26 Allow to configure if the proxy is behind NAT.
 
 package org.parosproxy.paros.core.proxy;
 
@@ -39,6 +40,7 @@ import java.net.UnknownHostException;
 import java.util.Arrays;
 import java.util.List;
 
+import org.apache.commons.configuration.ConversionException;
 import org.apache.commons.configuration.HierarchicalConfiguration;
 import org.apache.log4j.Logger;
 import org.parosproxy.paros.common.AbstractParam;
@@ -65,6 +67,10 @@ public class ProxyParam extends AbstractParam {
     private static final String REVERSE_PROXY_HTTP_PORT = "proxy.reverseProxy.httpPort";
     private static final String REVERSE_PROXY_HTTPS_PORT = "proxy.reverseProxy.httpsPort";
 
+    /**
+     * The configuration key to save/load the option {@link #behindNat}.
+     */
+    private static final String PROXY_BEHIND_NAT = PROXY_BASE_KEY + ".behindnat";
 
     private static final String SECURITY_PROTOCOLS_ENABLED = PROXY_BASE_KEY + ".securityProtocolsEnabled";
     private static final String ALL_SECURITY_PROTOCOLS_ENABLED_KEY = SECURITY_PROTOCOLS_ENABLED + ".protocol";
@@ -110,6 +116,13 @@ public class ProxyParam extends AbstractParam {
      */
     private boolean alwaysDecodeGzip = true;
 
+    /**
+     * Flag that controls whether or not the local proxy is behind NAT.
+     * <p>
+     * Default is {@code false}.
+     */
+    private boolean behindNat;
+
     private String[] securityProtocolsEnabled;
 
     public ProxyParam() {
@@ -149,6 +162,12 @@ public class ProxyParam extends AbstractParam {
         alwaysDecodeGzip = getConfig().getBoolean(ALWAYS_DECODE_GZIP, true);
 
         loadSecurityProtocolsEnabled();
+
+        try {
+            behindNat = getConfig().getBoolean(PROXY_BEHIND_NAT, false);
+        } catch (ConversionException e) {
+            logger.error("Failed to read '" + PROXY_BEHIND_NAT + "'", e);
+        }
     }
 
     public String getProxyIp() {
@@ -403,4 +422,23 @@ public class ProxyParam extends AbstractParam {
             proxyIpAnyLocalAddress = false;
         }
     }
+
+    /**
+     * Tells whether or not the proxy is behind NAT.
+     *
+     * @return {@code true} if the proxy is behind NAT, {@code false} otherwise.
+     */
+    public boolean isBehindNat() {
+        return behindNat;
+    }
+
+    /**
+     * Sets whether or not the proxy is behind NAT.
+     *
+     * @param behindNat {@code true} if the proxy is behind NAT, {@code false} otherwise.
+     */
+    public void setBehindNat(boolean behindNat) {
+        this.behindNat = behindNat;
+        getConfig().setProperty(PROXY_BEHIND_NAT, Boolean.valueOf(behindNat));
+    }
 }
diff --git a/src/org/parosproxy/paros/core/proxy/ProxyThread.java b/src/org/parosproxy/paros/core/proxy/ProxyThread.java
index d7a742b00..2eb2a36ed 100644
--- a/src/org/parosproxy/paros/core/proxy/ProxyThread.java
+++ b/src/org/parosproxy/paros/core/proxy/ProxyThread.java
@@ -70,6 +70,7 @@
 // ZAP: 2017/02/20 Issue 2699: Make SSLException handling more user friendly
 // ZAP: 2017/02/23  Issue 3227: Limit API access to whitelisted IP addresses
 // ZAP: 2017/03/15 Disable API by default
+// ZAP: 2017/03/26 Check the public address when behind NAT.
 
 package org.parosproxy.paros.core.proxy;
 
@@ -84,6 +85,7 @@ import java.net.Socket;
 import java.net.SocketException;
 import java.net.SocketTimeoutException;
 import java.nio.charset.StandardCharsets;
+import java.util.Arrays;
 import java.util.List;
 import java.util.Vector;
 import java.util.regex.Pattern;
@@ -96,6 +98,8 @@ import javax.net.ssl.SSLException;
 import org.apache.commons.httpclient.HttpException;
 import org.apache.commons.lang.exception.ExceptionUtils;
 import org.apache.log4j.Logger;
+import org.ice4j.TransportAddress;
+import org.ice4j.ice.harvest.AwsCandidateHarvester;
 import org.parosproxy.paros.Constant;
 import org.parosproxy.paros.db.RecordHistory;
 import org.parosproxy.paros.model.Model;
@@ -149,6 +153,16 @@ public class ProxyThread implements Runnable {
 	private static int id = 1;
     
     private static Vector<Thread> proxyThreadList = new Vector<>();
+
+    /**
+     * Used to obtain the public address of AWS EC2 instance.
+     * <p>
+     * Lazily initialised.
+     * 
+     * @see #getAwsCandidateHarvester()
+     * @see #isOwnPublicAddress(InetAddress)
+     */
+    private static AwsCandidateHarvester awsCandidateHarvester;
     
 	protected ProxyThread(ProxyServer server, Socket socket) {
 		this(server, socket, null);
@@ -759,7 +773,7 @@ public class ProxyThread implements Runnable {
      */
     private boolean isProxyAddress(InetAddress address) {
         if (parentServer.getProxyParam().isProxyIpAnyLocalAddress()) {
-            if (isLocalAddress(address) || isNetworkInterfaceAddress(address)) {
+            if (isLocalAddress(address) || isNetworkInterfaceAddress(address) || isOwnPublicAddress(address)) {
                 return true;
             }
         } else if (address.equals(inSocket.getLocalAddress())) {
@@ -798,6 +812,45 @@ public class ProxyThread implements Runnable {
         }
         return false;
     }
+
+    /**
+     * Tells whether or not the given {@code address} is a public address of the host, when behind NAT.
+     * <p>
+     * Returns {@code false} if the proxy is not behind NAT.
+     * <p>
+     * <strong>Implementation Note:</strong> Only AWS EC2 NAT detection is supported, by requesting the public IP address from
+     * <a href= "https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-instance-addressing.html#working-with-ip-addresses">
+     * AWS EC2 instance's metadata</a>.
+     * 
+     * @param address the address that will be checked
+     * @return {@code true} if the address is public address of the host, {@code false} otherwise.
+     * @see ProxyParam#isBehindNat()
+     */
+    private boolean isOwnPublicAddress(InetAddress address) {
+        if (!proxyParam.isBehindNat()) {
+            return false;
+        }
+
+        // Support just AWS for now.
+        TransportAddress publicAddress = getAwsCandidateHarvester().getMask();
+        if (publicAddress == null) {
+            return false;
+        }
+        return Arrays.equals(address.getAddress(), publicAddress.getAddress().getAddress());
+    }
+
+    private static AwsCandidateHarvester getAwsCandidateHarvester() {
+        if (awsCandidateHarvester == null) {
+            createAwsCandidateHarvester();
+        }
+        return awsCandidateHarvester;
+    }
+
+    private static synchronized void createAwsCandidateHarvester() {
+        if (awsCandidateHarvester == null) {
+            awsCandidateHarvester = new AwsCandidateHarvester();
+        }
+    }
     
     private void removeUnsupportedEncodings(HttpMessage msg) {
         String encoding = msg.getRequestHeader().getHeader(HttpHeader.ACCEPT_ENCODING);
diff --git a/src/org/parosproxy/paros/extension/option/OptionsLocalProxyPanel.java b/src/org/parosproxy/paros/extension/option/OptionsLocalProxyPanel.java
index cdfc8f4d6..5eabacfce 100644
--- a/src/org/parosproxy/paros/extension/option/OptionsLocalProxyPanel.java
+++ b/src/org/parosproxy/paros/extension/option/OptionsLocalProxyPanel.java
@@ -29,6 +29,7 @@
 // ZAP: 2015/02/10 Issue 1528: Support user defined font size
 // ZAP: 2016/06/13 Change option "Modify/Remove Accept-Encoding" to "Remove Unsupported Encodings"
 // ZAP: 2016/06/13 Internationalise string and remove unused instance variable
+// ZAP: 2017/03/26 Allow to set the Local Proxy behind NAT.
 
 package org.parosproxy.paros.extension.option;
 
@@ -49,7 +50,6 @@ import org.parosproxy.paros.view.AbstractParamPanel;
 import org.zaproxy.zap.utils.FontUtils;
 import org.zaproxy.zap.utils.ZapPortNumberSpinner;
 import org.zaproxy.zap.utils.ZapTextField;
-import org.zaproxy.zap.view.LayoutHelper;
 
 public class OptionsLocalProxyPanel extends AbstractParamPanel {
 
@@ -62,6 +62,7 @@ public class OptionsLocalProxyPanel extends AbstractParamPanel {
     private ZapTextField txtProxyIp = null;
     private ZapTextField txtReverseProxyIp = null;
 
+    private JCheckBox chkBehindNat;
     private JCheckBox chkRemoveUnsupportedEncodings = null;
     private JCheckBox chkAlwaysDecodeGzip = null;
 
@@ -166,12 +167,11 @@ public class OptionsLocalProxyPanel extends AbstractParamPanel {
             gbc.weightx = 1.0D;
             gbc.gridwidth = java.awt.GridBagConstraints.REMAINDER;
             gbc.anchor = java.awt.GridBagConstraints.PAGE_START;
+            panelLocalProxy.add(getChkBehindNat(), gbc);
             panelLocalProxy.add(getChkRemoveUnsupportedEncodings(), gbc);
 
             // TODO hacking
-            panelLocalProxy.add(this.getChkAlwaysDecodeGzip(), 
-            		LayoutHelper.getGBC(0, 6, 1, 1.0D, 0.0D, GridBagConstraints.HORIZONTAL, 
-            				GridBagConstraints.PAGE_START, new java.awt.Insets(2, 2, 2, 2)));
+            panelLocalProxy.add(this.getChkAlwaysDecodeGzip(), gbc);
 
         }
         
@@ -405,6 +405,14 @@ public class OptionsLocalProxyPanel extends AbstractParamPanel {
         return txtReverseProxyIp;
     }
 
+    private JCheckBox getChkBehindNat() {
+        if (chkBehindNat == null) {
+            chkBehindNat = new JCheckBox(Constant.messages.getString("options.proxy.local.label.behindnat"));
+            chkBehindNat.setToolTipText(Constant.messages.getString("options.proxy.local.tooltip.behindnat"));
+        }
+        return chkBehindNat;
+    }
+
     public JCheckBox getChkRemoveUnsupportedEncodings() {
         if (chkRemoveUnsupportedEncodings == null) {
             chkRemoveUnsupportedEncodings = new JCheckBox(Constant.messages.getString("options.proxy.local.label.removeUnsupportedEncodings"));
@@ -480,6 +488,7 @@ public class OptionsLocalProxyPanel extends AbstractParamPanel {
         // ZAP: Do not allow invalid port numbers
         spinnerProxyPort.setValue(proxyParam.getProxyPort());
 
+        chkBehindNat.setSelected(proxyParam.isBehindNat());
         chkRemoveUnsupportedEncodings.setSelected(proxyParam.isRemoveUnsupportedEncodings());
         chkAlwaysDecodeGzip.setSelected(proxyParam.isAlwaysDecodeGzip());
 
@@ -511,6 +520,7 @@ public class OptionsLocalProxyPanel extends AbstractParamPanel {
         // ZAP: Do not allow invalid port numbers
         proxyParam.setProxyPort(spinnerProxyPort.getValue());
 
+        proxyParam.setBehindNat(getChkBehindNat().isSelected());
         proxyParam.setRemoveUnsupportedEncodings(getChkRemoveUnsupportedEncodings().isSelected());
         // TODO hacking
         proxyParam.setAlwaysDecodeGzip(getChkAlwaysDecodeGzip().isSelected());
