diff --git a/src/org/zaproxy/zap/extension/api/CoreAPI.java b/src/org/zaproxy/zap/extension/api/CoreAPI.java
index ed4ca7474..330279f7b 100644
--- a/src/org/zaproxy/zap/extension/api/CoreAPI.java
+++ b/src/org/zaproxy/zap/extension/api/CoreAPI.java
@@ -1285,7 +1285,7 @@ public class CoreAPI extends ApiImplementor implements SessionListener {
 				final HarEntries entries = new HarEntries();
 				TableHistory tableHistory = Model.getSingleton().getDb().getTableHistory();
 				RecordHistory recordHistory = getRecordHistory(tableHistory, getParam(params, PARAM_ID, -1));
-				entries.addEntry(HarUtils.createHarEntry(recordHistory.getHttpMessage()));
+				addHarEntry(entries, recordHistory);
 
 				HarLog harLog = HarUtils.createZapHarLog();
 				harLog.setEntries(entries);
@@ -1316,20 +1316,14 @@ public class CoreAPI extends ApiImplementor implements SessionListener {
 					TableHistory tableHistory = Model.getSingleton().getDb().getTableHistory();
 					for (Integer id : getIds(params)) {
 						RecordHistory recordHistory = getRecordHistory(tableHistory, id);
-						entries.addEntry(HarUtils.createHarEntry(recordHistory.getHttpMessage()));
+						addHarEntry(entries, recordHistory);
 					}
 				} else {
 					processHttpMessages(
 							this.getParam(params, PARAM_BASE_URL, (String) null),
 							this.getParam(params, PARAM_START, -1),
 							this.getParam(params, PARAM_COUNT, -1),
-							new Processor<RecordHistory>() {
-
-								@Override
-								public void process(RecordHistory recordHistory) {
-									entries.addEntry(HarUtils.createHarEntry(recordHistory.getHttpMessage()));
-								}
-							});
+							rh -> addHarEntry(entries, rh));
 				}
 
 				HarLog harLog = HarUtils.createZapHarLog();
@@ -1371,12 +1365,9 @@ public class CoreAPI extends ApiImplementor implements SessionListener {
 					boolean followRedirects = getParam(params, PARAM_FOLLOW_REDIRECTS, false);
 					try {
 						final HarEntries entries = new HarEntries();
-						sendRequest(request, followRedirects, new Processor<HttpMessage>() {
-
-							@Override
-							public void process(HttpMessage msg) {
-								entries.addEntry(HarUtils.createHarEntry(msg));
-							}
+						sendRequest(request, followRedirects, httpMessage -> {
+							HistoryReference hRef = httpMessage.getHistoryRef();
+							entries.addEntry(HarUtils.createHarEntry(hRef.getHistoryId(), hRef.getHistoryType(), httpMessage));
 						});
 
 						HarLog harLog = HarUtils.createZapHarLog();
@@ -1435,6 +1426,21 @@ public class CoreAPI extends ApiImplementor implements SessionListener {
 		return listIds;
 	}
 
+	/**
+	 * Adds the given history record to the given {@code entries}.
+	 *
+	 * @param entries where to add the new {@code HarEntry}.
+	 * @param recordHistory the history record to add, after converting to {@code HarEntry}.
+	 * @see HarUtils#createHarEntry(int, int, HttpMessage)
+	 */
+	private static void addHarEntry(HarEntries entries, RecordHistory recordHistory) {
+		entries.addEntry(
+				HarUtils.createHarEntry(
+						recordHistory.getHistoryId(),
+						recordHistory.getHistoryType(),
+						recordHistory.getHttpMessage()));
+	}
+
 	private boolean incErrorDetails() {
 		return Model.getSingleton().getOptionsParam().getApiParam().isIncErrorDetails();
 	}
diff --git a/src/org/zaproxy/zap/extension/search/SearchAPI.java b/src/org/zaproxy/zap/extension/search/SearchAPI.java
index c40efd7bc..193c706ff 100644
--- a/src/org/zaproxy/zap/extension/search/SearchAPI.java
+++ b/src/org/zaproxy/zap/extension/search/SearchAPI.java
@@ -46,6 +46,7 @@ import org.zaproxy.zap.extension.api.ApiView;
 import org.zaproxy.zap.utils.HarUtils;
 
 import edu.umass.cs.benchlab.har.HarEntries;
+import edu.umass.cs.benchlab.har.HarEntry;
 import edu.umass.cs.benchlab.har.HarLog;
 
 public class SearchAPI extends ApiImplementor {
@@ -232,12 +233,9 @@ public class SearchAPI extends ApiImplementor {
 
 		try {
 			final HarEntries entries = new HarEntries();
-			search(params, searchType, new SearchResultsProcessor() {
-
-				@Override
-				public void processRecordHistory(RecordHistory recordHistory) {
-					entries.addEntry(HarUtils.createHarEntry(recordHistory.getHttpMessage()));
-				}
+			search(params, searchType, rh -> {
+				HarEntry entry = HarUtils.createHarEntry(rh.getHistoryId(), rh.getHistoryType(), rh.getHttpMessage());
+				entries.addEntry(entry);
 			});
 
 			HarLog harLog = HarUtils.createZapHarLog();
diff --git a/src/org/zaproxy/zap/utils/HarUtils.java b/src/org/zaproxy/zap/utils/HarUtils.java
index f6c03d4f4..463c3a05a 100644
--- a/src/org/zaproxy/zap/utils/HarUtils.java
+++ b/src/org/zaproxy/zap/utils/HarUtils.java
@@ -46,6 +46,7 @@ import edu.umass.cs.benchlab.har.HarContent;
 import edu.umass.cs.benchlab.har.HarCookie;
 import edu.umass.cs.benchlab.har.HarCookies;
 import edu.umass.cs.benchlab.har.HarCreator;
+import edu.umass.cs.benchlab.har.HarCustomFields;
 import edu.umass.cs.benchlab.har.HarEntry;
 import edu.umass.cs.benchlab.har.HarEntryTimings;
 import edu.umass.cs.benchlab.har.HarHeader;
@@ -72,6 +73,34 @@ public final class HarUtils {
 
     private static final Logger LOGGER = Logger.getLogger(HarUtils.class);
 
+    /**
+     * The prefix for custom HAR fields produced by ZAP.
+     * 
+     * @since TODO add version
+     */
+    public static final String CUSTOM_FIELD_PREFIX = "_zap";
+
+    /**
+     * The name of the custom field that contains the message ID.
+     * 
+     * @since TODO add version
+     */
+    public static final String MESSAGE_ID_CUSTOM_FIELD = CUSTOM_FIELD_PREFIX + "MessageId";
+
+    /**
+     * The name of the custom field that contains the message type.
+     * 
+     * @since TODO add version
+     */
+    public static final String MESSAGE_TYPE_CUSTOM_FIELD = CUSTOM_FIELD_PREFIX + "MessageType";
+
+    /**
+     * The name of the custom field that contains the message note.
+     * 
+     * @since TODO add version
+     */
+    public static final String MESSAGE_NOTE_CUSTOM_FIELD = CUSTOM_FIELD_PREFIX + "MessageNote";
+
     private HarUtils() {
     }
 
@@ -137,6 +166,14 @@ public final class HarUtils {
                 strBuilderReqBody.toString()));
     }
 
+    /**
+     * Creates a {@code HarEntry} from the given message.
+     *
+     * @param httpMessage the HTTP message.
+     * @return the {@code HarEntry}, never {@code null}.
+     * @see #createHarEntry(int, int, HttpMessage)
+     * @see #createMessageHarCustomFields(int, int, String)
+     */
     public static HarEntry createHarEntry(HttpMessage httpMessage) {
         HarEntryTimings timings = new HarEntryTimings(0, 0, httpMessage.getTimeElapsedMillis());
 
@@ -149,6 +186,40 @@ public final class HarUtils {
                 timings);
     }
 
+    /**
+     * Creates a {@code HarEntry} from the given message with additional custom fields for the history ID/type and note.
+     * 
+     * @param historyId the history ID of the HTTP message.
+     * @param historyType the history type of the HTTP message.
+     * @param httpMessage the HTTP message.
+     * @return the {@code HarEntry}, never {@code null}.
+     * @since TODO add version
+     * @see #createMessageHarCustomFields(int, int, String)
+     */
+    public static HarEntry createHarEntry(int historyId, int historyType, HttpMessage httpMessage) {
+        HarEntry entry = createHarEntry(httpMessage);
+        entry.setCustomFields(createMessageHarCustomFields(historyId, historyType, httpMessage.getNote()));
+        return entry;
+    }
+
+    /**
+     * Creates custom fields for the given data.
+     *
+     * @param historyId the history ID of the HTTP message.
+     * @param historyType the history type of the HTTP message.
+     * @param messageNote the note of the HTTP message.
+     * @return the {@code HarCustomFields}, never {@code null}.
+     * @since TODO add version
+     * @see #createHarEntry(int, int, HttpMessage)
+     */
+    public static HarCustomFields createMessageHarCustomFields(int historyId, int historyType, String messageNote) {
+        HarCustomFields customFields = new HarCustomFields();
+        customFields.addCustomField(MESSAGE_ID_CUSTOM_FIELD, Integer.toString(historyId));
+        customFields.addCustomField(MESSAGE_TYPE_CUSTOM_FIELD, Integer.toString(historyType));
+        customFields.addCustomField(MESSAGE_NOTE_CUSTOM_FIELD, messageNote);
+        return customFields;
+    }
+
     public static HarRequest createHarRequest(HttpMessage httpMessage) {
         HttpRequestHeader requestHeader = httpMessage.getRequestHeader();
 
