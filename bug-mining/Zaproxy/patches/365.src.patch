diff --git a/.github/workflows/release-main-version.yml b/.github/workflows/release-main-version.yml
index b420b22b2..d2c6aa7d1 100644
--- a/.github/workflows/release-main-version.yml
+++ b/.github/workflows/release-main-version.yml
@@ -12,10 +12,10 @@ jobs:
     runs-on: ubuntu-latest
     steps:
     - uses: actions/checkout@v2
-    - name: Setup Java 8
+    - name: Setup Java
       uses: actions/setup-java@v1
       with:
-        java-version: 8
+        java-version: 11
     - name: Build and Release
       env:
         GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
diff --git a/.github/workflows/release-weekly.yml b/.github/workflows/release-weekly.yml
index 445dd5480..b24a3b163 100644
--- a/.github/workflows/release-weekly.yml
+++ b/.github/workflows/release-weekly.yml
@@ -12,10 +12,10 @@ jobs:
     runs-on: ubuntu-latest
     steps:
     - uses: actions/checkout@v2
-    - name: Setup Java 8
+    - name: Setup Java
       uses: actions/setup-java@v1
       with:
-        java-version: 8
+        java-version: 11
     - name: Build and Release
       env:
         GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
diff --git a/build.gradle.kts b/build.gradle.kts
index f6de24751..d6d7afb3e 100644
--- a/build.gradle.kts
+++ b/build.gradle.kts
@@ -1,5 +1,5 @@
 plugins {
-    id("com.diffplug.gradle.spotless")
+    id("com.diffplug.spotless")
     id("org.sonarqube") version "3.1.1"
     id("com.github.ben-manes.versions") version "0.38.0"
 }
@@ -7,7 +7,7 @@ plugins {
 apply(from = "$rootDir/gradle/ci.gradle.kts")
 
 allprojects {
-    apply(plugin = "com.diffplug.gradle.spotless")
+    apply(plugin = "com.diffplug.spotless")
 
     repositories {
         mavenCentral()
@@ -17,7 +17,7 @@ allprojects {
         project.plugins.withType(JavaPlugin::class) {
             java {
                 licenseHeaderFile("$rootDir/gradle/spotless/license.java")
-                googleJavaFormat().aosp()
+                googleJavaFormat("1.7").aosp()
             }
         }
 
diff --git a/buildSrc/build.gradle.kts b/buildSrc/build.gradle.kts
index b33de87b4..778fb0554 100644
--- a/buildSrc/build.gradle.kts
+++ b/buildSrc/build.gradle.kts
@@ -1,6 +1,6 @@
 plugins {
     `kotlin-dsl`
-    id("com.diffplug.gradle.spotless") version "3.28.1"
+    id("com.diffplug.spotless") version "5.12.1"
 }
 
 repositories {
@@ -11,7 +11,7 @@ repositories {
 spotless {
     java {
         licenseHeaderFile(file("../gradle/spotless/license.java"))
-        googleJavaFormat().aosp()
+        googleJavaFormat("1.7").aosp()
     }
 
     kotlinGradle {
@@ -28,10 +28,14 @@ dependencies {
     implementation("org.eclipse.jgit:org.eclipse.jgit.archive:$jgitVersion")
     implementation("org.kohsuke:github-api:1.95")
     // Gradle Plugins
-    implementation("com.diffplug.spotless:spotless-plugin-gradle:3.28.1")
-    implementation("com.netflix.nebula:gradle-ospackage-plugin:8.2.0")
-    implementation("de.undercouch:gradle-download-task:3.4.3")
-    implementation("edu.sc.seis.launch4j:launch4j:2.4.6")
-    implementation("gradle.plugin.install4j.install4j:gradle_plugin:8.0.7")
+    implementation("com.diffplug.spotless:spotless-plugin-gradle:5.12.1")
+    implementation("com.netflix.nebula:gradle-ospackage-plugin:8.5.6")
+    implementation("de.undercouch:gradle-download-task:4.1.1")
+    implementation("edu.sc.seis.launch4j:launch4j:2.5.0")
+    if (JavaVersion.current() != JavaVersion.VERSION_1_8)
+        implementation("gradle.plugin.install4j.install4j.buildtools:gradle_publish:9.0.2")
+    else
+        // Just for compilation, not actually used (installers task is replaced).
+        implementation("gradle.plugin.install4j.install4j:gradle_plugin:8.0.11")
     implementation("me.champeau.gradle:japicmp-gradle-plugin:0.2.9")
 }
diff --git a/buildSrc/src/main/kotlin/org/zaproxy/zap/distributions.gradle.kts b/buildSrc/src/main/kotlin/org/zaproxy/zap/distributions.gradle.kts
index 8b7bddbed..d58707510 100644
--- a/buildSrc/src/main/kotlin/org/zaproxy/zap/distributions.gradle.kts
+++ b/buildSrc/src/main/kotlin/org/zaproxy/zap/distributions.gradle.kts
@@ -157,7 +157,8 @@ val macOsJreFile = File(macOsJreDir, "jdk$macOsJreVersion-jre.tar.gz")
 val downloadMacOsJre by tasks.registering(Download::class) {
     src("https://api.adoptopenjdk.net/v2/binary/releases/openjdk8?openjdk_impl=hotspot&os=mac&arch=x64&type=jre&release=jdk$macOsJreVersion")
     dest(macOsJreFile)
-    timeout(60_000)
+    connectTimeout(60_000)
+    readTimeout(60_000)
     onlyIfModified(true)
     doFirst {
         require (Os.isFamily(Os.FAMILY_MAC)) {
diff --git a/buildSrc/src/main/kotlin/org/zaproxy/zap/installers.gradle.kts b/buildSrc/src/main/kotlin/org/zaproxy/zap/installers.gradle.kts
index 15f030f35..642f848be 100644
--- a/buildSrc/src/main/kotlin/org/zaproxy/zap/installers.gradle.kts
+++ b/buildSrc/src/main/kotlin/org/zaproxy/zap/installers.gradle.kts
@@ -3,6 +3,7 @@ package org.zaproxy.zap
 import com.install4j.gradle.Install4jTask
 import de.undercouch.gradle.tasks.download.Download
 import de.undercouch.gradle.tasks.download.Verify
+import edu.sc.seis.launch4j.tasks.Launch4jLibraryTask
 import org.apache.tools.ant.taskdefs.condition.Os
 
 plugins {
@@ -24,7 +25,7 @@ install4j {
 
 launch4j {
     libraryDir = ""
-    copyConfigurable = project.copySpec{}
+    copyConfigurable = listOf<String>()
 
     mainClassName = "org.zaproxy.zap.ZAP"
 
@@ -75,23 +76,25 @@ val prepareLinuxInstallerData by tasks.registering(Sync::class) {
     from(file("src/main/resources/resource/zap1024x1024.png"))
 }
 
-val createExe by tasks.existing
+val createExe by tasks.existing(Launch4jLibraryTask::class) {
+    mustRunAfter("distFiles")
+}
+val zapExe = createExe.map { it.dest }
 
 val prepareWin32InstallerData by tasks.registering(Sync::class) {
     destinationDir = File(installerDataDir, "win32")
-    from(createExe)
+    from(zapExe)
     from(bundledAddOns) {
         into("plugin")
         exclude(listOf(
                 "*linux*.zap",
-                "*macos*.zap",
-                "jxbrowser*.zap"))
+                "*macos*.zap"))
     }
 }
 
 val prepareWin64InstallerData by tasks.registering(Sync::class) {
     destinationDir = File(installerDataDir, "win64")
-    from(createExe)
+    from(zapExe)
     from(bundledAddOns) {
         into("plugin")
         exclude(listOf(
@@ -100,64 +103,77 @@ val prepareWin64InstallerData by tasks.registering(Sync::class) {
     }
 }
 
-val installers by tasks.registering(Install4jTask::class) {
-    group = "Distribution"
-    description = "Creates the Linux and Windows installers."
-    dependsOn(
-            prepareCommonInstallerData,
-            prepareLinuxInstallerData,
-            prepareWin32InstallerData,
-            prepareWin64InstallerData)
-
-    projectFile = file("src/main/installer/zap.install4j")
-    variables = mapOf("version" to version)
-    destination = "$buildDir/install4j"
-
-    doFirst {
-        require(install4jHomeDirValidated || install4jHomeDir != null) {
-            "The install4jHomeDir property must be set to build the installers."
-        }
-    }
-}
+if (JavaVersion.current() >= JavaVersion.VERSION_11) {
 
-if (install4jHomeDir == null && Os.isFamily(Os.FAMILY_UNIX)) {
-    val install4jVersionUnderscores = install4jVersion.replace('.', '_')
-    val install4jBinDir = file("$buildDir/install4jBin")
-    val install4jBinUnpackDir = File(install4jBinDir, "unpacked")
-    val install4jBinFile = File(install4jBinDir, "install4j.tar.gz")
-    val install4jDir = File(install4jBinUnpackDir, "install4j$install4jVersion")
-
-    val downloadInstall4jBin by tasks.registering(Download::class) {
-        src("https://download-gcdn.ej-technologies.com/install4j/install4j_unix_$install4jVersionUnderscores.tar.gz")
-        dest(install4jBinFile)
-        timeout(60_000)
-        onlyIfModified(true)
-    }
+    val installers by tasks.registering(Install4jTask::class) {
+        group = "Distribution"
+        description = "Creates the Linux and Windows installers."
+        dependsOn(
+                prepareCommonInstallerData,
+                prepareLinuxInstallerData,
+                prepareWin32InstallerData,
+                prepareWin64InstallerData)
 
-    val verifyInstall4jBin by tasks.registering(Verify::class) {
-        dependsOn(downloadInstall4jBin)
-        src(install4jBinFile)
-        algorithm("SHA-256")
-        checksum("24321604dd196ce56eba90642c37437364be75b65138acb43c82503166d4da53")
-    }
+        projectFile = file("src/main/installer/zap.install4j")
+        variables = mapOf("version" to version)
+        destination = "$buildDir/install4j"
 
-    val unpackInstall4jBin by tasks.registering(Copy::class) {
-        dependsOn(verifyInstall4jBin)
-        from(tarTree(install4jBinFile))
-        into(install4jBinUnpackDir)
         doFirst {
-            delete(install4jBinUnpackDir)
+            require(install4jHomeDirValidated || install4jHomeDir != null) {
+                "The install4jHomeDir property must be set to build the installers."
+            }
         }
     }
 
-    installers {
-        dependsOn(unpackInstall4jBin)
-    }
+    if (install4jHomeDir == null && Os.isFamily(Os.FAMILY_UNIX)) {
+        val install4jVersionUnderscores = install4jVersion.replace('.', '_')
+        val install4jBinDir = file("$buildDir/install4jBin")
+        val install4jBinUnpackDir = File(install4jBinDir, "unpacked")
+        val install4jBinFile = File(install4jBinDir, "install4j.tar.gz")
+        val install4jDir = File(install4jBinUnpackDir, "install4j$install4jVersion")
+
+        val downloadInstall4jBin by tasks.registering(Download::class) {
+            src("https://download-gcdn.ej-technologies.com/install4j/install4j_unix_$install4jVersionUnderscores.tar.gz")
+            dest(install4jBinFile)
+            connectTimeout(60_000)
+            readTimeout(60_000)
+            onlyIfModified(true)
+        }
 
-    install4j {
-        installDir = file("$install4jDir")
+        val verifyInstall4jBin by tasks.registering(Verify::class) {
+            dependsOn(downloadInstall4jBin)
+            src(install4jBinFile)
+            algorithm("SHA-256")
+            checksum("24321604dd196ce56eba90642c37437364be75b65138acb43c82503166d4da53")
+        }
+
+        val unpackInstall4jBin by tasks.registering(Copy::class) {
+            dependsOn(verifyInstall4jBin)
+            from(tarTree(install4jBinFile))
+            into(install4jBinUnpackDir)
+            doFirst {
+                delete(install4jBinUnpackDir)
+            }
+        }
+
+        installers {
+            dependsOn(unpackInstall4jBin)
+        }
+
+        install4j {
+            installDir = file("$install4jDir")
+        }
+
+        install4jHomeDirValidated = true
     }
+} else {
+    tasks.register("installers") {
+        group = "Distribution"
+        description = "Creates the Linux and Windows installers."
 
-    install4jHomeDirValidated = true
+        doFirst {
+            throw RuntimeException("The installers can only be built with Java 11+.")
+        }
+    }
 }
 
diff --git a/buildSrc/src/main/kotlin/org/zaproxy/zap/spotless.gradle.kts b/buildSrc/src/main/kotlin/org/zaproxy/zap/spotless.gradle.kts
index b04e4ed4a..8181f7353 100644
--- a/buildSrc/src/main/kotlin/org/zaproxy/zap/spotless.gradle.kts
+++ b/buildSrc/src/main/kotlin/org/zaproxy/zap/spotless.gradle.kts
@@ -1,18 +1,12 @@
 package org.zaproxy.zap
 
-import com.diffplug.spotless.generic.LicenseHeaderStep
-
 plugins {
-    com.diffplug.gradle.spotless
+    com.diffplug.spotless
 }
 
 spotless {
     format ("license", {
-        addStep(LicenseHeaderStep.createFromFile(
-            project.file("$rootDir/gradle/spotless/license.java"),
-            getEncoding(),
-            "package ",
-            LicenseHeaderStep.defaultYearDelimiter()))
+        licenseHeaderFile(project.file("$rootDir/gradle/spotless/license.java"), "package ")
 
         target(project.fileTree(project.projectDir) {
             include(listOf(
@@ -124,7 +118,7 @@ spotless {
 
     java {
         clearSteps()
-        googleJavaFormat().aosp()
+        googleJavaFormat("1.7").aosp()
 
         // Exclude forked/3rd-party/generated files.
         targetExclude(listOf(
diff --git a/buildSrc/src/main/kotlin/org/zaproxy/zap/test.gradle.kts b/buildSrc/src/main/kotlin/org/zaproxy/zap/test.gradle.kts
index b3c58bfaa..99c36e1a3 100644
--- a/buildSrc/src/main/kotlin/org/zaproxy/zap/test.gradle.kts
+++ b/buildSrc/src/main/kotlin/org/zaproxy/zap/test.gradle.kts
@@ -2,7 +2,6 @@ package org.zaproxy.zap
 
 plugins {
     `java-library`
-    eclipse
 }
 
 tasks.withType<Test>().configureEach {
@@ -34,14 +33,6 @@ fun setupTest(name: String, addToCheck: Boolean = true): TaskProvider<Test> {
         "${nameTest}RuntimeOnly" { extendsFrom(configurations["testRuntimeOnly"]) }
     }
 
-    // Workaround for https://github.com/eclipse/buildship/issues/476
-    eclipse {
-        classpath {
-            plusConfigurations.plusAssign(configurations["${nameTest}CompileClasspath"])
-            plusConfigurations.plusAssign(configurations["${nameTest}RuntimeClasspath"])
-        }
-    }
-
     val nameLowerCase = name.toLowerCase()
     val testTask = tasks.register<Test>(nameTest) {
         group = LifecycleBasePlugin.VERIFICATION_GROUP
diff --git a/gradle/wrapper/gradle-wrapper.jar b/gradle/wrapper/gradle-wrapper.jar
index 87b738cbd..e708b1c02 100644
Binary files a/gradle/wrapper/gradle-wrapper.jar and b/gradle/wrapper/gradle-wrapper.jar differ
diff --git a/gradle/wrapper/gradle-wrapper.properties b/gradle/wrapper/gradle-wrapper.properties
index ee69dd68d..9d174797f 100644
--- a/gradle/wrapper/gradle-wrapper.properties
+++ b/gradle/wrapper/gradle-wrapper.properties
@@ -1,5 +1,6 @@
 distributionBase=GRADLE_USER_HOME
 distributionPath=wrapper/dists
-distributionUrl=https\://services.gradle.org/distributions/gradle-5.4.1-all.zip
+distributionSha256Sum=81003f83b0056d20eedf48cddd4f52a9813163d4ba185bcf8abd34b8eeea4cbd
+distributionUrl=https\://services.gradle.org/distributions/gradle-7.0-all.zip
 zipStoreBase=GRADLE_USER_HOME
 zipStorePath=wrapper/dists
diff --git a/gradlew b/gradlew
index af6708ff2..4f906e0c8 100755
--- a/gradlew
+++ b/gradlew
@@ -1,5 +1,21 @@
 #!/usr/bin/env sh
 
+#
+# Copyright 2015 the original author or authors.
+#
+# Licensed under the Apache License, Version 2.0 (the "License");
+# you may not use this file except in compliance with the License.
+# You may obtain a copy of the License at
+#
+#      https://www.apache.org/licenses/LICENSE-2.0
+#
+# Unless required by applicable law or agreed to in writing, software
+# distributed under the License is distributed on an "AS IS" BASIS,
+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+# See the License for the specific language governing permissions and
+# limitations under the License.
+#
+
 ##############################################################################
 ##
 ##  Gradle start up script for UN*X
@@ -28,7 +44,7 @@ APP_NAME="Gradle"
 APP_BASE_NAME=`basename "$0"`
 
 # Add default JVM options here. You can also use JAVA_OPTS and GRADLE_OPTS to pass JVM options to this script.
-DEFAULT_JVM_OPTS='"-Xmx64m"'
+DEFAULT_JVM_OPTS='"-Xmx64m" "-Xms64m"'
 
 # Use the maximum available, or set MAX_FD != -1 to use that value.
 MAX_FD="maximum"
@@ -66,6 +82,7 @@ esac
 
 CLASSPATH=$APP_HOME/gradle/wrapper/gradle-wrapper.jar
 
+
 # Determine the Java command to use to start the JVM.
 if [ -n "$JAVA_HOME" ] ; then
     if [ -x "$JAVA_HOME/jre/sh/java" ] ; then
@@ -109,10 +126,11 @@ if $darwin; then
     GRADLE_OPTS="$GRADLE_OPTS \"-Xdock:name=$APP_NAME\" \"-Xdock:icon=$APP_HOME/media/gradle.icns\""
 fi
 
-# For Cygwin, switch paths to Windows format before running java
-if $cygwin ; then
+# For Cygwin or MSYS, switch paths to Windows format before running java
+if [ "$cygwin" = "true" -o "$msys" = "true" ] ; then
     APP_HOME=`cygpath --path --mixed "$APP_HOME"`
     CLASSPATH=`cygpath --path --mixed "$CLASSPATH"`
+
     JAVACMD=`cygpath --unix "$JAVACMD"`
 
     # We build the pattern for arguments to be converted via cygpath
@@ -138,19 +156,19 @@ if $cygwin ; then
         else
             eval `echo args$i`="\"$arg\""
         fi
-        i=$((i+1))
+        i=`expr $i + 1`
     done
     case $i in
-        (0) set -- ;;
-        (1) set -- "$args0" ;;
-        (2) set -- "$args0" "$args1" ;;
-        (3) set -- "$args0" "$args1" "$args2" ;;
-        (4) set -- "$args0" "$args1" "$args2" "$args3" ;;
-        (5) set -- "$args0" "$args1" "$args2" "$args3" "$args4" ;;
-        (6) set -- "$args0" "$args1" "$args2" "$args3" "$args4" "$args5" ;;
-        (7) set -- "$args0" "$args1" "$args2" "$args3" "$args4" "$args5" "$args6" ;;
-        (8) set -- "$args0" "$args1" "$args2" "$args3" "$args4" "$args5" "$args6" "$args7" ;;
-        (9) set -- "$args0" "$args1" "$args2" "$args3" "$args4" "$args5" "$args6" "$args7" "$args8" ;;
+        0) set -- ;;
+        1) set -- "$args0" ;;
+        2) set -- "$args0" "$args1" ;;
+        3) set -- "$args0" "$args1" "$args2" ;;
+        4) set -- "$args0" "$args1" "$args2" "$args3" ;;
+        5) set -- "$args0" "$args1" "$args2" "$args3" "$args4" ;;
+        6) set -- "$args0" "$args1" "$args2" "$args3" "$args4" "$args5" ;;
+        7) set -- "$args0" "$args1" "$args2" "$args3" "$args4" "$args5" "$args6" ;;
+        8) set -- "$args0" "$args1" "$args2" "$args3" "$args4" "$args5" "$args6" "$args7" ;;
+        9) set -- "$args0" "$args1" "$args2" "$args3" "$args4" "$args5" "$args6" "$args7" "$args8" ;;
     esac
 fi
 
@@ -159,14 +177,9 @@ save () {
     for i do printf %s\\n "$i" | sed "s/'/'\\\\''/g;1s/^/'/;\$s/\$/' \\\\/" ; done
     echo " "
 }
-APP_ARGS=$(save "$@")
+APP_ARGS=`save "$@"`
 
 # Collect all arguments for the java command, following the shell quoting and substitution rules
 eval set -- $DEFAULT_JVM_OPTS $JAVA_OPTS $GRADLE_OPTS "\"-Dorg.gradle.appname=$APP_BASE_NAME\"" -classpath "\"$CLASSPATH\"" org.gradle.wrapper.GradleWrapperMain "$APP_ARGS"
 
-# by default we should be in the correct project dir, but when run from Finder on Mac, the cwd is wrong
-if [ "$(uname)" = "Darwin" ] && [ "$HOME" = "$PWD" ]; then
-  cd "$(dirname "$0")"
-fi
-
 exec "$JAVACMD" "$@"
diff --git a/gradlew.bat b/gradlew.bat
index 0f8d5937c..ac1b06f93 100644
--- a/gradlew.bat
+++ b/gradlew.bat
@@ -1,3 +1,19 @@
+@rem
+@rem Copyright 2015 the original author or authors.
+@rem
+@rem Licensed under the Apache License, Version 2.0 (the "License");
+@rem you may not use this file except in compliance with the License.
+@rem You may obtain a copy of the License at
+@rem
+@rem      https://www.apache.org/licenses/LICENSE-2.0
+@rem
+@rem Unless required by applicable law or agreed to in writing, software
+@rem distributed under the License is distributed on an "AS IS" BASIS,
+@rem WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+@rem See the License for the specific language governing permissions and
+@rem limitations under the License.
+@rem
+
 @if "%DEBUG%" == "" @echo off
 @rem ##########################################################################
 @rem
@@ -13,15 +29,18 @@ if "%DIRNAME%" == "" set DIRNAME=.
 set APP_BASE_NAME=%~n0
 set APP_HOME=%DIRNAME%
 
+@rem Resolve any "." and ".." in APP_HOME to make it shorter.
+for %%i in ("%APP_HOME%") do set APP_HOME=%%~fi
+
 @rem Add default JVM options here. You can also use JAVA_OPTS and GRADLE_OPTS to pass JVM options to this script.
-set DEFAULT_JVM_OPTS="-Xmx64m"
+set DEFAULT_JVM_OPTS="-Xmx64m" "-Xms64m"
 
 @rem Find java.exe
 if defined JAVA_HOME goto findJavaFromJavaHome
 
 set JAVA_EXE=java.exe
 %JAVA_EXE% -version >NUL 2>&1
-if "%ERRORLEVEL%" == "0" goto init
+if "%ERRORLEVEL%" == "0" goto execute
 
 echo.
 echo ERROR: JAVA_HOME is not set and no 'java' command could be found in your PATH.
@@ -35,7 +54,7 @@ goto fail
 set JAVA_HOME=%JAVA_HOME:"=%
 set JAVA_EXE=%JAVA_HOME%/bin/java.exe
 
-if exist "%JAVA_EXE%" goto init
+if exist "%JAVA_EXE%" goto execute
 
 echo.
 echo ERROR: JAVA_HOME is set to an invalid directory: %JAVA_HOME%
@@ -45,28 +64,14 @@ echo location of your Java installation.
 
 goto fail
 
-:init
-@rem Get command-line arguments, handling Windows variants
-
-if not "%OS%" == "Windows_NT" goto win9xME_args
-
-:win9xME_args
-@rem Slurp the command line arguments.
-set CMD_LINE_ARGS=
-set _SKIP=2
-
-:win9xME_args_slurp
-if "x%~1" == "x" goto execute
-
-set CMD_LINE_ARGS=%*
-
 :execute
 @rem Setup the command line
 
 set CLASSPATH=%APP_HOME%\gradle\wrapper\gradle-wrapper.jar
 
+
 @rem Execute Gradle
-"%JAVA_EXE%" %DEFAULT_JVM_OPTS% %JAVA_OPTS% %GRADLE_OPTS% "-Dorg.gradle.appname=%APP_BASE_NAME%" -classpath "%CLASSPATH%" org.gradle.wrapper.GradleWrapperMain %CMD_LINE_ARGS%
+"%JAVA_EXE%" %DEFAULT_JVM_OPTS% %JAVA_OPTS% %GRADLE_OPTS% "-Dorg.gradle.appname=%APP_BASE_NAME%" -classpath "%CLASSPATH%" org.gradle.wrapper.GradleWrapperMain %*
 
 :end
 @rem End local scope for the variables with windows NT shell
diff --git a/zap/zap.gradle.kts b/zap/zap.gradle.kts
index cde9895ac..27f508a4e 100644
--- a/zap/zap.gradle.kts
+++ b/zap/zap.gradle.kts
@@ -27,12 +27,19 @@ val creationDate by extra { project.findProperty("creationDate") ?: LocalDate.no
 val distDir = file("src/main/dist/")
 
 java {
-    sourceCompatibility = JavaVersion.VERSION_1_8
-    targetCompatibility = JavaVersion.VERSION_1_8
+    // Compile ZAP with Java 8 when building releases.
+    if (System.getenv("GITHUB_REF")?.contains("refs/tags/") ?: false) {
+        toolchain {
+            languageVersion.set(JavaLanguageVersion.of(8))
+        }
+    } else {
+        sourceCompatibility = JavaVersion.VERSION_1_8
+        targetCompatibility = JavaVersion.VERSION_1_8
+    }
 }
 
 jacoco {
-    toolVersion = "0.8.5"
+    toolVersion = "0.8.6"
 }
 
 tasks.named<JacocoReport>("jacocoTestReport") {
