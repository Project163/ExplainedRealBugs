{"url":"https://api.github.com/repos/microsoft/playwright/issues/32453","repository_url":"https://api.github.com/repos/microsoft/playwright","labels_url":"https://api.github.com/repos/microsoft/playwright/issues/32453/labels{/name}","comments_url":"https://api.github.com/repos/microsoft/playwright/issues/32453/comments","events_url":"https://api.github.com/repos/microsoft/playwright/issues/32453/events","html_url":"https://github.com/microsoft/playwright/issues/32453","id":2506347657,"node_id":"I_kwDODTssw86VY9SJ","number":32453,"title":"[Bug]: Action pointer rendered for each iframe in trace viewer snapshot","user":{"login":"ruifigueira","id":1374559,"node_id":"MDQ6VXNlcjEzNzQ1NTk=","avatar_url":"https://avatars.githubusercontent.com/u/1374559?v=4","gravatar_id":"","url":"https://api.github.com/users/ruifigueira","html_url":"https://github.com/ruifigueira","followers_url":"https://api.github.com/users/ruifigueira/followers","following_url":"https://api.github.com/users/ruifigueira/following{/other_user}","gists_url":"https://api.github.com/users/ruifigueira/gists{/gist_id}","starred_url":"https://api.github.com/users/ruifigueira/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ruifigueira/subscriptions","organizations_url":"https://api.github.com/users/ruifigueira/orgs","repos_url":"https://api.github.com/users/ruifigueira/repos","events_url":"https://api.github.com/users/ruifigueira/events{/privacy}","received_events_url":"https://api.github.com/users/ruifigueira/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":7211040179,"node_id":"LA_kwDODTssw88AAAABrc-9sw","url":"https://api.github.com/repos/microsoft/playwright/labels/v1.48","name":"v1.48","color":"000000","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"dgozman","id":9881434,"node_id":"MDQ6VXNlcjk4ODE0MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9881434?v=4","gravatar_id":"","url":"https://api.github.com/users/dgozman","html_url":"https://github.com/dgozman","followers_url":"https://api.github.com/users/dgozman/followers","following_url":"https://api.github.com/users/dgozman/following{/other_user}","gists_url":"https://api.github.com/users/dgozman/gists{/gist_id}","starred_url":"https://api.github.com/users/dgozman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dgozman/subscriptions","organizations_url":"https://api.github.com/users/dgozman/orgs","repos_url":"https://api.github.com/users/dgozman/repos","events_url":"https://api.github.com/users/dgozman/events{/privacy}","received_events_url":"https://api.github.com/users/dgozman/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"dgozman","id":9881434,"node_id":"MDQ6VXNlcjk4ODE0MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9881434?v=4","gravatar_id":"","url":"https://api.github.com/users/dgozman","html_url":"https://github.com/dgozman","followers_url":"https://api.github.com/users/dgozman/followers","following_url":"https://api.github.com/users/dgozman/following{/other_user}","gists_url":"https://api.github.com/users/dgozman/gists{/gist_id}","starred_url":"https://api.github.com/users/dgozman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dgozman/subscriptions","organizations_url":"https://api.github.com/users/dgozman/orgs","repos_url":"https://api.github.com/users/dgozman/repos","events_url":"https://api.github.com/users/dgozman/events{/privacy}","received_events_url":"https://api.github.com/users/dgozman/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":1,"created_at":"2024-09-04T21:34:01Z","updated_at":"2024-09-11T10:04:04Z","closed_at":"2024-09-11T10:04:04Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Version\r\n\r\n1.46.1\r\n\r\n### Steps to reproduce\r\n\r\nThis is a simplified test of a scenario where I noticed the issue (I added it to `tests/library/trace-viewer.spec.ts` to use trace viewer fixtures):\r\n\r\n```ts\r\ntest('should show only one pointer with multilevel iframes', async ({ page, runAndTrace, server }) => {\r\n  server.setRoute('/level-0.html', (req, res) => {\r\n    res.writeHead(200);\r\n    res.end(`<iframe src=\"/level-1.html\" style=\"position: absolute; left: 100px\"></iframe>`);\r\n  });\r\n  server.setRoute('/level-1.html', (req, res) => {\r\n    res.writeHead(200);\r\n    res.end(`<iframe src=\"/level-2.html\"></iframe>`);\r\n  });\r\n  server.setRoute('/level-2.html', (req, res) => {\r\n    res.writeHead(200);\r\n    res.end(`<button>Click me</button>`);\r\n  });\r\n\r\n  const traceViewer = await runAndTrace(async () => {\r\n    await page.goto(server.PREFIX + '/level-0.html');\r\n    await page.frameLocator('iframe').frameLocator('iframe').locator('button').click({ position: { x: 5, y: 5 } });\r\n  });\r\n  const snapshotFrame = await traceViewer.snapshotFrame('locator.click');\r\n  await expect.soft(snapshotFrame.locator('x-pw-pointer')).not.toBeAttached();\r\n  await expect.soft(snapshotFrame.frameLocator('iframe').locator('x-pw-pointer')).not.toBeAttached();\r\n  await expect.soft(snapshotFrame.frameLocator('iframe').frameLocator('iframe').locator('x-pw-pointer')).toBeVisible();\r\n});\r\n```\r\n\r\n![image](https://github.com/user-attachments/assets/dedc9ee9-c9c3-4395-b968-ec36662e78da)\r\n\r\n\r\n### Expected behavior\r\n\r\nI expected the pointer to only appear one time.\r\n\r\n### Actual behavior\r\n\r\nIt appears for each iframe.\r\n\r\n### Additional context\r\n\r\nPoint coordinates are relative to main frame viewport, and that's why the middle frame pointer gets a big offset, which corresponds to the frame offset.\r\n\r\nRegarding the frame with the actual clicked button, it renders the pointer at its center because it relies on the actual button bounding box to render it. \r\n\r\n### Environment\r\n\r\n```shell\r\nSystem:\r\n    OS: Windows 11 10.0.22631\r\n    CPU: (12) x64 13th Gen Intel(R) Core(TM) i5-1335U\r\n    Memory: 11.88 GB / 31.66 GB\r\n  Binaries:\r\n    Node: 20.17.0 - ~\\scoop\\apps\\nvm\\current\\nodejs\\nodejs\\node.EXE\r\n    npm: 10.8.2 - ~\\scoop\\apps\\nvm\\current\\nodejs\\nodejs\\npm.CMD\r\n  IDEs:\r\n    VSCode: 1.92.2 - C:\\Users\\rui.figueira\\AppData\\Local\\Programs\\Microsoft VS Code\\bin\\code.CMD\r\n  Languages:\r\n    Bash: 5.2.26 - C:\\Users\\rui.figueira\\scoop\\shims\\bash.EXE\r\n```\r\n","closed_by":{"login":"dgozman","id":9881434,"node_id":"MDQ6VXNlcjk4ODE0MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9881434?v=4","gravatar_id":"","url":"https://api.github.com/users/dgozman","html_url":"https://github.com/dgozman","followers_url":"https://api.github.com/users/dgozman/followers","following_url":"https://api.github.com/users/dgozman/following{/other_user}","gists_url":"https://api.github.com/users/dgozman/gists{/gist_id}","starred_url":"https://api.github.com/users/dgozman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dgozman/subscriptions","organizations_url":"https://api.github.com/users/dgozman/orgs","repos_url":"https://api.github.com/users/dgozman/repos","events_url":"https://api.github.com/users/dgozman/events{/privacy}","received_events_url":"https://api.github.com/users/dgozman/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/microsoft/playwright/issues/32453/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/microsoft/playwright/issues/32453/timeline","performed_via_github_app":null,"state_reason":"completed"}