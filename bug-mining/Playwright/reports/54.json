{"url":"https://api.github.com/repos/microsoft/playwright/issues/29422","repository_url":"https://api.github.com/repos/microsoft/playwright","labels_url":"https://api.github.com/repos/microsoft/playwright/issues/29422/labels{/name}","comments_url":"https://api.github.com/repos/microsoft/playwright/issues/29422/comments","events_url":"https://api.github.com/repos/microsoft/playwright/issues/29422/events","html_url":"https://github.com/microsoft/playwright/issues/29422","id":2125902242,"node_id":"I_kwDODTssw85-trGi","number":29422,"title":"[Feature]: Mechanism to disable TTY behaviour in reporters","user":{"login":"BPScott","id":227292,"node_id":"MDQ6VXNlcjIyNzI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/227292?v=4","gravatar_id":"","url":"https://api.github.com/users/BPScott","html_url":"https://github.com/BPScott","followers_url":"https://api.github.com/users/BPScott/followers","following_url":"https://api.github.com/users/BPScott/following{/other_user}","gists_url":"https://api.github.com/users/BPScott/gists{/gist_id}","starred_url":"https://api.github.com/users/BPScott/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BPScott/subscriptions","organizations_url":"https://api.github.com/users/BPScott/orgs","repos_url":"https://api.github.com/users/BPScott/repos","events_url":"https://api.github.com/users/BPScott/events{/privacy}","received_events_url":"https://api.github.com/users/BPScott/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":6122463142,"node_id":"LA_kwDODTssw88AAAABbO1fpg","url":"https://api.github.com/repos/microsoft/playwright/labels/v1.45","name":"v1.45","color":"000000","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"dgozman","id":9881434,"node_id":"MDQ6VXNlcjk4ODE0MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9881434?v=4","gravatar_id":"","url":"https://api.github.com/users/dgozman","html_url":"https://github.com/dgozman","followers_url":"https://api.github.com/users/dgozman/followers","following_url":"https://api.github.com/users/dgozman/following{/other_user}","gists_url":"https://api.github.com/users/dgozman/gists{/gist_id}","starred_url":"https://api.github.com/users/dgozman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dgozman/subscriptions","organizations_url":"https://api.github.com/users/dgozman/orgs","repos_url":"https://api.github.com/users/dgozman/repos","events_url":"https://api.github.com/users/dgozman/events{/privacy}","received_events_url":"https://api.github.com/users/dgozman/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"dgozman","id":9881434,"node_id":"MDQ6VXNlcjk4ODE0MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9881434?v=4","gravatar_id":"","url":"https://api.github.com/users/dgozman","html_url":"https://github.com/dgozman","followers_url":"https://api.github.com/users/dgozman/followers","following_url":"https://api.github.com/users/dgozman/following{/other_user}","gists_url":"https://api.github.com/users/dgozman/gists{/gist_id}","starred_url":"https://api.github.com/users/dgozman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dgozman/subscriptions","organizations_url":"https://api.github.com/users/dgozman/orgs","repos_url":"https://api.github.com/users/dgozman/repos","events_url":"https://api.github.com/users/dgozman/events{/privacy}","received_events_url":"https://api.github.com/users/dgozman/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":0,"created_at":"2024-02-08T19:14:43Z","updated_at":"2024-05-15T22:01:53Z","closed_at":"2024-05-15T22:01:53Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### ðŸš€ Feature Request\r\n\r\nCurrently there is no way to force reporters to use their non-TTY output. \r\n\r\nI would like a way to tell playwright reporters to produce non-TTY output - without ansi escapes and [cursor manipulation](https://gist.github.com/fnky/458719343aabd01cfb17a3a4f7296797#cursor-controls), even when `process.stdout.isTTY` reports true.\r\n\r\nCurrently [`isTTY` in the base reporter](https://github.com/microsoft/playwright/blob/7f81c6e1381acc4648e1c48693c69dbd3a67243e/packages/playwright/src/reporters/base.ts#L48C56-L48C76) is set based on the value of `process.stdout.isTTY`, and you can use `process.env.PWTEST_TTY_WIDTH` to force TTY behaviour to be on, but there is no way to force it to be off.\r\n\r\n### Example\r\n\r\nThe least invasive way could be to add a new environment variable `FORCE_TTY` (name up for grabs) that acts as a boolean and if it is set  [`isTTY` in the base reporter](https://github.com/microsoft/playwright/blob/7f81c6e1381acc4648e1c48693c69dbd3a67243e/packages/playwright/src/reporters/base.ts#L48C56-L48C76) uses the value from that.\r\n\r\nThen `FORCE_TTY=0 npm run playwright test` would output content without ansi codes.\r\n\r\n\r\nThis feels similar to `FORCE_COLOR` as a mechanism of forcing color output that is used just below where `isTTY` is defined.\r\n\r\nAlternatively reporters could have an option that toggles TTY/color usage, but it doesn't look like playwright currently has a concept of options on the base reporter and I'm not sure if you'd want to add one. It feels like introducing that might be a breaking change as reporters that extend from the base would need to start ensuring those base options are passed through.\r\n\r\n### Motivation\r\n\r\nI want to run the `list` reporter on CI to give improved visibility on \"what test runs on what test shard\". I'm using Buildkite as a CI provider, which runs CI scripts in a pseudo-TTY (and thus `process.stdout.isTTY` returns true) and [transforms ansi escapes into HTML](https://buildkite.com/docs/pipelines/managing-log-output), however it seems to have a rendering bug where it mangles the [line rewriting using cursor controls](https://github.com/microsoft/playwright/blob/7f81c6e1381acc4648e1c48693c69dbd3a67243e/packages/playwright/src/reporters/list.ts#L222-L234) that the list reporter uses in a TTY. https://github.com/buildkite/terminal-to-html/issues/127 is the bug raised against buildkite, which contains examples of how buildkite mangles output.\r\n\r\n\r\nI'd like a way to force the list reporter to output plain text without cursor controls, to avoid this bug.\r\n","closed_by":{"login":"dgozman","id":9881434,"node_id":"MDQ6VXNlcjk4ODE0MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9881434?v=4","gravatar_id":"","url":"https://api.github.com/users/dgozman","html_url":"https://github.com/dgozman","followers_url":"https://api.github.com/users/dgozman/followers","following_url":"https://api.github.com/users/dgozman/following{/other_user}","gists_url":"https://api.github.com/users/dgozman/gists{/gist_id}","starred_url":"https://api.github.com/users/dgozman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dgozman/subscriptions","organizations_url":"https://api.github.com/users/dgozman/orgs","repos_url":"https://api.github.com/users/dgozman/repos","events_url":"https://api.github.com/users/dgozman/events{/privacy}","received_events_url":"https://api.github.com/users/dgozman/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/microsoft/playwright/issues/29422/reactions","total_count":5,"+1":5,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/microsoft/playwright/issues/29422/timeline","performed_via_github_app":null,"state_reason":"completed"}