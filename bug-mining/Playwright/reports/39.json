{"url":"https://api.github.com/repos/microsoft/playwright/issues/28848","repository_url":"https://api.github.com/repos/microsoft/playwright","labels_url":"https://api.github.com/repos/microsoft/playwright/issues/28848/labels{/name}","comments_url":"https://api.github.com/repos/microsoft/playwright/issues/28848/comments","events_url":"https://api.github.com/repos/microsoft/playwright/issues/28848/events","html_url":"https://github.com/microsoft/playwright/issues/28848","id":2064745642,"node_id":"I_kwDODTssw857EYSq","number":28848,"title":"[BUG] getByRole(\"heading\") can't match name from input value contents","user":{"login":"WestonThayer","id":709153,"node_id":"MDQ6VXNlcjcwOTE1Mw==","avatar_url":"https://avatars.githubusercontent.com/u/709153?v=4","gravatar_id":"","url":"https://api.github.com/users/WestonThayer","html_url":"https://github.com/WestonThayer","followers_url":"https://api.github.com/users/WestonThayer/followers","following_url":"https://api.github.com/users/WestonThayer/following{/other_user}","gists_url":"https://api.github.com/users/WestonThayer/gists{/gist_id}","starred_url":"https://api.github.com/users/WestonThayer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/WestonThayer/subscriptions","organizations_url":"https://api.github.com/users/WestonThayer/orgs","repos_url":"https://api.github.com/users/WestonThayer/repos","events_url":"https://api.github.com/users/WestonThayer/events{/privacy}","received_events_url":"https://api.github.com/users/WestonThayer/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":6447780283,"node_id":"LA_kwDODTssw88AAAABgFFRuw","url":"https://api.github.com/repos/microsoft/playwright/labels/feature-role","name":"feature-role","color":"D4C5F9","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"dgozman","id":9881434,"node_id":"MDQ6VXNlcjk4ODE0MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9881434?v=4","gravatar_id":"","url":"https://api.github.com/users/dgozman","html_url":"https://github.com/dgozman","followers_url":"https://api.github.com/users/dgozman/followers","following_url":"https://api.github.com/users/dgozman/following{/other_user}","gists_url":"https://api.github.com/users/dgozman/gists{/gist_id}","starred_url":"https://api.github.com/users/dgozman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dgozman/subscriptions","organizations_url":"https://api.github.com/users/dgozman/orgs","repos_url":"https://api.github.com/users/dgozman/repos","events_url":"https://api.github.com/users/dgozman/events{/privacy}","received_events_url":"https://api.github.com/users/dgozman/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"dgozman","id":9881434,"node_id":"MDQ6VXNlcjk4ODE0MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9881434?v=4","gravatar_id":"","url":"https://api.github.com/users/dgozman","html_url":"https://github.com/dgozman","followers_url":"https://api.github.com/users/dgozman/followers","following_url":"https://api.github.com/users/dgozman/following{/other_user}","gists_url":"https://api.github.com/users/dgozman/gists{/gist_id}","starred_url":"https://api.github.com/users/dgozman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dgozman/subscriptions","organizations_url":"https://api.github.com/users/dgozman/orgs","repos_url":"https://api.github.com/users/dgozman/repos","events_url":"https://api.github.com/users/dgozman/events{/privacy}","received_events_url":"https://api.github.com/users/dgozman/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":4,"created_at":"2024-01-03T22:45:43Z","updated_at":"2024-04-17T21:09:13Z","closed_at":"2024-04-17T19:25:10Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### System info\r\n- Playwright Version: v1.40.1\r\n- Operating System: All\r\n- Browser: Chromium\r\n- Other info:\r\n\r\n### Source code\r\n\r\n```js\r\ntest(\"heading should be located\", async ({ page }) => {\r\n  await page.setContent(`\r\n<h1>\r\n  <input type=\"text\" value=\"Foo bar\">\r\n</h1>\r\n  `);\r\n\r\n  await expect(page.getByRole(\"heading\", { name: \"Foo bar\" })).toBeVisible();\r\n  // Fails to locate\r\n});\r\n```\r\n\r\n**Steps**\r\n- Run the test code\r\n\r\n**Expected**\r\n\r\nThe `<h1>` should be located successfully. Chromium DevTools Accessibility inspector shows that the `<h1>`'s accName is `\"Foo bar\":\r\n\r\n<img width=\"234\" alt=\"image\" src=\"https://github.com/microsoft/playwright/assets/709153/af878d50-be4b-47c1-882b-cca347fc9006\">\r\n\r\n**Actual**\r\n\r\nFails to locate.\r\n\r\n### Notes\r\n\r\n`getByRole` *is* able to locate headings that get their accNames from content (ex: `<h1><a href=\"#\">Foo bar</a></h1>` locates with `page.getByRole(\"heading\", { name: \"Foo bar\" })` successfully.\r\n\r\nIs Playwright actually consulting Chromium's accessibility tree for `getByRole`?\r\n\r\nedit: I understand better now, no Playwright is not using [CDP's Accessibility Domain](https://chromedevtools.github.io/devtools-protocol/tot/Accessibility/). It's [roleSelectorEngine](https://github.com/microsoft/playwright/blob/main/packages/playwright-core/src/server/injected/roleSelectorEngine.ts) is an injected script, working entirely in JS/DOM land attempting to mimic the browser's own accessibility tree computations.\r\n\r\nI guess that makes sense, certainly more x-browser friendly. But sure seems like a tough job to match the browser 1:1, accessibility computations are so dang complicated (and often evolving). This approach also may provide a slight false sense of security as it could successfully locate an element that the browser actually botched the accessibility calc for (due to regression or quirk).\r\n\r\nI'd be great if it was possible to [extend selectors](https://playwright.dev/docs/extensibility) with a **non** injected engine.","closed_by":{"login":"dgozman","id":9881434,"node_id":"MDQ6VXNlcjk4ODE0MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9881434?v=4","gravatar_id":"","url":"https://api.github.com/users/dgozman","html_url":"https://github.com/dgozman","followers_url":"https://api.github.com/users/dgozman/followers","following_url":"https://api.github.com/users/dgozman/following{/other_user}","gists_url":"https://api.github.com/users/dgozman/gists{/gist_id}","starred_url":"https://api.github.com/users/dgozman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dgozman/subscriptions","organizations_url":"https://api.github.com/users/dgozman/orgs","repos_url":"https://api.github.com/users/dgozman/repos","events_url":"https://api.github.com/users/dgozman/events{/privacy}","received_events_url":"https://api.github.com/users/dgozman/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/microsoft/playwright/issues/28848/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/microsoft/playwright/issues/28848/timeline","performed_via_github_app":null,"state_reason":"completed"}