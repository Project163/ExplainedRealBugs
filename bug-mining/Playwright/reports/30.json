{"url":"https://api.github.com/repos/microsoft/playwright/issues/29876","repository_url":"https://api.github.com/repos/microsoft/playwright","labels_url":"https://api.github.com/repos/microsoft/playwright/issues/29876/labels{/name}","comments_url":"https://api.github.com/repos/microsoft/playwright/issues/29876/comments","events_url":"https://api.github.com/repos/microsoft/playwright/issues/29876/events","html_url":"https://github.com/microsoft/playwright/issues/29876","id":2178976426,"node_id":"I_kwDODTssw86B4Iqq","number":29876,"title":"[Bug]: Ambiguous retry mechanism in playwright 1.42.1","user":{"login":"Smrtnyk","id":31451544,"node_id":"MDQ6VXNlcjMxNDUxNTQ0","avatar_url":"https://avatars.githubusercontent.com/u/31451544?v=4","gravatar_id":"","url":"https://api.github.com/users/Smrtnyk","html_url":"https://github.com/Smrtnyk","followers_url":"https://api.github.com/users/Smrtnyk/followers","following_url":"https://api.github.com/users/Smrtnyk/following{/other_user}","gists_url":"https://api.github.com/users/Smrtnyk/gists{/gist_id}","starred_url":"https://api.github.com/users/Smrtnyk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Smrtnyk/subscriptions","organizations_url":"https://api.github.com/users/Smrtnyk/orgs","repos_url":"https://api.github.com/users/Smrtnyk/repos","events_url":"https://api.github.com/users/Smrtnyk/events{/privacy}","received_events_url":"https://api.github.com/users/Smrtnyk/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":6122462647,"node_id":"LA_kwDODTssw88AAAABbO1dtw","url":"https://api.github.com/repos/microsoft/playwright/labels/v1.43","name":"v1.43","color":"000000","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"dgozman","id":9881434,"node_id":"MDQ6VXNlcjk4ODE0MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9881434?v=4","gravatar_id":"","url":"https://api.github.com/users/dgozman","html_url":"https://github.com/dgozman","followers_url":"https://api.github.com/users/dgozman/followers","following_url":"https://api.github.com/users/dgozman/following{/other_user}","gists_url":"https://api.github.com/users/dgozman/gists{/gist_id}","starred_url":"https://api.github.com/users/dgozman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dgozman/subscriptions","organizations_url":"https://api.github.com/users/dgozman/orgs","repos_url":"https://api.github.com/users/dgozman/repos","events_url":"https://api.github.com/users/dgozman/events{/privacy}","received_events_url":"https://api.github.com/users/dgozman/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"dgozman","id":9881434,"node_id":"MDQ6VXNlcjk4ODE0MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9881434?v=4","gravatar_id":"","url":"https://api.github.com/users/dgozman","html_url":"https://github.com/dgozman","followers_url":"https://api.github.com/users/dgozman/followers","following_url":"https://api.github.com/users/dgozman/following{/other_user}","gists_url":"https://api.github.com/users/dgozman/gists{/gist_id}","starred_url":"https://api.github.com/users/dgozman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dgozman/subscriptions","organizations_url":"https://api.github.com/users/dgozman/orgs","repos_url":"https://api.github.com/users/dgozman/repos","events_url":"https://api.github.com/users/dgozman/events{/privacy}","received_events_url":"https://api.github.com/users/dgozman/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":1,"created_at":"2024-03-11T12:09:58Z","updated_at":"2024-03-21T04:01:32Z","closed_at":"2024-03-21T04:01:31Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Version\r\n\r\n1.42.1\r\n\r\n### Steps to reproduce\r\n\r\n1. Clone my repo https://github.com/Smrtnyk/PW-repros\r\n2. npm install\r\n3. npm run test\r\n\r\n### Expected behavior\r\n\r\nTest retry mechanism should be more clear\r\n\r\n### Actual behavior\r\n\r\n2 Issues here.\r\n\r\n1. In file `retries-successful-test.spec` the test that succeeded is also retried, not just the failed one.\r\nI wasn't expecting to see successful test being retried, just the failing one.\r\n\r\n2. In file `expecting-retries.spec` starting with playwright 1.42 the failing test is not retrying anymore, due to exception being thrown in fixture after `run` statement.\r\nIn 1.41 test would still retry.\r\nNow it is not clear if this new behavior is expected, but if it is, it should be at least clear why test is not retrying anymore.\r\nWe have quite a sophisticated test cleanup scenarios, and it was hard to figure out why some of our tests were not being retried anymore due to exception not being shown anywhere.\r\n\r\n### Additional context\r\n\r\n_No response_\r\n\r\n### Environment\r\n\r\n```shell\r\nSystem:\r\n    OS: Windows 11 10.0.22631\r\n    CPU: (24) x64 12th Gen Intel(R) Core(TM) i9-12950HX\r\n    Memory: 43.18 GB / 63.69 GB\r\n  Binaries:\r\n    Node: 20.10.0 - C:\\Program Files\\nodejs\\node.EXE\r\n    Yarn: 1.22.19 - ~\\AppData\\Roaming\\npm\\yarn.CMD\r\n    npm: 10.2.3 - C:\\Program Files\\nodejs\\npm.CMD\r\n    pnpm: 8.12.0 - C:\\Program Files\\nodejs\\pnpm.CMD\r\n  IDEs:\r\n    VSCode: 1.86.0 - C:\\workspaces\\devtools\\Microsoft VS Code\\bin\\code.CMD\r\n  Languages:\r\n    Bash: 5.2.21 - C:\\Program Files\\Git\\usr\\bin\\bash.EXE\r\n  npmPackages:\r\n    @playwright/test: 1.42.1 => 1.42.1\r\n```\r\n","closed_by":{"login":"dgozman","id":9881434,"node_id":"MDQ6VXNlcjk4ODE0MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9881434?v=4","gravatar_id":"","url":"https://api.github.com/users/dgozman","html_url":"https://github.com/dgozman","followers_url":"https://api.github.com/users/dgozman/followers","following_url":"https://api.github.com/users/dgozman/following{/other_user}","gists_url":"https://api.github.com/users/dgozman/gists{/gist_id}","starred_url":"https://api.github.com/users/dgozman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dgozman/subscriptions","organizations_url":"https://api.github.com/users/dgozman/orgs","repos_url":"https://api.github.com/users/dgozman/repos","events_url":"https://api.github.com/users/dgozman/events{/privacy}","received_events_url":"https://api.github.com/users/dgozman/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/microsoft/playwright/issues/29876/reactions","total_count":9,"+1":9,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/microsoft/playwright/issues/29876/timeline","performed_via_github_app":null,"state_reason":"completed"}