{"url":"https://api.github.com/repos/microsoft/playwright/issues/30499","repository_url":"https://api.github.com/repos/microsoft/playwright","labels_url":"https://api.github.com/repos/microsoft/playwright/issues/30499/labels{/name}","comments_url":"https://api.github.com/repos/microsoft/playwright/issues/30499/comments","events_url":"https://api.github.com/repos/microsoft/playwright/issues/30499/events","html_url":"https://github.com/microsoft/playwright/issues/30499","id":2260532470,"node_id":"I_kwDODTssw86GvPz2","number":30499,"title":"[Bug]: Invalid flags supplied to RegExp constructor ' >> nth=3' when generating locator with PWDEBUG=console","user":{"login":"RunOrVeith","id":12949211,"node_id":"MDQ6VXNlcjEyOTQ5MjEx","avatar_url":"https://avatars.githubusercontent.com/u/12949211?v=4","gravatar_id":"","url":"https://api.github.com/users/RunOrVeith","html_url":"https://github.com/RunOrVeith","followers_url":"https://api.github.com/users/RunOrVeith/followers","following_url":"https://api.github.com/users/RunOrVeith/following{/other_user}","gists_url":"https://api.github.com/users/RunOrVeith/gists{/gist_id}","starred_url":"https://api.github.com/users/RunOrVeith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RunOrVeith/subscriptions","organizations_url":"https://api.github.com/users/RunOrVeith/orgs","repos_url":"https://api.github.com/users/RunOrVeith/repos","events_url":"https://api.github.com/users/RunOrVeith/events{/privacy}","received_events_url":"https://api.github.com/users/RunOrVeith/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":6122463142,"node_id":"LA_kwDODTssw88AAAABbO1fpg","url":"https://api.github.com/repos/microsoft/playwright/labels/v1.45","name":"v1.45","color":"000000","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"dgozman","id":9881434,"node_id":"MDQ6VXNlcjk4ODE0MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9881434?v=4","gravatar_id":"","url":"https://api.github.com/users/dgozman","html_url":"https://github.com/dgozman","followers_url":"https://api.github.com/users/dgozman/followers","following_url":"https://api.github.com/users/dgozman/following{/other_user}","gists_url":"https://api.github.com/users/dgozman/gists{/gist_id}","starred_url":"https://api.github.com/users/dgozman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dgozman/subscriptions","organizations_url":"https://api.github.com/users/dgozman/orgs","repos_url":"https://api.github.com/users/dgozman/repos","events_url":"https://api.github.com/users/dgozman/events{/privacy}","received_events_url":"https://api.github.com/users/dgozman/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"dgozman","id":9881434,"node_id":"MDQ6VXNlcjk4ODE0MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9881434?v=4","gravatar_id":"","url":"https://api.github.com/users/dgozman","html_url":"https://github.com/dgozman","followers_url":"https://api.github.com/users/dgozman/followers","following_url":"https://api.github.com/users/dgozman/following{/other_user}","gists_url":"https://api.github.com/users/dgozman/gists{/gist_id}","starred_url":"https://api.github.com/users/dgozman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dgozman/subscriptions","organizations_url":"https://api.github.com/users/dgozman/orgs","repos_url":"https://api.github.com/users/dgozman/repos","events_url":"https://api.github.com/users/dgozman/events{/privacy}","received_events_url":"https://api.github.com/users/dgozman/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":0,"created_at":"2024-04-24T07:04:23Z","updated_at":"2024-05-13T19:40:47Z","closed_at":"2024-05-13T19:40:47Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Version\r\n\r\n1.43.1\r\n\r\n### Steps to reproduce\r\n\r\nI have a copy of the HTML that causes the issue attached here: [errored.html.txt](https://github.com/microsoft/playwright/files/15089993/errored.html.txt)\r\n\r\n1. Put it in a folder and  remove the .txt extension, this is just so github will let me upload it.\r\n2. Put this test in a file next to the errored.html\r\n3. Then run the test with `PWDEBUG=console npx playwright test`. PWDEBUG is required here to trigger the bug.\r\n\r\nHere is also a complete zip folder with all contents that you can just extract and run: [reproduceBug.zip](https://github.com/microsoft/playwright/files/15090389/reproduceBug.zip)\r\n\r\n\r\n```TS\r\nimport { expect, test } from \"@playwright/test\";\r\nimport fs from \"fs\";\r\n\r\ntest.describe(\"reproduce bug\", () => {\r\n  test.only(\"it can generate a locator for the div\", async ({ page }) => {\r\n    const htmlContent = fs.readFileSync(\"./errored.html\");\r\n\r\n    await page.route(/.*anything.*/, (route) =>\r\n      route.fulfill({ body: htmlContent })\r\n    );\r\n    await page.goto(\"https://anything.com\");\r\n\r\n    await page.evaluate(() => {\r\n      const element = document.querySelector(\r\n        \".block > div:nth-child(1) > div:nth-child(2) > div:nth-child(2) > div:nth-child(2) > div:nth-child(1) > div:nth-child(2) > div:nth-child(1) > div:nth-child(1) > div:nth-child(1)\"\r\n      );\r\n      if (!element) {\r\n        throw new Error(\"element not found\");\r\n      }\r\n      const locator = playwright.generateLocator(element);\r\n\r\n      expect(typeof locator).toMatch(\"string\");\r\n    });\r\n  });\r\n});\r\n\r\n```\r\n\r\n\r\nThe element I am trying to generate a Locator for is this:\r\n\r\n```HTML\r\n<div class=\"group relative flex w-auto border-y-2 border-silver-100 border-b-transparent bg-white transition-all ease-out hover:cursor-pointer hover:bg-silver-50\">...</div>\r\n```\r\nor here highlighted in the chrome debug tools:\r\n![image](https://github.com/microsoft/playwright/assets/12949211/b2cfc9fa-8aa2-4961-92a0-ca5cb6851b51)\r\n\r\n\r\n\r\n### Expected behavior\r\n\r\nI expect the test to pass and a locator to be generated\r\n\r\n### Actual behavior\r\n\r\nAn error is thrown by `playwright.generateLocator`:\r\n\r\n```\r\n Error: page.evaluate: SyntaxError: Invalid flags supplied to RegExp constructor ' >> nth=3'\r\n\r\n        at new RegExp (<anonymous>)\r\n        at createTextMatcher (<anonymous>:5935:16)\r\n        at Object.queryAll (<anonymous>:5004:29)\r\n        at InjectedScript._queryEngineAll (<anonymous>:4949:49)\r\n        at InjectedScript.querySelectorAll (<anonymous>:4936:30)\r\n        at generateSelector (<anonymous>:3649:32)\r\n        at InjectedScript.generateSelectorSimple (<anonymous>:4872:12)\r\n        at ConsoleAPI._generateLocator (eval at extend (:5100:40), <anonymous>:2241:43)\r\n        at Object.generateLocator (eval at extend (:5100:40), <anonymous>:2205:52)\r\n        at eval (eval at evaluate (:226:30), <anonymous>:6:34)\r\n        at createTextMatcher (/home/veith/projects/automagically/ts/apps/next-automagically/playwrightTests/reproduceBug/<anonymous>:5935:16)\r\n        at Object.queryAll (/home/veith/projects/automagically/ts/apps/next-automagically/playwrightTests/reproduceBug/<anonymous>:5004:29)\r\n        at InjectedScript._queryEngineAll (/home/veith/projects/automagically/ts/apps/next-automagically/playwrightTests/reproduceBug/<anonymous>:4949:49)\r\n        at InjectedScript.querySelectorAll (/home/veith/projects/automagically/ts/apps/next-automagically/playwrightTests/reproduceBug/<anonymous>:4936:30)\r\n        at generateSelector (/home/veith/projects/automagically/ts/apps/next-automagically/playwrightTests/reproduceBug/<anonymous>:3649:32)\r\n        at InjectedScript.generateSelectorSimple (/home/veith/projects/automagically/ts/apps/next-automagically/playwrightTests/reproduceBug/<anonymous>:4872:12)\r\n        at ConsoleAPI._generateLocator (/home/veith/projects/automagically/ts/apps/next-automagically/playwrightTests/reproduceBug/eval at extend (:5100:40), <anonymous>:2241:43)\r\n        at Object.generateLocator (/home/veith/projects/automagically/ts/apps/next-automagically/playwrightTests/reproduceBug/eval at extend (:5100:40), <anonymous>:2205:52)\r\n        at eval (/home/veith/projects/automagically/ts/apps/next-automagically/playwrightTests/reproduceBug/eval at evaluate (:226:30), <anonymous>:6:34)\r\n        at /home/veith/projects/automagically/ts/apps/next-automagically/playwrightTests/reproduceBug/reproduce.spec.ts:13:16\r\n\r\n```\r\n\r\nPossibly related: #26974\r\n\r\n### Additional context\r\n\r\nUsing the playwright recorder, I can not select this element, it just doesn't appear when hovering over the corresponding area.\r\n\r\n### Environment\r\n\r\n```shell\r\nSystem:\r\n    OS: Linux 6.5 Ubuntu 22.04.4 LTS 22.04.4 LTS (Jammy Jellyfish)\r\n    CPU: (12) x64 Intel(R) Core(TM) i7-8850H CPU @ 2.60GHz\r\n    Memory: 9.78 GB / 15.31 GB\r\n    Container: Yes\r\n  Binaries:\r\n    Node: 20.9.0 - ~/.nvm/versions/node/v20.9.0/bin/node\r\n    npm: 10.1.0 - ~/.nvm/versions/node/v20.9.0/bin/npm\r\n    pnpm: 8.15.5 - ~/.local/share/pnpm/pnpm\r\n  IDEs:\r\n    VSCode: 1.88.1 - /snap/bin/code\r\n  Languages:\r\n    Bash: 5.1.16 - /usr/bin/bash\r\n```\r\n","closed_by":{"login":"dgozman","id":9881434,"node_id":"MDQ6VXNlcjk4ODE0MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9881434?v=4","gravatar_id":"","url":"https://api.github.com/users/dgozman","html_url":"https://github.com/dgozman","followers_url":"https://api.github.com/users/dgozman/followers","following_url":"https://api.github.com/users/dgozman/following{/other_user}","gists_url":"https://api.github.com/users/dgozman/gists{/gist_id}","starred_url":"https://api.github.com/users/dgozman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dgozman/subscriptions","organizations_url":"https://api.github.com/users/dgozman/orgs","repos_url":"https://api.github.com/users/dgozman/repos","events_url":"https://api.github.com/users/dgozman/events{/privacy}","received_events_url":"https://api.github.com/users/dgozman/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/microsoft/playwright/issues/30499/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/microsoft/playwright/issues/30499/timeline","performed_via_github_app":null,"state_reason":"completed"}