{"url":"https://api.github.com/repos/microsoft/playwright/issues/30000","repository_url":"https://api.github.com/repos/microsoft/playwright","labels_url":"https://api.github.com/repos/microsoft/playwright/issues/30000/labels{/name}","comments_url":"https://api.github.com/repos/microsoft/playwright/issues/30000/comments","events_url":"https://api.github.com/repos/microsoft/playwright/issues/30000/events","html_url":"https://github.com/microsoft/playwright/issues/30000","id":2195161545,"node_id":"I_kwDODTssw86C14HJ","number":30000,"title":"[Bug]: page.route does not disable http cache in Firefox","user":{"login":"MattIPv4","id":12371363,"node_id":"MDQ6VXNlcjEyMzcxMzYz","avatar_url":"https://avatars.githubusercontent.com/u/12371363?v=4","gravatar_id":"","url":"https://api.github.com/users/MattIPv4","html_url":"https://github.com/MattIPv4","followers_url":"https://api.github.com/users/MattIPv4/followers","following_url":"https://api.github.com/users/MattIPv4/following{/other_user}","gists_url":"https://api.github.com/users/MattIPv4/gists{/gist_id}","starred_url":"https://api.github.com/users/MattIPv4/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MattIPv4/subscriptions","organizations_url":"https://api.github.com/users/MattIPv4/orgs","repos_url":"https://api.github.com/users/MattIPv4/repos","events_url":"https://api.github.com/users/MattIPv4/events{/privacy}","received_events_url":"https://api.github.com/users/MattIPv4/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":6122462647,"node_id":"LA_kwDODTssw88AAAABbO1dtw","url":"https://api.github.com/repos/microsoft/playwright/labels/v1.43","name":"v1.43","color":"000000","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"aslushnikov","id":746130,"node_id":"MDQ6VXNlcjc0NjEzMA==","avatar_url":"https://avatars.githubusercontent.com/u/746130?v=4","gravatar_id":"","url":"https://api.github.com/users/aslushnikov","html_url":"https://github.com/aslushnikov","followers_url":"https://api.github.com/users/aslushnikov/followers","following_url":"https://api.github.com/users/aslushnikov/following{/other_user}","gists_url":"https://api.github.com/users/aslushnikov/gists{/gist_id}","starred_url":"https://api.github.com/users/aslushnikov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aslushnikov/subscriptions","organizations_url":"https://api.github.com/users/aslushnikov/orgs","repos_url":"https://api.github.com/users/aslushnikov/repos","events_url":"https://api.github.com/users/aslushnikov/events{/privacy}","received_events_url":"https://api.github.com/users/aslushnikov/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"aslushnikov","id":746130,"node_id":"MDQ6VXNlcjc0NjEzMA==","avatar_url":"https://avatars.githubusercontent.com/u/746130?v=4","gravatar_id":"","url":"https://api.github.com/users/aslushnikov","html_url":"https://github.com/aslushnikov","followers_url":"https://api.github.com/users/aslushnikov/followers","following_url":"https://api.github.com/users/aslushnikov/following{/other_user}","gists_url":"https://api.github.com/users/aslushnikov/gists{/gist_id}","starred_url":"https://api.github.com/users/aslushnikov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aslushnikov/subscriptions","organizations_url":"https://api.github.com/users/aslushnikov/orgs","repos_url":"https://api.github.com/users/aslushnikov/repos","events_url":"https://api.github.com/users/aslushnikov/events{/privacy}","received_events_url":"https://api.github.com/users/aslushnikov/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":7,"created_at":"2024-03-19T14:39:34Z","updated_at":"2024-03-28T17:25:38Z","closed_at":"2024-03-28T17:25:38Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Version\r\n\r\n1.41.0\r\n\r\n### Steps to reproduce\r\n\r\nhttps://try.playwright.tech/?l=javascript&s=lxhfadd\r\n\r\n```js\r\n// @ts-check\r\nconst playwright = require('playwright');\r\n\r\n(async () => {\r\n    const browser = await playwright.firefox.launch();\r\n    const context = await browser.newContext();\r\n    const page = await context.newPage();\r\n\r\n    // Route everything to disable the cache (this doesn't work)\r\n    // \"Enabling routing disables http cache.\" per https://playwright.dev/docs/api/class-page#page-route\r\n    await page.route('**/*', route => route.continue());\r\n\r\n    // Go to the homepage\r\n    await page.goto('https://www.digitalocean.com');\r\n\r\n    // Set a fast timeout, as we're expecting timeouts for this issue reproduction\r\n    page.setDefaultTimeout(1500);\r\n\r\n    for (let i = 0; i < 5; i++) {\r\n        await Promise.all([\r\n            page.waitForResponse(resp => {\r\n                // Look for the API request we're about to make\r\n                if (!resp.url().includes('/api/static-content/v1/tags/ubuntu')) return;\r\n\r\n                // Log the response we got, including the status that Playwright sees\r\n                console.log(i, 'playwright', resp.status());\r\n\r\n                // We want to wait for a successful response\r\n                return resp.ok();\r\n            }).catch(e => {\r\n                // Log a timeout but don't crash\r\n                console.log(i, e.message);\r\n            }),\r\n            // Make the API request and log the status that the browser sees\r\n            page.evaluate('fetch(\"/api/static-content/v1/tags/ubuntu\").then(resp => resp.status)').then(status => console.log(i, 'browser', status)),\r\n        ]);\r\n    }\r\n\r\n    // Allow some time for final logs to flush before closing\r\n    await new Promise(res => setTimeout(res, 500));\r\n    await browser.close();\r\n})();\r\n```\r\n\r\n### Expected behavior\r\n\r\nhttps://playwright.dev/docs/api/class-page#page-route states that when `page.route` is used, the HTTP cache should be disabled. As such, I'd expect `resp.status()` to return `200` every time, or the documentation to be updated to reflect that caching is not disabled in Firefox.\r\n\r\n### Actual behavior\r\n\r\nOn the first (or first few depending on how Firefox feels), the `resp.status()` is observed to be `200`, however it then gets cached by Firefox and the `resp.status()` switches to being a `304` (while the status that the browser fetch call sees is still a `200`).\r\n\r\n### Additional context\r\n\r\nI believe this is somewhat related to https://github.com/microsoft/playwright/issues/27573\r\n\r\n### Environment\r\n\r\n```shell\r\nUnsure how to get this info from https://try.playwright.tech\r\n```\r\n","closed_by":{"login":"yury-s","id":9798949,"node_id":"MDQ6VXNlcjk3OTg5NDk=","avatar_url":"https://avatars.githubusercontent.com/u/9798949?v=4","gravatar_id":"","url":"https://api.github.com/users/yury-s","html_url":"https://github.com/yury-s","followers_url":"https://api.github.com/users/yury-s/followers","following_url":"https://api.github.com/users/yury-s/following{/other_user}","gists_url":"https://api.github.com/users/yury-s/gists{/gist_id}","starred_url":"https://api.github.com/users/yury-s/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yury-s/subscriptions","organizations_url":"https://api.github.com/users/yury-s/orgs","repos_url":"https://api.github.com/users/yury-s/repos","events_url":"https://api.github.com/users/yury-s/events{/privacy}","received_events_url":"https://api.github.com/users/yury-s/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/microsoft/playwright/issues/30000/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/microsoft/playwright/issues/30000/timeline","performed_via_github_app":null,"state_reason":"completed"}