{"url":"https://api.github.com/repos/docker/cli/issues/1707","repository_url":"https://api.github.com/repos/docker/cli","labels_url":"https://api.github.com/repos/docker/cli/issues/1707/labels{/name}","comments_url":"https://api.github.com/repos/docker/cli/issues/1707/comments","events_url":"https://api.github.com/repos/docker/cli/issues/1707/events","html_url":"https://github.com/docker/cli/issues/1707","id":416641757,"node_id":"MDU6SXNzdWU0MTY2NDE3NTc=","number":1707,"title":"[ssh connhelper] /dev/stdin EAGAIN","user":{"login":"AkihiroSuda","id":9248427,"node_id":"MDQ6VXNlcjkyNDg0Mjc=","avatar_url":"https://avatars.githubusercontent.com/u/9248427?v=4","gravatar_id":"","url":"https://api.github.com/users/AkihiroSuda","html_url":"https://github.com/AkihiroSuda","followers_url":"https://api.github.com/users/AkihiroSuda/followers","following_url":"https://api.github.com/users/AkihiroSuda/following{/other_user}","gists_url":"https://api.github.com/users/AkihiroSuda/gists{/gist_id}","starred_url":"https://api.github.com/users/AkihiroSuda/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AkihiroSuda/subscriptions","organizations_url":"https://api.github.com/users/AkihiroSuda/orgs","repos_url":"https://api.github.com/users/AkihiroSuda/repos","events_url":"https://api.github.com/users/AkihiroSuda/events{/privacy}","received_events_url":"https://api.github.com/users/AkihiroSuda/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2019-03-04T05:49:49Z","updated_at":"2019-04-18T17:55:53Z","closed_at":"2019-04-18T17:55:53Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\nIf you are reporting a new issue, make sure that we do not have any duplicates\r\nalready open. You can ensure this by searching the issue list for this\r\nrepository. If there is a duplicate, please close your issue and add a comment\r\nto the existing issue instead.\r\n\r\nIf you suspect your issue is a bug, please edit your issue description to\r\ninclude the BUG REPORT INFORMATION shown below. If you fail to provide this\r\ninformation within 7 days, we cannot debug your issue and will close it. We\r\nwill, however, reopen it if you later provide the information.\r\n\r\nFor more information about reporting issues, see\r\nhttps://github.com/docker/cli/blob/master/CONTRIBUTING.md#reporting-other-issues\r\n\r\n---------------------------------------------------\r\nGENERAL SUPPORT INFORMATION\r\n---------------------------------------------------\r\n\r\nThe GitHub issue tracker is for bug reports and feature requests.\r\nGeneral support can be found at the following locations:\r\n\r\n- Docker Support Forums - https://forums.docker.com\r\n- Docker Community Slack - https://dockr.ly/community\r\n- Post a question on StackOverflow, using the Docker tag\r\n\r\n---------------------------------------------------\r\nBUG REPORT INFORMATION\r\n---------------------------------------------------\r\nUse the commands below to provide key information from your environment:\r\nYou do NOT have to include this information if this is a FEATURE REQUEST\r\n-->\r\n\r\n**Description**\r\n\r\n`DOCKER_HOST=ssh://...` does not work with `docker run -i` on certain conditions, due to `Error sendStdin: read /dev/stdin: resource temporarily unavailable`.\r\n\r\n**Steps to reproduce the issue:**\r\n1. ` DOCKER_HOST=ssh://suda-debian docker run -it --rm alpine`\r\n\r\n**Describe the results you received:**\r\nShell prompt does not appear\r\n\r\n**Describe the results you expected:**\r\nShell prompt appears\r\n\r\n**Additional information you deem important (e.g. issue happens only occasionally):**\r\n\r\nDebug logs:\r\n```\r\n$ DOCKER_HOST=ssh://suda-debian docker --debug run -it --rm alpine\r\nDEBU[0000] connhelper: starting ssh with [suda-debian -- docker system dial-stdio]\r\nDEBU[0001] connhelper: starting ssh with [suda-debian -- docker system dial-stdio]\r\nDEBU[0003] connhelper: starting ssh with [suda-debian -- docker system dial-stdio]\r\n                                                                                   DEBU[0003] [hijack] End of stdin\r\nDEBU[0003] Error sendStdin: read /dev/stdin: resource temporarily unavailable\r\nDEBU[0003] [hijack] End of stdout\r\n```\r\n\r\n* Not reproducible with macOS client.\r\n* Not reproducible with a daemon running in a local LXC container. So the issue is likely to be  related to network latency.\r\n* Not reproducible when stdin is not tty, i.e. `echo foo | DOCKER_HOST=ssh://suda-debian docker --debug run -i --rm alpine cat` works\r\n* Client: Ubuntu 18.04.2, kernel `4.15.0-45-generic #48-Ubuntu`, bash, tmux\r\n\r\n**Output of `docker version`:**\r\n\r\n```\r\nClient: Docker Engine - Community\r\n Version:           18.09.3\r\n API version:       1.39\r\n Go version:        go1.10.8\r\n Git commit:        774a1f4\r\n Built:             Thu Feb 28 06:32:01 2019\r\n OS/Arch:           linux/amd64\r\n Experimental:      true\r\n\r\nServer: Docker Engine - Community\r\n Engine:\r\n  Version:          18.09.3\r\n  API version:      1.39 (minimum version 1.12)\r\n  Go version:       go1.10.8\r\n  Git commit:       774a1f4\r\n  Built:            Thu Feb 28 05:59:55 2019\r\n  OS/Arch:          linux/amd64\r\n  Experimental:     false\r\n```\r\n\r\n**Output of `docker info`:**\r\n\r\n```\r\nContainers: 16\r\n Running: 16\r\n Paused: 0\r\n Stopped: 0\r\nImages: 9\r\nServer Version: 18.09.3\r\nStorage Driver: overlay2\r\n Backing Filesystem: extfs\r\n Supports d_type: true\r\n Native Overlay Diff: true\r\nLogging Driver: json-file\r\nCgroup Driver: cgroupfs\r\nPlugins:\r\n Volume: local\r\n Network: bridge host macvlan null overlay\r\n Log: awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog\r\nSwarm: inactive\r\nRuntimes: runc\r\nDefault Runtime: runc\r\nInit Binary: docker-init\r\ncontainerd version: e6b3f5632f50dbc4e9cb6288d911bf4f5e95b18e\r\nrunc version: 6635b4f0c6af3810594d2770f662f34ddc15b40d\r\ninit version: fec3683\r\nSecurity Options:\r\n seccomp\r\n  Profile: default\r\nKernel Version: 4.9.0-8-amd64\r\nOperating System: Debian GNU/Linux 9 (stretch)\r\nOSType: linux\r\nArchitecture: x86_64\r\nCPUs: 32\r\nTotal Memory: 118GiB\r\nName: suda-debian\r\nID: NTDN:QBDF:Y6PR:QUUL:QRLD:AYSL:27JV:5VJG:QXL5:T5CS:5S3A:7BCT\r\nDocker Root Dir: /var/lib/docker\r\nDebug Mode (client): false\r\nDebug Mode (server): false\r\nUsername: akihirosuda\r\nRegistry: https://index.docker.io/v1/\r\nLabels:\r\nExperimental: false\r\nInsecure Registries:\r\n 127.0.0.0/8\r\nLive Restore Enabled: false\r\nProduct License: Community Engine\r\n\r\nWARNING: No swap limit support\r\n```\r\n","closed_by":{"login":"thaJeztah","id":1804568,"node_id":"MDQ6VXNlcjE4MDQ1Njg=","avatar_url":"https://avatars.githubusercontent.com/u/1804568?v=4","gravatar_id":"","url":"https://api.github.com/users/thaJeztah","html_url":"https://github.com/thaJeztah","followers_url":"https://api.github.com/users/thaJeztah/followers","following_url":"https://api.github.com/users/thaJeztah/following{/other_user}","gists_url":"https://api.github.com/users/thaJeztah/gists{/gist_id}","starred_url":"https://api.github.com/users/thaJeztah/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/thaJeztah/subscriptions","organizations_url":"https://api.github.com/users/thaJeztah/orgs","repos_url":"https://api.github.com/users/thaJeztah/repos","events_url":"https://api.github.com/users/thaJeztah/events{/privacy}","received_events_url":"https://api.github.com/users/thaJeztah/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/docker/cli/issues/1707/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/docker/cli/issues/1707/timeline","performed_via_github_app":null,"state_reason":"completed"}