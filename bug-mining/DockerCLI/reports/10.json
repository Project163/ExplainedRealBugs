{"url":"https://api.github.com/repos/docker/cli/issues/1358","repository_url":"https://api.github.com/repos/docker/cli","labels_url":"https://api.github.com/repos/docker/cli/issues/1358/labels{/name}","comments_url":"https://api.github.com/repos/docker/cli/issues/1358/comments","events_url":"https://api.github.com/repos/docker/cli/issues/1358/events","html_url":"https://github.com/docker/cli/issues/1358","id":358534205,"node_id":"MDU6SXNzdWUzNTg1MzQyMDU=","number":1358,"title":"\"docker manifest inspect --insecure\" doesn't work","user":{"login":"ijc","id":12985729,"node_id":"MDQ6VXNlcjEyOTg1NzI5","avatar_url":"https://avatars.githubusercontent.com/u/12985729?v=4","gravatar_id":"","url":"https://api.github.com/users/ijc","html_url":"https://github.com/ijc","followers_url":"https://api.github.com/users/ijc/followers","following_url":"https://api.github.com/users/ijc/following{/other_user}","gists_url":"https://api.github.com/users/ijc/gists{/gist_id}","starred_url":"https://api.github.com/users/ijc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ijc/subscriptions","organizations_url":"https://api.github.com/users/ijc/orgs","repos_url":"https://api.github.com/users/ijc/repos","events_url":"https://api.github.com/users/ijc/events{/privacy}","received_events_url":"https://api.github.com/users/ijc/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":15,"created_at":"2018-09-10T09:12:22Z","updated_at":"2018-09-20T18:06:13Z","closed_at":"2018-09-20T16:57:31Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Description**\r\n\r\nI have a local (insecure) registry for debugging purposes. But I cannot run `manifest inspect` against it, even with `--insecure`.\r\n\r\n```\r\n$ docker -D manifest inspect --insecure 172.17.0.4:5000/foo:latest\r\nDEBU[0000] hostDir: /etc/docker/certs.d/172.17.0.4:5000 \r\nDEBU[0000] endpoints for 172.17.0.4:5000/foo:latest: [] \r\nDEBU[0000] hostDir: /etc/docker/certs.d/172.17.0.4:5000 \r\nDEBU[0000] endpoints for 172.17.0.4:5000/foo:latest: [] \r\nopen /etc/docker/certs.d/172.17.0.4:5000: permission denied\r\n```\r\n\r\n**Steps to reproduce the issue:**\r\n\r\nJust run `docker -D manifest inspect --insecure 172.17.0.4:5000/foo:latest`.\r\n\r\nThe registry and the image don't actually need to exist to hit the problem since it occurs before any sockets are opened etc (according to my quick look over the strace logs).\r\n\r\n**Describe the results you received:**\r\n\r\n```\r\nopen /etc/docker/certs.d/172.17.0.4:5000: permission denied\r\n```\r\n\r\n**Describe the results you expected:**\r\n\r\nThe manifest to be printed.\r\n\r\n**Additional information you deem important (e.g. issue happens only occasionally):**\r\n\r\nThe directory `/etc/docker/certs.d` doesn't exist, but in any case the permissions on `/etc/docker` are `0700`, also it seems odd to rely only on a system wide directory here. I couldn't find any setting or config file option which would redirect this to e.g. `~/.docker/certs.d`.\r\n\r\n**Output of `docker version`:**\r\n\r\n```\r\n$ docker version\r\nClient:\r\n Version:           18.06.0-ce\r\n API version:       1.38\r\n Go version:        go1.10.3\r\n Git commit:        0ffa825\r\n Built:             Wed Jul 18 19:09:33 2018\r\n OS/Arch:           linux/amd64\r\n Experimental:      true\r\n\r\nServer:\r\n Engine:\r\n  Version:          18.06.0-ce\r\n  API version:      1.38 (minimum version 1.12)\r\n  Go version:       go1.10.3\r\n  Git commit:       0ffa825\r\n  Built:            Wed Jul 18 19:07:38 2018\r\n  OS/Arch:          linux/amd64\r\n  Experimental:     true\r\n```\r\n\r\nAlso reproduced with 96dba79d99d69df9adc67b230d9dd39849733ef2 (recent master).\r\n\r\n**Output of `docker info`:**\r\n\r\n```\r\nContainers: 3\r\n Running: 3\r\n Paused: 0\r\n Stopped: 0\r\nImages: 178\r\nServer Version: 18.06.0-ce\r\nStorage Driver: overlay2\r\n Backing Filesystem: extfs\r\n Supports d_type: true\r\n Native Overlay Diff: true\r\nLogging Driver: json-file\r\nCgroup Driver: cgroupfs\r\nPlugins:\r\n Volume: local\r\n Network: bridge host ipvlan macvlan null overlay\r\n Log: awslogs fluentd gcplogs gelf journald json-file logentries splunk syslog\r\nSwarm: inactive\r\nRuntimes: runc\r\nDefault Runtime: runc\r\nInit Binary: docker-init\r\ncontainerd version: d64c661f1d51c48782c9cec8fda7604785f93587\r\nrunc version: 69663f0bd4b60df09991c08812a60108003fa340\r\ninit version: fec3683\r\nSecurity Options:\r\n apparmor\r\n seccomp\r\n  Profile: default\r\nKernel Version: 4.14.0-3-amd64\r\nOperating System: Debian GNU/Linux buster/sid\r\nOSType: linux\r\nArchitecture: x86_64\r\nCPUs: 4\r\nTotal Memory: 15.53GiB\r\nName: bokrug\r\nID: AU33:BO7D:7VGM:MOLB:RSDF:IBRV:GCWT:THHM:OEVM:TX3C:BNLM:WHAR\r\nDocker Root Dir: /var/lib/docker\r\nDebug Mode (client): false\r\nDebug Mode (server): true\r\n File Descriptors: 41\r\n Goroutines: 67\r\n System Time: 2018-09-10T10:09:15.802266701+01:00\r\n EventsListeners: 0\r\nUsername: ijc25\r\nRegistry: https://index.docker.io/v1/\r\nLabels:\r\nExperimental: true\r\nInsecure Registries:\r\n 127.0.0.0/8\r\nLive Restore Enabled: false\r\n\r\nWARNING: No swap limit support\r\n```\r\n\r\n**Additional environment details (AWS, VirtualBox, physical, etc.):**\r\n\r\nNative Linux (Debian) running docker-ce packages from `download.docker.com` apt repo.","closed_by":{"login":"vdemeester","id":6508,"node_id":"MDQ6VXNlcjY1MDg=","avatar_url":"https://avatars.githubusercontent.com/u/6508?v=4","gravatar_id":"","url":"https://api.github.com/users/vdemeester","html_url":"https://github.com/vdemeester","followers_url":"https://api.github.com/users/vdemeester/followers","following_url":"https://api.github.com/users/vdemeester/following{/other_user}","gists_url":"https://api.github.com/users/vdemeester/gists{/gist_id}","starred_url":"https://api.github.com/users/vdemeester/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vdemeester/subscriptions","organizations_url":"https://api.github.com/users/vdemeester/orgs","repos_url":"https://api.github.com/users/vdemeester/repos","events_url":"https://api.github.com/users/vdemeester/events{/privacy}","received_events_url":"https://api.github.com/users/vdemeester/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/docker/cli/issues/1358/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/docker/cli/issues/1358/timeline","performed_via_github_app":null,"state_reason":"completed"}