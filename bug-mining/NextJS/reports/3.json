{"url":"https://api.github.com/repos/vercel/next.js/issues/73130","repository_url":"https://api.github.com/repos/vercel/next.js","labels_url":"https://api.github.com/repos/vercel/next.js/issues/73130/labels{/name}","comments_url":"https://api.github.com/repos/vercel/next.js/issues/73130/comments","events_url":"https://api.github.com/repos/vercel/next.js/issues/73130/events","html_url":"https://github.com/vercel/next.js/issues/73130","id":2686604378,"node_id":"I_kwDOBC3Cis6gIlRa","number":73130,"title":"`use cache` directive does not work with notFound(), shows an error instead","user":{"login":"timomeh","id":4227520,"node_id":"MDQ6VXNlcjQyMjc1MjA=","avatar_url":"https://avatars.githubusercontent.com/u/4227520?v=4","gravatar_id":"","url":"https://api.github.com/users/timomeh","html_url":"https://github.com/timomeh","followers_url":"https://api.github.com/users/timomeh/followers","following_url":"https://api.github.com/users/timomeh/following{/other_user}","gists_url":"https://api.github.com/users/timomeh/gists{/gist_id}","starred_url":"https://api.github.com/users/timomeh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/timomeh/subscriptions","organizations_url":"https://api.github.com/users/timomeh/orgs","repos_url":"https://api.github.com/users/timomeh/repos","events_url":"https://api.github.com/users/timomeh/events{/privacy}","received_events_url":"https://api.github.com/users/timomeh/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2471906168,"node_id":"MDU6TGFiZWwyNDcxOTA2MTY4","url":"https://api.github.com/repos/vercel/next.js/labels/bug","name":"bug","color":"fddf99","default":true,"description":"Issue was opened via the bug report template."},{"id":5721224978,"node_id":"LA_kwDOBC3Cis8AAAABVQL3Eg","url":"https://api.github.com/repos/vercel/next.js/labels/locked","name":"locked","color":"ededed","default":false,"description":null},{"id":7684431993,"node_id":"LA_kwDOBC3Cis8AAAABygcgeQ","url":"https://api.github.com/repos/vercel/next.js/labels/Cache%20Components","name":"Cache Components","color":"ea02e9","default":false,"description":"Related to the `cacheComponents`, `useCache`, or `ppr` experimental flags."}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2024-11-23T21:10:18Z","updated_at":"2024-12-14T00:06:15Z","closed_at":"2024-11-29T19:45:23Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Link to the code that reproduces this issue\r\n\r\nhttps://github.com/timomeh/next-canaray24-not-found-issue\r\n\r\n### To Reproduce\r\n\r\n1. Start the app in dev (`npm run dev`)\r\n2. Open localhost:3000\r\n3. Click \"Example without use cache\". You should see it not throwing an error, and you should see the not-found page.\r\n4. Click \"Example with use cache\". You should see it throwing an error, and you should see the error page.\r\n\r\n### Current vs. Expected behavior\r\n\r\nBoth pages `/example-with-cache` and `/example-without-cache` have the same contents. The only difference is that `/example-with-cache/page.tsx` has an additional `'use cache'` directive.\r\n\r\n```tsx\r\n// example-without-cache/page.tsx\r\nimport { notFound } from \"next/navigation\"\r\n\r\nexport default async function Page() {\r\n  notFound()\r\n\r\n  return <div />\r\n}\r\n```\r\n\r\n```tsx\r\n// example-with-cache/page.tsx\r\nimport { notFound } from \"next/navigation\"\r\n\r\nexport default async function Page() {\r\n  'use cache'\r\n  notFound()\r\n\r\n  return <div />\r\n}\r\n```\r\n\r\nBoth pages call `notFound()`, so they both should render `not-found.tsx`.\r\n\r\nBut the second page `example-with-cache` does _not_ render `not-found.tsx`. Instead it renders the error page.\r\n\r\n### Provide environment information\r\n\r\n```bash\r\nOperating System:\r\n  Platform: darwin\r\n  Arch: arm64\r\n  Version: Darwin Kernel Version 23.6.0: Wed Jul 31 20:49:39 PDT 2024; root:xnu-10063.141.1.700.5~1/RELEASE_ARM64_T6000\r\n  Available memory (MB): 32768\r\n  Available CPU cores: 10\r\nBinaries:\r\n  Node: 20.17.0\r\n  npm: 10.8.2\r\n  Yarn: 1.22.22\r\n  pnpm: N/A\r\nRelevant Packages:\r\n  next: 15.0.4-canary.24 // Latest available version is detected (15.0.4-canary.24).\r\n  eslint-config-next: N/A\r\n  react: 19.0.0-rc-380f5d67-20241113\r\n  react-dom: 19.0.0-rc-380f5d67-20241113\r\n  typescript: 5.7.2\r\nNext.js Config:\r\n  output: N/A\r\n```\r\n\r\n\r\n### Which area(s) are affected? (Select all that apply)\r\n\r\ndynamicIO\r\n\r\n### Which stage(s) are affected? (Select all that apply)\r\n\r\nnext dev (local), next build (local), next start (local)\r\n\r\n### Additional context\r\n\r\nTerminal output:\r\n\r\n```\r\n тип src/app/example-with-cache/page.tsx (6:11) @ notFound\r\n тип unhandledRejection: Error: NEXT_HTTP_ERROR_FALLBACK\r\n    at notFound (src/app/example-with-cache/page.tsx:6:10)\r\n```\r\n\r\nKeywords for search: NEXT_HTTP_ERROR_FALLBACK, use cache, notFound, NEXT_HTTP_ERROR_FALLBACK;404","closed_by":{"login":"unstubbable","id":761683,"node_id":"MDQ6VXNlcjc2MTY4Mw==","avatar_url":"https://avatars.githubusercontent.com/u/761683?v=4","gravatar_id":"","url":"https://api.github.com/users/unstubbable","html_url":"https://github.com/unstubbable","followers_url":"https://api.github.com/users/unstubbable/followers","following_url":"https://api.github.com/users/unstubbable/following{/other_user}","gists_url":"https://api.github.com/users/unstubbable/gists{/gist_id}","starred_url":"https://api.github.com/users/unstubbable/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/unstubbable/subscriptions","organizations_url":"https://api.github.com/users/unstubbable/orgs","repos_url":"https://api.github.com/users/unstubbable/repos","events_url":"https://api.github.com/users/unstubbable/events{/privacy}","received_events_url":"https://api.github.com/users/unstubbable/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/vercel/next.js/issues/73130/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/vercel/next.js/issues/73130/timeline","performed_via_github_app":null,"state_reason":"completed"}