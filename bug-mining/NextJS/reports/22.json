{"url":"https://api.github.com/repos/vercel/next.js/issues/77073","repository_url":"https://api.github.com/repos/vercel/next.js","labels_url":"https://api.github.com/repos/vercel/next.js/issues/77073/labels{/name}","comments_url":"https://api.github.com/repos/vercel/next.js/issues/77073/comments","events_url":"https://api.github.com/repos/vercel/next.js/issues/77073/events","html_url":"https://github.com/vercel/next.js/issues/77073","id":2916378253,"node_id":"I_kwDOBC3Cis6t1GaN","number":77073,"title":"HMR and some /_next/static/ requests fail through a proxy","user":{"login":"PodkopovP","id":113348735,"node_id":"U_kgDOBsGQfw","avatar_url":"https://avatars.githubusercontent.com/u/113348735?v=4","gravatar_id":"","url":"https://api.github.com/users/PodkopovP","html_url":"https://github.com/PodkopovP","followers_url":"https://api.github.com/users/PodkopovP/followers","following_url":"https://api.github.com/users/PodkopovP/following{/other_user}","gists_url":"https://api.github.com/users/PodkopovP/gists{/gist_id}","starred_url":"https://api.github.com/users/PodkopovP/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/PodkopovP/subscriptions","organizations_url":"https://api.github.com/users/PodkopovP/orgs","repos_url":"https://api.github.com/users/PodkopovP/repos","events_url":"https://api.github.com/users/PodkopovP/events{/privacy}","received_events_url":"https://api.github.com/users/PodkopovP/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":3555423777,"node_id":"LA_kwDOBC3Cis7T63Yh","url":"https://api.github.com/repos/vercel/next.js/labels/Font%20(next/font)","name":"Font (next/font)","color":"0D3A54","default":false,"description":"Related to Next.js Font Optimization."},{"id":5721224978,"node_id":"LA_kwDOBC3Cis8AAAABVQL3Eg","url":"https://api.github.com/repos/vercel/next.js/labels/locked","name":"locked","color":"ededed","default":false,"description":null}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":10,"created_at":"2025-03-13T09:02:47Z","updated_at":"2025-04-05T12:02:17Z","closed_at":"2025-03-22T00:08:26Z","author_association":"NONE","type":{"id":1930995,"node_id":"IT_kwDOAOSnPM4AHXbz","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T15:36:35Z","updated_at":"2024-07-26T10:33:22Z","is_enabled":true},"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Link to the code that reproduces this issue\n\nhttps://codesandbox.io/p/sandbox/admin-dashboard-ppp3f8\n\n### To Reproduce\n\n1. Start the application in development\n2. Import some Google Next/Font packages\n3. Hit through a proxy (i.e. nginx)\n\n### Current vs. Expected behavior\n\nWhen I hit my Next server through a proxy, my browser should be able to make requests to https://local.test.com/_next/static/media/S6u8w4BMUTPHh30AXC_qNiXg7Q-s.p.01183af7.woff2 for example, and recieve the resource - since 15.2.2, I receieve a 403 Unauthorized error. There are no console errors, and logging in middleware reveals that those errors don't actually even reach the middleware stage.\n\nUsing the --hostname flag to replicate my proxy domain, this does work as expected, however this will not work with a multi-tenant system where the proxy domain can be dynamic.\n\nThis can be tested quite easily on any Next app by testing using the following request headers in an API agent like Postman:\n\nSUCCESS:\n\n\"Origin\": \"http://localhost:3025\"\n\nthis is the port it's actually running on, so if I query the page directly without nginx, this is the origin that would be attached\n\nSUCCESS:\n\n\"Origin\": \"http://localhost:1283189273981273981728397123\"\n\njust put a random port to see what would happen, and it works\n\nFAILURE:\n\n\"Origin\": \"https://local.hello.com/\"\n\nUsing a proxy, this is the origin that gets attached, and it fails\n\n\n\nI also noticed that since 15.2.2, I have to explicitly set Origin to \"\" in my Nginx proxy when hitting /_next/webpack-hmr, or else my HMR also fails.\n\n### Provide environment information\n\n```bash\nOperating System:\n  Platform: darwin\n  Arch: arm64\n  Version: Darwin Kernel Version 23.6.0: Mon Jul 29 21:14:30 PDT 2024; root:xnu-10063.141.2~1/RELEASE_ARM64_T6030\n  Available memory (MB): 18432\n  Available CPU cores: 11\nBinaries:\n  Node: 22.9.0\n  npm: 10.8.3\n  Yarn: 4.1.1\n  pnpm: 10.6.2\nRelevant Packages:\n  next: 15.2.2 // Latest available version is detected (15.2.2).\n  eslint-config-next: 15.2.0\n  react: 19.0.0\n  react-dom: 19.0.0\n  typescript: 5.7.3\nNext.js Config:\n  output: N/A\n```\n\n### Which area(s) are affected? (Select all that apply)\n\nFont (next/font)\n\n### Which stage(s) are affected? (Select all that apply)\n\nnext dev (local)\n\n### Additional context\n\nI tested on 15.2.1, and it does work as expected without making any changes. Everything since, and including, 15.2.2, including canary versions, give said errors.","closed_by":{"login":"ztanner","id":1939140,"node_id":"MDQ6VXNlcjE5MzkxNDA=","avatar_url":"https://avatars.githubusercontent.com/u/1939140?v=4","gravatar_id":"","url":"https://api.github.com/users/ztanner","html_url":"https://github.com/ztanner","followers_url":"https://api.github.com/users/ztanner/followers","following_url":"https://api.github.com/users/ztanner/following{/other_user}","gists_url":"https://api.github.com/users/ztanner/gists{/gist_id}","starred_url":"https://api.github.com/users/ztanner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ztanner/subscriptions","organizations_url":"https://api.github.com/users/ztanner/orgs","repos_url":"https://api.github.com/users/ztanner/repos","events_url":"https://api.github.com/users/ztanner/events{/privacy}","received_events_url":"https://api.github.com/users/ztanner/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/vercel/next.js/issues/77073/reactions","total_count":10,"+1":10,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/vercel/next.js/issues/77073/timeline","performed_via_github_app":null,"state_reason":"completed"}