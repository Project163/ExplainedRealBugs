{"url":"https://api.github.com/repos/vercel/next.js/issues/73413","repository_url":"https://api.github.com/repos/vercel/next.js","labels_url":"https://api.github.com/repos/vercel/next.js/issues/73413/labels{/name}","comments_url":"https://api.github.com/repos/vercel/next.js/issues/73413/comments","events_url":"https://api.github.com/repos/vercel/next.js/issues/73413/events","html_url":"https://github.com/vercel/next.js/issues/73413","id":2710363560,"node_id":"I_kwDOBC3Cis6hjN2o","number":73413,"title":"Importing ESM file from *next/client/*.js fails","user":{"login":"Sebmaster","id":347870,"node_id":"MDQ6VXNlcjM0Nzg3MA==","avatar_url":"https://avatars.githubusercontent.com/u/347870?v=4","gravatar_id":"","url":"https://api.github.com/users/Sebmaster","html_url":"https://github.com/Sebmaster","followers_url":"https://api.github.com/users/Sebmaster/followers","following_url":"https://api.github.com/users/Sebmaster/following{/other_user}","gists_url":"https://api.github.com/users/Sebmaster/gists{/gist_id}","starred_url":"https://api.github.com/users/Sebmaster/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Sebmaster/subscriptions","organizations_url":"https://api.github.com/users/Sebmaster/orgs","repos_url":"https://api.github.com/users/Sebmaster/repos","events_url":"https://api.github.com/users/Sebmaster/events{/privacy}","received_events_url":"https://api.github.com/users/Sebmaster/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2471906168,"node_id":"MDU6TGFiZWwyNDcxOTA2MTY4","url":"https://api.github.com/repos/vercel/next.js/labels/bug","name":"bug","color":"fddf99","default":true,"description":"Issue was opened via the bug report template."},{"id":3502418291,"node_id":"LA_kwDOBC3Cis7Qwqlz","url":"https://api.github.com/repos/vercel/next.js/labels/Webpack","name":"Webpack","color":"FF1E56","default":false,"description":"Related to Webpack with Next.js."},{"id":5721224978,"node_id":"LA_kwDOBC3Cis8AAAABVQL3Eg","url":"https://api.github.com/repos/vercel/next.js/labels/locked","name":"locked","color":"ededed","default":false,"description":null}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2024-12-02T03:39:37Z","updated_at":"2024-12-19T00:06:23Z","closed_at":"2024-12-04T17:33:10Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Link to the code that reproduces this issue\r\n\r\nhttps://github.com/Sebmaster/next-client-issue\r\n\r\n### To Reproduce\r\n\r\n1. `npm i`\r\n2. `npm run dev`\r\n3. Visit http://localhost:3000\r\n\r\n### Current vs. Expected behavior\r\n\r\nNo errors should display when opening the /home page. Instead the following error is in the browser console (which then causes follow-on issues):\r\n\r\n```\r\nReferenceError: exports is not defined\r\n    at eval (index.js:3:23)\r\n    at (:3000/app-pages-browser)/adapter-next/dist/client/index.js (http://localhost:3000/_next/static/chunks/app/page.js:61:1)\r\n    at options.factory (webpack.js:700:31)\r\n    at __webpack_require__ (webpack.js:37:33)\r\n    at fn (webpack.js:357:21)\r\n    at eval (page.tsx:6:80)\r\n    at (:3000/app-pages-browser)/app/page.tsx (http://localhost:3000/_next/static/chunks/app/page.js:28:1)\r\n    at options.factory (webpack.js:700:31)\r\n    at __webpack_require__ (webpack.js:37:33)\r\n    at fn (webpack.js:357:21)\r\n```\r\n\r\nThe following error is displayed in the build console:\r\n\r\n```\r\nAttempted import error: 'noop' is not exported from '@monorepo/adapter-next' (imported as 'noop').\r\n\r\nImport trace for requested module:\r\n./app/page.tsx\r\n тип app/page.tsx (6:7) @ noop\r\n тип TypeError: (0 , _monorepo_adapter_next__WEBPACK_IMPORTED_MODULE_1__.noop) is not a function\r\n    at Home (./app/page.tsx:11:65)\r\ndigest: \"1189400259\"\r\n  4 | /** Add your relevant code here for the issue to reproduce */\r\n  5 | export default function Home() {\r\n> 6 |   noop();\r\n    |       ^\r\n  7 |   return <div />;\r\n  8 | }\r\n  9 |\r\n```\r\n\r\n### Provide environment information\r\n\r\n```bash\r\nOperating System:\r\n  Platform: darwin\r\n  Arch: arm64\r\n  Version: Darwin Kernel Version 24.1.0: Thu Oct 10 21:00:32 PDT 2024; root:xnu-11215.41.3~2/RELEASE_ARM64_T6030\r\n  Available memory (MB): 36864\r\n  Available CPU cores: 12\r\nBinaries:\r\n  Node: 22.11.0\r\n  npm: 10.9.0\r\n  Yarn: N/A\r\n  pnpm: N/A\r\nRelevant Packages:\r\n  next: 15.0.4-canary.33 // Latest available version is detected (15.0.4-canary.33).\r\n  eslint-config-next: N/A\r\n  react: 19.0.0-rc-b01722d5-20241114\r\n  react-dom: 19.0.0-rc-b01722d5-20241114\r\n  typescript: 5.3.3\r\nNext.js Config:\r\n  output: N/A\r\n```\r\n\r\nThis issue also affects v14.\r\n\r\n\r\n### Which area(s) are affected? (Select all that apply)\r\n\r\nWebpack\r\n\r\n### Which stage(s) are affected? (Select all that apply)\r\n\r\nnext dev (local), next build (local)\r\n\r\n### Additional context\r\n\r\nThis issue only happens when the importing package is suffixed with `next` and the file is imported from a path including `client/`, so I'm assuming some special casing for nextjs internals are leaking into user packages. It doesn't happen for another suffix (like next2), it doesn't happen if the path doesn't contain a client/ dir.\r\n\r\nThe actual code throwing the error is specifically:\r\n```\r\nObject.defineProperty(exports, \"__esModule\", {\r\n    value: true\r\n});\r\nObject.defineProperty(exports, \"noop\", {\r\n    enumerable: true,\r\n    get: function() {\r\n        return noop;\r\n    }\r\n});\r\n```\r\n\r\nwhich is prepended to the compiled module output. Not sure if `exports` should actually be `__webpack_exports__`, or if that code shouldn't exist at all.","closed_by":{"login":"unstubbable","id":761683,"node_id":"MDQ6VXNlcjc2MTY4Mw==","avatar_url":"https://avatars.githubusercontent.com/u/761683?v=4","gravatar_id":"","url":"https://api.github.com/users/unstubbable","html_url":"https://github.com/unstubbable","followers_url":"https://api.github.com/users/unstubbable/followers","following_url":"https://api.github.com/users/unstubbable/following{/other_user}","gists_url":"https://api.github.com/users/unstubbable/gists{/gist_id}","starred_url":"https://api.github.com/users/unstubbable/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/unstubbable/subscriptions","organizations_url":"https://api.github.com/users/unstubbable/orgs","repos_url":"https://api.github.com/users/unstubbable/repos","events_url":"https://api.github.com/users/unstubbable/events{/privacy}","received_events_url":"https://api.github.com/users/unstubbable/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/vercel/next.js/issues/73413/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/vercel/next.js/issues/73413/timeline","performed_via_github_app":null,"state_reason":"completed"}