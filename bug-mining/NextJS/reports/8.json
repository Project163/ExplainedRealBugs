{"url":"https://api.github.com/repos/vercel/next.js/issues/73992","repository_url":"https://api.github.com/repos/vercel/next.js","labels_url":"https://api.github.com/repos/vercel/next.js/issues/73992/labels{/name}","comments_url":"https://api.github.com/repos/vercel/next.js/issues/73992/comments","events_url":"https://api.github.com/repos/vercel/next.js/issues/73992/events","html_url":"https://github.com/vercel/next.js/issues/73992","id":2743280770,"node_id":"I_kwDOBC3Cis6jgySC","number":73992,"title":"Server action throws when accessing headers if invoked before hydration","user":{"login":"jonathanhefner","id":771968,"node_id":"MDQ6VXNlcjc3MTk2OA==","avatar_url":"https://avatars.githubusercontent.com/u/771968?v=4","gravatar_id":"","url":"https://api.github.com/users/jonathanhefner","html_url":"https://github.com/jonathanhefner","followers_url":"https://api.github.com/users/jonathanhefner/followers","following_url":"https://api.github.com/users/jonathanhefner/following{/other_user}","gists_url":"https://api.github.com/users/jonathanhefner/gists{/gist_id}","starred_url":"https://api.github.com/users/jonathanhefner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jonathanhefner/subscriptions","organizations_url":"https://api.github.com/users/jonathanhefner/orgs","repos_url":"https://api.github.com/users/jonathanhefner/repos","events_url":"https://api.github.com/users/jonathanhefner/events{/privacy}","received_events_url":"https://api.github.com/users/jonathanhefner/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2471906168,"node_id":"MDU6TGFiZWwyNDcxOTA2MTY4","url":"https://api.github.com/repos/vercel/next.js/labels/bug","name":"bug","color":"fddf99","default":true,"description":"Issue was opened via the bug report template."},{"id":4932840687,"node_id":"LA_kwDOBC3Cis8AAAABJgUs7w","url":"https://api.github.com/repos/vercel/next.js/labels/linear:%20next","name":"linear: next","color":"A53EF5","default":false,"description":"Confirmed issue that is tracked by the Next.js team."},{"id":5721224978,"node_id":"LA_kwDOBC3Cis8AAAABVQL3Eg","url":"https://api.github.com/repos/vercel/next.js/labels/locked","name":"locked","color":"ededed","default":false,"description":null}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2024-12-16T19:57:52Z","updated_at":"2025-01-06T12:02:11Z","closed_at":"2024-12-20T18:46:52Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Link to the code that reproduces this issue\r\n\r\nhttps://codesandbox.io/p/devbox/nice-rgb-xsqkxt\r\n\r\n### To Reproduce\r\n\r\n1. Start the application in development.\r\n2. Open the preview in a dedicated browser tab.\r\n3. Disable JavaScript in that tab using the browser's dev console ([Chrome instructions](https://developer.chrome.com/docs/devtools/javascript/disable); in Firefox, click the cog wheel menu in the upper right corner of the debugger).\r\n4. Refresh the tab.\r\n5. On the application root page, click the \"Action without headers\" button.  Notice that the action _works_ and the browser is successfully redirected.\r\n6. Navigate back.\r\n7. On the application root page, click the \"Action with headers\" button.  The action _does not work_.  The following error appears in the server log:\r\n    ```\r\n     тип Error: `headers` was called outside a request scope. Read more: https://nextjs.org/docs/messages/next-dynamic-api-wrong-context\r\n        at headers (app/actions.ts:11:16)\r\n       9 |\r\n      10 | export async function actionWithHeaders() {\r\n    > 11 |   (await headers()).get(\"referer\");\r\n         |                ^\r\n      12 |   redirect(`/result/${Date.now()}`);\r\n      13 | }\r\n    ```\r\n\r\n### Current vs. Expected behavior\r\n\r\nI expect the `actionWithHeaders()` action to succeed just like the `actionWithoutHeaders()` action.  If for some reason that isn't possible, I expect a more accurate error message (`headers` is, in fact, being called inside a request scope).\r\n\r\n\r\n### Provide environment information\r\n\r\n```bash\r\nOperating System:\r\n  Platform: linux\r\n  Arch: x64\r\n  Version: #1 SMP PREEMPT_DYNAMIC Sun Aug  6 20:05:33 UTC 2023\r\n  Available memory (MB): 4102\r\n  Available CPU cores: 2\r\nBinaries:\r\n  Node: 20.9.0\r\n  npm: 9.8.1\r\n  Yarn: 1.22.19\r\n  pnpm: 8.10.2\r\nRelevant Packages:\r\n  next: 15.1.1-canary.6 // Latest available version is detected (15.1.1-canary.6).\r\n  eslint-config-next: N/A\r\n  react: 19.0.0\r\n  react-dom: 19.0.0\r\n  typescript: 5.3.3\r\nNext.js Config:\r\n  output: N/A\r\n```\r\n\r\n\r\n### Which area(s) are affected? (Select all that apply)\r\n\r\nNot sure\r\n\r\n### Which stage(s) are affected? (Select all that apply)\r\n\r\nnext dev (local)\r\n\r\n### Additional context\r\n\r\n_No response_","closed_by":{"login":"unstubbable","id":761683,"node_id":"MDQ6VXNlcjc2MTY4Mw==","avatar_url":"https://avatars.githubusercontent.com/u/761683?v=4","gravatar_id":"","url":"https://api.github.com/users/unstubbable","html_url":"https://github.com/unstubbable","followers_url":"https://api.github.com/users/unstubbable/followers","following_url":"https://api.github.com/users/unstubbable/following{/other_user}","gists_url":"https://api.github.com/users/unstubbable/gists{/gist_id}","starred_url":"https://api.github.com/users/unstubbable/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/unstubbable/subscriptions","organizations_url":"https://api.github.com/users/unstubbable/orgs","repos_url":"https://api.github.com/users/unstubbable/repos","events_url":"https://api.github.com/users/unstubbable/events{/privacy}","received_events_url":"https://api.github.com/users/unstubbable/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/vercel/next.js/issues/73992/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/vercel/next.js/issues/73992/timeline","performed_via_github_app":null,"state_reason":"completed"}