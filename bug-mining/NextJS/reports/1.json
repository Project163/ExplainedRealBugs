{"url":"https://api.github.com/repos/vercel/next.js/issues/72915","repository_url":"https://api.github.com/repos/vercel/next.js","labels_url":"https://api.github.com/repos/vercel/next.js/issues/72915/labels{/name}","comments_url":"https://api.github.com/repos/vercel/next.js/issues/72915/comments","events_url":"https://api.github.com/repos/vercel/next.js/issues/72915/events","html_url":"https://github.com/vercel/next.js/issues/72915","id":2668010931,"node_id":"I_kwDOBC3Cis6fBp2z","number":72915,"title":"Failed `npm run build` for Next.JS + Mongoose example","user":{"login":"reynaldichernando","id":12949382,"node_id":"MDQ6VXNlcjEyOTQ5Mzgy","avatar_url":"https://avatars.githubusercontent.com/u/12949382?v=4","gravatar_id":"","url":"https://api.github.com/users/reynaldichernando","html_url":"https://github.com/reynaldichernando","followers_url":"https://api.github.com/users/reynaldichernando/followers","following_url":"https://api.github.com/users/reynaldichernando/following{/other_user}","gists_url":"https://api.github.com/users/reynaldichernando/gists{/gist_id}","starred_url":"https://api.github.com/users/reynaldichernando/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/reynaldichernando/subscriptions","organizations_url":"https://api.github.com/users/reynaldichernando/orgs","repos_url":"https://api.github.com/users/reynaldichernando/repos","events_url":"https://api.github.com/users/reynaldichernando/events{/privacy}","received_events_url":"https://api.github.com/users/reynaldichernando/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":549032284,"node_id":"MDU6TGFiZWw1NDkwMzIyODQ=","url":"https://api.github.com/repos/vercel/next.js/labels/examples","name":"examples","color":"ecffaf","default":false,"description":"Issue was opened via the examples template."},{"id":5721224978,"node_id":"LA_kwDOBC3Cis8AAAABVQL3Eg","url":"https://api.github.com/repos/vercel/next.js/labels/locked","name":"locked","color":"ededed","default":false,"description":null}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2024-11-18T10:25:34Z","updated_at":"2024-12-03T00:07:32Z","closed_at":"2024-11-18T20:25:26Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Verify canary release\n\n- [X] I verified that the issue exists in the latest Next.js canary release\n\n### Provide environment information\n\n```bash\nOperating System:\r\n  Platform: darwin\r\n  Arch: arm64\r\n  Version: Darwin Kernel Version 24.1.0: Thu Oct 10 21:03:15 PDT 2024; root:xnu-11215.41.3~2/RELEASE_ARM64_T6000\r\n  Available memory (MB): 16384\r\n  Available CPU cores: 8\r\nBinaries:\r\n  Node: 18.20.2\r\n  npm: 10.5.0\r\n  Yarn: 1.22.22\r\n  pnpm: 9.9.0\r\nRelevant Packages:\r\n  next: 15.0.4-canary.17 // Latest available version is detected (15.0.4-canary.17).\r\n  eslint-config-next: N/A\r\n  react: 18.3.1\r\n  react-dom: 18.3.1\r\n  typescript: 5.6.3\r\nNext.js Config:\r\n  output: N/A\n```\n\n\n### Which example does this report relate to?\n\nwith-mongodb-mongoose\n\n### What browser are you using? (if relevant)\n\n-\n\n### How are you deploying your application? (if relevant)\n\n-\n\n### Describe the Bug\n\n<img width=\"850\" alt=\"image\" src=\"https://github.com/user-attachments/assets/c75854a8-8bdb-4a8c-93f1-b33b756c4260\">\r\nRunning `npm run build` on the Next.JS + Mongoose example will result in an error about MONGODB_URI not found (see above). This is because upon importing the `dbConnect.ts` file, it is already trying to get the environment variable even though it is not needed.\r\n\r\nhttps://github.com/vercel/next.js/blob/e3e3461fe80ec07f99b4927281d189720792c568/examples/with-mongodb-mongoose/lib/dbConnect.ts#L6\n\n### Expected Behavior\n\nThe build should succeed without MONGODB_URI in environment variable. This means moving the code for getting the environment variable inside the dbConnect function.\n\n### To Reproduce\n\n`npm run build`","closed_by":{"login":"samcx","id":28912696,"node_id":"MDQ6VXNlcjI4OTEyNjk2","avatar_url":"https://avatars.githubusercontent.com/u/28912696?v=4","gravatar_id":"","url":"https://api.github.com/users/samcx","html_url":"https://github.com/samcx","followers_url":"https://api.github.com/users/samcx/followers","following_url":"https://api.github.com/users/samcx/following{/other_user}","gists_url":"https://api.github.com/users/samcx/gists{/gist_id}","starred_url":"https://api.github.com/users/samcx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samcx/subscriptions","organizations_url":"https://api.github.com/users/samcx/orgs","repos_url":"https://api.github.com/users/samcx/repos","events_url":"https://api.github.com/users/samcx/events{/privacy}","received_events_url":"https://api.github.com/users/samcx/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/vercel/next.js/issues/72915/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/vercel/next.js/issues/72915/timeline","performed_via_github_app":null,"state_reason":"completed"}