{"url":"https://api.github.com/repos/vercel/next.js/issues/74062","repository_url":"https://api.github.com/repos/vercel/next.js","labels_url":"https://api.github.com/repos/vercel/next.js/issues/74062/labels{/name}","comments_url":"https://api.github.com/repos/vercel/next.js/issues/74062/comments","events_url":"https://api.github.com/repos/vercel/next.js/issues/74062/events","html_url":"https://github.com/vercel/next.js/issues/74062","id":2747315245,"node_id":"I_kwDOBC3Cis6jwLQt","number":74062,"title":"Turbopack does not handle CommonJS modules properly when \"type\": \"commonjs\" is specified in package.json","user":{"login":"saoudi-h","id":68503582,"node_id":"MDQ6VXNlcjY4NTAzNTgy","avatar_url":"https://avatars.githubusercontent.com/u/68503582?v=4","gravatar_id":"","url":"https://api.github.com/users/saoudi-h","html_url":"https://github.com/saoudi-h","followers_url":"https://api.github.com/users/saoudi-h/followers","following_url":"https://api.github.com/users/saoudi-h/following{/other_user}","gists_url":"https://api.github.com/users/saoudi-h/gists{/gist_id}","starred_url":"https://api.github.com/users/saoudi-h/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/saoudi-h/subscriptions","organizations_url":"https://api.github.com/users/saoudi-h/orgs","repos_url":"https://api.github.com/users/saoudi-h/repos","events_url":"https://api.github.com/users/saoudi-h/events{/privacy}","received_events_url":"https://api.github.com/users/saoudi-h/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2471906168,"node_id":"MDU6TGFiZWwyNDcxOTA2MTY4","url":"https://api.github.com/repos/vercel/next.js/labels/bug","name":"bug","color":"fddf99","default":true,"description":"Issue was opened via the bug report template."},{"id":4771244046,"node_id":"LA_kwDOBC3Cis8AAAABHGNoDg","url":"https://api.github.com/repos/vercel/next.js/labels/Turbopack","name":"Turbopack","color":"FF1E56","default":false,"description":"Related to Turbopack with Next.js."},{"id":5721224978,"node_id":"LA_kwDOBC3Cis8AAAABVQL3Eg","url":"https://api.github.com/repos/vercel/next.js/labels/locked","name":"locked","color":"ededed","default":false,"description":null}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2024-12-18T09:43:54Z","updated_at":"2025-01-23T00:05:06Z","closed_at":"2025-01-07T13:50:35Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Link to the code that reproduces this issue\n\nhttps://github.com/saoudi-h/commonjs-issue-next-turbopack\n\n### To Reproduce\n\nCreate a Next.js app using npx create-next-app.\r\nInstall Jotai (pnpm install jotai) or any other library that specifies \"type\": \"commonjs\" in its package.json.\r\nRun the application with Turbopack enabled (next dev --turbopack).\r\nImport the library into your project and attempt to use it.\n\n### Current vs. Expected behavior\n\nCurrent Behavior: The application throws an error due to an incompatibility between the \"type\": \"commonjs\" field in the library's package.json and Turbopack's handling of ESModules. This breaks the development server and prevents the application from running.\r\n\r\nExpected Behavior: Turbopack should handle CommonJS modules seamlessly, as per the Node.js module resolution standards, regardless of the \"type\" field in package.json.\n\n### Provide environment information\n\n```bash\nOperating System:\r\n  Platform: win32\r\n  Arch: x64\r\n  Version: Windows 11 Pro\r\n  Available memory (MB): 32695\r\n  Available CPU cores: 16\r\nBinaries:\r\n  Node: 20.11.1\r\n  npm: 10.2.4\r\n  Yarn: 1.22.19\r\n  pnpm: 8.15.3\r\nRelevant Packages:\r\n  next: 15.1.1 // Latest available version is detected (15.1.1).\r\n  eslint-config-next: 15.1.1\r\n  react: 19.0.0\r\n  react-dom: 19.0.0\r\n  typescript: 5.7.2\r\nNext.js Config:\r\n  output: N/A\n```\n\n\n### Which area(s) are affected? (Select all that apply)\n\nTurbopack\n\n### Which stage(s) are affected? (Select all that apply)\n\nnext dev (local)\n\n### Additional context\n\nThis issue was initially observed in a discussion in the [Jotai repository](https://github.com/pmndrs/jotai/discussions/2579). The maintainer pointed out that Turbopack does not respect the \"type\": \"commonjs\" field, leading to incompatibilities with libraries that follow the Node.js module conventions. While workarounds like patching the affected library or modifying its package.json exist, the root cause seems to be Turbopack's handling of CommonJS modules.\r\n\r\nIt would be great to address this issue as it could impact many libraries and developers using Turbopack in their Next.js projects.","closed_by":{"login":"lubieowoce","id":13698226,"node_id":"MDQ6VXNlcjEzNjk4MjI2","avatar_url":"https://avatars.githubusercontent.com/u/13698226?v=4","gravatar_id":"","url":"https://api.github.com/users/lubieowoce","html_url":"https://github.com/lubieowoce","followers_url":"https://api.github.com/users/lubieowoce/followers","following_url":"https://api.github.com/users/lubieowoce/following{/other_user}","gists_url":"https://api.github.com/users/lubieowoce/gists{/gist_id}","starred_url":"https://api.github.com/users/lubieowoce/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lubieowoce/subscriptions","organizations_url":"https://api.github.com/users/lubieowoce/orgs","repos_url":"https://api.github.com/users/lubieowoce/repos","events_url":"https://api.github.com/users/lubieowoce/events{/privacy}","received_events_url":"https://api.github.com/users/lubieowoce/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/vercel/next.js/issues/74062/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/vercel/next.js/issues/74062/timeline","performed_via_github_app":null,"state_reason":"completed"}