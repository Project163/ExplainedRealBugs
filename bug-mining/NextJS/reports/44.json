{"url":"https://api.github.com/repos/vercel/next.js/issues/77810","repository_url":"https://api.github.com/repos/vercel/next.js","labels_url":"https://api.github.com/repos/vercel/next.js/issues/77810/labels{/name}","comments_url":"https://api.github.com/repos/vercel/next.js/issues/77810/comments","events_url":"https://api.github.com/repos/vercel/next.js/issues/77810/events","html_url":"https://github.com/vercel/next.js/issues/77810","id":2970881206,"node_id":"I_kwDOBC3Cis6xFAy2","number":77810,"title":"Non-deterministic IDs in Static Export HTML/TXT Files","user":{"login":"avernikoz","id":18717529,"node_id":"MDQ6VXNlcjE4NzE3NTI5","avatar_url":"https://avatars.githubusercontent.com/u/18717529?v=4","gravatar_id":"","url":"https://api.github.com/users/avernikoz","html_url":"https://github.com/avernikoz","followers_url":"https://api.github.com/users/avernikoz/followers","following_url":"https://api.github.com/users/avernikoz/following{/other_user}","gists_url":"https://api.github.com/users/avernikoz/gists{/gist_id}","starred_url":"https://api.github.com/users/avernikoz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/avernikoz/subscriptions","organizations_url":"https://api.github.com/users/avernikoz/orgs","repos_url":"https://api.github.com/users/avernikoz/repos","events_url":"https://api.github.com/users/avernikoz/events{/privacy}","received_events_url":"https://api.github.com/users/avernikoz/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":3502418291,"node_id":"LA_kwDOBC3Cis7Qwqlz","url":"https://api.github.com/repos/vercel/next.js/labels/Webpack","name":"Webpack","color":"FF1E56","default":false,"description":"Related to Webpack with Next.js."},{"id":4932840687,"node_id":"LA_kwDOBC3Cis8AAAABJgUs7w","url":"https://api.github.com/repos/vercel/next.js/labels/linear:%20next","name":"linear: next","color":"A53EF5","default":false,"description":"Confirmed issue that is tracked by the Next.js team."},{"id":5721224978,"node_id":"LA_kwDOBC3Cis8AAAABVQL3Eg","url":"https://api.github.com/repos/vercel/next.js/labels/locked","name":"locked","color":"ededed","default":false,"description":null}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2025-04-03T23:10:56Z","updated_at":"2025-06-19T00:06:08Z","closed_at":"2025-06-04T23:31:59Z","author_association":"NONE","type":{"id":1930995,"node_id":"IT_kwDOAOSnPM4AHXbz","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T15:36:35Z","updated_at":"2024-07-26T10:33:22Z","is_enabled":true},"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Link to the code that reproduces this issue\n\nhttps://github.com/avernikoz/nextjs-non-deterministic-ids\n\n### To Reproduce\n\n1. Clone the [reproduction repository](https://github.com/avernikoz/nextjs-non-deterministic-ids)\n2. Install dependencies: `npm install`\n3. Run the build: `npm run build`\n4. Check any HTML file in the `out` directory (e.g., `out/index.html` or `out/blog.html`) - note the 21-character ID\n5. Run the build again: `npm run build`\n6. Compare the same HTML file - notice the ID has changed despite no code changes\n\nNote: Setting `generateBuildId` in next.config.js to return a static value doesn't affect this behavior - the IDs still change between builds.\n\n\n### Current vs. Expected behavior\n\n**Current Behavior:**\nEach build generates new random-looking 21-character IDs (containing alphanumeric characters plus `-` and `_`) that appear in both:\n- The HTML version of each page (`/out/index.html`)\n- The TXT version of the same page (`/out/index.txt`)\n```\n<!-- /out/index.html -->\n    <script>\n      self.__next_f.push([\n        1,\n        '0:{\"P\":null,\"b\":\"static-build-id-v1\",\"p\":\"\",\"c\":[\"\",\"\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"__PAGE__\",{}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/b3cbcd051438d1d5.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"__className_d65c78\",\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\\\"Segoe UI\\\\\",Roboto,Helvetica,Arial,sans-serif,\\\\\"Apple Color Emoji\\\\\",\\\\\"Segoe UI Emoji\\\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[[\"$\",\"div\",null,{\"children\":[\"$\",\"h1\",null,{\"children\":\"Home page\"}]}],\"$undefined\",null,[\"$\",\"$L4\",null,{\"children\":[\"$L5\",\"$L6\",null]}]]}],{},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"8did5CzdK-_FUXgUnI31p\",{\"children\":[[\"$\",\"$L7\",null,{\"children\":\"$L8\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}],[\"$\",\"$L9\",null,{\"children\":\"$La\"}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$b\",\"$undefined\"],\"s\":false,\"S\":true}\\n',\n      ]);\n    </script>\n<!-- /out/index.txt -->\n// Same ID appears here: 8did5CzdK-_FUXgUnI31p\n```\nExample from second build (same code):\n```\n<!-- /out/index.html -->\n    <script>\n      self.__next_f.push([\n        1,\n        '0:{\"P\":null,\"b\":\"static-build-id-v1\",\"p\":\"\",\"c\":[\"\",\"\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"__PAGE__\",{}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/b3cbcd051438d1d5.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"__className_d65c78\",\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\\\"Segoe UI\\\\\",Roboto,Helvetica,Arial,sans-serif,\\\\\"Apple Color Emoji\\\\\",\\\\\"Segoe UI Emoji\\\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[[\"$\",\"div\",null,{\"children\":[\"$\",\"h1\",null,{\"children\":\"Home page\"}]}],\"$undefined\",null,[\"$\",\"$L4\",null,{\"children\":[\"$L5\",\"$L6\",null]}]]}],{},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"Wo-j9eG_HP1r23sgh1j2d\",{\"children\":[[\"$\",\"$L7\",null,{\"children\":\"$L8\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}],[\"$\",\"$L9\",null,{\"children\":\"$La\"}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$b\",\"$undefined\"],\"s\":false,\"S\":true}\\n',\n      ]);\n    </script>\n<!-- /out/index.txt -->\n// Same ID appears here: Wo-j9eG_HP1r23sgh1j2d\n```\n\nNote how the ID changes (`8did5CzdK-_FUXgUnI31p` â†’ `Wo-j9eG_HP1r23sgh1j2d`) between builds despite identical source code and static build ID.\n\n**Expected Behavior:**\nEither:\n1. These IDs should be deterministic between builds when the source code hasn't changed, similar to how `generateBuildId` works for the build ID\n2. Or Next.js should provide a configuration option to make these IDs deterministic in cases where it doesn't break the intended design\n\n\n### Provide environment information\n\n```bash\nOperating System:\n  Platform: darwin\n  Arch: x64\n  Version: Darwin Kernel Version 23.6.0: Thu Dec 19 20:44:50 PST 2024; root:xnu-10063.141.1.703.2~1/RELEASE_X86_64\n  Available memory (MB): 65536\n  Available CPU cores: 16\nBinaries:\n  Node: 20.11.0\n  npm: 10.2.4\n  Yarn: 1.22.4\n  pnpm: 9.6.0\nRelevant Packages:\n  next: 15.2.4\n  eslint-config-next: N/A\n  react: 19.1.0\n  react-dom: 19.1.0\n  typescript: 5.7.3\nNext.js Config:\n  output: export\n```\n\n### Which area(s) are affected? (Select all that apply)\n\nWebpack\n\n### Which stage(s) are affected? (Select all that apply)\n\nnext build (local), Other (Deployed)\n\n### Additional context\n- The IDs appear in script tags in the HTML and corresponding locations in TXT files\n- The purpose of these IDs is not immediately clear from the build output or documentation\n- The IDs are 21 characters long and contain alphanumeric characters plus `-` and `_`\n- Each page gets its own unique ID, but that ID is shared between its HTML and TXT versions\n- While IDs are consistent between HTML and TXT files within the same build, they change completely on subsequent builds\n- This affects build reproducibility, cache invalidation, and deployment comparisons\n\nI've spent several days trying to track down the source of these non-deterministic IDs in Next.js/React RSC source code without success. If the Next.js team could point to where this ID generation happens, I'd be happy to work on a fix and submit a PR.\n\n### Questions\n1. What is the purpose of these IDs?\n2. Is their non-deterministic nature intentional?\n3. If they need to be unique per build, could this be documented?\n4. Is there a way to make these IDs static/deterministic between builds?\n5. If not, what's the technical reason preventing deterministic ID generation, given that even `generateBuildId` doesn't affect these IDs?","closed_by":{"login":"ztanner","id":1939140,"node_id":"MDQ6VXNlcjE5MzkxNDA=","avatar_url":"https://avatars.githubusercontent.com/u/1939140?v=4","gravatar_id":"","url":"https://api.github.com/users/ztanner","html_url":"https://github.com/ztanner","followers_url":"https://api.github.com/users/ztanner/followers","following_url":"https://api.github.com/users/ztanner/following{/other_user}","gists_url":"https://api.github.com/users/ztanner/gists{/gist_id}","starred_url":"https://api.github.com/users/ztanner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ztanner/subscriptions","organizations_url":"https://api.github.com/users/ztanner/orgs","repos_url":"https://api.github.com/users/ztanner/repos","events_url":"https://api.github.com/users/ztanner/events{/privacy}","received_events_url":"https://api.github.com/users/ztanner/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/vercel/next.js/issues/77810/reactions","total_count":7,"+1":7,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/vercel/next.js/issues/77810/timeline","performed_via_github_app":null,"state_reason":"completed"}