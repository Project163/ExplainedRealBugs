{"url":"https://api.github.com/repos/vercel/next.js/issues/83354","repository_url":"https://api.github.com/repos/vercel/next.js","labels_url":"https://api.github.com/repos/vercel/next.js/issues/83354/labels{/name}","comments_url":"https://api.github.com/repos/vercel/next.js/issues/83354/comments","events_url":"https://api.github.com/repos/vercel/next.js/issues/83354/events","html_url":"https://github.com/vercel/next.js/issues/83354","id":3377376013,"node_id":"I_kwDOBC3Cis7JTqsN","number":83354,"title":"Dynamic Routes with Rewrites are severely broken in latest version","user":{"login":"blairmcalpine","id":97198784,"node_id":"U_kgDOBcsiwA","avatar_url":"https://avatars.githubusercontent.com/u/97198784?v=4","gravatar_id":"","url":"https://api.github.com/users/blairmcalpine","html_url":"https://github.com/blairmcalpine","followers_url":"https://api.github.com/users/blairmcalpine/followers","following_url":"https://api.github.com/users/blairmcalpine/following{/other_user}","gists_url":"https://api.github.com/users/blairmcalpine/gists{/gist_id}","starred_url":"https://api.github.com/users/blairmcalpine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/blairmcalpine/subscriptions","organizations_url":"https://api.github.com/users/blairmcalpine/orgs","repos_url":"https://api.github.com/users/blairmcalpine/repos","events_url":"https://api.github.com/users/blairmcalpine/events{/privacy}","received_events_url":"https://api.github.com/users/blairmcalpine/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":3499418124,"node_id":"LA_kwDOBC3Cis7QlOIM","url":"https://api.github.com/repos/vercel/next.js/labels/Middleware","name":"Middleware","color":"3116D4","default":false,"description":"Related to Next.js Middleware."},{"id":4279919987,"node_id":"LA_kwDOBC3Cis7_GmVz","url":"https://api.github.com/repos/vercel/next.js/labels/Runtime","name":"Runtime","color":"f81ce5","default":false,"description":"Related to Node.js or Edge Runtime with Next.js."},{"id":5721224978,"node_id":"LA_kwDOBC3Cis8AAAABVQL3Eg","url":"https://api.github.com/repos/vercel/next.js/labels/locked","name":"locked","color":"ededed","default":false,"description":null},{"id":8068724755,"node_id":"LA_kwDOBC3Cis8AAAAB4O74Ew","url":"https://api.github.com/repos/vercel/next.js/labels/Dynamic%20Routes","name":"Dynamic Routes","color":"A4336B","default":false,"description":"Related to dynamic routes."}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2025-09-02T20:20:21Z","updated_at":"2025-09-18T00:05:02Z","closed_at":"2025-09-03T11:04:40Z","author_association":"NONE","type":{"id":1930995,"node_id":"IT_kwDOAOSnPM4AHXbz","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T15:36:35Z","updated_at":"2024-07-26T10:33:22Z","is_enabled":true},"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Link to the code that reproduces this issue\n\nhttps://github.com/blairmcalpine/ssg-middleware-rewrite-no-cache\n\n### To Reproduce\n\n1. Run `npm i && npm build`\n2. Run `npm start` and visit the following:\nhttp://localhost:3000\nhttp://localhost:3000/1\nhttp://localhost:3000/working\nNotice for all of these, there is a server log about cache sets & gets. That is, these work properly for caching static routes.\n\nNow visit\nhttp://localhost:3000/broken\n\nNotice that there isn't a server log about cache sets and gets for this route. This is the bug - static routes that involve both a middleware rewrite and dynamic route segment (made static through generateStaticParams) aren't properly considered for caching.\n\nI believe this broke as part of [this commit](https://github.com/vercel/next.js/commit/d884398da6c55f662115cd1b3ff19e72fb6bb8d5#diff-bc87cb622b355cd3ead736f9eddee557676ff9520362113061cedcbc78166cbf), which changed how prerenderInfo was calculated in app-page.ts. This means isSSG evaluates to false in that same file, which it shouldn't.\n\nAs an aside, while creating this reproduction I discovered a potentially even worse bug:\n\nVisit http://localhost:3000/mega-broken/1\n\nThis gives a 404. Despite the route existing, the combination of a middleware rewrite, dynamic route segment, and static route segment seems to be very problematic and the page won't even be found. I'd imagine this is a pretty common use case that just doesn't work at all.\n\n### Current vs. Expected behavior\n\nI expect static routes that use middleware rewrites & dynamic route segments to be considered properly static. Right now they're not and aren't being cached at all.\n\nFor the aside bug, I'd expect the page to properly load instead of returning a 404.\n\n### Provide environment information\n\n```bash\nOperating System:\n  Platform: darwin\n  Arch: arm64\n  Version: Darwin Kernel Version 24.6.0: Mon Jul 14 11:30:40 PDT 2025; root:xnu-11417.140.69~1/RELEASE_ARM64_T6041\n  Available memory (MB): 49152\n  Available CPU cores: 14\nBinaries:\n  Node: 22.15.1\n  npm: 10.9.2\n  Yarn: 1.22.22\n  pnpm: N/A\nRelevant Packages:\n  next: 15.5.2 // Latest available version is detected (15.5.2).\n  eslint-config-next: 15.5.2\n  react: 19.1.0\n  react-dom: 19.1.0\n  typescript: 5.9.2\nNext.js Config:\n  output: N/A\n```\n\n### Which area(s) are affected? (Select all that apply)\n\nMiddleware, Runtime, Dynamic Routes\n\n### Which stage(s) are affected? (Select all that apply)\n\nnext start (local), next dev (local)\n\n### Additional context\n\n_No response_","closed_by":{"login":"wyattjoh","id":633002,"node_id":"MDQ6VXNlcjYzMzAwMg==","avatar_url":"https://avatars.githubusercontent.com/u/633002?v=4","gravatar_id":"","url":"https://api.github.com/users/wyattjoh","html_url":"https://github.com/wyattjoh","followers_url":"https://api.github.com/users/wyattjoh/followers","following_url":"https://api.github.com/users/wyattjoh/following{/other_user}","gists_url":"https://api.github.com/users/wyattjoh/gists{/gist_id}","starred_url":"https://api.github.com/users/wyattjoh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wyattjoh/subscriptions","organizations_url":"https://api.github.com/users/wyattjoh/orgs","repos_url":"https://api.github.com/users/wyattjoh/repos","events_url":"https://api.github.com/users/wyattjoh/events{/privacy}","received_events_url":"https://api.github.com/users/wyattjoh/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/vercel/next.js/issues/83354/reactions","total_count":19,"+1":19,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/vercel/next.js/issues/83354/timeline","performed_via_github_app":null,"state_reason":"completed"}