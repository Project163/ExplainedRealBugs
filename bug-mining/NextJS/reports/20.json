{"url":"https://api.github.com/repos/vercel/next.js/issues/76810","repository_url":"https://api.github.com/repos/vercel/next.js","labels_url":"https://api.github.com/repos/vercel/next.js/issues/76810/labels{/name}","comments_url":"https://api.github.com/repos/vercel/next.js/issues/76810/comments","events_url":"https://api.github.com/repos/vercel/next.js/issues/76810/events","html_url":"https://github.com/vercel/next.js/issues/76810","id":2895147097,"node_id":"I_kwDOBC3Cis6skHBZ","number":76810,"title":"Streaming Metadata: Favicon Not Applied on Initial Load","user":{"login":"ryanburns23","id":17202389,"node_id":"MDQ6VXNlcjE3MjAyMzg5","avatar_url":"https://avatars.githubusercontent.com/u/17202389?v=4","gravatar_id":"","url":"https://api.github.com/users/ryanburns23","html_url":"https://github.com/ryanburns23","followers_url":"https://api.github.com/users/ryanburns23/followers","following_url":"https://api.github.com/users/ryanburns23/following{/other_user}","gists_url":"https://api.github.com/users/ryanburns23/gists{/gist_id}","starred_url":"https://api.github.com/users/ryanburns23/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ryanburns23/subscriptions","organizations_url":"https://api.github.com/users/ryanburns23/orgs","repos_url":"https://api.github.com/users/ryanburns23/repos","events_url":"https://api.github.com/users/ryanburns23/events{/privacy}","received_events_url":"https://api.github.com/users/ryanburns23/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":3555293326,"node_id":"LA_kwDOBC3Cis7T6XiO","url":"https://api.github.com/repos/vercel/next.js/labels/Metadata","name":"Metadata","color":"CEC038","default":false,"description":"Related to Next.js' Metadata API."},{"id":4932840687,"node_id":"LA_kwDOBC3Cis8AAAABJgUs7w","url":"https://api.github.com/repos/vercel/next.js/labels/linear:%20next","name":"linear: next","color":"A53EF5","default":false,"description":"Confirmed issue that is tracked by the Next.js team."},{"id":5721224978,"node_id":"LA_kwDOBC3Cis8AAAABVQL3Eg","url":"https://api.github.com/repos/vercel/next.js/labels/locked","name":"locked","color":"ededed","default":false,"description":null}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2025-03-04T18:54:04Z","updated_at":"2025-03-26T12:02:10Z","closed_at":"2025-03-12T11:18:33Z","author_association":"NONE","type":{"id":1930995,"node_id":"IT_kwDOAOSnPM4AHXbz","name":"Bug","description":"An unexpected problem or behavior","color":"red","created_at":"2024-01-25T15:36:35Z","updated_at":"2024-07-26T10:33:22Z","is_enabled":true},"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Link to the code that reproduces this issue\n\nhttps://github.com/ryanburns23/nextjs-streaming-metadata-bug\n\n### To Reproduce\n\n1. Open the deployed [reproduction example](https://nextjs-streaming-metadata-bug.vercel.app/) in Chrome.\n2. Wait approximately 1.5 seconds for the metadata to stream in. Observe that the favicon does not update.\n\nAdditional context:\n\n- Clicking the button to navigate to \"page2\" correctly updates the favicon.\n- This issue only occurs on the initial page load.\n\n### Current vs. Expected behavior\n\nCurrent behavior:\n\nNext.js 15.2 introduced [Streaming Metadata](https://nextjs.org/blog/next-15-2#streaming-metadata). When using streaming metadata in a project with dynamic routes and dynamic favicons, Chrome doesn't apply the favicon upon initial load. While the metadata and tags are correctly streamed and appended to the end of the <body> tag once generated, Chrome fails to recognize and display the favicon initially.\n\nExpected behavior:\n\nThe favicon should correctly update and display immediately after streaming metadata loads, even on initial page load.\n\n### Provide environment information\n\n```bash\nOperating System:\n  Platform: darwin\n  Arch: arm64\n  Version: Darwin Kernel Version 24.1.0: Thu Oct 10 21:03:11 PDT 2024; root:xnu-11215.41.3~2/RELEASE_ARM64_T6020\n  Available memory (MB): 98304\n  Available CPU cores: 12\nBinaries:\n  Node: 22.13.0\n  npm: 10.9.2\n  Yarn: N/A\n  pnpm: 10.2.0\nRelevant Packages:\n  next: 15.2.2-canary.0 // Latest available version is detected (15.2.2-canary.0).\n  eslint-config-next: N/A\n  react: 19.0.0\n  react-dom: 19.0.0\n  typescript: 5.8.2\nNext.js Config:\n  output: N/A\n```\n\n### Which area(s) are affected? (Select all that apply)\n\nMetadata\n\n### Which stage(s) are affected? (Select all that apply)\n\nnext dev (local), next build (local), next start (local), Vercel (Deployed)\n\n### Additional context\n\n- Tested with Chrome 133.0.6943.142\n- This appears to be specifically related to Chrome's handling of dynamically streamed favicons.\n- Subsequent navigations to other routes with dynamic metadata correctly update the favicon, confirming that this issue is isolated to the initial page load scenario. Notably, the key difference during subsequent navigations is that metadata tags are appended directly to the `<head>`, rather than the `<body>` as seen on initial load. A potential solution could involve ensuring that initially streamed metadata tags are also appended to the `<head>` instead of the `<body>`.\n- While potentially a browser-level issue, it may be valuable for Next.js to investigate possible workarounds or mitigations.\n","closed_by":{"login":"huozhi","id":4800338,"node_id":"MDQ6VXNlcjQ4MDAzMzg=","avatar_url":"https://avatars.githubusercontent.com/u/4800338?v=4","gravatar_id":"","url":"https://api.github.com/users/huozhi","html_url":"https://github.com/huozhi","followers_url":"https://api.github.com/users/huozhi/followers","following_url":"https://api.github.com/users/huozhi/following{/other_user}","gists_url":"https://api.github.com/users/huozhi/gists{/gist_id}","starred_url":"https://api.github.com/users/huozhi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/huozhi/subscriptions","organizations_url":"https://api.github.com/users/huozhi/orgs","repos_url":"https://api.github.com/users/huozhi/repos","events_url":"https://api.github.com/users/huozhi/events{/privacy}","received_events_url":"https://api.github.com/users/huozhi/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/vercel/next.js/issues/76810/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/vercel/next.js/issues/76810/timeline","performed_via_github_app":null,"state_reason":"completed"}