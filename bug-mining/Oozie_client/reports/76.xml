<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:48:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OOZIE-1319] &quot;LAST_ONLY&quot; in execution control for coordinator job still runs all the actions</title>
                <link>https://issues.apache.org/jira/browse/OOZIE-1319</link>
                <project id="12311620" key="OOZIE">Oozie (Retired)</project>
                    <description>&lt;p&gt;In execute() of CoordJobGetReadyActionsJPAExecutor.java, once we retrieve the top item from a &quot;LIFO&quot; query result, we do not discard or delete the remaining items from the result list. As a result, the next time execute() is invoked, we will be retrieving the next item in line. Consequently, LAST_ONLY strategy will also execute all ready actions for a given coordinator job, making it no different than LIFO.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12642069">OOZIE-1319</key>
            <summary>&quot;LAST_ONLY&quot; in execution control for coordinator job still runs all the actions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rkanter">Robert Kanter</assignee>
                                    <reporter username="bowenzhangusa">Bowen Zhang</reporter>
                        <labels>
                    </labels>
                <created>Thu, 11 Apr 2013 16:45:47 +0000</created>
                <updated>Thu, 28 May 2015 11:58:54 +0000</updated>
                            <resolved>Fri, 30 May 2014 21:39:53 +0000</resolved>
                                                    <fixVersion>4.1.0</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="13630438" author="tucu00" created="Fri, 12 Apr 2013 18:22:36 +0000"  >&lt;p&gt;it seems like bug&lt;/p&gt;</comment>
                            <comment id="13630460" author="bowenzhangusa" created="Fri, 12 Apr 2013 18:37:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tucu00&quot; class=&quot;user-hover&quot; rel=&quot;tucu00&quot;&gt;tucu00&lt;/a&gt;, what should be the status of the actions we skipped using LAST_ONLY execution? Should we introduce a new status called &quot;SKIPPED&quot;? or do we use &quot;KILLED&quot;.&lt;/p&gt;</comment>
                            <comment id="13635657" author="tucu00" created="Thu, 18 Apr 2013 20:33:17 +0000"  >&lt;p&gt;It seems that a new &apos;SKIPPED&apos; status makes more sense. We have to make sure this does not break things.&lt;/p&gt;</comment>
                            <comment id="13668822" author="tucu00" created="Tue, 28 May 2013 23:54:04 +0000"  >&lt;p&gt;Apologies for the delay. patch LGTM. One more thing we may have to take care is in the purge logic, can you please check this?&lt;/p&gt;

&lt;p&gt;Any reason why it has not been marked as &apos;submit patch&apos; for test-patch to run?&lt;/p&gt;</comment>
                            <comment id="13668827" author="bowenzhangusa" created="Wed, 29 May 2013 00:03:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tucu00&quot; class=&quot;user-hover&quot; rel=&quot;tucu00&quot;&gt;tucu00&lt;/a&gt;, I will take a look at the purge logic.&lt;/p&gt;</comment>
                            <comment id="13668829" author="rkanter" created="Wed, 29 May 2013 00:06:04 +0000"  >&lt;p&gt;I don&apos;t think this should affect the purge logic.  I just took a quick look and it doesn&apos;t search for coordinator actions; the way it deletes coordinator actions is by searching for the underlying workflows and deleting all of the coordinator actions when we delete the coordinator job (after verifying some other stuff of course).  &lt;/p&gt;</comment>
                            <comment id="13668898" author="hadoopqa" created="Wed, 29 May 2013 01:33:26 +0000"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/OOZIE-1319&quot; title=&quot;&amp;quot;LAST_ONLY&amp;quot; in execution control for coordinator job still runs all the actions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OOZIE-1319&quot;&gt;&lt;del&gt;OOZIE-1319&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Cleaning local svn workspace&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; the patch contains 3 line(s) longer than 132 characters&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 2 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;WARNING&lt;/font&gt;: the current HEAD has 1 Javadoc warning(s)&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; the patch seems to introduce 1 new javac warning(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 BACKWARDS_COMPATIBILITY&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not change any JPA Entity/Colum/Basic/Lob/Transient annotations&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not modify JPA files&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 1240&lt;br/&gt;
.    Tests failed: 0&lt;br/&gt;
.    Tests errors: 1109&lt;/p&gt;

&lt;p&gt;.    The patch failed the following testcases:&lt;/p&gt;

&lt;p&gt;.      &lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;&lt;b&gt;-1 Overall result, please check the reported -1(s)&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;.   There is at least one warning, please check&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/oozie-trunk-precommit-build/546/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/oozie-trunk-precommit-build/546/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13669824" author="bowenzhangusa" created="Wed, 29 May 2013 22:36:56 +0000"  >&lt;p&gt;I don&apos;t think the test failures are related to my changes.&lt;/p&gt;</comment>
                            <comment id="13669878" author="rkanter" created="Wed, 29 May 2013 23:28:25 +0000"  >&lt;p&gt;Probably not; can you reupload the patch to run the tests again?  It&apos;s doing that thing were it can&apos;t lock some directory for the mini dfs cluster; hopefully its fixed itself by now.  &lt;/p&gt;</comment>
                            <comment id="13669883" author="tucu00" created="Wed, 29 May 2013 23:31:49 +0000"  >&lt;p&gt;no need to reupload, i&apos;ve kicked the build for this patch manually.&lt;/p&gt;</comment>
                            <comment id="13682869" author="tucu00" created="Thu, 13 Jun 2013 22:59:25 +0000"  >&lt;p&gt;+1, pending jenkins, kicking off jenkins manually.&lt;/p&gt;</comment>
                            <comment id="13682927" author="hadoopqa" created="Fri, 14 Jun 2013 00:14:02 +0000"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/OOZIE-1319&quot; title=&quot;&amp;quot;LAST_ONLY&amp;quot; in execution control for coordinator job still runs all the actions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OOZIE-1319&quot;&gt;&lt;del&gt;OOZIE-1319&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Cleaning local svn workspace&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; the patch contains 3 line(s) longer than 132 characters&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 2 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 BACKWARDS_COMPATIBILITY&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not change any JPA Entity/Colum/Basic/Lob/Transient annotations&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not modify JPA files&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 1247&lt;br/&gt;
.    Tests failed: 1&lt;br/&gt;
.    Tests errors: 0&lt;/p&gt;

&lt;p&gt;.    The patch failed the following testcases:&lt;/p&gt;

&lt;p&gt;.      testCoordinatorActionEvent(org.apache.oozie.event.TestEventGeneration)&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;&lt;b&gt;-1 Overall result, please check the reported -1(s)&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/oozie-trunk-precommit-build/584/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/oozie-trunk-precommit-build/584/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13683969" author="hadoopqa" created="Sat, 15 Jun 2013 00:34:58 +0000"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/OOZIE-1319&quot; title=&quot;&amp;quot;LAST_ONLY&amp;quot; in execution control for coordinator job still runs all the actions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OOZIE-1319&quot;&gt;&lt;del&gt;OOZIE-1319&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Cleaning local svn workspace&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; the patch contains 3 line(s) longer than 132 characters&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 2 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 BACKWARDS_COMPATIBILITY&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not change any JPA Entity/Colum/Basic/Lob/Transient annotations&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not modify JPA files&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 1248&lt;br/&gt;
.    Tests failed: 1&lt;br/&gt;
.    Tests errors: 0&lt;/p&gt;

&lt;p&gt;.    The patch failed the following testcases:&lt;/p&gt;

&lt;p&gt;.      testCoordinatorActionEvent(org.apache.oozie.event.TestEventGeneration)&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;&lt;b&gt;-1 Overall result, please check the reported -1(s)&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/oozie-trunk-precommit-build/595/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/oozie-trunk-precommit-build/595/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13684042" author="tucu00" created="Sat, 15 Jun 2013 02:58:46 +0000"  >&lt;p&gt;Bowen, could you please check if the failure is related or not?&lt;/p&gt;</comment>
                            <comment id="13966113" author="rkanter" created="Fri, 11 Apr 2014 01:22:56 +0000"  >&lt;p&gt;I tried out the patch by modifying the aggregator example to be LAST_ONLY and removing the input data from HDFS.  Once both actions were WAITING, I uploaded the data back into HDFS.  I was expecting the first (&amp;#64;1) action to go WAITING --&amp;gt; READY --&amp;gt; SKIPPED and the second (&amp;#64;2) action to go WAITING --&amp;gt; READY --&amp;gt; RUNNING --&amp;gt; SUCCEEDED.  However, they both went WAITING --&amp;gt; READY --&amp;gt; RUNNING --&amp;gt; SUCCEEDED; though they did it in LIFO order (that is, &amp;#64;2 then &amp;#64;1).  So, it doesn&apos;t look like this is working properly.  Looking at the code, I think it looks like it should work.  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bowenzhangusa&quot; class=&quot;user-hover&quot; rel=&quot;bowenzhangusa&quot;&gt;bowenzhangusa&lt;/a&gt;, any ideas?&lt;/p&gt;

&lt;p&gt;Also, so I don&apos;t forget, the patch should also update the documentation to mention the SKIPPED status here: &lt;br/&gt;
&lt;a href=&quot;https://oozie.apache.org/docs/4.0.1/CoordinatorFunctionalSpec.html#a6.1.3.2._Coordinator_Action_Status&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://oozie.apache.org/docs/4.0.1/CoordinatorFunctionalSpec.html#a6.1.3.2._Coordinator_Action_Status&lt;/a&gt;&lt;br/&gt;
and also where it talks about LAST_ONLY here: &lt;br/&gt;
&lt;a href=&quot;https://oozie.apache.org/docs/4.0.1/CoordinatorFunctionalSpec.html#a6.3._Synchronous_Coordinator_Application_Definition&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://oozie.apache.org/docs/4.0.1/CoordinatorFunctionalSpec.html#a6.3._Synchronous_Coordinator_Application_Definition&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13966323" author="bowenzhangusa" created="Fri, 11 Apr 2014 08:21:42 +0000"  >&lt;p&gt;I think the concurrency also need to be 2 if you get two actions in waiting. Overall, this execution control is not really a well-defined property.&lt;/p&gt;</comment>
                            <comment id="13966921" author="rkanter" created="Fri, 11 Apr 2014 18:23:06 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think the concurrency also need to be 2 if you get two actions in waiting.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;That just made both actions do RUNNING at the same time instead of in sequence&lt;/p&gt;

&lt;p&gt;I think the problem is that the query used to get the Jobs is this (for FIFO; FILO is just this with the order as &quot;desc&quot;):&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;select a.id, a.jobId, a.statusStr, a.pending, a.nominalTimestamp, a.createdTimestamp from CoordinatorActionBean a where a.jobId = :jobId AND a.statusStr = &apos;READY&apos; order by a.nominalTimestamp
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Even though I made the data available for both actions at the same time, Oozie didn&apos;t transition them to READY at the same time, so when this query was executed, there was only ever 1 action in READY &amp;#8211; that&apos;s why it didn&apos;t seem to do anything.  I was thinking that this may depend partly on the timing of the actions transitioning from WAITING to READY, which doesn&apos;t happen simultaneously for all actions.  &lt;br/&gt;
I tried modifying the example to have 4 actions; I then waited for all of them to be WAITING and put up the data; the &amp;#64;4 went to RUNNING and the rest eventually went to READY.  I was then expecting those to go to SKIPPED because the query should be looking for them; however, they stayed READY and just went in sequence to RUNNING and SUCCEEDED.&lt;/p&gt;

&lt;p&gt;tldr; the patch isn&apos;t working &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;Overall, this execution control is not really a well-defined property.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;My understanding of LAST_ONLY is that if multiple actions are WAITING or READY, only one of them should actually run while the rest are skipped.  What&apos;s not clear to me is if the &quot;LAST&quot; means the oldest action (i.e. the &lt;em&gt;last&lt;/em&gt; one in the list) or the newest action (i.e. the &lt;em&gt;last&lt;/em&gt; one to be added); though this isn&apos;t too hard to switch around once we get the rest of this working.  It may make sense to add a &quot;FIRST_ONLY&quot; for the opposite or something.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bowenzhangusa&quot; class=&quot;user-hover&quot; rel=&quot;bowenzhangusa&quot;&gt;bowenzhangusa&lt;/a&gt;, are you planning on still doing this?  Or do you mind if I take a stab at it?&lt;/p&gt;</comment>
                            <comment id="13966928" author="bowenzhangusa" created="Fri, 11 Apr 2014 18:28:14 +0000"  >&lt;p&gt;go ahead and take it. But, don&apos;t try too hard since I haven&apos;t encountered any customers using this property.&lt;/p&gt;</comment>
                            <comment id="13967878" author="shaik.idris" created="Sun, 13 Apr 2014 16:26:06 +0000"  >&lt;p&gt;We have some usecases related to realtime data pipeline with frequency around minutes(5), this feature is very handy specially when we have huge backlog of workflow instances, wherein we just pick the latest action and discard the rest.&lt;/p&gt;</comment>
                            <comment id="13970612" author="shwethags" created="Wed, 16 Apr 2014 09:43:09 +0000"  >&lt;p&gt;Does purge delete the old skipped coord actions? Please make sure that they are deleted, else it will just fill up the DB&lt;/p&gt;</comment>
                            <comment id="13971556" author="rkanter" created="Wed, 16 Apr 2014 15:38:05 +0000"  >&lt;p&gt;I&apos;m still working on the patch, but it should delete the SKIPPED actions because when looking for entries to delete, it only looks at the jobs; it then deletes all actions belonging to the job without looking at their status.  In other words, the actions&apos; statuses don&apos;t actually matter.&lt;/p&gt;</comment>
                            <comment id="13972202" author="rkanter" created="Thu, 17 Apr 2014 01:33:04 +0000"  >&lt;p&gt;I&apos;ve had to re-work the approach that the original patch was taking.  In the original patch, it only looks at the currently READY actions; we actually want to skip any unscheduled actions (i.e. READY or WAITING).  So, when I was trying it out, what was happening is that the actions didn&apos;t all become READY at the same time, so it wasn&apos;t skipping any.  &lt;/p&gt;

&lt;p&gt;The new patch keeps the SKIPPED status stuff from the original patch, but we now check when we materialize actions.  Basically, whenever we materialize action(s) we want to skip all but the latest unscheduled action.  &lt;/p&gt;</comment>
                            <comment id="13972213" author="hadoopqa" created="Thu, 17 Apr 2014 01:53:01 +0000"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/OOZIE-1319&quot; title=&quot;&amp;quot;LAST_ONLY&amp;quot; in execution control for coordinator job still runs all the actions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OOZIE-1319&quot;&gt;&lt;del&gt;OOZIE-1319&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Cleaning local git workspace&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; Patch failed to apply to head of branch&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;</comment>
                            <comment id="13972244" author="rkanter" created="Thu, 17 Apr 2014 02:37:59 +0000"  >&lt;p&gt;Rebased patch on latest trunk&lt;/p&gt;</comment>
                            <comment id="13972294" author="hadoopqa" created="Thu, 17 Apr 2014 04:12:43 +0000"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/OOZIE-1319&quot; title=&quot;&amp;quot;LAST_ONLY&amp;quot; in execution control for coordinator job still runs all the actions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OOZIE-1319&quot;&gt;&lt;del&gt;OOZIE-1319&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Cleaning local git workspace&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; the patch contains 4 line(s) longer than 132 characters&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 4 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 BACKWARDS_COMPATIBILITY&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not change any JPA Entity/Colum/Basic/Lob/Transient annotations&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not modify JPA files&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 1422&lt;br/&gt;
.    Tests failed: 0&lt;br/&gt;
.    Tests errors: 1&lt;/p&gt;

&lt;p&gt;.    The patch failed the following testcases:&lt;/p&gt;

&lt;p&gt;.      &lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;&lt;b&gt;-1 Overall result, please check the reported -1(s)&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/oozie-trunk-precommit-build/1176/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/oozie-trunk-precommit-build/1176/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13972320" author="rkanter" created="Thu, 17 Apr 2014 05:30:11 +0000"  >&lt;p&gt;The 4 lines that are too long are for namedQueries and twiki formatting.  Test failure is unrelated.&lt;/p&gt;</comment>
                            <comment id="13972802" author="shwethags" created="Thu, 17 Apr 2014 09:56:29 +0000"  >&lt;blockquote&gt;
&lt;p&gt;I&apos;m still working on the patch, but it should delete the SKIPPED actions because when looking for entries to delete, it only looks at the jobs; it then deletes all actions belonging to the job without looking at their status. In other words, the actions&apos; statuses don&apos;t actually matter.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Since skipped coord actions will not have any workflow jobs, just want to make sure this is handled. Great if its already taken care. Thanks&lt;/p&gt;</comment>
                            <comment id="13973128" author="rkanter" created="Thu, 17 Apr 2014 16:32:08 +0000"  >&lt;blockquote&gt;&lt;p&gt;Since skipped coord actions will not have any workflow jobs, just want to make sure this is handled. Great if its already taken care. Thanks&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yup, actions are deleted when their associated jobs are deleted.  For example, all Coordinator actions, regardless of status or anything else, are deleted when their associated Coordinator Job is deleted.  &lt;/p&gt;</comment>
                            <comment id="13980084" author="rkanter" created="Thu, 24 Apr 2014 18:45:06 +0000"  >&lt;p&gt;Rebased on latest trunk&lt;/p&gt;</comment>
                            <comment id="13980253" author="hadoopqa" created="Thu, 24 Apr 2014 20:44:22 +0000"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/OOZIE-1319&quot; title=&quot;&amp;quot;LAST_ONLY&amp;quot; in execution control for coordinator job still runs all the actions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OOZIE-1319&quot;&gt;&lt;del&gt;OOZIE-1319&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Cleaning local git workspace&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; the patch contains 4 line(s) longer than 132 characters&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 4 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 BACKWARDS_COMPATIBILITY&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not change any JPA Entity/Colum/Basic/Lob/Transient annotations&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not modify JPA files&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 1426&lt;br/&gt;
.    Tests failed: 3&lt;br/&gt;
.    Tests errors: 4&lt;/p&gt;

&lt;p&gt;.    The patch failed the following testcases:&lt;/p&gt;

&lt;p&gt;.      testConcurrencyReachedAndChooseNextEligible(org.apache.oozie.service.TestCallableQueueService)&lt;br/&gt;
.      testTimeOutWithUnresolvedMissingDependencies(org.apache.oozie.command.coord.TestCoordPushDependencyCheckXCommand)&lt;br/&gt;
.      testCoordinatorActionCommandsSubmitAndStart(org.apache.oozie.sla.TestSLAEventGeneration)&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;&lt;b&gt;-1 Overall result, please check the reported -1(s)&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/oozie-trunk-precommit-build/1197/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/oozie-trunk-precommit-build/1197/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13980516" author="bowenzhangusa" created="Thu, 24 Apr 2014 23:58:12 +0000"  >&lt;p&gt;By spotting your patch, I see two things.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;By definition, &quot;execution order&quot; means &quot;the execution order if multiple instances of the coordinator job have satisfied their execution criteria&quot; which means instances that fulfill both data and time dependency and ready to run. You added the &quot;handleLastOnly()&quot; in CoordMaterializeTransitionXCommand which changes the logic of regular materialization. After your changes, any coordinator job with &quot;LAST_ONLY&quot; execution will only execute the last action in EACH MATERIALIZATION WINDOW. For example, suppose right now is 9am and I submit a coordinator job with &quot;LAST_ONLY&quot; and 10 minutes frequency which starts at 10 am and ends at 1pm. As a result, among all the 18 actions, only actions with nominal time of 10:50am, 11:50am, and 12:50pm will run. All the others will be SKIPPED. That is not correct behavior.&lt;/li&gt;
	&lt;li&gt;We should not create JPAExecutor class anymore. Your query name &quot;GET_UNSCHEDULED_ACTIONS&quot; should be put into CoordActionQueryExecutor.java.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13981461" author="rkanter" created="Fri, 25 Apr 2014 19:06:27 +0000"  >&lt;p&gt;I think this will work if I update &lt;tt&gt;handleLastOnly()&lt;/tt&gt; to check if the nominal time for the action is in the past.  If it&apos;s in the past, then Oozie is doing &quot;catch up&quot; and the current behavior of &lt;tt&gt;handleLastOnly()&lt;/tt&gt; is correct.  If it&apos;s in the future, then &lt;tt&gt;handleLastOnly()&lt;/tt&gt; should do nothing to it (so the original behavior remains and it will be WAITING/READY).  Does this sound right?  &lt;/p&gt;

&lt;p&gt;I&apos;ll get rid of the JPAExecutor in the next patch.&lt;/p&gt;</comment>
                            <comment id="13981488" author="bowenzhangusa" created="Fri, 25 Apr 2014 19:30:28 +0000"  >&lt;p&gt;The right logic change should really happen in CoordActionReadyXCommand instead of materialization stage. Your new approach will not work in the following two scenarios:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;If a coordinator job starts at 9am and ends at 12pm with frequency of 10 minutes. And oozie server is back up at 11am. It is supposed to only run the action at 10:50 am and forward. However, your new code will run the action at 10:50am AS WELL AS the action at 9:50am.&lt;/li&gt;
	&lt;li&gt;Same coordinator job with a data dependency and oozie server is always up. The job starts at 9am, but the data dependency fulfills only at 11am. ALL actions will run since they are all marked as &quot;WAITING&quot; and no logic in CoordActionREadyXCommand.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13981526" author="rkanter" created="Fri, 25 Apr 2014 20:06:24 +0000"  >&lt;p&gt;The second part of &lt;tt&gt;handleLastOnly()&lt;/tt&gt; actually retrieves all READY or WAITING actions already created and sets them to SKIPPED.  In other words, when materializing actions, if it sees any previously materialized actions READY/WAITING, they&apos;ll be set to SKIPPED.  So in those two scenarios, I believe it will actually work correctly.  &lt;/p&gt;

&lt;p&gt;The only time we need to set an action to SKIPPED is if its READY/WAITING and a newer action gets materialized.  So I think putting the code in CoordMaterializeTransitionXCommand makes sense with this in mind.  I think the issue now is that it doesn&apos;t take into account if we&apos;re materializing future actions or not, in which case, it needs to not do this behavior.&lt;/p&gt;</comment>
                            <comment id="13981614" author="bowenzhangusa" created="Fri, 25 Apr 2014 21:13:35 +0000"  >&lt;p&gt;Neither of the two scenarios are guaranteed to work.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The first scenario, &lt;blockquote&gt;&lt;p&gt;In other words, when materializing actions, if it sees any previously materialized actions READY/WAITING, they&apos;ll be set to SKIPPED.&lt;/p&gt;&lt;/blockquote&gt; After oozie server is back up, when you run the second materialization, previously materialized actions may already be in RUNNING state or even &quot;SUCCEEDED&quot; state, therefore your &quot;get_unscheduled_actions&quot; query won&apos;t retrieve them.&lt;/li&gt;
	&lt;li&gt;Second scenario, what if the data dependency is fulfilled at 10:30am? All the WAITING actions will be in &quot;READY&quot; state. You need to wait till 10:55am to kick off your materialization logic.&lt;/li&gt;
	&lt;li&gt;Third point, your &quot;GET_UNSCHEDULED_ACTIONS&quot; query is retrieving all actions regardless the execution order of the parent coord jobs.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13981725" author="rkanter" created="Fri, 25 Apr 2014 22:49:33 +0000"  >&lt;blockquote&gt;&lt;p&gt;After oozie server is back up, when you run the second materialization, previously materialized actions may already be in RUNNING state or even &quot;SUCCEEDED&quot; state, therefore your &quot;get_unscheduled_actions&quot; query won&apos;t retrieve them.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Isn&apos;t that the correct behavior?  If the action is already running, then I think we should not kill it.  &lt;/p&gt;

&lt;p&gt;In the second scenario, there would only be one WAITING action becuase the older ones should be SKIPPED.  My understanding of LAST_ONLY, is that if there are any WAITING or READY actions in the past, they should all be SKIPPED except for the latest one.  WAITING or READY actions in the future should be unaffected (though my patch doesn&apos;t do this yet).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Third point, your &quot;GET_UNSCHEDULED_ACTIONS&quot; query is retrieving all actions regardless the execution order of the parent coord jobs.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It only runs &quot;GET_UNSCHEDULED_ACTIONS&quot; if the coordinator job&apos;s execution strategy is LAST_ONLY; there&apos;s an if statement in &lt;tt&gt;handleLastOnly()&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="13981787" author="bowenzhangusa" created="Sat, 26 Apr 2014 00:09:53 +0000"  >&lt;p&gt;Let me give a more detailed description of the two scenarios&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;same coordinator job. If oozie server is back up at 11am, CoordMaterializationService will run immediately and create 6 actions from 9am to 9:50am which the first 5 actions will be &quot;SKIPPED&quot;. At the same time, RecoveryService is very likely to kick off the action at 9:50am and turn the action into &quot;SUCCEEDED&quot; even before your CoordMaterializationService runs again to materialize actions from 10am to 10:50am where your &quot;GET_UNSCHEDULED_ACTIONS&quot; won&apos;t be able to retrieve the action at 9:50am. As a result, both actions at 9:50am and 10:50am are &quot;SUCCEEDED&quot;. This is not the correct behavior.&lt;/li&gt;
	&lt;li&gt;same coordinator job with a data dependency. oozie server is always up from the beginning. If data dependency is fulfilled at 10:35am, then by definition, the action at 10:30 am should run and all the previous ones should be &quot;SKIPPED&quot;. But in your code, everything will run into &quot;SUCCEEDED&quot; since the next CoordMaterializationService will run and try to materialize new actions at 10:55 am. At 10:30 am, there are already 12 actions in &quot;WAITING&quot; state in the database since at 8:55 am and 9:55 am, actions ARE NOT marked &quot;SKIPPED&quot; during materialization stage.&lt;/li&gt;
	&lt;li&gt;&lt;blockquote&gt;&lt;p&gt; It only runs &quot;GET_UNSCHEDULED_ACTIONS&quot; if the coordinator job&apos;s execution strategy is LAST_ONLY; there&apos;s an if statement in handleLastOnly() &lt;/p&gt;&lt;/blockquote&gt; Not true. What if at the same time, another coordinator job with &quot;LIFO&quot; execution order is running? Will you &quot;SKIPPED&quot; all its actions?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13981788" author="bowenzhangusa" created="Sat, 26 Apr 2014 00:15:21 +0000"  >&lt;p&gt;correction for my second point. In the second scenario, actions from 9:00 am to 9:50 am will be correctly skipped, but actions from 10:00 am till 10:50 am will run to &quot;SUCCEDDED&quot;.&lt;/p&gt;</comment>
                            <comment id="13981803" author="rkanter" created="Sat, 26 Apr 2014 00:31:50 +0000"  >&lt;p&gt;First scenario: I understand now.  You are correct and this doesn&apos;t work properly because of the windowing.  It needs to take into account all of the backlogged actions.&lt;/p&gt;

&lt;p&gt;Second scenario: I understand now.  The CoordMaterializationService doesn&apos;t run frequently enough against this coordinator job (and it&apos;s not supposed to) for what I did to work properly.  &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Not true. What if at the same time, another coordinator job with &quot;LIFO&quot; execution order is running? Will you &quot;SKIPPED&quot; all its actions?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I was being stupid here &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
The query should take the coordinator job id as an argument.  Good catch; I was only trying this with one coord job, so I didn&apos;t run into this being an issue.&lt;/p&gt;


&lt;p&gt;I think you might be right and I need to look into maybe doing something in CoordActionReadyXCommand or possibly both there and CoordMaterializeTransitionXCommand.  Whatever it is, it definitely needs to take into account if a materialization is in the future or in the past because the behavior should be different.  Materialized actions in the past should be SKIPPED (except for the latest one once we catch up or the job ends), while materialized actions in the future should not be SKIPPED because we haven&apos;t gotten there yet.  And when materializing in the past, the materialization window makes things trickier.  &lt;br/&gt;
Do you agree?&lt;/p&gt;</comment>
                            <comment id="13981821" author="rkanter" created="Sat, 26 Apr 2014 01:10:01 +0000"  >&lt;p&gt;Here&apos;s a rough idea of what I&apos;m currently thinking:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;When materializing actions in CoordMaterializeTransitionXCommand, if we&apos;re in the past and LAST_ONLY, then it needs to materialize &lt;b&gt;all&lt;/b&gt; actions until &quot;now&quot; or the end of the job (whichever is earliest) and set all but the latest one to SKIPPED (so we ignore the window in this case).  And when materializing more actions (at the next window), it should set any old WAITING ones to SKIPPED as well.  This doesn&apos;t touch any actions materialized in the future.&lt;/li&gt;
	&lt;li&gt;When getting READY actions in CoordActionReadyXCommand, only the latest READY action should become SUBMITTED; the rest should be SKIPPED (re-use LIFO query here)&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Just a note to clarify: even with LAST_ONLY it is possible for multiple jobs to be RUNNING at the same time.  e.g. if an older action that used to be the latest is still RUNNING when new actions come along, then that older action and the latest of the newer actions could both be RUNNING.  &lt;/p&gt;</comment>
                            <comment id="13983819" author="rkanter" created="Tue, 29 Apr 2014 00:51:45 +0000"  >&lt;p&gt;The new patch attempts to do what I described in my previous comment.  I believe it now properly handles actions in the past and in the present/future.  I&apos;ve also updated the documentation to explain LAST_ONLY a bit more.&lt;/p&gt;</comment>
                            <comment id="13983820" author="rkanter" created="Tue, 29 Apr 2014 00:52:00 +0000"  >&lt;p&gt;I&apos;ve also uploaded the patch to ReviewBoard: &lt;a href=&quot;https://reviews.apache.org/r/20822/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/20822/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13983896" author="hadoopqa" created="Tue, 29 Apr 2014 02:25:58 +0000"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/OOZIE-1319&quot; title=&quot;&amp;quot;LAST_ONLY&amp;quot; in execution control for coordinator job still runs all the actions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OOZIE-1319&quot;&gt;&lt;del&gt;OOZIE-1319&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Cleaning local git workspace&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; the patch contains 3 line(s) longer than 132 characters&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 7 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; the patch seems to introduce 1 new javac warning(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 BACKWARDS_COMPATIBILITY&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not change any JPA Entity/Colum/Basic/Lob/Transient annotations&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not modify JPA files&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 1445&lt;br/&gt;
.    Tests failed: 5&lt;br/&gt;
.    Tests errors: 2&lt;/p&gt;

&lt;p&gt;.    The patch failed the following testcases:&lt;/p&gt;

&lt;p&gt;.      testQueueUniquenessWithSameKey(org.apache.oozie.service.TestCallableQueueService)&lt;br/&gt;
.      testJobLog(org.apache.oozie.client.TestOozieCLI)&lt;br/&gt;
.      testCoordinatorActionCommandsSubmitAndStart(org.apache.oozie.sla.TestSLAEventGeneration)&lt;br/&gt;
.      testTimeOutWithUnresolvedMissingDependencies(org.apache.oozie.command.coord.TestCoordPushDependencyCheckXCommand)&lt;br/&gt;
.      testBundleId(org.apache.oozie.servlet.TestBulkMonitorWebServiceAPI)&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;&lt;b&gt;-1 Overall result, please check the reported -1(s)&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/oozie-trunk-precommit-build/1205/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/oozie-trunk-precommit-build/1205/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13983995" author="rkanter" created="Tue, 29 Apr 2014 04:45:47 +0000"  >&lt;p&gt;Test failures appear to be unrelated&lt;/p&gt;</comment>
                            <comment id="13988812" author="bowenzhangusa" created="Sat, 3 May 2014 21:26:30 +0000"  >&lt;p&gt;two things here:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;A job with frequency of 10 mins and starts from 10 am till 12 pm. Say, none of the data dependency is fulfilled. Your code will break if all of the data dependencies are fulfilled between 10:55 am and 11am. Since at 10:55 am, you SKIPPED all actions in the first hour and materialize all future actions. But by definition, if all data dependencies are available at 10:56 am, then, the action at 10:50 am should run.&lt;/li&gt;
	&lt;li&gt;This is a bigger issue with your change in CoordActionReadyXCommand. Say, a job with 10 mins frequency starts from 10 am to 11am. And all the data dependencies are realized at 10:35 am. So by definition, actions at 10:00, 10:10, and 10:20 will be SKIPPED. But, do you realize that CoordActionReadyXCommand is invoked per action in CoordActionInputCheckXCommand right after each action is set to READY? And the query &quot;GET_COORD_ACTIONS_WAITING_SUBMITTED_OLDER_THAN&quot; has no order preference. As a result, all your &quot;for loop&quot; in ReadyXCommand will only contain one action which you set to SUBMITTED. It&apos;s very likely at the end, all actions will be run.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13990054" author="rkanter" created="Mon, 5 May 2014 22:26:46 +0000"  >&lt;p&gt;You&apos;re right, those two cases will both be problematic.  I&apos;m not sure of a good way to solve them; any ideas?&lt;/p&gt;

&lt;p&gt;What if we made it LAST_ONLY a little more restrictive and have it effectively set the timeout equal to the frequency?  I believe this would help prevent the second case because even if a bunch of data dependencies get satisfied at the same time, the older actions would have already TIMEDOUT, so you&apos;d only have the current one.&lt;/p&gt;</comment>
                            <comment id="13990273" author="chitnis" created="Tue, 6 May 2014 04:55:05 +0000"  >&lt;blockquote&gt;&lt;p&gt;A job with frequency of 10 mins and starts from 10 am till 12 pm. Say, none of the data dependency is fulfilled. Your code will break if all of the data dependencies are fulfilled between 10:55 am and 11am. Since at 10:55 am, you SKIPPED all actions in the first hour &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If materialization occurred at 10:55, why is 10:50 action SKIPPED? it would be the last eligible action in this case right?&lt;/p&gt;

&lt;p&gt;So we are going to have a case with multiple CoordActionReadyX commands queued up all looping over each other. To resolve this, you could have an action know the total SUBMITTED count so far and look only towards its predecessor. &lt;br/&gt;
e.g. &lt;br/&gt;
if action 10:50, n(SUBMITTED) = 0/1, own status - READY, action 10:40 - SUBMITTED,&lt;br/&gt;
then action 10:40 -&amp;gt; SKIPPED, action 10:50 -&amp;gt; SUBMITTED&lt;/p&gt;

&lt;p&gt;but, if action 10:50, n(SUBMITTED) = 1, own status - READY, action 10:40 - RUNNING,&lt;br/&gt;
then action 10:50 would have to mark itself as SKIPPED right?&lt;/p&gt;</comment>
                            <comment id="13990279" author="bowenzhangusa" created="Tue, 6 May 2014 05:05:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chitnis&quot; class=&quot;user-hover&quot; rel=&quot;chitnis&quot;&gt;chitnis&lt;/a&gt;, &lt;blockquote&gt;&lt;p&gt;If materialization occurred at 10:55, why is 10:50 action SKIPPED? it would be the last eligible action in this case right?&lt;/p&gt;&lt;/blockquote&gt;, this is the expected behavior, but not what his code is going to do. His new function of handleLastOnly will mark all actions as &quot;SKIPPED&quot; during materialization event.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt; e.g.&lt;br/&gt;
if action 10:50, n(SUBMITTED) = 0/1, own status - READY, action 10:40 - SUBMITTED,&lt;br/&gt;
then action 10:40 -&amp;gt; SKIPPED, action 10:50 -&amp;gt; SUBMITTED&lt;/p&gt;

&lt;p&gt;but, if action 10:50, n(SUBMITTED) = 1, own status - READY, action 10:40 - RUNNING,&lt;br/&gt;
then action 10:50 would have to mark itself as SKIPPED right?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;These are all correct expected behavior. But the problem is in your first case, marking action 10:40 from SUBMITTED to SKIPPED can&apos;t work 100% of the time since at the mean time, RecoveryService may have already converted it into RUNNING.&lt;/p&gt;</comment>
                            <comment id="13992352" author="rkanter" created="Wed, 7 May 2014 23:21:40 +0000"  >&lt;blockquote&gt;&lt;p&gt;since at the mean time, RecoveryService may have already converted it into RUNNING.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;What if we simply had the RecoveryService ignore actions from LAST_ONLY jobs?  &lt;/p&gt;</comment>
                            <comment id="13993721" author="bowenzhangusa" created="Fri, 9 May 2014 17:29:56 +0000"  >&lt;p&gt;You can certainly do that. But, this is equivalent of having some blocking mechanism between RecoveryService and MaterializationService. And the &quot;Ignore&quot; should only apply when server is back up, not during regular recovery Runnable. Otherwise, job with &quot;Last_only&quot; never gets to run. So, we all need to just go back to my approach in oozie-1305.&lt;/p&gt;</comment>
                            <comment id="14003922" author="rkanter" created="Tue, 20 May 2014 20:20:28 +0000"  >&lt;p&gt;Looking at this again from another perspective: isn&apos;t setting LAST_ONLY effectively equivalent to doing FIFO with a timeout set to the amount of time between actions?  For example, if you have actions materializing every 10min and also have a timeout of 10min, then when the time dependency for the next action is met, the previous action would become TIMEDOUT.  This behavior already exists.  So, perhaps we can re-use that logic so that when LAST_ONLY is set, the timeout for the &lt;tt&gt;current_action&lt;/tt&gt; is set to &lt;tt&gt;MIN(timeout_set_by_the_user, next_action.nominal_time &#8211; current_action.nominal_time)&lt;/tt&gt;?  We then wouldn&apos;t need most of the other changes I&apos;ve already made and we&apos;d reuse the TIMEDOUT status instead of the new SKIPPED status.&lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;</comment>
                            <comment id="14007921" author="rkanter" created="Sat, 24 May 2014 00:21:16 +0000"  >&lt;p&gt;I first tried to re-use the TIMEDOUT status and logic, but that didn&apos;t work for a few reasons, including the fact that TIMEDOUT causes the coordinator job to transition to DONEWITHERROR and not SUCCEEDED.  &lt;/p&gt;

&lt;p&gt;So I ended up mirroring the TIMEDOUT logic to some extent for the new SKIPPED status.  This ended up being much simpler than the old approach.  I kept some of the old approach&apos;s logic, such as when materializing actions in CoordMaterializeTransitionXCommand, if we&apos;re in the past and LAST_ONLY, then it needs to materialize all actions until &quot;now&quot;.  The new logic is in CoordActionInputCheckXCommand where we check if an action&apos;s dependencies are met (this also gets called for actions without dependencies); the TIMEDOUT logic is here too.  I added some code that will set the action&apos;s status to SKIPPED if the current time is later than the next action&apos;s nominal time; this way, there is only ever one WAITING action whose time dependency has been met.  The documentation in the patch gives a more user-oriented explanation that might be more clear.&lt;/p&gt;

&lt;p&gt;This is a little more restrictive than the old approach would have been had it worked properly.  In affect, the new approach doesn&apos;t allow two WAITING actions whose time dependencies are met but data dependencies are not met could become SUBMITTED; while the old approach would allow this.  However, I think this restriction make sense because with LAST_ONLY you&apos;re only interested in the last action anyway; older actions should be SKIPPED, even if the last action&apos;s (data) dependencies haven&apos;t been met yet.  &lt;/p&gt;</comment>
                            <comment id="14008432" author="hadoopqa" created="Sun, 25 May 2014 20:54:51 +0000"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/OOZIE-1319&quot; title=&quot;&amp;quot;LAST_ONLY&amp;quot; in execution control for coordinator job still runs all the actions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OOZIE-1319&quot;&gt;&lt;del&gt;OOZIE-1319&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Cleaning local git workspace&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; the patch contains 5 line(s) longer than 132 characters&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 8 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 BACKWARDS_COMPATIBILITY&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not change any JPA Entity/Colum/Basic/Lob/Transient annotations&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not modify JPA files&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 1458&lt;br/&gt;
.    Tests failed: 6&lt;br/&gt;
.    Tests errors: 4&lt;/p&gt;

&lt;p&gt;.    The patch failed the following testcases:&lt;/p&gt;

&lt;p&gt;.      testCoordStatusTransitServiceDoneWithError(org.apache.oozie.service.TestStatusTransitService)&lt;br/&gt;
.      testCoordinatorActionCommandsSubmitAndStart(org.apache.oozie.sla.TestSLAEventGeneration)&lt;br/&gt;
.      testBundleRerunInPausedWithError(org.apache.oozie.command.bundle.TestBundleRerunXCommand)&lt;br/&gt;
.      testCoordDefUnsupportedChange(org.apache.oozie.command.coord.TestCoordUpdateXCommand)&lt;br/&gt;
.      testTimeOutWithUnresolvedMissingDependencies(org.apache.oozie.command.coord.TestCoordPushDependencyCheckXCommand)&lt;br/&gt;
.      testEngine(org.apache.oozie.TestCoordinatorEngine)&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;&lt;b&gt;-1 Overall result, please check the reported -1(s)&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/oozie-trunk-precommit-build/1263/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/oozie-trunk-precommit-build/1263/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14010654" author="bowenzhangusa" created="Wed, 28 May 2014 01:49:54 +0000"  >&lt;p&gt;I don&apos;t see you dealing with the race condition between RecoveryService and CoordMaterilalizeTriggerService.. When oozie server is back up after more than an hour of downtime, you may only skip the first hour of actions, but you still will materialize and run all actions with nominal times in the past one or several hours during downtime since CoordActionInputCheckXCommand runs before CoordMaterializationXCommand.&lt;br/&gt;
Second, you CoordActionInputCheckXCommand relies on a big assumption that the latest action will get called first by CoordActionInputCheckXCommand since if the second to the latest one gets called first in CoordActionInputCheckXCommand, it will mark the latest action which is supposed to run as &quot;SKIPPED&quot;.&lt;/p&gt;</comment>
                            <comment id="14010674" author="rkanter" created="Wed, 28 May 2014 02:17:50 +0000"  >&lt;blockquote&gt;&lt;p&gt;When oozie server is back up after more than an hour of downtime, you may only skip the first hour of actions, but you still will materialize and run all actions with nominal times in the past one or several hours during downtime since CoordActionInputCheckXCommand runs before CoordMaterializationXCommand.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;By CoordMaterializationXCommand, did you mean CoordMaterializeTransitionXCommand?  Doesn&apos;t CoordActionInputCheckXCommand get run periodically to check if an action&apos;s dependencies are met?  &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Second, you CoordActionInputCheckXCommand relies on a big assumption that the latest action will get called first by CoordActionInputCheckXCommand since if the second to the latest one gets called first in CoordActionInputCheckXCommand, it will mark the latest action which is supposed to run as &quot;SKIPPED&quot;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I don&apos;t think that&apos;s the case.  CoordActionInputCheckXCommand looks at the next action, but it only edits the &quot;current&apos; action.  That is, if it&apos;s checking action 5, it will look at action 6&apos;s nominal time, but it would set action 5&apos;s status only, not action 6&apos;s; that happens in a different call to CoordActionInputCheckXCommand.  I don&apos;t think the order makes a difference here.  Can you give an example of what you mean?  &lt;/p&gt;

&lt;p&gt;The new approach I used should inherently work because it&apos;s doing something very similar to how the timeout stuff works, and that doesn&apos;t have any problems AFAIK.&lt;/p&gt;</comment>
                            <comment id="14011367" author="bowenzhangusa" created="Wed, 28 May 2014 17:43:11 +0000"  >&lt;p&gt;you are right on these two points. The logic LGTM. Can you change the check for &quot;LAST_ONLY&quot; execution order to &quot;ignoreCase&quot;?&lt;br/&gt;
+1.&lt;/p&gt;</comment>
                            <comment id="14011370" author="bowenzhangusa" created="Wed, 28 May 2014 17:44:28 +0000"  >&lt;p&gt;As a follow-on, I want to merge 1305 into this feature once you check this in. I am just adding a new order called &quot;NONE&quot;. so, we don&apos;t need to change any DB.&lt;/p&gt;</comment>
                            <comment id="14011426" author="rkanter" created="Wed, 28 May 2014 18:30:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;Can you change the check for &quot;LAST_ONLY&quot; execution order to &quot;ignoreCase&quot;?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;When checking LAST_ONLY I use the enum, not the String, so that shouldn&apos;t be a problem.  Unless I did one of the checks the wrong way?&lt;/p&gt;

&lt;p&gt;I don&apos;t think we should merge &lt;a href=&quot;https://issues.apache.org/jira/browse/OOZIE-1305&quot; title=&quot;coordinator job should have an option to recover none of actions after downtime&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OOZIE-1305&quot;&gt;&lt;del&gt;OOZIE-1305&lt;/del&gt;&lt;/a&gt; into this JIRA; this patch is big and complicated enough.  But it definitely makes sense to re-use the SKIPPED status I added for the NONE execution order.  Agree?&lt;/p&gt;</comment>
                            <comment id="14011456" author="bowenzhangusa" created="Wed, 28 May 2014 19:01:30 +0000"  >&lt;p&gt;I didn&apos;t say commit 1305 with this one. I ssaid &lt;blockquote&gt;&lt;p&gt;I want to merge 1305 into this feature once you check this in&lt;/p&gt;&lt;/blockquote&gt;.&lt;/p&gt;</comment>
                            <comment id="14011504" author="rkanter" created="Wed, 28 May 2014 19:56:18 +0000"  >&lt;p&gt;Ah, sorry, I misunderstood what you meant.  &lt;/p&gt;

&lt;p&gt;I&apos;ll check that the test failures are unrelated and commit this soon.  Thanks for the review&lt;/p&gt;</comment>
                            <comment id="14011739" author="rkanter" created="Wed, 28 May 2014 22:41:08 +0000"  >&lt;p&gt;TestCoordinatorEngine failure was related: it checks an error message which lists all of the action statuses and didn&apos;t include SKIPPED so it was failing.  The new patch fixes that.&lt;/p&gt;

&lt;p&gt;I&apos;ll commit it once Jenkins confirms that it&apos;s now fixed.&lt;/p&gt;</comment>
                            <comment id="14011994" author="hadoopqa" created="Thu, 29 May 2014 02:51:05 +0000"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/OOZIE-1319&quot; title=&quot;&amp;quot;LAST_ONLY&amp;quot; in execution control for coordinator job still runs all the actions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OOZIE-1319&quot;&gt;&lt;del&gt;OOZIE-1319&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Cleaning local git workspace&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; the patch contains 5 line(s) longer than 132 characters&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 9 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 BACKWARDS_COMPATIBILITY&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not change any JPA Entity/Colum/Basic/Lob/Transient annotations&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not modify JPA files&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 1460&lt;br/&gt;
.    Tests failed: 4&lt;br/&gt;
.    Tests errors: 6&lt;/p&gt;

&lt;p&gt;.    The patch failed the following testcases:&lt;/p&gt;

&lt;p&gt;.      testActionInputCheckLatestActionCreationTime(org.apache.oozie.command.coord.TestCoordActionInputCheckXCommand)&lt;br/&gt;
.      testBundleEngineSuspend(org.apache.oozie.servlet.TestV1JobServletBundleEngine)&lt;br/&gt;
.      testLastOnlyMaterialization(org.apache.oozie.command.coord.TestCoordMaterializeTransitionXCommand)&lt;br/&gt;
.      testActionInputCheckLatestActionCreationTime(org.apache.oozie.command.coord.TestCoordActionInputCheckXCommandNonUTC)&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;&lt;b&gt;-1 Overall result, please check the reported -1(s)&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/oozie-trunk-precommit-build/1270/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/oozie-trunk-precommit-build/1270/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14012582" author="bowenzhangusa" created="Thu, 29 May 2014 17:38:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rkanter&quot; class=&quot;user-hover&quot; rel=&quot;rkanter&quot;&gt;rkanter&lt;/a&gt;, I think my claim about problem arising from server backup is still legit. Consider the server goes down at 8:30 am and back up at 9:31am. The job has a frequency of 10 mins and starts at 8 am. what is expected is only the action at 9:30 am should run and the rest should be skipped. But in your code, the action at 8:50am would also run since CoordInputcheckXCommand sees the nextcoordaction is null before the materialization service materializes actions from 9 am till 10 am. As a result, the action at 8:50 am will be marked as READY.&lt;/p&gt;</comment>
                            <comment id="14012828" author="rkanter" created="Thu, 29 May 2014 20:17:13 +0000"  >&lt;p&gt;I tried replicating that scenario (by playing with my system clock so I didn&apos;t have to wait so long) and it worked correctly; that doesn&apos;t seem to be a problem.&lt;/p&gt;

&lt;p&gt;Though I do have some tests to fix; it looks like &lt;a href=&quot;https://issues.apache.org/jira/browse/OOZIE-1819&quot; title=&quot;Avoid early queueing of CoordActionInputCheckXCommand&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OOZIE-1819&quot;&gt;&lt;del&gt;OOZIE-1819&lt;/del&gt;&lt;/a&gt;, which got in when I last rebased the patch, somehow broke some of my tests.&lt;/p&gt;</comment>
                            <comment id="14012891" author="bowenzhangusa" created="Thu, 29 May 2014 20:56:47 +0000"  >&lt;p&gt;But analytically, this does seem to be a problem.&lt;/p&gt;</comment>
                            <comment id="14012897" author="rkanter" created="Thu, 29 May 2014 21:01:48 +0000"  >&lt;p&gt;That certainly seems like a valid concern, but it looks like it materializes the actions before the check happens so it&apos;s not actually a problem.&lt;/p&gt;</comment>
                            <comment id="14012931" author="bowenzhangusa" created="Thu, 29 May 2014 21:22:17 +0000"  >&lt;p&gt;I think the reason you don&apos;t see the problem is that you only have one coordinator or few coordinators running. Therefore, Materialization happens really fast which beats the speed of recoveryservice. You can check this patch in, but certainly this is a bug.&lt;/p&gt;</comment>
                            <comment id="14012960" author="rkanter" created="Thu, 29 May 2014 21:41:04 +0000"  >&lt;p&gt;Ah, that&apos;s a good point.  I&apos;ll try to think of a solution to that problem.&lt;/p&gt;</comment>
                            <comment id="14012972" author="bowenzhangusa" created="Thu, 29 May 2014 21:48:52 +0000"  >&lt;p&gt;Try to think if you can have any blocking mechanism between the two services. For examples, skip queuing CoordInputCheckXCommand for certain actions with LAST_ONLY execution order. And queue them only after certain conditions are satisfied.&lt;/p&gt;</comment>
                            <comment id="14012985" author="rkanter" created="Thu, 29 May 2014 21:56:25 +0000"  >&lt;p&gt;That&apos;s going to get tricky.  I have another idea to try first: Instead of looking at the nominal time of the next action in CoordActionInputCheckXCommand, I can have it calculate what the nominal time of the next action should be.  Functionally, this is equivalent to what I have now, but the advantage is that it doesn&apos;t rely on the next action having been materialized yet.  So in the last scenario that you gave, even though the action at 8:50am might see the nextcoordaction as null, it won&apos;t matter because it will compute what the nextcoordaction&apos;s nominal time is.  I should be able to steal some logic from the CoordMaterializeTransitionXCommand for computing the next nominal time.&lt;/p&gt;</comment>
                            <comment id="14012987" author="rkanter" created="Thu, 29 May 2014 21:57:29 +0000"  >&lt;p&gt;To clarify, if I can get that idea to work, then I don&apos;t need to even retrieve the nextcoordaction at all and can delete that code.&lt;/p&gt;</comment>
                            <comment id="14013090" author="bowenzhangusa" created="Thu, 29 May 2014 23:17:20 +0000"  >&lt;p&gt;Sounds promising. please consider both integer and cron frequency.&lt;/p&gt;</comment>
                            <comment id="14013230" author="rkanter" created="Fri, 30 May 2014 02:40:06 +0000"  >&lt;p&gt;Yup; cron is actually easier &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;The new patch gets rid of the changes added to get the next action in CoordActionInputCheckXCommand and instead computes the next nominal time.  I also fixed/updated the related failing tests.  &lt;/p&gt;</comment>
                            <comment id="14013298" author="hadoopqa" created="Fri, 30 May 2014 04:55:17 +0000"  >&lt;p&gt;Testing JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/OOZIE-1319&quot; title=&quot;&amp;quot;LAST_ONLY&amp;quot; in execution control for coordinator job still runs all the actions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OOZIE-1319&quot;&gt;&lt;del&gt;OOZIE-1319&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Cleaning local git workspace&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 PATCH_APPLIES&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 CLEAN&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 RAW_PATCH_ANALYSIS&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any @author tags&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any tabs&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not introduce any trailing spaces&lt;br/&gt;
.    &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; the patch contains 2 line(s) longer than 132 characters&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does adds/modifies 7 testcase(s)&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 RAT&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new RAT warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 JAVADOC&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new Javadoc warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 COMPILE&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; HEAD compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; patch compiles&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not seem to introduce new javac warnings&lt;br/&gt;
&lt;font color=&quot;green&quot;&gt;+1 BACKWARDS_COMPATIBILITY&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not change any JPA Entity/Colum/Basic/Lob/Transient annotations&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; the patch does not modify JPA files&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;-1 TESTS&lt;/font&gt;&lt;br/&gt;
.    Tests run: 1458&lt;br/&gt;
.    Tests failed: 1&lt;br/&gt;
.    Tests errors: 1&lt;/p&gt;

&lt;p&gt;.    The patch failed the following testcases:&lt;/p&gt;

&lt;p&gt;.      testBundleEngineKill(org.apache.oozie.servlet.TestV1JobServletBundleEngine)&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 DISTRO&lt;/font&gt;&lt;br/&gt;
.    &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; distro tarball builds with the patch &lt;/p&gt;

&lt;p&gt;----------------------------&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;&lt;b&gt;-1 Overall result, please check the reported -1(s)&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;


&lt;p&gt;The full output of the test-patch run is available at&lt;/p&gt;

&lt;p&gt;.   &lt;a href=&quot;https://builds.apache.org/job/oozie-trunk-precommit-build/1275/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/oozie-trunk-precommit-build/1275/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14013352" author="rkanter" created="Fri, 30 May 2014 06:39:02 +0000"  >&lt;p&gt;Test failures are unrelated.  Lines that are too long are Named Queries.&lt;/p&gt;</comment>
                            <comment id="14014224" author="bowenzhangusa" created="Fri, 30 May 2014 21:11:11 +0000"  >&lt;p&gt;one last issue. When computing nextNominalTime, you need to make sure nextNominalTime is &amp;lt; end time of the coord job. Otherwise, you may wrongly skip the last action of the coord job. After that, +1.&lt;/p&gt;</comment>
                            <comment id="14014226" author="rkanter" created="Fri, 30 May 2014 21:14:25 +0000"  >&lt;p&gt;It already checks that:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;// If the next nominal time is after the job&apos;s end time, then &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is the last action, so &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (nextNominalTime.after(coordJob.getEndTime())) {
    nextNominalTime = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
}
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; nextNominalTime;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14014238" author="rkanter" created="Fri, 30 May 2014 21:30:14 +0000"  >&lt;p&gt;Thanks for the reviews and catching all of those edge cases.  I&apos;m glad we can finally get this in &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14014248" author="bowenzhangusa" created="Fri, 30 May 2014 21:37:33 +0000"  >&lt;p&gt;my bad, didn&apos;t see it.&lt;/p&gt;</comment>
                            <comment id="14014249" author="rkanter" created="Fri, 30 May 2014 21:39:53 +0000"  >&lt;p&gt;Committed to trunk!&lt;/p&gt;</comment>
                            <comment id="14064742" author="shwethags" created="Thu, 17 Jul 2014 09:32:12 +0000"  >&lt;p&gt;I have a question regarding this implementation(Sorry about the late ask) - Why does this require changes in CoordActionInputCheckXCommand, why the comparison with now and next nominal time? Take an example of an hourly coord and there are coord actions for 8th, 9th, 10th and 11th hour in WAITING state. The expectation of LAST_ONLY is that among the ready actions(all dependencies met), it runs only the last one. But with now and next nominal time check, CoordActionInputCheckXCommand marks 8th, 9th and 10th as SKIPPED and 11th will remain in WAITING state. If the dependencies are available late consistently, the same thing continues(in 12th hour, 11th will be marked SKIPPED) and so on and none of the instances for this coord will run.&lt;/p&gt;

&lt;p&gt;Instead, shouldn&apos;t the change be in CoordActionReadyXCommand which picks all ready actions and picks latest and discard the rest?&lt;/p&gt;</comment>
                            <comment id="14065774" author="rkanter" created="Thu, 17 Jul 2014 23:35:54 +0000"  >&lt;blockquote&gt;&lt;p&gt;CoordActionInputCheckXCommand, why the comparison with now and next nominal time? &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;As for what the LAST_ONLY option was supposed to do, we never actually had any very specific documentation.  To try to keep this from becoming very complicated (both to implement and to use), at some point I made the decision that the LAST_ONLY will look at the nominal time of the next nominal time.  In essence, you can think of this like having the timeout set to the interval, but instead of being TIMEDOUT (which results in a &quot;bad&quot; end state for the job), it becomes SKIPPED (which results in a &quot;good&quot; end state for the job).  I think this decision makes sense anyway because if the next action is ready to run, the previous action should have either already ran or should not run.  &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Take an example of an hourly coord and there are coord actions for 8th, 9th, 10th and 11th hour in WAITING state. The expectation of LAST_ONLY is that among the ready actions(all dependencies met), it runs only the last one. But with now and next nominal time check, CoordActionInputCheckXCommand marks 8th, 9th and 10th as SKIPPED and 11th will remain in WAITING state. If the dependencies are available late consistently, the same thing continues(in 12th hour, 11th will be marked SKIPPED) and so on and none of the instances for this coord will run.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;If the dependencies are met, then shouldn&apos;t the 11th transition from WAITING to READY to RUNNING etc?  &lt;br/&gt;
But yes, I suppose if you had a job where the data was consistently late by over one interval of the frequency, and the timeout was set high enough, then it is possible that no actions will actually run.  I&apos;m not sure of a good way to handle this scenario, but if you have any ideas, please file a JIRA.&lt;/p&gt;</comment>
                            <comment id="14066169" author="shwethags" created="Fri, 18 Jul 2014 08:46:57 +0000"  >&lt;p&gt;Previously, LAST_ONLY was running the latest ready action. The gap was that it was picking up even the old ready instances after that. So, I thought just skipping the old instances in CoordActionReadyXCommand would complete the feature. But the current implementation changes the meaning of LAST_ONLY to run only the latest nominal time(makes sense in case of backlog, but the backlog is in waiting actions which will happen probably because of materialisation delays which is internal to oozie?)&lt;/p&gt;

&lt;p&gt;Anyways, now that its implemented already, Is there a usecase for the current implementation of LAST_ONLY. If there is, I will add another enum which executes latest ready action and discards the rest. If there is no usecase, can we modify LAST_ONLY to run the latest ready action?&lt;/p&gt;

&lt;p&gt;Depending on what we decide, I will create the jira accordingly. Let me know. Thanks&lt;/p&gt;</comment>
                            <comment id="14071498" author="shwethags" created="Wed, 23 Jul 2014 08:30:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rkanter&quot; class=&quot;user-hover&quot; rel=&quot;rkanter&quot;&gt;rkanter&lt;/a&gt;, can you check this please?&lt;/p&gt;</comment>
                            <comment id="14072340" author="rkanter" created="Wed, 23 Jul 2014 21:03:23 +0000"  >&lt;blockquote&gt;&lt;p&gt;Previously, LAST_ONLY was running the latest ready action. The gap was that it was picking up even the old ready instances after that. &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Actually, previously LAST_ONLY was basically the same as LIFO.  And from what I could tell, it hasn&apos;t worked properly for at least 3 years.  &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;But the current implementation changes the meaning of LAST_ONLY to run only the latest nominal time&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The meaning of LAST_ONLY was never clearly specified.  From the documentation, it only had this: &quot;discards all older materializations&quot;.  That&apos;s pretty vague and could mean a few different things.  After Bowen&apos;s attempt at this JIRA, and then my earlier attempts, it was getting too complicated and we kept find edge cases that we couldn&apos;t fix.  t finally decided that LAST_ONLY could be interpreted as essentially the same as having a timeout equal to the frequency, but with a &quot;good&quot; ending status (see &lt;a href=&quot;https://issues.apache.org/jira/browse/OOZIE-1319?focusedCommentId=14003922&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14003922&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;this comment&lt;/a&gt; and later).  &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Is there a usecase for the current implementation of LAST_ONLY. If there is&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;LAST_ONLY is good if you have a coordinator where you don&apos;t necessarily care about the specific instances that it runs, just that it runs.  Specifically, we had a customer who had a coordinator with LAST_ONLY and was expecting this behavior.  They brought down their Oozie server for a while for maintenance; when they brought it up, they were expecting Oozie to ignore the &quot;missed&quot; instantiations and just do the last one and continue normally after that, but it instead played &quot;catch up&quot; and started them all.  That&apos;s why I wanted to fix this; otherwise, nobody has complained that LAST_ONLY hasn&apos;t worked in 3 years... I imagine most users don&apos;t even know that you can change it to LIFO or LAST_ONLY.  &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I will add another enum which executes latest ready action and discards the rest.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Feel free to add another execution strategy.  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bowenzhangusa&quot; class=&quot;user-hover&quot; rel=&quot;bowenzhangusa&quot;&gt;bowenzhangusa&lt;/a&gt; has already created a new one called NONE in &lt;a href=&quot;https://issues.apache.org/jira/browse/OOZIE-1875&quot; title=&quot;Add &amp;quot;NONE&amp;quot; to coordinator job execution_order&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OOZIE-1875&quot;&gt;&lt;del&gt;OOZIE-1875&lt;/del&gt;&lt;/a&gt;.  &lt;/p&gt;</comment>
                            <comment id="14072848" author="shwethags" created="Thu, 24 Jul 2014 05:50:53 +0000"  >&lt;p&gt;LAST_ONLY makes sense for coords with no inputs. Created &lt;a href=&quot;https://issues.apache.org/jira/browse/OOZIE-1951&quot; title=&quot;Add option to run only the latest ready instance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OOZIE-1951&quot;&gt;OOZIE-1951&lt;/a&gt; for running latest ready action. Thanks&lt;/p&gt;</comment>
                            <comment id="14562744" author="clark010" created="Thu, 28 May 2015 11:58:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bowenzhangusa&quot; class=&quot;user-hover&quot; rel=&quot;bowenzhangusa&quot;&gt;bowenzhangusa&lt;/a&gt; in 4.1.0 version&#65292;Only when i restart the server it will skipped the WAITING or READY job. And why i can&apos;t find the handleLastOnly method in 4.1.0-branche source code.  Thanks&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12532520">OOZIE-614</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12647515" name="OOZIE-1319.patch" size="56429" author="rkanter" created="Fri, 30 May 2014 02:40:06 +0000"/>
                            <attachment id="12647236" name="OOZIE-1319.patch" size="62097" author="rkanter" created="Wed, 28 May 2014 22:41:08 +0000"/>
                            <attachment id="12646642" name="OOZIE-1319.patch" size="60669" author="rkanter" created="Sat, 24 May 2014 00:21:16 +0000"/>
                            <attachment id="12642378" name="OOZIE-1319.patch" size="60401" author="rkanter" created="Tue, 29 Apr 2014 00:51:45 +0000"/>
                            <attachment id="12641776" name="OOZIE-1319.patch" size="35325" author="rkanter" created="Thu, 24 Apr 2014 18:45:06 +0000"/>
                            <attachment id="12640579" name="OOZIE-1319.patch" size="35360" author="rkanter" created="Thu, 17 Apr 2014 02:37:59 +0000"/>
                            <attachment id="12640574" name="OOZIE-1319.patch" size="34766" author="rkanter" created="Thu, 17 Apr 2014 01:33:04 +0000"/>
                            <attachment id="12585670" name="oozie-1319.patch" size="9018" author="bowenzhangusa" created="Fri, 31 May 2013 21:48:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>322483</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 25 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1jn1j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>322828</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>