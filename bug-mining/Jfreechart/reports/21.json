{"url":"https://api.github.com/repos/jfree/jfreechart/issues/182","repository_url":"https://api.github.com/repos/jfree/jfreechart","labels_url":"https://api.github.com/repos/jfree/jfreechart/issues/182/labels{/name}","comments_url":"https://api.github.com/repos/jfree/jfreechart/issues/182/comments","events_url":"https://api.github.com/repos/jfree/jfreechart/issues/182/events","html_url":"https://github.com/jfree/jfreechart/issues/182","id":736508226,"node_id":"MDU6SXNzdWU3MzY1MDgyMjY=","number":182,"title":"Copy chart to clipboard IOException (Windows)","user":{"login":"lynnskii","id":73971908,"node_id":"MDQ6VXNlcjczOTcxOTA4","avatar_url":"https://avatars.githubusercontent.com/u/73971908?v=4","gravatar_id":"","url":"https://api.github.com/users/lynnskii","html_url":"https://github.com/lynnskii","followers_url":"https://api.github.com/users/lynnskii/followers","following_url":"https://api.github.com/users/lynnskii/following{/other_user}","gists_url":"https://api.github.com/users/lynnskii/gists{/gist_id}","starred_url":"https://api.github.com/users/lynnskii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lynnskii/subscriptions","organizations_url":"https://api.github.com/users/lynnskii/orgs","repos_url":"https://api.github.com/users/lynnskii/repos","events_url":"https://api.github.com/users/lynnskii/events{/privacy}","received_events_url":"https://api.github.com/users/lynnskii/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-11-05T00:14:31Z","updated_at":"2020-11-10T20:13:26Z","closed_at":"2020-11-10T20:13:26Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I'm in the process of migrating my applications to OpenJDK 11, I've discovered that copying a ChartPanel image to the WIndows clipboard now gives an IOException:\r\n\r\n java.io.IOException: Registered service providers failed to encode BufferedImage@228e6026: type = 2 DirectColorModel: rmask=ff0000 gmask=ff00 bmask=ff amask=ff000000 IntegerInterleavedRaster: width = 765 height = 420 #Bands = 4 xOff = 0 yOff = 0 dataOffset[0] 0 to image/jpeg\r\nat java.desktop/sun.awt.datatransfer.DataTransferer.imageToStandardBytesImpl(DataTransferer.java:1799)\r\nat java.desktop/sun.awt.datatransfer.DataTransferer.imageToStandardBytes(DataTransferer.java:1713)\r\nat java.desktop/sun.awt.windows.WDataTransferer.imageToPlatformBytes(WDataTransferer.java:353)\r\nat java.desktop/sun.awt.datatransfer.DataTransferer.translateTransferable(DataTransferer.java:855)\r\nat java.desktop/sun.awt.windows.WDataTransferer.translateTransferable(WDataTransferer.java:220)\r\nat java.desktop/sun.awt.windows.WClipboard.setContentsNative(WClipboard.java:83)\r\nat java.desktop/sun.awt.datatransfer.SunClipboard.setContents(SunClipboard.java:105)\r\nat org.jfree.chart.ChartPanel.doCopy(ChartPanel.java:2702)\r\n\r\n Have done some research, it seems that the alpha channel of the JPEG image is no longer supported in the OpenJDK implementation.\r\n\r\n I've tracked it down to org.jfree.chart.ChartTransferable.ChartTransferable.createBufferedImage(â€¦)\r\nBufferedImage image = new BufferedImage(w, h, BufferedImage.TYPE_INT_ARGB);\r\n\r\n If BufferedImage.TYPE_INT_ARGB is replaced by BufferedImage.TYPE_INT_RGB, it works. Not sure if there are any other places with similar issues.\r\n\r\n Here are some links from my research:\r\nhttps://github.com/fesch/Structorizer.D ... issues/685\r\n Apparently, the clipboard converts the image into JPG format instead of PNG as the menu item promises. As you would expect, the stack trace vanishes if the image type BufferedImage.TYPE_INT_RGB is used to prepare the image for transfer. The visual result doesn't differ.\r\n\r\nhttps://bugs.openjdk.java.net/browse/JDK-8176556\r\nhttps://bugs.openjdk.java.net/browse/JDK-8204188\r\n JDK-8204187 removed support for ARGB channel for JPEG. Test uses ARGB input to encode JPEG image and we get IOException.","closed_by":{"login":"jfree","id":1835893,"node_id":"MDQ6VXNlcjE4MzU4OTM=","avatar_url":"https://avatars.githubusercontent.com/u/1835893?v=4","gravatar_id":"","url":"https://api.github.com/users/jfree","html_url":"https://github.com/jfree","followers_url":"https://api.github.com/users/jfree/followers","following_url":"https://api.github.com/users/jfree/following{/other_user}","gists_url":"https://api.github.com/users/jfree/gists{/gist_id}","starred_url":"https://api.github.com/users/jfree/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jfree/subscriptions","organizations_url":"https://api.github.com/users/jfree/orgs","repos_url":"https://api.github.com/users/jfree/repos","events_url":"https://api.github.com/users/jfree/events{/privacy}","received_events_url":"https://api.github.com/users/jfree/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/jfree/jfreechart/issues/182/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/jfree/jfreechart/issues/182/timeline","performed_via_github_app":null,"state_reason":"completed"}