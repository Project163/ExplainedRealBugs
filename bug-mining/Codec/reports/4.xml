<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:23:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CODEC-61] Base64.encodeBase64() throws NegativeArraySizeException on large files</title>
                <link>https://issues.apache.org/jira/browse/CODEC-61</link>
                <project id="12310464" key="CODEC">Commons Codec</project>
                    <description>&lt;p&gt;The NegativeArraySizeException exception is thrown by Base64.EncodeBase64() for arrays larger than 268435455 bytes (2^31/8-1).&lt;/p&gt;

&lt;p&gt;public static byte[] encodeBase64(byte[] binaryData, boolean isChunked)  starts with the following three lines:&lt;/p&gt;

&lt;p&gt;        int lengthDataBits = binaryData.length * EIGHTBIT;&lt;br/&gt;
        int fewerThan24bits = lengthDataBits % TWENTYFOURBITGROUP;&lt;br/&gt;
        int numberTriplets = lengthDataBits / TWENTYFOURBITGROUP;&lt;/p&gt;

&lt;p&gt;The first of the lines will cause an integer overflow in lengthDataBits for lengths larger than 2^31/8-1, making it a negative number. The fix is trivial (but not tested on the running code, I just ran through a few numbers to validate that it computes the same results as the original code):&lt;/p&gt;

&lt;p&gt;        int lengthData = binaryData.length;&lt;br/&gt;
        int fewerThan24bits = lengthData % (TWENTYFOURBITGROUP / EIGHTBIT) * EIGHTBIT;&lt;br/&gt;
        int numberTriplets = lengthData / (TWENTYFOURBITGROUP / EIGHTBIT);&lt;/p&gt;

&lt;p&gt;This way the encoder will be able to process files of up to 2^31-1 bytes in length, which is much better than ~250MB.&lt;/p&gt;

&lt;p&gt;The issue was found in commons 1.3; the source code above was taken from SVN trunk so I assume it&apos;s still present in 1.4: &lt;a href=&quot;http://svn.apache.org/repos/asf/commons/proper/codec/trunk/src/java/org/apache/commons/codec/binary/Base64.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/repos/asf/commons/proper/codec/trunk/src/java/org/apache/commons/codec/binary/Base64.java&lt;/a&gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;java -version&lt;br/&gt;
java version &quot;1.5.0_03&quot;&lt;br/&gt;
Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_03-b07)&lt;br/&gt;
Java HotSpot(TM) Server VM (build 1.5.0_03-b07, mixed mode)&lt;/p&gt;

&lt;p&gt;uname -a&lt;br/&gt;
Linux HP-FC7-IGOR 2.6.23.8-34.fc7 #1 SMP Thu Nov 22 20:39:56 EST 2007 x86_64 x86_64 x86_64 GNU/Linux&lt;/p&gt;</environment>
        <key id="12387721">CODEC-61</key>
            <summary>Base64.encodeBase64() throws NegativeArraySizeException on large files</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="igors">Igor Sedukhin</reporter>
                        <labels>
                    </labels>
                <created>Sun, 3 Feb 2008 07:39:51 +0000</created>
                <updated>Mon, 13 Jul 2009 21:44:09 +0000</updated>
                            <resolved>Sat, 8 Mar 2008 07:28:55 +0000</resolved>
                                    <version>1.3</version>
                                    <fixVersion>1.4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12565425" author="julien.ayme@gmail.com" created="Mon, 4 Feb 2008 17:37:31 +0000"  >&lt;p&gt;An easier way to fix this bug would be to declare lengthDataBits as a long, and cast the other to int:&lt;/p&gt;

&lt;p&gt;long lengthDataBits = ((long)binaryData.length) * EIGHTBIT;&lt;br/&gt;
int fewerThan24bits = (int) (lengthDataBits % TWENTYFOURBITGROUP);&lt;br/&gt;
int numberTriplets = (int) (lengthDataBits / TWENTYFOURBITGROUP);&lt;/p&gt;</comment>
                            <comment id="12565504" author="ggregory@seagullsw.com" created="Mon, 4 Feb 2008 20:20:54 +0000"  >&lt;p&gt;Fix typo.&lt;/p&gt;</comment>
                            <comment id="12565505" author="ggregory@seagullsw.com" created="Mon, 4 Feb 2008 20:22:29 +0000"  >&lt;p&gt;Committed revision 618419: Throws IllegalArgumentException when the input array needs an output array bigger than Integer.MAX_VALUE. Internally uses longs instead of ints for size computations.&lt;/p&gt;</comment>
                            <comment id="12565506" author="ggregory@seagullsw.com" created="Mon, 4 Feb 2008 20:23:20 +0000"  >&lt;p&gt;Igor Slepchin: Can please you test in your environment? All unit tests still pass for me.&lt;/p&gt;</comment>
                            <comment id="12730535" author="juliusdavies" created="Mon, 13 Jul 2009 21:44:09 +0000"  >&lt;p&gt;To encode/decode files greater than 2GB use Base64InputStream or Base64OutputStream provided by &lt;a href=&quot;https://issues.apache.org/jira/browse/CODEC-69&quot; title=&quot;Streaming Base64&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CODEC-69&quot;&gt;&lt;del&gt;CODEC-69&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12398475">CODEC-69</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>110388</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 19 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ep9j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>83855</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>