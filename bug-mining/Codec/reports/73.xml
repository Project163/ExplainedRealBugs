<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:24:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CODEC-130] Base64InputStream.skip skips underlying stream, not output</title>
                <link>https://issues.apache.org/jira/browse/CODEC-130</link>
                <project id="12310464" key="CODEC">Commons Codec</project>
                    <description>&lt;p&gt;Base64InputStream.skip() skips within underlying stream, leading to unexpected behaviour.&lt;/p&gt;

&lt;p&gt;The following code will reproduce the issue:&lt;/p&gt;

&lt;p&gt;@Test&lt;br/&gt;
public void testSkip() throws Throwable {&lt;br/&gt;
    InputStream ins =&lt;br/&gt;
            new ByteArrayInputStream(&quot;AAAA////&quot;.getBytes(&quot;ISO-8859-1&quot;));//should decode to &lt;/p&gt;
{0, 0, 0, 255, 255, 255}
&lt;p&gt;    Base64InputStream instance = new Base64InputStream(ins);&lt;br/&gt;
    assertEquals(3L, instance.skip(3L)); //should skip 3 decoded characters, or 4 encoded characters&lt;br/&gt;
    assertEquals(255, instance.read()); //Currently returns 3, as it is decoding &quot;A/&quot;, not &quot;//&quot; &lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;The following code, if added to Base64InputStream, or (BaseNCodecInputStream in the dev build) would resolve the issue:&lt;/p&gt;

&lt;p&gt;@Override&lt;br/&gt;
public long skip(long n) throws IOException {&lt;br/&gt;
    //delegate to read()&lt;br/&gt;
    long bytesRead = 0;&lt;br/&gt;
    while ((bytesRead &amp;lt; n) &amp;amp;&amp;amp; (read() != -1)) &lt;/p&gt;
{
        bytesRead++;
    }
&lt;p&gt;    return bytesRead;&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;More efficient code may be possible.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12524624">CODEC-130</key>
            <summary>Base64InputStream.skip skips underlying stream, not output</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="james_pic">James Pickering</reporter>
                        <labels>
                    </labels>
                <created>Mon, 26 Sep 2011 11:59:12 +0000</created>
                <updated>Fri, 14 Sep 2012 20:21:09 +0000</updated>
                            <resolved>Mon, 19 Mar 2012 21:00:11 +0000</resolved>
                                    <version>1.5</version>
                                    <fixVersion>1.7</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13114741" author="garydgregory" created="Mon, 26 Sep 2011 16:05:39 +0000"  >&lt;p&gt;Can you please attach your code as a file and grant the ASF license to use it by clicking the grant check box on the attach form?&lt;/p&gt;</comment>
                            <comment id="13115062" author="garydgregory" created="Tue, 27 Sep 2011 00:12:43 +0000"  >&lt;p&gt;Looking at the Javadoc for FilterInputStream#skip(long), I do not think we should change the semantics for this API.&lt;/p&gt;

&lt;p&gt;We can discuss adding a new API to our class like skipReads(long) or read(long).&lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;</comment>
                            <comment id="13115302" author="james_pic" created="Tue, 27 Sep 2011 07:51:11 +0000"  >&lt;p&gt;Code snippets, for test case, and sample implementation of fix&lt;/p&gt;</comment>
                            <comment id="13115318" author="james_pic" created="Tue, 27 Sep 2011 08:12:51 +0000"  >&lt;p&gt;I think what you&apos;re saying is that the current code conforms to the FilterInputStream contract. I don&apos;t think this is the case.&lt;/p&gt;

&lt;p&gt;At a practical level, the current behaviour isn&apos;t what other FilterInputStream subclasses do. InflaterInputStream, for example (from the JDK standard class library), skips over bytes of uncompressed (i.e, output) data.&lt;/p&gt;

&lt;p&gt;At a theoretical level, we should be honoring the InputStream contract. FilterInputStream is a convenience subclass, to simplify InputStream coding (most FilterInputStream subclasses have a 1-1 correspondence between input and output bytes, so FilterInputStream&apos;s behaviour is reasonable). An InputStream is a stream of bytes that can be read, and consumers should not need to know how it is implemented. If we continue with the current behaviour, we introduce an implementation dependency, breaking OO encapsulation (indeed, I first noticed this bug when some code that worked with other InputStreams broke with Base64InputStream).&lt;/p&gt;

&lt;p&gt;I take your point that existing code that relies on the current behaviour could break as a result of the fix, but I can&apos;t imagine any correct code relying on the current behaviour (it produces nonsense data if skip requests are not multiples of 4, and aligned to 4 byte boundaries). At worst, we&apos;d break people&apos;s workarounds.&lt;/p&gt;</comment>
                            <comment id="13231575" author="tn" created="Fri, 16 Mar 2012 20:11:11 +0000"  >&lt;p&gt;Imho the request for change has some merit.&lt;/p&gt;

&lt;p&gt;When looking at the InflaterInputStream (which is also a derived FilterInputStream), the skip method is implemented to skip uncompressed bytes rather than compressed ones (aka from the underlying stream):&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Skips specified number of bytes of uncompressed data. 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13231614" author="garydgregory" created="Fri, 16 Mar 2012 20:52:34 +0000"  >&lt;p&gt;Hm. I am almost sold on this. Nice job to all posters for clarifying the requirements and implementations.&lt;/p&gt;

&lt;p&gt;My question is: what do we want to be skipping? underlying bytes or decoded chars?&lt;/p&gt;

&lt;p&gt;InflaterInputStream for example says:&lt;/p&gt;

&lt;blockquote&gt;
&lt;ul&gt;
	&lt;li&gt;Skips specified number of bytes of uncompressed data.&lt;/li&gt;
	&lt;li&gt;@param n the number of bytes to skip&lt;/li&gt;
	&lt;li&gt;@return the actual number of bytes skipped.&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;

&lt;p&gt;If we do that on a B64 and B32 stream, will skipping underlying bytes risk of messing up further decoding? Can you prove that it will not?&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13231638" author="tn" created="Fri, 16 Mar 2012 21:19:29 +0000"  >&lt;p&gt;I think we do not have a choice other than skipping decoded bytes.&lt;/p&gt;

&lt;p&gt;Consider the case where a user receives an InputStream that is in fact a filtered base64 stream. From the POV of the user, he may not be even aware that the underlying stream is providing encoded data. What he sees and is interested in are decoded chars, thus a skip on any filtered input stream should skip the amount of bytes the stream is responsible for (i.e. is producing as output).&lt;/p&gt;</comment>
                            <comment id="13231647" author="garydgregory" created="Fri, 16 Mar 2012 21:27:19 +0000"  >&lt;p&gt;Are you saying that it is possible to shoot yourself in the foot then?&lt;/p&gt;
</comment>
                            <comment id="13232023" author="tn" created="Sat, 17 Mar 2012 17:28:46 +0000"  >&lt;p&gt;My example was maybe not so clear, but yes that&apos;s basically what I think happens when skipping the underlying stream.&lt;br/&gt;
In case you have a 1:1 mapping (1 byte in the underlying stream refers to 1 byte in the filtered stream), it does not matter. For compressing or encoding streams this may be different, so the skip method has to be adjusted imho.&lt;/p&gt;

&lt;p&gt;After looking at the code of InflaterInputStream, I think we can do quite the same here (and check also other filtered input streams).&lt;/p&gt;</comment>
                            <comment id="13232027" author="tn" created="Sat, 17 Mar 2012 17:42:28 +0000"  >&lt;p&gt;After checking commons-compress, the input streams there are all directly derived from InputStream (exception is CountingInputStream, but this one just counts bytes read), so no problem there.&lt;/p&gt;

&lt;p&gt;I think to be correct, also available has to be implemented. The implementation in InflaterInputStream is very simple:&lt;/p&gt;

&lt;p&gt;return 0 when if EOF has been reached, 1 otherwise&lt;/p&gt;

&lt;p&gt;but correct. I know available is not reliable but, but returning the available measure of the underlying stream is even worse.&lt;/p&gt;</comment>
                            <comment id="13232035" author="tn" created="Sat, 17 Mar 2012 18:35:39 +0000"  >&lt;p&gt;I have added a unit test to demonstrate the wrong behaviour in an understandable way.&lt;/p&gt;

&lt;p&gt;First, I encode a string &quot;Hello World!&quot; using the Base64outputstream. The encoded string is then read back with a Base64InputStream, but first I do a skip(1) on the stream. Which results in total rubbish instead of the expected &quot;ello World!&quot;.&lt;/p&gt;

&lt;p&gt;btw. when using an InputStreamReader, the problem is non-existent, as the InputStreamReader implements the skip properly by calling the read method of the underlying stream.&lt;/p&gt;</comment>
                            <comment id="13232340" author="garydgregory" created="Sun, 18 Mar 2012 19:37:48 +0000"  >&lt;p&gt;Ok, I see. If the BaseNCodecInputStream class is going to be changed, you need:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;A test for Base64CodecInputStream (which you provided)&lt;/li&gt;
	&lt;li&gt;A test for Base32CodecInputStream (missing)&lt;/li&gt;
	&lt;li&gt;100% code (I hope) coverage of the new skip method in BaseNCodecInputStream&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13232898" author="garydgregory" created="Mon, 19 Mar 2012 21:00:11 +0000"  >&lt;p&gt;In SVN.&lt;/p&gt;</comment>
                            <comment id="13456101" author="garydgregory" created="Fri, 14 Sep 2012 20:21:09 +0000"  >&lt;p&gt;Released in 1.7 today.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12496645" name="base64snippet.java" size="623" author="james_pic" created="Tue, 27 Sep 2011 07:51:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3256</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 10 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i05uef:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32022</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>