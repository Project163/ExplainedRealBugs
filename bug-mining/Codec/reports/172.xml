<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:26:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CODEC-331] org.apache.commons.codec.language.bm.Rule.parsePhonemeExpr(String) adds duplicate empty phoneme when input ends with |</title>
                <link>https://issues.apache.org/jira/browse/CODEC-331</link>
                <project id="12310464" key="CODEC">Commons Codec</project>
                    <description>&lt;p&gt;Component: org.apache.commons.codec.language.bm.Rule&lt;/p&gt;

&lt;p&gt;Method: private static PhonemeExpr parsePhonemeExpr(String ph)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;h1&gt;&lt;a name=&quot;Problem&quot;&gt;&lt;/a&gt;Problem&lt;/h1&gt;

&lt;p&gt;When the input string is &lt;b&gt;(()|)&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;The method &lt;b&gt;parsePhonemeExpr(String)&lt;/b&gt; first strips the parentheses, producing: &lt;b&gt;body = &quot;()|&#8221;&lt;/b&gt;&lt;br/&gt;
Then it executes &lt;b&gt;body.split(&quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;|&amp;#93;&lt;/span&gt;&quot;)&lt;/b&gt;&lt;br/&gt;
Due to Java&apos;s default behavior, the trailing empty string (after the &lt;b&gt;|&lt;/b&gt;) is discarded, resulting in &lt;b&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;()&amp;quot;&amp;#93;&lt;/span&gt;&lt;/b&gt;&lt;br/&gt;
To compensate for this, the following logic is used:&lt;br/&gt;
if (body.startsWith(&quot;|&quot;) || body.endsWith(&quot;|&quot;))&lt;/p&gt;

{ &#160; &#160; phs.add(new Phoneme(&quot;&quot;, Languages.ANY_LANGUAGE)); }

&lt;p&gt;However, the &lt;b&gt;&quot;()&quot;&lt;/b&gt; entry already results in a &lt;b&gt;Phoneme(&quot;&quot;)&lt;/b&gt; when parsed.&lt;br/&gt;
As a result, the list ends up containing two empty phonemes, which seems unintended.&lt;/p&gt;
&lt;h1&gt;&lt;a name=&quot;ExpectedResult&quot;&gt;&lt;/a&gt;Expected Result&lt;/h1&gt;

&lt;p&gt;Only one empty phoneme should be added for (()|).&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;h1&gt;&lt;a name=&quot;ActualResult&quot;&gt;&lt;/a&gt;Actual Result&lt;/h1&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Two empty phonemes are returned:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;One from parsing &quot;()&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;One manually added due to .endsWith(&quot;|&quot;)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;Affected Version: 1.18.1 (I found this version from my pom.xml)&lt;/p&gt;

&lt;p&gt;MacOS&lt;/p&gt;

&lt;p&gt;JDK 8&lt;/p&gt;</environment>
        <key id="13618469">CODEC-331</key>
            <summary>org.apache.commons.codec.language.bm.Rule.parsePhonemeExpr(String) adds duplicate empty phoneme when input ends with |</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggregory">Gary D. Gregory</assignee>
                                    <reporter username="ilikecode">IlikeCode</reporter>
                        <labels>
                    </labels>
                <created>Sun, 18 May 2025 22:13:32 +0000</created>
                <updated>Sun, 6 Jul 2025 19:53:24 +0000</updated>
                            <resolved>Sun, 6 Jul 2025 19:28:45 +0000</resolved>
                                    <version>1.18.0</version>
                                    <fixVersion>1.19.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17952473" author="garydgregory" created="Sun, 18 May 2025 22:29:02 +0000"  >&lt;p&gt;In general, I don&apos;t think that testing the internals of this class through reflection is helpful here since it might not reflect a bug in the client call-site because additional processing may not surface an actual issue.&lt;/p&gt;

&lt;p&gt;Do you have an actual failing example?&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Please use JUnit 5&lt;/li&gt;
	&lt;li&gt;This is is bad:
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e)

{             fail(&lt;span class=&quot;code-quote&quot;&gt;&quot;Exception should not have been thrown: &quot;&lt;/span&gt; + e.getMessage());         }
    }

}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Let the exception percolate to JUnit.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17952610" author="JIRAUSER309579" created="Mon, 19 May 2025 13:43:37 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;I investigated the call chain of the &quot;parsePhonemeExpr&quot; method and found that it is invoked by &quot;parseRules&quot;, which in turn is called during the construction of Rule. Therefore, I focused on whether creating a Rule instance behaves correctly when encountering a specific phoneme expression.&lt;/p&gt;

&lt;p&gt;To test this, I created a rule file at: src/test/resources/org/apache/commons/codec/language/bm/gen_rules_english.txt&lt;br/&gt;
With the following content: &quot;s&quot; &quot;&quot; &quot;&quot; &quot;(()|)&quot;&lt;br/&gt;
This rule is picked up during Rule initialization. The phoneme expression &quot;(()|)&quot; is parsed via &quot;parsePhonemeExpr&quot;, which is expected to return a PhonemeList containing exactly one phoneme (an empty one). However, the method currently returns two phonemes, incorrectly treating the trailing &quot;|&quot; as a separate empty phoneme.&lt;/p&gt;

&lt;p&gt;To verify this behavior, I wrote a JUnit 5 test with proper camel case naming conventions:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; org.apache.commons.codec.language.bm;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.List;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.junit.jupiter.api.Test;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; org.junit.jupiter.api.Assertions.assertEquals;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;RuleParsePhonemeExprTest {
&#160; &#160; @Test
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void TestRule() {
&#160; &#160; &#160; &#160; List&amp;lt;Rule&amp;gt; rules = Rule.getInstance(NameType.GENERIC, RuleType.RULES, &lt;span class=&quot;code-quote&quot;&gt;&quot;english&quot;&lt;/span&gt;);
&#160; &#160; &#160; &#160; Rule rule = rules.stream()
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; .filter(r -&amp;gt; r.getPattern().equals(&lt;span class=&quot;code-quote&quot;&gt;&quot;s&quot;&lt;/span&gt;))
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; .findFirst()
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; .orElseThrow(() -&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AssertionError(&lt;span class=&quot;code-quote&quot;&gt;&quot;Rule not found&quot;&lt;/span&gt;));
&#160; &#160; &#160; &#160; Rule.PhonemeExpr expr = rule.getPhoneme();
&#160; &#160; &#160; &#160; assertEquals(1, expr.size()); &lt;span class=&quot;code-comment&quot;&gt;// Expected 1, but got 2
&lt;/span&gt;&#160; &#160; }
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;In this test, expr.size() should return 1, but it actually returns 2, confirming the bug in &quot;parsePhonemeExpr&quot;.&lt;/p&gt;</comment>
                            <comment id="18001342" author="garydgregory" created="Sun, 6 Jul 2025 19:28:45 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ilikecode&quot; class=&quot;user-hover&quot; rel=&quot;ilikecode&quot;&gt;ilikecode&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;This is fixed in git master and snapshot builds in &lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Please verify and close this ticket if your use case is fixed.&lt;/p&gt;

&lt;p&gt;TY!&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13076563" name="Screenshot 2025-05-19 at 8.11.02&#8239;am.png" size="99717" author="ilikecode" created="Sun, 18 May 2025 22:11:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1vwv4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>