<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:25:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CODEC-264] murmur3.hash128() does not account for unsigned seed argument</title>
                <link>https://issues.apache.org/jira/browse/CODEC-264</link>
                <project id="12310464" key="CODEC">Commons Codec</project>
                    <description>&lt;p&gt;The original murmur3_x64_128 code used unsigned int for seed arguments.  Using the equivalent bit patterns in the commons codec version does not yield the same results.&lt;/p&gt;

&lt;p&gt;I believe this is because the commons version does not account for sign extension etc.&lt;/p&gt;

&lt;p&gt;Yonic Seeley &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yonik&quot; class=&quot;user-hover&quot; rel=&quot;yonik&quot;&gt;yonik&lt;/a&gt; has explains the issue in his implementation &lt;a href=&quot;https://github.com/yonik/java_util/blob/master/src/util/hash/MurmurHash3.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/yonik/java_util/blob/master/src/util/hash/MurmurHash3.java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;He provides a test case to show that his code returns the same answers as the original C/C++ code.  I modified that test to call the codec version to show the error.&lt;/p&gt;

&lt;p&gt;I have attached that test case.&lt;/p&gt;

&lt;p&gt;Given that the original code is in the wild I am uncertain how to fix this issue.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13265875">CODEC-264</key>
            <summary>murmur3.hash128() does not account for unsigned seed argument</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aherbert">Alex Herbert</assignee>
                                    <reporter username="claude">Claude Warren</reporter>
                        <labels>
                    </labels>
                <created>Sat, 2 Nov 2019 08:49:37 +0000</created>
                <updated>Sat, 18 Jan 2020 09:27:58 +0000</updated>
                            <resolved>Sun, 24 Nov 2019 12:41:27 +0000</resolved>
                                    <version>1.13</version>
                                    <fixVersion>1.14</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16965397" author="garydgregory" created="Sat, 2 Nov 2019 15:12:05 +0000"  >&lt;p&gt;Hi and thank you for your report.&lt;br/&gt;
Would it be possible for you to provide a PR on GitHub?&lt;/p&gt;</comment>
                            <comment id="16965640" author="claudenw" created="Sun, 3 Nov 2019 10:14:07 +0000"  >&lt;p&gt;The pull request to fix this issue&lt;/p&gt;</comment>
                            <comment id="16965645" author="erans" created="Sun, 3 Nov 2019 10:53:10 +0000"  >&lt;p&gt;There are formatting issues in the PR (alignment, tab).  It seems that tabs were used in the original file. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
I&apos;d suggest to make a PR to fix that first, but I don&apos;t know what the regular contributors to &lt;span class=&quot;error&quot;&gt;&amp;#91;Codec&amp;#93;&lt;/span&gt; would recommend.  Better ask on the &quot;dev&quot; ML.  Thanks.&lt;/p&gt;

&lt;p&gt;In general the PR associated with well-defined issue and a JIRA report should come with a &lt;em&gt;single&lt;/em&gt; commit whose message is prefixed with the JIRA identifier, i.e. in this case:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;CODEC-264: Fixed sign extensions.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and the &lt;a href=&quot;https://github.com/apache/commons-codec/blob/master/src/changes/changes.xml&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;src/changes/changes.xml&lt;/a&gt; file should be updated accordingly.&lt;/p&gt;

&lt;p&gt;Similarly, unit tests that ensure that the fix is working should be either named according to what they test (e.g. &lt;tt&gt;testHash64SignExtension&lt;/tt&gt; or something) or to the JIRA issue (e.g. &lt;tt&gt;testCodec264&lt;/tt&gt;).  Of course, you are welcome to mention attribution in the commit message:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;CODEC-264: Fixed sign extensions.

Thanks to &quot;yonik&quot; for documenting the issue.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and/or in a code comment in the unit tests Java file.&lt;/p&gt;</comment>
                            <comment id="16965646" author="erans" created="Sun, 3 Nov 2019 10:56:31 +0000"  >&lt;p&gt;If the changes could break existing applications (as you mentioned), it would assume that it must also be discussed on the &quot;dev&quot; ML.&lt;/p&gt;</comment>
                            <comment id="16965649" author="erans" created="Sun, 3 Nov 2019 11:21:46 +0000"  >&lt;p&gt;Another nit: no magic numbers (in new code at least).  If used more than a couple times, such occurrences as &quot;0x00ff&quot; should be replaced by a static field.&lt;/p&gt;</comment>
                            <comment id="16965662" author="claudenw" created="Sun, 3 Nov 2019 12:51:25 +0000"  >&lt;p&gt;Made 0xff and 0x00000000FFFFFFFFL static final vars and replace their usage with the var in the Murmur3 code.&lt;br/&gt;
updated the changes.xml&lt;br/&gt;
renamed the tests.&lt;br/&gt;
Altered the pull request message&lt;/p&gt;

&lt;p&gt;I have left the tab/space issue as that predates this change.  I don&apos;t think I made it worse.&lt;/p&gt;</comment>
                            <comment id="16979255" author="alexherbert" created="Thu, 21 Nov 2019 13:00:20 +0000"  >&lt;p&gt;As discussed on the PR raised by Claude the two sign extension bugs in MurmurHash3 should be fixed in new methods to avoid behavioural changes to the existing released hash32 and hash128 methods.&lt;/p&gt;

&lt;p&gt;New methods can take inspiration from the c++ source code method names:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;MurmurHash3_x86_32 -&amp;gt;&#160;MurmurHash3.hash32x86
MurmurHash3_x64_128 -&amp;gt; MurmurHash3.hash128x64
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16979257" author="alexherbert" created="Thu, 21 Nov 2019 13:01:51 +0000"  >&lt;p&gt;I am going to clean up MurmurHash3 with full documentation of the current code. At present the code is sparsely documented and contains a number of methods with no equivalent in the c++ source for MurmurHash3.&lt;/p&gt;</comment>
                            <comment id="16981049" author="claudenw" created="Sun, 24 Nov 2019 11:56:45 +0000"  >&lt;p&gt;This issues should be closed with the changes that Alex made to master.  I am not certain what the codec procedure is.  As the person that opened this issue should I mark it as resolved or close it, or just leave it alone for Alex to record?&lt;/p&gt;</comment>
                            <comment id="16981062" author="alexherbert" created="Sun, 24 Nov 2019 12:41:27 +0000"  >&lt;p&gt;New method hash128x64 to handle unsigned seed argument added to master.&lt;/p&gt;</comment>
                            <comment id="17018374" author="andy.seaborne" created="Fri, 17 Jan 2020 22:43:53 +0000"  >&lt;p&gt;The v1.14 version of &lt;tt&gt;hash128(byte[], , int seed)&lt;/tt&gt; does now apply the seed mask, contrary to the comments.&lt;/p&gt;

&lt;p&gt;Line 805&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    @Deprecated
    public static long[] hash128(final byte[] data, final int offset, final int length, final int seed) {
        // ************
        // Note: This fails to apply masking using 0xffffffffL to the seed.
        // ************
        return hash128x64(data, offset, length, seed);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It calls &lt;tt&gt;hash128x86(byte[],, int seed)&lt;/tt&gt; (exact signature match), not &lt;tt&gt;hash128x86(byte[],, long seed)&lt;/tt&gt; (type conversion).&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;hash128x86(byte[],, int seed)&lt;/tt&gt; applies the mask (checked by debugger walk through in EclipseIDE).&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;hash128(byte[],, int seed)&lt;/tt&gt; should be a call of &lt;tt&gt;hash128x86(byte[],, long)&lt;/tt&gt; directly.&lt;/p&gt;

&lt;p&gt;I think that casting at the call site will do that:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;        return hash128x64(data, offset, length, (long)seed);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;or for clarity explicitly:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;        long seedLong = seed; /* unmasked 32-&amp;gt;64 bit extension */
        return hash128x64(data, offset, length, seedLong);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If the private static work function had a different name, then automatic, unmasked conversion would have applied.&lt;/p&gt;
</comment>
                            <comment id="17018468" author="alexherbert" created="Sat, 18 Jan 2020 02:00:37 +0000"  >&lt;p&gt;Thanks for the raising this.&lt;/p&gt;

&lt;p&gt;The effect is that despite creating a new method for the fixed version to maintain behavioural compatibility with the old broken version the code actually fixes the old version and breaks behavioural compatibility.&lt;/p&gt;

&lt;p&gt;I have added a test to maintain behavioural compatibility and fixed the code as suggested. Please review the current master to check that the fix is correct.&lt;/p&gt;</comment>
                            <comment id="17018547" author="andy.seaborne" created="Sat, 18 Jan 2020 09:27:58 +0000"  >&lt;p&gt;Hi Alex,&lt;/p&gt;

&lt;p&gt;I&apos;ve visually inspected the code in git (&lt;a href=&quot;https://github.com/apache/commons-codec/commit/f5a61f0c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;commit f5a61f0c&lt;/a&gt;) and it looks correct.&lt;/p&gt;

&lt;p&gt;Thanks / Andy&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13269834">CODEC-267</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12984679" name="YonikMurmur3Tests.java" size="5973" author="claude" created="Sat, 2 Nov 2019 08:49:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 43 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z08708:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>