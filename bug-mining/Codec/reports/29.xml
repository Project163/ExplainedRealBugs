<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:24:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CODEC-98] Base64InputStream causes NullPointerException on some input</title>
                <link>https://issues.apache.org/jira/browse/CODEC-98</link>
                <project id="12310464" key="CODEC">Commons Codec</project>
                    <description>&lt;p&gt;Certain (malformed?) input to &lt;tt&gt;Base64InputStream&lt;/tt&gt; causes a &lt;tt&gt;NullPointerException&lt;/tt&gt; in &lt;tt&gt;Base64.decode&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;The exception occurs when &lt;tt&gt;Base64.decode&lt;/tt&gt; is entered with the following conditions:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;buffer&lt;/tt&gt; is &lt;tt&gt;null&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;modulus&lt;/tt&gt; is &lt;tt&gt;3&lt;/tt&gt; from a previous entry.&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;inAvail&lt;/tt&gt; is &lt;tt&gt;-1&lt;/tt&gt; because &lt;tt&gt;Base64InputStream.read&lt;/tt&gt; reached EOF on line 150.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Under these conditions, &lt;tt&gt;Base64.decode&lt;/tt&gt; reaches line 581 with &lt;tt&gt;buffer&lt;/tt&gt; still &lt;tt&gt;null&lt;/tt&gt; and throws a &lt;tt&gt;NullPointerException&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Here is some input data that will trigger it:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;H4sIAAAAAAAAAFvzloG1uIhBKiuxLFGvODW5tCizpFIvODM9LzXFPykrNbmE8//eDC2bq/+ZGJij
GdiT8/NKUvNKShiYop2iGTiLgQoTS0qLUgsZ6hgYfRh4SjJSE3PS84GmZOSWMAj5gMzVz0nMS9cP
LinKzEu3rigoLQJpXvNZ/AcbR8gDJgaGigIGBqbLayAuMUxNKdVLTyxJTc7QS07WSyzKLC7JL8lJ
1StJLErMKynNSdTLyUxOzStO1fOB0AwQwMjEwOrJwJMbn+mSWFkclpiTmeID4joml2SWpYZk5qaW
MEj45Bel62flpyTqlwAF9F2A9oBkrMEqnYtSoXyob1hy4z1dShgEIL4oLcnM0Q8N9XQBqubKjYfa
DjTV1AfoZn2Im/WTk/XhbtaHu1kf6mZ9T5g2YED8BwKgj8WAbtIDuUkP5CY9mJt22FSkZEXf/QkK
oCIGeVRFSYlA/zsBCZjq//9/PvSP1VvMxMDkxcCe6ZuZk5NZ7MPAnemcUZSfl5+Tn15ZwiCF5n2E
nDUoDhjVfhrpNABdpI5qWTJYmZ5nsD9Cg0pwSWnSyhOCaYXmAerMoDgsxnAkzG1R+XmpYPXL9Bln
1RhJPQarL+dgYNM1MLUyMKioKAYFOCvIBb8vl8qCOFxA4/jAiRIU7HqgYN8zk/n7jNxWfbAXeXJS
E4tLgOnUKbOk2IuBOzcfzqso6M1QmrzKkedPzcYO3QZu129As4xITlZI6QqYFNhz44v9EkFpCGua
LmEQdkktS83JL8gF5g4FqBGlIJ+wAI1gKJtZEvTws/j3FluPu4lcr7ra9OfHKXIZNTa4FPd8n33J
QXPFLte9AZe5uBaJvGrKVl+rbrTaXDZO6NwU7gnHOVgzzsmnGX2Y5GDqrst8wcTear0Ab1yj6PrD
F977vL/5iUMg773My5qLLK8OVAu6Tz7Xcyjy9Uym02Z/+xY7m85nYo/t4E93FXFKOf9/a3X78neS
jE5Tu066K3Mdf17m66mbpXN9y34ZZ3ErRobfn+RfzVBIWj0vc82vY7YPvM5eLHHOulV77M6CoB4h
xb/FjHWHRR+ldb6QmSP1ROGwGs+nx2quwitN7+mIpsRFhU37JPRoZe2ZjiX/70j7CS1tz51YP/3W
/xfnV2i/4rAoYeAN9nA0NTQqBxYMQcGOAG5
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Say this is read from file with a &lt;tt&gt;byte[]&lt;/tt&gt; of size &lt;tt&gt;1024&lt;/tt&gt; using &lt;tt&gt;Base64InputStream.read(byte[])&lt;/tt&gt;.  In the first iteration, all &lt;tt&gt;1190&lt;/tt&gt; bytes get read into &lt;tt&gt;buf&lt;/tt&gt;, then it enters &lt;tt&gt;Base64.setInitialBuffer&lt;/tt&gt; and assigns the &lt;tt&gt;byte&lt;span class=&quot;error&quot;&gt;&amp;#91;1024&amp;#93;&lt;/span&gt;&lt;/tt&gt; to &lt;tt&gt;buffer&lt;/tt&gt; and does a round of decoding.  When it then enters &lt;tt&gt;Base64.readResults&lt;/tt&gt; on line &lt;tt&gt;162&lt;/tt&gt; in &lt;tt&gt;Base64InputStream&lt;/tt&gt;, it sets &lt;tt&gt;buffer&lt;/tt&gt; to &lt;tt&gt;null&lt;/tt&gt;, &lt;tt&gt;modulus&lt;/tt&gt; has the left-over value &lt;tt&gt;3&lt;/tt&gt;, and the NPE occurs the next iteration.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;Base64InputStream&lt;/tt&gt; could avoid this by returning right away on EOF (&lt;tt&gt;-1&lt;/tt&gt;), but I think the real fix needs to happen in &lt;tt&gt;Base64&lt;/tt&gt; since it this same situation could be created by direct use.  My guess is either more needs to happen in the body of the &lt;tt&gt;if&lt;/tt&gt; on line &lt;tt&gt;542&lt;/tt&gt; (set &lt;tt&gt;modulus&lt;/tt&gt; to &lt;tt&gt;0&lt;/tt&gt;?) or the condition on line &lt;tt&gt;573&lt;/tt&gt; is flawed and needs adjusting.&lt;/p&gt;</description>
                <environment>&lt;p&gt;N/A&lt;/p&gt;</environment>
        <key id="12460244">CODEC-98</key>
            <summary>Base64InputStream causes NullPointerException on some input</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="blahjake">Jake Cobb</reporter>
                        <labels>
                            <label>base64</label>
                            <label>codec</label>
                            <label>nullpointerexception</label>
                            <label>stream</label>
                    </labels>
                <created>Thu, 25 Mar 2010 15:32:37 +0000</created>
                <updated>Wed, 2 Jun 2010 22:08:22 +0000</updated>
                            <resolved>Wed, 2 Jun 2010 22:08:22 +0000</resolved>
                                    <version>1.4</version>
                                    <fixVersion>Nightly Builds</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12849726" author="blahjake" created="Thu, 25 Mar 2010 15:34:49 +0000"  >&lt;p&gt;Removed &apos;malformed&apos; from summary since I&apos;m not sure this is actually the case.&lt;/p&gt;</comment>
                            <comment id="12849773" author="ggregory@seagullsw.com" created="Thu, 25 Mar 2010 16:51:11 +0000"  >&lt;p&gt;Thank you for the report. Can you please provide a unit test that demonstrate the issue?&lt;/p&gt;</comment>
                            <comment id="12849794" author="blahjake" created="Thu, 25 Mar 2010 17:39:41 +0000"  >&lt;p&gt;Here&apos;s one with a shorter input.  Basically, you can encode something to Base64 and then knock a character or two off the end of a line and it will usually be a triggering input.  However, if you use the input below with everything from &quot;//&quot; to the end removed, it doesn&apos;t trigger the NPE.&lt;/p&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Base64NPETest.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.ByteArrayInputStream;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.IOException;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.UnsupportedEncodingException;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.codec.binary.Base64InputStream;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.junit.Test;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Base64NPETest
{
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; INPUT =
		&lt;span class=&quot;code-quote&quot;&gt;&quot;H4sIAAAAAAAAAFvzloG1uIhBKiuxLFGvODW5tCizpFIvODM9LzXFPykrNbmE8&lt;span class=&quot;code-comment&quot;&gt;//eDC2bq/+ZGJi&quot;&lt;/span&gt;;
&lt;/span&gt;
	@Test
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testCodec98() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; UnsupportedEncodingException
	{
		ByteArrayInputStream data = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayInputStream(INPUT.getBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;));
		&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;
		{
			Base64InputStream stream = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Base64InputStream(data);
			&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] buf = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[1024];
			&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; read = 0;
			&lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt;( read != -1 )
				read = stream.read(buf);
			&lt;span class=&quot;code-comment&quot;&gt;// success &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; no NPE by &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; point
&lt;/span&gt;		}
		&lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt;(IOException ignore) 
		{ 
			&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.err.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Ignoring IOException&quot;&lt;/span&gt;);
		}
	}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12849800" author="ggregory@seagullsw.com" created="Thu, 25 Mar 2010 17:47:23 +0000"  >&lt;p&gt;So what should the behavior be on bad input? Garbage in, garbage out, no NPE? It&apos;s not complete garbage out in the case you describe where the end of the transmission is lopped off and causes an NPE.&lt;/p&gt;</comment>
                            <comment id="12849837" author="blahjake" created="Thu, 25 Mar 2010 18:49:29 +0000"  >&lt;p&gt;From &lt;tt&gt;Base64InputStream&lt;/tt&gt;, &lt;tt&gt;IOException&lt;/tt&gt; or a more specific subclass thereof would be appropriate.  Client code handling the stream will have to be expecting a possible &lt;tt&gt;IOException&lt;/tt&gt;, but a NPE when &lt;tt&gt;read&lt;/tt&gt;&apos;s argument is known to be non-&lt;tt&gt;null&lt;/tt&gt; is not expected and unlikely to be caught in a helpful place (if it gets caught at all).&lt;/p&gt;

&lt;p&gt;For &lt;tt&gt;Base64&lt;/tt&gt;, &lt;tt&gt;DecoderException&lt;/tt&gt; could be thrown by &lt;tt&gt;Base64.decode&lt;/tt&gt;.  Although this is adding a checked exception, the method is package-private so you should have some flexibility.  It looks like the public methods already throw this.  &lt;tt&gt;Base64InputStream&lt;/tt&gt; could then wrap the &lt;tt&gt;DecoderException&lt;/tt&gt; in an &lt;tt&gt;IOException&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;If someone had a use-case for wanting the portion that was decoded successfully despite knowing an error occurred, you could modify the exception to allow partial results to be attached.  Personally, I don&apos;t consider this necessary but others may disagree.&lt;/p&gt;</comment>
                            <comment id="12850382" author="juliusdavies" created="Fri, 26 Mar 2010 22:27:50 +0000"  >&lt;p&gt;The attached patch file fixes it!  I&apos;ll upload unit tests within next 2 hours.&lt;/p&gt;

&lt;p&gt;I&apos;m using my own test case:&lt;br/&gt;
YWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXpBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWjAxMjM&lt;/p&gt;

&lt;p&gt;Notice that Base64.decodeBase64() is able to deal with it:&lt;br/&gt;
abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123&lt;/p&gt;

&lt;p&gt;But Base64InputStream is not (with buffer of size 1024).  So this isn&apos;t an example of garbage-in/garbage-out.  This is valid input blowing up inside Base64InputStream!&lt;/p&gt;</comment>
                            <comment id="12850404" author="juliusdavies" created="Fri, 26 Mar 2010 23:41:09 +0000"  >
&lt;p&gt;Here are some JUnits to trigger the NPE.  I managed to trigger it with Base64OutputStream as well.&lt;/p&gt;
</comment>
                            <comment id="12850411" author="ggregory@seagullsw.com" created="Fri, 26 Mar 2010 23:50:17 +0000"  >&lt;p&gt;Julius: &lt;/p&gt;

&lt;p&gt;Your patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12439927/codec-98-fix.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12439927/codec-98-fix.patch&lt;/a&gt; is not licensed for Apache, there is no Apache feather next to the patch link in this ticket.&lt;/p&gt;

&lt;p&gt;Can remove and resubmit? Thank you.&lt;/p&gt;</comment>
                            <comment id="12850416" author="juliusdavies" created="Fri, 26 Mar 2010 23:57:33 +0000"  >&lt;p&gt;Sorry, accidentially clicked &quot; Attachment not intended for inclusion&quot; radio last time.&lt;/p&gt;

&lt;p&gt;Just to be clear, this 3 line patch &lt;em&gt;IS&lt;/em&gt; granted to ASF for inclusion in ASF works.&lt;/p&gt;


</comment>
                            <comment id="12874827" author="juliusdavies" created="Wed, 2 Jun 2010 22:08:22 +0000"  >&lt;p&gt;Committed to trunk: &lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=950267&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=950267&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12439933" name="codec-98-fix.patch" size="704" author="juliusdavies" created="Fri, 26 Mar 2010 23:57:33 +0000"/>
                            <attachment id="12439932" name="codec-98-tests.patch" size="4007" author="juliusdavies" created="Fri, 26 Mar 2010 23:41:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40232</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 25 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ep6v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>83843</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>