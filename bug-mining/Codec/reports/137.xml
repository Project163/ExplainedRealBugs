<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:25:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CODEC-250] Wrong value calculated by Cologne Phonetic if a special character is placed between equal letters</title>
                <link>https://issues.apache.org/jira/browse/CODEC-250</link>
                <project id="12310464" key="CODEC">Commons Codec</project>
                    <description>&lt;p&gt;The algorith for cologne phonetic is (simpilied):&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Encode letter by letter from left to right according to the conversion table.&lt;/li&gt;
	&lt;li&gt;Remove all digits occurring more than once next to each other.&lt;/li&gt;
	&lt;li&gt;Remove all code &quot;0&quot; except at the beginning.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Characters which are not specified in conversion table (such as hyphens) are ignored. See &lt;a href=&quot;https://en.wikipedia.org/wiki/Cologne_phonetics&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://en.wikipedia.org/wiki/Cologne_phonetics&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If the input is &quot;test-test&quot; the step results will be:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;20822082&lt;/li&gt;
	&lt;li&gt;2082082&lt;/li&gt;
	&lt;li&gt;28282&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;The expected result for &quot;test-test&quot; is therefor 28282.&lt;/p&gt;

&lt;p&gt;The actual result for &quot;test-test&quot; is 282&lt;font color=&quot;#FF0000&quot;&gt;2&lt;/font&gt;82.&lt;/p&gt;

&lt;p&gt;This bug is caused by the fix from&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/commons-codec/commit/72c8759a22c6552a2dfcdf61b29729f981752879&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-codec/commit/72c8759a22c6552a2dfcdf61b29729f981752879&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;and is present since 1.5&lt;/p&gt;</description>
                <environment></environment>
        <key id="13186807">CODEC-250</key>
            <summary>Wrong value calculated by Cologne Phonetic if a special character is placed between equal letters</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="xhelp">Alex Volodko</reporter>
                        <labels>
                    </labels>
                <created>Sat, 22 Sep 2018 13:24:10 +0000</created>
                <updated>Sat, 23 Feb 2019 13:00:36 +0000</updated>
                            <resolved>Sat, 23 Feb 2019 09:55:30 +0000</resolved>
                                    <version>1.5</version>
                    <version>1.11</version>
                                    <fixVersion>1.12</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="600">10m</timespent>
                                <comments>
                            <comment id="16624666" author="xhelp" created="Sat, 22 Sep 2018 13:24:50 +0000"  >&lt;p&gt;I will provide a PR for the fix including a new test&lt;/p&gt;</comment>
                            <comment id="16624688" author="githubbot" created="Sat, 22 Sep 2018 14:04:21 +0000"  >&lt;p&gt;GitHub user DerXHelp opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-codec/pull/14&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-codec/pull/14&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CODEC-250&quot; title=&quot;Wrong value calculated by Cologne Phonetic if a special character is placed between equal letters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CODEC-250&quot;&gt;&lt;del&gt;CODEC-250&lt;/del&gt;&lt;/a&gt; correcting handling of special character between equal letters for cologne phonetic&lt;/p&gt;

&lt;p&gt;    Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/CODEC-250&quot; title=&quot;Wrong value calculated by Cologne Phonetic if a special character is placed between equal letters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CODEC-250&quot;&gt;&lt;del&gt;CODEC-250&lt;/del&gt;&lt;/a&gt;(&lt;a href=&quot;https://issues.apache.org/jira/browse/CODEC-250&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CODEC-250&lt;/a&gt;) for handling of special characters between equal letters for cologne phonetic.&lt;br/&gt;
    &quot;Test-test&quot; and &quot;testtest&quot; should result in the same value according to cologne phonetic.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/DerXHelp/commons-codec&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/DerXHelp/commons-codec&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/CODEC-250&quot; title=&quot;Wrong value calculated by Cologne Phonetic if a special character is placed between equal letters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CODEC-250&quot;&gt;&lt;del&gt;CODEC-250&lt;/del&gt;&lt;/a&gt;-cologne-phonetic&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/commons-codec/pull/14.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-codec/pull/14.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #14&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 4f6547a3dfc808824622e0ff502d9a870a66c1fc&lt;br/&gt;
Author: Alex Volodko &amp;lt;volodko@...&amp;gt;&lt;br/&gt;
Date:   2018-09-22T14:01:56Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CODEC-250&quot; title=&quot;Wrong value calculated by Cologne Phonetic if a special character is placed between equal letters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CODEC-250&quot;&gt;&lt;del&gt;CODEC-250&lt;/del&gt;&lt;/a&gt; correcting handling of special character between equal letters for cologne phonetic&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16625049" author="xhelp" created="Sun, 23 Sep 2018 09:49:39 +0000"  >&lt;p&gt;The fix is created in respect to the existing code, so its basically a minimal change to fix the problem.&lt;/p&gt;

&lt;p&gt;However, it might be worth to consider refactoring/rewriting this class. The current implementation works, but its not trivial to recognize the full algorithm based on the implementation.&lt;/p&gt;</comment>
                            <comment id="16629965" author="sebb@apache.org" created="Thu, 27 Sep 2018 08:58:06 +0000"  >&lt;p&gt;I agree that the code could/should be re-written.&lt;br/&gt;
Does it makes sense to to try to do the encoding in a single pass?&lt;br/&gt;
It makes the code harder to follow and maintain, as evidenced by this bug report.&lt;/p&gt;

&lt;p&gt;It could certainly do with some more comments as to the meaning of some of the variables and the special values they may take.&lt;/p&gt;</comment>
                            <comment id="16630003" author="xhelp" created="Thu, 27 Sep 2018 09:11:58 +0000"  >&lt;p&gt;I don&apos;t see a reason for &quot;do everything in a single step&quot; approach, cologne phonetic is not a highly complex&#160;algorithm, which require fancy implementation tricks to gain some performance improvements. I would split the steps in order to reflect the description of the algorithm.&lt;/p&gt;

&lt;p&gt;Since you also agree on rewriting, I would suggest that I&#160;provide a PR with a&#160;new implementation and based on that suggestion we will work out a final implementation.&lt;/p&gt;</comment>
                            <comment id="16630045" author="sebb@apache.org" created="Thu, 27 Sep 2018 09:28:03 +0000"  >&lt;p&gt;Surely the ignored letters could be dropped in the pre-processing phase?&lt;/p&gt;</comment>
                            <comment id="16630058" author="sebb@apache.org" created="Thu, 27 Sep 2018 09:35:12 +0000"  >&lt;p&gt;I also noticed that the PREPROCESS_MAP contains the German small s (looks like a beta).&lt;br/&gt;
However, this is converted to &apos;SS&apos; by String#toUpperCase(Locale.GERMAN), so it serves no purpose in the map.&lt;br/&gt;
This made me wonder if the small-s should be converted before up-casing.&lt;br/&gt;
But AFAICT &apos;SS&apos; is treated the same way as &apos;S&apos; so it does not matter when it is converted.&lt;/p&gt;</comment>
                            <comment id="16630063" author="sebb@apache.org" created="Thu, 27 Sep 2018 09:40:12 +0000"  >&lt;p&gt;Also the private preprocess method returns a String, but the calling code needs a char array, so the conversion to String is useless.&lt;/p&gt;</comment>
                            <comment id="16630167" author="xhelp" created="Thu, 27 Sep 2018 10:42:57 +0000"  >&lt;p&gt;Regarding the ignored letters: yes, according to the algorithm they are simply ignored. So for the implementation: if they are removed from the input string,&#160;it should be correct. I understand that the description of the algorithm is quite short and generic, it might have some room for interpretations. On the other hand: this algorithm should allow to compare words phonetically: you don&apos;t pronounce special characters and for the german language (which is the main target group of cologne phonetic) I cannot came up with a &quot;non letter&quot; character, which will change the pronunciation of the word.&lt;/p&gt;

&lt;p&gt;Regarding the handling of &#223; (sharp s): yes, you are competly right. Stricly according to the algorithm it should be handled as &apos;S&apos;, but both value &apos;S&apos; and &apos;SS&apos; have the same output, so at the end it doesn&apos;t matter, but on the other hand: also don&apos;t make the code more understandable.&lt;/p&gt;</comment>
                            <comment id="16630262" author="sebb@apache.org" created="Thu, 27 Sep 2018 11:42:38 +0000"  >&lt;p&gt;I find it confusing that the PREPROCESS_MAP contains a char that cannot occur.&lt;br/&gt;
(Thus there can never be 100% code coverage).&lt;/p&gt;

&lt;p&gt;Before making any changes I think it would be useful to increase the test coverage.&lt;br/&gt;
For example, there don&apos;t appear to be any tests containing small sharp s.&lt;/p&gt;</comment>
                            <comment id="16631105" author="sebb@apache.org" created="Thu, 27 Sep 2018 22:16:30 +0000"  >&lt;p&gt;In trying to simplify the code, I found what seems to be another way to fix the hyphenation issue.&lt;br/&gt;
If the code detects &apos;H&apos; or a char outside &apos;A&apos; - &apos;Z&apos; then ignore it completely.&lt;/p&gt;

&lt;p&gt;See patch to follow.&lt;/p&gt;</comment>
                            <comment id="16631586" author="xhelp" created="Fri, 28 Sep 2018 09:11:40 +0000"  >&lt;p&gt;Agree, also a way to fix it.&#160;In my opinion also a better/clearer&#160;way to do it.&lt;/p&gt;

&lt;p&gt;But I&#160;would&#160;shift the block as an independent&#160;IF before the whole if...else if...else if... construct. To have an abort criteria in a huge&#160;IF construct, which is actually designed to determin the code-to-be-used seems&#160;odd to me.&lt;/p&gt;</comment>
                            <comment id="16631698" author="sebb@apache.org" created="Fri, 28 Sep 2018 10:58:32 +0000"  >&lt;p&gt;Good point; will do.&lt;/p&gt;</comment>
                            <comment id="16632146" author="sebb@apache.org" created="Fri, 28 Sep 2018 17:11:43 +0000"  >&lt;p&gt;Attached sample reworking of the colognePhonetic method using a switch statement on the current char.&lt;/p&gt;

&lt;p&gt;I think this is easier to compare the Wikipedia conversion table.&lt;br/&gt;
It should also be more efficient as there are fewer array scans.&lt;/p&gt;

&lt;p&gt;It passes all the existing tests.&lt;/p&gt;</comment>
                            <comment id="16632618" author="sebb@apache.org" created="Fri, 28 Sep 2018 22:55:42 +0000"  >&lt;p&gt;Added fix to skip H and invalid chars before the large IF block;&lt;br/&gt;
added test to show this fixes this issue&lt;/p&gt;

&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/viewvc?rev=1842290&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=1842290&amp;amp;view=rev&lt;/a&gt;&lt;br/&gt;
Log:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/CODEC-250&quot; title=&quot;Wrong value calculated by Cologne Phonetic if a special character is placed between equal letters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CODEC-250&quot;&gt;&lt;del&gt;CODEC-250&lt;/del&gt;&lt;/a&gt; Wrong value calculated by Cologne Phonetic if a special character is placed between equal letters&lt;/p&gt;

&lt;p&gt;Modified:&lt;br/&gt;
    commons/proper/codec/trunk/src/changes/changes.xml&lt;br/&gt;
    commons/proper/codec/trunk/src/main/java/org/apache/commons/codec/language/ColognePhonetic.java&lt;br/&gt;
    commons/proper/codec/trunk/src/test/java/org/apache/commons/codec/language/ColognePhoneticTest.java&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12941602" name="CODEC250.patch" size="912" author="sebb" created="Thu, 27 Sep 2018 22:16:54 +0000"/>
                            <attachment id="12941714" name="ColognePhonetic.java" size="3929" author="sebb" created="Fri, 28 Sep 2018 17:06:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 7 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ydtj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>