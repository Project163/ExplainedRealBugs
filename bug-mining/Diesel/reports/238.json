{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/3446","repository_url":"https://api.github.com/repos/diesel-rs/diesel","labels_url":"https://api.github.com/repos/diesel-rs/diesel/issues/3446/labels{/name}","comments_url":"https://api.github.com/repos/diesel-rs/diesel/issues/3446/comments","events_url":"https://api.github.com/repos/diesel-rs/diesel/issues/3446/events","html_url":"https://github.com/diesel-rs/diesel/issues/3446","id":1492605390,"node_id":"I_kwDOAnrqL85Y91nO","number":3446,"title":"Infer_schema! generates joinable for composite Foreign Key","user":{"login":"lochetti","id":2541422,"node_id":"MDQ6VXNlcjI1NDE0MjI=","avatar_url":"https://avatars.githubusercontent.com/u/2541422?v=4","gravatar_id":"","url":"https://api.github.com/users/lochetti","html_url":"https://github.com/lochetti","followers_url":"https://api.github.com/users/lochetti/followers","following_url":"https://api.github.com/users/lochetti/following{/other_user}","gists_url":"https://api.github.com/users/lochetti/gists{/gist_id}","starred_url":"https://api.github.com/users/lochetti/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lochetti/subscriptions","organizations_url":"https://api.github.com/users/lochetti/orgs","repos_url":"https://api.github.com/users/lochetti/repos","events_url":"https://api.github.com/users/lochetti/events{/privacy}","received_events_url":"https://api.github.com/users/lochetti/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":254193212,"node_id":"MDU6TGFiZWwyNTQxOTMyMTI=","url":"https://api.github.com/repos/diesel-rs/diesel/labels/bug","name":"bug","color":"fc2929","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":13,"created_at":"2022-12-12T19:35:04Z","updated_at":"2022-12-21T14:58:08Z","closed_at":"2022-12-21T14:51:40Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Setup\r\nThe following repository was used to setup and reproduce the problem: https://github.com/lochetti/diesel_joinable_composite_fk\r\n\r\nThe problem is reproduced just by running the migration with the print_schema enabled.\r\n\r\n### Versions\r\n\r\n- **Rust**: 1.65\r\n- **Diesel**: 2.0.2\r\n- **Database**: Postgresql\r\n- **Operating System**: Fedora 37\r\n\r\n### Feature Flags\r\n\r\n- **diesel:**[\"32-column-tables\", \"chrono\", \"numeric\", \"postgres\", \"r2d2\", \"without-deprecated\"]\r\n\r\n## Problem Description\r\nAccording to [the documentation](https://docs.diesel.rs/diesel/macro.joinable.html)  we didn't expect to have a joinable being created between the second and third tables, since the only relationship between them is the composite foreign key.\r\n\r\nA more dangerous implication of this problem is that it seems that diesel chooses the first column to be the joinable which could lead to wrong joining strategies. This can be verified by changing the order of the columns in the definition of the foreign key, in the migration file, which generates a different join strategy.\r\n\r\n### What are you trying to accomplish?\r\nI'm trying to be sure that the infer_schema only creates joinables that are correct, and in that case the joinable created could not be correct.\r\n\r\n### What is the expected output?\r\nI expect to don't have a joinable between those tables, according to the documentation provided.\r\n\r\n### What is the actual output?\r\nSee the schema.rs file in the [setup repository](https://github.com/lochetti/diesel_joinable_composite_fk/blob/main/src/schema.rs).\r\n\r\n### Are you seeing any additional errors?\r\nNo.\r\n\r\n### Steps to reproduce\r\n1. clone the repository\r\n2. configure a postgres database_url in the .env file\r\n3. Run `diesel setup` .\r\n4. See the outputed schema.rs file\r\n\r\n## Checklist\r\n\r\n- [X] I have already looked over the [issue tracker](https://github.com/diesel-rs/diesel/issues)  and the [disussion forum](https://github.com/diesel-rs/diesel/discussions)  for similar possible closed issues. \r\n- [X] This issue can be reproduced on Rust's stable channel. (Your issue will be\r\n  closed if this is not the case)\r\n- [X] This issue can be reproduced without requiring a third party crate","closed_by":{"login":"weiznich","id":1674512,"node_id":"MDQ6VXNlcjE2NzQ1MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1674512?v=4","gravatar_id":"","url":"https://api.github.com/users/weiznich","html_url":"https://github.com/weiznich","followers_url":"https://api.github.com/users/weiznich/followers","following_url":"https://api.github.com/users/weiznich/following{/other_user}","gists_url":"https://api.github.com/users/weiznich/gists{/gist_id}","starred_url":"https://api.github.com/users/weiznich/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weiznich/subscriptions","organizations_url":"https://api.github.com/users/weiznich/orgs","repos_url":"https://api.github.com/users/weiznich/repos","events_url":"https://api.github.com/users/weiznich/events{/privacy}","received_events_url":"https://api.github.com/users/weiznich/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/3446/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/diesel-rs/diesel/issues/3446/timeline","performed_via_github_app":null,"state_reason":"completed"}