{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/1988","repository_url":"https://api.github.com/repos/diesel-rs/diesel","labels_url":"https://api.github.com/repos/diesel-rs/diesel/issues/1988/labels{/name}","comments_url":"https://api.github.com/repos/diesel-rs/diesel/issues/1988/comments","events_url":"https://api.github.com/repos/diesel-rs/diesel/issues/1988/events","html_url":"https://github.com/diesel-rs/diesel/issues/1988","id":411174983,"node_id":"MDU6SXNzdWU0MTExNzQ5ODM=","number":1988,"title":"Our current design of `BoxedSelectStatement` cannot support `group_by` backwards compatibly","user":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":293011870,"node_id":"MDU6TGFiZWwyOTMwMTE4NzA=","url":"https://api.github.com/repos/diesel-rs/diesel/labels/breaking%20change","name":"breaking change","color":"f7c6c7","default":false,"description":null},{"id":1236576152,"node_id":"MDU6TGFiZWwxMjM2NTc2MTUy","url":"https://api.github.com/repos/diesel-rs/diesel/labels/Release%20Blocker","name":"Release Blocker","color":"bc3529","default":false,"description":"This issue needs to be solved before we can release a new version, it can't be punted to the next"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/diesel-rs/diesel/milestones/16","html_url":"https://github.com/diesel-rs/diesel/milestone/16","labels_url":"https://api.github.com/repos/diesel-rs/diesel/milestones/16/labels","id":3954983,"node_id":"MDk6TWlsZXN0b25lMzk1NDk4Mw==","number":16,"title":"2.0","description":"","creator":{"login":"weiznich","id":1674512,"node_id":"MDQ6VXNlcjE2NzQ1MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1674512?v=4","gravatar_id":"","url":"https://api.github.com/users/weiznich","html_url":"https://github.com/weiznich","followers_url":"https://api.github.com/users/weiznich/followers","following_url":"https://api.github.com/users/weiznich/following{/other_user}","gists_url":"https://api.github.com/users/weiznich/gists{/gist_id}","starred_url":"https://api.github.com/users/weiznich/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weiznich/subscriptions","organizations_url":"https://api.github.com/users/weiznich/orgs","repos_url":"https://api.github.com/users/weiznich/repos","events_url":"https://api.github.com/users/weiznich/events{/privacy}","received_events_url":"https://api.github.com/users/weiznich/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":1,"closed_issues":40,"state":"closed","created_at":"2019-01-09T08:56:03Z","updated_at":"2024-11-24T07:42:53Z","due_on":null,"closed_at":"2022-10-27T10:21:27Z"},"comments":0,"created_at":"2019-02-17T10:59:13Z","updated_at":"2020-11-09T16:34:41Z","closed_at":"2020-11-09T16:34:40Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Right now we erase the types of both the select clause and the group by clause, which means that we can't enforce that either one is valid. Making this type safe will require a breaking change, so we should decide what option we want to take before 2.0 is released, even if 2.0 doesn't include `group_by`.\r\n\r\nThese are the options that I can see, roughly in order of my personal preference. I'd love to hear others thoughts on the pros/cons, their preference on the direction we take, or if there's something I've missed.\r\n\r\n1. Continue erasing both types, do not allow either `.select` or `.group_by` to be called after boxing. This might not be as unreasonable as it sounds, since you can still conditionally modify them but it'll always have to be done before boxing. So it'd look more like:\r\n\r\n```rust\r\nlet mut query = if some_condition {\r\n    query.select(foo).group_by(bar).into_boxed()\r\n} else {\r\n    query.into_boxed()\r\n}\r\n```\r\n\r\n2. Leave things as they are, state in our documentation that we do not properly type check `GROUP BY` clauses on boxed select statements, and that the use of `GROUP BY` or aggregate functions after boxing could result in runtime errors.\r\n3. Stop erasing one or both clauses. This would let us safely call them after boxing, but doing so becomes basically useless since it changes the type of the query, meaning you couldn't do it conditionally.\r\n\r\nOptions 1 and 3 are major breaking changes, so we'll need to do that in 2.0 if we're going to do either one.","closed_by":{"login":"weiznich","id":1674512,"node_id":"MDQ6VXNlcjE2NzQ1MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1674512?v=4","gravatar_id":"","url":"https://api.github.com/users/weiznich","html_url":"https://github.com/weiznich","followers_url":"https://api.github.com/users/weiznich/followers","following_url":"https://api.github.com/users/weiznich/following{/other_user}","gists_url":"https://api.github.com/users/weiznich/gists{/gist_id}","starred_url":"https://api.github.com/users/weiznich/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weiznich/subscriptions","organizations_url":"https://api.github.com/users/weiznich/orgs","repos_url":"https://api.github.com/users/weiznich/repos","events_url":"https://api.github.com/users/weiznich/events{/privacy}","received_events_url":"https://api.github.com/users/weiznich/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/1988/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/diesel-rs/diesel/issues/1988/timeline","performed_via_github_app":null,"state_reason":"completed"}