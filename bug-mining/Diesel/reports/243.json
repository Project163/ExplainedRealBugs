{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/3566","repository_url":"https://api.github.com/repos/diesel-rs/diesel","labels_url":"https://api.github.com/repos/diesel-rs/diesel/issues/3566/labels{/name}","comments_url":"https://api.github.com/repos/diesel-rs/diesel/issues/3566/comments","events_url":"https://api.github.com/repos/diesel-rs/diesel/issues/3566/events","html_url":"https://github.com/diesel-rs/diesel/issues/3566","id":1640570487,"node_id":"I_kwDOAnrqL85hyR53","number":3566,"title":"MultiConnection not usable for queries containing `Selectable` or boxed queries.","user":{"login":"weiznich","id":1674512,"node_id":"MDQ6VXNlcjE2NzQ1MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1674512?v=4","gravatar_id":"","url":"https://api.github.com/users/weiznich","html_url":"https://github.com/weiznich","followers_url":"https://api.github.com/users/weiznich/followers","following_url":"https://api.github.com/users/weiznich/following{/other_user}","gists_url":"https://api.github.com/users/weiznich/gists{/gist_id}","starred_url":"https://api.github.com/users/weiznich/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weiznich/subscriptions","organizations_url":"https://api.github.com/users/weiznich/orgs","repos_url":"https://api.github.com/users/weiznich/repos","events_url":"https://api.github.com/users/weiznich/events{/privacy}","received_events_url":"https://api.github.com/users/weiznich/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":254193212,"node_id":"MDU6TGFiZWwyNTQxOTMyMTI=","url":"https://api.github.com/repos/diesel-rs/diesel/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":292827048,"node_id":"MDU6TGFiZWwyOTI4MjcwNDg=","url":"https://api.github.com/repos/diesel-rs/diesel/labels/hole%20in%20api","name":"hole in api","color":"eb6420","default":false,"description":null},{"id":310402791,"node_id":"MDU6TGFiZWwzMTA0MDI3OTE=","url":"https://api.github.com/repos/diesel-rs/diesel/labels/internal%20or%20unreleased%20api","name":"internal or unreleased api","color":"5319e7","default":false,"description":null},{"id":1236576152,"node_id":"MDU6TGFiZWwxMjM2NTc2MTUy","url":"https://api.github.com/repos/diesel-rs/diesel/labels/Release%20Blocker","name":"Release Blocker","color":"bc3529","default":false,"description":"This issue needs to be solved before we can release a new version, it can't be punted to the next"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2023-03-25T16:14:45Z","updated_at":"2023-04-25T18:49:44Z","closed_at":"2023-04-25T18:49:44Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\nIf you want to report a bug, we added some points below which help us track down the problem faster.\r\n-->\r\n\r\n## Setup\r\n\r\n### Versions\r\n\r\n- **Rust:**\r\n- **Diesel:** [e548447](https://github.com/diesel-rs/diesel/commit/e5484477b11eeae13054ab4c3b3a006d9eddfe82) \r\n- **Database:**\r\n- **Operating System**\r\n\r\n### Feature Flags\r\n\r\n- **diesel: sqlite postgres**\r\n\r\n## Problem Description\r\n\r\n\r\n### What are you trying to accomplish?\r\n\r\nI've tried the following code:\r\n\r\n```rust\r\nuse diesel::prelude::*;\r\n\r\ntable! {\r\n    users {\r\n        id -> Integer,\r\n        name -> Text,\r\n    }\r\n}\r\n\r\n#[derive(Selectable, Queryable)]\r\nstruct User {\r\n    id: i32,\r\n}\r\n\r\n#[derive(diesel::MultiConnection)]\r\nenum DbConnection {\r\n    Sqlite(SqliteConnection),\r\n    Pg(PgConnection)\r\n}\r\n\r\nfn main() {\r\n    let conn = &mut DbConnection::establish(\"â€¦\").unwrap();\r\n\r\n    let u = users::table.into_boxed().load::<(i32, String)>(conn);\r\n\r\n    let u = users::table\r\n        .select(User::as_select())\r\n        .load(conn);\r\n}\r\n\r\n```\r\n\r\n\r\n### What is the expected output?\r\n\r\nCode compiles\r\n\r\n\r\n### What is the actual output?\r\n\r\nCode does not compile:\r\n\r\n```rust\r\nerror[E0277]: the trait bound `BoxedSelectStatement<'_, (diesel::sql_types::Integer, diesel::sql_types::Text), FromClause<users::table>, multi_connection_impl::backend::MultiBackend>: QueryFragment<Sqlite>` is not satisfied\r\n    --> src/main.rs:24:61\r\n     |\r\n24   |     let u = users::table.into_boxed().load::<(i32, String)>(conn);\r\n     |                                       ----                  ^^^^ the trait `QueryFragment<Sqlite>` is not implemented for `BoxedSelectStatement<'_, (diesel::sql_types::Integer, diesel::sql_types::Text), FromClause<users::table>, multi_connection_impl::backend::MultiBackend>`\r\n     |                                       |\r\n     |                                       required by a bound introduced by this call\r\n     |\r\n     = help: the following other types implement trait `QueryFragment<DB, SP>`:\r\n               <BoxedSelectStatement<'a, ST, QS, DB, GB> as QueryFragment<DB, AnsiSqlSelectStatement>>\r\n               <BoxedSelectStatement<'a, ST, QS, DB, GB> as QueryFragment<DB>>\r\n               <BoxedSelectStatement<'a, ST, QS, multi_connection_impl::backend::MultiBackend, GB> as QueryFragment<multi_connection_impl::backend::MultiBackend, MultiSelectStatementSyntax>>\r\nnote: required for `BoxedSelectStatement<'_, (Integer, Text), FromClause<table>, MultiBackend>` to implement `QueryFragment<multi_connection_impl::backend::MultiBackend, MultiSelectStatementSyntax>`\r\n    --> src/main.rs:15:10\r\n     |\r\n15   | #[derive(diesel::MultiConnection)]\r\n     |          ^^^^^^^^^^^^^^^^^^^^^^^ unsatisfied trait bound introduced in this `derive` macro\r\n     = note: the full type name has been written to '/tmp/diesel_test/target/debug/deps/diesel_test-e9839cd4beffff40.long-type-6862964700214725501.txt'\r\n     = note: 1 redundant requirement hidden\r\n     = note: required for `BoxedSelectStatement<'_, (Integer, Text), FromClause<table>, MultiBackend>` to implement `QueryFragment<multi_connection_impl::backend::MultiBackend>`\r\n     = note: the full type name has been written to '/tmp/diesel_test/target/debug/deps/diesel_test-e9839cd4beffff40.long-type-17859806514065189679.txt'\r\n     = note: required for `BoxedSelectStatement<'_, (Integer, Text), FromClause<table>, MultiBackend>` to implement `LoadQuery<'_, DbConnection, (i32, String)>`\r\n     = note: the full type name has been written to '/tmp/diesel_test/target/debug/deps/diesel_test-e9839cd4beffff40.long-type-17859806514065189679.txt'\r\nnote: required by a bound in `diesel::RunQueryDsl::load`\r\n    --> /home/weiznich/Documents/rust/diesel/diesel/src/query_dsl/mod.rs:1543:15\r\n     |\r\n1543 |         Self: LoadQuery<'query, Conn, U>,\r\n     |               ^^^^^^^^^^^^^^^^^^^^^^^^^^ required by this bound in `RunQueryDsl::load`\r\n     = note: this error originates in the derive macro `diesel::MultiConnection` (in Nightly builds, run with -Z macro-backtrace for more info)\r\n\r\nerror[E0277]: the trait bound `BoxedSelectStatement<'_, (diesel::sql_types::Integer, diesel::sql_types::Text), FromClause<users::table>, multi_connection_impl::backend::MultiBackend>: QueryFragment<Pg>` is not satisfied\r\n    --> src/main.rs:24:61\r\n     |\r\n24   |     let u = users::table.into_boxed().load::<(i32, String)>(conn);\r\n     |                                       ----                  ^^^^ the trait `QueryFragment<Pg>` is not implemented for `BoxedSelectStatement<'_, (diesel::sql_types::Integer, diesel::sql_types::Text), FromClause<users::table>, multi_connection_impl::backend::MultiBackend>`\r\n     |                                       |\r\n     |                                       required by a bound introduced by this call\r\n     |\r\n     = help: the following other types implement trait `QueryFragment<DB, SP>`:\r\n               <BoxedSelectStatement<'a, ST, QS, DB, GB> as QueryFragment<DB, AnsiSqlSelectStatement>>\r\n               <BoxedSelectStatement<'a, ST, QS, DB, GB> as QueryFragment<DB>>\r\n               <BoxedSelectStatement<'a, ST, QS, multi_connection_impl::backend::MultiBackend, GB> as QueryFragment<multi_connection_impl::backend::MultiBackend, MultiSelectStatementSyntax>>\r\nnote: required for `BoxedSelectStatement<'_, (Integer, Text), FromClause<table>, MultiBackend>` to implement `QueryFragment<multi_connection_impl::backend::MultiBackend, MultiSelectStatementSyntax>`\r\n    --> src/main.rs:15:10\r\n     |\r\n15   | #[derive(diesel::MultiConnection)]\r\n     |          ^^^^^^^^^^^^^^^^^^^^^^^ unsatisfied trait bound introduced in this `derive` macro\r\n     = note: the full type name has been written to '/tmp/diesel_test/target/debug/deps/diesel_test-e9839cd4beffff40.long-type-6862964700214725501.txt'\r\n     = note: 1 redundant requirement hidden\r\n     = note: required for `BoxedSelectStatement<'_, (Integer, Text), FromClause<table>, MultiBackend>` to implement `QueryFragment<multi_connection_impl::backend::MultiBackend>`\r\n     = note: the full type name has been written to '/tmp/diesel_test/target/debug/deps/diesel_test-e9839cd4beffff40.long-type-17859806514065189679.txt'\r\n     = note: required for `BoxedSelectStatement<'_, (Integer, Text), FromClause<table>, MultiBackend>` to implement `LoadQuery<'_, DbConnection, (i32, String)>`\r\n     = note: the full type name has been written to '/tmp/diesel_test/target/debug/deps/diesel_test-e9839cd4beffff40.long-type-17859806514065189679.txt'\r\nnote: required by a bound in `diesel::RunQueryDsl::load`\r\n    --> /home/weiznich/Documents/rust/diesel/diesel/src/query_dsl/mod.rs:1543:15\r\n     |\r\n1543 |         Self: LoadQuery<'query, Conn, U>,\r\n     |               ^^^^^^^^^^^^^^^^^^^^^^^^^^ required by this bound in `RunQueryDsl::load`\r\n     = note: this error originates in the derive macro `diesel::MultiConnection` (in Nightly builds, run with -Z macro-backtrace for more info)\r\n\r\nerror[E0277]: the trait bound `LimitOffsetClause<diesel::query_builder::limit_clause::NoLimitClause, diesel::query_builder::offset_clause::NoOffsetClause>: IntoBoxedClause<'_, multi_connection_impl::backend::MultiBackend>` is not satisfied\r\n  --> src/main.rs:24:26\r\n   |\r\n24 |     let u = users::table.into_boxed().load::<(i32, String)>(conn);\r\n   |                          ^^^^^^^^^^ the trait `IntoBoxedClause<'_, multi_connection_impl::backend::MultiBackend>` is not implemented for `LimitOffsetClause<diesel::query_builder::limit_clause::NoLimitClause, diesel::query_builder::offset_clause::NoOffsetClause>`\r\n   |\r\n   = help: the trait `IntoBoxedClause<'a, Sqlite>` is implemented for `LimitOffsetClause<diesel::query_builder::limit_clause::NoLimitClause, diesel::query_builder::offset_clause::NoOffsetClause>`\r\n   = note: required for `SelectStatement<FromClause<users::table>>` to implement `BoxedDsl<'_, multi_connection_impl::backend::MultiBackend>`\r\n\r\nerror[E0277]: the trait bound `LimitOffsetClause<diesel::query_builder::limit_clause::NoLimitClause, diesel::query_builder::offset_clause::NoOffsetClause>: IntoBoxedClause<'_, multi_connection_impl::backend::MultiBackend>` is not satisfied\r\n    --> src/main.rs:24:26\r\n     |\r\n24   |     let u = users::table.into_boxed().load::<(i32, String)>(conn);\r\n     |                          ^^^^^^^^^^ the trait `IntoBoxedClause<'_, multi_connection_impl::backend::MultiBackend>` is not implemented for `LimitOffsetClause<diesel::query_builder::limit_clause::NoLimitClause, diesel::query_builder::offset_clause::NoOffsetClause>`\r\n     |\r\n     = help: the trait `IntoBoxedClause<'a, Sqlite>` is implemented for `LimitOffsetClause<diesel::query_builder::limit_clause::NoLimitClause, diesel::query_builder::offset_clause::NoOffsetClause>`\r\n     = note: required for `SelectStatement<FromClause<users::table>>` to implement `BoxedDsl<'_, multi_connection_impl::backend::MultiBackend>`\r\n     = note: 1 redundant requirement hidden\r\n     = note: required for `users::table` to implement `BoxedDsl<'_, multi_connection_impl::backend::MultiBackend>`\r\nnote: required by a bound in `diesel::QueryDsl::into_boxed`\r\n    --> /home/weiznich/Documents/rust/diesel/diesel/src/query_dsl/mod.rs:1299:15\r\n     |\r\n1299 |         Self: methods::BoxedDsl<'a, DB>,\r\n     |               ^^^^^^^^^^^^^^^^^^^^^^^^^ required by this bound in `QueryDsl::into_boxed`\r\n\r\nerror[E0277]: the trait bound `SelectBy<User, multi_connection_impl::backend::MultiBackend>: QueryFragment<Sqlite>` is not satisfied\r\n    --> src/main.rs:28:15\r\n     |\r\n28   |         .load(conn);\r\n     |          ---- ^^^^ the trait `QueryFragment<Sqlite>` is not implemented for `SelectBy<User, multi_connection_impl::backend::MultiBackend>`\r\n     |          |\r\n     |          required by a bound introduced by this call\r\n     |\r\n     = help: the trait `QueryFragment<DB>` is implemented for `SelectBy<T, DB>`\r\n     = note: required for `diesel::query_builder::select_clause::SelectClause<SelectBy<User, multi_connection_impl::backend::MultiBackend>>` to implement `QueryFragment<Sqlite>`\r\n     = note: 4 redundant requirements hidden\r\n     = note: required for `SelectStatement<FromClause<table>, SelectClause<SelectBy<User, MultiBackend>>>` to implement `QueryFragment<multi_connection_impl::backend::MultiBackend>`\r\n     = note: the full type name has been written to '/tmp/diesel_test/target/debug/deps/diesel_test-e9839cd4beffff40.long-type-13019818345722010715.txt'\r\n     = note: required for `SelectStatement<FromClause<table>, SelectClause<SelectBy<User, MultiBackend>>>` to implement `LoadQuery<'_, DbConnection, User>`\r\n     = note: the full type name has been written to '/tmp/diesel_test/target/debug/deps/diesel_test-e9839cd4beffff40.long-type-13019818345722010715.txt'\r\nnote: required by a bound in `diesel::RunQueryDsl::load`\r\n    --> /home/weiznich/Documents/rust/diesel/diesel/src/query_dsl/mod.rs:1543:15\r\n     |\r\n1543 |         Self: LoadQuery<'query, Conn, U>,\r\n     |               ^^^^^^^^^^^^^^^^^^^^^^^^^^ required by this bound in `RunQueryDsl::load`\r\n\r\nerror[E0277]: the trait bound `SelectBy<User, multi_connection_impl::backend::MultiBackend>: QueryFragment<Pg>` is not satisfied\r\n    --> src/main.rs:28:15\r\n     |\r\n28   |         .load(conn);\r\n     |          ---- ^^^^ the trait `QueryFragment<Pg>` is not implemented for `SelectBy<User, multi_connection_impl::backend::MultiBackend>`\r\n     |          |\r\n     |          required by a bound introduced by this call\r\n     |\r\n     = help: the trait `QueryFragment<DB>` is implemented for `SelectBy<T, DB>`\r\n     = note: required for `diesel::query_builder::select_clause::SelectClause<SelectBy<User, multi_connection_impl::backend::MultiBackend>>` to implement `QueryFragment<Pg>`\r\n     = note: 4 redundant requirements hidden\r\n     = note: required for `SelectStatement<FromClause<table>, SelectClause<SelectBy<User, MultiBackend>>>` to implement `QueryFragment<multi_connection_impl::backend::MultiBackend>`\r\n     = note: the full type name has been written to '/tmp/diesel_test/target/debug/deps/diesel_test-e9839cd4beffff40.long-type-13019818345722010715.txt'\r\n     = note: required for `SelectStatement<FromClause<table>, SelectClause<SelectBy<User, MultiBackend>>>` to implement `LoadQuery<'_, DbConnection, User>`\r\n     = note: the full type name has been written to '/tmp/diesel_test/target/debug/deps/diesel_test-e9839cd4beffff40.long-type-13019818345722010715.txt'\r\nnote: required by a bound in `diesel::RunQueryDsl::load`\r\n    --> /home/weiznich/Documents/rust/diesel/diesel/src/query_dsl/mod.rs:1543:15\r\n     |\r\n1543 |         Self: LoadQuery<'query, Conn, U>,\r\n     |               ^^^^^^^^^^^^^^^^^^^^^^^^^^ required by this bound in `RunQueryDsl::load`\r\n\r\n```\r\n\r\n(That sounds that some queryfragment impls in diesel are to restrictive for using `selectable` and/or boxed queries with the new `MultiConnection` derive.\r\n\r\n\r\n### Are you seeing any additional errors?\r\n\r\n## Checklist\r\n\r\n- [x] I have already looked over the [issue tracker](https://github.com/diesel-rs/diesel/issues)  and the [disussion forum](https://github.com/diesel-rs/diesel/discussions)  for similar possible closed issues.\r\n<!--\r\nIf you are unsure if your issue is a duplicate of an existing issue please link the issue in question here\r\n--> \r\n- [x] This issue can be reproduced on Rust's stable channel. (Your issue will be\r\n  closed if this is not the case)\r\n- [x] This issue can be reproduced without requiring a third party crate\r\n\r\n<!--\r\nThank you for your submission!  You're helping make Diesel more robust ðŸŽ‰\r\n\r\nWe'll try to respond as quickly as possible.\r\n-->\r\n","closed_by":{"login":"weiznich","id":1674512,"node_id":"MDQ6VXNlcjE2NzQ1MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1674512?v=4","gravatar_id":"","url":"https://api.github.com/users/weiznich","html_url":"https://github.com/weiznich","followers_url":"https://api.github.com/users/weiznich/followers","following_url":"https://api.github.com/users/weiznich/following{/other_user}","gists_url":"https://api.github.com/users/weiznich/gists{/gist_id}","starred_url":"https://api.github.com/users/weiznich/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weiznich/subscriptions","organizations_url":"https://api.github.com/users/weiznich/orgs","repos_url":"https://api.github.com/users/weiznich/repos","events_url":"https://api.github.com/users/weiznich/events{/privacy}","received_events_url":"https://api.github.com/users/weiznich/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/3566/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/diesel-rs/diesel/issues/3566/timeline","performed_via_github_app":null,"state_reason":"completed"}