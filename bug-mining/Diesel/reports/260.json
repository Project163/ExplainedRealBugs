{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/4092","repository_url":"https://api.github.com/repos/diesel-rs/diesel","labels_url":"https://api.github.com/repos/diesel-rs/diesel/issues/4092/labels{/name}","comments_url":"https://api.github.com/repos/diesel-rs/diesel/issues/4092/comments","events_url":"https://api.github.com/repos/diesel-rs/diesel/issues/4092/events","html_url":"https://github.com/diesel-rs/diesel/issues/4092","id":2383637122,"node_id":"I_kwDOAnrqL86OE2qC","number":4092,"title":"Add support for currently unsupported range operators and methods","user":{"login":"weiznich","id":1674512,"node_id":"MDQ6VXNlcjE2NzQ1MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1674512?v=4","gravatar_id":"","url":"https://api.github.com/users/weiznich","html_url":"https://github.com/weiznich","followers_url":"https://api.github.com/users/weiznich/followers","following_url":"https://api.github.com/users/weiznich/following{/other_user}","gists_url":"https://api.github.com/users/weiznich/gists{/gist_id}","starred_url":"https://api.github.com/users/weiznich/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weiznich/subscriptions","organizations_url":"https://api.github.com/users/weiznich/orgs","repos_url":"https://api.github.com/users/weiznich/repos","events_url":"https://api.github.com/users/weiznich/events{/privacy}","received_events_url":"https://api.github.com/users/weiznich/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":254193214,"node_id":"MDU6TGFiZWwyNTQxOTMyMTQ=","url":"https://api.github.com/repos/diesel-rs/diesel/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":null},{"id":254193215,"node_id":"MDU6TGFiZWwyNTQxOTMyMTU=","url":"https://api.github.com/repos/diesel-rs/diesel/labels/help%20wanted","name":"help wanted","color":"159818","default":true,"description":null},{"id":292540851,"node_id":"MDU6TGFiZWwyOTI1NDA4NTE=","url":"https://api.github.com/repos/diesel-rs/diesel/labels/good%20first%20issue","name":"good first issue","color":"d4c5f9","default":true,"description":null},{"id":292827048,"node_id":"MDU6TGFiZWwyOTI4MjcwNDg=","url":"https://api.github.com/repos/diesel-rs/diesel/labels/hole%20in%20api","name":"hole in api","color":"eb6420","default":false,"description":null},{"id":536100334,"node_id":"MDU6TGFiZWw1MzYxMDAzMzQ=","url":"https://api.github.com/repos/diesel-rs/diesel/labels/postgres","name":"postgres","color":"c5def5","default":false,"description":null},{"id":693731039,"node_id":"MDU6TGFiZWw2OTM3MzEwMzk=","url":"https://api.github.com/repos/diesel-rs/diesel/labels/mentoring%20available","name":"mentoring available","color":"0e8a16","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2024-07-01T11:52:21Z","updated_at":"2024-08-16T10:01:29Z","closed_at":"2024-08-16T10:01:29Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Diesel currently supports the postgres range types. We do not provide built-in support for [various operators and methods](https://www.postgresql.org/docs/current/functions-range.html) available for these types. This is a tracking issue for adding support for these operators. \r\n\r\nThe general strategy for adding support for new operators is as following:\r\n\r\n1. Define the operator via [`infix_operator!()`](https://docs.diesel.rs/master/diesel/macro.infix_operator.html). The RangeExtends operator  would be defined as following: `infix_operator!(RangeExtends, \" &> \", backend: Pg);` These operators can be defined [here](https://github.com/diesel-rs/diesel/blob/dd5f41dc93c574077646185393cd064c7103000b/diesel/src/pg/expression/operators.rs). If there is already an existing definition, this step could be skipped.\r\n2. Define a new helper type [here](https://github.com/diesel-rs/diesel/blob/master/diesel/src/pg/expression/helper_types.rs#L30). Helper types are a tool for diesel users to simplify type definitions. Again if there is already a matching type definition this could be skipped. \r\n3. Add a new method to the [`PgRangeExpressionMethods` trait](https://github.com/diesel-rs/diesel/blob/99ef8bbdee614b8eb6560b00c4c1ead88fb0e737/diesel/src/pg/expression/expression_methods.rs#L706-L758). This definition should:\r\n    * Use the previously defined helper type\r\n    * Contain a documentation with an example\r\n4. If possible add a test case for the auto_type attribute [here](https://github.com/diesel-rs/diesel/blob/99ef8bbdee614b8eb6560b00c4c1ead88fb0e737/diesel_derives/tests/auto_type.rs#L277-L288). (If not possible add a documentation entry there)\r\n5. Check if compile test output is up to date by running `TRYBUILD=overwrite cargo test` inside of `diesel_compile_tests`. (This is required if you've added a new operator based on `infix_operator!`\r\n5. Submit a PR with the change\r\n\r\nThe general strategy for adding support for new methods is as following:\r\n\r\n1. Define the operator via [`define_sql_function!()`](https://docs.diesel.rs/master/diesel/expression/functions/macro.define_sql_function.html). The lower method would be defined as following: `define_sql_function!(fn lower<T: RangeHelper>(range: T) -> T::Inner);` These operators can be defined [here](https://github.com/diesel-rs/diesel/blob/99ef8bbdee614b8eb6560b00c4c1ead88fb0e737/diesel/src/pg/expression/functions.rs). If there is already an existing definition, this step could be skipped. This function should have a short documentation snippet with en example\r\n6. Check if compile test output is up to date by running `TRYBUILD=overwrite cargo test` inside of `diesel_compile_tests`. (This is required if you've added a new operator based on `infix_operator!`\r\n5. Submit a PR with the change\r\n\r\n\r\n\r\nOperator list:\r\n\r\n- [x] `anyrange @> anyrange -> bool` (Does the first range contain the second?)\r\n- [x] `anyrange @> anyelement -> boolean` (Does the range contain the element?) * \r\n- [x] `anyrange <@ anyrange -> boolean` (Is the first range contained by the second?)  *\r\n- [x] `anyelement <@ anyrange -> boolean` (Is the element contained in the range?) *\r\n- [x] `anyrange && anyrange -> boolean` (Do the ranges overlap, that is, have any elements in common?) *\r\n- [x] `anyrange << anyrange -> boolean` (Is the first range strictly left of the second?) *\r\n- [x] `anyrange >> anyrange -> boolean` (Is the first range strictly right of the second?) *\r\n- [x] `anyrange &< anyrange -> boolean` (Does the first range not extend to the right of the second?) *\r\n- [x] `anyrange &> anyrange -> boolean` (Does the first range not extend to the left of the second?) *\r\n- [x] `anyrange -|- anyrange -> boolean` (Are the ranges adjacent?) *\r\n- [x] `anyrange + anyrange -> anyrange` (Computes the union of the ranges. The ranges must overlap or be adjacent, so that the union is a single range (but see range_merge()).) **\r\n- [x] `anyrange * anyrange -> anyrange` (Computes the intersection of the ranges.) **\r\n- [x] `anyrange - anyrange -> anyrange` (Computes the difference of the ranges. The second range must not be contained in the first in such a way that the difference would not be a single range.) **\r\n\r\nMethod list:\r\n\r\n- [x] `lower ( anyrange ) -> anyelement` (Extracts the lower bound of the range (NULL if the range is empty or has no lower bound).) *\r\n- [x] `upper ( anyrange ) -> anyelement` (Extracts the upper bound of the range (NULL if the range is empty or has no upper bound).) *\r\n- [x] `isempty ( anyrange ) -> boolean` (Is the range empty?) *\r\n- [x] `lower_inc ( anyrange ) -> boolean` (Is the range's lower bound inclusive?) *\r\n- [x] `upper_inc ( anyrange ) -> boolean` (Is the range's upper bound inclusive?) *\r\n- [x] `lower_inf ( anyrange ) -> boolean` (Does the range have no lower bound? (A lower bound of -Infinity returns false.) *\r\n- [x] `upper_inf ( anyrange ) -> boolean` (Does the range have no upper bound? (An upper bound of Infinity returns false.)) *\r\n- [x] `range_merge ( anyrange, anyrange ) -> anyrange` (Computes the smallest range that includes both of the given ranges.) *\r\n- [x] `int4range(Nullable<Integer>, Nullable<Integer>, RangeBoundEnum) -> int4range` ***\r\n- [x] `int8range(Nullable<BigInteger>, Nullable<BigInteger>, RangeBoundEnum) -> int8range` ***\r\n- [x] `numrange(Nullable<Numeric>, Nullable<Numeric>, RangeBoundEnum) -> numrange` ***\r\n- [x] `tsrange(Nullable<Timestamp>, Nullable<Timestamp>, RangeBoundEnum) -> tsrange` ***\r\n- [x] `tstzrange(Nullable<Timestamptz>, Nullable<Timestamptz>, RangeBoundEnum) -> tstzrange` ***\r\n- [x] `daterange(Nullable<Date>, Nullable<Date>, RangeBoundEnum) -> daterange` ***\r\n\r\n\r\nItems marked with one `*` can follow the instructions directly. For items marked with ** it might be useful to look into how to use the [existing](https://github.com/diesel-rs/diesel/tree/99ef8bbdee614b8eb6560b00c4c1ead88fb0e737/diesel/src/expression/ops) rust side operator implementations as well. For items marked with *** we need to introduce an `enum RangeBoundEnum` type (or similar named) that specifies which bound kinds should be used. That likely requires a custom sql type + implementing the relevant type mapping.\r\n\r\nPlease add a comment to this issue if you plan to work on a specific operator/method.\r\n\r\nIf there is anything unclear about how to add a support for a specific operator/method just ask and we will try to answer your questions.\r\n","closed_by":{"login":"weiznich","id":1674512,"node_id":"MDQ6VXNlcjE2NzQ1MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1674512?v=4","gravatar_id":"","url":"https://api.github.com/users/weiznich","html_url":"https://github.com/weiznich","followers_url":"https://api.github.com/users/weiznich/followers","following_url":"https://api.github.com/users/weiznich/following{/other_user}","gists_url":"https://api.github.com/users/weiznich/gists{/gist_id}","starred_url":"https://api.github.com/users/weiznich/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weiznich/subscriptions","organizations_url":"https://api.github.com/users/weiznich/orgs","repos_url":"https://api.github.com/users/weiznich/repos","events_url":"https://api.github.com/users/weiznich/events{/privacy}","received_events_url":"https://api.github.com/users/weiznich/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/4092/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/diesel-rs/diesel/issues/4092/timeline","performed_via_github_app":null,"state_reason":"completed"}