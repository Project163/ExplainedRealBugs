{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/3673","repository_url":"https://api.github.com/repos/diesel-rs/diesel","labels_url":"https://api.github.com/repos/diesel-rs/diesel/issues/3673/labels{/name}","comments_url":"https://api.github.com/repos/diesel-rs/diesel/issues/3673/comments","events_url":"https://api.github.com/repos/diesel-rs/diesel/issues/3673/events","html_url":"https://github.com/diesel-rs/diesel/issues/3673","id":1782392451,"node_id":"I_kwDOAnrqL85qPSaD","number":3673,"title":"ERROR: `relation \"user\" does not exist` while running `diesel migration/print-schema`","user":{"login":"df51d","id":122315498,"node_id":"U_kgDOB0pi6g","avatar_url":"https://avatars.githubusercontent.com/u/122315498?v=4","gravatar_id":"","url":"https://api.github.com/users/df51d","html_url":"https://github.com/df51d","followers_url":"https://api.github.com/users/df51d/followers","following_url":"https://api.github.com/users/df51d/following{/other_user}","gists_url":"https://api.github.com/users/df51d/gists{/gist_id}","starred_url":"https://api.github.com/users/df51d/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/df51d/subscriptions","organizations_url":"https://api.github.com/users/df51d/orgs","repos_url":"https://api.github.com/users/df51d/repos","events_url":"https://api.github.com/users/df51d/events{/privacy}","received_events_url":"https://api.github.com/users/df51d/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":254193212,"node_id":"MDU6TGFiZWwyNTQxOTMyMTI=","url":"https://api.github.com/repos/diesel-rs/diesel/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":320992021,"node_id":"MDU6TGFiZWwzMjA5OTIwMjE=","url":"https://api.github.com/repos/diesel-rs/diesel/labels/cli","name":"cli","color":"fbca04","default":false,"description":null},{"id":536100334,"node_id":"MDU6TGFiZWw1MzYxMDAzMzQ=","url":"https://api.github.com/repos/diesel-rs/diesel/labels/postgres","name":"postgres","color":"c5def5","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2023-06-30T11:47:43Z","updated_at":"2023-07-19T10:24:36Z","closed_at":"2023-07-06T05:59:14Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\nIf you want to report a bug, we added some points below which help us track down the problem faster.\r\n-->\r\n\r\n## Setup\r\n[My pg dump](https://gist.github.com/df51d/51e5ae9b2bb52ca40014f2235a7e8c55#file-pg_dump-sql)\r\n### Versions\r\n\r\n- **Rust:**\r\ncargo 1.70.0 (ec8a8a0ca 2023-04-25)\r\nrustc 1.70.0 (90c541806 2023-05-31)\r\n- **Diesel:**\r\ndiesel 2.1.0\r\n- **Database:**\r\npostgresql 15.3-1.pgdg120+1\r\n- **Operating System**\r\nArcoLinux kernel 6.3.8-arch1-1\r\n### Feature Flags\r\n```\r\ncargo install diesel_cli --no-\r\ndefault-features --features \"postgres sqlite\"\r\n```\r\n## Problem Description\r\nI encountered an error while running `diesel print-schema`/`diesel migration run` on my old database after installing the diesel-cli. I was attempting to switch from a TypeScript project that utilized Prisma as the database driver to a Rust project with Diesel as the database driver. Since starting from scratch and recreating everything would be a significant amount of work, my intention was to reuse my existing database. However, I faced difficulties during the process. \r\n### What are you trying to accomplish?\r\n```diesel print-schema```\r\n### What is the actual output?\r\n```relation \"user\" does not exist```\r\n### Steps to reproduce\r\n#### with prisma installed\r\n```bash\r\ndocker pull postgres\r\n\r\ndocker run -e POSTGRES_PASSWORD=postgres -p 5432:5432 -d postgres\r\n\r\necho 'DATABASE_URL=\"postgresql://postgres:postgres@localhost:5432/db\"' > .env\r\n\r\nprisma init\r\n\r\necho 'model User {\\n\\tid Int @id @default(autoincrement())\\n}' >> prisma/schema.prisma\r\n\r\nprisma db push\r\n\r\ndiesel print-schema\r\n```\r\n#### without prisma installed\r\n```bash\r\ndocker pull postgres\r\n\r\ndocker run -e POSTGRES_PASSWORD=postgres -p 5432:5432 -d postgres\r\n\r\necho 'DATABASE_URL=\"postgresql://postgres:postgres@localhost:5432/db\"' > .env\r\n\r\ndiesel setup\r\n\r\nmkdir migrations/user\r\n\r\necho \"CREATE TABLE public.\\\"User\\\" (\r\n    id integer NOT NULL\r\n);\r\nALTER TABLE public.\\\"User\\\" OWNER TO postgres;\r\nCREATE SEQUENCE public.\\\"User_id_seq\\\"\r\n    AS integer\r\n    START WITH 1\r\n    INCREMENT BY 1\r\n    NO MINVALUE\r\n    NO MAXVALUE\r\n    CACHE 1;\r\nALTER TABLE public.\\\"User_id_seq\\\" OWNER TO postgres;\r\nALTER SEQUENCE public.\\\"User_id_seq\\\" OWNED BY public.\\\"User\\\".id;\r\nALTER TABLE ONLY public.\\\"User\\\" ALTER COLUMN id SET DEFAULT nextval('public.\\\"User_id_seq\\\"'::regclass);\r\nSELECT pg_catalog.setval('public.\\\"User_id_seq\\\"', 1, false);\r\nALTER TABLE ONLY public.\\\"User\\\"\r\n    ADD CONSTRAINT \\\"User_pkey\\\" PRIMARY KEY (id);\" > migrations/user/up.sql\r\n    \r\ndiesel migration run\r\n```\r\n### Temporary fix:\r\nMaking all tables lowercase seems to fix the problem:\r\n#### working migration\r\n```sql\r\n--- this works just fine /migrations/user/up.sql\r\nCREATE TABLE public.\"user\" (\r\n    id integer NOT NULL\r\n);\r\nALTER TABLE public.\"user\" OWNER TO postgres;\r\nCREATE SEQUENCE public.\"user_id_seq\"\r\n    AS integer\r\n    START WITH 1\r\n    INCREMENT BY 1\r\n    NO MINVALUE\r\n    NO MAXVALUE\r\n    CACHE 1;\r\nALTER TABLE public.\"user_id_seq\" OWNER TO postgres;\r\nALTER SEQUENCE public.\"user_id_seq\" OWNED BY public.\"user\".id;\r\nALTER TABLE ONLY public.\"user\" ALTER COLUMN id SET DEFAULT nextval('public.\"user_id_seq\"'::regclass);\r\nSELECT pg_catalog.setval('public.\"user_id_seq\"', 1, false);\r\nALTER TABLE ONLY public.\"user\"\r\n    ADD CONSTRAINT \"user_pkey\" PRIMARY KEY (id);\r\n```\r\n#### working prisma \r\n```prisma\r\nmodel user {\r\n  id Int @id @default(autoincrement())\r\n}\r\n```\r\n## Checklist\r\n- [x] I have already looked over the [issue tracker](https://github.com/diesel-rs/diesel/issues) and the [discussion forum](https://github.com/diesel-rs/diesel/discussions) for similar possible closed issues.\r\n<!--\r\nIf you are unsure if your issue is a duplicate of an existing issue please link the issue in question here\r\n--> \r\n- [x] This issue can be reproduced on Rust's stable channel. (Your issue will be\r\n  closed if this is not the case)\r\n- [x] This issue can be reproduced without requiring a third party crate","closed_by":{"login":"weiznich","id":1674512,"node_id":"MDQ6VXNlcjE2NzQ1MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1674512?v=4","gravatar_id":"","url":"https://api.github.com/users/weiznich","html_url":"https://github.com/weiznich","followers_url":"https://api.github.com/users/weiznich/followers","following_url":"https://api.github.com/users/weiznich/following{/other_user}","gists_url":"https://api.github.com/users/weiznich/gists{/gist_id}","starred_url":"https://api.github.com/users/weiznich/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weiznich/subscriptions","organizations_url":"https://api.github.com/users/weiznich/orgs","repos_url":"https://api.github.com/users/weiznich/repos","events_url":"https://api.github.com/users/weiznich/events{/privacy}","received_events_url":"https://api.github.com/users/weiznich/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/3673/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/diesel-rs/diesel/issues/3673/timeline","performed_via_github_app":null,"state_reason":"completed"}