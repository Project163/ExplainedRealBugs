{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/2202","repository_url":"https://api.github.com/repos/diesel-rs/diesel","labels_url":"https://api.github.com/repos/diesel-rs/diesel/issues/2202/labels{/name}","comments_url":"https://api.github.com/repos/diesel-rs/diesel/issues/2202/comments","events_url":"https://api.github.com/repos/diesel-rs/diesel/issues/2202/events","html_url":"https://github.com/diesel-rs/diesel/issues/2202","id":509431669,"node_id":"MDU6SXNzdWU1MDk0MzE2Njk=","number":2202,"title":"Generated schema depends on platform","user":{"login":"Ten0","id":9094255,"node_id":"MDQ6VXNlcjkwOTQyNTU=","avatar_url":"https://avatars.githubusercontent.com/u/9094255?v=4","gravatar_id":"","url":"https://api.github.com/users/Ten0","html_url":"https://github.com/Ten0","followers_url":"https://api.github.com/users/Ten0/followers","following_url":"https://api.github.com/users/Ten0/following{/other_user}","gists_url":"https://api.github.com/users/Ten0/gists{/gist_id}","starred_url":"https://api.github.com/users/Ten0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Ten0/subscriptions","organizations_url":"https://api.github.com/users/Ten0/orgs","repos_url":"https://api.github.com/users/Ten0/repos","events_url":"https://api.github.com/users/Ten0/events{/privacy}","received_events_url":"https://api.github.com/users/Ten0/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2019-10-19T10:39:19Z","updated_at":"2021-09-28T18:24:20Z","closed_at":"2019-11-25T11:12:06Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Setup\r\n\r\n### Versions\r\n\r\n- **Rust:** Latest stable\r\n- **Diesel:** CLI from cargo\r\n- **Database:** Postgres\r\n- **Operating System:** Linux/MacOS (schema differs depending which one we're on)\r\n\r\n## Problem Description\r\n\r\n### What are you trying to accomplish?\r\nReliably generate a `schema.rs` on whichever platform based on a set of migrations.\r\nWe are then patching the schema using `diff -u`/`patch`. The order being different breaks the patch, as well as deploy-time checks that ensure the git-tracked file is consistent with the database schema.\r\n\r\n### What is the expected output?\r\nOn both platforms, `schema.rs` lines are ordered the same way.\r\n\r\n### What is the actual output?\r\nThe tables are not ordered in the same way.\r\nOn Linux:\r\n- d_c_e\r\n- d_cs\r\n- ds\r\n- d_s_c\r\n\r\nOn Mac:\r\n- d_c_e\r\n- d_cs\r\n- d_s_c\r\n- ds\r\n\r\n(Can be noted that the Mac ordering is more consistent. Looks like the Linux sort gets rid of the underscores before sorting.)\r\n\r\n### Any clue on how to solve?\r\n\r\nI suspect there are no `sort`s on the rust side when generating the schema, and this inconsistency may come more from the postgres side than from the rust side.\r\n(Everytime schema generation was run on Mac so far, the database was also there. I may soon check for what happens when generating on MacOS a schema for a database that lives on a Linux postgres.)\r\n\r\nIt is possible that the fix is as simple as applying a sort on the rust side.\r\nTo limit breakage, the sort applied could be the same as is applied on the Linux version.","closed_by":{"login":"weiznich","id":1674512,"node_id":"MDQ6VXNlcjE2NzQ1MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1674512?v=4","gravatar_id":"","url":"https://api.github.com/users/weiznich","html_url":"https://github.com/weiznich","followers_url":"https://api.github.com/users/weiznich/followers","following_url":"https://api.github.com/users/weiznich/following{/other_user}","gists_url":"https://api.github.com/users/weiznich/gists{/gist_id}","starred_url":"https://api.github.com/users/weiznich/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weiznich/subscriptions","organizations_url":"https://api.github.com/users/weiznich/orgs","repos_url":"https://api.github.com/users/weiznich/repos","events_url":"https://api.github.com/users/weiznich/events{/privacy}","received_events_url":"https://api.github.com/users/weiznich/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/2202/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/diesel-rs/diesel/issues/2202/timeline","performed_via_github_app":null,"state_reason":"completed"}