{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/2385","repository_url":"https://api.github.com/repos/diesel-rs/diesel","labels_url":"https://api.github.com/repos/diesel-rs/diesel/issues/2385/labels{/name}","comments_url":"https://api.github.com/repos/diesel-rs/diesel/issues/2385/comments","events_url":"https://api.github.com/repos/diesel-rs/diesel/issues/2385/events","html_url":"https://github.com/diesel-rs/diesel/issues/2385","id":613623160,"node_id":"MDU6SXNzdWU2MTM2MjMxNjA=","number":2385,"title":"Inserting BigDecimal with scale into Postgres is broken","user":{"login":"leoyvens","id":9885558,"node_id":"MDQ6VXNlcjk4ODU1NTg=","avatar_url":"https://avatars.githubusercontent.com/u/9885558?v=4","gravatar_id":"","url":"https://api.github.com/users/leoyvens","html_url":"https://github.com/leoyvens","followers_url":"https://api.github.com/users/leoyvens/followers","following_url":"https://api.github.com/users/leoyvens/following{/other_user}","gists_url":"https://api.github.com/users/leoyvens/gists{/gist_id}","starred_url":"https://api.github.com/users/leoyvens/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leoyvens/subscriptions","organizations_url":"https://api.github.com/users/leoyvens/orgs","repos_url":"https://api.github.com/users/leoyvens/repos","events_url":"https://api.github.com/users/leoyvens/events{/privacy}","received_events_url":"https://api.github.com/users/leoyvens/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":254193215,"node_id":"MDU6TGFiZWwyNTQxOTMyMTU=","url":"https://api.github.com/repos/diesel-rs/diesel/labels/help%20wanted","name":"help wanted","color":"159818","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-05-06T21:25:27Z","updated_at":"2020-10-05T12:02:06Z","closed_at":"2020-10-05T12:02:06Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\nIf you want to report a bug, we added some points below you can fill out. If you want to request a feature, feel free to remove all the irrelevant text. In addition to this [issue tracker](https://github.com/diesel-rs/diesel/issues), you can also talk to Diesel maintainers and users on [Gitter](https://gitter.im/diesel-rs/diesel).\r\n-->\r\n\r\n## Setup\r\n\r\n### Versions\r\n\r\n- **Rust:**\r\n1.43\r\n\r\n- **Diesel:**\r\ncurrent master, commit 968e7f79c\r\n\r\n- **Database:**\r\nPostgres\r\n\r\n- **Operating System**\r\nLinux\r\n\r\n### Feature Flags\r\n\r\n- **diesel:**\r\npostgres, numeric\r\n\r\n## Problem Description\r\nFirst, thanks for continuing to maintain Diesel.\r\n\r\nInserting a BigDecimal as a numeric in Postgres is and probably has always been broken for any number with power of ten > 0 (or scale < 0 in BigDecimal terms). Looking at the current code https://github.com/diesel-rs/diesel/blob/master/diesel/src/pg/types/numeric.rs#L90, it's full of unchecked casts and arithmetic which are vulnerable to silent overflows.\r\n\r\nGiven this, I'd recommend to anyone inserting BigDecimals into Postgres that you avoid using the Diesel support and instead cast text values to numeric.\r\n\r\n### What are you trying to accomplish?\r\nInsert a BigDecimal with a scale.\r\n\r\n### What is the expected output?\r\nIt works.\r\n\r\n### What is the actual output?\r\n```\r\nthread 'main' panicked at 'called `Result::unwrap()` on an `Err` value:\r\nDatabaseError(__Unknown, \"invalid scale in external \\\"numeric\\\" value\")', src/main.rs:31:5\r\n```\r\n\r\n### Are you seeing any additional errors?\r\nNo.\r\n\r\n### Steps to reproduce\r\nRun this https://github.com/leoyvens/diesel-numeric-bug.\r\n\r\n## Checklist\r\n\r\n- [x] I have already looked over the [issue tracker](https://github.com/diesel-rs/diesel/issues) for similar issues.\r\n- [x] This issue can be reproduced on Rust's stable channel. (Your issue will be\r\n  closed if this is not the case)","closed_by":{"login":"weiznich","id":1674512,"node_id":"MDQ6VXNlcjE2NzQ1MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1674512?v=4","gravatar_id":"","url":"https://api.github.com/users/weiznich","html_url":"https://github.com/weiznich","followers_url":"https://api.github.com/users/weiznich/followers","following_url":"https://api.github.com/users/weiznich/following{/other_user}","gists_url":"https://api.github.com/users/weiznich/gists{/gist_id}","starred_url":"https://api.github.com/users/weiznich/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weiznich/subscriptions","organizations_url":"https://api.github.com/users/weiznich/orgs","repos_url":"https://api.github.com/users/weiznich/repos","events_url":"https://api.github.com/users/weiznich/events{/privacy}","received_events_url":"https://api.github.com/users/weiznich/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/2385/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/diesel-rs/diesel/issues/2385/timeline","performed_via_github_app":null,"state_reason":"completed"}