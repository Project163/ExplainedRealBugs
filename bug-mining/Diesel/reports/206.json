{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/2623","repository_url":"https://api.github.com/repos/diesel-rs/diesel","labels_url":"https://api.github.com/repos/diesel-rs/diesel/issues/2623/labels{/name}","comments_url":"https://api.github.com/repos/diesel-rs/diesel/issues/2623/comments","events_url":"https://api.github.com/repos/diesel-rs/diesel/issues/2623/events","html_url":"https://github.com/diesel-rs/diesel/issues/2623","id":788770440,"node_id":"MDU6SXNzdWU3ODg3NzA0NDA=","number":2623,"title":"SQL UNIQUE with multiple foreign keys","user":{"login":"cemoktra","id":15634263,"node_id":"MDQ6VXNlcjE1NjM0MjYz","avatar_url":"https://avatars.githubusercontent.com/u/15634263?v=4","gravatar_id":"","url":"https://api.github.com/users/cemoktra","html_url":"https://github.com/cemoktra","followers_url":"https://api.github.com/users/cemoktra/followers","following_url":"https://api.github.com/users/cemoktra/following{/other_user}","gists_url":"https://api.github.com/users/cemoktra/gists{/gist_id}","starred_url":"https://api.github.com/users/cemoktra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cemoktra/subscriptions","organizations_url":"https://api.github.com/users/cemoktra/orgs","repos_url":"https://api.github.com/users/cemoktra/repos","events_url":"https://api.github.com/users/cemoktra/events{/privacy}","received_events_url":"https://api.github.com/users/cemoktra/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2021-01-19T07:12:41Z","updated_at":"2021-01-19T19:18:53Z","closed_at":"2021-01-19T19:18:53Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\nIf you want to report a bug, we added some points below you can fill out. If you want to request a feature, feel free to remove all the irrelevant text. In addition to this [issue tracker](https://github.com/diesel-rs/diesel/issues), you can also talk to Diesel maintainers and users on [Gitter](https://gitter.im/diesel-rs/diesel).\r\n-->\r\n\r\n## Setup\r\n\r\n### Versions\r\n\r\n- **Rust:** 1.49.0\r\n- **Diesel:** 1.4.2\r\n- **Database:** MariaDB\r\n- **Operating System** Linux / Ubuntu\r\n\r\n### Feature Flags\r\n\r\n- **diesel:** mysql\r\n\r\n## Problem Description\r\n\r\n\r\n### What are you trying to accomplish?\r\nI'm trying to create a schema for an existing database.\r\n\r\n### What is the expected output?\r\nA working schema.rs\r\n\r\n### What is the actual output?\r\n`Unexpected null for non-null column`\r\n\r\n### Are you seeing any additional errors?\r\nNo\r\n\r\n### Steps to reproduce\r\n\r\nPut the following in an up.sql and do a migration:\r\n```\r\nCREATE TABLE tab_key1(\r\n    id bigint NOT NULL auto_increment,\r\n    PRIMARY KEY (id)\r\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\r\n\r\nCREATE TABLE tab_key2(\r\n    id bigint NOT NULL auto_increment,\r\n    PRIMARY KEY (id)\r\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\r\n\r\nCREATE TABLE tab_key3(\r\n    id bigint NOT NULL auto_increment,\r\n    PRIMARY KEY (id)\r\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\r\n\r\nCREATE TABLE tab_key4(\r\n    id bigint NOT NULL auto_increment,\r\n    PRIMARY KEY (id)\r\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\r\n\r\nCREATE TABLE tab_problem (\r\n  id bigint NOT NULL auto_increment,\r\n  key1 bigint NOT NULL,\r\n  key2 bigint NOT NULL,\r\n  key3 bigint NULL,\r\n  some_value varchar(25) NULL,\r\n  key4 bigint NULL,\r\n\r\n  PRIMARY KEY (id),\r\n  UNIQUE (key1, key2),\r\n  CONSTRAINT `key1` FOREIGN KEY (key1) REFERENCES tab_key1(id),\r\n  CONSTRAINT `key2` FOREIGN KEY (key2) REFERENCES tab_key2(id),\r\n  CONSTRAINT `key3` FOREIGN KEY (key3) REFERENCES tab_key3(id),\r\n  CONSTRAINT `key4` FOREIGN KEY (key4) REFERENCES tab_key4(id)\r\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\r\n\r\n```\r\n\r\n<!--\r\nPlease include as much of your codebase as needed to reproduce the error.  If the relevant files are large, please consider linking to a public repository or a [Gist](https://gist.github.com/).\r\n\r\nPlease post as much of your database schema as necessary. If you are using `infer_schema!`, you can use `diesel print-schema` and post the relevant parts from that.\r\n-->\r\n\r\nI tried to create a minimal example to reproduce this for multiple hours now, but the minimal example always works as expected. The root of the problem is the usage of the 'UNIQUE' keyword with two or more foreign keys.\r\n\r\n## Checklist\r\n\r\n- [X] I have already looked over the [issue tracker](https://github.com/diesel-rs/diesel/issues) for similar issues.\r\n- [X] This issue can be reproduced on Rust's stable channel. (Your issue will be\r\n  closed if this is not the case)\r\n\r\n<!--\r\nThank you for your submission!  You're helping make Diesel more robust ðŸŽ‰\r\n\r\nWe'll try to respond as quickly as possible.\r\n-->\r\n","closed_by":{"login":"weiznich","id":1674512,"node_id":"MDQ6VXNlcjE2NzQ1MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1674512?v=4","gravatar_id":"","url":"https://api.github.com/users/weiznich","html_url":"https://github.com/weiznich","followers_url":"https://api.github.com/users/weiznich/followers","following_url":"https://api.github.com/users/weiznich/following{/other_user}","gists_url":"https://api.github.com/users/weiznich/gists{/gist_id}","starred_url":"https://api.github.com/users/weiznich/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weiznich/subscriptions","organizations_url":"https://api.github.com/users/weiznich/orgs","repos_url":"https://api.github.com/users/weiznich/repos","events_url":"https://api.github.com/users/weiznich/events{/privacy}","received_events_url":"https://api.github.com/users/weiznich/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/2623/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/diesel-rs/diesel/issues/2623/timeline","performed_via_github_app":null,"state_reason":"completed"}