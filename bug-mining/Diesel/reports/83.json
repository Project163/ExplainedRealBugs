{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/704","repository_url":"https://api.github.com/repos/diesel-rs/diesel","labels_url":"https://api.github.com/repos/diesel-rs/diesel/issues/704/labels{/name}","comments_url":"https://api.github.com/repos/diesel-rs/diesel/issues/704/comments","events_url":"https://api.github.com/repos/diesel-rs/diesel/issues/704/events","html_url":"https://github.com/diesel-rs/diesel/issues/704","id":207558640,"node_id":"MDU6SXNzdWUyMDc1NTg2NDA=","number":704,"title":"inferring PK from existing schema","user":{"login":"dvdplm","id":18515,"node_id":"MDQ6VXNlcjE4NTE1","avatar_url":"https://avatars.githubusercontent.com/u/18515?v=4","gravatar_id":"","url":"https://api.github.com/users/dvdplm","html_url":"https://github.com/dvdplm","followers_url":"https://api.github.com/users/dvdplm/followers","following_url":"https://api.github.com/users/dvdplm/following{/other_user}","gists_url":"https://api.github.com/users/dvdplm/gists{/gist_id}","starred_url":"https://api.github.com/users/dvdplm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dvdplm/subscriptions","organizations_url":"https://api.github.com/users/dvdplm/orgs","repos_url":"https://api.github.com/users/dvdplm/repos","events_url":"https://api.github.com/users/dvdplm/events{/privacy}","received_events_url":"https://api.github.com/users/dvdplm/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2017-02-14T16:05:14Z","updated_at":"2017-02-15T12:12:57Z","closed_at":"2017-02-15T12:12:57Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Using the table definition below and the `infer_table_from_schema!` macro I'm getting an odd error: `error: proc-macro derive panicked`.\r\n\r\n```sql\r\nCREATE TABLE stuffs (\r\n    id bigint NOT NULL,\r\n    uuid character varying(255),\r\n    account_id bigint\r\n   );\r\nCREATE SEQUENCE stuffs_id_seq1\r\n    START WITH 1\r\n    INCREMENT BY 1\r\n    NO MINVALUE\r\n    NO MAXVALUE\r\n    CACHE 1;\r\n    \r\nALTER SEQUENCE stuffs_id_seq1 OWNED BY stuffs.id;\r\nALTER TABLE ONLY stuffs ALTER COLUMN id SET DEFAULT nextval('stuffs_id_seq1'::regclass);\r\nALTER TABLE ONLY stuffs\r\n    ADD CONSTRAINT stuffs_pkey1 PRIMARY KEY (id);\r\nCREATE INDEX stuffs_account_id_idx ON stuffs USING btree (account_id);\r\n```\r\n\r\nThe above SQL is an extract from the dump that `pg_dump` produces so it's perhaps not the way a human would have written it but results in a perfectly valid table. This SQL adds rows and increments the PK:\r\n\r\n```sql\r\nINSERT INTO stuffs (\"uuid\", \"account_id\") VALUES('abc123', 999);\r\nINSERT INTO stuffs (\"uuid\", \"account_id\") VALUES('def456', 888);\r\n```\r\n\r\nRust version: \r\n```\r\n$ rustc -V\r\nrustc 1.17.0-nightly (956e2bcba 2017-02-12)\r\n```\r\n\r\nCargo.toml:\r\n```\r\n[package]\r\nname = \"diesel_demo\"\r\nversion = \"0.1.0\"\r\nauthors = [\"David Palm <dvdplm@gmail.com>\"]\r\n\r\n[dependencies]\r\ndiesel = { version = \"0.10.1\", features = [\"postgres\"] }\r\ndiesel_codegen = { version = \"0.10.1\", features = [\"postgres\"] }\r\ndotenv = \"0.8.0\"\r\n\r\n[replace]\r\n\"diesel:0.10.1\" = { git = \" https://github.com/diesel-rs/diesel.git\" }\r\n\"diesel_codegen:0.10.1\" = { git = \" https://github.com/diesel-rs/diesel.git\" }\r\n\"diesel_infer_schema:0.10.1\" = { git = \" https://github.com/diesel-rs/diesel.git\" }\r\n```\r\n\r\nThe code that runs is essentially the \"getting_started_step_1\" without any migrations generated as I'm trying to see how Diesel and Rust performs on my existing schema.\r\n\r\nFull error output:\r\n```\r\nerror: proc-macro derive panicked\r\n --> src/schema.rs:2:1\r\n  |\r\n2 | infer_table_from_schema!(\"dotenv:DATABASE_URL\", \"stuffs\");\r\n  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  |\r\n  = help: message: Could not infer table stuffs: StringError(\"Diesel only supports tables with primary keys. Table stuffs has no primary key\")\r\n  = note: this error originates in a macro outside of the current crate\r\n\r\nerror: Could not compile `diesel_demo`.\r\n\r\nCaused by:\r\n  process didn't exit successfully: `rustc --crate-name diesel_demo src/lib.rs --crate-type lib --emit=dep-info,link -C debuginfo=2 -C metadata=4534e1ff4f2f0cef -C extra-filename=-4534e1ff4f2f0cef --out-dir /Users/dvd/dev/rust/diesel_demo/target/debug/deps -L dependency=/Users/dvd/dev/rust/diesel_demo/target/debug/deps --extern diesel=/Users/dvd/dev/rust/diesel_demo/target/debug/deps/libdiesel-647af581b82e4074.rlib --extern diesel_codegen=/Users/dvd/dev/rust/diesel_demo/target/debug/deps/libdiesel_codegen-2fc13b4e395fcd1e.dylib --extern dotenv=/Users/dvd/dev/rust/diesel_demo/target/debug/deps/libdotenv-75d8ce5725f9d0e8.rlib -L native=/usr/local/Cellar/postgresql/9.6beta2/lib` (exit code: 101)\r\n```","closed_by":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/704/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/diesel-rs/diesel/issues/704/timeline","performed_via_github_app":null,"state_reason":"completed"}