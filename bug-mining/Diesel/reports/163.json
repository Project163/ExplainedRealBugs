{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/1745","repository_url":"https://api.github.com/repos/diesel-rs/diesel","labels_url":"https://api.github.com/repos/diesel-rs/diesel/issues/1745/labels{/name}","comments_url":"https://api.github.com/repos/diesel-rs/diesel/issues/1745/comments","events_url":"https://api.github.com/repos/diesel-rs/diesel/issues/1745/events","html_url":"https://github.com/diesel-rs/diesel/issues/1745","id":328382104,"node_id":"MDU6SXNzdWUzMjgzODIxMDQ=","number":1745,"title":"MySQL u32 overflow at i32::max_value()","user":{"login":"bpbp-boop","id":322387,"node_id":"MDQ6VXNlcjMyMjM4Nw==","avatar_url":"https://avatars.githubusercontent.com/u/322387?v=4","gravatar_id":"","url":"https://api.github.com/users/bpbp-boop","html_url":"https://github.com/bpbp-boop","followers_url":"https://api.github.com/users/bpbp-boop/followers","following_url":"https://api.github.com/users/bpbp-boop/following{/other_user}","gists_url":"https://api.github.com/users/bpbp-boop/gists{/gist_id}","starred_url":"https://api.github.com/users/bpbp-boop/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bpbp-boop/subscriptions","organizations_url":"https://api.github.com/users/bpbp-boop/orgs","repos_url":"https://api.github.com/users/bpbp-boop/repos","events_url":"https://api.github.com/users/bpbp-boop/events{/privacy}","received_events_url":"https://api.github.com/users/bpbp-boop/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2018-06-01T04:56:21Z","updated_at":"2018-06-14T21:18:00Z","closed_at":"2018-06-13T22:49:53Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Setup\r\n\r\n### Versions\r\n\r\n- **Rust:** rustc 1.26.1 (827013a31 2018-05-25)\r\n- **Diesel:** 1.3.0\r\n- **Database:** MySQL 8\r\n- **Operating System** CentOS\r\n\r\n### Feature Flags\r\n\r\n- **diesel:** diesel = { version = \"1.0.0\", features = [\"mysql\", \"chrono\"] }\r\n\r\n\r\n## Problem Description\r\nTrying to insert a u32 above i32::max_value causes an overflow and database error on MySQL\r\n\r\n### Steps to reproduce (reduced testcase)\r\n\r\n```rust\r\n#[macro_use]\r\nextern crate diesel;\r\nextern crate dotenv;\r\n\r\nuse diesel::prelude::*;\r\nuse diesel::insert_into;\r\nuse dotenv::dotenv;\r\nuse std::env;\r\n\r\ntable! {\r\n    DATA (id) {\r\n        id -> Integer,\r\n        record_id -> Unsigned<Integer>,\r\n        session_id -> Unsigned<Integer>,\r\n    }\r\n}\r\n\r\n#[derive(Debug, Insertable)]\r\n#[table_name = \"DATA\"]\r\npub struct Data {\r\n    pub record_id: u32,\r\n    pub session_id: u32,\r\n}\r\n\r\nfn main() {\r\n    use DATA::dsl::*;\r\n\r\n    dotenv().ok();\r\n    let database_url = env::var(\"DATABASE_URL\").expect(\"DATABASE_URL must be set\");\r\n    let connection = MysqlConnection::establish(&database_url)\r\n        .expect(&format!(\"Error connecting to {}\", database_url));\r\n\r\n    let i32_max = i32::max_value() as u32;\r\n    let data_ok = Data {\r\n        record_id: 1,\r\n        session_id: i32_max\r\n    };\r\n\r\n    insert_into(DATA).values(&data_ok).execute(&connection).unwrap();\r\n\r\n    let data_error = Data {\r\n        record_id: 1,\r\n        session_id: i32_max + 1\r\n    };\r\n\r\n    insert_into(DATA).values(&data_error).execute(&connection).unwrap();\r\n}\r\n```\r\n\r\n### Output\r\n```\r\n    Finished dev [unoptimized + debuginfo] target(s) in 10.45 secs\r\n     Running `target/debug/overflow`\r\n\r\nthread 'main' panicked at 'called `Result::unwrap()` on an `Err` value: DatabaseError(__Unknown, \"Out of range value for column \\'session_id\\' at row 1\")', libcore/result.rs:945:5\r\nstack backtrace:\r\n   0: std::sys::unix::backtrace::tracing::imp::unwind_backtrace\r\n             at libstd/sys/unix/backtrace/tracing/gcc_s.rs:49\r\n   1: std::sys_common::backtrace::print\r\n             at libstd/sys_common/backtrace.rs:71\r\n             at libstd/sys_common/backtrace.rs:59\r\n   2: std::panicking::default_hook::{{closure}}\r\n             at libstd/panicking.rs:207\r\n   3: std::panicking::default_hook\r\n             at libstd/panicking.rs:223\r\n   4: std::panicking::rust_panic_with_hook\r\n             at libstd/panicking.rs:402\r\n   5: std::panicking::begin_panic_fmt\r\n             at libstd/panicking.rs:349\r\n   6: rust_begin_unwind\r\n             at libstd/panicking.rs:325\r\n   7: core::panicking::panic_fmt\r\n             at libcore/panicking.rs:72\r\n   8: core::result::unwrap_failed\r\n             at /checkout/src/libcore/macros.rs:26\r\n   9: <core::result::Result<T, E>>::unwrap\r\n             at /checkout/src/libcore/result.rs:782\r\n  10: overflow::main\r\n             at src/main.rs:46\r\n  11: std::rt::lang_start::{{closure}}\r\n             at /checkout/src/libstd/rt.rs:74\r\n  12: std::panicking::try::do_call\r\n             at libstd/rt.rs:59\r\n             at libstd/panicking.rs:306\r\n  13: __rust_maybe_catch_panic\r\n             at libpanic_unwind/lib.rs:102\r\n  14: std::rt::lang_start_internal\r\n             at libstd/panicking.rs:285\r\n             at libstd/panic.rs:361\r\n             at libstd/rt.rs:58\r\n  15: std::rt::lang_start\r\n             at /checkout/src/libstd/rt.rs:74\r\n  16: main\r\n  17: __libc_start_main\r\n  18: <unknown>\r\n\r\n\r\n```\r\nActual SQL executed via the general log\r\n```\r\n2018-06-01T04:52:07.152401Z        74 Query     SET sql_mode=(SELECT CONCAT(@@sql_mode, ',PIPES_AS_CONCAT'))\r\n2018-06-01T04:52:07.152678Z        74 Query     SET time_zone = '+00:00'\r\n2018-06-01T04:52:07.152931Z        74 Query     SET character_set_client = 'utf8mb4'\r\n2018-06-01T04:52:07.153124Z        74 Query     SET character_set_connection = 'utf8mb4'\r\n2018-06-01T04:52:07.153405Z        74 Query     SET character_set_results = 'utf8mb4'\r\n2018-06-01T04:52:07.154014Z        74 Prepare   INSERT INTO `DATA` (`record_id`, `session_id`) VALUES (?, ?)\r\n2018-06-01T04:52:07.154222Z        74 Execute   INSERT INTO `DATA` (`record_id`, `session_id`) VALUES (1, 2147483647)\r\n2018-06-01T04:52:07.323184Z        74 Close stmt\r\n2018-06-01T04:52:07.323492Z        74 Prepare   INSERT INTO `DATA` (`record_id`, `session_id`) VALUES (?, ?)\r\n2018-06-01T04:52:07.323738Z        74 Execute   INSERT INTO `DATA` (`record_id`, `session_id`) VALUES (1, -2147483648)\r\n2018-06-01T04:52:07.324176Z        74 Close stmt\r\n2018-06-01T04:52:07.324698Z        74 Quit\r\n```\r\n## Checklist\r\n\r\n- [x] I have already looked over the [issue tracker](https://github.com/diesel-rs/diesel/issues) for similar issues.\r\n- [x] This issue can be reproduced on Rust's stable channel. (Your issue will be\r\n  closed if this is not the case)\r\n","closed_by":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/1745/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/diesel-rs/diesel/issues/1745/timeline","performed_via_github_app":null,"state_reason":"completed"}