[{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/comments/376684659","html_url":"https://github.com/diesel-rs/diesel/issues/1604#issuecomment-376684659","issue_url":"https://api.github.com/repos/diesel-rs/diesel/issues/1604","id":376684659,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NjY4NDY1OQ==","user":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-03-27T21:39:14Z","updated_at":"2018-03-27T21:39:14Z","body":"Docs should just look like normal rustdocs, not an additional argument in this case. I did spend some time looking at making this work with macros 1.1, and I'm actually not 100% sure that it's possible today, since we'd need to wrap the whole thing in a module, the only name we have for that module is the name of the function, and you can't have a type and module with the same name. We could potentially *also* change the API if you use the new syntax, but I'm not sure how I feel about that.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/comments/376684659/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/comments/377444651","html_url":"https://github.com/diesel-rs/diesel/issues/1604#issuecomment-377444651","issue_url":"https://api.github.com/repos/diesel-rs/diesel/issues/1604","id":377444651,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NzQ0NDY1MQ==","user":{"login":"moore3071","id":8052748,"node_id":"MDQ6VXNlcjgwNTI3NDg=","avatar_url":"https://avatars.githubusercontent.com/u/8052748?v=4","gravatar_id":"","url":"https://api.github.com/users/moore3071","html_url":"https://github.com/moore3071","followers_url":"https://api.github.com/users/moore3071/followers","following_url":"https://api.github.com/users/moore3071/following{/other_user}","gists_url":"https://api.github.com/users/moore3071/gists{/gist_id}","starred_url":"https://api.github.com/users/moore3071/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/moore3071/subscriptions","organizations_url":"https://api.github.com/users/moore3071/orgs","repos_url":"https://api.github.com/users/moore3071/repos","events_url":"https://api.github.com/users/moore3071/events{/privacy}","received_events_url":"https://api.github.com/users/moore3071/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-03-30T04:52:08Z","updated_at":"2018-03-30T04:52:16Z","body":"If you mean having the docs above the macro call, I don't think that's possible at the moment. Nor would having them inside the arguments list now that I think of it. You could possibly hijack another unused token instead of `///` or `//!`. Say:\r\n```rust\r\nsql_function!(\r\n    @This is documentation for the\r\n    @sql function foo\r\n    fn foo(x: Integer, length: Integer) -> Text)\r\n);\r\n```\r\nThis would probably pose other problems though.\r\n\r\n> We could potentially also change the API if you use the new syntax, but I'm not sure how I feel about that.\r\n\r\nI'd love to hear a little more elaboration on this","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/comments/377444651/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"moore3071","id":8052748,"node_id":"MDQ6VXNlcjgwNTI3NDg=","avatar_url":"https://avatars.githubusercontent.com/u/8052748?v=4","gravatar_id":"","url":"https://api.github.com/users/moore3071","html_url":"https://github.com/moore3071","followers_url":"https://api.github.com/users/moore3071/followers","following_url":"https://api.github.com/users/moore3071/following{/other_user}","gists_url":"https://api.github.com/users/moore3071/gists{/gist_id}","starred_url":"https://api.github.com/users/moore3071/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/moore3071/subscriptions","organizations_url":"https://api.github.com/users/moore3071/orgs","repos_url":"https://api.github.com/users/moore3071/repos","events_url":"https://api.github.com/users/moore3071/events{/privacy}","received_events_url":"https://api.github.com/users/moore3071/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/comments/377727606","html_url":"https://github.com/diesel-rs/diesel/issues/1604#issuecomment-377727606","issue_url":"https://api.github.com/repos/diesel-rs/diesel/issues/1604","id":377727606,"node_id":"MDEyOklzc3VlQ29tbWVudDM3NzcyNzYwNg==","user":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-03-31T22:22:36Z","updated_at":"2018-03-31T22:22:36Z","body":"> If you mean having the docs above the macro call,\r\n\r\nI don't. I mean having them exactly where they would otherwise be.\r\n\r\n```\r\nsql_function! {\r\n    /// Here are some docs\r\n    #[sql_name = \"heres_an_anotation\"]\r\n    fn foo(bar: Integer) -> Text;\r\n}\r\n\r\nsql_function! {\r\n    #[sql_name = \"note_the_order_can_be_reversed\"]\r\n    /// Doc comments just get desugared to #[doc = \"...\"]\r\n    fn bar(baz: Integer) -> Text;\r\n}\r\n```","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/comments/377727606/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":1592724859,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDE1OTI3MjQ4NTk=","url":"https://api.github.com/repos/diesel-rs/diesel/issues/events/1592724859","actor":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"135e9980790fb5b77060c151b0799f2730d05b42","commit_url":"https://api.github.com/repos/diesel-rs/diesel/commits/135e9980790fb5b77060c151b0799f2730d05b42","created_at":"2018-04-24T21:55:14Z","performed_via_github_app":null},{"id":1592726333,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDE1OTI3MjYzMzM=","url":"https://api.github.com/repos/diesel-rs/diesel/issues/events/1592726333","actor":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"db1f7739791f29af31abbad7f23f296dcf447739","commit_url":"https://api.github.com/repos/diesel-rs/diesel/commits/db1f7739791f29af31abbad7f23f296dcf447739","created_at":"2018-04-24T21:56:07Z","performed_via_github_app":null},{"actor":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-04-24T21:58:42Z","updated_at":"2018-04-24T21:58:42Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/1658","repository_url":"https://api.github.com/repos/diesel-rs/diesel","labels_url":"https://api.github.com/repos/diesel-rs/diesel/issues/1658/labels{/name}","comments_url":"https://api.github.com/repos/diesel-rs/diesel/issues/1658/comments","events_url":"https://api.github.com/repos/diesel-rs/diesel/issues/1658/events","html_url":"https://github.com/diesel-rs/diesel/pull/1658","id":317410413,"node_id":"MDExOlB1bGxSZXF1ZXN0MTgzODc2MDk4","number":1658,"title":"Redesign `sql_function!`","user":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2018-04-24T21:58:42Z","updated_at":"2018-04-26T12:24:35Z","closed_at":"2018-04-26T12:24:14Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":41609775,"node_id":"MDEwOlJlcG9zaXRvcnk0MTYwOTc3NQ==","name":"diesel","full_name":"diesel-rs/diesel","private":false,"owner":{"login":"diesel-rs","id":16763251,"node_id":"MDEyOk9yZ2FuaXphdGlvbjE2NzYzMjUx","avatar_url":"https://avatars.githubusercontent.com/u/16763251?v=4","gravatar_id":"","url":"https://api.github.com/users/diesel-rs","html_url":"https://github.com/diesel-rs","followers_url":"https://api.github.com/users/diesel-rs/followers","following_url":"https://api.github.com/users/diesel-rs/following{/other_user}","gists_url":"https://api.github.com/users/diesel-rs/gists{/gist_id}","starred_url":"https://api.github.com/users/diesel-rs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/diesel-rs/subscriptions","organizations_url":"https://api.github.com/users/diesel-rs/orgs","repos_url":"https://api.github.com/users/diesel-rs/repos","events_url":"https://api.github.com/users/diesel-rs/events{/privacy}","received_events_url":"https://api.github.com/users/diesel-rs/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/diesel-rs/diesel","description":"A safe, extensible ORM and Query Builder for Rust","fork":false,"url":"https://api.github.com/repos/diesel-rs/diesel","forks_url":"https://api.github.com/repos/diesel-rs/diesel/forks","keys_url":"https://api.github.com/repos/diesel-rs/diesel/keys{/key_id}","collaborators_url":"https://api.github.com/repos/diesel-rs/diesel/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/diesel-rs/diesel/teams","hooks_url":"https://api.github.com/repos/diesel-rs/diesel/hooks","issue_events_url":"https://api.github.com/repos/diesel-rs/diesel/issues/events{/number}","events_url":"https://api.github.com/repos/diesel-rs/diesel/events","assignees_url":"https://api.github.com/repos/diesel-rs/diesel/assignees{/user}","branches_url":"https://api.github.com/repos/diesel-rs/diesel/branches{/branch}","tags_url":"https://api.github.com/repos/diesel-rs/diesel/tags","blobs_url":"https://api.github.com/repos/diesel-rs/diesel/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/diesel-rs/diesel/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/diesel-rs/diesel/git/refs{/sha}","trees_url":"https://api.github.com/repos/diesel-rs/diesel/git/trees{/sha}","statuses_url":"https://api.github.com/repos/diesel-rs/diesel/statuses/{sha}","languages_url":"https://api.github.com/repos/diesel-rs/diesel/languages","stargazers_url":"https://api.github.com/repos/diesel-rs/diesel/stargazers","contributors_url":"https://api.github.com/repos/diesel-rs/diesel/contributors","subscribers_url":"https://api.github.com/repos/diesel-rs/diesel/subscribers","subscription_url":"https://api.github.com/repos/diesel-rs/diesel/subscription","commits_url":"https://api.github.com/repos/diesel-rs/diesel/commits{/sha}","git_commits_url":"https://api.github.com/repos/diesel-rs/diesel/git/commits{/sha}","comments_url":"https://api.github.com/repos/diesel-rs/diesel/comments{/number}","issue_comment_url":"https://api.github.com/repos/diesel-rs/diesel/issues/comments{/number}","contents_url":"https://api.github.com/repos/diesel-rs/diesel/contents/{+path}","compare_url":"https://api.github.com/repos/diesel-rs/diesel/compare/{base}...{head}","merges_url":"https://api.github.com/repos/diesel-rs/diesel/merges","archive_url":"https://api.github.com/repos/diesel-rs/diesel/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/diesel-rs/diesel/downloads","issues_url":"https://api.github.com/repos/diesel-rs/diesel/issues{/number}","pulls_url":"https://api.github.com/repos/diesel-rs/diesel/pulls{/number}","milestones_url":"https://api.github.com/repos/diesel-rs/diesel/milestones{/number}","notifications_url":"https://api.github.com/repos/diesel-rs/diesel/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/diesel-rs/diesel/labels{/name}","releases_url":"https://api.github.com/repos/diesel-rs/diesel/releases{/id}","deployments_url":"https://api.github.com/repos/diesel-rs/diesel/deployments","created_at":"2015-08-29T22:51:00Z","updated_at":"2025-11-09T19:31:55Z","pushed_at":"2025-11-07T18:13:31Z","git_url":"git://github.com/diesel-rs/diesel.git","ssh_url":"git@github.com:diesel-rs/diesel.git","clone_url":"https://github.com/diesel-rs/diesel.git","svn_url":"https://github.com/diesel-rs/diesel","homepage":"https://diesel.rs","size":109357,"stargazers_count":13771,"watchers_count":13771,"language":"Rust","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":true,"has_discussions":true,"forks_count":1168,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":153,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["mysql","orm","postgresql","query-builder","rust","sqlite"],"visibility":"public","forks":1168,"open_issues":153,"watchers":13771,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/diesel-rs/diesel/pulls/1658","html_url":"https://github.com/diesel-rs/diesel/pull/1658","diff_url":"https://github.com/diesel-rs/diesel/pull/1658.diff","patch_url":"https://github.com/diesel-rs/diesel/pull/1658.patch","merged_at":"2018-04-26T12:24:13Z"},"body":"TL;DR:\r\n==\r\n\r\nBefore:\r\n--\r\n\r\n```rust\r\nsql_function!(lower, lower_t, (x: Text) -> Text, \"\r\nThis represents the lower function.\r\nUnfortunately, the API of `sql_function!` makes providing a doc\r\nstring ugly as all hell.\");\r\n```\r\n\r\nAfter:\r\n--\r\n\r\n```rust\r\nsql_function! {\r\n    /// This represents the `lower` function.\r\n    /// Because the syntax of `sql_function!` is identical to a normal\r\n    /// extern function in Rust, editor hilighting now works,\r\n    /// and this will get picked up by ctags.\r\n    fn lower(x: Text) -> Text;\r\n}\r\n```\r\n\r\nActual commit description:\r\n===\r\n\r\nThis redesign comes from a few main desires:\r\n\r\n- Remove the second argument to the macro\r\n- Make it easy to add `#[sql_name]` in the future (see #1596)\r\n- Have the function picked up by ctags\r\n- Generally just look more like Rust.\r\n\r\nOne other nice side effect is that we're able to pick up any/all meta\r\nitems. Right now I'm only applying them to the function, but it may be\r\nworth applying them to the module as well to enable various `#[allow]`s\r\nto get added by users in the event of future lints added to rust/clippy\r\nthat we are violating.\r\n\r\nThe second argument to `sql_function!` has long been a wart on Diesel.\r\nUltimately we want to generate these three things:\r\n\r\n```rust\r\nfn lower<X>(x: X) -> lower<X>\r\nwhere\r\n    X: AsExpression<Text>,\r\n{\r\n    ...\r\n}\r\n\r\npub struct lower<X> {\r\n    x: X,\r\n}\r\n\r\npub type lower<X> = lower<<X as AsExpression<Text>>::Expression>;\r\n```\r\n\r\nHowever, we cannot have the struct and the type exist at the same time.\r\nOne of them needs to have a different name. Ultimately we don't care\r\nabout the struct. The only time it ever needs to get named is in the\r\nbody of the generated function. Virtually everything else can work with\r\nthe helper type. We will never be able to automatically generate all of\r\nthose things unless we either get stable procedural macros, or a working\r\nform of `concat_idents!`. Ultimately all we need is for that struct to\r\nbe some unique name, or otherwise unnameable outside of the macro.\r\n\r\nHowever, as I was working on this, it became clear that the helper type\r\nis pretty rarely needed. Generally the only time you care about having\r\nthat helper type is if you are making a library to be consumed by others\r\n(e.g. `diesel_full_text_search`), in which case you're already\r\nre-exporting it from other places. When you're re-exporting, we can take\r\nadvantage of how Rust deals with name resolution between glob imports\r\nand locally defined items. We actually use `sql_function!` surprisingly\r\nlittle in Diesel itself, but you can see the effects of this in `date`.\r\n\r\nI've opted to give the struct the same name as the function, and the\r\nhelper type the \"generic\" name. The alternative would be to give the\r\nhelper type the same name as the function, and call the struct `Repr` or\r\nsomething similar. However, the struct appears in error messages, the\r\nhelper type does not.\r\n\r\nAt the end of the day though, very little code actually wants or needs\r\nthe helper type. We do use `sql_function!` quite a bit in tests, and\r\nthere's literally only one place where we were using the type (and that\r\nplace was code that was pre-0.16, which is not code I would have written\r\nthat way today in the first place).\r\n\r\nEdge cases\r\n---\r\n\r\nThis doesn't quite handle everything the old form does. 100% of the edge\r\ncases we miss come from the use of `sql_function!` inside of a Rust\r\nfunction. To make all of this work, we need to wrap most of the code\r\ninside of a module. To resolve items the user expects us to, we do `use\r\nsuper::*`. However, that will not resolve any items that were imported\r\nin the function itself. To make it more concrete, this code will not\r\ncompile:\r\n\r\n```\r\nfn foo() {\r\n    use std::io::Stdout;\r\n\r\n    mod bar {\r\n        use super::*;\r\n        type Out = self::Stdout;\r\n    }\r\n}\r\n```\r\n\r\nThe only place this really affects `sql_function!` is with imported SQL\r\ntypes. For example, you'll often see `use diesel::sql_types::Text`\r\nbefore the definition of `lower` to avoid having to qualify it. Because\r\nthis is limited to SQL types, I've tried to lower the impact of this\r\ncaveat by adding `use diesel::sql_types::*;` at the top of the module.\r\nHowever, `sql_functions!` which reference types from third party crates\r\nwill either need to be declared outside of a function, have the imports\r\ndone outside of a function, or just qualify the names.\r\n\r\nFinally, if you use `sql_function!` inside of a Rust function, you can\r\nnever reference the helper types. There is no workaround. You'll just\r\nhave to declare the sql function outside the Rust function.\r\n\r\nThese edge cases are fine. The TL;DR workaround for all of them is\r\n\"don't use `sql_function!` inside of a Rust function\". Really the only\r\nreason to have done that in the first place is if you're dealing with a\r\nhighly variadic function like `coalesce`, where you want to just encode\r\nthe exact signature for the case you have right now. Those cases\r\ngenerally still work, and once we add support for `#[sql_name]`, those\r\nbecome easier to handle without abusing Rust's scoping rules anyway.\r\n\r\nFuture plans\r\n---\r\n\r\nI think this design has much more room for extension than the old one\r\ndid. Here's what I'd like to do with this in the future:\r\n\r\n- Support `#[sql_name]` as a special meta item\r\n  - Discussed above. It's the primary motivation for the redesign in the\r\n    first place.\r\n- Unify `sql_function!` and `no_arg_sql_function!`\r\n  - The main difference between them is that the no-arg form just\r\n    generates a unit struct, rather than a function. I think we can\r\n    probably generate the function no matter what, but then generate a\r\n    unit struct instead of a module if there are no arguments.\r\n- Support where clauses\r\n  - Required for unifying `no_arg_sql_function!`. `DB` would be a\r\n    \"magic\" type that you can reference in the where clause to add\r\n    backend constraints. I suspect we may also want to support `where DB\r\n    == Pg` to specify that it's only available on postgres, but that's\r\n    really only useful for PG sepcific libraries, so there's not as much\r\n    gain.\r\n- Support generics\r\n  - We have an obvious syntax we can use to get rid of `ord_function!`\r\n    and `fold_function!`. We should use it.\r\n\r\nFixes #1604","reactions":{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/1658/reactions","total_count":2,"+1":1,"-1":0,"laugh":0,"hooray":1,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/diesel-rs/diesel/issues/1658/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":1596360387,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDE1OTYzNjAzODc=","url":"https://api.github.com/repos/diesel-rs/diesel/issues/events/1596360387","actor":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"676e74302b097dfc895aa188170371dfb28422c0","commit_url":"https://api.github.com/repos/diesel-rs/diesel/commits/676e74302b097dfc895aa188170371dfb28422c0","created_at":"2018-04-26T12:23:48Z","performed_via_github_app":null},{"id":1596361122,"node_id":"MDExOkNsb3NlZEV2ZW50MTU5NjM2MTEyMg==","url":"https://api.github.com/repos/diesel-rs/diesel/issues/events/1596361122","actor":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2018-04-26T12:24:13Z","state_reason":null,"performed_via_github_app":null}]