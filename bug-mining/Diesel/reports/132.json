{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/1255","repository_url":"https://api.github.com/repos/diesel-rs/diesel","labels_url":"https://api.github.com/repos/diesel-rs/diesel/issues/1255/labels{/name}","comments_url":"https://api.github.com/repos/diesel-rs/diesel/issues/1255/comments","events_url":"https://api.github.com/repos/diesel-rs/diesel/issues/1255/events","html_url":"https://github.com/diesel-rs/diesel/issues/1255","id":264445291,"node_id":"MDU6SXNzdWUyNjQ0NDUyOTE=","number":1255,"title":"Panic while formatting an error when Pg connection is reset","user":{"login":"jethrogb","id":1132307,"node_id":"MDQ6VXNlcjExMzIzMDc=","avatar_url":"https://avatars.githubusercontent.com/u/1132307?v=4","gravatar_id":"","url":"https://api.github.com/users/jethrogb","html_url":"https://github.com/jethrogb","followers_url":"https://api.github.com/users/jethrogb/followers","following_url":"https://api.github.com/users/jethrogb/following{/other_user}","gists_url":"https://api.github.com/users/jethrogb/gists{/gist_id}","starred_url":"https://api.github.com/users/jethrogb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jethrogb/subscriptions","organizations_url":"https://api.github.com/users/jethrogb/orgs","repos_url":"https://api.github.com/users/jethrogb/repos","events_url":"https://api.github.com/users/jethrogb/events{/privacy}","received_events_url":"https://api.github.com/users/jethrogb/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/diesel-rs/diesel/milestones/4","html_url":"https://github.com/diesel-rs/diesel/milestone/4","labels_url":"https://api.github.com/repos/diesel-rs/diesel/milestones/4/labels","id":1440971,"node_id":"MDk6TWlsZXN0b25lMTQ0MDk3MQ==","number":4,"title":"1.0","description":"","creator":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":14,"state":"closed","created_at":"2015-12-02T23:00:09Z","updated_at":"2018-01-15T14:15:01Z","due_on":"2017-12-31T08:00:00Z","closed_at":"2018-01-15T14:15:01Z"},"comments":3,"created_at":"2017-10-11T03:25:06Z","updated_at":"2017-10-17T17:34:27Z","closed_at":"2017-10-17T17:34:27Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Problem Description\r\n\r\nWhen a Postgres database connection is closed unexpectedly, trying to debug-format the error returned by Diesel panics. Here's a simple test program (using a table named `config`):\r\n\r\n```rust\r\nfn main() {\r\n    let connection = establish_connection();\r\n    loop {\r\n        println!(\"{:?}\", config::table.count().first::<i64>(&connection));\r\n        std::thread::sleep(std::time::Duration::from_secs(1));\r\n    }\r\n}\r\n```\r\n\r\nHave the DB server running before starting the program. After you see an `Ok(...)` line, forcefully terminate the DB server, for example using `kill -9`. I'm getting the following panic:\r\n\r\n```\r\nthread 'main' panicked at 'internal error: entered unreachable code: Per PGs documentation, all errors should have a message', .cargo/registry/src/github.com-1ecc6299db9ec823/diesel-0.16.0/src/pg/connection/result.rs:97:20\r\nstack backtrace:\r\n   0: std::sys::imp::backtrace::tracing::imp::unwind_backtrace\r\n             at /checkout/src/libstd/sys/unix/backtrace/tracing/gcc_s.rs:49\r\n   1: std::sys_common::backtrace::_print\r\n             at /checkout/src/libstd/sys_common/backtrace.rs:71\r\n   2: std::panicking::default_hook::{{closure}}\r\n             at /checkout/src/libstd/sys_common/backtrace.rs:60\r\n             at /checkout/src/libstd/panicking.rs:380\r\n   3: std::panicking::default_hook\r\n             at /checkout/src/libstd/panicking.rs:396\r\n   4: std::panicking::rust_panic_with_hook\r\n             at /checkout/src/libstd/panicking.rs:611\r\n   5: std::panicking::begin_panic_new\r\n             at /checkout/src/libstd/panicking.rs:553\r\n   6: std::panicking::begin_panic_fmt\r\n             at /checkout/src/libstd/panicking.rs:521\r\n   7: <diesel::pg::connection::result::PgErrorInformation as diesel::result::DatabaseErrorInformation>::message\r\n             at .cargo/registry/src/github.com-1ecc6299db9ec823/diesel-0.16.0/src/pg/connection/result.rs:97\r\n   8: <diesel::result::DatabaseErrorInformation + core::marker::Sync + core::marker::Send + 'static as core::fmt::Debug>::fmt\r\n             at .cargo/registry/src/github.com-1ecc6299db9ec823/diesel-0.16.0/src/result.rs:52\r\n   9: <alloc::boxed::Box<T> as core::fmt::Debug>::fmt\r\n             at /checkout/src/liballoc/boxed.rs:534\r\n  10: <&'a T as core::fmt::Debug>::fmt\r\n             at /checkout/src/libcore/fmt/mod.rs:1482\r\n  11: core::fmt::write\r\n             at /checkout/src/libcore/fmt/mod.rs:951\r\n  12: core::fmt::builders::DebugTuple::field\r\n             at /checkout/src/libcore/fmt/builders.rs:0\r\n  13: <diesel::result::Error as core::fmt::Debug>::fmt\r\n             at .cargo/registry/src/github.com-1ecc6299db9ec823/diesel-0.16.0/src/result.rs:6\r\n  14: <&'a T as core::fmt::Debug>::fmt\r\n             at /checkout/src/libcore/fmt/mod.rs:1482\r\n  15: core::fmt::write\r\n             at /checkout/src/libcore/fmt/mod.rs:951\r\n  16: core::fmt::builders::DebugTuple::field\r\n             at /checkout/src/libcore/fmt/builders.rs:0\r\n  17: <core::result::Result<T, E> as core::fmt::Debug>::fmt\r\n             at /checkout/src/libcore/result.rs:250\r\n  18: core::fmt::write\r\n             at /checkout/src/libcore/fmt/mod.rs:951\r\n  19: <std::io::stdio::Stdout as std::io::Write>::write_fmt\r\n             at /checkout/src/libstd/io/mod.rs:1117\r\n             at /checkout/src/libstd/io/stdio.rs:461\r\n  20: std::io::stdio::_print\r\n             at /checkout/src/libstd/io/stdio.rs:679\r\n             at /checkout/src/libstd/io/stdio.rs:701\r\n  21: dtest::main\r\n             at src/main.rs:27\r\n  22: __rust_maybe_catch_panic\r\n             at /checkout/src/libpanic_unwind/lib.rs:98\r\n  23: std::rt::lang_start\r\n             at /checkout/src/libstd/panicking.rs:458\r\n             at /checkout/src/libstd/panic.rs:361\r\n             at /checkout/src/libstd/rt.rs:59\r\n  24: main\r\n  25: __libc_start_main\r\n  26: _start\r\n```\r\n\r\n## Setup\r\n\r\n### Versions\r\n\r\n- **Rust:** 1.20\r\n- **Diesel:** 0.16.0\r\n- **Database:** CockroachDB 1.0\r\n- **Operating System** Ubuntu 16.04\r\n- **libpq**: 9.5.8-0ubuntu0.16.04.1\r\n\r\n### Feature Flags\r\n\r\n- **diesel:** default\r\n- **diesel_codegen:** default\r\n","closed_by":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/1255/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/diesel-rs/diesel/issues/1255/timeline","performed_via_github_app":null,"state_reason":"completed"}