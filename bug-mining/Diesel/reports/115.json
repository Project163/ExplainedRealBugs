{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/1068","repository_url":"https://api.github.com/repos/diesel-rs/diesel","labels_url":"https://api.github.com/repos/diesel-rs/diesel/issues/1068/labels{/name}","comments_url":"https://api.github.com/repos/diesel-rs/diesel/issues/1068/comments","events_url":"https://api.github.com/repos/diesel-rs/diesel/issues/1068/events","html_url":"https://github.com/diesel-rs/diesel/issues/1068","id":247975519,"node_id":"MDU6SXNzdWUyNDc5NzU1MTk=","number":1068,"title":"Not working: parent.join(child.join(grandchild)) [in some cases]","user":{"login":"valeriansaliou","id":1451907,"node_id":"MDQ6VXNlcjE0NTE5MDc=","avatar_url":"https://avatars.githubusercontent.com/u/1451907?v=4","gravatar_id":"","url":"https://api.github.com/users/valeriansaliou","html_url":"https://github.com/valeriansaliou","followers_url":"https://api.github.com/users/valeriansaliou/followers","following_url":"https://api.github.com/users/valeriansaliou/following{/other_user}","gists_url":"https://api.github.com/users/valeriansaliou/gists{/gist_id}","starred_url":"https://api.github.com/users/valeriansaliou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/valeriansaliou/subscriptions","organizations_url":"https://api.github.com/users/valeriansaliou/orgs","repos_url":"https://api.github.com/users/valeriansaliou/repos","events_url":"https://api.github.com/users/valeriansaliou/events{/privacy}","received_events_url":"https://api.github.com/users/valeriansaliou/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2017-08-04T11:12:33Z","updated_at":"2017-08-04T19:04:27Z","closed_at":"2017-08-04T17:00:22Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Setup\r\n\r\n### Versions\r\n\r\n- **Rust:** rustc 1.21.0-nightly (b75d1f0ce 2017-08-02)\r\n- **Diesel:** 0.15.2\r\n- **Database:** PG\r\n- **Operating System** macOS 10.12.6\r\n\r\n### Feature Flags\r\n\r\n- **diesel:** [\"postgres\"]\r\n- **diesel_codegen:** [\"postgres\"]\r\n\r\n## Problem Description\r\n\r\nIn certain relational schemas, performing a `parent.join(child.join(grandchild))` doesn't work as expected (`join` can be an `inner_join` or `left_join`, same error).\r\n\r\nThe same code, using the simpler `parent.join(child.join)` call works.\r\n\r\n**If I change the schema and reverse the belongs_to relation between parent and child, the nested join works just fine. However that's the schema I want to rely on, plus my schema is SQL-valid.**\r\n\r\n### What are you trying to accomplish?\r\n\r\nI'm trying to perform a join w/ the following structure: `parent.join(child.join(grandchild))`\r\n\r\nGiven the following schema: \r\n\r\n```rust\r\ntable! {\r\n    parent (id) {\r\n        id -> Integer,\r\n        child_id -> Integer,\r\n    }\r\n}\r\n\r\ntable! {\r\n    child (id) {\r\n        id -> Integer,\r\n        grand_child_id -> Integer,\r\n    }\r\n}\r\n\r\ntable! {\r\n    grandchild (id) {\r\n        id -> Integer,\r\n    }\r\n}\r\n```\r\n\r\nAnd the following model:\r\n\r\n```rust\r\n#[derive(Identifiable, Queryable, Associations)]\r\n#[belongs_to(Child)]\r\n#[table_name=\"parent\"]\r\npub struct Parent {\r\n    pub id: i32,\r\n    pub child_id: i32,\r\n}\r\n\r\n#[derive(Identifiable, Queryable, Associations)]\r\n#[belongs_to(GrandChild)]\r\n#[table_name=\"child\"]\r\npub struct Child {\r\n    pub id: i32,\r\n    pub grand_child_id: i32,\r\n}\r\n\r\n#[derive(Identifiable, Queryable, Associations)]\r\n#[table_name=\"grandchild\"]\r\npub struct GrandChild {\r\n    pub id: i32,\r\n}\r\n```\r\n\r\n### What is the expected output?\r\n\r\nThe expected output is the equivalent of the full-SQL request:\r\n\r\n```sql\r\nSELECT \"person_employment\".\"title\", \"company\".\"legal_name\", \"contact\".\"emails\" FROM (\r\n\t\"person_employment\"\r\n\t\tINNER JOIN \"company\" ON \"person_employment\".\"company_id\" = \"company\".\"id\"\r\n\t\tINNER JOIN \"contact\" ON \"company\".\"contact_id\" = \"contact\".\"id\"\r\n);\r\n```\r\n\r\nWhich works just fine in a PG prompt, based on the bare SQL schema defined above.\r\n\r\n### What is the actual output?\r\n\r\nGetting the following error when compiling, although all relevant `belongs_to` and `enable_multi_table_joins!` are set.\r\n\r\n```\r\nerror[E0277]: the trait bound `diesel::query_source::joins::PleaseGenerateInverseJoinImpls<parent::table>: diesel::JoinTo<child::table>` is not satisfied\r\n   --> src/lib.rs:141:10\r\n    |\r\n141 |         .inner_join(child::table.inner_join(grandchild::table))\r\n    |          ^^^^^^^^^^ the trait `diesel::JoinTo<child::table>` is not implemented for `diesel::query_source::joins::PleaseGenerateInverseJoinImpls<parent::table>`\r\n```\r\n\r\n### Are you seeing any additional errors?\r\n\r\nNo, only this one.\r\n\r\n### Steps to reproduce\r\n\r\n1. Gist: [valeriansaliou/48f441bbcdcef29f5395b87b09dc9893](https://gist.github.com/valeriansaliou/48f441bbcdcef29f5395b87b09dc9893)\r\n2. Compile the code w/o changing it. It works. It's using the only relational schema I could get it to work with, however I don't want it this way (in this schema, a child references both its parent and grandchild)\r\n3. Uncomment the 2 commented sections regarding schema + models and comment out the other ones.\r\n4. Build it, you'll get the compilation error I'm talking about. This is using the schema that's more appropriate in that case, but which will never build w/ Diesel.","closed_by":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/1068/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/diesel-rs/diesel/issues/1068/timeline","performed_via_github_app":null,"state_reason":"completed"}