[{"id":7869530663,"node_id":"LE_lADOAnrqL85XCB4pzwAAAAHVD4In","url":"https://api.github.com/repos/diesel-rs/diesel/issues/events/7869530663","actor":{"login":"weiznich","id":1674512,"node_id":"MDQ6VXNlcjE2NzQ1MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1674512?v=4","gravatar_id":"","url":"https://api.github.com/users/weiznich","html_url":"https://github.com/weiznich","followers_url":"https://api.github.com/users/weiznich/followers","following_url":"https://api.github.com/users/weiznich/following{/other_user}","gists_url":"https://api.github.com/users/weiznich/gists{/gist_id}","starred_url":"https://api.github.com/users/weiznich/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weiznich/subscriptions","organizations_url":"https://api.github.com/users/weiznich/orgs","repos_url":"https://api.github.com/users/weiznich/repos","events_url":"https://api.github.com/users/weiznich/events{/privacy}","received_events_url":"https://api.github.com/users/weiznich/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2022-11-22T16:15:10Z","label":{"name":"bug","color":"fc2929"},"performed_via_github_app":null},{"id":7869530665,"node_id":"LE_lADOAnrqL85XCB4pzwAAAAHVD4Ip","url":"https://api.github.com/repos/diesel-rs/diesel/issues/events/7869530665","actor":{"login":"weiznich","id":1674512,"node_id":"MDQ6VXNlcjE2NzQ1MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1674512?v=4","gravatar_id":"","url":"https://api.github.com/users/weiznich","html_url":"https://github.com/weiznich","followers_url":"https://api.github.com/users/weiznich/followers","following_url":"https://api.github.com/users/weiznich/following{/other_user}","gists_url":"https://api.github.com/users/weiznich/gists{/gist_id}","starred_url":"https://api.github.com/users/weiznich/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weiznich/subscriptions","organizations_url":"https://api.github.com/users/weiznich/orgs","repos_url":"https://api.github.com/users/weiznich/repos","events_url":"https://api.github.com/users/weiznich/events{/privacy}","received_events_url":"https://api.github.com/users/weiznich/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2022-11-22T16:15:10Z","label":{"name":"help wanted","color":"159818"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/comments/1323920077","html_url":"https://github.com/diesel-rs/diesel/issues/3425#issuecomment-1323920077","issue_url":"https://api.github.com/repos/diesel-rs/diesel/issues/3425","id":1323920077,"node_id":"IC_kwDOAnrqL85O6WrN","user":{"login":"weiznich","id":1674512,"node_id":"MDQ6VXNlcjE2NzQ1MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1674512?v=4","gravatar_id":"","url":"https://api.github.com/users/weiznich","html_url":"https://github.com/weiznich","followers_url":"https://api.github.com/users/weiznich/followers","following_url":"https://api.github.com/users/weiznich/following{/other_user}","gists_url":"https://api.github.com/users/weiznich/gists{/gist_id}","starred_url":"https://api.github.com/users/weiznich/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weiznich/subscriptions","organizations_url":"https://api.github.com/users/weiznich/orgs","repos_url":"https://api.github.com/users/weiznich/repos","events_url":"https://api.github.com/users/weiznich/events{/privacy}","received_events_url":"https://api.github.com/users/weiznich/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-11-22T16:15:13Z","updated_at":"2022-11-22T16:15:13Z","body":"This seems to be a bug in our bind logic. We handle owned and borrowed values in a different manner to avoid additional allocations whenever possible. The relevant code section is here:\r\nhttps://github.com/diesel-rs/diesel/blob/abe221d7af8455d0dba3a90a2a8aad27e8833b9d/diesel/src/sqlite/connection/stmt.rs#L106-L127\r\n\r\nThe problem there is the `if` statement, which checks if the string is empty or not. For an empty string we just use a null pointer as argument to `sqlite3_bind_text`. Seems like I missed the relevant part of the sqlite documentation:\r\n\r\n> The third argument is the value to bind to the parameter. If the third parameter to sqlite3_bind_text() or sqlite3_bind_text16() or sqlite3_bind_blob() is a NULL pointer then the fourth parameter is ignored and the end result is the same as sqlite3_bind_null().\r\n\r\nTo fix this we need to remove the special handling of empty strings there. I think it might be fine to just unconditionally execute the other branch, but I've not checked that yet. The same fix needs to be applied to the `InternalSqliteBindValue::Binary` branch a few lines above: https://github.com/diesel-rs/diesel/blob/abe221d7af8455d0dba3a90a2a8aad27e8833b9d/diesel/src/sqlite/connection/stmt.rs#L76\r\n\r\nAlso we likely want a test for this, as our CI executes most of the sqlite tests with asan enabled. This might catch additional issues here.\r\n\r\nI'm happy to accept a PR for this, if someone want's to touch the corresponding unsafe code. I myself will likely not be able to work on a fix till next week or so.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/comments/1323920077/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"weiznich","id":1674512,"node_id":"MDQ6VXNlcjE2NzQ1MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1674512?v=4","gravatar_id":"","url":"https://api.github.com/users/weiznich","html_url":"https://github.com/weiznich","followers_url":"https://api.github.com/users/weiznich/followers","following_url":"https://api.github.com/users/weiznich/following{/other_user}","gists_url":"https://api.github.com/users/weiznich/gists{/gist_id}","starred_url":"https://api.github.com/users/weiznich/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weiznich/subscriptions","organizations_url":"https://api.github.com/users/weiznich/orgs","repos_url":"https://api.github.com/users/weiznich/repos","events_url":"https://api.github.com/users/weiznich/events{/privacy}","received_events_url":"https://api.github.com/users/weiznich/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":7930349604,"node_id":"REFE_lADOAnrqL85XCB4pzwAAAAHYr4gk","url":"https://api.github.com/repos/diesel-rs/diesel/issues/events/7930349604","actor":{"login":"weiznich","id":1674512,"node_id":"MDQ6VXNlcjE2NzQ1MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1674512?v=4","gravatar_id":"","url":"https://api.github.com/users/weiznich","html_url":"https://github.com/weiznich","followers_url":"https://api.github.com/users/weiznich/followers","following_url":"https://api.github.com/users/weiznich/following{/other_user}","gists_url":"https://api.github.com/users/weiznich/gists{/gist_id}","starred_url":"https://api.github.com/users/weiznich/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weiznich/subscriptions","organizations_url":"https://api.github.com/users/weiznich/orgs","repos_url":"https://api.github.com/users/weiznich/repos","events_url":"https://api.github.com/users/weiznich/events{/privacy}","received_events_url":"https://api.github.com/users/weiznich/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"eb125bd0fae8a79bac8e8a62dd2c88087e824dd4","commit_url":"https://api.github.com/repos/weiznich/diesel/commits/eb125bd0fae8a79bac8e8a62dd2c88087e824dd4","created_at":"2022-12-01T10:20:31Z","performed_via_github_app":null},{"id":7930800692,"node_id":"CE_lADOAnrqL85XCB4pzwAAAAHYtmo0","url":"https://api.github.com/repos/diesel-rs/diesel/issues/events/7930800692","actor":{"login":"pksunkara","id":174703,"node_id":"MDQ6VXNlcjE3NDcwMw==","avatar_url":"https://avatars.githubusercontent.com/u/174703?v=4","gravatar_id":"","url":"https://api.github.com/users/pksunkara","html_url":"https://github.com/pksunkara","followers_url":"https://api.github.com/users/pksunkara/followers","following_url":"https://api.github.com/users/pksunkara/following{/other_user}","gists_url":"https://api.github.com/users/pksunkara/gists{/gist_id}","starred_url":"https://api.github.com/users/pksunkara/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pksunkara/subscriptions","organizations_url":"https://api.github.com/users/pksunkara/orgs","repos_url":"https://api.github.com/users/pksunkara/repos","events_url":"https://api.github.com/users/pksunkara/events{/privacy}","received_events_url":"https://api.github.com/users/pksunkara/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"eb125bd0fae8a79bac8e8a62dd2c88087e824dd4","commit_url":"https://api.github.com/repos/diesel-rs/diesel/commits/eb125bd0fae8a79bac8e8a62dd2c88087e824dd4","created_at":"2022-12-01T11:14:13Z","state_reason":null,"performed_via_github_app":null},{"id":7930800738,"node_id":"REFE_lADOAnrqL85XCB4pzwAAAAHYtmpi","url":"https://api.github.com/repos/diesel-rs/diesel/issues/events/7930800738","actor":{"login":"pksunkara","id":174703,"node_id":"MDQ6VXNlcjE3NDcwMw==","avatar_url":"https://avatars.githubusercontent.com/u/174703?v=4","gravatar_id":"","url":"https://api.github.com/users/pksunkara","html_url":"https://github.com/pksunkara","followers_url":"https://api.github.com/users/pksunkara/followers","following_url":"https://api.github.com/users/pksunkara/following{/other_user}","gists_url":"https://api.github.com/users/pksunkara/gists{/gist_id}","starred_url":"https://api.github.com/users/pksunkara/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pksunkara/subscriptions","organizations_url":"https://api.github.com/users/pksunkara/orgs","repos_url":"https://api.github.com/users/pksunkara/repos","events_url":"https://api.github.com/users/pksunkara/events{/privacy}","received_events_url":"https://api.github.com/users/pksunkara/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"6521ace25d1630ce578a7f5f69bc8361f09069ff","commit_url":"https://api.github.com/repos/diesel-rs/diesel/commits/6521ace25d1630ce578a7f5f69bc8361f09069ff","created_at":"2022-12-01T11:14:14Z","performed_via_github_app":null},{"id":9018877843,"node_id":"REFE_lADOAnrqL85XCB4pzwAAAAIZkSeT","url":"https://api.github.com/repos/diesel-rs/diesel/issues/events/9018877843","actor":{"login":"adamchalmers","id":5407457,"node_id":"MDQ6VXNlcjU0MDc0NTc=","avatar_url":"https://avatars.githubusercontent.com/u/5407457?v=4","gravatar_id":"","url":"https://api.github.com/users/adamchalmers","html_url":"https://github.com/adamchalmers","followers_url":"https://api.github.com/users/adamchalmers/followers","following_url":"https://api.github.com/users/adamchalmers/following{/other_user}","gists_url":"https://api.github.com/users/adamchalmers/gists{/gist_id}","starred_url":"https://api.github.com/users/adamchalmers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adamchalmers/subscriptions","organizations_url":"https://api.github.com/users/adamchalmers/orgs","repos_url":"https://api.github.com/users/adamchalmers/repos","events_url":"https://api.github.com/users/adamchalmers/events{/privacy}","received_events_url":"https://api.github.com/users/adamchalmers/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"b8e23aafc74b3a884f02b5e8582173316977e386","commit_url":"https://api.github.com/repos/adamchalmers/diesel/commits/b8e23aafc74b3a884f02b5e8582173316977e386","created_at":"2023-04-17T01:08:51Z","performed_via_github_app":null}]