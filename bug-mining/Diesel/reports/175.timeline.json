[{"id":2356521175,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjM1NjUyMTE3NQ==","url":"https://api.github.com/repos/diesel-rs/diesel/issues/events/2356521175","actor":{"login":"weiznich","id":1674512,"node_id":"MDQ6VXNlcjE2NzQ1MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1674512?v=4","gravatar_id":"","url":"https://api.github.com/users/weiznich","html_url":"https://github.com/weiznich","followers_url":"https://api.github.com/users/weiznich/followers","following_url":"https://api.github.com/users/weiznich/following{/other_user}","gists_url":"https://api.github.com/users/weiznich/gists{/gist_id}","starred_url":"https://api.github.com/users/weiznich/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weiznich/subscriptions","organizations_url":"https://api.github.com/users/weiznich/orgs","repos_url":"https://api.github.com/users/weiznich/repos","events_url":"https://api.github.com/users/weiznich/events{/privacy}","received_events_url":"https://api.github.com/users/weiznich/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-05-21T15:11:45Z","performed_via_github_app":null},{"id":2356521176,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIzNTY1MjExNzY=","url":"https://api.github.com/repos/diesel-rs/diesel/issues/events/2356521176","actor":{"login":"weiznich","id":1674512,"node_id":"MDQ6VXNlcjE2NzQ1MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1674512?v=4","gravatar_id":"","url":"https://api.github.com/users/weiznich","html_url":"https://github.com/weiznich","followers_url":"https://api.github.com/users/weiznich/followers","following_url":"https://api.github.com/users/weiznich/following{/other_user}","gists_url":"https://api.github.com/users/weiznich/gists{/gist_id}","starred_url":"https://api.github.com/users/weiznich/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weiznich/subscriptions","organizations_url":"https://api.github.com/users/weiznich/orgs","repos_url":"https://api.github.com/users/weiznich/repos","events_url":"https://api.github.com/users/weiznich/events{/privacy}","received_events_url":"https://api.github.com/users/weiznich/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-05-21T15:11:45Z","performed_via_github_app":null},{"id":2356521178,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MjM1NjUyMTE3OA==","url":"https://api.github.com/repos/diesel-rs/diesel/issues/events/2356521178","actor":{"login":"Ten0","id":9094255,"node_id":"MDQ6VXNlcjkwOTQyNTU=","avatar_url":"https://avatars.githubusercontent.com/u/9094255?v=4","gravatar_id":"","url":"https://api.github.com/users/Ten0","html_url":"https://github.com/Ten0","followers_url":"https://api.github.com/users/Ten0/followers","following_url":"https://api.github.com/users/Ten0/following{/other_user}","gists_url":"https://api.github.com/users/Ten0/gists{/gist_id}","starred_url":"https://api.github.com/users/Ten0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Ten0/subscriptions","organizations_url":"https://api.github.com/users/Ten0/orgs","repos_url":"https://api.github.com/users/Ten0/repos","events_url":"https://api.github.com/users/Ten0/events{/privacy}","received_events_url":"https://api.github.com/users/Ten0/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2019-05-21T15:11:45Z","performed_via_github_app":null},{"id":2356521180,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIzNTY1MjExODA=","url":"https://api.github.com/repos/diesel-rs/diesel/issues/events/2356521180","actor":{"login":"Ten0","id":9094255,"node_id":"MDQ6VXNlcjkwOTQyNTU=","avatar_url":"https://avatars.githubusercontent.com/u/9094255?v=4","gravatar_id":"","url":"https://api.github.com/users/Ten0","html_url":"https://github.com/Ten0","followers_url":"https://api.github.com/users/Ten0/followers","following_url":"https://api.github.com/users/Ten0/following{/other_user}","gists_url":"https://api.github.com/users/Ten0/gists{/gist_id}","starred_url":"https://api.github.com/users/Ten0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Ten0/subscriptions","organizations_url":"https://api.github.com/users/Ten0/orgs","repos_url":"https://api.github.com/users/Ten0/repos","events_url":"https://api.github.com/users/Ten0/events{/privacy}","received_events_url":"https://api.github.com/users/Ten0/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2019-05-21T15:11:45Z","performed_via_github_app":null},{"id":2356521679,"node_id":"MDE3OlJlbmFtZWRUaXRsZUV2ZW50MjM1NjUyMTY3OQ==","url":"https://api.github.com/repos/diesel-rs/diesel/issues/events/2356521679","actor":{"login":"Ten0","id":9094255,"node_id":"MDQ6VXNlcjkwOTQyNTU=","avatar_url":"https://avatars.githubusercontent.com/u/9094255?v=4","gravatar_id":"","url":"https://api.github.com/users/Ten0","html_url":"https://github.com/Ten0","followers_url":"https://api.github.com/users/Ten0/followers","following_url":"https://api.github.com/users/Ten0/following{/other_user}","gists_url":"https://api.github.com/users/Ten0/gists{/gist_id}","starred_url":"https://api.github.com/users/Ten0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Ten0/subscriptions","organizations_url":"https://api.github.com/users/Ten0/orgs","repos_url":"https://api.github.com/users/Ten0/repos","events_url":"https://api.github.com/users/Ten0/events{/privacy}","received_events_url":"https://api.github.com/users/Ten0/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"renamed","commit_id":null,"commit_url":null,"created_at":"2019-05-21T15:11:54Z","rename":{"from":"Postgres: We should avoid one query per custom type bind","to":"Postgres: We should avoid sending one query per custom type bind"},"performed_via_github_app":null},{"id":2356533613,"node_id":"MDEzOkFzc2lnbmVkRXZlbnQyMzU2NTMzNjEz","url":"https://api.github.com/repos/diesel-rs/diesel/issues/events/2356533613","actor":{"login":"weiznich","id":1674512,"node_id":"MDQ6VXNlcjE2NzQ1MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1674512?v=4","gravatar_id":"","url":"https://api.github.com/users/weiznich","html_url":"https://github.com/weiznich","followers_url":"https://api.github.com/users/weiznich/followers","following_url":"https://api.github.com/users/weiznich/following{/other_user}","gists_url":"https://api.github.com/users/weiznich/gists{/gist_id}","starred_url":"https://api.github.com/users/weiznich/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weiznich/subscriptions","organizations_url":"https://api.github.com/users/weiznich/orgs","repos_url":"https://api.github.com/users/weiznich/repos","events_url":"https://api.github.com/users/weiznich/events{/privacy}","received_events_url":"https://api.github.com/users/weiznich/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2019-05-21T15:15:16Z","assignee":{"login":"Ten0","id":9094255,"node_id":"MDQ6VXNlcjkwOTQyNTU=","avatar_url":"https://avatars.githubusercontent.com/u/9094255?v=4","gravatar_id":"","url":"https://api.github.com/users/Ten0","html_url":"https://github.com/Ten0","followers_url":"https://api.github.com/users/Ten0/followers","following_url":"https://api.github.com/users/Ten0/following{/other_user}","gists_url":"https://api.github.com/users/Ten0/gists{/gist_id}","starred_url":"https://api.github.com/users/Ten0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Ten0/subscriptions","organizations_url":"https://api.github.com/users/Ten0/orgs","repos_url":"https://api.github.com/users/Ten0/repos","events_url":"https://api.github.com/users/Ten0/events{/privacy}","received_events_url":"https://api.github.com/users/Ten0/received_events","type":"User","user_view_type":"public","site_admin":false},"performed_via_github_app":null},{"id":2356534722,"node_id":"MDEyOkxhYmVsZWRFdmVudDIzNTY1MzQ3MjI=","url":"https://api.github.com/repos/diesel-rs/diesel/issues/events/2356534722","actor":{"login":"weiznich","id":1674512,"node_id":"MDQ6VXNlcjE2NzQ1MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1674512?v=4","gravatar_id":"","url":"https://api.github.com/users/weiznich","html_url":"https://github.com/weiznich","followers_url":"https://api.github.com/users/weiznich/followers","following_url":"https://api.github.com/users/weiznich/following{/other_user}","gists_url":"https://api.github.com/users/weiznich/gists{/gist_id}","starred_url":"https://api.github.com/users/weiznich/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weiznich/subscriptions","organizations_url":"https://api.github.com/users/weiznich/orgs","repos_url":"https://api.github.com/users/weiznich/repos","events_url":"https://api.github.com/users/weiznich/events{/privacy}","received_events_url":"https://api.github.com/users/weiznich/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2019-05-21T15:15:37Z","label":{"name":"assigned","color":"0e8a16"},"performed_via_github_app":null},{"id":2356534723,"node_id":"MDEyOkxhYmVsZWRFdmVudDIzNTY1MzQ3MjM=","url":"https://api.github.com/repos/diesel-rs/diesel/issues/events/2356534723","actor":{"login":"weiznich","id":1674512,"node_id":"MDQ6VXNlcjE2NzQ1MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1674512?v=4","gravatar_id":"","url":"https://api.github.com/users/weiznich","html_url":"https://github.com/weiznich","followers_url":"https://api.github.com/users/weiznich/followers","following_url":"https://api.github.com/users/weiznich/following{/other_user}","gists_url":"https://api.github.com/users/weiznich/gists{/gist_id}","starred_url":"https://api.github.com/users/weiznich/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weiznich/subscriptions","organizations_url":"https://api.github.com/users/weiznich/orgs","repos_url":"https://api.github.com/users/weiznich/repos","events_url":"https://api.github.com/users/weiznich/events{/privacy}","received_events_url":"https://api.github.com/users/weiznich/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2019-05-21T15:15:37Z","label":{"name":"help wanted","color":"159818"},"performed_via_github_app":null},{"id":2356534725,"node_id":"MDEyOkxhYmVsZWRFdmVudDIzNTY1MzQ3MjU=","url":"https://api.github.com/repos/diesel-rs/diesel/issues/events/2356534725","actor":{"login":"weiznich","id":1674512,"node_id":"MDQ6VXNlcjE2NzQ1MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1674512?v=4","gravatar_id":"","url":"https://api.github.com/users/weiznich","html_url":"https://github.com/weiznich","followers_url":"https://api.github.com/users/weiznich/followers","following_url":"https://api.github.com/users/weiznich/following{/other_user}","gists_url":"https://api.github.com/users/weiznich/gists{/gist_id}","starred_url":"https://api.github.com/users/weiznich/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weiznich/subscriptions","organizations_url":"https://api.github.com/users/weiznich/orgs","repos_url":"https://api.github.com/users/weiznich/repos","events_url":"https://api.github.com/users/weiznich/events{/privacy}","received_events_url":"https://api.github.com/users/weiznich/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2019-05-21T15:15:37Z","label":{"name":"mentoring available","color":"0e8a16"},"performed_via_github_app":null},{"id":2356534726,"node_id":"MDEyOkxhYmVsZWRFdmVudDIzNTY1MzQ3MjY=","url":"https://api.github.com/repos/diesel-rs/diesel/issues/events/2356534726","actor":{"login":"weiznich","id":1674512,"node_id":"MDQ6VXNlcjE2NzQ1MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1674512?v=4","gravatar_id":"","url":"https://api.github.com/users/weiznich","html_url":"https://github.com/weiznich","followers_url":"https://api.github.com/users/weiznich/followers","following_url":"https://api.github.com/users/weiznich/following{/other_user}","gists_url":"https://api.github.com/users/weiznich/gists{/gist_id}","starred_url":"https://api.github.com/users/weiznich/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weiznich/subscriptions","organizations_url":"https://api.github.com/users/weiznich/orgs","repos_url":"https://api.github.com/users/weiznich/repos","events_url":"https://api.github.com/users/weiznich/events{/privacy}","received_events_url":"https://api.github.com/users/weiznich/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2019-05-21T15:15:37Z","label":{"name":"postgres","color":"c5def5"},"performed_via_github_app":null},{"id":2391717535,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDIzOTE3MTc1MzU=","url":"https://api.github.com/repos/diesel-rs/diesel/issues/events/2391717535","actor":{"login":"Ten0","id":9094255,"node_id":"MDQ6VXNlcjkwOTQyNTU=","avatar_url":"https://avatars.githubusercontent.com/u/9094255?v=4","gravatar_id":"","url":"https://api.github.com/users/Ten0","html_url":"https://github.com/Ten0","followers_url":"https://api.github.com/users/Ten0/followers","following_url":"https://api.github.com/users/Ten0/following{/other_user}","gists_url":"https://api.github.com/users/Ten0/gists{/gist_id}","starred_url":"https://api.github.com/users/Ten0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Ten0/subscriptions","organizations_url":"https://api.github.com/users/Ten0/orgs","repos_url":"https://api.github.com/users/Ten0/repos","events_url":"https://api.github.com/users/Ten0/events{/privacy}","received_events_url":"https://api.github.com/users/Ten0/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"c58154190ad7a2d273b02872715f81d01066cd28","commit_url":"https://api.github.com/repos/Ten0/diesel/commits/c58154190ad7a2d273b02872715f81d01066cd28","created_at":"2019-06-05T15:55:50Z","performed_via_github_app":null},{"actor":{"login":"Ten0","id":9094255,"node_id":"MDQ6VXNlcjkwOTQyNTU=","avatar_url":"https://avatars.githubusercontent.com/u/9094255?v=4","gravatar_id":"","url":"https://api.github.com/users/Ten0","html_url":"https://github.com/Ten0","followers_url":"https://api.github.com/users/Ten0/followers","following_url":"https://api.github.com/users/Ten0/following{/other_user}","gists_url":"https://api.github.com/users/Ten0/gists{/gist_id}","starred_url":"https://api.github.com/users/Ten0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Ten0/subscriptions","organizations_url":"https://api.github.com/users/Ten0/orgs","repos_url":"https://api.github.com/users/Ten0/repos","events_url":"https://api.github.com/users/Ten0/events{/privacy}","received_events_url":"https://api.github.com/users/Ten0/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-05T15:58:42Z","updated_at":"2019-06-05T15:58:42Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/2088","repository_url":"https://api.github.com/repos/diesel-rs/diesel","labels_url":"https://api.github.com/repos/diesel-rs/diesel/issues/2088/labels{/name}","comments_url":"https://api.github.com/repos/diesel-rs/diesel/issues/2088/comments","events_url":"https://api.github.com/repos/diesel-rs/diesel/issues/2088/events","html_url":"https://github.com/diesel-rs/diesel/pull/2088","id":452584331,"node_id":"MDExOlB1bGxSZXF1ZXN0Mjg1NDQyNjQz","number":2088,"title":"Cache custom types OIDs on Postgres","user":{"login":"Ten0","id":9094255,"node_id":"MDQ6VXNlcjkwOTQyNTU=","avatar_url":"https://avatars.githubusercontent.com/u/9094255?v=4","gravatar_id":"","url":"https://api.github.com/users/Ten0","html_url":"https://github.com/Ten0","followers_url":"https://api.github.com/users/Ten0/followers","following_url":"https://api.github.com/users/Ten0/following{/other_user}","gists_url":"https://api.github.com/users/Ten0/gists{/gist_id}","starred_url":"https://api.github.com/users/Ten0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Ten0/subscriptions","organizations_url":"https://api.github.com/users/Ten0/orgs","repos_url":"https://api.github.com/users/Ten0/repos","events_url":"https://api.github.com/users/Ten0/events{/privacy}","received_events_url":"https://api.github.com/users/Ten0/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-06-05T15:58:42Z","updated_at":"2020-04-20T14:22:24Z","closed_at":"2019-06-07T07:57:23Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":41609775,"node_id":"MDEwOlJlcG9zaXRvcnk0MTYwOTc3NQ==","name":"diesel","full_name":"diesel-rs/diesel","private":false,"owner":{"login":"diesel-rs","id":16763251,"node_id":"MDEyOk9yZ2FuaXphdGlvbjE2NzYzMjUx","avatar_url":"https://avatars.githubusercontent.com/u/16763251?v=4","gravatar_id":"","url":"https://api.github.com/users/diesel-rs","html_url":"https://github.com/diesel-rs","followers_url":"https://api.github.com/users/diesel-rs/followers","following_url":"https://api.github.com/users/diesel-rs/following{/other_user}","gists_url":"https://api.github.com/users/diesel-rs/gists{/gist_id}","starred_url":"https://api.github.com/users/diesel-rs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/diesel-rs/subscriptions","organizations_url":"https://api.github.com/users/diesel-rs/orgs","repos_url":"https://api.github.com/users/diesel-rs/repos","events_url":"https://api.github.com/users/diesel-rs/events{/privacy}","received_events_url":"https://api.github.com/users/diesel-rs/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/diesel-rs/diesel","description":"A safe, extensible ORM and Query Builder for Rust","fork":false,"url":"https://api.github.com/repos/diesel-rs/diesel","forks_url":"https://api.github.com/repos/diesel-rs/diesel/forks","keys_url":"https://api.github.com/repos/diesel-rs/diesel/keys{/key_id}","collaborators_url":"https://api.github.com/repos/diesel-rs/diesel/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/diesel-rs/diesel/teams","hooks_url":"https://api.github.com/repos/diesel-rs/diesel/hooks","issue_events_url":"https://api.github.com/repos/diesel-rs/diesel/issues/events{/number}","events_url":"https://api.github.com/repos/diesel-rs/diesel/events","assignees_url":"https://api.github.com/repos/diesel-rs/diesel/assignees{/user}","branches_url":"https://api.github.com/repos/diesel-rs/diesel/branches{/branch}","tags_url":"https://api.github.com/repos/diesel-rs/diesel/tags","blobs_url":"https://api.github.com/repos/diesel-rs/diesel/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/diesel-rs/diesel/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/diesel-rs/diesel/git/refs{/sha}","trees_url":"https://api.github.com/repos/diesel-rs/diesel/git/trees{/sha}","statuses_url":"https://api.github.com/repos/diesel-rs/diesel/statuses/{sha}","languages_url":"https://api.github.com/repos/diesel-rs/diesel/languages","stargazers_url":"https://api.github.com/repos/diesel-rs/diesel/stargazers","contributors_url":"https://api.github.com/repos/diesel-rs/diesel/contributors","subscribers_url":"https://api.github.com/repos/diesel-rs/diesel/subscribers","subscription_url":"https://api.github.com/repos/diesel-rs/diesel/subscription","commits_url":"https://api.github.com/repos/diesel-rs/diesel/commits{/sha}","git_commits_url":"https://api.github.com/repos/diesel-rs/diesel/git/commits{/sha}","comments_url":"https://api.github.com/repos/diesel-rs/diesel/comments{/number}","issue_comment_url":"https://api.github.com/repos/diesel-rs/diesel/issues/comments{/number}","contents_url":"https://api.github.com/repos/diesel-rs/diesel/contents/{+path}","compare_url":"https://api.github.com/repos/diesel-rs/diesel/compare/{base}...{head}","merges_url":"https://api.github.com/repos/diesel-rs/diesel/merges","archive_url":"https://api.github.com/repos/diesel-rs/diesel/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/diesel-rs/diesel/downloads","issues_url":"https://api.github.com/repos/diesel-rs/diesel/issues{/number}","pulls_url":"https://api.github.com/repos/diesel-rs/diesel/pulls{/number}","milestones_url":"https://api.github.com/repos/diesel-rs/diesel/milestones{/number}","notifications_url":"https://api.github.com/repos/diesel-rs/diesel/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/diesel-rs/diesel/labels{/name}","releases_url":"https://api.github.com/repos/diesel-rs/diesel/releases{/id}","deployments_url":"https://api.github.com/repos/diesel-rs/diesel/deployments","created_at":"2015-08-29T22:51:00Z","updated_at":"2025-11-09T19:31:55Z","pushed_at":"2025-11-07T18:13:31Z","git_url":"git://github.com/diesel-rs/diesel.git","ssh_url":"git@github.com:diesel-rs/diesel.git","clone_url":"https://github.com/diesel-rs/diesel.git","svn_url":"https://github.com/diesel-rs/diesel","homepage":"https://diesel.rs","size":109357,"stargazers_count":13771,"watchers_count":13771,"language":"Rust","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":true,"has_discussions":true,"forks_count":1168,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":153,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["mysql","orm","postgresql","query-builder","rust","sqlite"],"visibility":"public","forks":1168,"open_issues":153,"watchers":13771,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/diesel-rs/diesel/pulls/2088","html_url":"https://github.com/diesel-rs/diesel/pull/2088","diff_url":"https://github.com/diesel-rs/diesel/pull/2088.diff","patch_url":"https://github.com/diesel-rs/diesel/pull/2088.patch","merged_at":"2019-06-07T07:57:23Z"},"body":"Resolves #2071\r\n\r\nThis avoids sending one query per custom type bind, which caused a lot of back and forth to the database when inserting a large numbers of lines that used a custom type.\r\n\r\nNote: The implementation was also discussed on the issue (#2071).","reactions":{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/2088/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/diesel-rs/diesel/issues/2088/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":2396520643,"node_id":"MDExOkNsb3NlZEV2ZW50MjM5NjUyMDY0Mw==","url":"https://api.github.com/repos/diesel-rs/diesel/issues/events/2396520643","actor":{"login":"weiznich","id":1674512,"node_id":"MDQ6VXNlcjE2NzQ1MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1674512?v=4","gravatar_id":"","url":"https://api.github.com/users/weiznich","html_url":"https://github.com/weiznich","followers_url":"https://api.github.com/users/weiznich/followers","following_url":"https://api.github.com/users/weiznich/following{/other_user}","gists_url":"https://api.github.com/users/weiznich/gists{/gist_id}","starred_url":"https://api.github.com/users/weiznich/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weiznich/subscriptions","organizations_url":"https://api.github.com/users/weiznich/orgs","repos_url":"https://api.github.com/users/weiznich/repos","events_url":"https://api.github.com/users/weiznich/events{/privacy}","received_events_url":"https://api.github.com/users/weiznich/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2019-06-07T07:57:23Z","state_reason":null,"performed_via_github_app":null},{"actor":{"login":"weiznich","id":1674512,"node_id":"MDQ6VXNlcjE2NzQ1MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1674512?v=4","gravatar_id":"","url":"https://api.github.com/users/weiznich","html_url":"https://github.com/weiznich","followers_url":"https://api.github.com/users/weiznich/followers","following_url":"https://api.github.com/users/weiznich/following{/other_user}","gists_url":"https://api.github.com/users/weiznich/gists{/gist_id}","starred_url":"https://api.github.com/users/weiznich/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weiznich/subscriptions","organizations_url":"https://api.github.com/users/weiznich/orgs","repos_url":"https://api.github.com/users/weiznich/repos","events_url":"https://api.github.com/users/weiznich/events{/privacy}","received_events_url":"https://api.github.com/users/weiznich/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-28T12:21:00Z","updated_at":"2020-07-28T12:21:00Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/2469","repository_url":"https://api.github.com/repos/diesel-rs/diesel","labels_url":"https://api.github.com/repos/diesel-rs/diesel/issues/2469/labels{/name}","comments_url":"https://api.github.com/repos/diesel-rs/diesel/issues/2469/comments","events_url":"https://api.github.com/repos/diesel-rs/diesel/issues/2469/events","html_url":"https://github.com/diesel-rs/diesel/issues/2469","id":667023615,"node_id":"MDU6SXNzdWU2NjcwMjM2MTU=","number":2469,"title":"How to properly implement HasSqlType::metadata for a custom type?","user":{"login":"frol","id":304265,"node_id":"MDQ6VXNlcjMwNDI2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/304265?v=4","gravatar_id":"","url":"https://api.github.com/users/frol","html_url":"https://github.com/frol","followers_url":"https://api.github.com/users/frol/followers","following_url":"https://api.github.com/users/frol/following{/other_user}","gists_url":"https://api.github.com/users/frol/gists{/gist_id}","starred_url":"https://api.github.com/users/frol/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/frol/subscriptions","organizations_url":"https://api.github.com/users/frol/orgs","repos_url":"https://api.github.com/users/frol/repos","events_url":"https://api.github.com/users/frol/events{/privacy}","received_events_url":"https://api.github.com/users/frol/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-07-28T12:12:34Z","updated_at":"2020-07-28T12:21:00Z","closed_at":"2020-07-28T12:21:00Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":41609775,"node_id":"MDEwOlJlcG9zaXRvcnk0MTYwOTc3NQ==","name":"diesel","full_name":"diesel-rs/diesel","private":false,"owner":{"login":"diesel-rs","id":16763251,"node_id":"MDEyOk9yZ2FuaXphdGlvbjE2NzYzMjUx","avatar_url":"https://avatars.githubusercontent.com/u/16763251?v=4","gravatar_id":"","url":"https://api.github.com/users/diesel-rs","html_url":"https://github.com/diesel-rs","followers_url":"https://api.github.com/users/diesel-rs/followers","following_url":"https://api.github.com/users/diesel-rs/following{/other_user}","gists_url":"https://api.github.com/users/diesel-rs/gists{/gist_id}","starred_url":"https://api.github.com/users/diesel-rs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/diesel-rs/subscriptions","organizations_url":"https://api.github.com/users/diesel-rs/orgs","repos_url":"https://api.github.com/users/diesel-rs/repos","events_url":"https://api.github.com/users/diesel-rs/events{/privacy}","received_events_url":"https://api.github.com/users/diesel-rs/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/diesel-rs/diesel","description":"A safe, extensible ORM and Query Builder for Rust","fork":false,"url":"https://api.github.com/repos/diesel-rs/diesel","forks_url":"https://api.github.com/repos/diesel-rs/diesel/forks","keys_url":"https://api.github.com/repos/diesel-rs/diesel/keys{/key_id}","collaborators_url":"https://api.github.com/repos/diesel-rs/diesel/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/diesel-rs/diesel/teams","hooks_url":"https://api.github.com/repos/diesel-rs/diesel/hooks","issue_events_url":"https://api.github.com/repos/diesel-rs/diesel/issues/events{/number}","events_url":"https://api.github.com/repos/diesel-rs/diesel/events","assignees_url":"https://api.github.com/repos/diesel-rs/diesel/assignees{/user}","branches_url":"https://api.github.com/repos/diesel-rs/diesel/branches{/branch}","tags_url":"https://api.github.com/repos/diesel-rs/diesel/tags","blobs_url":"https://api.github.com/repos/diesel-rs/diesel/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/diesel-rs/diesel/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/diesel-rs/diesel/git/refs{/sha}","trees_url":"https://api.github.com/repos/diesel-rs/diesel/git/trees{/sha}","statuses_url":"https://api.github.com/repos/diesel-rs/diesel/statuses/{sha}","languages_url":"https://api.github.com/repos/diesel-rs/diesel/languages","stargazers_url":"https://api.github.com/repos/diesel-rs/diesel/stargazers","contributors_url":"https://api.github.com/repos/diesel-rs/diesel/contributors","subscribers_url":"https://api.github.com/repos/diesel-rs/diesel/subscribers","subscription_url":"https://api.github.com/repos/diesel-rs/diesel/subscription","commits_url":"https://api.github.com/repos/diesel-rs/diesel/commits{/sha}","git_commits_url":"https://api.github.com/repos/diesel-rs/diesel/git/commits{/sha}","comments_url":"https://api.github.com/repos/diesel-rs/diesel/comments{/number}","issue_comment_url":"https://api.github.com/repos/diesel-rs/diesel/issues/comments{/number}","contents_url":"https://api.github.com/repos/diesel-rs/diesel/contents/{+path}","compare_url":"https://api.github.com/repos/diesel-rs/diesel/compare/{base}...{head}","merges_url":"https://api.github.com/repos/diesel-rs/diesel/merges","archive_url":"https://api.github.com/repos/diesel-rs/diesel/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/diesel-rs/diesel/downloads","issues_url":"https://api.github.com/repos/diesel-rs/diesel/issues{/number}","pulls_url":"https://api.github.com/repos/diesel-rs/diesel/pulls{/number}","milestones_url":"https://api.github.com/repos/diesel-rs/diesel/milestones{/number}","notifications_url":"https://api.github.com/repos/diesel-rs/diesel/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/diesel-rs/diesel/labels{/name}","releases_url":"https://api.github.com/repos/diesel-rs/diesel/releases{/id}","deployments_url":"https://api.github.com/repos/diesel-rs/diesel/deployments","created_at":"2015-08-29T22:51:00Z","updated_at":"2025-11-09T19:31:55Z","pushed_at":"2025-11-07T18:13:31Z","git_url":"git://github.com/diesel-rs/diesel.git","ssh_url":"git@github.com:diesel-rs/diesel.git","clone_url":"https://github.com/diesel-rs/diesel.git","svn_url":"https://github.com/diesel-rs/diesel","homepage":"https://diesel.rs","size":109357,"stargazers_count":13771,"watchers_count":13771,"language":"Rust","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":true,"has_discussions":true,"forks_count":1168,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":153,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["mysql","orm","postgresql","query-builder","rust","sqlite"],"visibility":"public","forks":1168,"open_issues":153,"watchers":13771,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"## Setup\r\n\r\ndiesel with diesel-derive-enum (it just helped to uncover the issue)\r\n\r\n### Versions\r\n\r\n- **Rust**: nightly-2020-05-15 (irrelevant)\r\n- **Diesel**: 1.4.5\r\n- **Database**: PostgreSQL\r\n- **Operating System**: Arch Linux\r\n\r\n### Feature Flags\r\n\r\n- **diesel**: \"postgres\", \"numeric\", \"serde_json\"\r\n\r\n## Problem Description\r\n\r\nWorking on a project using [`diesel-derive-enum`](https://github.com/adwhit/diesel-derive-enum) I discovered that diesel queries take too long to execute. [After some digging](https://github.com/adwhit/diesel-derive-enum/issues/52) I learned that diesel-derive-enum does runtime lookups for the enum types on PostgreSQL, and it does that for every single entry, so a single INSERT statement with 20 records produces 20 pre-flight lookups before a single query. \r\n\r\n### What are you trying to accomplish?\r\n\r\nShould diesel-derive-enum implement caching or what is the proposed solution to this issue? Replacing the runtime lookup with a constant value where `oid` and `array_oid` are zeros did not bring any issues for SELECT, UPDATE, and INSERT statements, so I wonder if diesel needs that information at all for such types of queries.\r\n\r\n### What is the expected output?\r\n\r\nI expect a single `insert_into` execution to produce a single `INSERT INTO` statement.\r\n\r\n### What is the actual output?\r\n\r\nA single `insert_into` execution may lead to N pre-flight lookup queries from custom types implementing HasSqlType::metadata.\r\n\r\n## Checklist\r\n\r\n- [x] I have already looked over the [issue tracker](https://github.com/diesel-rs/diesel/issues) for similar issues.\r\n- [x] This issue can be reproduced on Rust's stable channel. (Your issue will be closed if this is not the case)","reactions":{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/2469/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/diesel-rs/diesel/issues/2469/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"id":4043925503,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDQwNDM5MjU1MDM=","url":"https://api.github.com/repos/diesel-rs/diesel/issues/events/4043925503","actor":{"login":"disconsented","id":1381469,"node_id":"MDQ6VXNlcjEzODE0Njk=","avatar_url":"https://avatars.githubusercontent.com/u/1381469?v=4","gravatar_id":"","url":"https://api.github.com/users/disconsented","html_url":"https://github.com/disconsented","followers_url":"https://api.github.com/users/disconsented/followers","following_url":"https://api.github.com/users/disconsented/following{/other_user}","gists_url":"https://api.github.com/users/disconsented/gists{/gist_id}","starred_url":"https://api.github.com/users/disconsented/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/disconsented/subscriptions","organizations_url":"https://api.github.com/users/disconsented/orgs","repos_url":"https://api.github.com/users/disconsented/repos","events_url":"https://api.github.com/users/disconsented/events{/privacy}","received_events_url":"https://api.github.com/users/disconsented/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"42a46c46e7b2c939db61d73194b302adee33f674","commit_url":"https://api.github.com/repos/NarrativeApp/diesel/commits/42a46c46e7b2c939db61d73194b302adee33f674","created_at":"2020-11-26T21:41:50Z","performed_via_github_app":null},{"actor":{"login":"davepacheco","id":532688,"node_id":"MDQ6VXNlcjUzMjY4OA==","avatar_url":"https://avatars.githubusercontent.com/u/532688?v=4","gravatar_id":"","url":"https://api.github.com/users/davepacheco","html_url":"https://github.com/davepacheco","followers_url":"https://api.github.com/users/davepacheco/followers","following_url":"https://api.github.com/users/davepacheco/following{/other_user}","gists_url":"https://api.github.com/users/davepacheco/gists{/gist_id}","starred_url":"https://api.github.com/users/davepacheco/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davepacheco/subscriptions","organizations_url":"https://api.github.com/users/davepacheco/orgs","repos_url":"https://api.github.com/users/davepacheco/repos","events_url":"https://api.github.com/users/davepacheco/events{/privacy}","received_events_url":"https://api.github.com/users/davepacheco/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-18T23:35:28Z","updated_at":"2024-04-18T23:35:28Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/oxidecomputer/omicron/issues/5561","repository_url":"https://api.github.com/repos/oxidecomputer/omicron","labels_url":"https://api.github.com/repos/oxidecomputer/omicron/issues/5561/labels{/name}","comments_url":"https://api.github.com/repos/oxidecomputer/omicron/issues/5561/comments","events_url":"https://api.github.com/repos/oxidecomputer/omicron/issues/5561/events","html_url":"https://github.com/oxidecomputer/omicron/issues/5561","id":2251297506,"node_id":"I_kwDODjhzlc6GMBLi","number":5561,"title":"nexus oid cache is broken across schema migrations","user":{"login":"davepacheco","id":532688,"node_id":"MDQ6VXNlcjUzMjY4OA==","avatar_url":"https://avatars.githubusercontent.com/u/532688?v=4","gravatar_id":"","url":"https://api.github.com/users/davepacheco","html_url":"https://github.com/davepacheco","followers_url":"https://api.github.com/users/davepacheco/followers","following_url":"https://api.github.com/users/davepacheco/following{/other_user}","gists_url":"https://api.github.com/users/davepacheco/gists{/gist_id}","starred_url":"https://api.github.com/users/davepacheco/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davepacheco/subscriptions","organizations_url":"https://api.github.com/users/davepacheco/orgs","repos_url":"https://api.github.com/users/davepacheco/repos","events_url":"https://api.github.com/users/davepacheco/events{/privacy}","received_events_url":"https://api.github.com/users/davepacheco/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2024-04-18T18:25:25Z","updated_at":"2024-04-24T17:00:16Z","closed_at":"2024-04-24T17:00:15Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":238580629,"node_id":"MDEwOlJlcG9zaXRvcnkyMzg1ODA2Mjk=","name":"omicron","full_name":"oxidecomputer/omicron","private":false,"owner":{"login":"oxidecomputer","id":54040662,"node_id":"MDEyOk9yZ2FuaXphdGlvbjU0MDQwNjYy","avatar_url":"https://avatars.githubusercontent.com/u/54040662?v=4","gravatar_id":"","url":"https://api.github.com/users/oxidecomputer","html_url":"https://github.com/oxidecomputer","followers_url":"https://api.github.com/users/oxidecomputer/followers","following_url":"https://api.github.com/users/oxidecomputer/following{/other_user}","gists_url":"https://api.github.com/users/oxidecomputer/gists{/gist_id}","starred_url":"https://api.github.com/users/oxidecomputer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oxidecomputer/subscriptions","organizations_url":"https://api.github.com/users/oxidecomputer/orgs","repos_url":"https://api.github.com/users/oxidecomputer/repos","events_url":"https://api.github.com/users/oxidecomputer/events{/privacy}","received_events_url":"https://api.github.com/users/oxidecomputer/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/oxidecomputer/omicron","description":"Omicron: Oxide control plane","fork":false,"url":"https://api.github.com/repos/oxidecomputer/omicron","forks_url":"https://api.github.com/repos/oxidecomputer/omicron/forks","keys_url":"https://api.github.com/repos/oxidecomputer/omicron/keys{/key_id}","collaborators_url":"https://api.github.com/repos/oxidecomputer/omicron/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/oxidecomputer/omicron/teams","hooks_url":"https://api.github.com/repos/oxidecomputer/omicron/hooks","issue_events_url":"https://api.github.com/repos/oxidecomputer/omicron/issues/events{/number}","events_url":"https://api.github.com/repos/oxidecomputer/omicron/events","assignees_url":"https://api.github.com/repos/oxidecomputer/omicron/assignees{/user}","branches_url":"https://api.github.com/repos/oxidecomputer/omicron/branches{/branch}","tags_url":"https://api.github.com/repos/oxidecomputer/omicron/tags","blobs_url":"https://api.github.com/repos/oxidecomputer/omicron/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/oxidecomputer/omicron/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/oxidecomputer/omicron/git/refs{/sha}","trees_url":"https://api.github.com/repos/oxidecomputer/omicron/git/trees{/sha}","statuses_url":"https://api.github.com/repos/oxidecomputer/omicron/statuses/{sha}","languages_url":"https://api.github.com/repos/oxidecomputer/omicron/languages","stargazers_url":"https://api.github.com/repos/oxidecomputer/omicron/stargazers","contributors_url":"https://api.github.com/repos/oxidecomputer/omicron/contributors","subscribers_url":"https://api.github.com/repos/oxidecomputer/omicron/subscribers","subscription_url":"https://api.github.com/repos/oxidecomputer/omicron/subscription","commits_url":"https://api.github.com/repos/oxidecomputer/omicron/commits{/sha}","git_commits_url":"https://api.github.com/repos/oxidecomputer/omicron/git/commits{/sha}","comments_url":"https://api.github.com/repos/oxidecomputer/omicron/comments{/number}","issue_comment_url":"https://api.github.com/repos/oxidecomputer/omicron/issues/comments{/number}","contents_url":"https://api.github.com/repos/oxidecomputer/omicron/contents/{+path}","compare_url":"https://api.github.com/repos/oxidecomputer/omicron/compare/{base}...{head}","merges_url":"https://api.github.com/repos/oxidecomputer/omicron/merges","archive_url":"https://api.github.com/repos/oxidecomputer/omicron/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/oxidecomputer/omicron/downloads","issues_url":"https://api.github.com/repos/oxidecomputer/omicron/issues{/number}","pulls_url":"https://api.github.com/repos/oxidecomputer/omicron/pulls{/number}","milestones_url":"https://api.github.com/repos/oxidecomputer/omicron/milestones{/number}","notifications_url":"https://api.github.com/repos/oxidecomputer/omicron/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/oxidecomputer/omicron/labels{/name}","releases_url":"https://api.github.com/repos/oxidecomputer/omicron/releases{/id}","deployments_url":"https://api.github.com/repos/oxidecomputer/omicron/deployments","created_at":"2020-02-06T01:04:16Z","updated_at":"2025-11-08T01:19:40Z","pushed_at":"2025-11-10T00:23:44Z","git_url":"git://github.com/oxidecomputer/omicron.git","ssh_url":"git@github.com:oxidecomputer/omicron.git","clone_url":"https://github.com/oxidecomputer/omicron.git","svn_url":"https://github.com/oxidecomputer/omicron","homepage":"","size":86593,"stargazers_count":365,"watchers_count":365,"language":"Rust","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":61,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":1269,"license":{"key":"mpl-2.0","name":"Mozilla Public License 2.0","spdx_id":"MPL-2.0","url":"https://api.github.com/licenses/mpl-2.0","node_id":"MDc6TGljZW5zZTE0"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["api"],"visibility":"public","forks":61,"open_issues":1269,"watchers":365,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"We updated dogfood today and ran into a new problem with instance provisions:\r\n\r\n```\r\nerror_message_internal = saga ACTION error at node \"sled_id\": unexpected database error: type with ID 218 does not exist\r\n```\r\n\r\nAfter some digging, it appears that Nexus's OID caching is hanging onto a stale value that was changed by the schema migration.  Namely, some sequence like this happens during the upgrade:\r\n\r\n- After mupdate, new Nexus starts up, establishes its connections to CockroachDB, and populates its OID cache (which maps enum types like `sled_resource_kind` to their numeric database [OID](https://www.postgresql.org/docs/current/datatype-oid.html)).\r\n- We run the schema migration that drops and re-creates the `sled_resource_kind` enum.  This invalidates the cache entry because now the name `sled_resource_kind` points to a different OID.\r\n- In whatever context Diesel uses that cache (which appears to include at least `INSERT` statements), it uses the old OID, which does not correspond to any existing type any more, and we get this error from the database.\r\n\r\nThe workaround is to restart Nexus instances after this happens because when they come back up they will re-populate their cache with the correct value.  The real fix will be to somehow invalidate this cache after schema migrations but we're still figuring out how to do that.","reactions":{"url":"https://api.github.com/repos/oxidecomputer/omicron/issues/5561/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/oxidecomputer/omicron/issues/5561/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"actor":{"login":"davepacheco","id":532688,"node_id":"MDQ6VXNlcjUzMjY4OA==","avatar_url":"https://avatars.githubusercontent.com/u/532688?v=4","gravatar_id":"","url":"https://api.github.com/users/davepacheco","html_url":"https://github.com/davepacheco","followers_url":"https://api.github.com/users/davepacheco/followers","following_url":"https://api.github.com/users/davepacheco/following{/other_user}","gists_url":"https://api.github.com/users/davepacheco/gists{/gist_id}","starred_url":"https://api.github.com/users/davepacheco/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davepacheco/subscriptions","organizations_url":"https://api.github.com/users/davepacheco/orgs","repos_url":"https://api.github.com/users/davepacheco/repos","events_url":"https://api.github.com/users/davepacheco/events{/privacy}","received_events_url":"https://api.github.com/users/davepacheco/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-19T04:02:51Z","updated_at":"2024-04-19T04:02:51Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/3995","repository_url":"https://api.github.com/repos/diesel-rs/diesel","labels_url":"https://api.github.com/repos/diesel-rs/diesel/issues/3995/labels{/name}","comments_url":"https://api.github.com/repos/diesel-rs/diesel/issues/3995/comments","events_url":"https://api.github.com/repos/diesel-rs/diesel/issues/3995/events","html_url":"https://github.com/diesel-rs/diesel/issues/3995","id":2252033978,"node_id":"I_kwDOAnrqL86GO0-6","number":3995,"title":"oid caching leads to broken queries after schema changes","user":{"login":"davepacheco","id":532688,"node_id":"MDQ6VXNlcjUzMjY4OA==","avatar_url":"https://avatars.githubusercontent.com/u/532688?v=4","gravatar_id":"","url":"https://api.github.com/users/davepacheco","html_url":"https://github.com/davepacheco","followers_url":"https://api.github.com/users/davepacheco/followers","following_url":"https://api.github.com/users/davepacheco/following{/other_user}","gists_url":"https://api.github.com/users/davepacheco/gists{/gist_id}","starred_url":"https://api.github.com/users/davepacheco/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davepacheco/subscriptions","organizations_url":"https://api.github.com/users/davepacheco/orgs","repos_url":"https://api.github.com/users/davepacheco/repos","events_url":"https://api.github.com/users/davepacheco/events{/privacy}","received_events_url":"https://api.github.com/users/davepacheco/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":254193212,"node_id":"MDU6TGFiZWwyNTQxOTMyMTI=","url":"https://api.github.com/repos/diesel-rs/diesel/labels/bug","name":"bug","color":"fc2929","default":true,"description":null},{"id":536100334,"node_id":"MDU6TGFiZWw1MzYxMDAzMzQ=","url":"https://api.github.com/repos/diesel-rs/diesel/labels/postgres","name":"postgres","color":"c5def5","default":false,"description":null}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2024-04-19T04:02:51Z","updated_at":"2024-06-08T06:05:18Z","closed_at":null,"author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":41609775,"node_id":"MDEwOlJlcG9zaXRvcnk0MTYwOTc3NQ==","name":"diesel","full_name":"diesel-rs/diesel","private":false,"owner":{"login":"diesel-rs","id":16763251,"node_id":"MDEyOk9yZ2FuaXphdGlvbjE2NzYzMjUx","avatar_url":"https://avatars.githubusercontent.com/u/16763251?v=4","gravatar_id":"","url":"https://api.github.com/users/diesel-rs","html_url":"https://github.com/diesel-rs","followers_url":"https://api.github.com/users/diesel-rs/followers","following_url":"https://api.github.com/users/diesel-rs/following{/other_user}","gists_url":"https://api.github.com/users/diesel-rs/gists{/gist_id}","starred_url":"https://api.github.com/users/diesel-rs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/diesel-rs/subscriptions","organizations_url":"https://api.github.com/users/diesel-rs/orgs","repos_url":"https://api.github.com/users/diesel-rs/repos","events_url":"https://api.github.com/users/diesel-rs/events{/privacy}","received_events_url":"https://api.github.com/users/diesel-rs/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/diesel-rs/diesel","description":"A safe, extensible ORM and Query Builder for Rust","fork":false,"url":"https://api.github.com/repos/diesel-rs/diesel","forks_url":"https://api.github.com/repos/diesel-rs/diesel/forks","keys_url":"https://api.github.com/repos/diesel-rs/diesel/keys{/key_id}","collaborators_url":"https://api.github.com/repos/diesel-rs/diesel/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/diesel-rs/diesel/teams","hooks_url":"https://api.github.com/repos/diesel-rs/diesel/hooks","issue_events_url":"https://api.github.com/repos/diesel-rs/diesel/issues/events{/number}","events_url":"https://api.github.com/repos/diesel-rs/diesel/events","assignees_url":"https://api.github.com/repos/diesel-rs/diesel/assignees{/user}","branches_url":"https://api.github.com/repos/diesel-rs/diesel/branches{/branch}","tags_url":"https://api.github.com/repos/diesel-rs/diesel/tags","blobs_url":"https://api.github.com/repos/diesel-rs/diesel/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/diesel-rs/diesel/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/diesel-rs/diesel/git/refs{/sha}","trees_url":"https://api.github.com/repos/diesel-rs/diesel/git/trees{/sha}","statuses_url":"https://api.github.com/repos/diesel-rs/diesel/statuses/{sha}","languages_url":"https://api.github.com/repos/diesel-rs/diesel/languages","stargazers_url":"https://api.github.com/repos/diesel-rs/diesel/stargazers","contributors_url":"https://api.github.com/repos/diesel-rs/diesel/contributors","subscribers_url":"https://api.github.com/repos/diesel-rs/diesel/subscribers","subscription_url":"https://api.github.com/repos/diesel-rs/diesel/subscription","commits_url":"https://api.github.com/repos/diesel-rs/diesel/commits{/sha}","git_commits_url":"https://api.github.com/repos/diesel-rs/diesel/git/commits{/sha}","comments_url":"https://api.github.com/repos/diesel-rs/diesel/comments{/number}","issue_comment_url":"https://api.github.com/repos/diesel-rs/diesel/issues/comments{/number}","contents_url":"https://api.github.com/repos/diesel-rs/diesel/contents/{+path}","compare_url":"https://api.github.com/repos/diesel-rs/diesel/compare/{base}...{head}","merges_url":"https://api.github.com/repos/diesel-rs/diesel/merges","archive_url":"https://api.github.com/repos/diesel-rs/diesel/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/diesel-rs/diesel/downloads","issues_url":"https://api.github.com/repos/diesel-rs/diesel/issues{/number}","pulls_url":"https://api.github.com/repos/diesel-rs/diesel/pulls{/number}","milestones_url":"https://api.github.com/repos/diesel-rs/diesel/milestones{/number}","notifications_url":"https://api.github.com/repos/diesel-rs/diesel/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/diesel-rs/diesel/labels{/name}","releases_url":"https://api.github.com/repos/diesel-rs/diesel/releases{/id}","deployments_url":"https://api.github.com/repos/diesel-rs/diesel/deployments","created_at":"2015-08-29T22:51:00Z","updated_at":"2025-11-09T19:31:55Z","pushed_at":"2025-11-07T18:13:31Z","git_url":"git://github.com/diesel-rs/diesel.git","ssh_url":"git@github.com:diesel-rs/diesel.git","clone_url":"https://github.com/diesel-rs/diesel.git","svn_url":"https://github.com/diesel-rs/diesel","homepage":"https://diesel.rs","size":109357,"stargazers_count":13771,"watchers_count":13771,"language":"Rust","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":true,"has_discussions":true,"forks_count":1168,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":153,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["mysql","orm","postgresql","query-builder","rust","sqlite"],"visibility":"public","forks":1168,"open_issues":153,"watchers":13771,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"All of the details asked for in the template below are specified in my reproducer https://github.com/davepacheco/diesel-oid.  I'll also fill it in as requested below but I think it'll be easier to just look at the reproducer.\r\n\r\n## Setup\r\n\r\n### Versions\r\n\r\n- **Rust:** 1.77.0\r\n- **Diesel:** 2.1.5\r\n- **Database:** PostgreSQL 16.2\r\n- **Operating System** MacOS Ventura 13.6.1\r\n\r\n### Feature Flags\r\n\r\n- **diesel:** default + \"postgres\"\r\n\r\n## Problem Description\r\n\r\nWe have a program that:\r\n\r\n- runs some queries that insert rows containing user-defined types\r\n- some other program runs a schema change that's compatible with the Diesel schema but changes the type's oid (i.e., drop the type and re-add it)\r\n- runs more of those queries\r\n\r\nAfter the schema change, such queries start failing with errors like `type with ID 218 does not exist` (CockroachDB) or `cache lookup failed for type 16455` (PostgreSQL)\r\n\r\nYou could argue that this is not supposed to work?  But restarting the application or executing the queries from new connections fixes the problem.  It's the stale cache in the Diesel connection that's broken and if it didn't cache the OIDs, I think the application would work.\r\n\r\nI don't know if PostgreSQL provides any way for Diesel to handle this without the application's help.  If not, how should an application deal with this?  Should the application have a way to disable caching?  Or maybe a way to communicate to Diesel that the cache needs to be flushed?\r\n\r\nTo make things more complicated, the application where we actually hit this proactively populates the Diesel cache with all of our user-defined types to avoid lots of tiny queries for very short-lived connections (our test suite).\r\n\r\nRelatedly: why is the cache per-connection?  We're using a connection pool.  So even if Diesel had a way to flush the cache and re-fill it, it's hard for us to go do that on every connection.  It'd be really nice if the cache were distributed via a `watch` channel or something where we could update a canonical copy and then propagate that out to all the consumers that want it.  I guess that might be hard if consumers need to modify it themselves as they run into new types that they need?\r\n\r\n### What are you trying to accomplish?\r\n\r\nWe're trying to manage an application where the database schema can change over time.  We're **not** yet doing online schema updates, in that we're not expecting the application to work seamlessly as the schema is updated.  We **do** expect that we can start the program, have it wait for the schema to match what the version that it understands, and then proceed.\r\n\r\nFirst, we store an integer version number for our schema in a database table.\r\n\r\nTo update our system to a new version of the software + schema, we do the following:\r\n\r\n- shut the application down (\"old\" application version, \"old\" schema version)\r\n- replace the application binaries on disk\r\n- start the application again (\"new\" application version)\r\n    - on startup, it checks the schema version.  It'll still be the old one.  It blocks, re-checking every few seconds until the version matches what's expected.\r\n- an operator executes a separate program to perform the schema update.\r\n    - this unblocks the application above\r\n\r\nOur problem is that Diesel may have cached some types' OIDs before the schema change.  If that happens, then the application is totally broken (lots of queries fail) after the schema change.\r\n\r\nFor much more detail, see oxidecomputer/omicron#5561.\r\n\r\n### What is the expected output?\r\n\r\nFor my reproducer, I expect no \"cache lookup failed\" error.\r\n\r\n### What is the actual output?\r\n\r\nFor my reproducer, I see the \"cache lookup failed\" error.\r\n\r\n### Are you seeing any additional errors?\r\n\r\nSee reproducer README or output below.\r\n\r\n### Steps to reproduce\r\n\r\n1. Set up PostgreSQL 16.2 (version probably doesn't matter much) running on 127.0.0.1 port 5432 with a database called `dap`.\r\n2. Clone https://github.com/davepacheco/diesel-oid.  This fully specifies the Rust version (rust-toolchain.toml) and dependencies (Cargo.lock).\r\n3. In `diesel-oid`, run `cargo run -- postgresql://127.0.0.1:5432/dap`.\r\n\r\nI see:\r\n\r\n```\r\n$ cargo run -- postgresql://127.0.0.1:5432/dap\r\n   Compiling diesel-oid v0.1.0 (/Users/dap/diesel-oid)\r\n    Finished dev [unoptimized + debuginfo] target(s) in 0.44s\r\n     Running `target/debug/diesel-oid 'postgresql://127.0.0.1:5432/dap'`\r\nconnecting to: postgresql://127.0.0.1:5432/dap\r\nconnected!\r\ninitialized schema\r\ninserted rows: 1\r\nfound rows: [MyTable { a: 0, b: One }]\r\nupdated schema\r\nERROR: second insert failed: cache lookup failed for type 16455\r\nestablishing second connection\r\nconnected!\r\ninsert on second connection worked: 1\r\ncontents of table after second insert (second conn):\r\nrows: [MyTable { a: 0, b: One }, MyTable { a: 0, b: One }]\r\ncontents of table after second insert (first conn):\r\nError: listing contents of table\r\n\r\nCaused by:\r\n    cached plan must not change result type\r\n```\r\n\r\nI'm **not** worried about \"cached plan must not change result type\" -- I get that one.  The problem is the \"cache lookup failed for type 16455\".  I think what's going on is:\r\n\r\n1. From one connection, we successfully INSERT a row into table my_table, which has a column of user-defined type my_type. This populates Diesels OID cache for the type my_type.\r\n2. Then we change the schema in a way thats compatible with the Diesel definition of that schema, but with a different OID (by dropping and re-creating the user-defined type).\r\n3. Then we try the INSERT again. It fails unexpectedly. It appears that whats happening is Diesel is sending the same OID as before, from its cache, but thats wrong now.\r\n4. To prove its just a caching issue: we create a second connection and do the same INSERT again. It works.\r\n\r\n## Checklist\r\n\r\n- [x] I have already looked over the [issue tracker](https://github.com/diesel-rs/diesel/issues) and the [discussion forum](https://github.com/diesel-rs/diesel/discussions) for similar possible closed issues.  (related issues: #2088, #2071, #2203)\r\n- [x] This issue can be reproduced on Rust's stable channel. (Your issue will be\r\n  closed if this is not the case)\r\n- [ ] This issue can be reproduced without requiring a third party crate\r\n\r\nI am not sure how to reproduce this without `diesel_derive_enum` but I do not believe it's related to the problem.","reactions":{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/3995/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/diesel-rs/diesel/issues/3995/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"}]