{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/1311","repository_url":"https://api.github.com/repos/diesel-rs/diesel","labels_url":"https://api.github.com/repos/diesel-rs/diesel/issues/1311/labels{/name}","comments_url":"https://api.github.com/repos/diesel-rs/diesel/issues/1311/comments","events_url":"https://api.github.com/repos/diesel-rs/diesel/issues/1311/events","html_url":"https://github.com/diesel-rs/diesel/issues/1311","id":276774406,"node_id":"MDU6SXNzdWUyNzY3NzQ0MDY=","number":1311,"title":"A less boilerplaty way of specifying a boxed `ORDER BY` with multiple clauses?","user":{"login":"blakepettersson","id":1227954,"node_id":"MDQ6VXNlcjEyMjc5NTQ=","avatar_url":"https://avatars.githubusercontent.com/u/1227954?v=4","gravatar_id":"","url":"https://api.github.com/users/blakepettersson","html_url":"https://github.com/blakepettersson","followers_url":"https://api.github.com/users/blakepettersson/followers","following_url":"https://api.github.com/users/blakepettersson/following{/other_user}","gists_url":"https://api.github.com/users/blakepettersson/gists{/gist_id}","starred_url":"https://api.github.com/users/blakepettersson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/blakepettersson/subscriptions","organizations_url":"https://api.github.com/users/blakepettersson/orgs","repos_url":"https://api.github.com/users/blakepettersson/repos","events_url":"https://api.github.com/users/blakepettersson/events{/privacy}","received_events_url":"https://api.github.com/users/blakepettersson/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/diesel-rs/diesel/milestones/13","html_url":"https://github.com/diesel-rs/diesel/milestone/13","labels_url":"https://api.github.com/repos/diesel-rs/diesel/milestones/13/labels","id":3036346,"node_id":"MDk6TWlsZXN0b25lMzAzNjM0Ng==","number":13,"title":"1.2","description":"","creator":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":12,"state":"closed","created_at":"2018-01-15T14:15:08Z","updated_at":"2018-04-10T19:17:13Z","due_on":"2018-02-15T08:00:00Z","closed_at":"2018-04-10T19:17:13Z"},"comments":9,"created_at":"2017-11-25T20:10:57Z","updated_at":"2022-08-24T09:52:47Z","closed_at":"2018-02-05T14:25:17Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\nIf you want to report a bug, we added some points below you can fill out. If you want to request a feature, feel free to remove all the irrelevant text. In addition to this [issue tracker](https://github.com/diesel-rs/diesel/issues), you can also talk to Diesel maintainers and users on [Gitter](https://gitter.im/diesel-rs/diesel).\r\n-->\r\n\r\n## Problem Description\r\n\r\nI have a use case where I want to dynamically set an order by clause via some request parameters. I have an example entity below, `Todo`:\r\n\r\n```rust\r\ninfer_schema!(\"dotenv:POSTGRES_URL\");\r\n\r\n#[derive(Debug, Default, Clone, PartialEq, Eq, Serialize, Deserialize, Queryable, Insertable, AsChangeset)]\r\n#[table_name = \"todos\"]\r\n#[changeset_options(treat_none_as_null = \"true\")]\r\npub struct Todo {\r\n    id: Uuid,\r\n    title: String,\r\n    body: Option<String>,\r\n    published: bool\r\n}\r\n```\r\n\r\nDoing a boxed query works fine:\r\n\r\n```rust\r\nuse std::env;\r\nuse dotenv::dotenv;\r\nuse diesel::pg::PgConnection;\r\nuse self::todos::dsl::todos as table;\r\nuse self::todos as column;\r\n\r\npub enum MyErr {\r\n    Diesel(diesel::result::Error),\r\n    TooManySortColumns(String),\r\n    InvalidParam(String)\r\n}\r\n\r\npub fn establish_connection() -> PgConnection {\r\n    dotenv().ok();\r\n\r\n    let database_url = env::var(\"POSTGRES_URL\").expect(\"POSTGRES_URL must be set\");\r\n    PgConnection::establish(&database_url)\r\n        .expect(&format!(\"Error connecting to {}\", database_url))\r\n}\r\n\r\nfn test(order_by: Vec<&str>) -> Result<Vec<Todo>, MyErr> {\r\n    let mut query = table.into_boxed();\r\n    let mut order_columns: Vec<Box<BoxableExpression<table, Pg, SqlType = ()>>> = Vec::new();\r\n\r\n    for order in &order_by {\r\n        match *order {\r\n            \"title\" => order_columns.push(Box::new(column::title.asc())),\r\n            \"body\" => order_columns.push(Box::new(column::body.asc())),\r\n            \"published\" => order_columns.push(Box::new(column::published.asc())),\r\n            other => return Err(MyErr::InvalidParam(other.to_string()))\r\n        }\r\n    }\r\n\r\n    match order_columns.len() {\r\n        1 => query = query.order(order_columns.remove(0)),\r\n        2 => query = query.order((order_columns.remove(0), order_columns.remove(0))),\r\n        3 => {\r\n            query = query.order((\r\n                order_columns.remove(0),\r\n                order_columns.remove(0),\r\n                order_columns.remove(0)\r\n            ))\r\n        }\r\n        _ => {\r\n            return Err(MyErr::TooManySortColumns(\"too many sort columns\".to_string()))\r\n        }\r\n    }\r\n\r\n    query.load::<Todo>(&establish_connection()).map_err(|e| MyErr::Diesel(e))\r\n}\r\n```\r\n\r\n### What are you trying to accomplish?\r\n\r\nWhile this works great, I was wondering if there's a simpler/shorter way of accomplishing the same thing. According to the [documentation](http://docs.diesel.rs/diesel/prelude/trait.OrderDsl.html#tymethod.order), an `order` clause will override any other order clause. Ideally I'd like an API that would work something like this, where any order clauses would be appended instead of replacing any previous order clauses:\r\n\r\n```rust\r\n    for order in &order_by {\r\n        match *order {\r\n            \"title\" => query = query.order(Box::new(column::title.asc())),\r\n            \"body\" => query = query.order(Box::new(column::body.asc())),\r\n            \"published\" => query = query.order(Box::new(column::published.asc())),\r\n            other => return Err(MyErr::InvalidParam(other.to_string()))\r\n        }\r\n    }\r\n``` \r\n\r\nIs there an API that already does this with Diesel, and/or would it be possible to achieve (with current Rust stable)? If it is hypothetically possible but not currently available, I'd be happy to look into this if someone can point me in the right way :)\r\n\r\n## Checklist\r\n\r\n- [x] I have already looked over the [issue tracker](https://github.com/diesel-rs/diesel/issues) for similar issues.\r\n\r\n<!--\r\nThank you for your submission!  You're helping make Diesel more robust ðŸŽ‰  \r\n\r\nWe'll try to respond as quickly as possible.\r\n-->\r\n","closed_by":{"login":"weiznich","id":1674512,"node_id":"MDQ6VXNlcjE2NzQ1MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1674512?v=4","gravatar_id":"","url":"https://api.github.com/users/weiznich","html_url":"https://github.com/weiznich","followers_url":"https://api.github.com/users/weiznich/followers","following_url":"https://api.github.com/users/weiznich/following{/other_user}","gists_url":"https://api.github.com/users/weiznich/gists{/gist_id}","starred_url":"https://api.github.com/users/weiznich/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weiznich/subscriptions","organizations_url":"https://api.github.com/users/weiznich/orgs","repos_url":"https://api.github.com/users/weiznich/repos","events_url":"https://api.github.com/users/weiznich/events{/privacy}","received_events_url":"https://api.github.com/users/weiznich/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/1311/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/diesel-rs/diesel/issues/1311/timeline","performed_via_github_app":null,"state_reason":"completed"}