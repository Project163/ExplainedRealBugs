{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/650","repository_url":"https://api.github.com/repos/diesel-rs/diesel","labels_url":"https://api.github.com/repos/diesel-rs/diesel/issues/650/labels{/name}","comments_url":"https://api.github.com/repos/diesel-rs/diesel/issues/650/comments","events_url":"https://api.github.com/repos/diesel-rs/diesel/issues/650/events","html_url":"https://github.com/diesel-rs/diesel/issues/650","id":206479159,"node_id":"MDU6SXNzdWUyMDY0NzkxNTk=","number":650,"title":"Provide a better \"raw sql\" escape hatch for full queries that we don't support in the query builder","user":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":254193215,"node_id":"MDU6TGFiZWwyNTQxOTMyMTU=","url":"https://api.github.com/repos/diesel-rs/diesel/labels/help%20wanted","name":"help wanted","color":"159818","default":true,"description":null},{"id":292827063,"node_id":"MDU6TGFiZWwyOTI4MjcwNjM=","url":"https://api.github.com/repos/diesel-rs/diesel/labels/discussion%20desired","name":"discussion desired","color":"bfd4f2","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/diesel-rs/diesel/milestones/4","html_url":"https://github.com/diesel-rs/diesel/milestone/4","labels_url":"https://api.github.com/repos/diesel-rs/diesel/milestones/4/labels","id":1440971,"node_id":"MDk6TWlsZXN0b25lMTQ0MDk3MQ==","number":4,"title":"1.0","description":"","creator":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":14,"state":"closed","created_at":"2015-12-02T23:00:09Z","updated_at":"2018-01-15T14:15:01Z","due_on":"2017-12-31T08:00:00Z","closed_at":"2018-01-15T14:15:01Z"},"comments":1,"created_at":"2017-02-09T11:37:57Z","updated_at":"2017-10-16T19:46:17Z","closed_at":"2017-10-16T19:46:17Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Today we have some form of an escape hatch in the form of the `sql` function. However, it's meant for use with small fragments, not full queries. It's limited because it requires specifying the full SQL type of the output, and cannot handle bind parameters. I'd like to introduce a new function that is a more ergonomic API for raw SQL as an escape hatch for queries we don't support in the query builder yet.\r\n\r\nUltimately I've resisted introducing this, as we want to support all possible safe queries in the query builder eventually, but I think we need a proper escape hatch for us to go 1.0.\r\n\r\nI'd like this API to be fully untyped, and named to make it clear that no verification of the query is occurring. For deserialization, it should not go through `Queryable`, as I do not think enforcing column order is ergonomic when writing raw SQL (and `Queryable` needs a SQL type to work). Instead I'd like to introduce an `UntypedQueryable`, which takes a row directly, and is able to fetch fields by name. I'm fine with the API requiring specifying the SQL type on this call if type inference can't pick it up. e.g. `let updated_at: NaiveDateTime = row.get::<Timestamp>(\"updated_at\")?`. I suspect for most types which only implement `FromSql` for a single DB type type inference will handle it, but we should explore our options here and see what feels best.\r\n\r\nI'm less clear what we should do with bind parameters. I do know that I don't want to go the route that the postgres crate went where we take `&[&UntypedToSql]`, as constructing that value is painful, it forces dynamic dispatch (which then usually also forces boxing), and requires `&[]` for queries with no bind parameters. We could potentially still pass tuples here as long as type inference does what we want. I also think `conn.raw_query(\"SELECT * FROM users WHERE id = $1\").bind(id)` could work (as an aside, I think we will likely need to pass the connection in before the bind parameters for this to work, which will lead to a semi-weird api of `conn.raw_query().bind().execute()`). I'm fine with also sometimes requiring giving a SQL type for the bind here as long as type inference is able to handle the most common cases.","closed_by":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/650/reactions","total_count":9,"+1":9,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/diesel-rs/diesel/issues/650/timeline","performed_via_github_app":null,"state_reason":"completed"}