[{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/comments/255518230","html_url":"https://github.com/diesel-rs/diesel/issues/485#issuecomment-255518230","issue_url":"https://api.github.com/repos/diesel-rs/diesel/issues/485","id":255518230,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NTUxODIzMA==","user":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-10-22T09:40:43Z","updated_at":"2016-10-22T09:40:43Z","body":"I _think_ this is a bug in the latest nightly, but I will investigate further.\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/comments/255518230/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/comments/255583441","html_url":"https://github.com/diesel-rs/diesel/issues/485#issuecomment-255583441","issue_url":"https://api.github.com/repos/diesel-rs/diesel/issues/485","id":255583441,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NTU4MzQ0MQ==","user":{"login":"oeb25","id":2669721,"node_id":"MDQ6VXNlcjI2Njk3MjE=","avatar_url":"https://avatars.githubusercontent.com/u/2669721?v=4","gravatar_id":"","url":"https://api.github.com/users/oeb25","html_url":"https://github.com/oeb25","followers_url":"https://api.github.com/users/oeb25/followers","following_url":"https://api.github.com/users/oeb25/following{/other_user}","gists_url":"https://api.github.com/users/oeb25/gists{/gist_id}","starred_url":"https://api.github.com/users/oeb25/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oeb25/subscriptions","organizations_url":"https://api.github.com/users/oeb25/orgs","repos_url":"https://api.github.com/users/oeb25/repos","events_url":"https://api.github.com/users/oeb25/events{/privacy}","received_events_url":"https://api.github.com/users/oeb25/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-10-23T11:29:39Z","updated_at":"2016-10-23T11:29:39Z","body":"FYI using the macro around the struct results in the same error eg.\n\n``` rust\n// src/models.rs\nQueryable! { struct Thing { ... } }\n```\n\n``` bash\nerror: `Queryable` is a derive mode\n --> src/models.rs:3:1\n  |\n3 | Queryable! { struct Thing { ... } }\n  | ^^^^^^^^^\n```\n\nhaving\n\n``` rust\n// src/lib.rs\nextern crate dotenv;\n\n#[macro_use] extern crate diesel;\n#[macro_use] extern crate diesel_codegen;\n\nuse diesel::prelude::*;\nuse diesel::pg::PgConnection;\nuse dotenv::dotenv;\nuse std::env;\n\npub mod schema;\npub mod models;\n```\n\nAny update on this? I read [jseyfried's comment on the issue on the rust repo](https://github.com/rust-lang/rust/issues/35900#issuecomment-255523500), but I'm not entirely sure what this means for Diesel.\n\nDoes this require a change in Diesel, user code or are we waiting for a fix in rust?\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/comments/255583441/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"oeb25","id":2669721,"node_id":"MDQ6VXNlcjI2Njk3MjE=","avatar_url":"https://avatars.githubusercontent.com/u/2669721?v=4","gravatar_id":"","url":"https://api.github.com/users/oeb25","html_url":"https://github.com/oeb25","followers_url":"https://api.github.com/users/oeb25/followers","following_url":"https://api.github.com/users/oeb25/following{/other_user}","gists_url":"https://api.github.com/users/oeb25/gists{/gist_id}","starred_url":"https://api.github.com/users/oeb25/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oeb25/subscriptions","organizations_url":"https://api.github.com/users/oeb25/orgs","repos_url":"https://api.github.com/users/oeb25/repos","events_url":"https://api.github.com/users/oeb25/events{/privacy}","received_events_url":"https://api.github.com/users/oeb25/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/comments/255996351","html_url":"https://github.com/diesel-rs/diesel/issues/485#issuecomment-255996351","issue_url":"https://api.github.com/repos/diesel-rs/diesel/issues/485","id":255996351,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NTk5NjM1MQ==","user":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-10-25T10:20:20Z","updated_at":"2016-10-25T10:20:20Z","body":"Any update on this? Just hit this bug.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/comments/255996351/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/comments/257149070","html_url":"https://github.com/diesel-rs/diesel/issues/485#issuecomment-257149070","issue_url":"https://api.github.com/repos/diesel-rs/diesel/issues/485","id":257149070,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NzE0OTA3MA==","user":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-10-30T12:47:21Z","updated_at":"2016-10-30T12:47:21Z","body":"I'm hoping to get this fixed upstream.\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/comments/257149070/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"jseyfried","id":8652869,"node_id":"MDQ6VXNlcjg2NTI4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/8652869?v=4","gravatar_id":"","url":"https://api.github.com/users/jseyfried","html_url":"https://github.com/jseyfried","followers_url":"https://api.github.com/users/jseyfried/followers","following_url":"https://api.github.com/users/jseyfried/following{/other_user}","gists_url":"https://api.github.com/users/jseyfried/gists{/gist_id}","starred_url":"https://api.github.com/users/jseyfried/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jseyfried/subscriptions","organizations_url":"https://api.github.com/users/jseyfried/orgs","repos_url":"https://api.github.com/users/jseyfried/repos","events_url":"https://api.github.com/users/jseyfried/events{/privacy}","received_events_url":"https://api.github.com/users/jseyfried/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-10-31T00:04:19Z","updated_at":"2016-10-31T00:04:19Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/rust-lang/rust/issues/35900","repository_url":"https://api.github.com/repos/rust-lang/rust","labels_url":"https://api.github.com/repos/rust-lang/rust/issues/35900/labels{/name}","comments_url":"https://api.github.com/repos/rust-lang/rust/issues/35900/comments","events_url":"https://api.github.com/repos/rust-lang/rust/issues/35900/events","html_url":"https://github.com/rust-lang/rust/issues/35900","id":172498288,"node_id":"MDU6SXNzdWUxNzI0OTgyODg=","number":35900,"title":"Tracking issue for \"Macros 1.1\" (RFC #1681)","user":{"login":"nikomatsakis","id":155238,"node_id":"MDQ6VXNlcjE1NTIzOA==","avatar_url":"https://avatars.githubusercontent.com/u/155238?v=4","gravatar_id":"","url":"https://api.github.com/users/nikomatsakis","html_url":"https://github.com/nikomatsakis","followers_url":"https://api.github.com/users/nikomatsakis/followers","following_url":"https://api.github.com/users/nikomatsakis/following{/other_user}","gists_url":"https://api.github.com/users/nikomatsakis/gists{/gist_id}","starred_url":"https://api.github.com/users/nikomatsakis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nikomatsakis/subscriptions","organizations_url":"https://api.github.com/users/nikomatsakis/orgs","repos_url":"https://api.github.com/users/nikomatsakis/repos","events_url":"https://api.github.com/users/nikomatsakis/events{/privacy}","received_events_url":"https://api.github.com/users/nikomatsakis/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":211668019,"node_id":"MDU6TGFiZWwyMTE2NjgwMTk=","url":"https://api.github.com/repos/rust-lang/rust/labels/T-lang","name":"T-lang","color":"bfd4f2","default":false,"description":"Relevant to the language team"},{"id":219670472,"node_id":"MDU6TGFiZWwyMTk2NzA0NzI=","url":"https://api.github.com/repos/rust-lang/rust/labels/final-comment-period","name":"final-comment-period","color":"1e76d9","default":false,"description":"In the final comment period and will be merged soon unless new substantive objections are raised."},{"id":246778137,"node_id":"MDU6TGFiZWwyNDY3NzgxMzc=","url":"https://api.github.com/repos/rust-lang/rust/labels/B-unstable","name":"B-unstable","color":"d304cb","default":false,"description":"Blocker: Implemented in the nightly compiler and unstable."},{"id":433146169,"node_id":"MDU6TGFiZWw0MzMxNDYxNjk=","url":"https://api.github.com/repos/rust-lang/rust/labels/B-RFC-implemented","name":"B-RFC-implemented","color":"d304cb","default":false,"description":"Blocker: Approved by a merged RFC and implemented but not stabilized."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":268,"created_at":"2016-08-22T16:37:11Z","updated_at":"2017-02-02T03:53:33Z","closed_at":"2017-01-04T22:08:13Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":724712,"node_id":"MDEwOlJlcG9zaXRvcnk3MjQ3MTI=","name":"rust","full_name":"rust-lang/rust","private":false,"owner":{"login":"rust-lang","id":5430905,"node_id":"MDEyOk9yZ2FuaXphdGlvbjU0MzA5MDU=","avatar_url":"https://avatars.githubusercontent.com/u/5430905?v=4","gravatar_id":"","url":"https://api.github.com/users/rust-lang","html_url":"https://github.com/rust-lang","followers_url":"https://api.github.com/users/rust-lang/followers","following_url":"https://api.github.com/users/rust-lang/following{/other_user}","gists_url":"https://api.github.com/users/rust-lang/gists{/gist_id}","starred_url":"https://api.github.com/users/rust-lang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rust-lang/subscriptions","organizations_url":"https://api.github.com/users/rust-lang/orgs","repos_url":"https://api.github.com/users/rust-lang/repos","events_url":"https://api.github.com/users/rust-lang/events{/privacy}","received_events_url":"https://api.github.com/users/rust-lang/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/rust-lang/rust","description":"Empowering everyone to build reliable and efficient software.","fork":false,"url":"https://api.github.com/repos/rust-lang/rust","forks_url":"https://api.github.com/repos/rust-lang/rust/forks","keys_url":"https://api.github.com/repos/rust-lang/rust/keys{/key_id}","collaborators_url":"https://api.github.com/repos/rust-lang/rust/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/rust-lang/rust/teams","hooks_url":"https://api.github.com/repos/rust-lang/rust/hooks","issue_events_url":"https://api.github.com/repos/rust-lang/rust/issues/events{/number}","events_url":"https://api.github.com/repos/rust-lang/rust/events","assignees_url":"https://api.github.com/repos/rust-lang/rust/assignees{/user}","branches_url":"https://api.github.com/repos/rust-lang/rust/branches{/branch}","tags_url":"https://api.github.com/repos/rust-lang/rust/tags","blobs_url":"https://api.github.com/repos/rust-lang/rust/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/rust-lang/rust/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/rust-lang/rust/git/refs{/sha}","trees_url":"https://api.github.com/repos/rust-lang/rust/git/trees{/sha}","statuses_url":"https://api.github.com/repos/rust-lang/rust/statuses/{sha}","languages_url":"https://api.github.com/repos/rust-lang/rust/languages","stargazers_url":"https://api.github.com/repos/rust-lang/rust/stargazers","contributors_url":"https://api.github.com/repos/rust-lang/rust/contributors","subscribers_url":"https://api.github.com/repos/rust-lang/rust/subscribers","subscription_url":"https://api.github.com/repos/rust-lang/rust/subscription","commits_url":"https://api.github.com/repos/rust-lang/rust/commits{/sha}","git_commits_url":"https://api.github.com/repos/rust-lang/rust/git/commits{/sha}","comments_url":"https://api.github.com/repos/rust-lang/rust/comments{/number}","issue_comment_url":"https://api.github.com/repos/rust-lang/rust/issues/comments{/number}","contents_url":"https://api.github.com/repos/rust-lang/rust/contents/{+path}","compare_url":"https://api.github.com/repos/rust-lang/rust/compare/{base}...{head}","merges_url":"https://api.github.com/repos/rust-lang/rust/merges","archive_url":"https://api.github.com/repos/rust-lang/rust/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/rust-lang/rust/downloads","issues_url":"https://api.github.com/repos/rust-lang/rust/issues{/number}","pulls_url":"https://api.github.com/repos/rust-lang/rust/pulls{/number}","milestones_url":"https://api.github.com/repos/rust-lang/rust/milestones{/number}","notifications_url":"https://api.github.com/repos/rust-lang/rust/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/rust-lang/rust/labels{/name}","releases_url":"https://api.github.com/repos/rust-lang/rust/releases{/id}","deployments_url":"https://api.github.com/repos/rust-lang/rust/deployments","created_at":"2010-06-16T20:39:03Z","updated_at":"2025-11-10T00:54:06Z","pushed_at":"2025-11-09T23:15:36Z","git_url":"git://github.com/rust-lang/rust.git","ssh_url":"git@github.com:rust-lang/rust.git","clone_url":"https://github.com/rust-lang/rust.git","svn_url":"https://github.com/rust-lang/rust","homepage":"https://www.rust-lang.org","size":804551,"stargazers_count":107736,"watchers_count":107736,"language":"Rust","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":13960,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":11735,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["compiler","language","rust"],"visibility":"public","forks":13960,"open_issues":11735,"watchers":107736,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"Tracking issue for rust-lang/rfcs#1681.\r\n\r\ncc @alexcrichton \r\n## Stabilization TODO\r\n\r\nLitmus tests:\r\n- [x] - Does diesel work? https://github.com/rust-lang/rust/issues/35900#issuecomment-251242313\r\n- [x] - Does serde work? https://users.rust-lang.org/t/serde-transitioning-to-macros-1-1/7437\r\n\r\nFeatures:\r\n- Crate name, currently is `proc_macro`\r\n- Crate type, currently `proc-macro`\r\n- The `#[proc_macro_derive(Foo)]` attribute \r\n- Loading `proc-macro` crates with `-L` and `#[macro_use]` to load them\r\n- shadowing is an error\r\n- no hygiene\r\n- passing a token stream for the entire struct and receiving it all back\r\n- Cargo manifest attribute, currently `proc-macro = true`\r\n\r\nKnown bugs:\r\n\r\n- [ ] - Panicking derive may have the wrong span - #36935\r\n- [ ] - token streams with `mod foo` fail - #36691\r\n- [ ] - docs aren't published for `proc_macro` - #38749\r\n- [x] - custom attributes for multiple modes is hard - https://github.com/rust-lang/rust/issues/35900#issuecomment-252499766\r\n- [x] - cargo test fails for proc macro libs - #37480\r\n- [x] - order still matters - https://github.com/rust-lang/rust/issues/35900#issuecomment-252430957 (fxed by https://github.com/rust-lang/rust/pull/37067)\r\n- [x] - Can't document rustc-macro crates - https://github.com/rust-lang/rust/issues/36820 (fixed in #36847)\r\n- [x] - Cargo rebuilds too often - https://github.com/rust-lang/rust/issues/36625 (fixed in https://github.com/rust-lang/rust/pull/36776)\r\n- [x] - Attributes generated by the compiler make custom derive authors' lives difficult - https://github.com/rust-lang/rust/issues/35900#issuecomment-245978831\r\n  - [x] - Change order of expansions to users-first - https://github.com/rust-lang/rust/issues/35900#issuecomment-246840357 (fixed in https://github.com/rust-lang/rust/pull/36782)\r\n## Implementation TODO\r\n- [x] - Create a `rustc_macro` crate\r\n  - [x] - Have `librustc_macro` link to `libsyntax`. Depend on `librustc_macro` in `librustc_driver`\r\n  - [x] - Tag `rustc_macro` as unstable with our [standard header](https://github.com/rust-lang/rust/blob/master/src/libsyntax/lib.rs#L17-L25).\r\n  - [x] - Only tag `rustc_macro` with `#![crate_type = \"rlib\"]`, do not produce a dylib.\r\n  - [x] - Implement [the API](https://github.com/rust-lang/rfcs/blob/master/text/1681-macros-1.1.md#librustc_macro) of `rustc_macro` using `libsyntax`'s `TokenStream` internally\r\n  - [x] - tag `rustc_macro` with a `TokenStream` lang item so the compiler knows about it.\r\n- [x] - Add `rustc_macro_derive` attribute\r\n  - [x] - validate it's of the exact form `foo(bar)`, no other arguments/formats\r\n  - [x] - verify it's only applied to functions\r\n  - [x] - verify it's only applied to functions in the root module\r\n  - [x]  - verify the signature with the `TokenStream` lang item added above\r\n  - [x] - encode all function symbols with `rustc_macro_derive` into metadata along with the derive mode they're used for.\r\n- [x] - Add a `rustc-macro` crate type for other crates\r\n  - [x] - wire it up to produce a dylib\r\n  - [x] - ensure the dylib gets metadata\r\n  - [x] - ensure `rustc-macro` crates **cannot be linked as dylibs**\r\n  - [x] - ensure there are no _reachable_ items other than those tagged with `#[rustc_macro_derive]`\r\n  - [x] - Add `cfg(rustc_macro)` as an unstable `cfg` directive, set it for the `rustc-macro` crate type\r\n  - [x] - ensure that `rustc-macro` crates link dynamically to libsytnax\r\n- [x] - Fill in `#[macro_use]` support for `rustc-macro` crates\r\n  - [x] - extend library loader to find `rustc-macro` crates separately from dylib/rlib tracked today when loding crates\r\n  - [x] - Parse metadata for `rustc-macro` crates to learn about symbol/derive mode pairings\r\n  - [x] - `dlopen` the dylib\r\n  - [x] - generate an error if any derive mode would shadow any other.\r\n- [x] - Add cargo integeration\r\n  - [x] - recognize `rustc-macro` similar to `plugin = true`\r\n  - [x] - pass `--crate-type=rustc-macro` when depending on it\r\n  - [x] - plumb the same host/target logic for rustc-macro crates as is present for plugin crates (e.g. always compile rustc-macro crates for hosts)\r\n- [x] - Tests\r\n  - [x] - smoke test loading a rustc-macro, dummy `#[derive]` trait \r\n  - [x] - name conflicts are an error\r\n  - [x] - compiling for the wrong architecture is an error\r\n  - [x] - cannot emit crate type rustc-macro and anything else (e.g. rustc-macro+dylib) is an error\r\n  - [x] - span information not being horrendous\r\n  - [x] - removing attributes from a struct, as well as fields\r\n  - [x] - adding impls next to a struct\r\n  - [x] - cross compilation looks for the host rustc-macro crate type\r\n  - [x] - don't load vanilla dylibs as rustc-macro crate types\r\n  - [x] - can't have public exports beyond macro derive functions in a rustc-macro crate\r\n  - [x] - derive macros must have required signature\r\n  - [x] - load two macro crates in one compilation\r\n","reactions":{"url":"https://api.github.com/repos/rust-lang/rust/issues/35900/reactions","total_count":29,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":26,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rust-lang/rust/issues/35900/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/comments/257245206","html_url":"https://github.com/diesel-rs/diesel/issues/485#issuecomment-257245206","issue_url":"https://api.github.com/repos/diesel-rs/diesel/issues/485","id":257245206,"node_id":"MDEyOklzc3VlQ29tbWVudDI1NzI0NTIwNg==","user":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-10-31T09:10:47Z","updated_at":"2016-10-31T09:10:47Z","body":"@sgrif That seems like a direction that might take some time, if it is resolved in your favor at all. The issue seems to be that a recent change put macros and `derive`s in the same namespace, thus `Queryable!` and `[derive(Queryable)]` collide. It does not seem like it would be onerous to rename one of the two, presumably the macro, to something different. Alternatively, you could provide a duplicate macro with a different name (say, `Queryable_`) that is only used for code generation so that `Queryable` can still be used by others. This would resolve the conflict while keeping the ergonomics you're presumably aiming for.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/comments/257245206/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"SergioBenitez","id":1480321,"node_id":"MDQ6VXNlcjE0ODAzMjE=","avatar_url":"https://avatars.githubusercontent.com/u/1480321?v=4","gravatar_id":"","url":"https://api.github.com/users/SergioBenitez","html_url":"https://github.com/SergioBenitez","followers_url":"https://api.github.com/users/SergioBenitez/followers","following_url":"https://api.github.com/users/SergioBenitez/following{/other_user}","gists_url":"https://api.github.com/users/SergioBenitez/gists{/gist_id}","starred_url":"https://api.github.com/users/SergioBenitez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SergioBenitez/subscriptions","organizations_url":"https://api.github.com/users/SergioBenitez/orgs","repos_url":"https://api.github.com/users/SergioBenitez/repos","events_url":"https://api.github.com/users/SergioBenitez/events{/privacy}","received_events_url":"https://api.github.com/users/SergioBenitez/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":841616520,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50ODQxNjE2NTIw","url":"https://api.github.com/repos/diesel-rs/diesel/issues/events/841616520","actor":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2016-10-31T09:10:47Z","performed_via_github_app":null},{"id":841616521,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDg0MTYxNjUyMQ==","url":"https://api.github.com/repos/diesel-rs/diesel/issues/events/841616521","actor":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2016-10-31T09:10:47Z","performed_via_github_app":null},{"id":843523328,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDg0MzUyMzMyOA==","url":"https://api.github.com/repos/diesel-rs/diesel/issues/events/843523328","actor":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"6fd3127df39e3d995fa5f8df8eca5fa50bae7b87","commit_url":"https://api.github.com/repos/diesel-rs/diesel/commits/6fd3127df39e3d995fa5f8df8eca5fa50bae7b87","created_at":"2016-11-01T15:34:30Z","performed_via_github_app":null},{"actor":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-11-01T15:34:35Z","updated_at":"2016-11-01T15:34:35Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/489","repository_url":"https://api.github.com/repos/diesel-rs/diesel","labels_url":"https://api.github.com/repos/diesel-rs/diesel/issues/489/labels{/name}","comments_url":"https://api.github.com/repos/diesel-rs/diesel/issues/489/comments","events_url":"https://api.github.com/repos/diesel-rs/diesel/issues/489/events","html_url":"https://github.com/diesel-rs/diesel/pull/489","id":186564970,"node_id":"MDExOlB1bGxSZXF1ZXN0OTE4MDUzMjQ=","number":489,"title":"Fix failures on latest nightlies","user":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2016-11-01T15:34:35Z","updated_at":"2016-11-11T16:42:03Z","closed_at":"2016-11-11T16:42:03Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":41609775,"node_id":"MDEwOlJlcG9zaXRvcnk0MTYwOTc3NQ==","name":"diesel","full_name":"diesel-rs/diesel","private":false,"owner":{"login":"diesel-rs","id":16763251,"node_id":"MDEyOk9yZ2FuaXphdGlvbjE2NzYzMjUx","avatar_url":"https://avatars.githubusercontent.com/u/16763251?v=4","gravatar_id":"","url":"https://api.github.com/users/diesel-rs","html_url":"https://github.com/diesel-rs","followers_url":"https://api.github.com/users/diesel-rs/followers","following_url":"https://api.github.com/users/diesel-rs/following{/other_user}","gists_url":"https://api.github.com/users/diesel-rs/gists{/gist_id}","starred_url":"https://api.github.com/users/diesel-rs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/diesel-rs/subscriptions","organizations_url":"https://api.github.com/users/diesel-rs/orgs","repos_url":"https://api.github.com/users/diesel-rs/repos","events_url":"https://api.github.com/users/diesel-rs/events{/privacy}","received_events_url":"https://api.github.com/users/diesel-rs/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/diesel-rs/diesel","description":"A safe, extensible ORM and Query Builder for Rust","fork":false,"url":"https://api.github.com/repos/diesel-rs/diesel","forks_url":"https://api.github.com/repos/diesel-rs/diesel/forks","keys_url":"https://api.github.com/repos/diesel-rs/diesel/keys{/key_id}","collaborators_url":"https://api.github.com/repos/diesel-rs/diesel/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/diesel-rs/diesel/teams","hooks_url":"https://api.github.com/repos/diesel-rs/diesel/hooks","issue_events_url":"https://api.github.com/repos/diesel-rs/diesel/issues/events{/number}","events_url":"https://api.github.com/repos/diesel-rs/diesel/events","assignees_url":"https://api.github.com/repos/diesel-rs/diesel/assignees{/user}","branches_url":"https://api.github.com/repos/diesel-rs/diesel/branches{/branch}","tags_url":"https://api.github.com/repos/diesel-rs/diesel/tags","blobs_url":"https://api.github.com/repos/diesel-rs/diesel/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/diesel-rs/diesel/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/diesel-rs/diesel/git/refs{/sha}","trees_url":"https://api.github.com/repos/diesel-rs/diesel/git/trees{/sha}","statuses_url":"https://api.github.com/repos/diesel-rs/diesel/statuses/{sha}","languages_url":"https://api.github.com/repos/diesel-rs/diesel/languages","stargazers_url":"https://api.github.com/repos/diesel-rs/diesel/stargazers","contributors_url":"https://api.github.com/repos/diesel-rs/diesel/contributors","subscribers_url":"https://api.github.com/repos/diesel-rs/diesel/subscribers","subscription_url":"https://api.github.com/repos/diesel-rs/diesel/subscription","commits_url":"https://api.github.com/repos/diesel-rs/diesel/commits{/sha}","git_commits_url":"https://api.github.com/repos/diesel-rs/diesel/git/commits{/sha}","comments_url":"https://api.github.com/repos/diesel-rs/diesel/comments{/number}","issue_comment_url":"https://api.github.com/repos/diesel-rs/diesel/issues/comments{/number}","contents_url":"https://api.github.com/repos/diesel-rs/diesel/contents/{+path}","compare_url":"https://api.github.com/repos/diesel-rs/diesel/compare/{base}...{head}","merges_url":"https://api.github.com/repos/diesel-rs/diesel/merges","archive_url":"https://api.github.com/repos/diesel-rs/diesel/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/diesel-rs/diesel/downloads","issues_url":"https://api.github.com/repos/diesel-rs/diesel/issues{/number}","pulls_url":"https://api.github.com/repos/diesel-rs/diesel/pulls{/number}","milestones_url":"https://api.github.com/repos/diesel-rs/diesel/milestones{/number}","notifications_url":"https://api.github.com/repos/diesel-rs/diesel/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/diesel-rs/diesel/labels{/name}","releases_url":"https://api.github.com/repos/diesel-rs/diesel/releases{/id}","deployments_url":"https://api.github.com/repos/diesel-rs/diesel/deployments","created_at":"2015-08-29T22:51:00Z","updated_at":"2025-11-09T19:31:55Z","pushed_at":"2025-11-07T18:13:31Z","git_url":"git://github.com/diesel-rs/diesel.git","ssh_url":"git@github.com:diesel-rs/diesel.git","clone_url":"https://github.com/diesel-rs/diesel.git","svn_url":"https://github.com/diesel-rs/diesel","homepage":"https://diesel.rs","size":109357,"stargazers_count":13771,"watchers_count":13771,"language":"Rust","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":true,"has_discussions":true,"forks_count":1168,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":153,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["mysql","orm","postgresql","query-builder","rust","sqlite"],"visibility":"public","forks":1168,"open_issues":153,"watchers":13771,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/diesel-rs/diesel/pulls/489","html_url":"https://github.com/diesel-rs/diesel/pull/489","diff_url":"https://github.com/diesel-rs/diesel/pull/489.diff","patch_url":"https://github.com/diesel-rs/diesel/pull/489.patch","merged_at":null},"body":"Macros 1.1 was changed so that bang macros and custom derive macros\r\nshare the same namespace. This causes problems for us, since we expose\r\nand use a bang macro with the same name as the custom derive macro. I\r\nwas hoping we could have this changed upstream, but\r\nhttps://github.com/rust-lang/rust/issues/35900#issuecomment-257190405\r\nmakes it seem like that's not going to happen. I'm not sure what my long\r\nterm plan for the bang macros are, but in the short term we can just\r\nexpose them under another name internally. Those who are using the bang\r\nmacros are likely not using them in conjunction with `diesel_codegen`.\r\n\r\nFixes #485.","reactions":{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/489/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/diesel-rs/diesel/issues/489/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":843806098,"node_id":"MDExOkNsb3NlZEV2ZW50ODQzODA2MDk4","url":"https://api.github.com/repos/diesel-rs/diesel/issues/events/843806098","actor":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"4f38cc8f6351c2628deab9c7d7957b6bde463ed7","commit_url":"https://api.github.com/repos/diesel-rs/diesel/commits/4f38cc8f6351c2628deab9c7d7957b6bde463ed7","created_at":"2016-11-01T18:34:46Z","state_reason":null,"performed_via_github_app":null}]