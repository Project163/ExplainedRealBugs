[{"id":889307022,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDg4OTMwNzAyMg==","url":"https://api.github.com/repos/diesel-rs/diesel/issues/events/889307022","actor":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"1d3d1b060f4c5b9597e5911eb52ec5cbf971a2b9","commit_url":"https://api.github.com/repos/diesel-rs/diesel/commits/1d3d1b060f4c5b9597e5911eb52ec5cbf971a2b9","created_at":"2016-12-10T14:07:49Z","performed_via_github_app":null},{"id":889307446,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDg4OTMwNzQ0Ng==","url":"https://api.github.com/repos/diesel-rs/diesel/issues/events/889307446","actor":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"c96efa5c9e2568e51ee5c1cc1cc2c5915f47d125","commit_url":"https://api.github.com/repos/diesel-rs/diesel/commits/c96efa5c9e2568e51ee5c1cc1cc2c5915f47d125","created_at":"2016-12-10T14:09:28Z","performed_via_github_app":null},{"actor":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-12-10T14:10:01Z","updated_at":"2016-12-10T14:10:01Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/541","repository_url":"https://api.github.com/repos/diesel-rs/diesel","labels_url":"https://api.github.com/repos/diesel-rs/diesel/issues/541/labels{/name}","comments_url":"https://api.github.com/repos/diesel-rs/diesel/issues/541/comments","events_url":"https://api.github.com/repos/diesel-rs/diesel/issues/541/events","html_url":"https://github.com/diesel-rs/diesel/pull/541","id":194769978,"node_id":"MDExOlB1bGxSZXF1ZXN0OTc0MjYyNTQ=","number":541,"title":"Construct error messages properly when libpq returns `NULL` result","user":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-12-10T14:10:01Z","updated_at":"2016-12-10T19:52:27Z","closed_at":"2016-12-10T19:52:27Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":41609775,"node_id":"MDEwOlJlcG9zaXRvcnk0MTYwOTc3NQ==","name":"diesel","full_name":"diesel-rs/diesel","private":false,"owner":{"login":"diesel-rs","id":16763251,"node_id":"MDEyOk9yZ2FuaXphdGlvbjE2NzYzMjUx","avatar_url":"https://avatars.githubusercontent.com/u/16763251?v=4","gravatar_id":"","url":"https://api.github.com/users/diesel-rs","html_url":"https://github.com/diesel-rs","followers_url":"https://api.github.com/users/diesel-rs/followers","following_url":"https://api.github.com/users/diesel-rs/following{/other_user}","gists_url":"https://api.github.com/users/diesel-rs/gists{/gist_id}","starred_url":"https://api.github.com/users/diesel-rs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/diesel-rs/subscriptions","organizations_url":"https://api.github.com/users/diesel-rs/orgs","repos_url":"https://api.github.com/users/diesel-rs/repos","events_url":"https://api.github.com/users/diesel-rs/events{/privacy}","received_events_url":"https://api.github.com/users/diesel-rs/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/diesel-rs/diesel","description":"A safe, extensible ORM and Query Builder for Rust","fork":false,"url":"https://api.github.com/repos/diesel-rs/diesel","forks_url":"https://api.github.com/repos/diesel-rs/diesel/forks","keys_url":"https://api.github.com/repos/diesel-rs/diesel/keys{/key_id}","collaborators_url":"https://api.github.com/repos/diesel-rs/diesel/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/diesel-rs/diesel/teams","hooks_url":"https://api.github.com/repos/diesel-rs/diesel/hooks","issue_events_url":"https://api.github.com/repos/diesel-rs/diesel/issues/events{/number}","events_url":"https://api.github.com/repos/diesel-rs/diesel/events","assignees_url":"https://api.github.com/repos/diesel-rs/diesel/assignees{/user}","branches_url":"https://api.github.com/repos/diesel-rs/diesel/branches{/branch}","tags_url":"https://api.github.com/repos/diesel-rs/diesel/tags","blobs_url":"https://api.github.com/repos/diesel-rs/diesel/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/diesel-rs/diesel/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/diesel-rs/diesel/git/refs{/sha}","trees_url":"https://api.github.com/repos/diesel-rs/diesel/git/trees{/sha}","statuses_url":"https://api.github.com/repos/diesel-rs/diesel/statuses/{sha}","languages_url":"https://api.github.com/repos/diesel-rs/diesel/languages","stargazers_url":"https://api.github.com/repos/diesel-rs/diesel/stargazers","contributors_url":"https://api.github.com/repos/diesel-rs/diesel/contributors","subscribers_url":"https://api.github.com/repos/diesel-rs/diesel/subscribers","subscription_url":"https://api.github.com/repos/diesel-rs/diesel/subscription","commits_url":"https://api.github.com/repos/diesel-rs/diesel/commits{/sha}","git_commits_url":"https://api.github.com/repos/diesel-rs/diesel/git/commits{/sha}","comments_url":"https://api.github.com/repos/diesel-rs/diesel/comments{/number}","issue_comment_url":"https://api.github.com/repos/diesel-rs/diesel/issues/comments{/number}","contents_url":"https://api.github.com/repos/diesel-rs/diesel/contents/{+path}","compare_url":"https://api.github.com/repos/diesel-rs/diesel/compare/{base}...{head}","merges_url":"https://api.github.com/repos/diesel-rs/diesel/merges","archive_url":"https://api.github.com/repos/diesel-rs/diesel/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/diesel-rs/diesel/downloads","issues_url":"https://api.github.com/repos/diesel-rs/diesel/issues{/number}","pulls_url":"https://api.github.com/repos/diesel-rs/diesel/pulls{/number}","milestones_url":"https://api.github.com/repos/diesel-rs/diesel/milestones{/number}","notifications_url":"https://api.github.com/repos/diesel-rs/diesel/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/diesel-rs/diesel/labels{/name}","releases_url":"https://api.github.com/repos/diesel-rs/diesel/releases{/id}","deployments_url":"https://api.github.com/repos/diesel-rs/diesel/deployments","created_at":"2015-08-29T22:51:00Z","updated_at":"2025-11-09T19:31:55Z","pushed_at":"2025-11-07T18:13:31Z","git_url":"git://github.com/diesel-rs/diesel.git","ssh_url":"git@github.com:diesel-rs/diesel.git","clone_url":"https://github.com/diesel-rs/diesel.git","svn_url":"https://github.com/diesel-rs/diesel","homepage":"https://diesel.rs","size":109357,"stargazers_count":13771,"watchers_count":13771,"language":"Rust","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":true,"has_discussions":true,"forks_count":1168,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":153,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["mysql","orm","postgresql","query-builder","rust","sqlite"],"visibility":"public","forks":1168,"open_issues":153,"watchers":13771,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/diesel-rs/diesel/pulls/541","html_url":"https://github.com/diesel-rs/diesel/pull/541","diff_url":"https://github.com/diesel-rs/diesel/pull/541.diff","patch_url":"https://github.com/diesel-rs/diesel/pull/541.patch","merged_at":"2016-12-10T19:52:27Z"},"body":"I had originally thought that this was some weird condition that was the\r\nresult of the server getting a query with more than `34464` (`i16::MAX`)\r\nbind parameters, where we got back an error but it had no message. We\r\npanic in that case, as PG is documented that all errors have a message.\r\nIt turns out I was wrong for two reasons.\r\n\r\nFirst, the number is 65535 (`u16::MAX`), not `34464`. (This might have\r\nbeen something changed on the PG side in 9.6 which was released since I\r\nlast looked at this). Second, we were not getting back an error with no\r\nmessage, we were getting a `NULL` return value from libpq. From [their\r\ndocs][]:\r\n\r\n[their docs]: https://www.postgresql.org/docs/9.6/static/libpq-exec.html#LIBPQ-PQPREPARE\r\n\r\n> A null result indicates out-of-memory or inability to send the command\r\n> at all. Use PQerrorMessage to get more information about such errors.\r\n\r\n`PQerrorMessage` means the error is on the connection. The reason that\r\nwe had no result was that the PG wire protocol uses a `u16` for the\r\nnumber of bind parameters, so there's no way for the driver to have even\r\nsent the message to the server.\r\n\r\nOnce we realized the error condition that we were seeing is more general\r\nthan just the bind parameter case, I've refactored the code to perform a\r\nnot null check as early as possible, and hide the `*mut PGresult`.\r\n\r\nThe test itself is written in a somewhat strange fashion. We're\r\nconstructing a query that has 70_000 bind parameters, as this is the\r\nonly case that I know of which will always cause libpq to return null. I\r\ndon't care what the error message is, just that it's not an empty\r\nstring. I've also written the test to explicitly match instead of unwrap\r\nand use `#[should_panic]` because I want to be sure that it *didn't*\r\npanic.\r\n\r\nIdeally we would never see `*mut PGresult` anywhere in the code, and use\r\n`Unique<PGresult>` instead. However, it is currently unstable. I had\r\noriginally implemented this to use `Unique` if `feature = \"unstable\"`\r\nwas set, but deleted it as the `#[cfg]` branches made the code harder to\r\ncomprehend. The only real benefit `Unique` gives us here is clarity of\r\nintent. For the not-null and non-aliased hints to result in any\r\noptimization by the compiler would require libpq to be statically\r\nlinked, and LTO to be happening at the LLVM layer, neither of which are\r\ncommonly true.\r\n\r\nWe know that `Send` and `Sync` are safe to implement on our new struct,\r\nbecause the pointer is unaliased. We can delete those impls if we switch\r\nto using `Unique` in the future, as it already implements those traits.\r\n\r\nFixes #446.","reactions":{"url":"https://api.github.com/repos/diesel-rs/diesel/issues/541/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/diesel-rs/diesel/issues/541/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":889311004,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDg4OTMxMTAwNA==","url":"https://api.github.com/repos/diesel-rs/diesel/issues/events/889311004","actor":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"58940c31523f90de8d9a8f814649baa8435bd71a","commit_url":"https://api.github.com/repos/diesel-rs/diesel/commits/58940c31523f90de8d9a8f814649baa8435bd71a","created_at":"2016-12-10T14:24:06Z","performed_via_github_app":null},{"id":889385442,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDg4OTM4NTQ0Mg==","url":"https://api.github.com/repos/diesel-rs/diesel/issues/events/889385442","actor":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"7e378c484316fef1b02a5ccfdfc526f645faed52","commit_url":"https://api.github.com/repos/diesel-rs/diesel/commits/7e378c484316fef1b02a5ccfdfc526f645faed52","created_at":"2016-12-10T19:17:35Z","performed_via_github_app":null},{"id":889394235,"node_id":"MDExOkNsb3NlZEV2ZW50ODg5Mzk0MjM1","url":"https://api.github.com/repos/diesel-rs/diesel/issues/events/889394235","actor":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2016-12-10T19:52:27Z","state_reason":null,"performed_via_github_app":null}]