diff --git a/rt/rs/security/oauth-parent/oauth2/src/main/java/org/apache/cxf/rs/security/oauth2/grants/refresh/RefreshTokenGrantHandler.java b/rt/rs/security/oauth-parent/oauth2/src/main/java/org/apache/cxf/rs/security/oauth2/grants/refresh/RefreshTokenGrantHandler.java
index 2037ba0d3d..ac6714d9bd 100644
--- a/rt/rs/security/oauth-parent/oauth2/src/main/java/org/apache/cxf/rs/security/oauth2/grants/refresh/RefreshTokenGrantHandler.java
+++ b/rt/rs/security/oauth-parent/oauth2/src/main/java/org/apache/cxf/rs/security/oauth2/grants/refresh/RefreshTokenGrantHandler.java
@@ -52,8 +52,9 @@ public class RefreshTokenGrantHandler implements AccessTokenGrantHandler {
                                             params.getFirst(OAuthConstants.SCOPE),
                                             useAllClientScopes,
                                             partialMatchScopeValidation);
-
-        return dataProvider.refreshAccessToken(client, refreshToken, requestedScopes);
+        final ServerAccessToken st = dataProvider.refreshAccessToken(client, refreshToken, requestedScopes);
+        st.setGrantType(OAuthConstants.REFRESH_TOKEN_GRANT);
+        return st;
     }
 
     public void setPartialMatchScopeValidation(boolean partialMatchScopeValidation) {
diff --git a/rt/rs/security/sso/oidc/src/main/java/org/apache/cxf/rs/security/oidc/idp/IdTokenResponseFilter.java b/rt/rs/security/sso/oidc/src/main/java/org/apache/cxf/rs/security/oidc/idp/IdTokenResponseFilter.java
index 428d107931..2431389038 100644
--- a/rt/rs/security/sso/oidc/src/main/java/org/apache/cxf/rs/security/oidc/idp/IdTokenResponseFilter.java
+++ b/rt/rs/security/sso/oidc/src/main/java/org/apache/cxf/rs/security/oidc/idp/IdTokenResponseFilter.java
@@ -78,7 +78,12 @@ public class IdTokenResponseFilter extends OAuthServerJoseJwtProducer implements
                 idToken.setAudience(st.getClient().getClientId());
                 idToken.setAuthorizedParty(st.getClient().getClientId());
                 // if this token was refreshed then the cloned IDToken might need to have its
-                // issuedAt and expiry time properties adjusted if it proves to be necessary
+                // issuedAt and expiry time properties adjusted
+                if (OAuthConstants.REFRESH_TOKEN_GRANT.equals(st.getGrantType())) {
+                    final Long iat = st.getIssuedAt();
+                    idToken.setExpiryTime(iat + (idToken.getExpiryTime() - idToken.getIssuedAt()));
+                    idToken.setIssuedAt(iat);
+                }
                 setAtHashAndNonce(idToken, st);
                 return processJwt(new JwtToken(idToken), st.getClient());
             }
diff --git a/systests/rs-security/src/test/java/org/apache/cxf/systest/jaxrs/security/oauth2/common/JCacheOAuthDataProviderImpl.java b/systests/rs-security/src/test/java/org/apache/cxf/systest/jaxrs/security/oauth2/common/JCacheOAuthDataProviderImpl.java
index 378529d29d..03e002130d 100644
--- a/systests/rs-security/src/test/java/org/apache/cxf/systest/jaxrs/security/oauth2/common/JCacheOAuthDataProviderImpl.java
+++ b/systests/rs-security/src/test/java/org/apache/cxf/systest/jaxrs/security/oauth2/common/JCacheOAuthDataProviderImpl.java
@@ -21,6 +21,7 @@ package org.apache.cxf.systest.jaxrs.security.oauth2.common;
 import java.io.InputStream;
 import java.security.cert.Certificate;
 import java.util.ArrayList;
+import java.util.Arrays;
 import java.util.Collections;
 import java.util.HashSet;
 import java.util.List;
@@ -100,13 +101,15 @@ public class JCacheOAuthDataProviderImpl extends JCacheCodeDataProvider {
         // OIDC filters test client
         client = createPublicClients ? new Client("consumer-id-oidc", null, false)
             : new Client("consumer-id-oidc", "this-is-a-secret", true);
-        client.setRedirectUris(Collections.singletonList("https://localhost:" + servicePort
-                                                         + "/secured/bookstore/books"));
+        client.setRedirectUris(Arrays.asList(
+            "https://localhost:" + servicePort + "/secured/bookstore/books",
+            "http://www.blah.apache.org"));
 
         client.getAllowedGrantTypes().add("authorization_code");
         client.getAllowedGrantTypes().add("refresh_token");
 
         client.getRegisteredScopes().add("openid");
+        client.getRegisteredScopes().add(OAuthConstants.REFRESH_TOKEN_SCOPE);
 
         this.setClient(client);
 
@@ -217,66 +220,39 @@ public class JCacheOAuthDataProviderImpl extends JCacheCodeDataProvider {
 
         List<OAuthPermission> permissions = new ArrayList<>();
         for (String requestedScope : requestedScopes) {
+            final OAuthPermission permission;
             if ("read_book".equals(requestedScope)) {
-                OAuthPermission permission = new OAuthPermission("read_book");
+                permission = new OAuthPermission("read_book");
                 permission.setHttpVerbs(Collections.singletonList("GET"));
-                List<String> uris = new ArrayList<>();
-                String partnerAddress = "/secured/bookstore/books/*";
-                uris.add(partnerAddress);
-                permission.setUris(uris);
-
-                permissions.add(permission);
+                permission.setUris(Collections.singletonList("/secured/bookstore/books/*"));
             } else if ("create_book".equals(requestedScope)) {
-                OAuthPermission permission = new OAuthPermission("create_book");
+                permission = new OAuthPermission("create_book");
                 permission.setHttpVerbs(Collections.singletonList("POST"));
-                List<String> uris = new ArrayList<>();
-                String partnerAddress = "/secured/bookstore/books/*";
-                uris.add(partnerAddress);
-                permission.setUris(uris);
-
-                permissions.add(permission);
+                permission.setUris(Collections.singletonList("/secured/bookstore/books/*"));
             } else if ("create_image".equals(requestedScope)) {
-                OAuthPermission permission = new OAuthPermission("create_image");
+                permission = new OAuthPermission("create_image");
                 permission.setHttpVerbs(Collections.singletonList("POST"));
-                List<String> uris = new ArrayList<>();
-                String partnerAddress = "/secured/bookstore/image/*";
-                uris.add(partnerAddress);
-                permission.setUris(uris);
-
-                permissions.add(permission);
+                permission.setUris(Collections.singletonList("/secured/bookstore/image/*"));
             } else if ("read_balance".equals(requestedScope)) {
-                OAuthPermission permission = new OAuthPermission("read_balance");
+                permission = new OAuthPermission("read_balance");
                 permission.setHttpVerbs(Collections.singletonList("GET"));
-                List<String> uris = new ArrayList<>();
-                String partnerAddress = "/partners/balance/*";
-                uris.add(partnerAddress);
-                permission.setUris(uris);
-
-                permissions.add(permission);
+                permission.setUris(Collections.singletonList("/partners/balance/*"));
             } else if ("create_balance".equals(requestedScope)) {
-                OAuthPermission permission = new OAuthPermission("create_balance");
+                permission = new OAuthPermission("create_balance");
                 permission.setHttpVerbs(Collections.singletonList("POST"));
-                List<String> uris = new ArrayList<>();
-                String partnerAddress = "/partners/balance/*";
-                uris.add(partnerAddress);
-                permission.setUris(uris);
-
-                permissions.add(permission);
+                permission.setUris(Collections.singletonList("/partners/balance/*"));
             } else if ("read_data".equals(requestedScope)) {
-                OAuthPermission permission = new OAuthPermission("read_data");
+                permission = new OAuthPermission("read_data");
                 permission.setHttpVerbs(Collections.singletonList("GET"));
-                List<String> uris = new ArrayList<>();
-                String partnerAddress = "/partners/data/*";
-                uris.add(partnerAddress);
-                permission.setUris(uris);
-
-                permissions.add(permission);
+                permission.setUris(Collections.singletonList("/partners/data/*"));
             } else if ("openid".equals(requestedScope)) {
-                OAuthPermission permission = new OAuthPermission("openid", "Authenticate user");
-                permissions.add(permission);
+                permission = new OAuthPermission("openid", "Authenticate user");
+            } else if (OAuthConstants.REFRESH_TOKEN_SCOPE.equals(requestedScope)) {
+                permission = new OAuthPermission(requestedScope);
             } else {
                 throw new OAuthServiceException("invalid_scope");
             }
+            permissions.add(permission);
         }
 
         return permissions;
diff --git a/systests/rs-security/src/test/java/org/apache/cxf/systest/jaxrs/security/oauth2/common/JPAOAuthDataProviderImpl.java b/systests/rs-security/src/test/java/org/apache/cxf/systest/jaxrs/security/oauth2/common/JPAOAuthDataProviderImpl.java
index 8ed473e004..2823820539 100644
--- a/systests/rs-security/src/test/java/org/apache/cxf/systest/jaxrs/security/oauth2/common/JPAOAuthDataProviderImpl.java
+++ b/systests/rs-security/src/test/java/org/apache/cxf/systest/jaxrs/security/oauth2/common/JPAOAuthDataProviderImpl.java
@@ -19,6 +19,7 @@
 package org.apache.cxf.systest.jaxrs.security.oauth2.common;
 
 import java.util.ArrayList;
+import java.util.Arrays;
 import java.util.Collections;
 import java.util.HashSet;
 import java.util.List;
@@ -80,13 +81,15 @@ public class JPAOAuthDataProviderImpl extends JPACodeDataProvider {
 
         // OIDC filters test client
         client = new Client("consumer-id-oidc", "this-is-a-secret", true);
-        client.setRedirectUris(Collections.singletonList("https://localhost:" + servicePort
-                                                         + "/secured/bookstore/books"));
+        client.setRedirectUris(Arrays.asList(
+            "https://localhost:" + servicePort + "/secured/bookstore/books",
+            "http://www.blah.apache.org"));
 
         client.getAllowedGrantTypes().add("authorization_code");
         client.getAllowedGrantTypes().add("refresh_token");
 
         client.getRegisteredScopes().add("openid");
+        client.getRegisteredScopes().add(OAuthConstants.REFRESH_TOKEN_SCOPE);
 
         this.setClient(client);
 
@@ -175,66 +178,39 @@ public class JPAOAuthDataProviderImpl extends JPACodeDataProvider {
 
         List<OAuthPermission> permissions = new ArrayList<>();
         for (String requestedScope : requestedScopes) {
+            final OAuthPermission permission;
             if ("read_book".equals(requestedScope)) {
-                OAuthPermission permission = new OAuthPermission("read_book");
+                permission = new OAuthPermission("read_book");
                 permission.setHttpVerbs(Collections.singletonList("GET"));
-                List<String> uris = new ArrayList<>();
-                String partnerAddress = "/secured/bookstore/books/*";
-                uris.add(partnerAddress);
-                permission.setUris(uris);
-
-                permissions.add(permission);
+                permission.setUris(Collections.singletonList("/secured/bookstore/books/*"));
             } else if ("create_book".equals(requestedScope)) {
-                OAuthPermission permission = new OAuthPermission("create_book");
+                permission = new OAuthPermission("create_book");
                 permission.setHttpVerbs(Collections.singletonList("POST"));
-                List<String> uris = new ArrayList<>();
-                String partnerAddress = "/secured/bookstore/books/*";
-                uris.add(partnerAddress);
-                permission.setUris(uris);
-
-                permissions.add(permission);
+                permission.setUris(Collections.singletonList("/secured/bookstore/books/*"));
             } else if ("create_image".equals(requestedScope)) {
-                OAuthPermission permission = new OAuthPermission("create_image");
+                permission = new OAuthPermission("create_image");
                 permission.setHttpVerbs(Collections.singletonList("POST"));
-                List<String> uris = new ArrayList<>();
-                String partnerAddress = "/secured/bookstore/image/*";
-                uris.add(partnerAddress);
-                permission.setUris(uris);
-
-                permissions.add(permission);
+                permission.setUris(Collections.singletonList("/secured/bookstore/image/*"));
             } else if ("read_balance".equals(requestedScope)) {
-                OAuthPermission permission = new OAuthPermission("read_balance");
+                permission = new OAuthPermission("read_balance");
                 permission.setHttpVerbs(Collections.singletonList("GET"));
-                List<String> uris = new ArrayList<>();
-                String partnerAddress = "/partners/balance/*";
-                uris.add(partnerAddress);
-                permission.setUris(uris);
-
-                permissions.add(permission);
+                permission.setUris(Collections.singletonList("/partners/balance/*"));
             } else if ("create_balance".equals(requestedScope)) {
-                OAuthPermission permission = new OAuthPermission("create_balance");
+                permission = new OAuthPermission("create_balance");
                 permission.setHttpVerbs(Collections.singletonList("POST"));
-                List<String> uris = new ArrayList<>();
-                String partnerAddress = "/partners/balance/*";
-                uris.add(partnerAddress);
-                permission.setUris(uris);
-
-                permissions.add(permission);
+                permission.setUris(Collections.singletonList("/partners/balance/*"));
             } else if ("read_data".equals(requestedScope)) {
-                OAuthPermission permission = new OAuthPermission("read_data");
+                permission = new OAuthPermission("read_data");
                 permission.setHttpVerbs(Collections.singletonList("GET"));
-                List<String> uris = new ArrayList<>();
-                String partnerAddress = "/partners/data/*";
-                uris.add(partnerAddress);
-                permission.setUris(uris);
-
-                permissions.add(permission);
+                permission.setUris(Collections.singletonList("/partners/data/*"));
             } else if ("openid".equals(requestedScope)) {
-                OAuthPermission permission = new OAuthPermission("openid", "Authenticate user");
-                permissions.add(permission);
+                permission = new OAuthPermission("openid", "Authenticate user");
+            } else if (OAuthConstants.REFRESH_TOKEN_SCOPE.equals(requestedScope)) {
+                permission = new OAuthPermission(requestedScope);
             } else {
                 throw new OAuthServiceException("invalid_scope");
             }
+            permissions.add(permission);
         }
 
         return permissions;
diff --git a/systests/rs-security/src/test/java/org/apache/cxf/systest/jaxrs/security/oidc/IdTokenProviderImpl.java b/systests/rs-security/src/test/java/org/apache/cxf/systest/jaxrs/security/oidc/IdTokenProviderImpl.java
index d9fcdd0eb6..05d70b8fe9 100644
--- a/systests/rs-security/src/test/java/org/apache/cxf/systest/jaxrs/security/oidc/IdTokenProviderImpl.java
+++ b/systests/rs-security/src/test/java/org/apache/cxf/systest/jaxrs/security/oidc/IdTokenProviderImpl.java
@@ -18,26 +18,21 @@
  */
 package org.apache.cxf.systest.jaxrs.security.oidc;
 
-import java.time.Instant;
 import java.util.List;
 
 import org.apache.cxf.rs.security.oauth2.common.UserSubject;
+import org.apache.cxf.rs.security.oauth2.utils.OAuthUtils;
 import org.apache.cxf.rs.security.oidc.common.IdToken;
 import org.apache.cxf.rs.security.oidc.idp.IdTokenProvider;
 
 public class IdTokenProviderImpl implements IdTokenProvider {
 
-    public IdTokenProviderImpl() {
-
-    }
-
     @Override
     public IdToken getIdToken(String clientId, UserSubject authenticatedUser, List<String> scopes) {
         IdToken token = new IdToken();
 
-        Instant now = Instant.now();
-        token.setIssuedAt(now.getEpochSecond());
-        token.setExpiryTime(now.plusSeconds(60L).getEpochSecond());
+        token.setIssuedAt(OAuthUtils.getIssuedAt());
+        token.setExpiryTime(token.getIssuedAt() + 60L);
         token.setAudience(clientId);
         token.setSubject(authenticatedUser.getLogin());
         token.setIssuer("OIDC IdP");
diff --git a/systests/rs-security/src/test/java/org/apache/cxf/systest/jaxrs/security/oidc/OIDCFlowTest.java b/systests/rs-security/src/test/java/org/apache/cxf/systest/jaxrs/security/oidc/OIDCFlowTest.java
index 4d8223e2e3..a202977076 100644
--- a/systests/rs-security/src/test/java/org/apache/cxf/systest/jaxrs/security/oidc/OIDCFlowTest.java
+++ b/systests/rs-security/src/test/java/org/apache/cxf/systest/jaxrs/security/oidc/OIDCFlowTest.java
@@ -28,12 +28,15 @@ import java.security.cert.CertificateException;
 import java.security.cert.X509Certificate;
 import java.time.Instant;
 import java.util.Collections;
+import java.util.concurrent.TimeUnit;
 
 import javax.ws.rs.core.Form;
+import javax.ws.rs.core.MediaType;
 import javax.ws.rs.core.Response;
 
 import org.apache.cxf.common.util.Base64UrlUtility;
 import org.apache.cxf.jaxrs.client.WebClient;
+import org.apache.cxf.rs.security.jose.jaxrs.JsonWebKeysProvider;
 import org.apache.cxf.rs.security.jose.jwa.SignatureAlgorithm;
 import org.apache.cxf.rs.security.jose.jwk.JsonWebKeys;
 import org.apache.cxf.rs.security.jose.jws.JwsHeaders;
@@ -42,12 +45,15 @@ import org.apache.cxf.rs.security.jose.jws.JwsJwtCompactProducer;
 import org.apache.cxf.rs.security.jose.jwt.JwtClaims;
 import org.apache.cxf.rs.security.jose.jwt.JwtConstants;
 import org.apache.cxf.rs.security.jose.jwt.JwtToken;
+import org.apache.cxf.rs.security.oauth2.client.Consumer;
+import org.apache.cxf.rs.security.oauth2.client.OAuthClientUtils;
 import org.apache.cxf.rs.security.oauth2.common.ClientAccessToken;
 import org.apache.cxf.rs.security.oauth2.common.OAuthAuthorizationData;
 import org.apache.cxf.rs.security.oauth2.grants.code.CodeVerifierTransformer;
 import org.apache.cxf.rs.security.oauth2.grants.code.DigestCodeVerifier;
 import org.apache.cxf.rs.security.oauth2.utils.OAuthConstants;
 import org.apache.cxf.rs.security.oidc.common.IdToken;
+import org.apache.cxf.rs.security.oidc.rp.IdTokenReader;
 import org.apache.cxf.rs.security.oidc.utils.OidcUtils;
 import org.apache.cxf.rt.security.crypto.CryptoUtils;
 import org.apache.cxf.systest.jaxrs.security.SecurityTestUtil;
@@ -63,6 +69,7 @@ import org.junit.runners.Parameterized.Parameters;
 
 import static org.junit.Assert.assertEquals;
 import static org.junit.Assert.assertFalse;
+import static org.junit.Assert.assertNotEquals;
 import static org.junit.Assert.assertNotNull;
 import static org.junit.Assert.assertNull;
 import static org.junit.Assert.assertTrue;
@@ -938,6 +945,46 @@ public class OIDCFlowTest extends AbstractBusClientServerTestBase {
                                                           SignatureAlgorithm.RS256));
     }
 
+    @org.junit.Test
+    public void testAuthorizationCodeFlowRefreshToken() throws Exception {
+        URL busFile = OIDCFlowTest.class.getResource("client.xml");
+
+        String address = "https://localhost:" + port + "/services/";
+        WebClient client = WebClient.create(address, OAuth2TestUtils.setupProviders(),
+                                            "alice", "security", busFile.toString());
+        // Save the Cookie for the second request...
+        WebClient.getConfig(client).getRequestContext().put(
+            org.apache.cxf.message.Message.MAINTAIN_SESSION, Boolean.TRUE);
+
+        // Get Authorization Code
+        String code = OAuth2TestUtils.getAuthorizationCode(client,
+            String.join(" ", OidcUtils.getOpenIdScope(), OAuthConstants.REFRESH_TOKEN_SCOPE),
+            "consumer-id-oidc");
+        assertNotNull(code);
+
+        // Now get the access token
+        client = WebClient.create(address, "consumer-id-oidc", "this-is-a-secret", busFile.toString());
+
+        ClientAccessToken accessToken =
+            OAuth2TestUtils.getAccessTokenWithAuthorizationCode(client, code, "consumer-id-oidc", null);
+        assertNotNull(accessToken.getTokenKey());
+        assertTrue(accessToken.getApprovedScope().contains("openid"));
+
+        IdToken idToken = getIdToken(accessToken, address + "keys/", "consumer-id-oidc");
+        assertNotNull(idToken);
+        Long issuedAt = idToken.getIssuedAt();
+
+        TimeUnit.SECONDS.sleep(1L);
+
+        accessToken = OAuthClientUtils.refreshAccessToken(
+            client,
+            new Consumer("consumer-id-oidc"),
+            accessToken);
+        idToken = getIdToken(accessToken, address + "keys/", "consumer-id-oidc");
+
+        assertNotEquals(issuedAt, idToken.getIssuedAt());
+    }
+
     private void validateIdToken(String idToken, String nonce)
         throws KeyStoreException, NoSuchAlgorithmException, CertificateException, IOException {
         JwsJwtCompactConsumer jwtConsumer = new JwsJwtCompactConsumer(idToken);
@@ -983,6 +1030,19 @@ public class OIDCFlowTest extends AbstractBusClientServerTestBase {
                                                           SignatureAlgorithm.RS256));
     }
 
+    private static IdToken getIdToken(ClientAccessToken accessToken, String jwksUri, String clientId) {
+        WebClient c = WebClient.create(jwksUri,
+            Collections.singletonList(new JsonWebKeysProvider()),
+            "alice", "security",
+            OIDCFlowTest.class.getResource("client.xml").toString())
+            .accept(MediaType.APPLICATION_JSON);
+        IdTokenReader idTokenReader = new IdTokenReader();
+        idTokenReader.setJwkSetClient(c);
+        idTokenReader.setIssuerId("OIDC IdP");
+
+        return idTokenReader.getIdToken(accessToken, new Consumer(clientId));
+    }
+
     private boolean isAccessTokenInJWTFormat() {
         return JWT_JCACHE_SERVER.getPort().equals(port) || JWT_NON_PERSIST_JCACHE_SERVER.getPort().equals(port);
     }
diff --git a/systests/rs-security/src/test/java/org/apache/cxf/systest/jaxrs/security/oidc/SubjectCreatorImpl.java b/systests/rs-security/src/test/java/org/apache/cxf/systest/jaxrs/security/oidc/SubjectCreatorImpl.java
new file mode 100644
index 0000000000..0915d42714
--- /dev/null
+++ b/systests/rs-security/src/test/java/org/apache/cxf/systest/jaxrs/security/oidc/SubjectCreatorImpl.java
@@ -0,0 +1,58 @@
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements. See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership. The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License. You may obtain a copy of the License at
+ *
+ * http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing,
+ * software distributed under the License is distributed on an
+ * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
+ * KIND, either express or implied. See the License for the
+ * specific language governing permissions and limitations
+ * under the License.
+ */
+package org.apache.cxf.systest.jaxrs.security.oidc;
+
+import java.util.Collections;
+import java.util.List;
+
+import javax.ws.rs.core.MultivaluedMap;
+
+import org.apache.cxf.jaxrs.ext.MessageContext;
+import org.apache.cxf.rs.security.oauth2.provider.SubjectCreator;
+import org.apache.cxf.rs.security.oauth2.utils.OAuthConstants;
+import org.apache.cxf.rs.security.oauth2.utils.OAuthUtils;
+import org.apache.cxf.rs.security.oidc.idp.IdTokenProvider;
+import org.apache.cxf.rs.security.oidc.idp.OidcUserSubject;
+import org.apache.cxf.rs.security.oidc.utils.OidcUtils;
+import org.apache.cxf.security.SecurityContext;
+
+
+public class SubjectCreatorImpl implements SubjectCreator {
+
+    private static final IdTokenProvider ID_TOKEN_PROVIDER = new IdTokenProviderImpl();
+
+    @Override
+    public OidcUserSubject createUserSubject(MessageContext mc, MultivaluedMap<String, String> params) {
+        OidcUserSubject oidcSub = new OidcUserSubject(OAuthUtils.createSubject(mc,
+            (SecurityContext)mc.get(SecurityContext.class.getName())));
+
+        final List<String> scopes;
+        String requestedScope = params.getFirst(OAuthConstants.SCOPE);
+        if (requestedScope != null && !requestedScope.isEmpty()) {
+            scopes = OidcUtils.getScopeClaims(requestedScope.split(" "));
+        } else {
+            scopes = Collections.emptyList();
+        }
+
+        oidcSub.setIdToken(ID_TOKEN_PROVIDER.getIdToken(null, oidcSub, scopes));
+
+        return oidcSub;
+    }
+
+}
diff --git a/systests/rs-security/src/test/resources/META-INF/persistence.xml b/systests/rs-security/src/test/resources/META-INF/persistence.xml
index ca34221b2c..ddab4c4778 100644
--- a/systests/rs-security/src/test/resources/META-INF/persistence.xml
+++ b/systests/rs-security/src/test/resources/META-INF/persistence.xml
@@ -14,6 +14,7 @@
         <class>org.apache.cxf.rs.security.oauth2.common.AccessToken</class>
         <class>org.apache.cxf.rs.security.oauth2.common.OAuthPermission</class>
         <class>org.apache.cxf.rs.security.oauth2.tokens.refresh.RefreshToken</class>
+        <class>org.apache.cxf.rs.security.oidc.idp.OidcUserSubject</class>
         <exclude-unlisted-classes>true</exclude-unlisted-classes>
         <shared-cache-mode>ENABLE_SELECTIVE</shared-cache-mode>
         <properties>
diff --git a/systests/rs-security/src/test/resources/org/apache/cxf/systest/jaxrs/security/oidc/oidc-server-jpa.xml b/systests/rs-security/src/test/resources/org/apache/cxf/systest/jaxrs/security/oidc/oidc-server-jpa.xml
index 4e0d9db807..61a9e4cfd5 100644
--- a/systests/rs-security/src/test/resources/org/apache/cxf/systest/jaxrs/security/oidc/oidc-server-jpa.xml
+++ b/systests/rs-security/src/test/resources/org/apache/cxf/systest/jaxrs/security/oidc/oidc-server-jpa.xml
@@ -81,12 +81,14 @@ under the License.
    
    <bean id="authorizationService" class="org.apache.cxf.rs.security.oidc.idp.OidcAuthorizationCodeService">
       <property name="dataProvider" ref="oauthProvider"/>
+      <property name="subjectCreator" ref="subjectCreator"/>
    </bean>
    
    <bean id="implicitService" class="org.apache.cxf.rs.security.oidc.idp.OidcImplicitService">
       <property name="dataProvider" ref="oauthProvider"/>
       <property name="responseFilter" ref="idTokenFilter"/>
-      <property name="idTokenProvider" ref="idTokenProviderImpl"/>
+      <!-- <property name="idTokenProvider" ref="idTokenProviderImpl"/> -->
+      <property name="subjectCreator" ref="subjectCreator"/>
    </bean>
 
    <bean id="refreshGrantHandler" class="org.apache.cxf.rs.security.oauth2.grants.refresh.RefreshTokenGrantHandler">
@@ -99,10 +101,11 @@ under the License.
       <property name="codeVerifierTransformer" ref="digestVerifier"/>
    </bean>
 
-   <bean id="idTokenProviderImpl" class="org.apache.cxf.systest.jaxrs.security.oidc.IdTokenProviderImpl"/>
+   <!-- <bean id="idTokenProviderImpl" class="org.apache.cxf.systest.jaxrs.security.oidc.IdTokenProviderImpl"/> -->
+    <bean id="subjectCreator" class="org.apache.cxf.systest.jaxrs.security.oidc.SubjectCreatorImpl" />
 
    <bean id="idTokenFilter" class="org.apache.cxf.rs.security.oidc.idp.IdTokenResponseFilter">
-       <property name="idTokenProvider" ref="idTokenProviderImpl"/>
+       <!-- <property name="idTokenProvider" ref="idTokenProviderImpl"/> -->
    </bean>
    
    <bean id="tokenService" class="org.apache.cxf.rs.security.oauth2.services.AccessTokenService">
@@ -119,7 +122,8 @@ under the License.
    <bean id="hybridService" class="org.apache.cxf.rs.security.oidc.idp.OidcHybridService">
       <property name="dataProvider" ref="oauthProvider"/>
       <property name="responseFilter" ref="idTokenFilter"/>
-      <property name="idTokenProvider" ref="idTokenProviderImpl"/>
+      <!-- <property name="idTokenProvider" ref="idTokenProviderImpl"/> -->
+      <property name="subjectCreator" ref="subjectCreator"/>
       <property name="codeService" ref="authorizationService"/>
    </bean>
    
