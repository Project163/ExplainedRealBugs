diff --git a/api/src/main/java/org/apache/cxf/staxutils/transform/DelegatingNamespaceContext.java b/api/src/main/java/org/apache/cxf/staxutils/transform/DelegatingNamespaceContext.java
index 9b952d5f93..c9a7dd77b6 100644
--- a/api/src/main/java/org/apache/cxf/staxutils/transform/DelegatingNamespaceContext.java
+++ b/api/src/main/java/org/apache/cxf/staxutils/transform/DelegatingNamespaceContext.java
@@ -82,7 +82,9 @@ class DelegatingNamespaceContext implements NamespaceContext {
             }
         }
         String ns = nc.getNamespaceURI(prefix);
-        addPrefix(prefix, ns);
+        if (ns != null) {
+            addPrefix(prefix, ns);
+        }
         return ns;
     }
 
@@ -100,7 +102,9 @@ class DelegatingNamespaceContext implements NamespaceContext {
             return prefixes.get(0).get(actualNs);
         }
         String prefix = nc.getPrefix(actualNs);
-        addPrefix(prefix, actualNs);
+        if (prefix != null) {
+            addPrefix(prefix, actualNs);
+        }
         return prefix;
     }
 
diff --git a/api/src/main/java/org/apache/cxf/staxutils/transform/InTransformReader.java b/api/src/main/java/org/apache/cxf/staxutils/transform/InTransformReader.java
index 89a8ed5a9f..3a359b58ee 100644
--- a/api/src/main/java/org/apache/cxf/staxutils/transform/InTransformReader.java
+++ b/api/src/main/java/org/apache/cxf/staxutils/transform/InTransformReader.java
@@ -306,6 +306,8 @@ public class InTransformReader extends DepthXMLStreamReader {
         String actualNs = nsMap.get(ns);
         if (actualNs != null) {
             return actualNs;
+        } else if (ns.equals(reader.getNamespaceURI())) {
+            return getNamespaceURI();
         } else {
             return ns;
         }
@@ -320,6 +322,8 @@ public class InTransformReader extends DepthXMLStreamReader {
             } else {
                 return "";
             }
+        } else if (ns.equals(reader.getNamespaceURI())) {
+            return getPrefix();
         } else {
             return namespaceContext.getPrefix(ns);
         }
diff --git a/api/src/main/java/org/apache/cxf/staxutils/transform/OutTransformWriter.java b/api/src/main/java/org/apache/cxf/staxutils/transform/OutTransformWriter.java
index 0573566c7d..7f52c25cb1 100644
--- a/api/src/main/java/org/apache/cxf/staxutils/transform/OutTransformWriter.java
+++ b/api/src/main/java/org/apache/cxf/staxutils/transform/OutTransformWriter.java
@@ -49,6 +49,7 @@ public class OutTransformWriter extends DelegatingXMLStreamWriter {
     private Set<QName> dropElements;
     private Stack<List<ParsingEvent>> pushedAheadEvents = new Stack<List<ParsingEvent>>();
     private Stack<QName> elementsStack = new Stack<QName>();
+    private String replaceNamespace;
     private String replaceText;
     private int currentDepth;
     private int dropDepth;
@@ -95,7 +96,8 @@ public class OutTransformWriter extends DelegatingXMLStreamWriter {
             return;
         }
         String value = nsMap.get(uri);
-        if (value != null && value.length() == 0) {
+        if ((value != null && value.length() == 0)
+            || uri.equals(replaceNamespace)) {
             return;
         }
         
@@ -108,11 +110,13 @@ public class OutTransformWriter extends DelegatingXMLStreamWriter {
         
         if (defaultNamespace != null && defaultNamespace.equals(uri)) {
             super.writeDefaultNamespace(uri);
+            namespaceContext.addPrefix("", uri);
         } else {
             if (prefix.length() == 0) {
                 prefix = namespaceContext.findUniquePrefix(uri);
             }
             super.writeNamespace(prefix, uri);
+            namespaceContext.addPrefix(prefix, uri);
         }
         writtenUris.get(0).add(uri);
     }
@@ -125,7 +129,8 @@ public class OutTransformWriter extends DelegatingXMLStreamWriter {
         }
         String value = nsMap.get(uri);
         if ((value != null && value.length() == 0) 
-            || (isDefaultNamespaceRedefined() && !isDefaultNamespaceRedefined(uri))) {
+            || (isDefaultNamespaceRedefined() && !isDefaultNamespaceRedefined(uri))
+            || uri.equals(replaceNamespace)) {
             return;
         }
         
@@ -135,7 +140,7 @@ public class OutTransformWriter extends DelegatingXMLStreamWriter {
             return;
         }
         super.writeDefaultNamespace(uri);
-
+        namespaceContext.addPrefix("", uri);
         writtenUris.get(0).add(uri);
     }
 
@@ -252,6 +257,8 @@ public class OutTransformWriter extends DelegatingXMLStreamWriter {
         }
         pushedAheadEvents.push(pe);
         elementsStack.push(expected);
+        replaceNamespace = expected.getNamespaceURI().equals(theName.getNamespaceURI()) 
+            ? null : theName.getNamespaceURI();
 
         if (appendProp != null && !replaceContent && appendProp.isChild()) {
             // ap-post-*
@@ -360,16 +367,15 @@ public class OutTransformWriter extends DelegatingXMLStreamWriter {
                 }
             } else {
                 prefix = qname.getPrefix();
-                namespaceContext.addPrefix(prefix, qname.getNamespaceURI());    
             }
             
-        }
+        } 
         if (isDefaultNamespaceRedefined(qname.getNamespaceURI())) {
             prefix = "";
         }
-        
         super.writeStartElement(prefix, qname.getLocalPart(), qname.getNamespaceURI());
-        if (writeNs) {
+        if (writeNs 
+            || !qname.getNamespaceURI().equals(namespaceContext.getNamespaceURI(prefix))) {
             this.writeNamespace(prefix, qname.getNamespaceURI());
         }
     }
diff --git a/api/src/main/java/org/apache/cxf/staxutils/transform/TransformUtils.java b/api/src/main/java/org/apache/cxf/staxutils/transform/TransformUtils.java
index 377913cb7b..28dc8eb3c9 100644
--- a/api/src/main/java/org/apache/cxf/staxutils/transform/TransformUtils.java
+++ b/api/src/main/java/org/apache/cxf/staxutils/transform/TransformUtils.java
@@ -97,7 +97,8 @@ public final class TransformUtils {
                 QName lname = XMLUtils.convertStringToQName(entry.getKey());
                 QName rname = XMLUtils.convertStringToQName(entry.getValue());
                 elementsMap.put(lname, rname);
-                if (nsMap != null && !isEmptyQName(rname)) {
+                if (nsMap != null && !isEmptyQName(rname)
+                    && ("*".equals(lname.getLocalPart()) && "*".equals(rname.getLocalPart()))) {
                     nsMap.put(lname.getNamespaceURI(), rname.getNamespaceURI());
                 }
             }
diff --git a/api/src/test/java/org/apache/cxf/staxutils/transform/OutTransformWriterTest.java b/api/src/test/java/org/apache/cxf/staxutils/transform/OutTransformWriterTest.java
index 834f06700d..6afb2d0bfe 100644
--- a/api/src/test/java/org/apache/cxf/staxutils/transform/OutTransformWriterTest.java
+++ b/api/src/test/java/org/apache/cxf/staxutils/transform/OutTransformWriterTest.java
@@ -115,9 +115,9 @@ public class OutTransformWriterTest extends Assert {
         String xmlPI = "<?xml version='1.0' encoding='UTF-8'?>";
         String start = "<testBean xmlns=\"http://testbeans.com/v2\"";
         String expected1 = xmlPI + start
-            + " xmlns:ps2=\"http://testbeans.com/v3\"><ps2:bean/></testBean>";
+            + " xmlns:ps1=\"http://testbeans.com/v3\"><ps1:bean/></testBean>";
         String expected2 = xmlPI + start
-            + "><ps2:bean xmlns:ps2=\"http://testbeans.com/v3\"/></testBean>";
+            + "><ps1:bean xmlns:ps1=\"http://testbeans.com/v3\"/></testBean>";
         String out = os.toString();
         assertTrue("Output \"" + out + "\" does not match expected values",
                 expected1.equals(out) || expected2.equals(out));
