diff --git a/core/src/main/java/org/apache/cxf/common/jaxb/JAXBUtils.java b/core/src/main/java/org/apache/cxf/common/jaxb/JAXBUtils.java
index e8f750b5ef..28294a427e 100644
--- a/core/src/main/java/org/apache/cxf/common/jaxb/JAXBUtils.java
+++ b/core/src/main/java/org/apache/cxf/common/jaxb/JAXBUtils.java
@@ -68,6 +68,7 @@ import org.w3c.dom.Node;
 import org.xml.sax.EntityResolver;
 import org.xml.sax.InputSource;
 
+import org.apache.cxf.common.classloader.ClassLoaderUtils;
 import org.apache.cxf.common.util.ASMHelper;
 import org.apache.cxf.common.util.ASMHelper.ClassWriter;
 import org.apache.cxf.common.util.ASMHelper.FieldVisitor;
@@ -1008,17 +1009,32 @@ public final class JAXBUtils {
         className += postFix;
         Class<?> cls = helper.findClass(className, JAXBUtils.class);
         if (cls == null) {
-            ClassWriter cw = helper.createClassWriter();
-            if (cw == null) {
-                return null;
+            try {
+                ClassWriter cw = helper.createClassWriter();
+                if (cw != null) { 
+                    cls = createNamespaceWrapperInternal(helper, cw, postFix, mcls);
+                }
+            } catch (RuntimeException ex) {
+                // continue
             }
-            cls = createNamespaceWrapperInternal(helper, cw, postFix, mcls);
         }
-        try {
-            return cls.getConstructor(Map.class).newInstance(map);
-        } catch (Exception e) {
-            return null;
+        if (cls == null
+            && (mcls.getName().contains(".internal.") || mcls.getName().contains("com.sun"))) {
+            try {
+                cls = ClassLoaderUtils.loadClass("org.apache.cxf.common.jaxb.NamespaceMapper", 
+                                                 JAXBUtils.class);
+            } catch (ClassNotFoundException ex2) {
+                // ignore
+            }
         }
+        if (cls != null) {
+            try {
+                return cls.getConstructor(Map.class).newInstance(map);
+            } catch (Exception e) {
+                // ignore
+            }
+        }
+        return null;
     }
     /*
     // This is the "prototype" for the ASM generated class below
diff --git a/rt/frontend/jaxrs/src/main/java/org/apache/cxf/jaxrs/provider/AbstractJAXBProvider.java b/rt/frontend/jaxrs/src/main/java/org/apache/cxf/jaxrs/provider/AbstractJAXBProvider.java
index da1dce89c2..ff6d5a76d8 100644
--- a/rt/frontend/jaxrs/src/main/java/org/apache/cxf/jaxrs/provider/AbstractJAXBProvider.java
+++ b/rt/frontend/jaxrs/src/main/java/org/apache/cxf/jaxrs/provider/AbstractJAXBProvider.java
@@ -153,7 +153,7 @@ public abstract class AbstractJAXBProvider<T> extends AbstractConfigurableProvid
     protected void setNamespaceMapper(Marshaller ms, 
                                       Map<String, String> map) throws Exception {
         Object nsMapper = JAXBUtils.setNamespaceMapper(map, ms);
-        if (namespaceMapperPropertyName != null) {
+        if (nsMapper != null && namespaceMapperPropertyName != null) {
             setMarshallerProp(ms, nsMapper, namespaceMapperPropertyName, null);
         }
     }
diff --git a/rt/rs/extensions/providers/src/main/java/org/apache/cxf/jaxrs/provider/json/JSONProvider.java b/rt/rs/extensions/providers/src/main/java/org/apache/cxf/jaxrs/provider/json/JSONProvider.java
index 24f9182daf..d3ee71994c 100644
--- a/rt/rs/extensions/providers/src/main/java/org/apache/cxf/jaxrs/provider/json/JSONProvider.java
+++ b/rt/rs/extensions/providers/src/main/java/org/apache/cxf/jaxrs/provider/json/JSONProvider.java
@@ -495,6 +495,9 @@ public class JSONProvider<T> extends AbstractJAXBProvider<T>  {
         }
         XMLStreamWriter writer = createWriter(actualObject, actualClass, genericType, enc, 
                                               actualOs, isCollection);
+        if (namespaceMap.size() > 1 || namespaceMap.size() == 1 && !namespaceMap.containsKey(JSONUtils.XSI_URI)) {
+            setNamespaceMapper(ms, namespaceMap);
+        }
         ms.marshal(actualObject, writer);
         writer.close();
         if (os != actualOs) {
@@ -605,9 +608,6 @@ public class JSONProvider<T> extends AbstractJAXBProvider<T>  {
         }
         
         Marshaller ms = createMarshaller(actualObject, actualClass, genericType, enc);
-        if (!namespaceMap.isEmpty()) {
-            setNamespaceMapper(ms, namespaceMap);
-        }
         marshal(ms, actualObject, actualClass, genericType, enc, os, false);
     }
     
diff --git a/rt/rs/extensions/providers/src/main/java/org/apache/cxf/jaxrs/provider/json/utils/JSONUtils.java b/rt/rs/extensions/providers/src/main/java/org/apache/cxf/jaxrs/provider/json/utils/JSONUtils.java
index fa68e958d3..c194cfc88c 100644
--- a/rt/rs/extensions/providers/src/main/java/org/apache/cxf/jaxrs/provider/json/utils/JSONUtils.java
+++ b/rt/rs/extensions/providers/src/main/java/org/apache/cxf/jaxrs/provider/json/utils/JSONUtils.java
@@ -55,8 +55,8 @@ import org.codehaus.jettison.mapped.TypeConverter;
 
 public final class JSONUtils {
 
-    private static final String XSI_PREFIX = "xsi";
-    private static final String XSI_URI = WSDLConstants.NS_SCHEMA_XSI; 
+    public static final String XSI_PREFIX = "xsi";
+    public static final String XSI_URI = WSDLConstants.NS_SCHEMA_XSI; 
     
     private JSONUtils() {
     }
