diff --git a/core/src/main/java/org/apache/cxf/common/util/CompressionUtils.java b/core/src/main/java/org/apache/cxf/common/util/CompressionUtils.java
index 6b48aa7c17..c80352e431 100644
--- a/core/src/main/java/org/apache/cxf/common/util/CompressionUtils.java
+++ b/core/src/main/java/org/apache/cxf/common/util/CompressionUtils.java
@@ -72,7 +72,11 @@ public final class CompressionUtils {
     }
     
     public static byte[] deflate(byte[] tokenBytes, boolean nowrap) {
-        Deflater compresser = new Deflater(Deflater.DEFLATED, nowrap);
+        return deflate(tokenBytes, Deflater.DEFLATED, nowrap);
+    }
+    
+    public static byte[] deflate(byte[] tokenBytes, int level, boolean nowrap) {
+        Deflater compresser = new Deflater(level, nowrap);
         
         compresser.setInput(tokenBytes);
         compresser.finish();
diff --git a/rt/rs/security/xml/src/main/java/org/apache/cxf/rs/security/saml/DeflateEncoderDecoder.java b/rt/rs/security/xml/src/main/java/org/apache/cxf/rs/security/saml/DeflateEncoderDecoder.java
index 0b2925e38a..c1b20c87b8 100644
--- a/rt/rs/security/xml/src/main/java/org/apache/cxf/rs/security/saml/DeflateEncoderDecoder.java
+++ b/rt/rs/security/xml/src/main/java/org/apache/cxf/rs/security/saml/DeflateEncoderDecoder.java
@@ -20,8 +20,12 @@ package org.apache.cxf.rs.security.saml;
 
 import java.io.InputStream;
 import java.util.zip.DataFormatException;
+import java.util.zip.Deflater;
 
 import org.apache.cxf.common.util.CompressionUtils;
+import org.apache.cxf.common.util.PropertyUtils;
+import org.apache.cxf.message.Message;
+import org.apache.cxf.phase.PhaseInterceptorChain;
 
 public class DeflateEncoderDecoder {
     public InputStream inflateToken(byte[] deflatedToken) 
@@ -30,6 +34,30 @@ public class DeflateEncoderDecoder {
     }
     
     public byte[] deflateToken(byte[] tokenBytes) {
-        return CompressionUtils.deflate(tokenBytes);
+        
+        return deflateToken(tokenBytes, true);
+    }
+    
+    public byte[] deflateToken(byte[] tokenBytes, boolean nowrap) {
+        
+        return deflateToken(tokenBytes, getDeflateLevel(), nowrap);
+    }
+    
+    public byte[] deflateToken(byte[] tokenBytes, int level, boolean nowrap) {
+        
+        return CompressionUtils.deflate(tokenBytes, level, nowrap);
+    }
+    
+    private static int getDeflateLevel() {
+        Integer level = null;
+        
+        Message m = PhaseInterceptorChain.getCurrentMessage();
+        if (m != null) {
+            level = PropertyUtils.getInteger(m, "deflate.level");
+        }
+        if (level == null) {
+            level = Deflater.DEFLATED;
+        }
+        return level;
     }
 }
diff --git a/rt/rs/security/xml/src/test/java/org/apache/cxf/rs/security/saml/DeflateEncoderDecoderTest.java b/rt/rs/security/xml/src/test/java/org/apache/cxf/rs/security/saml/DeflateEncoderDecoderTest.java
index 47de912502..15a2512a00 100644
--- a/rt/rs/security/xml/src/test/java/org/apache/cxf/rs/security/saml/DeflateEncoderDecoderTest.java
+++ b/rt/rs/security/xml/src/test/java/org/apache/cxf/rs/security/saml/DeflateEncoderDecoderTest.java
@@ -18,8 +18,11 @@
  */
 package org.apache.cxf.rs.security.saml;
 
+import java.io.ByteArrayInputStream;
 import java.io.InputStream;
 import java.util.zip.DataFormatException;
+import java.util.zip.Inflater;
+import java.util.zip.InflaterInputStream;
 
 import org.apache.cxf.common.util.Base64Utility;
 import org.apache.cxf.helpers.IOUtils;
@@ -62,5 +65,21 @@ public class DeflateEncoderDecoderTest extends Assert {
         assertNotNull(is);
         assertEquals("valid_grant", IOUtils.readStringFromStream(is));
     }
-    
+    @Test
+    public void testInflateDeflateWithTokenDuplication() throws Exception {
+        String token = "valid_grant valid_grant valid_grant valid_grant valid_grant valid_grant";
+
+        DeflateEncoderDecoder deflateEncoderDecoder = new DeflateEncoderDecoder();
+        byte[] deflatedToken = deflateEncoderDecoder.deflateToken(token.getBytes(), 0, true);
+
+        String cxfInflatedToken = IOUtils
+                .toString(deflateEncoderDecoder.inflateToken(deflatedToken));
+
+        String streamInflatedToken = IOUtils.toString(
+                new InflaterInputStream(new ByteArrayInputStream(deflatedToken),
+                        new Inflater(true)));
+
+        assertEquals(streamInflatedToken, token);
+        assertEquals(cxfInflatedToken, token);
+    }
 }
