diff --git a/api/src/main/java/org/apache/cxf/databinding/AbstractDataBinding.java b/api/src/main/java/org/apache/cxf/databinding/AbstractDataBinding.java
index e01c4866cb..d91b87ebdb 100644
--- a/api/src/main/java/org/apache/cxf/databinding/AbstractDataBinding.java
+++ b/api/src/main/java/org/apache/cxf/databinding/AbstractDataBinding.java
@@ -89,8 +89,11 @@ public abstract class AbstractDataBinding implements DataBinding {
         }
         SchemaInfo schema = new SchemaInfo(serviceInfo, ns);
         schema.setSystemId(systemId);
-        XmlSchema xmlSchema = col.read(d, systemId, null);
-        schema.setSchema(xmlSchema);
+        XmlSchema xmlSchema;
+        synchronized (d) {
+            xmlSchema = col.read(d, systemId, null);
+            schema.setSchema(xmlSchema);
+        }
         serviceInfo.addSchema(schema);
         return xmlSchema;
     }
diff --git a/api/src/main/java/org/apache/cxf/message/Message.java b/api/src/main/java/org/apache/cxf/message/Message.java
index 71b6e0ac89..987dea655c 100644
--- a/api/src/main/java/org/apache/cxf/message/Message.java
+++ b/api/src/main/java/org/apache/cxf/message/Message.java
@@ -57,6 +57,7 @@ public interface Message extends StringMap {
     String ENCODING = Message.class.getName() + ".ENCODING";
     String FIXED_PARAMETER_ORDER = Message.class.getName() + "FIXED_PARAMETER_ORDER";
     String MAINTAIN_SESSION = Message.class.getName() + ".MAINTAIN_SESSION";
+    String ATTACHMENTS = Message.class.getName() + ".ATTACHMENTS";
 
     String WSDL_DESCRIPTION = "javax.xml.ws.wsdl.description";
     String WSDL_SERVICE = "javax.xml.ws.wsdl.service";
diff --git a/api/src/main/java/org/apache/cxf/message/MessageImpl.java b/api/src/main/java/org/apache/cxf/message/MessageImpl.java
index df1f56c498..4791b28324 100644
--- a/api/src/main/java/org/apache/cxf/message/MessageImpl.java
+++ b/api/src/main/java/org/apache/cxf/message/MessageImpl.java
@@ -49,6 +49,7 @@ public class MessageImpl extends StringMapImpl implements Message {
 
     public void setAttachments(Collection<Attachment> attachments) {
         this.attachments = attachments;
+        put(ATTACHMENTS, attachments);
     }
 
     public String getAttachmentMimeType() {
diff --git a/api/src/main/java/org/apache/cxf/service/model/SchemaInfo.java b/api/src/main/java/org/apache/cxf/service/model/SchemaInfo.java
index edea13187d..dd36cc5493 100644
--- a/api/src/main/java/org/apache/cxf/service/model/SchemaInfo.java
+++ b/api/src/main/java/org/apache/cxf/service/model/SchemaInfo.java
@@ -76,10 +76,13 @@ public final class SchemaInfo extends AbstractPropertiesHolder {
         this.namespaceUri = nsUri;
     }
 
-    public Element getElement() {
+    public synchronized Element getElement() {
         if (element == null && getSchema() != null) {
             CachedOutputStream cout = new CachedOutputStream();
-            getSchema().write(cout);
+            XmlSchema sch = getSchema();
+            synchronized (sch) {
+                getSchema().write(cout);
+            }
             Document sdoc = null;
             try {
                 sdoc = XMLUtils.parse(cout.getInputStream());
diff --git a/api/src/main/java/org/apache/cxf/wsdl/EndpointReferenceUtils.java b/api/src/main/java/org/apache/cxf/wsdl/EndpointReferenceUtils.java
index 3216ced9e0..19b4ba7125 100644
--- a/api/src/main/java/org/apache/cxf/wsdl/EndpointReferenceUtils.java
+++ b/api/src/main/java/org/apache/cxf/wsdl/EndpointReferenceUtils.java
@@ -564,14 +564,11 @@ public final class EndpointReferenceUtils {
         return null;
     }
     
-    public static Schema getSchema(ServiceInfo serviceInfo) {
-        if (serviceInfo == null) {
-            return null;
-        }
+    
+    private static Schema createSchema(ServiceInfo serviceInfo) {
         Schema schema = serviceInfo.getProperty(Schema.class.getName(), Schema.class);
-        if (schema == null && !serviceInfo.hasProperty(Schema.class.getName())) {
-            SchemaFactory factory = SchemaFactory.newInstance(
-                XMLConstants.W3C_XML_SCHEMA_NS_URI);
+        if (schema == null) {
+            SchemaFactory factory = SchemaFactory.newInstance(XMLConstants.W3C_XML_SCHEMA_NS_URI);
             List<Source> schemaSources = new ArrayList<Source>();
             for (SchemaInfo schemaInfo : serviceInfo.getSchemas()) {
                 Source source = new DOMSource(schemaInfo.getElement());
@@ -594,7 +591,20 @@ public final class EndpointReferenceUtils {
                     LOG.log(Level.WARNING, "Schema for: " + schemaInfo.getNamespaceURI() + "\n" + s);
                 }
             }
-            serviceInfo.setProperty(Schema.class.getName(), schema);            
+            serviceInfo.setProperty(Schema.class.getName(), schema);
+        }
+        return schema;
+    }
+    
+    public static Schema getSchema(ServiceInfo serviceInfo) {
+        if (serviceInfo == null) {
+            return null;
+        }
+        Schema schema = serviceInfo.getProperty(Schema.class.getName(), Schema.class);
+        if (schema == null && !serviceInfo.hasProperty(Schema.class.getName())) {
+            synchronized (serviceInfo) {
+                return createSchema(serviceInfo);
+            }
         }
         return schema;
     }
diff --git a/common/common/src/main/java/org/apache/cxf/staxutils/StaxUtils.java b/common/common/src/main/java/org/apache/cxf/staxutils/StaxUtils.java
index 911ccf83c5..37643e52d7 100644
--- a/common/common/src/main/java/org/apache/cxf/staxutils/StaxUtils.java
+++ b/common/common/src/main/java/org/apache/cxf/staxutils/StaxUtils.java
@@ -50,7 +50,6 @@ import org.w3c.dom.Element;
 import org.w3c.dom.EntityReference;
 import org.w3c.dom.NamedNodeMap;
 import org.w3c.dom.Node;
-import org.w3c.dom.NodeList;
 import org.w3c.dom.ProcessingInstruction;
 import org.w3c.dom.Text;
 
@@ -530,11 +529,11 @@ public final class StaxUtils {
             }
         }
 
-        NodeList nodes = e.getChildNodes();
-        for (int i = 0; i < nodes.getLength(); i++) {
-            Node n = nodes.item(i);
-            writeNode(n, writer, repairing);
-        }
+        Node nd = e.getFirstChild();
+        while (nd != null) {
+            writeNode(nd, writer, repairing);
+            nd = nd.getNextSibling();
+        }       
 
         if (endElement) {
             writer.writeEndElement();
@@ -545,10 +544,10 @@ public final class StaxUtils {
         throws XMLStreamException {
         if (n instanceof Element) {
             writeElement((Element)n, writer, repairing);
-        } else if (n instanceof Text) {
-            writer.writeCharacters(((Text)n).getNodeValue());
         } else if (n instanceof CDATASection) {
             writer.writeCData(((CDATASection)n).getData());
+        } else if (n instanceof Text) {
+            writer.writeCharacters(((Text)n).getNodeValue());
         } else if (n instanceof Comment) {
             writer.writeComment(((Comment)n).getData());
         } else if (n instanceof EntityReference) {
diff --git a/rt/core/src/main/java/org/apache/cxf/wsdl11/SchemaUtil.java b/rt/core/src/main/java/org/apache/cxf/wsdl11/SchemaUtil.java
index 83c85e7b77..f417d9dbd8 100644
--- a/rt/core/src/main/java/org/apache/cxf/wsdl11/SchemaUtil.java
+++ b/rt/core/src/main/java/org/apache/cxf/wsdl11/SchemaUtil.java
@@ -93,27 +93,29 @@ public final class SchemaUtil {
                     }
                 }
                 if (schemaElem != null) {
-                    for (Object prefix : def.getNamespaces().keySet()) {
-                        String ns = (String)def.getNamespaces().get(prefix);
-                        if (!"".equals(prefix) && !schemaElem.hasAttribute("xmlns:" + prefix)) {
-                            schemaElem.setAttributeNS(javax.xml.XMLConstants.XMLNS_ATTRIBUTE_NS_URI,
-                                                      "xmlns:" + prefix, ns);
+                    synchronized (schemaElem.getOwnerDocument()) {
+                        for (Object prefix : def.getNamespaces().keySet()) {
+                            String ns = (String)def.getNamespaces().get(prefix);
+                            if (!"".equals(prefix) && !schemaElem.hasAttribute("xmlns:" + prefix)) {
+                                schemaElem.setAttributeNS(javax.xml.XMLConstants.XMLNS_ATTRIBUTE_NS_URI,
+                                                          "xmlns:" + prefix, ns);
+                            }
                         }
+                        String systemId = def.getDocumentBaseURI() + "#types" + schemaCount;
+    
+                        schemaCol.setBaseUri(def.getDocumentBaseURI());
+                        CatalogXmlSchemaURIResolver schemaResolver =
+                            new CatalogXmlSchemaURIResolver(OASISCatalogManager.getCatalogManager(bus));
+                        schemaCol.setSchemaResolver(schemaResolver);
+                        
+                        XmlSchema xmlSchema = schemaCol.read(schemaElem, systemId);
+                        SchemaInfo schemaInfo = new SchemaInfo(serviceInfo, xmlSchema.getTargetNamespace());
+                        schemaInfo.setElement(schemaElem);
+                        schemaInfo.setSchema(xmlSchema);
+                        schemaInfo.setSystemId(systemId);
+                        serviceInfo.addSchema(schemaInfo);
+                        schemaCount++;
                     }
-                    String systemId = def.getDocumentBaseURI() + "#types" + schemaCount;
-
-                    schemaCol.setBaseUri(def.getDocumentBaseURI());
-                    CatalogXmlSchemaURIResolver schemaResolver =
-                        new CatalogXmlSchemaURIResolver(OASISCatalogManager.getCatalogManager(bus));
-                    schemaCol.setSchemaResolver(schemaResolver);
-                    
-                    XmlSchema xmlSchema = schemaCol.read(schemaElem, systemId);
-                    SchemaInfo schemaInfo = new SchemaInfo(serviceInfo, xmlSchema.getTargetNamespace());
-                    schemaInfo.setElement(schemaElem);
-                    schemaInfo.setSchema(xmlSchema);
-                    schemaInfo.setSystemId(systemId);
-                    serviceInfo.addSchema(schemaInfo);
-                    schemaCount++;
                 }
             }
         }
diff --git a/rt/frontend/jaxws/src/main/java/org/apache/cxf/jaxws/interceptors/WrapperHelperCompiler.java b/rt/frontend/jaxws/src/main/java/org/apache/cxf/jaxws/interceptors/WrapperHelperCompiler.java
index f7963f8819..49822550b7 100644
--- a/rt/frontend/jaxws/src/main/java/org/apache/cxf/jaxws/interceptors/WrapperHelperCompiler.java
+++ b/rt/frontend/jaxws/src/main/java/org/apache/cxf/jaxws/interceptors/WrapperHelperCompiler.java
@@ -20,7 +20,7 @@ package org.apache.cxf.jaxws.interceptors;
 
 import java.lang.reflect.Field;
 import java.lang.reflect.Method;
-import java.util.Collection;
+import java.util.List;
 
 import javax.xml.bind.JAXBElement;
 
@@ -248,7 +248,7 @@ final class WrapperHelperCompiler extends ASMHelper {
             Class<?> tp = getMethods[x].getReturnType();
             mv.visitVarInsn(Opcodes.ALOAD, 2);            
             
-            if (Collection.class.isAssignableFrom(tp)) {
+            if (List.class.isAssignableFrom(tp)) {
                 doCollection(mv, x);
             } else { 
                 if (JAXBElement.class.isAssignableFrom(tp)) {
diff --git a/rt/frontend/jaxws/src/main/java/org/apache/cxf/jaxws/support/ContextPropertiesMapping.java b/rt/frontend/jaxws/src/main/java/org/apache/cxf/jaxws/support/ContextPropertiesMapping.java
index b7bb0df40c..2ccc2971df 100644
--- a/rt/frontend/jaxws/src/main/java/org/apache/cxf/jaxws/support/ContextPropertiesMapping.java
+++ b/rt/frontend/jaxws/src/main/java/org/apache/cxf/jaxws/support/ContextPropertiesMapping.java
@@ -129,6 +129,15 @@ public final class ContextPropertiesMapping {
             context.put(MessageContext.HTTP_RESPONSE_HEADERS, responseHeaders);
         }  
         mapContext(context, cxf2jaxwsMap);
+        
+        Collection<Attachment> attachments 
+            = CastUtils.cast((Collection<?>)context.get(Message.ATTACHMENTS));
+        Map<String, DataHandler> dataHandlers = getDHMap(attachments);
+        context.put(MessageContext.INBOUND_MESSAGE_ATTACHMENTS, dataHandlers);
+        Map<String, Scope> scopes = CastUtils.cast((Map<?, ?>)context.get(WrappedMessageContext.SCOPES));
+        if (scopes != null) {
+            scopes.put(MessageContext.INBOUND_MESSAGE_ATTACHMENTS, Scope.APPLICATION);
+        }
     }
     
     private static void mapJaxws2Cxf(Map<String, Object> context) {
@@ -229,13 +238,9 @@ public final class ContextPropertiesMapping {
         }
 
     }
-    
-    private static void addMessageAttachments(WrappedMessageContext ctx,
-                                              Message message,
-                                              String propertyName) {
-        Map<String, DataHandler> dataHandlers = null;
 
-        Collection<Attachment> attachments = message.getAttachments();
+    private static Map<String, DataHandler> getDHMap(Collection<Attachment> attachments) {
+        Map<String, DataHandler> dataHandlers = null;
         if (attachments != null) {
             if (attachments instanceof LazyAttachmentCollection) {
                 dataHandlers = ((LazyAttachmentCollection)attachments).createDataHandlerMap();
@@ -247,7 +252,14 @@ public final class ContextPropertiesMapping {
                 }
             }
         }
+        return dataHandlers;
+    }
+    private static void addMessageAttachments(WrappedMessageContext ctx,
+                                              Message message,
+                                              String propertyName) {
 
+        Collection<Attachment> attachments = message.getAttachments();
+        Map<String, DataHandler> dataHandlers = getDHMap(attachments);
         ctx.put(propertyName, 
                 dataHandlers == null ? new LinkedHashMap<String, DataHandler>()
                                      : dataHandlers,
diff --git a/systests/src/test/java/org/apache/cxf/systest/jaxws/ClientServerMiscTest.java b/systests/src/test/java/org/apache/cxf/systest/jaxws/ClientServerMiscTest.java
index 0e1026835f..cfc96968ae 100644
--- a/systests/src/test/java/org/apache/cxf/systest/jaxws/ClientServerMiscTest.java
+++ b/systests/src/test/java/org/apache/cxf/systest/jaxws/ClientServerMiscTest.java
@@ -25,6 +25,7 @@ import java.util.ArrayList;
 import java.util.Arrays;
 import java.util.Collections;
 import java.util.List;
+import java.util.Set;
 
 import javax.xml.namespace.QName;
 import javax.xml.ws.Holder;
@@ -263,6 +264,9 @@ public class ClientServerMiscTest extends AbstractBusClientServerTestBase {
         assertEquals("Hello", echoMsg);
     }
     private void runDocLitTest(DocLitWrappedCodeFirstService port) throws Exception {
+        Set<Foo> fooSet = port.getFooSet();
+        assertEquals(2, fooSet.size());
+        
         assertEquals(24, port.echoIntDifferentWrapperName(24));
         
         String echoMsg = port.echo("Hello");
diff --git a/systests/src/test/java/org/apache/cxf/systest/jaxws/DocLitWrappedCodeFirstService.java b/systests/src/test/java/org/apache/cxf/systest/jaxws/DocLitWrappedCodeFirstService.java
index 72c49cd2af..937f0954aa 100644
--- a/systests/src/test/java/org/apache/cxf/systest/jaxws/DocLitWrappedCodeFirstService.java
+++ b/systests/src/test/java/org/apache/cxf/systest/jaxws/DocLitWrappedCodeFirstService.java
@@ -19,6 +19,7 @@
 package org.apache.cxf.systest.jaxws;
 
 import java.util.List;
+import java.util.Set;
 import java.util.Vector;
 
 import javax.jws.WebMethod;
@@ -124,5 +125,6 @@ public interface DocLitWrappedCodeFirstService {
         }
     }
     
+    Set<Foo> getFooSet();
 
 }
diff --git a/systests/src/test/java/org/apache/cxf/systest/jaxws/DocLitWrappedCodeFirstServiceImpl.java b/systests/src/test/java/org/apache/cxf/systest/jaxws/DocLitWrappedCodeFirstServiceImpl.java
index d755780a6c..34793b410e 100644
--- a/systests/src/test/java/org/apache/cxf/systest/jaxws/DocLitWrappedCodeFirstServiceImpl.java
+++ b/systests/src/test/java/org/apache/cxf/systest/jaxws/DocLitWrappedCodeFirstServiceImpl.java
@@ -19,7 +19,9 @@
 package org.apache.cxf.systest.jaxws;
 
 import java.util.Arrays;
+import java.util.LinkedHashSet;
 import java.util.List;
+import java.util.Set;
 import java.util.Vector;
 
 import javax.annotation.Resource;
@@ -29,6 +31,7 @@ import javax.xml.ws.WebServiceContext;
 
 import org.apache.cxf.feature.Features;
 import org.apache.cxf.message.Exchange;
+import org.apache.cxf.systest.jaxws.DocLitWrappedCodeFirstService.Foo;
 import org.apache.cxf.systest.jaxws.types.Bar;
 import org.apache.cxf.systest.jaxws.types.BarImpl;
 
@@ -133,6 +136,10 @@ public class DocLitWrappedCodeFirstServiceImpl implements DocLitWrappedCodeFirst
         b.setName("b");
         return Arrays.asList(a, b);
     }
+    
+    public Set<Foo> getFooSet() {
+        return new LinkedHashSet<Foo>(listObjectOutput());
+    }
 
     public List<Foo[]> listObjectArrayOutput() {
         Foo a = new Foo();
diff --git a/tools/validator/src/main/java/org/apache/cxf/tools/validator/internal/ValidatorUtil.java b/tools/validator/src/main/java/org/apache/cxf/tools/validator/internal/ValidatorUtil.java
index 61ff7c7f78..aca8255337 100644
--- a/tools/validator/src/main/java/org/apache/cxf/tools/validator/internal/ValidatorUtil.java
+++ b/tools/validator/src/main/java/org/apache/cxf/tools/validator/internal/ValidatorUtil.java
@@ -84,43 +84,44 @@ public final class ValidatorUtil {
         if (document == null) {
             return schemaList;
         }
-        // URL might need encoding for special characters.
-        baseURI = URLEncoder.encode(baseURI, "utf-8");
-        SchemaCollection schemaCol = new SchemaCollection();
-        schemaCol.setBaseUri(baseURI);
-        NodeList nodes = document.getElementsByTagNameNS(
-            WSDLConstants.NS_SCHEMA_XSD, "schema");
-        for (int x = 0; x < nodes.getLength(); x++) {
-            Node schemaNode = nodes.item(x);
-            Element schemaEl = (Element) schemaNode;
-            String tns = schemaEl.getAttribute("targetNamespace");
-            try {
-                schemaCol.read(schemaEl, tns);
-            } catch (RuntimeException ex) {
-                LOG.log(Level.WARNING, "SCHEMA_READ_FAIL", tns);
-                //
-                // Couldn't find schema... check if it's relative to wsdl.
-                // XXX - Using setBaseUri() on the XmlSchemaCollection,
-                // only seems to work for the first imported xsd... so pass
-                // in the baseURI here.
-                //
+        synchronized (document) {
+            // URL might need encoding for special characters.
+            baseURI = URLEncoder.encode(baseURI, "utf-8");
+            SchemaCollection schemaCol = new SchemaCollection();
+            schemaCol.setBaseUri(baseURI);
+            NodeList nodes = document.getElementsByTagNameNS(
+                WSDLConstants.NS_SCHEMA_XSD, "schema");
+            for (int x = 0; x < nodes.getLength(); x++) {
+                Node schemaNode = nodes.item(x);
+                Element schemaEl = (Element) schemaNode;
+                String tns = schemaEl.getAttribute("targetNamespace");
                 try {
-                    schemaCol.read(schemaEl, baseURI);
-                } catch (RuntimeException ex2) {
-                    LOG.log(Level.WARNING, "SCHEMA_READ_FAIL", baseURI);
-                    continue;
+                    schemaCol.read(schemaEl, tns);
+                } catch (RuntimeException ex) {
+                    LOG.log(Level.WARNING, "SCHEMA_READ_FAIL", tns);
+                    //
+                    // Couldn't find schema... check if it's relative to wsdl.
+                    // XXX - Using setBaseUri() on the XmlSchemaCollection,
+                    // only seems to work for the first imported xsd... so pass
+                    // in the baseURI here.
+                    //
+                    try {
+                        schemaCol.read(schemaEl, baseURI);
+                    } catch (RuntimeException ex2) {
+                        LOG.log(Level.WARNING, "SCHEMA_READ_FAIL", baseURI);
+                        continue;
+                    }
                 }
             }
-        }
-        schemaList.add(schemaCol);
-        
-        // Now add schemas from imported wsdl files.
-        Map<String, Document> wsdlImports = getImportedWsdlMap(
-            document, baseURI);
-        for (Document wsdlImport : wsdlImports.values()) {
-            schemaList.addAll(getSchemaList(wsdlImport, baseURI));
-        }
-        
+            schemaList.add(schemaCol);
+            
+            // Now add schemas from imported wsdl files.
+            Map<String, Document> wsdlImports = getImportedWsdlMap(
+                document, baseURI);
+            for (Document wsdlImport : wsdlImports.values()) {
+                schemaList.addAll(getSchemaList(wsdlImport, baseURI));
+            }
+        }        
         return schemaList;
     }
     
diff --git a/tools/wsdlto/frontend/jaxws/src/main/java/org/apache/cxf/tools/wsdlto/frontend/jaxws/processor/internal/ProcessorUtil.java b/tools/wsdlto/frontend/jaxws/src/main/java/org/apache/cxf/tools/wsdlto/frontend/jaxws/processor/internal/ProcessorUtil.java
index aa7e4b52fb..1320267b46 100644
--- a/tools/wsdlto/frontend/jaxws/src/main/java/org/apache/cxf/tools/wsdlto/frontend/jaxws/processor/internal/ProcessorUtil.java
+++ b/tools/wsdlto/frontend/jaxws/src/main/java/org/apache/cxf/tools/wsdlto/frontend/jaxws/processor/internal/ProcessorUtil.java
@@ -364,7 +364,9 @@ public final class ProcessorUtil {
             Map<String, Element> maps = CastUtils.cast((Map<?, ?>)context.get(ToolConstants.SCHEMA_MAP));
             if (maps != null) {
                 for (Element ele : maps.values()) {
-                    schema.read(ele);
+                    synchronized (ele.getOwnerDocument()) {
+                        schema.read(ele);
+                    }
                 }
                 elementByName = schema.getElementByQName(partElement);
             }
