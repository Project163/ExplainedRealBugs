diff --git a/api/src/main/java/org/apache/cxf/message/MessageImpl.java b/api/src/main/java/org/apache/cxf/message/MessageImpl.java
index e31ed9201a..40d2b930d0 100644
--- a/api/src/main/java/org/apache/cxf/message/MessageImpl.java
+++ b/api/src/main/java/org/apache/cxf/message/MessageImpl.java
@@ -110,7 +110,7 @@ public class MessageImpl extends StringMapImpl implements Message {
         Object val = get(key);
         
         Exchange ex = getExchange();
-        if (val == null) {
+        if (val == null && ex != null) {
             val = ex.get(key);
         }
         
@@ -121,7 +121,7 @@ public class MessageImpl extends StringMapImpl implements Message {
             }
         }
         
-        if (val == null) {
+        if (val == null && ex != null) {
             Endpoint ep = ex.get(Endpoint.class); 
             if (ep != null) {
                 val = ep.get(key);
@@ -135,19 +135,17 @@ public class MessageImpl extends StringMapImpl implements Message {
                 }
 
             }
-        }
-        
-        if (val == null) {
-            Service ep = ex.get(Service.class); 
-            if (ep != null) {
-                val = ep.get(key);
-            }
-        }
-        
-        if (val == null) {
-            Bus bus = ex.get(Bus.class);
-            if (bus != null) {
-                val = bus.getProperty(key);
+            if (val == null) {
+                Service sv = ex.get(Service.class); 
+                if (sv != null) {
+                    val = sv.get(key);
+                }
+                if (val == null) {
+                    Bus bus = ex.get(Bus.class);
+                    if (bus != null) {
+                        val = bus.getProperty(key);
+                    }
+                }
             }
         }
         
diff --git a/rt/core/src/test/java/org/apache/cxf/attachment/AttachmentDeserializerTest.java b/rt/core/src/test/java/org/apache/cxf/attachment/AttachmentDeserializerTest.java
index b51215559d..c9603c678e 100644
--- a/rt/core/src/test/java/org/apache/cxf/attachment/AttachmentDeserializerTest.java
+++ b/rt/core/src/test/java/org/apache/cxf/attachment/AttachmentDeserializerTest.java
@@ -25,6 +25,11 @@ import java.io.PushbackInputStream;
 import java.util.Collection;
 import java.util.Iterator;
 
+import javax.xml.parsers.SAXParser;
+import javax.xml.parsers.SAXParserFactory;
+
+import org.xml.sax.helpers.DefaultHandler;
+
 import org.apache.cxf.helpers.IOUtils;
 import org.apache.cxf.message.Attachment;
 import org.apache.cxf.message.Exchange;
@@ -299,4 +304,33 @@ public class AttachmentDeserializerTest extends Assert {
         assertEquals(-1, m.read(new byte[1000]));
         assertEquals(-1, m.read(new byte[1000]));
     }
+    
+    @Test
+    public void testCXF2542() throws Exception {
+        StringBuffer buf = new StringBuffer();
+        buf.append("------=_Part_0_2180223.1203118300920\n");
+        buf.append("Content-Type: application/xop+xml; charset=UTF-8; type=\"text/xml\"\n");
+        buf.append("Content-Transfer-Encoding: 8bit\n");
+        buf.append("Content-ID: <soap.xml@xfire.codehaus.org>\n");
+        buf.append("\n");
+        buf.append("<soap:Envelope xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\" "
+                   + "xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" "
+                   + "xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">"
+                   + "<soap:Body><getNextMessage xmlns=\"http://foo.bar\" /></soap:Body>"
+                   + "</soap:Envelope>\n");
+        buf.append("------=_Part_0_2180223.1203118300920--\n");
+
+        InputStream rawInputStream = new ByteArrayInputStream(buf.toString().getBytes());
+        MessageImpl message = new MessageImpl();
+        message.setContent(InputStream.class, rawInputStream);
+        message.put(Message.CONTENT_TYPE, 
+                    "multipart/related; type=\"application/xop+xml\"; "
+                    + "start=\"<soap.xml@xfire.codehaus.org>\"; "
+                    + "start-info=\"text/xml\"; boundary=\"----=_Part_0_2180223.1203118300920\"");
+        new AttachmentDeserializer(message).initializeAttachments();
+        InputStream inputStreamWithoutAttachments = message.getContent(InputStream.class);
+        SAXParser parser = SAXParserFactory.newInstance().newSAXParser();
+        parser.parse(inputStreamWithoutAttachments, new DefaultHandler());
+        System.out.println("All done.");
+    }
 }
\ No newline at end of file
