diff --git a/common/common/src/main/java/org/apache/cxf/configuration/spring/AbstractBeanDefinitionParser.java b/common/common/src/main/java/org/apache/cxf/configuration/spring/AbstractBeanDefinitionParser.java
index 12a8859c77..762877c387 100644
--- a/common/common/src/main/java/org/apache/cxf/configuration/spring/AbstractBeanDefinitionParser.java
+++ b/common/common/src/main/java/org/apache/cxf/configuration/spring/AbstractBeanDefinitionParser.java
@@ -173,13 +173,7 @@ public abstract class AbstractBeanDefinitionParser
 
     protected void setFirstChildAsProperty(Element element, ParserContext ctx, 
                                          BeanDefinitionBuilder bean, String propertyName) {
-        String id = getAndRegisterFirstChild(element, ctx, bean, propertyName);
-        bean.addPropertyReference(propertyName, id);
-        
-    }
 
-    protected String getAndRegisterFirstChild(Element element, ParserContext ctx, 
-                                              BeanDefinitionBuilder bean, String propertyName) {
         Element first = getFirstChild(element);
         
         if (first == null) {
@@ -196,25 +190,22 @@ public abstract class AbstractBeanDefinitionParser
                 if (id == null) {
                     throw new IllegalStateException("<ref> elements must have a \"bean\" attribute!");
                 }
-                return id;
+                bean.addPropertyReference(propertyName, id);
+                return;
             } else if ("bean".equals(name)) {
                 BeanDefinitionHolder bdh = ctx.getDelegate().parseBeanDefinitionElement(first);
                 child = bdh.getBeanDefinition();
-                id = bdh.getBeanName();
+                bean.addPropertyValue(propertyName, child);
+                return;
             } else {
                 throw new UnsupportedOperationException("Elements with the name " + name  
                                                         + " are not currently "
                                                         + "supported as sub elements of " 
                                                         + element.getLocalName());
             }
-            
-        } else {
-            child = ctx.getDelegate().parseCustomElement(first, bean.getBeanDefinition());
-            id = child.toString();
         }
-       
-        ctx.getRegistry().registerBeanDefinition(id, child);
-        return id;
+        child = ctx.getDelegate().parseCustomElement(first, bean.getBeanDefinition());
+        bean.addPropertyValue(propertyName, child);
     }
 
     protected Element getFirstChild(Element element) {
diff --git a/rt/bindings/soap/src/main/java/org/apache/cxf/binding/soap/SoapBindingConfiguration.java b/rt/bindings/soap/src/main/java/org/apache/cxf/binding/soap/SoapBindingConfiguration.java
index 23201897ba..788e24e3e5 100644
--- a/rt/bindings/soap/src/main/java/org/apache/cxf/binding/soap/SoapBindingConfiguration.java
+++ b/rt/bindings/soap/src/main/java/org/apache/cxf/binding/soap/SoapBindingConfiguration.java
@@ -28,13 +28,18 @@ import org.apache.cxf.service.model.ServiceInfo;
 
 public class SoapBindingConfiguration extends BindingConfiguration {
     private SoapVersion soapVersion = Soap11.getInstance();
-    private String style = "document";
+    private String style;
     private String use;
     private String transportURI = "http://schemas.xmlsoap.org/soap/http";
     private String defaultSoapAction = "";
     private boolean mtomEnabled;
     private QName bindingName;
     private String bindingNamePostfix = "SoapBinding";
+    
+    public SoapBindingConfiguration() {
+        
+    }
+    
 
     @Override
     public String getBindingId() {
@@ -63,11 +68,15 @@ public class SoapBindingConfiguration extends BindingConfiguration {
         this.transportURI = transportURI;
     }
 
-    protected String getStyle() {
-        return style;
+    public boolean isSetStyle() {
+        return style != null;
+    }
+    
+    public String getStyle() {
+        return style == null ? "document" : style;
     }
 
-    protected String getStyle(OperationInfo op) {
+    public String getStyle(OperationInfo op) {
         return getStyle();
     }
 
diff --git a/rt/core/src/main/java/org/apache/cxf/transport/http/WSDLQueryHandler.java b/rt/core/src/main/java/org/apache/cxf/transport/http/WSDLQueryHandler.java
index f9b558515d..657f9ed72a 100644
--- a/rt/core/src/main/java/org/apache/cxf/transport/http/WSDLQueryHandler.java
+++ b/rt/core/src/main/java/org/apache/cxf/transport/http/WSDLQueryHandler.java
@@ -69,7 +69,10 @@ public class WSDLQueryHandler implements StemMatchingQueryHandler {
     
     public WSDLQueryHandler() {
     }
-
+    public WSDLQueryHandler(Bus b) {
+        bus = b;
+    }
+    
     public String getResponseContentType(String baseUri, String ctx) {
         if (baseUri.toLowerCase().contains("?wsdl")
             || baseUri.toLowerCase().contains("?xsd=")) {
diff --git a/rt/frontend/jaxws/src/main/java/org/apache/cxf/jaxws/binding/soap/JaxWsSoapBindingConfiguration.java b/rt/frontend/jaxws/src/main/java/org/apache/cxf/jaxws/binding/soap/JaxWsSoapBindingConfiguration.java
index 45a12c7a26..f17f6ddd31 100644
--- a/rt/frontend/jaxws/src/main/java/org/apache/cxf/jaxws/binding/soap/JaxWsSoapBindingConfiguration.java
+++ b/rt/frontend/jaxws/src/main/java/org/apache/cxf/jaxws/binding/soap/JaxWsSoapBindingConfiguration.java
@@ -41,7 +41,7 @@ public class JaxWsSoapBindingConfiguration extends SoapBindingConfiguration {
     }
 
     @Override
-    protected String getStyle() {
+    public String getStyle() {
         SOAPBinding sb = getServiceClass().getAnnotation(SOAPBinding.class);
         if (sb != null) {
             if (sb.style().equals(Style.DOCUMENT)) {
@@ -72,6 +72,6 @@ public class JaxWsSoapBindingConfiguration extends SoapBindingConfiguration {
                 return "encoded";
             }
         }
-        return super.getStyle();
+        return super.getUse();
     }
 }
diff --git a/rt/frontend/jaxws/src/main/java/org/apache/cxf/jaxws/support/JaxWsServiceConfiguration.java b/rt/frontend/jaxws/src/main/java/org/apache/cxf/jaxws/support/JaxWsServiceConfiguration.java
index 34f1d8fb70..0659632aa5 100644
--- a/rt/frontend/jaxws/src/main/java/org/apache/cxf/jaxws/support/JaxWsServiceConfiguration.java
+++ b/rt/frontend/jaxws/src/main/java/org/apache/cxf/jaxws/support/JaxWsServiceConfiguration.java
@@ -694,7 +694,7 @@ public class JaxWsServiceConfiguration extends AbstractServiceConfiguration {
         if (ann != null) {
             return ann.style().toString().toLowerCase();
         }
-        return "document";
+        return super.getStyle();
     }
     
     private boolean isDocumentBare(Method method) {
@@ -717,7 +717,7 @@ public class JaxWsServiceConfiguration extends AbstractServiceConfiguration {
         if (ann != null) {
             return ann.style().equals(SOAPBinding.Style.RPC);
         }
-        return Boolean.FALSE;
+        return super.isRPC(method);
     }
     
     
diff --git a/rt/frontend/jaxws/src/test/java/org/apache/cxf/jaxws/spring/SpringBeansTest.java b/rt/frontend/jaxws/src/test/java/org/apache/cxf/jaxws/spring/SpringBeansTest.java
index b8deb9f0c0..b9e79a53b4 100644
--- a/rt/frontend/jaxws/src/test/java/org/apache/cxf/jaxws/spring/SpringBeansTest.java
+++ b/rt/frontend/jaxws/src/test/java/org/apache/cxf/jaxws/spring/SpringBeansTest.java
@@ -18,6 +18,7 @@
  */
 package org.apache.cxf.jaxws.spring;
 
+import java.io.ByteArrayOutputStream;
 import java.io.PrintWriter;
 import java.io.StringWriter;
 import java.util.List;
@@ -27,6 +28,7 @@ import javax.xml.namespace.QName;
 
 import junit.framework.Assert;
 
+import org.apache.cxf.Bus;
 import org.apache.cxf.BusFactory;
 import org.apache.cxf.anonymous_complex_type.AnonymousComplexType;
 import org.apache.cxf.anonymous_complex_type.SplitNameResponse.Names;
@@ -46,6 +48,7 @@ import org.apache.cxf.jaxws.EndpointImpl;
 import org.apache.cxf.jaxws.JaxWsProxyFactoryBean;
 import org.apache.cxf.jaxws.JaxWsServerFactoryBean;
 import org.apache.cxf.jaxws.service.Hello;
+import org.apache.cxf.transport.http.WSDLQueryHandler;
 import org.apache.hello_world_soap_http.Greeter;
 import org.junit.After;
 import org.junit.Test;
@@ -217,16 +220,37 @@ public class SpringBeansTest extends Assert {
         ClassPathXmlApplicationContext ctx = 
             new ClassPathXmlApplicationContext(new String[] {"/org/apache/cxf/jaxws/spring/servers.xml"});
 
-        JaxWsServerFactoryBean bean = (JaxWsServerFactoryBean) ctx.getBean("simple");
+        JaxWsServerFactoryBean bean;
+        BindingConfiguration bc;
+        SoapBindingConfiguration sbc;
+        
+        bean = (JaxWsServerFactoryBean) ctx.getBean("inlineSoapBindingRPC");
+        assertNotNull(bean);
+        
+        bc = bean.getBindingConfig();
+        assertTrue(bc instanceof SoapBindingConfiguration);
+        sbc = (SoapBindingConfiguration) bc;
+        assertEquals("rpc", sbc.getStyle());
+
+        WSDLQueryHandler handler = new WSDLQueryHandler((Bus)ctx.getBean("cxf"));
+        ByteArrayOutputStream bout = new ByteArrayOutputStream();
+        handler.writeResponse("http://localhost/test?wsdl", "/test",
+                              bean.create().getEndpoint().getEndpointInfo(),
+                              bout);
+        String wsdl = bout.toString();
+        assertTrue(wsdl.contains("name=\"stringArray\""));
+        assertTrue(wsdl.contains("name=\"stringArray\""));
+        
+        bean = (JaxWsServerFactoryBean) ctx.getBean("simple");
         assertNotNull(bean);
 
         bean = (JaxWsServerFactoryBean) ctx.getBean("inlineSoapBinding");
         assertNotNull(bean);
         
-        BindingConfiguration bc = bean.getBindingConfig();
+        bc = bean.getBindingConfig();
         assertTrue(bc instanceof SoapBindingConfiguration);
-        SoapBindingConfiguration sbc = (SoapBindingConfiguration) bc;
-        assertTrue(sbc.getVersion() instanceof Soap12);
+        sbc = (SoapBindingConfiguration) bc;
+        assertTrue("Not soap version 1.2: " + sbc.getVersion(),  sbc.getVersion() instanceof Soap12);
         
         bean = (JaxWsServerFactoryBean) ctx.getBean("inlineDataBinding");
         
@@ -300,4 +324,5 @@ public class SpringBeansTest extends Assert {
         assertTrue("the soap configure should set isMtomEnabled to be true",
                    sbc.isMtomEnabled());
     }
+    
 }
diff --git a/rt/frontend/jaxws/src/test/java/org/apache/cxf/jaxws/spring/servers.xml b/rt/frontend/jaxws/src/test/java/org/apache/cxf/jaxws/spring/servers.xml
index 2f0d4395ec..c7b4107905 100644
--- a/rt/frontend/jaxws/src/test/java/org/apache/cxf/jaxws/spring/servers.xml
+++ b/rt/frontend/jaxws/src/test/java/org/apache/cxf/jaxws/spring/servers.xml
@@ -38,7 +38,7 @@ http://cxf.apache.org/jaxws http://cxf.apache.org/schemas/jaxws.xsd">
           </list>
       </property>
   </bean>
-  
+   
   <jaxws:server id="simple" serviceBean="#greeter" xmlns:test="urn:foo" xmlns="urn:foo"/>
 
   <bean id="greeter" class="org.apache.hello_world_soap_http.GreeterImpl"/>
@@ -109,6 +109,14 @@ http://cxf.apache.org/jaxws http://cxf.apache.org/schemas/jaxws.xsd">
     </jaxws:binding>
   </jaxws:server>
   
+  <jaxws:server id="inlineSoapBindingRPC" 
+    serviceClass="org.apache.cxf.jaxws.service.Hello"
+    address="http://localhost:8080/testrpc">
+    <jaxws:binding>
+      <soap:soapBinding style="rpc"/>
+    </jaxws:binding>
+  </jaxws:server>
+  
   <jaxws:server id="inlineDataBinding" 
     serviceClass="org.apache.cxf.jaxws.service.Hello"
     address="http://localhost:8080/test">
diff --git a/rt/frontend/jaxws/src/test/java/org/apache/cxf/jaxws/support/JaxWsServiceConfigurationTest.java b/rt/frontend/jaxws/src/test/java/org/apache/cxf/jaxws/support/JaxWsServiceConfigurationTest.java
index 49432941ff..e50d513fcb 100644
--- a/rt/frontend/jaxws/src/test/java/org/apache/cxf/jaxws/support/JaxWsServiceConfigurationTest.java
+++ b/rt/frontend/jaxws/src/test/java/org/apache/cxf/jaxws/support/JaxWsServiceConfigurationTest.java
@@ -86,7 +86,8 @@ public class JaxWsServiceConfigurationTest extends Assert {
         JaxWsServiceConfiguration jwsc = (JaxWsServiceConfiguration) bean.getServiceConfigurations().get(0);
         jwsc.setServiceFactory(bean);
 
-        assertEquals("document", jwsc.getStyle());
+        assertNull(jwsc.getStyle());
+        assertEquals("document", bean.getStyle());
         assertNull(jwsc.isWrapped());
     }
 
diff --git a/rt/frontend/simple/src/main/java/org/apache/cxf/frontend/AbstractWSDLBasedEndpointFactory.java b/rt/frontend/simple/src/main/java/org/apache/cxf/frontend/AbstractWSDLBasedEndpointFactory.java
index d1bd82063f..5567dad16f 100644
--- a/rt/frontend/simple/src/main/java/org/apache/cxf/frontend/AbstractWSDLBasedEndpointFactory.java
+++ b/rt/frontend/simple/src/main/java/org/apache/cxf/frontend/AbstractWSDLBasedEndpointFactory.java
@@ -34,6 +34,7 @@ import org.apache.cxf.endpoint.EndpointException;
 import org.apache.cxf.endpoint.EndpointImpl;
 import org.apache.cxf.interceptor.AnnotationInterceptors;
 import org.apache.cxf.service.Service;
+import org.apache.cxf.service.factory.AbstractServiceConfiguration;
 import org.apache.cxf.service.factory.ReflectionServiceFactoryBean;
 import org.apache.cxf.service.factory.ServiceConstructionException;
 import org.apache.cxf.service.model.BindingInfo;
@@ -58,9 +59,29 @@ public abstract class AbstractWSDLBasedEndpointFactory extends AbstractEndpointF
         serviceClass = sbean.getServiceClass();
         serviceName = sbean.getServiceQName(false);
         endpointName = sbean.getEndpointName(false);
+        sbean.getServiceConfigurations().add(new SoapBindingServiceConfiguration());
     }
     protected AbstractWSDLBasedEndpointFactory() {
     }
+
+    
+    private class SoapBindingServiceConfiguration extends AbstractServiceConfiguration {
+        public String getStyle() {
+            if (getBindingConfig() instanceof SoapBindingConfiguration
+                && ((SoapBindingConfiguration)getBindingConfig()).isSetStyle()) {
+                return ((SoapBindingConfiguration)getBindingConfig()).getStyle();
+            }
+            return null;
+        }
+        public Boolean isWrapped() {
+            if (getBindingConfig() instanceof SoapBindingConfiguration
+                && ((SoapBindingConfiguration)getBindingConfig()).isSetStyle()
+                && "rpc".equals(((SoapBindingConfiguration)getBindingConfig()).getStyle())) {
+                return Boolean.FALSE;
+            }
+            return null;
+        }
+    }
     
     protected Endpoint createEndpoint() throws BusException, EndpointException {        
         serviceFactory.setFeatures(getFeatures());
@@ -292,7 +313,8 @@ public abstract class AbstractWSDLBasedEndpointFactory extends AbstractEndpointF
                 if (bindingConfig == null) {
                     bindingConfig = new SoapBindingConfiguration();
                 }
-                if (bindingConfig instanceof SoapBindingConfiguration) {
+                if (bindingConfig instanceof SoapBindingConfiguration
+                    && !((SoapBindingConfiguration)bindingConfig).isSetStyle()) {
                     ((SoapBindingConfiguration)bindingConfig).setStyle(serviceFactory.getStyle());
                 }
             }
diff --git a/rt/frontend/simple/src/main/java/org/apache/cxf/service/factory/ReflectionServiceFactoryBean.java b/rt/frontend/simple/src/main/java/org/apache/cxf/service/factory/ReflectionServiceFactoryBean.java
index a127f4879d..2de6b5fd9e 100644
--- a/rt/frontend/simple/src/main/java/org/apache/cxf/service/factory/ReflectionServiceFactoryBean.java
+++ b/rt/frontend/simple/src/main/java/org/apache/cxf/service/factory/ReflectionServiceFactoryBean.java
@@ -157,6 +157,13 @@ public class ReflectionServiceFactoryBean extends AbstractServiceFactoryBean {
 
     private List<AbstractFeature> features;
     
+    private Map<Method, Boolean> wrappedCache = new HashMap<Method, Boolean>();
+    private Map<Method, Boolean> isRpcCache = new HashMap<Method, Boolean>();
+    private String styleCache;
+    private Boolean defWrappedCache;
+    
+    
+    
     public ReflectionServiceFactoryBean() {
         getServiceConfigurations().add(0, new DefaultServiceConfiguration());
 
@@ -587,7 +594,11 @@ public class ReflectionServiceFactoryBean extends AbstractServiceFactoryBean {
 
             setFaultClassInfo(o, method);
         }
-        o.setProperty(METHOD_PARAM_ANNOTATIONS, method.getParameterAnnotations());
+        try {
+            o.setProperty(METHOD_PARAM_ANNOTATIONS, method.getParameterAnnotations());
+        } catch (Throwable t) {
+            t.printStackTrace();
+        }
         o.setProperty(METHOD_ANNOTATIONS, method.getAnnotations());
         Class<?>[] paramTypes = method.getParameterTypes();
         Type[] genericTypes = method.getGenericParameterTypes();
@@ -750,7 +761,7 @@ public class ReflectionServiceFactoryBean extends AbstractServiceFactoryBean {
         op.setProperty(METHOD_ANNOTATIONS, m.getAnnotations());
         op.setProperty(METHOD_PARAM_ANNOTATIONS, m.getParameterAnnotations());
 
-        if (isWrapped(m)) {
+        if (!isRPC(m) && isWrapped(m)) {
             UnwrappedOperationInfo uOp = new UnwrappedOperationInfo(op);
             uOp.setProperty(METHOD_ANNOTATIONS, m.getAnnotations());
             uOp.setProperty(METHOD_PARAM_ANNOTATIONS, m.getParameterAnnotations());
@@ -1637,13 +1648,25 @@ public class ReflectionServiceFactoryBean extends AbstractServiceFactoryBean {
     }
     
     protected boolean isWrapped(final Method method) {
-        for (AbstractServiceConfiguration c : serviceConfigurations) {
-            Boolean b = c.isWrapped(method);
-            if (b != null) {
-                return b.booleanValue();
+        Boolean b = wrappedCache.get(method);
+        if (b == null) {
+            if (isRPC(method)) {
+                wrappedCache.put(method, Boolean.FALSE);
+                return false;
             }
+            
+            for (AbstractServiceConfiguration c : serviceConfigurations) {
+                b = c.isWrapped(method);
+                if (b != null) {
+                    wrappedCache.put(method, b);
+                    return b.booleanValue();
+                }
+            }
+            
+            wrappedCache.put(method, Boolean.TRUE);
+            return true;            
         }
-        return true;
+        return b; 
     }
 
     protected boolean isMatchOperation(String methodNameInClass, String methodNameInWsdl) {
@@ -2063,35 +2086,47 @@ public class ReflectionServiceFactoryBean extends AbstractServiceFactoryBean {
 
     public boolean isWrapped() {
         if (this.wrappedStyle != null) {
-            return this.wrappedStyle;
+            defWrappedCache = wrappedStyle;
         }
-        for (AbstractServiceConfiguration c : serviceConfigurations) {
-            Boolean b = c.isWrapped();
-            if (b != null) {
-                return b.booleanValue();
+        if (this.defWrappedCache == null) {
+            for (AbstractServiceConfiguration c : serviceConfigurations) {
+                defWrappedCache = c.isWrapped();
+                if (defWrappedCache != null) {
+                    return defWrappedCache;
+                }
             }
+            defWrappedCache = Boolean.TRUE;
         }
-        return true;
+        return defWrappedCache;
     }
 
     public String getStyle() {
-        for (AbstractServiceConfiguration c : serviceConfigurations) {
-            String style = c.getStyle();
-            if (style != null) {
-                return style;
+        if (styleCache == null) {
+            for (AbstractServiceConfiguration c : serviceConfigurations) {
+                styleCache = c.getStyle();
+                if (styleCache != null) {
+                    return styleCache;
+                }
             }
+            styleCache = "document";
         }
-        return "document";
+        return styleCache;
     }
 
     public boolean isRPC(Method method) {
-        for (AbstractServiceConfiguration c : serviceConfigurations) {
-            Boolean b = c.isRPC(method);
-            if (b != null) {
-                return b.booleanValue();
+        Boolean b = isRpcCache.get(method);
+        if (b == null) {
+            for (AbstractServiceConfiguration c : serviceConfigurations) {
+                b = c.isRPC(method);
+                if (b != null) {
+                    isRpcCache.put(method, b);
+                    return b.booleanValue();
+                }
             }
+            b = "rpc".equals(getStyle());
+            isRpcCache.put(method, b);            
         }
-        return "rpc".equals(getStyle());
+        return b;
     }
 
     public void setWrapped(boolean style) {
