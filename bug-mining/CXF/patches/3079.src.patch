diff --git a/rt/rs/security/oauth-parent/oauth2/src/main/java/org/apache/cxf/rs/security/oauth2/grants/code/JPACMTCodeDataProvider.java b/rt/rs/security/oauth-parent/oauth2/src/main/java/org/apache/cxf/rs/security/oauth2/grants/code/JPACMTCodeDataProvider.java
index 5eaa39abeb..bcc2ee778a 100644
--- a/rt/rs/security/oauth-parent/oauth2/src/main/java/org/apache/cxf/rs/security/oauth2/grants/code/JPACMTCodeDataProvider.java
+++ b/rt/rs/security/oauth-parent/oauth2/src/main/java/org/apache/cxf/rs/security/oauth2/grants/code/JPACMTCodeDataProvider.java
@@ -18,12 +18,24 @@
  */
 package org.apache.cxf.rs.security.oauth2.grants.code;
 
+import java.util.Collections;
+import java.util.Map;
+
 import javax.persistence.EntityManager;
 import javax.persistence.EntityTransaction;
+import javax.persistence.LockModeType;
 import javax.persistence.PersistenceContext;
 
+import org.apache.cxf.rs.security.oauth2.common.ServerAccessToken;
+import org.apache.cxf.rs.security.oauth2.tokens.refresh.RefreshToken;
+
 public class JPACMTCodeDataProvider extends JPACodeDataProvider {
 
+    private static final int DEFAULT_PESSIMISTIC_LOCK_TIMEOUT = 10000;
+    
+    private int pessimisticLockTimeout = DEFAULT_PESSIMISTIC_LOCK_TIMEOUT;
+    private boolean useJpaLockForExistingRefreshToken = true;
+    
     @PersistenceContext
     private EntityManager entityManager;
 
@@ -60,4 +72,44 @@ public class JPACMTCodeDataProvider extends JPACodeDataProvider {
     @Override
     protected void closeIfNeeded(EntityManager em) {
     }
+    
+    @Override
+    protected RefreshToken updateExistingRefreshToken(RefreshToken rt, ServerAccessToken at) {
+        if (useJpaLockForExistingRefreshToken) {
+            // lock RT for update
+            lockRefreshTokenForUpdate(rt);
+            return super.updateRefreshToken(rt, at);
+        } else {
+            return super.updateExistingRefreshToken(rt, at);
+        }
+    }
+    
+    protected void lockRefreshTokenForUpdate(final RefreshToken refreshToken) {
+        try {
+            execute(new EntityManagerOperation<Void>() {
+
+                @Override
+                public Void execute(EntityManager em) {
+                    Map<String, Object> options = null;
+                    if (pessimisticLockTimeout > 0) {
+                        options = Collections.singletonMap("javax.persistence.lock.timeout", pessimisticLockTimeout);
+                    } else {
+                        options = Collections.emptyMap();
+                    }
+                    em.refresh(refreshToken, LockModeType.PESSIMISTIC_WRITE, options);
+                    return null;
+                }
+            });
+        } catch (IllegalArgumentException e) {
+            // entity is not managed yet. ignore
+        }
+    }
+    
+    public void setPessimisticLockTimeout(int pessimisticLockTimeout) {
+        this.pessimisticLockTimeout = pessimisticLockTimeout;
+    }
+
+    public void setUseJpaLockForExistingRefreshToken(boolean useJpaLockForExistingRefreshToken) {
+        this.useJpaLockForExistingRefreshToken = useJpaLockForExistingRefreshToken;
+    }
 }
diff --git a/rt/rs/security/oauth-parent/oauth2/src/main/java/org/apache/cxf/rs/security/oauth2/provider/JPAOAuthDataProvider.java b/rt/rs/security/oauth-parent/oauth2/src/main/java/org/apache/cxf/rs/security/oauth2/provider/JPAOAuthDataProvider.java
index fc594318bc..850b76d4f4 100644
--- a/rt/rs/security/oauth-parent/oauth2/src/main/java/org/apache/cxf/rs/security/oauth2/provider/JPAOAuthDataProvider.java
+++ b/rt/rs/security/oauth-parent/oauth2/src/main/java/org/apache/cxf/rs/security/oauth2/provider/JPAOAuthDataProvider.java
@@ -19,16 +19,13 @@
 package org.apache.cxf.rs.security.oauth2.provider;
 
 import java.util.ArrayList;
-import java.util.Collections;
 import java.util.HashMap;
 import java.util.LinkedList;
 import java.util.List;
-import java.util.Map;
 
 import javax.persistence.EntityManager;
 import javax.persistence.EntityManagerFactory;
 import javax.persistence.EntityTransaction;
-import javax.persistence.LockModeType;
 import javax.persistence.TypedQuery;
 
 import org.apache.cxf.helpers.CastUtils;
@@ -56,11 +53,6 @@ public class JPAOAuthDataProvider extends AbstractOAuthDataProvider {
     private static final String CLIENT_QUERY = "SELECT client FROM Client client"
             + " INNER JOIN client.resourceOwnerSubject ros";
 
-    private static final int DEFAULT_PESSIMISTIC_LOCK_TIMEOUT = 10000;
-    
-    private int pessimisticLockTimeout = DEFAULT_PESSIMISTIC_LOCK_TIMEOUT;
-    private boolean useJpaLockForExistingRefreshToken = true;
-    
     private EntityManagerFactory entityManagerFactory;
 
     public void setEntityManagerFactory(EntityManagerFactory emf) {
@@ -77,39 +69,6 @@ public class JPAOAuthDataProvider extends AbstractOAuthDataProvider {
         });
     }
 
-    protected void lockRefreshTokenForUpdate(final RefreshToken refreshToken) {
-        try {
-            execute(new EntityManagerOperation<Void>() {
-
-                @Override
-                public Void execute(EntityManager em) {
-                    Map<String, Object> options = null;
-                    if (pessimisticLockTimeout > 0) {
-                        options = Collections.singletonMap("javax.persistence.lock.timeout", pessimisticLockTimeout);
-                    } else {
-                        options = Collections.emptyMap();
-                    }
-                    em.refresh(refreshToken, LockModeType.PESSIMISTIC_WRITE, options);
-                    return null;
-                }
-            });
-        } catch (IllegalArgumentException e) {
-            // entity is not managed yet. ignore
-        }
-    }
-        
-    @Override
-    protected RefreshToken updateExistingRefreshToken(RefreshToken rt, ServerAccessToken at) {
-        if (useJpaLockForExistingRefreshToken) {
-            // lock RT for update
-            lockRefreshTokenForUpdate(rt);
-            return super.updateRefreshToken(rt, at);
-        } else {
-            return super.updateExistingRefreshToken(rt, at);
-        }
-    }
-    
-    
     protected <T> T execute(EntityManagerOperation<T> operation) {
         EntityManager em = getEntityManager();
         T value;
@@ -458,14 +417,6 @@ public class JPAOAuthDataProvider extends AbstractOAuthDataProvider {
         em.close();
     }
 
-    public void setPessimisticLockTimeout(int pessimisticLockTimeout) {
-        this.pessimisticLockTimeout = pessimisticLockTimeout;
-    }
-
-    public void setUseJpaLockForExistingRefreshToken(boolean useJpaLockForExistingRefreshToken) {
-        this.useJpaLockForExistingRefreshToken = useJpaLockForExistingRefreshToken;
-    }
-
     public interface EntityManagerOperation<T> {
         T execute(EntityManager em);
     }
