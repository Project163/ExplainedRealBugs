diff --git a/services/sts/systests/basic/src/test/java/org/apache/cxf/systest/sts/common/CustomIdentityMapper.java b/services/sts/systests/basic/src/test/java/org/apache/cxf/systest/sts/common/CustomIdentityMapper.java
index 59c8c31d47..5a94433bd1 100644
--- a/services/sts/systests/basic/src/test/java/org/apache/cxf/systest/sts/common/CustomIdentityMapper.java
+++ b/services/sts/systests/basic/src/test/java/org/apache/cxf/systest/sts/common/CustomIdentityMapper.java
@@ -20,13 +20,13 @@ package org.apache.cxf.systest.sts.common;
 
 import java.security.Principal;
 
-import org.apache.cxf.sts.IdentityMapper;
+import org.apache.cxf.sts.cache.MemoryIdentityCache;
 import org.apache.wss4j.common.principal.CustomTokenPrincipal;
 
 /**
  * A test implementation of IdentityMapper.
  */
-public class CustomIdentityMapper implements IdentityMapper {
+public class CustomIdentityMapper extends MemoryIdentityCache {
 
     /**
      * Map a principal in the source realm to the target realm
diff --git a/services/sts/systests/basic/src/test/java/org/apache/cxf/systest/sts/issueunit/IssueUnitTest.java b/services/sts/systests/basic/src/test/java/org/apache/cxf/systest/sts/issueunit/IssueUnitTest.java
index c72c898b9c..630bb43df6 100644
--- a/services/sts/systests/basic/src/test/java/org/apache/cxf/systest/sts/issueunit/IssueUnitTest.java
+++ b/services/sts/systests/basic/src/test/java/org/apache/cxf/systest/sts/issueunit/IssueUnitTest.java
@@ -388,7 +388,6 @@ public class IssueUnitTest extends AbstractBusClientServerTestBase {
         bus.shutdown(true);
     }
 
-  //CHECKSTYLE:OFF
     @org.junit.Test
     public void testSAMLinWSSecToOtherRealm() throws Exception {
         SpringBusFactory bf = new SpringBusFactory();
@@ -477,6 +476,7 @@ public class IssueUnitTest extends AbstractBusClientServerTestBase {
         return requestSecurityToken(tokenType, keyType, null, bus, endpointAddress, context, null, null, null);
     }
 
+    // CHECKSTYLE:OFF
     private SecurityToken requestSecurityToken(
         String tokenType,
         String keyType,
@@ -533,6 +533,7 @@ public class IssueUnitTest extends AbstractBusClientServerTestBase {
 
         return stsClient.requestSecurityToken(endpointAddress);
     }
+    // CHECKSTYLE:ON
 
     private Properties getEncryptionProperties() {
         Properties properties = new Properties();
diff --git a/services/sts/systests/basic/src/test/resources/org/apache/cxf/systest/sts/deployment/sts/realms.xml b/services/sts/systests/basic/src/test/resources/org/apache/cxf/systest/sts/deployment/sts/realms.xml
index 7ba66d2666..7de1aaf139 100644
--- a/services/sts/systests/basic/src/test/resources/org/apache/cxf/systest/sts/deployment/sts/realms.xml
+++ b/services/sts/systests/basic/src/test/resources/org/apache/cxf/systest/sts/deployment/sts/realms.xml
@@ -36,13 +36,18 @@
     </util:map>
     
     <!-- Relationships between realms -->
-    <bean id="identityMapper" class="org.apache.cxf.systest.sts.common.CustomIdentityMapper"/>
+    <bean id="identityMapper" class="org.apache.cxf.systest.sts.common.CustomIdentityMapper">
+    </bean>
+    
+    <bean id="identityCache" class="org.apache.cxf.sts.cache.MemoryIdentityCache">
+        <constructor-arg ref="identityMapper"></constructor-arg>
+    </bean>
     
     <util:list id="relationships">
         <bean class="org.apache.cxf.sts.token.realm.Relationship">
             <property name="sourceRealm" value="#{realmA.getName()}"/>
             <property name="targetRealm" value="#{realmB.getName()}"/>
-            <property name="identityMapper" ref="identityMapper"/>
+            <property name="identityMapper" ref="identityCache"/>
             <property name="type" value="FederatedIdentity"/>
         </bean>
     </util:list>
