diff --git a/common/common/src/main/java/org/apache/cxf/common/util/StringUtils.java b/common/common/src/main/java/org/apache/cxf/common/util/StringUtils.java
index 28f2f50383..02bafeb837 100644
--- a/common/common/src/main/java/org/apache/cxf/common/util/StringUtils.java
+++ b/common/common/src/main/java/org/apache/cxf/common/util/StringUtils.java
@@ -69,10 +69,10 @@ public final class StringUtils {
     }
 
     public static boolean isEmpty(String str) {
-        if (str != null && str.trim().length() > 0) {
-            return false;
+        if (str == null || str.length() == 0) {
+            return true;
         }
-        return true;
+        return str.trim().length() == 0;
     }
     
     public static boolean isEmpty(List<String> list) {
diff --git a/common/common/src/main/java/org/apache/cxf/helpers/DOMUtils.java b/common/common/src/main/java/org/apache/cxf/helpers/DOMUtils.java
index 1cf75e8d85..4dec15cb52 100644
--- a/common/common/src/main/java/org/apache/cxf/helpers/DOMUtils.java
+++ b/common/common/src/main/java/org/apache/cxf/helpers/DOMUtils.java
@@ -549,7 +549,7 @@ public final class DOMUtils {
             p = "ns" + i;
             i++;
         }
-        el.setAttribute(XMLNAMESPACE + ":" + p, ns);
+        addNamespacePrefix(el, ns, p);
         return p;
     }
 
diff --git a/common/common/src/main/java/org/apache/cxf/staxutils/CachingXmlEventWriter.java b/common/common/src/main/java/org/apache/cxf/staxutils/CachingXmlEventWriter.java
index 7f54829908..1f02a3d69f 100644
--- a/common/common/src/main/java/org/apache/cxf/staxutils/CachingXmlEventWriter.java
+++ b/common/common/src/main/java/org/apache/cxf/staxutils/CachingXmlEventWriter.java
@@ -160,21 +160,9 @@ public class CachingXmlEventWriter implements XMLStreamWriter {
         } 
     }
     
-    private String creatPrefix() {
-        int count = 1;
-        String pfx = "ns" + count;
-        while (curContext.getNamespaceURI(pfx) != null) {
-            count++;
-            pfx = "ns" + count;
-        }
-        return pfx;
-    }
     public void writeAttribute(String uri, String name, String value) throws XMLStreamException {
         if (!StringUtils.isEmpty(uri)) {
-            String pfx = this.getPrefix(uri);
-            if (pfx == null) {
-                pfx = creatPrefix();
-            }
+            String pfx = StaxUtils.getUniquePrefix(this, uri, false);
             addEvent(factory.createAttribute(pfx, uri, name, value));            
         } else {            
             addEvent(factory.createAttribute(name, value));            
diff --git a/common/common/src/main/java/org/apache/cxf/staxutils/StaxUtils.java b/common/common/src/main/java/org/apache/cxf/staxutils/StaxUtils.java
index 4ab7164d16..28cc2bf4cd 100644
--- a/common/common/src/main/java/org/apache/cxf/staxutils/StaxUtils.java
+++ b/common/common/src/main/java/org/apache/cxf/staxutils/StaxUtils.java
@@ -81,6 +81,11 @@ public final class StaxUtils {
     private static final BlockingQueue<XMLOutputFactory> OUTPUT_FACTORY_POOL;
     
     private static final String XML_NS = "http://www.w3.org/2000/xmlns/";
+    private static final String DEF_PREFIXES[] = new String[] {
+        "ns1".intern(), "ns2".intern(), "ns3".intern(),
+        "ns4".intern(), "ns5".intern(), "ns6".intern(),
+        "ns7".intern(), "ns8".intern(), "ns9".intern()
+    };
     
     static {
         int i = 20;
@@ -212,6 +217,7 @@ public final class StaxUtils {
         }
     }
 
+    
     public static void nextEvent(XMLStreamReader dr) {
         try {
             dr.next();
@@ -1027,7 +1033,6 @@ public final class StaxUtils {
         return new QName(ns, localName, prefix);
     }
     
-
     /**
      * Create a unique namespace uri/prefix combination.
      * 
@@ -1049,18 +1054,29 @@ public final class StaxUtils {
         }
         return prefix;
     }
-
+    public static String getUniquePrefix(XMLStreamWriter writer, String namespaceURI)
+        throws XMLStreamException {
+        return getUniquePrefix(writer, namespaceURI, false);
+    }
     public static String getUniquePrefix(XMLStreamWriter writer) {
-        int n = 1;
-        
         NamespaceContext nc = writer.getNamespaceContext();
+        if (nc == null) {
+            return DEF_PREFIXES[0];
+        }
+        for (String t : DEF_PREFIXES) {
+            String uri = nc.getNamespaceURI(t);
+            if (StringUtils.isEmpty(uri)) {
+                return t;
+            }
+        }
+
+        int n = 10;
         while (true) {
             String nsPrefix = "ns" + n;
-
-            if (nc == null || nc.getNamespaceURI(nsPrefix) == null) {
+            String uri = nc.getNamespaceURI(nsPrefix);
+            if (StringUtils.isEmpty(uri)) {
                 return nsPrefix;
             }
-
             n++;
         }
     }
diff --git a/rt/bindings/jbi/src/main/java/org/apache/cxf/binding/jbi/interceptor/JBIWrapperOutInterceptor.java b/rt/bindings/jbi/src/main/java/org/apache/cxf/binding/jbi/interceptor/JBIWrapperOutInterceptor.java
index 3fd4d18bfc..87b9ac4045 100644
--- a/rt/bindings/jbi/src/main/java/org/apache/cxf/binding/jbi/interceptor/JBIWrapperOutInterceptor.java
+++ b/rt/bindings/jbi/src/main/java/org/apache/cxf/binding/jbi/interceptor/JBIWrapperOutInterceptor.java
@@ -39,6 +39,7 @@ import org.apache.cxf.service.model.BindingMessageInfo;
 import org.apache.cxf.service.model.BindingOperationInfo;
 import org.apache.cxf.service.model.MessageInfo;
 import org.apache.cxf.service.model.MessagePartInfo;
+import org.apache.cxf.staxutils.StaxUtils;
 
 public class JBIWrapperOutInterceptor extends AbstractOutDatabindingInterceptor {
 
@@ -129,14 +130,10 @@ public class JBIWrapperOutInterceptor extends AbstractOutDatabindingInterceptor
             QName name = outPart.getConcreteName();
 
             try {
-                
-                int x = 1;
-                while (xmlWriter.getNamespaceContext().getNamespaceURI("ns" + x) != null) {
-                    x++;
-                }
-                xmlWriter.setPrefix("ns" + x, name.getNamespaceURI());
-                xmlWriter.writeStartElement("ns" + x, name.getLocalPart(), name.getNamespaceURI());
-                xmlWriter.writeNamespace("ns" + x, name.getNamespaceURI());
+                String pfx = StaxUtils.getUniquePrefix(xmlWriter, name.getNamespaceURI());
+                xmlWriter.setPrefix(pfx, name.getNamespaceURI());
+                xmlWriter.writeStartElement(pfx, name.getLocalPart(), name.getNamespaceURI());
+                xmlWriter.writeNamespace(pfx, name.getNamespaceURI());
             } catch (XMLStreamException e) {
                 throw new Fault(new org.apache.cxf.common.i18n.Message("STAX_WRITE_EXC", BUNDLE), e);
             }
diff --git a/rt/core/src/main/java/org/apache/cxf/interceptor/WrappedOutInterceptor.java b/rt/core/src/main/java/org/apache/cxf/interceptor/WrappedOutInterceptor.java
index c80e26646a..bd5c5a7325 100644
--- a/rt/core/src/main/java/org/apache/cxf/interceptor/WrappedOutInterceptor.java
+++ b/rt/core/src/main/java/org/apache/cxf/interceptor/WrappedOutInterceptor.java
@@ -33,14 +33,10 @@ import org.apache.cxf.service.Service;
 import org.apache.cxf.service.model.BindingOperationInfo;
 import org.apache.cxf.service.model.MessageInfo;
 import org.apache.cxf.service.model.MessagePartInfo;
+import org.apache.cxf.staxutils.StaxUtils;
 
 public class WrappedOutInterceptor extends AbstractOutDatabindingInterceptor {
     private static final ResourceBundle BUNDLE = BundleUtils.getBundle(WrappedOutInterceptor.class);
-    private static final String DEF_PREFIXES[] = new String[] {
-        "ns1".intern(), "ns2".intern(), "ns3".intern(),
-        "ns4".intern(), "ns5".intern(), "ns6".intern(),
-        "ns7".intern(), "ns8".intern(), "ns9".intern()
-    };
 
     private WrappedOutEndingInterceptor ending = new WrappedOutEndingInterceptor();
     
@@ -75,21 +71,7 @@ public class WrappedOutInterceptor extends AbstractOutDatabindingInterceptor {
                     pfx = service.getDataBinding().getDeclaredNamespaceMappings().get(name.getNamespaceURI());
                 }
                 if (pfx == null) {
-                    for (String t : DEF_PREFIXES) {
-                        if (!StringUtils.isEmpty(xmlWriter.getNamespaceContext()
-                                                     .getNamespaceURI(t))) {
-                            pfx = t;
-                            break;
-                        }
-                    }
-                    if (pfx == null) {    
-                        int x = 10;
-                        while (!StringUtils.isEmpty(xmlWriter.getNamespaceContext()
-                                                         .getNamespaceURI("ns" + x))) {
-                            x++;
-                        }
-                        pfx = "ns" + x;
-                    }
+                    pfx = StaxUtils.getUniquePrefix(xmlWriter, name.getNamespaceURI(), false);
                 }
                 xmlWriter.setPrefix(pfx, name.getNamespaceURI());
                 xmlWriter.writeStartElement(pfx, name.getLocalPart(), name.getNamespaceURI());
diff --git a/rt/databinding/aegis/src/main/java/org/apache/cxf/aegis/util/NamespaceHelper.java b/rt/databinding/aegis/src/main/java/org/apache/cxf/aegis/util/NamespaceHelper.java
index f10df7d042..3722d68704 100644
--- a/rt/databinding/aegis/src/main/java/org/apache/cxf/aegis/util/NamespaceHelper.java
+++ b/rt/databinding/aegis/src/main/java/org/apache/cxf/aegis/util/NamespaceHelper.java
@@ -34,6 +34,7 @@ import org.w3c.dom.Element;
 import org.apache.cxf.aegis.DatabindingException;
 import org.apache.cxf.helpers.DOMUtils;
 import org.apache.cxf.helpers.JavaUtils;
+import org.apache.cxf.staxutils.StaxUtils;
 
 /**
  * Namespace utilities.
@@ -52,14 +53,12 @@ public final class NamespaceHelper {
      */
     public static String getUniquePrefix(Element element, String namespaceURI) {
         String prefix = getPrefix(element, namespaceURI);
-
         // it is OK to have both namespace URI and prefix be empty. 
         if (prefix == null) {
             if ("".equals(namespaceURI)) {
                 return "";
             }
-            prefix = getUniquePrefix(element);
-            DOMUtils.addNamespacePrefix(element, namespaceURI, prefix);
+            prefix = DOMUtils.createNamespace(element, namespaceURI);
         }
         return prefix;
     }
@@ -72,20 +71,6 @@ public final class NamespaceHelper {
         DOMUtils.getPrefixesRecursive(element, namespaceURI, prefixes);
     }
 
-    public static String getUniquePrefix(Element el) {
-        int n = 1;
-
-        while (true) {
-            String nsPrefix = "ns" + n;
-
-            if (DOMUtils.getNamespace(el, nsPrefix) == null) {
-                return nsPrefix;
-            }
-
-            n++;
-        }
-    }
-
     /**
      * Create a unique namespace uri/prefix combination.
      * 
@@ -110,7 +95,9 @@ public final class NamespaceHelper {
      * @throws XMLStreamException
      */
     public static String getUniquePrefix(XMLStreamWriter writer, 
-                                         String namespaceURI, String preferred, boolean declare)
+                                         String namespaceURI,
+                                         String preferred,
+                                         boolean declare)
         throws XMLStreamException {
         
         if (preferred != null) {
@@ -128,7 +115,7 @@ public final class NamespaceHelper {
         }
         
         if (prefix == null) {
-            prefix = getUniquePrefix(writer);
+            prefix = StaxUtils.getUniquePrefix(writer);
         }
 
         if (declare) {
@@ -139,20 +126,6 @@ public final class NamespaceHelper {
         return prefix;
     }
 
-    public static String getUniquePrefix(XMLStreamWriter writer) {
-        int n = 1;
-
-        while (true) {
-            String nsPrefix = "ns" + n;
-
-            if (writer.getNamespaceContext().getNamespaceURI(nsPrefix) == null) {
-                return nsPrefix;
-            }
-
-            n++;
-        }
-    }
-
     /**
      * Generates the name of a XML namespace from a given class name and
      * protocol. The returned namespace will take the form
diff --git a/rt/databinding/aegis/src/main/java/org/apache/cxf/aegis/xml/stax/ElementWriter.java b/rt/databinding/aegis/src/main/java/org/apache/cxf/aegis/xml/stax/ElementWriter.java
index 0af6bc424d..2210f3e593 100644
--- a/rt/databinding/aegis/src/main/java/org/apache/cxf/aegis/xml/stax/ElementWriter.java
+++ b/rt/databinding/aegis/src/main/java/org/apache/cxf/aegis/xml/stax/ElementWriter.java
@@ -26,10 +26,10 @@ import javax.xml.stream.XMLStreamException;
 import javax.xml.stream.XMLStreamWriter;
 
 import org.apache.cxf.aegis.DatabindingException;
-import org.apache.cxf.aegis.util.NamespaceHelper;
 import org.apache.cxf.aegis.xml.AbstractMessageWriter;
 import org.apache.cxf.aegis.xml.MessageWriter;
 import org.apache.cxf.common.util.StringUtils;
+import org.apache.cxf.staxutils.StaxUtils;
 
 public class ElementWriter extends AbstractMessageWriter implements MessageWriter {
     private XMLStreamWriter writer;
@@ -98,7 +98,7 @@ public class ElementWriter extends AbstractMessageWriter implements MessageWrite
                
                 if (!StringUtils.isEmpty(namespace)) {
                     declare = true;
-                    prefix = NamespaceHelper.getUniquePrefix(writer);
+                    prefix = StaxUtils.getUniquePrefix(writer);
                 } else {
                     prefix = "";
                     if (!StringUtils.isEmpty(writer.getNamespaceContext().getNamespaceURI(""))) {
@@ -199,7 +199,7 @@ public class ElementWriter extends AbstractMessageWriter implements MessageWrite
             String pfx = writer.getPrefix(ns);
 
             if (pfx == null) {
-                pfx = NamespaceHelper.getUniquePrefix(writer);
+                pfx = StaxUtils.getUniquePrefix(writer);
 
                 writer.setPrefix(pfx, ns);
                 writer.writeNamespace(pfx, ns);
@@ -227,7 +227,7 @@ public class ElementWriter extends AbstractMessageWriter implements MessageWrite
                 } else if (contextPfx != null) {
                     pfx = contextPfx;
                 } else {
-                    pfx = NamespaceHelper.getUniquePrefix(writer);
+                    pfx = StaxUtils.getUniquePrefix(writer);
                 }
 
                 writer.setPrefix(pfx, ns);
