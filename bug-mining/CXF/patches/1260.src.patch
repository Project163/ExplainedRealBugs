diff --git a/api/src/main/java/org/apache/cxf/attachment/AttachmentDataSource.java b/api/src/main/java/org/apache/cxf/attachment/AttachmentDataSource.java
index aaec3feb73..1bcbbaa295 100644
--- a/api/src/main/java/org/apache/cxf/attachment/AttachmentDataSource.java
+++ b/api/src/main/java/org/apache/cxf/attachment/AttachmentDataSource.java
@@ -27,6 +27,7 @@ import javax.activation.DataSource;
 
 import org.apache.cxf.helpers.IOUtils;
 import org.apache.cxf.io.CachedOutputStream;
+import org.apache.cxf.message.Message;
 
 public class AttachmentDataSource implements DataSource {
 
@@ -43,9 +44,10 @@ public class AttachmentDataSource implements DataSource {
     public boolean isCached() {
         return cache != null;
     }
-    public void cache() throws IOException {
+    public void cache(Message message) throws IOException {
         if (cache == null) {
             cache = new CachedOutputStream();
+            AttachmentUtil.setStreamedAttachmentProperties(message, cache);
             IOUtils.copy(ins, cache);
             cache.lockOutputStream();  
             ins.close();
@@ -55,8 +57,8 @@ public class AttachmentDataSource implements DataSource {
             }
         }
     }
-    public void hold() throws IOException {
-        cache();
+    public void hold(Message message) throws IOException {
+        cache(message);
         cache.holdTempFile();
     }
     public void release() {
diff --git a/api/src/main/java/org/apache/cxf/attachment/AttachmentDeserializer.java b/api/src/main/java/org/apache/cxf/attachment/AttachmentDeserializer.java
index 23d3533269..e95e2ca0e8 100644
--- a/api/src/main/java/org/apache/cxf/attachment/AttachmentDeserializer.java
+++ b/api/src/main/java/org/apache/cxf/attachment/AttachmentDeserializer.java
@@ -19,7 +19,6 @@
 
 package org.apache.cxf.attachment;
 
-import java.io.File;
 import java.io.IOException;
 import java.io.InputStream;
 import java.io.PushbackInputStream;
@@ -168,37 +167,6 @@ public class AttachmentDeserializer {
         return m.find() ? "--" + m.group(1) : null;
     }
     
-    private void setStreamedAttachmentProperties(CachedOutputStream bos) throws IOException {
-        Object directory = message.getContextualProperty(ATTACHMENT_DIRECTORY);
-        if (directory != null) {
-            if (directory instanceof File) {
-                bos.setOutputDir((File)directory);
-            } else {
-                bos.setOutputDir(new File((String)directory));
-            }
-        }
-        
-        Object threshold = message.getContextualProperty(ATTACHMENT_MEMORY_THRESHOLD);
-        if (threshold != null) {
-            if (threshold instanceof Long) {
-                bos.setThreshold((Long)threshold);
-            } else {
-                bos.setThreshold(Long.valueOf((String)threshold));
-            }
-        } else {
-            bos.setThreshold(THRESHOLD);
-        }
-
-        Object maxSize = message.getContextualProperty(ATTACHMENT_MAX_SIZE);
-        if (maxSize != null) {
-            if (maxSize instanceof Long) {
-                bos.setMaxSize((Long) maxSize);
-            } else {
-                bos.setMaxSize(Long.valueOf((String)maxSize));
-            }
-        }
-    }
-
     public AttachmentImpl readNext() throws IOException {
         // Cache any mime parts that are currently being streamed
         cacheStreamedAttachments();
@@ -237,7 +205,7 @@ public class AttachmentDeserializer {
             if (s instanceof AttachmentDataSource) {
                 AttachmentDataSource ads = (AttachmentDataSource)s;
                 if (!ads.isCached()) {
-                    ads.cache();
+                    ads.cache(message);
                 }
             } else if (s.getInputStream() instanceof DelegatingInputStream) {
                 cache((DelegatingInputStream) s.getInputStream(), false);
@@ -256,7 +224,7 @@ public class AttachmentDeserializer {
         InputStream origIn = input.getInputStream();
         try {
             out = new CachedOutputStream();
-            setStreamedAttachmentProperties(out);
+            AttachmentUtil.setStreamedAttachmentProperties(message, out);
             IOUtils.copy(input, out);
             input.setInputStream(out.getInputStream());
             origIn.close();
diff --git a/api/src/main/java/org/apache/cxf/attachment/AttachmentUtil.java b/api/src/main/java/org/apache/cxf/attachment/AttachmentUtil.java
index f8a49e041e..2fea030ce2 100644
--- a/api/src/main/java/org/apache/cxf/attachment/AttachmentUtil.java
+++ b/api/src/main/java/org/apache/cxf/attachment/AttachmentUtil.java
@@ -47,7 +47,9 @@ import javax.mail.internet.InternetHeaders;
 
 import org.apache.cxf.helpers.HttpHeaderHelper;
 import org.apache.cxf.interceptor.Fault;
+import org.apache.cxf.io.CachedOutputStream;
 import org.apache.cxf.message.Attachment;
+import org.apache.cxf.message.Message;
 
 public final class AttachmentUtil {
     
@@ -73,6 +75,38 @@ public final class AttachmentUtil {
         return COMMAND_MAP;
     }
     
+    public static void setStreamedAttachmentProperties(Message message, CachedOutputStream bos) 
+        throws IOException {
+        Object directory = message.getContextualProperty(AttachmentDeserializer.ATTACHMENT_DIRECTORY);
+        if (directory != null) {
+            if (directory instanceof File) {
+                bos.setOutputDir((File)directory);
+            } else {
+                bos.setOutputDir(new File((String)directory));
+            }
+        }
+        
+        Object threshold = message.getContextualProperty(AttachmentDeserializer.ATTACHMENT_MEMORY_THRESHOLD);
+        if (threshold != null) {
+            if (threshold instanceof Long) {
+                bos.setThreshold((Long)threshold);
+            } else {
+                bos.setThreshold(Long.valueOf((String)threshold));
+            }
+        } else {
+            bos.setThreshold(AttachmentDeserializer.THRESHOLD);
+        }
+
+        Object maxSize = message.getContextualProperty(AttachmentDeserializer.ATTACHMENT_MAX_SIZE);
+        if (maxSize != null) {
+            if (maxSize instanceof Long) {
+                bos.setMaxSize((Long) maxSize);
+            } else {
+                bos.setMaxSize(Long.valueOf((String)maxSize));
+            }
+        }
+    }
+    
     /**
      * @param ns
      * @return
diff --git a/rt/bindings/soap/src/main/java/org/apache/cxf/binding/soap/saaj/SAAJInInterceptor.java b/rt/bindings/soap/src/main/java/org/apache/cxf/binding/soap/saaj/SAAJInInterceptor.java
index 95382f4cda..a601dd1bb5 100644
--- a/rt/bindings/soap/src/main/java/org/apache/cxf/binding/soap/saaj/SAAJInInterceptor.java
+++ b/rt/bindings/soap/src/main/java/org/apache/cxf/binding/soap/saaj/SAAJInInterceptor.java
@@ -199,7 +199,7 @@ public class SAAJInInterceptor extends AbstractSoapInterceptor {
                 for (Attachment a : atts) {
                     if (a.getDataHandler().getDataSource() instanceof AttachmentDataSource) {
                         try {
-                            ((AttachmentDataSource)a.getDataHandler().getDataSource()).cache();
+                            ((AttachmentDataSource)a.getDataHandler().getDataSource()).cache(message);
                         } catch (IOException e) {
                             throw new Fault(e);
                         }
diff --git a/rt/databinding/jaxb/src/main/java/org/apache/cxf/jaxb/attachment/JAXBAttachmentSchemaValidationHack.java b/rt/databinding/jaxb/src/main/java/org/apache/cxf/jaxb/attachment/JAXBAttachmentSchemaValidationHack.java
index 327d2869a3..007acce8ca 100644
--- a/rt/databinding/jaxb/src/main/java/org/apache/cxf/jaxb/attachment/JAXBAttachmentSchemaValidationHack.java
+++ b/rt/databinding/jaxb/src/main/java/org/apache/cxf/jaxb/attachment/JAXBAttachmentSchemaValidationHack.java
@@ -53,7 +53,7 @@ public final class JAXBAttachmentSchemaValidationHack extends AbstractPhaseInter
                 if (at.getDataHandler().getDataSource() instanceof AttachmentDataSource) {
                     AttachmentDataSource ds = (AttachmentDataSource)at.getDataHandler().getDataSource();
                     try {
-                        ds.hold();
+                        ds.hold(message);
                     } catch (IOException e) {
                         throw new Fault(e);
                     }
diff --git a/rt/transports/http/src/main/java/org/apache/cxf/transport/http/AbstractHTTPDestination.java b/rt/transports/http/src/main/java/org/apache/cxf/transport/http/AbstractHTTPDestination.java
index f5cb87983b..b2c49ae147 100644
--- a/rt/transports/http/src/main/java/org/apache/cxf/transport/http/AbstractHTTPDestination.java
+++ b/rt/transports/http/src/main/java/org/apache/cxf/transport/http/AbstractHTTPDestination.java
@@ -451,7 +451,7 @@ public abstract class AbstractHTTPDestination
             for (Attachment a : atts) {
                 if (a.getDataHandler().getDataSource() instanceof AttachmentDataSource) {
                     try {
-                        ((AttachmentDataSource)a.getDataHandler().getDataSource()).cache();
+                        ((AttachmentDataSource)a.getDataHandler().getDataSource()).cache(inMessage);
                     } catch (IOException e) {
                         throw new Fault(e);
                     }
diff --git a/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/JAXRSMultipartTest.java b/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/JAXRSMultipartTest.java
index 0f23e854ed..40c3e063d6 100644
--- a/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/JAXRSMultipartTest.java
+++ b/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/JAXRSMultipartTest.java
@@ -562,7 +562,31 @@ public class JAXRSMultipartTest extends AbstractBusClientServerTestBase {
         post.setRequestHeader("Content-Type", ct);
         Part[] parts = new Part[1];
         parts[0] = new FilePart("image",
-                new ByteArrayPartSource("testfile.png", new byte[1024 * 1024 * 15]),
+                new ByteArrayPartSource("testfile.png", new byte[1024 * 11]),
+                "image/png", null);
+        post.setRequestEntity(new MultipartRequestEntity(parts, post.getParams()));
+
+        HttpClient httpclient = new HttpClient();
+
+        try {
+            int result = httpclient.executeMethod(post);
+            assertEquals(413, result);
+        } finally {
+            // Release current connection to the connection pool once you are done
+            post.releaseConnection();
+        }
+    }
+    @Test
+    public void testMultipartRequestTooLargeManyParts() throws Exception {
+        PostMethod post = new PostMethod("http://localhost:" + PORT + "/bookstore/books/image");
+        String ct = "multipart/mixed";
+        post.setRequestHeader("Content-Type", ct);
+        Part[] parts = new Part[2];
+        parts[0] = new FilePart("image",
+                new ByteArrayPartSource("testfile.png", new byte[1024 * 9]),
+                "image/png", null);
+        parts[1] = new FilePart("image",
+                new ByteArrayPartSource("testfile2.png", new byte[1024 * 11]),
                 "image/png", null);
         post.setRequestEntity(new MultipartRequestEntity(parts, post.getParams()));
 
diff --git a/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/MultipartServer.java b/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/MultipartServer.java
index 93cc3278c8..750d0169a0 100644
--- a/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/MultipartServer.java
+++ b/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/MultipartServer.java
@@ -34,7 +34,7 @@ public class MultipartServer extends AbstractBusTestServerBase {
         sf.setResourceClasses(MultipartStore.class);
         sf.setProperties(Collections.<String, Object>singletonMap(
                 AttachmentDeserializer.ATTACHMENT_MAX_SIZE,
-                String.valueOf(1024 * 1024 * 10)));
+                String.valueOf(1024 * 10)));
         //default lifecycle is per-request, change it to singleton
         sf.setResourceProvider(MultipartStore.class,
                                new SingletonResourceProvider(new MultipartStore()));
