diff --git a/rt/ws/security/src/main/java/org/apache/cxf/ws/security/wss4j/policyhandlers/AbstractBindingBuilder.java b/rt/ws/security/src/main/java/org/apache/cxf/ws/security/wss4j/policyhandlers/AbstractBindingBuilder.java
index 1aba8ef618..8c78ea79c4 100644
--- a/rt/ws/security/src/main/java/org/apache/cxf/ws/security/wss4j/policyhandlers/AbstractBindingBuilder.java
+++ b/rt/ws/security/src/main/java/org/apache/cxf/ws/security/wss4j/policyhandlers/AbstractBindingBuilder.java
@@ -178,9 +178,9 @@ public abstract class AbstractBindingBuilder {
     protected Element bottomUpElement;
     protected Element topDownElement;
     protected Element bstElement;
+    protected Element lastEncryptedKeyElement;
     
     private Element lastSupportingTokenElement;
-    private Element lastEncryptedKeyElement;
     private Element lastDerivedKeyElement;
     
     public AbstractBindingBuilder(
@@ -199,7 +199,7 @@ public abstract class AbstractBindingBuilder {
         message.getExchange().put(WSHandlerConstants.SEND_SIGV, signatures);
     }
     
-    private void insertAfter(Element child, Element sib) {
+    protected void insertAfter(Element child, Element sib) {
         if (sib.getNextSibling() == null) {
             secHeader.getSecurityHeader().appendChild(child);
         } else {
diff --git a/rt/ws/security/src/main/java/org/apache/cxf/ws/security/wss4j/policyhandlers/AsymmetricBindingHandler.java b/rt/ws/security/src/main/java/org/apache/cxf/ws/security/wss4j/policyhandlers/AsymmetricBindingHandler.java
index 8b4cd74f89..3cb140a32b 100644
--- a/rt/ws/security/src/main/java/org/apache/cxf/ws/security/wss4j/policyhandlers/AsymmetricBindingHandler.java
+++ b/rt/ws/security/src/main/java/org/apache/cxf/ws/security/wss4j/policyhandlers/AsymmetricBindingHandler.java
@@ -315,16 +315,17 @@ public class AsymmetricBindingHandler extends AbstractBindingBuilder {
                 doEndorse();
             }
             
-            checkForSignatureProtection(encryptionToken, encrBase);
+            encryptTokensInSecurityHeader(encryptionToken, encrBase);
         }
     }
     
     
-    private void checkForSignatureProtection(AbstractToken encryptionToken, WSSecBase encrBase) {
+    private void encryptTokensInSecurityHeader(AbstractToken encryptionToken, WSSecBase encrBase) {
+        List<WSEncryptionPart> secondEncrParts = new ArrayList<WSEncryptionPart>();
+        
         // Check for signature protection
         if (abinding.isEncryptSignature()) {
             policyAsserted(SPConstants.ENCRYPT_SIGNATURE);
-            List<WSEncryptionPart> secondEncrParts = new ArrayList<WSEncryptionPart>();
 
             // Now encrypt the signature using the above token
             if (mainSigId != null) {
@@ -336,35 +337,45 @@ public class AsymmetricBindingHandler extends AbstractBindingBuilder {
             if (sigConfList != null && !sigConfList.isEmpty()) {
                 secondEncrParts.addAll(sigConfList);
             }
+        }
             
-            if (isRequestor()) {
-                secondEncrParts.addAll(encryptedTokensList);
-            }
+        // Add any SupportingTokens that need to be encrypted
+        if (isRequestor()) {
+            secondEncrParts.addAll(encryptedTokensList);
+        }
+        
+        if (secondEncrParts.isEmpty()) {
+            return;
+        }
 
-            if (encryptionToken.getDerivedKeys() == DerivedKeys.RequireDerivedKeys && !secondEncrParts.isEmpty()
-                && encrBase instanceof WSSecDKEncrypt) {
-                try {
-                    Element secondRefList 
-                        = ((WSSecDKEncrypt)encrBase).encryptForExternalRef(null, secondEncrParts);
-                    ((WSSecDKEncrypt)encrBase).addExternalRefElement(secondRefList, secHeader);
+        // Perform encryption
+        if (encryptionToken.getDerivedKeys() == DerivedKeys.RequireDerivedKeys
+            && encrBase instanceof WSSecDKEncrypt) {
+            try {
+                Element secondRefList = 
+                    ((WSSecDKEncrypt)encrBase).encryptForExternalRef(null, secondEncrParts);
+                ((WSSecDKEncrypt)encrBase).addExternalRefElement(secondRefList, secHeader);
 
-                } catch (WSSecurityException ex) {
-                    throw new Fault(ex);
-                }
-            } else if (!secondEncrParts.isEmpty() && encrBase instanceof WSSecEncrypt) {
-                try {
-                    // Encrypt, get hold of the ref list and add it
-                    Element secondRefList = saaj.getSOAPPart()
-                        .createElementNS(WSConstants.ENC_NS,
-                                         WSConstants.ENC_PREFIX + ":ReferenceList");
+            } catch (WSSecurityException ex) {
+                throw new Fault(ex);
+            }
+        } else if (encrBase instanceof WSSecEncrypt) {
+            try {
+                // Encrypt, get hold of the ref list and add it
+                Element secondRefList = saaj.getSOAPPart()
+                    .createElementNS(WSConstants.ENC_NS,
+                                     WSConstants.ENC_PREFIX + ":ReferenceList");
+                if (lastEncryptedKeyElement != null) {
+                    insertAfter(secondRefList, lastEncryptedKeyElement);
+                } else {
                     this.insertBeforeBottomUp(secondRefList);
-                    ((WSSecEncrypt)encrBase).encryptForRef(secondRefList, secondEncrParts);
-                    
-                } catch (WSSecurityException ex) {
-                    throw new Fault(ex);
                 }
+                ((WSSecEncrypt)encrBase).encryptForRef(secondRefList, secondEncrParts);
+
+            } catch (WSSecurityException ex) {
+                throw new Fault(ex);
             }
-        }        
+        }
     }
     
     private WSSecBase doEncryption(AbstractTokenWrapper recToken,
diff --git a/rt/ws/security/src/main/java/org/apache/cxf/ws/security/wss4j/policyhandlers/StaxAsymmetricBindingHandler.java b/rt/ws/security/src/main/java/org/apache/cxf/ws/security/wss4j/policyhandlers/StaxAsymmetricBindingHandler.java
index fefae2eb2a..b2b06e0023 100644
--- a/rt/ws/security/src/main/java/org/apache/cxf/ws/security/wss4j/policyhandlers/StaxAsymmetricBindingHandler.java
+++ b/rt/ws/security/src/main/java/org/apache/cxf/ws/security/wss4j/policyhandlers/StaxAsymmetricBindingHandler.java
@@ -241,6 +241,13 @@ public class StaxAsymmetricBindingHandler extends AbstractStaxBindingHandler {
             }
             
             if (encryptionToken != null && encrParts.size() > 0) {
+                if (isRequestor()) {
+                    addSupportingTokens();
+                    encrParts.addAll(encryptedTokensList);
+                } else {
+                    addSignatureConfirmation(sigParts);
+                }
+                
                 //Check for signature protection
                 if (abinding.isEncryptSignature()) {
                     SecurePart part = 
@@ -255,12 +262,6 @@ public class StaxAsymmetricBindingHandler extends AbstractStaxBindingHandler {
                     sigParts.add(part);
                 }
                 
-                if (isRequestor()) {
-                    addSupportingTokens();
-                } else {
-                    addSignatureConfirmation(sigParts);
-                }
-                
                 if ((sigParts.size() > 0) && initiatorWrapper != null && isRequestor()) {
                     doSignature(initiatorWrapper, sigParts, attached);
                 } else if (!isRequestor()) {
diff --git a/systests/ws-security/src/test/java/org/apache/cxf/systest/ws/x509/StaxX509TokenTest.java b/systests/ws-security/src/test/java/org/apache/cxf/systest/ws/x509/StaxX509TokenTest.java
index 24ab4ecd03..d3d9e3881f 100644
--- a/systests/ws-security/src/test/java/org/apache/cxf/systest/ws/x509/StaxX509TokenTest.java
+++ b/systests/ws-security/src/test/java/org/apache/cxf/systest/ws/x509/StaxX509TokenTest.java
@@ -363,6 +363,34 @@ public class StaxX509TokenTest extends AbstractBusClientServerTestBase {
         ((java.io.Closeable)x509Port).close();
         bus.shutdown(true);
     }
+    
+    @org.junit.Test
+    public void testAsymmetricUsernameToken() throws Exception {
+
+        SpringBusFactory bf = new SpringBusFactory();
+        URL busFile = StaxX509TokenTest.class.getResource("client/client.xml");
+
+        Bus bus = bf.createBus(busFile.toString());
+        SpringBusFactory.setDefaultBus(bus);
+        SpringBusFactory.setThreadDefaultBus(bus);
+
+        URL wsdl = X509TokenTest.class.getResource("DoubleItX509.wsdl");
+        Service service = Service.create(wsdl, SERVICE_QNAME);
+        QName portQName = new QName(NAMESPACE, "DoubleItAsymmetricUsernameTokenPort");
+        DoubleItPortType x509Port = 
+                service.getPort(portQName, DoubleItPortType.class);
+        updateAddressPort(x509Port, PORT);
+        
+        // DOM
+        x509Port.doubleIt(25);
+        
+        // Streaming
+        SecurityTestUtil.enableStreaming(x509Port);
+        x509Port.doubleIt(25);
+        
+        ((java.io.Closeable)x509Port).close();
+        bus.shutdown(true);
+    }
     /*
     @org.junit.Test
     public void testSymmetricProtectTokens() throws Exception {
@@ -386,6 +414,7 @@ public class StaxX509TokenTest extends AbstractBusClientServerTestBase {
         bus.shutdown(true);
     }
     */
+    
     @org.junit.Test
     public void testTransportEndorsing() throws Exception {
 
diff --git a/systests/ws-security/src/test/java/org/apache/cxf/systest/ws/x509/X509TokenTest.java b/systests/ws-security/src/test/java/org/apache/cxf/systest/ws/x509/X509TokenTest.java
index d785987970..52f8c641ab 100644
--- a/systests/ws-security/src/test/java/org/apache/cxf/systest/ws/x509/X509TokenTest.java
+++ b/systests/ws-security/src/test/java/org/apache/cxf/systest/ws/x509/X509TokenTest.java
@@ -358,6 +358,34 @@ public class X509TokenTest extends AbstractBusClientServerTestBase {
         bus.shutdown(true);
     }
     
+    @org.junit.Test
+    public void testAsymmetricUsernameToken() throws Exception {
+
+        SpringBusFactory bf = new SpringBusFactory();
+        URL busFile = X509TokenTest.class.getResource("client/client.xml");
+
+        Bus bus = bf.createBus(busFile.toString());
+        SpringBusFactory.setDefaultBus(bus);
+        SpringBusFactory.setThreadDefaultBus(bus);
+
+        URL wsdl = X509TokenTest.class.getResource("DoubleItX509.wsdl");
+        Service service = Service.create(wsdl, SERVICE_QNAME);
+        QName portQName = new QName(NAMESPACE, "DoubleItAsymmetricUsernameTokenPort");
+        DoubleItPortType x509Port = 
+                service.getPort(portQName, DoubleItPortType.class);
+        updateAddressPort(x509Port, PORT);
+        
+        // DOM
+        x509Port.doubleIt(25);
+        
+        // Streaming
+        SecurityTestUtil.enableStreaming(x509Port);
+        x509Port.doubleIt(25);
+        
+        ((java.io.Closeable)x509Port).close();
+        bus.shutdown(true);
+    }
+    
     @org.junit.Test
     public void testSymmetricProtectTokens() throws Exception {
 
diff --git a/systests/ws-security/src/test/resources/org/apache/cxf/systest/ws/x509/DoubleItX509.wsdl b/systests/ws-security/src/test/resources/org/apache/cxf/systest/ws/x509/DoubleItX509.wsdl
index 401c08fc3b..f4bf5386cf 100644
--- a/systests/ws-security/src/test/resources/org/apache/cxf/systest/ws/x509/DoubleItX509.wsdl
+++ b/systests/ws-security/src/test/resources/org/apache/cxf/systest/ws/x509/DoubleItX509.wsdl
@@ -201,6 +201,25 @@
             </wsdl:fault>
         </wsdl:operation>
     </wsdl:binding>
+    <wsdl:binding name="DoubleItAsymmetricUsernameTokenBinding" type="tns:DoubleItPortType">
+        <wsp:PolicyReference URI="#DoubleItAsymmetricUsernameTokenPolicy" />
+        <soap:binding style="document"
+            transport="http://schemas.xmlsoap.org/soap/http" />
+        <wsdl:operation name="DoubleIt">
+            <soap:operation soapAction="" />
+            <wsdl:input>
+                <soap:body use="literal" />
+                <wsp:PolicyReference URI="#DoubleItBinding_DoubleIt_Input_Policy"/>
+            </wsdl:input>
+            <wsdl:output>
+                <soap:body use="literal" />
+                <wsp:PolicyReference URI="#DoubleItBinding_DoubleIt_Output_Policy"/>
+            </wsdl:output>
+            <wsdl:fault name="DoubleItFault">
+                <soap:body use="literal" name="DoubleItFault" />
+            </wsdl:fault>
+        </wsdl:operation>
+    </wsdl:binding>
     <wsdl:binding name="DoubleItSymmetricProtectTokensBinding" type="tns:DoubleItPortType">
         <wsp:PolicyReference URI="#DoubleItSymmetricProtectTokensPolicy" />
         <soap:binding style="document"
@@ -400,6 +419,10 @@
                    binding="tns:DoubleItAsymmetricProtectTokensBinding">
             <soap:address location="http://localhost:9001/DoubleItX509AsymmetricProtect" />
         </wsdl:port>
+        <wsdl:port name="DoubleItAsymmetricUsernameTokenPort" 
+                   binding="tns:DoubleItAsymmetricUsernameTokenBinding">
+            <soap:address location="http://localhost:9001/DoubleItX509AsymmetricUsernameToken" />
+        </wsdl:port>
         <wsdl:port name="DoubleItSymmetricProtectTokensPort" 
                    binding="tns:DoubleItSymmetricProtectTokensBinding">
             <soap:address location="http://localhost:9001/DoubleItX509SymmetricProtect" />
@@ -785,6 +808,60 @@
       </wsp:ExactlyOne>
     </wsp:Policy>
     
+    <wsp:Policy wsu:Id="DoubleItAsymmetricUsernameTokenPolicy">
+      <wsp:ExactlyOne>
+         <wsp:All>
+            <sp:AsymmetricBinding>
+               <wsp:Policy>
+                  <sp:InitiatorToken>
+                     <wsp:Policy>
+                        <sp:X509Token
+                           sp:IncludeToken="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient">
+                           <wsp:Policy>
+                              <sp:WssX509V3Token10 />
+                           </wsp:Policy>
+                        </sp:X509Token>
+                     </wsp:Policy>
+                  </sp:InitiatorToken>
+                  <sp:RecipientToken>
+                     <wsp:Policy>
+                        <sp:X509Token
+                           sp:IncludeToken="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToInitiator">
+                           <wsp:Policy>
+                              <sp:WssX509V3Token10 />
+                           </wsp:Policy>
+                        </sp:X509Token>
+                     </wsp:Policy>
+                  </sp:RecipientToken>
+                  <sp:Layout>
+                     <wsp:Policy>
+                        <sp:Lax/>
+                     </wsp:Policy>
+                  </sp:Layout>
+                  <sp:IncludeTimestamp/>
+                  <sp:OnlySignEntireHeadersAndBody/>
+                  <sp:EncryptBeforeSigning/>
+                  <sp:AlgorithmSuite>
+                     <wsp:Policy>
+                        <sp:Basic128/>
+                     </wsp:Policy>
+                  </sp:AlgorithmSuite>
+               </wsp:Policy>
+            </sp:AsymmetricBinding>
+            <sp:EncryptedSupportingTokens>
+               <wsp:Policy>
+                    <sp:UsernameToken
+                       sp:IncludeToken="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient">
+                       <wsp:Policy>
+                          <sp:WssUsernameToken11/>
+                       </wsp:Policy>
+                    </sp:UsernameToken>
+                </wsp:Policy>
+            </sp:EncryptedSupportingTokens>
+         </wsp:All>
+      </wsp:ExactlyOne>
+    </wsp:Policy>
+    
     <wsp:Policy wsu:Id="DoubleItSymmetricProtectTokensPolicy">
         <wsp:ExactlyOne>
             <wsp:All>
diff --git a/systests/ws-security/src/test/resources/org/apache/cxf/systest/ws/x509/client/client.xml b/systests/ws-security/src/test/resources/org/apache/cxf/systest/ws/x509/client/client.xml
index a9377a1d96..860c4f6b59 100644
--- a/systests/ws-security/src/test/resources/org/apache/cxf/systest/ws/x509/client/client.xml
+++ b/systests/ws-security/src/test/resources/org/apache/cxf/systest/ws/x509/client/client.xml
@@ -193,6 +193,21 @@
        </jaxws:properties>
     </jaxws:client>
     
+    <jaxws:client name="{http://www.example.org/contract/DoubleIt}DoubleItAsymmetricUsernameTokenPort" 
+                  createdFromAPI="true">
+       <jaxws:properties>
+           <entry key="ws-security.encryption.properties" 
+                  value="org/apache/cxf/systest/ws/wssec10/client/bob.properties"/> 
+           <entry key="ws-security.encryption.username" value="bob"/>
+           <entry key="ws-security.signature.properties" 
+                  value="org/apache/cxf/systest/ws/wssec10/client/alice.properties"/> 
+           <entry key="ws-security.signature.username" value="alice"/>
+           <entry key="ws-security.username" value="alice"/>
+           <entry key="ws-security.callback-handler" 
+                  value="org.apache.cxf.systest.ws.wssec10.client.KeystorePasswordCallback"/>
+       </jaxws:properties>
+    </jaxws:client>
+    
     <jaxws:client name="{http://www.example.org/contract/DoubleIt}DoubleItSymmetricProtectTokensPort" 
                   createdFromAPI="true">
        <jaxws:properties>
diff --git a/systests/ws-security/src/test/resources/org/apache/cxf/systest/ws/x509/server/server.xml b/systests/ws-security/src/test/resources/org/apache/cxf/systest/ws/x509/server/server.xml
index 104af0894e..05f1010c93 100644
--- a/systests/ws-security/src/test/resources/org/apache/cxf/systest/ws/x509/server/server.xml
+++ b/systests/ws-security/src/test/resources/org/apache/cxf/systest/ws/x509/server/server.xml
@@ -325,6 +325,26 @@
      
     </jaxws:endpoint> 
     
+    <jaxws:endpoint 
+       id="AsymmetricUsernameToken"
+       address="http://localhost:${testutil.ports.Server}/DoubleItX509AsymmetricUsernameToken" 
+       serviceName="s:DoubleItService"
+       endpointName="s:DoubleItAsymmetricUsernameTokenPort"
+       xmlns:s="http://www.example.org/contract/DoubleIt"
+       implementor="org.apache.cxf.systest.ws.common.DoubleItImpl"
+       wsdlLocation="org/apache/cxf/systest/ws/x509/DoubleItX509.wsdl">
+        
+       <jaxws:properties>
+          <entry key="ws-security.callback-handler" 
+                  value="org.apache.cxf.systest.ws.wssec10.client.KeystorePasswordCallback"/>
+          <entry key="ws-security.signature.properties" 
+                  value="org/apache/cxf/systest/ws/wssec10/client/bob.properties"/> 
+          <entry key="ws-security.encryption.username" value="useReqSigCert"/>
+          <entry key="ws-security.subject.cert.constraints" value=".*O=apache.org.*"/>
+       </jaxws:properties> 
+     
+    </jaxws:endpoint> 
+    
     <jaxws:endpoint 
        id="SymmetricProtectTokens"
        address="http://localhost:${testutil.ports.Server}/DoubleItX509SymmetricProtect" 
diff --git a/systests/ws-security/src/test/resources/org/apache/cxf/systest/ws/x509/server/stax-server.xml b/systests/ws-security/src/test/resources/org/apache/cxf/systest/ws/x509/server/stax-server.xml
index 8630634d3a..91f5542f34 100644
--- a/systests/ws-security/src/test/resources/org/apache/cxf/systest/ws/x509/server/stax-server.xml
+++ b/systests/ws-security/src/test/resources/org/apache/cxf/systest/ws/x509/server/stax-server.xml
@@ -336,6 +336,27 @@
           <entry key="ws-security.enable.streaming" value="true"/>
        </jaxws:properties> 
      
+    </jaxws:endpoint> 
+    
+     <jaxws:endpoint 
+       id="AsymmetricUsernameToken"
+       address="http://localhost:${testutil.ports.StaxServer}/DoubleItX509AsymmetricUsernameToken" 
+       serviceName="s:DoubleItService"
+       endpointName="s:DoubleItAsymmetricUsernameTokenPort"
+       xmlns:s="http://www.example.org/contract/DoubleIt"
+       implementor="org.apache.cxf.systest.ws.common.DoubleItImpl"
+       wsdlLocation="org/apache/cxf/systest/ws/x509/DoubleItX509.wsdl">
+        
+       <jaxws:properties>
+          <entry key="ws-security.callback-handler" 
+                  value="org.apache.cxf.systest.ws.wssec10.client.KeystorePasswordCallback"/>
+          <entry key="ws-security.signature.properties" 
+                  value="org/apache/cxf/systest/ws/wssec10/client/bob.properties"/> 
+          <entry key="ws-security.encryption.username" value="useReqSigCert"/>
+          <entry key="ws-security.subject.cert.constraints" value=".*O=apache.org.*"/>
+          <entry key="ws-security.enable.streaming" value="true"/>
+       </jaxws:properties> 
+     
     </jaxws:endpoint> 
     
     <jaxws:endpoint 
