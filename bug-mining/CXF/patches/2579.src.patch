diff --git a/rt/ws/security/src/main/java/org/apache/cxf/ws/security/wss4j/policyhandlers/SymmetricBindingHandler.java b/rt/ws/security/src/main/java/org/apache/cxf/ws/security/wss4j/policyhandlers/SymmetricBindingHandler.java
index 8068e341c4..6b4c4e8af4 100644
--- a/rt/ws/security/src/main/java/org/apache/cxf/ws/security/wss4j/policyhandlers/SymmetricBindingHandler.java
+++ b/rt/ws/security/src/main/java/org/apache/cxf/ws/security/wss4j/policyhandlers/SymmetricBindingHandler.java
@@ -486,23 +486,11 @@ public class SymmetricBindingHandler extends AbstractBindingBuilder {
             Element encrDKTokenElem = null;
             encrDKTokenElem = dkEncr.getdktElement();
             addDerivedKeyElement(encrDKTokenElem);
+            
             Element refList = dkEncr.encryptForExternalRef(null, encrParts);
             List<Element> attachments = dkEncr.getAttachmentEncryptedDataElements();
-            if (atEnd) {
-                this.insertBeforeBottomUp(refList);
-                if (attachments != null) {
-                    for (Element attachment : attachments) {
-                        this.insertBeforeBottomUp(attachment);
-                    }
-                }
-            } else {
-                this.addDerivedKeyElement(refList);
-                if (attachments != null) {
-                    for (Element attachment : attachments) {
-                        this.addDerivedKeyElement(attachment);
-                    }
-                }
-            }
+            addAttachmentsForEncryption(atEnd, refList, attachments);
+
             return dkEncr;
         } catch (Exception e) {
             LOG.log(Level.FINE, e.getMessage(), e);
@@ -608,21 +596,7 @@ public class SymmetricBindingHandler extends AbstractBindingBuilder {
                    
                     Element refList = encr.encryptForRef(null, encrParts);
                     List<Element> attachments = encr.getAttachmentEncryptedDataElements();
-                    if (atEnd) {
-                        this.insertBeforeBottomUp(refList);
-                        if (attachments != null) {
-                            for (Element attachment : attachments) {
-                                this.insertBeforeBottomUp(attachment);
-                            }
-                        }
-                    } else {
-                        this.addDerivedKeyElement(refList);
-                        if (attachments != null) {
-                            for (Element attachment : attachments) {
-                                this.addDerivedKeyElement(attachment);
-                            }
-                        }
-                    }
+                    addAttachmentsForEncryption(atEnd, refList, attachments);
                     
                     return encr;
                 } catch (WSSecurityException e) {
@@ -632,7 +606,25 @@ public class SymmetricBindingHandler extends AbstractBindingBuilder {
             }
         }
         return null;
-    }    
+    }
+    
+    private void addAttachmentsForEncryption(boolean atEnd, Element refList, List<Element> attachments) {
+        if (atEnd) {
+            this.insertBeforeBottomUp(refList);
+            if (attachments != null) {
+                for (Element attachment : attachments) {
+                    this.insertBeforeBottomUp(attachment);
+                }
+            }
+        } else {
+            this.addDerivedKeyElement(refList);
+            if (attachments != null) {
+                for (Element attachment : attachments) {
+                    this.addDerivedKeyElement(attachment);
+                }
+            }
+        }
+    }
     
     private byte[] doSignatureDK(List<WSEncryptionPart> sigs,
                                AbstractTokenWrapper policyAbstractTokenWrapper, 
