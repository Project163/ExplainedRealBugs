<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:45:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-3304] WebClient POST to a resource that returns 401 returns a blank InputStream when there&apos;s supposed to be text</title>
                <link>https://issues.apache.org/jira/browse/CXF-3304</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;I have two methods that return the same error message upon POST. The only difference is that one returns a 404 response status, the other returns a 401 response status.&lt;/p&gt;

&lt;p&gt;POSTing to the resource that returns 404 returns an InputStream containing the error message when you call Response.getEntity(). However, POSTing to the resource that returns 401 returns a blank InputStream when you call Response.getEntity().&lt;/p&gt;

&lt;p&gt;This problem was not reproducible with GET.&lt;/p&gt;

&lt;p&gt;Test case code attached. Launch the server using JettyServer. Then run the WebClient test in WebClientTest.&lt;/p&gt;</description>
                <environment>&lt;p&gt;JDK 1.6&lt;/p&gt;</environment>
        <key id="12497538">CXF-3304</key>
            <summary>WebClient POST to a resource that returns 401 returns a blank InputStream when there&apos;s supposed to be text</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="sergey_beryozkin">Sergey Beryozkin</assignee>
                                    <reporter username="jadowney">Jason Downey</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 Feb 2011 05:25:15 +0000</created>
                <updated>Tue, 1 Mar 2011 15:53:39 +0000</updated>
                            <resolved>Wed, 9 Feb 2011 13:01:47 +0000</resolved>
                                    <version>2.3.2</version>
                                    <fixVersion>2.3.3</fixVersion>
                    <fixVersion>2.4</fixVersion>
                                    <component>JAX-RS</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12991190" author="sergey_beryozkin" created="Sun, 6 Feb 2011 18:08:19 +0000"  >&lt;p&gt;I&apos;ve debugged and I can see that HttpURLConnection is returning an empty stream, both for conn.getInputStream and conn.getErrorStream(), despite the fact the text is contained in the error response.&lt;/p&gt;

&lt;p&gt;Can you please verify it on your own, first check that the server actually returns the text, using the tcptrace, and then check the streams explicitly, perhaps using Apache HttpClient or just useing HTTPURLConnection directly ?&lt;/p&gt;

&lt;p&gt;I suspect it is just a strange error in the Java HTTPUrlConnection. I believe 401 is usually supposed to have no response body so it could be HTTPUrlConnection enforces it by ignoring the response text if any&lt;/p&gt;

&lt;p&gt;cheers, Sergey  &lt;/p&gt;</comment>
                            <comment id="12991218" author="cxfuser71" created="Sun, 6 Feb 2011 21:09:10 +0000"  >&lt;p&gt;This is just a FYI.&lt;br/&gt;
With JAX-WS we had similar situation with CXF 2.3.1 release which was patched in 2.3.2.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-3249&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CXF-3249&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12991336" author="sergey_beryozkin" created="Mon, 7 Feb 2011 11:06:43 +0000"  >&lt;p&gt;Thanks for the comment but this is a different issue. HttpUrlConnection returns null for response and error streams and now the null stream is wrapped in an empty stream but the issue is about the response text available in the response body being lost, only in case of POSTs resulting in 401 - I believe it&apos;s an HTTPUrlConnection level issue.&lt;/p&gt;</comment>
                            <comment id="12991449" author="jadowney" created="Mon, 7 Feb 2011 16:38:43 +0000"  >&lt;p&gt;The text is definitely returned to the client. I can see the error message using browser-based REST test tools such as RESTClient in FireFox.&lt;/p&gt;

&lt;p&gt;I added more code to cxf_jax_rs_post_401_bug_httpurlconnection.zip to test HttpURLConnection directly and it worked. However, in order for the error message to appear in getErrorStream() I had to either 1) check the response code of the message first or 2) call getInputStream() (which results in a FileNotFoundException) and then call getErrorStream().&lt;/p&gt;

&lt;p&gt;Would it be possible to do something similar in WebClient?&lt;/p&gt;</comment>
                            <comment id="12991469" author="sergey_beryozkin" created="Mon, 7 Feb 2011 17:00:02 +0000"  >&lt;p&gt;Hi Jason - I&apos;m clueless &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. CXF HTTP Conduit clearly shows me that after conn.getResponseCode() returns 401, conn.getErrorStream() is called next and it returns null. &lt;/p&gt;

&lt;p&gt;Can you give me a favor please and post a non-empty request and see if the text is lost or not ? I&apos;m wandering may be it&apos;s something to do with the way HttpConduit handles empty post requests...&lt;/p&gt;

&lt;p&gt;thanks  &lt;/p&gt;</comment>
                            <comment id="12991805" author="jadowney" created="Tue, 8 Feb 2011 05:19:21 +0000"  >&lt;p&gt;Thanks for your hint about looking at HTTPConduit. I set some break points there and found the suspect code. I&apos;m not sure how to fix it though so I&apos;ll look to you for help on that &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;The cause for my grief is in HTTPConduit.prepare (lines 634 to 645 in 2.3.2&apos;s source). By default, csPolicy.isAllowChunking is true and this causes the HttpURLConnection.setChunkedStreamingMode to be set to -1. If it is set (as it currently is), havoc ensues. If setChunckedStreamingMode isn&apos;t set, getErrorStream works as it&apos;s supposed to. &lt;/p&gt;

&lt;p&gt;Now that we now what causes the issue, is there a way in WebClient to specify the HTTPClientPolicy for a request? I briefly looked at the methods and couldn&apos;t find any.&lt;/p&gt;

&lt;p&gt;By the way, WebClient behaves the same whether or not there is actual data in the post. &lt;/p&gt;


</comment>
                            <comment id="12991879" author="sergey_beryozkin" created="Tue, 8 Feb 2011 10:02:46 +0000"  >&lt;p&gt;Hi Jason - thanks for spending the time on it and finding the cause of this issue. &lt;br/&gt;
HttpURLConnection.setChunkedStreamingMode(-1) works well for the usual cases, so I guess what we can do is to configure the policy: either disable the chunking or set the chunkedStreamingMode to something different, to 2048 or similar...&lt;/p&gt;

&lt;p&gt;You can do it like this:&lt;/p&gt;

&lt;p&gt;WebClient.getConfig(client).getHttpConduit().getClient().setAllowChunking(false);&lt;/p&gt;

&lt;p&gt;or&lt;/p&gt;

&lt;p&gt;WebClient.getConfig(client).getHttpConduit().getClient().setChunkedStreamingMode(2048);&lt;/p&gt;


&lt;p&gt;WebClient.getConfig(client) works for web clients and proxies.&lt;/p&gt;

&lt;p&gt;So may be if you can confirm configuring the policy fixes the issue then we close this JIRA &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ?&lt;/p&gt;</comment>
                            <comment id="12992026" author="jadowney" created="Tue, 8 Feb 2011 16:25:11 +0000"  >&lt;p&gt;As long as the HttpConduit was previously initialized, the workaround was fine. For the very first WebClient request, I found that I needed to manually register the ClientOnlyHTTPTransportFactory.&lt;/p&gt;

&lt;p&gt;I&apos;ve uploaded the final demo file illustrating this workaround.&lt;/p&gt;</comment>
                            <comment id="12992467" author="sergey_beryozkin" created="Wed, 9 Feb 2011 12:59:25 +0000"  >&lt;p&gt;Thanks for this test. It actually reminded me that AbstractClient had a code dealing a non-initialized ConduitSelector and it also let me resolve &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-3124&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CXF-3124&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I&apos;ve added the test, the relevant merge should be recorded here...&lt;/p&gt;

</comment>
                            <comment id="12992471" author="sergey_beryozkin" created="Wed, 9 Feb 2011 13:01:47 +0000"  >&lt;p&gt;The reported side-effect with the text accompanying the 401 response is only visible if the chunking is enabled. Disabling the chunking (or possibly changing the default chunking threshold value) leads to an expected result.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12470601" name="WebClientTest.java" size="4522" author="jadowney" created="Tue, 8 Feb 2011 16:25:11 +0000"/>
                            <attachment id="12470102" name="cxf_jax_rs_post_401_bug.zip" size="2043" author="jadowney" created="Thu, 3 Feb 2011 05:26:55 +0000"/>
                            <attachment id="12470461" name="cxf_jax_rs_post_401_bug_httpurlconnection.zip" size="2426" author="jadowney" created="Mon, 7 Feb 2011 16:34:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>46917</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 41 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0a31j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>56766</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>