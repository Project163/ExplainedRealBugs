<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:57:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-4716] WS-security policies enforcement with CXF server, bad policy selected</title>
                <link>https://issues.apache.org/jira/browse/CXF-4716</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;The problem is related to WS-security policies, only when a service is exposed with CXF in Tomcat :&lt;/p&gt;

&lt;p&gt;We have 2 operations :&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;getMsgChiffr : the &quot;chiffr_policy&quot; security policy is  bound&lt;/li&gt;
	&lt;li&gt;getMsg2ChiffrBody : the &quot;chiffr_body_policy&quot; security policy is  bound&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The input request for these 2 operations is composed of :&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;an input message : a string&lt;/li&gt;
	&lt;li&gt;a header : two strings&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The 2 policies are :&lt;br/&gt;
chiffr_body_policy : only the body must be encrypted&lt;br/&gt;
chiffr_policy : body+headers must be encrypted&lt;/p&gt;


&lt;p&gt;When getMsgChiffr is called, all is fine. CXF checks if &quot;chiff_policy&quot; is correctly applied (= body+headers encrypted)&lt;/p&gt;

&lt;p&gt;When getMsg2ChiffrBody is called, CXF checks &quot;chiff_policy&quot; instead of &quot;chiffr_body_policy&quot;. The stacktrace is :&lt;/p&gt;

&lt;p&gt;2012-12-20 17:16:21,037-DEBUG PolicyBasedWSS4JInInterceptor - Incoming request failed signed-encrypted policy validation&lt;br/&gt;
2012-12-20 17:16:21,037-DEBUG WSS4JInInterceptor - WSS4JInInterceptor: exit handleMessage()&lt;br/&gt;
2012-12-20 17:16:21,052-DEBUG PhaseInterceptorChain - Invoking handleMessage on interceptor org.apache.cxf.binding.soap.interceptor.CheckFaultInterceptor@1c673a9&lt;br/&gt;
2012-12-20 17:16:21,052-DEBUG PhaseInterceptorChain - Invoking handleMessage on interceptor org.apache.cxf.jaxb.attachment.JAXBAttachmentSchemaValidationHack@2a6c5e&lt;br/&gt;
2012-12-20 17:16:21,052-DEBUG PhaseInterceptorChain - Invoking handleMessage on interceptor org.apache.cxf.interceptor.DocLiteralInInterceptor@46a62&lt;br/&gt;
2012-12-20 17:16:21,052-DEBUG PhaseInterceptorChain - Invoking handleMessage on interceptor org.apache.cxf.binding.soap.interceptor.SoapHeaderInterceptor@1e463a2&lt;br/&gt;
2012-12-20 17:16:21,052-DEBUG PhaseInterceptorChain - Invoking handleMessage on interceptor org.apache.cxf.interceptor.OneWayProcessorInterceptor@1173444&lt;br/&gt;
2012-12-20 17:16:21,052-DEBUG PhaseInterceptorChain - Invoking handleMessage on interceptor org.apache.cxf.jaxws.interceptors.WrapperClassInInterceptor@688800&lt;br/&gt;
2012-12-20 17:16:21,052-DEBUG PhaseInterceptorChain - Invoking handleMessage on interceptor org.apache.cxf.jaxws.interceptors.SwAInInterceptor@b07eeb&lt;br/&gt;
2012-12-20 17:16:21,052-DEBUG PhaseInterceptorChain - Invoking handleMessage on interceptor org.apache.cxf.jaxws.interceptors.HolderInInterceptor@b8ec86&lt;br/&gt;
2012-12-20 17:16:21,052-DEBUG PhaseInterceptorChain - Invoking handleMessage on interceptor org.apache.cxf.ws.policy.PolicyVerificationInInterceptor@1d6f8ae&lt;br/&gt;
2012-12-20 17:16:21,052-DEBUG PhaseInterceptorChain - Invoking handleFault on interceptor org.apache.cxf.ws.policy.PolicyVerificationInInterceptor@1d6f8ae&lt;br/&gt;
2012-12-20 17:16:21,052-DEBUG PhaseInterceptorChain - Invoking handleFault on interceptor org.apache.cxf.jaxws.interceptors.HolderInInterceptor@b8ec86&lt;br/&gt;
2012-12-20 17:16:21,052-DEBUG PhaseInterceptorChain - Invoking handleFault on interceptor org.apache.cxf.jaxws.interceptors.SwAInInterceptor@b07eeb&lt;br/&gt;
2012-12-20 17:16:21,052-DEBUG PhaseInterceptorChain - Invoking handleFault on interceptor org.apache.cxf.jaxws.interceptors.WrapperClassInInterceptor@688800&lt;br/&gt;
2012-12-20 17:16:21,052-DEBUG PhaseInterceptorChain - Invoking handleFault on interceptor org.apache.cxf.interceptor.OneWayProcessorInterceptor@1173444&lt;br/&gt;
2012-12-20 17:16:21,052-DEBUG PhaseInterceptorChain - Invoking handleFault on interceptor org.apache.cxf.binding.soap.interceptor.SoapHeaderInterceptor@1e463a2&lt;br/&gt;
2012-12-20 17:16:21,052-DEBUG PhaseInterceptorChain - Invoking handleFault on interceptor org.apache.cxf.interceptor.DocLiteralInInterceptor@46a62&lt;br/&gt;
2012-12-20 17:16:21,052-DEBUG PhaseInterceptorChain - Invoking handleFault on interceptor org.apache.cxf.jaxb.attachment.JAXBAttachmentSchemaValidationHack@2a6c5e&lt;br/&gt;
2012-12-20 17:16:21,052-DEBUG PhaseInterceptorChain - Invoking handleFault on interceptor org.apache.cxf.binding.soap.interceptor.CheckFaultInterceptor@1c673a9&lt;br/&gt;
2012-12-20 17:16:21,052-DEBUG PhaseInterceptorChain - Invoking handleFault on interceptor org.apache.cxf.ws.security.wss4j.PolicyBasedWSS4JInInterceptor@676d73&lt;br/&gt;
2012-12-20 17:16:21,052-DEBUG PhaseInterceptorChain - Invoking handleFault on interceptor org.apache.cxf.binding.soap.interceptor.MustUnderstandInterceptor@1d3676a&lt;br/&gt;
2012-12-20 17:16:21,052-DEBUG PhaseInterceptorChain - Invoking handleFault on interceptor org.apache.cxf.ws.mex.MEXInInterceptor@7e872c&lt;br/&gt;
2012-12-20 17:16:21,052-DEBUG PhaseInterceptorChain - Invoking handleFault on interceptor org.apache.cxf.binding.soap.interceptor.StartBodyInterceptor@16d81d&lt;br/&gt;
2012-12-20 17:16:21,052-DEBUG PhaseInterceptorChain - Invoking handleFault on interceptor org.apache.cxf.binding.soap.interceptor.SoapActionInInterceptor@7418be&lt;br/&gt;
2012-12-20 17:16:21,052-DEBUG PhaseInterceptorChain - Invoking handleFault on interceptor org.apache.cxf.binding.soap.interceptor.ReadHeadersInterceptor@1494fcf&lt;br/&gt;
2012-12-20 17:16:21,052-DEBUG PhaseInterceptorChain - Invoking handleFault on interceptor org.apache.cxf.binding.soap.saaj.SAAJInInterceptor$SAAJPreInInterceptor@1264f8b&lt;br/&gt;
2012-12-20 17:16:21,052-DEBUG PhaseInterceptorChain - Invoking handleFault on interceptor org.apache.cxf.frontend.WSDLGetInterceptor@11be2e3&lt;br/&gt;
2012-12-20 17:16:21,052-DEBUG PhaseInterceptorChain - Invoking handleFault on interceptor org.apache.cxf.interceptor.StaxInInterceptor@1e699b0&lt;br/&gt;
2012-12-20 17:16:21,052-DEBUG PhaseInterceptorChain - Invoking handleFault on interceptor org.apache.cxf.transport.https.CertConstraintsInterceptor@130ac20&lt;br/&gt;
2012-12-20 17:16:21,052-DEBUG PhaseInterceptorChain - Invoking handleFault on interceptor org.apache.cxf.interceptor.AttachmentInInterceptor@dc5f15&lt;br/&gt;
2012-12-20 17:16:21,052-DEBUG PhaseInterceptorChain - Invoking handleFault on interceptor org.apache.cxf.interceptor.LoggingInInterceptor@15ca1bd&lt;br/&gt;
2012-12-20 17:16:21,052-DEBUG PhaseInterceptorChain - Invoking handleFault on interceptor org.apache.cxf.ws.policy.PolicyInInterceptor@2c7301&lt;br/&gt;
2012-12-20 17:16:21,052-WARN  PhaseInterceptorChain - Interceptor for &lt;/p&gt;
{http://www.abcdef-hijklmn.fr/interop/POC1/}
&lt;p&gt;POC1_service_sec#&lt;/p&gt;
{http://www.abcdef-hijklmn.fr/interop/POC1/}
&lt;p&gt;getMsg2ChiffrBody has thrown exception, unwinding now&lt;br/&gt;
org.apache.cxf.interceptor.Fault: These policy alternatives can not be satisfied: &lt;/p&gt;
{http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702}
&lt;p&gt;EncryptedParts: &lt;/p&gt;
{http://referentiel.ca.fr/soapHeaderV1}
&lt;p&gt; not + ENCRYPTED&lt;/p&gt;
{http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702}
&lt;p&gt;EncryptedParts&lt;br/&gt;
	at org.apache.cxf.ws.policy.AbstractPolicyInterceptor.handleMessage(AbstractPolicyInterceptor.java:47)&lt;br/&gt;
	at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:271)&lt;br/&gt;
	at org.apache.cxf.transport.ChainInitiationObserver.onMessage(ChainInitiationObserver.java:121)&lt;br/&gt;
	at org.apache.cxf.transport.http.AbstractHTTPDestination.invoke(AbstractHTTPDestination.java:238)&lt;br/&gt;
	at org.apache.cxf.transport.servlet.ServletController.invokeDestination(ServletController.java:218)&lt;br/&gt;
	at org.apache.cxf.transport.servlet.ServletController.invoke(ServletController.java:198)&lt;br/&gt;
	at org.apache.cxf.transport.servlet.ServletController.invoke(ServletController.java:137)&lt;br/&gt;
	at org.apache.cxf.transport.servlet.CXFNonSpringServlet.invoke(CXFNonSpringServlet.java:158)&lt;br/&gt;
	at org.apache.cxf.transport.servlet.AbstractHTTPServlet.handleRequest(AbstractHTTPServlet.java:243)&lt;br/&gt;
	at org.apache.cxf.transport.servlet.AbstractHTTPServlet.doPost(AbstractHTTPServlet.java:163)&lt;br/&gt;
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:637)&lt;br/&gt;
	at org.apache.cxf.transport.servlet.AbstractHTTPServlet.service(AbstractHTTPServlet.java:219)&lt;br/&gt;
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)&lt;br/&gt;
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)&lt;br/&gt;
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)&lt;br/&gt;
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)&lt;br/&gt;
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)&lt;br/&gt;
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)&lt;br/&gt;
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)&lt;br/&gt;
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:298)&lt;br/&gt;
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:857)&lt;br/&gt;
	at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:588)&lt;br/&gt;
	at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:489)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:722)&lt;br/&gt;
Caused by: org.apache.cxf.ws.policy.PolicyException: These policy alternatives can not be satisfied: &lt;/p&gt;
{http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702}
&lt;p&gt;EncryptedParts: &lt;/p&gt;
{http://referentiel.ca.fr/soapHeaderV1}
&lt;p&gt; not + ENCRYPTED&lt;/p&gt;
{http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702}
&lt;p&gt;EncryptedParts&lt;br/&gt;
	at org.apache.cxf.ws.policy.AssertionInfoMap.checkEffectivePolicy(AssertionInfoMap.java:167)&lt;br/&gt;
	at org.apache.cxf.ws.policy.PolicyVerificationInInterceptor.handle(PolicyVerificationInInterceptor.java:101)&lt;br/&gt;
	at org.apache.cxf.ws.policy.AbstractPolicyInterceptor.handleMessage(AbstractPolicyInterceptor.java:45)&lt;br/&gt;
	... 23 more&lt;/p&gt;

&lt;p&gt;The behavior seems to depend on some names used in the WSDL definition. The problem disappears when these names are changed, for example : &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;targetNamespace set to &lt;a href=&quot;http://www.abcdefghijklmn.fr/interop/POC1/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.abcdefghijklmn.fr/interop/POC1/&lt;/a&gt; or &lt;a href=&quot;http://www.c-a.fr/interop/POC1/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.c-a.fr/interop/POC1/&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;operation getMsgChiffr set to something else&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;It works fine when CXF runs as a client with the same WSDL. (CXF 2.6.1, CXF 2.7.1)&lt;/p&gt;


</description>
                <environment>&lt;p&gt;JDK 1.7.0_02&lt;br/&gt;
Windows 7&lt;br/&gt;
Tomcat 6.0.29&lt;/p&gt;</environment>
        <key id="12624844">CXF-4716</key>
            <summary>WS-security policies enforcement with CXF server, bad policy selected</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="coheigea">Colm O hEigeartaigh</assignee>
                                    <reporter username="fwi">Franck WIELGUS</reporter>
                        <labels>
                    </labels>
                <created>Thu, 20 Dec 2012 16:32:28 +0000</created>
                <updated>Thu, 28 Feb 2013 17:27:24 +0000</updated>
                            <resolved>Fri, 21 Dec 2012 15:54:28 +0000</resolved>
                                    <version>2.6.1</version>
                    <version>2.7.1</version>
                                    <fixVersion>2.5.8</fixVersion>
                    <fixVersion>2.6.5</fixVersion>
                    <fixVersion>2.7.2</fixVersion>
                                    <component>WS-* Components</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13537136" author="fwi" created="Thu, 20 Dec 2012 16:33:55 +0000"  >&lt;p&gt;WSDL example+xsd to reproduce the problem + request capture (sent with CXF)&lt;/p&gt;</comment>
                            <comment id="13538160" author="coheigea" created="Fri, 21 Dec 2012 15:54:28 +0000"  >
&lt;p&gt;This issue is now fixed, as confirmed by a test-case. The problem was that we were exiting too early from certain policy validation operations.&lt;/p&gt;

&lt;p&gt;Colm.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12561919" name="CA_groupHeader_simple.xsd" size="556" author="fwi" created="Thu, 20 Dec 2012 16:33:55 +0000"/>
                            <attachment id="12561924" name="POC1.wsdl" size="7522" author="fwi" created="Thu, 20 Dec 2012 16:37:16 +0000"/>
                            <attachment id="12561920" name="POC1.xsd" size="1778" author="fwi" created="Thu, 20 Dec 2012 16:33:55 +0000"/>
                            <attachment id="12561922" name="request.txt" size="6543" author="fwi" created="Thu, 20 Dec 2012 16:33:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>301352</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 48 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i16rv3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>247646</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>