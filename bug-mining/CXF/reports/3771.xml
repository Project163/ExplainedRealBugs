<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:40:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-9091] Camel 3|CXF: ParsingErrors with OneWay Messages</title>
                <link>https://issues.apache.org/jira/browse/CXF-9091</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;Hi everyone,&lt;/p&gt;

&lt;p&gt;we recently moved from Camel 2 to Camel 3 and we are now observing the following problem with CXF. If a OneWay message exceeds a certain length, the messages fail with a parser error like:&lt;/p&gt;

&lt;p&gt;Caused by: java.lang.IllegalStateException: Current event not START_ELEMENT or END_ELEMENT&lt;br/&gt;
at com.ctc.wstx.sr.BasicStreamReader.getNamespaceCount(BasicStreamReader.java:805) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;woodstox-core-6.2.7.jar:6.2.7&amp;#93;&lt;/span&gt;&lt;br/&gt;
at org.apache.cxf.staxutils.DepthXMLStreamReader.getNamespaceCount(DepthXMLStreamReader.java:122) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;cxf-core-3.5.2.jar:3.5.2&amp;#93;&lt;/span&gt;&lt;br/&gt;
at org.apache.cxf.staxutils.DepthXMLStreamReader.getNamespaceCount(DepthXMLStreamReader.java:122) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;cxf-core-3.5.2.jar:3.5.2&amp;#93;&lt;/span&gt;&lt;br/&gt;
at org.apache.camel.component.cxf.converter.DelegatingXMLStreamReader.&amp;lt;init&amp;gt;(DelegatingXMLStreamReader.java:40) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;camel-cxf-3.17.0.jar:3.17.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
at org.apache.camel.component.cxf.converter.CxfPayloadConverter.convertTo(CxfPayloadConverter.java:225) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;camel-cxf-3.17.0.jar:3.17.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
at org.apache.camel.component.cxf.converter.CxfPayloadConverterLoader.lambda$registerFallbackConverters$8(CxfPayloadConverterLoader.java:68) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;camel-cxf-3.17.0.jar:3.17.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
at org.apache.camel.support.SimpleTypeConverter.convertTo(SimpleTypeConverter.java:101) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;camel-support-3.17.0.jar:3.17.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
... 30 common frames omitted&lt;/p&gt;

&lt;p&gt;The error will not happen if we reduce the length of the message or if we change it from OneWay to ResponseReply. This indicates a problem in the async decoupling of the request.&lt;/p&gt;

&lt;p&gt;During debugging I found that the HTTP thread is used to handle the request. But the actual processing of the message happens in new thread. Maybe the input stream is closed after the http thread is finished (HTTP 202) and the spawned thread cannot read the full content anymore.&lt;/p&gt;

&lt;p&gt;I created the following reproducer based on Spring Boot: &lt;a href=&quot;https://github.com/mash-sap/cxfOneWayError/tree/main&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/mash-sap/cxfOneWayError/tree/main&lt;/a&gt;&lt;br/&gt;
CXF: 3.6.5&lt;br/&gt;
Camel CXF: 3.17.0&lt;br/&gt;
Tomcat: 9.0.83&lt;/p&gt;

&lt;p&gt;Mailinglist Post: &lt;a href=&quot;https://lists.apache.org/thread/vproojr7pcygpjtrygfxj8qcgj1x2q4x&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lists.apache.org/thread/vproojr7pcygpjtrygfxj8qcgj1x2q4x&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13602534">CXF-9091</key>
            <summary>Camel 3|CXF: ParsingErrors with OneWay Messages</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ffang">Freeman Yue Fang</assignee>
                                    <reporter username="mash-sap">Manuel Shenavai</reporter>
                        <labels>
                    </labels>
                <created>Wed, 18 Dec 2024 07:55:31 +0000</created>
                <updated>Tue, 11 Feb 2025 21:59:47 +0000</updated>
                            <resolved>Tue, 11 Feb 2025 20:53:45 +0000</resolved>
                                                    <fixVersion>3.6.6</fixVersion>
                    <fixVersion>4.0.7</fixVersion>
                    <fixVersion>4.1.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17906642" author="mash-sap" created="Wed, 18 Dec 2024 08:00:08 +0000"  >&lt;p&gt;One noteable observation:&lt;br/&gt;
Sending an incomplete payload which is expected to be not parseable, a HTTP 202 returned in the new codeline. While on the old codeline this same request failed already in the HTTP thread, which led to HTTP 500 instead of HTTP 202.&lt;/p&gt;

&lt;p&gt;In our old codeline, this is the stacktrace for a wrong XML. Client receives HTTP 500&lt;br/&gt;
Daemon Thread &lt;span class=&quot;error&quot;&gt;&amp;#91;https-jsse-nio-8041-exec-18&amp;#93;&lt;/span&gt;&lt;br/&gt;
org.apache.cxf.binding.soap.saaj.SAAJInInterceptor.handleMessage(SAAJInInterceptor.java:262)&lt;br/&gt;
org.apache.cxf.ws.security.wss4j.WSS4JInInterceptor.getSOAPMessage(WSS4JInInterceptor.java:167)&lt;br/&gt;
org.apache.cxf.ws.security.wss4j.WSS4JInInterceptor.handleMessageInternal(WSS4JInInterceptor.java:234)&lt;br/&gt;
org.apache.cxf.ws.security.wss4j.WSS4JInInterceptor.handleMessage(WSS4JInInterceptor.java:200)&lt;br/&gt;
org.apache.cxf.ws.security.wss4j.PolicyBasedWSS4JInInterceptor.handleMessage(PolicyBasedWSS4JInInterceptor.java:80)&lt;br/&gt;
org.apache.cxf.ws.security.wss4j.PolicyBasedWSS4JInInterceptor.handleMessage(PolicyBasedWSS4JInInterceptor.java:67)&lt;br/&gt;
org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:308)&lt;br/&gt;
org.apache.cxf.transport.ChainInitiationObserver.onMessage(ChainInitiationObserver.java:121)&lt;br/&gt;
org.apache.cxf.transport.http.AbstractHTTPDestination.invoke(AbstractHTTPDestination.java:267)&lt;br/&gt;
org.apache.cxf.transport.servlet.ServletController.invokeDestination(ServletController.java:234)...&lt;/p&gt;


&lt;p&gt;The new codeline gets a HTTP 202.&lt;/p&gt;</comment>
                            <comment id="17910642" author="mash-sap" created="Tue, 7 Jan 2025 14:25:26 +0000"  >&lt;p&gt;Is there any update on this topic?&lt;/p&gt;</comment>
                            <comment id="17910817" author="ffang" created="Tue, 7 Jan 2025 21:49:34 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mash-sap&quot; class=&quot;user-hover&quot; rel=&quot;mash-sap&quot;&gt;mash-sap&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Since with ONEWAY mode the client just send request and not wait until the server side finish processing or receive any fault response,  and the client would close connection to server very soon after HTTP 202 is received.&lt;/p&gt;

&lt;p&gt;I think you may want to use ROBUST_ONEWAY which client has chance to wait until server finish processing or receive error code if there is any.&lt;/p&gt;

&lt;p&gt;You can just add &lt;br/&gt;
&amp;lt;entry key=&quot;org.apache.cxf.oneway.robust&quot; value=&quot;true&quot;/&amp;gt;&lt;br/&gt;
in &amp;lt;cxf:properties&amp;gt; in src/main/resources/my-camel.xml in your reproducer to see the difference.&lt;/p&gt;

&lt;p&gt;Freeman&lt;/p&gt;</comment>
                            <comment id="17910826" author="reta" created="Tue, 7 Jan 2025 22:09:02 +0000"  >&lt;p&gt;Adding the preceding communication on the mailing list here: &lt;a href=&quot;https://lists.apache.org/thread/vproojr7pcygpjtrygfxj8qcgj1x2q4x&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lists.apache.org/thread/vproojr7pcygpjtrygfxj8qcgj1x2q4x&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;TLDR; I briefly looked into the issue (the one from the description_ and could confirm that there is indeed a problem with larger message payload. However, I could also reproduce it on Camel 2.x (I was using 2.25.4) although the exception is slightly different. I was not able to troubleshoot the cause yet, hope to get back to it at some point (unless someone steps in to pick it up).&lt;/p&gt;</comment>
                            <comment id="17911014" author="mash-sap" created="Wed, 8 Jan 2025 10:31:06 +0000"  >&lt;p&gt;Thanks for your replies! We rely on oneway and we will not be able to apply the workaround. I hope you can troubleshoot this soon!&lt;/p&gt;</comment>
                            <comment id="17911153" author="ffang" created="Wed, 8 Jan 2025 16:04:39 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reta&quot; class=&quot;user-hover&quot; rel=&quot;reta&quot;&gt;reta&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Thanks for your update. Just FYI, with ROBUST_ONEWAY enabled, the huge message also passed.&lt;/p&gt;

&lt;p&gt;Cheers&lt;br/&gt;
Freeman&lt;/p&gt;</comment>
                            <comment id="17911154" author="ffang" created="Wed, 8 Jan 2025 16:06:01 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mash-sap&quot; class=&quot;user-hover&quot; rel=&quot;mash-sap&quot;&gt;mash-sap&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Could you please let us know what is the exact CXF and Camel version with Camel 2.x when it was working with plain ONEWAY?&lt;/p&gt;

&lt;p&gt;Thanks!&lt;br/&gt;
Freeman&lt;/p&gt;</comment>
                            <comment id="17911185" author="mash-sap" created="Wed, 8 Jan 2025 17:44:11 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ffang&quot; class=&quot;user-hover&quot; rel=&quot;ffang&quot;&gt;ffang&lt;/a&gt;, &lt;/p&gt;

&lt;p&gt;we got a fork of Camel 2.24.2, CXF 3.2.11 and Tomcat 8.5.&lt;/p&gt;

&lt;p&gt;Best regards,&lt;br/&gt;
Manuel&lt;/p&gt;</comment>
                            <comment id="17911372" author="mash-sap" created="Thu, 9 Jan 2025 08:37:44 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ffang&quot; class=&quot;user-hover&quot; rel=&quot;ffang&quot;&gt;ffang&lt;/a&gt;, just to emphasize my previous comment:&lt;br/&gt;
You can see that in the old codeline there was a interceptor (PolicyBasedWSS4JInInterceptor) reading the payload before any response code was returned. The old codeline would not return HTTP 202 before reading the complete payload.&lt;br/&gt;
In my test I send a invalid XML to the endpoint. In old codeline, the response is 500 while in the new codeline the broken payload is accepted and HTTP 202 is returned.&lt;/p&gt;

&lt;p&gt;So I think a potential fix would require to read the complete payload before returning HTTP 202.&lt;/p&gt;

&lt;p&gt;Best regards,&lt;br/&gt;
Manuel&lt;/p&gt;


&lt;p&gt;Daemon Thread &lt;span class=&quot;error&quot;&gt;&amp;#91;https-jsse-nio-8041-exec-18&amp;#93;&lt;/span&gt;&lt;br/&gt;
org.apache.cxf.binding.soap.saaj.SAAJInInterceptor.handleMessage(SAAJInInterceptor.java:262)&lt;br/&gt;
org.apache.cxf.ws.security.wss4j.WSS4JInInterceptor.getSOAPMessage(WSS4JInInterceptor.java:167)&lt;br/&gt;
org.apache.cxf.ws.security.wss4j.WSS4JInInterceptor.handleMessageInternal(WSS4JInInterceptor.java:234)&lt;br/&gt;
org.apache.cxf.ws.security.wss4j.WSS4JInInterceptor.handleMessage(WSS4JInInterceptor.java:200)&lt;br/&gt;
org.apache.cxf.ws.security.wss4j.PolicyBasedWSS4JInInterceptor.handleMessage(PolicyBasedWSS4JInInterceptor.java:80)&lt;br/&gt;
org.apache.cxf.ws.security.wss4j.PolicyBasedWSS4JInInterceptor.handleMessage(PolicyBasedWSS4JInInterceptor.java:67)&lt;br/&gt;
org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:308)&lt;br/&gt;
org.apache.cxf.transport.ChainInitiationObserver.onMessage(ChainInitiationObserver.java:121)&lt;br/&gt;
org.apache.cxf.transport.http.AbstractHTTPDestination.invoke(AbstractHTTPDestination.java:267)&lt;br/&gt;
org.apache.cxf.transport.servlet.ServletController.invokeDestination(ServletController.java:234)...&lt;/p&gt;</comment>
                            <comment id="17911595" author="ffang" created="Thu, 9 Jan 2025 17:37:40 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mash-sap&quot; class=&quot;user-hover&quot; rel=&quot;mash-sap&quot;&gt;mash-sap&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;I&apos;d say what &quot;ONEWAY&quot; means in wsdl2 spec is the server return immediately with HTTP 202 before the server actually process the incoming payload. And for the large payload with ONEWAY, we normally need to cache the stream before the server process the payload, otherwise we may see such errors you ran into. That&apos;s the reason why CXF introduced &quot;ROBUST ONEWAY&quot; in 2012, tracked by &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-4091&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CXF-4091&lt;/a&gt;, also you can find more details from the cxf dev mailing list discussion here to get more details &lt;a href=&quot;https://lists.apache.org/thread/fkj1kjxtyqr3fpngmkn683ghbqcobvwl&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lists.apache.org/thread/fkj1kjxtyqr3fpngmkn683ghbqcobvwl&lt;/a&gt; about why &quot;ROBUST ONEWAY&quot;  was introduced and what&apos;s the problem the &quot;ROBUST ONEWAY&quot; can resolve. I believe &quot;ROBUST ONEWAY&quot; here can perfectly fit your scenario.&lt;/p&gt;

&lt;p&gt;Best Regards&lt;br/&gt;
Freeman&lt;/p&gt;</comment>
                            <comment id="17911600" author="mash-sap" created="Thu, 9 Jan 2025 17:48:00 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ffang&quot; class=&quot;user-hover&quot; rel=&quot;ffang&quot;&gt;ffang&lt;/a&gt;,&lt;br/&gt;
do you mean to say that this is not a bug?&lt;br/&gt;
Best regards,&lt;br/&gt;
Manuel&lt;/p&gt;</comment>
                            <comment id="17911952" author="mash-sap" created="Fri, 10 Jan 2025 12:37:58 +0000"  >&lt;p&gt;I just noticed that this problem is only happening with ws-addressing. If the policy is removed from the endpoint (and the payload is adapted to not send the addressing headers), the reported problem is not happening. So it seems to be related to wsAddressing.&lt;/p&gt;

&lt;p&gt;This is the policy from the wsdl:&lt;/p&gt;

&lt;p&gt;    &amp;lt;wsp:Policy xmlns:wsp=&quot;http://schemas.xmlsoap.org/ws/2004/09/policy&quot; wsu:Id=&quot;BN__binding&quot;&lt;br/&gt;
                xmlns:wsu=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot;&amp;gt;&lt;br/&gt;
        &amp;lt;wsp:ExactlyOne&amp;gt;&lt;br/&gt;
            &amp;lt;wsp:All&amp;gt;&lt;br/&gt;
                &amp;lt;wsaw:UsingAddressing xmlns:wsaw=&quot;http://www.w3.org/2006/05/addressing/wsdl&quot;/&amp;gt;&lt;br/&gt;
            &amp;lt;/wsp:All&amp;gt;&lt;br/&gt;
        &amp;lt;/wsp:ExactlyOne&amp;gt;&lt;br/&gt;
    &amp;lt;/wsp:Policy&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17912055" author="ffang" created="Fri, 10 Jan 2025 17:48:22 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mash-sap&quot; class=&quot;user-hover&quot; rel=&quot;mash-sap&quot;&gt;mash-sap&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;For the &quot;ONEWAY&quot;, IMHO it&apos;s not a bug in terms of invalid payload returns HTTP 202, but for the big message, probably we can address it by caching the inputstream somewhere. &lt;/p&gt;

&lt;p&gt;And for the ws-addressing makes the difference, yeah, it could be as with ws-addresing CXF switches threads on the server side.&lt;/p&gt;

&lt;p&gt;Freeman&lt;/p&gt;</comment>
                            <comment id="17912100" author="mash-sap" created="Fri, 10 Jan 2025 19:37:00 +0000"  >&lt;p&gt;That makes sense, thanks for confirming &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ffang&quot; class=&quot;user-hover&quot; rel=&quot;ffang&quot;&gt;ffang&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17914015" author="mash-sap" created="Fri, 17 Jan 2025 09:06:20 +0000"  >&lt;p&gt;I found that in Camel 2, this problem will not occur if the WSDL contains the following policy (attaching the full wsdl to this ticket). Does anyone know to which runtime components this relates?&lt;/p&gt;

&lt;p&gt;                &amp;lt;sp:TransportBinding xmlns:sp=&quot;http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702&quot;&amp;gt;&lt;br/&gt;
                    &amp;lt;wsp:Policy&amp;gt;&lt;br/&gt;
                        &amp;lt;sp:TransportToken&amp;gt;&lt;br/&gt;
                            &amp;lt;wsp:Policy&amp;gt;&lt;br/&gt;
                                &amp;lt;sp:HttpsToken&amp;gt;&lt;br/&gt;
                                    &amp;lt;wsp:Policy&amp;gt;&lt;br/&gt;
                                        &amp;lt;wsp:ExactlyOne&amp;gt;&lt;br/&gt;
                                            &amp;lt;sp:HttpBasicAuthentication/&amp;gt;&lt;br/&gt;
                                            &amp;lt;sp:RequireClientCertificate/&amp;gt;&lt;br/&gt;
                                        &amp;lt;/wsp:ExactlyOne&amp;gt;&lt;br/&gt;
                                    &amp;lt;/wsp:Policy&amp;gt;&lt;br/&gt;
                                &amp;lt;/sp:HttpsToken&amp;gt;&lt;br/&gt;
                            &amp;lt;/wsp:Policy&amp;gt;&lt;br/&gt;
                        &amp;lt;/sp:TransportToken&amp;gt;&lt;br/&gt;
                        &amp;lt;sp:AlgorithmSuite&amp;gt;&lt;br/&gt;
                            &amp;lt;wsp:Policy&amp;gt;&lt;br/&gt;
                                &amp;lt;wsp:ExactlyOne&amp;gt;&lt;br/&gt;
                                    &amp;lt;sp:Basic256/&amp;gt;&lt;br/&gt;
                                    &amp;lt;sp:Basic192/&amp;gt;&lt;br/&gt;
                                    &amp;lt;sp:Basic128/&amp;gt;&lt;br/&gt;
                                    &amp;lt;sp:TripleDes/&amp;gt;&lt;br/&gt;
                                    &amp;lt;sp:Basic256Rsa15/&amp;gt;&lt;br/&gt;
                                    &amp;lt;sp:Basic192Rsa15/&amp;gt;&lt;br/&gt;
                                    &amp;lt;sp:Basic128Rsa15/&amp;gt;&lt;br/&gt;
                                    &amp;lt;sp:TripleDesRsa15/&amp;gt;&lt;br/&gt;
                                    &amp;lt;sp:Basic256Sha256/&amp;gt;&lt;br/&gt;
                                    &amp;lt;sp:Basic192Sha256/&amp;gt;&lt;br/&gt;
                                    &amp;lt;sp:Basic128Sha256/&amp;gt;&lt;br/&gt;
                                    &amp;lt;sp:TripleDesSha256/&amp;gt;&lt;br/&gt;
                                    &amp;lt;sp:Basic256Sha256Rsa15/&amp;gt;&lt;br/&gt;
                                    &amp;lt;sp:Basic192Sha256Rsa15/&amp;gt;&lt;br/&gt;
                                    &amp;lt;sp:Basic128Sha256Rsa15/&amp;gt;&lt;br/&gt;
                                    &amp;lt;sp:TripleDesSha256Rsa15/&amp;gt;&lt;br/&gt;
                                &amp;lt;/wsp:ExactlyOne&amp;gt;&lt;br/&gt;
                            &amp;lt;/wsp:Policy&amp;gt;&lt;br/&gt;
                        &amp;lt;/sp:AlgorithmSuite&amp;gt;&lt;br/&gt;
                        &amp;lt;sp:Layout&amp;gt;&lt;br/&gt;
                            &amp;lt;wsp:Policy&amp;gt;&lt;br/&gt;
                                &amp;lt;sp:Strict/&amp;gt;&lt;br/&gt;
                            &amp;lt;/wsp:Policy&amp;gt;&lt;br/&gt;
                        &amp;lt;/sp:Layout&amp;gt;&lt;br/&gt;
                    &amp;lt;/wsp:Policy&amp;gt;&lt;br/&gt;
                &amp;lt;/sp:TransportBinding&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17914945" author="mash-sap" created="Tue, 21 Jan 2025 11:09:26 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ffang&quot; class=&quot;user-hover&quot; rel=&quot;ffang&quot;&gt;ffang&lt;/a&gt;,&lt;br/&gt;
I tried to further understand the problem and created the following project:&lt;br/&gt;
&lt;a href=&quot;https://github.com/mash-sap/cxfOneWayError/tree/parserError&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/mash-sap/cxfOneWayError/tree/parserError&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In this project you can remove the SoapOutEndingInterceptor by commenting following line:&lt;br/&gt;
&lt;a href=&quot;https://github.com/mash-sap/cxfOneWayError/blob/parserError/src/main/java/de/mash/demo/RemoveInterceptorPreStream.java#L21&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/mash-sap/cxfOneWayError/blob/parserError/src/main/java/de/mash/demo/RemoveInterceptorPreStream.java#L21&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If we remove the SoapOutEndingInterceptor from the chain, the parser error is not happening. If we keep it in the chain, the parser error is coming up again.&lt;/p&gt;

&lt;p&gt;Unfortunately I dont understand why writing to the StreamWriter (SoapOutEndingInterceptor) would break the StreamReader (CachedCXFPayload/StaxUtils).&lt;/p&gt;

&lt;p&gt;________________________________________________________________________________________________&lt;br/&gt;
The SoapOutEndingInterceptor:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cxf/blob/3.6.x-fixes/rt/bindings/soap/src/main/java/org/apache/cxf/binding/soap/interceptor/SoapOutInterceptor.java#L302&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/blob/3.6.x-fixes/rt/bindings/soap/src/main/java/org/apache/cxf/binding/soap/interceptor/SoapOutInterceptor.java#L302&lt;/a&gt;&lt;br/&gt;
________________________________________________________________________________________________&lt;br/&gt;
Parser Error is happening here:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cxf/blob/3.6.x-fixes/core/src/main/java/org/apache/cxf/staxutils/StaxUtils.java#L718&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/blob/3.6.x-fixes/core/src/main/java/org/apache/cxf/staxutils/StaxUtils.java#L718&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;I share this with you, so maybe this example can help you to troubleshoot this problem.&lt;/p&gt;

&lt;p&gt;Best regards,&lt;br/&gt;
Manuel&lt;/p&gt;</comment>
                            <comment id="17922609" author="mash-sap" created="Fri, 31 Jan 2025 08:05:19 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ffang&quot; class=&quot;user-hover&quot; rel=&quot;ffang&quot;&gt;ffang&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;were you able to find the root cause of this problem? Do you already have any plans how this can be fixed?&lt;/p&gt;

&lt;p&gt;Best regards,&lt;br/&gt;
Manuel&lt;/p&gt;</comment>
                            <comment id="17922714" author="ffang" created="Fri, 31 Jan 2025 12:58:12 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mash-sap&quot; class=&quot;user-hover&quot; rel=&quot;mash-sap&quot;&gt;mash-sap&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;I&apos;m revisiting it.&lt;/p&gt;

&lt;p&gt;Freeman&lt;/p&gt;</comment>
                            <comment id="17924819" author="mash-sap" created="Fri, 7 Feb 2025 09:06:21 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ffang&quot; class=&quot;user-hover&quot; rel=&quot;ffang&quot;&gt;ffang&lt;/a&gt;, do you have any update on this topic?&lt;br/&gt;
Thanks in advance!&lt;br/&gt;
Manuel&lt;/p&gt;</comment>
                            <comment id="17925077" author="mash-sap" created="Fri, 7 Feb 2025 22:42:19 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ffang&quot; class=&quot;user-hover&quot; rel=&quot;ffang&quot;&gt;ffang&lt;/a&gt;, &lt;/p&gt;

&lt;p&gt;I found a possible fix for the problem. Can you please check my PR:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cxf/pull/2261&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/2261&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternative solution:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cxf/pull/2262&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/2262&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thanks!&lt;br/&gt;
Manuel&lt;/p&gt;</comment>
                            <comment id="17925589" author="ffang" created="Mon, 10 Feb 2025 14:31:06 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mash-sap&quot; class=&quot;user-hover&quot; rel=&quot;mash-sap&quot;&gt;mash-sap&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Thanks for the PR!&lt;/p&gt;

&lt;p&gt;More update of this issue. I found the root cause is that on the server side, firstly in DocLiteralInInterceptor, the message part stream is saved in MessageContentsList(As StaxSource based on the InputStream in your case), and later in MAPAggregatorImpl &lt;br/&gt;
it calls into&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isOneway
                    || !ContextUtils.isGenericAddress(maps.getReplyTo())) {
                    InternalContextUtils.rebaseResponse(maps.getReplyTo(),
                                                maps,
                                                message);
                }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This rebase operation cause thread switch and the InputStream of server side is closed(hence the StaxSource based on this inputstream is invalid), but later in Camel-cxf(CachedCxfPayload) this StaxSource is read again, hence we see the exception&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Current event not START_ELEMENT or END_ELEMENT
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The right fix is to cache the InputStream at some proper point, actually CXF side has done this when switching thread, but seems too late as DocLiteralInInterceptor is executed early in the server side interceptor chain. I am still thinking of a solution to deal with it, but seems your PR &lt;a href=&quot;https://github.com/apache/cxf/pull/2262&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/2262&lt;/a&gt; is promising.&lt;/p&gt;

&lt;p&gt;Cheers&lt;br/&gt;
Freeman&lt;/p&gt;</comment>
                            <comment id="17925598" author="mash-sap" created="Mon, 10 Feb 2025 14:53:35 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ffang&quot; class=&quot;user-hover&quot; rel=&quot;ffang&quot;&gt;ffang&lt;/a&gt;, the interesting part is, that the rebase operation is already caching the request payload:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cxf/blob/3.6.x-fixes/rt/ws/addr/src/main/java/org/apache/cxf/ws/addressing/impl/InternalContextUtils.java#L276&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/blob/3.6.x-fixes/rt/ws/addr/src/main/java/org/apache/cxf/ws/addressing/impl/InternalContextUtils.java#L276&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;But due to missing property (cxf.io.cacheinput) the inputStream is read/consumed here:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cxf/blob/3.6.x-fixes/rt/transports/http/src/main/java/org/apache/cxf/transport/http/AbstractHTTPDestination.java#L605&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/blob/3.6.x-fixes/rt/transports/http/src/main/java/org/apache/cxf/transport/http/AbstractHTTPDestination.java#L605&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cxf/blob/3.6.x-fixes/rt/transports/http/src/main/java/org/apache/cxf/transport/http/AbstractHTTPDestination.java#L626&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/blob/3.6.x-fixes/rt/transports/http/src/main/java/org/apache/cxf/transport/http/AbstractHTTPDestination.java#L626&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;When eventually the workerThread tries to read the payload, the inputStreams position is already at the end which leads to the parser error. So the initial idea was to reset() the inputstream, which worked.&lt;/p&gt;

&lt;p&gt;But I guess that using the property (cxf.io.cacheinput) is the correct way to let cxf know that this is a cached payload.&lt;/p&gt;

&lt;p&gt;Best regards,&lt;br/&gt;
Manuel&lt;/p&gt;</comment>
                            <comment id="17926175" author="ffang" created="Tue, 11 Feb 2025 20:54:08 +0000"  >&lt;p&gt;Patch applied on behalf of &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mash-sap&quot; class=&quot;user-hover&quot; rel=&quot;mash-sap&quot;&gt;mash-sap&lt;/a&gt; with thanks!&lt;/p&gt;</comment>
                            <comment id="17926200" author="mash-sap" created="Tue, 11 Feb 2025 21:59:47 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ffang&quot; class=&quot;user-hover&quot; rel=&quot;ffang&quot;&gt;ffang&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13074111" name="GenericRequestReply_wsdl_myendpoint.wsdl" size="5362" author="mash-sap" created="Fri, 17 Jan 2025 09:08:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            39 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1t728:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>