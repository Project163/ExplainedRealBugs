<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:17:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-6519] WS-RM - Invalid response for CloseSequence</title>
                <link>https://issues.apache.org/jira/browse/CXF-6519</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;When endpoint is running with WS-RM 1.1/1.2 enabled, after CloseSequence control message (org.apache.cxf.ws.rm.RM11Constants.CLOSE_SEQUENCE_ACTION) is received, invalid empty response (202 Accepted with no content) is returned instead of CloseSequenceResponse.&lt;/p&gt;

&lt;p&gt;This in turn means that source RM endpoint won&apos;t proceed to terminate the sequence which results in sequence metadata not being being removed (as part of sequence termination handling) from RMTxStore if it&apos;s used on either side.&lt;/p&gt;

&lt;p&gt;I suspect one particular line to be causing the issue - see line 172 where I believe RM11Constants.CLOSE_SEQUENCE_ACTION should be used instead of RM11Constants.SEQUENCE_ACKNOWLEDGMENT_ACTION:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;org.apache.cxf.ws.rm.RMInInterceptor&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; 85     &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void handle(Message message) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SequenceFault, RMException {
                ...
 166         } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
 167             rme.receivedControlMessage();
 168             &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (RM10Constants.SEQUENCE_ACKNOWLEDGMENT_ACTION.equals(action)
 169                 || RM11Constants.SEQUENCE_ACKNOWLEDGMENT_ACTION.equals(action)) {
 170                 processAcknowledgments(rme, rmps, protocol);
 171             } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (RM10Constants.CLOSE_SEQUENCE_ACTION.equals(action)
 172                 || RM11Constants.SEQUENCE_ACKNOWLEDGMENT_ACTION.equals(action)) {
 173                 processSequence(destination, message);
 174             } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ((RM10Constants.CREATE_SEQUENCE_ACTION.equals(action)
 175                 || RM11Constants.CREATE_SEQUENCE_ACTION.equals(action)) &amp;amp;&amp;amp; !isServer) {
 176                 LOG.fine(&lt;span class=&quot;code-quote&quot;&gt;&quot;Processing inbound CreateSequence on client side.&quot;&lt;/span&gt;);
 177                 Servant servant = rme.getServant();
 178                 &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; csr = servant.createSequence(message);
 179                 Proxy proxy = rme.getProxy();
 180                 proxy.createSequenceResponse(csr, protocol);
 181                 &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
 182             }
 183         }
 184         
 185         assertReliability(message);
 186     }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I found the issue on v2.7.14, but I think the issue is present on all versions (since I see suspected code present in all versions)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12851637">CXF-6519</key>
            <summary>WS-RM - Invalid response for CloseSequence</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ay">Akitoshi Yoshida</assignee>
                                    <reporter username="jtomek">Jozef Tomek</reporter>
                        <labels>
                    </labels>
                <created>Wed, 5 Aug 2015 09:40:11 +0000</created>
                <updated>Fri, 14 Oct 2016 14:22:47 +0000</updated>
                            <resolved>Fri, 7 Aug 2015 14:15:06 +0000</resolved>
                                    <version>2.7.17</version>
                                    <fixVersion>2.7.18</fixVersion>
                                    <component>WS-* Components</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14659659" author="ay" created="Thu, 6 Aug 2015 08:01:02 +0000"  >&lt;p&gt;Hi Josef,&lt;br/&gt;
thanks for analyzing this issue and finding out the cause.&lt;br/&gt;
We will fix it shortly.&lt;br/&gt;
regards, aki&lt;/p&gt;</comment>
                            <comment id="14660194" author="ay" created="Thu, 6 Aug 2015 15:53:58 +0000"  >&lt;p&gt;Hi Josef,&lt;br/&gt;
actually the wrong constant is not relevant here because WS-RM 1.1&apos;s close sequence has no sequenced message attached to it and needs no sequence processing.&lt;/p&gt;

&lt;p&gt;And I just verified that the CloseSequenceResponse is correctly returned for both 3.1.2 and 3.0.6.&lt;br/&gt;
I haven&apos;t verified if some earlier 3.x.x has the same limitation as in 2.7.x.&lt;/p&gt;

&lt;p&gt;For now, I will just remove the wrong constant usage and add a test.&lt;/p&gt;

&lt;p&gt;regards, aki&lt;/p&gt;</comment>
                            <comment id="14660798" author="jtomek" created="Thu, 6 Aug 2015 21:10:45 +0000"  >&lt;p&gt;Hi Akitoshi&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt; actually the wrong constant is not relevant here because WS-RM 1.1&apos;s close sequence has no sequenced message attached to it and needs no sequence processing.&lt;/p&gt;

&lt;p&gt;What I have is cxf 2.7.11 client on one side, ServiceMix with cxf 2.7.14 as server side. Within sequence creation, client also offers inbound sequence with this dummy / anonymous URI, server accepts both (probably not important, but still mentioning it). This invalid constant then definitely causes empty response to be sent to CloseSequence request which in turn makes client to not proceed and send TerminateSequence. From what I see in the payload, the CloseSequence request is another message in a sequence with it&apos;s own UID and order number.&lt;/p&gt;

&lt;p&gt;Also, per spec (&lt;a href=&quot;http://docs.oasis-open.org/ws-rx/wsrm/200702/wsrm-1.1-spec-os-01-e1.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;1.1&lt;/a&gt;, line 750):&lt;br/&gt;
&quot;A CloseSequenceResponse is sent in the body of a message in response to receipt of a CloseSequence request message. It indicates that the responder has closed the Sequence.&quot;&lt;/p&gt;

&lt;p&gt;I patched the server side stack (shadowed only the RMInInterceptor class with dirty OSGi hack) and now server responds with SequenceAcknowledgement acking the CloseSequence request (it&apos;s order number) and client proceeds and sends TerminateSequence to which server responds with TerminateSequenceResponse ... while properly removing the sequence(s) from the RMTxStore. That&apos;s actualy how I found the issue ... sequences/messages have not been removed from RMTxStore and I back-tracked through call hierarchy which led me to single possible call - processSequence(destination, message) on line 173.&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt; And I just verified that the CloseSequenceResponse is correctly returned for both 3.1.2 and 3.0.6. I haven&apos;t verified if some earlier 3.x.x has the same limitation as in 2.7.x.&lt;/p&gt;

&lt;p&gt;Once I am little less busy at work, I definitely want to try it with 3.x binaries.&lt;/p&gt;

&lt;p&gt;Regards&lt;br/&gt;
Jozef&lt;/p&gt;</comment>
                            <comment id="14661479" author="ay" created="Fri, 7 Aug 2015 08:11:03 +0000"  >&lt;p&gt;Hi Jozef,&lt;br/&gt;
calling line line 173 triggers the sequence handling and consequently its ack generation code. But the RM11 CloseSequence message has no message for that sequence and does not require any sequence ack handling unlike a normal message carrying a numbered message. Because of this, as you already observed, in calling that method, you would just get the ack message and not the expected CloseSequenceResponse message. So this is still incorrect and you are just lucky that your client accepted this incorrect response. On the other hand, you are unlucky that your client did not accept yet another incorrect empty response. If it did, you wouldn&apos;t have had this problem.&lt;/p&gt;

&lt;p&gt;Ideally, any WS-RM client should ignore any response from CloseSequence or TerminateSequence. Because these control messages are intended for the client (RMSource) to inform the server (RMDestination) that the client has no intention of sending additional messages over this sequence so that the server can free the associated resource. As the client will send these messages as BestEffort and anything can happen, the client should log/warn anything unexpected (i.e., getting an error or un unexpected response) but continue processing so that it is protected from any server or network problem. Such a rule should be part of the WSI WS-RM profile which does not exit.&lt;/p&gt;

&lt;p&gt;If you have an RM client that strictly expects the CloseSequenceResponse message before initiating the TerminateSequence process, you will have an issue with not only CXF 2.7.x which does not currently support CloseSequenceResponse but also with any server or network that sporadically fails.&lt;/p&gt;

&lt;p&gt;For 3.1.x and 3.0.x, there is an integration unit test verifying the correct CloseSequence/CloseSequenceResponse handling.&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cxf/blob/master/systests/ws-rm/src/test/java/org/apache/cxf/systest/ws/rm/ProtocolVariationsTest.java#L435-L438&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/blob/master/systests/ws-rm/src/test/java/org/apache/cxf/systest/ws/rm/ProtocolVariationsTest.java#L435-L438&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;For 2.7.x, there are a few things missing for correctly handling CloseSequence. So, I need to look at it to see if it&apos;s worth a while to fix this handling.&lt;/p&gt;

&lt;p&gt;regards, aki&lt;/p&gt;</comment>
                            <comment id="14661574" author="jtomek" created="Fri, 7 Aug 2015 09:59:20 +0000"  >&lt;p&gt;Hi Aki&lt;/p&gt;

&lt;p&gt;You&apos;re right. With 2.7.x, in both situations (before and after I patched that IF statement), server side does not really behave as one would expect - it either sends empty response or (with the patch) its sends SequenceAcknowledgement instead of CloseSequenceResponse.&lt;/p&gt;

&lt;p&gt;While looking closely once again at the messages being exchanged, I see that even client, in it&apos;s CloseSequence request, does not send what I believe it should. There&apos;s no body and I would expect to see CloseSequence element there.&lt;/p&gt;

&lt;p&gt;But, luckily, for my needs, with that incorrect patch of mine, server side and client side that I&apos;m using, while both doing wrong things, do proceed and terminate the sequence at the end ... which is what matters to me right now.&lt;/p&gt;

&lt;p&gt;Regards&lt;br/&gt;
Jozef&lt;/p&gt;</comment>
                            <comment id="14661880" author="ay" created="Fri, 7 Aug 2015 14:15:06 +0000"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;fixed CloseSequene handling for 2.7.x.&lt;/li&gt;
	&lt;li&gt;added some tests in rt/ws/rm and systests/wr-rm to verify the correct CloseSequence handling for WS-RM 1.1.&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="14661882" author="ay" created="Fri, 7 Aug 2015 14:17:20 +0000"  >&lt;p&gt;Hi Jozef,&lt;br/&gt;
the CloseSequence handling should now work for 2.7.x (from 2.7.18).&lt;/p&gt;

&lt;p&gt;regards, aki&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 15 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ictr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>