<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:37:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-2242] FormEncodingProvider writes the application/x-www-form-urlencoded params incorrectly when multiple params with the same name are present</title>
                <link>https://issues.apache.org/jira/browse/CXF-2242</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;Hi, there is a problem with FormEncodingProvider when writing the url-encoded string. It is checking an incorrect iterator.&lt;/p&gt;

&lt;p&gt;    public void writeTo(MultivaluedMap&amp;lt;String, String&amp;gt; map, Class&amp;lt;?&amp;gt; c, Type t, Annotation[] anns, &lt;br/&gt;
                        MediaType mt, MultivaluedMap&amp;lt;String, Object&amp;gt; headers, OutputStream os) &lt;br/&gt;
        throws IOException, WebApplicationException {&lt;br/&gt;
        boolean encoded = AnnotationUtils.getAnnotation(anns, Encoded.class) != null;&lt;br/&gt;
        for (Iterator&amp;lt;Map.Entry&amp;lt;String, List&amp;lt;String&amp;gt;&amp;gt;&amp;gt; it = map.entrySet().iterator(); it.hasNext()&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; {&lt;br/&gt;
            Map.Entry&amp;lt;String, List&amp;lt;String&amp;gt;&amp;gt; entry = it.next();&lt;br/&gt;
            for (String value : entry.getValue()) {&lt;br/&gt;
                os.write(entry.getKey().getBytes(&quot;UTF-8&quot;));&lt;br/&gt;
                os.write(&apos;=&apos;);&lt;br/&gt;
                String data = encoded ? value : HttpUtils.urlEncode(value); &lt;br/&gt;
                os.write(data.getBytes(&quot;UTF-8&quot;));&lt;br/&gt;
                if (it.hasNext()) &lt;/p&gt;
{
                    os.write(&apos;&amp;amp;&apos;);
                }&lt;br/&gt;
            }&lt;br/&gt;
        }&lt;br/&gt;
    }&lt;br/&gt;
&lt;br/&gt;
it.hasNext() should be checking the entry iterator and not the map iterator. The consequence is that &amp;amp; is never appended if, for example, there is only one parameter&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
Fixed version would be:&lt;br/&gt;
&lt;br/&gt;
    public void writeTo(MultivaluedMap&amp;lt;String, String&amp;gt; map, Class&amp;lt;?&amp;gt; c, Type t, Annotation[] anns, &lt;br/&gt;
                        MediaType mt, MultivaluedMap&amp;lt;String, Object&amp;gt; headers, OutputStream os) &lt;br/&gt;
        throws IOException, WebApplicationException {&lt;br/&gt;
        boolean encoded = AnnotationUtils.getAnnotation(anns, Encoded.class) != null;&lt;br/&gt;
        for (Iterator&amp;lt;Map.Entry&amp;lt;String, List&amp;lt;String&amp;gt;&amp;gt;&amp;gt; it = map.entrySet().iterator(); it.hasNext()&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; {&lt;br/&gt;
            Map.Entry&amp;lt;String, List&amp;lt;String&amp;gt;&amp;gt; entry = it.next();&lt;br/&gt;
            for (Iterator&amp;lt;String&amp;gt; entryIterator = entry.getValue().iterator(); entryIterator.hasNext()&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; {&lt;br/&gt;
            	String value = entryIterator.next();&lt;br/&gt;
				os.write(entry.getKey().getBytes(&quot;UTF-8&quot;));&lt;br/&gt;
                os.write(&apos;=&apos;);&lt;br/&gt;
                String data = encoded ? value : HttpUtils.urlEncode(value); &lt;br/&gt;
                os.write(data.getBytes(&quot;UTF-8&quot;));&lt;br/&gt;
                if (entryIterator.hasNext()) {                    os.write(&apos;&amp;amp;&apos;);                }
&lt;p&gt;            }&lt;br/&gt;
        }&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;I don&apos;t have time just now to provide test cases but a careful look should do.&lt;/p&gt;

&lt;p&gt;best regards&lt;/p&gt;</description>
                <environment></environment>
        <key id="12426576">CXF-2242</key>
            <summary>FormEncodingProvider writes the application/x-www-form-urlencoded params incorrectly when multiple params with the same name are present</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sergey_beryozkin">Sergey Beryozkin</assignee>
                                    <reporter username="ignaciogmd">Nacho G. Mac Dowell</reporter>
                        <labels>
                    </labels>
                <created>Thu, 28 May 2009 13:09:01 +0000</created>
                <updated>Mon, 3 Aug 2009 20:06:55 +0000</updated>
                            <resolved>Mon, 1 Jun 2009 17:42:55 +0000</resolved>
                                    <version>2.2.1</version>
                                    <fixVersion>2.2.3</fixVersion>
                                    <component>JAX-RS</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12713972" author="ignaciogmd" created="Thu, 28 May 2009 13:10:17 +0000"  >&lt;p&gt;Patch solving this issue&lt;/p&gt;</comment>
                            <comment id="12713973" author="ignaciogmd" created="Thu, 28 May 2009 13:13:05 +0000"  >&lt;p&gt;Workaround: (Since it will probably take some time to include this patch in a release, I am including the implemented workaround)&lt;/p&gt;

&lt;p&gt;When invoking a application/x-www-form-urlencoded service register the following provider and everything will be fine:&lt;/p&gt;

&lt;p&gt;public class FixedFormEncodingProvider extends FormEncodingProvider {&lt;/p&gt;

&lt;p&gt;    public void writeTo(MultivaluedMap&amp;lt;String, String&amp;gt; map, Class&amp;lt;?&amp;gt; c, Type t, Annotation[] anns, &lt;br/&gt;
                        MediaType mt, MultivaluedMap&amp;lt;String, Object&amp;gt; headers, OutputStream os) &lt;br/&gt;
        throws IOException, WebApplicationException {&lt;br/&gt;
        boolean encoded = AnnotationUtils.getAnnotation(anns, Encoded.class) != null;&lt;br/&gt;
        for (Iterator&amp;lt;Map.Entry&amp;lt;String, List&amp;lt;String&amp;gt;&amp;gt;&amp;gt; it = map.entrySet().iterator(); it.hasNext()&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; {&lt;br/&gt;
            Map.Entry&amp;lt;String, List&amp;lt;String&amp;gt;&amp;gt; entry = it.next();&lt;br/&gt;
            for (Iterator&amp;lt;String&amp;gt; entryIterator = entry.getValue().iterator(); entryIterator.hasNext()&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; {&lt;br/&gt;
				String value = entryIterator.next();&lt;br/&gt;
				os.write(entry.getKey().getBytes(&quot;UTF-8&quot;));&lt;br/&gt;
                os.write(&apos;=&apos;);&lt;br/&gt;
                String data = encoded ? value : HttpUtils.urlEncode(value); &lt;br/&gt;
                os.write(data.getBytes(&quot;UTF-8&quot;));&lt;br/&gt;
                if (entryIterator.hasNext()) &lt;/p&gt;
{
                    os.write(&apos;&amp;amp;&apos;);
                }
&lt;p&gt;			}&lt;br/&gt;
        }&lt;br/&gt;
    }&lt;br/&gt;
}&lt;/p&gt;</comment>
                            <comment id="12714527" author="sergey_beryozkin" created="Fri, 29 May 2009 17:36:53 +0000"  >&lt;p&gt;Hi&lt;/p&gt;

&lt;p&gt;I&apos;ve added this unit test and it passes :&lt;/p&gt;

&lt;p&gt;MultivaluedMap&amp;lt;String, String&amp;gt; mvMap = new MetadataMap&amp;lt;String, String&amp;gt;();&lt;br/&gt;
        mvMap.add(&quot;a&quot;, &quot;a1&quot;);&lt;br/&gt;
        mvMap.add(&quot;a&quot;, &quot;a2&quot;);&lt;br/&gt;
        mvMap.add(&quot;b&quot;, &quot;b1&quot;);&lt;br/&gt;
        ByteArrayOutputStream bos = new ByteArrayOutputStream(); &lt;br/&gt;
        ferp.writeTo(mvMap, MultivaluedMap.class, MultivaluedMap.class, &lt;br/&gt;
                     new Annotation&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;, MediaType.APPLICATION_FORM_URLENCODED_TYPE, &lt;br/&gt;
                     new MetadataMap&amp;lt;String, Object&amp;gt;(), bos);&lt;br/&gt;
        String result = bos.toString();&lt;br/&gt;
        assertEquals(&quot;Wrong value&quot;, &quot;a=a1&amp;amp;a=a2&amp;amp;b=b1&quot;, result.toString());&lt;/p&gt;

&lt;p&gt;&amp;gt; The consequence is that &amp;amp; is never appended if, for example, there is only one parameter &lt;br/&gt;
Can you please just post here a sample combination of name/value pairs and their serialized sequence, such that I can update the test&lt;/p&gt;


&lt;p&gt;thanks, Sergey  &lt;/p&gt;</comment>
                            <comment id="12714709" author="ignaciogmd" created="Sat, 30 May 2009 13:21:12 +0000"  >&lt;p&gt;Oops... I forgot to include the other it.hasNext()...&lt;/p&gt;

&lt;p&gt;Currently this test fails:&lt;/p&gt;

&lt;p&gt;	MultivaluedMap&amp;lt;String, String&amp;gt; mvMap = new MetadataMap&amp;lt;String, String&amp;gt;();&lt;br/&gt;
        mvMap.add(&quot;a&quot;, &quot;a1&quot;);&lt;br/&gt;
        mvMap.add(&quot;a&quot;, &quot;a2&quot;);&lt;br/&gt;
        ByteArrayOutputStream bos = new ByteArrayOutputStream();&lt;br/&gt;
        ferp.writeTo(mvMap, MultivaluedMap.class, MultivaluedMap.class,&lt;br/&gt;
                     new Annotation&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;, MediaType.APPLICATION_FORM_URLENCODED_TYPE,&lt;br/&gt;
                     new MetadataMap&amp;lt;String, Object&amp;gt;(), bos);&lt;br/&gt;
        String result = bos.toString();&lt;br/&gt;
        assertEquals(&quot;Wrong value&quot;, &quot;a=a1&amp;amp;a=a2&quot;, result.toString());&lt;/p&gt;

&lt;p&gt;The result is a=a1a=a2&lt;/p&gt;

&lt;p&gt;So, it should be....:&lt;/p&gt;

&lt;p&gt;        for (Iterator&amp;lt;Map.Entry&amp;lt;String, List&amp;lt;String&amp;gt;&amp;gt;&amp;gt; it = map.entrySet().iterator(); it.hasNext()&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; {&lt;br/&gt;
            Map.Entry&amp;lt;String, List&amp;lt;String&amp;gt;&amp;gt; entry = it.next();&lt;br/&gt;
            for (Iterator&amp;lt;String&amp;gt; entryIterator = entry.getValue().iterator(); entryIterator.hasNext()&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; {&lt;br/&gt;
				String value = entryIterator.next();&lt;br/&gt;
				os.write(entry.getKey().getBytes(&quot;UTF-8&quot;));&lt;br/&gt;
                os.write(&apos;=&apos;);&lt;br/&gt;
                String data = encoded ? value : HttpUtils.urlEncode(value);&lt;br/&gt;
                os.write(data.getBytes(&quot;UTF-8&quot;));&lt;br/&gt;
                if (entryIterator.hasNext() || it.hasNext()) &lt;/p&gt;
{
                    os.write(&apos;&amp;amp;&apos;);
                }
&lt;p&gt;	}&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;Like this, your test, the prev test and the following will pass:&lt;/p&gt;

&lt;p&gt;	MultivaluedMap&amp;lt;String, String&amp;gt; mvMap = new MetadataMap&amp;lt;String, String&amp;gt;();&lt;br/&gt;
        mvMap.add(&quot;a&quot;, &quot;a1&quot;);&lt;br/&gt;
        mvMap.add(&quot;b&quot;, &quot;b1&quot;);&lt;br/&gt;
        mvMap.add(&quot;b&quot;, &quot;b2&quot;);&lt;br/&gt;
        ByteArrayOutputStream bos = new ByteArrayOutputStream();&lt;br/&gt;
        ferp.writeTo(mvMap, MultivaluedMap.class, MultivaluedMap.class,&lt;br/&gt;
                     new Annotation&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;, MediaType.APPLICATION_FORM_URLENCODED_TYPE,&lt;br/&gt;
                     new MetadataMap&amp;lt;String, Object&amp;gt;(), bos);&lt;br/&gt;
        String result = bos.toString();&lt;br/&gt;
        assertEquals(&quot;Wrong value&quot;, &quot;a=a1&amp;amp;a=a2&quot;, result.toString());&lt;/p&gt;

&lt;p&gt;Best regards,&lt;br/&gt;
n&lt;/p&gt;</comment>
                            <comment id="12715163" author="sergey_beryozkin" created="Mon, 1 Jun 2009 17:42:55 +0000"  >&lt;p&gt;I applied your proposed fix as is and it worked really well, thanks ! I&apos;d like to view it as a patch point. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12409262" name="FormEncodingProvider.patch" size="1373" author="ignaciogmd" created="Thu, 28 May 2009 13:10:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10061"><![CDATA[Novice]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>113680</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 26 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0v0tb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>179105</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>