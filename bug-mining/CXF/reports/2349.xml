<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:11:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-5966] NPE in MessageContextImpl when setting ResponseBuilder entity in an ExceptionMapper</title>
                <link>https://issues.apache.org/jira/browse/CXF-5966</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;I hope that this description is complete enough. I think creating a test case for this ticket will be more trouble than it&apos;s worth, but please let me know if you need me to.&lt;/p&gt;

&lt;p&gt;I have added BeanValidationInInterceptor to my JAX-RS service which uses JAXB-annotated entities.&lt;br/&gt;
I have created an ExceptionMapper to capture and write out the validation errors into my JAXB-annotated object&apos;s &apos;description&apos; field.&lt;br/&gt;
In my exception mapper, I populate MyObject (which is JAXB-annotated), and then set it as the entity:&lt;/p&gt;

&lt;p&gt;responseBuilder.entity(myObject);&lt;/p&gt;

&lt;p&gt;it results in an NPE as the JAXBElementProvider attempts to get any attachments from the MessageContext, which dereferences a null OutboundMessage from its Exchange.&lt;/p&gt;

&lt;p&gt;Line 83 in MessageContextImpl contains:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; m.getExchange().getOutMessage().get(Message.ATTACHMENTS);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The javadoc for Exchange.getOutMessage states that &quot;During the inbound message processing, the outbound message is null&quot;. &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2014-08-20 23:50:53,919|ERROR|http-0.0.0.0-8443-2:|STDERR| java.lang.NullPointerException
2014-08-20 23:50:53,919|ERROR|http-0.0.0.0-8443-2:|STDERR|      at org.apache.cxf.jaxrs.ext.MessageContextImpl.get(MessageContextImpl.java:83)
2014-08-20 23:50:53,919|ERROR|http-0.0.0.0-8443-2:|STDERR|      at org.apache.cxf.jaxrs.impl.tl.ThreadLocalMessageContext.get(ThreadLocalMessageContext.java:38)
2014-08-20 23:50:53,927|ERROR|http-0.0.0.0-8443-2:|STDERR|      at org.apache.cxf.jaxrs.provider.JAXBElementProvider.getAttachments(JAXBElementProvider.java:542)
2014-08-20 23:50:53,927|ERROR|http-0.0.0.0-8443-2:|STDERR|      at org.apache.cxf.jaxrs.provider.JAXBElementProvider.addAttachmentMarshaller(JAXBElementProvider.java:520)
2014-08-20 23:50:53,928|ERROR|http-0.0.0.0-8443-2:|STDERR|      at org.apache.cxf.jaxrs.provider.JAXBElementProvider.marshal(JAXBElementProvider.java:444)
2014-08-20 23:50:53,928|ERROR|http-0.0.0.0-8443-2:|STDERR|      at org.apache.cxf.jaxrs.provider.JAXBElementProvider.writeTo(JAXBElementProvider.java:318)
2014-08-20 23:50:53,928|ERROR|http-0.0.0.0-8443-2:|STDERR|      at org.apache.cxf.jaxrs.utils.JAXRSUtils.writeMessageBody(JAXRSUtils.java:1363)
2014-08-20 23:50:53,928|ERROR|http-0.0.0.0-8443-2:|STDERR|      at org.apache.cxf.jaxrs.interceptor.JAXRSOutInterceptor.serializeMessage(JAXRSOutInterceptor.java:244)
2014-08-20 23:50:53,928|ERROR|http-0.0.0.0-8443-2:|STDERR|      at org.apache.cxf.jaxrs.interceptor.JAXRSOutInterceptor.processResponse(JAXRSOutInterceptor.java:117)
2014-08-20 23:50:53,928|ERROR|http-0.0.0.0-8443-2:|STDERR|      at org.apache.cxf.jaxrs.interceptor.JAXRSOutInterceptor.handleMessage(JAXRSOutInterceptor.java:80)
2014-08-20 23:50:53,928|ERROR|http-0.0.0.0-8443-2:|STDERR|      at org.apache.cxf.jaxrs.interceptor.JAXRSDefaultFaultOutInterceptor.handleMessage(JAXRSDefaultFaultOutInterceptor.java:61)
2014-08-20 23:50:53,928|ERROR|http-0.0.0.0-8443-2:|STDERR|      at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:307)
2014-08-20 23:50:53,928|ERROR|http-0.0.0.0-8443-2:|STDERR|      at org.apache.cxf.interceptor.AbstractFaultChainInitiatorObserver.onMessage(AbstractFaultChainInitiatorObserver.java:113)
2014-08-20 23:50:53,928|ERROR|http-0.0.0.0-8443-2:|STDERR|      at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:371)
2014-08-20 23:50:53,928|ERROR|http-0.0.0.0-8443-2:|STDERR|      at org.apache.cxf.transport.ChainInitiationObserver.onMessage(ChainInitiationObserver.java:121)
2014-08-20 23:50:53,928|ERROR|http-0.0.0.0-8443-2:|STDERR|      at org.apache.cxf.transport.http.AbstractHTTPDestination.invoke(AbstractHTTPDestination.java:243)
2014-08-20 23:50:53,928|ERROR|http-0.0.0.0-8443-2:|STDERR|      at org.apache.cxf.transport.servlet.ServletController.invokeDestination(ServletController.java:223)
2014-08-20 23:50:53,928|ERROR|http-0.0.0.0-8443-2:|STDERR|      at org.apache.cxf.transport.servlet.ServletController.invoke(ServletController.java:197)
2014-08-20 23:50:53,928|ERROR|http-0.0.0.0-8443-2:|STDERR|      at org.apache.cxf.transport.servlet.ServletController.invoke(ServletController.java:149)
2014-08-20 23:50:53,928|ERROR|http-0.0.0.0-8443-2:|STDERR|      at org.apache.cxf.transport.servlet.CXFNonSpringServlet.invoke(CXFNonSpringServlet.java:171)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;CXF 3.0.1 with custom ExceptionMapper&amp;lt;ValidationException&amp;gt;, JAXBElementProvider, MessageContextImpl&lt;/p&gt;</environment>
        <key id="12735819">CXF-5966</key>
            <summary>NPE in MessageContextImpl when setting ResponseBuilder entity in an ExceptionMapper</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sergey_beryozkin">Sergey Beryozkin</assignee>
                                    <reporter username="mparker">Matt Parker</reporter>
                        <labels>
                    </labels>
                <created>Thu, 21 Aug 2014 16:06:59 +0000</created>
                <updated>Mon, 16 Feb 2015 16:09:33 +0000</updated>
                            <resolved>Fri, 22 Aug 2014 13:38:53 +0000</resolved>
                                    <version>3.0.1</version>
                                    <fixVersion>3.0.2</fixVersion>
                    <fixVersion>3.1</fixVersion>
                                    <component>JAX-RS</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14106823" author="sergey_beryozkin" created="Fri, 22 Aug 2014 13:38:40 +0000"  >&lt;p&gt;This is now fixed, it was caused by the fact that you use a native CXF interceptor and the way the exceptions are mapped to JAX-RS mappers is different, the exceptions flows to a CXF out fault chain where the outMessage is reset to null, and a faultOutMessage is set instead. I&apos;ve updated the default JAX-RS fault mapper to treat both the same way. In meantime consider using JAXRSBeanValidationInInterceptor and register it as a jaxrs:provider, so it will be treated as a JAX-RS ContainerRequestFilter, this will work for you without waiting for a fix&lt;/p&gt;</comment>
                            <comment id="14109941" author="mparker" created="Mon, 25 Aug 2014 23:09:21 +0000"  >&lt;p&gt;I have tried the workaround you suggested. I registered org.apache.cxf.jaxrs.validation.JAXRSBeanValidationInInterceptor as a provider, and removed org.apache.cxf.validation.BeanValidationInInterceptor as an inInterceptor. But it still fails in the same way. I see that you added a fix in 3.0.x-fixes. Will that fix make its way into 3.0.2-SNAPSHOT, or do I need to do something else to get it for early testing?&lt;/p&gt;

&lt;p&gt;A side note: to use JAXRSBeanValidationInInterceptor, I needed to add javax.annotation-api-1.2.jar to my project for the @Priority annotation. I didn&apos;t see this in the migration guide, it might be worth mentioning (for those of us unfortunate enough to have to chase down dependencies manually).&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="14110577" author="sergey_beryozkin" created="Tue, 26 Aug 2014 10:21:24 +0000"  >&lt;p&gt;You are right, the JAXRS filter only registers itself as a native CXF interceptor, so the problem persists. I recall now I did introduce it to facilitate the registration from custom DynamicFeatures. So I think the only workaround in the released 3.0.1 is to register a custom out fault interceptor...the snapshots have it addressed though.&lt;/p&gt;

&lt;p&gt;Re the annotations dependency, not a migration issue for sure given that it&apos;s a new and optional dependency affecting the new 2.0 filters only but you are right it should&apos;ve been mentioned somewhere, I updated this section:&lt;br/&gt;
&lt;a href=&quot;https://cwiki.apache.org/confluence/display/CXF20DOC/JAX-RS#JAX-RS-CXF3.0.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/display/CXF20DOC/JAX-RS#JAX-RS-CXF3.0.0&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;thanks &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 13 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1z6uv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>