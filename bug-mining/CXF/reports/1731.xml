<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:59:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-4918] Cannot get xsd schema file when access wsdl file as &quot;?wsdl&quot; with auto redirect turned on</title>
                <link>https://issues.apache.org/jira/browse/CXF-4918</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;=============&lt;br/&gt;
Problem Description:&lt;br/&gt;
=============&lt;/p&gt;

&lt;p&gt;The scenario is trying to access wsdl file from remote service provider using URL as &quot;http://localhost:9083/TestWeb/HelloService?wsdl&quot;. The remote service redirect the request to URL &quot;http://localhost:9083/TestWeb/HelloService/HelloService.wsdl&quot;.&lt;/p&gt;

&lt;p&gt;I turned on AutoRedirect by calling method &quot;HTTPClientPolicy.setAutoRedirect(true)&quot; in CXF. The auto redirection works and WSDL file is loaded successfully.&lt;/p&gt;

&lt;p&gt;However, inside of the WSDL file it imports another XSD schema file which is in the same folder as WSDL file on remote server.&lt;/p&gt;

&lt;p&gt;&amp;lt;xsd:schema&amp;gt;&lt;br/&gt;
&amp;lt;xsd:import namespace=&quot;http://hello.jaxws.sample.com/&quot; schemaLocation=&quot;HelloService_schema1.xsd&quot;/&amp;gt;&lt;br/&gt;
&amp;lt;/xsd:schema&amp;gt;&lt;/p&gt;

&lt;p&gt;CXF tries to load this XSD file, but it use the original URL &quot;http://localhost:9083/TestWeb/HelloService?wsdl&quot; as base URI, and got the wrong target address as &quot;http://localhost:9083/TestWeb/HelloService_schema1.xsd&quot;. Obviously it failed since the XSD file is not there.&lt;/p&gt;

&lt;p&gt;Actually if CXF use the new URL after auto redirect as base URI, it will get the correct URL for XSD file, in this case it should be &quot;http://localhost:9083/TestWeb/HelloService/HelloService_schema1.xsd&quot;.&lt;/p&gt;


&lt;p&gt;=============&lt;br/&gt;
Investigation&lt;br/&gt;
=============&lt;/p&gt;


&lt;p&gt;In method TransportURIResolver.resolve(String curUri, String baseUri):&lt;/p&gt;

&lt;p&gt;                    c.prepare(message);&lt;br/&gt;
                    c.close(message);&lt;br/&gt;
                    InputStream ins = exch.get(InputStream.class);&lt;br/&gt;
                    resourceOpened.addElement(ins);&lt;br/&gt;
                    InputSource src = new InputSource(ins);&lt;br/&gt;
                    src.setPublicId(base.toString());&lt;br/&gt;
                    src.setSystemId(base.toString());&lt;br/&gt;
                    lastestImportUri = base.toString();&lt;/p&gt;

&lt;p&gt;The actual redirect happens in method HTTPConduit.redirectRetransmit(...) when &quot;c.close(message)&quot; above is invoked. However TransportURIResolver has no idea if redirect happens or not. So it still save the original URI (the variable base) to publicId and systemId and lastestImportUri. Later when it tries to get XSD file these info will be used as base URI.&lt;/p&gt;

&lt;p&gt;To resolve this problem I suggest we get the new URL after redirect, and save it as publicId, systemId, or lastestImportUri. And use it as future base URI.&lt;/p&gt;

&lt;p&gt;Per my investigation the new URL after redirect can be retrieved from message object:&lt;/p&gt;

&lt;p&gt;                    java.net.HttpURLConnection conn = (java.net.HttpURLConnection)message.get(&quot;http.connection&quot;);&lt;br/&gt;
                    String newURL = conn.getURL().toURI().toString();&lt;/p&gt;

&lt;p&gt;The problem is at this place it does not know if redirect happened or not. If it does not happen, the returned URL should be the same as original base URI.&lt;/p&gt;

&lt;p&gt;Could somebody help to review this logic please? Is there any object for this proposed change? Any suggestion are welcome. Thank you!&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Eric&lt;/p&gt;

</description>
                <environment>&lt;p&gt;Windows&lt;/p&gt;</environment>
        <key id="12638793">CXF-4918</key>
            <summary>Cannot get xsd schema file when access wsdl file as &quot;?wsdl&quot; with auto redirect turned on</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="kouzq">Kou, Zhi Qiang</reporter>
                        <labels>
                    </labels>
                <created>Mon, 25 Mar 2013 08:18:56 +0000</created>
                <updated>Thu, 28 Mar 2013 14:08:08 +0000</updated>
                            <resolved>Thu, 28 Mar 2013 14:06:51 +0000</resolved>
                                    <version>2.6.2</version>
                                    <fixVersion>2.7.4</fixVersion>
                    <fixVersion>2.6.7</fixVersion>
                                    <component>Transports</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13614470" author="dkulp" created="Tue, 26 Mar 2013 19:47:11 +0000"  >
&lt;p&gt;That won&apos;t work if the Async http conduit is picked up as the HttpURLConnection wouldn&apos;t be used.   &lt;/p&gt;

&lt;p&gt;I THINK a better option would be:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;diff --git a/api/src/main/java/org/apache/cxf/transport/TransportURIResolver.java b/api/src/main/java/org/apache/cxf/transport/TransportURIResolver.java
index 72a336d..261a822 100644
--- a/api/src/main/java/org/apache/cxf/transport/TransportURIResolver.java
+++ b/api/src/main/java/org/apache/cxf/transport/TransportURIResolver.java
@@ -129,9 +129,13 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TransportURIResolver &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; ExtendedURIResolver {
                     InputStream ins = exch.get(InputStream.class);
                     resourceOpened.addElement(ins);
                     InputSource src = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; InputSource(ins);
-                    src.setPublicId(base.toString());
-                    src.setSystemId(base.toString());
-                    lastestImportUri = base.toString();
+                    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; u = (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;)message.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;http.retransmit.url&quot;&lt;/span&gt;);
+                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (u == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
+                        u = base.toString();
+                    }
+                    src.setPublicId(u);
+                    src.setSystemId(u);
+                    lastestImportUri = u;
                     currentResolver.unresolve();
                     &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; src;
                 }
diff --git a/rt/transports/http/src/main/java/org/apache/cxf/transport/http/HTTPConduit.java b/rt/transports/http/src/main/java/org/apache/cxf/transport/http/HTTPConduit.java
index 9876088..7f564ac 100644
--- a/rt/transports/http/src/main/java/org/apache/cxf/transport/http/HTTPConduit.java
+++ b/rt/transports/http/src/main/java/org/apache/cxf/transport/http/HTTPConduit.java
@@ -1187,7 +1187,7 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;HTTPConduit
         
         &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void retransmit(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; newURL) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
             setupNewConnection(newURL);
-            
+            outMessage.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;http.retransmit.url&quot;&lt;/span&gt;, newURL);
             &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (cachedStream != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; cachedStream.size() &amp;lt; &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.MAX_VALUE) {
                 setFixedLengthStreamingMode((&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)cachedStream.size());
             }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;as that would set that property for both of the HTTPConduit subclasses.  I&apos;m going to see if that &quot;breaks&quot; anything, but help testing would be great.  &lt;/p&gt;</comment>
                            <comment id="13616267" author="kouzq" created="Thu, 28 Mar 2013 14:06:12 +0000"  >&lt;p&gt;Hi Daniel, thank you so much for giving the fix of this issue!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10020">
                    <name>Cloners</name>
                                            <outwardlinks description="is a clone of">
                                        <issuelink>
            <issuekey id="12638792">CXF-4917</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>319268</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 34 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1j36n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>319609</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>