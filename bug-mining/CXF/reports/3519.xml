<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:35:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-8280] AttachmentId issue </title>
                <link>https://issues.apache.org/jira/browse/CXF-8280</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;Hello,&#160;&lt;/p&gt;

&lt;p&gt;I don&apos;t know if it is really a bug, or something I am missing, but I have and issue when the attachmend is resolved.&lt;/p&gt;

&lt;p&gt;I have a xopUri like this :&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// cid:998c3362-5b5f-405a-817a-b20f8373c378-5@urn%3Abe%3Acin%3Anip%3Aasync%3Ageneric&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;when it is resolved as attachmentId via the method&#160;getAttachmentId(xopUri) the value is this :&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// 998c3362-5b5f-405a-817a-b20f8373c378-5@urn:be:cin:nip:async:&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We see here that %3A has been replaced by his related characters &apos;:&apos;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;After when the attachmentCallbackHandler try to find the correct attachment in the list (loadAttachments methods) it compare these 2 values in the do while&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// }&lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt;(attachmentId != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; !attachmentId.equals(attachment.getId()));&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The value of attachmentId is&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// 998c3362-5b5f-405a-817a-b20f8373c378-5@urn:be:cin:nip:async:&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The value of&#160;attachment.getId() is :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// 998c3362-5b5f-405a-817a-b20f8373c378-5@urn%3Abe%3Acin%3Anip%3Aasync%3Ageneric&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So the comparaison fails and attachment is not found =&amp;gt; Exception attachment not found&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Is it some issue, or do I something wrong ?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Version of wss4j : 2.2.4&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13303134">CXF-8280</key>
            <summary>AttachmentId issue </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="coheigea">Colm O hEigeartaigh</assignee>
                                    <reporter username="frederic.pirson">Fr&#233;d&#233;ric Pirson</reporter>
                        <labels>
                    </labels>
                <created>Wed, 6 May 2020 14:49:21 +0000</created>
                <updated>Wed, 22 Dec 2021 20:43:52 +0000</updated>
                            <resolved>Fri, 8 May 2020 12:16:26 +0000</resolved>
                                                    <fixVersion>3.3.7</fixVersion>
                    <fixVersion>3.4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17100885" author="coheigea" created="Wed, 6 May 2020 15:17:20 +0000"  >&lt;p&gt;I don&apos;t think WSS4J does any URL Decoding on XOP attachment Ids. Could you add a screenshot of what the part of your request that references the XOP URI looks like?&lt;/p&gt;

&lt;p&gt;When you say &quot;when it is resolved as attachmentId via the method getAttachmentId(xopUri)&quot; - where is xopUri coming from in this case? Maybe you can walk backwards from this point and see where the URL decoding is happening.&lt;/p&gt;</comment>
                            <comment id="17100890" author="frederic.pirson" created="Wed, 6 May 2020 15:24:50 +0000"  >&lt;p&gt;Here is a test that explains my problem :&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void test() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception{
    org.apache.xml.security.Init.init();
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; attachmentId=&lt;span class=&quot;code-quote&quot;&gt;&quot;998c3362-5b5f-405a-817a-b20f8373c378-5@urn%3Abe%3Acin%3Anip%3Aasync%3Ageneric&quot;&lt;/span&gt;;
    Attachment attachment = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AttachmentImpl(attachmentId);
    AttachmentCallbackHandler callbackHandler = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AttachmentCallbackHandler(Collections.singletonList(attachment));
    AttachmentUtils.getBytesFromAttachment(&lt;span class=&quot;code-quote&quot;&gt;&quot;cid:&quot;&lt;/span&gt;+attachmentId, callbackHandler,&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The decode is done here :&#160;&lt;/p&gt;

&lt;p&gt;Class AttachmentUtils:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getAttachmentId(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; xopUri) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; WSSecurityException {
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; URLDecoder.decode(xopUri.substring(&lt;span class=&quot;code-quote&quot;&gt;&quot;cid:&quot;&lt;/span&gt;.length()), StandardCharsets.UTF_8.name());
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (UnsupportedEncodingException var2) {
        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; WSSecurityException(ErrorCode.INVALID_SECURITY, &lt;span class=&quot;code-quote&quot;&gt;&quot;empty&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[]{&lt;span class=&quot;code-quote&quot;&gt;&quot;Attachment ID cannot be decoded: &quot;&lt;/span&gt; + xopUri});
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;It should be generated by the Signature action of wss4j&lt;/p&gt;

&lt;p&gt;I can look upon when the signature&#160;and the cid&#160; are generated&#160;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17101500" author="coheigea" created="Thu, 7 May 2020 10:08:09 +0000"  >&lt;p&gt;The URL Decoding was added for this JIRA: &lt;a href=&quot;https://issues.apache.org/jira/browse/WSS-652&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/WSS-652&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;From what I can tell, the Content-Id of the attachment should not be URL encoded:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;A &quot;cid&quot; URL is converted to the corresponding Content-ID message
header [MIME] by removing the &quot;cid:&quot; prefix, converting the % encoded
character to their equivalent US-ASCII characters, and enclosing the
remaining parts with an angle bracket pair, &quot;&amp;lt;&quot; and &quot;&amp;gt;&quot;.&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So I&apos;m inclined to think that WSS4J is doing the right thing by URL Decoding the XOP URI and comparing the decoded version against the attachment Content-Id directly. What is generating the attachment headers in your example?&lt;/p&gt;</comment>
                            <comment id="17102362" author="frederic.pirson" created="Fri, 8 May 2020 08:16:49 +0000"  >&lt;p&gt;Ok, we are using CXF 3.3.5.&#160;&lt;/p&gt;

&lt;p&gt;It also encode the attachmentId (cid) :&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; createContentID(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; ns) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; UnsupportedEncodingException {
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; cid = &lt;span class=&quot;code-quote&quot;&gt;&quot;cxf.apache.org&quot;&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ns != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; !ns.isEmpty()) {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            URI uri = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URI(ns);
            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; host = uri.getHost();
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (host != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                cid = host;
            } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                cid = ns;
            }
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception var4) {
            cid = ns;
        }
    }

    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ATT_UUID + &lt;span class=&quot;code-quote&quot;&gt;&apos;-&apos;&lt;/span&gt; + &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.toString(COUNTER.incrementAndGet()) + &lt;span class=&quot;code-quote&quot;&gt;&apos;@&apos;&lt;/span&gt; + URLEncoder.encode(cid, StandardCharsets.UTF_8.name());
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It our case we have no host, so it encodes the namespace.&lt;/p&gt;

&lt;p&gt;Do you need to create an issue at cxf side ?&lt;/p&gt;</comment>
                            <comment id="17102478" author="coheigea" created="Fri, 8 May 2020 11:17:29 +0000"  >&lt;p&gt;I&apos;ve moved this to CXF. What I will do is to add some code in the AttachmentCallbackHandler to URL Decode the attachment ID + check this as well. Hopefully this will work. Please test with the latest code + re-open this issue if it does not work for you!&lt;/p&gt;</comment>
                            <comment id="17104185" author="frederic.pirson" created="Mon, 11 May 2020 08:07:16 +0000"  >&lt;p&gt;Hello Colm,&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I will have a test. But I am using Wildfly 19, and as I can remember it tooks the WSS4J handlers from wss4j 2.2.4 and not the handlers in cxf. I will verify it asap and let you know.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Regards&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Fr&#233;d&#233;ric&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 27 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0efsg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>