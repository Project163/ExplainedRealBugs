<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:59:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-4920] TransformationInInterceptor fails when XML contains same namespace with different prefixes</title>
                <link>https://issues.apache.org/jira/browse/CXF-4920</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;TransformationInInterceptor fails when XML contains same namespace with different prefixes.&lt;/p&gt;


&lt;p&gt;So for example this will fail:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;wireTransfer xmlns:q1=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//bar.com/foo&quot;&lt;/span&gt; xsi:type=&lt;span class=&quot;code-quote&quot;&gt;&quot;q1:SwiftWireTransfer&quot;&lt;/span&gt;&amp;gt;
&lt;/span&gt;...
&amp;lt;/wireTransfer&amp;gt;
&amp;lt;wireTransfer xmlns:q2=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//bar.com/foo&quot;&lt;/span&gt; xsi:type=&lt;span class=&quot;code-quote&quot;&gt;&quot;q2:SwiftWireTransfer&quot;&lt;/span&gt;&amp;gt;
&lt;/span&gt;...
&amp;lt;/wireTransfer&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;as for &quot;q2:SwiftWireTransfer&quot; the prefix q2 would be never found due to internal cache strategy.&lt;/p&gt;

&lt;p&gt;So the above bug blocks usage of such kind of XML message.&lt;br/&gt;
Of cource using different prefixes for same namespaces is not a good practice, but when there is a need to &quot;talk&quot; with external vendor software (as in my situation) there might be no chance to fix it on second side.&lt;/p&gt;

&lt;p&gt;I have this already fixed.&lt;br/&gt;
Will apply patch in few moments.&lt;/p&gt;

&lt;p&gt;Greetings,&lt;br/&gt;
Piotr Klimczak&lt;/p&gt;</description>
                <environment>&lt;p&gt;FuseESB 4.4.1-07-11 on SLES&lt;/p&gt;</environment>
        <key id="12638855">CXF-4920</key>
            <summary>TransformationInInterceptor fails when XML contains same namespace with different prefixes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ay">Akitoshi Yoshida</assignee>
                                    <reporter username="nannou9">Piotr Klimczak</reporter>
                        <labels>
                            <label>core</label>
                            <label>failed</label>
                            <label>interceptors</label>
                            <label>missing</label>
                            <label>namespace</label>
                            <label>prefix</label>
                            <label>transform</label>
                    </labels>
                <created>Mon, 25 Mar 2013 11:06:54 +0000</created>
                <updated>Tue, 9 Apr 2013 15:15:46 +0000</updated>
                            <resolved>Wed, 27 Mar 2013 22:40:11 +0000</resolved>
                                    <version>2.3</version>
                    <version>2.4</version>
                    <version>2.5</version>
                    <version>2.6</version>
                    <version>2.7.3</version>
                    <version>3.0.0-milestone1</version>
                                    <fixVersion>2.7.4</fixVersion>
                    <fixVersion>2.6.7</fixVersion>
                    <fixVersion>2.5.10</fixVersion>
                    <fixVersion>3.0.0-milestone1</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13612550" author="nannou9" created="Mon, 25 Mar 2013 11:10:22 +0000"  >&lt;p&gt;Passed test on core:&lt;br/&gt;
Results :&lt;/p&gt;

&lt;p&gt;Tests run: 270, Failures: 0, Errors: 0, Skipped: 1&lt;/p&gt;

&lt;p&gt;As well as on whole CXF project- all compiles and successfully passes tests.&lt;/p&gt;</comment>
                            <comment id="13612557" author="nannou9" created="Mon, 25 Mar 2013 11:23:46 +0000"  >&lt;p&gt;The patch was made for trunk and 2.7 version.&lt;br/&gt;
On 2.6.x and older it will fail.&lt;/p&gt;

&lt;p&gt;If anybody will request then i can create a patch for 2.6.x, 2.5.x versions.&lt;/p&gt;

&lt;p&gt;Greetings&lt;br/&gt;
Piotr Klimczak&lt;/p&gt;</comment>
                            <comment id="13612568" author="nannou9" created="Mon, 25 Mar 2013 12:04:38 +0000"  >&lt;p&gt;Patch for latest 2.6.x version&lt;/p&gt;</comment>
                            <comment id="13612573" author="nannou9" created="Mon, 25 Mar 2013 12:05:47 +0000"  >&lt;p&gt;Patch for latest 2.5.x version&lt;/p&gt;</comment>
                            <comment id="13613725" author="nannou9" created="Tue, 26 Mar 2013 12:15:57 +0000"  >&lt;p&gt;Hi Aki!&lt;/p&gt;

&lt;p&gt;Thanks for taking this issue.&lt;br/&gt;
If you have any questions to the patches or anything else I will do my best to answer ASAP.&lt;/p&gt;

&lt;p&gt;Please note that this bug is a blocker for my project.&lt;/p&gt;

&lt;p&gt;Greetings,&lt;br/&gt;
Piotr Klimczak&lt;br/&gt;
&lt;a href=&quot;http://reintegrate.pl&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://reintegrate.pl&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="13613780" author="ay" created="Tue, 26 Mar 2013 13:35:11 +0000"  >&lt;p&gt;Hi Piotr,&lt;br/&gt;
there is a test case for preserving the original prefixes which is working. And I now wrote another test case that looks like yours:&lt;br/&gt;
input xml&lt;br/&gt;
&amp;lt;a:foo xmlns:a=&quot;urn:abc&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&amp;gt;&lt;br/&gt;
  &amp;lt;wireTransfer xmlns:q1=&quot;http://bar.com/foo&quot; xsi:type=&quot;q1:SwiftWireTransfer&quot;&amp;gt;10&amp;lt;/wireTransfer&amp;gt;&lt;br/&gt;
  &amp;lt;wireTransfer xmlns:q2=&quot;http://bar.com/foo&quot; xsi:type=&quot;q2:SwiftWireTransfer&quot;&amp;gt;20&amp;lt;/wireTransfer&amp;gt;&lt;br/&gt;
&amp;lt;/a:foo&amp;gt;&lt;br/&gt;
with transform option&lt;br/&gt;
transformElements.put(&quot;&lt;/p&gt;
{urn:abc}
&lt;p&gt;*&quot;,&lt;br/&gt;
                      &quot;&lt;/p&gt;
{urn:a}
&lt;p&gt;*&quot;);&lt;/p&gt;

&lt;p&gt;and get the result xml&lt;br/&gt;
&amp;lt;a:foo xmlns:a=&quot;urn:a&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&amp;gt;&lt;br/&gt;
  &amp;lt;wireTransfer xmlns:q1=&quot;http://bar.com/foo&quot; xsi:type=&quot;q1:SwiftWireTransfer&quot;&amp;gt;10&amp;lt;/wireTransfer&amp;gt;&lt;br/&gt;
  &amp;lt;wireTransfer xmlns:q2=&quot;http://bar.com/foo&quot; xsi:type=&quot;q2:SwiftWireTransfer&quot;&amp;gt;20&amp;lt;/wireTransfer&amp;gt;&lt;br/&gt;
&amp;lt;/a:foo&amp;gt;&lt;/p&gt;

&lt;p&gt;And I am not observing the problem you mentioned. Could you attach the test input file, the transformer option, and the expected result xml so that I can see the issue?&lt;/p&gt;

&lt;p&gt;thanks.&lt;br/&gt;
regards, aki&lt;/p&gt;</comment>
                            <comment id="13614058" author="nannou9" created="Tue, 26 Mar 2013 14:28:59 +0000"  >&lt;p&gt;Hi Aki,&lt;/p&gt;

&lt;p&gt;Thanks for your answer.&lt;br/&gt;
What is the name of that test? I would like to take a look at it.&lt;/p&gt;

&lt;p&gt;I know that it sounds crazy when i&apos;m saying that i found such a bug that exists from the very beginning of CXF 2.X (or meybe even 1.X). The exact situation is quite difficult to reproduce as i&apos;ve hitted this bug using CXF to handle WebServices over HTTP with this interceptors:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;WS Security Signature + timestamp&lt;/li&gt;
	&lt;li&gt;LoggingInInterceptor&lt;/li&gt;
	&lt;li&gt;TransformInInterceptors (transforming namespaces)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Similar interceptors are used for OUT.&lt;/p&gt;

&lt;p&gt;Using WS Security altogether with TransformIn/OutInterceptor was very difficult to get it work as default position for in/out interceptors in interceptor chain makes them unusable.&lt;/p&gt;

&lt;p&gt;So finally in such a complicated configuration i&apos;ve hitted this bug.&lt;br/&gt;
I have found it in CXF code doing tracing and debuging.&lt;br/&gt;
I was not able to reproduce this situation in any unit test that covers hughe part of code (basing on existing unit test). Also the real life situation was too dificult to be reproduced in unit test. But as I remember the exception was raised with some kind of unknown prefix exception.&lt;br/&gt;
The only way to reproduce this bug in a test case was to test the very small piece of code.&lt;/p&gt;

&lt;p&gt;Those patches have solved my problems but i need them to be official.&lt;/p&gt;


&lt;p&gt;But let&apos;s go back to your test.&lt;br/&gt;
In your example you are transforming different namespace that the one making problems.&lt;br/&gt;
Try to transform &quot;http://bar.com/foo&quot; to anyhing else. Then it should fail.&lt;/p&gt;

&lt;p&gt;I know that testcases are saying everything is ok, but if you take a look at the code and analyze it, you will see there is a bug in cache strategy.&lt;/p&gt;

&lt;p&gt;Cache is using this two maps:&lt;br/&gt;
NAMESPACES: prefix as key, ns as a value =&amp;gt; MAPPING PREFIXES TO NAMESPACES&lt;br/&gt;
PREFIXES: ns as a key, prefix as a value =&amp;gt; MAPPING NAMESPACES TO PREFIXES&lt;/p&gt;

&lt;p&gt;The problem is with mapping namespaces to prefixes.&lt;br/&gt;
When it find in XML shuch part: q1=&quot;http://bar.com/foo&quot; then it adds to cache maps:&lt;br/&gt;
NAMESPACES:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;q1 =&amp;gt;http:&lt;span class=&quot;code-comment&quot;&gt;//bar.com/foo&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;PREFIXES: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;http:&lt;span class=&quot;code-comment&quot;&gt;//bar.com/foo =&amp;gt; q1&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So when it hits: q2=&quot;http://bar.com/foo&quot;, then it adds:&lt;br/&gt;
NAMESPACES:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;q2 =&amp;gt; http:&lt;span class=&quot;code-comment&quot;&gt;//bar.com/foo&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;PREFIXES: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;http:&lt;span class=&quot;code-comment&quot;&gt;//bar.com/foo =&amp;gt; q2&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So after second prefix with same name, NAMESPACES contains 2 elements but PREFIXES cache contains only one element with the key q2. So the q1 prefix is forgotten in PREFIXES when it is known in NAMESPACES.&lt;/p&gt;

&lt;p&gt;This situation is unexpected and it is solved in my patches.&lt;/p&gt;

&lt;p&gt;Greetings&lt;br/&gt;
Piotr Klimczak &lt;/p&gt;</comment>
                            <comment id="13614078" author="nannou9" created="Tue, 26 Mar 2013 14:47:39 +0000"  >&lt;p&gt;Sorry for making few edits to the above comment but i&apos;m doing few other things in parallel.&lt;br/&gt;
The above comment is finished.&lt;/p&gt;</comment>
                            <comment id="13614085" author="ay" created="Tue, 26 Mar 2013 14:58:07 +0000"  >&lt;p&gt;Hi Piotr,&lt;br/&gt;
thanks.&lt;br/&gt;
I can now see the problem.&lt;br/&gt;
regards, aki&lt;/p&gt;</comment>
                            <comment id="13614130" author="nannou9" created="Tue, 26 Mar 2013 15:34:39 +0000"  >&lt;p&gt;No problem &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I&apos;m always happy to be helpful &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Greetings,&lt;br/&gt;
Piotr Klimczak&lt;/p&gt;</comment>
                            <comment id="13615054" author="ay" created="Wed, 27 Mar 2013 09:17:09 +0000"  >&lt;p&gt;Hi Piotr,&lt;br/&gt;
I added a stricter namespace binding check that made this problem visible.&lt;br/&gt;
I also added your DelegatingNamespaceContext&apos;s test case. But I fixed the problem differently as other changes were needed in InTransformReader to make all the existing tests work with this stricter namespace binding check.&lt;/p&gt;

&lt;p&gt;The change is in trunk and 2.7.x. I will be integrating it to the lower versions later.&lt;br/&gt;
If you could test it for your case, that would be great.&lt;/p&gt;

&lt;p&gt;regards, aki&lt;/p&gt;</comment>
                            <comment id="13615259" author="nannou9" created="Wed, 27 Mar 2013 13:40:24 +0000"  >&lt;p&gt;Thanks Aki for your effort.&lt;/p&gt;

&lt;p&gt;It will take me some time to test it in real life, but as I see it should be ok becauese the main reason of my problem has been removed.&lt;/p&gt;

&lt;p&gt;I have seen your changes and I have noticed that PREFIXES map can be removed at all.&lt;br/&gt;
Just remove prefixes from here: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!prefixes.isEmpty()) {
            Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; cache = prefixes.getFirst();
            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; pfs : prefixes) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and replace them by entrySet on namespaces.&lt;/p&gt;

&lt;p&gt;Greetings&lt;br/&gt;
Piotr Klimczak&lt;/p&gt;</comment>
                            <comment id="13615857" author="ay" created="Wed, 27 Mar 2013 22:39:42 +0000"  >&lt;p&gt;Hi Piotr,&lt;/p&gt;

&lt;p&gt;I am not sure what you mean by your comment on the &quot;prefixes&quot; code fragment.&lt;br/&gt;
Both prefixes and namespaces are used along with their cache entry (corresponding to the current level entry) to perform the two frequently used operations getNamespaceURI(String prefix) and getPrefix(String uri) efficiently. Basically, when a particular prefix or uri is looked up at some level, if it doesn&apos;t find the binding in that level, it goes up the level until it finds one and then caches it at the current level so that the subsequent lookup can find the binding in that level.&lt;/p&gt;

&lt;p&gt;regards, aki&lt;br/&gt;
p.s. in any way, the fix is now all the way down to 2.5.x. Thanks again for spotting this.&lt;/p&gt;</comment>
                            <comment id="13616103" author="nannou9" created="Thu, 28 Mar 2013 06:43:27 +0000"  >&lt;p&gt;Hi Aki,&lt;/p&gt;

&lt;p&gt;Thanks again for solving this problem.&lt;br/&gt;
Hope that my patches ware at least a little helpful.&lt;/p&gt;

&lt;p&gt;Greetings,&lt;br/&gt;
Piotr Klimczak&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12575307" name="CXF4920-v2.5.X.diff" size="7068" author="nannou9" created="Mon, 25 Mar 2013 12:05:47 +0000"/>
                            <attachment id="12575306" name="CXF4920-v2.6.X.diff" size="7008" author="nannou9" created="Mon, 25 Mar 2013 12:04:38 +0000"/>
                            <attachment id="12575304" name="CXF4920.diff" size="5280" author="nannou9" created="Mon, 25 Mar 2013 11:10:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>319325</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 34 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1j3jb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>319666</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>