<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:51:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-4130] Server using Provider implementation writes contents of SOAP body in SOAP header</title>
                <link>https://issues.apache.org/jira/browse/CXF-4130</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;When using a server using a Provider implementation in conjunction with a WSDL that defines a SOAP header as part of its output, the contents out the SOAP body will be written as a SOAP header depending on the order of the parts defined in the output message.&lt;/p&gt;

&lt;p&gt;For example if an output message is defined like this:&lt;/p&gt;

&lt;p&gt;	&amp;lt;message name=&quot;FooResponse&quot;&amp;gt;&lt;br/&gt;
		&amp;lt;part name=&quot;FooResponseHeader&quot; element=&quot;tns:FooResponseHeader&quot;/&amp;gt;&lt;br/&gt;
		&amp;lt;part name=&quot;FooResponse&quot; element=&quot;tns:FooResponse&quot;/&amp;gt;&lt;br/&gt;
	&amp;lt;/message&amp;gt;&lt;/p&gt;

&lt;p&gt;and the SOAP binding operation is defined like this:&lt;/p&gt;

&lt;p&gt;		&amp;lt;operation name=&quot;Foo&quot;&amp;gt;&lt;br/&gt;
			&amp;lt;soap:operation/&amp;gt;&lt;br/&gt;
			&amp;lt;input&amp;gt;&lt;br/&gt;
				&amp;lt;soap:header message=&quot;tns:FooRequest&quot; part=&quot;FooRequestHeader&quot; use=&quot;literal&quot;/&amp;gt;&lt;br/&gt;
				&amp;lt;soap:body parts=&quot;FooRequest&quot; use=&quot;literal&quot;/&amp;gt;&lt;br/&gt;
			&amp;lt;/input&amp;gt;&lt;br/&gt;
			&amp;lt;output&amp;gt;&lt;br/&gt;
				&amp;lt;soap:header message=&quot;tns:FooResponse&quot; part=&quot;FooResponseHeader&quot; use=&quot;literal&quot;/&amp;gt;&lt;br/&gt;
				&amp;lt;soap:body use=&quot;literal&quot;/&amp;gt;&lt;br/&gt;
			&amp;lt;/output&amp;gt;&lt;br/&gt;
		&amp;lt;/operation&amp;gt;&lt;/p&gt;

&lt;p&gt;because the FooResponseHeader is defined as the first part in the output message, CXF writes out the following message:&lt;/p&gt;


&lt;p&gt;&amp;lt;SOAP-ENV:Envelope xmlns:SOAP-ENV=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&amp;gt;&lt;br/&gt;
  &amp;lt;SOAP-ENV:Header&amp;gt;&lt;br/&gt;
    &amp;lt;FooResponseHeader xmlns:ns2=&quot;http://cxf.apache.org/soapheader/inband&quot;&amp;gt;FooResponseHeader&amp;lt;/FooResponseHeader&amp;gt;&lt;br/&gt;
    &amp;lt;ns2:FooResponse xmlns:ns2=&quot;http://cxf.apache.org/soapheader/inband&quot;&amp;gt;&lt;br/&gt;
      &amp;lt;ns2:Return&amp;gt;Foo Response Body&amp;lt;/ns2:Return&amp;gt;&lt;br/&gt;
    &amp;lt;/ns2:FooResponse&amp;gt;&amp;lt;/SOAP-ENV:Header&amp;gt;&lt;br/&gt;
  &amp;lt;SOAP-ENV:Body/&amp;gt;&lt;br/&gt;
&amp;lt;/SOAP-ENV:Envelope&amp;gt;&lt;/p&gt;

&lt;p&gt;The basic reason for this is that the SoapOutInterceptor uses the part index of the part defining the output header to look up the instance of that part in the MessageContentList contained in the Message. However, in the Provider use case, the MessageModeOutInterceptorInternal interceptor puts the contents of the SOAP body into the first slot of the MessageContentList. So in the case where the index of the SOAP header part is 0, the contents of the SOAP body get written out as a SOAP header.&lt;/p&gt;

&lt;p&gt;Additional details are available as part of the CXF developers mailing list here: &lt;a href=&quot;http://cxf.547215.n5.nabble.com/Response-SOAP-Headers-with-Provider-implementation-td5485785.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cxf.547215.n5.nabble.com/Response-SOAP-Headers-with-Provider-implementation-td5485785.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;A possible solution to this problem is to place the contents of the SOAP body in the appropriate location in the MessageContentList in MessageModeOutInterceptorInternal. This solution would look something like this:&lt;/p&gt;

&lt;p&gt;MessageModeOutInterceptorInternal.handleMessage() &lt;/p&gt;

&lt;p&gt;            list.remove(0); &lt;br/&gt;
            DocumentFragment frag = soapMessage.getSOAPPart().createDocumentFragment(); &lt;br/&gt;
            try { &lt;br/&gt;
                Node body = soapMessage.getSOAPBody(); &lt;br/&gt;
                Node nd = body.getFirstChild(); &lt;br/&gt;
                while (nd != null) &lt;/p&gt;
{ 
                    body.removeChild(nd); 
                    frag.appendChild(nd); 
                    nd = soapMessage.getSOAPBody().getFirstChild(); 
                }
&lt;p&gt; &lt;/p&gt;

&lt;p&gt;                int index = 0; &lt;/p&gt;

&lt;p&gt;                Exchange exchange = message.getExchange(); &lt;br/&gt;
                BindingOperationInfo operation = (BindingOperationInfo)exchange.get(BindingOperationInfo.class &lt;br/&gt;
                    .getName()); &lt;/p&gt;

&lt;p&gt;                List&amp;lt;MessagePartInfo&amp;gt; parts = null; &lt;br/&gt;
                BindingMessageInfo bmsg = null; &lt;br/&gt;
                boolean client = isRequestor(message); &lt;/p&gt;

&lt;p&gt;                if (!client) { &lt;br/&gt;
                    if (operation.getOutput() != null) &lt;/p&gt;
{ 
                        bmsg = operation.getOutput(); 
                        parts = bmsg.getMessageParts(); 
                    }
&lt;p&gt; &lt;br/&gt;
                } else &lt;/p&gt;
{ 
                    bmsg = operation.getInput(); 
                    parts = bmsg.getMessageParts(); 
                }
&lt;p&gt;   &lt;/p&gt;

&lt;p&gt;                if (parts != null &amp;amp;&amp;amp; parts.size() &amp;gt; 0) &lt;/p&gt;
{ 
                index = parts.get(0).getIndex(); 
                }
&lt;p&gt;       &lt;/p&gt;

&lt;p&gt;                list.set(index, frag);&lt;/p&gt;</description>
                <environment></environment>
        <key id="12543730">CXF-4130</key>
            <summary>Server using Provider implementation writes contents of SOAP body in SOAP header</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dkulp">Daniel Kulp</assignee>
                                    <reporter username="seumas.soltysik">Seumas Soltysik</reporter>
                        <labels>
                    </labels>
                <created>Wed, 22 Feb 2012 18:51:43 +0000</created>
                <updated>Mon, 23 Apr 2012 16:45:17 +0000</updated>
                            <resolved>Fri, 2 Mar 2012 21:14:06 +0000</resolved>
                                    <version>2.5.2</version>
                                    <fixVersion>2.3.10</fixVersion>
                    <fixVersion>2.4.7</fixVersion>
                    <fixVersion>2.5.3</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13213863" author="seumas.soltysik" created="Wed, 22 Feb 2012 19:06:59 +0000"  >&lt;p&gt;Patch includes system testcase which demonstrates the issue.&lt;/p&gt;

&lt;p&gt;Suggestion of fix is included in the issue description but is not part of the patch.&lt;/p&gt;</comment>
                            <comment id="13220298" author="seumas.soltysik" created="Thu, 1 Mar 2012 19:52:40 +0000"  >&lt;p&gt;Any further thoughts/progress on this jira? We have a customer who would like this as part of a patch in the next couple of weeks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12515631" name="cxf4130.patch" size="13202" author="seumas.soltysik" created="Wed, 22 Feb 2012 19:06:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10062"><![CDATA[Moderate]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>228969</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 38 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0b7vb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>63387</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>