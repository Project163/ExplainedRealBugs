<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:09:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-5679] WS-S after upgrade fails with org.apache.ws.security.WSSecurityException: The signature or decryption was invalid</title>
                <link>https://issues.apache.org/jira/browse/CXF-5679</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;After upgrading CXF from version 2.7.5 to 2.7.9 or higher, we experienced this issue. Worked well with 2.7.5 and earlier.&lt;/p&gt;

&lt;p&gt;Request (our business data stripped and replaced with dummy ns1):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&amp;lt;soapenv:Envelope &lt;span class=&quot;code-keyword&quot;&gt;xmlns:ns1&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://example/soap&quot;&lt;/span&gt;
	&lt;span class=&quot;code-keyword&quot;&gt;xmlns:soapenv&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&lt;/span&gt;&amp;gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;soapenv:Header&amp;gt;&lt;/span&gt;
		&amp;lt;wsse:Security soapenv:mustUnderstand=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;
			&lt;span class=&quot;code-keyword&quot;&gt;xmlns:wsse&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd&quot;&lt;/span&gt;
			&lt;span class=&quot;code-keyword&quot;&gt;xmlns:wsu&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot;&lt;/span&gt;&amp;gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;ds:Signature Id=&lt;span class=&quot;code-quote&quot;&gt;&quot;SIG-33&quot;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;xmlns:ds&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2000/09/xmldsig#&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;ds:SignedInfo&amp;gt;&lt;/span&gt;
					&amp;lt;ds:CanonicalizationMethod
						Algorithm=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;&lt;/span&gt;&amp;gt;
						&amp;lt;ec:InclusiveNamespaces PrefixList=&lt;span class=&quot;code-quote&quot;&gt;&quot;ns1 soapenv&quot;&lt;/span&gt;
							&lt;span class=&quot;code-keyword&quot;&gt;xmlns:ec&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;&lt;/span&gt; /&amp;gt;
					&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/ds:CanonicalizationMethod&amp;gt;&lt;/span&gt;
					&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;ds:SignatureMethod Algorithm=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2000/09/xmldsig#rsa-sha1&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
					&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;ds:Reference URI=&lt;span class=&quot;code-quote&quot;&gt;&quot;#id-22&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
						&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;ds:Transforms&amp;gt;&lt;/span&gt;
							&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;ds:Transform Algorithm=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
								&amp;lt;ec:InclusiveNamespaces PrefixList=&lt;span class=&quot;code-quote&quot;&gt;&quot;ns1&quot;&lt;/span&gt;
									&lt;span class=&quot;code-keyword&quot;&gt;xmlns:ec&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;&lt;/span&gt; /&amp;gt;
							&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/ds:Transform&amp;gt;&lt;/span&gt;
						&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/ds:Transforms&amp;gt;&lt;/span&gt;
						&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;ds:DigestMethod Algorithm=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2000/09/xmldsig#sha1&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
						&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;ds:DigestValue&amp;gt;&lt;/span&gt;VF0g31FSsHWpdMN7lGVgQA1li4c=&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/ds:DigestValue&amp;gt;&lt;/span&gt;
					&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/ds:Reference&amp;gt;&lt;/span&gt;
					&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;ds:Reference URI=&lt;span class=&quot;code-quote&quot;&gt;&quot;#TS-32&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
						&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;ds:Transforms&amp;gt;&lt;/span&gt;
							&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;ds:Transform Algorithm=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
								&amp;lt;ec:InclusiveNamespaces PrefixList=&lt;span class=&quot;code-quote&quot;&gt;&quot;wsse ns1 soapenv&quot;&lt;/span&gt;
									&lt;span class=&quot;code-keyword&quot;&gt;xmlns:ec&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;&lt;/span&gt; /&amp;gt;
							&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/ds:Transform&amp;gt;&lt;/span&gt;
						&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/ds:Transforms&amp;gt;&lt;/span&gt;
						&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;ds:DigestMethod Algorithm=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2000/09/xmldsig#sha1&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
						&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;ds:DigestValue&amp;gt;&lt;/span&gt;4yW2ssYnI+QB40HBdWexy80+GNo=&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/ds:DigestValue&amp;gt;&lt;/span&gt;
					&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/ds:Reference&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/ds:SignedInfo&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;ds:SignatureValue&amp;gt;&lt;/span&gt;QGIDsbR//zUyjUD36LtkiMJsIiT1vYionG8Y0blqif2QKrMB2AHnr9KXiYy7MbcdMaTVxn6gmKGN
					7bRjE6MX1VVf9ZPem5SfasHYQ6wS7l/I1NGUyGw227cv1AceDPje05Wjk5vmN9G1dKvbfECJhBLA
					7/OBAxJI+TYmYe94cu8=&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/ds:SignatureValue&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;ds:KeyInfo Id=&lt;span class=&quot;code-quote&quot;&gt;&quot;KI-6788C4A756C88F8773139703929455550&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
					&amp;lt;wsse:SecurityTokenReference
						wsu:Id=&lt;span class=&quot;code-quote&quot;&gt;&quot;STR-6788C4A756C88F8773139703929455551&quot;&lt;/span&gt;&amp;gt;
						&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;ds:X509Data&amp;gt;&lt;/span&gt;
							&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;ds:X509IssuerSerial&amp;gt;&lt;/span&gt;
								&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;ds:X509IssuerName&amp;gt;&lt;/span&gt;CN=clientuser&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/ds:X509IssuerName&amp;gt;&lt;/span&gt;
								&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;ds:X509SerialNumber&amp;gt;&lt;/span&gt;1288174342&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/ds:X509SerialNumber&amp;gt;&lt;/span&gt;
							&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/ds:X509IssuerSerial&amp;gt;&lt;/span&gt;
						&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/ds:X509Data&amp;gt;&lt;/span&gt;
					&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/wsse:SecurityTokenReference&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/ds:KeyInfo&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/ds:Signature&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;wsu:Timestamp wsu:Id=&lt;span class=&quot;code-quote&quot;&gt;&quot;TS-32&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;wsu:Created&amp;gt;&lt;/span&gt;2014-04-09T10:28:14.554Z&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/wsu:Created&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;wsu:Expires&amp;gt;&lt;/span&gt;2014-04-09T10:33:14.554Z&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/wsu:Expires&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/wsu:Timestamp&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/wsse:Security&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/soapenv:Header&amp;gt;&lt;/span&gt;
	&amp;lt;soapenv:Body wsu:Id=&lt;span class=&quot;code-quote&quot;&gt;&quot;id-22&quot;&lt;/span&gt;
		&lt;span class=&quot;code-keyword&quot;&gt;xmlns:wsu&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot;&lt;/span&gt;&amp;gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;ns1:hello&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/ns1:hello&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/soapenv:Body&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/soapenv:Envelope&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Response:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;soap:Envelope &lt;span class=&quot;code-keyword&quot;&gt;xmlns:soap&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;soap:Body&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;soap:Fault&amp;gt;&lt;/span&gt;
			&amp;lt;faultcode
				&lt;span class=&quot;code-keyword&quot;&gt;xmlns:ns1&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd&quot;&lt;/span&gt;&amp;gt;ns1:FailedCheck&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/faultcode&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;faultstring&amp;gt;&lt;/span&gt;The signature or decryption was invalid&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/faultstring&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/soap:Fault&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/soap:Body&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/soap:Envelope&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Log:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;o.a.c.w.s.wss4j.WSS4JInInterceptor - org.apache.ws.security.WSSecurityException: The signature or decryption was invalid
o.a.c.w.s.wss4j.WSS4JInInterceptor - #011at org.apache.ws.security.processor.SignatureProcessor.handleToken(SignatureProcessor.java:19

o.a.c.w.s.wss4j.WSS4JInInterceptor - #011at org.apache.ws.security.WSSecurityEngine.processSecurityHeader(WSSecurityEngine.java:396)
o.a.c.w.s.wss4j.WSS4JInInterceptor - #011at org.apache.cxf.ws.security.wss4j.WSS4JInInterceptor.handleMessage(WSS4JInInterceptor.java:

o.a.c.w.s.wss4j.WSS4JInInterceptor - #011at org.apache.cxf.ws.security.wss4j.WSS4JInInterceptor.handleMessage(WSS4JInInterceptor.java:

o.a.c.w.s.wss4j.WSS4JInInterceptor - #011at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:272)
o.a.c.w.s.wss4j.WSS4JInInterceptor - #011at org.apache.cxf.transport.ChainInitiationObserver.onMessage(ChainInitiationObserver.java:12

o.a.c.w.s.wss4j.WSS4JInInterceptor - #011at org.apache.cxf.transport.http.AbstractHTTPDestination.invoke(AbstractHTTPDestination.java:

o.a.c.w.s.wss4j.WSS4JInInterceptor - #011at org.apache.cxf.transport.servlet.ServletController.invokeDestination(ServletController.jav

o.a.c.w.s.wss4j.WSS4JInInterceptor - #011at org.apache.cxf.transport.servlet.ServletController.invoke(ServletController.java:222)
o.a.c.w.s.wss4j.WSS4JInInterceptor - #011at org.apache.cxf.transport.servlet.ServletController.invoke(ServletController.java:153)
o.a.c.w.s.wss4j.WSS4JInInterceptor - #011at org.apache.cxf.transport.servlet.CXFNonSpringServlet.invoke(CXFNonSpringServlet.java:167)
o.a.c.w.s.wss4j.WSS4JInInterceptor - #011at org.apache.cxf.transport.servlet.AbstractHTTPServlet.handleRequest(AbstractHTTPServlet.jav

o.a.c.w.s.wss4j.WSS4JInInterceptor - #011at org.apache.cxf.transport.servlet.AbstractHTTPServlet.doPost(AbstractHTTPServlet.java:206)
o.a.c.w.s.wss4j.WSS4JInInterceptor - #011at javax.servlet.http.HttpServlet.service(HttpServlet.java:641)
o.a.c.w.s.wss4j.WSS4JInInterceptor - #011at org.apache.cxf.transport.servlet.AbstractHTTPServlet.service(AbstractHTTPServlet.java:262)
o.a.c.w.s.wss4j.WSS4JInInterceptor - #011at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.ja

o.a.c.w.s.wss4j.WSS4JInInterceptor - #011at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12707398">CXF-5679</key>
            <summary>WS-S after upgrade fails with org.apache.ws.security.WSSecurityException: The signature or decryption was invalid</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="coheigea">Colm O hEigeartaigh</assignee>
                                    <reporter username="ondrusekj">J&#225;n Ondru&#353;ek</reporter>
                        <labels>
                            <label>security</label>
                    </labels>
                <created>Wed, 9 Apr 2014 10:30:17 +0000</created>
                <updated>Tue, 9 Dec 2014 12:26:13 +0000</updated>
                            <resolved>Mon, 5 May 2014 17:18:40 +0000</resolved>
                                    <version>2.7.9</version>
                    <version>2.7.10</version>
                                    <fixVersion>3.0</fixVersion>
                    <fixVersion>2.7.12</fixVersion>
                                    <component>WS-* Components</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13964428" author="coheigea" created="Wed, 9 Apr 2014 17:32:38 +0000"  >
&lt;p&gt;How are you configuring your client + service, is it via a WS-SecurityPolicy or by specifying &quot;actions&quot;? Could you attach whatever configuration you are using here? Also, if you could attach the debug server log, as this will tell me where signature validation is failing.&lt;/p&gt;

&lt;p&gt;Colm.&lt;/p&gt;</comment>
                            <comment id="13965084" author="ondrusekj" created="Thu, 10 Apr 2014 07:22:47 +0000"  >&lt;p&gt;WS-S DEBUG log&lt;/p&gt;</comment>
                            <comment id="13965085" author="ondrusekj" created="Thu, 10 Apr 2014 07:23:14 +0000"  >&lt;p&gt;We use in out interceptors + Spring to configure CXF:&lt;/p&gt;

&lt;p&gt;web.xml&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;servlet&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;servlet-name&amp;gt;&lt;/span&gt;cxf&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/servlet-name&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;servlet-class&amp;gt;&lt;/span&gt;org.apache.cxf.transport.servlet.CXFServlet&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/servlet-class&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;load-on-startup&amp;gt;&lt;/span&gt;1&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/load-on-startup&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/servlet&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;cxf-servlet.xml&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;jaxws:endpoint id=&lt;span class=&quot;code-quote&quot;&gt;&quot;cxfEndpoint&quot;&lt;/span&gt; address=&lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt; implementor=&lt;span class=&quot;code-quote&quot;&gt;&quot;#endpoint&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;jaxws:outInterceptors&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;ref bean=&lt;span class=&quot;code-quote&quot;&gt;&quot;outgoingSecurityInterceptor&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/jaxws:outInterceptors&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;jaxws:inInterceptors&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;ref bean=&lt;span class=&quot;code-quote&quot;&gt;&quot;cryptoCoverageChecker&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;ref bean=&lt;span class=&quot;code-quote&quot;&gt;&quot;incomingSecurityInterceptor&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/jaxws:inInterceptors&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/jaxws:endpoint&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Spring JavaConfig:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; KEYSTORE_SERVICE_NAME = &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.ws.security.crypto.merlin.keystore.alias&quot;&lt;/span&gt;;
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; KEYSTORE_SERVICE_PASSWORD = &lt;span class=&quot;code-quote&quot;&gt;&quot;keystore.service.password&quot;&lt;/span&gt;;
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; KEYSTORE_PROPERTIES = &lt;span class=&quot;code-quote&quot;&gt;&quot;keystoreProperties&quot;&lt;/span&gt;;

	&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; CoverageType TYPE_SIGNED = CryptoCoverageUtil.CoverageType.SIGNED;
	&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; CoverageScope SCOOPED_ELEMENT = CryptoCoverageUtil.CoverageScope.ELEMENT;

	&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; X_PATH_BODY_VERIFIER = &lt;span class=&quot;code-quote&quot;&gt;&quot;/soap:Envelope/soap:Body&quot;&lt;/span&gt;;
	&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; X_PATH_TIMESTAMP_VERIFIER = &lt;span class=&quot;code-quote&quot;&gt;&quot;/soap:Envelope/soap:Header/wsse:Security/wsu:Timestamp&quot;&lt;/span&gt;;

	@Bean
	@Qualifier(KEYSTORE_PROPERTIES)
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Properties getProperties() {
		&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; PropertiesLoaderUtils.loadProperties(...);
	}

	@Bean
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Interceptor&amp;lt;SoapMessage&amp;gt; cryptoCoverageChecker() {
		Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; prefixes = Maps.newHashMap();
		prefixes.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;soap&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//schemas.xmlsoap.org/soap/envelope/&quot;&lt;/span&gt;);
&lt;/span&gt;		prefixes.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;wsse&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd&quot;&lt;/span&gt;);
&lt;/span&gt;		prefixes.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;wsu&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot;&lt;/span&gt;);
&lt;/span&gt;
		List&amp;lt;XPathExpression&amp;gt; xPaths = Lists.newArrayList();
		xPaths.add(bodyVerifier());
		xPaths.add(timestampVerifier());

		&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CryptoCoverageChecker(prefixes, xPaths);
	}

	@Bean
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; CryptoCoverageChecker.XPathExpression bodyVerifier() {
		&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CryptoCoverageChecker.XPathExpression(X_PATH_BODY_VERIFIER, TYPE_SIGNED, SCOOPED_ELEMENT);
	}

	@Bean
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; CryptoCoverageChecker.XPathExpression timestampVerifier() {
		&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CryptoCoverageChecker.XPathExpression(X_PATH_TIMESTAMP_VERIFIER, TYPE_SIGNED, SCOOPED_ELEMENT);
	}

	@Bean
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Interceptor&amp;lt;SoapMessage&amp;gt; incomingSecurityInterceptor() {
		Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; properties = Maps.newHashMap();
		properties.putAll(getCommonWSSProperties());
		&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; WSS4JInInterceptor(properties);
	}

	@Bean
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Interceptor&amp;lt;SoapMessage&amp;gt; outgoingSecurityInterceptor() {
		Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; properties = Maps.newHashMap();
		properties.put(WSHandlerConstants.USER, getKeystoreProperty(KEYSTORE_SERVICE_NAME));
		properties.put(WSHandlerConstants.ENCRYPTION_USER, &lt;span class=&quot;code-quote&quot;&gt;&quot;useReqSigCert&quot;&lt;/span&gt;);
		properties.putAll(getCommonWSSProperties());
		properties.put(
				WSHandlerConstants.SIGNATURE_PARTS,
				&lt;span class=&quot;code-quote&quot;&gt;&quot;{Element}{http:&lt;span class=&quot;code-comment&quot;&gt;//schemas.xmlsoap.org/soap/envelope/}Body;{Element}{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd}Timestamp&quot;&lt;/span&gt;);
&lt;/span&gt;		&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; WSS4JOutInterceptor(properties);
	}

	@Bean
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; ServiceKeystorePasswordCallback passwordCallback() {
		Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; credentials = Maps.newHashMap();
		credentials.put(getKeystoreProperty(KEYSTORE_SERVICE_NAME), getKeystoreProperty(KEYSTORE_SERVICE_PASSWORD));
		CredentialsHolder credentialsHolder = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CredentialsHolder(credentials);
		&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ServiceKeystorePasswordCallback(credentialsHolder);
	}

	&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getKeystoreProperty(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; key) {
		&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; getProperties().getProperty(key);
	}

	&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; getCommonWSSProperties() {
		Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; properties = Maps.newHashMap();
		properties.put(WSHandlerConstants.ACTION, WSHandlerConstants.TIMESTAMP + &lt;span class=&quot;code-quote&quot;&gt;&quot; &quot;&lt;/span&gt; + WSHandlerConstants.SIGNATURE);
		properties.put(WSHandlerConstants.SIG_PROP_REF_ID, KEYSTORE_PROPERTIES);
		properties.put(WSHandlerConstants.ENC_PROP_REF_ID, KEYSTORE_PROPERTIES);
		properties.put(KEYSTORE_PROPERTIES, getProperties());
		properties.put(WSHandlerConstants.PW_CALLBACK_REF, passwordCallback());
		properties.put(WSHandlerConstants.ENABLE_SIGNATURE_CONFIRMATION, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;);
		&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; properties;
	}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;DEBUG log file:&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;Unable to embed resource: log.txt of type text/plain&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="13967086" author="coheigea" created="Fri, 11 Apr 2014 20:53:42 +0000"  >
&lt;p&gt;Could you review your logging setup - there is no WSS4J debug logs in the attached file? Is your client also CXF (and if so which version? Finally, would it be possible to create a test-case to reproduce the problem?&lt;/p&gt;

&lt;p&gt;Colm.&lt;/p&gt;</comment>
                            <comment id="13983541" author="julian" created="Mon, 28 Apr 2014 21:08:55 +0000"  >&lt;p&gt;This is reproducible by running a request from SoapUI 5 against the ws_security/sign_enc example server.&lt;br/&gt;
Bisect says it was introduced in commit eb70d100 for &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-5527&quot; title=&quot;SAAJ API&amp;#39;s can corrupt messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-5527&quot;&gt;&lt;del&gt;CXF-5527&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13984248" author="coheigea" created="Tue, 29 Apr 2014 12:41:23 +0000"  >
&lt;p&gt;Ok problem confirmed, thanks for the test-case. The problem appears to be that the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-5527&quot; title=&quot;SAAJ API&amp;#39;s can corrupt messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-5527&quot;&gt;&lt;del&gt;CXF-5527&lt;/del&gt;&lt;/a&gt; is removing the newline before the closing SOAP Body tag, and hence signature validation is failing. I will ping Dan on fixing this. In the meantime, you can get your SOAP UI testcase to pass by simply deleting the whitespace between the closing greetMe + Body tags, e.g. &quot;&amp;lt;/typ:greetMe&amp;gt;&amp;lt;/soapenv:Body&amp;gt;&quot;.&lt;/p&gt;

&lt;p&gt;Colm.&lt;/p&gt;</comment>
                            <comment id="13986043" author="ay" created="Wed, 30 Apr 2014 20:37:26 +0000"  >&lt;p&gt;I think StaxUtils.copy using SAAJStreamWriter loses the initial and trailing whitespace/newline info, which is, in contrast, preserved when using StaxUtils.readDocElements.&lt;/p&gt;

&lt;p&gt;I&apos;m attaching a simpler unit test (ParseBodyTest) for trunk to show this issue.&lt;/p&gt;</comment>
                            <comment id="13986083" author="ay" created="Wed, 30 Apr 2014 21:06:40 +0000"  >&lt;p&gt;an updated file to show the initial/trailing whitespace cases that i meant.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12760429">CXF-6144</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12711818">CXF-5724</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12642724" name="ParseBodyTest.java" size="3309" author="ay" created="Wed, 30 Apr 2014 21:06:40 +0000"/>
                            <attachment id="12642323" name="bad-request-formatted.xml" size="3977" author="julian" created="Mon, 28 Apr 2014 21:08:55 +0000"/>
                            <attachment id="12642319" name="bad-run.txt" size="81574" author="julian" created="Mon, 28 Apr 2014 21:08:55 +0000"/>
                            <attachment id="12642321" name="example-test.diff" size="4845" author="julian" created="Mon, 28 Apr 2014 21:08:55 +0000"/>
                            <attachment id="12642322" name="good-request-formatted.xml" size="4225" author="julian" created="Mon, 28 Apr 2014 21:08:55 +0000"/>
                            <attachment id="12639544" name="log.txt" size="29032" author="ondrusekj" created="Thu, 10 Apr 2014 07:22:47 +0000"/>
                            <attachment id="12642320" name="test-soapui-project.xml" size="13032" author="julian" created="Mon, 28 Apr 2014 21:08:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>385721</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 29 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ug5z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>385985</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>