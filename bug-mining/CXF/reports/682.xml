<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:43:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-3004] Inconsistent HTTP response code 202 returned for WS-RM piggybacked Ack response message</title>
                <link>https://issues.apache.org/jira/browse/CXF-3004</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;I originally posted this issue on cxf-dev mailing list in last june.&lt;br/&gt;
&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/cxf-dev/201006.mbox/%3CAANLkTikVG6ULDcj9gkrnfGcks90S5zVcYDrZ79sKxI9G@mail.gmail.com%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://mail-archives.apache.org/mod_mbox/cxf-dev/201006.mbox/%3CAANLkTikVG6ULDcj9gkrnfGcks90S5zVcYDrZ79sKxI9G@mail.gmail.com%3E&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I didn&apos;t see any response and unfortunately, I also forgot to follow up on this problem. The problem is present in the recently released 2.2.10. I observed this problem in 2.2.9, 2.2.10, 2.2.11-SNAPSHOT, and 2.3.0-SNAPSHOT.&lt;/p&gt;

&lt;p&gt;The problem description and possible solutions to fix this issue are given below.&lt;/p&gt;

&lt;p&gt;Problem&lt;br/&gt;
When oneway call is received at the server and gets rebased, its response message is marked as a partial response. The response code of this partial response message is automatically set to 202. &lt;/p&gt;

&lt;p&gt;This behavior of the CXF implementation causes interoperability problems for a WS-RM scenario with a non-addressable client (i.e., the&lt;br/&gt;
client that needs to receive WS-RM acknowledgement messages in the piggybacked HTTP 200 response). As the response code 202 indicates no&lt;br/&gt;
presence of a valid SOAP envelope, WS-RM acknowledgement messages are not correctly processed at those client implementations that follow this rule. &lt;/p&gt;

&lt;p&gt;I think there are several approaches in fixing this issue. One option is to revert the status code to 200 in RMSoapInterceptor when the response message must be filled with the relevant WS-RM properties. I tested this option with 2.2.9, 2.2.10, and 2.2.11-SNAPSHOT, and it works fine.&lt;/p&gt;

&lt;p&gt;Concretely, I modified RMSoapInterceptor to revert the http response code to 200 when the rm header is filled with the relevant rm properties. &lt;/p&gt;

&lt;p&gt;In particular, I added the following lines in the encode method of  org.apache.cxf.ws.rm.soap.RMSoapInterceptor&lt;/p&gt;

&lt;p&gt;              }&lt;br/&gt;
              Node node = hdr.getFirstChild();&lt;br/&gt;
+             if (node != null &amp;amp;&amp;amp; MessageUtils.isPartialResponse(message)) &lt;/p&gt;
{
+                 // make sure the ack response is returned as HTTP 200 and not 202
+ //              message.put(Message.PARTIAL_RESPONSE_MESSAGE, null);
+                 message.put(Message.RESPONSE_CODE, HttpURLConnection.HTTP_OK);
+             }
&lt;p&gt;              while (node != null) {&lt;br/&gt;
                  Header holder = new Header(new QName(node.getNamespaceURI(), node.getLocalName()), node);&lt;br/&gt;
                  header.add(holder);&lt;/p&gt;

&lt;p&gt;For 2.3.0-SNAPSHOT, however, this change alone does not solve the problem because  org.apache.cxf.transport.http.AbstractHTTPDestination always&lt;br/&gt;
overwrites the http response code for the partial response message in its updateResponeHeaders method. &lt;/p&gt;

&lt;p&gt;So, in order to avoid this overwriting, I needed to comment out this part  shown below in the updateResponseHeader shown below.&lt;/p&gt;

&lt;p&gt;      protected void updateResponseHeaders(Message message) {&lt;br/&gt;
!         // setting the response to 202 here breaks the ws-rm piggybacked ack response&lt;br/&gt;
! //        if (MessageUtils.isPartialResponse(message)) &lt;/p&gt;
{
! //            message.put(Message.RESPONSE_CODE, HttpURLConnection.HTTP_ACCEPTED);
! //        }
&lt;p&gt;          Map&amp;lt;String, List&amp;lt;String&amp;gt;&amp;gt; responseHeaders =&lt;br/&gt;
              CastUtils.cast((Map)message.get(Message.PROTOCOL_HEADERS));&lt;br/&gt;
          if (responseHeaders == null) {&lt;/p&gt;

&lt;p&gt;Alternatively, we could remove the partial response flag of this response message at RMSoapInterceptor so that the updateResponseHeaders method would not overwrite the response status. However, this interferes with another part of the AbstractHTTPDestination class and this approach will require additional changes in this class. However, it was not clear to me what exactly the semantic definition of the partial response message should be in the context of the WS-RM protocol. So I did not pursue this approach.&lt;/p&gt;

&lt;p&gt;Best Regards, &lt;br/&gt;
Aki&lt;/p&gt;</description>
                <environment></environment>
        <key id="12474602">CXF-3004</key>
            <summary>Inconsistent HTTP response code 202 returned for WS-RM piggybacked Ack response message</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dkulp">Daniel Kulp</assignee>
                                    <reporter username="ay">Akitoshi Yoshida</reporter>
                        <labels>
                    </labels>
                <created>Mon, 20 Sep 2010 15:14:22 +0000</created>
                <updated>Mon, 11 Oct 2010 14:46:17 +0000</updated>
                            <resolved>Thu, 30 Sep 2010 21:12:44 +0000</resolved>
                                    <version>2.2.9</version>
                    <version>2.2.10</version>
                                    <fixVersion>2.3</fixVersion>
                    <fixVersion>2.2.11</fixVersion>
                                    <component>WS-* Components</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12912562" author="ay" created="Mon, 20 Sep 2010 16:19:43 +0000"  >&lt;p&gt;as my code fragment text in the above description was garbled,&lt;br/&gt;
attaching the diffs and the modified java files for 2.2.x and 2.3.x for better references.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12455051" name="cxf-3004-fixes.zip" size="19679" author="ay" created="Mon, 20 Sep 2010 16:19:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>47196</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 10 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i13ybj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>231190</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>