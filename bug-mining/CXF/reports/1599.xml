<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:57:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-4741] Different conduits are used when configuring stub and sending actual message</title>
                <link>https://issues.apache.org/jira/browse/CXF-4741</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;I was trying to set TLS context as described here: &lt;a href=&quot;http://cxf.apache.org/docs/client-http-transport-including-ssl-support.html#ClientHTTPTransport%28includingSSLsupport%29-HowtoconfiguretheHTTPConduitfortheSOAPClient%3F&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;How to configure the HTTPConduit for the SOAP Client?&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;However it doesn&apos;t work in CXF 2.6.2 and 2.6.4 while it worked perfectly fine in 2.5.3&lt;/p&gt;

&lt;p&gt;When looking into the code (line numbers are for version 2.6.4) I discovered that during this configuration a new message is created and passed to conduit selector (in this case UpfrontConduitSelector) - ClientImpl.getConduit():846.&lt;/p&gt;

&lt;p&gt;New conduit is created, assigned to message and returned.&lt;/p&gt;

&lt;p&gt;However when I do an actual call, I get to ClientImpl.doInvoke():486 where another message is created. Later on prepare() is called on conduit selector at ClientImpl.prepareConduitSelector():850 but the message is different so another conduit is created.&lt;/p&gt;

&lt;p&gt;This results in my conduit config being disregarded and I&apos;m getting SSLHandshakeException&lt;/p&gt;</description>
                <environment></environment>
        <key id="12626745">CXF-4741</key>
            <summary>Different conduits are used when configuring stub and sending actual message</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="gnatyuk">Yaroslav Gnatyuk</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Jan 2013 11:15:22 +0000</created>
                <updated>Thu, 30 Mar 2017 18:57:32 +0000</updated>
                                            <version>2.6.2</version>
                    <version>2.6.4</version>
                                                    <component>Transports</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13548407" author="gnatyuk" created="Wed, 9 Jan 2013 11:29:37 +0000"  >&lt;p&gt;In version 2.5.3 AbstractConduitSelector stored previously created conduit in selectedConduit field which was removed in 2.6&lt;/p&gt;</comment>
                            <comment id="13548545" author="dkulp" created="Wed, 9 Jan 2013 14:45:45 +0000"  >
&lt;p&gt;The actual message used should be irrelevant, it should depend on the URL.   Is the URL different between the first call into the AbstractConduitSelector then the second call?    That&apos;s important cause if the URL is different, we do have to create a new conduit so we can reconfigure it based on config settings for the new URL.&lt;/p&gt;

&lt;p&gt;Can you create a testcase?&lt;/p&gt;</comment>
                            <comment id="13548558" author="gnatyuk" created="Wed, 9 Jan 2013 15:06:53 +0000"  >&lt;p&gt;You&apos;re right, I&apos;m trying to debug it right now to see the exact content of conduits collection. Basically what I&apos;m doing is I have already generated SOAP client (by means of cxf-codegen-plugin) and the URL in WSDL differs from the one I&apos;m actually calling. So for each call I&apos;m getting a port and configuring its conduit with URL, read timeout, connection timeout and TLS&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        Client client = ClientProxy.getClient(port);
        client.getRequestContext().put(Message.ENDPOINT_ADDRESS, endpointUrl);

        HTTPClientPolicy httpClientPolicy = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HTTPClientPolicy();
        httpClientPolicy.setConnectionTimeout(connectionTimeout);
        httpClientPolicy.setReceiveTimeout(readTimeout);

        HTTPConduit http = (HTTPConduit) client.getConduit();
        http.setClient(httpClientPolicy);

        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            &lt;span class=&quot;code-object&quot;&gt;char&lt;/span&gt;[] password = keyStorePassword.toCharArray();

            KeyStore keyStore = KeyStore.getInstance(keyStoreType);
            keyStore.load(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ClassPathResource(keyStoreLocation).getInputStream(), password);

            KeyManagerFactory factory = KeyManagerFactory.getInstance(KeyManagerFactory.getDefaultAlgorithm());
            factory.init(keyStore, password);

            TLSClientParameters params = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TLSClientParameters();
            params.setKeyManagers(factory.getKeyManagers());
            http.setTlsClientParameters(params);
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RuntimeException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Cannot build key managers&quot;&lt;/span&gt;, e);
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But looks like when I&apos;m actually doing a call it uses different conduit in ClientImpl.doInvoke()&lt;/p&gt;</comment>
                            <comment id="13548580" author="gnatyuk" created="Wed, 9 Jan 2013 15:39:13 +0000"  >&lt;p&gt;I think I found it, when debugging AbstractConduitSelector.findCompatibleConduit() I discovered that address comparison is done incorrectly. If full comparison is switched off (which is the default case) it does the following:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!full) {
                &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; idx = conduitAddress.indexOf(&lt;span class=&quot;code-quote&quot;&gt;&apos;:&apos;&lt;/span&gt;);
                conduitAddress = idx == -1 ? &quot;&quot; : conduitAddress.substring(0, idx);
                idx = actualAddress.indexOf(&lt;span class=&quot;code-quote&quot;&gt;&apos;:&apos;&lt;/span&gt;);
                actualAddress = idx == -1 ? &quot;&quot; : actualAddress.substring(0, idx);
            }
            
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (conduitAddress.equalsIgnoreCase(actualAddress)) {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; c2;
            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So effectively only address protocols are compared. I guess the intention was quite the opposite that is to compare addresses without protocols. Can you confirm please?&lt;/p&gt;</comment>
                            <comment id="13548585" author="dkulp" created="Wed, 9 Jan 2013 15:43:32 +0000"  >&lt;p&gt;&lt;br/&gt;
No, that is correct.   If the protocol changes from &quot;http&quot; to &quot;https&quot;, we need to create a new conduit to make sure we get one that would have the https stuff configured.  More importantly, if we flip from &quot;http&quot; to &quot;jms&quot; or similar, we REALLY have to recreate everything. &lt;/p&gt;</comment>
                            <comment id="13548589" author="dkulp" created="Wed, 9 Jan 2013 15:44:56 +0000"  >&lt;p&gt;&lt;br/&gt;
Most likely, when the very first Message is created, we should be filling in the information from the request context so if you call the &quot;.put(Message.ENDPOINT_ADDRESS, endpointUrl);&quot; before getting the conduit, the conduit you receive would already have used that address for consideration in the selection process.&lt;/p&gt;</comment>
                            <comment id="13548619" author="gnatyuk" created="Wed, 9 Jan 2013 16:09:03 +0000"  >&lt;p&gt;Yes, that&apos;s what I did to fix it in my code&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        client.getBus().setProperty( AbstractConduitSelector.CONDUIT_COMPARE_FULL_URL, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; );
        http.getTarget().getAddress().setValue( endpointUrl );
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But I can&apos;t understand the logic in findCompatibleConduit(). Let&apos;s say I&apos;m using same client but send data to different endpoints. I have &lt;a href=&quot;https://endpoint1.com&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://endpoint1.com&lt;/a&gt; and &lt;a href=&quot;https://endpoint2.com&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://endpoint2.com&lt;/a&gt; and each one has it&apos;s own TLS config. However if AbstractConduitSelector.CONDUIT_COMPARE_FULL_URL is not set or set to false, and I already configured it for endpoint1 my conduit might be reused for endpoint2 because both have same https scheme.&lt;/p&gt;

&lt;p&gt;That&apos;s why I set AbstractConduitSelector.CONDUIT_COMPARE_FULL_URL to true in my code so that whole address gets compared&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>303362</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 45 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i17apb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>250702</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>