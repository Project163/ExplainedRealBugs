<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:38:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-8597] CXF JAXRS client not closing HTTP connections</title>
                <link>https://issues.apache.org/jira/browse/CXF-8597</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;After upgrading from cxf-3.3.4 to 3.4.3 we noticed large numbers of HTTP connections remaining in CLOSE_WAIT state, originating from JAXRS proxy clients - unfortunately in production first.&lt;br/&gt;
 The open sockets lead to a total blockage of the system as file handles eventually are exhausted and no further addtional connections can be opened. At this point we see tens of thousands connections in CLOSE_WAIT.&lt;/p&gt;

&lt;p&gt;During our investigation we spotted a substantial refactoring in&#160;&lt;a href=&quot;https://github.com/apache/cxf/blob/75fb6bb56d82f72771a9ee6ecab5d36168303f51/rt/frontend/jaxrs/src/main/java/org/apache/cxf/jaxrs/impl/ResponseImpl.java#L424&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/blob/75fb6bb56d82f72771a9ee6ecab5d36168303f51/rt/frontend/jaxrs/src/main/java/org/apache/cxf/jaxrs/impl/ResponseImpl.java#L424&lt;/a&gt;&#160;which seems to cause the issue (parameter &quot;closeAfterRead&quot; being always false).&lt;/p&gt;

&lt;p&gt;Please refer to the attached reproducer project which demonstrates the issue - the underlying HttpUrlConnection never being closed in cxf-3.4.3/3.4.4. By changing the build.gradle.kts of the reproducer to use cxf-3.3.4 the included test case is working.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;If possible please advise a workaround. Our initial attempts to get &quot;behind&quot; ResponseImpl#doReadEntity via the client interceptor chain were unsuccessful.&lt;/p&gt;

&lt;p&gt;For the time being production operators are forcibly removing CLOSE_WAIT connections by OS means (&quot;&lt;tt&gt;ss --tcp state CLOSE-WAIT &apos;( dport = &amp;lt;api-gateway-port&amp;gt; )&apos; --kill&lt;/tt&gt;&quot;)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;CXF 3.4.3/3.4.4&lt;/p&gt;

&lt;p&gt;OpenJDK 11.11&lt;/p&gt;</environment>
        <key id="13401237">CXF-8597</key>
            <summary>CXF JAXRS client not closing HTTP connections</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="reta">Andriy Redko</assignee>
                                    <reporter username="lkoe">Lars K&#246;dderitzsch</reporter>
                        <labels>
                    </labels>
                <created>Wed, 15 Sep 2021 06:17:01 +0000</created>
                <updated>Wed, 22 Dec 2021 20:41:43 +0000</updated>
                            <resolved>Tue, 28 Sep 2021 17:36:10 +0000</resolved>
                                    <version>3.4.3</version>
                    <version>3.4.4</version>
                                    <fixVersion>3.5.0</fixVersion>
                    <fixVersion>3.4.5</fixVersion>
                                    <component>JAX-RS</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17415825" author="reta" created="Thu, 16 Sep 2021 01:25:59 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lkoe&quot; class=&quot;user-hover&quot; rel=&quot;lkoe&quot;&gt;lkoe&lt;/a&gt; , thank you for reporting the issue, it will be looked into shortly. As I workaround, may you please try 3.4.0, the commit in question (if is a culprit) was introduced in later releases. Thank you.&lt;/p&gt;</comment>
                            <comment id="17419527" author="reta" created="Fri, 24 Sep 2021 02:34:30 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lkoe&quot; class=&quot;user-hover&quot; rel=&quot;lkoe&quot;&gt;lkoe&lt;/a&gt;, the fix should be available in latest 3.4.5-SNAPSHOT, could you give it a try please? Thank you!&lt;/p&gt;</comment>
                            <comment id="17422006" author="lkoe" created="Wed, 29 Sep 2021 08:24:50 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reta&quot; class=&quot;user-hover&quot; rel=&quot;reta&quot;&gt;reta&lt;/a&gt;, thanks for the fix and sorry for the confirmation delay.&lt;br/&gt;
 I did some limited testing with 3.4.5-SNAPSHOT and could not produce CLOSE_WAIT connections anymore, looking good :thumbsup&lt;/p&gt;</comment>
                            <comment id="17422008" author="lkoe" created="Wed, 29 Sep 2021 08:28:42 +0000"  >&lt;p&gt;Is there an ETA on 3.4.5 release (asking for our own release planning)?&lt;/p&gt;</comment>
                            <comment id="17422104" author="reta" created="Wed, 29 Sep 2021 13:02:51 +0000"  >&lt;p&gt;Thanks a lot for confirming, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lkoe&quot; class=&quot;user-hover&quot; rel=&quot;lkoe&quot;&gt;lkoe&lt;/a&gt; , the ETA for 3.4.5 is this week, coincidentally &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13403689">CXF-8601</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13033524" name="cxf-jaxrs-connection-close.zip" size="60980" author="lkoe" created="Wed, 15 Sep 2021 06:15:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 6 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0uxmo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>