<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:32:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-7874] JAX-RS SSE Leaking SSESink (s)</title>
                <link>https://issues.apache.org/jira/browse/CXF-7874</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;Closing of SSE connection by client is not detected and handled on the server part.&lt;br/&gt;
This results in server leaking resources when it is the clients responsibility for deciding on the lifetime of SSE connection.&lt;/p&gt;

&lt;p&gt;My particular scenario is:&lt;br/&gt;
Status notifications for devices manged by the server are sent to the client (browser), this is a continues stream. That stream lives until browser tab/window is closed, which results in client closing the underlying SSE connection.&lt;br/&gt;
SseSinkImpl is not informed of connection being closed. &lt;br/&gt;
At the same time the exception set in  org.apache.cxf.jaxrs.sse.SseEventSinkImpl#dequeue &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt;.completeExceptionally(ex);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; in case of channel being closed is not acted upon internally within SseSinkImpl.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Observed on karaf (jetty).&lt;br/&gt;
Reproduced on jetty by modifying cxf SSE tests.&lt;/p&gt;</environment>
        <key id="13191209">CXF-7874</key>
            <summary>JAX-RS SSE Leaking SSESink (s)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="reta">Andriy Redko</assignee>
                                    <reporter username="LWysocki">Lukasz Wysocki</reporter>
                        <labels>
                    </labels>
                <created>Fri, 12 Oct 2018 14:16:47 +0000</created>
                <updated>Tue, 30 Oct 2018 10:06:02 +0000</updated>
                            <resolved>Wed, 17 Oct 2018 16:44:20 +0000</resolved>
                                    <version>3.2.6</version>
                                    <fixVersion>3.2.7</fixVersion>
                    <fixVersion>3.3.0</fixVersion>
                                    <component>JAX-RS</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16647965" author="lwysocki" created="Fri, 12 Oct 2018 14:29:26 +0000"  >&lt;p&gt;the cxf-7874.reproduce.patch that is attached modifies:&lt;br/&gt;
systests/rs-sse/rs-sse-base/src/main/java/org/apache/cxf/systest/jaxrs/sse/AbstractSseTest.java&lt;br/&gt;
systests/rs-sse/rs-sse-base/src/main/java/org/apache/cxf/systest/jaxrs/sse/BookStore.java&lt;/p&gt;

&lt;p&gt;that reproduces the problem. Note that this is not a test, it&apos;s my experimentation code, reproducing the problem.&lt;br/&gt;
The effect is that when running the jetty based tests rs-sse-jetty produces in the log:&lt;br/&gt;
...&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; 2018-10-12 16:22:36.259 o.a.cxf.systest.jaxrs.sse.BookStore - [] Sent 1&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; 2018-10-12 16:22:39.263 o.a.cxf.systest.jaxrs.sse.BookStore - [] Sent 2&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; 2018-10-12 16:22:40.264 o.a.cxf.systest.jaxrs.sse.BookStore - [] Sent 3&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; 2018-10-12 16:22:40.268 o.a.cxf.systest.jaxrs.sse.BookStore - [] 3 Sink isClosed?: false Got an exception org.eclipse.jetty.io.EofException&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; 2018-10-12 16:22:41.265 o.a.cxf.systest.jaxrs.sse.BookStore - [] 4 Sink isClosed?: false Got an exception org.eclipse.jetty.io.EofException: Closed&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; 2018-10-12 16:22:41.265 o.a.cxf.systest.jaxrs.sse.BookStore - [] Sent 4&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; 2018-10-12 16:22:42.267 o.a.cxf.systest.jaxrs.sse.BookStore - [] 5 Sink isClosed?: false Got an exception org.eclipse.jetty.io.EofException: Closed&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; 2018-10-12 16:22:42.267 o.a.cxf.systest.jaxrs.sse.BookStore - [] Sent 5&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; 2018-10-12 16:22:47.269 o.a.cxf.systest.jaxrs.sse.BookStore - [] 6 Sink isClosed?: false Got an exception org.eclipse.jetty.io.EofException: Closed&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; 2018-10-12 16:22:47.270 o.a.cxf.systest.jaxrs.sse.BookStore - [] Sent 6&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; 2018-10-12 16:22:47.270 o.a.cxf.systest.jaxrs.sse.BookStore - [] Close sink&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; 2018-10-12 16:22:47.270 o.a.cxf.systest.jaxrs.sse.BookStore - [] got onClose callback&lt;br/&gt;
...&lt;/p&gt;

&lt;p&gt;Which matched to the patched code of BookStore.java shows that:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;No callback on SseSinkImpl when client closes the channel,&lt;/li&gt;
	&lt;li&gt;that SseSink is open (isClosed=false), even dough client end is closed and we get repeted EofException for each send&lt;/li&gt;
	&lt;li&gt;that SseBrodcaster also is not infored of Sink being closed&lt;/li&gt;
	&lt;li&gt;and finally that sink is closed and removed from broadcaster only after server side sseSink.close() call&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;hence mentioned leakage of SseSinks in case where it is the client that is managing the lifetime of sse connection.&lt;/p&gt;</comment>
                            <comment id="16649643" author="reta" created="Mon, 15 Oct 2018 02:06:46 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=LWysocki&quot; class=&quot;user-hover&quot; rel=&quot;LWysocki&quot;&gt;LWysocki&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thanks for this bug report. Indeed, the sink is not being moved off to closed state. It is notoriously difficult to detect the client disconnect conditions (on server side), which additionally varies from one servlet container to another. I think I have found the acceptable solution (basically relying on IOException), I should have a fix ready in the next few days. I am wondering if you would be able to help by giving it a try in your application? Thank you.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16649836" author="lwysocki" created="Mon, 15 Oct 2018 07:26:16 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reta&quot; class=&quot;user-hover&quot; rel=&quot;reta&quot;&gt;reta&lt;/a&gt;, Thanks for looking at this one.&lt;br/&gt;
Of course, I&apos;ll give it a spin -  no problem.&lt;/p&gt;</comment>
                            <comment id="16651475" author="coheigea" created="Tue, 16 Oct 2018 10:43:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reta&quot; class=&quot;user-hover&quot; rel=&quot;reta&quot;&gt;reta&lt;/a&gt; Is this still targetted for CXF 3.2.7? We want to call a vote imminently...&lt;/p&gt;</comment>
                            <comment id="16651614" author="reta" created="Tue, 16 Oct 2018 12:42:20 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=coheigea&quot; class=&quot;user-hover&quot; rel=&quot;coheigea&quot;&gt;coheigea&lt;/a&gt;, I need a few days to wrap it up, the fix is ready, I am testing it extensively, turned out to be tricky. Could we hold on with the vote till Thu/Fri please? (would be good to get this fix in). Thanks.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16651626" author="coheigea" created="Tue, 16 Oct 2018 12:52:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reta&quot; class=&quot;user-hover&quot; rel=&quot;reta&quot;&gt;reta&lt;/a&gt; Yes no problem, thanks!&lt;/p&gt;</comment>
                            <comment id="16652884" author="reta" created="Wed, 17 Oct 2018 02:58:32 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=LWysocki&quot; class=&quot;user-hover&quot; rel=&quot;LWysocki&quot;&gt;LWysocki&lt;/a&gt;, just commit the change (&lt;a href=&quot;https://github.com/apache/cxf/commit/829fbc63033eb64bc3aa5847b3717fff75ba05ea)&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/commit/829fbc63033eb64bc3aa5847b3717fff75ba05ea&lt;/a&gt;), this is for 3.2.x-fixes branch (3.2.7-SNAPSHOT). The code got significantly more complex but sinks should not be leaking. If you could give it a spin, would appreciated your feedback.Thank you.&lt;/p&gt;</comment>
                            <comment id="16653201" author="coheigea" created="Wed, 17 Oct 2018 08:47:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reta&quot; class=&quot;user-hover&quot; rel=&quot;reta&quot;&gt;reta&lt;/a&gt; Should it be merged to master as well?&lt;/p&gt;</comment>
                            <comment id="16653334" author="reta" created="Wed, 17 Oct 2018 10:31:28 +0000"  >&lt;p&gt;Yes, absolutely, just pushed into master, thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=coheigea&quot; class=&quot;user-hover&quot; rel=&quot;coheigea&quot;&gt;coheigea&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="16653341" author="lwysocki" created="Wed, 17 Oct 2018 10:37:10 +0000"  >&lt;p&gt;On it. &lt;br/&gt;
Might take some time as there are some dependency changes in 3.2.7 which i need to resolve before getting a working distribution of the stuff I&apos;m working on.&lt;/p&gt;</comment>
                            <comment id="16653348" author="reta" created="Wed, 17 Oct 2018 10:42:34 +0000"  >&lt;p&gt;Thanks a lot, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=LWysocki&quot; class=&quot;user-hover&quot; rel=&quot;LWysocki&quot;&gt;LWysocki&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16653535" author="coheigea" created="Wed, 17 Oct 2018 13:20:47 +0000"  >&lt;p&gt;Can the Jira be resolved for now?&lt;/p&gt;</comment>
                            <comment id="16653544" author="reta" created="Wed, 17 Oct 2018 13:25:50 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=coheigea&quot; class=&quot;user-hover&quot; rel=&quot;coheigea&quot;&gt;coheigea&lt;/a&gt;, waiting for feedback from user, thanks!&lt;/p&gt;</comment>
                            <comment id="16653686" author="lwysocki" created="Wed, 17 Oct 2018 15:00:23 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reta&quot; class=&quot;user-hover&quot; rel=&quot;reta&quot;&gt;reta&lt;/a&gt;, it seems the workaround you&apos;ve implemented for !tomcat containers works (as tested in karaf/jetty).&lt;br/&gt;
The sink is removed from broadcaster and the onClose callback from broadcaster is also invoked.&lt;br/&gt;
As expected this happens with some delay (1 or 2 event sends later in my scenario).&lt;/p&gt;</comment>
                            <comment id="16653827" author="reta" created="Wed, 17 Oct 2018 16:44:12 +0000"  >&lt;p&gt;Awesome, thanks a lot &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=LWysocki&quot; class=&quot;user-hover&quot; rel=&quot;LWysocki&quot;&gt;LWysocki&lt;/a&gt;, really appreciate it. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=coheigea&quot; class=&quot;user-hover&quot; rel=&quot;coheigea&quot;&gt;coheigea&lt;/a&gt; we are good to go, thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12943653" name="cxf-7874.reproduce.patch" size="5418" author="LWysocki" created="Fri, 12 Oct 2018 14:18:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 4 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3z4tr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>