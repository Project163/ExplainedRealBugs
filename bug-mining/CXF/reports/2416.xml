<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:12:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-6101] Accept Header not Respected with Response from Custom MessageReader</title>
                <link>https://issues.apache.org/jira/browse/CXF-6101</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;I have created a custom MessageBodyReader class which implements the readFrom method and attempts to deserialize a JSON message using a specialized deserializer. If this fails for some reason, I am throwing a WebApplicationException with a Response build like this:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;Response.status(HttpStatus.BAD_REQUEST_400).entity(myCustomResponseObject).build()&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;On the incoming request there is an Accept header which is respected when processing proceeds normally, but this header is not respected if I throw an exception in the readFrom method (content type of the response is always &quot;text/xml&quot;). The problem seems to be in the &lt;tt&gt;JAXRSInInterceptor&lt;/tt&gt; class which creates a default message which does not have the exchange set on it, so when the createMessage method is invoked it is unable to find the correct content type so it will always default to &quot;text/xml&quot;. Contrast the way this method works with how the &lt;tt&gt;ServiceInvokerInterceptor&lt;/tt&gt; class creates a new message, it sets the exchange on the new message first before creating it.&lt;/p&gt;

&lt;p&gt;I realize I could set an explicit media type when creating the response but this seems to defeat the purpose of server side content negotiation. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12754940">CXF-6101</key>
            <summary>Accept Header not Respected with Response from Custom MessageReader</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sergey_beryozkin">Sergey Beryozkin</assignee>
                                    <reporter username="jjathman">Joseph Athman</reporter>
                        <labels>
                    </labels>
                <created>Thu, 13 Nov 2014 01:19:58 +0000</created>
                <updated>Mon, 16 Feb 2015 16:09:26 +0000</updated>
                            <resolved>Fri, 14 Nov 2014 11:41:21 +0000</resolved>
                                    <version>3.0.2</version>
                                    <fixVersion>3.0.3</fixVersion>
                    <fixVersion>3.1</fixVersion>
                                    <component>JAX-RS</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14209048" author="jjathman" created="Thu, 13 Nov 2014 01:20:19 +0000"  >&lt;p&gt;This seems like a bug to me, but if this is not a bug I&apos;d like to understand better what I&apos;m doing wrong.&lt;/p&gt;</comment>
                            <comment id="14209567" author="sergey_beryozkin" created="Thu, 13 Nov 2014 10:31:38 +0000"  >&lt;p&gt;Right it is known case. What if the client who expects say text/xml and the server responds 400 with a plain text ? Should the runtime fail because Accept is not matched even though a plain text response would be more typical for HTTP errors ? So the error responses are not routed via the intersection with Accept. But the fact it is picking up text/xml is a bug. it is coming from a default JAX-RS Binding by default, I&apos;ll fix it, the spec actually requires application/octet-stream in response Content-Type is not set &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="14211225" author="jjathman" created="Thu, 13 Nov 2014 20:08:20 +0000"  >&lt;p&gt;Thanks, this is helpful. I&apos;m still a little confused though. It just seems strange that in my application I could respect the accept header the client sent me and provide content back to them in the format which the client requested, but because CXF isn&apos;t doing that negotiation for me I have to attempt it myself or just hardcode a content type. What is the downside of allowing the automatic negotiation to happen? Sorry if this is obvious and I&apos;m not seeing it.&lt;/p&gt;</comment>
                            <comment id="14212150" author="sergey_beryozkin" created="Fri, 14 Nov 2014 11:28:38 +0000"  >&lt;p&gt;The automatic negotatiation happens when the resource method selection is done, when Accept is matched against @Produces. When a custom Response is created in the exception mapper, the runtime can not block error responses if their format (example, Response.status(500).type(&quot;text/plain&quot;).entity(&quot;Server error&quot;).build()) does not match what the client Accepts (application/json) because the client expectations are against the OK responses, the client must get the correct error status and the message no matter what. If the runtime did try to auto-negotiate at this point then it would return a misleading status hiding the original error. &lt;/p&gt;

&lt;p&gt;The exception mapper can get HttpHeaders contxt injected and get the most preferred Accept type and set a Response type accordingly.&lt;/p&gt;

&lt;p&gt;In your case it is slightly different, you have no CT set, but the runtime does not know what type the entity is of; arguably the runtime could&apos;ve auto-negotiated at this point - but the spec requires it to default to application/octet-stream if no CT has been set at this point.&lt;/p&gt;

&lt;p&gt;I&apos;d like to encourage you to ask at JAX-RS users list for more clarifications. To be honest I&apos;m not quite happy with a default application/octet-stream either, but auto-negotatiating in cases like yours can cause its own ambiguities, example, a user would report just Response.status(500).entity(&quot;Server error&quot;).build(); and the client would get in your case &quot;Content-Type: application/json&quot; followed by &quot;Server error&quot; which would obvioulsy confuse the client too when it will do Response.readEntity(MyJsonBean.class).&lt;/p&gt;

&lt;p&gt;Cheers, Sergey &lt;/p&gt;

</comment>
                            <comment id="14212172" author="sergey_beryozkin" created="Fri, 14 Nov 2014 11:39:22 +0000"  >&lt;p&gt;Updating the runtime to set a CT to application/octet-stream as opposed to text/xml if the response entity is available but no CT is set as per spec... &lt;/p&gt;</comment>
                            <comment id="14212174" author="sergey_beryozkin" created="Fri, 14 Nov 2014 11:41:21 +0000"  >&lt;p&gt;may be I should&apos;ve closed this issue as Invalid and opened another one related to defaulting to text/xml, but I&apos;ll close it as Fixed gievn that now application/octet-stream is set if no CT is available&lt;/p&gt;

&lt;p&gt;thanks&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 1 week, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i22b7j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>