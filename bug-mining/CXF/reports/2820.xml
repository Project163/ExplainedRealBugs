<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:20:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-6929] Request hangs when using JAX-RS AsyncResponse and Exception mapper</title>
                <link>https://issues.apache.org/jira/browse/CXF-6929</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;I have a JAX-RS resource which takes an AsyncResponse, but immediately throws an exception before returning from the function. If the exception is then mapped by an ExceptionMapper, the response seems to be never sent, and the request hangs (stays suspended forever). Am I doing something wrong?&lt;/p&gt;

&lt;p&gt;Example code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.ws.rs.GET;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.ws.rs.Path;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.ws.rs.Produces;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.ws.rs.container.AsyncResponse;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.ws.rs.container.Suspended;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.ws.rs.core.Response;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.ws.rs.ext.ExceptionMapper;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.lang.NotImplementedException;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.cxf.jaxrs.servlet.CXFNonSpringJaxrsServlet;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.eclipse.jetty.server.Connector;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.eclipse.jetty.server.Server;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.eclipse.jetty.server.ServerConnector;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.eclipse.jetty.servlet.ServletContextHandler;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.eclipse.jetty.servlet.ServletHolder;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ServerDemo2 {
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main( &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args ) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Server server = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Server();
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ServerConnector connector = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ServerConnector( server );
        connector.setHost( &lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt; );
        connector.setPort( 8888 );
        server.setConnectors( &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Connector[] { connector } );
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ServletContextHandler handler = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ServletContextHandler();
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ServletHolder holder = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ServletHolder( CXFNonSpringJaxrsServlet.class );
        holder.setInitParameter( &lt;span class=&quot;code-quote&quot;&gt;&quot;jaxrs.serviceClasses&quot;&lt;/span&gt;, Resource.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getName() );
        holder.setInitParameter( &lt;span class=&quot;code-quote&quot;&gt;&quot;jaxrs.providers&quot;&lt;/span&gt;, Mapper.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getName() );
        handler.addServlet( holder, &lt;span class=&quot;code-quote&quot;&gt;&quot;/*&quot;&lt;/span&gt; );
        server.setHandler( handler );
        server.start();

        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.in.read();

        server.stop();
    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Mapper &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; ExceptionMapper&amp;lt;NotImplementedException&amp;gt; {
        @Override
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Response toResponse( &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; NotImplementedException exception ) {
            exception.printStackTrace();
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; Response.ok().build();
        }
    }

    @Path( &lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt; )
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Resource {
        @GET
        @Path( &lt;span class=&quot;code-quote&quot;&gt;&quot;/foo&quot;&lt;/span&gt; )
        @Produces( &lt;span class=&quot;code-quote&quot;&gt;&quot;text/plain&quot;&lt;/span&gt; )
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void foo( @Suspended &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; AsyncResponse response ) {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NotImplementedException( &lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt; );
        }

        @GET
        @Path( &lt;span class=&quot;code-quote&quot;&gt;&quot;/bar&quot;&lt;/span&gt; )
        @Produces( &lt;span class=&quot;code-quote&quot;&gt;&quot;text/plain&quot;&lt;/span&gt; )
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void bar( @Suspended &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; AsyncResponse response ) {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RuntimeException( &lt;span class=&quot;code-quote&quot;&gt;&quot;bar&quot;&lt;/span&gt; );
        }
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;curl localhost:8888/foo hangs forever; curl localhost:8888/bar does not.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12975276">CXF-6929</key>
            <summary>Request hangs when using JAX-RS AsyncResponse and Exception mapper</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10004">Not A Bug</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="fdiebold">Florian Diebold</reporter>
                        <labels>
                    </labels>
                <created>Thu, 2 Jun 2016 19:37:52 +0000</created>
                <updated>Fri, 21 Oct 2016 18:50:09 +0000</updated>
                            <resolved>Mon, 20 Jun 2016 16:33:12 +0000</resolved>
                                    <version>3.1.1</version>
                    <version>3.1.6</version>
                                                    <component>JAX-RS</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15314255" author="sergey_beryozkin" created="Fri, 3 Jun 2016 15:07:15 +0000"  >&lt;p&gt;I&apos;ve added a couple of tests, all seems to work OK:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://git-wip-us.apache.org/repos/asf/cxf/commit/c0ad4d31&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://git-wip-us.apache.org/repos/asf/cxf/commit/c0ad4d31&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I wonder, should you enable an asyncSupported property somehow ?&lt;/p&gt;</comment>
                            <comment id="15314329" author="fdiebold" created="Fri, 3 Jun 2016 16:08:41 +0000"  >&lt;p&gt;I can setAsyncSupported(true) on the ServletHolder, but that doesn&apos;t change anything.&lt;/p&gt;</comment>
                            <comment id="15320772" author="sergey_beryozkin" created="Wed, 8 Jun 2016 15:43:49 +0000"  >&lt;p&gt;I haven&apos;t had time to look at it, but I guess you can try a more AsyncResponse friendly way to report the exception in meantime: asyncResponse.resume(new MyException());&lt;/p&gt;</comment>
                            <comment id="15320900" author="fdiebold" created="Wed, 8 Jun 2016 16:42:52 +0000"  >&lt;p&gt;Yes, that&apos;s my workaround. Adding a try/catch in every resource isn&apos;t very nice, though.&lt;/p&gt;</comment>
                            <comment id="15339614" author="sergey_beryozkin" created="Mon, 20 Jun 2016 14:43:33 +0000"  >&lt;p&gt;It appears you use an older version of Jetty, please remove the direct jetty dependencies and instead add: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.apache.cxf&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;cxf-rt-transports-http-jetty&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;3.1.7-SNAPSHOT&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and then rewrite your demo code as follows:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        org.eclipse.jetty.server.Server server = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; org.eclipse.jetty.server.Server(9000);
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ServletHolder servletHolder = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ServletHolder(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CXFNonSpringJaxrsServlet());
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ServletContextHandler context = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ServletContextHandler();      
        context.setContextPath(&lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;);
        context.addServlet(servletHolder, &lt;span class=&quot;code-quote&quot;&gt;&quot;/*&quot;&lt;/span&gt;);  
        
        servletHolder.setInitParameter( &lt;span class=&quot;code-quote&quot;&gt;&quot;jaxrs.serviceClasses&quot;&lt;/span&gt;, Resource.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getName() );
        servletHolder.setInitParameter( &lt;span class=&quot;code-quote&quot;&gt;&quot;jaxrs.providers&quot;&lt;/span&gt;, Mapper.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getName() );
                
        server.setHandler(context);
        server.start();
        server.join();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;?&lt;/p&gt;

&lt;p&gt;Works for me:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;curl localhost:9000/foo -v

* Hostname was NOT found in DNS cache
*   Trying 127.0.0.1...
* Connected to localhost (127.0.0.1) port 9000 (#0)
&amp;gt; GET /foo HTTP/1.1
&amp;gt; User-Agent: curl/7.35.0
&amp;gt; Host: localhost:9000
&amp;gt; Accept: */*
&amp;gt; 
&amp;lt; HTTP/1.1 200 OK
&amp;lt; Date: Mon, 20 Jun 2016 14:40:15 GMT
&amp;lt; Date: Mon, 20 Jun 2016 14:40:15 GMT
&amp;lt; Content-Length: 0
* Server Jetty(9.3.5.v20151012) is not blacklisted
&amp;lt; Server: Jetty(9.3.5.v20151012)
&amp;lt; 
* Connection #0 to host localhost left intact

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15339860" author="fdiebold" created="Mon, 20 Jun 2016 16:32:02 +0000"  >&lt;p&gt;Upgrading Jetty (to 9.3.9 in my case) indeed fixes the problem. Thanks! I should have thought of that myself.&lt;/p&gt;</comment>
                            <comment id="15340248" author="sergey_beryozkin" created="Mon, 20 Jun 2016 19:31:18 +0000"  >&lt;p&gt;Np, good it all works as expected&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 22 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ywqn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>