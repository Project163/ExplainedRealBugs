<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:38:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-2468] attribute namespace is missed in out message in  case of XmlBeans data binding</title>
                <link>https://issues.apache.org/jira/browse/CXF-2468</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;SCENARIO:&lt;/p&gt;

&lt;p&gt;The XmlBeans databinding is used.&lt;/p&gt;

&lt;p&gt;Trying to send a message with an input data like:&lt;/p&gt;

&lt;p&gt;&amp;lt;myOperation&lt;br/&gt;
        xmlns=&quot;http://sandbox.org/services/MyService/myOperation&quot;&lt;br/&gt;
        xmlns:s1=&quot;http://sandbox.org/datatypes/one&quot;&lt;br/&gt;
        xmlns:s2=&quot;http://sandbox.org/datatypes/two&quot;&lt;br/&gt;
        xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&amp;gt;&lt;br/&gt;
    &amp;lt;data&amp;gt;&lt;br/&gt;
        &amp;lt;s1:oneElement&amp;gt;&lt;br/&gt;
            &amp;lt;s2:twoElement xsi:nil=&quot;true&quot;/&amp;gt;&lt;br/&gt;
        &amp;lt;/s1:oneElement&amp;gt;&lt;br/&gt;
    &amp;lt;/data&amp;gt;&lt;br/&gt;
&amp;lt;/myOperation&amp;gt;&lt;/p&gt;


&lt;p&gt;ACTUAL RESULT:&lt;/p&gt;

&lt;p&gt;The out message is generated as follows:&lt;/p&gt;

&lt;p&gt;&amp;lt;soap:Envelope xmlns:soap=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&amp;gt;&lt;br/&gt;
&amp;lt;soap:Body&amp;gt;&lt;br/&gt;
    &amp;lt;myOperation xmlns=&quot;http://sandbox.org/services/MyService/myOperation&quot;&amp;gt;&lt;br/&gt;
        &amp;lt;data&amp;gt;&lt;br/&gt;
            &amp;lt;oneElement xmlns=&quot;http://sandbox.org/datatypes/one&quot;&amp;gt;&lt;br/&gt;
                &amp;lt;twoElement xmlns=&quot;http://sandbox.org/datatypes/two&quot; xsi:nil=&quot;true&quot;/&amp;gt;&lt;br/&gt;
            &amp;lt;/oneElement&amp;gt;&lt;br/&gt;
        &amp;lt;/data&amp;gt;&lt;br/&gt;
    &amp;lt;/myOperation&amp;gt;&lt;br/&gt;
&amp;lt;/soap:Body&amp;gt;&lt;br/&gt;
&amp;lt;/soap:Envelope&amp;gt;&lt;/p&gt;

&lt;p&gt;Namespace definition for &quot;xsi&quot; prefix is missed. And the receiver fails to process the message because of validation.&lt;/p&gt;


&lt;p&gt;EXPECTED RESULT:&lt;/p&gt;

&lt;p&gt;&amp;lt;soap:Envelope xmlns:soap=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&amp;gt;&lt;br/&gt;
&amp;lt;soap:Body&amp;gt;&lt;br/&gt;
    &amp;lt;myOperation xmlns=&quot;http://sandbox.org/services/MyService/myOperation&quot;&amp;gt;&lt;br/&gt;
        &amp;lt;data&amp;gt;&lt;br/&gt;
            &amp;lt;oneElement xmlns=&quot;http://sandbox.org/datatypes/one&quot;&amp;gt;&lt;br/&gt;
                &amp;lt;twoElement xmlns=&quot;http://sandbox.org/datatypes/two&quot; &lt;br/&gt;
                            xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; &lt;br/&gt;
                            xsi:nil=&quot;true&quot;/&amp;gt;&lt;br/&gt;
            &amp;lt;/oneElement&amp;gt;&lt;br/&gt;
        &amp;lt;/data&amp;gt;&lt;br/&gt;
    &amp;lt;/myOperation&amp;gt;&lt;br/&gt;
&amp;lt;/soap:Body&amp;gt;&lt;br/&gt;
&amp;lt;/soap:Envelope&amp;gt;&lt;/p&gt;

&lt;p&gt;I.e. the namespace for &quot;xsi&quot; prefix is present.&lt;/p&gt;


&lt;p&gt;ANALYSIS:&lt;/p&gt;

&lt;p&gt;Analysis is based on the CXF 2.2.3.&lt;/p&gt;

&lt;p&gt;Please have a look at the sources:&lt;/p&gt;

&lt;p&gt;   Class: org.apache.cxf.staxutils.StaxUtils&lt;br/&gt;
   Method: writeStartElement(XMLStreamReader reader, XMLStreamWriter writer)&lt;br/&gt;
   The code under his comment -&amp;gt; // Write out attributes&lt;/p&gt;

&lt;p&gt;My guess is:&lt;/p&gt;

&lt;p&gt;   If we have both &quot;ns&quot; and &quot;nsPrefix&quot; that are not empty then the namespace definition should be written.&lt;/p&gt;

&lt;p&gt;   506            } else &lt;/p&gt;
{
   507                writer.writeNamespace(nsPrefix, ns); // &amp;lt;-- THIS IS A NEW EXAMPLE LINE OF WHAT IS DESIRED
   508                writer.writeAttribute(reader.getAttributePrefix(i), reader.getAttributeNamespace(i), reader
   509                    .getAttributeLocalName(i), reader.getAttributeValue(i));
   510            }</description>
                <environment></environment>
        <key id="12437972">CXF-2468</key>
            <summary>attribute namespace is missed in out message in  case of XmlBeans data binding</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dkulp">Daniel Kulp</assignee>
                                    <reporter username="mklimiuk">Michael Klimiuk</reporter>
                        <labels>
                    </labels>
                <created>Tue, 13 Oct 2009 13:00:23 +0000</created>
                <updated>Fri, 4 Dec 2009 22:34:06 +0000</updated>
                            <resolved>Wed, 21 Oct 2009 00:49:19 +0000</resolved>
                                                    <fixVersion>2.1.8</fixVersion>
                    <fixVersion>2.2.5</fixVersion>
                                    <component>OtherDatabindings</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12765148" author="dkulp" created="Tue, 13 Oct 2009 16:52:37 +0000"  >

&lt;p&gt;Is there any way you could create a small testcase and attach?  This actually looks like a bug in xmlbeans.   We pretty much copy the events that xmlbeans gives us to the output.   If it&apos;s not providing the xsi namespace when it needs it, that&apos;s possibly a bug in xmlbeans.   However, we may be able to provide a better workaround if I can get a good testcase that would allow me to dig in better.     Maybe call the XmlOptions.setSaveNamespacesFirst() option or something to put them at the top level.   Hard to tell without a testcase.&lt;/p&gt;</comment>
                            <comment id="12765409" author="mklimiuk" created="Wed, 14 Oct 2009 05:48:52 +0000"  >&lt;p&gt;Thanks for a quick response, Daniel. Will try to provide the testcase today.&lt;/p&gt;</comment>
                            <comment id="12765591" author="mklimiuk" created="Wed, 14 Oct 2009 15:20:50 +0000"  >&lt;p&gt;Please the test project attached.&lt;/p&gt;

&lt;p&gt;README.txt&lt;/p&gt;

&lt;p&gt;1. Make sure &quot;cxf.dir&quot; property in &quot;build.properties&quot; file points&lt;br/&gt;
   to the &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-2&quot; title=&quot;Complete JAX-WS frontend&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-2&quot;&gt;&lt;del&gt;CXF-2&lt;/del&gt;&lt;/a&gt;.2.3 directory with libs.&lt;/p&gt;

&lt;p&gt;2. Run ant.&lt;/p&gt;

&lt;p&gt;3. The error will occur but in the logs we can see the outgoing message:&lt;/p&gt;

&lt;p&gt;   &amp;lt;soap:Envelope xmlns:soap=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&amp;gt;&lt;br/&gt;
     &amp;lt;soap:Body&amp;gt;&lt;br/&gt;
       &amp;lt;myOperationRequest xmlns=&quot;http://sandbox.org/services/myService/myDataTypes&quot;&amp;gt;&lt;br/&gt;
         &amp;lt;info&amp;gt;&lt;br/&gt;
           &amp;lt;firstName&amp;gt;Mike&amp;lt;/firstName&amp;gt;&lt;br/&gt;
           &amp;lt;lastName xsi:nil=&quot;true&quot; /&amp;gt;&lt;br/&gt;
         &amp;lt;/info&amp;gt;&lt;br/&gt;
       &amp;lt;/myOperationRequest&amp;gt;&lt;br/&gt;
     &amp;lt;/soap:Body&amp;gt;&lt;br/&gt;
   &amp;lt;/soap:Envelope&amp;gt;&lt;/p&gt;

&lt;p&gt;   I.e. no defnition for &quot;xsi&quot; prefix.&lt;/p&gt;
</comment>
                            <comment id="12765657" author="dkulp" created="Wed, 14 Oct 2009 17:35:01 +0000"  >&lt;p&gt;&lt;br/&gt;
Thanks for the test case.   It&apos;s definitely an xmlbeans bug as the XMLStreamReader they provide never defines a namespace for xsi.   I&apos;ve updated the StaxUtils to do some checking of the namespaces/prefixes to catch this now.   We already do this for the element qnames to catch broken prefixes and stuff on the element level.  I just updated it to also catch them for attributes.  Running tests now.&lt;/p&gt;</comment>
                            <comment id="12767230" author="mklimiuk" created="Mon, 19 Oct 2009 07:11:00 +0000"  >&lt;p&gt;Hi Daniel, I&apos;ve reopened the issue just to make sure that the situation is clear.&lt;/p&gt;

&lt;p&gt;As stated above the xml reader does not provide the namespace for xsi, but the same test (that attached) shows that it does provide it.&lt;/p&gt;

&lt;p&gt;We can see it if we include the output of the xml bean object in the test before the service invocation, like:&lt;/p&gt;

&lt;p&gt;    System.out.println(&quot;Document = &quot; + doc);&lt;/p&gt;

&lt;p&gt;this will show us:&lt;/p&gt;

&lt;p&gt;    Document = &amp;lt;myOperationRequest xmlns=&quot;http://sandbox.org/services/myService/myDataTypes&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&amp;gt;&amp;lt;info&amp;gt;&amp;lt;firstName&amp;gt;Mike&amp;lt;/firstName&amp;gt;&amp;lt;lastName xsi:nil=&quot;true&quot;/&amp;gt;&amp;lt;/info&amp;gt;&amp;lt;/myOperationRequest&amp;gt;&lt;/p&gt;

&lt;p&gt;In the output message this information is missed, but if we do the following fix in the StaxUtils class(as I mentioned earlier):&lt;/p&gt;

&lt;p&gt;&amp;gt;    506            } else &lt;/p&gt;
{
&amp;gt;    507                writer.writeNamespace(nsPrefix, ns); // &amp;lt;-- FIX: NEW LINE ADDED
&amp;gt;    508                writer.writeAttribute(reader.getAttributePrefix(i), reader.getAttributeNamespace(i), reader
&amp;gt;    509                    .getAttributeLocalName(i), reader.getAttributeValue(i));
&amp;gt;    510            }

&lt;p&gt;Than the namespace for xsi will be caught and used.&lt;/p&gt;

&lt;p&gt;This fix works in our project, so please review it and tell whether this is the right way or not.&lt;/p&gt;</comment>
                            <comment id="12768037" author="dkulp" created="Wed, 21 Oct 2009 00:49:19 +0000"  >&lt;p&gt;&amp;gt; As stated above the xml reader does not provide the namespace for xsi, but the same test (that attached) shows that it does provide it. &lt;/p&gt;

&lt;p&gt;The XMLStreamReader does not, but the toString method that is used when doing println(doc) does.    As mentioned, bug in XMLBeans XMLStreamReader thing.&lt;/p&gt;



&lt;p&gt;&amp;gt; writer.writeNamespace(nsPrefix, ns); // &amp;lt;-- FIX: NEW LINE ADDED &lt;/p&gt;

&lt;p&gt;You don&apos;t want to do that as ALL attributes that are namespace prefixed would end up with new namespace declarations outputted.   The fix I implemented checks if the namespace is already declared properly and on writes out the namespace decl if it really need to.&lt;/p&gt;

&lt;p&gt;See:&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc/cxf/trunk/common/common/src/main/java/org/apache/cxf/staxutils/StaxUtils.java?p2=/cxf/trunk/common/common/src/main/java/org/apache/cxf/staxutils/StaxUtils.java&amp;amp;p1=/cxf/trunk/common/common/src/main/java/org/apache/cxf/staxutils/StaxUtils.java&amp;amp;r1=825221&amp;amp;r2=825220&amp;amp;view=diff&amp;amp;pathrev=825221&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc/cxf/trunk/common/common/src/main/java/org/apache/cxf/staxutils/StaxUtils.java?p2=/cxf/trunk/common/common/src/main/java/org/apache/cxf/staxutils/StaxUtils.java&amp;amp;p1=/cxf/trunk/common/common/src/main/java/org/apache/cxf/staxutils/StaxUtils.java&amp;amp;r1=825221&amp;amp;r2=825220&amp;amp;view=diff&amp;amp;pathrev=825221&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12422108" name="CXF2468.zip" size="4249" author="mklimiuk" created="Wed, 14 Oct 2009 15:20:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>113883</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 6 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0uxan:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178535</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>