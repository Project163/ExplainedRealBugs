<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:35:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-1849] PolicyVerificationOutInterceptor writes faults at wrong phase when processing response</title>
                <link>https://issues.apache.org/jira/browse/CXF-1849</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;When a CXF response is processed on an endpoint that contains policy assertions (via spring, WSDL, etc), and the policy assertions are not marked as asserted, the PolicyVerificationOutInterceptor properly raises a SOAP fault.  However, this interceptor is inserted into the &quot;post-stream&quot; phase, and it seems as though the fault gets written to the SOAP body after the business logic has been written.&lt;/p&gt;

&lt;p&gt;So a response in this scenario will come out as follows:&lt;/p&gt;

&lt;p&gt;&amp;lt;soap:Envelope xmlns:soap=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&amp;gt;&lt;br/&gt;
  &amp;lt;soap:Body&amp;gt;&lt;br/&gt;
     &amp;lt;sayHiResponse xmlns=&quot;...&quot;&amp;gt;&lt;br/&gt;
       &amp;lt;responseType&amp;gt;Bonjou&amp;lt;/responseType&amp;gt;&lt;br/&gt;
     &amp;lt;/sayHiResponse&amp;gt;&lt;br/&gt;
     &amp;lt;soap:Fault&amp;gt;&lt;br/&gt;
       &amp;lt;faultcode&amp;gt;soap:Server&amp;lt;/faultcode&amp;gt;&lt;br/&gt;
       &amp;lt;faultstring&amp;gt;These policy alternatives can not be satisfied: &lt;span class=&quot;error&quot;&gt;&amp;#91;snip&amp;#93;&lt;/span&gt;&amp;lt;/faultstring &amp;gt;&lt;br/&gt;
    &amp;lt;/soap:Fault&amp;gt;&lt;br/&gt;
  &amp;lt;/soap:Body&amp;gt;&lt;br/&gt;
&amp;lt;/soap:Envelope&amp;gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12405998">CXF-1849</key>
            <summary>PolicyVerificationOutInterceptor writes faults at wrong phase when processing response</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dkulp">Daniel Kulp</assignee>
                                    <reporter username="fdushin">Fred Dushin</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Oct 2008 10:11:39 +0000</created>
                <updated>Fri, 23 Jan 2009 17:53:36 +0000</updated>
                            <resolved>Fri, 10 Oct 2008 18:34:29 +0000</resolved>
                                    <version>2.1.2</version>
                                    <fixVersion>2.1.3</fixVersion>
                                    <component>WS-* Components</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12637897" author="dkulp" created="Wed, 8 Oct 2008 12:15:57 +0000"  >&lt;p&gt;I think policy verification on the outgoing side needs to just log an error, not throw an exception.  With streaming, there really isn&apos;t a way to &quot;undo&quot; what was written.&lt;/p&gt;

&lt;p&gt;Either that, or all the policies need two interceptors.  One that runs very early to make sure the policy is assertable and then a second that really does the work.&lt;/p&gt;</comment>
                            <comment id="12638590" author="fdushin" created="Fri, 10 Oct 2008 17:06:59 +0000"  >&lt;p&gt;Proposed patch, per Dan&apos;s suggestion of logging in the case of an outbound server context.&lt;/p&gt;

&lt;p&gt;This patch was generated off r703513 of trunk.&lt;/p&gt;

&lt;p&gt;Please review inbound/outbound client/server logic detection, for soundness.  (full build from trunk passes with this change)&lt;/p&gt;

&lt;p&gt;If all is well, I&apos;d like to backmerge this patch to the 2.1.x-fixes branch.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="12638626" author="fdushin" created="Fri, 10 Oct 2008 18:55:18 +0000"  >&lt;p&gt;Thanks, Dan!&lt;/p&gt;

&lt;p&gt;The merge back to the 2.1 fixes branch looks like it should be without conflict.  Should I submit a patch for that?  Or is there a different process for back-merging?&lt;/p&gt;

&lt;p&gt;/work/src/apache/cxf/branches/2.1.x-fixes&amp;gt; svn diff -r 703557 rt/ws/policy/src/main/java/org/apache/cxf/ws/policy/PolicyVerificationOutInterceptor.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; rt/ws/policy/src/main/java/org/apache/cxf/ws/policy/PolicyVerificationOutInterceptor.java	(revision 703557)&lt;br/&gt;
+++ rt/ws/policy/src/main/java/org/apache/cxf/ws/policy/PolicyVerificationOutInterceptor.java	(working copy)&lt;br/&gt;
@@ -63,32 +63,10 @@&lt;br/&gt;
         if (policy == null) &lt;/p&gt;
{
             return;
         }
&lt;p&gt;-&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-1849&quot; title=&quot;PolicyVerificationOutInterceptor writes faults at wrong phase when processing response&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-1849&quot;&gt;&lt;del&gt;CXF-1849&lt;/del&gt;&lt;/a&gt; Log a message at FINE level if policy verification fails&lt;/li&gt;
	&lt;li&gt;// on the outbound-server side of a response&lt;/li&gt;
	&lt;li&gt;try 
{
-            aim.checkEffectivePolicy(policy.getPolicy());
-        }
&lt;p&gt; catch (final PolicyException e) {&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;if (isOutboundServer(message)) 
{
-                LOG.fine(&quot;An exception was thrown when verifying that the effective policy for &quot;
-                         + &quot;this request was satisfied.  However, this exception will not result in &quot;
-                         + &quot;a fault.  The exception raised is: &quot;
-                         + e.toString());
-                return;
-            }
&lt;p&gt; else &lt;/p&gt;
{
-                throw e;
-            }&lt;/li&gt;
	&lt;li&gt;}&lt;br/&gt;
+        &lt;br/&gt;
+        aim.checkEffectivePolicy(policy.getPolicy());&lt;br/&gt;
+        &lt;br/&gt;
         LOG.fine(&quot;Verified policies for outbound message.&quot;);&lt;br/&gt;
     }&lt;/li&gt;
	&lt;li&gt;&lt;/li&gt;
	&lt;li&gt;private boolean isOutboundServer(final Message message) 
{
-        final Object role = message.get(Message.REQUESTOR_ROLE);
-        final boolean isClient =
-            role != null ? Boolean.TRUE.equals(role) : false;
-        final boolean isOutbound =
-            message == message.getExchange().getOutMessage()
-            || message == message.getExchange().getOutFaultMessage();
-        return !isClient &amp;amp;&amp;amp; isOutbound;
-    }
&lt;p&gt;+&lt;br/&gt;
 }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

</comment>
                    </comments>
                    <attachments>
                            <attachment id="12391888" name="CXF-1849-trunk-r703513.patch" size="1843" author="fdushin" created="Fri, 10 Oct 2008 17:06:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>112618</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 7 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0v18f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>179173</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>