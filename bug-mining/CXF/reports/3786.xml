<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:41:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-9132] HttpClientHTTPConduit releases the client while there are connection(s) still using it</title>
                <link>https://issues.apache.org/jira/browse/CXF-9132</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cxf/pull/1777/files&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/1777/files&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;When I used version 4.0.4 without any issues, all subsequent versions had problems.&lt;/p&gt;

&lt;p&gt;If the address is modified, it will be released multiple times.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;throw java.io.IOException: shutdownNow&lt;br/&gt;
throw java.io.IOException: closed&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13076316/13076316_image-2025-04-29-17-49-16-376.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13076317/13076317_image-2025-04-29-17-49-06-378.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;import jakarta.jws.WebMethod;&lt;br/&gt;
import jakarta.jws.WebParam;&lt;br/&gt;
import jakarta.jws.WebResult;&lt;br/&gt;
import org.apache.commons.lang3.RandomUtils;&lt;br/&gt;
import org.apache.cxf.binding.soap.SoapMessage;&lt;br/&gt;
import org.apache.cxf.interceptor.Fault;&lt;br/&gt;
import org.apache.cxf.jaxws.JaxWsProxyFactoryBean;&lt;br/&gt;
import org.apache.cxf.phase.AbstractPhaseInterceptor;&lt;br/&gt;
import org.apache.cxf.phase.Phase;&lt;/p&gt;

&lt;p&gt;import java.util.ArrayList;&lt;br/&gt;
import java.util.List;&lt;/p&gt;

&lt;p&gt;public class TestCxf {&lt;/p&gt;

&lt;p&gt;public static void main(String[] args) throws InterruptedException {&lt;br/&gt;
HTNGOutboundWebService byAddress = getByAddress();&lt;br/&gt;
int i = 0;&lt;br/&gt;
while (i &amp;lt;= 300) {&lt;br/&gt;
Thread.ofVirtual().start(new Runnable() {&lt;br/&gt;
@Override&lt;br/&gt;
public void run() {&lt;br/&gt;
try&lt;/p&gt;

{ byAddress.ratePlanSubmitRequest(&quot;&quot;); }

&lt;p&gt;catch (Exception e) {&lt;br/&gt;
if (!e.getCause().toString().contains(&quot;HTTP response&quot;))&lt;/p&gt;

{ e.printStackTrace(); }

&lt;p&gt;}&lt;br/&gt;
}&lt;br/&gt;
} );&lt;br/&gt;
i++;&lt;br/&gt;
}&lt;br/&gt;
Thread.sleep(100000);&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;public static class HTNGHeaderOutInterceptor1 extends AbstractPhaseInterceptor&amp;lt;SoapMessage&amp;gt; {&lt;br/&gt;
static List&amp;lt;String&amp;gt; address = new ArrayList();&lt;/p&gt;

&lt;p&gt;public HTNGHeaderOutInterceptor1()&lt;/p&gt;

{ super(Phase.PREPARE_SEND); address.add(&quot;https://www.baidu.com&quot;); address.add(&quot;https://www.tencent.com&quot;); }

&lt;p&gt;@Override&lt;br/&gt;
public void handleMessage(SoapMessage message) throws Fault&lt;/p&gt;

{ int i1 = RandomUtils.secure().randomInt(0, 2); message.put(org.apache.cxf.message.Message.ENDPOINT_ADDRESS, address.get(i1)); }

&lt;p&gt;}&lt;/p&gt;

&lt;p&gt;public static HTNGOutboundWebService getByAddress()&lt;/p&gt;

{ JaxWsProxyFactoryBean jaxWsProxyFactoryBean = new JaxWsProxyFactoryBean(); jaxWsProxyFactoryBean.setServiceClass(HTNGOutboundWebService.class); jaxWsProxyFactoryBean.getOutInterceptors().add(new HTNGHeaderOutInterceptor1()); HTNGOutboundWebService soap = (HTNGOutboundWebService) jaxWsProxyFactoryBean.create(); return soap; }

&lt;p&gt;public interface HTNGOutboundWebService&lt;/p&gt;

{ @WebMethod(operationName = &quot;RatePlan_SubmitRequest&quot;, action = &quot;http://htng.org/PWSWG/2010/12/RatePlan_SubmitRequest&quot;) @WebResult(name = &quot;OTA_HotelRatePlanNotifRS&quot;, targetNamespace = &quot;http://www.opentravel.org/OTA/2003/05&quot;, partName = &quot;OTA_HotelRatePlanNotifRS&quot;) public void ratePlanSubmitRequest( @WebParam(partName = &quot;OTA_HotelRatePlanNotifRQ&quot;, name = &quot;OTA_HotelRatePlanNotifRQ&quot;, targetNamespace = &quot;http://www.opentravel.org/OTA/2003/05&quot;) String aa ); }

&lt;p&gt;}&lt;br/&gt;
&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;JDK 21&lt;br/&gt;
CXF 4.0.5/4.0.6/4.0.7/4.1.0/4.1.1&lt;/p&gt;</environment>
        <key id="13616657">CXF-9132</key>
            <summary>HttpClientHTTPConduit releases the client while there are connection(s) still using it</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="reta">Andriy Redko</assignee>
                                    <reporter username="cantos">Cantos Song</reporter>
                        <labels>
                    </labels>
                <created>Tue, 29 Apr 2025 05:35:52 +0000</created>
                <updated>Wed, 14 May 2025 01:30:17 +0000</updated>
                            <resolved>Wed, 14 May 2025 01:30:17 +0000</resolved>
                                    <version>4.1.0</version>
                    <version>4.0.5</version>
                    <version>4.0.6</version>
                    <version>4.0.7</version>
                    <version>4.1.1</version>
                                    <fixVersion>4.1.2</fixVersion>
                    <fixVersion>4.0.8</fixVersion>
                    <fixVersion>3.6.7</fixVersion>
                                    <component>Transports</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17948018" author="JIRAUSER309560" created="Tue, 29 Apr 2025 06:11:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cxf/pull/2386&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/2386&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17948789" author="reta" created="Fri, 2 May 2025 00:22:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cantos&quot; class=&quot;user-hover&quot; rel=&quot;cantos&quot;&gt;cantos&lt;/a&gt; I don&apos;t think there are multliple shutdown procedures,  what is happening apparently is that while one connection is being processed, the change to the HTTPS address causes the client behind the reference to be shutdown, while it is being recreated with a new HTTPS address.&lt;/p&gt;</comment>
                            <comment id="17949175" author="JIRAUSER309560" created="Sat, 3 May 2025 16:24:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reta&quot; class=&quot;user-hover&quot; rel=&quot;reta&quot;&gt;reta&lt;/a&gt; In concurrent situations, the client Ref will be referenced multiple times. If released, it will trigger multiple closed, which can be easily replicated through the example program I provided.&lt;/p&gt;</comment>
                            <comment id="17949177" author="reta" created="Sat, 3 May 2025 16:47:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cantos&quot; class=&quot;user-hover&quot; rel=&quot;cantos&quot;&gt;cantos&lt;/a&gt; the client keeps reference counter: it is only released when ref counter reaches 0, it is noop in all other cases.&lt;/p&gt;</comment>
                            <comment id="17949879" author="JIRAUSER309560" created="Wed, 7 May 2025 03:26:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reta&quot; class=&quot;user-hover&quot; rel=&quot;reta&quot;&gt;reta&lt;/a&gt; release decrementAndGet triggered multiple times, resulting in inconsistent count quantities, existing requests will fail.&lt;/p&gt;



&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13076390/13076390_image-2025-05-07-11-25-24-799.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17950090" author="reta" created="Wed, 7 May 2025 18:19:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cantos&quot; class=&quot;user-hover&quot; rel=&quot;cantos&quot;&gt;cantos&lt;/a&gt; I don&apos;t follow, if decrementAndGet results in inconsistent count quantities, it seems to be a serious issue in JDK atomic primitives, please consider opening an issue against OpenJDK.&lt;/p&gt;</comment>
                            <comment id="17950161" author="JIRAUSER309560" created="Thu, 8 May 2025 01:32:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reta&quot; class=&quot;user-hover&quot; rel=&quot;reta&quot;&gt;reta&lt;/a&gt; When the domain name changes, &apos;acquire&apos; is not executed and &apos;release&apos; is executed, resulting in inconsistent count.&lt;/p&gt;

&lt;p&gt;I will modify my submission and not execute &apos;release&apos;.this will be simpler.&lt;/p&gt;



&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13076419/13076419_image-2025-05-08-09-28-05-723.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17950163" author="reta" created="Thu, 8 May 2025 01:44:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cantos&quot; class=&quot;user-hover&quot; rel=&quot;cantos&quot;&gt;cantos&lt;/a&gt; this is by design: SSL URL change for this specific conduit forces client recreation. Since the only way to acquire client reference is through the acquire, the release must be called as well. There are no inconsistencies here. If you want previous behavior, please pass `&lt;font color=&quot;#000000&quot;&gt;&lt;font color=&quot;#2a00ff&quot;&gt;&lt;/font&gt;share.httpclient.http.conduit&lt;/font&gt;&lt;font color=&quot;&quot;&gt;&lt;/font&gt;` with value property&#160; `false` to bus or message.&lt;/p&gt;</comment>
                            <comment id="17950410" author="JIRAUSER309560" created="Fri, 9 May 2025 01:55:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reta&quot; class=&quot;user-hover&quot; rel=&quot;reta&quot;&gt;reta&lt;/a&gt; &#160;There are also issues with share. share.httpclient.http.conduit=false&lt;/p&gt;

&lt;p&gt;When the domain name changes, &apos;acquire&apos; is not executed and &apos;release&apos; is executed, resulting in inconsistent count.&lt;/p&gt;

&lt;p&gt;This will affect the network requests that have already been initiated.&lt;/p&gt;

&lt;p&gt;I think the last refactoring changed the default implementation, but this time there are bugs in the implementation.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Host 1: Requests 1~50-&amp;gt;RefCount1 acquire execute 50 times, count=50&lt;/p&gt;

&lt;p&gt;Host 2: Requests 51 -&amp;gt; acquire&#160; not execute ,then&lt;font color=&quot;#ff0000&quot;&gt; release execute&lt;/font&gt;, RefCount1 count=49, new RefCount2 count=1&lt;/p&gt;

&lt;p&gt;At this point, RefCount1 one request from Host1 will be lost, the reason is that the release was execute.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17950498" author="reta" created="Fri, 9 May 2025 11:51:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cantos&quot; class=&quot;user-hover&quot; rel=&quot;cantos&quot;&gt;cantos&lt;/a&gt; so here is the thing: the previous impl (client == null) was leaking the client. Now, when the leak is fixed, we have impact on ongoing executions if the client behind the reference is &quot;in use&quot; (&lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-9132?focusedCommentId=17948789&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-17948789&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CXF-9132?focusedCommentId=17948789&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-17948789&lt;/a&gt;). I think your previous finding/idea to get rid of&#160; &lt;font color=&quot;#000000&quot;&gt;&lt;font color=&quot;#0000c0&quot;&gt;&lt;/font&gt;sslURL&lt;/font&gt;&lt;font color=&quot;&quot;&gt;&lt;/font&gt; usage tracking was on the right track.&lt;/p&gt;</comment>
                            <comment id="17950505" author="JIRAUSER309560" created="Fri, 9 May 2025 12:39:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reta&quot; class=&quot;user-hover&quot; rel=&quot;reta&quot;&gt;reta&lt;/a&gt; yes&#65292; I will restore the old submission, and it&apos;s up to you to decide which one to use&lt;/p&gt;</comment>
                            <comment id="17950506" author="JIRAUSER309560" created="Fri, 9 May 2025 12:45:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cxf/pull/2397&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/2397&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17951306" author="reta" created="Wed, 14 May 2025 01:30:17 +0000"  >&lt;p&gt;Documentation updated: &lt;a href=&quot;https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=49941#ClientHTTPTransport(includingSSLsupport)-DefaultClientTransport&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=49941#ClientHTTPTransport(includingSSLsupport)-DefaultClientTransport&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13076318" name="438528865-8f282ba8-c4de-4451-b2ca-a8f76c79b643.png" size="30605" author="cantos" created="Tue, 29 Apr 2025 09:49:01 +0000"/>
                            <attachment id="13076313" name="TestCxf.java" size="2876" author="cantos" created="Tue, 29 Apr 2025 05:35:24 +0000"/>
                            <attachment id="13076317" name="image-2025-04-29-17-49-06-378.png" size="982005" author="cantos" created="Tue, 29 Apr 2025 09:49:09 +0000"/>
                            <attachment id="13076316" name="image-2025-04-29-17-49-16-376.png" size="30605" author="cantos" created="Tue, 29 Apr 2025 09:49:16 +0000"/>
                            <attachment id="13076390" name="image-2025-05-07-11-25-24-799.png" size="122332" author="cantos" created="Wed, 7 May 2025 03:25:26 +0000"/>
                            <attachment id="13076417" name="image-2025-05-08-09-27-38-409.png" size="98143" author="cantos" created="Thu, 8 May 2025 01:27:39 +0000"/>
                            <attachment id="13076418" name="image-2025-05-08-09-27-59-002.png" size="98143" author="cantos" created="Thu, 8 May 2025 01:27:59 +0000"/>
                            <attachment id="13076419" name="image-2025-05-08-09-28-05-723.png" size="98143" author="cantos" created="Thu, 8 May 2025 01:28:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            26 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1vlog:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>