<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:41:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-2768] Temporary files are not deleted for requests &gt;64kb when using LoggingInInterceptor</title>
                <link>https://issues.apache.org/jira/browse/CXF-2768</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;When we use the LoggingInInterceptor and receive a request that is larger than 64kb, CXF creates a temporary file, but does not delete it.&lt;/p&gt;

&lt;p&gt;The LoggingInInterceptor closes the message&apos;s original input stream and opens a new one.  In the case of a request that is larger than 64kb, the CachedOutputStream creates a temporary file which the new input stream reads.  The new FileInputStream&apos;s close method is overridden to delete the temporary file when it is closed, but that close is never called.&lt;/p&gt;

&lt;p&gt;It appears that CXF assumes that the input stream passed to the interceptors does not need to be closed explicitly, because in the normal case that input stream is the HttpServletRequest input stream which will be closed by the container.  However when LoggingInInterceptor passes along a new input stream to the rest of the interceptor chain, it is left unclosed.&lt;/p&gt;

&lt;p&gt;I created a new InputStreamClosingInterceptor that explicitly closes the input stream if it exists and set it for the PRE_INVOKE phase so that it runs after all other interceptors are done with the input stream.  With this change the new input stream is successfully closed and the temporary file is correctly deleted.  Is this safe?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;InputStreamClosingInterceptor&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;InputStreamClosingInterceptor
   &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; AbstractPhaseInterceptor&amp;lt;Message&amp;gt;
{
   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; InputStreamClosingInterceptor() {
      &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;(Phase.PRE_INVOKE);
   }

   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void handleMessage(Message message)
      &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Fault
   {
      InputStream inputStream = message.getContent(InputStream.class);
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(inputStream != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
         closeInputStream(inputStream);
      }
   }

   &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void closeInputStream(InputStream inputStream) {
      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
         inputStream.close();
      }
      &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
         &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Fault(e);
      }
   }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A more elegant solution would be to modify CXF so that it does not assume that the input stream passed to the interceptor chain is the same stream at the end of the chain, and that it explicitly closes the resultant stream at the end of the chain processing in the framework.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows XP, Linux&lt;br/&gt;
Java 1.6&lt;/p&gt;</environment>
        <key id="12462288">CXF-2768</key>
            <summary>Temporary files are not deleted for requests &gt;64kb when using LoggingInInterceptor</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dkulp">Daniel Kulp</assignee>
                                    <reporter username="nathan.waldman">Nathan Waldman</reporter>
                        <labels>
                    </labels>
                <created>Fri, 16 Apr 2010 20:44:18 +0000</created>
                <updated>Mon, 10 May 2010 18:06:06 +0000</updated>
                            <resolved>Wed, 5 May 2010 18:22:17 +0000</resolved>
                                    <version>2.2.3</version>
                    <version>2.2.5</version>
                                    <fixVersion>2.2.8</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12858034" author="nathan.waldman" created="Fri, 16 Apr 2010 22:15:58 +0000"  >&lt;p&gt;This is possibly related to &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-1743&quot; title=&quot;Temporary files are not deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-1743&quot;&gt;&lt;del&gt;CXF-1743&lt;/del&gt;&lt;/a&gt;, but it is definitely not working on Windows XP.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114149</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 32 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0sxxz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>166976</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>