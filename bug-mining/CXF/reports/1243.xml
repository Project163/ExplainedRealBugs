<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:51:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-4099] SignedParts, EncryptedParts policy assertions are silently ignored on the client side if specified alone</title>
                <link>https://issues.apache.org/jira/browse/CXF-4099</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;Actually if client defines policy containing only SignedParts, EncryptedParts assertions without binding (Assymetric, Symmetric or Transport) CXF does nothing and send unsigned/unencrypted message. Exception is thrown only on service side (Assertion is not satisfied). I find it a little bit dangerous, because client can assume that message is encrypted. IMHO exception should be thrown already on client side.&lt;/p&gt;

&lt;p&gt;Fix proposals:&lt;br/&gt;
A) PolicyVerificationOutInterceptor &lt;/p&gt;

&lt;p&gt;As I can see PolicyVerificationOutInterceptor doesn&apos;t throw exception in case if policy assertions are not satisfied.&lt;br/&gt;
That means for outgoing messages (client request and server response) policy assertions can be not fulfilled and message will be sent anyway.&lt;/p&gt;

&lt;p&gt;Code is below:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-comment&quot;&gt;// CXF-1849 Log a message at FINE level &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; policy verification fails
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// on the outbound-server side of a response
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            aim.checkEffectivePolicy(policy.getPolicy());
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (PolicyException e) {
            LOG.fine(&lt;span class=&quot;code-quote&quot;&gt;&quot;An exception was thrown when verifying that the effective policy &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &quot;&lt;/span&gt;
                     + &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; request was satisfied.  However, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; exception will not result in &quot;&lt;/span&gt;
                     + &lt;span class=&quot;code-quote&quot;&gt;&quot;a fault.  The exception raised is: &quot;&lt;/span&gt;
                     + e.toString());
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
        }
        LOG.fine(&lt;span class=&quot;code-quote&quot;&gt;&quot;Verified policies &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; outbound message.&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For incoming messages unsatisfied assertion is interpreted as real problem and causes fault.&lt;/p&gt;

&lt;p&gt;I am not sure about the reason of such different verification.&lt;br/&gt;
There are some cases where it can be critical even for outgoing message: encryption, compression.&lt;/p&gt;

&lt;p&gt;B) If alternative A is not possible for some reasons, I would propose to implement additional interceptor, register it in WSSecurityPolicyInterceptorProvider and check specially for critcal security assertion satisfaction there. Interceptor should be called after PolicyBasedWSS4J* interceptors.&lt;/p&gt;

&lt;p&gt;I am going to provide a patch either for A or B.&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Andrei.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12542121">CXF-4099</key>
            <summary>SignedParts, EncryptedParts policy assertions are silently ignored on the client side if specified alone</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="coheigea">Colm O hEigeartaigh</assignee>
                                    <reporter username="ashakirin">Andrei Shakirin</reporter>
                        <labels>
                    </labels>
                <created>Fri, 10 Feb 2012 14:59:30 +0000</created>
                <updated>Mon, 23 Apr 2012 16:45:49 +0000</updated>
                            <resolved>Thu, 16 Feb 2012 18:54:33 +0000</resolved>
                                                    <fixVersion>2.4.7</fixVersion>
                    <fixVersion>2.5.3</fixVersion>
                    <fixVersion>2.6</fixVersion>
                                    <component>WS-* Components</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13205492" author="dkulp" created="Fri, 10 Feb 2012 15:08:00 +0000"  >
&lt;p&gt;By the time the PolicyVerificationOutInterceptor is run, the message is likely already sent (or mostly sent, keep in mind we try to stream whenever possible).   Thus, throwing an exception there would just mean that any response would get discarded/lost, but the unencrypted data would have still been sent.  Thus, option 1 really would&apos;t accomplish much from a security standpoint.&lt;/p&gt;

&lt;p&gt;Option 2 is &quot;acceptable&quot;, but it may be easier to just update the PolicyBasedWSS4JOutInterceptor to handle the checks there.&lt;/p&gt;</comment>
                            <comment id="13205495" author="coheigea" created="Fri, 10 Feb 2012 15:15:51 +0000"  >
&lt;p&gt;I agree with Dan, as far as Option 2 is concerned. Just add a check to the PolicyBasedWSS4JOutInterceptor to check if there is any Signed/Encrypted Parts/Elements policy specified without a binding, and throw an exception if there is.&lt;/p&gt;

&lt;p&gt;Colm.&lt;/p&gt;</comment>
                            <comment id="13207650" author="ashakirin" created="Tue, 14 Feb 2012 12:00:23 +0000"  >&lt;p&gt;Hi Dan and Colm,&lt;/p&gt;

&lt;p&gt;OK, now I see the issue with PolicyVerificationOutInterceptor: &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;from one side it should be called late, because it is possible that some interceptors are invoked on SEND or POST_STREAM phases and they satisfy corresponded policy assertions&lt;/li&gt;
	&lt;li&gt;from other side as far as it is called after MessageSenderInterceptor, Conduit already opens the connection and sets OutputStream into message. It is also possible that message is already partly sent until PolicyVerificationOutInterceptor is called.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Unfortunatelly it is not directly possible to fix it in PolicyBasedWSS4JOutInterceptor, because this interceptor is associated with binding assertions (TRANSPORT_BINDING, ASSYMETRIC_BINDING, SYMMETRIC_BINDING). If binding is not specified at all, interceptor will not be activated. I will try to provide patch for alternative 2.&lt;/p&gt;

&lt;p&gt;Other question: does it make sense to throw exception in PolicyVerificationOutInterceptor anyway, if assertion is not satisfied? In some cases message is still not sent, if it is partly send - ok, better later as never &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
My concern that it is possible to have other, non-security assertions that also can be critical for client, for example custom compression. If assertion for some reasons is not satisfied on the client side, why not throw the exception instead send huge uncompressed message? Verify every individual assertion can be quite complicated.&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Andrei.&lt;/p&gt;</comment>
                            <comment id="13208499" author="ashakirin" created="Wed, 15 Feb 2012 14:28:20 +0000"  >&lt;p&gt;Patch for alternative 2&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12514644" name="cxf-rt-ws-security.patch" size="11314" author="ashakirin" created="Wed, 15 Feb 2012 14:28:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>227408</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 40 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0b8jb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>63495</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>