<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:35:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-8234] Response Content-Type is missing &apos;charset&apos; when Transformation feature is enabled</title>
                <link>https://issues.apache.org/jira/browse/CXF-8234</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;We have a JAXWS based service and we enabled the transformation feature based on&#160;&lt;a href=&quot;https://cxf.apache.org/docs/transformationfeature.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cxf.apache.org/docs/transformationfeature.html&lt;/a&gt;, but then we noticed that &apos;charset&apos; is missing in response Content-Type.&#160; This is probably due to &quot;disable.outputstream.optimization&quot; being set to true by&#160;TransformOutInterceptor but the documentation states that &quot;disable.outputstream.optimization&quot; needs to be set to true&#160;prior to CXF versions 3.2.6 and 3.1.17.&lt;/p&gt;

&lt;p&gt;We are using 3.2.6 and we even upgraded to 3.2.12 and the behavior is the same.&#160; I also checked&#160;TransformOutInterceptor in master branch and it is still setting &quot;disable.outputstream.optimization&quot; to true.&lt;/p&gt;

&lt;p&gt;Is there a workaround for this issue in 3.2.x branch and can this be fixed in future releases?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Here are part of the headers with transformation:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
HTTP/1.1 200 
Content-Type: text/xml
Transfer-Encoding: chunked
Date: Sun, 08 Mar 2020 22:41:04 GMT&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;And here are part of the headers when transformation is not used:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
HTTP/1.1 200 
Content-Type: text/xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Sun, 08 Mar 2020 22:40:43 GMT
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13290428">CXF-8234</key>
            <summary>Response Content-Type is missing &apos;charset&apos; when Transformation feature is enabled</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="coheigea">Colm O hEigeartaigh</assignee>
                                    <reporter username="edga">Edwin</reporter>
                        <labels>
                    </labels>
                <created>Sun, 8 Mar 2020 22:36:26 +0000</created>
                <updated>Wed, 22 Dec 2021 20:43:46 +0000</updated>
                            <resolved>Thu, 12 Mar 2020 16:38:22 +0000</resolved>
                                    <version>3.2.6</version>
                    <version>3.2.12</version>
                                    <fixVersion>3.3.6</fixVersion>
                    <fixVersion>3.2.13</fixVersion>
                                    <component>JAX-WS Runtime</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17054573" author="edga" created="Mon, 9 Mar 2020 00:18:05 +0000"  >&lt;p&gt;The reason the encoding is not set when transformation is used is because the method&#160;&lt;b&gt;getEncoding&lt;/b&gt; in&#160;&lt;b&gt;StaxOutInterceptor&lt;/b&gt; is never called.&lt;/p&gt;

&lt;p&gt;I have found a workaround and I was wondering if I could ask you to please confirm if it is ok.&#160; In an interceptor to be run before &lt;b&gt;TransformOutInterceptor&lt;/b&gt;, the following code seems to do the trick:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Exchange ex = message.getExchange();
&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; encoding = (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;)message.get(Message.ENCODING);
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (encoding == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; ex.getInMessage() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) 
{
    encoding = (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;) ex.getInMessage().get(Message.ENCODING);
    message.put(Message.ENCODING, encoding);
}
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (encoding == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) 
{
    encoding = StandardCharsets.UTF_8.name();
    message.put(Message.ENCODING, encoding);
}
OutputStream os = message.getContent(OutputStream.class);
message.setContent(XMLStreamWriter.class, StaxUtils.createXMLStreamWriter(os, encoding));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17055773" author="coheigea" created="Tue, 10 Mar 2020 10:05:41 +0000"  >&lt;p&gt;We need to disable output stream optimization to get certain features to work, e.g. see &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7805&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CXF-7805&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;What I&apos;ll do is merge a fix so that it only sets it to true, if it hasn&apos;t already been explicitly configured to some value.&lt;/p&gt;</comment>
                            <comment id="17056098" author="edga" created="Tue, 10 Mar 2020 16:15:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=coheigea&quot; class=&quot;user-hover&quot; rel=&quot;coheigea&quot;&gt;coheigea&lt;/a&gt;&#160;Thank you very much.&#160; I believe the issue with the &apos;charset&apos; not being set is related to a XMLStreamWriter being set in the message before&#160;TransformOutInterceptor is called.&#160; When a writer is set then&#160;TransformOutInterceptor exits early without calling &apos;getEncoding&apos; method which sets the encoding/charset properly.&lt;/p&gt;</comment>
                            <comment id="17058027" author="coheigea" created="Thu, 12 Mar 2020 15:44:05 +0000"  >&lt;p&gt;OK I think I merged a fix for this issue, if you could confirm with the latest SNAPSHOT code that&apos;d be great.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17058072" author="edga" created="Thu, 12 Mar 2020 16:33:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=coheigea&quot; class=&quot;user-hover&quot; rel=&quot;coheigea&quot;&gt;coheigea&lt;/a&gt;&#160;Thank you very much.&#160; My apologies, all along I have meant to refer to the issue in StaxOutInterceptor and instead by mistake I have been referring to TransformOutInterceptor.&#160; If you check the first few lines of &apos;handleMessage&apos; in StaxOutInterceptor which is as follows&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
OutputStream os = message.getContent(OutputStream.class);
XMLStreamWriter xwriter = message.getContent(XMLStreamWriter.class);
Writer writer = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (os == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {&#160; &#160; &#160; &#160; &#160; &#160; 
    writer = message.getContent(Writer.class);&#160; &#160; &#160; &#160; 
}&#160; &#160; &#160; &#160; 
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ((os == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; writer == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) || xwriter != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {&#160; &#160; &#160; &#160; &#160; &#160; 
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;&#160; &#160; &#160; &#160; 
}

&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; encoding = getEncoding(message);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;As indicated, when an &apos;xwriter&apos; is available on the message, then there is a return and the &apos;getEncoding(message)&apos; method is never called to set the encoding in the message.&#160; I believe this is the root cause of the issue.&lt;/p&gt;</comment>
                            <comment id="17058082" author="edga" created="Thu, 12 Mar 2020 16:41:47 +0000"  >&lt;p&gt;My question is then if an xwriter is set on the message, is there an expectation that whoever set the xwriter they also must set the encoding on the message?&lt;/p&gt;</comment>
                            <comment id="17058088" author="coheigea" created="Thu, 12 Mar 2020 16:49:23 +0000"  >&lt;p&gt;Yes I suppose so.&lt;/p&gt;</comment>
                            <comment id="17058133" author="edga" created="Thu, 12 Mar 2020 17:41:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=coheigea&quot; class=&quot;user-hover&quot; rel=&quot;coheigea&quot;&gt;coheigea&lt;/a&gt;&#160;Thank you very much.&#160; In that case we can close the ticket because my workaround above which does set the encoding as well as the xwriter seems to resolve the issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 35 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0cb68:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>