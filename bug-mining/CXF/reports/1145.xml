<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:50:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-3916] partial response problem with SOAP 1.1 use of WS-Addressing</title>
                <link>https://issues.apache.org/jira/browse/CXF-3916</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;Description copied from email:&lt;/p&gt;

&lt;p&gt;I&apos;ve read over this more and now see that the partial response stuff is definitely for asynchronous processing, so the check with the WS-Addressing relatesTo header makes sense.  The problem (I think) appears in your checkin revision 705446 for ClientImpl.java in this section:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; (message.getExchange()) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!isPartialResponse(message) &amp;amp;&amp;amp; callback == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            message.getExchange().put(FINISHED, &lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;.TRUE);
            message.getExchange().setInMessage(message);
            message.getExchange().notifyAll();                   
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You added the &quot;&amp;amp;&amp;amp; callback == null&quot; test, but I think what is needed is &quot;|| callback == null&quot;.  The idea here (again, as I&apos;m reading it) is regarding these two cases:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;it&apos;s an asynchronous response which is not a partial response&lt;/li&gt;
	&lt;li&gt;there is no callback, meaning it&apos;s a synchronous response&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In either of these cases you want to tell the exchange that it&apos;s finished and the message you just got is the inbound message.  I think this worked for a long time without anyone running into this because in the synchronous case (callback == null), the only way you get a partialResponse==true is when WS-Addressing is engaged AND the server that you&apos;re connecting to doesn&apos;t return the optional (but almost always used) relatesTo header.  Probably in the vast majority of cases either WS-Addressing isn&apos;t used or the relatesTo header is present in a response.&lt;/p&gt;

&lt;p&gt;If you agree, I can create a defect and describe this.  Since the change is just &amp;amp;&amp;amp; to ||, obviously it won&apos;t help to send you a patch file &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Jesse&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;-----Original Message-----
From: Jesse Pangburn [mailto:Jesse.Pangburn@us.lawson.com] 
Sent: Wednesday, November 09, 2011 6:37 PM
To: users@cxf.apache.org
Subject: partial response problem with SOAP 1.1 use of WS-Addressing and SOAPAction

Hi,
I invoked a SOAP 1.1 web service using CXF 2.4.2 DispatchImpl and that service immediately returned the following soap header:
	&amp;lt;soap:Header&amp;gt;
		&amp;lt;wsa:MessageID&amp;gt;uuid:A12B3727-0B3D-11E1-983D-DFB5348FF699&amp;lt;/wsa:MessageID&amp;gt;
		&amp;lt;wsa:Action&amp;gt;response&amp;lt;/wsa:Action&amp;gt;
	&amp;lt;/soap:Header&amp;gt;

My client hung &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 60 seconds until a timeout was reached, at which point the response was available in the StaxSource.  Tracing the problem into the code revealed that it was waiting because the message response it had received so far was deemed a &lt;span class=&quot;code-quote&quot;&gt;&quot;partial response&quot;&lt;/span&gt; due to the following code which always is called when WS-Addressing is enabled in MAPCodec.java:
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void markPartialResponse(SoapMessage message, AddressingProperties maps) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ContextUtils.isRequestor(message) &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; != maps
            &amp;amp;&amp;amp; (&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; == maps.getRelatesTo() 
                || (&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; != maps.getRelatesTo()
                    &amp;amp;&amp;amp; Names.WSA_UNSPECIFIED_RELATIONSHIP.equals(maps.getRelatesTo().getValue())))) {
            message.put(Message.PARTIAL_RESPONSE_MESSAGE, &lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;.TRUE);
        } 
    }

The problem, I think, is &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; condition &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; == maps.getRelatesTo()&quot;&lt;/span&gt;.  This essentially means that a WS-Addressing RelatesTo header is required to indicate that a message response is complete- even on a synchronous request/response.  I think the source of &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; problem is that the original WS-Addressing submission to W3C said that &lt;span class=&quot;code-quote&quot;&gt;&quot;This element MUST be present &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the message is a reply&quot;&lt;/span&gt; in the description &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the RelatesTo header (see http:&lt;span class=&quot;code-comment&quot;&gt;//www.w3.org/Submission/ws-addressing/#_Toc77464323).  This language was struck from the &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; WS-Addressing 1.0 (see http://www.w3.org/TR/ws-addr-core/#msgaddrpropsinfoset) and means that RelatesTo is not required.
&lt;/span&gt;
While I think it was sloppy on the part of the service writer to not include the RelatesTo header, it is OPTIONAL according to the spec.  So, especially in the &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; of a synchronous request, I think &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; code is incorrect.  A CXF Dispatch client should not hang until timeout is reached because an optional header is not included in the response.

Unfortunately, I&lt;span class=&quot;code-quote&quot;&gt;&apos;m not really sure what the correct solution is here since I don&apos;&lt;/span&gt;t understand the &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; ever having a partial response message in a synchronous request/response.  Should later code note that the request/response is synchronous and ignore &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; partial response flag?  I assume the intention of &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; code is &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; asynchronous request/response so that the immediate response on the request&apos;s socket connection is not treated as the asynchronous response message.

Any clues?
Thanks,
Jesse
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12531548">CXF-3916</key>
            <summary>partial response problem with SOAP 1.1 use of WS-Addressing</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dkulp">Daniel Kulp</assignee>
                                    <reporter username="jpangburn">Jesse Pangburn</reporter>
                        <labels>
                            <label>client</label>
                            <label>dispatch</label>
                            <label>soap11</label>
                            <label>ws-addressing</label>
                    </labels>
                <created>Tue, 15 Nov 2011 22:59:17 +0000</created>
                <updated>Mon, 23 Apr 2012 16:45:20 +0000</updated>
                            <resolved>Tue, 7 Feb 2012 21:48:01 +0000</resolved>
                                    <version>2.4.2</version>
                                    <fixVersion>2.3.10</fixVersion>
                    <fixVersion>2.4.7</fixVersion>
                    <fixVersion>2.5.3</fixVersion>
                                    <component>JAX-WS Runtime</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13201808" author="jpangburn" created="Mon, 6 Feb 2012 23:39:50 +0000"  >&lt;p&gt;The previous fix applied does not resolve the issue.  I&apos;ve tried this using 2.5.2 and the fix says it&apos;s resolved in 2.5.1, but still getting the same problem.&lt;/p&gt;

&lt;p&gt;When the response message comes back like this without a relatesTo header is when the trouble happens:&lt;br/&gt;
	&amp;lt;soap:Header&amp;gt;&lt;br/&gt;
		&amp;lt;wsa:MessageID&amp;gt;uuid:7F0786FA-5118-11E1-9ACE-BB6287EFAC14&amp;lt;/wsa:MessageID&amp;gt;&lt;br/&gt;
		&amp;lt;wsa:Action&amp;gt;response&amp;lt;/wsa:Action&amp;gt;&lt;br/&gt;
	&amp;lt;/soap:Header&amp;gt;&lt;/p&gt;

&lt;p&gt;The original code was:&lt;br/&gt;
                if (!isPartialResponse(message) &amp;amp;&amp;amp; callback == null) &lt;/p&gt;
{
                    message.getExchange().put(FINISHED, Boolean.TRUE);
                    message.getExchange().setInMessage(message);
                    message.getExchange().notifyAll();
                }

&lt;p&gt;This was clearly wrong and so I think Dan changed the test to be:&lt;br/&gt;
                if (!isPartialResponse(message)) {&lt;/p&gt;

&lt;p&gt;I believe the intention is that this test would do what it implies &quot;if the response is not a partial response then...&quot;.  If that were true this would have worked.  It&apos;s not true though, because that test returns true in the case of a synchronous request with no relatesTo header- saying that it&apos;s a partial response when it&apos;s not.  It&apos;s the complete response because it was a synchronous response.&lt;/p&gt;

&lt;p&gt;The fault here really lies in the code that sets the variable this test checks, but it&apos;s hard to fix there.  This is why my original suggestion was to change the test to:&lt;br/&gt;
                if (!isPartialResponse(message) || callback == null) {&lt;/p&gt;

&lt;p&gt;This fixes the synchronous case because callback is always null for a synchronous response.  It does not harm the test for asynchronous case because callback is not null.&lt;/p&gt;

&lt;p&gt;Changing 2.5.2 code to have this test instead works with that response which is missing the relatesTo header.  The response is returned immediately to the client instead of timing out waiting for the full response to come back (when there is no more forthcoming).&lt;/p&gt;

&lt;p&gt;thanks,&lt;br/&gt;
Jesse&lt;/p&gt;</comment>
                            <comment id="13202832" author="dkulp" created="Tue, 7 Feb 2012 21:48:01 +0000"  >
&lt;p&gt;Added a testcase for this.   &lt;/p&gt;

&lt;p&gt;Basing on the presence or not of the callback is definitely not a correct fix and the testcase I added actually proved it.   A couple interceptors based their actions on whether the message was a partial response or not and thus things were not processed correctly.   For example, in the testcase, the response resulted in a ClassCastException as the WrapperClassInInterceptor does not run if the response is a partial message so the contents List had the wrapper object and not the expected integer.   Also, with WS-RM, you can have partial responses and such coming in whether or not you have a callback object.  &lt;/p&gt;

&lt;p&gt;I&apos;ve updated the MAPAggregator to do some extra checks if the message is marked a partial response to reset to a non-partial response if it feels it should be.   That fixes the test.  &lt;/p&gt;

&lt;p&gt;It would be great if you could try your cases with tonights snapshots (or build your own snapshots).&lt;/p&gt;</comment>
                            <comment id="13203833" author="jpangburn" created="Wed, 8 Feb 2012 18:45:07 +0000"  >&lt;p&gt;Hi Dan,&lt;br/&gt;
Perfect, this is definitely the best fix so that isPartialResponse() does what it says it does.  I hadn&apos;t considered other downstream interceptors using isPartialResponse and having problems since I didn&apos;t encounter any problems like that with my quick fix and don&apos;t use WS-RM.  Thank you for fixing it right!&lt;/p&gt;

&lt;p&gt;I downloaded the 2.5.3 snapshot this morning and tested it and it worked great with the endpoint that was causing me trouble.&lt;/p&gt;

&lt;p&gt;Thanks again,&lt;br/&gt;
Jesse&lt;/p&gt;</comment>
                            <comment id="13212704" author="dkulp" created="Tue, 21 Feb 2012 16:23:36 +0000"  >
&lt;p&gt;Jesse,&lt;/p&gt;

&lt;p&gt;Aki just pointed out to me that according to the WS-Addressing  spec, the wsa:RelatesTo header MUST be present if the message is a reply.  I&apos;m going to leave my fix in place, but I&apos;m pointing this out to you as you may want to fix the service that is generating the invalid WS-Addressing response.&lt;/p&gt;

&lt;p&gt;Dan&lt;/p&gt;</comment>
                            <comment id="13212804" author="jpangburn" created="Tue, 21 Feb 2012 19:02:48 +0000"  >&lt;p&gt;Hi Dan,&lt;br/&gt;
I don&apos;t think that&apos;s true.  I looked up the spec before going down this path.  The W3C spec is at &lt;a href=&quot;http://www.w3.org/TR/ws-addr-core/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.w3.org/TR/ws-addr-core/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Here&apos;s the part about relatesTo:&lt;br/&gt;
/wsa:RelatesTo&lt;br/&gt;
This OPTIONAL (repeating) element information item contributes one abstract &lt;span class=&quot;error&quot;&gt;&amp;#91;relationship&amp;#93;&lt;/span&gt; property value, in the form of an (IRI, IRI) pair. The content of this element (of type xs:anyURI) conveys the &lt;span class=&quot;error&quot;&gt;&amp;#91;message id&amp;#93;&lt;/span&gt; of the related message.&lt;/p&gt;

&lt;p&gt;The spec says nothing about it being required, in fact it says in caps &quot;OPTIONAL&quot;.&lt;/p&gt;

&lt;p&gt;Aki is probably looking at the original W3C submission, not the final spec.  The submission is available here: &lt;a href=&quot;http://www.w3.org/Submission/ws-addressing/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.w3.org/Submission/ws-addressing/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It&apos;s different.  It says:&lt;br/&gt;
/wsa:RelatesTo&lt;br/&gt;
This OPTIONAL (repeating) element information item contributes one abstract &lt;span class=&quot;error&quot;&gt;&amp;#91;relationship&amp;#93;&lt;/span&gt; property value, in the form of a (URI, QName) pair. The &lt;span class=&quot;error&quot;&gt;&amp;#91;children&amp;#93;&lt;/span&gt; property of this element (which is of type xs:anyURI) conveys the &lt;span class=&quot;error&quot;&gt;&amp;#91;message id&amp;#93;&lt;/span&gt; of the related message. This element MUST be present if the message is a reply.&lt;/p&gt;

&lt;p&gt;This is probably where he got the idea that it was required, since it is required in the submission version.  Apparently that was lifted in the final version.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Jesse&lt;/p&gt;
</comment>
                            <comment id="13212814" author="dkulp" created="Tue, 21 Feb 2012 19:18:01 +0000"  >&lt;p&gt;Right.  However, it is specified in section 3.4 about creating a reply message:&lt;/p&gt;


&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;relationship&amp;#93;&lt;/span&gt;: this property MUST include a pair of IRIs as follows; the relationship type is the predefined reply URI &quot;http://www.w3.org/2005/08/addressing/reply&quot; and the related message&apos;s identifier is the &lt;span class=&quot;error&quot;&gt;&amp;#91;message id&amp;#93;&lt;/span&gt; property value from the message being replied to; other relationships MAY be expressed in this property&lt;/p&gt;


&lt;p&gt;So the relationship must be specified.  &lt;/p&gt;

&lt;p&gt;So it&apos;s optional in that it isn&apos;t on all messages, but for a message formulating a reply, it must be there to formulate the relationship.&lt;/p&gt;


</comment>
                            <comment id="13213142" author="jpangburn" created="Wed, 22 Feb 2012 00:24:47 +0000"  >&lt;p&gt;Hi Dan,&lt;br/&gt;
That makes sense.  I was searching the doc for &quot;relatesTo&quot; and it isn&apos;t mentioned there.  I see the interpretation making sense though.  The service I was calling was beyond my control- it&apos;s a test service for a government service.&lt;/p&gt;

&lt;p&gt;Still, doesn&apos;t hurt us (CXF users) to be tolerant.  Follows the send precise / receive tolerant idea.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Jesse&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10062"><![CDATA[Moderate]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>217284</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 40 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0b89j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>63451</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>