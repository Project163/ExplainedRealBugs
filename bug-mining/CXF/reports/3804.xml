<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:41:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-9173] Default SO_LINGER induce TCP RST on each connection closure</title>
                <link>https://issues.apache.org/jira/browse/CXF-9173</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;After migrating from CXF 3.5.11 to 4.1.2, we noticed that TCP connections managed by the async HTTP conduit are abruptly closed with a TCP reset when the connection time-to-live (CONNECTION_TTL) expires, resulting in Connection Reset errors on the remote side.&lt;br/&gt;
&#160;&lt;/p&gt;

&lt;p&gt;Both CXF versions allow customisation of key parameters via the CXF bus:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;CONNECTION_TTL (default: 60000 ms): Duration a connection remains open.&lt;/li&gt;
	&lt;li&gt;SO_LINGER (default: -1): Controls socket linger time, affecting how connections are closed.&lt;br/&gt;
&#160;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The main change in CXF 4.x is the unit for the SO_LINGER option that is now expected to be in milliseconds while it was expressed in seconds on older CXF 3:&lt;/p&gt;

&lt;p&gt;1. The value from the CXF bus is interpreted as milliseconds when creating the IOReactorConfig (see &lt;a href=&quot;https://github.com/apache/cxf/blob/cxf-4.1.2/rt/transports/http-hc5/src/main/java/org/apache/cxf/transport/http/asyncclient/hc5/AsyncHTTPConduitFactory.java#L341&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;code&lt;/a&gt;)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; IOReactorConfig config = IOReactorConfig.custom()
&#160; &#160; &#160; &#160; &#160; &#160; .setSoLinger(TimeValue.ofMilliseconds(soLinger))&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;2. It is then converted back to seconds when the reactor consumes the config (see &lt;a href=&quot;https://github.com/apache/httpcomponents-core/blob/rel/v5.4-alpha1/httpcore5/src/main/java/org/apache/hc/core5/reactor/SingleCoreIOReactor.java#L296&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;code&lt;/a&gt;)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; linger = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.reactorConfig.getSoLinger().toSecondsIntBound();
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (linger &amp;gt;= 0) {
    socket.setSoLinger(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, linger);
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The problem occurs when the default value (-1) for the SO_LINGER option is used. In CXF 4.x, this value is first interpreted as -1 milliseconds, then converted to 0 seconds (= 0 is the result of doing &lt;em&gt;toSecondsIntBound()&lt;/em&gt; on a TimeValue of -1 milliseconds).&lt;/p&gt;

&lt;p&gt;As a result, the linger option is enabled with a timeout of 0, causing sockets to close immediately and trigger a TCP reset. &lt;/p&gt;

&lt;p&gt;That&apos;s definitively a difference in behaviour compared to CXF 3 version where the default SO_LINGER value -1 was meant to disable socket linger by default. &lt;/p&gt;

&lt;p&gt;1. Can you please clarify if this change was on purpose or if its a bug resulting from the various unit conversions?&lt;br/&gt;
2. We see setting org&lt;em&gt;.apache.cxf.transport.http.async.SO_LINGER&lt;/em&gt; to -1000 effectively disables the linger option, which aligns with the default behavior in CXF 3.x. Is this a valid workaround to prevent abrupt socket closures and TCP resets until the issue is clarified or resolved?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13633561">CXF-9173</key>
            <summary>Default SO_LINGER induce TCP RST on each connection closure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="reta">Andriy Redko</assignee>
                                    <reporter username="lmartella1">Luca Martella</reporter>
                        <labels>
                    </labels>
                <created>Thu, 6 Nov 2025 16:50:22 +0000</created>
                <updated>Mon, 10 Nov 2025 12:15:19 +0000</updated>
                            <resolved>Sat, 8 Nov 2025 15:52:36 +0000</resolved>
                                    <version>4.1.2</version>
                                    <fixVersion>4.1.4</fixVersion>
                    <fixVersion>3.6.9</fixVersion>
                    <fixVersion>4.0.10</fixVersion>
                                    <component>Transports</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="18036035" author="reta" created="Fri, 7 Nov 2025 00:52:40 +0000"  >&lt;p&gt;Thanks for the report &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lmartella1&quot; class=&quot;user-hover&quot; rel=&quot;lmartella1&quot;&gt;lmartella1&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;&amp;gt; 1. Can you please clarify if this change was on purpose or if its a bug resulting from the various unit conversions?&lt;/p&gt;

&lt;p&gt;No, the change was not on purpose but adapted to Apache HttpClient 5 APIs, the overall convention for timeout is milliseconds, and I would love to see where Apache CXF mentions seconds as the time unit (sorry, I cannot find any references)&#160;&lt;/p&gt;

&lt;p&gt;&amp;gt; 2. We see setting org&lt;em&gt;.apache.cxf.transport.http.async.SO_LINGER&lt;/em&gt; to -1000 effectively disables the linger option, which aligns with the default behavior in CXF 3.x. Is this a valid workaround to prevent abrupt socket closures and TCP resets until the issue is clarified or resolved?&lt;/p&gt;

&lt;p&gt;Yes, I think we could easily fix that by treating -1 as negative second value.&#160;&lt;/p&gt;</comment>
                            <comment id="18036049" author="reta" created="Fri, 7 Nov 2025 02:06:38 +0000"  >&lt;p&gt;Following up on SO_LINGER - it is indeed in seconds (although not very trivial to find), fixing it&lt;/p&gt;</comment>
                            <comment id="18036765" author="JIRAUSER311434" created="Mon, 10 Nov 2025 09:27:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reta&quot; class=&quot;user-hover&quot; rel=&quot;reta&quot;&gt;reta&lt;/a&gt; thanks for the resolution! Any clue on when the 4.1.4 including the fix will be released?&lt;/p&gt;</comment>
                            <comment id="18036796" author="reta" created="Mon, 10 Nov 2025 12:15:19 +0000"  >&lt;p&gt;We are planning to release within next few weeks, thank you&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1yhnc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>