<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:38:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-2346] CXF with Spring AOP-based Auth makes JAX-RS POST urlencode gives @FormParam=null </title>
                <link>https://issues.apache.org/jira/browse/CXF-2346</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;It&apos;s much accurate to illustrate this with a real project sample, since it takes quite an effort to setup the integrated environment to reproduce this bug. (yet I have to say, this integration setup is a good &apos;standard setup&apos; for my general JAX-RS purposes)&lt;/p&gt;

&lt;p&gt;The sample project is at: &lt;a href=&quot;http://scm.ops4j.org/repos/ops4j/laboratory/users/ceefour/cxfbug-urlencode-basicauth&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://scm.ops4j.org/repos/ops4j/laboratory/users/ceefour/cxfbug-urlencode-basicauth&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Given a project with the setup of CXF, JAX-RS, Servlet, Spring Security, Spring AOP, CGLIB, and JSR-250 annotation, doing a POST with urlencode on JAX-RS resource with @FormParam is not working.&lt;/p&gt;

&lt;p&gt;Here&apos;s the script used to test:&lt;/p&gt;

&lt;p&gt;    #!/bin/sh&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Environment: CXF 2.2.2, JAX-RS, Servlet Edition running under Tomcat 6.0, in combination with Spring and Spring AOP 2.5.6SEC01, Spring Security 2.0, JSR-250 @RolesAllowed, and CGLIB 2.2&lt;/li&gt;
	&lt;li&gt;Description: CXF with Spring AOP-based Auth makes JAX-RS POST urlencode gives @FormParam=null&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    echo &apos;Test if CXF just works&apos;&lt;br/&gt;
    curl -D - -v &lt;a href=&quot;http://localhost:8080/cxfbug-urlencode-basicauth/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8080/cxfbug-urlencode-basicauth/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    echo&lt;br/&gt;
    echo &apos;Test if CXF POST works&apos;&lt;br/&gt;
    curl -D - -v -X POST &lt;a href=&quot;http://localhost:8080/cxfbug-urlencode-basicauth/guestquery?name=Apache&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8080/cxfbug-urlencode-basicauth/guestquery?name=Apache&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    echo&lt;br/&gt;
    echo &apos;Test if CXF POST urlencode works&apos;&lt;br/&gt;
    curl -D - -v -X POST --data-urlencode name=Apache &lt;a href=&quot;http://localhost:8080/cxfbug-urlencode-basicauth/guestform&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8080/cxfbug-urlencode-basicauth/guestform&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    echo&lt;br/&gt;
    echo &apos;Test if CXF Auth with Spring AOP + Spring Security + JSR-250 works&apos;&lt;br/&gt;
    curl -D - -v -u apache:apache &lt;a href=&quot;http://localhost:8080/cxfbug-urlencode-basicauth/loginget&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8080/cxfbug-urlencode-basicauth/loginget&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    echo&lt;br/&gt;
    echo &apos;Test if CXF POST works&apos;&lt;br/&gt;
    curl -D - -v -u apache:apache -X POST &lt;a href=&quot;http://localhost:8080/cxfbug-urlencode-basicauth/loginquery?name=Apache&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8080/cxfbug-urlencode-basicauth/loginquery?name=Apache&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    echo&lt;br/&gt;
    echo &apos;Test if CXF POST urlencode works with Auth&apos;&lt;br/&gt;
    curl -D - -v -u apache:apache -X POST --data-urlencode name=Apache &lt;a href=&quot;http://localhost:8080/cxfbug-urlencode-basicauth/loginform&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8080/cxfbug-urlencode-basicauth/loginform&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Only the last one is failing, here&apos;s the result of the last two tests in my setup:&lt;/p&gt;

&lt;p&gt;Test if CXF POST works&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;About to connect() to localhost port 8080 (#0)&lt;/li&gt;
	&lt;li&gt;Trying ::1... connected&lt;/li&gt;
	&lt;li&gt;Connected to localhost (::1) port 8080 (#0)&lt;/li&gt;
	&lt;li&gt;Server auth using Basic with user &apos;apache&apos;&lt;br/&gt;
&amp;gt; POST /cxfbug-urlencode-basicauth/loginquery?name=Apache HTTP/1.1&lt;br/&gt;
&amp;gt; Authorization: Basic YXBhY2hlOmFwYWNoZQ==&lt;br/&gt;
&amp;gt; User-Agent: curl/7.18.2 (i486-pc-linux-gnu) libcurl/7.18.2 OpenSSL/0.9.8g zlib/1.2.3.3 libidn/1.10&lt;br/&gt;
&amp;gt; Host: localhost:8080&lt;br/&gt;
&amp;gt; Accept: &lt;b&gt;/&lt;/b&gt;&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;lt; HTTP/1.1 200 OK&lt;br/&gt;
HTTP/1.1 200 OK&lt;br/&gt;
&amp;lt; Server: Apache-Coyote/1.1&lt;br/&gt;
Server: Apache-Coyote/1.1&lt;br/&gt;
&amp;lt; Date: Fri, 17 Jul 2009 18:16:35 GMT&lt;br/&gt;
Date: Fri, 17 Jul 2009 18:16:35 GMT&lt;br/&gt;
&amp;lt; Content-Type: text/plain&lt;br/&gt;
Content-Type: text/plain&lt;br/&gt;
&amp;lt; Content-Length: 12&lt;br/&gt;
Content-Length: 12&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&amp;lt; &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Connection #0 to host localhost left intact&lt;br/&gt;
Hello Apache* Closing connection #0&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Test if CXF POST urlencode works with Auth&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;About to connect() to localhost port 8080 (#0)&lt;/li&gt;
	&lt;li&gt;Trying ::1... connected&lt;/li&gt;
	&lt;li&gt;Connected to localhost (::1) port 8080 (#0)&lt;/li&gt;
	&lt;li&gt;Server auth using Basic with user &apos;apache&apos;&lt;br/&gt;
&amp;gt; POST /cxfbug-urlencode-basicauth/loginform HTTP/1.1&lt;br/&gt;
&amp;gt; Authorization: Basic YXBhY2hlOmFwYWNoZQ==&lt;br/&gt;
&amp;gt; User-Agent: curl/7.18.2 (i486-pc-linux-gnu) libcurl/7.18.2 OpenSSL/0.9.8g zlib/1.2.3.3 libidn/1.10&lt;br/&gt;
&amp;gt; Host: localhost:8080&lt;br/&gt;
&amp;gt; Accept: &lt;b&gt;/&lt;/b&gt;&lt;br/&gt;
&amp;gt; Content-Length: 11&lt;br/&gt;
&amp;gt; Content-Type: application/x-www-form-urlencoded&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;lt; HTTP/1.1 200 OK&lt;br/&gt;
HTTP/1.1 200 OK&lt;br/&gt;
&amp;lt; Server: Apache-Coyote/1.1&lt;br/&gt;
Server: Apache-Coyote/1.1&lt;br/&gt;
&amp;lt; Date: Fri, 17 Jul 2009 18:16:35 GMT&lt;br/&gt;
Date: Fri, 17 Jul 2009 18:16:35 GMT&lt;br/&gt;
&amp;lt; Content-Type: text/plain&lt;br/&gt;
Content-Type: text/plain&lt;br/&gt;
&amp;lt; Content-Length: 10&lt;br/&gt;
Content-Length: 10&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&amp;lt; &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Connection #0 to host localhost left intact&lt;br/&gt;
Hello null* Closing connection #0&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;@FormParam is giving null instead of provided &quot;Apache&quot;.&lt;/p&gt;</description>
                <environment>&lt;p&gt;CXF 2.2.2, JAX-RS, Servlet Edition running under Tomcat 6.0, in combination with Spring and Spring AOP 2.5.6SEC01, Spring Security 2.0, JSR-250 @RolesAllowed, and CGLIB 2.2&lt;/p&gt;</environment>
        <key id="12430799">CXF-2346</key>
            <summary>CXF with Spring AOP-based Auth makes JAX-RS POST urlencode gives @FormParam=null </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sergey_beryozkin">Sergey Beryozkin</assignee>
                                    <reporter username="ceefour">Hendy Irawan</reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 Jul 2009 18:17:45 +0000</created>
                <updated>Mon, 3 Aug 2009 20:07:05 +0000</updated>
                            <resolved>Sun, 19 Jul 2009 18:27:20 +0000</resolved>
                                    <version>2.2.2</version>
                                    <fixVersion>2.2.3</fixVersion>
                    <fixVersion>2.3</fixVersion>
                                    <component>JAX-RS</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12732662" author="ceefour" created="Fri, 17 Jul 2009 18:21:54 +0000"  >&lt;p&gt;Although this and &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-2345&quot; title=&quot;Returning AOP/CGLIB proxy as Subresource throws Fault &amp;quot;object is not an instance of declaring class&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-2345&quot;&gt;&lt;del&gt;CXF-2345&lt;/del&gt;&lt;/a&gt; seem related to Spring AOP, but is a different issue.&lt;/p&gt;</comment>
                            <comment id="12732700" author="sergey_beryozkin" created="Fri, 17 Jul 2009 19:45:35 +0000"  >&lt;p&gt;Hi, is it a subresource method that is being invoked upon in this case ? Is it a CGLIB-proxified subresource bean ?&lt;/p&gt;

&lt;p&gt;And it works without Spring security ?&lt;/p&gt;

&lt;p&gt;thanks &lt;/p&gt;</comment>
                            <comment id="12732706" author="ceefour" created="Fri, 17 Jul 2009 19:52:13 +0000"  >&lt;p&gt;Hi again Sergey &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;It&apos;s not a subresource method, there&apos;s only one RootResource with several test-methods&lt;/p&gt;

&lt;p&gt;Yes I would say Spring AOP proxified it using CGLIB.&lt;/p&gt;

&lt;p&gt;It works without Spring Security. i.e. running &lt;/p&gt;

&lt;p&gt;    curl -D - -v -u apache:apache -X POST --data-urlencode name=Apache &lt;a href=&quot;http://localhost:8080/cxfbug-urlencode-basicauth/loginform&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8080/cxfbug-urlencode-basicauth/loginform&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;on a REST Service uses no Spring Security (i.e. the passed username &amp;amp; password is ignored) works without problems.&lt;/p&gt;

&lt;p&gt;Note that even with Spring Security configured as per the sample project, all CXF operations seem to be fine including @FormParam IF using multipart. Only POST, @FormParam, and urlencode combination is troublesome (for me).&lt;/p&gt;

&lt;p&gt;I guess I should include this test-case: (multipart POST)&lt;/p&gt;

&lt;p&gt;    curl -D - -v -u apache:apache -X POST -F name=Apache &lt;a href=&quot;http://localhost:8080/cxfbug-urlencode-basicauth/loginform&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8080/cxfbug-urlencode-basicauth/loginform&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;that is working both with or without Spring Security.&lt;/p&gt;</comment>
                            <comment id="12732707" author="ceefour" created="Fri, 17 Jul 2009 19:57:15 +0000"  >&lt;p&gt;I just discovered that @RolesAllowed, i.e. the security rule itself is not needed to trigger this bug.&lt;/p&gt;

&lt;p&gt;Example failing test:&lt;/p&gt;

&lt;p&gt;curl -u apache:apache -D - -v -X POST --data-urlencode name=Apache &lt;a href=&quot;http://localhost:8080/cxfbug-urlencode-basicauth/guestform&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8080/cxfbug-urlencode-basicauth/guestform&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I think it&apos;s a general problem with AOP proxied Resource and CXF handling of @FormParam, urlencode, and Basic Auth. i.e. not so much Spring Security specific&lt;/p&gt;

&lt;p&gt;I also have to add that if the client provides the credentials by way of cookies (not basic auth), no problem as well.&lt;/p&gt;</comment>
                            <comment id="12732713" author="ceefour" created="Fri, 17 Jul 2009 20:04:31 +0000"  >&lt;p&gt;I&apos;ve updated the sample project in SVN to make it simpler and less external factors&lt;/p&gt;

&lt;p&gt;It turns out @RolesAllowed / JSR-250 nor Spring Security&apos;s global-method-security is not required to reproduce the problem, so I remove the tests requiring JSR-250.&lt;/p&gt;

&lt;p&gt;The following is enough to reproduce the bug:&lt;/p&gt;

&lt;p&gt;curl -D - -v -u apache:apache -X POST --data-urlencode name=Apache &lt;a href=&quot;http://localhost:8080/cxfbug-urlencode-basicauth/guestform&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8080/cxfbug-urlencode-basicauth/guestform&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;Note that the RootResource class now has no security annotations. Simply that Spring Security is loaded &quot;in the background&quot; is enough.&lt;/p&gt;</comment>
                            <comment id="12732920" author="sergey_beryozkin" created="Sat, 18 Jul 2009 17:56:21 +0000"  >&lt;p&gt;thanks a million for simplifying the scenario. Actually a couple of users reported seeing empty FormParams but I could not reproduce it - so it appears that external factors like loading Spring Security. etc, might&apos;ve contributed to it. I&apos;ll look into it now...&lt;/p&gt;</comment>
                            <comment id="12733026" author="sergey_beryozkin" created="Sun, 19 Jul 2009 18:26:06 +0000"  >&lt;p&gt;It was a tricky issue to sort out, mainly because it was tricky to reproduce. As it happens in some cases servlet filters may consume the form request body, Spring security filters in this case, and when they do they make name/value pairs available as HttpServletRequest parameters.&lt;/p&gt;

&lt;p&gt;thanks for helping me to get to the bottom of it - I think you deserve a solid patch point.&lt;br/&gt;
cheers, Sergey&lt;/p&gt;</comment>
                            <comment id="12733157" author="sergey_beryozkin" created="Mon, 20 Jul 2009 08:38:42 +0000"  >&lt;p&gt;By the way, here&apos;s a workaround, untill 2.2.3 gets released.&lt;/p&gt;

&lt;p&gt;Register a JAX-RS request filter and in there :&lt;/p&gt;

&lt;p&gt;if (&quot;POST&quot;.equals(m.get(Message.HTTP_REQUEST_METHOD))&lt;br/&gt;
     &amp;amp;&amp;amp; &quot;application/x-www-form-urlencoded&quot;.equals(m.get(Message.CONTENT_TYPE))) {&lt;/p&gt;

&lt;p&gt;HttpServletRequest request = (HttpServletRequest)m.get(AbstractHTTPDestination.HTTP_REQUEST);&lt;/p&gt;

&lt;p&gt;StringBuilder sb = new StringBuilder();&lt;br/&gt;
for (Enumeration en = request.getParameterNames(); en.hasMoreElements()&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; {&lt;br/&gt;
          String paramName = en.nextElement().toString();&lt;br/&gt;
          String[] paramValues = request.getParameterValues(paramName);&lt;br/&gt;
           for (int i = 0; i &amp;lt; paramValues.length; i++) {&lt;br/&gt;
                  sb.append(paramName).append(&apos;=&apos;).append(paramValues&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;);&lt;br/&gt;
                  if (i + 1 &amp;lt; paramValues.length) &lt;/p&gt;
{
                       sb.append(&apos;&amp;amp;&apos;);
                  }
&lt;p&gt;           }&lt;br/&gt;
           if (en.hasMoreElements()) &lt;/p&gt;
{
                sb.append(&apos;&amp;amp;&apos;);
           }
&lt;p&gt;}&lt;/p&gt;

&lt;p&gt;m.putContent(InputStream.class, new ByteArrayInputStream(sb.getBytes(&quot;UTF-8&quot;)));&lt;br/&gt;
}&lt;/p&gt;</comment>
                            <comment id="12733276" author="ceefour" created="Mon, 20 Jul 2009 17:01:30 +0000"  >&lt;p&gt;Thank you very much Sergey for the prompt fix. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Always glad to help in any way. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12430733">CXF-2345</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>113774</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 19 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i14dq7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>233687</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>