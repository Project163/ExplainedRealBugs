<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:30:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-7520] Ensure CXF can build with JDK9.0.1 and JDK8_161</title>
                <link>https://issues.apache.org/jira/browse/CXF-7520</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;a couple of cxf test failied with JDK9 GA due to recent change&lt;br/&gt;
Mainly in JAXB and SAAJ&lt;/p&gt;</description>
                <environment></environment>
        <key id="13105649">CXF-7520</key>
            <summary>Ensure CXF can build with JDK9.0.1 and JDK8_161</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ffang">Freeman Yue Fang</assignee>
                                    <reporter username="ffang">Freeman Yue Fang</reporter>
                        <labels>
                    </labels>
                <created>Thu, 28 Sep 2017 04:44:52 +0000</created>
                <updated>Wed, 7 Feb 2018 14:52:08 +0000</updated>
                            <resolved>Fri, 19 Jan 2018 06:29:38 +0000</resolved>
                                                    <fixVersion>3.2.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16183662" author="ffang" created="Thu, 28 Sep 2017 04:58:58 +0000"  >&lt;p&gt;So far I disable two tests when run with jdk9 GA&lt;br/&gt;
JSONProviderTest.testWriteNullValueAsString&lt;br/&gt;
JSONProviderTest.testWriteNullValueAsNull&lt;br/&gt;
Because those two are caused by a JDK9 bug IMO. Already reported to &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;This is caused by a new introduced com.sun.xml.internal.bind.v2.runtime.output.XMLStreamWriterOutput$NewLineEscapeHandler&lt;br/&gt;
Previously the &lt;br/&gt;
com.sun.xml.internal.bind.v2.runtime.output.XMLStreamWriterOutput.text method is&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void text(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; value, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; needsSeparatingWhitespace) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException, SAXException,   XMLStreamException {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(needsSeparatingWhitespace)
            out.writeCharacters(&lt;span class=&quot;code-quote&quot;&gt;&quot; &quot;&lt;/span&gt;);
        out.writeCharacters(value);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So that even the String value is empty, the underlying XMLStreamWriter get chance to be invoked, so that we can do anything in customized XMLStreamWriter like JSONProviderTest$NullWriter we handle the case that the value is empty and put anything meaningful in the output payload&lt;/p&gt;

&lt;p&gt;However with JDK9 GA the com.sun.xml.internal.bind.v2.runtime.output.XMLStreamWriterOutput.text method is&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void text(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; value, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; needsSeparatingWhitespace) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException, SAXException, XMLStreamException {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(needsSeparatingWhitespace)
            out.writeCharacters(&lt;span class=&quot;code-quote&quot;&gt;&quot; &quot;&lt;/span&gt;);
        escapeHandler.escape(value.toCharArray(), 0, value.length(), &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, writerWrapper);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And the  escapeHandler.escape is&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void escape(&lt;span class=&quot;code-object&quot;&gt;char&lt;/span&gt;[] ch, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; start, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; length, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isAttVal, Writer out) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
            &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; limit = start+length;
            &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; lastEscaped = start;
            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = start; i &amp;lt; limit; i++) {
                &lt;span class=&quot;code-object&quot;&gt;char&lt;/span&gt; c = ch[i];
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (c == &lt;span class=&quot;code-quote&quot;&gt;&apos;\r&apos;&lt;/span&gt; || c == &lt;span class=&quot;code-quote&quot;&gt;&apos;\n&apos;&lt;/span&gt;) {
                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (i != lastEscaped) {
                        out.write(ch, lastEscaped, i - lastEscaped);
                    }
                    lastEscaped = i + 1;
                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (out &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; XmlStreamOutWriterAdapter) {
                        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                            ((XmlStreamOutWriterAdapter)out).writeEntityRef(&lt;span class=&quot;code-quote&quot;&gt;&quot;#x&quot;&lt;/span&gt; + &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.toHexString(c));
                        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (XMLStreamException e) {
                            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Error writing xml stream&quot;&lt;/span&gt;, e);
                        }
                    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                        out.write(&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;amp;#x&quot;&lt;/span&gt;);
                        out.write(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.toHexString(c));
                        out.write(&lt;span class=&quot;code-quote&quot;&gt;&apos;;&apos;&lt;/span&gt;);
                    }
                }
            }

            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (lastEscaped != limit) { &lt;span class=&quot;code-comment&quot;&gt;//here &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;char&lt;/span&gt;[] ch lenght is 0, then there&apos;s no way to run into the out.write
&lt;/span&gt;                out.write(ch, lastEscaped, length - lastEscaped);
            }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So if the text is empty then the underlying XMLStreamWriter.writeCharacters(...) will never be invoked, and hence what we do in JSONProviderTest$NullWriter will be skipped&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;http://bugreport.java.com/&lt;/p&gt;</comment>
                            <comment id="16183714" author="ffang" created="Thu, 28 Sep 2017 06:08:50 +0000"  >&lt;p&gt;JDK bug is tracked by&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;http://bugs.java.com/bugdatabase/view_bug.do?bug_id=JDK-8188080&lt;/p&gt;</comment>
                            <comment id="16185698" author="githubbot" created="Fri, 29 Sep 2017 11:14:02 +0000"  >&lt;p&gt;GitHub user johnpoth opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1982&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1982&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Jdk9 ga&lt;/p&gt;

&lt;p&gt;    Enable more tests on JDK9 GA and upgrade maven-surefire-plugin to 2.20.1.&lt;/p&gt;

&lt;p&gt;    Some tests are still skipped on JDK9 GA due to:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7520&quot; title=&quot;Ensure CXF can build with JDK9.0.1 and JDK8_161&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7520&quot;&gt;&lt;del&gt;CXF-7520&lt;/del&gt;&lt;/a&gt;(&lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7520&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CXF-7520&lt;/a&gt;)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;BOON-376&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://github.com/boonproject/boon/issues/376&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/boonproject/boon/issues/376&lt;/a&gt;)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;groovy-eclipse-265&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://github.com/groovy/groovy-eclipse/issues/265&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/groovy/groovy-eclipse/issues/265&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/TOMEE-2038&quot; title=&quot;JDK 9 support&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TOMEE-2038&quot;&gt;&lt;del&gt;TOMEE-2038&lt;/del&gt;&lt;/a&gt;(&lt;a href=&quot;https://issues.apache.org/jira/browse/TOMEE-2038&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/TOMEE-2038&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;    Thanks!&lt;/p&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/johnpoth/camel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/johnpoth/camel&lt;/a&gt; jdk9-ga&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1982.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1982.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1982&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit b354ebbbfaeefeca49a05e02a4b1e59e2fcdfe90&lt;br/&gt;
Author: jpoth &amp;lt;poth.john@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-09-29T10:56:46Z&lt;/p&gt;

&lt;p&gt;    Upgrade maven-surefire-plugin which fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/SUREFIRE-1265&quot; title=&quot;reuseForks=false fails on jdk-9-ea builds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SUREFIRE-1265&quot;&gt;&lt;del&gt;SUREFIRE-1265&lt;/del&gt;&lt;/a&gt; on JDK9 GA&lt;/p&gt;

&lt;p&gt;commit 4553bb6f8fc04e6b9f9c0397790eb020d28011fd&lt;br/&gt;
Author: jpoth &amp;lt;poth.john@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-09-29T11:03:57Z&lt;/p&gt;

&lt;p&gt;    Enable tests that now pass on JDK9 GA&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16185805" author="githubbot" created="Fri, 29 Sep 2017 13:16:34 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1982&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1982&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16262230" author="jpoth" created="Wed, 22 Nov 2017 09:55:41 +0000"  >&lt;p&gt;Looks like Oracle closed the issue as &apos;Not an Issue&apos;&lt;/p&gt;</comment>
                            <comment id="16321896" author="githubbot" created="Thu, 11 Jan 2018 09:10:15 +0000"  >&lt;p&gt;jimma opened a new pull request #365: &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7520&quot; title=&quot;Ensure CXF can build with JDK9.0.1 and JDK8_161&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7520&quot;&gt;&lt;del&gt;CXF-7520&lt;/del&gt;&lt;/a&gt;:Ensure CXF can build with JDK9 GA(build 9+181)&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/cxf/pull/365&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/365&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16321908" author="ema" created="Thu, 11 Jan 2018 09:15:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ffang&quot; class=&quot;user-hover&quot; rel=&quot;ffang&quot;&gt;ffang&lt;/a&gt;  I encountered a similar issue which complains  Entity References are not allowed in SOAP documents:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;unwinding now: org.apache.cxf.interceptor.Fault: Marshalling Error: Entity References are not allowed in SOAP documents&lt;br/&gt;
    at org.apache.cxf.jaxb.JAXBEncoderDecoder.marshall(JAXBEncoderDecoder.java:270)&lt;br/&gt;
    at org.apache.cxf.jaxb.io.DataWriterImpl.write(DataWriterImpl.java:232)&lt;br/&gt;
    at org.apache.cxf.interceptor.AbstractOutDatabindingInterceptor.writeParts(AbstractOutDatabindingInterceptor.java:137)&lt;br/&gt;
    at org.apache.cxf.binding.soap.interceptor.RPCOutInterceptor.handleMessage(RPCOutInterceptor.java:111)&lt;br/&gt;
    at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:308)&lt;br/&gt;
    at org.apache.cxf.interceptor.OutgoingChainInterceptor.handleMessage(OutgoingChainInterceptor.java:90)&lt;br/&gt;
    at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:308)&lt;br/&gt;
    at org.apache.cxf.transport.ChainInitiationObserver.onMessage(ChainInitiationObserver.java:121)&lt;br/&gt;
    at org.apache.cxf.transport.http.AbstractHTTPDestination.invoke(AbstractHTTPDestination.java:267)&lt;br/&gt;
    at org.jboss.wsf.stack.cxf.RequestHandlerImpl.handleHttpRequest(RequestHandlerImpl.java:109)&lt;br/&gt;
    at org.jboss.wsf.stack.cxf.transport.ServletHelper.callRequestHandler(ServletHelper.java:134)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I fixed this with adding a NoEscapehandler: &lt;a href=&quot;https://github.com/apache/cxf/pull/365&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/365&lt;/a&gt;. Can you please have a look if this is good to fix the jdk9 failures ? &lt;/p&gt;</comment>
                            <comment id="16322130" author="githubbot" created="Thu, 11 Jan 2018 12:26:07 +0000"  >&lt;p&gt;ffang commented on issue #365: &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7520&quot; title=&quot;Ensure CXF can build with JDK9.0.1 and JDK8_161&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7520&quot;&gt;&lt;del&gt;CXF-7520&lt;/del&gt;&lt;/a&gt;:Ensure CXF can build with JDK9 GA(build 9+181)&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/cxf/pull/365#issuecomment-356919645&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/365#issuecomment-356919645&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @jimma , looks good to me.&lt;br/&gt;
   Just one thing, as this is JDK9 specific, could you please add a java9 profile in pom.xml and put jaxb-impl dependency there?&lt;br/&gt;
   Also how about add a code to check the jdk version , if it&apos;s jdk9, set the NoEscapeHandler?&lt;/p&gt;

&lt;p&gt;   Thanks!&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16322199" author="githubbot" created="Thu, 11 Jan 2018 13:29:51 +0000"  >&lt;p&gt;asoldano commented on issue #365: &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7520&quot; title=&quot;Ensure CXF can build with JDK9.0.1 and JDK8_161&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7520&quot;&gt;&lt;del&gt;CXF-7520&lt;/del&gt;&lt;/a&gt;:Ensure CXF can build with JDK9 GA(build 9+181)&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/cxf/pull/365#issuecomment-356934100&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/365#issuecomment-356934100&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @ffang, do you think that&apos;s really needed? As long as there&apos;s no side effect when running on older jdks, I don&apos;t think we should be increasing the complexity of the build.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16322202" author="githubbot" created="Thu, 11 Jan 2018 13:30:54 +0000"  >&lt;p&gt;asoldano commented on issue #365: &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7520&quot; title=&quot;Ensure CXF can build with JDK9.0.1 and JDK8_161&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7520&quot;&gt;&lt;del&gt;CXF-7520&lt;/del&gt;&lt;/a&gt;:Ensure CXF can build with JDK9 GA(build 9+181)&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/cxf/pull/365#issuecomment-356934100&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/365#issuecomment-356934100&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @ffang, do you think that&apos;s really needed? As long as there&apos;s no side effect when running on older jdks, I don&apos;t think we should be increasing the complexity of the build.&lt;/p&gt;

&lt;p&gt;   Similar reasoning for the NoEscapeHandler: @jimma , does the addition of that affect the execution with jdk 8?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16322216" author="githubbot" created="Thu, 11 Jan 2018 13:41:40 +0000"  >&lt;p&gt;dkulp commented on issue #365: &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7520&quot; title=&quot;Ensure CXF can build with JDK9.0.1 and JDK8_161&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7520&quot;&gt;&lt;del&gt;CXF-7520&lt;/del&gt;&lt;/a&gt;:Ensure CXF can build with JDK9 GA(build 9+181)&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/cxf/pull/365#issuecomment-356937052&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/365#issuecomment-356937052&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   The deps are scope=provided so they shouldn&apos;t affect anyone downstream as they won&apos;t be pulled in.  Thus, the profile is likely not needed.&lt;/p&gt;

&lt;p&gt;   HOWEVER, there is an issue at runtime if the com.sun.xml.bind.marshaller.CharacterEscapeHandler class is not found (example: using in JDK version of jaxb instead of the jar), then the writer won&apos;t be createable at all and everything will fail.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16322247" author="githubbot" created="Thu, 11 Jan 2018 14:05:41 +0000"  >&lt;p&gt;ffang commented on issue #365: &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7520&quot; title=&quot;Ensure CXF can build with JDK9.0.1 and JDK8_161&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7520&quot;&gt;&lt;del&gt;CXF-7520&lt;/del&gt;&lt;/a&gt;:Ensure CXF can build with JDK9 GA(build 9+181)&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/cxf/pull/365#issuecomment-356943373&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/365#issuecomment-356943373&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   java9 profile make the pom more organized, we know it&apos;s for java9 only, like a marker.  I think it&apos;s important for us to clearly know which is java9 specific, can help us to resolve similar issue in the future, as we have some clear marker to draw upon. &lt;/p&gt;

&lt;p&gt;   My 2 cents.&lt;/p&gt;


&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16322558" author="githubbot" created="Thu, 11 Jan 2018 17:01:59 +0000"  >&lt;p&gt;dkulp commented on issue #365: &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7520&quot; title=&quot;Ensure CXF can build with JDK9.0.1 and JDK8_161&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7520&quot;&gt;&lt;del&gt;CXF-7520&lt;/del&gt;&lt;/a&gt;:Ensure CXF can build with JDK9 GA(build 9+181)&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/cxf/pull/365#issuecomment-356992972&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/365#issuecomment-356992972&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   One more question:  does this actually WORK?    What happens if you try to send a &amp;lt; or a &amp;gt; character?  Those need to be escaped.   &lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16323450" author="githubbot" created="Fri, 12 Jan 2018 02:33:09 +0000"  >&lt;p&gt;jimma commented on issue #365: &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7520&quot; title=&quot;Ensure CXF can build with JDK9.0.1 and JDK8_161&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7520&quot;&gt;&lt;del&gt;CXF-7520&lt;/del&gt;&lt;/a&gt;:Ensure CXF can build with JDK9 GA(build 9+181)&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/cxf/pull/365#issuecomment-357125959&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/365#issuecomment-357125959&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   &amp;gt; Just  one thing, as this is JDK9 specific, could you please add a java9 profile in pom.xml and put jaxb-impl dependency there?&lt;br/&gt;
   Also how about add a code to check the jdk version , if it&apos;s jdk9, set the NoEscapeHandler?&lt;/p&gt;

&lt;p&gt;   @ffang  This fix is not only for jdk9. If we want to upgrade to jaxb2.3, we still need to set an escape handler to make jdk8 makes. &lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16325942" author="githubbot" created="Mon, 15 Jan 2018 07:19:52 +0000"  >&lt;p&gt;ffang commented on issue #365: &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7520&quot; title=&quot;Ensure CXF can build with JDK9.0.1 and JDK8_161&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7520&quot;&gt;&lt;del&gt;CXF-7520&lt;/del&gt;&lt;/a&gt;:Ensure CXF can build with JDK9 GA(build 9+181)&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/cxf/pull/365#issuecomment-357600643&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/365#issuecomment-357600643&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @jimma yeah, verified specify the MimiumEscapeHandler can fix the &lt;br/&gt;
   JSONProviderTest.testWriteNullValueAsString&lt;br/&gt;
   JSONProviderTest.testWriteNullValueAsNull&lt;br/&gt;
   with jdk9, however, we need set it in org.apache.cxf.jaxrs.provider.AbstractJAXBProvider when create the marshaller. &lt;br/&gt;
   I will go ahead to fix the broken jdk9 test failures based on your suggested solution.&lt;/p&gt;


&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16326020" author="githubbot" created="Mon, 15 Jan 2018 09:11:44 +0000"  >&lt;p&gt;ffang commented on issue #365: &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7520&quot; title=&quot;Ensure CXF can build with JDK9.0.1 and JDK8_161&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7520&quot;&gt;&lt;del&gt;CXF-7520&lt;/del&gt;&lt;/a&gt;:Ensure CXF can build with JDK9 GA(build 9+181)&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/cxf/pull/365#issuecomment-357600643&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/365#issuecomment-357600643&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @jimma yeah, verified specify the MimiumEscapeHandler can fix the &lt;br/&gt;
   JSONProviderTest.testWriteNullValueAsString&lt;br/&gt;
   JSONProviderTest.testWriteNullValueAsNull&lt;br/&gt;
   with jdk9, however, we need set it in org.apache.cxf.jaxrs.provider.AbstractJAXBProvider when create the marshaller. &lt;br/&gt;
   I will go ahead to fix the broken jdk9 test failures based on your suggested solution.&lt;br/&gt;
   Btw, I tested this with jaxb-core 2.2.11&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16326037" author="githubbot" created="Mon, 15 Jan 2018 09:38:37 +0000"  >&lt;p&gt;ffang commented on issue #365: &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7520&quot; title=&quot;Ensure CXF can build with JDK9.0.1 and JDK8_161&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7520&quot;&gt;&lt;del&gt;CXF-7520&lt;/del&gt;&lt;/a&gt;:Ensure CXF can build with JDK9 GA(build 9+181)&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/cxf/pull/365#issuecomment-357629633&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/365#issuecomment-357629633&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @jimma &lt;br/&gt;
   Continued test with jaxb-core 2.3.0.&lt;br/&gt;
   JSONProviderTest.testWriteNullValueAsString&lt;br/&gt;
   JSONProviderTest.testWriteNullValueAsNull&lt;br/&gt;
   still failed with jdk9, with MimiumEscapeHandler or your NoEscapeHandler I got same error&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16326073" author="githubbot" created="Mon, 15 Jan 2018 10:10:11 +0000"  >&lt;p&gt;jimma commented on issue #365: &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7520&quot; title=&quot;Ensure CXF can build with JDK9.0.1 and JDK8_161&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7520&quot;&gt;&lt;del&gt;CXF-7520&lt;/del&gt;&lt;/a&gt;:Ensure CXF can build with JDK9 GA(build 9+181)&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/cxf/pull/365#issuecomment-357637819&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/365#issuecomment-357637819&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @ffang  Looks we have to add our customized MininumEscpapeHandler to write a empty string like&lt;/p&gt;

&lt;p&gt;    ```&lt;br/&gt;
   public class CXFMinimumEscapeHandler implements CharacterEscapeHandler {&lt;br/&gt;
       private CXFMinimumEscapeHandler() {&lt;br/&gt;
       }&lt;br/&gt;
       public static final CharacterEscapeHandler HANDLER = new CXFMinimumEscapeHandler();&lt;br/&gt;
       public void escape(char[] ch, int start, int length, boolean isAttVal, Writer out) throws IOException {&lt;br/&gt;
           if (length == 0 &amp;amp;&amp;amp; start == 0) &lt;/p&gt;
{
               out.write(ch[start]);
               return;
           }
&lt;p&gt; else &lt;/p&gt;
{
               MinimumEscapeHandler.theInstance.escape(ch, start, length, isAttVal, out);
           }
&lt;p&gt;       }&lt;br/&gt;
   }&lt;br/&gt;
   ```&lt;br/&gt;
   Besides this new class, we need to add another method in JAXBUtil to set escape handler property to jMarshaller. Then DataWriterImpl and AbstractJAXBProvider can both invoke this util method to set customized escape handler after marshller created.  To support jdk&apos;s internal jaxb class, we may need to create a  minimum escape handler class with asm like what we did for NamespaceMapper.  Do you think this will fix all the things ?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16326076" author="githubbot" created="Mon, 15 Jan 2018 10:10:43 +0000"  >&lt;p&gt;jimma commented on issue #365: &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7520&quot; title=&quot;Ensure CXF can build with JDK9.0.1 and JDK8_161&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7520&quot;&gt;&lt;del&gt;CXF-7520&lt;/del&gt;&lt;/a&gt;:Ensure CXF can build with JDK9 GA(build 9+181)&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/cxf/pull/365#issuecomment-357637819&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/365#issuecomment-357637819&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @ffang  Looks we have to add our customized MininumEscpapeHandler to write a empty string like&lt;/p&gt;

&lt;p&gt;    ```&lt;br/&gt;
   public class CXFMinimumEscapeHandler implements CharacterEscapeHandler {&lt;br/&gt;
       private CXFMinimumEscapeHandler() {&lt;br/&gt;
       }&lt;br/&gt;
       public static final CharacterEscapeHandler HANDLER = new CXFMinimumEscapeHandler();&lt;br/&gt;
       public void escape(char[] ch, int start, int length, boolean isAttVal, Writer out) throws IOException {&lt;br/&gt;
           if (length == 0 &amp;amp;&amp;amp; start == 0) &lt;/p&gt;
{
               out.write(ch[start]);
               return;
           }
&lt;p&gt; else &lt;/p&gt;
{
               MinimumEscapeHandler.theInstance.escape(ch, start, length, isAttVal, out);
           }
&lt;p&gt;       }&lt;br/&gt;
   }&lt;br/&gt;
   ```&lt;br/&gt;
   Besides this new class, we need to add another method in JAXBUtil to set escape handler property to Marshaller. Then DataWriterImpl and AbstractJAXBProvider can both invoke this util method to set customized escape handler after marshaller created.  To support jdk&apos;s internal jaxb class, we may need to create a  minimum escape handler class with asm like what we did for NamespaceMapper.  Do you think this will fix all the things ?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16326098" author="githubbot" created="Mon, 15 Jan 2018 10:41:24 +0000"  >&lt;p&gt;ffang commented on issue #365: &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7520&quot; title=&quot;Ensure CXF can build with JDK9.0.1 and JDK8_161&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7520&quot;&gt;&lt;del&gt;CXF-7520&lt;/del&gt;&lt;/a&gt;:Ensure CXF can build with JDK9 GA(build 9+181)&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/cxf/pull/365#issuecomment-357645837&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/365#issuecomment-357645837&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @jimma about we need extend EscapeHandler to support the empty string, I just found same and got &lt;br/&gt;
   JSONProviderTest.testWriteNullValueAsString&lt;br/&gt;
   JSONProviderTest.testWriteNullValueAsNull&lt;br/&gt;
   passed with jdk9 + jaxb-core 2.3,  ensure empty string can call into out.write is the key part to reverse the behavior changed in both jdk9 and jaxb-core 2.3.&lt;br/&gt;
   And I agree that we should add Extended EscapeHandler in cxf-core module, as it has jaxb-core dependency and even a jaxb package there already.&lt;/p&gt;

&lt;p&gt;   Append a patch what I got so far, this is to fix JSONProviderTest failure with jdk9 oriented so it didn&apos;t include your fix in jaxb databinding module&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;CXF-7520-20180115.txt&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://github.com/apache/cxf/files/1631328/CXF-7520-20180115.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/files/1631328/CXF-7520-20180115.txt&lt;/a&gt;)&lt;/p&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16329905" author="githubbot" created="Thu, 18 Jan 2018 02:43:11 +0000"  >&lt;p&gt;jimma commented on issue #365: &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7520&quot; title=&quot;Ensure CXF can build with JDK9.0.1 and JDK8_161&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7520&quot;&gt;&lt;del&gt;CXF-7520&lt;/del&gt;&lt;/a&gt;:Ensure CXF can build with JDK9 GA(build 9+181)&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/cxf/pull/365#issuecomment-358520108&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/365#issuecomment-358520108&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @ffang @dkulp @asoldano  I updated the change to set our customized MinimumEscapeHandler and support jdk internal jaxb, please review. &lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16331790" author="githubbot" created="Fri, 19 Jan 2018 06:11:08 +0000"  >&lt;p&gt;jimma closed pull request #365: &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7520&quot; title=&quot;Ensure CXF can build with JDK9.0.1 and JDK8_161&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7520&quot;&gt;&lt;del&gt;CXF-7520&lt;/del&gt;&lt;/a&gt;:Ensure CXF can build with JDK9 GA(build 9+181)&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/cxf/pull/365&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/365&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/core/src/main/java/org/apache/cxf/common/jaxb/EscapeHandlerInvocationHandler.java b/core/src/main/java/org/apache/cxf/common/jaxb/EscapeHandlerInvocationHandler.java&lt;br/&gt;
new file mode 100644&lt;br/&gt;
index 00000000000..64f1385ac46&lt;br/&gt;
&amp;#8212; /dev/null&lt;br/&gt;
+++ b/core/src/main/java/org/apache/cxf/common/jaxb/EscapeHandlerInvocationHandler.java&lt;br/&gt;
@@ -0,0 +1,45 @@&lt;br/&gt;
+/**&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
+ * or more contributor license agreements. See the NOTICE file&lt;br/&gt;
+ * distributed with this work for additional information&lt;br/&gt;
+ * regarding copyright ownership. The ASF licenses this file&lt;br/&gt;
+ * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
+ * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
+ * with the License. You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ * &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing,&lt;br/&gt;
+ * software distributed under the License is distributed on an&lt;br/&gt;
+ * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY&lt;br/&gt;
+ * KIND, either express or implied. See the License for the&lt;br/&gt;
+ * specific language governing permissions and limitations&lt;br/&gt;
+ * under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+package org.apache.cxf.common.jaxb;&lt;br/&gt;
+&lt;br/&gt;
+import java.io.Writer;&lt;br/&gt;
+import java.lang.reflect.InvocationHandler;&lt;br/&gt;
+import java.lang.reflect.Method;&lt;br/&gt;
+&lt;br/&gt;
+public final class EscapeHandlerInvocationHandler implements InvocationHandler {&lt;br/&gt;
+&lt;br/&gt;
+    private Object target; &lt;br/&gt;
+    public EscapeHandlerInvocationHandler(Object obj) &lt;/p&gt;
{
+        target = obj;
+    }
&lt;p&gt;+    @Override&lt;br/&gt;
+    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {&lt;br/&gt;
+        Object result = null;&lt;br/&gt;
+        if (method.getName().equals(&quot;escape&quot;) &amp;amp;&amp;amp; args.length == 5) {&lt;br/&gt;
+            if ((Integer)args&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; == 0 &amp;amp;&amp;amp; (Integer)args&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; == 0) &lt;/p&gt;
{
+                Writer writer = (Writer)args[4];
+                writer.write(&quot;&quot;);
+                return null;
+            }
&lt;p&gt;+            result =  method.invoke(target, args);&lt;br/&gt;
+        } &lt;br/&gt;
+        return result;&lt;br/&gt;
+    }&lt;br/&gt;
+    &lt;br/&gt;
+}&lt;br/&gt;
diff --git a/core/src/main/java/org/apache/cxf/common/jaxb/JAXBUtils.java b/core/src/main/java/org/apache/cxf/common/jaxb/JAXBUtils.java&lt;br/&gt;
index e33a12188d5..685cb077d9f 100644&lt;br/&gt;
&amp;#8212; a/core/src/main/java/org/apache/cxf/common/jaxb/JAXBUtils.java&lt;br/&gt;
+++ b/core/src/main/java/org/apache/cxf/common/jaxb/JAXBUtils.java&lt;br/&gt;
@@ -30,6 +30,7 @@&lt;br/&gt;
 import java.lang.annotation.ElementType;&lt;br/&gt;
 import java.lang.annotation.Target;&lt;br/&gt;
 import java.lang.reflect.Constructor;&lt;br/&gt;
+import java.lang.reflect.InvocationHandler;&lt;br/&gt;
 import java.lang.reflect.Method;&lt;br/&gt;
 import java.lang.reflect.Proxy;&lt;br/&gt;
 import java.lang.reflect.Type;&lt;br/&gt;
@@ -85,6 +86,7 @@&lt;br/&gt;
 import org.apache.cxf.common.util.ASMHelper.Opcodes;&lt;br/&gt;
 import org.apache.cxf.common.util.CachedClass;&lt;br/&gt;
 import org.apache.cxf.common.util.PackageUtils;&lt;br/&gt;
+import org.apache.cxf.common.util.ProxyHelper;&lt;br/&gt;
 import org.apache.cxf.common.util.ReflectionInvokationHandler;&lt;br/&gt;
 import org.apache.cxf.common.util.ReflectionInvokationHandler.WrapReturn;&lt;br/&gt;
 import org.apache.cxf.common.util.ReflectionUtil;&lt;br/&gt;
@@ -123,6 +125,7 @@&lt;br/&gt;
     private static final Map&amp;lt;String, String&amp;gt; BUILTIN_DATATYPES_MAP;&lt;br/&gt;
     private static final Map&amp;lt;String, Class&amp;lt;?&amp;gt;&amp;gt; HOLDER_TYPES_MAP;&lt;br/&gt;
     private static ClassLoader jaxbXjcLoader;&lt;br/&gt;
+    private static Object jaxbEscapeHandler;&lt;/p&gt;

&lt;p&gt;     static {&lt;br/&gt;
         BUILTIN_DATATYPES_MAP = new HashMap&amp;lt;&amp;gt;();&lt;br/&gt;
@@ -1531,4 +1534,44 @@ public static JAXBBeanInfo getBeanInfo(JAXBContextProxy context, Class&amp;lt;?&amp;gt; cls) &lt;/p&gt;
{
         return ReflectionInvokationHandler.createProxyWrapper(o, JAXBBeanInfo.class);
     }

&lt;p&gt;+    public static void setMinimumEscapeHandler(Marshaller marshaller) {&lt;br/&gt;
+        String postFix = &quot;&quot;;&lt;br/&gt;
+        if (marshaller.getClass().getName().contains(&quot;com.sun.xml.internal&quot;)&lt;br/&gt;
+            || marshaller.getClass().getName().contains(&quot;eclipse&quot;)) &lt;/p&gt;
{
+            //eclipse moxy accepts sun package CharacterEscapeHandler 
+            postFix = &quot;.internal&quot;;
+        }
&lt;p&gt; else if (marshaller.getClass().getName().contains(&quot;com.sun.xml.bind&quot;)) &lt;/p&gt;
{
+            postFix = &quot;&quot;;
+        }
&lt;p&gt; else &lt;/p&gt;
{
+            LOG.log(Level.WARNING, &quot;Failed to set MinumEscapeHandler for unknown jaxb marshaller:&quot;
+                                   + marshaller);
+            return;
+        }
&lt;p&gt;+        try {&lt;br/&gt;
+            Class&amp;lt;?&amp;gt; handlerClass = ClassLoaderUtils.loadClass(&quot;com.sun.xml&quot; + postFix&lt;br/&gt;
+                                                                   + &quot;.bind.marshaller.MinimumEscapeHandler&quot;,&lt;br/&gt;
+                                                               marshaller.getClass());&lt;br/&gt;
+            Class&amp;lt;?&amp;gt; handlerInterface = ClassLoaderUtils&lt;br/&gt;
+                .loadClass(&quot;com.sun.xml&quot; + postFix + &quot;.bind.marshaller.CharacterEscapeHandler&quot;,&lt;br/&gt;
+                           marshaller.getClass());&lt;br/&gt;
+            Object targetHandler = ReflectionUtil.getDeclaredField(handlerClass, &quot;theInstance&quot;).get(null);&lt;br/&gt;
+            Object escapeHandler = getEscapeHandlerInstance(marshaller.getClass().getClassLoader(),&lt;br/&gt;
+                                                            new Class[] &lt;/p&gt;
{handlerInterface}
&lt;p&gt;,&lt;br/&gt;
+                                                            new EscapeHandlerInvocationHandler(targetHandler));&lt;br/&gt;
+            marshaller.setProperty(&quot;com.sun.xml&quot; + postFix + &quot;.bind.characterEscapeHandler&quot;, escapeHandler);&lt;br/&gt;
+        } catch (Exception e) &lt;/p&gt;
{
+            e.printStackTrace();
+            LOG.log(Level.INFO, &quot;Failed to set MinumEscapeHandler to jaxb marshaller&quot;, e);
+        }
&lt;p&gt;+    }&lt;br/&gt;
+&lt;br/&gt;
+    private static synchronized Object getEscapeHandlerInstance(ClassLoader loader, Class&amp;lt;?&amp;gt;[] interfaces,&lt;br/&gt;
+                                                                InvocationHandler handler) {&lt;br/&gt;
+        if (jaxbEscapeHandler == null) &lt;/p&gt;
{
+            jaxbEscapeHandler = ProxyHelper.getProxy(loader, interfaces, handler);
+        }
&lt;p&gt;+        return jaxbEscapeHandler;&lt;br/&gt;
+    }&lt;br/&gt;
+    &lt;br/&gt;
+&lt;br/&gt;
 }&lt;br/&gt;
diff --git a/rt/databinding/jaxb/src/main/java/org/apache/cxf/jaxb/io/DataWriterImpl.java b/rt/databinding/jaxb/src/main/java/org/apache/cxf/jaxb/io/DataWriterImpl.java&lt;br/&gt;
index 5ca0a3661a8..992e2924bff 100644&lt;br/&gt;
&amp;#8212; a/rt/databinding/jaxb/src/main/java/org/apache/cxf/jaxb/io/DataWriterImpl.java&lt;br/&gt;
+++ b/rt/databinding/jaxb/src/main/java/org/apache/cxf/jaxb/io/DataWriterImpl.java&lt;br/&gt;
@@ -130,6 +130,8 @@ public Marshaller createMarshaller(Object elValue, MessagePartInfo part) {&lt;br/&gt;
             marshaller.setProperty(Marshaller.JAXB_FRAGMENT, true);&lt;br/&gt;
             marshaller.setProperty(Marshaller.JAXB_FORMATTED_OUTPUT, Boolean.FALSE);&lt;br/&gt;
             marshaller.setListener(databinding.getMarshallerListener());&lt;br/&gt;
+            JAXBUtils.setMinimumEscapeHandler(marshaller);&lt;br/&gt;
+&lt;br/&gt;
             if (setEventHandler) {&lt;br/&gt;
                 ValidationEventHandler h = veventHandler;&lt;br/&gt;
                 if (veventHandler == null) {&lt;br/&gt;
diff --git a/rt/frontend/jaxrs/src/main/java/org/apache/cxf/jaxrs/provider/AbstractJAXBProvider.java b/rt/frontend/jaxrs/src/main/java/org/apache/cxf/jaxrs/provider/AbstractJAXBProvider.java&lt;br/&gt;
index eed47448c84..c9ae400d300 100644&lt;br/&gt;
&amp;#8212; a/rt/frontend/jaxrs/src/main/java/org/apache/cxf/jaxrs/provider/AbstractJAXBProvider.java&lt;br/&gt;
+++ b/rt/frontend/jaxrs/src/main/java/org/apache/cxf/jaxrs/provider/AbstractJAXBProvider.java&lt;br/&gt;
@@ -627,6 +627,7 @@ protected Marshaller createMarshaller(Object obj, Class&amp;lt;?&amp;gt; cls, Type genericType&lt;br/&gt;
         if (marshallerListener != null) &lt;/p&gt;
{
             marshaller.setListener(marshallerListener);
         }
&lt;p&gt;+        JAXBUtils.setMinimumEscapeHandler(marshaller);&lt;br/&gt;
         validateObjectIfNeeded(marshaller, cls, obj);&lt;br/&gt;
         return marshaller;&lt;br/&gt;
     }&lt;br/&gt;
diff --git a/rt/rs/extensions/providers/src/test/java/org/apache/cxf/jaxrs/provider/json/JSONProviderTest.java b/rt/rs/extensions/providers/src/test/java/org/apache/cxf/jaxrs/provider/json/JSONProviderTest.java&lt;br/&gt;
index 02e0ae80427..49dbd953e27 100644&lt;br/&gt;
&amp;#8212; a/rt/rs/extensions/providers/src/test/java/org/apache/cxf/jaxrs/provider/json/JSONProviderTest.java&lt;br/&gt;
+++ b/rt/rs/extensions/providers/src/test/java/org/apache/cxf/jaxrs/provider/json/JSONProviderTest.java&lt;br/&gt;
@@ -325,15 +325,11 @@ public void testEscapeForwardSlashesAlways() throws Exception {&lt;/p&gt;

&lt;p&gt;     @Test&lt;br/&gt;
     public void testWriteNullValueAsString() throws Exception {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (!System.getProperty(&quot;java.version&quot;).startsWith(&quot;9&quot;)) 
{
-            doTestWriteNullValue(true);
-        }
&lt;p&gt;+        doTestWriteNullValue(true);&lt;br/&gt;
     }&lt;br/&gt;
     @Test&lt;br/&gt;
     public void testWriteNullValueAsNull() throws Exception {&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;if (!System.getProperty(&quot;java.version&quot;).startsWith(&quot;9&quot;)) 
{
-            doTestWriteNullValue(false);
-        }
&lt;p&gt;+        doTestWriteNullValue(false);&lt;br/&gt;
     }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     private void doTestWriteNullValue(boolean nullAsString) throws Exception {&lt;br/&gt;
@@ -1952,7 +1948,7 @@ public void writeCharacters(String text) throws XMLStreamException {&lt;br/&gt;
         public void writeCharacters(char[] text, int arg1, int arg2) throws XMLStreamException {&lt;br/&gt;
             String str = new String(text);&lt;br/&gt;
             if (StringUtils.isEmpty(str.trim())) &lt;/p&gt;
{
-                super.writeCharacters(null, arg1, arg2);
+                super.writeCharacters(null);
             }
&lt;p&gt; else &lt;/p&gt;
{
                 super.writeCharacters(text, arg1, arg2);
             }




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16340621" author="githubbot" created="Fri, 26 Jan 2018 06:34:46 +0000"  >&lt;p&gt;jimma opened a new pull request #371: &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7520&quot; title=&quot;Ensure CXF can build with JDK9.0.1 and JDK8_161&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7520&quot;&gt;&lt;del&gt;CXF-7520&lt;/del&gt;&lt;/a&gt;:Set NoEscapeHandler for fastinfoset content type to fix co&#8230;&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/cxf/pull/371&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/371&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   &#8230;uple of test failures; Fix javascript test&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16343264" author="githubbot" created="Mon, 29 Jan 2018 11:54:46 +0000"  >&lt;p&gt;ffang commented on issue #371: &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7520&quot; title=&quot;Ensure CXF can build with JDK9.0.1 and JDK8_161&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7520&quot;&gt;&lt;del&gt;CXF-7520&lt;/del&gt;&lt;/a&gt;:Set NoEscapeHandler for fastinfoset content type to fix co&#8230;&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/cxf/pull/371#issuecomment-361223198&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/371#issuecomment-361223198&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Hi @jimma , &lt;br/&gt;
   All tests passed with jdk 1.8.161 and jdk 9.0.1 now, thanks!&lt;br/&gt;
   Please merge&lt;br/&gt;
   Freeman&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16343379" author="githubbot" created="Mon, 29 Jan 2018 14:06:58 +0000"  >&lt;p&gt;jimma closed pull request #371: &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7520&quot; title=&quot;Ensure CXF can build with JDK9.0.1 and JDK8_161&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7520&quot;&gt;&lt;del&gt;CXF-7520&lt;/del&gt;&lt;/a&gt;:Set NoEscapeHandler for fastinfoset content type;Fix couple of test failures&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/cxf/pull/371&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/371&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/core/src/main/java/org/apache/cxf/common/jaxb/JAXBUtils.java b/core/src/main/java/org/apache/cxf/common/jaxb/JAXBUtils.java&lt;br/&gt;
index fb2d51fd1bb..352fc92e15a 100644&lt;br/&gt;
&amp;#8212; a/core/src/main/java/org/apache/cxf/common/jaxb/JAXBUtils.java&lt;br/&gt;
+++ b/core/src/main/java/org/apache/cxf/common/jaxb/JAXBUtils.java&lt;br/&gt;
@@ -46,6 +46,7 @@&lt;br/&gt;
 import java.util.Iterator;&lt;br/&gt;
 import java.util.List;&lt;br/&gt;
 import java.util.Map;&lt;br/&gt;
+import java.util.Optional;&lt;br/&gt;
 import java.util.Set;&lt;br/&gt;
 import java.util.StringTokenizer;&lt;br/&gt;
 import java.util.logging.Level;&lt;br/&gt;
@@ -124,7 +125,8 @@&lt;br/&gt;
     private static final Map&amp;lt;String, String&amp;gt; BUILTIN_DATATYPES_MAP;&lt;br/&gt;
     private static final Map&amp;lt;String, Class&amp;lt;?&amp;gt;&amp;gt; HOLDER_TYPES_MAP;&lt;br/&gt;
     private static ClassLoader jaxbXjcLoader;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private static volatile Object jaxbEscapeHandler;&lt;br/&gt;
+    private static volatile Optional&amp;lt;Object&amp;gt; jaxbMinimumEscapeHandler;&lt;br/&gt;
+    private static volatile Optional&amp;lt;Object&amp;gt; jaxbNoEscapeHandler;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     static {&lt;br/&gt;
         BUILTIN_DATATYPES_MAP = new HashMap&amp;lt;&amp;gt;();&lt;br/&gt;
@@ -1543,32 +1545,55 @@ private static String getPostfix(Class&amp;lt;?&amp;gt; cls) {&lt;br/&gt;
         }&lt;br/&gt;
         return null;&lt;br/&gt;
     }&lt;br/&gt;
+&lt;br/&gt;
     public static void setMinimumEscapeHandler(Marshaller marshaller) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (jaxbEscapeHandler == null) {&lt;/li&gt;
	&lt;li&gt;jaxbEscapeHandler = createEscapeHandler(marshaller.getClass());&lt;br/&gt;
+        if (jaxbMinimumEscapeHandler == null) 
{
+            jaxbMinimumEscapeHandler = Optional.ofNullable(createMininumEscapeHandler(marshaller.getClass()));
+        }
&lt;p&gt;+        //if escape handler class is not loaded&lt;br/&gt;
+        if (jaxbMinimumEscapeHandler.isPresent()) &lt;/p&gt;
{
+            setEscapeHandler(marshaller, jaxbMinimumEscapeHandler.get());
+        }
&lt;p&gt;+&lt;br/&gt;
+    }&lt;br/&gt;
+&lt;br/&gt;
+    public static void setNoEscapeHandler(Marshaller marshaller) {&lt;br/&gt;
+        if (jaxbNoEscapeHandler == null) &lt;/p&gt;
{
+            jaxbNoEscapeHandler = Optional.ofNullable(createNoEscapeHandler(marshaller.getClass()));
+        }
&lt;p&gt;+        //if escape handler class is not loaded&lt;br/&gt;
+        if (jaxbNoEscapeHandler.isPresent()) &lt;/p&gt;
{
+            setEscapeHandler(marshaller, jaxbNoEscapeHandler.get());
         }&lt;/li&gt;
	&lt;li&gt;setMinimumEscapeHandler(marshaller, jaxbEscapeHandler);&lt;br/&gt;
     }&lt;/li&gt;
	&lt;li&gt;public static void setMinimumEscapeHandler(Marshaller marshaller, Object escapeHandler) {&lt;br/&gt;
+    &lt;br/&gt;
+    public static void setEscapeHandler(Marshaller marshaller, Object escapeHandler) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {         try {
             String postFix = getPostfix(marshaller.getClass());
             marshaller.setProperty(&quot;com.sun.xml&quot; + postFix + &quot;.bind.characterEscapeHandler&quot;, escapeHandler);
         } catch (PropertyException e) {
-            e.printStackTrace();
             LOG.log(Level.INFO, &quot;Failed to set MinumEscapeHandler to jaxb marshaller&quot;, e);
         }     }&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public static Object createEscapeHandler(Class&amp;lt;?&amp;gt; cls) {&lt;br/&gt;
+    public static Object createMininumEscapeHandler(Class&amp;lt;?&amp;gt; cls) 
{
+        return createEscapeHandler(cls, &quot;MinimumEscapeHandler&quot;);
+    }
&lt;p&gt;+    &lt;br/&gt;
+    public static Object createNoEscapeHandler(Class&amp;lt;?&amp;gt; cls) &lt;/p&gt;
{
+        return createEscapeHandler(cls, &quot;NoEscapeHandler&quot;);
+    }
&lt;p&gt;+    &lt;br/&gt;
+    private static Object createEscapeHandler(Class&amp;lt;?&amp;gt; cls, String simpleClassName) {&lt;br/&gt;
         try {&lt;br/&gt;
             String postFix = getPostfix(cls);&lt;br/&gt;
             if (postFix == null) &lt;/p&gt;
{
-                LOG.log(Level.WARNING, &quot;Failed to create MinumEscapeHandler for unknown jaxb class:&quot;
+                LOG.log(Level.WARNING, &quot;Failed to create&quot; + simpleClassName + &quot; for unknown jaxb class:&quot;
                     + cls);
                 return null;
             }
&lt;p&gt;             Class&amp;lt;?&amp;gt; handlerClass = ClassLoaderUtils.loadClass(&quot;com.sun.xml&quot; + postFix&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;+ &quot;.bind.marshaller.MinimumEscapeHandler&quot;,&lt;br/&gt;
+                                                                   + &quot;.bind.marshaller.&quot; + simpleClassName,&lt;br/&gt;
                                                                cls);&lt;br/&gt;
             Class&amp;lt;?&amp;gt; handlerInterface = ClassLoaderUtils&lt;br/&gt;
                 .loadClass(&quot;com.sun.xml&quot; + postFix + &quot;.bind.marshaller.CharacterEscapeHandler&quot;,&lt;br/&gt;
@@ -1578,8 +1603,7 @@ public static Object createEscapeHandler(Class&amp;lt;?&amp;gt; cls) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {                                         new Class[] {handlerInterface},                                         new EscapeHandlerInvocationHandler(targetHandler));         }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt; catch (Exception e) &lt;/p&gt;
{
-            e.printStackTrace();
-            LOG.log(Level.INFO, &quot;Failed to create MinumEscapeHandler&quot;, e);
+            LOG.log(Level.INFO, &quot;Failed to create &quot; + simpleClassName);
         }
&lt;p&gt;         return null;&lt;br/&gt;
     }&lt;br/&gt;
diff --git a/rt/databinding/jaxb/src/main/java/org/apache/cxf/jaxb/JAXBDataBinding.java b/rt/databinding/jaxb/src/main/java/org/apache/cxf/jaxb/JAXBDataBinding.java&lt;br/&gt;
index 6a9648d60cf..20ab5c21e56 100644&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/rt/databinding/jaxb/src/main/java/org/apache/cxf/jaxb/JAXBDataBinding.java&lt;br/&gt;
+++ b/rt/databinding/jaxb/src/main/java/org/apache/cxf/jaxb/JAXBDataBinding.java&lt;br/&gt;
@@ -243,20 +243,26 @@ public JAXBDataBinding(JAXBContext context) 
{
         this();
         setContext(context);
     }
&lt;p&gt;-&lt;br/&gt;
+    &lt;br/&gt;
     public JAXBContext getContext() &lt;/p&gt;
{
         return context;
     }&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     public final void setContext(JAXBContext ctx) &lt;/p&gt;
{
         context = ctx;
-        escapeHandler = JAXBUtils.createEscapeHandler(ctx.getClass());
+        //create default MininumEscapeHandler
+        escapeHandler = JAXBUtils.createMininumEscapeHandler(ctx.getClass());
     }

&lt;p&gt;     public Object getEscapeHandler() &lt;/p&gt;
{
         return escapeHandler;
     }

&lt;p&gt;+    public void setEscapeHandler(Object handler) &lt;/p&gt;
{
+        escapeHandler = handler;
+        
+    }
&lt;p&gt;+    &lt;br/&gt;
     @SuppressWarnings(&quot;unchecked&quot;)&lt;br/&gt;
     public &amp;lt;T&amp;gt; DataWriter&amp;lt;T&amp;gt; createWriter(Class&amp;lt;T&amp;gt; c) {&lt;/p&gt;

&lt;p&gt;diff --git a/rt/databinding/jaxb/src/main/java/org/apache/cxf/jaxb/io/DataWriterImpl.java b/rt/databinding/jaxb/src/main/java/org/apache/cxf/jaxb/io/DataWriterImpl.java&lt;br/&gt;
index a8ae15a3406..b342c32b969 100644&lt;br/&gt;
&amp;#8212; a/rt/databinding/jaxb/src/main/java/org/apache/cxf/jaxb/io/DataWriterImpl.java&lt;br/&gt;
+++ b/rt/databinding/jaxb/src/main/java/org/apache/cxf/jaxb/io/DataWriterImpl.java&lt;br/&gt;
@@ -59,6 +59,7 @@&lt;/p&gt;

&lt;p&gt;     ValidationEventHandler veventHandler;&lt;br/&gt;
     boolean setEventHandler = true;&lt;br/&gt;
+    boolean noEscape;&lt;br/&gt;
     private JAXBDataBinding databinding;&lt;/p&gt;

&lt;p&gt;     public DataWriterImpl(JAXBDataBinding binding) {&lt;br/&gt;
@@ -79,6 +80,10 @@ public void setProperty(String prop, Object value) {&lt;br/&gt;
             }&lt;br/&gt;
             setEventHandler = MessageUtils.getContextualBoolean(m,&lt;br/&gt;
                     JAXBDataBinding.SET_VALIDATION_EVENT_HANDLER, true);&lt;br/&gt;
+            Object contentType = m.get(org.apache.cxf.message.Message.CONTENT_TYPE);&lt;br/&gt;
+            if (contentType != null &amp;amp;&amp;amp; contentType.toString().contains(&quot;fastinfoset&quot;)) &lt;/p&gt;
{
+                noEscape = true;
+            }
&lt;p&gt;         }&lt;br/&gt;
     }&lt;/p&gt;

&lt;p&gt;@@ -130,7 +135,11 @@ public Marshaller createMarshaller(Object elValue, MessagePartInfo part) {&lt;br/&gt;
             marshaller.setProperty(Marshaller.JAXB_FRAGMENT, true);&lt;br/&gt;
             marshaller.setProperty(Marshaller.JAXB_FORMATTED_OUTPUT, Boolean.FALSE);&lt;br/&gt;
             marshaller.setListener(databinding.getMarshallerListener());&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;JAXBUtils.setMinimumEscapeHandler(marshaller, databinding.getEscapeHandler());&lt;br/&gt;
+            if (noEscape || databinding.getEscapeHandler() == null) 
{
+                JAXBUtils.setNoEscapeHandler(marshaller);
+            }
&lt;p&gt; else &lt;/p&gt;
{
+                JAXBUtils.setEscapeHandler(marshaller, databinding.getEscapeHandler());
+            }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;             if (setEventHandler) {&lt;br/&gt;
                 ValidationEventHandler h = veventHandler;&lt;br/&gt;
diff --git a/rt/javascript/javascript-tests/src/test/resources/deserializationTests.js b/rt/javascript/javascript-tests/src/test/resources/deserializationTests.js&lt;br/&gt;
index c42c26d8a35..5c0d10c057f 100644&lt;br/&gt;
&amp;#8212; a/rt/javascript/javascript-tests/src/test/resources/deserializationTests.js&lt;br/&gt;
+++ b/rt/javascript/javascript-tests/src/test/resources/deserializationTests.js&lt;br/&gt;
@@ -34,8 +34,9 @@ function deserializeTestBean3_1(xmlString)&lt;br/&gt;
 {&lt;br/&gt;
 	var dom = parseXml(xmlString);&lt;br/&gt;
 	var bean = org_apache_cxf_javascript_testns_testBean1_deserialize(jsutils, dom);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if(bean.getStringItem() != &quot;bean1&amp;gt;stringItem&quot;)&lt;/li&gt;
	&lt;li&gt;assertionFailed(&quot;deserializeTestBean3_1 stringItem &quot; + bean.getStringItem());&lt;br/&gt;
+ 	//since jdk1.8_161 and jdk9 escape &apos;&amp;gt;&apos; character&lt;br/&gt;
+ 	if(bean.getStringItem() != &quot;bean1&amp;gt;stringItem&quot; &amp;amp;&amp;amp; bean.getStringItem() != &quot;bean1&amp;gt;stringItem&quot;)&lt;br/&gt;
+  		assertionFailed(&quot;deserializeTestBean3_1 stringItem &quot; + bean.getStringItem());&lt;br/&gt;
 	if(bean.getIntItem() != 43)&lt;br/&gt;
 		assertionFailed(&quot;deserializeTestBean3_1 intItem &quot; + bean.getIntItem());&lt;br/&gt;
 	if(bean.getLongItem() != 0)&lt;br/&gt;
diff --git a/rt/ws/addr/src/main/java/org/apache/cxf/ws/addressing/soap/MAPCodec.java b/rt/ws/addr/src/main/java/org/apache/cxf/ws/addressing/soap/MAPCodec.java&lt;br/&gt;
index 4967467ba29..f1348147fad 100644
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/rt/ws/addr/src/main/java/org/apache/cxf/ws/addressing/soap/MAPCodec.java&lt;br/&gt;
+++ b/rt/ws/addr/src/main/java/org/apache/cxf/ws/addressing/soap/MAPCodec.java&lt;br/&gt;
@@ -715,8 +715,10 @@ private AddressingProperties decode(SoapMessage message) {&lt;br/&gt;
                                  Class&amp;lt;T&amp;gt; clz,&lt;br/&gt;
                                  JAXBContext ctx,&lt;br/&gt;
                                  boolean mustUnderstand) throws JAXBException 
{
+        JAXBDataBinding jaxbDataBinding = new JAXBDataBinding(ctx);
+        jaxbDataBinding.setEscapeHandler(null);
         SoapHeader h = new SoapHeader(qname, new JAXBElement&amp;lt;T&amp;gt;(qname, clz, value),
-                                      new JAXBDataBinding(ctx));
+                                      jaxbDataBinding);
         h.setMustUnderstand(mustUnderstand);
         message.getHeaders().add(h);
     }
&lt;p&gt;diff --git a/testutils/src/main/java/org/apache/cxf/testutil/common/ServerLauncher.java b/testutils/src/main/java/org/apache/cxf/testutil/common/ServerLauncher.java&lt;br/&gt;
index ed2f0bf0291..873c40fac95 100644&lt;/p&gt;&lt;/li&gt;
			&lt;li&gt;a/testutils/src/main/java/org/apache/cxf/testutil/common/ServerLauncher.java&lt;br/&gt;
+++ b/testutils/src/main/java/org/apache/cxf/testutil/common/ServerLauncher.java&lt;br/&gt;
@@ -30,6 +30,7 @@&lt;br/&gt;
 import java.net.URL;&lt;br/&gt;
 import java.net.URLClassLoader;&lt;br/&gt;
 import java.nio.file.Files;&lt;br/&gt;
+import java.nio.file.NoSuchFileException;&lt;br/&gt;
 import java.nio.file.Paths;&lt;br/&gt;
 import java.util.ArrayList;&lt;br/&gt;
 import java.util.HashMap;&lt;br/&gt;
@@ -287,17 +288,21 @@ public void run() {&lt;br/&gt;
             try {&lt;br/&gt;
                 try 
{
                     os = Files.newOutputStream(Paths.get(outputDir + className + &quot;.out&quot;));
-                }
&lt;p&gt; catch (FileNotFoundException fex) {&lt;/p&gt;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;outputDir = System.getProperty(&quot;basedir&quot;);&lt;/li&gt;
	&lt;li&gt;if (outputDir == null) 
{
-                        outputDir = &quot;target/surefire-reports/&quot;;
+                }
&lt;p&gt; catch (IOException ioe) {&lt;br/&gt;
+                    if (ioe instanceof FileNotFoundException || ioe instanceof NoSuchFileException) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+                        outputDir = System.getProperty(&amp;quot;basedir&amp;quot;);+                        if (outputDir == null) {
+                            outputDir = &quot;target/surefire-reports/&quot;;
+                        } else {
+                            outputDir += &quot;/target/surefire-reports/&quot;;
+                        }++                        File file = new File(outputDir);+                        file.mkdirs();+                        os = Files.newOutputStream(Paths.get(outputDir + className + &amp;quot;.out&amp;quot;));                     }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt; else &lt;/p&gt;
{
-                        outputDir += &quot;/target/surefire-reports/&quot;;
+                        throw ioe;
                     }
&lt;p&gt;-&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;File file = new File(outputDir);&lt;/li&gt;
	&lt;li&gt;file.mkdirs();&lt;/li&gt;
	&lt;li&gt;os = Files.newOutputStream(Paths.get(outputDir + className + &quot;.out&quot;));&lt;br/&gt;
                 }&lt;br/&gt;
             } catch (IOException ex) {&lt;br/&gt;
                 if (!ex.getMessage().contains(&quot;Stream closed&quot;)) {&lt;/li&gt;
&lt;/ul&gt;





&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 42 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3knav:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>