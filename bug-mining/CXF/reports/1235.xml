<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:51:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-4052] Crypto cache issues and the PolicyBasedWSS4JInInterceptor used as a singleton</title>
                <link>https://issues.apache.org/jira/browse/CXF-4052</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;When using WS-Policy to setup WS-Security interceptors, the WSSecurityInterceptorProvider runs:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;...
&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.getInInterceptors().add(PolicyBasedWSS4JInInterceptor.INSTANCE);
&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.getInFaultInterceptors().add(PolicyBasedWSS4JInInterceptor.INSTANCE);
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;which causes the same instance of PolicyBasedWSS4JInInterceptor to be added to any bus.&lt;br/&gt;
Unfortunately, the PolicyBasedWSS4JInInterceptor ends up extending org.apache.ws.security.handler.WSHandler which has a Map&amp;lt;String, Crypto&amp;gt; attribute. That is used whenever loading a Crypto instance and caches instances with keys basically given by the Merlin prop file name the user specified for the endpoint.&lt;br/&gt;
So, when having multiple deployments referencing properties files with the same name, the first crypto instance is always used.&lt;/p&gt;

&lt;p&gt;If we want to keep the singleton approach on using the PolicyBasedWSS4JInInterceptor, we should probably at least use a different mechanism for creating keys so that prop files from different deployments are kept separate.&lt;/p&gt;</description>
                <environment>&lt;p&gt;JBossWS-CXF integration, using Apache CXF 2.4.x&lt;/p&gt;</environment>
        <key id="12539482">CXF-4052</key>
            <summary>Crypto cache issues and the PolicyBasedWSS4JInInterceptor used as a singleton</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="coheigea">Colm O hEigeartaigh</assignee>
                                    <reporter username="asoldano">Alessio Soldano</reporter>
                        <labels>
                    </labels>
                <created>Mon, 23 Jan 2012 15:29:32 +0000</created>
                <updated>Wed, 3 Oct 2012 09:16:21 +0000</updated>
                            <resolved>Fri, 10 Feb 2012 15:18:41 +0000</resolved>
                                    <version>2.4.5</version>
                    <version>2.5.2</version>
                                    <fixVersion>2.4.7</fixVersion>
                    <fixVersion>2.5.3</fixVersion>
                    <fixVersion>2.6</fixVersion>
                                    <component>WS-* Components</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13193761" author="coheigea" created="Thu, 26 Jan 2012 11:31:22 +0000"  >&lt;p&gt;Hi Alessio,&lt;/p&gt;

&lt;p&gt;See attached for a patch for this issue against trunk. If you could review it and test it, that&apos;d be great.&lt;/p&gt;

&lt;p&gt;The basic idea is to override the way Crypto objects are loaded and cached in WSHandler. When Crypto objects are loaded via a property filename, we use the full path of the file as the key of the cache, rather than just the filename.&lt;/p&gt;

&lt;p&gt;Colm.&lt;/p&gt;</comment>
                            <comment id="13193908" author="asoldano" created="Thu, 26 Jan 2012 15:36:20 +0000"  >&lt;p&gt;Hi Colm,&lt;br/&gt;
thanks for having worked on this. Unfortunately, I think the patch is not enough to solve the issue. AFAICS, AbstractWSS4JInterceptor::loadCrypto(...) still first tries looking up the Crypto using the refId that comes from the requestData message context (&quot;RefId-bob.properties&quot; in my case). I think that is set in PolicyBasedWSS4JInInterceptor::computeAction(...) when using WS-Policy.&lt;/p&gt;</comment>
                            <comment id="13201435" author="asoldano" created="Mon, 6 Feb 2012 18:03:31 +0000"  >&lt;p&gt;Colm, are you still on this? I can probably trying providing a patch on my own unless you&apos;re already working on this.&lt;/p&gt;</comment>
                            <comment id="13202682" author="coheigea" created="Tue, 7 Feb 2012 19:41:20 +0000"  >
&lt;p&gt;Here&apos;s a better attempt at solving this problem. The PolicyBasedWSS4JInInterceptor uses the URL of the Properties file as the cache key. No changes to WSS4J are required.&lt;/p&gt;

&lt;p&gt;Colm.&lt;/p&gt;</comment>
                            <comment id="13205357" author="asoldano" created="Fri, 10 Feb 2012 10:55:37 +0000"  >&lt;p&gt;Hi Colm,&lt;br/&gt;
the patch is working, cool. I&apos;ve merged it into 2.4.x branch to test it, let me know if you want me to commit or you&apos;re going ahead.&lt;br/&gt;
Thanks&lt;/p&gt;</comment>
                            <comment id="13205476" author="coheigea" created="Fri, 10 Feb 2012 14:33:07 +0000"  >&lt;p&gt;Hi Alessio,&lt;/p&gt;

&lt;p&gt;I&apos;ll take care of the merge.&lt;/p&gt;

&lt;p&gt;Colm.&lt;/p&gt;</comment>
                            <comment id="13205547" author="asoldano" created="Fri, 10 Feb 2012 16:58:20 +0000"  >&lt;p&gt;Added 2.6 fix version (as it&apos;s committed on trunk too)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12610054">CXF-4539</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12513667" name="cxf-4052-2.patch" size="8735" author="coheigea" created="Tue, 7 Feb 2012 19:41:20 +0000"/>
                            <attachment id="12511972" name="cxf-4052.patch" size="5701" author="coheigea" created="Thu, 26 Jan 2012 11:31:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>224984</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 41 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0b85j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>63433</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>