<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:37:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-2145] Proxy in JCA connector throws exception due to concurrency issues</title>
                <link>https://issues.apache.org/jira/browse/CXF-2145</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;A customer is having a problem with concurrent access to a JCA endpoint that is deployed in WebSphere. The stacktrace is below.&lt;br/&gt;
They are running a 2.0.x version of CXF with WebSphere 6.1.0.19, HP/UX version B.11.23, Java 1.5.0.13 .&lt;/p&gt;

&lt;p&gt;The problem is that the JCA connector uses a single MDB/EJB proxy for all threads which is causing the exception to be thrown. The solution is to create a pool of proxies which can be accessed so that the proxy is used by no more than 1 thread at a time.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;3/10/09 15:55:19:685 EDT&amp;#93;&lt;/span&gt; 0000042f DispatchMDBIn E Failed to obtain service object java:comp/env/GreeterWithWsdlLocalHome &lt;br/&gt;
                                 java.lang.IllegalStateException: Multiple threads can not use same MessageEndpoint proxy instance concurrently &lt;br/&gt;
            at com.ibm.ejs.container.MessageEndpointHandler.throwIllegalStateException(MessageEndpointHandler.java:599) &lt;br/&gt;
            at com.ibm.ejs.container.MessageEndpointHandler.checkState(MessageEndpointHandler.java:433) &lt;br/&gt;
            at com.ibm.ejs.container.MessageEndpointHandler.invokeMdbMethod(MessageEndpointHandler.java:889) &lt;br/&gt;
            at com.ibm.ejs.container.MessageEndpointHandler.invoke(MessageEndpointHandler.java:747) &lt;br/&gt;
            at $Proxy50.lookupTargetObject(Unknown Source) &lt;br/&gt;
            at org.apache.cxf.jca.inbound.DispatchMDBInvoker.getServiceObject(DispatchMDBInvoker.java:57) &lt;br/&gt;
            at org.apache.cxf.service.invoker.AbstractInvoker.invoke(AbstractInvoker.java:51) &lt;br/&gt;
            at org.apache.cxf.interceptor.ServiceInvokerInterceptor$1.run(ServiceInvokerInterceptor.java:56) &lt;br/&gt;
            at org.apache.cxf.workqueue.SynchronousExecutor.execute(SynchronousExecutor.java:37) &lt;br/&gt;
            at org.apache.cxf.interceptor.ServiceInvokerInterceptor.handleMessage(ServiceInvokerInterceptor.java:92) &lt;br/&gt;
            at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:221) &lt;br/&gt;
            at org.apache.cxf.transport.ChainInitiationObserver.onMessage(ChainInitiationObserver.java:77) &lt;br/&gt;
            at org.apache.cxf.transport.http_jetty.JettyHTTPDestination.serviceRequest(JettyHTTPDestination.java:280) &lt;br/&gt;
            at org.apache.cxf.transport.http_jetty.JettyHTTPDestination.doService(JettyHTTPDestination.java:254) &lt;br/&gt;
            at org.apache.cxf.transport.http_jetty.JettyHTTPHandler.handle(JettyHTTPHandler.java:70) &lt;br/&gt;
            at org.mortbay.jetty.handler.ContextHandler.handle(ContextHandler.java:726) &lt;br/&gt;
            at org.mortbay.jetty.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:206) &lt;br/&gt;
            at org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:152) &lt;br/&gt;
            at org.mortbay.jetty.Server.handle(Server.java:324) &lt;br/&gt;
            at org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:505) &lt;br/&gt;
            at org.mortbay.jetty.HttpConnection$RequestHandler.content(HttpConnection.java:842) &lt;br/&gt;
            at org.mortbay.jetty.HttpParser.parseNext(HttpParser.java:648) &lt;br/&gt;
            at org.mortbay.jetty.HttpParser.parseAvailable(HttpParser.java:211) &lt;br/&gt;
            at org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:380) &lt;br/&gt;
            at org.mortbay.io.nio.SelectChannelEndPoint.run(SelectChannelEndPoint.java:395) &lt;br/&gt;
            at org.mortbay.thread.BoundedThreadPool$PoolThread.run(BoundedThreadPool.java:450) &lt;/p&gt;</description>
                <environment></environment>
        <key id="12421691">CXF-2145</key>
            <summary>Proxy in JCA connector throws exception due to concurrency issues</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dkulp">Daniel Kulp</assignee>
                                    <reporter username="seumassoltysik">Seumas Soltysik</reporter>
                        <labels>
                    </labels>
                <created>Tue, 31 Mar 2009 18:03:53 +0000</created>
                <updated>Fri, 24 Apr 2009 21:17:11 +0000</updated>
                            <resolved>Fri, 3 Apr 2009 19:05:29 +0000</resolved>
                                    <version>2.1</version>
                    <version>2.0.6</version>
                    <version>2.2</version>
                                    <fixVersion>2.0.11</fixVersion>
                    <fixVersion>2.1.5</fixVersion>
                    <fixVersion>2.2.1</fixVersion>
                                    <component>Integration</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12694226" author="seumassoltysik" created="Tue, 31 Mar 2009 19:32:35 +0000"  >&lt;p&gt;This is patch for 2.0.x but undoubted needs to also be applied to 2.1.x and trunk. The patch adds  a pool for EJB/MDB proxies to avoid thread concurrency issues.&lt;/p&gt;</comment>
                            <comment id="12694336" author="wtam" created="Wed, 1 Apr 2009 01:00:27 +0000"  >&lt;p&gt;I was wondering whether recycling MessageEndpoint instance is a good idea or not. I went back to the JCA spec. Then, I came to the conclusion that it is NOT a good thing. &lt;/p&gt;

&lt;p&gt;First, Chapter 12.5 Message Delivery in the JCA spec confirms the root problem. &quot;The same endpoint instance may be used again to deliver subsequent messages serially, but it must not use the&lt;br/&gt;
same endpoint instance concurrently.&quot;&lt;/p&gt;

&lt;p&gt;However, it is unnecessary for the resource adapter to pool endpoint instances. It says in the same chapter, &quot;The resource adapter may call the release method on the proxy endpoint instance to indicate that it no longer needs the proxy instance. This hint may be used by the application server for proxy endpoint pooling decisions. This method call frees the state of the proxy instance. The released proxy instance may be reused for further proxy endpoint requests from the same resource adapter.&quot; That means, the application server may already maintain a pool of endpoint instances per resource adapter. We should just call the release() method on the endpoint instance and call createEndpoint() when it is needed again. I guess the biggest issue of our pooling is XA transaction support (in the future). Each endpoint could be attached to a different XAResource at creation time.&lt;/p&gt;

&lt;p&gt;I think a fix would be to have the MDBInvoker() holding on to a MessageEndpointFactory instead of a MessageEndpoint instance. In the getServiceObject(), it calls createEndpoint() and release() when it is done.&lt;/p&gt;

&lt;p&gt;(BTW, it looks like a bug in the patch that the DispatchMDBInvoker.releaseServiceObject() method should&apos;ve been overridden to do nothing.) &lt;/p&gt;</comment>
                            <comment id="12695399" author="seumassoltysik" created="Fri, 3 Apr 2009 14:19:40 +0000"  >&lt;p&gt;This second patch simplifies the process of retreiving a new endpoint for each invocation. Instead of maintaining a pool of endpoint, the patch relies on the pooling of endpoint by the app server according to spec. After each invocation the endpoint is released and recycled by the application server.&lt;/p&gt;</comment>
                            <comment id="12695402" author="wtam" created="Fri, 3 Apr 2009 14:33:15 +0000"  >&lt;p&gt;Looks good.  Just a quick/minor comment in restoring the saved classloader (in MDBActivationWork.run() method).&lt;/p&gt;

&lt;p&gt;         try &lt;/p&gt;
{
+            savedClassLoader = Thread.currentThread().getContextClassLoader();
+            ClassLoader classLoader = mep.getClass().getClassLoader();
             Thread.currentThread().setContextClassLoader(classLoader);
-            activate(endpoint, classLoader);
+            activate(invoker, classLoader);
         }
&lt;p&gt; finally &lt;/p&gt;
{
+            invoker.releaseEndpoint(mep);
             Thread.currentThread().setContextClassLoader(savedClassLoader);
         }

&lt;p&gt;You may want to check for null savedClassLoader before restoring to be safe.&lt;/p&gt;</comment>
                            <comment id="12695416" author="seumassoltysik" created="Fri, 3 Apr 2009 15:07:06 +0000"  >&lt;p&gt;One more time.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12404260" name="patch.txt" size="12466" author="seumassoltysik" created="Tue, 31 Mar 2009 19:32:35 +0000"/>
                            <attachment id="12404547" name="patch2.txt" size="9939" author="seumassoltysik" created="Fri, 3 Apr 2009 14:19:40 +0000"/>
                            <attachment id="12404556" name="patch3.txt" size="10086" author="seumassoltysik" created="Fri, 3 Apr 2009 15:07:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>113597</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 34 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i143in:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>232033</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>