<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:03:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-5184] javax.ws.rs.NotFoundException while using LoadDistributorFeature after failover of 1st node or with single node configured</title>
                <link>https://issues.apache.org/jira/browse/CXF-5184</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;I&apos;ve configured JAX-RS proxy to work with LoadDistributorFeature. &lt;br/&gt;
If failover occurs on the first node OR when there&apos;s only a single &apos;healthy&apos; (no failover) node configured then I&apos;m getting javax.ws.rs.NotFoundException as a result of a second call to the proxy. &lt;br/&gt;
All works fine with FailoverFeature or without any clustering features enabled.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Path(&lt;span class=&quot;code-quote&quot;&gt;&quot;/library&quot;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; Library {
	@GET
	@Path(&lt;span class=&quot;code-quote&quot;&gt;&quot;/books&quot;&lt;/span&gt;)
	Books getAllBooks();
	
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;client&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;		LoadDistributorFeature feature = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; LoadDistributorFeature();
		SequentialStrategy strategy = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SequentialStrategy();
		strategy.setAlternateAddresses(asList(&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8080&quot;&lt;/span&gt;));
&lt;/span&gt;		feature.setStrategy(strategy);
		

		JAXRSClientFactoryBean bean = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JAXRSClientFactoryBean();
		List&amp;lt;Feature&amp;gt; features = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;Feature&amp;gt;();
		features.add(feature);
		bean.setFeatures(features);
		bean.setAddress(&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//dummy:8080&quot;&lt;/span&gt;);
&lt;/span&gt;		bean.setResourceClass(Library.class);
		Library library = bean.create(Library.class);
		
		library.getAllAuthors();
		

		library.getAllAuthors; &lt;span class=&quot;code-comment&quot;&gt;//I&apos;m getting the exception here
&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;jdk7&lt;/p&gt;</environment>
        <key id="12662244">CXF-5184</key>
            <summary>javax.ws.rs.NotFoundException while using LoadDistributorFeature after failover of 1st node or with single node configured</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sergey_beryozkin">Sergey Beryozkin</assignee>
                                    <reporter username="panjacek">Jacek Obarymski</reporter>
                        <labels>
                    </labels>
                <created>Tue, 6 Aug 2013 23:18:39 +0000</created>
                <updated>Fri, 27 Sep 2013 18:18:10 +0000</updated>
                            <resolved>Mon, 19 Aug 2013 10:53:47 +0000</resolved>
                                    <version>2.7.6</version>
                                    <fixVersion>2.6.10</fixVersion>
                    <fixVersion>2.7.7</fixVersion>
                    <fixVersion>3.0.0-milestone1</fixVersion>
                                    <component>JAX-RS</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13737417" author="panjacek" created="Mon, 12 Aug 2013 22:02:08 +0000"  >&lt;p&gt;updating the bug info after further investigation&lt;/p&gt;</comment>
                            <comment id="13737976" author="sergey_beryozkin" created="Tue, 13 Aug 2013 08:32:40 +0000"  >&lt;p&gt;Thanks. Looks like LoadDistributorFeature does not move to the alternate address in case of failures...&lt;/p&gt;</comment>
                            <comment id="13743326" author="panjacek" created="Sun, 18 Aug 2013 18:34:16 +0000"  >&lt;p&gt;I have fixed the issue. Attaching a patch.&lt;/p&gt;</comment>
                            <comment id="13743333" author="sergey_beryozkin" created="Sun, 18 Aug 2013 19:09:41 +0000"  >&lt;p&gt;Hi, many thanks for your patch - much appreciated.&lt;/p&gt;

&lt;p&gt;One thing I&apos;d like to note, a mock based test is good, but we probably need to have a system test updated instead, I&apos;m not really sure we can have JAX-RS test dependency in the clustering feature module, LoadDistributorTest is available in systests/jaxrs, I copied it from systests/jaxws.   &lt;/p&gt;

&lt;p&gt;Can you please consider updating LoadDistributorTest or add LoadDistributorTestSameAddress which will test your scenario ? I can deal with it later on myself. Right now I&apos;m dealing with many different issues so it might take me a bit of time &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, but we will get it fixed.&lt;/p&gt;

&lt;p&gt;By the way, I&apos;d like to clarify. You have two &quot;library.getAllAuthors();&quot; calls, what happens during the first call, does it succeed, i.e, does it reach its target ? &lt;br/&gt;
Next, given that we only have a single (same) address set in SequentialStrategy, what do you expect to happen during a second &quot;library.getAllAuthors();&quot; call ?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;







</comment>
                            <comment id="13743351" author="panjacek" created="Sun, 18 Aug 2013 20:04:45 +0000"  >&lt;p&gt;OK, I&apos;ll have a look at the system test and try to reproduce the problem there.&lt;/p&gt;

&lt;p&gt;In my example actually the first call to &quot;library.getAllAuthors();&quot; is also not successful when primary address set in &apos;bean.setAddress(&quot;http://localhost:8080&quot;);&apos; is same as the alternate address. &lt;br/&gt;
If I set &apos;bean.setAddress(&quot;http://dummy:8080&quot;);&apos; and alternate address to &quot;http://localhost:8080&quot; then the first call is successfull (calls &quot;http://localhost:8080/library/books&quot;) and the second fails because it calls &quot;http://localhost:8080&quot;.&lt;br/&gt;
In the example I&apos;m showing the case when there wasn&apos;t any failover and the node &quot;http://localhost:8080&quot; is healthy, so I&apos;m expecting both calls to send request to &quot;http://localhost:8080/library/books&quot; and return the same response, which is not the case with the current implementation.&lt;/p&gt;

</comment>
                            <comment id="13743602" author="sergey_beryozkin" created="Mon, 19 Aug 2013 07:33:42 +0000"  >&lt;p&gt;Hi, thanks for the clarifications.&lt;/p&gt;

&lt;p&gt;To contribute a bit, I&apos;ve added a test in LoadDistributorTest:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Test    
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testFailover() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        LoadDistributorFeature feature = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; LoadDistributorFeature();
        List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; alternateAddresses = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;();
        alternateAddresses.add(Server.ADDRESS2);
        SequentialStrategy strategy = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SequentialStrategy();
        strategy.setAlternateAddresses(alternateAddresses);
        feature.setStrategy(strategy);
        
        BookStore bookStore = getBookStore(Server.ADDRESS1, feature);
        
        &lt;span class=&quot;code-comment&quot;&gt;// 1st call
&lt;/span&gt;        Book book = bookStore.getBook(&lt;span class=&quot;code-quote&quot;&gt;&quot;123&quot;&lt;/span&gt;);
        assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;unexpected id&quot;&lt;/span&gt;, 123L, book.getId());
        
        &lt;span class=&quot;code-comment&quot;&gt;// 2nd call
&lt;/span&gt;        book = bookStore.getBook(&lt;span class=&quot;code-quote&quot;&gt;&quot;123&quot;&lt;/span&gt;);
        assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;unexpected id&quot;&lt;/span&gt;, 123L, book.getId());
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It fails during the 2nd call, exactly as you described in this JIRA. &lt;br/&gt;
So I can continue working with your fix to get the above test passing.&lt;/p&gt;

&lt;p&gt;Please double check the above test passes for you with your local fix&lt;/p&gt;

&lt;p&gt;thanks&lt;/p&gt;</comment>
                            <comment id="13743708" author="sergey_beryozkin" created="Mon, 19 Aug 2013 10:35:13 +0000"  >&lt;p&gt;Unfortunately the proposed fix gets WS test spinning. I&apos;ve poked around a bit and found that FailoverTargetSelector already deals with similar cases, I have a fix getting in now&lt;/p&gt;</comment>
                            <comment id="13743714" author="sergey_beryozkin" created="Mon, 19 Aug 2013 10:47:31 +0000"  >&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/r1515348&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1515348&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;thanks for your help, the fix is different but your effort is appreciated &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12598680" name="CXF-5184.patch" size="22705" author="panjacek" created="Sun, 18 Aug 2013 18:34:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>342248</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 14 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1n0vr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>342553</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>