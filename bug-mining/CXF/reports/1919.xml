<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:03:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-5201] jaxrs2: unable to intercept response to add new response headers</title>
                <link>https://issues.apache.org/jira/browse/CXF-5201</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;In a WriterInterceptor, one expects to be able to modify response headers via:&lt;/p&gt;

&lt;p&gt;//here using putSingle() but could also use on of the addXXX variants&lt;br/&gt;
context.getHeaders().putSingle(&quot;headerName&quot;, headerValue);&lt;/p&gt;

&lt;p&gt;However, above is not working in 2.7.5/2.7.6 (@see JIRA-4986)&lt;/p&gt;

&lt;p&gt;As a workaround, one should be able to inject the HttpServletResponse object via: @Context HttpServletResponse response;&lt;br/&gt;
then be able to add headers directly to the response object e.g.,&lt;/p&gt;

&lt;p&gt;response.setHeader(&quot;headerName&quot;, headerValue);&lt;/p&gt;

&lt;p&gt;however, above is also not working in (2.7.5/2.7.6). This is not always reproducable as sometimes my client does see the new headers in the received response. On closer look it seems the added headers get lost when it is a @GET request as opposed to e.g., a @POST. Basically, my test case (a @GET) always fails with a missing header in the received response even though I am pretty sure the server had added the header. &lt;/p&gt;</description>
                <environment>&lt;p&gt;windows&lt;/p&gt;</environment>
        <key id="12663593">CXF-5201</key>
            <summary>jaxrs2: unable to intercept response to add new response headers</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="sergey_beryozkin">Sergey Beryozkin</assignee>
                                    <reporter username="abdelgadiri">abdelgadiri</reporter>
                        <labels>
                    </labels>
                <created>Wed, 14 Aug 2013 08:25:47 +0000</created>
                <updated>Thu, 5 Dec 2013 19:05:27 +0000</updated>
                            <resolved>Mon, 19 Aug 2013 19:03:20 +0000</resolved>
                                    <version>2.7.5</version>
                    <version>2.7.6</version>
                                    <fixVersion>Invalid</fixVersion>
                                    <component>JAX-RS</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13739449" author="abdelgadiri" created="Wed, 14 Aug 2013 09:35:16 +0000"  >&lt;p&gt;The bit related to the http method in my above comments may not be relevant - it was just an observation. Below are more details about my test case&lt;/p&gt;

&lt;p&gt;My JAX-RS resource has two methods (first one &apos;readSingleAccount()&apos; always ends up successfully appending additional response headers to the returned HTTPResponse while second one always doesn&apos;t append):&lt;/p&gt;

&lt;p&gt; @GET&lt;br/&gt;
 @Path(&quot;/&lt;/p&gt;
{id}
&lt;p&gt;&quot;)&lt;br/&gt;
 public Response readSingleAccount(@PathParam(&quot;id&quot;) String accountID, @Context UriInfo uriInfo);&lt;/p&gt;

&lt;p&gt; @GET&lt;br/&gt;
 public Response readManyAccounts(@Context HttpServletRequest request, @Context UriInfo uriInfo);&lt;/p&gt;



&lt;p&gt;The WriterInterceptor is as follows:&lt;/p&gt;

&lt;p&gt;OutboundWriterInterceptor implements WriterInterceptor{&lt;br/&gt;
  @Context&lt;br/&gt;
    private HttpServletResponse response;&lt;/p&gt;

&lt;p&gt; public void aroundWriteTo(WriterInterceptorContext context)  IOException, WebApplicationException &lt;/p&gt;
{
   response.setHeader(&quot;headerName&quot;, &quot;headerValue&quot;);
 }

&lt;p&gt;}&lt;/p&gt;

&lt;p&gt;I am pretty sure the above interceptor gets invoked for both the JAX-RS calls but on client the response from first method readSingleAccount() will include the new &apos;headerName&apos; while the readManyAccounts() won&apos;t &lt;/p&gt;</comment>
                            <comment id="13739777" author="abdelgadiri" created="Wed, 14 Aug 2013 15:35:58 +0000"  >&lt;p&gt;As an additional check, I created the following Servlet filter to introspect the response headers which confirmed to me that the response header set from the JAX-RS interceptor is not being returned to the client.&lt;/p&gt;

&lt;p&gt;@WebFilter(filterName = &quot;ResponseDebugFilter&quot;, urlPatterns = &lt;/p&gt;
{&quot;/*&quot;}
&lt;p&gt;)&lt;br/&gt;
public class ResponseDebugFilter implements Filter {&lt;br/&gt;
    @Override&lt;br/&gt;
    public void init(FilterConfig filterConfig) throws ServletException &lt;/p&gt;
{
        //do nothing
    }&lt;br/&gt;
&lt;br/&gt;
    @Override&lt;br/&gt;
    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)&lt;br/&gt;
            throws IOException, ServletException {&lt;br/&gt;
&lt;br/&gt;
        //carry on as normal&lt;br/&gt;
        filterChain.doFilter(servletRequest, servletResponse);&lt;br/&gt;
&lt;br/&gt;
        //print response headers on way out&lt;br/&gt;
        if (servletResponse instanceof HttpServletResponse) {&lt;br/&gt;
            Collection&amp;lt;String&amp;gt; headerNames = ((HttpServletResponse) servletResponse).getHeaderNames();&lt;br/&gt;
            for (String hn : headerNames) {
                Collection&amp;lt;String&amp;gt; headers = ((HttpServletResponse) servletResponse).getHeaders(hn);
                System.out.println(&quot;^^^^^^^^^^^^^^^^^^^^^^^^^^^^ found response header (&quot; + hn + &quot;): &quot; + headers);
            }&lt;br/&gt;
        }&lt;br/&gt;
    }&lt;br/&gt;
&lt;br/&gt;
    @Override&lt;br/&gt;
    public void destroy() {        //do nothing    }
&lt;p&gt;}&lt;/p&gt;</comment>
                            <comment id="13739788" author="abdelgadiri" created="Wed, 14 Aug 2013 15:44:59 +0000"  >&lt;p&gt;although seems unlikely but could this issue has anything to to with the size of the response payload?&lt;br/&gt;
I have noticed that when the database is empty or when it contains a single account then the test case passes and i can detect the additional response header both on the Deugging servlet filter and on client. However, when the database contains two or more accounts then the readManyAccounts() will always fail with missing header but readSingleAccount() will always pass. For both API calls I can see in the debugger that the response.setHeader() method is being invoked from the interceptor.&lt;/p&gt;

</comment>
                            <comment id="13740057" author="sergey_beryozkin" created="Wed, 14 Aug 2013 19:10:11 +0000"  >&lt;p&gt;I&apos;m a bit confused what exactly works and what does not &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;So, if the filter has:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;context.getHeaders().putSingle(&lt;span class=&quot;code-quote&quot;&gt;&quot;headerName&quot;&lt;/span&gt;, headerValue);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;then it works or not ?&lt;/p&gt;


&lt;p&gt;I understand that writing to HttpServletResponse works for most cases. &lt;/p&gt;

&lt;p&gt;In your filter, use HttpServletResponseWrapper wrapping the original headers, and override all the methods where headers are set. And try WriterInterceptor adding headers either via WriterInterceptorContext or HttpServletResponse - your HttpServletResponseWrapper will see all the headers irrespectively of how the headers are added in WriterInterceptor &lt;/p&gt;</comment>
                            <comment id="13740798" author="abdelgadiri" created="Thu, 15 Aug 2013 08:17:17 +0000"  >&lt;p&gt;Hi Sergey,&lt;/p&gt;

&lt;p&gt;setting the header via &quot;context.getHeaders().putSingle(&quot;headerName&quot;, headerValue)&quot; is NOT working.&lt;/p&gt;

&lt;p&gt;I am injecting the HttpServletResponse object via &quot;@Context private HttpServletResponse response&quot; and I get ThreadLocalHttpServletResponse instance injected. So how do I obtain an HttpServletResponseWrapper instance ?&lt;/p&gt;

&lt;p&gt;I tried injecting  &quot;@Context private HttpServletResponseWrapper response&quot; but my war file failed to deploy.  &lt;/p&gt;</comment>
                            <comment id="13740803" author="sergey_beryozkin" created="Thu, 15 Aug 2013 08:28:39 +0000"  >&lt;p&gt;Sorry, I was referring to your Servlet filter code - wrap HttpServletResponse there&lt;/p&gt;</comment>
                            <comment id="13740826" author="abdelgadiri" created="Thu, 15 Aug 2013 09:19:12 +0000"  >&lt;p&gt;I have wrapped the response and passed it to the jax-rs interceptor which sets the header on it. I can see the setHeader() method getting called on my response wrapper but when printing the available headers from the filter (on way out), the just added header is missing.&lt;/p&gt;


&lt;p&gt;public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)&lt;br/&gt;
            throws IOException, ServletException {&lt;br/&gt;
        MyHttpServletResponseWrapper responseWrapper = new MyHttpServletResponseWrapper((HttpServletResponse) servletResponse);&lt;/p&gt;

&lt;p&gt;        //proceed&lt;br/&gt;
        filterChain.doFilter(servletRequest, responseWrapper);&lt;/p&gt;

&lt;p&gt;		//print on way out - however, the additional header added by the jax-rs interceptor is missing&lt;br/&gt;
        Collection&amp;lt;String&amp;gt; headerNames = responseWrapper.getHeaderNames();&lt;br/&gt;
        for (String hn : headerNames) &lt;/p&gt;
{
            Collection&amp;lt;String&amp;gt; headers = responseWrapper.getHeaders(hn);
            System.out.println(&quot;^^^^^^^^^^^^^^^^^^^^^^^^^^^^ found response header (&quot; + hn + &quot;): &quot; + headers);
        }
&lt;p&gt;}&lt;/p&gt;

&lt;p&gt;/** The response wrapper passed to the JAX-RS interceptor. */&lt;br/&gt;
public class MyHttpServletResponseWrapper extends HttpServletResponseWrapper {&lt;br/&gt;
    public MyHttpServletResponseWrapper(HttpServletResponse response) &lt;/p&gt;
{
        super(response);
    }

&lt;p&gt;    @Override&lt;br/&gt;
    public void setDateHeader(String name, long date) &lt;/p&gt;
{
        System.out.println(&quot;****** setting date header ... &quot; + name);
        super.setDateHeader(name, date);
    }

&lt;p&gt;    @Override&lt;br/&gt;
    public void addDateHeader(String name, long date) &lt;/p&gt;
{
        System.out.println(&quot;****** adding date header ... &quot; + name);
        super.addDateHeader(name, date);
    }

&lt;p&gt;    @Override&lt;br/&gt;
    public void setHeader(String name, String value) &lt;/p&gt;
{
		//this method is being invoked by the OutboundMsgInterceptor
        System.out.println(&quot;****** setting header ... &quot; + name);
        super.setHeader(name, value);
    }

&lt;p&gt;    @Override&lt;br/&gt;
    public void addHeader(String name, String value) &lt;/p&gt;
{
        System.out.println(&quot;****** adding header ... &quot; + name);
        super.addHeader(name, value);
    }

&lt;p&gt;    @Override&lt;br/&gt;
    public void setIntHeader(String name, int value) &lt;/p&gt;
{
        System.out.println(&quot;****** setting int header ... &quot; + name);
        super.setIntHeader(name, value);
    }

&lt;p&gt;    @Override&lt;br/&gt;
    public void addIntHeader(String name, int value) &lt;/p&gt;
{
        System.out.println(&quot;****** adding int header ... &quot; + name);
        super.addIntHeader(name, value);
    }
&lt;p&gt;}&lt;/p&gt;


&lt;p&gt;@Provider&lt;br/&gt;
public class OutboundMsgInterceptor implements WriterInterceptor {&lt;/p&gt;

&lt;p&gt;    @Context&lt;br/&gt;
    private HttpServletResponse response;&lt;/p&gt;

&lt;p&gt;	  public void aroundWriteTo(WriterInterceptorContext context) throws IOException, WebApplicationException &lt;/p&gt;
{
		//this will definitly invoke the relevant methods in MyHttpServletResponseWrapper. 
	    response.setHeader(&quot;headerName&quot;, &quot;headerValue&quot;);
	  }
&lt;p&gt;}&lt;/p&gt;</comment>
                            <comment id="13740837" author="abdelgadiri" created="Thu, 15 Aug 2013 09:41:19 +0000"  >&lt;p&gt;so basically i see following on sys.out&lt;/p&gt;

&lt;p&gt;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp; adding header ... Content-Type&lt;br/&gt;
&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp; adding header ... Date&lt;br/&gt;
&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp; setting header ... headerName&lt;br/&gt;
^^^^^^^^^^^^^^^^^^^^^^^^^^^^ found response header (Date): &lt;span class=&quot;error&quot;&gt;&amp;#91;Thu, 15 Aug 2013 09:39:31 GMT&amp;#93;&lt;/span&gt;&lt;br/&gt;
^^^^^^^^^^^^^^^^^^^^^^^^^^^^ found response header (Content-Type): &lt;span class=&quot;error&quot;&gt;&amp;#91;application/json;charset=UTF-8&amp;#93;&lt;/span&gt;&lt;br/&gt;
^^^^^^^^^^^^^^^^^^^^^^^^^^^^ found response header (Transfer-Encoding): &lt;span class=&quot;error&quot;&gt;&amp;#91;chunked&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="13740877" author="abdelgadiri" created="Thu, 15 Aug 2013 11:02:14 +0000"  >&lt;p&gt;I think this might be a problem with the Servlet implementation as opposed to cxf because even if I set a new header within the servlet filter, I am  still unable to read it back. See below&lt;/p&gt;


&lt;p&gt;@WebFilter(urlPatterns = &lt;/p&gt;
{&quot;/*&quot;}
&lt;p&gt;)&lt;br/&gt;
public class ResponseDebugFilter implements Filter {&lt;br/&gt;
    @Override&lt;br/&gt;
    public void init(FilterConfig filterConfig) throws ServletException &lt;/p&gt;
{
        //do nothing
    }&lt;br/&gt;
&lt;br/&gt;
    @Override&lt;br/&gt;
    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)&lt;br/&gt;
            throws IOException, ServletException {&lt;br/&gt;
        VelosHttpServletResponseWrapper responseWrapper = new VelosHttpServletResponseWrapper((HttpServletResponse) servletResponse);&lt;br/&gt;
&lt;br/&gt;
        //carry on as normal&lt;br/&gt;
        filterChain.doFilter(servletRequest, responseWrapper);&lt;br/&gt;
&lt;br/&gt;
        //I am explicitly defining a new header here so I would expect to be able to read it back below   &lt;br/&gt;
        responseWrapper.setHeader(&quot;newlyDefinedHeader&quot;, &quot;newHeaderValue&quot;);&lt;br/&gt;
&lt;br/&gt;
        //print response headers on way out but above &quot;newlyDefinedHeader&quot; is not printing i.e., missing&lt;br/&gt;
        Collection&amp;lt;String&amp;gt; headerNames = responseWrapper.getHeaderNames();&lt;br/&gt;
        for (String hn : headerNames) {
            Collection&amp;lt;String&amp;gt; headers = responseWrapper.getHeaders(hn);
            System.out.println(&quot;^^^^^^^^^^^^^^^^^^^^^^^^^^^^ found response header (&quot; + hn + &quot;): &quot; + headers);
        }&lt;br/&gt;
    }&lt;br/&gt;
&lt;br/&gt;
    @Override&lt;br/&gt;
    public void destroy() {        //do nothing    }
&lt;p&gt;}&lt;/p&gt;</comment>
                            <comment id="13740878" author="abdelgadiri" created="Thu, 15 Aug 2013 11:03:35 +0000"  >&lt;p&gt;I am using apache-tomcat-7.0.27&lt;/p&gt;</comment>
                            <comment id="13740897" author="abdelgadiri" created="Thu, 15 Aug 2013 11:33:14 +0000"  >&lt;p&gt;I just noticed that the underlying used servlet response impl is org.apache.cxf.jaxrs.impl.tl.ThreadLocalHttpServletResponse so this issue might be CXF related after all &lt;/p&gt;</comment>
                            <comment id="13740970" author="sergey_beryozkin" created="Thu, 15 Aug 2013 13:49:11 +0000"  >&lt;p&gt;See &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/r1514272&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1514272&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;we have a custom WriterInterceptor which adds headers via WriterInterceptorContext and now directly via HttpServletResponse and the client gets those headers.&lt;/p&gt;

&lt;p&gt;Are you sure it does not work in CXF 2.7.6 ? If yes - please try CXF 2.7.7-SNAPSHOT in a day or so. If it still does not work - please create a reproducible Maven-based test, or attach a simple war built against CXF 2.7.6 to this JIRA (without CXF libs if possible). Without being able to reproduce I&apos;ll have to close this JIRA as Can&apos;t Reproduce, thanks  &lt;/p&gt;</comment>
                            <comment id="13742241" author="abdelgadiri" created="Fri, 16 Aug 2013 14:13:19 +0000"  >&lt;p&gt;source maven project&lt;/p&gt;</comment>
                            <comment id="13742242" author="abdelgadiri" created="Fri, 16 Aug 2013 14:13:50 +0000"  >&lt;p&gt;war file to reproduce the issue&lt;/p&gt;</comment>
                            <comment id="13742247" author="abdelgadiri" created="Fri, 16 Aug 2013 14:17:53 +0000"  >&lt;p&gt;i have now attached some code to reproduce the issue. Deploy the war to a tomcat instance then run the test cases in the attached source project. The test cases assume you deployed the war to a local tomcat (you may need to modify the test case a bit otherwise to point to where you deployed the war because i have hard coded the server url).&lt;/p&gt;

&lt;p&gt;you will find the first test case (for small payload) always passes while the second test case (for large payload) always fails. However, both should always succeed.&lt;/p&gt;
</comment>
                            <comment id="13742250" author="abdelgadiri" created="Fri, 16 Aug 2013 14:19:20 +0000"  >&lt;p&gt;above is how i run the test cases but obviously you may do it differently depending on your setup so feel free to modify the test case as you need.&lt;/p&gt;</comment>
                            <comment id="13742253" author="abdelgadiri" created="Fri, 16 Aug 2013 14:21:50 +0000"  >&lt;p&gt;sorry i forgot to re-enable the second test case on the attached source project so please enable it first&lt;/p&gt;</comment>
                            <comment id="13742309" author="abdelgadiri" created="Fri, 16 Aug 2013 15:36:08 +0000"  >&lt;p&gt;please note in the attached jaxrs resource, I am simulating a very large payload (1000000 * &quot;some text&quot;) but the test case is failing even with a lot smaller payload e.g., (1000 * &quot;some text&quot;). Another thing, this test case is throwing (on server log) &quot;org.apache.cxf.interceptor.Fault: Could not send Message. .... Caused by: ClientAbortException:  java.io.IOException&quot; which I am not seeing in my real project (could be due to my logger interceptor config). In both my real project and this test case, the client is receiving a response with status OK but with missing expected header.&lt;/p&gt;</comment>
                            <comment id="13743784" author="sergey_beryozkin" created="Mon, 19 Aug 2013 12:58:18 +0000"  >&lt;p&gt;Hi, it appears to me the issues you are seeing are beyond CXF&apos;s control. Can you avoid this ClientAbortException somehow ? This is just an extra variable which does not help with identifying the CXF issue if any. What happens if you remove the logging interceptor ?&lt;/p&gt;</comment>
                            <comment id="13743818" author="abdelgadiri" created="Mon, 19 Aug 2013 13:43:28 +0000"  >&lt;p&gt;removing logging has no effect.&lt;/p&gt;

&lt;p&gt;The writer interceptor is throwing an exception on this line&lt;br/&gt;
 originalStream.write(base64Body.getBytes(&quot;UTF-8&quot;));&lt;/p&gt;

&lt;p&gt;since originalStream is an instance of org.apache.cxf.transport.http.AbstractHTTPDestination$WrappedOutputStream, is it not under cxf control?&lt;/p&gt;
</comment>
                            <comment id="13743825" author="sergey_beryozkin" created="Mon, 19 Aug 2013 13:53:30 +0000"  >&lt;p&gt;You are right, this particular Stream implementation is under CXF control, but what is not is preventing a ClientAbortException.&lt;/p&gt;

&lt;p&gt;Which client do you use ? Can you please try &apos;curl -v&apos; ?&lt;/p&gt;
</comment>
                            <comment id="13743851" author="abdelgadiri" created="Mon, 19 Aug 2013 14:31:26 +0000"  >&lt;p&gt;I got the same clientabortexception with both HttpClient 4.2.5 and cxf client.&lt;/p&gt;</comment>
                            <comment id="13743857" author="abdelgadiri" created="Mon, 19 Aug 2013 14:37:45 +0000"  >&lt;p&gt;for information I found that the fix for this issue and to ensure both test cases pass with expected header is to swap the order of setting the response header and writing to the output stream. So, the fix is for the writerinterceptor to have:&lt;/p&gt;

&lt;p&gt;response.setHeader(&quot;bug4986TestHeaderName&quot;, &quot;bug4986TestHeaderValue&quot;);&lt;br/&gt;
originalStream.write(base64Body.getBytes(&quot;UTF-8&quot;)); &lt;/p&gt;

&lt;p&gt;instead of:&lt;/p&gt;

&lt;p&gt;originalStream.write(base64Body.getBytes(&quot;UTF-8&quot;)); &lt;br/&gt;
response.setHeader(&quot;bug4986TestHeaderName&quot;, &quot;bug4986TestHeaderValue&quot;);&lt;/p&gt;

&lt;p&gt;If you do the above, then no ClientAbortExceptions will be thrown and the client will find all expected response headers. this hints that org.apache.cxf.transport.http.AbstractHTTPDestination$WrappedOutputStream is making an incorrect assumptions when writing to the output stream&lt;/p&gt;</comment>
                            <comment id="13744117" author="sergey_beryozkin" created="Mon, 19 Aug 2013 19:02:50 +0000"  >&lt;p&gt;First of all, thanks for getting it work; &lt;br/&gt;
FYI&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;originalStream.write(base64Body.getBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;));
response.setHeader(&lt;span class=&quot;code-quote&quot;&gt;&quot;bug4986TestHeaderName&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;bug4986TestHeaderValue&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;is incorrect, you can not write headers after writing to the stream and expect the headers be visible.&lt;br/&gt;
Closing this JIRA as invalid;&lt;/p&gt;</comment>
                            <comment id="13744188" author="abdelgadiri" created="Mon, 19 Aug 2013 20:39:13 +0000"  >&lt;p&gt;interesting to know! however:&lt;/p&gt;

&lt;p&gt;1. behaviour with respect to writing to headers after writing to stream is fine when size of payload is below a certain threshold. Since this is incorrect behaviour as you suggest then cxf should complain e.g., by throwing an illegalstateexception when one attempts to set headers after writing to stream. It also make the behaviour consistent irrespective of payload size.&lt;br/&gt;
2. I can not find this behaviour documented anywhere in the spec for jsr-339, for example see &lt;a href=&quot;https://javaee-spec.java.net/nonav/javadocs/javax/ws/rs/ext/WriterInterceptorContext.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://javaee-spec.java.net/nonav/javadocs/javax/ws/rs/ext/WriterInterceptorContext.html&lt;/a&gt;&lt;br/&gt;
3. how is this different from calling context.proceed() which will also end up writing to the output stream? to my knowledge you should be able to set headers after calling context.proceed()&lt;/p&gt;

</comment>
                            <comment id="13744761" author="sergey_beryozkin" created="Tue, 20 Aug 2013 07:09:35 +0000"  >&lt;p&gt;1: I guess it is servlet container specific, this is not controlled by JAX-RS stacks. Producing ISE is not something JAX-RS mentions anywhere, and it is probably difficult to do consistently&lt;/p&gt;

&lt;p&gt;2:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://jax-rs-spec.java.net/nonav/2.0/apidocs/javax/ws/rs/ext/MessageBodyWriter.html#writeTo(T,%20java.lang.Class,%20java.lang.reflect.Type,%20java.lang.annotation.Annotation[],%20javax.ws.rs.core.MediaType,%20javax.ws.rs.core.MultivaluedMap,%20java.io.OutputStream&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jax-rs-spec.java.net/nonav/2.0/apidocs/javax/ws/rs/ext/MessageBodyWriter.html#writeTo(T,%20java.lang.Class,%20java.lang.reflect.Type,%20java.lang.annotation.Annotation[],%20javax.ws.rs.core.MediaType,%20javax.ws.rs.core.MultivaluedMap,%20java.io.OutputStream&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;3. if you try set headers after context.proceed() then then these headers will likely be lost as well &lt;/p&gt;</comment>
                            <comment id="13744794" author="abdelgadiri" created="Tue, 20 Aug 2013 08:42:06 +0000"  >&lt;p&gt;Thank you very much Sergey.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12598470" name="bug4986-1.0.war" size="8677042" author="abdelgadiri" created="Fri, 16 Aug 2013 14:13:50 +0000"/>
                            <attachment id="12598469" name="bug4986.zip" size="17766" author="abdelgadiri" created="Fri, 16 Aug 2013 14:13:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>343594</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 14 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1n95z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>343898</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>