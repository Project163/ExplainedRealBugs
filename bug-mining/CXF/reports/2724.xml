<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:19:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-6706] Bean validation seems to not be working in OSGi</title>
                <link>https://issues.apache.org/jira/browse/CXF-6706</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;Using Karaf 4.0.2, &lt;/p&gt;

&lt;p&gt;if you take this repo:&lt;/p&gt;

&lt;p&gt;git@github.com:benson-basis/cxf-karaf-validation-tc.git&lt;/p&gt;

&lt;p&gt;and checkout the use-cxf-support branch, it will build you a Karaf assembly that, when you poke the service (&lt;a href=&quot;http://localhost:8181/cxf/validate&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8181/cxf/validate&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;will yield the following backtrace. This assumes that you are up to date with my fix to cxf-6705 which is on master and the 3.1.x branch.&lt;/p&gt;




&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;
javax.validation.ValidationException: Unable to find a default provider
	at javax.validation.Validation$GenericBootstrapImpl.configure(Validation.java:264)
	at javax.validation.Validation.buildDefaultValidatorFactory(Validation.java:111)
	at org.apache.cxf.validation.BeanValidationProvider.&amp;lt;init&amp;gt;(BeanValidationProvider.java:45)
	at com.basistech.ts.impl.TrivialService.validate(TrivialService.java:50)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12921063">CXF-6706</key>
            <summary>Bean validation seems to not be working in OSGi</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bmargulies">Benson Margulies</assignee>
                                    <reporter username="bmargulies">Benson Margulies</reporter>
                        <labels>
                    </labels>
                <created>Fri, 11 Dec 2015 14:09:57 +0000</created>
                <updated>Wed, 7 Jun 2017 11:28:22 +0000</updated>
                            <resolved>Mon, 14 Dec 2015 18:22:23 +0000</resolved>
                                    <version>3.1.4</version>
                    <version>3.2.0</version>
                                    <fixVersion>3.1.5</fixVersion>
                    <fixVersion>3.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15052961" author="bmargulies" created="Fri, 11 Dec 2015 16:16:58 +0000"  >&lt;p&gt;As of the changes I made for &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-6705&quot; title=&quot;Incorrect version in Import-Package for javax.validation for CXF Core&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-6705&quot;&gt;&lt;del&gt;CXF-6705&lt;/del&gt;&lt;/a&gt;, the error above can be circumvented by explicitly configuring a hibernate provider and not depending on the SPI. Should that be necessary?&lt;/p&gt;</comment>
                            <comment id="15053647" author="bmargulies" created="Fri, 11 Dec 2015 21:57:54 +0000"  >&lt;p&gt;In git@github.com:benson-basis/cxf.git, there&apos;s a branch cxf-6706-hibernate-help that has the &apos;helper&apos; that worked in my code. But it fails in Karaf 3 with the original &apos;missing expression class&apos; error. &lt;/p&gt;

&lt;p&gt;Caused by: java.lang.ClassNotFoundException: com.sun.el.ExpressionFactoryImpl not found by org.apache.cxf.cxf-rt-transports-http &lt;span class=&quot;error&quot;&gt;&amp;#91;91&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.felix.framework.BundleWiringImpl.findClassOrResourceByDelegation(BundleWiringImpl.java:1532)&lt;br/&gt;
	at org.apache.felix.framework.BundleWiringImpl.access$400(BundleWiringImpl.java:75)&lt;br/&gt;
	at org.apache.felix.framework.BundleWiringImpl$BundleClassLoader.loadClass(BundleWiringImpl.java:1955)&lt;/p&gt;</comment>
                            <comment id="15054337" author="githubbot" created="Sat, 12 Dec 2015 14:20:04 +0000"  >&lt;p&gt;GitHub user benson-basis opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cxf/pull/102&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/102&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-6706&quot; title=&quot;Bean validation seems to not be working in OSGi&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-6706&quot;&gt;&lt;del&gt;CXF-6706&lt;/del&gt;&lt;/a&gt; hibernate help&lt;/p&gt;

&lt;p&gt;    I&apos;m hoping to get some collaborative attention via this PR, as to why the test I added (and @Ignored) fails so spectacularly.&lt;/p&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/benson-basis/cxf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/benson-basis/cxf&lt;/a&gt; cxf-6706-hibernate-help&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cxf/pull/102.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/102.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #102&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit dccd12eb381d7403a09eb895aea36eaef604296d&lt;br/&gt;
Author: Benson Margulies &amp;lt;benson@basistech.com&amp;gt;&lt;br/&gt;
Date:   2015-12-11T21:06:17Z&lt;/p&gt;

&lt;p&gt;    try to add the helper to CXF.&lt;/p&gt;

&lt;p&gt;commit f20f255406152ca563fbce717d0118a02bff6d58&lt;br/&gt;
Author: Benson Margulies &amp;lt;benson@basistech.com&amp;gt;&lt;br/&gt;
Date:   2015-12-11T23:38:08Z&lt;/p&gt;

&lt;p&gt;    Ignore the test.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15054526" author="bmargulies" created="Sat, 12 Dec 2015 18:37:42 +0000"  >&lt;p&gt;I have it all working. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sergeyb&quot; class=&quot;user-hover&quot; rel=&quot;sergeyb&quot;&gt;sergeyb&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dkulp&quot; class=&quot;user-hover&quot; rel=&quot;dkulp&quot;&gt;dkulp&lt;/a&gt; Care to review before I put this on 3.1.x? &lt;/p&gt;</comment>
                            <comment id="15054981" author="githubbot" created="Sun, 13 Dec 2015 14:07:11 +0000"  >&lt;p&gt;Github user reta commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cxf/pull/102#issuecomment-164262300&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/102#issuecomment-164262300&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @benson-basis I&apos;ll try to help you out, @cschneider may have better idea about the issue.&lt;/p&gt;</comment>
                            <comment id="15055292" author="githubbot" created="Mon, 14 Dec 2015 02:20:06 +0000"  >&lt;p&gt;Github user reta commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cxf/pull/102#issuecomment-164324664&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/102#issuecomment-164324664&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @benson-basis Interesting, I pulled out your PR / branch, run tests and all of them are passed:&lt;/p&gt;

&lt;p&gt;    !&lt;span class=&quot;error&quot;&gt;&amp;#91;test&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://cloud.githubusercontent.com/assets/509855/11771492/32bf8a34-a1df-11e5-9e48-811cd749c24d.png&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cloud.githubusercontent.com/assets/509855/11771492/32bf8a34-a1df-11e5-9e48-811cd749c24d.png&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;    Any clues?&lt;/p&gt;</comment>
                            <comment id="15055941" author="chris@die-schneider.net" created="Mon, 14 Dec 2015 12:45:41 +0000"  >&lt;p&gt;I am not so sure about the approach. Looks like too much classloader and proxy magic for my taste. If it is really the only way then it is ok of course.&lt;br/&gt;
Another issue is that I am not sure if CXF is the correct place to put the ValidationHelper. &lt;/p&gt;

&lt;p&gt;I would rather expect hibernate to provide a bundle that offers an OSGi ready ValidationProvider or ValidationFactory as a service. As we do not have direct influence on the hibernate project we also might put such a module in karaf in the mean time. &lt;/p&gt;

&lt;p&gt;I will also ask in the OSGi dev group if there is experience with correctly using bean validation in OSGi.&lt;/p&gt;

&lt;p&gt;In any case CXF should rather simply refer to a ValidationProvider service and expect that it gets a valid one there.&lt;br/&gt;
WDYT?&lt;/p&gt;</comment>
                            <comment id="15055948" author="sergey_beryozkin" created="Mon, 14 Dec 2015 12:57:50 +0000"  >&lt;p&gt;Hi Christian&lt;/p&gt;

&lt;p&gt;You are right, it may not be quite CXF specific.&lt;br/&gt;
I copied to JB to get&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/SMX4-1618&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SMX4-1618&lt;/a&gt;&lt;br/&gt;
re-evaluated, I guess the spec API bundle may need to be tuned to find the actual Validation provider ?&lt;/p&gt;

&lt;p&gt;Having a Validation service (Karaf specific or even standard ?) would be nice too&lt;/p&gt;</comment>
                            <comment id="15055961" author="bmargulies" created="Mon, 14 Dec 2015 13:15:40 +0000"  >&lt;p&gt;I have a simplified alternative almost working using servicemix stuff.&lt;br/&gt;
Emphasis on almost, I think it will still need the proxy to deal with EL. I&lt;br/&gt;
will push it soon.&lt;/p&gt;
</comment>
                            <comment id="15055999" author="bmargulies" created="Mon, 14 Dec 2015 13:57:40 +0000"  >&lt;p&gt;I have read all the code in servicemix and I don&apos;t see anything that could&lt;br/&gt;
deal with the deferred load of the el provider. I could propose the proxy&lt;br/&gt;
circus as a servicemix patch. Unless hibernate has an api to push in an el&lt;br/&gt;
provider.&lt;/p&gt;
</comment>
                            <comment id="15056003" author="chris@die-schneider.net" created="Mon, 14 Dec 2015 14:03:17 +0000"  >&lt;p&gt;Probably we just need to wait a bit or help the hibernate guys:&lt;br/&gt;
&lt;a href=&quot;http://hibernate.org/validator/roadmap/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hibernate.org/validator/roadmap/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://hibernate.atlassian.net/browse/HV-570&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hibernate.atlassian.net/browse/HV-570&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Looks like on top of their roadmap is to expose the Validator as an OSGi service.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bimargulies%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;bimargulies@gmail.com&quot;&gt;bimargulies@gmail.com&lt;/a&gt; maybe you could offer them a patch?&lt;br/&gt;
Oops .. just saw that Charlie already did an impl. Can you check if it does the job?&lt;/p&gt;</comment>
                            <comment id="15056006" author="sergey_beryozkin" created="Mon, 14 Dec 2015 14:06:12 +0000"  >&lt;p&gt;Hi Benson&lt;/p&gt;

&lt;p&gt;According to &lt;a href=&quot;http://in.relation.to/2013/07/04/bean-validation-11-feature-spotlight-expression-language/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://in.relation.to/2013/07/04/bean-validation-11-feature-spotlight-expression-language/&lt;/a&gt; it is only have to be on the classpath so if it is not found then your patch to ServiceMix API spec bundle may help indeed&lt;/p&gt;</comment>
                            <comment id="15056015" author="bmargulies" created="Mon, 14 Dec 2015 14:10:40 +0000"  >&lt;p&gt;I am not sure what to tell them to do about EL. A dynamic-importpackage and&lt;br/&gt;
setting the tccl? Is there a better way?&lt;br/&gt;
On Dec 14, 2015 4:03 PM, &quot;Christian Schneider (JIRA)&quot; &amp;lt;jira@apache.org&amp;gt;&lt;/p&gt;
</comment>
                            <comment id="15056016" author="chris@die-schneider.net" created="Mon, 14 Dec 2015 14:11:47 +0000"  >&lt;p&gt;Just checked out the code from Charlie. It seems to use quite a lot of spring stuff. So it is pobably not the ideal solution. Maybe we can provide a better one for the issue above.&lt;/p&gt;</comment>
                            <comment id="15056075" author="githubbot" created="Mon, 14 Dec 2015 15:06:49 +0000"  >&lt;p&gt;Github user benson-basis commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cxf/pull/102#issuecomment-164460805&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/102#issuecomment-164460805&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Oh, it works. it&apos;s just really ugly &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;    Look at the horrible proxy code.&lt;/p&gt;

&lt;p&gt;    On Sun, Dec 13, 2015 at 9:20 PM, Andriy Redko &amp;lt;notifications@github.com&amp;gt;&lt;br/&gt;
    wrote:&lt;/p&gt;

&lt;p&gt;    &amp;gt; @benson-basis &amp;lt;&lt;a href=&quot;https://github.com/benson-basis&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/benson-basis&lt;/a&gt;&amp;gt; Interesting, I pulled out&lt;br/&gt;
    &amp;gt; your PR / branch, run tests and all of them are passed:&lt;br/&gt;
    &amp;gt;&lt;br/&gt;
    &amp;gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;image: test&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &amp;gt; &amp;lt;&lt;a href=&quot;https://cloud.githubusercontent.com/assets/509855/11771492/32bf8a34-a1df-11e5-9e48-811cd749c24d.png&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cloud.githubusercontent.com/assets/509855/11771492/32bf8a34-a1df-11e5-9e48-811cd749c24d.png&lt;/a&gt;&amp;gt;&lt;br/&gt;
    &amp;gt;&lt;br/&gt;
    &amp;gt; Any clues?&lt;br/&gt;
    &amp;gt;&lt;br/&gt;
    &amp;gt; &#8212;&lt;br/&gt;
    &amp;gt; Reply to this email directly or view it on GitHub&lt;br/&gt;
    &amp;gt; &amp;lt;&lt;a href=&quot;https://github.com/apache/cxf/pull/102#issuecomment-164324664&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/102#issuecomment-164324664&lt;/a&gt;&amp;gt;.&lt;br/&gt;
    &amp;gt;&lt;/p&gt;
</comment>
                            <comment id="15056091" author="bmargulies" created="Mon, 14 Dec 2015 15:17:27 +0000"  >&lt;p&gt;Let me show you &apos;plan b&apos; that fails. It fails because the ServiceMix bundle for hibernate does not do any import that sees com.sun.el for the EL implementation. I suppose that if I make the local bundle import com.sun.el and use it&apos;s class loader, it might work, coming right up.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; BeanValidationProvider prov;
        &lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt; oldtccl = &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread().getContextClassLoader();
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread().setContextClassLoader(HibernateValidator.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getClassLoader());
            HibernateValidatorConfiguration configuration =
                    Validation.byProvider(HibernateValidator.class)
                            .configure();
            ValidatorFactory factory = configuration.buildValidatorFactory();
            prov = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BeanValidationProvider(factory);
        } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
            &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread().setContextClassLoader(oldtccl);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread().setContextClassLoader(HibernateValidator.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getClassLoader());
            prov.validateBean(book);
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (ConstraintViolationException cve) {
            &lt;span class=&quot;code-comment&quot;&gt;/* ... */&lt;/span&gt;
        } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
            &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread().setContextClassLoader(oldtccl);
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15056094" author="bmargulies" created="Mon, 14 Dec 2015 15:19:21 +0000"  >&lt;p&gt;And, indeed, it does. By adding a bit of classloader management to the BeanValidationProvider I think I can mutate this patch to be acceptable until Hibernate does better.&lt;/p&gt;</comment>
                            <comment id="15056097" author="githubbot" created="Mon, 14 Dec 2015 15:21:54 +0000"  >&lt;p&gt;Github user cschneider commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cxf/pull/102#issuecomment-164464862&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/102#issuecomment-164464862&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Why do you use the hibernate bundle from servicemix?&lt;br/&gt;
    It looks like hibernate already provides a validator bundle:&lt;br/&gt;
    &lt;a href=&quot;http://search.maven.org/#artifactdetails&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://search.maven.org/#artifactdetails&lt;/a&gt;|org.hibernate|hibernate-validator-osgi|5.2.2.Final|pom&lt;/p&gt;</comment>
                            <comment id="15056103" author="githubbot" created="Mon, 14 Dec 2015 15:27:06 +0000"  >&lt;p&gt;Github user benson-basis commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cxf/pull/102#issuecomment-164466569&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/102#issuecomment-164466569&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I didn&apos;t know. I assumed that the SM stuff was there for a reason. That&lt;br/&gt;
    will be my next port of call.&lt;/p&gt;


&lt;p&gt;    On Mon, Dec 14, 2015 at 10:21 AM, Christian Schneider &amp;lt;&lt;br/&gt;
    notifications@github.com&amp;gt; wrote:&lt;/p&gt;

&lt;p&gt;    &amp;gt; Why do you use the hibernate bundle from servicemix?&lt;br/&gt;
    &amp;gt; It looks like hibernate already provides a validator bundle:&lt;br/&gt;
    &amp;gt;&lt;br/&gt;
    &amp;gt; &lt;a href=&quot;http://search.maven.org/#artifactdetails&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://search.maven.org/#artifactdetails&lt;/a&gt;|org.hibernate|hibernate-validator-osgi|5.2.2.Final|pom&lt;br/&gt;
    &amp;gt;&lt;br/&gt;
    &amp;gt; &#8212;&lt;br/&gt;
    &amp;gt; Reply to this email directly or view it on GitHub&lt;br/&gt;
    &amp;gt; &amp;lt;&lt;a href=&quot;https://github.com/apache/cxf/pull/102#issuecomment-164464862&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/102#issuecomment-164464862&lt;/a&gt;&amp;gt;.&lt;br/&gt;
    &amp;gt;&lt;/p&gt;
</comment>
                            <comment id="15056106" author="githubbot" created="Mon, 14 Dec 2015 15:27:35 +0000"  >&lt;p&gt;Github user benson-basis commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cxf/pull/102#issuecomment-164466763&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/102#issuecomment-164466763&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Do you think I can then avoid the &apos;specs&apos; bundle, too?&lt;/p&gt;


&lt;p&gt;    On Mon, Dec 14, 2015 at 10:27 AM, Benson Margulies &amp;lt;benson@basistech.com&amp;gt;&lt;br/&gt;
    wrote:&lt;/p&gt;

&lt;p&gt;    &amp;gt; I didn&apos;t know. I assumed that the SM stuff was there for a reason. That&lt;br/&gt;
    &amp;gt; will be my next port of call.&lt;br/&gt;
    &amp;gt;&lt;br/&gt;
    &amp;gt;&lt;br/&gt;
    &amp;gt; On Mon, Dec 14, 2015 at 10:21 AM, Christian Schneider &amp;lt;&lt;br/&gt;
    &amp;gt; notifications@github.com&amp;gt; wrote:&lt;br/&gt;
    &amp;gt;&lt;br/&gt;
    &amp;gt;&amp;gt; Why do you use the hibernate bundle from servicemix?&lt;br/&gt;
    &amp;gt;&amp;gt; It looks like hibernate already provides a validator bundle:&lt;br/&gt;
    &amp;gt;&amp;gt;&lt;br/&gt;
    &amp;gt;&amp;gt; &lt;a href=&quot;http://search.maven.org/#artifactdetails&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://search.maven.org/#artifactdetails&lt;/a&gt;|org.hibernate|hibernate-validator-osgi|5.2.2.Final|pom&lt;br/&gt;
    &amp;gt;&amp;gt;&lt;br/&gt;
    &amp;gt;&amp;gt; &#8212;&lt;br/&gt;
    &amp;gt;&amp;gt; Reply to this email directly or view it on GitHub&lt;br/&gt;
    &amp;gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://github.com/apache/cxf/pull/102#issuecomment-164464862&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/102#issuecomment-164464862&lt;/a&gt;&amp;gt;.&lt;br/&gt;
    &amp;gt;&amp;gt;&lt;br/&gt;
    &amp;gt;&lt;br/&gt;
    &amp;gt;&lt;/p&gt;
</comment>
                            <comment id="15056112" author="bmargulies" created="Mon, 14 Dec 2015 15:30:33 +0000"  >&lt;p&gt;I tried their bundle. Same original problem:&lt;/p&gt;

&lt;p&gt;javax.validation.ValidationException: Unable to create a Configuration, because no Bean Validation provider could be found. Add a provider like Hibernate Validator (RI) to your classpath.&lt;/p&gt;

&lt;p&gt;	at javax.validation.Validation$GenericBootstrapImpl.configure(Validation.java:271)&lt;br/&gt;
	at javax.validation.Validation.buildDefaultValidatorFactory(Validation.java:110)&lt;br/&gt;
	at com.basistech.hibernateitest.HibernateValidationTest.defaultProvider(HibernateValidationTest.java:90)&lt;/p&gt;


&lt;p&gt;The SM bundle at least provides some API support for getting around this.&lt;/p&gt;

&lt;p&gt;Let me go see if they publish any doc to go with that bundle.&lt;/p&gt;</comment>
                            <comment id="15056153" author="bmargulies" created="Mon, 14 Dec 2015 15:49:32 +0000"  >&lt;p&gt;Their stuff is defective from my POV.&lt;/p&gt;

&lt;p&gt;For example:&lt;/p&gt;

&lt;p&gt;   &amp;lt;bundle&amp;gt;wrap:mvn:com.thoughtworks.paranamer:paranamer:2.5.5&amp;lt;/bundle&amp;gt;&lt;/p&gt;

&lt;p&gt;in the karaf bundle. &amp;lt;wrap&amp;gt; doesn&apos;t work very well in Karaf 4.  I feel like spending time on it once I blew up on that.&lt;/p&gt;</comment>
                            <comment id="15056158" author="githubbot" created="Mon, 14 Dec 2015 15:53:22 +0000"  >&lt;p&gt;Github user benson-basis commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cxf/pull/102#issuecomment-164473792&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/102#issuecomment-164473792&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I think that what&apos;s here now should be digestible. No &apos;helper&apos;, no proxy, just a bit of TCCL juggling and import management required by the creator of the BeanValidationProvider instance. People who want to do that from Blueprint will be sad, I guess. Do people want some sort of factory?&lt;/p&gt;

&lt;p&gt;    If something better emerges from Hibernate later, great.&lt;/p&gt;
</comment>
                            <comment id="15056164" author="githubbot" created="Mon, 14 Dec 2015 15:56:25 +0000"  >&lt;p&gt;Github user cschneider commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cxf/pull/102#issuecomment-164474590&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/102#issuecomment-164474590&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I think we should not create our own feature for hibernate. There is already one:&lt;/p&gt;</comment>
                            <comment id="15056174" author="githubbot" created="Mon, 14 Dec 2015 15:59:20 +0000"  >&lt;p&gt;Github user benson-basis commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cxf/pull/102#issuecomment-164475385&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/102#issuecomment-164475385&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Yes, and it&apos;s busted. It uses wrap, and karaf 4 refuses to start up if you&lt;br/&gt;
    provision it as a bootFeature. For a 3.1.x change, I doubt that we want to&lt;br/&gt;
    remove the feature. I have unwould the extra feature I added.&lt;/p&gt;

&lt;p&gt;    On Mon, Dec 14, 2015 at 10:56 AM, Christian Schneider &amp;lt;&lt;br/&gt;
    notifications@github.com&amp;gt; wrote:&lt;/p&gt;

&lt;p&gt;    &amp;gt; I think we should not create our own feature for hibernate. There is&lt;br/&gt;
    &amp;gt; already one:&lt;br/&gt;
    &amp;gt;&lt;br/&gt;
    &amp;gt; &#8212;&lt;br/&gt;
    &amp;gt; Reply to this email directly or view it on GitHub&lt;br/&gt;
    &amp;gt; &amp;lt;&lt;a href=&quot;https://github.com/apache/cxf/pull/102#issuecomment-164474590&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/102#issuecomment-164474590&lt;/a&gt;&amp;gt;.&lt;br/&gt;
    &amp;gt;&lt;/p&gt;
</comment>
                            <comment id="15056181" author="sergey_beryozkin" created="Mon, 14 Dec 2015 16:04:51 +0000"  >&lt;p&gt;Having a short term solution (Benson&apos;s utility/helper bundle) that can be deprecated once a more robust solution is available seems reasonable to me&lt;/p&gt;</comment>
                            <comment id="15056193" author="sergey_beryozkin" created="Mon, 14 Dec 2015 16:09:39 +0000"  >&lt;p&gt;Thought should this helper bundle be a ServiceMix bundle ?&lt;/p&gt;</comment>
                            <comment id="15056194" author="githubbot" created="Mon, 14 Dec 2015 16:09:48 +0000"  >&lt;p&gt;Github user cschneider commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cxf/pull/102#issuecomment-164478366&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/102#issuecomment-164478366&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Ah yes I see there are two wrap entries ... still I think this does not belong into cxf. &lt;br/&gt;
    I am especially concerned with the tight binding of the cxf validation to hibernate validator. I think CXF should be able to work with any validation provider and let the user choose which to install.&lt;/p&gt;

&lt;p&gt;    How about adding a correct hibernate 5 feature without wrap into the upcoming karaf 4.0.4?&lt;br/&gt;
    I will take care of providing a fix to hibernate so their own feature is better in the next release.&lt;/p&gt;

&lt;p&gt;    I propose we only have the cxf-bean-validation feature in CXF. We can load the validation api using dependency=true. This way it should nicely interoperate with the hibernate validator feature.&lt;/p&gt;
</comment>
                            <comment id="15056199" author="chris@die-schneider.net" created="Mon, 14 Dec 2015 16:12:26 +0000"  >&lt;p&gt;As karaf 4.0.4 will be released in the next few days I am sure we can provide a correct hibernate validator feature in karaf in short term. So I dont think this step is necessary.&lt;/p&gt;

&lt;p&gt;I think it is even simpler. Karaf already contains a hibernate validator feature in the enterprise feature repo. Would this work for us?&lt;/p&gt;</comment>
                            <comment id="15056201" author="chris@die-schneider.net" created="Mon, 14 Dec 2015 16:14:43 +0000"  >&lt;p&gt;If I am not mistaken then the newest pull request does not contain any helper bundle anymore. So I think the only thing left to do is provide a good feature.&lt;/p&gt;</comment>
                            <comment id="15056226" author="chris@die-schneider.net" created="Mon, 14 Dec 2015 16:26:10 +0000"  >&lt;p&gt;This also seems relevant:&lt;br/&gt;
&lt;a href=&quot;https://github.com/hibernate/hibernate-validator/pull/371&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/hibernate/hibernate-validator/pull/371&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Looks like they provided a new hook to use a user class loader. Not sure if that would help us but it might.&lt;/p&gt;</comment>
                            <comment id="15056229" author="githubbot" created="Mon, 14 Dec 2015 16:28:09 +0000"  >&lt;p&gt;Github user benson-basis commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cxf/pull/102#issuecomment-164485180&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/102#issuecomment-164485180&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I am entirely with you for 3.2.0. For 3.1.5 I just wanted to patch things&lt;br/&gt;
    into working condition. What do you think of my smaller maneuver in&lt;br/&gt;
    beanvalidationprovider?&lt;br/&gt;
    On Dec 14, 2015 6:09 PM, &quot;Christian Schneider&quot; &amp;lt;notifications@github.com&amp;gt;&lt;br/&gt;
    wrote:&lt;/p&gt;

&lt;p&gt;    &amp;gt; Ah yes I see there are two wrap entries ... still I think this does not&lt;br/&gt;
    &amp;gt; belong into cxf.&lt;br/&gt;
    &amp;gt; I am especially concerned with the tight binding of the cxf validation to&lt;br/&gt;
    &amp;gt; hibernate validator. I think CXF should be able to work with any validation&lt;br/&gt;
    &amp;gt; provider and let the user choose which to install.&lt;br/&gt;
    &amp;gt;&lt;br/&gt;
    &amp;gt; How about adding a correct hibernate 5 feature without wrap into the&lt;br/&gt;
    &amp;gt; upcoming karaf 4.0.4?&lt;br/&gt;
    &amp;gt; I will take care of providing a fix to hibernate so their own feature is&lt;br/&gt;
    &amp;gt; better in the next release.&lt;br/&gt;
    &amp;gt;&lt;br/&gt;
    &amp;gt; I propose we only have the cxf-bean-validation feature in CXF. We can load&lt;br/&gt;
    &amp;gt; the validation api using dependency=true. This way it should nicely&lt;br/&gt;
    &amp;gt; interoperate with the hibernate validator feature.&lt;br/&gt;
    &amp;gt;&lt;br/&gt;
    &amp;gt; &#8212;&lt;br/&gt;
    &amp;gt; Reply to this email directly or view it on GitHub&lt;br/&gt;
    &amp;gt; &amp;lt;&lt;a href=&quot;https://github.com/apache/cxf/pull/102#issuecomment-164478366&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/102#issuecomment-164478366&lt;/a&gt;&amp;gt;.&lt;br/&gt;
    &amp;gt;&lt;/p&gt;
</comment>
                            <comment id="15056231" author="sergey_beryozkin" created="Mon, 14 Dec 2015 16:30:22 +0000"  >&lt;p&gt;Hi Christian, &lt;br/&gt;
as far as I recall Benson suggested having Hibernate and Apache BVal features, and it would probably completely cover the provider space &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, +1 to having a nice feature in Karaf, though I wonder, what if someone wants to try it outside of Karaf, how can that work , i.e is some work may still need to be done with ServiceMix bundles  ?&lt;/p&gt;</comment>
                            <comment id="15056238" author="chris@die-schneider.net" created="Mon, 14 Dec 2015 16:34:40 +0000"  >&lt;p&gt;I agree with you Benson. As the feature is already there it makes sense to fix it for 3.1.x. It would not make sense to do a big change in the bugfix branch.&lt;br/&gt;
So I propose you provide the fixed version for 3.1.x and I provide a smaller feature for 3.2.x that avoids having hibernate bundles in the CXF feature.&lt;/p&gt;</comment>
                            <comment id="15056245" author="chris@die-schneider.net" created="Mon, 14 Dec 2015 16:38:08 +0000"  >&lt;p&gt;I think the Apache Bval feature should rather go into karaf too. So the CXF feature is simply agnostic to where the provider comes from.&lt;/p&gt;

&lt;p&gt;Outside karaf people do not have features anyway. So they will have to figure out which bundles to use. As the current code from Benson does not do any fancy magic (it just sets the TCCL) I think there is no need to provide additional support for it in servicemix bundles.&lt;/p&gt;</comment>
                            <comment id="15056253" author="chris@die-schneider.net" created="Mon, 14 Dec 2015 16:44:03 +0000"  >&lt;p&gt;I created an issue at hibernate to fix their feature &lt;a href=&quot;https://hibernate.atlassian.net/browse/HHH-10377&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hibernate.atlassian.net/browse/HHH-10377&lt;/a&gt;. As there already is a validator (4.3.x)  feature in karaf I think we can wait for their fix and do not need to provide a fixed feature in karaf.&lt;/p&gt;</comment>
                            <comment id="15056263" author="githubbot" created="Mon, 14 Dec 2015 16:51:35 +0000"  >&lt;p&gt;Github user cschneider commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cxf/pull/102#issuecomment-164492183&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/102#issuecomment-164492183&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The change in BeanValidator looks good to me. I think it is just a workaround though. If hibernate needs el to work internally it should take care of importing it by itself. Maybe we should file this as a bug.&lt;br/&gt;
    On the other hand providing a special classloader makes sense anyway as hibernate validator needs access to the user classes. &lt;/p&gt;</comment>
                            <comment id="15056267" author="githubbot" created="Mon, 14 Dec 2015 16:53:22 +0000"  >&lt;p&gt;Github user cschneider commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cxf/pull/102#issuecomment-164492683&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/102#issuecomment-164492683&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    So anyway .. +1 for this change in CXF 3.1.x. I sometimes concentrate too much on the long term effects. For the bugfix release your changes make sense.&lt;/p&gt;</comment>
                            <comment id="15056423" author="bmargulies" created="Mon, 14 Dec 2015 18:22:23 +0000"  >&lt;p&gt;The changes made at least make it possible to use bean validation, osgi, and karaf. We intend to neaten this up further for 3.2.0.&lt;/p&gt;</comment>
                            <comment id="15059727" author="gunnar.morling" created="Wed, 16 Dec 2015 09:05:16 +0000"  >&lt;p&gt;Hi, a Hibernate Validator developer here &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Sorry to hear you run into issues with using HV in OSGi. We&apos;ve put a bit of an effort into making it work, which it actually does in general by now. But I am happy to help ironing out any remaining glitches.&lt;/p&gt;

&lt;p&gt;Some remarks:&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Bootstrap&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;Atm. a custom validation provider resolver is needed with OSGi, also if the &lt;tt&gt;HibernateValidator&lt;/tt&gt; provider is explicitly used. This is due to a glitch in the BV API JAR, which we&apos;ve planned to fix in the next version (see &lt;a href=&quot;https://hibernate.atlassian.net/browse/BVAL-486&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;BVAL-486&lt;/a&gt;). Note that the official spec JAR already contains the required manifest entries. So for now it&apos;d have to be the following:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MyValidationProviderResolver &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; ValidationProviderResolver {

    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; List&amp;lt;ValidationProvider&amp;lt;?&amp;gt;&amp;gt; getValidationProviders() {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; Collections.&amp;lt;ValidationProvider&amp;lt;?&amp;gt;&amp;gt;singletonList( &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HibernateValidator() );
    }
}

&lt;span class=&quot;code-comment&quot;&gt;// And using the resolver:
&lt;/span&gt;ValidatorFacotry vf = Validation.byProvider( HibernateValidator.class )
    .providerResolver( &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MyValidationProviderResolver() )
    .configure()
    .buildValidatorFactory();
				
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;b&gt;User-provided resources&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;Whenever we need to load stuff by name or provided by the user in general (classes given in XML config, message bundles etc.) we do so using a classloader that may explicitly be set during bootstrap. See &lt;tt&gt;HibernateValidatorConfiguration#externalClassLoader()&lt;/tt&gt; for the details.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Karaf Features file&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;We provide one already (see &lt;a href=&quot;https://github.com/hibernate/hibernate-validator/blob/master/osgi/karaf-features/src/main/features/features.xml&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;) and I&apos;d love it that&apos;d be &quot;the one&quot;. We can fix the issues due to the wrap stuff, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bmargulies&quot; class=&quot;user-hover&quot; rel=&quot;bmargulies&quot;&gt;bmargulies&lt;/a&gt; offered his help already. Thanks!&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Class-loading issues around EL&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;This one is puzzling me, it should suffice if the HV bundle can see EL packages (in the right version) exported by another bundle. As discussed in &lt;a href=&quot;https://hibernate.atlassian.net/browse/HV-1039&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;HV-1039&lt;/a&gt; we&apos;d need to have some more details on this one (full log/stacktrace).&lt;/p&gt;

&lt;p&gt;Please let me know if there is anything else I/we can do to make that integration work smoothly.&lt;/p&gt;</comment>
                            <comment id="15059733" author="chris@die-schneider.net" created="Wed, 16 Dec 2015 09:20:34 +0000"  >&lt;p&gt;Fully agree with using the official hibernate feature in the future. At the moment we have the problem with the wrap: usage. This should be fixed in the next version though. So I will propose in the karaf dev list that we do not include any new hibernate features in the enterprise feature file and instead document to use the official feature file from hibernate. &lt;br/&gt;
I have already added the hibernate feature url to org.apache.karaf.features.cfg. So people can add the hibernate feature using feature:repo-add hibernate &amp;lt;version&amp;gt;.&lt;/p&gt;

&lt;p&gt;Many thanks for your help in ironing out the remaining problems.&lt;/p&gt;
</comment>
                            <comment id="15059827" author="sergey_beryozkin" created="Wed, 16 Dec 2015 10:57:57 +0000"  >&lt;p&gt;Gunnar, thanks for the information,&lt;/p&gt;

&lt;p&gt;Benson, FYI, CXF BeanValidationProvider has a constructor accepting a custom  ValidationProviderResolver&lt;/p&gt;

&lt;p&gt;Cheers, Sergey &lt;/p&gt;</comment>
                            <comment id="15059859" author="bmargulies" created="Wed, 16 Dec 2015 11:35:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gunnar.morling&quot; class=&quot;user-hover&quot; rel=&quot;gunnar.morling&quot;&gt;gunnar.morling&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;On the EL classpath thing:&lt;/p&gt;

&lt;p&gt;One way to see this: checkout the Apache CXF tree on the 3.1.x branch, and remove the call to set a special classloader in the BeanValidationProvider from org.apache.cxf.osgi.itests.jaxrs.BookStore#createBookValidate.&lt;/p&gt;

&lt;p&gt;However, I hope to have a contained test case for you in a few minutes. I&apos;m currently having a struggle with PaxExam.&lt;/p&gt;
</comment>
                            <comment id="15059865" author="chris@die-schneider.net" created="Wed, 16 Dec 2015 11:38:13 +0000"  >&lt;p&gt;How about abstracting the validator problem from CXF a bit? We could create a small test bundle on github to explore how to use bean validation in a nice way in general.&lt;br/&gt;
Then when we are fine with this go back to the cxf integration.&lt;/p&gt;</comment>
                            <comment id="15059894" author="bmargulies" created="Wed, 16 Dec 2015 12:11:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chris%40die-schneider.net&quot; class=&quot;user-hover&quot; rel=&quot;chris@die-schneider.net&quot;&gt;chris@die-schneider.net&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/benson-basis/hibernate-karaf-tc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/benson-basis/hibernate-karaf-tc&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If you can help me figure out why pax-exam refuses to run this simple thing, I will be very, very grateful.&lt;/p&gt;</comment>
                            <comment id="15059929" author="bmargulies" created="Wed, 16 Dec 2015 12:35:56 +0000"  >&lt;p&gt;I&apos;ve pushed a &apos;not-karaf&apos; branch. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gunnar.morling&quot; class=&quot;user-hover&quot; rel=&quot;gunnar.morling&quot;&gt;gunnar.morling&lt;/a&gt;, I think this shows that I am missing something basic. It hangs trying to get a log manager in log4j 2. I just let it have a log4j2 bundle, maybe this is a bad idea? I&apos;ll some some research on pax-logging and log4j2.&lt;/p&gt;

&lt;p&gt;I&apos;m sort of stumped here. When I use 5.2.2.Final, I get hung up with log4j2. When I use the older version that servicemix has worked around that for, there&apos;s no &apos;exernalClasspath&apos;.&lt;/p&gt;
</comment>
                            <comment id="15059944" author="bmargulies" created="Wed, 16 Dec 2015 12:54:58 +0000"  >&lt;p&gt;The not-karaf branch now runs with the older, servicemixed, validator &amp;#8211; and fails to fail. So it isn&apos;t a model of what happens in CXF as yet. I&apos;ll go try harder.&lt;/p&gt;</comment>
                            <comment id="15060638" author="bmargulies" created="Wed, 16 Dec 2015 19:37:16 +0000"  >&lt;p&gt;I decided to make sure that I could reproduce the problem in CXF after taking all of Gunnar&apos;s advice before working further on a small test case.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/cxf/pull/103/files&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/103/files&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In the process, I noticed type signature problems with the BeanValidationProvider constructors that &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sergey_beryozkin&quot; class=&quot;user-hover&quot; rel=&quot;sergey_beryozkin&quot;&gt;sergey_beryozkin&lt;/a&gt; pointed to. I am in the middle of discovering if the we still have a problem at all after taking the advice.&lt;/p&gt;</comment>
                            <comment id="15060684" author="bmargulies" created="Wed, 16 Dec 2015 19:52:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chris%40die-schneider.net&quot; class=&quot;user-hover&quot; rel=&quot;chris@die-schneider.net&quot;&gt;chris@die-schneider.net&lt;/a&gt; So, that PR still need a classloader trick to avoid a problem with EL, and I&apos;m really unsure as to how to get the small test case to try to follow along.&lt;/p&gt;

&lt;p&gt;Here&apos;s the pattern: when you create a JAX-RS service, you cause some jetty bundle to call your resource class, and then the resource class calls validate(), and that goes &apos;poof&apos;. I am going to try to cook up something with a TinyBundle to do this, but if you happen to see this and have an idea of a shorter cut, I&apos;d be grateful. I&apos;m at end of day in this time zone.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gunnar.morling&quot; class=&quot;user-hover&quot; rel=&quot;gunnar.morling&quot;&gt;gunnar.morling&lt;/a&gt; I continue to strive to make you a self-contained test case &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;
</comment>
                            <comment id="15060829" author="gunnar.morling" created="Wed, 16 Dec 2015 20:49:10 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bimargulies%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;bimargulies@gmail.com&quot;&gt;bimargulies@gmail.com&lt;/a&gt;, maybe you could take the &lt;a href=&quot;https://github.com/hibernate/hibernate-validator/blob/master/osgi/integrationtest/src/test/java/org/hibernate/validator/osgi/integrationtest/OsgiIntegrationTest.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;OSGi integration test&lt;/a&gt; from Hibernate Validator as a starting point for your experiments? This runs Hibernate Validator on Karaf, using our Features file. No problems with EL or similar there. So maybe you could take it and see where&apos;s the difference in your set-up to narrow down the issue.&lt;/p&gt;</comment>
                            <comment id="15060885" author="gunnar.morling" created="Wed, 16 Dec 2015 21:14:01 +0000"  >&lt;p&gt;Regarding the logging issue, Hibernate Validator (or, more specifically, JBoss Logging, which is the logging facade it uses) doesn&apos;t require log4j or any other specific log library. So you could just try and omit it, it will then use the JDK util logging framework by default.&lt;/p&gt;</comment>
                            <comment id="15061558" author="bmargulies" created="Thu, 17 Dec 2015 06:00:47 +0000"  >&lt;p&gt;Now that I&apos;ve awake, I&apos;m back on track. I need to set up some tiny bundles to create an environment that has the same structure as the situation that fails on CXF.&lt;/p&gt;</comment>
                            <comment id="15061840" author="sergey_beryozkin" created="Thu, 17 Dec 2015 10:11:45 +0000"  >&lt;p&gt;Hi Benson, the constructors can be tweaked if needed, np, just let me know what the problem is, and I can get the constructors simplified, cheers&lt;/p&gt;</comment>
                            <comment id="15062263" author="bmargulies" created="Thu, 17 Dec 2015 16:21:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gunnar.morling&quot; class=&quot;user-hover&quot; rel=&quot;gunnar.morling&quot;&gt;gunnar.morling&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I have a small test case for you. It fails. It fails &lt;em&gt;differently&lt;/em&gt; than the CXF failure, but I think it&apos;s reasonably possible that they stem from the same problem. However, you may not feel that this meets your entry conditions.&lt;/p&gt;

&lt;p&gt;git@github.com:benson-basis/hibernate-karaf-tc.git, branch not-karaf&lt;/p&gt;

&lt;p&gt;If you run the test in here, the log messages will include:&lt;/p&gt;

&lt;p&gt;null&lt;span class=&quot;error&quot;&gt;&amp;#91;com.basistech.hibernateitest.ms.MockService&amp;#93;&lt;/span&gt; : Validation ran but didn&apos;t complain&lt;/p&gt;

&lt;p&gt;That is, I don&apos;t get any class-not-found errors, but instead the validator doesn&apos;t complain about an object that should fail validation.&lt;/p&gt;

&lt;p&gt;This is, of course, different from the original problem, which is below. I&apos;m going to do some debugging in CXF to see if I can get some idea about how the Karaf+CXF+Pax-Web combo comes up with a different classloading environment than my test case.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Caused by: javax.el.ELException: Provider com.sun.el.ExpressionFactoryImpl not found
	at javax.el.FactoryFinder.newInstance(FactoryFinder.java:101)[51:javax.el-api:3.0.0]
	at javax.el.FactoryFinder.find(FactoryFinder.java:197)[51:javax.el-api:3.0.0]
	at javax.el.ExpressionFactory.newInstance(ExpressionFactory.java:197)[51:javax.el-api:3.0.0]
	at javax.el.ExpressionFactory.newInstance(ExpressionFactory.java:168)[51:javax.el-api:3.0.0]
	at org.hibernate.validator.internal.engine.messageinterpolation.InterpolationTerm.&amp;lt;clinit&amp;gt;(InterpolationTerm.java:60)
	... 65 more
Caused by: java.lang.ClassNotFoundException: com.sun.el.ExpressionFactoryImpl not found by org.apache.cxf.cxf-rt-transports-http [90]
	at org.apache.felix.framework.BundleWiringImpl.findClassOrResourceByDelegation(BundleWiringImpl.java:1532)
	at org.apache.felix.framework.BundleWiringImpl.access$400(BundleWiringImpl.java:75)
	at org.apache.felix.framework.BundleWiringImpl$BundleClassLoader.loadClass(BundleWiringImpl.java:1955)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:357)[:1.8.0_60]
	at org.apache.felix.framework.Felix.loadBundleClass(Felix.java:1844)
	at org.apache.felix.framework.BundleImpl.loadClass(BundleImpl.java:937)
	at org.ops4j.pax.swissbox.core.BundleClassLoader.findClass(BundleClassLoader.java:176)[80:org.ops4j.pax.swissbox.core:1.7.0]
	at java.lang.ClassLoader.loadClass(ClassLoader.java:424)[:1.8.0_60]
	at org.ops4j.pax.swissbox.core.BundleClassLoader.loadClass(BundleClassLoader.java:192)[80:org.ops4j.pax.swissbox.core:1.7.0]
	at java.lang.ClassLoader.loadClass(ClassLoader.java:357)[:1.8.0_60]
	at javax.el.FactoryFinder.newInstance(FactoryFinder.java:87)[51:javax.el-api:3.0.0]
	... 69 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15062469" author="bmargulies" created="Thu, 17 Dec 2015 18:13:59 +0000"  >&lt;p&gt;I&apos;ve explained the &apos;no validation errors&apos; situation, and I&apos;m closer to reproducing the actual problem.&lt;/p&gt;</comment>
                            <comment id="15062474" author="bmargulies" created="Thu, 17 Dec 2015 18:18:57 +0000"  >&lt;p&gt;The test case now reproduced the original problem, complete with a place to set a context class loader to make the problem go away.&lt;/p&gt;

&lt;p&gt;You might wish that I could repro this with 5.2.2_Final; I&apos;m currently stuck on the log4j2 issue, but I&apos;ll look into getting around that.&lt;/p&gt;</comment>
                            <comment id="15062514" author="bmargulies" created="Thu, 17 Dec 2015 18:39:46 +0000"  >&lt;p&gt;Well, I&apos;m sure you&apos;re all really bored of all this by now, but I hope you&apos;ll read this one.&lt;/p&gt;

&lt;p&gt;5.2.2_Final does not have the problem. jboss-logging 3.3.0.Final is fine, the log4j2 dep is optional. &lt;/p&gt;

&lt;p&gt;I will be making the changes to CXF to take advantage of all of this.&lt;/p&gt;
</comment>
                            <comment id="15063679" author="gunnar.morling" created="Fri, 18 Dec 2015 08:14:59 +0000"  >&lt;p&gt;Hey, that sounds great! So to be sure, also the issue around EL goes away if you use HV 5.2.2 + JBoss Logging 3.3.0? Then indeed the update to the HV Features file seems to be all that is needed. Looking forward to your PR for that, thanks for investigating and making it work!&lt;/p&gt;</comment>
                            <comment id="15279949" author="githubbot" created="Wed, 11 May 2016 11:17:25 +0000"  >&lt;p&gt;Github user tomitribe-dev commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cxf/pull/102#issuecomment-218430605&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/102#issuecomment-218430605&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Build triggered. sha1 is original commit.&lt;/p&gt;</comment>
                            <comment id="15279968" author="githubbot" created="Wed, 11 May 2016 11:22:14 +0000"  >&lt;p&gt;Github user tomitribe-dev commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cxf/pull/102#issuecomment-218431546&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/102#issuecomment-218431546&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Build started sha1 is original commit.&lt;/p&gt;
</comment>
                            <comment id="15279974" author="githubbot" created="Wed, 11 May 2016 11:27:44 +0000"  >&lt;p&gt;Github user tomitribe-dev commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cxf/pull/102#issuecomment-218432570&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/102#issuecomment-218432570&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Build finished. 697 tests run, 2 skipped, 0 failed.&lt;/p&gt;
</comment>
                            <comment id="16025298" author="githubbot" created="Thu, 25 May 2017 20:03:09 +0000"  >&lt;p&gt;Github user deki commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cxf/pull/102&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/102&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-6706&quot; title=&quot;Bean validation seems to not be working in OSGi&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-6706&quot;&gt;&lt;del&gt;CXF-6706&lt;/del&gt;&lt;/a&gt; is resolved so this should be closed as well, shouldn&apos;t it?&lt;/p&gt;</comment>
                            <comment id="16040730" author="githubbot" created="Wed, 7 Jun 2017 11:28:22 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cxf/pull/102&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/102&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12922796">SM-2777</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 24 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2prpb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>