<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:46:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-3379] @Context fails to inject Application instance</title>
                <link>https://issues.apache.org/jira/browse/CXF-3379</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;Quoting JSR 311:&lt;/p&gt;

&lt;p&gt;&quot;The instance of the application-supplied Application subclass can be injected into a class field or method parameter using the @Context annotation. Access to the Application subclass instance allows configuration information to be centralized in that class. Note that this cannot be injected into the Application subclass itself since this would create a circular dependency.&quot;&lt;/p&gt;

&lt;p&gt;JAXRSUtils.createContextValue() doesn&apos;t handle this. This bug exists in 2.3.x and HEAD.&lt;/p&gt;

&lt;p&gt;I&apos;d submit a patch but I don&apos;t know where (or if) the Application class is registered after it&apos;s instantiated by CXFNonSpringJaxrsServlet.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12500475">CXF-3379</key>
            <summary>@Context fails to inject Application instance</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sergey_beryozkin">Sergey Beryozkin</assignee>
                                    <reporter username="bnoordhuis">Ben Noordhuis</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 Mar 2011 21:28:32 +0000</created>
                <updated>Mon, 18 Apr 2011 12:42:22 +0000</updated>
                            <resolved>Wed, 16 Mar 2011 17:24:44 +0000</resolved>
                                    <version>2.3.3</version>
                                    <fixVersion>2.4</fixVersion>
                    <fixVersion>2.3.4</fixVersion>
                                    <component>JAX-RS</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13003349" author="sergey_beryozkin" created="Mon, 7 Mar 2011 13:29:00 +0000"  >&lt;p&gt;thanks for opening this JIRA.&lt;/p&gt;

&lt;p&gt;CXFNonSpringJaxrsServlet.createServerFromApplication returns Server, so Application instance may be saved as the server.getEndpoint() property. Endpoint can later be retrieved from the current message:&lt;br/&gt;
m.getExchange().get(Endpoint.class) and then the property pointing to the Application instance can be checked.&lt;/p&gt;

&lt;p&gt;However, I don&apos;t understand why would a root resource or provider class want to have Application instance injected ? Can you explain please what you&apos;d use it for ?&lt;/p&gt;

&lt;p&gt;thanks, Sergey&lt;/p&gt;</comment>
                            <comment id="13003432" author="bnoordhuis" created="Mon, 7 Mar 2011 16:58:46 +0000"  >&lt;p&gt;Sergey, would this be an acceptable approach? Tests and style checks pass. Color diff and raw patch:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/bnoordhuis/cxf/compare/trunk...CXF-3379&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/bnoordhuis/cxf/compare/trunk...CXF-3379&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/bnoordhuis/cxf/compare/trunk...CXF-3379.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/bnoordhuis/cxf/compare/trunk...CXF-3379.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ll write some unit tests if you give the green light.&lt;/p&gt;

&lt;p&gt;&amp;gt; However, I don&apos;t understand why would a root resource or provider class want to have Application instance injected ? Can you explain please what you&apos;d use it for ?&lt;/p&gt;

&lt;p&gt;For that configuration information the JSR talks about or as the source of service objects in a plain servlet web app (think MyApplication.getWidgetDao() and such). It&apos;s a good place for it, right?&lt;/p&gt;</comment>
                            <comment id="13003460" author="sergey_beryozkin" created="Mon, 7 Mar 2011 17:36:59 +0000"  >&lt;p&gt;Hi Ben&lt;/p&gt;

&lt;p&gt;Please stay with with me for a moment while I&apos;m trying to grasp this idea.&lt;br/&gt;
I can see why an Application can be injected in a plain servlet web app for the latter to dynamically get the service objects. So that makes sense.&lt;/p&gt;

&lt;p&gt;Actually, MyApplication.getWidgetDao() kind of start making sense too. So we have a root resource and it delegates to that widgetDao... Definitely the non-Spring option &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; but I can see the picture a bit better, thanks.&lt;/p&gt;

&lt;p&gt;So yes, the patch looks fine so far, you might want to drop contextMessage.getExchange() it can only be null if message.seyExchange(new ExchangeImpl()) was not done in the test, never null in the real case...Same for the endpoint representation, even on the client side. &lt;/p&gt;

&lt;p&gt;The only missing bit is the related ThreadLocal implementation, to be located in impl.tl subpackage and it will need to be initialized in the InjectionUtils, which is where the thread-safe proxy is initially injected. &lt;/p&gt;

&lt;p&gt;May be the time has come to remove most of those explicit thread local implementations and use generic proxies instead. I&apos;d probably leave ThreadLocalMessageContext only, so that we can avoid NPEs in the JAX-WS/JAX-RS case. Please feel free to open a related JIRA, but probably we will keep explicit TL implementations in 2.4.0 and work on it later on...&lt;/p&gt;

&lt;p&gt;thanks   &lt;/p&gt;
</comment>
                            <comment id="13003596" author="bnoordhuis" created="Mon, 7 Mar 2011 20:57:45 +0000"  >&lt;p&gt;Sergey, can you mentor me a little?&lt;/p&gt;

&lt;p&gt;&amp;gt; you might want to drop contextMessage.getExchange() it can only be null if message.seyExchange(new ExchangeImpl()) was not done in the test, never null in the real case&lt;/p&gt;

&lt;p&gt;At the top of JAXRSUtils.createContextValue() this check is done:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Message contextMessage = m.getExchange() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? m.getExchange().getInMessage() : m;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (contextMessage == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; &lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;.FALSE.equals(m.get(Message.INBOUND_MESSAGE))) {
    contextMessage = m;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So conceivably it could be true that contextMessage == m and m.getExchange() == null, right?&lt;/p&gt;

&lt;p&gt;&amp;gt; The only missing bit is the related ThreadLocal implementation&lt;/p&gt;

&lt;p&gt;The Application object is a singleton, its thread safety the responsibility of the developer - like servlets, really. How and why does a ThreadLocalProxy enter the mix? (There probably is a splendid reason, I just haven&apos;t caught on yet.)&lt;/p&gt;</comment>
                            <comment id="13003901" author="sergey_beryozkin" created="Tue, 8 Mar 2011 11:32:53 +0000"  >&lt;p&gt;Hi Ben&lt;/p&gt;

&lt;p&gt;m.getExchange() != null&lt;/p&gt;

&lt;p&gt;is most likely (99%) a lame attempt to avoid initializing Messages in tests. It is most likely a dead code.&lt;br/&gt;
I can see now few tests failing with NPEs without this check because I just pass new MessageImpl().&lt;br/&gt;
But I&apos;d keep it anyway, just to feel safer &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; - so yes, please keep the null guard in your patch too, sorry...&lt;/p&gt;

&lt;p&gt;About Applications and singletons.&lt;/p&gt;

&lt;p&gt;Do we have the proper visibility guarantee if we have a singleton root resource class injected the same Application reference on every request across multiple threads ? Is field injection an atomic operation at the low level ? So say the thread1 injects the Application reference and then just before it attempts to read this field from the application code another thread2 assigns the same reference to that field. Is there a chance the thread1 will see a corrupted reference or null, not sure - need to review the basics... &lt;/p&gt;

&lt;p&gt;Not an issue for per-request resource classes though...&lt;/p&gt;</comment>
                            <comment id="13005245" author="sergey_beryozkin" created="Thu, 10 Mar 2011 18:57:18 +0000"  >&lt;p&gt;Ben - can you please add ThreadLocalApplication to the patch and update the relevant InjectionUtils code ? I&apos;ll add a system test myself&lt;/p&gt;

&lt;p&gt;cheers, Sergey&lt;/p&gt;</comment>
                            <comment id="13005917" author="bnoordhuis" created="Sat, 12 Mar 2011 00:16:44 +0000"  >&lt;p&gt;Sergey, would a ThreadLocalProxy work for Application instances? The other thread-local proxies implement an interface (e.g. Request) and delegate to a thread-local concrete implementation of that interface. But Application objects are already concrete (and derived) so that doesn&apos;t work.&lt;/p&gt;

&lt;p&gt;The Application object is a singleton, right? Correct me if I&apos;m wrong, but wouldn&apos;t it be enough to inject it once into the singleton root resource and be done with it?&lt;/p&gt;</comment>
                            <comment id="13006195" author="sergey_beryozkin" created="Sun, 13 Mar 2011 13:32:48 +0000"  >&lt;p&gt;Hi Ben&lt;/p&gt;

&lt;p&gt;I think it would work but the existing TL support won&apos;t help indeed and as you said it is actually not needed if it is injected only once.&lt;/p&gt;

&lt;p&gt;You are right, injecting it into the singleton resource only once is exactly what is needed. &lt;br/&gt;
But the patch will need to be modified because it affect the code which does the injection on every request for both singletons and per-request resources but we only need to do it once for singletons.&lt;/p&gt;

&lt;p&gt;I have to think how to do it better, especially given that JAX-RS 1.1 also requires supporting the injection into Application instances, so we need to deal with injecting Applications and also with injecting contexts such as UriInfo, etc into the injected Applications, ouch &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;thanks, Sergey  &lt;/p&gt;</comment>
                            <comment id="13010691" author="sergey_beryozkin" created="Thu, 24 Mar 2011 14:35:18 +0000"  >&lt;p&gt;Hi Ben, just FYI, the injection of Contexts into injected Applications is also supported, see&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-3417&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CXF-3417&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;thanks, Sergey&lt;/p&gt;</comment>
                            <comment id="13011441" author="bnoordhuis" created="Fri, 25 Mar 2011 21:55:36 +0000"  >&lt;p&gt;Thanks for the heads up, Sergey!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>46847</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 35 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i145dj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>232334</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>