<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:35:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-8097] Equal candidates for handling the current request (HEAD / GET)</title>
                <link>https://issues.apache.org/jira/browse/CXF-8097</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;I have just migrated a very outdated Spring backend to Spring 5 and with it upgraded CXF to first 3.3.2 and just now 3.3.3. I have a REST service class defining two different methods with the same path defined via &lt;tt&gt;javax.ws.rs.Path&lt;/tt&gt; annotation, differentiated by &lt;tt&gt;javax.ws.rs.HEAD&lt;/tt&gt; and &lt;tt&gt;javax.ws.rs.GET&lt;/tt&gt; annotations. Both methods are annotated with &lt;tt&gt;@Produces(MediaType.APPLICATION_OCTET_STREAM)&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;When this method is called I get (redacted):&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;JAXRSUtils.compare:129&amp;#93;&lt;/span&gt; Both ServiceRestImpl#getFile and ServiceRestImpl#getFileAsHeadRequest are equal candidates for handling the current request which can lead to unpredictable results&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;The differentiation works: HEAD requests are handled by the &lt;tt&gt;@HEAD&lt;/tt&gt; annotated method and GET requests by the &lt;tt&gt;@GET&lt;/tt&gt; annotated one (this has always worked). Therefore the warning is false but will severely clutter production log output, possibly affect performance.&lt;/p&gt;

&lt;p&gt;Relevant dependencies:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Spring framework 5.1.8&lt;/li&gt;
	&lt;li&gt;&quot;org.apache.cxf&quot;, &quot;cxf-rt-rs-service-description&quot;, &quot;3.3.3&quot;&lt;/li&gt;
	&lt;li&gt;&quot;javax.servlet&quot;, &quot;javax.servlet-api&quot;, &quot;4.0.1&quot;&lt;/li&gt;
	&lt;li&gt;&quot;javax.ws.rs&quot;, &quot;javax.ws.rs-api&quot;, &quot;2.0.1&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;d appreciate support. May be linked to:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7670&quot; title=&quot;synthetic methods: equal candidates for handling the current request&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7670&quot;&gt;&lt;del&gt;CXF-7670&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-6684&quot; title=&quot;A Warning is logged on every JAX-RS call&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-6684&quot;&gt;&lt;del&gt;CXF-6684&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="13252625">CXF-8097</key>
            <summary>Equal candidates for handling the current request (HEAD / GET)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="reta">Andriy Redko</assignee>
                                    <reporter username="carsten.d">Carsten D</reporter>
                        <labels>
                    </labels>
                <created>Fri, 23 Aug 2019 09:48:52 +0000</created>
                <updated>Wed, 15 Jan 2020 10:24:04 +0000</updated>
                            <resolved>Sat, 4 Jan 2020 19:10:28 +0000</resolved>
                                    <version>3.3.2</version>
                    <version>3.3.3</version>
                    <version>3.3.4</version>
                                    <fixVersion>3.3.5</fixVersion>
                    <fixVersion>3.2.12</fixVersion>
                    <fixVersion>3.4.0</fixVersion>
                                    <component>JAX-RS</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16915142" author="reta" created="Sun, 25 Aug 2019 03:19:17 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=carsten.d&quot; class=&quot;user-hover&quot; rel=&quot;carsten.d&quot;&gt;carsten.d&lt;/a&gt; , would you mind please to attach a sample project, I was trying to reproduce the issue but had no luck so far, thank you.&lt;/p&gt;</comment>
                            <comment id="16997950" author="carsten.d" created="Tue, 17 Dec 2019 07:38:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reta&quot; class=&quot;user-hover&quot; rel=&quot;reta&quot;&gt;reta&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=coheigea&quot; class=&quot;user-hover&quot; rel=&quot;coheigea&quot;&gt;coheigea&lt;/a&gt; Sorry for not being able to respond earlier to your request. I can see this issue has been closed, but as I feared it hits us in production now. I am seeing over one million of these log statements daily and it really is an issue. As I described, functionality is fine and has not been changed, the annotations do distinguish between GET and HEAD request properly. Only with the update this log statement popped up.&lt;/p&gt;

&lt;p&gt;Since it&apos;s a project with many dependencies I couldn&apos;t get to creating a sample project yet for reproducing this, but I&apos;ll try to get to it soon and see if I can reproduce. If you have any more insight by now or need more information, I&apos;ll try my best.&lt;/p&gt;</comment>
                            <comment id="16999411" author="coheigea" created="Wed, 18 Dec 2019 18:22:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=carsten.d&quot; class=&quot;user-hover&quot; rel=&quot;carsten.d&quot;&gt;carsten.d&lt;/a&gt; Once you have a sample testcase or project to reproduce, then feel free to re-open the issue and we&apos;ll take a look.&lt;/p&gt;</comment>
                            <comment id="17006804" author="carsten.d" created="Thu, 2 Jan 2020 13:25:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=coheigea&quot; class=&quot;user-hover&quot; rel=&quot;coheigea&quot;&gt;coheigea&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I have now managed to mostly strip my project to reproduce the problem. Please see  &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12989820/12989820_cxf-8097-mcve.zip&quot; title=&quot;cxf-8097-mcve.zip attached to CXF-8097&quot;&gt;cxf-8097-mcve.zip&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;You may run this server after extracting it with&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
./gradlew runTestServer
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Afterwards you should be able to trigger this warning by sending HEAD and GET requests:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is the HEAD request which produces the WARN log statement
&lt;/span&gt;curl --location --head &lt;span class=&quot;code-quote&quot;&gt;&apos;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8989/api/test/path/x/y/z/test&apos;&lt;/span&gt;
&lt;/span&gt;
&lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; calls a different method but on the same path, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; does not produce the log statement
&lt;/span&gt;curl --location --request GET &lt;span class=&quot;code-quote&quot;&gt;&apos;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8989/api/test/path/x/y/z/test&apos;&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Output:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2020-01-02 14:18:01,509 INFO  [qtp1970436060-24] [] [ServletRequestLogHandler.handle:23] Request: HEAD /api/test/path/x/y/z/test, Content-Type: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, Body: 0 bytes
2020-01-02 14:18:01,595 WARN  [qtp1970436060-24] [] [JAXRSUtils.compare:129] Both com.test.app.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.service.impl.TestRestServiceImpl#test and com.test.app.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.service.impl.TestRestServiceImpl#testAsHeadRequest are equal candidates &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; handling the current request which can lead to unpredictable results
2020-01-02 14:18:01,599 INFO  [qtp1970436060-24] [] [TestRestServiceImpl.testAsHeadRequest:46] HEAD request
2020-01-02 14:18:01,630 INFO  [qtp1970436060-24] [] [ServletRequestLogHandler.handle:33] Response -- Status: 200, Content-Type: application/octet-stream
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17007123" author="reta" created="Thu, 2 Jan 2020 23:07:49 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=carsten.d&quot; class=&quot;user-hover&quot; rel=&quot;carsten.d&quot;&gt;carsten.d&lt;/a&gt; ,&lt;/p&gt;

&lt;p&gt;Thanks a lot for the sample project. I&apos;ve noticed that you are using custom resource comparator (by overriding the CXF&apos;s default one):&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;        ...
        factory.setResourceComparator(new QueryResourceInfoComperator());
        factory.setServiceName(new QName(&quot;CXF-8097&quot;));
        return factory.create();
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This comparator&apos;s implementation is the reason why you see warning. When default CXF resource comparator is used , the warning is gone:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2020-01-02 16:24:53,814 INFO  [qtp603658030-20] [] [ServletRequestLogHandler.handle:23] Request: HEAD /api/test/path/x/y/z/test, Content-Type: null, Body: 0 bytes
2020-01-02 16:24:53,828 INFO  [qtp603658030-20] [] [TestRestServiceImpl.testAsHeadRequest:46] HEAD request
2020-01-02 16:24:53,828 INFO  [qtp603658030-20] [] [ServletRequestLogHandler.handle:33] Response -- Status: 200, Content-Type: application/octet-stream
2020-01-02 16:24:55,808 INFO  [qtp603658030-19] [] [ServletRequestLogHandler.handle:23] Request: GET /api/test/path/x/y/z/test, Content-Type: null, Body: 0 bytes
2020-01-02 16:24:55,810 INFO  [qtp603658030-19] [] [TestRestServiceImpl.test:34] GET request
2020-01-02 16:24:55,810 INFO  [qtp603658030-19] [] [ServletRequestLogHandler.handle:33] Response -- Status: 200, Content-Type: null
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The issue is that the custom comparator (&lt;b&gt;QueryResourceInfoComperator&lt;/b&gt;) is inherited from &lt;b&gt;OperationResourceInfoComparator&lt;/b&gt; but does not properly initialize it (passing *null*s to parent&apos;s constructor).&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    public QueryResourceInfoComperator()
    {
        super(null, null);
    } &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This is purely CXF documentation fault (since this where the original example of custom resource comparator comes from), the &lt;b&gt;OperationResourceInfoComparator&lt;/b&gt; is not reusable and is very context-dependent. Probably, the simplest solution in this case is to remove &lt;b&gt;OperationResourceInfoComparator&lt;/b&gt; from inheritance chain and use delegation instead (otherwise the important details (like HTTP method) are not passed through, leading to warnings and surprises), for example:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    @Override
    public int compare(OperationResourceInfo oper1, OperationResourceInfo oper2, Message message)
    {
         // HTTP method
        final String httpMethod = HttpUtils.getProtocolHeader(message, Message.HTTP_REQUEST_METHOD, HttpMethod.POST, true);
        final OperationResourceInfoComparator delegate = new OperationResourceInfoComparator(null, httpMethod);
        
        // Check if CXF can make a decision
        final int cxfResult = delegate .compare(oper1, oper2);
        ...
    }  &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The proper fix would take some time but the workaround with delegation should do the job meantime. &lt;br/&gt;
I am wondering, would it work for the time being? &lt;br/&gt;
Thank you.&lt;/p&gt;

&lt;p&gt;Best Regards,&lt;br/&gt;
&#160;&#160;&#160; Andriy Redko&lt;/p&gt;</comment>
                            <comment id="17007474" author="carsten.d" created="Fri, 3 Jan 2020 13:14:16 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reta&quot; class=&quot;user-hover&quot; rel=&quot;reta&quot;&gt;reta&lt;/a&gt; for the quick response! Indeed this is the issue: when trying your delegate example the warning is gone.&lt;/p&gt;

&lt;p&gt;As long as this is not causing noticeable performance degradations due to increased garbage collection of the comparator instances per request, I don&apos;t see a problem with the workaround for the time being. Do you consider this a possible issue? Thanks again!&lt;/p&gt;</comment>
                            <comment id="17008109" author="reta" created="Sat, 4 Jan 2020 18:03:42 +0000"  >&lt;p&gt;Thanks for checking it out, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=carsten.d&quot; class=&quot;user-hover&quot; rel=&quot;carsten.d&quot;&gt;carsten.d&lt;/a&gt;! I have done a minor refactorings to extract the base comparison logic into&#160;&lt;b&gt;OperationResourceInfoComparatorBase&lt;/b&gt; so the example would look like:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;public class QueryResourceInfoComparator extends OperationResourceInfoComparatorBase implements ResourceComparator { 
   @Override
    public int compare(OperationResourceInfo oper1, OperationResourceInfo oper2, Message message)
    {
        // HTTP method
        final String httpMethod = HttpUtils.getProtocolHeader(message, Message.HTTP_REQUEST_METHOD, HttpMethod.POST, true);
        
        // Check if CXF can make a decision
        final int cxfResult = compare(oper1, oper2, httpMethod);
        if (cxfResult != 0) {
            return cxfResult;
        }

        ...
    }
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Unfortunately it is going to be available in the next release only (the documentation will be updated accordingly as well), hopefully in a few weeks timeframe. The in-place instantiation + delegation is more like a workaround to address the issue at hand.&lt;/p&gt;

&lt;p&gt;Thank you!&lt;/p&gt;</comment>
                            <comment id="17008133" author="reta" created="Sat, 4 Jan 2020 19:10:29 +0000"  >&lt;p&gt;Documentation has been updated (published along with the release): &lt;a href=&quot;https://cwiki.apache.org/confluence/display/CXF20DOC/JAX-RS+Basics&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/display/CXF20DOC/JAX-RS+Basics&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12988977" name="Screenshot 2019-12-17 at 08.44.29.png" size="40906" author="carsten.d" created="Tue, 17 Dec 2019 07:48:32 +0000"/>
                            <attachment id="12989820" name="cxf-8097-mcve.zip" size="15313930" author="carsten.d" created="Thu, 2 Jan 2020 13:19:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 45 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z05z00:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>