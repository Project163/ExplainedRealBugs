<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:33:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-7943] MAPCodec: Memory leak due to growing uncorrelatedExchanges</title>
                <link>https://issues.apache.org/jira/browse/CXF-7943</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;When running load tests, my system begin to get memory leak after 4 hours or so. When analyzing the heap dump using VisualVM (please see attachments), I can see that a ConcurrentHashMap is taking up 1.7 GB of space in the heap, as well as being the main &quot;suspect&quot; for this leak. This leads me to believe that it is the&#160;uncorrelatedExchanges attribute since this map is being reference from the MAPCodec class.&lt;/p&gt;

&lt;p&gt;I believe that the map, in my case, for whatever reason, does not always remove the Exchange after the synchronous request/responses are done, however I could be wrong.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;IF this is indeed a bug, what could the cause of this be, as well as any work around?&lt;/p&gt;</description>
                <environment>&lt;p&gt;CXF 3.2.0, JDK 1.8&lt;/p&gt;</environment>
        <key id="13209333">CXF-7943</key>
            <summary>MAPCodec: Memory leak due to growing uncorrelatedExchanges</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="JohnCKG">Sean</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Jan 2019 08:27:47 +0000</created>
                <updated>Wed, 24 Apr 2019 10:17:28 +0000</updated>
                                            <version>3.2.0</version>
                                                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16749809" author="volpe" created="Wed, 23 Jan 2019 10:56:46 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;we&apos;re experiencing the same issue with version 3.1.17.&lt;/p&gt;</comment>
                            <comment id="16749858" author="coheigea" created="Wed, 23 Jan 2019 12:03:02 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;Could you share your test details? I tried with a basic SOAP endpoint with WS-Addressing enabled + a JMeter test with a random UUID as the MessageID and I didn&apos;t see any memory leaks relating to MAPCodec.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Colm.&lt;/p&gt;</comment>
                            <comment id="16750465" author="dkulp" created="Wed, 23 Jan 2019 21:55:39 +0000"  >&lt;p&gt;I&apos;ve seen this reported before and every time I&apos;ve investigated it&apos;s due to whatever &quot;load tester&quot; they were using not doing WS-Addressing properly and sticking bogus values in for the message-ids and RelatesTo headers for ws-addressing.   If the RelatesTo doesn&apos;t properly match what the client is sending, then it cannot be correlated and the messages would not be removed from the Map.   Thus, we would definitely need to see request/response messages.&lt;/p&gt;</comment>
                            <comment id="16751009" author="volpe" created="Thu, 24 Jan 2019 10:54:15 +0000"  >&lt;p&gt;I think that the growth is caused by fault response received. Take a look at attachments. Today dump is growth to 1.5 Gb.&lt;/p&gt;</comment>
                            <comment id="16752013" author="volpe" created="Fri, 25 Jan 2019 08:15:39 +0000"  >&lt;p&gt;Hi Daniel, i have seen your commits about this bug on 3.2x: will be available also per 3.1.x ?&lt;/p&gt;</comment>
                            <comment id="16752169" author="coheigea" created="Fri, 25 Jan 2019 11:20:58 +0000"  >&lt;p&gt;I backported it to 3.1.x.&lt;/p&gt;</comment>
                            <comment id="16752951" author="deki" created="Sat, 26 Jan 2019 06:01:56 +0000"  >&lt;p&gt;So we can resolve this issue?&lt;/p&gt;</comment>
                            <comment id="16753337" author="coheigea" created="Sun, 27 Jan 2019 10:08:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=deki&quot; class=&quot;user-hover&quot; rel=&quot;deki&quot;&gt;deki&lt;/a&gt; No, not yet. Dan fixed the memory leak for this particular case (a WSRF Fault with no RelatesTo header). However there is still a wider problem or a memory leak that needs to be fixed possibly using a LRU cache of a fixed size rather than just an open-ended map as we currently use. I&apos;ll add it to fix for 3.3.1.&lt;/p&gt;</comment>
                            <comment id="16755904" author="johnckg" created="Wed, 30 Jan 2019 09:28:46 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=coheigea&quot; class=&quot;user-hover&quot; rel=&quot;coheigea&quot;&gt;coheigea&lt;/a&gt;, the issue for us in the end was pretty much what &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dkulp&quot; class=&quot;user-hover&quot; rel=&quot;dkulp&quot;&gt;dkulp&lt;/a&gt; said, which&#160;was that our relatesTo/messageId value would change in the end &#8211; more specifically our original messageId would have a timestamp at the end of the value, but later on we removed it --&#160;so that when the&#160;uncorrelatedExchanges map would search for the changed key&#160;during delete,&#160;the map would find nothing, thus having the map continue to grow, which makes sense.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12403482">CXF-1778</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12956128" name="fault_req_resp.xml" size="7445" author="Volpe" created="Thu, 24 Jan 2019 10:54:23 +0000"/>
                            <attachment id="12954800" name="histogram.PNG" size="74755" author="JohnCKG" created="Fri, 11 Jan 2019 14:55:29 +0000"/>
                            <attachment id="12954801" name="leak_suspect_1.PNG" size="42354" author="JohnCKG" created="Fri, 11 Jan 2019 14:55:16 +0000"/>
                            <attachment id="12955942" name="mapcodec_leak.png" size="25587" author="Volpe" created="Wed, 23 Jan 2019 10:59:57 +0000"/>
                            <attachment id="12956130" name="mem_dump.png" size="16502" author="Volpe" created="Thu, 24 Jan 2019 11:05:44 +0000"/>
                            <attachment id="12956129" name="ok_req_resp.xml" size="8534" author="Volpe" created="Thu, 24 Jan 2019 11:03:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 42 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|u00svc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>