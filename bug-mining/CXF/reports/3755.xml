<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:40:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-9078] AsyncHTTPConduit.java causing NullPointerException when closing</title>
                <link>https://issues.apache.org/jira/browse/CXF-9078</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;When using HTTP GET action by either calling JAX-WS Dispatch invoke() or JAX-RS WebClient invoke()/async().method() with a dummy payload, the program always ends up with a NullPointerException.&lt;/p&gt;

&lt;p&gt;The typical stack flow could look like the following:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: java.lang.NullPointerException: Cannot invoke &lt;span class=&quot;code-quote&quot;&gt;&quot;java.io.OutputStream.write(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[], &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)&quot;&lt;/span&gt; because &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;parameter1&amp;gt;&quot;&lt;/span&gt; is &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&#160; &#160; at java.base/java.io.ByteArrayOutputStream.writeTo(Unknown Source)
&#160; &#160; at org.apache.cxf.io.CachedOutputStream.writeCacheTo(CachedOutputStream.java:317)
&#160; &#160; at org.apache.cxf.transport.http.asyncclient.hc5.AsyncHTTPConduit$AsyncWrappedOutputStream.close(AsyncHTTPConduit.java:439)
&#160; &#160; at org.apache.cxf.io.CacheAndWriteOutputStream.postClose(CacheAndWriteOutputStream.java:56)
&#160; &#160; at org.apache.cxf.io.CachedOutputStream.close(CachedOutputStream.java:228)
&#160; &#160; at org.apache.cxf.transport.AbstractConduit.close(AbstractConduit.java:56)
&#160; &#160; at org.apache.cxf.transport.http.HTTPConduit.close(HTTPConduit.java:717)
&#160; &#160; at org.apache.cxf.transport.http.HttpClientHTTPConduit.close(HttpClientHTTPConduit.java:249)
&#160; &#160; at org.apache.cxf.interceptor.MessageSenderInterceptor$MessageSenderEndingInterceptor.handleMessage(MessageSenderInterceptor.java:63)
&#160; &#160; at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:307)
&#160; &#160; at org.apache.cxf.endpoint.ClientImpl.doInvoke(ClientImpl.java:530)
&#160; &#160; at org.apache.cxf.endpoint.ClientImpl.invoke(ClientImpl.java:441)
&#160; &#160; at org.apache.cxf.endpoint.ClientImpl.invoke(ClientImpl.java:356)
&#160; &#160; at org.apache.cxf.endpoint.ClientImpl.invoke(ClientImpl.java:314)
&#160; &#160; at org.apache.cxf.endpoint.ClientImpl.invokeWrapped(ClientImpl.java:349)
&#160; &#160; at org.apache.cxf.jaxws.DispatchImpl.invoke(DispatchImpl.java:322) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;By checking code around AsyncHTTPConduit.java:439, I would think&#160;&lt;br/&gt;
handleHeadersTrustCaching() could have left &lt;em&gt;wrappedStream&lt;/em&gt; as &lt;em&gt;null&lt;/em&gt; for GET action, which eventually crashing the later &lt;em&gt;out.writeCacheTo(wrappedStream).&lt;/em&gt;&lt;br/&gt;
&#160;&lt;br/&gt;
My local case seems to be OK after I override the class and put a check before &lt;em&gt;out.writeCacheTo(wrappedStream).&lt;/em&gt; But I&apos;m no expert on the related modules. Please let me know if there are any other solutions.&lt;br/&gt;
&#160;&lt;br/&gt;
I know the issue won&apos;t be hit with JAX-RS client if GET is triggered with a null payload. But somehow in our usage, we can&apos;t totally ban GET for JAX-WS dispatch. So it&apos;s still a problem to us.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13597744">CXF-9078</key>
            <summary>AsyncHTTPConduit.java causing NullPointerException when closing</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="reta">Andriy Redko</assignee>
                                    <reporter username="lukexu_infor">Luke Xu</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 Nov 2024 10:26:33 +0000</created>
                <updated>Thu, 21 Nov 2024 00:50:34 +0000</updated>
                            <resolved>Thu, 21 Nov 2024 00:50:34 +0000</resolved>
                                    <version>4.0.5</version>
                                    <fixVersion>4.1.0</fixVersion>
                    <fixVersion>3.5.10</fixVersion>
                    <fixVersion>3.6.5</fixVersion>
                    <fixVersion>4.0.6</fixVersion>
                                    <component>Transports</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17897059" author="reta" created="Mon, 11 Nov 2024 02:05:30 +0000"  >&lt;p&gt;Indeed the spec &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; is not strict on that but the general recommendation &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; is that:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Although request message framing is independent of the method used, content received in a GET request has no generally defined semantics, cannot alter the meaning or target of the request, and might lead some implementations to reject the request and close the connection because of its potential as a request smuggling attack (&lt;a href=&quot;https://www.rfc-editor.org/rfc/rfc9112#section-11.2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Section 11.2&lt;/a&gt; of &lt;a href=&quot;https://www.rfc-editor.org/rfc/rfc9110.html#HTTP11]&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;[HTTP/1.1&lt;/a&gt;). A client SHOULD NOT generate content in a GET request unless it is made directly to an origin server that has previously indicated, in or out of band, that such a request has a purpose and will be adequately supported. An origin server SHOULD NOT rely on private agreements to receive content, since participants in HTTP communication are often unaware of intermediaries along the request chain.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;If I am not mistaken, the Apache HttpClient 4.x (I assume this is the&#160;AsyncHTTPConduit impl referenced here) does not support payload by default.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://www.rfc-editor.org/rfc/rfc9110.html#name-get&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.rfc-editor.org/rfc/rfc9110.html#name-get&lt;/a&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17897131" author="lukexu_infor" created="Mon, 11 Nov 2024 09:03:38 +0000"  >&lt;p&gt;Will there be a fix inside AsyncHTTPConduit? handleHeadersTrustCaching() actually takes GET into the account and &lt;em&gt;out.writeCacheTo(null)&lt;/em&gt; doesn&apos;t really make sense to me in the context.&lt;/p&gt;</comment>
                            <comment id="17897304" author="reta" created="Tue, 12 Nov 2024 00:35:27 +0000"  >&lt;p&gt;I think it warrants the fix in the AsyncHTTPConduit, failing with NPE is not an option, thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lukexu_infor&quot; class=&quot;user-hover&quot; rel=&quot;lukexu_infor&quot;&gt;lukexu_infor&lt;/a&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17897334" author="lukexu_infor" created="Tue, 12 Nov 2024 02:37:34 +0000"  >&lt;p&gt;Thanks a lot. That will be helpful to us.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1sds8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>