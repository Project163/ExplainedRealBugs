<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:56:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-4615] OAuthRequestFilter.java should ignore HTTP OPTIONS verb</title>
                <link>https://issues.apache.org/jira/browse/CXF-4615</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;In handleRequest of OAuthRequestFilter.java at line 54 something similar to the following should be added:&lt;/p&gt;

&lt;p&gt;if (((String)m.get(Message.HTTP_REQUEST_METHOD)).equals(&quot;OPTIONS&quot;)) return null;&lt;/p&gt;

&lt;p&gt;This will skip any HTTP OPTIONS verb requests. I&apos;m getting the OPTIONS verb request when using an OAuth 2 javascript client.&lt;/p&gt;

&lt;p&gt;I haven&apos;t found a way in the configuration to specify that OPTIONS requests should skip this filter.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12614860">CXF-4615</key>
            <summary>OAuthRequestFilter.java should ignore HTTP OPTIONS verb</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sergey_beryozkin">Sergey Beryozkin</assignee>
                                    <reporter username="tippettssh">Steven Tippetts</reporter>
                        <labels>
                    </labels>
                <created>Mon, 5 Nov 2012 22:13:18 +0000</created>
                <updated>Mon, 10 Apr 2017 19:07:01 +0000</updated>
                            <resolved>Fri, 16 Nov 2012 09:50:12 +0000</resolved>
                                    <version>2.6.2</version>
                    <version>2.7</version>
                                                    <component>JAX-RS Security</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13490987" author="sergey_beryozkin" created="Mon, 5 Nov 2012 22:23:04 +0000"  >&lt;p&gt;Hmm, should CORS filter be sitting in front of OAuthFilter and managing OPTIONS ?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://cxf.apache.org/docs/jax-rs-cors.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cxf.apache.org/docs/jax-rs-cors.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13491404" author="sergey_beryozkin" created="Tue, 6 Nov 2012 12:01:21 +0000"  >&lt;p&gt;The only current limitation of using CrossOriginResourceSharingFilter with OAuth filter is that CORS filter will let the local preflight requests through, example, in cases when a service resource method is annotated with @Options and @LocalPreflight, but this still will be blocked by OAuth filter. &lt;/p&gt;

&lt;p&gt;I&apos;ve updated the oauth filter to let OPTIONS request pass through only if it is a local preflight request:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/viewvc?rev=1406106&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=1406106&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Can you please experiment with the latest code ?&lt;/p&gt;
</comment>
                            <comment id="13491636" author="tippettssh" created="Tue, 6 Nov 2012 17:34:17 +0000"  >&lt;p&gt;It looks like the fix works only when the CORS filter is used with the OAuth filter. Will the CORS filter be required now to use OAuth or are you planning an additional fix that works without the CORS filter?&lt;/p&gt;</comment>
                            <comment id="13491648" author="sergey_beryozkin" created="Tue, 6 Nov 2012 17:47:32 +0000"  >&lt;p&gt;If OPTIONS request is not part of the browser doing CORS preflight then the filter can not just get OPTIONS pass by, right ? It could be an actual OAuth client trying to use OPTIONS and I guess we may have a case of a rogue client trying to use OPTIONS and the fact the JAX-RS are required to return a list of supported HTTP verbs in response to OPTIONS, thus, unless it is a local preflight, the filter has to block it, unless it is actually issued by a client whose access token can be validated.&lt;/p&gt;

&lt;p&gt;If no CORS support is required (as in say with authorization code flow) then no CORS filter will be needed.&lt;/p&gt;

&lt;p&gt;You do not have to use CORS filter at all if it seems like an extra headache &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, simply extend OAuthRequestFiler and override its handleRequest() and let the request proceed for OPTIONS, but if this OPTIONS is indeed part of CORS preflight then using the CORS filter is better because it will take care of preparing a proper preflight response, and generally speaking will not interfere with the actual OAuth flow.&lt;/p&gt;

&lt;p&gt;Does it help ? &lt;/p&gt;
</comment>
                            <comment id="13491687" author="tippettssh" created="Tue, 6 Nov 2012 18:33:53 +0000"  >&lt;p&gt;Thank you for your feedback. In order to make the CXF OAuth solution simple, I think you&apos;ll need to have a fix to this that doesn&apos;t involve the CORS filter or extending OAuthRequestFilter. Here&apos;s why I think this. My client is javascript in the browser and uses jQuery $.ajax to make the call to the OAuth resource server. The client provides the $.ajax call with the Authorization header information that includes the bearer token; however, for some reason jQuery first sends the OPTIONS request but without including the Authorization header. I&apos;m guessing that this will be a problem for anyone using a javascript client.&lt;/p&gt;</comment>
                            <comment id="13491696" author="sergey_beryozkin" created="Tue, 6 Nov 2012 18:40:37 +0000"  >&lt;p&gt;&amp;gt; however, for some reason jQuery first sends the OPTIONS request but without including the Authorization header&lt;/p&gt;

&lt;p&gt;AFAIK this is CORS preflight request. What do you expect to happen if OAuth filter will pass it through ? I think it will fail because no proper CORS response will be returned to the browser, or does it work if you modify the filter as you suggested ?&lt;/p&gt;</comment>
                            <comment id="13491717" author="tippettssh" created="Tue, 6 Nov 2012 19:08:23 +0000"  >&lt;p&gt;It does work when I modify the filter as suggested.  That said, I do have a filter in the chain that does the following:&lt;/p&gt;

&lt;p&gt;public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {&lt;br/&gt;
    HttpServletRequest httpServletRequest = (HttpServletRequest) request;&lt;br/&gt;
    ((HttpServletResponse)response).addHeader(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;);&lt;br/&gt;
    ((HttpServletResponse)response).addHeader(&quot;Access-Control-Allow-Methods&quot;, &quot;PUT,POST,GET,OPTIONS&quot;);&lt;br/&gt;
    ((HttpServletResponse)response).addHeader(&quot;Access-Control-Allow-Headers&quot;, &quot;Content-Type, Authorization&quot;);&lt;br/&gt;
    chain.doFilter(request,response);&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;It is now occurring to me that this may be similar to what the CORS filter is doing. If so, then I just need to switch to it.&lt;/p&gt;</comment>
                            <comment id="13491846" author="sergey_beryozkin" created="Tue, 6 Nov 2012 21:35:12 +0000"  >&lt;p&gt;OK, that explains it.&lt;/p&gt;

&lt;p&gt;Please try CORS filter and see how it works for you (list it before OAuth one). IMHO using the filter may be a better option, it is expected to be CORS spec compliant, can be configured to manage preflights and is more effective in the case of OPTIONS. At the moment, what happens after the OAuth filter passes OPTIONS through, the runtime will try to find the resource method supporting OPTIONS, and because it is not there, it will attempt to build &quot;Allow&quot; headers from the internal info, and will return, and in fact this &apos;Allow&apos; won&apos;t be of use because Access-Control-Allow-Methods is expected instead.&lt;/p&gt;




</comment>
                            <comment id="13491897" author="tippettssh" created="Tue, 6 Nov 2012 22:33:13 +0000"  >&lt;p&gt;Sorry for my ignorance. Thank you for your help. I&apos;ll add the CORS filter and remove the other and test your changes.&lt;/p&gt;</comment>
                            <comment id="13495239" author="sergey_beryozkin" created="Mon, 12 Nov 2012 13:09:06 +0000"  >&lt;p&gt;Hi Steven, no problems at all, note that you can also have:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@OPTIONS
@LocalPreflight
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Response handlePreflightRequest() {
} 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;if preferred. This code will specifically deal with analyzing the CORS OPTIONS request and preparing the response. This is a bit intrusive for the application code but allows to do the more sophisticated CORS Preflight processing which may not be possible by using the CORS filter only. Note I&apos;ve updated OAuth filter to support the code above after you opened this JIRA.&lt;/p&gt;

&lt;p&gt;Can I resolve it as Won&apos;t Fix or Not a Problem now ?&lt;/p&gt;</comment>
                            <comment id="13498414" author="tippettssh" created="Thu, 15 Nov 2012 22:51:30 +0000"  >&lt;p&gt;Yes, go ahead and resolve it. Please note that I added the CORS filter without updating to your new code and my issue went away. In other words, I didn&apos;t test your new code. Sorry.&lt;/p&gt;</comment>
                            <comment id="13498692" author="sergey_beryozkin" created="Fri, 16 Nov 2012 09:48:05 +0000"  >&lt;p&gt;OK. Regarding the local preflight pass-through code in OAuth2 filter: I&apos;ll keep it there for a bit, may get rid of it in the future if the feedback from users will show that a local preflight mode is used rarely, thanks&lt;/p&gt;</comment>
                            <comment id="13498694" author="sergey_beryozkin" created="Fri, 16 Nov 2012 09:50:12 +0000"  >&lt;p&gt;I&apos;m resolving it as Fixed due to a minor update I did to OAuth filter to let the local-preflight requests pass through&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>255358</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 1 week, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0era7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>84182</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>