<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:32:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-7758] MTOM + SchemaValidation results in empty input stream from data handler</title>
                <link>https://issues.apache.org/jira/browse/CXF-7758</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;With enabled validation, data handler returns empty input stream for attachment data.&lt;/p&gt;

&lt;p&gt;Reproducer:&lt;/p&gt;

&lt;p&gt;1. Unzip the attachment&lt;br/&gt;
 2. Build using &quot;mvn clean install&quot; and deploy war file to JBoss EAP 7.1.2.&lt;br/&gt;
 3. Try calling the deployed soap service with attachments as given in the sample soap UI project.&lt;br/&gt;
 4. Notice the resulting file is empty. This happens only when schema validation enabled. After removing SchemaValidation annotation it works fine.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13165530">CXF-7758</key>
            <summary>MTOM + SchemaValidation results in empty input stream from data handler</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="thofman">Tomas Hofman</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 Jun 2018 09:30:57 +0000</created>
                <updated>Mon, 25 Mar 2019 12:28:32 +0000</updated>
                            <resolved>Wed, 13 Jun 2018 12:43:06 +0000</resolved>
                                    <version>3.2.4</version>
                                    <fixVersion>3.1.16</fixVersion>
                    <fixVersion>3.2.5</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16509431" author="githubbot" created="Tue, 12 Jun 2018 09:46:19 +0000"  >&lt;p&gt;TomasHofman opened a new pull request #423: &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7758&quot; title=&quot;MTOM + SchemaValidation results in empty input stream from data handler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7758&quot;&gt;&lt;del&gt;CXF-7758&lt;/del&gt;&lt;/a&gt; MTOM + SchemaValidation results in empty input stream from d&#8230;&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/cxf/pull/423&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/423&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   &#8230;ata handler&lt;/p&gt;

&lt;p&gt;   &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7758&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CXF-7758&lt;/a&gt;&lt;br/&gt;
   &lt;a href=&quot;https://issues.jboss.org/browse/JBEAP-14830&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://issues.jboss.org/browse/JBEAP-14830&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   This is to allow checking `endpoint.getEndpointInfo()` even when `exchange.getBindingOperationInfo()` is not yet set.&lt;/p&gt;

&lt;p&gt;   The `JAXBAttachmentSchemaValidationHack` is checking if the the validation is enabled in a phase before `exchange.getBindingOperationInfo()` is set. This leads to not correctly determining that validation is enabled and attachment datasources not being cached. Because the datasource is not cached, it returns the same InputStream to the validation unmarshaller and then to the application, resulting in the app not being able to read any data from the attachment DS.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16509433" author="thofman" created="Tue, 12 Jun 2018 09:46:44 +0000"  >&lt;p&gt;PR: &lt;a href=&quot;https://github.com/apache/cxf/pull/423&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/423&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16510800" author="githubbot" created="Wed, 13 Jun 2018 08:49:03 +0000"  >&lt;p&gt;TomasHofman commented on issue #423: &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7758&quot; title=&quot;MTOM + SchemaValidation results in empty input stream from data handler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7758&quot;&gt;&lt;del&gt;CXF-7758&lt;/del&gt;&lt;/a&gt; MTOM + SchemaValidation results in empty input stream from d&#8230;&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/cxf/pull/423#issuecomment-396863569&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/423#issuecomment-396863569&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Test failure seems unrelated, can we retest?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16511051" author="githubbot" created="Wed, 13 Jun 2018 12:36:27 +0000"  >&lt;p&gt;dkulp closed pull request #423: &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7758&quot; title=&quot;MTOM + SchemaValidation results in empty input stream from data handler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7758&quot;&gt;&lt;del&gt;CXF-7758&lt;/del&gt;&lt;/a&gt; MTOM + SchemaValidation results in empty input stream from d&#8230;&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/cxf/pull/423&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/423&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/core/src/main/java/org/apache/cxf/helpers/ServiceUtils.java b/core/src/main/java/org/apache/cxf/helpers/ServiceUtils.java&lt;br/&gt;
index a4537a27cab..69c4b1d974e 100644&lt;br/&gt;
&amp;#8212; a/core/src/main/java/org/apache/cxf/helpers/ServiceUtils.java&lt;br/&gt;
+++ b/core/src/main/java/org/apache/cxf/helpers/ServiceUtils.java&lt;br/&gt;
@@ -108,30 +108,30 @@ private static SchemaValidationType getOverrideSchemaValidationType(Message mess&lt;/p&gt;

&lt;p&gt;     private static SchemaValidationType getSchemaValidationTypeFromModel(Message message) {&lt;br/&gt;
         Exchange exchange = message.getExchange();&lt;br/&gt;
+        SchemaValidationType validationType = null;&lt;/p&gt;

&lt;p&gt;         if (exchange != null) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;BindingOperationInfo boi = exchange.getBindingOperationInfo();&lt;/li&gt;
	&lt;li&gt;Endpoint endpoint = exchange.getEndpoint();&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (boi != null &amp;amp;&amp;amp; endpoint != null) {&lt;/li&gt;
	&lt;li&gt;SchemaValidationType validationType = null;&lt;br/&gt;
+            BindingOperationInfo boi = exchange.getBindingOperationInfo();&lt;br/&gt;
+            if (boi != null) {&lt;br/&gt;
                 OperationInfo opInfo = boi.getOperationInfo();&lt;/li&gt;
	&lt;li&gt;EndpointInfo ep = endpoint.getEndpointInfo();&lt;br/&gt;
-&lt;br/&gt;
                 if (opInfo != null) 
{
                     validationType = getSchemaValidationTypeFromModel(opInfo);
+                }
&lt;p&gt;+            }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (validationType == null &amp;amp;&amp;amp; ep != null) {&lt;br/&gt;
+            if (validationType == null) {&lt;br/&gt;
+                Endpoint endpoint = exchange.getEndpoint();&lt;br/&gt;
+                if (endpoint != null) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+                    EndpointInfo ep = endpoint.getEndpointInfo();+                    if (ep != null) {
                         validationType = getSchemaValidationTypeFromModel(ep);
                     }                 }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;-&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;return validationType;&lt;br/&gt;
             }&lt;br/&gt;
         }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// else&lt;/li&gt;
	&lt;li&gt;return null;&lt;br/&gt;
+        return validationType;&lt;br/&gt;
     }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     private static SchemaValidationType getSchemaValidationTypeFromModel(&lt;br/&gt;
diff --git a/systests/jaxws/src/test/java/org/apache/cxf/systest/jaxws/attachment/AttachmentService.java b/systests/jaxws/src/test/java/org/apache/cxf/systest/jaxws/attachment/AttachmentService.java&lt;br/&gt;
new file mode 100644&lt;br/&gt;
index 00000000000..6acbf6c51e3&lt;br/&gt;
&amp;#8212; /dev/null&lt;br/&gt;
+++ b/systests/jaxws/src/test/java/org/apache/cxf/systest/jaxws/attachment/AttachmentService.java&lt;br/&gt;
@@ -0,0 +1,36 @@&lt;br/&gt;
+/**&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
+ * or more contributor license agreements. See the NOTICE file&lt;br/&gt;
+ * distributed with this work for additional information&lt;br/&gt;
+ * regarding copyright ownership. The ASF licenses this file&lt;br/&gt;
+ * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
+ * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
+ * with the License. You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ * &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing,&lt;br/&gt;
+ * software distributed under the License is distributed on an&lt;br/&gt;
+ * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY&lt;br/&gt;
+ * KIND, either express or implied. See the License for the&lt;br/&gt;
+ * specific language governing permissions and limitations&lt;br/&gt;
+ * under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+package org.apache.cxf.systest.jaxws.attachment;&lt;br/&gt;
+&lt;br/&gt;
+import javax.jws.WebMethod;&lt;br/&gt;
+import javax.jws.WebParam;&lt;br/&gt;
+import javax.jws.WebService;&lt;br/&gt;
+import javax.xml.bind.annotation.XmlElement;&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.cxf.annotations.SchemaValidation;&lt;br/&gt;
+&lt;br/&gt;
+@WebService(name = &quot;AttachmentService&quot;, targetNamespace = &quot;http://org.apache.cxf/service/AttachmentService&quot;)&lt;br/&gt;
+@SchemaValidation(type = SchemaValidation.SchemaValidationType.IN)&lt;br/&gt;
+public interface AttachmentService &lt;/p&gt;
{
+
+    @WebMethod
+    int test(@WebParam(name = &quot;request&quot;) @XmlElement(required = true) Request request) throws Exception;
+
+}
&lt;p&gt;diff --git a/systests/jaxws/src/test/java/org/apache/cxf/systest/jaxws/attachment/AttachmentServiceImpl.java b/systests/jaxws/src/test/java/org/apache/cxf/systest/jaxws/attachment/AttachmentServiceImpl.java&lt;br/&gt;
new file mode 100644&lt;br/&gt;
index 00000000000..b6a4511347f&lt;br/&gt;
&amp;#8212; /dev/null&lt;br/&gt;
+++ b/systests/jaxws/src/test/java/org/apache/cxf/systest/jaxws/attachment/AttachmentServiceImpl.java&lt;br/&gt;
@@ -0,0 +1,45 @@&lt;br/&gt;
+/**&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
+ * or more contributor license agreements. See the NOTICE file&lt;br/&gt;
+ * distributed with this work for additional information&lt;br/&gt;
+ * regarding copyright ownership. The ASF licenses this file&lt;br/&gt;
+ * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
+ * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
+ * with the License. You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ * &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing,&lt;br/&gt;
+ * software distributed under the License is distributed on an&lt;br/&gt;
+ * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY&lt;br/&gt;
+ * KIND, either express or implied. See the License for the&lt;br/&gt;
+ * specific language governing permissions and limitations&lt;br/&gt;
+ * under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+package org.apache.cxf.systest.jaxws.attachment;&lt;br/&gt;
+&lt;br/&gt;
+import java.io.InputStream;&lt;br/&gt;
+&lt;br/&gt;
+import javax.activation.DataHandler;&lt;br/&gt;
+import javax.jws.WebMethod;&lt;br/&gt;
+import javax.jws.WebParam;&lt;br/&gt;
+import javax.jws.WebService;&lt;br/&gt;
+import javax.xml.bind.annotation.XmlElement;&lt;br/&gt;
+import javax.xml.ws.soap.MTOM;&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.cxf.annotations.SchemaValidation;&lt;br/&gt;
+import org.apache.cxf.helpers.IOUtils;&lt;br/&gt;
+&lt;br/&gt;
+@WebService(name = &quot;AttachmentService&quot;, targetNamespace = &quot;http://org.apache.cxf/service/AttachmentService&quot;)&lt;br/&gt;
+@SchemaValidation(type = SchemaValidation.SchemaValidationType.IN)&lt;br/&gt;
+@MTOM(enabled = true)&lt;br/&gt;
+public class AttachmentServiceImpl implements AttachmentService {&lt;br/&gt;
+&lt;br/&gt;
+    @WebMethod&lt;br/&gt;
+    public int test(@WebParam(name = &quot;request&quot;) @XmlElement(required = true) Request request) throws Exception &lt;/p&gt;
{
+        DataHandler dataHandler = request.getContent();
+        InputStream inputStream = dataHandler.getInputStream();
+        return IOUtils.readBytesFromStream(inputStream).length;
+    }
&lt;p&gt;+}&lt;br/&gt;
diff --git a/systests/jaxws/src/test/java/org/apache/cxf/systest/jaxws/attachment/Request.java b/systests/jaxws/src/test/java/org/apache/cxf/systest/jaxws/attachment/Request.java&lt;br/&gt;
new file mode 100644&lt;br/&gt;
index 00000000000..b9f082076e7&lt;br/&gt;
&amp;#8212; /dev/null&lt;br/&gt;
+++ b/systests/jaxws/src/test/java/org/apache/cxf/systest/jaxws/attachment/Request.java&lt;br/&gt;
@@ -0,0 +1,45 @@&lt;br/&gt;
+/**&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
+ * or more contributor license agreements. See the NOTICE file&lt;br/&gt;
+ * distributed with this work for additional information&lt;br/&gt;
+ * regarding copyright ownership. The ASF licenses this file&lt;br/&gt;
+ * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
+ * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
+ * with the License. You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ * &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing,&lt;br/&gt;
+ * software distributed under the License is distributed on an&lt;br/&gt;
+ * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY&lt;br/&gt;
+ * KIND, either express or implied. See the License for the&lt;br/&gt;
+ * specific language governing permissions and limitations&lt;br/&gt;
+ * under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+package org.apache.cxf.systest.jaxws.attachment;&lt;br/&gt;
+&lt;br/&gt;
+import javax.activation.DataHandler;&lt;br/&gt;
+import javax.xml.bind.annotation.XmlAccessType;&lt;br/&gt;
+import javax.xml.bind.annotation.XmlAccessorType;&lt;br/&gt;
+import javax.xml.bind.annotation.XmlElement;&lt;br/&gt;
+import javax.xml.bind.annotation.XmlType;&lt;br/&gt;
+&lt;br/&gt;
+@XmlAccessorType(XmlAccessType.FIELD)&lt;br/&gt;
+@XmlType(name = &quot;request&quot;, propOrder = &lt;/p&gt;
{&quot;content&quot;}
&lt;p&gt;)&lt;br/&gt;
+public class Request {&lt;br/&gt;
+&lt;br/&gt;
+    @XmlElement(name = &quot;content&quot;, required = true)&lt;br/&gt;
+    private DataHandler content;&lt;br/&gt;
+&lt;br/&gt;
+    public Request() &lt;/p&gt;
{
+    }
&lt;p&gt;+&lt;br/&gt;
+    public DataHandler getContent() &lt;/p&gt;
{
+        return content;
+    }
&lt;p&gt;+&lt;br/&gt;
+    public void setContent(DataHandler content) &lt;/p&gt;
{
+        this.content = content;
+    }
&lt;p&gt;+}&lt;br/&gt;
diff --git a/systests/jaxws/src/test/java/org/apache/cxf/systest/jaxws/attachment/ValidationWithAttachmentTest.java b/systests/jaxws/src/test/java/org/apache/cxf/systest/jaxws/attachment/ValidationWithAttachmentTest.java&lt;br/&gt;
new file mode 100644&lt;br/&gt;
index 00000000000..cda53f20b9f&lt;br/&gt;
&amp;#8212; /dev/null&lt;br/&gt;
+++ b/systests/jaxws/src/test/java/org/apache/cxf/systest/jaxws/attachment/ValidationWithAttachmentTest.java&lt;br/&gt;
@@ -0,0 +1,83 @@&lt;br/&gt;
+/**&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
+ * or more contributor license agreements. See the NOTICE file&lt;br/&gt;
+ * distributed with this work for additional information&lt;br/&gt;
+ * regarding copyright ownership. The ASF licenses this file&lt;br/&gt;
+ * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
+ * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
+ * with the License. You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ * &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing,&lt;br/&gt;
+ * software distributed under the License is distributed on an&lt;br/&gt;
+ * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY&lt;br/&gt;
+ * KIND, either express or implied. See the License for the&lt;br/&gt;
+ * specific language governing permissions and limitations&lt;br/&gt;
+ * under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+package org.apache.cxf.systest.jaxws.attachment;&lt;br/&gt;
+&lt;br/&gt;
+import javax.activation.DataHandler;&lt;br/&gt;
+import javax.xml.ws.BindingProvider;&lt;br/&gt;
+import javax.xml.ws.soap.SOAPBinding;&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.cxf.endpoint.Server;&lt;br/&gt;
+import org.apache.cxf.jaxws.JaxWsProxyFactoryBean;&lt;br/&gt;
+import org.apache.cxf.jaxws.JaxWsServerFactoryBean;&lt;br/&gt;
+import org.apache.cxf.testutil.common.TestUtil;&lt;br/&gt;
+&lt;br/&gt;
+import org.junit.AfterClass;&lt;br/&gt;
+import org.junit.Assert;&lt;br/&gt;
+import org.junit.BeforeClass;&lt;br/&gt;
+import org.junit.Test;&lt;br/&gt;
+&lt;br/&gt;
+public class ValidationWithAttachmentTest {&lt;br/&gt;
+&lt;br/&gt;
+    static final String PORT = TestUtil.getNewPortNumber(ValidationWithAttachmentTest.class);&lt;br/&gt;
+    static final String ADDRESS = &quot;http://localhost:&quot; + PORT + &quot;/&quot; + ValidationWithAttachmentTest.class.getSimpleName();&lt;br/&gt;
+&lt;br/&gt;
+    static Server server;&lt;br/&gt;
+    static AttachmentService client;&lt;br/&gt;
+&lt;br/&gt;
+    @BeforeClass&lt;br/&gt;
+    public static void setUp() &lt;/p&gt;
{
+        initServer();
+        initClient();
+    }
&lt;p&gt;+&lt;br/&gt;
+    @AfterClass&lt;br/&gt;
+    public static void tearDown() &lt;/p&gt;
{
+        server.stop();
+    }
&lt;p&gt;+&lt;br/&gt;
+    @Test&lt;br/&gt;
+    public void test() throws Exception &lt;/p&gt;
{
+        Request request = new Request();
+        request.setContent(new DataHandler(&quot;test&quot;, &quot;text/plain&quot;));
+
+        int bytes = client.test(request);
+        Assert.assertTrue(&quot;Attachment data were not received&quot;, bytes &amp;gt; 0);
+    }
&lt;p&gt;+&lt;br/&gt;
+    private static void initServer() &lt;/p&gt;
{
+        JaxWsServerFactoryBean factory = new JaxWsServerFactoryBean();
+        factory.setServiceClass(AttachmentServiceImpl.class);
+        factory.setAddress(ADDRESS);
+        factory.setServiceBean(new AttachmentServiceImpl());
+        server = factory.create();
+    }
&lt;p&gt;+&lt;br/&gt;
+    private static void initClient() &lt;/p&gt;
{
+        JaxWsProxyFactoryBean clientFactory = new JaxWsProxyFactoryBean();
+        clientFactory.setServiceClass(AttachmentService.class);
+        clientFactory.setAddress(ADDRESS);
+        client = (AttachmentService) clientFactory.create();
+
+        //enable MTOM in client
+        BindingProvider bp = (BindingProvider) client;
+        SOAPBinding binding = (SOAPBinding) bp.getBinding();
+        binding.setMTOMEnabled(true);
+    }
&lt;p&gt;+}&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16511061" author="thofman" created="Wed, 13 Jun 2018 12:43:06 +0000"  >&lt;p&gt;Merged in cxf 3.2.5.&lt;/p&gt;</comment>
                            <comment id="16511182" author="githubbot" created="Wed, 13 Jun 2018 14:03:41 +0000"  >&lt;p&gt;TomasHofman opened a new pull request #424: &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7758&quot; title=&quot;MTOM + SchemaValidation results in empty input stream from data handler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7758&quot;&gt;&lt;del&gt;CXF-7758&lt;/del&gt;&lt;/a&gt; MTOM + SchemaValidation results in empty input stream from d&#8230;&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/cxf/pull/424&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/424&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   &#8230;ata handler&lt;/p&gt;

&lt;p&gt;   I realized I need this for 3.1.x branch too...&lt;/p&gt;

&lt;p&gt;   &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7758&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CXF-7758&lt;/a&gt;&lt;br/&gt;
   &lt;a href=&quot;https://issues.jboss.org/browse/JBEAP-14830&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://issues.jboss.org/browse/JBEAP-14830&lt;/a&gt;&lt;br/&gt;
   Upstream PR: &lt;a href=&quot;https://github.com/apache/cxf/pull/423&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/423&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16515776" author="githubbot" created="Mon, 18 Jun 2018 14:26:04 +0000"  >&lt;p&gt;deki closed pull request #424: &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7758&quot; title=&quot;MTOM + SchemaValidation results in empty input stream from data handler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7758&quot;&gt;&lt;del&gt;CXF-7758&lt;/del&gt;&lt;/a&gt; MTOM + SchemaValidation results in empty input stream from d&#8230;&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/cxf/pull/424&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/424&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/core/src/main/java/org/apache/cxf/helpers/ServiceUtils.java b/core/src/main/java/org/apache/cxf/helpers/ServiceUtils.java&lt;br/&gt;
index 22b9a5332b3..9ce9f7d1a3a 100644&lt;br/&gt;
&amp;#8212; a/core/src/main/java/org/apache/cxf/helpers/ServiceUtils.java&lt;br/&gt;
+++ b/core/src/main/java/org/apache/cxf/helpers/ServiceUtils.java&lt;br/&gt;
@@ -101,30 +101,30 @@ private static SchemaValidationType getOverrideSchemaValidationType(Message mess&lt;/p&gt;

&lt;p&gt;     private static SchemaValidationType getSchemaValidationTypeFromModel(Message message) {&lt;br/&gt;
         Exchange exchange = message.getExchange();&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;p&gt;+        SchemaValidationType validationType = null;&lt;br/&gt;
+&lt;br/&gt;
         if (exchange != null) {&lt;br/&gt;
+&lt;br/&gt;
             BindingOperationInfo boi = exchange.getBindingOperationInfo();&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;Endpoint endpoint = exchange.getEndpoint();&lt;/li&gt;
	&lt;li&gt;&lt;/li&gt;
	&lt;li&gt;if (boi != null &amp;amp;&amp;amp; endpoint != null) {&lt;/li&gt;
	&lt;li&gt;SchemaValidationType validationType = null;&lt;br/&gt;
+            if (boi != null) {&lt;br/&gt;
                 OperationInfo opInfo = boi.getOperationInfo();&lt;/li&gt;
	&lt;li&gt;EndpointInfo ep = endpoint.getEndpointInfo();&lt;/li&gt;
	&lt;li&gt;&lt;/li&gt;
	&lt;li&gt;if (validationType == null &amp;amp;&amp;amp; opInfo != null) {&lt;br/&gt;
+                if (opInfo != null) {&lt;br/&gt;
                     validationType = getSchemaValidationTypeFromModel(opInfo);&lt;/li&gt;
	&lt;li&gt;&lt;/li&gt;
	&lt;li&gt;if (validationType == null &amp;amp;&amp;amp; ep != null) 
{
+                }
&lt;p&gt;+            }&lt;br/&gt;
+&lt;br/&gt;
+            if (validationType == null) {&lt;br/&gt;
+                Endpoint endpoint = exchange.getEndpoint();&lt;br/&gt;
+                if (endpoint != null) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+                    EndpointInfo ep = endpoint.getEndpointInfo();+                    if (ep != null) {
                         validationType = getSchemaValidationTypeFromModel(ep);
                     }                 }&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;&lt;/li&gt;
	&lt;li&gt;return validationType;&lt;br/&gt;
             }&lt;br/&gt;
         }&lt;/li&gt;
	&lt;li&gt;&lt;/li&gt;
	&lt;li&gt;// else&lt;/li&gt;
	&lt;li&gt;return null;&lt;br/&gt;
+&lt;br/&gt;
+        return validationType;&lt;br/&gt;
     }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     private static SchemaValidationType getSchemaValidationTypeFromModel(&lt;br/&gt;
diff --git a/systests/jaxws/src/test/java/org/apache/cxf/systest/jaxws/attachment/AttachmentService.java b/systests/jaxws/src/test/java/org/apache/cxf/systest/jaxws/attachment/AttachmentService.java&lt;br/&gt;
new file mode 100644&lt;br/&gt;
index 00000000000..6acbf6c51e3&lt;br/&gt;
&amp;#8212; /dev/null&lt;br/&gt;
+++ b/systests/jaxws/src/test/java/org/apache/cxf/systest/jaxws/attachment/AttachmentService.java&lt;br/&gt;
@@ -0,0 +1,36 @@&lt;br/&gt;
+/**&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
+ * or more contributor license agreements. See the NOTICE file&lt;br/&gt;
+ * distributed with this work for additional information&lt;br/&gt;
+ * regarding copyright ownership. The ASF licenses this file&lt;br/&gt;
+ * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
+ * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
+ * with the License. You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ * &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing,&lt;br/&gt;
+ * software distributed under the License is distributed on an&lt;br/&gt;
+ * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY&lt;br/&gt;
+ * KIND, either express or implied. See the License for the&lt;br/&gt;
+ * specific language governing permissions and limitations&lt;br/&gt;
+ * under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+package org.apache.cxf.systest.jaxws.attachment;&lt;br/&gt;
+&lt;br/&gt;
+import javax.jws.WebMethod;&lt;br/&gt;
+import javax.jws.WebParam;&lt;br/&gt;
+import javax.jws.WebService;&lt;br/&gt;
+import javax.xml.bind.annotation.XmlElement;&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.cxf.annotations.SchemaValidation;&lt;br/&gt;
+&lt;br/&gt;
+@WebService(name = &quot;AttachmentService&quot;, targetNamespace = &quot;http://org.apache.cxf/service/AttachmentService&quot;)&lt;br/&gt;
+@SchemaValidation(type = SchemaValidation.SchemaValidationType.IN)&lt;br/&gt;
+public interface AttachmentService &lt;/p&gt;
{
+
+    @WebMethod
+    int test(@WebParam(name = &quot;request&quot;) @XmlElement(required = true) Request request) throws Exception;
+
+}
&lt;p&gt;diff --git a/systests/jaxws/src/test/java/org/apache/cxf/systest/jaxws/attachment/AttachmentServiceImpl.java b/systests/jaxws/src/test/java/org/apache/cxf/systest/jaxws/attachment/AttachmentServiceImpl.java&lt;br/&gt;
new file mode 100644&lt;br/&gt;
index 00000000000..b6a4511347f&lt;br/&gt;
&amp;#8212; /dev/null&lt;br/&gt;
+++ b/systests/jaxws/src/test/java/org/apache/cxf/systest/jaxws/attachment/AttachmentServiceImpl.java&lt;br/&gt;
@@ -0,0 +1,45 @@&lt;br/&gt;
+/**&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
+ * or more contributor license agreements. See the NOTICE file&lt;br/&gt;
+ * distributed with this work for additional information&lt;br/&gt;
+ * regarding copyright ownership. The ASF licenses this file&lt;br/&gt;
+ * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
+ * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
+ * with the License. You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ * &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing,&lt;br/&gt;
+ * software distributed under the License is distributed on an&lt;br/&gt;
+ * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY&lt;br/&gt;
+ * KIND, either express or implied. See the License for the&lt;br/&gt;
+ * specific language governing permissions and limitations&lt;br/&gt;
+ * under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+package org.apache.cxf.systest.jaxws.attachment;&lt;br/&gt;
+&lt;br/&gt;
+import java.io.InputStream;&lt;br/&gt;
+&lt;br/&gt;
+import javax.activation.DataHandler;&lt;br/&gt;
+import javax.jws.WebMethod;&lt;br/&gt;
+import javax.jws.WebParam;&lt;br/&gt;
+import javax.jws.WebService;&lt;br/&gt;
+import javax.xml.bind.annotation.XmlElement;&lt;br/&gt;
+import javax.xml.ws.soap.MTOM;&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.cxf.annotations.SchemaValidation;&lt;br/&gt;
+import org.apache.cxf.helpers.IOUtils;&lt;br/&gt;
+&lt;br/&gt;
+@WebService(name = &quot;AttachmentService&quot;, targetNamespace = &quot;http://org.apache.cxf/service/AttachmentService&quot;)&lt;br/&gt;
+@SchemaValidation(type = SchemaValidation.SchemaValidationType.IN)&lt;br/&gt;
+@MTOM(enabled = true)&lt;br/&gt;
+public class AttachmentServiceImpl implements AttachmentService {&lt;br/&gt;
+&lt;br/&gt;
+    @WebMethod&lt;br/&gt;
+    public int test(@WebParam(name = &quot;request&quot;) @XmlElement(required = true) Request request) throws Exception &lt;/p&gt;
{
+        DataHandler dataHandler = request.getContent();
+        InputStream inputStream = dataHandler.getInputStream();
+        return IOUtils.readBytesFromStream(inputStream).length;
+    }
&lt;p&gt;+}&lt;br/&gt;
diff --git a/systests/jaxws/src/test/java/org/apache/cxf/systest/jaxws/attachment/Request.java b/systests/jaxws/src/test/java/org/apache/cxf/systest/jaxws/attachment/Request.java&lt;br/&gt;
new file mode 100644&lt;br/&gt;
index 00000000000..b9f082076e7&lt;br/&gt;
&amp;#8212; /dev/null&lt;br/&gt;
+++ b/systests/jaxws/src/test/java/org/apache/cxf/systest/jaxws/attachment/Request.java&lt;br/&gt;
@@ -0,0 +1,45 @@&lt;br/&gt;
+/**&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
+ * or more contributor license agreements. See the NOTICE file&lt;br/&gt;
+ * distributed with this work for additional information&lt;br/&gt;
+ * regarding copyright ownership. The ASF licenses this file&lt;br/&gt;
+ * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
+ * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
+ * with the License. You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ * &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing,&lt;br/&gt;
+ * software distributed under the License is distributed on an&lt;br/&gt;
+ * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY&lt;br/&gt;
+ * KIND, either express or implied. See the License for the&lt;br/&gt;
+ * specific language governing permissions and limitations&lt;br/&gt;
+ * under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+package org.apache.cxf.systest.jaxws.attachment;&lt;br/&gt;
+&lt;br/&gt;
+import javax.activation.DataHandler;&lt;br/&gt;
+import javax.xml.bind.annotation.XmlAccessType;&lt;br/&gt;
+import javax.xml.bind.annotation.XmlAccessorType;&lt;br/&gt;
+import javax.xml.bind.annotation.XmlElement;&lt;br/&gt;
+import javax.xml.bind.annotation.XmlType;&lt;br/&gt;
+&lt;br/&gt;
+@XmlAccessorType(XmlAccessType.FIELD)&lt;br/&gt;
+@XmlType(name = &quot;request&quot;, propOrder = &lt;/p&gt;
{&quot;content&quot;}
&lt;p&gt;)&lt;br/&gt;
+public class Request {&lt;br/&gt;
+&lt;br/&gt;
+    @XmlElement(name = &quot;content&quot;, required = true)&lt;br/&gt;
+    private DataHandler content;&lt;br/&gt;
+&lt;br/&gt;
+    public Request() &lt;/p&gt;
{
+    }
&lt;p&gt;+&lt;br/&gt;
+    public DataHandler getContent() &lt;/p&gt;
{
+        return content;
+    }
&lt;p&gt;+&lt;br/&gt;
+    public void setContent(DataHandler content) &lt;/p&gt;
{
+        this.content = content;
+    }
&lt;p&gt;+}&lt;br/&gt;
diff --git a/systests/jaxws/src/test/java/org/apache/cxf/systest/jaxws/attachment/ValidationWithAttachmentTest.java b/systests/jaxws/src/test/java/org/apache/cxf/systest/jaxws/attachment/ValidationWithAttachmentTest.java&lt;br/&gt;
new file mode 100644&lt;br/&gt;
index 00000000000..cda53f20b9f&lt;br/&gt;
&amp;#8212; /dev/null&lt;br/&gt;
+++ b/systests/jaxws/src/test/java/org/apache/cxf/systest/jaxws/attachment/ValidationWithAttachmentTest.java&lt;br/&gt;
@@ -0,0 +1,83 @@&lt;br/&gt;
+/**&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
+ * or more contributor license agreements. See the NOTICE file&lt;br/&gt;
+ * distributed with this work for additional information&lt;br/&gt;
+ * regarding copyright ownership. The ASF licenses this file&lt;br/&gt;
+ * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
+ * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
+ * with the License. You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ * &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing,&lt;br/&gt;
+ * software distributed under the License is distributed on an&lt;br/&gt;
+ * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY&lt;br/&gt;
+ * KIND, either express or implied. See the License for the&lt;br/&gt;
+ * specific language governing permissions and limitations&lt;br/&gt;
+ * under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+package org.apache.cxf.systest.jaxws.attachment;&lt;br/&gt;
+&lt;br/&gt;
+import javax.activation.DataHandler;&lt;br/&gt;
+import javax.xml.ws.BindingProvider;&lt;br/&gt;
+import javax.xml.ws.soap.SOAPBinding;&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.cxf.endpoint.Server;&lt;br/&gt;
+import org.apache.cxf.jaxws.JaxWsProxyFactoryBean;&lt;br/&gt;
+import org.apache.cxf.jaxws.JaxWsServerFactoryBean;&lt;br/&gt;
+import org.apache.cxf.testutil.common.TestUtil;&lt;br/&gt;
+&lt;br/&gt;
+import org.junit.AfterClass;&lt;br/&gt;
+import org.junit.Assert;&lt;br/&gt;
+import org.junit.BeforeClass;&lt;br/&gt;
+import org.junit.Test;&lt;br/&gt;
+&lt;br/&gt;
+public class ValidationWithAttachmentTest {&lt;br/&gt;
+&lt;br/&gt;
+    static final String PORT = TestUtil.getNewPortNumber(ValidationWithAttachmentTest.class);&lt;br/&gt;
+    static final String ADDRESS = &quot;http://localhost:&quot; + PORT + &quot;/&quot; + ValidationWithAttachmentTest.class.getSimpleName();&lt;br/&gt;
+&lt;br/&gt;
+    static Server server;&lt;br/&gt;
+    static AttachmentService client;&lt;br/&gt;
+&lt;br/&gt;
+    @BeforeClass&lt;br/&gt;
+    public static void setUp() &lt;/p&gt;
{
+        initServer();
+        initClient();
+    }
&lt;p&gt;+&lt;br/&gt;
+    @AfterClass&lt;br/&gt;
+    public static void tearDown() &lt;/p&gt;
{
+        server.stop();
+    }
&lt;p&gt;+&lt;br/&gt;
+    @Test&lt;br/&gt;
+    public void test() throws Exception &lt;/p&gt;
{
+        Request request = new Request();
+        request.setContent(new DataHandler(&quot;test&quot;, &quot;text/plain&quot;));
+
+        int bytes = client.test(request);
+        Assert.assertTrue(&quot;Attachment data were not received&quot;, bytes &amp;gt; 0);
+    }
&lt;p&gt;+&lt;br/&gt;
+    private static void initServer() &lt;/p&gt;
{
+        JaxWsServerFactoryBean factory = new JaxWsServerFactoryBean();
+        factory.setServiceClass(AttachmentServiceImpl.class);
+        factory.setAddress(ADDRESS);
+        factory.setServiceBean(new AttachmentServiceImpl());
+        server = factory.create();
+    }
&lt;p&gt;+&lt;br/&gt;
+    private static void initClient() &lt;/p&gt;
{
+        JaxWsProxyFactoryBean clientFactory = new JaxWsProxyFactoryBean();
+        clientFactory.setServiceClass(AttachmentService.class);
+        clientFactory.setAddress(ADDRESS);
+        client = (AttachmentService) clientFactory.create();
+
+        //enable MTOM in client
+        BindingProvider bp = (BindingProvider) client;
+        SOAPBinding binding = (SOAPBinding) bp.getBinding();
+        binding.setMTOMEnabled(true);
+    }
&lt;p&gt;+}&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16541196" author="deki" created="Thu, 12 Jul 2018 06:12:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thofman&quot; class=&quot;user-hover&quot; rel=&quot;thofman&quot;&gt;thofman&lt;/a&gt; there is a report that it no longer works without schema validation: &lt;a href=&quot;https://stackoverflow.com/questions/51216192/spring-boot-apache-cxf-3-2-5-with-mtom-sends-empty-attachment&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://stackoverflow.com/questions/51216192/spring-boot-apache-cxf-3-2-5-with-mtom-sends-empty-attachment&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Could you please take a look?&lt;/p&gt;</comment>
                            <comment id="16541409" author="thofman" created="Thu, 12 Jul 2018 09:55:23 +0000"  >&lt;p&gt;Sure, checking it out.&lt;/p&gt;</comment>
                            <comment id="16543287" author="thofman" created="Fri, 13 Jul 2018 14:40:46 +0000"  >&lt;p&gt;There isn&apos;t much detail in the report but I gather that the reported had to enable request validation on the client side to make attachments transfer working. His server implementation is non Java.&lt;/p&gt;

&lt;p&gt;I tried to extend my test case&#160;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; to involve some basic use cases with enabled client side validation. I tried to use simple-fronted client and jaxws client. Everything appears to be working fine. Concerning my original fix, I verified again that the reproducer is passing in both cases with validation enabled and disabled.&lt;/p&gt;

&lt;p&gt;Could someone perhaps review the test to check that I&apos;m not doing some nonsense or suggest other things to test? I&apos;m not very familiar with various frontends offered by CXF. I didn&apos;t manage for instance to make simple-fronted client pass server side validation at all, and had various issues with server reading empty request because of simple-frontend client sending objects with different namespace, or method arguments being named differently (&quot;arg0&quot; vs &quot;request&quot;). It could be that the reporter is facing something similar.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/TomasHofman/cxf/commit/b1ad08217e901d15d570c651042550c869cd93cd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/TomasHofman/cxf/commit/b1ad08217e901d15d570c651042550c869cd93cd&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12927441" name="sample_jboss_bug_apache_cxf.zip" size="1005269" author="thofman" created="Tue, 12 Jun 2018 09:31:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12311020" key="com.atlassian.jira.plugin.system.customfieldtypes:url">
                        <customfieldname>External issue URL</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[https://issues.jboss.org/browse/JBEAP-14830]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 18 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3urif:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>