<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:47:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-3518] WebClient doesn&apos;t handle responses containing a quoted-string in a header correctly</title>
                <link>https://issues.apache.org/jira/browse/CXF-3518</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;Similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-2462&quot; title=&quot;CXF REST is not parsing the header value correctly if a comma is specified in a parameter value.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-2462&quot;&gt;&lt;del&gt;CXF-2462&lt;/del&gt;&lt;/a&gt;, if a request returns a response header that looks like the following:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&lt;tt&gt;q: &quot;stuff with commas, and spaces&quot;&lt;/tt&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;WebClient&apos;s response.getMetadata() returns 2 values:&lt;/p&gt;

&lt;blockquote&gt;
&lt;ol&gt;
	&lt;li&gt;&quot;stuff with commas&lt;/li&gt;
	&lt;li&gt;and spaces&quot;&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;

&lt;p&gt;while the correct response should be:&lt;/p&gt;

&lt;blockquote&gt;
&lt;ol&gt;
	&lt;li&gt;stuff with commas, and spaces&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;

&lt;p&gt;Here&apos;s the WebClient code which reproduces the issue (as long as the server response contains a header that returns the header value above):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Response r = WebClient.create(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URI(&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8080&quot;&lt;/span&gt;)).path(&lt;span class=&quot;code-quote&quot;&gt;&quot;key/quoted&quot;&lt;/span&gt;).get();
&lt;/span&gt;List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; l = r.getMetadata().get(&lt;span class=&quot;code-quote&quot;&gt;&quot;q&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;JDK 1.6&lt;/p&gt;</environment>
        <key id="12507253">CXF-3518</key>
            <summary>WebClient doesn&apos;t handle responses containing a quoted-string in a header correctly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sergey_beryozkin">Sergey Beryozkin</assignee>
                                    <reporter username="kfung">Ka-Lok Fung</reporter>
                        <labels>
                    </labels>
                <created>Sun, 15 May 2011 05:30:50 +0000</created>
                <updated>Mon, 8 Aug 2011 14:43:37 +0000</updated>
                            <resolved>Tue, 17 May 2011 13:03:51 +0000</resolved>
                                    <version>2.4</version>
                    <version>2.3.4</version>
                                    <fixVersion>2.4.1</fixVersion>
                    <fixVersion>2.3.5</fixVersion>
                                    <component>JAX-RS</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13033647" author="kfung" created="Sun, 15 May 2011 05:42:38 +0000"  >&lt;p&gt;Here&apos;s my first attempt at a patch for this issue against trunk.&lt;/p&gt;

&lt;p&gt;I&apos;m more than willing to make further changes if anyone has any feedback.&lt;/p&gt;

&lt;p&gt;Three specific comments about this patch from my side:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;To leverage the work done in &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-2462&quot; title=&quot;CXF REST is not parsing the header value correctly if a comma is specified in a parameter value.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-2462&quot;&gt;&lt;del&gt;CXF-2462&lt;/del&gt;&lt;/a&gt;, instead of rolling our own header parsing code in &lt;tt&gt;WebClient&lt;/tt&gt;, &lt;tt&gt;HttpHeadersImpl&lt;/tt&gt; is used to do the header parsing.&lt;/li&gt;
	&lt;li&gt;This patch could be made more efficient by adding a function to &lt;tt&gt;HttpHeadersImpl&lt;/tt&gt; to return a &lt;tt&gt;Map&amp;lt;String, List&amp;lt;String&amp;gt;&amp;gt;&lt;/tt&gt; (see comment in patch). If you don&apos;t object to the function addition, I can update the patch with this change.&lt;/li&gt;
	&lt;li&gt;I was also looking into adding a unit test but it seems there&apos;s no easy way for me to do so (because the header parsing done in &lt;tt&gt;WebClient&lt;/tt&gt; is only done after a physical connection to a server). If anyone has any feedback on how to add a unit test for this, I&apos;ll greatly appreciate it.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13034268" author="sergey_beryozkin" created="Mon, 16 May 2011 20:08:45 +0000"  >&lt;p&gt;Hi, thanks for this patch.&lt;/p&gt;

&lt;p&gt;I&apos;m a bit concerned about introducing HttpHeaderImpl in there, given that some headers, notably Set-Cookie, can contain a combination of all sort of values, ex, &lt;br/&gt;
Set-Cookie: bar.com.anoncart=107894933471602436; Domain=.bar.com;Expires=Thu, 01-Oct-2020 23:44:22 GMT; Path=/&lt;/p&gt;

&lt;p&gt;and I&apos;m worried we could break some existing code there if we try to generalize, because HttpHeadersImpl will split by default.&lt;/p&gt;

&lt;p&gt;What do you think of the following approach:&lt;/p&gt;

&lt;p&gt;I reckon that realistically, as far as \&quot; character is concerned, we can expect&lt;br/&gt;
SomeHeader: &quot;some text, some more text&quot;&lt;/p&gt;

&lt;p&gt;or&lt;/p&gt;

&lt;p&gt;SomeHeader: &quot;some text, some more text&quot;,&quot;even more text&quot;&lt;/p&gt;

&lt;p&gt;but not &lt;/p&gt;

&lt;p&gt;SomeHeader: &quot;some text, some more text with inlined \&quot;&quot;&lt;br/&gt;
which may not be even legal.&lt;/p&gt;

&lt;p&gt;So would checking if the header value starts with \&quot; and if yes then parse it using fast indexOf will work well in most/all such cases ?&lt;/p&gt;

&lt;p&gt;Cheers, Sergey&lt;/p&gt;</comment>
                            <comment id="13034302" author="kfung" created="Mon, 16 May 2011 20:52:16 +0000"  >&lt;p&gt;For my use cases, your suggestion will work:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;So would checking if the header value starts with \&quot; and if yes then parse it using fast indexOf will work well in most/all such cases ? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;However, this is technically allowed (per RFC2616, section 2.2, see quoted-pair)&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;SomeHeader: &quot;some text, some more text with inlined \&quot;&quot;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;What do you think of me submitting another patch that works for the following use cases:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;SomeHeader: &quot;some text, some more text&quot;&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;SomeHeader: &quot;some text&quot;,&quot;quoted,text&quot;,&quot;even more text&quot;&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;SomeHeader: &quot;some text, some more text with inlined \&quot;&quot;&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;but would fail for the following use case:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;SomeHeader: some text,&quot;other quoted, text&quot;,&quot;blah&quot;&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Because we&apos;re doing text scanning, I&apos;m thinking that the most efficient way to do this is actually going character by character in the string (converting to &lt;tt&gt;char[]&lt;/tt&gt; first) than using indexOf. However, I could do a benchmark to see which is faster and choose that for the patch &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;What do you think?&lt;/p&gt;</comment>
                            <comment id="13034306" author="sergey_beryozkin" created="Mon, 16 May 2011 20:59:28 +0000"  >&lt;p&gt;Hi&lt;/p&gt;

&lt;p&gt;Failing&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;SomeHeader: some text,&quot;other quoted, text&quot;,&quot;blah&quot;&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;is not a problem because it&apos;s reasonable to expect multiple SomeHeader headers in such cases.&lt;/p&gt;

&lt;p&gt;SomeHeader: some text&lt;br/&gt;
SomeHeader: &quot;other quoted, text&quot;,&quot;blah&quot;&lt;/p&gt;

&lt;p&gt;If we ever get a single line like that then we can see what can be improved. We can always have contextual properties which can tell the client which headers may need some special processing/etc&lt;/p&gt;

&lt;p&gt;thanks, Sergey&lt;/p&gt;</comment>
                            <comment id="13034309" author="kfung" created="Mon, 16 May 2011 21:05:05 +0000"  >&lt;p&gt;Okay, that works for me. I&apos;ll work on this tonight then.&lt;/p&gt;

&lt;p&gt;By the way, did you have any suggestions for the unit test question I had? Is there a way I can easily/moderately add a unit test for this?&lt;/p&gt;

&lt;p&gt;-kl&lt;/p&gt;</comment>
                            <comment id="13034319" author="sergey_beryozkin" created="Mon, 16 May 2011 21:17:13 +0000"  >&lt;p&gt;At the moment the fact that HttpURLConnection is directly dealt with is problematic. We will definitely refactor the client runtime, for the async conduit be supported better, for a local transport be supported, etc. That will have to become a priority soon enough, however we are more focused at the moment on wadl and security.&lt;/p&gt;

&lt;p&gt;In meantime, I tend to update real system tests to test such cases, ex, please copy &amp;amp; paste one of BookStore methods in systest/jaxrs and then add a test invocation in JAXRSClientServerBookTest. That will work with Jetty. I believe one can do a similar test even in rt/frontend/jaxrs, but I&apos;ll need to review how it can be done&lt;/p&gt;

&lt;p&gt;Cheers, Sergey &lt;/p&gt;


</comment>
                            <comment id="13034602" author="kfung" created="Tue, 17 May 2011 06:45:26 +0000"  >&lt;p&gt;I&apos;ve implemented the &quot;good enough&quot; proposal per the feedback from Sergey.&lt;/p&gt;

&lt;p&gt;As long as long all the values inside the header are appropriately quoted, they will be available to &lt;tt&gt;WebClient&lt;/tt&gt;. If the values aren&apos;t quoted correctly, &lt;tt&gt;WebClient&lt;/tt&gt; will apply a &quot;best effort&quot; approach to return the header data from the server to the client.&lt;/p&gt;

&lt;p&gt;I&apos;ve also added/modified three system tests to component test these changes:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;I&apos;ve extended the ETag test to make sure the current &lt;tt&gt;WebClient&lt;/tt&gt; behaviour remains - that is, if the server returned quoted values, &lt;tt&gt;WebClient&lt;/tt&gt; also return quoted values.&lt;/li&gt;
	&lt;li&gt;Added a test for quoted-strings in headers&lt;/li&gt;
	&lt;li&gt;Added a test for malformed quoted-strings in headers &amp;amp; broken per spec case discussed above&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13034742" author="sergey_beryozkin" created="Tue, 17 May 2011 13:03:51 +0000"  >&lt;p&gt;Patch with a minor modification has been applied, many thanks.&lt;br/&gt;
I just had to update AbstractClient to check if a given value was empty or null, before testing if it was quoted&lt;/p&gt;


&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/viewvc?rev=1104217&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=1104217&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12479250" name="trunk.wc_quote_minimal.diff" size="3277" author="kfung" created="Sun, 15 May 2011 05:42:38 +0000"/>
                            <attachment id="12479434" name="trunk.webclient.quote.try2.diff" size="10125" author="kfung" created="Tue, 17 May 2011 06:45:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10061"><![CDATA[Novice]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5854</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 28 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0b987:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>63607</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>