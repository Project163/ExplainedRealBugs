<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:40:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-9100] HttpClient-1-Worker-* thread leak when throwing exception in LoggingOutInterceptor and sending large SOAP message</title>
                <link>https://issues.apache.org/jira/browse/CXF-9100</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;Hello,&lt;/p&gt;

&lt;p&gt;After upgrading from 3.5.3 to 3.6+ (tried 3.6.5, 4.0.4, 4.1.0) we have noticed a HttpClient-1-Worker-* thread leak. Screenshots from VisualVM in attachments.&lt;/p&gt;

&lt;p&gt;How to reproduce:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;register custom LogEventSender and LoggingOutInterceptor&#160;&lt;/li&gt;
	&lt;li&gt;throw any exception in send() method&lt;/li&gt;
	&lt;li&gt;send SOAP message with body &amp;gt;4kb (default chunkingThreshold value for HTTPConduit)&lt;/li&gt;
	&lt;li&gt;repeat previous step N times&lt;/li&gt;
	&lt;li&gt;watch HttpClient-1-Worker-* threads count grow till RejectedExecutionException for JDK17 or OutOfMemoryError for JDK21 after 3984 (in my case) threads&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Possible workaround:&lt;br/&gt;
Configure chunkingThreshold with greater value&lt;/p&gt;

&lt;p&gt;Example for Spring:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Bean
fun httpConduitConfigurer(): HTTPConduitConfigurer {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; HTTPConduitConfigurer { _, _, conduit -&amp;gt;
        val httpClientPolicy = HTTPClientPolicy()
        httpClientPolicy.chunkingThreshold = 16384
        conduit.setClient(httpClientPolicy)
    }
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I wrote a demo project for this case: &lt;a href=&quot;https://github.com/AndChelp/cxf-thread-leak&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/AndChelp/cxf-thread-leak&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You can run TestControllerTest#testCommonEndpoint and watch &#171;HttpClient-1-* thread count: N&#187; log. Or you can run it as Spring Application, send GET /common request and watch threads with any profiler.&lt;/p&gt;

&lt;p&gt;The project also has a configured workaround on /workaround endpoint and test for it&lt;/p&gt;</description>
                <environment></environment>
        <key id="13604674">CXF-9100</key>
            <summary>HttpClient-1-Worker-* thread leak when throwing exception in LoggingOutInterceptor and sending large SOAP message</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="reta">Andriy Redko</assignee>
                                    <reporter username="andchelp">Andrey</reporter>
                        <labels>
                    </labels>
                <created>Mon, 13 Jan 2025 08:07:52 +0000</created>
                <updated>Sat, 19 Apr 2025 23:11:53 +0000</updated>
                            <resolved>Sat, 19 Apr 2025 23:11:53 +0000</resolved>
                                    <version>4.0.4</version>
                    <version>4.1.0</version>
                    <version>3.6.5</version>
                                    <fixVersion>4.1.2</fixVersion>
                    <fixVersion>4.0.8</fixVersion>
                    <fixVersion>3.6.7</fixVersion>
                                    <component>logging</component>
                    <component>Transports</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                        <attachments>
                            <attachment id="13073939" name="image-2025-01-13-12-39-07-688.png" size="2588309" author="andchelp" created="Mon, 13 Jan 2025 07:39:10 +0000"/>
                            <attachment id="13073938" name="image-2025-01-13-12-40-36-534.png" size="546692" author="andchelp" created="Mon, 13 Jan 2025 07:40:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12314421" key="com.atlassian.jira.plugin.system.customfieldtypes:labels">
                        <customfieldname>Language</customfieldname>
                        <customfieldvalues>
                                        <label>Java</label>
            <label>kotlin</label>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            43 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1tk94:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>