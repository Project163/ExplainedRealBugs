<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:04:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-4934] JAXRSInvoker and Proxy classes (Spring Security)</title>
                <link>https://issues.apache.org/jira/browse/CXF-4934</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;


&lt;p&gt;I am aware of other tickets regarding the proxy invocation issues.&lt;/p&gt;

&lt;p&gt;During development I noticed an exception popping up:&lt;br/&gt;
IllegalArgumentException: object not instance of class&lt;/p&gt;

&lt;p&gt;I narrowed it down to AbstractInvoker.java:performInvocation(Exchange exchange, Object serviceObject, Method m, Object[] paramArray)&lt;/p&gt;

&lt;p&gt;This kept happening whenever I added a @Secured annotation to a rest method. This annotation caused a Spring Security AOP Proxy to be passed to the default Invoker (JAXRSInvoker.java) instead of the original target class. Which is fine.&lt;/p&gt;

&lt;p&gt;The problem (I think) is in the method performInvocation. The serviceObject parameter is a reference to the Proxy and not the target class causing the line:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;return m.invoke(serviceObject, paramArray);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;to fail with the above mentioned error.&lt;/p&gt;


&lt;p&gt;I resolved this by extending JAXRSInvoker and registering it via:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;jaxrs:invoker&amp;gt;
    &amp;lt;bean class=&quot;hr.altima.web.security.SpringSecurityInvokerProxy&quot;/&amp;gt;
&amp;lt;/jaxrs:invoker&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and overriding the performInvocation method like so:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;public class SpringSecurityInvokerProxy extends JAXRSInvoker {

    @Override
    protected Object performInvocation(Exchange exchange, Object serviceObject, Method m, Object[] paramArray) throws Exception {
        paramArray = insertExchange(m, paramArray, exchange);


        if (serviceObject instanceof Proxy) {
            try {
                return Proxy.getInvocationHandler(serviceObject).invoke(serviceObject, m, paramArray);
            } catch (Throwable throwable) {
                throw new Exception(&quot;Proxy invocation threw an exception&quot;, throwable);
            }
        } else {
            return m.invoke(serviceObject, paramArray);
        }
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;My reasoning is that you want to call the proxied method (security check) and not the target method directly but the call through proxies should be done differently.&lt;/p&gt;

&lt;p&gt;I am not saying this is the correct way to invoke proxies but it works for this situation although I prefer this to be built in the CXF lib.&lt;/p&gt;

</description>
                <environment>&lt;p&gt;Spring framework ver 3.1.3.RELEASE&lt;/p&gt;</environment>
        <key id="12639779">CXF-4934</key>
            <summary>JAXRSInvoker and Proxy classes (Spring Security)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sergey_beryozkin">Sergey Beryozkin</assignee>
                                    <reporter username="franpregernik">Fran Pregernik</reporter>
                        <labels>
                            <label>invoker</label>
                            <label>newbie</label>
                            <label>proxy</label>
                            <label>rest</label>
                            <label>springsecurity</label>
                    </labels>
                <created>Fri, 29 Mar 2013 09:48:20 +0000</created>
                <updated>Tue, 26 Nov 2013 17:40:12 +0000</updated>
                            <resolved>Fri, 27 Sep 2013 16:32:07 +0000</resolved>
                                    <version>2.7.3</version>
                    <version>3.0.0-milestone1</version>
                                    <fixVersion>3.0.0-milestone1</fixVersion>
                    <fixVersion>2.7.8</fixVersion>
                                    <component>JAX-RS</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13617579" author="sergey_beryozkin" created="Fri, 29 Mar 2013 18:22:46 +0000"  >&lt;p&gt;Hi - thanks for reporting the issue - good the see you&apos;ve found a workaround. &lt;br/&gt;
I&apos;ve thought we&apos;ve had most of these issues resolved - for example, see&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/repos/asf/cxf/trunk/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/security/SecureBookInterface.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/repos/asf/cxf/trunk/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/security/SecureBookInterface.java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;this interface is implemented by&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/repos/asf/cxf/trunk/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/security/SecureBookStore.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/repos/asf/cxf/trunk/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/security/SecureBookStore.java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;and is referenced here:&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/repos/asf/cxf/trunk/systests/jaxrs/src/test/resources/jaxrs_security/WEB-INF/beans.xml&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/repos/asf/cxf/trunk/systests/jaxrs/src/test/resources/jaxrs_security/WEB-INF/beans.xml&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I wonder what is  different in your case ?&lt;/p&gt;</comment>
                            <comment id="13617988" author="franpregernik" created="Sat, 30 Mar 2013 05:32:07 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;in the example you provided I noticed that the @Secured interface was defined on the interface. I have a generic CrudInterface so that wouldn&apos;t be ok to do but I tried it anyway and it didn&apos;t help. JAXRSInvoker still gets the Proxy class as the serviceObject in performInvocation and the m.invoke fails.&lt;/p&gt;

&lt;p&gt;I also noticed in the example that it is using the CustomJAXRSInvoker which does its own security checking before the reflection invoke call. But this is duplicating the behaviour that the Proxy does anyway (and it does it better probably).&lt;/p&gt;

&lt;p&gt;I will attach the testbed for my issue and you can see the issue for yourself. Just put a brakepoint in SpringSecurityInvokerProxy:performInvocation.&lt;/p&gt;</comment>
                            <comment id="13617990" author="franpregernik" created="Sat, 30 Mar 2013 05:42:19 +0000"  >&lt;p&gt;Demo project&lt;/p&gt;</comment>
                            <comment id="13618451" author="sergey_beryozkin" created="Sun, 31 Mar 2013 19:39:19 +0000"  >&lt;p&gt;Hi - thanks for attaching the test project.&lt;/p&gt;

&lt;p&gt;What I&apos;ve found out is that changing CrudService to have &quot;public Response findById(Long id);&quot; instead of &quot;public Response findById(I id);&quot; fixes the issue. JAX-RS runtime tries to find out which method to invoke on the proxy and I guess CrudService methods have actually Object parameters due to the erasure so the runtime can not spot the actual method on the proxy so it fails and the workaround is needed.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure yet if we can generalize what you typed in the custom invoker...&lt;/p&gt;




&lt;p&gt;Note that even with your custom service invoker, SpringSecurity still blocks &apos;findById&apos; with 403, it kind of works during the 1st attempt but then fails after the retry.  &lt;/p&gt;


</comment>
                            <comment id="13619499" author="franpregernik" created="Tue, 2 Apr 2013 04:13:39 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;thank you for your effort. I just started configuring Spring Security and chances are high that I misconfigured something - ignore that &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;You are right, there is no need to use the generic form of CrudService. Now I have two workarounds for this issue.&lt;/p&gt;

&lt;p&gt;To generalize this in the future maybe you could find out how is it that the proxy invocation handler resolves and calls the method on the proxy without problems and use that in CXF. Maybe Spring Security took into account the generic parameter when creating the proxy wrapper, created the proper method signature and that is why the call works (just speculating).&lt;/p&gt;

&lt;p&gt;That being said I am satisfied with the workarounds so you can treat this issue as you see fit.&lt;/p&gt;</comment>
                            <comment id="13619588" author="sergey_beryozkin" created="Tue, 2 Apr 2013 07:26:09 +0000"  >&lt;p&gt;Hi - I&apos;m actually not sure the invocation handler invokes the right method either. CXF does &quot;method.invoke(object)&quot; and in this case it does not work because the method belongs to the service bean class, not to its proxy. I suspect the handler works because it is smart enough to invoke directly on the service bean - bypassing the AOP layer supporting @Secured - I was not able to confirm because even with &quot;rod:koala&quot; I was getting 403 &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;</comment>
                            <comment id="13619657" author="franpregernik" created="Tue, 2 Apr 2013 09:34:22 +0000"  >&lt;p&gt;Updated project - fixed AccessDeniedException by switching to Spring Security pre-post annotations.&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12576529" name="web-template-2.zip" size="13023" author="franpregernik" created="Tue, 2 Apr 2013 09:34:22 +0000"/>
                            <attachment id="12576221" name="web-template.zip" size="13118" author="franpregernik" created="Sat, 30 Mar 2013 05:42:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>320248</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 34 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1j98f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>320589</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>