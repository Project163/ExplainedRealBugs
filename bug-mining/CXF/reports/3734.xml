<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:39:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-8987] Java 21 - HttpClientHTTPConduit thread locked during shutdown </title>
                <link>https://issues.apache.org/jira/browse/CXF-8987</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I am using Apache CXF client via the Apache Camel CXF connector.&lt;/p&gt;

&lt;p&gt;After I updated frm OpenJDK 17.x to OpenJDK 21.0.2, during application shutdown, the following lock occurs:&lt;/p&gt;

&lt;p&gt;&lt;b&gt;at java.lang.Thread.join(java.base@21.0.2/Thread.java:2072)&lt;/b&gt;&lt;br/&gt;
&#160; &#160; &lt;b&gt;- locked &amp;lt;0x000000061cd2ab80&amp;gt; (a jdk.internal.net.http.HttpClientImpl$SelectorManager)&lt;/b&gt;&lt;br/&gt;
&#160; &#160; &lt;b&gt;at java.lang.Thread.join(java.base@21.0.2/Thread.java:2200)&lt;/b&gt;&lt;br/&gt;
&#160; &#160; &lt;b&gt;at jdk.internal.net.http.HttpClientImpl.awaitTermination(java.net.http@21.0.2/HttpClientImpl.java:628)&lt;/b&gt;&lt;br/&gt;
&#160; &#160; &lt;b&gt;at java.net.http.HttpClient.&lt;font color=&quot;#de350b&quot;&gt;close&lt;/font&gt;(java.net.http@21.0.2/HttpClient.java:900)&lt;/b&gt;&lt;br/&gt;
&#160; &#160; &lt;b&gt;at jdk.internal.net.http.HttpClientFacade.&lt;font color=&quot;#de350b&quot;&gt;close&lt;/font&gt;(java.net.http@21.0.2/HttpClientFacade.java:192)&lt;/b&gt;&lt;br/&gt;
&#160; &#160; &lt;b&gt;at org.apache.cxf.transport.http.HttpClientHTTPConduit.&lt;font color=&quot;#de350b&quot;&gt;close&lt;/font&gt;(HttpClientHTTPConduit.java:125)&lt;/b&gt;&lt;/p&gt;


&lt;p&gt;HttpClientHTTPConduit.close&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void close() {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (client &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; AutoCloseable) {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            ((AutoCloseable)client).close();
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
            &lt;span class=&quot;code-comment&quot;&gt;//ignore
&lt;/span&gt;        }
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (client != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name = client.toString();
        client = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
        tryToShutdownSelector(name);
    }
    defaultAddress = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.close();
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;br/&gt;
java.net.HttpClient.close&lt;br/&gt;
&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void close() {
    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; terminated = isTerminated();
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!terminated) {
        shutdown();
        &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; interrupted = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
        &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (!terminated) {
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                terminated = awaitTermination(Duration.ofDays(1L));
            } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) {
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!interrupted) {
                    interrupted = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
                    shutdownNow();
                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isTerminated()) &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
                }
            }
        }
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (interrupted) {
            &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread().interrupt();
        }
    }
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;My workaround&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void close() {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (client &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; AutoCloseable) {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            client.shutdownNow();
            &lt;span class=&quot;code-comment&quot;&gt;//((AutoCloseable)client).close();
&lt;/span&gt;        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
            &lt;span class=&quot;code-comment&quot;&gt;//ignore
&lt;/span&gt;        }
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (client != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name = client.toString();
        client = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
        tryToShutdownSelector(name);
    }
    defaultAddress = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.close();
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13067472/13067472_thdump2&quot; title=&quot;thdump2 attached to CXF-8987&quot;&gt;thdump2&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;OpenJDK 21.0.2&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Apache CXF 4.0.4&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Apache Camel 4.4.1&lt;/b&gt;&lt;/p&gt;</environment>
        <key id="13572085">CXF-8987</key>
            <summary>Java 21 - HttpClientHTTPConduit thread locked during shutdown </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="reta">Andriy Redko</assignee>
                                    <reporter username="carnevalegiacomo">Giacomo Carnevale</reporter>
                        <labels>
                    </labels>
                <created>Fri, 15 Mar 2024 17:47:15 +0000</created>
                <updated>Sat, 11 May 2024 19:42:11 +0000</updated>
                            <resolved>Sat, 11 May 2024 19:42:11 +0000</resolved>
                                    <version>4.0.3</version>
                    <version>4.0.4</version>
                                    <fixVersion>4.1.0</fixVersion>
                    <fixVersion>4.0.5</fixVersion>
                    <fixVersion>3.6.4</fixVersion>
                                    <component>Transports</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17830282" author="reta" created="Sun, 24 Mar 2024 17:02:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=carnevalegiacomo&quot; class=&quot;user-hover&quot; rel=&quot;carnevalegiacomo&quot;&gt;carnevalegiacomo&lt;/a&gt; thanks for reporting it, it seems to be fixed by &lt;a href=&quot;https://bugs.openjdk.org/browse/JDK-8316580,&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://bugs.openjdk.org/browse/JDK-8316580,&lt;/a&gt; could you please recheck if it is still reproducible on JDK-22? Thank you.&lt;/p&gt;</comment>
                            <comment id="17833499" author="carnevalegiacomo" created="Wed, 3 Apr 2024 10:54:53 +0000"  >&lt;p&gt;Hi&lt;/p&gt;

&lt;p&gt;same problem with OpenJdk 22&lt;/p&gt;

&lt;p&gt;openjdk version &quot;22&quot; 2024-03-19&lt;br/&gt;
OpenJDK Runtime Environment (build 22+36-2370)&lt;br/&gt;
OpenJDK 64-Bit Server VM (build 22+36-2370, mixed mode, sharing)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;b&gt;Java Stack&lt;/b&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;at java.lang.Object.wait0(java.base@22/Native Method)
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;waiting on &lt;span class=&quot;error&quot;&gt;&amp;#91;no object reference available&amp;#93;&lt;/span&gt;&lt;br/&gt;
at java.lang.Object.wait(java.base@22/Object.java:375)&lt;br/&gt;
at java.lang.Thread.join(java.base@22/Thread.java:2039)&lt;/li&gt;
	&lt;li&gt;locked &lt;span class=&quot;error&quot;&gt;&amp;#91;0x0000000618372e08&amp;#93;&lt;/span&gt; (a jdk.internal.net.http.HttpClientImpl$SelectorManager)&lt;br/&gt;
at java.lang.Thread.join(java.base@22/Thread.java:2167)&lt;br/&gt;
at jdk.internal.net.http.HttpClientImpl.awaitTermination(java.net.http@22/HttpClientImpl.java:632)&lt;br/&gt;
at java.net.http.HttpClient.close(java.net.http@22/HttpClient.java:900)&lt;br/&gt;
at jdk.internal.net.http.HttpClientFacade.close(java.net.http@22/HttpClientFacade.java:192)&lt;br/&gt;
at org.apache.cxf.transport.http.HttpClientHTTPConduit.close(HttpClientHTTPConduit.java:125)&lt;br/&gt;
at org.apache.cxf.endpoint.AbstractConduitSelector.close(AbstractConduitSelector.java:77)&lt;br/&gt;
at org.apache.cxf.endpoint.ClientImpl.destroy(ClientImpl.java:177)&lt;br/&gt;
at org.apache.camel.component.cxf.jaxws.CxfProducer.doStop(CxfProducer.java:93)&lt;br/&gt;
at org.apache.camel.support.service.BaseService.stop(BaseService.java:154)&lt;/li&gt;
&lt;/ul&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;My workaround is to set system property org.apache.cxf.transport.http.forceURLConnection=true&lt;/p&gt;</comment>
                            <comment id="17833604" author="reta" created="Wed, 3 Apr 2024 14:27:24 +0000"  >&lt;p&gt;Thanks a lot for confirming, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=carnevalegiacomo&quot; class=&quot;user-hover&quot; rel=&quot;carnevalegiacomo&quot;&gt;carnevalegiacomo&lt;/a&gt; , will be looking into it shortly.&lt;/p&gt;</comment>
                            <comment id="17834027" author="ffang" created="Thu, 4 Apr 2024 17:03:09 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=carnevalegiacomo&quot; class=&quot;user-hover&quot; rel=&quot;carnevalegiacomo&quot;&gt;carnevalegiacomo&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Is it possible that you append a reproducer project so that we can reproduce this behaviour easily?&lt;/p&gt;

&lt;p&gt;Thanks!&lt;br/&gt;
Freeman&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13067472" name="thdump2" size="40062" author="carnevalegiacomo" created="Fri, 15 Mar 2024 17:34:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 31 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1o068:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>