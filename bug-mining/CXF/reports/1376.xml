<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:54:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-4348] Content-Type is broken in multipart serialization</title>
                <link>https://issues.apache.org/jira/browse/CXF-4348</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;Multiparts are serialized incorrectly.&lt;br/&gt;
Imagine the response with two attachments:&lt;br/&gt;
a) &quot;filename1.doc&quot; with attachment-id &quot;Attachment_id1&quot; and Content-Type &quot;application/msword&quot;&lt;br/&gt;
b) &quot;filename2.xls&quot; with attachment-id &quot;Attachment_id2&quot; and Content-Type &quot;application/vnd.ms-excel&quot;&lt;br/&gt;
Serialization of this Multipart is ({} are used for text reduction):&lt;/p&gt;

&lt;p&gt;HTTP/1.1 200 OK&lt;br/&gt;
Server: ...&lt;br/&gt;
Date: ...&lt;br/&gt;
Content-Type: application/octet-stream; type=&quot;application/msword&quot;; boundary=&quot;uuid:&lt;/p&gt;
{UUID}&quot;; start=&quot;&amp;lt;Attachment_id1&amp;gt;&quot;; start-info=&quot;application/msword&quot;&lt;br/&gt;
Transfer-Encoding: chunked&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
--uuid:{UUID}
&lt;p&gt;Content-Type: text/xml; charset=UTF-8; type=&quot;application/msword&quot;;&lt;br/&gt;
Content-Transfer-Encoding: binary&lt;br/&gt;
Content-ID: &amp;lt;Attachment_id1&amp;gt;&lt;br/&gt;
Content-Disposition: attachment; filename=filename1.doc&lt;/p&gt;

{CONTENT1}&lt;br/&gt;
-&lt;del&gt;uuid:{UUID}&lt;br/&gt;
Content-Type: application/vnd.ms-excel&lt;br/&gt;
Content-Transfer-Encoding: binary&lt;br/&gt;
Content-ID: &amp;lt;Attachment_id2&amp;gt;&lt;br/&gt;
Content-Disposition: attachment; filename=filename2.xls&lt;br/&gt;

{CONTENT2}&lt;br/&gt;
--uuid:{UUID}&lt;/del&gt;-&lt;br/&gt;
&lt;br/&gt;
While we are expecting kind of this:&lt;br/&gt;
&lt;br/&gt;
HTTP/1.1 200 OK&lt;br/&gt;
Server: ...&lt;br/&gt;
Date: ...&lt;br/&gt;
Content-Type: multipart/related&lt;br/&gt;
Transfer-Encoding: chunked&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
--uuid:{UUID}&lt;br/&gt;
Content-Type: application/msword;&lt;br/&gt;
Content-Transfer-Encoding: binary&lt;br/&gt;
Content-ID: &amp;lt;Attachment_id1&amp;gt;&lt;br/&gt;
Content-Disposition: attachment; filename=filename1.doc&lt;br/&gt;
{CONTENT1}
&lt;p&gt;--uuid:&lt;/p&gt;
{UUID}&lt;br/&gt;
Content-Type: application/vnd.ms-excel&lt;br/&gt;
Content-Transfer-Encoding: binary&lt;br/&gt;
Content-ID: &amp;lt;Attachment_id2&amp;gt;&lt;br/&gt;
Content-Disposition: attachment; filename=filename2.xls&lt;br/&gt;

{CONTENT2}&lt;br/&gt;
--uuid:{UUID}
&lt;p&gt;&amp;#8211;&lt;/p&gt;

&lt;p&gt;So the Content-Type of the whole response and of the first part are incorrect.&lt;br/&gt;
The starting point of the bug searching is org.apache.cxf.jaxrs.ext.MessageContextImpl.convertToAttachments(Object) method, which has at least these sub-bugs:&lt;br/&gt;
1) First attachment is handled other way than all subsequent ones -&amp;gt; All attachments must be handled in the same way.&lt;br/&gt;
2) AttachmentOutputInterceptor is created with some default Contetnt-Type, which is &quot;application/octet-stream&quot; -&amp;gt; The type must be &quot;multipart/related&quot; (or other multipart).&lt;br/&gt;
3) Content-Type of outMessage is changed to the first attachment&apos;s Content-Type and then new type is used at least in org.apache.cxf.attachment.AttachmentSerializer.writeProlog() method -&amp;gt; The same type must be used.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Any&lt;/p&gt;</environment>
        <key id="12558414">CXF-4348</key>
            <summary>Content-Type is broken in multipart serialization</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="sergey_beryozkin">Sergey Beryozkin</assignee>
                                    <reporter username="buzzeri">Ivan Bondarenko</reporter>
                        <labels>
                            <label>bug</label>
                            <label>multipart</label>
                            <label>serialization</label>
                    </labels>
                <created>Tue, 29 May 2012 11:24:14 +0000</created>
                <updated>Thu, 1 Nov 2012 10:48:32 +0000</updated>
                            <resolved>Wed, 31 Oct 2012 17:57:40 +0000</resolved>
                                                    <fixVersion>2.5.5</fixVersion>
                    <fixVersion>2.6.2</fixVersion>
                    <fixVersion>2.7</fixVersion>
                                    <component>JAX-RS</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13284757" author="sergey_beryozkin" created="Tue, 29 May 2012 12:24:09 +0000"  >&lt;p&gt;Please type the code which is used to post these attachments &lt;/p&gt;</comment>
                            <comment id="13284772" author="buzzeri" created="Tue, 29 May 2012 12:50:47 +0000"  >&lt;p&gt;I cannot type the exact code, because DataSource objects are constructed in a complicated internal way, but pseudo-code looks like this:&lt;/p&gt;

&lt;p&gt;@POST&lt;br/&gt;
@Path(&quot;&quot;)&lt;br/&gt;
@Consumes(&quot;multipart/*&quot;)&lt;br/&gt;
@Produces(&quot;multipart/*&quot;)&lt;br/&gt;
public MultipartBody translateDocumentPost() {&lt;br/&gt;
	List&amp;lt;Attachment&amp;gt; retAttachments = new LinkedList&amp;lt;Attachment&amp;gt;();&lt;br/&gt;
	MultivaluedMap&amp;lt;String, String&amp;gt; headers;&lt;br/&gt;
	headers = new MetadataMap&amp;lt;String, String&amp;gt;(false, true);&lt;br/&gt;
	headers.putSingle(&quot;Content-Disposition&quot;, &quot;attachment; filename=filename1.doc&quot;);&lt;br/&gt;
	retAttachments.add(new Attachment(&quot;Attachment_id1&quot;, new FileDataSource(&quot;d:/filename1.doc&quot;, &quot;application/msword&quot;), headers));&lt;/p&gt;

&lt;p&gt;	headers = new MetadataMap&amp;lt;String, String&amp;gt;(false, true);&lt;br/&gt;
	headers.putSingle(&quot;Content-Disposition&quot;, &quot;attachment; filename=filename2.xls&quot;);&lt;br/&gt;
	retAttachments.add(new Attachment(&quot;Attachment_id2&quot;, new FileDataSource(&quot;d:/filename2.xls&quot;, &quot;application/vnd.ms-excel&quot;), headers));&lt;/p&gt;

&lt;p&gt;	return new MultipartBody(retAttachments, true);&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;The code&lt;br/&gt;
new FileDataSource(&quot;d:/filename1.doc&quot;, &quot;application/msword&quot;)&lt;br/&gt;
you can consider as following:&lt;br/&gt;
a) getInputStream() = the file&apos;s content&lt;br/&gt;
b) getName() = &quot;filename1.doc&quot;&lt;br/&gt;
c) getContentType() = &quot;application/msword&quot;&lt;/p&gt;</comment>
                            <comment id="13284798" author="sergey_beryozkin" created="Tue, 29 May 2012 13:18:08 +0000"  >&lt;p&gt;I suspect it&apos;s a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-3479&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CXF-3479&lt;/a&gt;. Sending multiple attachments from the client code works fine, but I guess there could be some issues when writing the multiple attachments from the server side, I&apos;ll check&lt;/p&gt;</comment>
                            <comment id="13285795" author="sergey_beryozkin" created="Wed, 30 May 2012 16:29:21 +0000"  >&lt;p&gt;Ivan,&lt;/p&gt;

&lt;p&gt;&amp;gt; 2) AttachmentOutputInterceptor is created with some default Content-Type, which is &quot;application/octet-stream&quot; -&amp;gt; The type must be &quot;multipart/related&quot; (or other multipart).&lt;/p&gt;

&lt;p&gt;note that the method in your code @Produces(&quot;multipart/*&quot;). I can reproduce that the response message&apos;s Content-Type is set to &quot;application/octet-stream&quot;, but only if no &quot;Accept: multipart-related&quot; exists. If I update the client to set &quot;Accept: multipart-related&quot;, then the message Content-Type is set correctly to multipart-related, with other parameters like start-info, etc, included.&lt;/p&gt;

&lt;p&gt;Can you confirm that you have a specific multipart media type listed in Accept ?&lt;/p&gt;

&lt;p&gt;I can confirm that the Content-Type of the root part only is broken for outbound attachments. Will be fixing it&lt;/p&gt;

</comment>
                            <comment id="13286486" author="buzzeri" created="Thu, 31 May 2012 11:29:04 +0000"  >&lt;p&gt;I cannot check &quot;application/octet-stream&quot; right now, will do it a bit later.&lt;br/&gt;
But what spec reflects this in global Content-Type?: type=&quot;application/msword&quot;; boundary=&quot;uuid:&lt;/p&gt;
{UUID}
&lt;p&gt;&quot;; start=&quot;&amp;lt;Attachment_id1&amp;gt;&quot;; start-info=&quot;application/msword&quot;&lt;br/&gt;
As I know the first part should have no impact on the whole content.&lt;/p&gt;</comment>
                            <comment id="13286490" author="sergey_beryozkin" created="Thu, 31 May 2012 11:38:14 +0000"  >&lt;p&gt;just add LoggingFeature or LoggingInInterceptor to see the actual Accept.&lt;/p&gt;

&lt;p&gt;re: type=&quot;application/msword&quot;; boundary=&quot;uuid:&lt;/p&gt;
{UUID}
&lt;p&gt;&quot;; start=&quot;&amp;lt;Attachment_id1&amp;gt;&quot;; start-info=&quot;application/msword&quot;&lt;/p&gt;

&lt;p&gt;this is a bit broken, it should only occur for XOP payloads - will be fixing that. However it should not affect the consumers expecting no XOP, those are just media type parameters and thus can be safely ignored&lt;/p&gt;</comment>
                            <comment id="13286543" author="sergey_beryozkin" created="Thu, 31 May 2012 12:55:47 +0000"  >&lt;p&gt;The fix for the root part&apos;s Content-Type is on the trunk, 2.5.x &lt;/p&gt;</comment>
                            <comment id="13404004" author="sergey_beryozkin" created="Fri, 29 Jun 2012 16:27:22 +0000"  >&lt;p&gt;Optional start-info parameter is also dropped for simple multipart/related payloads (excluding XOP/MTOP), multipart/mixed, multipart/form-data will only have a boundary parameter&lt;/p&gt;</comment>
                            <comment id="13487989" author="buzzeri" created="Wed, 31 Oct 2012 17:27:48 +0000"  >&lt;p&gt;We haven&apos;t used this feature for some time, so I couldn&apos;t do a testing. Looks like global Content-Type is still broken:&lt;br/&gt;
Content-Type: multipart/related; type=&quot;application/msword&quot;; boundary=&quot;uuid:&lt;/p&gt;
{UUID}
&lt;p&gt;&quot;; start=&quot;&amp;lt;Attachment_id1&amp;gt;&quot;; start-info=&quot;application/msword&quot;&lt;br/&gt;
The necessity of &apos;type&apos;, &apos;start&apos; and &apos;start-info&apos; params in not described in spec. At least it is traffic overloading.&lt;/p&gt;</comment>
                            <comment id="13488003" author="sergey_beryozkin" created="Wed, 31 Oct 2012 17:43:54 +0000"  >&lt;p&gt;Are you reopening it because you think those parameters which are accepted for multipart/related overload the traffic ?  &lt;/p&gt;</comment>
                            <comment id="13488009" author="buzzeri" created="Wed, 31 Oct 2012 17:50:18 +0000"  >&lt;p&gt;Not only overload, they just shouldn&apos;t be there. But this part of bug has less priority than the fixed part.&lt;/p&gt;</comment>
                            <comment id="13488015" author="sergey_beryozkin" created="Wed, 31 Oct 2012 17:56:52 +0000"  >&lt;p&gt;Well, &lt;a href=&quot;http://tools.ietf.org/html/rfc2387&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://tools.ietf.org/html/rfc2387&lt;/a&gt; states that &apos;type&apos; is required, two other parameters are optional. &lt;/p&gt;

&lt;p&gt;Therefore I&apos;m going to close this issue. Please do not hesitate to move this discussion to CXF Dev list if you do not agree. Thank you &lt;/p&gt;</comment>
                            <comment id="13488018" author="sergey_beryozkin" created="Wed, 31 Oct 2012 17:57:40 +0000"  >&lt;p&gt;Fixed earlier - Not a problem related to the latest reopening of this issue&lt;/p&gt;</comment>
                            <comment id="13488120" author="sergey_beryozkin" created="Wed, 31 Oct 2012 19:15:37 +0000"  >&lt;p&gt;Ivan, I&apos;m adding one more test. Optional parameters are not there for types like &quot;multipart/mixed&quot;, &quot;multipart/form-data&quot;. For &quot;multipart/related&quot; I&apos;m seeing:&lt;/p&gt;

&lt;p&gt;&quot;Content-Type: multipart/related; type=&quot;application/xml&quot;; boundary=&quot;uuid:cb4e262c-8fa7-4d2a-8744-2801c61680fd&quot;; start=&quot;&amp;lt;root.message@cxf.apache.org&amp;gt;&quot;&quot;.&lt;/p&gt;

&lt;p&gt;Note, the only extra parameter is &apos;start&apos;, which is clearly defined in RFC2387 and it is the ContentId of the root part. It is optional all right and I guess is redundant, but it fits OK for multipart/related. &quot;start-info&quot; is not included by default and will only be there for XOP payloads.&lt;/p&gt;

&lt;p&gt;Thus I do not think we have an issue to be honest. However, please feel free to open a new Minor issue to get even &quot;start&quot; not reported for &apos;simple&apos; multipart/related, I&apos;m open to optimizing it even further though I&apos;d consider it a minor issue.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="13488127" author="sergey_beryozkin" created="Wed, 31 Oct 2012 19:22:07 +0000"  >&lt;p&gt;FYI:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/viewvc?rev=1404308&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=1404308&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13488129" author="buzzeri" created="Wed, 31 Oct 2012 19:22:57 +0000"  >&lt;p&gt;I have created a thread here too (guess it is CXF Dev list): &lt;a href=&quot;http://cxf.547215.n5.nabble.com/Multipart-serialization-td5717660.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cxf.547215.n5.nabble.com/Multipart-serialization-td5717660.html&lt;/a&gt; So looks like the bug is more connected to non-&quot;related&quot; multiparts. Probably this should be another report?!&lt;/p&gt;</comment>
                            <comment id="13488144" author="sergey_beryozkin" created="Wed, 31 Oct 2012 19:35:01 +0000"  >&lt;p&gt;OK, thanks - I&apos;m not seeing it at the dev list - you may need to register too.&lt;/p&gt;

&lt;p&gt;FYI, the latest update has been committed to 2.5.x, 2.6.x, trunk. As I said, it is only multipart/related where I see 3 parameters, two of them are required (boundary, type) plus one optional parameter (&quot;start&quot;). For other multipart media types I expect only a single parameter (&quot;boundary&quot;). Can you test with the latest released CXFs ?  &lt;/p&gt;</comment>
                            <comment id="13488249" author="buzzeri" created="Wed, 31 Oct 2012 21:29:46 +0000"  >&lt;p&gt;I have tested on 2.4.10 version. Cannot switch upper than 2.4.x right now, but looks like multipart methods are nearly the same. Also probably &quot;multipart/mixed&quot; must be used as a default type, not &quot;multipart/related&quot;.&lt;/p&gt;</comment>
                            <comment id="13488606" author="sergey_beryozkin" created="Thu, 1 Nov 2012 10:48:32 +0000"  >&lt;p&gt;I&apos;ve just confirmed that AttachmentSerializer on 2.4.x has not been updated to get the optional parameters dropped. I think I did not update 2.4.x to avoid the possible regressions due to some sensitivity of the change, given 2.4.9 is now actually the last tag in the 2.4.x line. So unfortunately the optional parameters will be there indeed on 2.4.x. &lt;/p&gt;

&lt;p&gt;Please migrate to 2.5.x at least where only &quot;multipart/related&quot; will have an optional &quot;start&quot; parameter included (as confirmed by the tests). &lt;br/&gt;
Also, as I said I&apos;d consider updating the code to get &apos;start&apos; dropped for non-XOP &quot;multipart/related&quot;, RS endpoint bound payloads - please open a minor issue if you&apos;d like to get it optimized further, cheers   &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12558413">CXF-4347</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>244829</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 3 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i05u3b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31972</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>