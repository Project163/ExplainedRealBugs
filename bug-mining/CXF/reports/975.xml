<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:47:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-3558] JaxWsProxyFactoryBean.create is not thread-safe</title>
                <link>https://issues.apache.org/jira/browse/CXF-3558</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;While running &lt;tt&gt;JaxWsProxyFactoryBean.create&lt;/tt&gt; concurrently I encountered the following exception:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Caused by: java.util.ConcurrentModificationException
	at java.util.LinkedList$ListItr.checkForComodification(LinkedList.java:761)
	at java.util.LinkedList$ListItr.next(LinkedList.java:696)
	at org.apache.cxf.service.factory.AbstractServiceFactoryBean.sendEvent(AbstractServiceFactoryBean.java:71)
	at org.apache.cxf.service.factory.ReflectionServiceFactoryBean.create(ReflectionServiceFactoryBean.java:238)
	at org.apache.cxf.jaxws.support.JaxWsServiceFactoryBean.create(JaxWsServiceFactoryBean.java:202)
	at org.apache.cxf.frontend.AbstractWSDLBasedEndpointFactory.createEndpoint(AbstractWSDLBasedEndpointFactory.java:101)
	at org.apache.cxf.frontend.ClientFactoryBean.create(ClientFactoryBean.java:90)
	at org.apache.cxf.frontend.ClientProxyFactoryBean.create(ClientProxyFactoryBean.java:152)
	at org.apache.cxf.jaxws.JaxWsProxyFactoryBean.create(JaxWsProxyFactoryBean.java:142)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Although not documented &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, &lt;tt&gt;org.apache.cxf.service.factory.ReflectionServiceFactoryBean#create&lt;/tt&gt; called somewhere during endpoint creation is &lt;tt&gt;synchronized&lt;/tt&gt; which suggests whole &lt;tt&gt;create&lt;/tt&gt; is thread-safe, but apparently it&apos;s not.&lt;/p&gt;

&lt;p&gt;I managed to discover source of this problem. I captured two threads: one (&lt;tt&gt;pool-1-thread-4&lt;/tt&gt;) entered synchronized &lt;tt&gt;ReflectionServiceFactoryBean#create&lt;/tt&gt;, the second one (&lt;tt&gt;pool-1-thread-2&lt;/tt&gt;) didn&apos;t made there yet but instead it calls &lt;tt&gt;AbstractServiceFactoryBean.setBus&lt;/tt&gt; outside of the &lt;tt&gt;synchronized&lt;/tt&gt; block. This causes the &lt;tt&gt;org.apache.cxf.service.factory.AbstractServiceFactoryBean#listeners&lt;/tt&gt; to be updated, making the former thread being susceptible to &lt;tt&gt;ConcurrentModificationException&lt;/tt&gt;. Stack dumps attached.&lt;/p&gt;

&lt;p&gt;Please either fix concurrency issue (making &lt;tt&gt;listeners&lt;/tt&gt; instance of &lt;tt&gt;java.util.concurrent.CopyOnWriteArrayList&lt;/tt&gt; might not be enough though) or document that &lt;tt&gt;JaxWsProxyFactoryBean.create&lt;/tt&gt; is not thread-safe.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12508750">CXF-3558</key>
            <summary>JaxWsProxyFactoryBean.create is not thread-safe</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ffang">Freeman Yue Fang</assignee>
                                    <reporter username="nurkiewicz">Tomasz Nurkiewicz</reporter>
                        <labels>
                    </labels>
                <created>Mon, 30 May 2011 20:00:53 +0000</created>
                <updated>Mon, 8 Aug 2011 14:43:45 +0000</updated>
                            <resolved>Tue, 31 May 2011 09:59:34 +0000</resolved>
                                    <version>2.4</version>
                                    <fixVersion>2.4.1</fixVersion>
                    <fixVersion>2.3.5</fixVersion>
                                    <component>JAX-WS Runtime</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13041386" author="njiang" created="Tue, 31 May 2011 02:27:07 +0000"  >&lt;p&gt;You don&apos;t need to create the proxy per thread. CXF client proxy is thread safe &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13041391" author="ffang" created="Tue, 31 May 2011 02:55:13 +0000"  >&lt;p&gt;Hi Tomasz,&lt;/p&gt;

&lt;p&gt;As Willem mentioned here, the proxy itself is actually thread safe already, do you really need create multiple proxies per thread, I can&apos;t image a necessary scenario for it, could you please clarify your requirement?&lt;br/&gt;
Moreover, I don&apos;t think currently the way to create a proxy is thread safe by design, besides the create method, we also have lots of other variable for ClientProxyFactoryBean like username/password/properties/bus/features/databinding which can cause uncertain if you try to set those from different thread.&lt;/p&gt;

&lt;p&gt;So the correct way is create only one proxy and use it in different thread.&lt;/p&gt;

&lt;p&gt;Freeman&lt;/p&gt;</comment>
                            <comment id="13041458" author="nurkiewicz" created="Tue, 31 May 2011 06:30:57 +0000"  >&lt;p&gt;Thank you very much for your comment. I am perfectly aware client is thread-safe once created and this is the way I use it typically. But I started to play a bit with clustering/failover features in Apache CXF which state in their JavaDocs (&lt;tt&gt;LoadDistributorFeature&lt;/tt&gt; and &lt;tt&gt;FailoverTargetSelector&lt;/tt&gt;): &lt;em&gt;Note that this feature changes the conduit on the fly and thus makes the Client not thread safe.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;So my solution was to pool the clients and create as many clients as necessary using just one factory (username/password etc. won&apos;t change once configured). And this is where the problem manifests - if two threads simultaneously try to create two CXF clients (since they shouldn&apos;t share the same one due to the load-balancing/failover restrictions mentioned above). I wrote some small &lt;a href=&quot;http://nurkiewicz.blogspot.com/2011/05/enabling-load-balancing-and-failover-in.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;article&lt;/a&gt; about it.&lt;/p&gt;</comment>
                            <comment id="13041504" author="ffang" created="Tue, 31 May 2011 09:50:25 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;Thanks for your clarification.&lt;br/&gt;
I get your point, so if your factory won&apos;t change any properties once configured, we can synchronized ClientProxyFactoryBean create() method, as well as use ModCountCopyOnWriteArrayList for ListenerList, ensure that the proxy creation is thread safe.&lt;/p&gt;

&lt;p&gt;Freeman&lt;/p&gt;</comment>
                            <comment id="13041507" author="ffang" created="Tue, 31 May 2011 09:59:34 +0000"  >&lt;p&gt;commit fix&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?rev=1129592&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=1129592&amp;amp;view=rev&lt;/a&gt; for trunk&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?rev=1129594&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=1129594&amp;amp;view=rev&lt;/a&gt; for 2.3.x branch&lt;/p&gt;</comment>
                            <comment id="13042002" author="ffang" created="Wed, 1 Jun 2011 06:37:00 +0000"  >&lt;p&gt;Hi Tomasz,&lt;/p&gt;

&lt;p&gt;Btw, your blog about &quot;Enabling load balancing and failover in Apache CXF&quot; is really good, I&apos;ve added the link to cxf resources and articles list.&lt;/p&gt;

&lt;p&gt;Thanks&lt;br/&gt;
Freeman&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12480871" name="CXF-3558.txt" size="2665" author="nurkiewicz" created="Mon, 30 May 2011 20:01:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10062"><![CDATA[Moderate]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5891</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 26 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0b8y7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>63562</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>