<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:36:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-8324] ClassCastException at AttachmentUtil.setStreamedAttachmentProperties</title>
                <link>https://issues.apache.org/jira/browse/CXF-8324</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;I am currently creating a Webservice Client and have set the &lt;tt&gt;AttachmentDeserializer.ATTACHMENT_MEMORY_THRESHOLD&lt;/tt&gt; property as an integer. When sending a request the following exception occured.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: java.lang.ClassCastException: &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;java.lang.&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; cannot be &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; to &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; (java.lang.&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; and java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; are in module java.base of loader &lt;span class=&quot;code-quote&quot;&gt;&apos;bootstrap&apos;&lt;/span&gt;)
        at org.apache.cxf@3.3.2&lt;span class=&quot;code-comment&quot;&gt;//org.apache.cxf.attachment.AttachmentUtil.setStreamedAttachmentProperties(AttachmentUtil.java:178)
&lt;/span&gt;        at org.apache.cxf@3.3.2&lt;span class=&quot;code-comment&quot;&gt;//org.apache.cxf.attachment.AttachmentDeserializer.cache(AttachmentDeserializer.java:242)
&lt;/span&gt;        at org.apache.cxf@3.3.2&lt;span class=&quot;code-comment&quot;&gt;//org.apache.cxf.attachment.AttachmentDeserializer.cacheStreamedAttachments(AttachmentDeserializer.java:216)
&lt;/span&gt;        at org.apache.cxf@3.3.2&lt;span class=&quot;code-comment&quot;&gt;//org.apache.cxf.attachment.AttachmentDeserializer.hasNext(AttachmentDeserializer.java:329)
&lt;/span&gt;        at org.apache.cxf@3.3.2&lt;span class=&quot;code-comment&quot;&gt;//org.apache.cxf.attachment.LazyAttachmentCollection.hasNext(LazyAttachmentCollection.java:77)
&lt;/span&gt;        at org.apache.cxf@3.3.2&lt;span class=&quot;code-comment&quot;&gt;//org.apache.cxf.attachment.AttachmentDeserializer.markClosed(AttachmentDeserializer.java:313)
&lt;/span&gt;        at org.apache.cxf@3.3.2&lt;span class=&quot;code-comment&quot;&gt;//org.apache.cxf.attachment.DelegatingInputStream.close(DelegatingInputStream.java:52)
&lt;/span&gt;        at org.apache.cxf@3.3.2&lt;span class=&quot;code-comment&quot;&gt;//org.apache.cxf.transport.AbstractConduit.close(AbstractConduit.java:60)
&lt;/span&gt;        at org.apache.cxf.impl&lt;span class=&quot;code-comment&quot;&gt;//org.apache.cxf.transport.http.HTTPConduit.close(HTTPConduit.java:671)
&lt;/span&gt;        at org.apache.cxf@3.3.2&lt;span class=&quot;code-comment&quot;&gt;//org.apache.cxf.endpoint.AbstractConduitSelector.complete(AbstractConduitSelector.java:208)
&lt;/span&gt;        at org.apache.cxf@3.3.2&lt;span class=&quot;code-comment&quot;&gt;//org.apache.cxf.endpoint.ClientImpl.completeExchange(ClientImpl.java:553)
&lt;/span&gt;        at org.apache.cxf@3.3.2&lt;span class=&quot;code-comment&quot;&gt;//org.apache.cxf.endpoint.ClientImpl.processResult(ClientImpl.java:605)
&lt;/span&gt;        at org.apache.cxf@3.3.2&lt;span class=&quot;code-comment&quot;&gt;//org.apache.cxf.endpoint.ClientImpl.doInvoke(ClientImpl.java:540)
&lt;/span&gt;        at org.apache.cxf@3.3.2&lt;span class=&quot;code-comment&quot;&gt;//org.apache.cxf.endpoint.ClientImpl.invoke(ClientImpl.java:440)
&lt;/span&gt;        at org.apache.cxf@3.3.2&lt;span class=&quot;code-comment&quot;&gt;//org.apache.cxf.endpoint.ClientImpl.invoke(ClientImpl.java:355)
&lt;/span&gt;        at org.apache.cxf@3.3.2&lt;span class=&quot;code-comment&quot;&gt;//org.apache.cxf.endpoint.ClientImpl.invoke(ClientImpl.java:313)
&lt;/span&gt;        at org.apache.cxf.impl&lt;span class=&quot;code-comment&quot;&gt;//org.apache.cxf.frontend.ClientProxy.invokeSync(ClientProxy.java:96)
&lt;/span&gt;        at org.apache.cxf.impl&lt;span class=&quot;code-comment&quot;&gt;//org.apache.cxf.jaxws.JaxWsClientProxy.invoke(JaxWsClientProxy.java:140)
&lt;/span&gt;        ... 77 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Only after receiving this exception I realized (through reading the implementation) the only two allowed values for the property are Long and String.&lt;/p&gt;

&lt;p&gt;For me the current implementation is too optimistic and pesimistic at the same time. The check if the given value is a Long is too optimistic because the user could also provide an integer or even a short if the value he wants to set is small. And the assumtion that any non Long value is a String is overly optimistic and in the end leads to the shown Exception.&lt;/p&gt;

&lt;p&gt;I would propose to change the implementation to something like this (if there is no hard requirement that the user has to provide an Long or String)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (threshold &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Number&lt;/span&gt;) {
    bos.setThreshold(((&lt;span class=&quot;code-object&quot;&gt;Number&lt;/span&gt;)threshold).longValue());
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (threshold &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;) {
    bos.setThreshold(&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;.parseLong((&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;)threshold));
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
    &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; some descriptive exception
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The same change can also be used for the other 2 properties set in this method.&lt;br/&gt;
 Providing some information in the JavaDoc of the mentioned property about allowed values would also be helpful.&lt;/p&gt;</description>
                <environment>&lt;p&gt;CXF used within Wildfly 17&lt;/p&gt;

&lt;p&gt;Java 11&lt;/p&gt;</environment>
        <key id="13321732">CXF-8324</key>
            <summary>ClassCastException at AttachmentUtil.setStreamedAttachmentProperties</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="coheigea">Colm O hEigeartaigh</assignee>
                                    <reporter username="rschimpf">Robin Schimpf</reporter>
                        <labels>
                    </labels>
                <created>Mon, 10 Aug 2020 06:21:54 +0000</created>
                <updated>Wed, 22 Dec 2021 20:43:51 +0000</updated>
                            <resolved>Wed, 12 Aug 2020 09:31:30 +0000</resolved>
                                    <version>3.3.2</version>
                                    <fixVersion>3.4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17174204" author="coheigea" created="Mon, 10 Aug 2020 09:31:17 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;Yes that change makes sense. Can you submit a pull request for it?&lt;/p&gt;

&lt;p&gt;Colm.&lt;/p&gt;</comment>
                            <comment id="17174242" author="rschimpf" created="Mon, 10 Aug 2020 10:59:07 +0000"  >&lt;p&gt;Yes, I&apos;ll send a pull request&lt;/p&gt;</comment>
                            <comment id="17176205" author="coheigea" created="Wed, 12 Aug 2020 09:31:30 +0000"  >&lt;p&gt;Thanks for the patch!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 14 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0hlsg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>