<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:14:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-6297] JAX-RS BeanValidation feature fails with NPE in JAXRSBeanValidationOutInterceptor on sub-resource call</title>
                <link>https://issues.apache.org/jira/browse/CXF-6297</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;With &lt;tt&gt;JAXRSBeanValidationFeature&lt;/tt&gt; enabled CXF fails to process request to sub-resource with exception like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;23:58:16.049 [qtp457732796-28] WARN  o.a.cxf.phase.PhaseInterceptorChain - Interceptor &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; {http:&lt;span class=&quot;code-comment&quot;&gt;//example.com/}MainResource has thrown exception, unwinding now
&lt;/span&gt;java.lang.NullPointerException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
    at org.apache.cxf.jaxrs.validation.ValidationUtils.getResourceInstance(ValidationUtils.java:39) ~[cxf-rt-frontend-jaxrs-3.0.4.jar:3.0.4]
    at org.apache.cxf.jaxrs.validation.JAXRSBeanValidationOutInterceptor.getServiceObject(JAXRSBeanValidationOutInterceptor.java:44) ~[cxf-rt-frontend-jaxrs-3.0.4.jar:3.0.4]
    at org.apache.cxf.validation.AbstractValidationInterceptor.handleMessage(AbstractValidationInterceptor.java:60) ~[cxf-core-3.0.4.jar:3.0.4]
    at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:307) [cxf-core-3.0.4.jar:3.0.4]
    at org.apache.cxf.interceptor.OutgoingChainInterceptor.handleMessage(OutgoingChainInterceptor.java:83) [cxf-core-3.0.4.jar:3.0.4]
    at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:307) [cxf-core-3.0.4.jar:3.0.4]
    at org.apache.cxf.transport.ChainInitiationObserver.onMessage(ChainInitiationObserver.java:121) [cxf-core-3.0.4.jar:3.0.4]
    at org.apache.cxf.transport.http.AbstractHTTPDestination.invoke(AbstractHTTPDestination.java:251) [cxf-rt-transports-http-3.0.4.jar:3.0.4]
    at org.apache.cxf.transport.servlet.ServletController.invokeDestination(ServletController.java:234) [cxf-rt-transports-http-3.0.4.jar:3.0.4]
    at org.apache.cxf.transport.servlet.ServletController.invoke(ServletController.java:208) [cxf-rt-transports-http-3.0.4.jar:3.0.4]
    at org.apache.cxf.transport.servlet.ServletController.invoke(ServletController.java:160) [cxf-rt-transports-http-3.0.4.jar:3.0.4]
    at org.apache.cxf.transport.servlet.CXFNonSpringServlet.invoke(CXFNonSpringServlet.java:171) [cxf-rt-transports-http-3.0.4.jar:3.0.4]
    at org.apache.cxf.transport.servlet.AbstractHTTPServlet.handleRequest(AbstractHTTPServlet.java:293) [cxf-rt-transports-http-3.0.4.jar:3.0.4]
    at org.apache.cxf.transport.servlet.AbstractHTTPServlet.doGet(AbstractHTTPServlet.java:217) [cxf-rt-transports-http-3.0.4.jar:3.0.4]
    at javax.servlet.http.HttpServlet.service(HttpServlet.java:687) [javax.servlet-api-3.1.0.jar:3.1.0]
    at org.apache.cxf.transport.servlet.AbstractHTTPServlet.service(AbstractHTTPServlet.java:268) [cxf-rt-transports-http-3.0.4.jar:3.0.4]
    ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The example resource code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Path(&lt;span class=&quot;code-quote&quot;&gt;&quot;/main&quot;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; MainResource {
    @Path(&lt;span class=&quot;code-quote&quot;&gt;&quot;/sub/{id}&quot;&lt;/span&gt;)
    SubResource subResource(@PathParam @Size(min=3, max=255) &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; id);
}

-----

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; SubResource {
    @GET
    @Path(&lt;span class=&quot;code-quote&quot;&gt;&quot;/items&quot;&lt;/span&gt;)
    List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; items();
}

GET http:&lt;span class=&quot;code-comment&quot;&gt;//example.com/main/sub/123/items&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;NPE happens at &lt;a href=&quot;https://github.com/apache/cxf/blob/c79696bfc1aee1d1204cbd592f6bc5c83c0d9dae/rt/frontend/jaxrs/src/main/java/org/apache/cxf/jaxrs/validation/ValidationUtils.java#L39&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ValidationUtils.java:39&lt;/a&gt;, since &lt;tt&gt;resourceProvider&lt;/tt&gt; retrieved on previous line is &lt;tt&gt;null&lt;/tt&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; getResourceInstance(Message message) {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; OperationResourceInfo ori = message.getExchange().get(OperationResourceInfo.class);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ori == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
        }
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ResourceProvider resourceProvider = ori.getClassResourceInfo().getResourceProvider();
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!resourceProvider.isSingleton()) {
            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; error = &lt;span class=&quot;code-quote&quot;&gt;&quot;Service object is not a singleton, use a custom invoker to validate&quot;&lt;/span&gt;;
            LOG.warning(error);
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; resourceProvider.getInstance(message);
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This happens only during invocation of &lt;tt&gt;JAXRSBeanValidationOutInterceptor&lt;/tt&gt; and only when calling sub-resources as in example above.&lt;/p&gt;

&lt;h3&gt;&lt;a name=&quot;PartialWorkaround&quot;&gt;&lt;/a&gt;Partial Workaround&lt;/h3&gt;

&lt;p&gt;The partial workaround is to enable in-interceptor only. But this won&apos;t work for people wishing to validate response entities as well.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12781694">CXF-6297</key>
            <summary>JAX-RS BeanValidation feature fails with NPE in JAXRSBeanValidationOutInterceptor on sub-resource call</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sergey_beryozkin">Sergey Beryozkin</assignee>
                                    <reporter username="kozlovda">Dmitry Kozlov</reporter>
                        <labels>
                    </labels>
                <created>Fri, 13 Mar 2015 01:33:21 +0000</created>
                <updated>Tue, 28 Apr 2015 15:15:11 +0000</updated>
                            <resolved>Wed, 18 Mar 2015 17:56:10 +0000</resolved>
                                    <version>3.0.4</version>
                                    <fixVersion>3.1</fixVersion>
                    <fixVersion>3.0.5</fixVersion>
                                    <component>JAX-RS</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14359798" author="kozlovda" created="Fri, 13 Mar 2015 02:11:12 +0000"  >&lt;p&gt;Similar exception report on stackoverflow: &lt;a href=&quot;http://stackoverflow.com/questions/27275698/apache-cxf-jax-rs-2-0-interceptors&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/27275698/apache-cxf-jax-rs-2-0-interceptors&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14378023" author="kozlovda" created="Tue, 24 Mar 2015 15:28:07 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sergey_beryozkin&quot; class=&quot;user-hover&quot; rel=&quot;sergey_beryozkin&quot;&gt;sergey_beryozkin&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Thank you very much! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I have a quick question though: I&apos;ve recently broken down my application into sub-resources to simplify maintenance, but have found that global request filters are now applied twice. With response filters applied once only.&lt;/p&gt;

&lt;p&gt;This introduces certain overhead. E.g. auth filter is now applied twice (basically it&apos;s applied against each (sub-)resource call in request).&lt;/p&gt;

&lt;p&gt;I&apos;m not sure if this is a bug, since it seems legit for &lt;tt&gt;Order&lt;/tt&gt; case as described here: &lt;a href=&quot;http://cxf.apache.org/docs/jax-rs-basics.html#JAX-RSBasics-Sub-resourcelocators&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cxf.apache.org/docs/jax-rs-basics.html#JAX-RSBasics-Sub-resourcelocators&lt;/a&gt;. But it would definitely be nice to have some way to handle it in the way that allows to avoid double authentication.&lt;/p&gt;

&lt;p&gt;I might be missing something. Your advice appreciated. Thanks!&lt;/p&gt;</comment>
                            <comment id="14379734" author="sergey_beryozkin" created="Wed, 25 Mar 2015 11:34:34 +0000"  >&lt;p&gt;One option is to have such filters annotated with @PreMatching:&lt;br/&gt;
&lt;a href=&quot;https://jax-rs-spec.java.net/nonav/2.0-rev-a/apidocs/javax/ws/rs/container/PreMatching.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jax-rs-spec.java.net/nonav/2.0-rev-a/apidocs/javax/ws/rs/container/PreMatching.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Authentication filters would be good candidates for having this annotation.&lt;br/&gt;
If it is a non-prematching filter then one option is to introduce NameBinding or may be control the binding from DynamicFeature.&lt;/p&gt;

&lt;p&gt;If it is just a global matching filter then it will indeed be invoked per every method starting from a root...&lt;br/&gt;
I&apos;ll need to double check it actually...&lt;/p&gt;



</comment>
                            <comment id="14379786" author="sergey_beryozkin" created="Wed, 25 Mar 2015 12:25:10 +0000"  >&lt;p&gt;I&apos;m presuming that yes, global post-match ContainerRequestFilter is applied twice if we have a single subresource locator and the final resource method. ContainerRequestFilter documentation is not clear about it but it does say that NameBinding-annotated filters would be applied to resource or subresource methods should they also have NameBinding and in case of a global post match filter we effectively have a wild-card NameBinding...&lt;/p&gt;

&lt;p&gt;I&apos;m still going to investigate it a bit more - can you do the same on your end ? Example, check how Jersey applies a post-match global ContainerRequestFilter when sub-resources are used ?&lt;/p&gt;

&lt;p&gt;Cheers, Sergey&lt;/p&gt;</comment>
                            <comment id="14379808" author="kozlovda" created="Wed, 25 Mar 2015 12:47:43 +0000"  >&lt;p&gt;Thanks Sergey,&lt;/p&gt;

&lt;p&gt;I&apos;ll take a look. My quick recent experiment is that Jersey reverses this logic &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; It applies request filter once, while response - twice ))) Anyways, I&apos;ll need to double check. But to this moment my personal preference is clearly CXF.&lt;/p&gt;

&lt;p&gt;As for Pre-matching - might be a good idea (actually the best - thought about it as well), the only concern is to make sure it&apos;s DDoS proof for the case when attacker generates path randomly. Frankly speaking I&apos;d prefer to bother auth server only in case when there is something to call (i.e. when match detected), otherwise 405 should be enough.&lt;/p&gt;

&lt;p&gt;As for the rest of cases granular use of NameBinding might be a way.&lt;/p&gt;

&lt;p&gt;Anyways, the spec leaves the impression that sub-resources case didn&apos;t get too much of attention. IMHO &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Thank you!&lt;/p&gt;</comment>
                            <comment id="14379810" author="kozlovda" created="Wed, 25 Mar 2015 12:49:56 +0000"  >&lt;p&gt;Not sure about the process, but just in case: closing as fixed as reporter.&lt;/p&gt;</comment>
                            <comment id="14379824" author="sergey_beryozkin" created="Wed, 25 Mar 2015 12:59:40 +0000"  >&lt;p&gt;Hi, this is actually pretty interesting. I agree there&apos;s a bit of inconsistency there...Invoking a global response filter twice given that a response from a subresourceMethod-resourceMethod chain is effectively a stack unwinding after the subresource method returns is unusual. I&apos;ve asked the question on the JAX-RS list, let me update it with your findings.&lt;/p&gt;

&lt;p&gt;Thanks, Sergey &lt;/p&gt;</comment>
                            <comment id="14379869" author="kozlovda" created="Wed, 25 Mar 2015 13:38:06 +0000"  >&lt;p&gt;Hi, decided to double check to avoid confusion.&lt;/p&gt;

&lt;p&gt;So, for sub-resource access the global filter (no name binding, just &lt;tt&gt;@Provider&lt;/tt&gt;) is applied once each way. Confirmed.&lt;/p&gt;

&lt;p&gt;While double-response filter application seem to be a different Jersey related bug - it happens when something fails inside Jersey response processing logic, when response has been already successfully returned by business logic.&lt;/p&gt;

&lt;p&gt;I&apos;ll probably attach code for this. But approach is simple - created resource with sub-resource and added one global filter logging its invocation:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;GET /myapp/groups/123/items/456 HTTP/1.1

06:31:14.049 [grizzly-nio-kernel(4) SelectorRunner] DEBUG o.g.g.nio.transport.TCPNIOTransport - TCPNIOConnection (TCPNIOConnection{localSocketAddress={/127.0.0.1:8080}, peerSocketAddress={/127.0.0.1:63678}}) (allocated) read 567 bytes
06:31:14.050 [grizzly-http-server-3] INFO  r.k.e.j.t.w.f.GlobalContainerFilter - Invoking request filter
06:31:14.051 [grizzly-http-server-3] INFO  r.k.e.j.t.w.f.GlobalContainerFilter - Invoking response filter
06:31:14.052 [grizzly-http-server-3] DEBUG o.g.g.nio.transport.TCPNIOTransport - TCPNIOConnection (TCPNIOConnection{localSocketAddress={/127.0.0.1:8080}, peerSocketAddress={/127.0.0.1:63678}}) (composite) write 177 bytes
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14379921" author="sergey_beryozkin" created="Wed, 25 Mar 2015 14:26:56 +0000"  >&lt;p&gt;The double filtering in case of the error response is expected, first the actual response is filtered and then the mapped exception response is filtered - this is correct - CXF should do the same.&lt;/p&gt;

&lt;p&gt;So the only difference then is that CXF calls a global request filter twice in a subresource case. Probably should be 1, but can you give me a favour and try add a NameBinding (ex, @Logged as in the JAX-RS docs) and apply it to both a subresource locator and the final resource method. How many times will you see Jersey invoking the filter in this case ?&lt;/p&gt;

&lt;p&gt;Thanks, Sergey&lt;/p&gt;</comment>
                            <comment id="14380032" author="kozlovda" created="Wed, 25 Mar 2015 15:14:13 +0000"  >&lt;p&gt;Hmm... I tried and results are surprising... and differ from CXF.&lt;/p&gt;

&lt;p&gt;Basically, I&apos;ve created 4 invocation-logging filters bound with the following:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;tt&gt;@TopResource&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;@TopResourceMethod&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;@SubResource&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;@SubResourceMethod&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;And applied them accordingly.&lt;/p&gt;

&lt;p&gt;The surprising part is that result is counter-intuitive:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;On access to top-resource method I get:
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;08:01:07.454 [grizzly-http-server-5] INFO  r.k.e.j.t.w.f.SubResourceMethodFilter - Invoking request filter: [teams/123]
08:01:07.454 [grizzly-http-server-5] INFO  r.k.e.j.t.w.filter.SubResourceFilter - Invoking request filter: [teams/123]
08:01:07.454 [grizzly-http-server-5] INFO  r.k.e.j.t.w.filter.TopResourceFilter - Invoking request filter: [teams/123]
08:01:07.454 [grizzly-http-server-5] INFO  r.k.e.j.t.w.f.TopResourceMethodFilter - Invoking request filter: [teams/123]
08:01:07.454 [grizzly-http-server-5] INFO  r.k.e.j.t.web.filter.GlobalFilter - Invoking request filter: [teams/123]
08:01:07.455 [grizzly-http-server-5] INFO  r.k.e.j.t.web.filter.GlobalFilter - Invoking response filter: [teams/123]
08:01:07.455 [grizzly-http-server-5] INFO  r.k.e.j.t.w.f.TopResourceMethodFilter - Invoking response filter: [teams/123]
08:01:07.455 [grizzly-http-server-5] INFO  r.k.e.j.t.w.filter.SubResourceFilter - Invoking response filter: [teams/123]
08:01:07.455 [grizzly-http-server-5] INFO  r.k.e.j.t.w.f.SubResourceMethodFilter - Invoking response filter: [teams/123]
08:01:07.455 [grizzly-http-server-5] INFO  r.k.e.j.t.w.filter.TopResourceFilter - Invoking response filter: [teams/123]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I.e. all of them are enacted.&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;while on access to sub-resource method I get only:
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;08:08:39.358 [grizzly-http-server-6] INFO  r.k.e.j.t.web.filter.GlobalFilter - Invoking request filter: [teams/123/members/456]
08:08:39.359 [grizzly-http-server-6] INFO  r.k.e.j.t.web.filter.GlobalFilter - Invoking response filter: [teams/123/members/456]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Resource definitions now look like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@TopResource
@Path(&lt;span class=&quot;code-quote&quot;&gt;&quot;/teams&quot;&lt;/span&gt;)
@Produces(MediaType.APPLICATION_JSON)
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; Teams
{
    ...

    @TopResourceMethod
    @GET
    @Path(&lt;span class=&quot;code-quote&quot;&gt;&quot;/{teamId}&quot;&lt;/span&gt;)
    TeamInfo get(@PathParam(&lt;span class=&quot;code-quote&quot;&gt;&quot;teamId&quot;&lt;/span&gt;) @Identifier &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; id);

    @Path(&lt;span class=&quot;code-quote&quot;&gt;&quot;/{teamId}/members&quot;&lt;/span&gt;)
    Members membersOf(@PathParam(&lt;span class=&quot;code-quote&quot;&gt;&quot;teamId&quot;&lt;/span&gt;) @Identifier &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; id);

    ...
}

----------------

@Produces(MediaType.APPLICATION_JSON)
@SubResource
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; Members
{
    ...

    @SubResourceMethod
    @GET
    @Path(&lt;span class=&quot;code-quote&quot;&gt;&quot;/{userId}&quot;&lt;/span&gt;)
    MemberInfo get(@PathParam(&lt;span class=&quot;code-quote&quot;&gt;&quot;userId&quot;&lt;/span&gt;) @Identifier &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; userId);

    ...
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14380036" author="kozlovda" created="Wed, 25 Mar 2015 15:17:58 +0000"  >&lt;p&gt;It may have something to do with the way Jersey resolves annotations. It gets really confused when annotations are defined in resource interfaces rather than classes.&lt;/p&gt;

&lt;p&gt;And above (global filter to be applied only once) might be the side-effect of the same.&lt;/p&gt;</comment>
                            <comment id="14380186" author="sergey_beryozkin" created="Wed, 25 Mar 2015 16:38:10 +0000"  >&lt;p&gt;Yes, invoking subresource-bound filters while invoking the top resource method does not make sense. Can you simplify it and have a concrete TopResource which returns a concrete Subresource and have only two name bindings, something like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Path(&lt;span class=&quot;code-quote&quot;&gt;&quot;rs&quot;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TopResource {
   @SubResource
   @Path(&lt;span class=&quot;code-quote&quot;&gt;&quot;sub&quot;&lt;/span&gt;)
   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; SubResource sub() {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SubResource();
   }
} 

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;SubResource {
   @SubResource 
   @Path(&lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;)
   @GET
   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; get() {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;Hello&quot;&lt;/span&gt;;
   }
} 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note a single @SubResource name binding only, and have a filter with this binding too.&lt;/p&gt;

&lt;p&gt;FYI, Marek has kindly confirmed Jersey does invoke a global filter only once in the above case so I will fix it (it should not be invoked for a subresource locator in CXF).&lt;/p&gt;

&lt;p&gt;But it appears that a name bound filter is invoked multiple times, can you please retry with the above example ? Is it invoked twice or once ? I&apos;m expecting it to be invoked twice. &lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;
</comment>
                            <comment id="14380209" author="kozlovda" created="Wed, 25 Mar 2015 16:49:02 +0000"  >&lt;p&gt;Ok, will do. Meanwhile, it&apos;s great to hear about global! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I&apos;d be happy to submit JIRA for this if needed.&lt;/p&gt;

&lt;p&gt;One note on global:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;with current implementation I get different context on filter invocations. Namely, &lt;tt&gt;uriInfo&lt;/tt&gt; and path params differ - first invocation gets top-level super-path and params only (e.g. &lt;tt&gt;/teams/123/members&lt;/tt&gt;), while second gets the rest (&lt;tt&gt;/teams/123/members/456&lt;/tt&gt;).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So obviously with this change the expectation would be to retain second call removing the first.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="14380216" author="sergey_beryozkin" created="Wed, 25 Mar 2015 16:54:31 +0000"  >&lt;p&gt;Yes, please do one last experiment, and create a JIRA issue&lt;/p&gt;

&lt;p&gt;thanks&lt;/p&gt;</comment>
                            <comment id="14380231" author="sergey_beryozkin" created="Wed, 25 Mar 2015 17:00:19 +0000"  >&lt;p&gt;Rereading the container filter documentation suggests that a subresource locator is not mentioned, subresource method is which most likely implies that even in the last example you will have a single filter call with Jersey which is probably correct.&lt;br/&gt;
Please try it anyway for your own test...&lt;br/&gt;
I&apos;ll probably create a spec documentation improvement issue. &lt;/p&gt;</comment>
                            <comment id="14386152" author="kozlovda" created="Mon, 30 Mar 2015 03:55:59 +0000"  >&lt;p&gt;I&apos;ve created &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-6321&quot; title=&quot;Make sure global JAX-RS filters are applied once per request even if made to sub-resource&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-6321&quot;&gt;&lt;del&gt;CXF-6321&lt;/del&gt;&lt;/a&gt; for filters.&lt;/p&gt;

&lt;p&gt;I&apos;ve also checked case above (and fixed name-binding on my side - I accidentally marked &lt;tt&gt;SubResource*Filter&lt;/tt&gt; filters with &lt;tt&gt;@TopResource&lt;/tt&gt; annotation). Now result is as expected:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;20:53:25.875 [grizzly-http-server-0] INFO  r.k.e.j.t.w.filter.SubResourceFilter - Invoking request filter: [rs/sub/test]
20:53:25.876 [grizzly-http-server-0] INFO  r.k.e.j.t.web.filter.GlobalFilter - Invoking request filter: [rs/sub/test]
20:53:25.881 [grizzly-http-server-0] INFO  r.k.e.j.t.web.filter.GlobalFilter - Invoking response filter: [rs/sub/test]
20:53:25.881 [grizzly-http-server-0] INFO  r.k.e.j.t.w.filter.SubResourceFilter - Invoking response filter: [rs/sub/test]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14386154" author="kozlovda" created="Mon, 30 Mar 2015 04:01:59 +0000"  >&lt;p&gt;Now with the fix the log looks as follows (for my &lt;tt&gt;Teams&lt;/tt&gt; and &lt;tt&gt;Members&lt;/tt&gt; resource definitions above):&lt;/p&gt;

&lt;p&gt;For root-resource method call (note, I didn&apos;t apply any priorities to these filters):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;20:56:50.320 [grizzly-http-server-2] INFO  r.k.e.j.t.w.f.TopResourceMethodFilter - Invoking request filter: [teams/123]
20:56:50.320 [grizzly-http-server-2] INFO  r.k.e.j.t.w.filter.TopResourceFilter - Invoking request filter: [teams/123]
20:56:50.320 [grizzly-http-server-2] INFO  r.k.e.j.t.web.filter.GlobalFilter - Invoking request filter: [teams/123]
20:56:50.321 [grizzly-http-server-2] INFO  r.k.e.j.t.web.filter.GlobalFilter - Invoking response filter: [teams/123]
20:56:50.321 [grizzly-http-server-2] INFO  r.k.e.j.t.w.f.TopResourceMethodFilter - Invoking response filter: [teams/123]
20:56:50.321 [grizzly-http-server-2] INFO  r.k.e.j.t.w.filter.TopResourceFilter - Invoking response filter: [teams/123]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For sub-resource method:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;20:59:21.019 [grizzly-http-server-3] INFO  r.k.e.j.t.w.f.SubResourceMethodFilter - Invoking request filter: [teams/123/members/456]
20:59:21.020 [grizzly-http-server-3] INFO  r.k.e.j.t.web.filter.GlobalFilter - Invoking request filter: [teams/123/members/456]
20:59:21.020 [grizzly-http-server-3] INFO  r.k.e.j.t.web.filter.GlobalFilter - Invoking response filter: [teams/123/members/456]
20:59:21.020 [grizzly-http-server-3] INFO  r.k.e.j.t.w.f.SubResourceMethodFilter - Invoking response filter: [teams/123/members/456]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I.e. &lt;tt&gt;@TopResource&lt;/tt&gt;-marked filter does not get applied to any of sub-resource methods - seems legit.&lt;br/&gt;
But &lt;tt&gt;@SubResource&lt;/tt&gt;-marked filter does not get applied too - seems strange.&lt;/p&gt;

&lt;p&gt;Tested with Jersey 2.17.&lt;/p&gt;</comment>
                            <comment id="14389639" author="kozlovda" created="Tue, 31 Mar 2015 23:17:56 +0000"  >&lt;p&gt;Hi Sergey (&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sergey_beryozkin&quot; class=&quot;user-hover&quot; rel=&quot;sergey_beryozkin&quot;&gt;sergey_beryozkin&lt;/a&gt;),&lt;/p&gt;

&lt;p&gt;I&apos;ve just figured out that my sub-resource validation constraints-annotated methods don&apos;t get processed.&lt;br/&gt;
I.e. &lt;tt&gt;JAXRSBeanValidationInInterceptor&lt;/tt&gt; is getting applied only once against top-resource method.&lt;/p&gt;

&lt;p&gt;This renders validation broken when using sub-resources. I guess I&apos;ll have to drawback to one bulk top-only resource solution for now, but it would be nice to fix behavior so that sub-resources would proof usable in future &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ll create a separate issue for this one.&lt;/p&gt;</comment>
                            <comment id="14390415" author="sergey_beryozkin" created="Wed, 1 Apr 2015 11:29:16 +0000"  >&lt;p&gt;This is not a bug - JAXRSBeanValidationInvoker can take care of it.&lt;/p&gt;

&lt;p&gt;Note JAXRSBeanValidationInInterceptor is also a ContainerRequestFilter - so you can register it as a JAX-RS provider, but ironically, given that post-match request filters can not be applied to the locators it can not be used to validate the locators... So registering a custom invoker is the only way to go to get the subresource locators validated too&lt;/p&gt;</comment>
                            <comment id="14390558" author="kozlovda" created="Wed, 1 Apr 2015 13:44:08 +0000"  >&lt;p&gt;Cool, thanks!&lt;/p&gt;

&lt;p&gt;Tried invoker, and it does work. So no need to say good bye to sub-resources.&lt;br/&gt;
I&apos;ve just thought it might appear to be a good idea to put sub-resource related topics in one place. Many people would really appreciate &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="14390705" author="sergey_beryozkin" created="Wed, 1 Apr 2015 14:51:02 +0000"  >&lt;p&gt;I&apos;ve just got a confirmation from Santiago that JAX-RS BV is not expected to be effective with subresource locators - CXF does support it with the invoker but it won&apos;t work with RI for example. I think it is a spec limitation to be honest - may be something will be improved in this area...&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="14396046" author="kozlovda" created="Sun, 5 Apr 2015 03:20:21 +0000"  >&lt;p&gt;Hi Sergey,&lt;/p&gt;

&lt;p&gt;I&apos;ve created bug/improvement item - &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-6331&quot; title=&quot;Wrap exceptions in JAXRSBeanValidationInvoker into Fault so that these exceptions are exposed to ExceptionMapper-s&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-6331&quot;&gt;&lt;del&gt;CXF-6331&lt;/del&gt;&lt;/a&gt; - to wrap non-&lt;tt&gt;ConstraintValidationException&lt;/tt&gt; unchecked exceptions thrown within &lt;tt&gt;JAXRSBeanValidationInvoker.invoke(..)&lt;/tt&gt; into &lt;tt&gt;Fault&lt;/tt&gt; instances so that they could be exposed to &lt;tt&gt;javax.ws.rs.ext.ExceptionMapper&lt;/tt&gt; framework.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12781693">CXF-6296</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10062"><![CDATA[Moderate]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 33 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i26pz3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>