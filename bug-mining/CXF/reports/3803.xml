<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:41:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-9171] DelayedCachedOutputStreamCleaner thread accumulation after CVE-2025-23184 fix</title>
                <link>https://issues.apache.org/jira/browse/CXF-9171</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;After the CVE-2025-23184 fix (&lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7396&quot; title=&quot;CachedOutputStream doesn&amp;#39;t delete temp files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7396&quot;&gt;&lt;del&gt;CXF-7396&lt;/del&gt;&lt;/a&gt;), DelayedCachedOutputStreamCleaner timer threads can be problematic and can contribute to unwanted thread growth and possibly classloader leaks potentially to the point of thread OOMEs or metaspace OOMEs. &#160;This now creates a unique Timer and thread for every bus instance created just to handle a single 30 min default interval task even if there is no closeable yet registered so this seems excessive and a bus is a much more leaky object as a result. &#160;The created Timer thread will also inherit contextClassLoaders and that may then preserve some app classloader reference to possibly influence additional classloader leaks.&lt;/p&gt;

&lt;p&gt;For instance, in the context of WildFly/JBoss it maintains a WeakHashMap storing busses with a bus keyed off a classloader. &#160;But the bus can now maintain a strong reference to that classloader through the DelayedCachedOutputStreamCleaner TimerThread&apos;s contextClassLoader so this WeakHashMap can no longer self clean:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; Name &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;| Ref. Objects | Shallow Heap | Ref. Shallow Heap | Retained Heap
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
[5] &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.jboss.wsf.stack.cxf.client.configuration.JBossWSBusFactory @ 0x5d513a898 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;| &#160; &#160; &#160; &#160; &#160; &#160;1 | &#160; &#160; &#160; &#160; &#160; &#160;8 | &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;96 | &#160; &#160;24,503,336
&apos;- classLoaderBusses java.util.WeakHashMap @ 0x5f846cd30 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;| &#160; &#160; &#160; &#160; &#160; &#160;1 | &#160; &#160; &#160; &#160; &#160; 48 | &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;96 | &#160; &#160;24,503,328
&#160; &#160;&apos;- table java.util.WeakHashMap$Entry[32] @ 0x5d6af4dd0 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; | &#160; &#160; &#160; &#160; &#160; &#160;1 | &#160; &#160; &#160; &#160; &#160;144 | &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;96 | &#160; &#160;24,503,232
&#160; &#160; &#160; &apos;- [28] java.util.WeakHashMap$Entry @ 0x5d6af4e60 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; | &#160; &#160; &#160; &#160; &#160; &#160;1 | &#160; &#160; &#160; &#160; &#160; 40 | &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;96 | &#160; &#160; 3,793,016
&#160; &#160; &#160; &#160; &#160;&apos;- value org.apache.cxf.bus.extension.ExtensionManagerBus @ 0x5d6af4e88 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;| &#160; &#160; &#160; &#160; &#160; &#160;1 | &#160; &#160; &#160; &#160; &#160; 56 | &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;96 | &#160; &#160; 3,792,976
&#160; &#160; &#160; &#160; &#160; &#160; &apos;- extensions java.util.concurrent.ConcurrentHashMap @ 0x5d6af5080 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;| &#160; &#160; &#160; &#160; &#160; &#160;1 | &#160; &#160; &#160; &#160; &#160; 64 | &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;96 | &#160; &#160; &#160; &#160; 3,616
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&apos;- table java.util.concurrent.ConcurrentHashMap$Node[64] @ 0x5d6af50c0 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; | &#160; &#160; &#160; &#160; &#160; &#160;1 | &#160; &#160; &#160; &#160; &#160;272 | &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;96 | &#160; &#160; &#160; &#160; 3,552
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &apos;- [2] java.util.concurrent.ConcurrentHashMap$Node @ 0x5d6e93778 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;| &#160; &#160; &#160; &#160; &#160; &#160;1 | &#160; &#160; &#160; &#160; &#160; 32 | &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;96 | &#160; &#160; &#160; &#160; &#160; &#160;32
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&apos;- val org.apache.cxf.io.DelayedCachedOutputStreamCleaner @ 0x5d6e89398 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;| &#160; &#160; &#160; &#160; &#160; &#160;1 | &#160; &#160; &#160; &#160; &#160; 24 | &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;96 | &#160; &#160; &#160; &#160; &#160; 256
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &apos;- cleaner org.apache.cxf.io.DelayedCachedOutputStreamCleaner$DelayedCleanerImpl @ 0x5d6e893b0 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;| &#160; &#160; &#160; &#160; &#160; &#160;1 | &#160; &#160; &#160; &#160; &#160; 32 | &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;96 | &#160; &#160; &#160; &#160; &#160; 232
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&apos;- timer java.util.Timer @ 0x5d6e89498 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; | &#160; &#160; &#160; &#160; &#160; &#160;1 | &#160; &#160; &#160; &#160; &#160; 24 | &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;96 | &#160; &#160; &#160; &#160; &#160; 720
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &apos;- thread java.util.TimerThread @ 0x5cf230188 &#160;DelayedCachedOutputStreamCleaner &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; | &#160; &#160; &#160; &#160; &#160; &#160;1 | &#160; &#160; &#160; &#160; &#160;128 | &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;96 | &#160; &#160; &#160; &#160; &#160; 144
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&apos;- contextClassLoader org.jboss.ws.common.utils.DelegateClassLoader @ 0x5cf1e9b68 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;| &#160; &#160; &#160; &#160; &#160; &#160;1 | &#160; &#160; &#160; &#160; &#160; 72 | &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;96 | &#160; &#160; &#160; &#160; &#160; 560
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &apos;- parent, parent my.app.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt; @ 0x5cf1e8af0| &#160; &#160; &#160; &#160; &#160; &#160;1 | &#160; &#160; &#160; &#160; &#160; 96 | &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;96 | &#160; &#160;11,565,128 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;JBoss/Wildfly&lt;/p&gt;</environment>
        <key id="13632310">CXF-9171</key>
            <summary>DelayedCachedOutputStreamCleaner thread accumulation after CVE-2025-23184 fix</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="reta">Andriy Redko</assignee>
                                    <reporter username="aogburn">Aaron Ogburn</reporter>
                        <labels>
                    </labels>
                <created>Thu, 23 Oct 2025 14:03:29 +0000</created>
                <updated>Wed, 5 Nov 2025 20:58:54 +0000</updated>
                            <resolved>Sat, 1 Nov 2025 17:12:33 +0000</resolved>
                                    <version>4.1.0</version>
                    <version>3.5.10</version>
                    <version>3.6.5</version>
                    <version>4.0.6</version>
                                    <fixVersion>4.1.4</fixVersion>
                    <fixVersion>3.6.9</fixVersion>
                    <fixVersion>4.0.10</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="18032652" author="reta" created="Fri, 24 Oct 2025 02:13:30 +0000"  >&lt;p&gt;Thanks for the issue &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aogburn&quot; class=&quot;user-hover&quot; rel=&quot;aogburn&quot;&gt;aogburn&lt;/a&gt; ,&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&amp;gt; This&#160;now creates a unique Timer and thread for every bus instance created just to handle a single 30 min default interval task even if there is no closeable yet registered so this seems excessive and a bus is a much more leaky object as a result.&lt;/p&gt;

&lt;p&gt;The interval is configured per bus (each has own timeout), to your point - we could definitely create a timer lazy (upon first closeable arrival). Aside from that, it becomes more complicated to deal with many bus instances that have arbitrary timeouts.&lt;/p&gt;

&lt;p&gt;&amp;gt; For instance, in the context of WildFly/JBoss it maintains a WeakHashMap storing busses with a bus keyed off a classloader. &#160;But the bus can now maintain a strong reference to that classloader through the DelayedCachedOutputStreamCleaner TimerThread&apos;s contextClassLoader so this WeakHashMap can no longer self clean:&lt;/p&gt;

&lt;p&gt;The classloader issue seems to be more profound, DelayedCachedOutputStreamCleaner does not hold any bus references but TimerThread apparently captures ClassLoader fro context. I will try to look for possible solutions here.&#160;&lt;/p&gt;</comment>
                            <comment id="18032780" author="aogburn" created="Fri, 24 Oct 2025 14:35:08 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reta&quot; class=&quot;user-hover&quot; rel=&quot;reta&quot;&gt;reta&lt;/a&gt;.&#160; The created thread would by default inherit the contextClassLoader upon creation so that could be a point of improvement.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;But if we minimize the thread creation and more lazily schedule the timer tasks only when needed and cancel the timer tasks as possible if closeables are unregistered, then this also minimizes thread growth along with any classloader leaks from them.&#160; I attached a patch &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=opalka&quot; class=&quot;user-hover&quot; rel=&quot;opalka&quot;&gt;opalka&lt;/a&gt; and I worked towards for that and tested using a single static timer thread and this corrects any potential thread growth (keeping to the one shared static Timer thread) and associated context loader references.&lt;/p&gt;</comment>
                            <comment id="18033042" author="reta" created="Sun, 26 Oct 2025 16:11:14 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aogburn&quot; class=&quot;user-hover&quot; rel=&quot;aogburn&quot;&gt;aogburn&lt;/a&gt; , opened up &lt;a href=&quot;https://github.com/apache/cxf/pull/2684&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/2684&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;br/&gt;
The fix introduces 2 major improvements:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;delays the timer creation till at least one registration for cleanup happens&lt;/li&gt;
	&lt;li&gt;introduces a cleanup strategy with new SingleTimerDelayedCleaner implementation for applications that may create a large number of &lt;tt&gt;Bus&lt;/tt&gt; instances (based on the patch for the issue)&lt;/li&gt;
	&lt;li&gt;additional &lt;tt&gt;Bus&lt;/tt&gt; property to select the appropriate strategy&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The default strategy is lazy (with respect to timers now), but you could opt-in for&#160; another strategy (based on the patch submitted, thank you). Please note the original patch has issues implementing clean() and forceClean() (more specifically, drainTo will only drain expired entries for DelayedQueue). Thank you.&lt;/p&gt;</comment>
                            <comment id="18034765" author="reta" created="Sat, 1 Nov 2025 17:12:33 +0000"  >&lt;p&gt;The documentation has been updated &lt;a href=&quot;https://cwiki.apache.org/confluence/display/CXF20DOC/Securing+CXF+Services&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/display/CXF20DOC/Securing+CXF+Services&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13077689">CXF-7396</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13608736">CXF-9110</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13078946" name="CXF-9171.patch" size="4059" author="aogburn" created="Fri, 24 Oct 2025 14:26:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 week, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1y9xc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>