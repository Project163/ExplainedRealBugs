<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:19:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-6720] AbstractHTTPDestination#WrappedOutputStream.close() calls flush after close</title>
                <link>https://issues.apache.org/jira/browse/CXF-6720</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;Bug location: &lt;a href=&quot;https://github.com/apache/cxf/blob/master/rt/transports/http/src/main/java/org/apache/cxf/transport/http/AbstractHTTPDestination.java#L806&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/blob/master/rt/transports/http/src/main/java/org/apache/cxf/transport/http/AbstractHTTPDestination.java#L806&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ServletResponse.flushBuffer: &lt;a href=&quot;http://grepcode.com/file/repo1.maven.org/maven2/javax.servlet/javax.servlet-api/3.1.0/javax/servlet/ServletResponse.java#ServletResponse.flushBuffer%28%29&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://grepcode.com/file/repo1.maven.org/maven2/javax.servlet/javax.servlet-api/3.1.0/javax/servlet/ServletResponse.java#ServletResponse.flushBuffer%28%29&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Reading the javadoc of ServletResponse.flushBuffer, Closable and Flushable interfaces tells me that calling flushBuffer on a ServletResponse containing a  closed stream could give an IOException.&lt;/p&gt;

&lt;p&gt;We have had problems with this in Liberty Profile, while using CXF together with CXF.&lt;/p&gt;

&lt;p&gt;Background story:&lt;br/&gt;
1) Javamelody issue: &lt;a href=&quot;https://github.com/javamelody/javamelody/issues/411&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/javamelody/javamelody/issues/411&lt;/a&gt;&lt;br/&gt;
2) Old discussion: &lt;a href=&quot;https://groups.google.com/forum/#!topic/javamelody/kX31sRTFrHE/discussion&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://groups.google.com/forum/#!topic/javamelody/kX31sRTFrHE/discussion&lt;/a&gt;&lt;br/&gt;
3) IBM WasDev issue: &lt;a href=&quot;https://developer.ibm.com/answers/questions/244982/why-does-httpoutputstreamflush-when-stream-is-clos/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://developer.ibm.com/answers/questions/244982/why-does-httpoutputstreamflush-when-stream-is-clos/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To make a short recap:&lt;br/&gt;
1) Soap-call to the service&lt;br/&gt;
2) Cxf calls close()  -&amp;gt; OutputStream closes&lt;br/&gt;
3) Cxf calls flushBuffer which hits JavaMelody&apos;s ServletResponse-wrapper which again calls flush on the OutputStream&lt;br/&gt;
4) Ibm Liberty Profile throws an IOException telling the stream is closed.&lt;/p&gt;

&lt;p&gt;If we exclude JavaMelody:&lt;br/&gt;
3) Cxf calls flushBuffer which hits Liberty Profile&apos;s ServletResponse-wrapper which checks if the stream is already close and returns early.&lt;/p&gt;

&lt;p&gt;Update: Added crossreference to the IBM WasDev issue from the wrong one: &lt;a href=&quot;https://developer.ibm.com/answers/questions/244982/why-does-httpoutputstreamflush-when-stream-is-clos/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://developer.ibm.com/answers/questions/244982/why-does-httpoutputstreamflush-when-stream-is-clos/&lt;/a&gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;IBM Liberty Profile with CXF and JavaMelody, but this is mostly a discussion about Servlet/Flushable-spec and flush after close.&lt;/p&gt;</environment>
        <key id="12923308">CXF-6720</key>
            <summary>AbstractHTTPDestination#WrappedOutputStream.close() calls flush after close</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ay">Akitoshi Yoshida</assignee>
                                    <reporter username="jahestad@gmail.com">John Hestad</reporter>
                        <labels>
                            <label>Closable</label>
                            <label>Flushable</label>
                            <label>IBM_JAVA</label>
                            <label>JavaMelody</label>
                            <label>LibertyProfile</label>
                            <label>OutputStream</label>
                            <label>core</label>
                            <label>flush</label>
                            <label>flushBuffer</label>
                            <label>servlet-api</label>
                    </labels>
                <created>Sun, 20 Dec 2015 22:52:30 +0000</created>
                <updated>Fri, 14 Oct 2016 14:15:54 +0000</updated>
                            <resolved>Thu, 7 Jan 2016 12:31:14 +0000</resolved>
                                    <version>2.7.18</version>
                    <version>3.0.7</version>
                    <version>3.1.4</version>
                                    <fixVersion>3.1.5</fixVersion>
                    <fixVersion>3.0.8</fixVersion>
                    <fixVersion>3.2.0</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15066354" author="ay" created="Mon, 21 Dec 2015 11:39:17 +0000"  >&lt;p&gt;Memo&lt;br/&gt;
this close and flush was added with this&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=548549&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=548549&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I think we can remove the flushBuffer line as I suppose the close on the stream will be flushing the response buffer.&lt;br/&gt;
But I don&apos;t know if there is a case that is not the case and this flushBuffer needs to be called.&lt;br/&gt;
In that case, we might need to keep it with some condition/protection (e.g. checking !response.isCommitted() before or catching the unexpected exception).&lt;/p&gt;

&lt;p&gt;Dan, how do you think?&lt;/p&gt;</comment>
                            <comment id="15067041" author="dkulp" created="Mon, 21 Dec 2015 20:40:58 +0000"  >&lt;p&gt;Probably can remove it providing the tests pass.  Likely (based on commit log) is 8 year old code to work around something that was a bug in Jetty at the time and long since fixed. &lt;/p&gt;</comment>
                            <comment id="15067960" author="ay" created="Tue, 22 Dec 2015 11:03:55 +0000"  >&lt;p&gt;Hi Dan,&lt;br/&gt;
thanks for your comments. The current jetty tests are all running fine without the flushBuffer line.&lt;br/&gt;
So I&apos;ll remove the line.&lt;br/&gt;
regards, aki&lt;/p&gt;</comment>
                            <comment id="15085331" author="gisle.grimen@evry.com" created="Wed, 6 Jan 2016 09:50:36 +0000"  >&lt;p&gt;Any eta on when this will be fixed?&lt;/p&gt;</comment>
                            <comment id="15087294" author="ay" created="Thu, 7 Jan 2016 12:30:00 +0000"  >&lt;p&gt;i thought i have pushed the change a long time ago, but I seem to have forgotten to do it.&lt;br/&gt;
I just pushed the change to master, 3.1.x, 3.0.x.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 45 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2q50f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>