<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:40:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-2585] Already connected exception when using a proxy created with JAXRSClientFactory</title>
                <link>https://issues.apache.org/jira/browse/CXF-2585</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;I&apos;m trying to get a very simple Rest client working, but I always got this exception:&lt;/p&gt;

&lt;p&gt;java.lang.IllegalStateException: Already connected&lt;br/&gt;
	at java.net.HttpURLConnection.setFixedLengthStreamingMode(HttpURLConnection.java:100)&lt;br/&gt;
	at org.apache.cxf.transport.http.HTTPConduit$WrappedOutputStream.thresholdNotReached(HTTPConduit.java:1885)&lt;br/&gt;
	at org.apache.cxf.io.AbstractThresholdOutputStream.close(AbstractThresholdOutputStream.java:99)&lt;br/&gt;
	at org.apache.cxf.transport.http.HTTPConduit$WrappedOutputStream.close(HTTPConduit.java:1976)&lt;br/&gt;
	at org.apache.cxf.transport.AbstractConduit.close(AbstractConduit.java:66)&lt;br/&gt;
	at org.apache.cxf.transport.http.HTTPConduit.close(HTTPConduit.java:637)&lt;br/&gt;
	at org.apache.cxf.interceptor.MessageSenderInterceptor$MessageSenderEndingInterceptor.handleMessage(MessageSenderInterceptor.java:62)&lt;br/&gt;
	at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:236)&lt;br/&gt;
	at org.apache.cxf.jaxrs.client.ClientProxyImpl.doChainedInvocation(ClientProxyImpl.java:429)&lt;br/&gt;
	at org.apache.cxf.jaxrs.client.ClientProxyImpl.invoke(ClientProxyImpl.java:166)&lt;br/&gt;
	at $Proxy16.doSomething(Unknown Source)&lt;br/&gt;
	at com.francetelecom.resttest.RestTest.main(RestTest.java:27)&lt;/p&gt;

&lt;p&gt;Here is my jax-rs interface:&lt;/p&gt;

&lt;p&gt;@Path(&quot;/&quot;)&lt;br/&gt;
public interface RestWS {&lt;br/&gt;
    @POST&lt;br/&gt;
    @Path(&quot;/test&quot;)&lt;br/&gt;
    public String doSomething( @QueryParam(&quot;param&quot;) String paramName);&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;And here the way my client uses it:&lt;/p&gt;

&lt;p&gt;RestWS proxy = JAXRSClientFactory.create(&quot;http://localhost:8080/RestWSMock&quot;,RestWS.class);&lt;br/&gt;
proxy.doSomething(&quot;bob&quot;);&lt;/p&gt;

&lt;p&gt;I can not get it simpler. Any idea what&apos;s wrong ?&lt;br/&gt;
regards&lt;/p&gt;</description>
                <environment>&lt;p&gt;JDK 1.5.0.18&lt;/p&gt;</environment>
        <key id="12443552">CXF-2585</key>
            <summary>Already connected exception when using a proxy created with JAXRSClientFactory</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sergey_beryozkin">Sergey Beryozkin</assignee>
                                    <reporter username="sallegro">St&#233;phaneA</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Dec 2009 17:06:23 +0000</created>
                <updated>Mon, 1 Feb 2010 19:02:24 +0000</updated>
                            <resolved>Thu, 17 Dec 2009 18:33:49 +0000</resolved>
                                    <version>2.2.5</version>
                                    <fixVersion>2.2.6</fixVersion>
                    <fixVersion>2.3</fixVersion>
                                    <component>JAX-RS</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12791576" author="sergey_beryozkin" created="Wed, 16 Dec 2009 20:48:51 +0000"  >&lt;p&gt;it is a bug affecting a proxy based flavor only. &lt;br/&gt;
The problem is that a proxy does not indicate to the transport-level HttpConduit that an empty POST (with no request body) is coming which is something that never occurs with SOAP proxies.&lt;/p&gt;

&lt;p&gt;It will be fixed for soon to be released 2.2.6&lt;/p&gt;

&lt;p&gt;Couple of workarounds.&lt;br/&gt;
1. Use WebClient :&lt;/p&gt;

&lt;p&gt;Response r = WebClient.create(endpointAddress).query(&quot;param&quot;, &quot;bob&quot;).post(null);&lt;br/&gt;
String s = (String)r.getEntity();&lt;/p&gt;

&lt;p&gt;2. If you do prefer to use a proxy then for the empty POST be processed correctly, you can temporarily register a CXF out interceptor&lt;br/&gt;
with a proxy and set a &quot;org.apache.cxf.post.empty&quot; property on a message - let me know please if you&apos;d like to try this option and I will post a code for the interceptor&lt;/p&gt;

&lt;p&gt;thanks&lt;/p&gt;</comment>
                            <comment id="12791919" author="sallegro" created="Thu, 17 Dec 2009 13:28:19 +0000"  >&lt;p&gt;Thank&apos;s for your quick answer&lt;br/&gt;
I prefer the 2nd workaround, and I will enjoy some code for the interceptor.&lt;br/&gt;
(PS: in fact, I setup my proxy using Spring, not JAXRSClientFactory directly)&lt;/p&gt;</comment>
                            <comment id="12792002" author="sergey_beryozkin" created="Thu, 17 Dec 2009 16:33:23 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;here is the code for a custom interceptor :&lt;/p&gt;

&lt;p&gt;public class EmptyPostOutInterceptor extends AbstractPhaseInterceptor&amp;lt;Message&amp;gt; {&lt;/p&gt;

&lt;p&gt;        public EmptyPostOutInterceptor() &lt;/p&gt;
{
             super(Phase.PRE_MARSHAL);
            
        }
&lt;p&gt; &lt;/p&gt;

&lt;p&gt;        public void handleMessage(Message message) throws Fault {&lt;br/&gt;
            if (&quot;POST&quot;.equals(message.get(Message.HTTP_REQUEST_METHOD))) &lt;/p&gt;
{
                message.put(&quot;org.apache.cxf.post.empty&quot;, true);
            }
&lt;p&gt;        }&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;you can register it from Spring like this, assuming you use jaxrs:client :&lt;/p&gt;

&lt;p&gt;&amp;lt;jaxrs:client&amp;gt;&lt;br/&gt;
&amp;lt;jaxrs:outInterceptors&amp;gt;&lt;br/&gt;
   &amp;lt;bean class=&quot;org.custom.EmptyPostOutInterceptor&quot;/&amp;gt;&lt;br/&gt;
&amp;lt;/jaxrs:outInterceptors&amp;gt;&lt;br/&gt;
&amp;lt;/jaxrs:client&amp;gt;&lt;/p&gt;


&lt;p&gt;Here is a Java code :&lt;/p&gt;

&lt;p&gt;@Test&lt;br/&gt;
    public void testEmptyPostProxy() throws Exception &lt;/p&gt;
{
        JAXRSClientFactoryBean bean = new JAXRSClientFactoryBean(); 
        bean.setAddress(&quot;http://localhost:9080&quot;);
        bean.setResourceClass(BookStore.class);
        bean.getOutInterceptors().add(new EmptyPostOutInterceptor());
        BookStore store = bean.create(BookStore.class);
        store.emptypost();
        assertEquals(204, WebClient.client(store).getResponse().getStatus());
    }

&lt;p&gt;give it a try please and let me know how it goes. &lt;br/&gt;
It is really a temp measure, the fix will be in 2.2.6 (to be released possibly in Jan)&lt;/p&gt;</comment>
                            <comment id="12792466" author="sallegro" created="Fri, 18 Dec 2009 13:12:19 +0000"  >&lt;p&gt;Hello, &lt;/p&gt;

&lt;p&gt;Using your Interceptor code, I got now this exception:&lt;/p&gt;

&lt;p&gt;18 d&#233;c. 2009 18:05:25 org.apache.cxf.phase.PhaseInterceptorChain doIntercept&lt;br/&gt;
ATTENTION: Interceptor has thrown exception, unwinding now&lt;br/&gt;
org.apache.cxf.interceptor.Fault: Could not send Message.&lt;br/&gt;
at org.apache.cxf.interceptor.MessageSenderInterceptor$MessageSenderEndingInterceptor.handleMessage(MessageSenderInterceptor.java:64)&lt;br/&gt;
at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:236)&lt;br/&gt;
at org.apache.cxf.jaxrs.client.ClientProxyImpl.doChainedInvocation(ClientProxyImpl.java:429)&lt;br/&gt;
at org.apache.cxf.jaxrs.client.ClientProxyImpl.invoke(ClientProxyImpl.java:166)&lt;br/&gt;
at $Proxy74.createCustomer(Unknown Source)&lt;br/&gt;
...&lt;/p&gt;

&lt;p&gt;Caused by: java.io.IOException: Introuvable&lt;br/&gt;
at org.apache.cxf.transport.http.HTTPConduit$WrappedOutputStream.handleResponseInternal(HTTPConduit.java:2109)&lt;br/&gt;
at org.apache.cxf.transport.http.HTTPConduit$WrappedOutputStream.handleResponse(HTTPConduit.java:2057)&lt;br/&gt;
at org.apache.cxf.transport.http.HTTPConduit$WrappedOutputStream.close(HTTPConduit.java:1982)&lt;br/&gt;
at org.apache.cxf.transport.AbstractConduit.close(AbstractConduit.java:66)&lt;br/&gt;
at org.apache.cxf.transport.http.HTTPConduit.close(HTTPConduit.java:637)&lt;br/&gt;
at org.apache.cxf.interceptor.MessageSenderInterceptor$MessageSenderEndingInterceptor.handleMessageMessageSenderInterceptor.java:62)&lt;/p&gt;

&lt;p&gt;... 45 more&lt;/p&gt;



&lt;p&gt;Any Idea ?&lt;br/&gt;
Thanks for your help.&lt;/p&gt;
</comment>
                            <comment id="12792472" author="sergey_beryozkin" created="Fri, 18 Dec 2009 13:26:35 +0000"  >&lt;p&gt;Perhaps the remote endpoint is now returns an error or not responding ?&lt;/p&gt;

&lt;p&gt;Can you capture please what happens on the wire ?&lt;/p&gt;

&lt;p&gt;Suppose an enpoint is listening on somehost:8080, you can use a tool like &lt;a href=&quot;http://www.pocketsoap.com/tcptrace/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.pocketsoap.com/tcptrace/&lt;/a&gt; (Windows) or similar, tell it to listen on localhost:8081 and redirect to somehost:8080 and then create a client using a 8081 port...&lt;/p&gt;

&lt;p&gt;cheers, Sergey&lt;/p&gt;</comment>
                            <comment id="12793261" author="sallegro" created="Mon, 21 Dec 2009 16:56:19 +0000"  >&lt;p&gt;Hello,&lt;br/&gt;
Sorry, you&apos;re completly right.&lt;br/&gt;
I was using this annotation&lt;br/&gt;
@Path(&quot;/webform.html?cmd=execute&amp;amp;workflow=createAccount&quot;) for a method.&lt;br/&gt;
And CXF did escape &quot;?&quot; and &quot;&amp;amp;&quot; characters and that&apos;s why my endpoint was&lt;br/&gt;
not responding.&lt;br/&gt;
BTW, is there a way to force a queryparam (that always has the same&lt;br/&gt;
value, like the &quot;cmd=execute&quot; above) for a method, such as it is not a&lt;br/&gt;
customizable parameter of this method ?&lt;br/&gt;
Thanks&lt;/p&gt;
</comment>
                            <comment id="12793284" author="sergey_beryozkin" created="Mon, 21 Dec 2009 18:12:44 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;do you mean making it such that a proxy adds this &lt;/p&gt;

&lt;p&gt;&apos;cmd=execute&apos; pair by default ?&lt;/p&gt;

&lt;p&gt;It is not really possible with the proxy based api ? Or may be I&apos;ve misunderstood the question ? What exactly you&apos;d like to see happening ?&lt;/p&gt;

&lt;p&gt;Perhaps the interface can be updated such that this Query param is not even in the signature ?&lt;/p&gt;

&lt;p&gt;cheers, Sergey&lt;/p&gt;</comment>
                            <comment id="12793553" author="sallegro" created="Tue, 22 Dec 2009 09:00:34 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
Yes, that&apos;s what I meant: Having &quot;cmd=execute&quot; by default, without having to put it in the signature.&lt;br/&gt;
I tried something like this:&lt;br/&gt;
@Path(&quot;/&quot;)&lt;br/&gt;
@Produces(&quot;application/xml&quot;)&lt;br/&gt;
public interface FlexibleHostingService {&lt;br/&gt;
    @POST&lt;br/&gt;
    @Path(&quot;/webform.html?cmd=execute&quot;)&lt;br/&gt;
    public String createCustomer(@QueryParam(&quot;workflow&quot;) String workflow);&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;But this proxy escaped &apos;?&apos; and &apos;=&apos;, thus posting to a non-existing endpoint.&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
St&#233;phane&lt;/p&gt;
</comment>
                            <comment id="12793579" author="sergey_beryozkin" created="Tue, 22 Dec 2009 10:33:04 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;@Path(&quot;/webform.html?cmd=execute&quot;)&lt;/p&gt;

&lt;p&gt;identifies the value for the uri path component, so &apos;?&apos; and &apos;=&apos; have to be encoded. JAXRS does not provide for embedding query values inside a @Path annotation&lt;/p&gt;

&lt;p&gt;How is the service endpoint written ? Is it a 3rd-party endpoint or is it yourself who wrote it ? If yes then may be that service endpoint can be updated to default to &quot;execute&quot; if no &quot;cmd&quot; query is provided ?&lt;/p&gt;

&lt;p&gt;Another option to try is to change your method signature like this :&lt;/p&gt;

&lt;p&gt;String createCustomer(@QueryParam(&quot;&quot;) QueryBean bean);&lt;/p&gt;

&lt;p&gt;public class QueryBean {&lt;br/&gt;
    private String cmd = &quot;execute&quot;;&lt;br/&gt;
    private String workflow;&lt;/p&gt;

&lt;p&gt;    public QueryBean() &lt;/p&gt;
{
         this(&quot;defaultWorkflowValue&quot;)
    }
&lt;p&gt;    public QueryBean(String workflow) &lt;/p&gt;
{ 
         this.workflow = workflow;
    }

&lt;p&gt;    public void setCmd(String value) &lt;/p&gt;
{
        cmd = value;
    }
&lt;p&gt;    public String getCmd() &lt;/p&gt;
{
        return cmd;
    }

&lt;p&gt;    public void setWorkflow(String value) &lt;/p&gt;
{
        workflow = value;
    }
&lt;p&gt;    public String getWorkflow() &lt;/p&gt;
{
        return workflow;
    }
&lt;p&gt;}&lt;/p&gt;

&lt;p&gt;and then&lt;/p&gt;

&lt;p&gt;proxy.createCustomer(new QueryBean(&quot;SomeWorkflowValue&quot;));&lt;/p&gt;

&lt;p&gt;This option is good in that you can add a support for new queries by updating the query bean and the service implementation but without changing the signature&lt;/p&gt;

&lt;p&gt;Finally, you can try to do&lt;/p&gt;

&lt;p&gt;@Path(&quot;/webform.html&quot;)&lt;br/&gt;
public String createCustomer(@QueryParam(&quot;workflow&quot;) String workflow);&lt;/p&gt;

&lt;p&gt;But then update Message.REQUEST_URI value on the current message in the CXF out interceptor, by appending &quot;&amp;amp;cmd=execute&quot; to it&lt;/p&gt;

&lt;p&gt;hope it helps, Sergey&lt;/p&gt;

</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10061"><![CDATA[Novice]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>113988</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 49 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i14e8n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>233770</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>