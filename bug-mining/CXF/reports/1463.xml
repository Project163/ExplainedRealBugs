<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:55:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-4508] @Context fails to inject SearchContext into JAX-RS resource bean</title>
                <link>https://issues.apache.org/jira/browse/CXF-4508</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;In an attempt to use the FIQL query parser functionality using the docs at &lt;a href=&quot;http://cxf.apache.org/docs/jax-rs-advanced-features.html#JAX-RSAdvancedFeatures-FIQLsearchqueries&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cxf.apache.org/docs/jax-rs-advanced-features.html#JAX-RSAdvancedFeatures-FIQLsearchqueries&lt;/a&gt;, it&apos;s clear there&apos;s a problem with the packaging such that the SearchContext cannot be injected into a JAX-RS resource installed under Karaf.  The problem is with org.apache.cxf.jaxrs.utils.InjectionUtils#createThreadLocalProxy, which returns the following exception:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.reflect.InvocationTargetException
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.apache.aries.blueprint.utils.ReflectionUtils$MethodPropertyDescriptor.internalSet(ReflectionUtils.java:568)
	at org.apache.aries.blueprint.utils.ReflectionUtils$PropertyDescriptor.set(ReflectionUtils.java:319)
	at org.apache.aries.blueprint.container.BeanRecipe.setProperty(BeanRecipe.java:935)
	at org.apache.aries.blueprint.container.BeanRecipe.setProperties(BeanRecipe.java:903)
	at org.apache.aries.blueprint.container.BeanRecipe.setProperties(BeanRecipe.java:884)
	at org.apache.aries.blueprint.container.BeanRecipe.internalCreate2(BeanRecipe.java:816)
	at org.apache.aries.blueprint.container.BeanRecipe.internalCreate(BeanRecipe.java:783)
	at org.apache.aries.blueprint.di.AbstractRecipe$1.call(AbstractRecipe.java:79)
	at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)
	at java.util.concurrent.FutureTask.run(FutureTask.java:138)
	at org.apache.aries.blueprint.di.AbstractRecipe.create(AbstractRecipe.java:88)
	at org.apache.aries.blueprint.container.BlueprintRepository.createInstances(BlueprintRepository.java:245)
	at org.apache.aries.blueprint.container.BlueprintRepository.createAll(BlueprintRepository.java:183)
	at org.apache.aries.blueprint.container.BlueprintContainerImpl.instantiateEagerComponents(BlueprintContainerImpl.java:648)
	at org.apache.aries.blueprint.container.BlueprintContainerImpl.doRun(BlueprintContainerImpl.java:340)
	at org.apache.aries.blueprint.container.BlueprintContainerImpl.run(BlueprintContainerImpl.java:242)
	at org.apache.aries.blueprint.container.BlueprintExtender.checkBundle(BlueprintExtender.java:315)
	at org.apache.aries.blueprint.container.BlueprintExtender.bundleChanged(BlueprintExtender.java:235)
	at org.apache.aries.blueprint.container.BlueprintExtender$BlueprintBundleTrackerCustomizer.modifiedBundle(BlueprintExtender.java:434)
	at org.apache.aries.util.tracker.hook.BundleHookBundleTracker$Tracked.customizerModified(BundleHookBundleTracker.java:198)
	at org.apache.aries.util.tracker.hook.BundleHookBundleTracker$Tracked.customizerModified(BundleHookBundleTracker.java:128)
	at org.apache.aries.util.tracker.hook.BundleHookBundleTracker$AbstractTracked.track(BundleHookBundleTracker.java:468)
	at org.apache.aries.util.tracker.hook.BundleHookBundleTracker$Tracked.bundleChanged(BundleHookBundleTracker.java:161)
	at org.apache.aries.util.tracker.hook.BundleHookBundleTracker$BundleEventHook.event(BundleHookBundleTracker.java:117)
	at org.apache.felix.framework.util.SecureAction.invokeBundleEventHook(SecureAction.java:1103)
	at org.apache.felix.framework.util.EventDispatcher.createWhitelistFromHooks(EventDispatcher.java:695)
	at org.apache.felix.framework.util.EventDispatcher.fireBundleEvent(EventDispatcher.java:483)
	at org.apache.felix.framework.Felix.fireBundleEvent(Felix.java:4244)
	at org.apache.felix.framework.Felix.startBundle(Felix.java:1923)
	at org.apache.felix.framework.BundleImpl.start(BundleImpl.java:944)
	at org.apache.felix.framework.BundleImpl.start(BundleImpl.java:931)
	at org.apache.karaf.bundle.command.Restart.doExecute(Restart.java:48)
	at org.apache.karaf.bundle.command.BundlesCommand.doExecute(BundlesCommand.java:50)
	at org.apache.karaf.bundle.command.BundlesCommandWithConfirmation.doExecute(BundlesCommandWithConfirmation.java:41)
	at org.apache.karaf.shell.console.AbstractAction.execute(AbstractAction.java:33)
	at org.apache.karaf.shell.console.OsgiCommandSupport.execute(OsgiCommandSupport.java:39)
	at org.apache.karaf.shell.commands.basic.AbstractCommand.execute(AbstractCommand.java:33)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.apache.aries.proxy.impl.ProxyHandler$1.invoke(ProxyHandler.java:54)
	at org.apache.aries.proxy.impl.ProxyHandler.invoke(ProxyHandler.java:119)
	at org.apache.karaf.shell.console.commands.$BlueprintCommand2076750611.execute(Unknown Source)
	at org.apache.felix.gogo.runtime.CommandProxy.execute(CommandProxy.java:78)
	at org.apache.felix.gogo.runtime.Closure.executeCmd(Closure.java:477)
	at org.apache.felix.gogo.runtime.Closure.executeStatement(Closure.java:403)
	at org.apache.felix.gogo.runtime.Pipe.run(Pipe.java:108)
	at org.apache.felix.gogo.runtime.Closure.execute(Closure.java:183)
	at org.apache.felix.gogo.runtime.Closure.execute(Closure.java:120)
	at org.apache.felix.gogo.runtime.CommandSessionImpl.execute(CommandSessionImpl.java:89)
	at org.apache.karaf.shell.console.impl.jline.ConsoleImpl.run(ConsoleImpl.java:179)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:680)
	at org.apache.karaf.shell.console.impl.jline.ConsoleFactoryService$3.doRun(ConsoleFactoryService.java:103)
	at org.apache.karaf.shell.console.impl.jline.ConsoleFactoryService$3$1.run(ConsoleFactoryService.java:94)
	at java.security.AccessController.doPrivileged(Native Method)
	at javax.security.auth.Subject.doAs(Subject.java:337)
	at org.apache.karaf.shell.console.impl.jline.ConsoleFactoryService$3.run(ConsoleFactoryService.java:92)
Caused by: java.lang.IllegalArgumentException: &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; org.apache.cxf.jaxrs.impl.tl.ThreadLocalProxy is not visible from &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;loader
	at java.lang.reflect.Proxy.getProxyClass(Proxy.java:353)
	at java.lang.reflect.Proxy.newProxyInstance(Proxy.java:581)
	at org.apache.cxf.jaxrs.utils.InjectionUtils.createThreadLocalProxy(InjectionUtils.java:874)
	at org.apache.cxf.jaxrs.model.AbstractResourceInfo.addContextMethod(AbstractResourceInfo.java:163)
	at org.apache.cxf.jaxrs.model.AbstractResourceInfo.checkContextMethod(AbstractResourceInfo.java:146)
	at org.apache.cxf.jaxrs.model.AbstractResourceInfo.findContextSetterMethods(AbstractResourceInfo.java:132)
	at org.apache.cxf.jaxrs.model.AbstractResourceInfo.findContextSetterMethods(AbstractResourceInfo.java:139)
	at org.apache.cxf.jaxrs.model.AbstractResourceInfo.&amp;lt;init&amp;gt;(AbstractResourceInfo.java:65)
	at org.apache.cxf.jaxrs.model.ClassResourceInfo.&amp;lt;init&amp;gt;(ClassResourceInfo.java:80)
	at org.apache.cxf.jaxrs.utils.ResourceUtils.createClassResourceInfo(ResourceUtils.java:218)
	at org.apache.cxf.jaxrs.JAXRSServiceFactoryBean.setResourceClassesFromBeans(JAXRSServiceFactoryBean.java:232)
	at org.apache.cxf.jaxrs.JAXRSServerFactoryBean.setServiceBeans(JAXRSServerFactoryBean.java:295)
	... 62 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;m trying to get this working with the cxf-bundle packaging but there&apos;s just too many missing dependencies for this to be practical for the average user.  Will keep poking around to see if I can figure out what the proper packaging is and provide a patch.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Mac OS 10.8.1 JDK 1.6.0_35&lt;/p&gt;</environment>
        <key id="12608139">CXF-4508</key>
            <summary>@Context fails to inject SearchContext into JAX-RS resource bean</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sergey_beryozkin">Sergey Beryozkin</assignee>
                                    <reporter username="topping">Brian Topping</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Sep 2012 21:23:20 +0000</created>
                <updated>Thu, 8 Nov 2012 17:14:57 +0000</updated>
                            <resolved>Fri, 21 Sep 2012 14:36:54 +0000</resolved>
                                    <version>2.6.2</version>
                                    <fixVersion>2.6.3</fixVersion>
                    <fixVersion>2.7</fixVersion>
                                    <component>Core</component>
                    <component>JAX-RS</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13458508" author="sergey_beryozkin" created="Wed, 19 Sep 2012 08:49:44 +0000"  >&lt;p&gt;Interesting, I have not seen any issues with this interface being not visible before - I&apos;ll experiment with out blueprint demo too.&lt;br/&gt;
Workaround: get SearchContext injected as a resource method parameter (with @Context annotation), thanks&lt;/p&gt;</comment>
                            <comment id="13458524" author="topping" created="Wed, 19 Sep 2012 09:25:40 +0000"  >&lt;p&gt;Hi Sergey, thanks for the quick response, I really appreciate it.  I should have mentioned that I did try injecting with the method as well (for instance finding that the setter must be named setSearchContext or the method is silently ignored) as the field.  Both code paths eventually lead to org.apache.cxf.jaxrs.utils.InjectionUtils#createThreadLocalProxy.  &lt;/p&gt;

&lt;p&gt;After failing last night with trying to use the bundle-all jar due to dependencies, I am going to try seeing if I can inject directly with Blueprint, without the @Context annotation to get a manual injection.  &lt;/p&gt;

&lt;p&gt;I looked around for the blueprint demo but couldn&apos;t find it, is it in the source tree?  Will probably be easiest for me to look for the namespace handler next as well to see what my options are.&lt;/p&gt;

&lt;p&gt;Thanks again, and if I can do anything to assist or you have other paths for me to help you with, please don&apos;t hesitate to reach out!  &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  &lt;/p&gt;</comment>
                            <comment id="13458530" author="sergey_beryozkin" created="Wed, 19 Sep 2012 09:41:42 +0000"  >&lt;p&gt;Hi Brian,&lt;/p&gt;

&lt;p&gt;&amp;gt; I should have mentioned that I did try injecting with the method as well &lt;/p&gt;

&lt;p&gt;For singletons it has the same effect of getting a thread-local proxy injected, but I actually meant adding it as a parameter to the JAX-RS resource method, say&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;RootResource {
@GET
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; MyData find(@Context SearchContext) {}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;One thing I&apos;ll focus myself after CXF 2.7.0 is out is on providing more useful converters, there are many query languages there and I think FIQL has a capability to act as a light-weight unifying query language, so what I&apos;m hoping to do is to get say Lucene, Casandra (and may be HBase), LDAP query converters added, to make FIQL more visible in the Apache land... May be working on one of these converters could be of interest to you &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Thanks  &lt;/p&gt;
</comment>
                            <comment id="13458854" author="topping" created="Wed, 19 Sep 2012 17:05:14 +0000"  >&lt;p&gt;Hi Sergey,&lt;/p&gt;

&lt;p&gt;Thanks for helping me unwind this!  That did get me a SearchContext injected, all good!&lt;/p&gt;

&lt;p&gt;Yes, that would really be great to help out actually!  I do have some needs for a map-reduce style database after October 15, it would be a pleasure to contribute in that way.&lt;/p&gt;

&lt;p&gt;Thanks, ttys.  Brian&lt;/p&gt;</comment>
                            <comment id="13460523" author="sergey_beryozkin" created="Fri, 21 Sep 2012 14:36:12 +0000"  >&lt;p&gt;Hi Brian, I had to add an explicit import to the search module and that seemed to resolve the issue (I was able to reproduce it initially). I may need to work on simplifying the thread local support, the fact the import is needed kind of suggests something has to be simplified there...&lt;/p&gt;

&lt;p&gt;Having FIQL converters which would simplify searching various non SQL stores would be great, lets work on them &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Cheers, Sergey&lt;/p&gt;

</comment>
                            <comment id="13460531" author="sergey_beryozkin" created="Fri, 21 Sep 2012 14:44:54 +0000"  >&lt;p&gt;btw, for completeness, one more workaround for issue with injecting a thread-local SearchContext, inject CXF MessageContext and then do context.getContext(SearchContext.class) - may be handy if adding SearchContext parameter to the resource method affects the interface signature, etc...&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>239860</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 9 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i00ufj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2862</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>