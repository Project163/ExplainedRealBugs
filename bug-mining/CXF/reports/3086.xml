<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:25:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-7401] CXF http-jetty fails to get private key if the jks keystore file contains multiple private keys with different password </title>
                <link>https://issues.apache.org/jira/browse/CXF-7401</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;I have a camel-cxf endpoint and it uses http-jetty transport over SSL connection. However, the JKS keystore I used contains multiple private keys and each of them has different password. &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ keytool -list -keystore jboss.keystore.jks
Enter keystore password:  

Keystore type: JKS
Keystore provider: SUN

Your keystore contains 3 entries

jboss, 08-Jun-2017, PrivateKeyEntry, 
Certificate fingerprint (SHA1): 55:2F:EC:00:58:3C:C0:0C:A2:04:7C:46:BC:71:86:B2:A6:3B:21:01
client, 08-Jun-2017, trustedCertEntry, 
Certificate fingerprint (SHA1): E2:29:BE:E9:74:BE:5F:58:C1:59:C0:CE:AA:1C:BF:29:93:94:5A:A9
test, 08-Jun-2017, PrivateKeyEntry, 
Certificate fingerprint (SHA1): 60:58:4F:7C:A4:58:D4:60:C0:B4:07:17:D5:CF:B0:78:E6:9D:C4:6B
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So the keystore jboss.keystore.jks has a store password &quot;secret&quot; and if both private key alias &quot;jboss&quot; and private key alias &quot;test&quot; have the same password, say &quot;changit&quot;, then it worked fine.   &lt;/p&gt;

&lt;p&gt;Here was my http-jetty transport configuration:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;httpj:engine-factory&amp;gt;
        &amp;lt;httpj:engine port=&lt;span class=&quot;code-quote&quot;&gt;&quot;9001&quot;&lt;/span&gt;&amp;gt;
            &amp;lt;httpj:tlsServerParameters&amp;gt;
                &amp;lt;sec:certAlias&amp;gt;jboss&amp;lt;/sec:certAlias&amp;gt;
                &amp;lt;sec:keyManagers keyPassword=&lt;span class=&quot;code-quote&quot;&gt;&quot;changit&quot;&lt;/span&gt;&amp;gt;
                    &amp;lt;sec:keyStore type=&lt;span class=&quot;code-quote&quot;&gt;&quot;JKS&quot;&lt;/span&gt; password=&lt;span class=&quot;code-quote&quot;&gt;&quot;secret&quot;&lt;/span&gt;
                         file=&lt;span class=&quot;code-quote&quot;&gt;&quot;src/main/resources/keys/jboss.keystore.jks&quot;&lt;/span&gt;/&amp;gt;
                &amp;lt;/sec:keyManagers&amp;gt;
                &amp;lt;sec:trustManagers&amp;gt;
                    &amp;lt;sec:keyStore type=&lt;span class=&quot;code-quote&quot;&gt;&quot;JKS&quot;&lt;/span&gt; password=&lt;span class=&quot;code-quote&quot;&gt;&quot;secret&quot;&lt;/span&gt;
                         file=&lt;span class=&quot;code-quote&quot;&gt;&quot;src/main/resources/keys/jboss.keystore.jks&quot;&lt;/span&gt;/&amp;gt;
                &amp;lt;/sec:trustManagers&amp;gt;
                &amp;lt;sec:cipherSuitesFilter&amp;gt;
                    &amp;lt;sec:include&amp;gt;.*_EXPORT_.*&amp;lt;/sec:include&amp;gt;
                    &amp;lt;sec:include&amp;gt;.*_EXPORT1024_.*&amp;lt;/sec:include&amp;gt;
                    &amp;lt;sec:include&amp;gt;.*_WITH_DES_.*&amp;lt;/sec:include&amp;gt;
                    &amp;lt;sec:include&amp;gt;.*_WITH_AES_.*&amp;lt;/sec:include&amp;gt;
                    &amp;lt;sec:include&amp;gt;.*_WITH_NULL_.*&amp;lt;/sec:include&amp;gt;
                    &amp;lt;sec:exclude&amp;gt;.*_DH_anon_.*&amp;lt;/sec:exclude&amp;gt;
                &amp;lt;/sec:cipherSuitesFilter&amp;gt;
                &amp;lt;sec:clientAuthentication want=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; required=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;/&amp;gt;
            &amp;lt;/httpj:tlsServerParameters&amp;gt;
        &amp;lt;/httpj:engine&amp;gt;
    &amp;lt;/httpj:engine-factory&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However, if I the two private keys have different key password, for instance, if I change the private key &quot;test&quot; key password from the &quot;changit&quot; to &quot;password&quot;, which is different from the password of the private key &quot;jboss&quot;, then I am getting following error when I tried to start it:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Caused by: java.security.UnrecoverableKeyException: Cannot recover key
	at sun.security.provider.KeyProtector.recover(KeyProtector.java:328)
	at sun.security.provider.JavaKeyStore.engineGetKey(JavaKeyStore.java:146)
	at sun.security.provider.JavaKeyStore$JKS.engineGetKey(JavaKeyStore.java:56)
	at sun.security.provider.KeyStoreDelegator.engineGetKey(KeyStoreDelegator.java:96)
	at sun.security.provider.JavaKeyStore$DualFormatJKS.engineGetKey(JavaKeyStore.java:70)
	at java.security.KeyStore.getKey(KeyStore.java:1023)
	at sun.security.ssl.SunX509KeyManagerImpl.&amp;lt;init&amp;gt;(SunX509KeyManagerImpl.java:133)
	at sun.security.ssl.KeyManagerFactoryImpl$SunX509.engineInit(KeyManagerFactoryImpl.java:70)
	at javax.net.ssl.KeyManagerFactory.init(KeyManagerFactory.java:256)
	at org.apache.cxf.configuration.jsse.TLSParameterJaxBUtils.getKeyManagers(TLSParameterJaxBUtils.java:272)
	at org.apache.cxf.configuration.jsse.TLSServerParametersConfig.&amp;lt;init&amp;gt;(TLSServerParametersConfig.java:75)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.lang.reflect.Constructor.newInstance(Constructor.java:422)
	at org.springframework.beans.BeanUtils.instantiateClass(BeanUtils.java:148)
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-4204&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CXF-4204&lt;/a&gt; introduced the feature to allow specifying the cert alias name in TLSServerParameters. But even with the &amp;lt;sec:certAlias&amp;gt; element specified in my http-jetty transport configuration, it still fails. &lt;/p&gt;</description>
                <environment></environment>
        <key id="13078302">CXF-7401</key>
            <summary>CXF http-jetty fails to get private key if the jks keystore file contains multiple private keys with different password </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ffang">Freeman Yue Fang</assignee>
                                    <reporter username="joeluo">Joe Luo</reporter>
                        <labels>
                    </labels>
                <created>Thu, 8 Jun 2017 12:41:54 +0000</created>
                <updated>Tue, 1 Aug 2017 16:42:15 +0000</updated>
                            <resolved>Thu, 15 Jun 2017 02:57:35 +0000</resolved>
                                    <version>3.1.5</version>
                                    <fixVersion>3.1.12</fixVersion>
                    <fixVersion>3.0.14</fixVersion>
                    <fixVersion>3.2.0</fixVersion>
                                    <component>Transports</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16042653" author="joeluo" created="Thu, 8 Jun 2017 12:59:58 +0000"  >&lt;p&gt;To run the test case:&lt;br/&gt;
1. go to project &quot;camel-cxf-https-multiple-keys-spring&quot; and invoke &quot;mvn camel:run&quot;;&lt;br/&gt;
2. go to project &quot;cxf-https-client&quot; and invoke &quot;mvn -Pclient&quot;;&lt;br/&gt;
3. the test case works because both private keys have the same password &quot;changit&quot;.  Then go to &quot;camel-cxf-https-multiple-keys-spring/src/main/resources/keys/&quot; folder, change the private key &quot;test&quot; password by invoking the command:&lt;br/&gt;
keytool -keypasswd -new password -keystore jboss.keystore.jks -storepass secret -alias test -keypass changit&lt;/p&gt;

&lt;p&gt;and then restart the server &quot;camel-cxf-https-multiple-keys-spring&quot;, you will see the error.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12872057" name="testcase.zip" size="29314" author="joeluo" created="Thu, 8 Jun 2017 12:55:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 23 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3g1av:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>