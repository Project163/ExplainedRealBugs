<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:23:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-7287] Incorrect JSON decoding in JsonMapObjectReaderWriter when commas are used in value</title>
                <link>https://issues.apache.org/jira/browse/CXF-7287</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;&lt;b&gt;Background&lt;/b&gt;:&lt;br/&gt;
Discovered when using JWT tokens. In org.apache.cxf.rs.security.jose.jws.JwsJwtCompactConsumer there is a line of code that reads:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;JwtClaims theClaims = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JwtClaims(getReader().fromJson(getDecodedJwsPayload()));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If the method &quot;getDecodedJwsPayload()&quot; returns a JSON string like:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&quot;\&quot;sub\&quot;:\&quot;admin\&quot;,\&quot;roles\&quot;:\&quot;admin,user\&quot;,\&quot;iss\&quot;:\&quot;auth0\&quot;&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;then the &quot;fromJson&quot; method returns an incorrect Map.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;The Bug&lt;/b&gt;&lt;br/&gt;
The problem occurs in org.apache.cxf.jaxrs.json.basic.JsonMapObjectReaderWriter (defined in cxf-rt-rs-json-basic-3.1.10.jar) in the &lt;em&gt;readJsonObjectAsSettable&lt;/em&gt; method. Specifically, line 188 reads:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; commaIndex = getCommaIndex(json, sepIndex + j);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which will cause the wrong comma index to be found for the JSON key &quot;roles&quot; in my example above (apparently commaIndex is used to find the &quot;next json key&quot; position in the json string).  &lt;/p&gt;

&lt;p&gt;I&apos;m also thinking that it&apos;s possible that line 166 could be a problem as well, if a JSON value would ever contain an (escaped) quote character.&lt;/p&gt;

&lt;p&gt;This JSON parsing seems fragile... I wonder why a &quot;standard&quot; JSON library wasn&apos;t used (perhaps just to not add an additional dependency?)&lt;/p&gt;

&lt;p&gt;Proper parsing of commas in JSON values is important for JWT purposes as the constructor of &lt;em&gt;org.apache.cxf.rs.security.jose.jaxrs.JwtTokenSecurityContext&lt;/em&gt; expects role claims to be comma-separated.&lt;/p&gt;</description>
                <environment>&lt;p&gt;OSX, Tomcat8, Java8&lt;/p&gt;</environment>
        <key id="13056873">CXF-7287</key>
            <summary>Incorrect JSON decoding in JsonMapObjectReaderWriter when commas are used in value</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sergey_beryozkin">Sergey Beryozkin</assignee>
                                    <reporter username="borice">Boris Capitanu</reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 Mar 2017 01:42:44 +0000</created>
                <updated>Mon, 10 Apr 2017 19:04:43 +0000</updated>
                            <resolved>Mon, 20 Mar 2017 15:21:45 +0000</resolved>
                                    <version>3.1.10</version>
                                    <fixVersion>3.1.11</fixVersion>
                    <fixVersion>3.2.0</fixVersion>
                                    <component>JAX-RS</component>
                    <component>JAX-RS Security</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15931998" author="sergey_beryozkin" created="Sun, 19 Mar 2017 22:24:21 +0000"  >&lt;p&gt;At some point JsonMapObjectReaderWriter was, as far as I recall, an implementation of the interface which was passed to various JOSE consumers,  but after many iterations I decided to simplify the API and simply let the basic parser be used - it allows for a bit of the extra control, for example, trace the duplications of the properties which must not be duplicated, etc.&lt;/p&gt;

&lt;p&gt;I&apos;ll start considering reintroducing the interface (after fixing this particular issue) so that the alternative JSON parsers can be wrapped if needed. &lt;/p&gt;

</comment>
                            <comment id="15932824" author="sergey_beryozkin" created="Mon, 20 Mar 2017 15:25:24 +0000"  >&lt;p&gt;As far as the possible support for an encoded double quote is concerned I&apos;d rather look into it when there&apos;s a good practical case for it is found. You are right JSON values may have such encoded characters in general, but having them in JWT token claim values appears to be very unusual to me, and there&apos;s always an option to use an escaped unicode sequence representing a double quote if really needed.&lt;br/&gt;
thanks&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10062"><![CDATA[Moderate]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 35 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3cejj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>