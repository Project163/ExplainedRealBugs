<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:07:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-5484] JAASAuthenticationFilter cannot separate 3rdParty java.security.Principals based on user/role</title>
                <link>https://issues.apache.org/jira/browse/CXF-5484</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;This is an obscure issue but org.apache.cxf.jaxrs.security.JAASAuthenticationFilter internally uses an instance of org.apache.cxf.interceptor.security.JAASLoginInterceptor to handle authentication for it.  It simply over-rides the &quot;getCallbackHandler&quot; method to provide credentials gathered via HTTP to the interceptor.  There are a few setters that allow conditioning of the underlying interceptor but there are no setters for roleClassifier/roleClassifierType.&lt;br/&gt;
e.g.&lt;br/&gt;
public void setRoleClassifier(String rc) &lt;/p&gt;
{ interceptor.setRoleClassifier(rc); }
&lt;p&gt;public void setRoleClassifierType(String rct) &lt;/p&gt;
{ interceptor.setRoleClassifierType(rct);}

&lt;p&gt;In my specific use I&apos;m embedded CXF JAX-RS services in Jetty within Apache Karaf and I need to gain access to the appropriate java.security.Principal representing the user that authenticated for a given resource.&lt;/p&gt;

&lt;p&gt;The LoginModule that represents the realm is an instance of org.apache.karaf.jaas.modules.ldap.LDAPLoginModule.  This LoginModule produces a Subject populated with two types of Principals&lt;br/&gt;
org.apache.karaf.jaas.modules.RolePrincipal abd&lt;br/&gt;
org.apache.karaf.jaas.modules.UserPrincipal&lt;/p&gt;


&lt;p&gt;The former represents the roles (groups) a user is in and the latter obviously represents the actual user principal.  In this situation however the existing JAASAuthenticationFilter has no means of separating out the two since it cannot be conditioned to determine which is which and as a result when consulting the results of javax.ws.rs.core.SecurityContext.getUserPrincipal(); it&apos;s undetermined which Principal will be returned and it&apos;s almost always the wrong one (a RolePrincipal rather than the UserPrincipal).&lt;/p&gt;

&lt;p&gt;The only way I could deal with this and get access to the correct Principal was to sub-class JAASAuthenticationFilter, duplicate some of its code, and condition the interceptor how I needed (I hard coded but setters obviously would have been more appropriate).&lt;/p&gt;

&lt;p&gt;E.g.&lt;br/&gt;
public class JAASAuthenticationFilter extends&lt;br/&gt;
        org.apache.cxf.jaxrs.security.JAASAuthenticationFilter {&lt;/p&gt;

&lt;p&gt;    private JAASLoginInterceptor interceptor = new JAASLoginInterceptor() {&lt;br/&gt;
        protected CallbackHandler getCallbackHandler(String name,String password) &lt;/p&gt;
{
            return JAASAuthenticationFilter.this.getCallbackHandler(name,password);
        }
&lt;p&gt;    };&lt;/p&gt;

&lt;p&gt;    public void setContextName(String name) &lt;/p&gt;
{
        interceptor.setContextName(name);
    }

&lt;p&gt;    public void setLoginConfig(Configuration config) &lt;/p&gt;
{
        interceptor.setLoginConfig(config);
    }

&lt;p&gt;    @Override&lt;br/&gt;
    public Response handleRequest(Message m, ClassResourceInfo cri) {&lt;br/&gt;
        try &lt;/p&gt;
{
        	interceptor.setRoleClassifierType(&quot;classname&quot;);
        	interceptor.setRoleClassifier(&quot;RolePrincipal&quot;);
            interceptor.handleMessage(m);
            return null;
        }
&lt;p&gt; catch (AuthenticationException ex) &lt;/p&gt;
{
            return handleAuthenticationException(ex, m);
        } catch (SecurityException ex) {            return handleAuthenticationException(ex, m);        }
&lt;p&gt;    }&lt;/p&gt;

&lt;p&gt;}&lt;/p&gt;

&lt;p&gt;And then at config time.&lt;br/&gt;
    &amp;lt;!-- bean id=&quot;authenticationFilter&quot; class=&quot;org.apache.cxf.jaxrs.security.JAASAuthenticationFilter&quot;--&amp;gt;&lt;br/&gt;
    &amp;lt;bean id=&quot;authenticationFilter&quot; class=&quot;cxf.workaround.JAASAuthenticationFilter&quot;&amp;gt;&lt;br/&gt;
        &amp;lt;property name=&quot;contextName&quot; value=&quot;...&quot;/&amp;gt;&lt;br/&gt;
        &amp;lt;property name=&quot;realmName&quot; value=&quot;...&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;/bean&amp;gt;&lt;/p&gt;

&lt;p&gt;If the two setters existed on org.apache.cxf.jaxrs.security.JAASAuthenticationFilter then I could have simply added:&lt;br/&gt;
&amp;lt;property name=&quot;roleClassifierType&quot; value=&quot;classname&quot; /&amp;gt;&lt;br/&gt;
&amp;lt;property name=&quot;roleClassifier&quot; value=&quot;RolePrincipal&quot; /&amp;gt;&lt;/p&gt;

&lt;p&gt;And things would have worked properly.&lt;/p&gt;

&lt;p&gt;Interestingly JAASAuthentication filter DOES implement a deprecated method that I could use to deal with this, setRoleClassifier, which calls through to the same deprecated method on the interceptor.  I&apos;ll probably switch to doing this but it seems that setRolePrefix has been replaced by the setRoleClassifier/Type methods so it also seems JAASAuthenticationFilter should mimic these methods.&lt;/p&gt;

&lt;p&gt;I take it back setRolePrefix is not an acceptable workaround because it doesn&apos;t compare to the classname of the Principal it compares it against the actual name meaning that Roles/Groups must be named by some convention that allows them to be separated from users which is why the method has been deprecated...&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Embedded in Karaf&lt;/p&gt;</environment>
        <key id="12687667">CXF-5484</key>
            <summary>JAASAuthenticationFilter cannot separate 3rdParty java.security.Principals based on user/role</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ffang">Freeman Yue Fang</assignee>
                                    <reporter username="adamspe">Paul Adams</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Jan 2014 15:45:36 +0000</created>
                <updated>Fri, 11 Jul 2014 12:50:19 +0000</updated>
                            <resolved>Wed, 8 Jan 2014 09:16:29 +0000</resolved>
                                    <version>2.7.8</version>
                                    <fixVersion>2.6.12</fixVersion>
                    <fixVersion>2.7.9</fixVersion>
                    <fixVersion>3.0.0-milestone2</fixVersion>
                                    <component>JAX-RS</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13865037" author="ffang" created="Wed, 8 Jan 2014 03:51:49 +0000"  >&lt;p&gt;Yeah, introduce roleClassifier/roleClassifierType configuration like we do for JAASLoginInterceptor should be the way to go&lt;/p&gt;</comment>
                            <comment id="13865226" author="ffang" created="Wed, 8 Jan 2014 09:16:29 +0000"  >&lt;p&gt;commit fix&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/r1556465&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1556465&lt;/a&gt; for trunk&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/r1556468&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1556468&lt;/a&gt; for 2.7.x branch&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/r1556471&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1556471&lt;/a&gt; for 2.6.x branch&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10062"><![CDATA[Moderate]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>366667</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 46 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1r7bz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>366978</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>