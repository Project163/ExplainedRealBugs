<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:32:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-7760] JOSE: JwsCompactConsumer parsing headers issue</title>
                <link>https://issues.apache.org/jira/browse/CXF-7760</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;When using the JwsCompactConsumer with a compact JWT whose kid contains a slash, the&#160;json parser escapes it, which causes issues later on while matching the kid to the one specified in the JWKS. For example:&lt;/p&gt;

&lt;p&gt;Header:&lt;/p&gt;

{
 &quot;kid&quot;: &quot;4pZbe4shQQGzZXHbeIlbDvmHOc1/H6jH6oBk3nUrcZE=&quot;,
 &quot;alg&quot;: &quot;RS256&quot;
}

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13165761">CXF-7760</key>
            <summary>JOSE: JwsCompactConsumer parsing headers issue</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="coheigea">Colm O hEigeartaigh</assignee>
                                    <reporter username="Roldan">J.J. Roldan</reporter>
                        <labels>
                    </labels>
                <created>Wed, 13 Jun 2018 07:57:23 +0000</created>
                <updated>Wed, 3 Oct 2018 13:33:17 +0000</updated>
                            <resolved>Mon, 25 Jun 2018 17:09:08 +0000</resolved>
                                    <version>3.1.13</version>
                                    <fixVersion>3.2.6</fixVersion>
                    <fixVersion>3.1.17</fixVersion>
                                    <component>JAX-RS Security</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16510831" author="coheigea" created="Wed, 13 Jun 2018 09:20:18 +0000"  >&lt;p&gt;Can you supply a test-case? I tried with this and it worked OK:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160; @Test&lt;br/&gt;
&#160;&#160;&#160; public void testEncodedKid() throws Exception &lt;/p&gt;
{
&#160;&#160;&#160;&#160;&#160;&#160;&#160; String keyId = &quot;4pZbe4shQQGzZXHbeIlbDvmHOc1/H6jH6oBk3nUrcZE=&quot;;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; JsonWebKey key = new JsonWebKey();
&#160;&#160;&#160;&#160;&#160;&#160;&#160; key.setKeyType(KeyType.OCTET);
&#160;&#160;&#160;&#160;&#160;&#160;&#160; key.setKeyId(keyId);
&#160;&#160;&#160;&#160;&#160;&#160;&#160; key.setKeyOperation(Arrays.asList(
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; new KeyOperation[]\{KeyOperation.SIGN, KeyOperation.VERIFY}
&lt;p&gt;));&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160; JwsHeaders headers = new JwsHeaders();&lt;br/&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; headers.setType(JoseType.JWT);&lt;br/&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; headers.setSignatureAlgorithm(SignatureAlgorithm.HS256);&lt;br/&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; headers.setHeader(JoseConstants.HEADER_KEY_ID, key.getKeyId());&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160; JwtClaims claims = new JwtClaims();&lt;br/&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; claims.setIssuer(&quot;joe&quot;);&lt;br/&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; claims.setExpiryTime(1300819380L);&lt;br/&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; claims.setClaim(&quot;http://example.com/is_root&quot;, Boolean.TRUE);&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160; JwtToken token = new JwtToken(headers, claims);&lt;br/&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; JwsCompactProducer jws = new JwsJwtCompactProducer(token, getWriter());&lt;br/&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; jws.signWith(new HmacJwsSignatureProvider(ENCODED_MAC_KEY, SignatureAlgorithm.HS256));&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160; JwsCompactConsumer consumer = new JwsJwtCompactConsumer(jws.getSignedEncodedJws());&lt;br/&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; assertTrue(consumer.verifySignatureWith(new HmacJwsSignatureVerifier(ENCODED_MAC_KEY, SignatureAlgorithm.HS256)));&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160; assertEquals(keyId, consumer.getJwsHeaders().getKeyId());&lt;br/&gt;
&#160;&#160;&#160; }&lt;/p&gt;</comment>
                            <comment id="16510912" author="roldan" created="Wed, 13 Jun 2018 10:13:20 +0000"  >&lt;p&gt;Thanks for the quick response. I am getting the JWT from&#160;cognito. See this:&lt;/p&gt;

&lt;p&gt;String keyId = &quot;4pZbe4shQQGzZXHbeIlbDvmHOc1/H6jH6oBk3nUrcZE=&quot;;&lt;/p&gt;

&lt;p&gt;String jwt = &quot;eyJraWQiOiI0cFpiZTRzaFFRR3paWEhiZUlsYkR2bUhPYzFcL0g2akg2b0JrM25VcmNaRT0iLCJhbGciOiJSUzI1NiJ9.nevermindtheclaims.orthesignature&quot;;&lt;br/&gt;
JwsCompactConsumer consumer = new JwsJwtCompactConsumer(jwt);&lt;br/&gt;
 assertEquals(keyId, consumer.getJwsHeaders()&lt;br/&gt;
 .asMap()&lt;br/&gt;
 .get(&quot;kid&quot;));&lt;/p&gt;</comment>
                            <comment id="16511301" author="coheigea" created="Wed, 13 Jun 2018 15:30:23 +0000"  >&lt;p&gt;I think the problem is with the token itself. For example not using any CXF APIs:&lt;/p&gt;

&lt;p&gt;String part1 = &quot;eyJraWQiOiI0cFpiZTRzaFFRR3paWEhiZUlsYkR2bUhPYzFcL0g2akg2b0JrM25VcmNaRT0iLCJhbGciOiJSUzI1NiJ9&quot;;&lt;br/&gt;
byte[] bytes = java.util.Base64.getDecoder().decode(part1);&lt;br/&gt;
System.out.println(new String(bytes, StandardCharsets.UTF_8));&lt;/p&gt;

&lt;p&gt;yields:&lt;/p&gt;

{&quot;kid&quot;:&quot;4pZbe4shQQGzZXHbeIlbDvmHOc1\/H6jH6oBk3nUrcZE=&quot;,&quot;alg&quot;:&quot;RS256&quot;}

&lt;p&gt;Here you can see the forward slash in the kid is already encoded in the token.&lt;/p&gt;</comment>
                            <comment id="16512045" author="roldan" created="Thu, 14 Jun 2018 06:53:29 +0000"  >&lt;p&gt;Oh.&#160;I will&#160;open a ticket to Cognito with your analysis. Thanks for all the help, deeply appreciated!&lt;/p&gt;</comment>
                            <comment id="16519019" author="roldan" created="Thu, 21 Jun 2018 07:29:45 +0000"  >&lt;p&gt;Hi, got feedback back from Cognito. It seems the problem is actually in the CXF JSON parsing. Using a vanilla Jackson ObjectMapper instance it is properly parsed:&lt;/p&gt;

&lt;p&gt;&#160;String part1 = &quot;eyJraWQiOiI0cFpiZTRzaFFRR3paWEhiZUlsYkR2bUhPYzFcL0g2akg2b0JrM25VcmNaRT0iLCJhbGciOiJSUzI1NiJ9&quot;;&lt;br/&gt;
 byte[] bytes = java.util.Base64.getUrlDecoder()&lt;br/&gt;
 .decode(part1);&lt;br/&gt;
 ObjectMapper mapper = new ObjectMapper();&lt;br/&gt;
 Map&amp;lt;String, Object&amp;gt; map = mapper.readValue(bytes, new TypeReference&amp;lt;Map&amp;lt;String, String&amp;gt;&amp;gt;() {&lt;br/&gt;
 });&lt;br/&gt;
 System.out.println(map);&lt;/p&gt;

&lt;p&gt;yields&#160;&lt;/p&gt;

{kid=4pZbe4shQQGzZXHbeIlbDvmHOc1/H6jH6oBk3nUrcZE=, alg=RS256}

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16521489" author="roldan" created="Sun, 24 Jun 2018 13:15:59 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=coheigea&quot; class=&quot;user-hover&quot; rel=&quot;coheigea&quot;&gt;coheigea&lt;/a&gt;,&#160;&lt;/p&gt;

&lt;p&gt;Please refer to the following reproduction:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
JsonMapObjectReaderWriter jsonMapObjectReaderWriter = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JsonMapObjectReaderWriter();
&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; part1 = &lt;span class=&quot;code-quote&quot;&gt;&quot;eyJraWQiOiI0cFpiZTRzaFFRR3paWEhiZUlsYkR2bUhPYzFcL0g2akg2b0JrM25VcmNaRT0iLCJhbGciOiJSUzI1NiJ9&quot;&lt;/span&gt;;
&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; innerJson = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;(java.util.Base64.getUrlDecoder()
.decode(part1), StandardCharsets.UTF_8);
Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; innerJsonParsed = jsonMapObjectReaderWriter.fromJson(innerJson);
&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.printf(&lt;span class=&quot;code-quote&quot;&gt;&quot;kid Expected: %s%n&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ObjectMapper().readValue(innerJson, Map.class)
.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;kid&quot;&lt;/span&gt;));
&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.printf(&lt;span class=&quot;code-quote&quot;&gt;&quot;kid Actual: %s%n&quot;&lt;/span&gt;, innerJsonParsed.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;kid&quot;&lt;/span&gt;));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Output:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
kid Expected: 4pZbe4shQQGzZXHbeIlbDvmHOc1/H6jH6oBk3nUrcZE=
kid Actual: 4pZbe4shQQGzZXHbeIlbDvmHOc1\/H6jH6oBk3nUrcZE=
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The &apos;\/&apos; should be evaluated to &apos;/&apos;, please refer to&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; as performed by Jackson.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;&#160;&lt;a href=&quot;https://www.json.org/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.json.org/&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 21 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3usxr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>