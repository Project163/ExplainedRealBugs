<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:23:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-5436] Poorly crafted response caused NullPointerException when processing incoming message</title>
                <link>https://issues.apache.org/jira/browse/CXF-5436</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;A CXF SOAP client is processing a response, and it gets a NPE:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2013-11-26 10:03:39,462 243006 WARNING [org.apache.cxf.phase.PhaseInterceptorChain] (pool-38-thread-1:) Interceptor for {http://REDACTED has thrown exception, unwinding now
java.lang.NullPointerException
        at org.apache.cxf.staxutils.StaxUtils.toNextElement(StaxUtils.java:333)
        at org.apache.cxf.interceptor.DocLiteralInInterceptor.handleMessage(DocLiteralInInterceptor.java:80)
        at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:243)
        at org.apache.cxf.endpoint.ClientImpl.onMessage(ClientImpl.java:755)
        at org.apache.cxf.transport.http.HTTPConduit$WrappedOutputStream.handleResponseInternal(HTTPConduit.java:2408)
        at org.apache.cxf.transport.http.HTTPConduit$WrappedOutputStream.handleResponse(HTTPConduit.java:2278)
        at org.apache.cxf.transport.http.HTTPConduit$WrappedOutputStream.close(HTTPConduit.java:2121)
        at org.apache.cxf.transport.AbstractConduit.close(AbstractConduit.java:66)
        at org.apache.cxf.transport.http.HTTPConduit.close(HTTPConduit.java:695)
        at org.apache.cxf.interceptor.MessageSenderInterceptor$MessageSenderEndingInterceptor.handleMessage(MessageSenderInterceptor.java:62)
        at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:243)
        at org.apache.cxf.endpoint.ClientImpl.invoke(ClientImpl.java:516)
        at org.apache.cxf.endpoint.ClientImpl.invoke(ClientImpl.java:313)
        at org.apache.cxf.endpoint.ClientImpl.invoke(ClientImpl.java:265)
        at org.apache.cxf.frontend.ClientProxy.invokeSync(ClientProxy.java:73)
        at org.apache.cxf.jaxws.JaxWsClientProxy.invoke(JaxWsClientProxy.java:124)
        at $Proxy1346.tenprintSearchResponse(Unknown Source)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)
        at java.lang.reflect.Method.invoke(Unknown Source)
        at my.application.ClassName.run(MessageRouterTask.java:44)
        at java.util.concurrent.Executors$RunnableAdapter.call(Unknown Source)
        at java.util.concurrent.FutureTask$Sync.innerRun(Unknown Source)
        at java.util.concurrent.FutureTask.run(Unknown Source)
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(Unknown Source)
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(Unknown Source)
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(Unknown Source)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)
        at java.lang.Thread.run(Unknown Source)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The issue has been traced back to the &lt;tt&gt;StaxInInterceptor&lt;/tt&gt; around this code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (contentType == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-comment&quot;&gt;//&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; contentType is &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is likely a an empty post/put/delete/similar, lets see &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; it&apos;s
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;//detectable at all
&lt;/span&gt;            Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;&amp;gt; m = CastUtils.&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;((Map&amp;lt;?, ?&amp;gt;)message.get(Message.PROTOCOL_HEADERS));
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (m != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; contentLen = HttpHeaderHelper
                    .getHeader(m, HttpHeaderHelper.CONTENT_LENGTH);
                List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; contentTE = HttpHeaderHelper
                    .getHeader(m, HttpHeaderHelper.CONTENT_TRANSFER_ENCODING);
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ((StringUtils.isEmpty(contentLen) || &lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;.equals(contentLen.get(0)))
                    &amp;amp;&amp;amp; StringUtils.isEmpty(contentTE)) {
                    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
                }
            }
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The endpoint is responding with an empty &lt;tt&gt;Content-Type&lt;/tt&gt; header and is using chunked encoding, so it&apos;s setting the &lt;tt&gt;Transfer-Encoding&lt;/tt&gt; header and omitting the &lt;tt&gt;Content-Length&lt;/tt&gt; header.  These combined attributes cause the &lt;tt&gt;StaxInInterceptor&lt;/tt&gt; to return before the &lt;tt&gt;XMLStreamReader&lt;/tt&gt; is created and put in the &lt;tt&gt;Message&lt;/tt&gt;, causing the NPE down the chain.  While I certainly feel that the endpoint shouldn&apos;t respond in such a way, the NPE in CXF is probably not the best way to handle this odd response from the endpoint.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12683028">CXF-5436</key>
            <summary>Poorly crafted response caused NullPointerException when processing incoming message</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ffang">Freeman Yue Fang</assignee>
                                    <reporter username="klape">Kyle Lape</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 Dec 2013 00:19:25 +0000</created>
                <updated>Mon, 27 Feb 2017 15:08:25 +0000</updated>
                            <resolved>Thu, 19 Jan 2017 07:28:28 +0000</resolved>
                                                    <fixVersion>3.1.10</fixVersion>
                    <fixVersion>3.0.13</fixVersion>
                    <fixVersion>3.2.0</fixVersion>
                                    <component>JAX-WS Runtime</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13840731" author="klape" created="Fri, 6 Dec 2013 00:22:54 +0000"  >&lt;p&gt;Attached the Jira associated with the commit that added the logic in the jira description.&lt;/p&gt;</comment>
                            <comment id="15825998" author="ajeans" created="Tue, 17 Jan 2017 12:56:13 +0000"  >&lt;p&gt;I got the same bug recently in 3.1.5, with the same combination of missing Content-Type header in a chunked response.&lt;/p&gt;

&lt;p&gt;Symptom is different though, the NullPointerException occurs here (see redacted excerpt below):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2017-01-13 11:39:58.308 WARN  [xxxxxxx.yy] [http-bio-8080-exec-2] [o.apache.cxf.phase.PhaseInterceptorChain.doLog] - Interceptor &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; {XXXXXXX has thrown exception, unwinding now
java.lang.NullPointerException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
    at org.apache.cxf.binding.soap.interceptor.StartBodyInterceptor.handleMessage(StartBodyInterceptor.java:59) ~[cxf-rt-bindings-soap-3.1.5.jar:3.1.5]
    at org.apache.cxf.binding.soap.interceptor.StartBodyInterceptor.handleMessage(StartBodyInterceptor.java:37) ~[cxf-rt-bindings-soap-3.1.5.jar:3.1.5]
    at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:308) [cxf-core-3.1.5.jar:3.1.5]
    at org.apache.cxf.endpoint.ClientImpl.onMessage(ClientImpl.java:798) [cxf-core-3.1.5.jar:3.1.5]
    at org.apache.cxf.transport.http.HTTPConduit$WrappedOutputStream.handleResponseInternal(HTTPConduit.java:1670) [cxf-rt-transports-http-3.1.5.jar:3.1.5]
    at org.apache.cxf.transport.http.HTTPConduit$WrappedOutputStream.handleResponse(HTTPConduit.java:1551) [cxf-rt-transports-http-3.1.5.jar:3.1.5]
    at org.apache.cxf.transport.http.HTTPConduit$WrappedOutputStream.close(HTTPConduit.java:1348) [cxf-rt-transports-http-3.1.5.jar:3.1.5]
    [...]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;My understanding is that the code in StaxInInterceptor  should also test for presence of &quot;Transfer-Encoding:chunked&quot; when deciding whether to exit early or not.&lt;br/&gt;
Is my understanding correct?&lt;/p&gt;</comment>
                            <comment id="15827821" author="githubbot" created="Wed, 18 Jan 2017 10:48:01 +0000"  >&lt;p&gt;GitHub user ajeans opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cxf/pull/224&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/224&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-5436&quot; title=&quot;Poorly crafted response caused NullPointerException when processing incoming message&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-5436&quot;&gt;&lt;del&gt;CXF-5436&lt;/del&gt;&lt;/a&gt;: Properly handle SOAP responses whose Content-Type is missin&#8230;&lt;/p&gt;

&lt;p&gt;    &#8230;g, even if&lt;/p&gt;

&lt;p&gt;    the response is chunked.&lt;br/&gt;
    This code already tests for &apos;Content-Length:0&apos; to fast track empty responses, but&lt;br/&gt;
    chunked responses don&apos;t set this header, so test also for &apos;Transfer-Encoding:chunked&apos;.&lt;/p&gt;

&lt;p&gt;    Signed-off-by: Arnaud Jeansen &amp;lt;arnaud.jeansen@ncr.com&amp;gt;&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/ajeans/cxf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ajeans/cxf&lt;/a&gt; master&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cxf/pull/224.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/224.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #224&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit afd0d92017dea93138a0bb5d19ba25dde9f947bc&lt;br/&gt;
Author: Arnaud Jeansen &amp;lt;arnaud.jeansen@ncr.com&amp;gt;&lt;br/&gt;
Date:   2017-01-17T16:06:39Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-5436&quot; title=&quot;Poorly crafted response caused NullPointerException when processing incoming message&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-5436&quot;&gt;&lt;del&gt;CXF-5436&lt;/del&gt;&lt;/a&gt;: Properly handle SOAP responses whose Content-Type is missing, even if&lt;br/&gt;
    the response is chunked.&lt;br/&gt;
    This code already tests for &apos;Content-Length:0&apos; to fast track empty responses, but&lt;br/&gt;
    chunked responses don&apos;t set this header, so test also for &apos;Transfer-Encoding:chunked&apos;.&lt;/p&gt;

&lt;p&gt;    Signed-off-by: Arnaud Jeansen &amp;lt;arnaud.jeansen@ncr.com&amp;gt;&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15829019" author="githubbot" created="Thu, 19 Jan 2017 00:06:00 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cxf/pull/224&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/224&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15829457" author="ffang" created="Thu, 19 Jan 2017 07:27:01 +0000"  >&lt;p&gt;patch applied on behalf of Arnaud Jeansen with thanks!&lt;/p&gt;</comment>
                            <comment id="15829579" author="ajeans" created="Thu, 19 Jan 2017 09:23:55 +0000"  >&lt;p&gt;Awesome, thanks a lot for the quick review.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12372824">CXF-758</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>362280</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 43 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1qg5b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>362574</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>