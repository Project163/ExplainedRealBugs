<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:47:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-3219] WS-RMs&apos; DestinationSequence does not update the ack range in the RMStore</title>
                <link>https://issues.apache.org/jira/browse/CXF-3219</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;This problem is described in my mail to the cxf-user list.&lt;br/&gt;
&lt;a href=&quot;http://cxf.547215.n5.nabble.com/WS-RMs-DestinationSequence-does-not-update-the-ack-range-stored-in-the-RMStore-td3315278.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cxf.547215.n5.nabble.com/WS-RMs-DestinationSequence-does-not-update-the-ack-range-stored-in-the-RMStore-td3315278.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In short, the acknowledged range information of the destination sequence is not updated in the RMTxStore for the inbound messages. So, when you stop and restart the server and the server retrieves the desctination sequences from the RMStore, the acknowledged range information is not retrieved. Consequently, the server will return the next acknowledgement with its range starting from the current messag number and not including the message numbers that have been acknowledged prior to the server restart.&lt;/p&gt;

&lt;p&gt;As I mentioned in the above mail, I think the Destination&apos;s acknowledge method should be modified so that the destination sequence is udpated in the storage. &lt;/p&gt;

&lt;p&gt;In the attached file, I modified the Destination class&apos;s acknowledge method so that the acknowledgement sequence gets updated in the storage. I also modified the mocking part of the DestinationTest class to accommodate this change.&lt;/p&gt;

&lt;p&gt;As commented in the modified code, the call to the storage to update the acknowleged range requires the content of the message. Unfortunately, for the inbound processing, StaxInInterceptor has consumed the InputStream object and placed instead the XMLStreamReader in the message. But this stream reader is consumed by several interceptors and the entire content is not available at RMInInterceptor.&lt;/p&gt;

&lt;p&gt;If the LoggingInInterceptor is engaged, this interceptor leaves the resettable InputStream in the message. In this case, we can get the content by reading this input stream again. If this interceptor is not engaged, we cannot get the message content and we fall back to use an empty content to just update the acknowledgement range information.&lt;/p&gt;

&lt;p&gt;So the modified code is a workaround solution. I think a permanent solution might use another interceptor placed in front of StaxInInterceptor to store the message content. In that case, we can simply get the message content at the acknowledge method at RMInInterceptor.&lt;/p&gt;

&lt;p&gt;Please let me know how you think.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;br/&gt;
Regards, Aki&lt;/p&gt;</description>
                <environment></environment>
        <key id="12494063">CXF-3219</key>
            <summary>WS-RMs&apos; DestinationSequence does not update the ack range in the RMStore</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ay">Akitoshi Yoshida</assignee>
                                    <reporter username="ay">Akitoshi Yoshida</reporter>
                        <labels>
                    </labels>
                <created>Sat, 25 Dec 2010 22:36:55 +0000</created>
                <updated>Mon, 8 Aug 2011 14:43:49 +0000</updated>
                            <resolved>Mon, 6 Jun 2011 18:07:43 +0000</resolved>
                                    <version>2.2.12</version>
                    <version>2.3.1</version>
                                    <fixVersion>2.4.1</fixVersion>
                                    <component>WS-* Components</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12975081" author="ay" created="Sat, 25 Dec 2010 22:39:49 +0000"  >&lt;p&gt;svn diff for codeline 2.3.x-fixes&lt;br/&gt;
Affected files&lt;br/&gt;
2.3.x-fixes/rt/ws/rm/src/main/java/org/apache/cxf/ws/rm/Destination.java&lt;br/&gt;
2.3.x-fixes/rt/ws/rm/src/test/java/org/apache/cxf/ws/rm/DestinationTest.java&lt;/p&gt;</comment>
                            <comment id="13044808" author="ay" created="Mon, 6 Jun 2011 12:00:36 +0000"  >&lt;p&gt;I am fixing this issue by introducing a new interceptor in the inbound chain for 2.4.x to capture the stream.&lt;/p&gt;

&lt;p&gt;I am also updating several ws-rm systests to verify the behavior of the correct ack range generation.&lt;/p&gt;</comment>
                            <comment id="13044989" author="ay" created="Mon, 6 Jun 2011 18:07:43 +0000"  >&lt;p&gt;The described issue has been resolved with this patch. Thus, I am closing this issue ticket.&lt;/p&gt;

&lt;p&gt;It is noted that some future changes is expected to be made in WS-RM and they will be tracked in other tickets.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12466965" name="rt-ws-rm-2.3.x-fixes-diff.txt" size="4251" author="ay" created="Sat, 25 Dec 2010 22:39:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10062"><![CDATA[Moderate]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5803</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 25 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0b94v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>63592</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>