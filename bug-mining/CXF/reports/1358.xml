<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:53:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-4309] OAuth2 Access Token Service: returned ClientAccessToken is not JAXB compliant</title>
                <link>https://issues.apache.org/jira/browse/CXF-4309</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;The OAuth2 Access Token Service current implementation (class org.apache.cxf.rs.security.oauth2.services.AccessTokenService) processes a request inside &quot;handleTokenRequest()&quot; and this method returns the successfully generated token using an instance of ClientAccessToken.&lt;/p&gt;

&lt;p&gt;But that class has two problems or limitations:&lt;/p&gt;

&lt;p&gt;1) It is not a JAXB-annotated bean so the error &quot;No message body writer has been found for response class ClientAccessToken&quot; is raised. This can be solved adding the &quot;jaxbElementClassMap&quot; property to the default JSON provider (jettison):&lt;/p&gt;

&lt;p&gt;&amp;lt;bean id=&quot;jsonProvider&quot; class=&quot;org.apache.cxf.jaxrs.provider.json.JSONProvider&quot;&amp;gt;&lt;br/&gt;
  &amp;lt;property name=&quot;jaxbElementClassMap&quot; ref=&quot;myElementClassMap&quot;/&amp;gt;&lt;br/&gt;
&amp;lt;/bean&amp;gt;&lt;/p&gt;

&lt;p&gt;&amp;lt;util:map id=&quot;myElementClassMap&quot;&amp;gt;&lt;br/&gt;
  &amp;lt;entry key=&quot;org.apache.cxf.rs.security.oauth2.common.ClientAccessToken&quot; value=&quot;ClientAccessToken&quot;/&amp;gt;&lt;br/&gt;
&amp;lt;/util:map&amp;gt;&lt;/p&gt;

&lt;p&gt;&amp;lt;jaxrs:server id=&quot;oauth2Server&quot; address=&quot;/oauth2&quot;&amp;gt;&lt;br/&gt;
  &amp;lt;jaxrs:serviceBeans&amp;gt;&lt;br/&gt;
    &amp;lt;ref bean=&quot;accessTokenService2&quot;/&amp;gt;&lt;br/&gt;
  &amp;lt;/jaxrs:serviceBeans&amp;gt;&lt;br/&gt;
  &amp;lt;jaxrs:providers&amp;gt;&lt;br/&gt;
	&amp;lt;ref bean=&quot;jsonProvider&quot;/&amp;gt;&lt;br/&gt;
  &amp;lt;/jaxrs:providers&amp;gt;    &lt;br/&gt;
&amp;lt;/jaxrs:server&amp;gt;&lt;/p&gt;

&lt;p&gt;Unluckily, after doing that change we find out the second problem:&lt;/p&gt;

&lt;p&gt;2) ClientAccessToken does not have a no-arg default constructor, so it&apos;s not JAXB compliant, and the default JSON provider is unable to serialize the data:&lt;br/&gt;
org.apache.cxf.rs.security.oauth2.common.AccessToken does not have a no-arg default constructor.&lt;br/&gt;
	this problem is related to the following location:&lt;br/&gt;
		at org.apache.cxf.rs.security.oauth2.common.AccessToken&lt;br/&gt;
		at org.apache.cxf.rs.security.oauth2.common.ClientAccessToken&lt;/p&gt;

&lt;p&gt;The only way I&apos;ve found to overcome both limitations is changing the JSON provider to Codehaus jackson:&lt;/p&gt;

&lt;p&gt;&amp;lt;bean id=&quot;jacksonObjectMapper&quot; class=&quot;org.codehaus.jackson.map.ObjectMapper&quot;/&amp;gt;&lt;br/&gt;
&amp;lt;bean id=&quot;jsonProvider&quot; class=&quot;org.codehaus.jackson.jaxrs.JacksonJaxbJsonProvider&quot;&amp;gt;&lt;br/&gt;
  &amp;lt;property name=&quot;mapper&quot; ref=&quot;jacksonObjectMapper&quot; /&amp;gt;&lt;br/&gt;
&amp;lt;/bean&amp;gt;&lt;/p&gt;

&lt;p&gt;&amp;lt;jaxrs:server id=&quot;oauth2Server&quot; address=&quot;/oauth2&quot;&amp;gt;&lt;br/&gt;
  &amp;lt;jaxrs:serviceBeans&amp;gt;&lt;br/&gt;
    &amp;lt;ref bean=&quot;accessTokenService2&quot;/&amp;gt;&lt;br/&gt;
  &amp;lt;/jaxrs:serviceBeans&amp;gt;&lt;br/&gt;
  &amp;lt;jaxrs:providers&amp;gt;&lt;br/&gt;
    &amp;lt;ref bean=&quot;jsonProvider&quot;/&amp;gt;&lt;br/&gt;
  &amp;lt;/jaxrs:providers&amp;gt;    &lt;br/&gt;
&amp;lt;/jaxrs:server&amp;gt;&lt;/p&gt;

&lt;p&gt;Here you can see a response generated using this new provider:&lt;/p&gt;

&lt;p&gt;Response-Code: 200&lt;br/&gt;
Content-Type: application/json&lt;br/&gt;
Headers: &lt;/p&gt;
{Cache-Control=[no-store], Pragma=[no-cache], Date=[Fri, 11 May 2012 11:11:29 GMT]}
&lt;p&gt;Payload: {&quot;tokenKey&quot;:&quot;e91ffcefb133de5eb7ebd02c25e7886e&quot;,&quot;tokenType&quot;:&quot;bearer&quot;,&quot;parameters&quot;:{},&quot;approvedScope&quot;:null,&quot;refreshToken&quot;:null}&lt;/p&gt;

&lt;p&gt;So far all the work is done at the server side, but what about the client side?&lt;/p&gt;

&lt;p&gt;If we try to de-serialize an access token response using CXF client capabilities (org.apache.cxf.jaxrs.client.WebClient), we will find the same already known problems: &lt;/p&gt;

&lt;p&gt;a) With jettison: &lt;br/&gt;
No message body reader has been found for class : class org.apache.cxf.rs.security.oauth2.common.ClientAccessToken, ContentType : application/json&lt;/p&gt;

&lt;p&gt;Adding the &quot;jaxbElementClassMap&quot; property to the provider, will stop us at the no-arg default constructor problem:&lt;/p&gt;

&lt;p&gt;JSONProvider&amp;lt;?&amp;gt; provider = new JSONProvider&amp;lt;Object&amp;gt;();&lt;br/&gt;
provider.setJaxbElementClassMap(Collections.singletonMap(&quot;org.apache.cxf.rs.security.oauth2.common.ClientAccessToken&quot;, &quot;ClientAccessToken&quot;));&lt;/p&gt;

&lt;p&gt;WebClient client = WebClient.create(&quot;http://localhost:8080/fwmobisecurity2/services/oauth2&quot;, Collections.singletonList(provider));&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;br/&gt;
ClientAccessToken obj = client.post(formData, ClientAccessToken.class);&lt;/p&gt;

&lt;p&gt;b) With jackson:&lt;br/&gt;
No suitable constructor found for type &lt;span class=&quot;error&quot;&gt;&amp;#91;simple type, class org.apache.cxf.rs.security.oauth2.common.ClientAccessToken&amp;#93;&lt;/span&gt;: can not instantiate from JSON object (need to add/enable type information?)&lt;/p&gt;

&lt;p&gt;Luckily, jackson offers &quot;Mix-in Annotations&quot; that allow us to define which constructor to use, and its parameter binding:&lt;/p&gt;

&lt;p&gt;First we must create a class with the following content:&lt;/p&gt;

&lt;p&gt;import org.codehaus.jackson.annotate.JsonCreator;&lt;br/&gt;
import org.codehaus.jackson.annotate.JsonProperty;&lt;/p&gt;

&lt;p&gt;public abstract class ClientAccessTokenDeserializeInfo {&lt;/p&gt;

&lt;p&gt;	@JsonCreator&lt;br/&gt;
	ClientAccessTokenDeserializeInfo(&lt;br/&gt;
			@JsonProperty(value=&quot;tokenType&quot;) String tokenType, &lt;br/&gt;
			@JsonProperty(value=&quot;tokenKey&quot;) String tokenKey) { }&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;And then we map it to the ClientAccessToken class:&lt;/p&gt;

&lt;p&gt;JacksonJsonProvider provider = new JacksonJsonProvider();&lt;br/&gt;
ObjectMapper mapper = new ObjectMapper();&lt;br/&gt;
mapper.getDeserializationConfig().addMixInAnnotations(ClientAccessToken.class, ClientAccessTokenDeserializeInfo.class);&lt;br/&gt;
provider.setMapper(mapper);&lt;/p&gt;

&lt;p&gt;WebClient client = WebClient.create(&quot;http://localhost:8080/fwmobisecurity2/services/oauth2&quot;, Collections.singletonList(provider));&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;br/&gt;
ClientAccessToken obj = client.post(formData, ClientAccessToken.class);&lt;/p&gt;

&lt;p&gt;Conclusion: Without changing ClientAccessToken source code, jackson JSON provider MUST be used at server and client sides&lt;/p&gt;</description>
                <environment></environment>
        <key id="12554893">CXF-4309</key>
            <summary>OAuth2 Access Token Service: returned ClientAccessToken is not JAXB compliant</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sergey_beryozkin">Sergey Beryozkin</assignee>
                                    <reporter username="jordi">Jordi Gerona</reporter>
                        <labels>
                            <label>jax-rs</label>
                            <label>jaxb</label>
                            <label>oauth2</label>
                    </labels>
                <created>Fri, 11 May 2012 12:14:04 +0000</created>
                <updated>Tue, 5 Jun 2012 13:31:31 +0000</updated>
                            <resolved>Mon, 14 May 2012 14:12:05 +0000</resolved>
                                    <version>2.6</version>
                                    <fixVersion>2.6.1</fixVersion>
                                    <component>JAX-RS Security</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13273203" author="sergey_beryozkin" created="Fri, 11 May 2012 12:37:02 +0000"  >&lt;p&gt;Can you please try org.apache.cxf.rs.security.oauth2.provider.OAuthJSONProvider ?&lt;/p&gt;

&lt;p&gt;The problem with using JSONProvider or Jackson dealing with OAuth2 access tokens or errors is that they are represented as flat sequences, and access tokens (thinking of MAC for ex) can have few extra properties, so it it is tricky to figure out where is what when reading with generic providers like JSONProvider/etc&lt;/p&gt;</comment>
                            <comment id="13273244" author="jordi" created="Fri, 11 May 2012 13:22:39 +0000"  >&lt;p&gt;Great!!! With &quot;org.apache.cxf.rs.security.oauth2.provider.OAuthJSONProvider&quot; the OAuth2 server serializes ClientAccessToken with no problems (and without any special configuration):&lt;br/&gt;
---------------------------&lt;br/&gt;
ID: 2&lt;br/&gt;
Response-Code: 200&lt;br/&gt;
Content-Type: application/json&lt;br/&gt;
Headers: &lt;/p&gt;
{Cache-Control=[no-store], Pragma=[no-cache], Date=[Fri, 11 May 2012 13:10:54 GMT]}
&lt;p&gt;Payload: &lt;/p&gt;
{&quot;access_token&quot;:&quot;9e2e647541e87dc62778bb9f484db8&quot;,&quot;token_type&quot;:&quot;bearer&quot;}
&lt;p&gt;--------------------------------------&lt;br/&gt;
Now, no empty attributes are sent and properties names change: tokenKey-&amp;gt;access_token and tokenType-&amp;gt;token_type.&lt;/p&gt;

&lt;p&gt;But at client side, the following code is still unable to de-serialize the response:&lt;/p&gt;

&lt;p&gt;OAuthJSONProvider provider = new OAuthJSONProvider();&lt;br/&gt;
WebClient client2 = WebClient.create(&quot;http://localhost:8080/fwmobisecurity2/services/oauth2&quot;, &lt;br/&gt;
	Collections.singletonList(provider));&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;br/&gt;
ClientAccessToken obj = client2.post(formData, ClientAccessToken.class);&lt;/p&gt;

&lt;p&gt;Received error:&lt;/p&gt;

&lt;p&gt;May 11, 2012 3:10:54 PM org.apache.cxf.jaxrs.client.AbstractClient reportMessageHandlerProblem&lt;br/&gt;
SEVERE: .No message body reader has been found for class : class org.apache.cxf.rs.security.oauth2.common.ClientAccessToken, ContentType : application/json&lt;/p&gt;</comment>
                            <comment id="13273303" author="sergey_beryozkin" created="Fri, 11 May 2012 14:43:05 +0000"  >&lt;p&gt;Hi, you need to add .accept(&quot;application/json&quot;), it should do it&lt;/p&gt;</comment>
                            <comment id="13273325" author="jordi" created="Fri, 11 May 2012 15:03:47 +0000"  >&lt;p&gt;I&apos;m sorry Sergey but this does not solve the problem. I&apos;m still getting:&lt;br/&gt;
org.apache.cxf.jaxrs.client.ClientWebApplicationException: .No message body reader has been found for class : class org.apache.cxf.rs.security.oauth2.common.ClientAccessToken&lt;/p&gt;

&lt;p&gt;To run the tests, I use the following code: &lt;/p&gt;

&lt;p&gt;OAuthJSONProvider provider = new OAuthJSONProvider();&lt;br/&gt;
WebClient client2 = WebClient.create(&quot;http://localhost:8080/fwmobisecurity2/services/oauth2&quot;, Collections.singletonList(provider));&lt;br/&gt;
client2.path(&quot;token&quot;);&lt;br/&gt;
client2.type(&quot;application/x-www-form-urlencoded&quot;);&lt;br/&gt;
client2.accept(&quot;application/json&quot;);&lt;/p&gt;

&lt;p&gt;formData = new Form();&lt;br/&gt;
formData.set(OAuthConstants.CLIENT_ID, &quot;aKey&quot;);&lt;br/&gt;
formData.set(OAuthConstants.CLIENT_SECRET, &quot;aSecret&quot;);			&lt;br/&gt;
formData.set(&quot;grant_type&quot;,OAuthConstants.CLIENT_CREDENTIALS_GRANT);&lt;br/&gt;
formData.set(&quot;scope&quot;,&quot;read_profile_scope&quot;);&lt;/p&gt;

&lt;p&gt;ClientAccessToken obj = client2.post(formData, ClientAccessToken.class);&lt;/p&gt;

&lt;p&gt;I also tried with:&lt;br/&gt;
client2.accept(&quot;text/html,application/xhtml+xml,application/xml;q=0.9,&lt;b&gt;/&lt;/b&gt;;q=0.8&quot;);&lt;/p&gt;

&lt;p&gt;and&lt;br/&gt;
client2.accept(&quot;application/json,text/html,application/xhtml+xml,application/xml;q=0.9,&lt;b&gt;/&lt;/b&gt;;q=0.8&quot;);&lt;/p&gt;

&lt;p&gt;but the result is always the same&lt;/p&gt;</comment>
                            <comment id="13273333" author="sergey_beryozkin" created="Fri, 11 May 2012 15:07:16 +0000"  >&lt;p&gt;Sorry, it only supports a Map on the read, can use OAuthClientUtils in the oauth2 package for getting the token ?&lt;br/&gt;
I&apos;ll check if it is possible to enhance the provider a bit&lt;/p&gt;</comment>
                            <comment id="13273353" author="jordi" created="Fri, 11 May 2012 15:33:31 +0000"  >&lt;p&gt;OK, I&apos;ve changed the code to:&lt;/p&gt;

&lt;p&gt;OAuthJSONProvider provider = new OAuthJSONProvider();&lt;br/&gt;
WebClient client2 = WebClient.create(&quot;http://localhost:8080/fwmobisecurity2/services/oauth2&quot;, Collections.singletonList(provider));&lt;br/&gt;
client2.path(&quot;token&quot;);&lt;br/&gt;
client2.type(&quot;application/x-www-form-urlencoded&quot;);&lt;br/&gt;
client2.accept(&quot;application/json&quot;);&lt;/p&gt;

&lt;p&gt;MyClientCredentialsGrant grant = new MyClientCredentialsGrant();&lt;br/&gt;
grant.setScope(&quot;read_profile_scope&quot;);&lt;/p&gt;

&lt;p&gt;ClientAccessToken obj = OAuthClientUtils.getAccessToken(client2, consumer, grant, false);&lt;/p&gt;

&lt;p&gt;and now I can get the token without any problems. Thank you very much for your time and help. You do a great job!!!&lt;/p&gt;

&lt;p&gt;Regards&lt;/p&gt;</comment>
                            <comment id="13274605" author="sergey_beryozkin" created="Mon, 14 May 2012 14:11:45 +0000"  >&lt;p&gt;I&apos;ve updated the provider to return a token directly if required. Also, &quot;scope&quot;, &quot;expires_in&quot;, &quot;refresh_token&quot; and custom token parameters if any will also be reported, but it can be disabled by setting a &apos;writeOptionalParameters&apos; to &apos;false&apos; on AccessTokenService&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>239146</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 28 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08953:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>46080</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>