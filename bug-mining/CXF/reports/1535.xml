<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:56:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-4616] When creating DataContentHandler, defaultCommandMap should be considered.</title>
                <link>https://issues.apache.org/jira/browse/CXF-4616</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;When creating DataContentHandler, null may be returned from CXF&apos;s static CommandMap. DefaultCommandMap from &lt;b&gt;CommandMap.getDefaultCommandMap()&lt;/b&gt; could also be used to create DataContentHandler. &lt;br/&gt;
Because in RI implementation,xxx.&lt;b&gt;saaj.soap.AttachmentPartImpl&lt;/b&gt;, &lt;br/&gt;
Some static statement would add specific content handler to default CommandMap.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;CommandMap localCommandMap = CommandMap.getDefaultCommandMap();
localMailcapCommandMap.addMailcap(&lt;span class=&quot;code-quote&quot;&gt;&quot;text/xml&quot;&lt;/span&gt; + str + &lt;span class=&quot;code-quote&quot;&gt;&quot;xxx.saaj.soap.XmlDataContentHandler&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12614915">CXF-4616</key>
            <summary>When creating DataContentHandler, defaultCommandMap should be considered.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dkulp">Daniel Kulp</assignee>
                                    <reporter username="ivywjhua">Jinhua Wang</reporter>
                        <labels>
                    </labels>
                <created>Tue, 6 Nov 2012 07:57:45 +0000</created>
                <updated>Wed, 19 Dec 2012 14:38:41 +0000</updated>
                            <resolved>Mon, 12 Nov 2012 20:01:08 +0000</resolved>
                                    <version>2.6.3</version>
                                    <fixVersion>2.6.4</fixVersion>
                    <fixVersion>2.7.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13492730" author="dkulp" created="Wed, 7 Nov 2012 21:45:34 +0000"  >&lt;p&gt;Are you sure this will do what you need?&lt;/p&gt;

&lt;p&gt;In my testing with the CXF test suite and a few other tests, the call to:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;DataContentHandler dch = &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.createDataContentHandler(mimeType);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;in your patch never once returned null.  Especially for text/xml, text/plain, etc....  Thus, the default map would never have been consulted.    If I do:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; mt : COMMAND_MAP.getMimeTypes()) {
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(mt);
            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (CommandInfo ci : COMMAND_MAP.getAllCommands(mt)) {
                &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;  &quot;&lt;/span&gt; + ci.getCommandName() + &lt;span class=&quot;code-quote&quot;&gt;&quot;  &quot;&lt;/span&gt; + ci.getCommandClass());
            }
        }  
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I get:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;image/*
  content-handler  org.apache.cxf.attachment.ImageDataContentHandler
message/rfc822
  content-handler  com.sun.mail.handlers.message_rfc822
multipart/*
  content-handler  com.sun.mail.handlers.multipart_mixed
text/plain
  content-handler  com.sun.mail.handlers.text_plain
  view  com.sun.activation.viewers.TextViewer
  edit  com.sun.activation.viewers.TextEditor
text/xml
  content-handler  com.sun.mail.handlers.text_xml
  view  com.sun.activation.viewers.TextViewer
  edit  com.sun.activation.viewers.TextEditor
text/html
  content-handler  com.sun.mail.handlers.text_html
  view  com.sun.activation.viewers.TextViewer
  edit  com.sun.activation.viewers.TextEditor
image/jpeg
  content-handler  org.apache.cxf.attachment.ImageDataContentHandler
  view  com.sun.activation.viewers.ImageViewer
image/gif
  content-handler  org.apache.cxf.attachment.ImageDataContentHandler
  view  com.sun.activation.viewers.ImageViewer
text/*
  view  com.sun.activation.viewers.TextViewer
  edit  com.sun.activation.viewers.TextEditor
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;which shows a content-handler for text/xml.   This is with the sun mail.jar on the classpath.  With the geronimo mail.jar, you get a similar map, but with geronimo class names.&lt;/p&gt;


&lt;p&gt;In addition, if you are adding things into default map in a static initializer, you could just call AttachmentUtil.getCommandMap() and add things in there as well.&lt;/p&gt;

</comment>
                            <comment id="13493041" author="ivywjhua" created="Thu, 8 Nov 2012 08:38:09 +0000"  >&lt;p&gt;Thank you Daniel.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;When constructing MailcapCommandMap or its subclass, constructor would load resources from &quot;META-INF/mailcap&quot; which can be found from mail.jar. Therefore when mail.jar on the classpath, specific content-handlers are found and printed.If without mail.jar on the classpath, those content-handlers printed out cannot be found.&lt;/li&gt;
	&lt;li&gt;There are different dataContentHandler implementations, such as
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;RI&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;no config/static initializer from AttachmentPartImpl&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;javamail&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;load config from meta/mailcap&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;geronimo-mail&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;load config from meta/mailcap&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;If without javamail or geronimo on classpath, there is only ImageDataContentHandler provided by cxf.&lt;br/&gt;
Content-handler provided by RI is preferred when mail.jar is not on the classpath.&lt;br/&gt;
Therefore, a new subclass of MailcapCommandMap is created to get defaultCommadMap configurations which have been filled by a static initializer in RI.&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;There is a sequence issue between static initializer and adding things to AttachmentUtil.getCommandMap().
	&lt;ul&gt;
		&lt;li&gt;As it is a static initializer in RI(AttachmentPartImpl), static initializer is invoked by JVM and out of our control.&lt;/li&gt;
		&lt;li&gt;That is before static initializer execution, there is nothing in defaultCommandMap. And there is nothing to be added to AttachmentUtil.getCommandMap().&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;Update EnhancedMailcapCommandMap and add two CommandMap test in attachments.&lt;br/&gt;
EnhancedMailcapCommandMap overrides getAllCommands(), getCommand(), getMimeTypes methods.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Please help to review my thoughts and code.&lt;/p&gt;






</comment>
                            <comment id="13494085" author="dkulp" created="Fri, 9 Nov 2012 16:20:13 +0000"  >
&lt;p&gt;Can I ask one more question for you to investigate:&lt;/p&gt;

&lt;p&gt;CXF attachment support requires that the class javax.mail.internet.InternetHeaders is found on the classpath.  Without a mail jar (geronimo or the oracle version), any idea where that class is coming from in your case?&lt;/p&gt;

&lt;p&gt;In our WHICH-JARS file, we specifically state that geronimo-javamail (or sun equivalent) is a REQUIRED jar.   I&apos;m mostly curious where the InternetHeaders class is coming from if there isn&apos;t a mail jar there.  &lt;/p&gt;
</comment>
                            <comment id="13495149" author="ivywjhua" created="Mon, 12 Nov 2012 08:31:19 +0000"  >&lt;p&gt;Hi, Danidel, the whole application is running in OSGi environment, and those mail classes are imported. Due to well known issue for exposing META-INF directories in OSGi, those mailcap files are not discovered, then we add the hook to expose those files. The bad thing is that, the javamail version we used has some issues for handling the text/xml messages. &lt;/p&gt;

&lt;p&gt;After some investigation, I found that the RI SAAJ impl also tries to register the correct handlers in the default map explicitly (Not via expose mailcap files). In the current CXF codes, it will create a new map for the DataHandler (by default, the Default Map will be used), I am thinking that CXF may need to consider this situation. Let&apos;s say, some third-party (e.g. SAAI RI) will register their own handlers programmically, and CXF changed the handler map explicitly, it somewhat will ignore those handlers in the default map. That is why I would suggest to create an enhanced map for this, and it will be more compatibile in those application environments.&lt;/p&gt;

&lt;p&gt;CommandMapImpactTest as attached is created under &quot;/cxf-api/src/test/java/org/apache/cxf/attachment/&quot; and CommandMap impact has been tested.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java mail on classpath 	jar:file:/D:/appdata/m2repo/org/apache/geronimo/specs/geronimo-javamail_1.4_spec/1.7.1/geronimo-javamail_1.4_spec-1.7.1.jar!/META-INF/mailcap
NewCommandMap:		content type is &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;
NewCommandMap:		dataContentHanlder type is &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.geronimo.mail.handlers.XMLHandler

java mail on classpath 	jar:file:/D:/appdata/m2repo/org/apache/geronimo/specs/geronimo-javamail_1.4_spec/1.7.1/geronimo-javamail_1.4_spec-1.7.1.jar!/META-INF/mailcap
Default CommandMap:	content type is &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;javax.xml.transform.stream.StreamSource
Default CommandMap:	dataContentHanlder type is &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;com.sun.xml.internal.messaging.saaj.soap.XmlDataContentHandler

java mail on classpath 	jar:file:/D:/appdata/m2repo/org/apache/geronimo/specs/geronimo-javamail_1.4_spec/1.7.1/geronimo-javamail_1.4_spec-1.7.1.jar!/META-INF/mailcap
No explicit CommandMap:	content type is &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;javax.xml.transform.stream.StreamSource
No explicit CommandMap	dataContentHanlder type is &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;com.sun.xml.internal.messaging.saaj.soap.XmlDataContentHandler

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

</comment>
                            <comment id="13495467" author="dkulp" created="Mon, 12 Nov 2012 18:16:20 +0000"  >
&lt;p&gt;Ah.  OSGi....  that certainly explains a lot.  &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;   Sometimes I really find OSGi (and the differences between it an non-osgi runtimes) annoying.&lt;/p&gt;

&lt;p&gt;Anyway, that analysis makes sense within OSGi when using some mail providers.  I&apos;d likely want to check the servicemix specs version of the mail bundle to see if it handles the mailcaps better.   But that&apos;s just an aside.  &lt;/p&gt;

&lt;p&gt;Thanks for the extra information.  Definitely helps understand the environment that is causing the issues.  &lt;/p&gt;

</comment>
                    </comments>
                    <attachments>
                            <attachment id="12552236" name="AttachmentUtil.java.patch" size="552" author="ivywjhua" created="Tue, 6 Nov 2012 07:59:43 +0000"/>
                            <attachment id="12552781" name="AttachmentUtilTest.java" size="3502" author="ivywjhua" created="Fri, 9 Nov 2012 06:42:08 +0000"/>
                            <attachment id="12552782" name="AttachmentUtilWithoutAttachmentPartTest.java" size="1351" author="ivywjhua" created="Fri, 9 Nov 2012 06:42:08 +0000"/>
                            <attachment id="12553087" name="CommandMapImpactTest.java" size="5892" author="ivywjhua" created="Mon, 12 Nov 2012 08:27:02 +0000"/>
                            <attachment id="12552780" name="EnhancedMailcapCommandMap.java" size="4010" author="ivywjhua" created="Fri, 9 Nov 2012 06:42:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>255427</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 2 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ervr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>84281</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>