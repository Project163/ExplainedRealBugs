<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:32:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-7765] URITemplate.compareTemplates returns inconsistent results</title>
                <link>https://issues.apache.org/jira/browse/CXF-7765</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;When&#160;org.apache.cxf.jaxrs.model.URITemplate.compareTemplates() is passed two templates with the same number of literal characters, it returns -1 regardless of the order the templates a passed in. I suppose this may be on purpose, but the result is that if compareTemplates() is used as the basis of a Comparator&amp;lt;URITemplate&amp;gt;&#160;that is used by java.util.Collections.sort()&#160;it can result in:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;java.lang.IllegalArgumentException: Comparison method violates its general contract!&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;I would also expect that this would result in some degree of unpredictability of the prioritization of when selecting the appropriate JAX-RS method to call for a given request.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13166977">CXF-7765</key>
            <summary>URITemplate.compareTemplates returns inconsistent results</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="coheigea">Colm O hEigeartaigh</assignee>
                                    <reporter username="svella">Shon Vella</reporter>
                        <labels>
                    </labels>
                <created>Tue, 19 Jun 2018 17:13:53 +0000</created>
                <updated>Wed, 3 Oct 2018 13:33:19 +0000</updated>
                            <resolved>Tue, 26 Jun 2018 23:04:08 +0000</resolved>
                                    <version>3.1.15</version>
                                    <fixVersion>3.2.6</fixVersion>
                    <fixVersion>3.1.17</fixVersion>
                                    <component>JAX-RS</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16517340" author="svella" created="Tue, 19 Jun 2018 17:22:21 +0000"  >&lt;p&gt;Suggested fix:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; compareTemplates(URITemplate t1, URITemplate t2) {
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; l1 = t1.getLiteralChars().length();
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; l2 = t2.getLiteralChars().length();
    &lt;span class=&quot;code-comment&quot;&gt;// descending order
&lt;/span&gt;    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; result = l1 &amp;lt; l2 ? 1 : l1 &amp;gt; l2 ? -1 : 0;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (result == 0) {
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; g1 = t1.getVariables().size();
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; g2 = t2.getVariables().size();
        &lt;span class=&quot;code-comment&quot;&gt;// descending order
&lt;/span&gt;        result = g1 &amp;lt; g2 ? 1 : g1 &amp;gt; g2 ? -1 : 0;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (result == 0) {
            &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; gCustom1 = t1.getCustomVariables().size();
            &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; gCustom2 = t2.getCustomVariables().size();
            result = gCustom1 &amp;lt; gCustom2 ? 1 : gCustom1 &amp;gt; gCustom2 ? -1 : 0;
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (result == 0) {
                result = t1.getPatternValue().compareTo(t2.getPatternValue());
            }
        }
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; result
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16518956" author="deki" created="Thu, 21 Jun 2018 06:09:00 +0000"  >&lt;p&gt;Can you open a PR for it? &lt;a href=&quot;https://github.com/apache/cxf/pulls&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pulls&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Makes it easier to review and apply.&lt;/p&gt;</comment>
                            <comment id="16519242" author="coheigea" created="Thu, 21 Jun 2018 11:31:05 +0000"  >&lt;p&gt;There is definitely a bug there, but I&apos;m not sure about the suggested fix - it removes the check for String equality on the literalChars that is currently there and replaces it with a comparison on the length of the literalChars. A better idea might be to compare the literalChars using String.compareTo instead.&lt;/p&gt;</comment>
                            <comment id="16521279" author="svella" created="Sat, 23 Jun 2018 21:42:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=deki&quot; class=&quot;user-hover&quot; rel=&quot;deki&quot;&gt;deki&lt;/a&gt;&#160;- Will try to find time to do that.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=coheigea%40progress.com&quot; class=&quot;user-hover&quot; rel=&quot;coheigea@progress.com&quot;&gt;coheigea@progress.com&lt;/a&gt;, I&apos;m reasonably sure the lexical ordering of the strings is uninteresting as this is being used to prioritize match patterns and the longer the number of literal characters that match, the higher priority. Lexical ordering becomes a last resort when all the more important factors have compared equal and is handled by the string comparison of the pattern values at the end.&lt;/p&gt;</comment>
                            <comment id="16522338" author="coheigea" created="Mon, 25 Jun 2018 14:27:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=svella&quot; class=&quot;user-hover&quot; rel=&quot;svella&quot;&gt;svella&lt;/a&gt;, could you submit a PR or a patch (and ideally a unit test in URITemplateTest)?&lt;/p&gt;</comment>
                            <comment id="16522883" author="githubbot" created="Mon, 25 Jun 2018 22:19:19 +0000"  >&lt;p&gt;svella opened a new pull request #425: &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7765&quot; title=&quot;URITemplate.compareTemplates returns inconsistent results&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7765&quot;&gt;&lt;del&gt;CXF-7765&lt;/del&gt;&lt;/a&gt; - URITemplate.compareTemplates returns inconsistent results&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/cxf/pull/425&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/425&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Proposed fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7765&quot; title=&quot;URITemplate.compareTemplates returns inconsistent results&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7765&quot;&gt;&lt;del&gt;CXF-7765&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16523897" author="coheigea" created="Tue, 26 Jun 2018 15:52:06 +0000"  >&lt;p&gt;I&apos;m wondering if the fall back to &quot;t1.getPatternValue().compareTo(t2.getPatternValue()&quot; should also be in &quot;descending order&quot; like the other comparisons?&lt;/p&gt;</comment>
                            <comment id="16524104" author="svella" created="Tue, 26 Jun 2018 18:41:47 +0000"  >&lt;p&gt;I don&apos;t think it really matters either way other than that changing it would behave differently than in the past for some cases that aren&apos;t currently a problem and as such has a small chance of causing someone somewhere a little grief.&lt;/p&gt;</comment>
                            <comment id="16524208" author="githubbot" created="Tue, 26 Jun 2018 21:04:01 +0000"  >&lt;p&gt;coheigea closed pull request #425: &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7765&quot; title=&quot;URITemplate.compareTemplates returns inconsistent results&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7765&quot;&gt;&lt;del&gt;CXF-7765&lt;/del&gt;&lt;/a&gt; - URITemplate.compareTemplates returns inconsistent results&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/cxf/pull/425&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/425&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/rt/frontend/jaxrs/src/main/java/org/apache/cxf/jaxrs/model/URITemplate.java b/rt/frontend/jaxrs/src/main/java/org/apache/cxf/jaxrs/model/URITemplate.java&lt;br/&gt;
index b5059f3ddca..b9f0232d1a9 100644&lt;br/&gt;
&amp;#8212; a/rt/frontend/jaxrs/src/main/java/org/apache/cxf/jaxrs/model/URITemplate.java&lt;br/&gt;
+++ b/rt/frontend/jaxrs/src/main/java/org/apache/cxf/jaxrs/model/URITemplate.java&lt;br/&gt;
@@ -377,28 +377,24 @@ public static URITemplate createExactTemplate(String pathValue) {&lt;br/&gt;
     }&lt;/p&gt;

&lt;p&gt;     public static int compareTemplates(URITemplate t1, URITemplate t2) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;String l1 = t1.getLiteralChars();&lt;/li&gt;
	&lt;li&gt;String l2 = t2.getLiteralChars();&lt;/li&gt;
	&lt;li&gt;if (!l1.equals(l2)) 
{
-            // descending order
-            return l1.length() &amp;lt; l2.length() ? 1 : -1;
-        }
&lt;p&gt;-&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;int g1 = t1.getVariables().size();&lt;/li&gt;
	&lt;li&gt;int g2 = t2.getVariables().size();&lt;br/&gt;
+        int l1 = t1.getLiteralChars().length();&lt;br/&gt;
+        int l2 = t2.getLiteralChars().length();&lt;br/&gt;
         // descending order&lt;/li&gt;
	&lt;li&gt;int result = g1 &amp;lt; g2 ? 1 : g1 &amp;gt; g2 ? -1 : 0;&lt;br/&gt;
+        int result = l1 &amp;lt; l2 ? 1 : l1 &amp;gt; l2 ? -1 : 0;&lt;br/&gt;
         if (result == 0) {&lt;/li&gt;
	&lt;li&gt;int gCustom1 = t1.getCustomVariables().size();&lt;/li&gt;
	&lt;li&gt;int gCustom2 = t2.getCustomVariables().size();&lt;/li&gt;
	&lt;li&gt;if (gCustom1 != gCustom2) {&lt;/li&gt;
	&lt;li&gt;// descending order&lt;/li&gt;
	&lt;li&gt;return gCustom1 &amp;lt; gCustom2 ? 1 : -1;&lt;br/&gt;
+            int g1 = t1.getVariables().size();&lt;br/&gt;
+            int g2 = t2.getVariables().size();&lt;br/&gt;
+            // descending order&lt;br/&gt;
+            result = g1 &amp;lt; g2 ? 1 : g1 &amp;gt; g2 ? -1 : 0;&lt;br/&gt;
+            if (result == 0) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+                int gCustom1 = t1.getCustomVariables().size();+                int gCustom2 = t2.getCustomVariables().size();+                result = gCustom1 &amp;lt; gCustom2 ? 1 }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;         }&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;if (result == 0) 
{
-            result = t1.getPatternValue().compareTo(t2.getPatternValue());
-        }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         return result;&lt;br/&gt;
     }&lt;br/&gt;
diff --git a/rt/frontend/jaxrs/src/test/java/org/apache/cxf/jaxrs/model/URITemplateTest.java b/rt/frontend/jaxrs/src/test/java/org/apache/cxf/jaxrs/model/URITemplateTest.java&lt;br/&gt;
index 97e53637479..7d2ac299ba0 100644&lt;br/&gt;
&amp;#8212; a/rt/frontend/jaxrs/src/test/java/org/apache/cxf/jaxrs/model/URITemplateTest.java&lt;br/&gt;
+++ b/rt/frontend/jaxrs/src/test/java/org/apache/cxf/jaxrs/model/URITemplateTest.java&lt;br/&gt;
@@ -740,4 +740,17 @@ public void testEncodeLiteralCharactersNotVariable() {&lt;br/&gt;
         //System.out.println(ut.encodeLiteralCharacters());&lt;br/&gt;
         assertEquals(&quot;a%20&lt;/p&gt;
{digit:[0-9]}
&lt;p&gt;%20b&quot;, ut.encodeLiteralCharacters(false));&lt;br/&gt;
     }&lt;br/&gt;
+&lt;br/&gt;
+    @Test&lt;br/&gt;
+    public void testCompareNumberOfLiteralCharacters() &lt;/p&gt;
{
+        URITemplate t1 = new URITemplate(&quot;/foo&quot;);
+        URITemplate t2 = new URITemplate(&quot;/bar&quot;);
+        URITemplate t3 = new URITemplate(&quot;/foo/bar&quot;);
+        assertEquals(0, URITemplate.compareTemplates(t1, t1));
+        assertTrue(URITemplate.compareTemplates(t1, t3) &amp;gt; 0);
+        assertTrue(URITemplate.compareTemplates(t3, t1) &amp;lt; 0);
+        assertEquals(Integer.signum(URITemplate.compareTemplates(t1, t2)),
+                -Integer.signum(URITemplate.compareTemplates(t2, t1)));
+    }
&lt;p&gt;+&lt;br/&gt;
 }&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 21 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3v0pj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>