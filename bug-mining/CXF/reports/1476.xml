<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:55:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-4533] Encoding error in CachedOutputStream when double-byte char is on 1024 byte boundary</title>
                <link>https://issues.apache.org/jira/browse/CXF-4533</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;We experience occasional encoding errors where a small number of two-byte chars get encoded wrong in an otherwise correct encoded message. I have traced the problem to the writeCacheTo method of CachedOutputStream where the temp cached file is read as 1024 bytes at the time which are then converted to a String before getting appended to the StringBuilder. If the 1024 byte boundary falls right between the two bytes of a two byte char the encoding fails.&lt;/p&gt;


&lt;p&gt;public void writeCacheTo(StringBuilder out, String charsetName) throws IOException {&lt;br/&gt;
   flush();&lt;br/&gt;
   if (inmem) {&lt;br/&gt;
      if (currentStream instanceof ByteArrayOutputStream) &lt;/p&gt;
{
         byte[] bytes = ((ByteArrayOutputStream)currentStream).toByteArray();
         out.append(IOUtils.newStringFromBytes(bytes, charsetName));
      }
&lt;p&gt; else &lt;/p&gt;
{
         throw new IOException(&quot;Unknown format of currentStream&quot;);
      }
&lt;p&gt;   } else {&lt;br/&gt;
      // read the file&lt;br/&gt;
      FileInputStream fin = new FileInputStream(tempFile);&lt;br/&gt;
      byte bytes[] = new byte&lt;span class=&quot;error&quot;&gt;&amp;#91;1024&amp;#93;&lt;/span&gt;;&lt;br/&gt;
      int x = fin.read(bytes);&lt;br/&gt;
      while (x != -1) &lt;/p&gt;
{
         out.append(IOUtils.newStringFromBytes(bytes, charsetName, 0, x));
         x = fin.read(bytes);
      }
&lt;p&gt;      fin.close();&lt;br/&gt;
   }&lt;br/&gt;
}&lt;/p&gt;


&lt;p&gt;Below is a couple of lines from the hex-dump of the cache-file where you can see that the second o-slash in the file fall on a 1024 byte boundary and therefore gets corrupted in the outgoing message:&lt;/p&gt;

&lt;p&gt;0001fbe0:  66 66 65 6e 74 6c 69 67 20 66 c3 b8 72 74 69 64 73 70 65 6e 73 69 6f 6e 2c 20 73 6f 6d 20 66 c3  ffentlig f&#248;rtidspension, som f?&lt;br/&gt;
0001fc00:  b8 72 65 72 20 74 69 6c 2c 20 61 74 20 6d 65 64 6c 65 6d 3c 2f 70 67 66 3a 52 65 70 75 72 63 68  ?rer til, at medlem&amp;lt;/pgf:Repurch&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12609886">CXF-4533</key>
            <summary>Encoding error in CachedOutputStream when double-byte char is on 1024 byte boundary</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dkulp">Daniel Kulp</assignee>
                                    <reporter username="larsve">Lars Svensson</reporter>
                        <labels>
                    </labels>
                <created>Tue, 2 Oct 2012 08:50:42 +0000</created>
                <updated>Thu, 8 Nov 2012 17:14:58 +0000</updated>
                            <resolved>Tue, 2 Oct 2012 20:12:14 +0000</resolved>
                                    <version>2.3</version>
                    <version>2.6.2</version>
                                    <fixVersion>2.4.10</fixVersion>
                    <fixVersion>2.5.6</fixVersion>
                    <fixVersion>2.6.3</fixVersion>
                    <fixVersion>2.7</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>239835</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 8 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i00u9z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2837</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>