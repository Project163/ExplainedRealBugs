<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:20:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-6863] WS-RM 3.x does not work with attachments upon a network error</title>
                <link>https://issues.apache.org/jira/browse/CXF-6863</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;When sending messages with an attachment, the CXF 3.x WS-RM code may lose message at the client side when a network error occurs. This was working with CXF 2.x WS-RM.&lt;/p&gt;

&lt;p&gt;This problem is related to the change &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-4866&quot; title=&quot;WSRM in combination with WS-Security: timestamp problem&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-4866&quot;&gt;&lt;del&gt;CXF-4866&lt;/del&gt;&lt;/a&gt; which changed the way how the outgoing message is captured. Previously, the entire message was buffered and captured, which isolated this capturing from network issue. In 3.x, only the SOAP part is captured in this way and not the attachments. As a result, an exception will be thrown during the attachment serialization when a network error occurs and the message will not be correctly placed in the retransmission queue.&lt;/p&gt;

&lt;p&gt;By comparing CXF 3.x and 2.x code, &lt;/p&gt;

&lt;p&gt;In 3.x., AttachmentSerializer.writeProlog will directly writes to the IO and this can trigger a Fault from AttachmentOutInterceptor.handleMessage.&lt;/p&gt;

&lt;p&gt;URLConnectionHTTPConduit$URLConnectionWrappedOutputStream(AbstractThresholdOutputStream).write(byte[], int, int) line: 61	&lt;br/&gt;
URLConnectionHTTPConduit$URLConnectionWrappedOutputStream(AbstractWrappedOutputStream).write(byte[]) line: 60	&lt;br/&gt;
CacheAndWriteOutputStream.write(byte[]) line: 89	&lt;br/&gt;
AttachmentSerializer.writeProlog() line: 182	&lt;br/&gt;
AttachmentOutInterceptor.handleMessage(Message) line: 77	&lt;/p&gt;

&lt;p&gt;whereas in CXF 2.x, AttachmentSerializer.writeProlog will write to the buffered WriteOnCloseOutputStream, as its RetransmissionInterceptor inserts WriteOnCloseOutputStream to isolate itself from any network issue.&lt;/p&gt;

&lt;p&gt;WriteOnCloseOutputStream(CachedOutputStream).write(byte[]) line: 466	&lt;br/&gt;
CacheAndWriteOutputStream.write(byte[]) line: 89	&lt;br/&gt;
AttachmentSerializer.writeProlog() line: 172	&lt;br/&gt;
AttachmentOutInterceptor.handleMessage(Message) line: 72	&lt;/p&gt;

&lt;p&gt;CXF 2.x, RetransmissionInterceptor inserted WriteOnCloseOutputStream to capture the message entirely.&lt;/p&gt;

&lt;p&gt;There seem to be other issues with attachments handling in CXF 3.x. Along with other issues &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-6646&quot; title=&quot;CXF 3.x WSRM message may not be retrieved from database&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-6646&quot;&gt;&lt;del&gt;CXF-6646&lt;/del&gt;&lt;/a&gt;, I am not sure how we should fix all these issues.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12957143">CXF-6863</key>
            <summary>WS-RM 3.x does not work with attachments upon a network error</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ay">Akitoshi Yoshida</assignee>
                                    <reporter username="ay">Akitoshi Yoshida</reporter>
                        <labels>
                    </labels>
                <created>Fri, 8 Apr 2016 08:28:50 +0000</created>
                <updated>Fri, 14 Oct 2016 14:21:55 +0000</updated>
                            <resolved>Tue, 5 Jul 2016 15:55:59 +0000</resolved>
                                    <version>3.1.3</version>
                    <version>3.0.9</version>
                                    <fixVersion>3.1.7</fixVersion>
                    <fixVersion>3.2.0</fixVersion>
                                    <component>WS-* Components</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15313883" author="ay" created="Fri, 3 Jun 2016 09:10:30 +0000"  >&lt;p&gt;referencing the two tickets that are prerequisite for fixing this issue.&lt;/p&gt;</comment>
                            <comment id="15316668" author="kairo" created="Mon, 6 Jun 2016 15:38:50 +0000"  >&lt;p&gt;Hello Aki,&lt;br/&gt;
find attached a patch file to solve the issue.&lt;/p&gt;

&lt;p&gt;Kai&lt;/p&gt;</comment>
                            <comment id="15318394" author="dsosnoski" created="Tue, 7 Jun 2016 12:36:23 +0000"  >&lt;p&gt;Serializing and capturing the entire message as it&apos;s being sent breaks the WS-Security handling of the message, since it means among other things that timestamps are fixed at the time of original message transmission. Even WS-RM is messed up with this approach, since it also means that acknowledgement information is resent. This can lead to invalid protocol states.&lt;/p&gt;

&lt;p&gt;What should be happening in this case is that the attachments should each be captured and stored separately from the main message body so they can be reprocessed along with the main message body when a retransmit is needed. I had put some code in for this purpose, but I don&apos;t think I ever got it completed and working correctly.&lt;/p&gt;

&lt;p&gt;I don&apos;t have time to participate on CXF now, though, so it&apos;s up to you on the team what you want to do.&lt;/p&gt;</comment>
                            <comment id="15318472" author="ay" created="Tue, 7 Jun 2016 13:36:59 +0000"  >&lt;p&gt;Hi Dennis,&lt;br/&gt;
I&apos;m not sure if we are on the same page. We are not serializing and storing the entire message like before (or as in 2.7.x). We capture the plain soap part and the only the attachments part separately but merge them into one blob so that we can reconstruct that state of the message in one DB-read for later retransmission. So the security processing will take place on the plain content and get applied on each retransmission.&lt;/p&gt;

&lt;p&gt;So, I&apos;m not sure if you are pointing to another issue not identified above. Please let me know.&lt;/p&gt;

&lt;p&gt;thanks.&lt;br/&gt;
regards, aki&lt;/p&gt;
</comment>
                            <comment id="15319452" author="dsosnoski" created="Tue, 7 Jun 2016 21:17:38 +0000"  >&lt;p&gt;That sounds completely correct, Aki. Sorry for my misunderstanding of what was being done, and glad to see you&apos;re cleaning up the remaining glitches in this messy code.&lt;/p&gt;

&lt;p&gt;The only other issue I can think of is that if you&apos;re combining all attachments into a single blob, won&apos;t this interfere with security for attachments? It&apos;s been a while since I looked at this, but I thought you could configure separate WS-Security for individual attachments.&lt;/p&gt;</comment>
                            <comment id="15320266" author="ay" created="Wed, 8 Jun 2016 09:02:01 +0000"  >&lt;p&gt;Hi Dennis,&lt;br/&gt;
Ok. Right. That is a good point. Regarding the attachments encryption/signature, we have the processed attachments and the merging itself shouldn&apos;t corrupt the data, I think, because encryption/signing is done within each attachment and not across multiple parts. The security processed attachments themselves are reusable for retransmission because there is no timestamp attached to them. However, the retransmission will currently re-apply security processing to the attachments and that will be wrong. We we re-use the processed attachments, we need to skip security processing for the attachments at retransmission. Alternatively, we could store the original attachments when ws-sec on attachments is configured and apply security processing at each retransmission. In any case, we will need one of these two options to support ws-rm + ws-security on attachments.&lt;/p&gt;

&lt;p&gt;regards, aki&lt;/p&gt;</comment>
                            <comment id="15352953" author="kairo" created="Tue, 28 Jun 2016 13:09:11 +0000"  >&lt;p&gt;I created the bug  &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-6955&quot; title=&quot;WS-RM 3.x encrypted attachments are saved for retransmission&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-6955&quot;&gt;CXF-6955&lt;/a&gt; to track the issue that the security processing is re-applied on attachments.&lt;/p&gt;</comment>
                            <comment id="15362672" author="ay" created="Tue, 5 Jul 2016 15:55:59 +0000"  >&lt;p&gt;Closing this ticket as the attachments handling has been corrected. The issue specifically related to security processing applied to attachments is tracked the linked ticket.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12984364">CXF-6955</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12634820">CXF-4866</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                            <outwardlinks description="requires">
                                        <issuelink>
            <issuekey id="12906273">CXF-6646</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12963476">CXF-6886</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12808414" name="0001-WS-RM-3.x-fix-for-retransmission-works-with-attachme.patch" size="7148" author="kairo" created="Mon, 6 Jun 2016 15:38:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 20 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2vtyf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>