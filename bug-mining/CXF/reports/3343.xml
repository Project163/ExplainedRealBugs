<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:32:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-7860] JAX-RS @FormParam parameters are not updated when form content is modified</title>
                <link>https://issues.apache.org/jira/browse/CXF-7860</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;The JAX-RS community noticed a difference in behavior between CXF and Jersey/RESTEasy where form data in the HTTP body is modified prior to invoking the resource method. &#160;There are two differences noted:&lt;/p&gt;

&lt;p&gt;1) CXF does not invoke a MessageBodyReader (or any ReaderInterceptors) when there is no entity parameter. &#160;I believe that this is proper behavior - or at least an appropriate optimization since there is no parameter, why bother creating one with a MBR (and it&apos;s associated ReaderInterceptors)? &#160;&lt;/p&gt;

&lt;p&gt;2) When the resource method contains both a Form parameter (entity) &lt;em&gt;and&lt;/em&gt; a parameter annotated with `@FormParam`, and a Filter or interceptor, etc. has modified the content of of the HTTP body, the value injected for the `@FormParam` parameter does not reflect those modifications, but the Form entity parameter does. &#160;This seems inconsistent, and (IMO) violates the spirit of the spec - note that there is no TCK test for this case, so CXF is still compliant - but it differs from other implementations. &#160;Here is an example:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Provider
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;FormReaderInterceptor &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; ReaderInterceptor {
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Logger LOG = LogUtils.getL7dLogger(FormReaderInterceptor.class);
&#160; &#160; @Override
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; aroundReadFrom(ReaderInterceptorContext ctx) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException, WebApplicationException {
&#160; &#160; &#160; &#160; BufferedReader br = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BufferedReader(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; InputStreamReader(ctx.getInputStream()));
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; line;
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; ((line = br.readLine()) != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
&#160; &#160; &#160; &#160; &#160; &#160; LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;readLine: &quot;&lt;/span&gt; + line);
&#160; &#160; &#160; &#160; }
&#160; &#160; &#160; &#160; ByteArrayInputStream bais = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayInputStream(&lt;span class=&quot;code-quote&quot;&gt;&quot;value=MODIFIED&quot;&lt;/span&gt;.getBytes());

&#160; &#160; &#160; &#160; ctx.setInputStream(bais);
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ctx.proceed();
&#160; &#160; }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#160; &#160; @POST

&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Response processForm(@FormParam(&lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt;) &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; value, Form form) {...
&#160;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;If the HTTP request body contains &quot;value=ORIGINAL&quot;, then when CXF invokes the processForm method, it will pass &quot;ORIGINAL&quot; to the String value, but will pass a Form object that contains a MultivaluedMap with entry &quot;value=MODIFIED&quot;. &#160;To be consistent with Jersey and RESTEasy, CXF should inject MODIFIED as the String value.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;See JAX-RS API &lt;a href=&quot;https://github.com/eclipse-ee4j/jaxrs-api/issues/659&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Issue 659&lt;/a&gt; for more details.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13188981">CXF-7860</key>
            <summary>JAX-RS @FormParam parameters are not updated when form content is modified</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="andymc">Andrew J McMurry</assignee>
                                    <reporter username="andymc">Andrew J McMurry</reporter>
                        <labels>
                    </labels>
                <created>Tue, 2 Oct 2018 21:19:34 +0000</created>
                <updated>Tue, 30 Oct 2018 10:06:03 +0000</updated>
                            <resolved>Tue, 9 Oct 2018 00:26:34 +0000</resolved>
                                    <version>3.2.6</version>
                                    <fixVersion>3.2.7</fixVersion>
                    <fixVersion>3.3.0</fixVersion>
                                    <component>JAX-RS</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16636144" author="githubbot" created="Tue, 2 Oct 2018 21:33:01 +0000"  >&lt;p&gt;andymc12 opened a new pull request #453: &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7860&quot; title=&quot;JAX-RS @FormParam parameters are not updated when form content is modified&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7860&quot;&gt;&lt;del&gt;CXF-7860&lt;/del&gt;&lt;/a&gt;: Reprocess @FormParam parms so they contain the latest data&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/cxf/pull/453&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/453&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   This addresses an issue surfaced by the Jakarta JAX-RS API community in Issue &lt;span class=&quot;error&quot;&gt;&amp;#91;659&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://github.com/eclipse-ee4j/jaxrs-api/issues/659&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/eclipse-ee4j/jaxrs-api/issues/659&lt;/a&gt;) where a parameter marked as `@FormParam` may be injected with a value that is inconsistent with an entity `Form` parameter.  The latter will have the latest contents of the HTTP form body stream whereas the former will not - modifications made to the HTTP form body during filters or interceptors will be lost, thus it is possible that the following code would fail:&lt;/p&gt;

&lt;p&gt;   ```&lt;br/&gt;
   @POST&lt;br/&gt;
   public Response processForm(@FormParam(&quot;value&quot;) String value, Form form) &lt;/p&gt;
{
       assertEquals(value, form.asMap().getFirst(&quot;value&quot;));
   }
&lt;p&gt;   ```&lt;/p&gt;

&lt;p&gt;   This change ensures that the `@FormParam` parameters will match the values in the `Form` parameter.  There is probably an optimization that I am missing that would only perform this logic if the input stream were modified - suggestions welcome on how I could best do this.  Thanks!&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16640763" author="githubbot" created="Sat, 6 Oct 2018 16:04:11 +0000"  >&lt;p&gt;reta commented on issue #453: &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7860&quot; title=&quot;JAX-RS @FormParam parameters are not updated when form content is modified&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7860&quot;&gt;&lt;del&gt;CXF-7860&lt;/del&gt;&lt;/a&gt;: Reprocess @FormParam parms so they contain the latest data&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/cxf/pull/453#issuecomment-427585364&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/453#issuecomment-427585364&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @andymc12 Thanks a lot for addressing this very edgy case. I was looking how the current implementation works and basically I was trying to understand if we could defer the evaluation of the HTTP parameters (like `@FormParam`) to a later phase. In general, I think it would be feasible but would significantly impact the existing design.&lt;/p&gt;

&lt;p&gt;   However, I think I found a simple trick to make it work: reordering parameters initialization. Here is an interesting exercise:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;`Response processForm(@FormParam(&quot;value&quot;) String value, Form form)` -&amp;gt; does not work&lt;/li&gt;
	&lt;li&gt;`Response processForm(Form form, @FormParam(&quot;value&quot;) String value)` -&amp;gt; works just fine&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   So the idea in the nutshell is to a modify `JAXRSUtils::processParameters` to initialize parameters in a different order. In this case, the `Form` should be initialized before any `@FormParam`, it triggers the reader interceptors and the right values are propagated in `Form` and `@FromParam` arguments. It should also work in case of constructors or class members.&lt;/p&gt;

&lt;p&gt;   What do you think? &lt;br/&gt;
   Thanks!&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16642388" author="githubbot" created="Mon, 8 Oct 2018 19:51:47 +0000"  >&lt;p&gt;andymc12 commented on issue #453: &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7860&quot; title=&quot;JAX-RS @FormParam parameters are not updated when form content is modified&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7860&quot;&gt;&lt;del&gt;CXF-7860&lt;/del&gt;&lt;/a&gt;: Ensure @FormParam parms are consistent with Form entities&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/cxf/pull/453#issuecomment-427958475&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/453#issuecomment-427958475&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @reta Thanks so much!  That is a much better solution that what I had originally proposed.  I had also considered that the &quot;right approach&quot; would be to refactor the phase when parameters were processed, but I think this solution is cleaner - and should not disrupt normal cases.&lt;/p&gt;

&lt;p&gt;   I&apos;ve left the test cases unaltered, but I removed my changes from `JAXRSInvoker` and instead changed `JAXRSUtils` as you suggested.  This passes all of the unit tests and the systests (including my new one).  Can you take a look at the latest changes?&lt;/p&gt;

&lt;p&gt;   Thanks again!&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16642525" author="githubbot" created="Mon, 8 Oct 2018 21:38:44 +0000"  >&lt;p&gt;reta commented on issue #453: &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7860&quot; title=&quot;JAX-RS @FormParam parameters are not updated when form content is modified&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7860&quot;&gt;&lt;del&gt;CXF-7860&lt;/del&gt;&lt;/a&gt;: Ensure @FormParam parms are consistent with Form entities&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/cxf/pull/453#issuecomment-427987700&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/453#issuecomment-427987700&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Looks good, thanks @andymc12 ! &lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16642641" author="githubbot" created="Tue, 9 Oct 2018 00:23:51 +0000"  >&lt;p&gt;andymc12 closed pull request #453: &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7860&quot; title=&quot;JAX-RS @FormParam parameters are not updated when form content is modified&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7860&quot;&gt;&lt;del&gt;CXF-7860&lt;/del&gt;&lt;/a&gt;: Ensure @FormParam parms are consistent with Form entities&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/cxf/pull/453&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/453&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/rt/frontend/jaxrs/src/main/java/org/apache/cxf/jaxrs/utils/JAXRSUtils.java b/rt/frontend/jaxrs/src/main/java/org/apache/cxf/jaxrs/utils/JAXRSUtils.java&lt;br/&gt;
index 4685270e5e1..90276785327 100644&lt;br/&gt;
&amp;#8212; a/rt/frontend/jaxrs/src/main/java/org/apache/cxf/jaxrs/utils/JAXRSUtils.java&lt;br/&gt;
+++ b/rt/frontend/jaxrs/src/main/java/org/apache/cxf/jaxrs/utils/JAXRSUtils.java&lt;br/&gt;
@@ -769,49 +769,68 @@ public static float getMediaTypeQualityFactor(String q) {&lt;br/&gt;
         boolean preferModelParams = paramsInfo.size() &amp;gt; parameterTypes.length&lt;br/&gt;
             &amp;amp;&amp;amp; !PropertyUtils.isTrue(message.getContextualProperty(&quot;org.apache.cxf.preferMethodParameters&quot;));&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;int parameterTypesLengh = preferModelParams ? paramsInfo.size() : parameterTypes.length;&lt;br/&gt;
+        final int parameterTypesLength = preferModelParams ? paramsInfo.size() : parameterTypes.length;&lt;br/&gt;
+        if (parameterTypesLength &amp;lt; 1) 
{
+            return Collections.emptyList();
+        }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         Type[] genericParameterTypes = ori.getInGenericParameterTypes();&lt;br/&gt;
         Annotation[][] anns = ori.getInParameterAnnotations();&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;List&amp;lt;Object&amp;gt; params = new ArrayList&amp;lt;&amp;gt;(parameterTypesLengh);&lt;br/&gt;
+        Object[] params = new Object&lt;span class=&quot;error&quot;&gt;&amp;#91;parameterTypesLength&amp;#93;&lt;/span&gt;;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;for (int i = 0; i &amp;lt; parameterTypesLengh; i++) {&lt;/li&gt;
	&lt;li&gt;Class&amp;lt;?&amp;gt; param = null;&lt;/li&gt;
	&lt;li&gt;Type genericParam = null;&lt;/li&gt;
	&lt;li&gt;Annotation[] paramAnns = null;&lt;br/&gt;
+        // Ensure we process all request-body parameters first, then all @*Params, etc.&lt;br/&gt;
+        ParamTuple[] tuple = new ParamTuple&lt;span class=&quot;error&quot;&gt;&amp;#91;parameterTypesLength&amp;#93;&lt;/span&gt;;&lt;br/&gt;
+        for (int i = 0; i &amp;lt; parameterTypesLength; i++) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+            tuple[i] = new ParamTuple();             if (!preferModelParams) {
-                param = parameterTypes[i];
-                genericParam = InjectionUtils.processGenericTypeIfNeeded(
-                    ori.getClassResourceInfo().getServiceClass(), param, genericParameterTypes[i]);
-                param = InjectionUtils.updateParamClassToTypeIfNeeded(param, genericParam);
-                paramAnns = anns == null ? EMPTY_ANNOTATIONS : anns[i];
+                tuple[i].param = parameterTypes[i];
+                tuple[i].genericParam = InjectionUtils.processGenericTypeIfNeeded(
+                    ori.getClassResourceInfo().getServiceClass(), tuple[i].param, genericParameterTypes[i]);
+                tuple[i].param = InjectionUtils.updateParamClassToTypeIfNeeded(tuple[i].param, 
+                                                                               tuple[i].genericParam);
+                tuple[i].paramAnns = anns == null ? EMPTY_ANNOTATIONS : anns[i];
             } else {
-                param = paramsInfo.get(i).getJavaType();
-                genericParam = param;
-                paramAnns = EMPTY_ANNOTATIONS;
+                tuple[i].param = paramsInfo.get(i).getJavaType();
+                tuple[i].genericParam = tuple[i].param;
+                tuple[i].paramAnns = EMPTY_ANNOTATIONS;
+            }+            if (paramsInfo.get(i).getType() == ParameterType.REQUEST_BODY) {
+                params[i] = processRequestBodyParameter(tuple[i].param, 
+                                                        tuple[i].genericParam, 
+                                                        tuple[i].paramAnns,
+                                                        message,
+                                                        ori);
             }+        }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;+        for (int i = 0; i &amp;lt; parameterTypesLength; i++) {&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Object paramValue = processParameter(param,&lt;/li&gt;
	&lt;li&gt;genericParam,&lt;/li&gt;
	&lt;li&gt;paramAnns,&lt;/li&gt;
	&lt;li&gt;paramsInfo.get&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;,&lt;/li&gt;
	&lt;li&gt;values,&lt;/li&gt;
	&lt;li&gt;message,&lt;/li&gt;
	&lt;li&gt;ori);&lt;/li&gt;
	&lt;li&gt;params.add(paramValue);&lt;br/&gt;
+            if (paramsInfo.get&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.getType() != ParameterType.REQUEST_BODY) 
{
+                params[i] = processParameter(tuple[i].param,
+                                             tuple[i].genericParam,
+                                             tuple[i].paramAnns,
+                                             paramsInfo.get(i),
+                                             values,
+                                             message,
+                                             ori);
+            }
&lt;p&gt;         }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return params;&lt;br/&gt;
+        return Arrays.asList(params);&lt;br/&gt;
     }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private static Object processParameter(Class&amp;lt;?&amp;gt; parameterClass,&lt;/li&gt;
	&lt;li&gt;Type parameterType,&lt;/li&gt;
	&lt;li&gt;Annotation[] parameterAnns,&lt;/li&gt;
	&lt;li&gt;Parameter parameter,&lt;/li&gt;
	&lt;li&gt;MultivaluedMap&amp;lt;String, String&amp;gt; values,&lt;/li&gt;
	&lt;li&gt;Message message,&lt;/li&gt;
	&lt;li&gt;OperationResourceInfo ori)&lt;br/&gt;
+    private static class ParamTuple 
{
+        private Class&amp;lt;?&amp;gt; param;
+        private Type genericParam;
+        private Annotation[] paramAnns;
+    }
&lt;p&gt;+&lt;br/&gt;
+    private static Object processRequestBodyParameter(Class&amp;lt;?&amp;gt; parameterClass,&lt;br/&gt;
+                                                      Type parameterType,&lt;br/&gt;
+                                                      Annotation[] parameterAnns,&lt;br/&gt;
+                                                      Message message,&lt;br/&gt;
+                                                      OperationResourceInfo ori)&lt;br/&gt;
         throws IOException, WebApplicationException &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+         InputStream is = message.getContent(InputStream.class);         if (is == null) {
             Reader reader = message.getContent(Reader.class);
@@ -819,26 +838,38 @@ private static Object processParameter(Class&amp;lt;?&amp;gt; parameterClass,
                 is = new ReaderInputStream(reader);
             }         }&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;if (parameter.getType() == ParameterType.REQUEST_BODY) {&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (parameterClass == AsyncResponse.class) 
{
-                return new AsyncResponseImpl(message);
-            }
&lt;p&gt;+        if (parameterClass == AsyncResponse.class) &lt;/p&gt;
{
+            return new AsyncResponseImpl(message);
+        }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;String contentType = (String)message.get(Message.CONTENT_TYPE);&lt;br/&gt;
+        String contentType = (String)message.get(Message.CONTENT_TYPE);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (contentType == null) 
{
-                String defaultCt = (String)message.getContextualProperty(DEFAULT_CONTENT_TYPE);
-                contentType = defaultCt == null ? MediaType.APPLICATION_OCTET_STREAM : defaultCt;
-            }
&lt;p&gt;+        if (contentType == null) &lt;/p&gt;
{
+            String defaultCt = (String)message.getContextualProperty(DEFAULT_CONTENT_TYPE);
+            contentType = defaultCt == null ? MediaType.APPLICATION_OCTET_STREAM : defaultCt;
+        }
&lt;p&gt;+&lt;br/&gt;
+        return readFromMessageBody(parameterClass,&lt;br/&gt;
+                                   parameterType,&lt;br/&gt;
+                                   parameterAnns,&lt;br/&gt;
+                                   is,&lt;br/&gt;
+                                   toMediaType(contentType),&lt;br/&gt;
+                                   ori,&lt;br/&gt;
+                                   message);&lt;br/&gt;
+    }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return readFromMessageBody(parameterClass,&lt;/li&gt;
	&lt;li&gt;parameterType,&lt;/li&gt;
	&lt;li&gt;parameterAnns,&lt;/li&gt;
	&lt;li&gt;is,&lt;/li&gt;
	&lt;li&gt;toMediaType(contentType),&lt;/li&gt;
	&lt;li&gt;ori,&lt;/li&gt;
	&lt;li&gt;message);&lt;br/&gt;
+    private static Object processParameter(Class&amp;lt;?&amp;gt; parameterClass,&lt;br/&gt;
+                                           Type parameterType,&lt;br/&gt;
+                                           Annotation[] parameterAnns,&lt;br/&gt;
+                                           Parameter parameter,&lt;br/&gt;
+                                           MultivaluedMap&amp;lt;String, String&amp;gt; values,&lt;br/&gt;
+                                           Message message,&lt;br/&gt;
+                                           OperationResourceInfo ori)&lt;br/&gt;
+        throws IOException, WebApplicationException {&lt;br/&gt;
+&lt;br/&gt;
+        if (parameter.getType() == ParameterType.REQUEST_BODY) 
{
+            return processRequestBodyParameter(parameterClass, parameterType, parameterAnns, message, ori);
         }
&lt;p&gt; else if (parameter.getType() == ParameterType.CONTEXT) &lt;/p&gt;
{
             return createContextValue(message, parameterType, parameterClass);
         }
&lt;p&gt; else if (parameter.getType() == ParameterType.BEAN) {&lt;br/&gt;
diff --git a/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/form/FormBehaviorTest.java b/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/form/FormBehaviorTest.java&lt;br/&gt;
new file mode 100644&lt;br/&gt;
index 00000000000..145967f2a13&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;/dev/null&lt;br/&gt;
+++ b/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/form/FormBehaviorTest.java&lt;br/&gt;
@@ -0,0 +1,84 @@&lt;br/&gt;
+/**&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
+ * or more contributor license agreements. See the NOTICE file&lt;br/&gt;
+ * distributed with this work for additional information&lt;br/&gt;
+ * regarding copyright ownership. The ASF licenses this file&lt;br/&gt;
+ * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
+ * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
+ * with the License. You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ * &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing,&lt;br/&gt;
+ * software distributed under the License is distributed on an&lt;br/&gt;
+ * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY&lt;br/&gt;
+ * KIND, either express or implied. See the License for the&lt;br/&gt;
+ * specific language governing permissions and limitations&lt;br/&gt;
+ * under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+package org.apache.cxf.systest.jaxrs.form;&lt;br/&gt;
+&lt;br/&gt;
+import javax.ws.rs.client.Client;&lt;br/&gt;
+import javax.ws.rs.client.ClientBuilder;&lt;br/&gt;
+import javax.ws.rs.client.Entity;&lt;br/&gt;
+import javax.ws.rs.core.Form;&lt;br/&gt;
+import javax.ws.rs.core.MediaType;&lt;br/&gt;
+import javax.ws.rs.core.Response;&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.cxf.jaxrs.JAXRSServerFactoryBean;&lt;br/&gt;
+import org.apache.cxf.jaxrs.model.AbstractResourceInfo;&lt;br/&gt;
+import org.apache.cxf.testutil.common.AbstractBusClientServerTestBase;&lt;br/&gt;
+import org.apache.cxf.testutil.common.AbstractBusTestServerBase;&lt;br/&gt;
+&lt;br/&gt;
+import org.junit.Assert;&lt;br/&gt;
+import org.junit.BeforeClass;&lt;br/&gt;
+import org.junit.Ignore;&lt;br/&gt;
+import org.junit.Test;&lt;br/&gt;
+&lt;br/&gt;
+public class FormBehaviorTest extends AbstractBusClientServerTestBase {&lt;br/&gt;
+    public static final String PORT = allocatePort(FormBehaviorTest.class);&lt;br/&gt;
+&lt;br/&gt;
+    @Ignore&lt;br/&gt;
+    public static class Server extends AbstractBusTestServerBase {&lt;br/&gt;
+        protected void run() 
{
+            final JAXRSServerFactoryBean sf = new JAXRSServerFactoryBean();
+            sf.setResourceClasses(FormResource.class);
+            sf.setProvider(new FormReaderInterceptor());
+            sf.setAddress(&quot;http://localhost:&quot; + PORT + &quot;/&quot;);
+            sf.create();
+        }
&lt;p&gt;+&lt;br/&gt;
+        public static void main(String[] args) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+            try {
+                Server s = new Server();
+                s.start();
+            } catch (Exception ex) {
+                ex.printStackTrace();
+                System.exit(-1);
+            } finally {
+                System.out.println(&quot;done!&quot;);
+            }+        }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;+    }&lt;br/&gt;
+&lt;br/&gt;
+    @BeforeClass&lt;br/&gt;
+    public static void startServers() throws Exception &lt;/p&gt;
{
+        AbstractResourceInfo.clearAllMaps();
+        // keep out of process due to stack traces testing failures
+        assertTrue(&quot;server did not launch correctly&quot;, launchServer(Server.class, true));
+        createStaticBus();
+    }
&lt;p&gt;+&lt;br/&gt;
+    @Test&lt;br/&gt;
+    public void testInterceptorInvokedOnFormAndFormParamMatchesFormValue() throws Exception &lt;/p&gt;
{
+        Client client = ClientBuilder.newClient();
+        String uri = &quot;http://localhost:&quot; + PORT + &quot;/form&quot;;
+        Form f = new Form(&quot;value&quot;, &quot;ORIGINAL&quot;);
+        Response r = client.target(uri)
+                           .request(MediaType.APPLICATION_FORM_URLENCODED)
+                           .post(Entity.form(f));
+
+        Assert.assertEquals(&quot;MODIFIED&quot;, r.getHeaderString(&quot;FromForm&quot;));
+        Assert.assertEquals(&quot;MODIFIED&quot;, r.getHeaderString(&quot;FromFormParam&quot;));
+    }
&lt;p&gt;+}&lt;br/&gt;
diff --git a/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/form/FormReaderInterceptor.java b/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/form/FormReaderInterceptor.java&lt;br/&gt;
new file mode 100644&lt;br/&gt;
index 00000000000..a81ad288092&lt;/p&gt;&lt;/li&gt;
			&lt;li&gt;/dev/null&lt;br/&gt;
+++ b/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/form/FormReaderInterceptor.java&lt;br/&gt;
@@ -0,0 +1,52 @@&lt;br/&gt;
+/**&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
+ * or more contributor license agreements. See the NOTICE file&lt;br/&gt;
+ * distributed with this work for additional information&lt;br/&gt;
+ * regarding copyright ownership. The ASF licenses this file&lt;br/&gt;
+ * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
+ * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
+ * with the License. You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ * &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing,&lt;br/&gt;
+ * software distributed under the License is distributed on an&lt;br/&gt;
+ * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY&lt;br/&gt;
+ * KIND, either express or implied. See the License for the&lt;br/&gt;
+ * specific language governing permissions and limitations&lt;br/&gt;
+ * under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+package org.apache.cxf.systest.jaxrs.form;&lt;br/&gt;
+&lt;br/&gt;
+import java.io.BufferedReader;&lt;br/&gt;
+import java.io.ByteArrayInputStream;&lt;br/&gt;
+import java.io.IOException;&lt;br/&gt;
+import java.io.InputStreamReader;&lt;br/&gt;
+import java.util.logging.Logger;&lt;br/&gt;
+&lt;br/&gt;
+import javax.ws.rs.WebApplicationException;&lt;br/&gt;
+import javax.ws.rs.ext.Provider;&lt;br/&gt;
+import javax.ws.rs.ext.ReaderInterceptor;&lt;br/&gt;
+import javax.ws.rs.ext.ReaderInterceptorContext;&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.cxf.common.logging.LogUtils;&lt;br/&gt;
+&lt;br/&gt;
+@Provider&lt;br/&gt;
+public class FormReaderInterceptor implements ReaderInterceptor {&lt;br/&gt;
+    private static final Logger LOG = LogUtils.getL7dLogger(FormReaderInterceptor.class);&lt;br/&gt;
+&lt;br/&gt;
+    @Override&lt;br/&gt;
+    public Object aroundReadFrom(ReaderInterceptorContext ctx) throws IOException, WebApplicationException 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+        BufferedReader br = new BufferedReader(new InputStreamReader(ctx.getInputStream()));+        String line;+        while ((line = br.readLine()) != null) {
+            LOG.info(&quot;readLine: &quot; + line);
+        }++        ByteArrayInputStream bais = new ByteArrayInputStream(&amp;quot;value=MODIFIED&amp;quot;.getBytes());+        LOG.info(&amp;quot;set value=MODIFIED&amp;quot;);+        ctx.setInputStream(bais);+        return ctx.proceed();+    }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;+&lt;br/&gt;
+}&lt;br/&gt;
diff --git a/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/form/FormResource.java b/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/form/FormResource.java&lt;br/&gt;
new file mode 100644&lt;br/&gt;
index 00000000000..b1816d383e4&lt;/p&gt;&lt;/li&gt;
			&lt;li&gt;/dev/null&lt;br/&gt;
+++ b/systests/jaxrs/src/test/java/org/apache/cxf/systest/jaxrs/form/FormResource.java&lt;br/&gt;
@@ -0,0 +1,45 @@&lt;br/&gt;
+/**&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
+ * or more contributor license agreements. See the NOTICE file&lt;br/&gt;
+ * distributed with this work for additional information&lt;br/&gt;
+ * regarding copyright ownership. The ASF licenses this file&lt;br/&gt;
+ * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
+ * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
+ * with the License. You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ * &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing,&lt;br/&gt;
+ * software distributed under the License is distributed on an&lt;br/&gt;
+ * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY&lt;br/&gt;
+ * KIND, either express or implied. See the License for the&lt;br/&gt;
+ * specific language governing permissions and limitations&lt;br/&gt;
+ * under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+package org.apache.cxf.systest.jaxrs.form;&lt;br/&gt;
+&lt;br/&gt;
+import java.util.logging.Logger;&lt;br/&gt;
+&lt;br/&gt;
+import javax.ws.rs.FormParam;&lt;br/&gt;
+import javax.ws.rs.POST;&lt;br/&gt;
+import javax.ws.rs.Path;&lt;br/&gt;
+import javax.ws.rs.core.Form;&lt;br/&gt;
+import javax.ws.rs.core.Response;&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.cxf.common.logging.LogUtils;&lt;br/&gt;
+&lt;br/&gt;
+@Path(&quot;/form&quot;)&lt;br/&gt;
+public class FormResource 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+    private static final Logger LOG = LogUtils.getL7dLogger(FormResource.class);++    @POST+    public Response processForm(@FormParam(&amp;quot;value&amp;quot;) String value, Form form) {
+        String fromForm = form.asMap().getFirst(&quot;value&quot;);
+        LOG.info(&quot;FromFormParam: &quot; + value);
+        LOG.info(&quot;FromForm: &quot; + fromForm);
+        return Response.ok()
+                        .header(&quot;FromFormParam&quot;, value)
+                        .header(&quot;FromForm&quot;, fromForm)
+                        .build();
+    }+}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;





&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 6 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3yr6f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>