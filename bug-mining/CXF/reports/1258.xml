<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:51:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-4149] org.apache.cxf.endpoint.ClientImpl raises </title>
                <link>https://issues.apache.org/jira/browse/CXF-4149</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;When invoking several different web services asynchronously a NullPointerException is raised. The web services were invoked firstly in parallel later sequentially. The issue occurs more frequently when the web services are executed in parallel.&lt;/p&gt;

&lt;p&gt;Apparently the issue is at ClientImpl line 715 in version 2.4.4. I&apos;ve debugged the issue and in some executions bus is null on method onMessage:&lt;/p&gt;


&lt;p&gt;    public void onMessage(Message message) {&lt;/p&gt;

&lt;p&gt;        Endpoint endpoint = message.getExchange().getEndpoint();&lt;br/&gt;
        if (endpoint == null) &lt;/p&gt;
{
            // in this case correlation will occur outside the transport,
            // however there&apos;s a possibility that the endpoint may have been
            // rebased in the meantime, so that the response will be mediated
            // via a set of in interceptors provided by a *different* endpoint
            //
            endpoint = getConduitSelector().getEndpoint();
            message.getExchange().put(Endpoint.class, endpoint);
        }
&lt;p&gt;        message = endpoint.getBinding().createMessage(message);&lt;br/&gt;
        message.getExchange().setInMessage(message);&lt;br/&gt;
        message.put(Message.REQUESTOR_ROLE, Boolean.TRUE);&lt;br/&gt;
        message.put(Message.INBOUND_MESSAGE, Boolean.TRUE);&lt;br/&gt;
===&amp;gt;    PhaseManager pm = bus.getExtension(PhaseManager.class);&lt;/p&gt;


&lt;p&gt;This is the exception raised:&lt;/p&gt;

&lt;p&gt;GRAVE: ExecutionException&lt;br/&gt;
java.util.concurrent.ExecutionException: java.lang.NullPointerException&lt;br/&gt;
	at org.apache.cxf.endpoint.ClientCallback.get(ClientCallback.java:147)&lt;br/&gt;
	at org.apache.cxf.jaxws.JaxwsResponseCallback.get(JaxwsResponseCallback.java:49)&lt;br/&gt;
	at org.ensure.configLayer.planningLayer.services.PreservationPlanOptimizer.PreservationPlanOptimizer.invokeAnalysisModules(PreservationPlanOptimizer.java:382)&lt;br/&gt;
	at org.ensure.configLayer.planningLayer.services.PreservationPlanOptimizer.PreservationPlanOptimizer.getOptimizedGlobalPreservationPlans(PreservationPlanOptimizer.java:166)&lt;br/&gt;
	at org.ensure.configLayer.test.planningLayer.PreservationPlanOptimizer.tester.Tester.main(Tester.java:37)&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
	at org.apache.cxf.endpoint.ClientImpl.onMessage(ClientImpl.java:715)&lt;br/&gt;
	at org.apache.cxf.endpoint.ClientImpl$1.onMessage(ClientImpl.java:890)&lt;br/&gt;
	at org.apache.cxf.transport.http.HTTPConduit$WrappedOutputStream.handleResponseInternal(HTTPConduit.java:1626)&lt;br/&gt;
	at org.apache.cxf.transport.http.HTTPConduit$WrappedOutputStream$1.run(HTTPConduit.java:1498)&lt;br/&gt;
	at java.lang.Thread.run(Unknown Source)&lt;/p&gt;

&lt;p&gt;Kind regards,&lt;/p&gt;

&lt;p&gt;Jorge.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Eclipse Helios, Tomcat 6, JDK 1.6, Windows 7&lt;/p&gt;</environment>
        <key id="12544675">CXF-4149</key>
            <summary>org.apache.cxf.endpoint.ClientImpl raises </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dkulp">Daniel Kulp</assignee>
                                    <reporter username="jorgevs">Jorge Vaquero</reporter>
                        <labels>
                    </labels>
                <created>Wed, 29 Feb 2012 21:35:35 +0000</created>
                <updated>Mon, 23 Apr 2012 16:45:13 +0000</updated>
                            <resolved>Fri, 2 Mar 2012 16:02:30 +0000</resolved>
                                    <version>2.4.4</version>
                    <version>2.4.6</version>
                    <version>2.5.2</version>
                                    <fixVersion>2.3.10</fixVersion>
                    <fixVersion>2.4.7</fixVersion>
                    <fixVersion>2.5.3</fixVersion>
                                    <component>Bus</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13220389" author="dkulp" created="Thu, 1 Mar 2012 21:36:00 +0000"  >
&lt;p&gt;I &lt;b&gt;THINK&lt;/b&gt; I know what is happening here, but want to clarify with you first.   How are you invoking the async method?  (via a proxy, Dispatch, dynamic client?)    Also, after you call the async method, what are you doing with the object that you invoked it on?   &lt;/p&gt;

&lt;p&gt;Can you also try something:  in the handler/callback that you pass to the method, can you add a field that points to the proxy/dispatch/client object?      &lt;/p&gt;

&lt;p&gt;My gut feeling is that what is happening is that you are invoking the async method, then discarding the proxy.  The garbage collector is kicking in which is calling destroy on the proxy and thus the client impl.  The destroy on the client impl nulls out a ton of things.   Then then response comes back and now the bus is null.    I THINK if the proxy is held onto even in the handler, it wouldn&apos;t be destroyed.&lt;/p&gt;

&lt;p&gt;That said, this is a bug, just need to figure out a good way to fix it.   I&apos;m hoping the strong reference can at least provide a workaround for you.&lt;/p&gt;</comment>
                            <comment id="13220736" author="jorgevs" created="Fri, 2 Mar 2012 06:50:25 +0000"  >&lt;p&gt;Thank you for your support Daniel. I think that your are right I&apos;m getting the Proxy to set the timeout and after the execution of the method is not used anymore.&lt;/p&gt;

&lt;p&gt;This is the code of the invocation, there are two different more like this:&lt;/p&gt;

&lt;p&gt;	private static Response&amp;lt;org.ensure.configLayer.service.cost.jaxws.GetGlobalPreservationPlanEvaluationResponse&amp;gt;  invokeCostModule(DataHandler globalPreservationPlan, RequirementSet requirementSet) {	&lt;/p&gt;

&lt;p&gt;		QName serviceName = new QName(&quot;http://cost.servicequalityfigLayer.ensure.org/&quot;, &quot;CostEngineImplService&quot;);&lt;br/&gt;
		QName portName = new QName(&quot;http://cost.service.configLayer.ensure.org/&quot;, &quot;CostEngineImplPort&quot;);&lt;/p&gt;

&lt;p&gt;		Service service = Service.create(serviceName);&lt;br/&gt;
		service.addPort(portName, SOAPBinding.SOAP11HTTP_BINDING,&lt;br/&gt;
				&quot;http://&quot; + costEngineWSHost + &quot;:&quot; + costEngineWSPort + &quot;/CostEngineWS/services/CostEngineWSImplPort&quot;);&lt;/p&gt;

&lt;p&gt;		org.ensure.configLayer.service.cost.CostEngineWS client = service.getPort(portName,  org.ensure.configLayer.service.cost.CostEngineWS.class);&lt;/p&gt;

&lt;p&gt;		org.apache.cxf.endpoint.Client clientProxy = ClientProxy.getClient(client);&lt;/p&gt;

&lt;p&gt;		// Enabling MTOM on client&lt;br/&gt;
		ServiceUtil.setMTOMEnabled(((BindingProvider)client));&lt;/p&gt;

&lt;p&gt;		// Setting a wider connection timeout for asynchronous communications&lt;br/&gt;
		ServiceUtil.setHTTPAsyncTimeout((HTTPConduit) clientProxy.getConduit());&lt;/p&gt;

&lt;p&gt;		System.out.println(&quot;Invoking getGlobalPreservationPlanEvaluationAsync using polling...&quot;);    &lt;/p&gt;

&lt;p&gt;		Response&amp;lt;org.ensure.configLayer.service.cost.jaxws.GetGlobalPreservationPlanEvaluationResponse&amp;gt; response;&lt;/p&gt;

&lt;p&gt;		try&lt;/p&gt;
{
			response = client.getGlobalPreservationPlanEvaluationAsync(globalPreservationPlan, requirementSet);
		}
&lt;p&gt;catch (Exception e) &lt;/p&gt;
{
			e.printStackTrace();
			LogUtils.printStackTrace(log, e);
			return null;
		}

&lt;p&gt;		return response;&lt;br/&gt;
	}&lt;/p&gt;

&lt;p&gt;And this is the invocation to the three operations in parallel with polling (I have tried doing the three invocations sequentially and it happens but with far less frequency). The method below is executed N times:&lt;/p&gt;

&lt;p&gt;		Response&amp;lt;org.ensure.configLayer.service.cost.jaxws.GetGlobalPreservationPlanEvaluationResponse&amp;gt; costEvaluationReply= null;			&lt;br/&gt;
		Response&amp;lt;org.ensure.configLayer.service.quality.jaxws.GetGlobalPreservationPlanEvaluationResponse&amp;gt; qualityEvaluationReply = null;			&lt;br/&gt;
		Response&amp;lt;org.ensure.configLayer.service.economicPerformance.jaxws.GetGlobalPreservationPlanEvaluationResponse&amp;gt;  economicPerformanceReply = null;&lt;/p&gt;

&lt;p&gt;		org.ensure.configLayer.service.cost.jaxws.GetGlobalPreservationPlanEvaluationResponse costEvaluationReplyRes = null;			&lt;br/&gt;
		org.ensure.configLayer.service.quality.jaxws.GetGlobalPreservationPlanEvaluationResponse qualityEvaluationReplyRes = null;			&lt;br/&gt;
		org.ensure.configLayer.service.economicPerformance.jaxws.GetGlobalPreservationPlanEvaluationResponse economicPerformanceReplyRes = null;&lt;/p&gt;


&lt;p&gt;--------------&lt;/p&gt;


&lt;p&gt;				costEvaluationReply = 		invokeCostModule(globalPreservationPlanDataHandler, requirementSet);&lt;br/&gt;
				qualityEvaluationReply = 	invokeQualityModule(globalPreservationPlanDataHandler, requirementSet);&lt;br/&gt;
				economicPerformanceReply = 	invokeEconomicPerformanceModule(globalPreservationPlanDataHandler, requirementSet);&lt;br/&gt;
			}catch (Exception e) &lt;/p&gt;
{
				e.printStackTrace();
				LogUtils.printStackTrace(log, e);
				return EError.getUnknownError(InternalModule.PRESERVATION_PLAN_OPTIMIZER);
			}

&lt;p&gt;			// Polling method&lt;br/&gt;
			if (costEvaluationReply != null &amp;amp;&amp;amp; qualityEvaluationReply != null &amp;amp;&amp;amp; economicPerformanceReply!= null){&lt;br/&gt;
				int i = 0;&lt;br/&gt;
				while (	!costEvaluationReply.isDone()|| !qualityEvaluationReply.isDone() || !economicPerformanceReply.isDone()) {&lt;br/&gt;
					try &lt;/p&gt;
{
						Thread.sleep(Constants.POLLING_INTERVAL);
					}
&lt;p&gt; catch (InterruptedException e) &lt;/p&gt;
{
						e.printStackTrace();
						LogUtils.printStackTrace(log, e);
					}
&lt;p&gt;					i+= Constants.POLLING_INTERVAL/1000;&lt;br/&gt;
					System.out.println(&quot;Waiting...&quot; + i + &quot; seconds&quot;);&lt;br/&gt;
				}&lt;br/&gt;
			}else&lt;/p&gt;
{
				log.error(&quot;invokeAnalysisModules =&amp;gt; Error invoking WSs&quot;);
				return EError.getUnknownError(InternalModule.PRESERVATION_PLAN_OPTIMIZER);
			}

&lt;p&gt;			try {&lt;/p&gt;


&lt;p&gt;				costEvaluationReplyRes = costEvaluationReply.get();&lt;br/&gt;
				qualityEvaluationReplyRes = qualityEvaluationReply.get();&lt;br/&gt;
				economicPerformanceReplyRes = economicPerformanceReply.get();&lt;/p&gt;


&lt;p&gt;This code is executed iteratively, it some iterations it works in others raised the exception.&lt;/p&gt;

&lt;p&gt;Kind regards,&lt;/p&gt;

&lt;p&gt;Jorge.&lt;/p&gt;</comment>
                            <comment id="13220755" author="jorgevs" created="Fri, 2 Mar 2012 07:42:49 +0000"  >&lt;p&gt;Good Morning Daniel,&lt;/p&gt;

&lt;p&gt;It looks that is working now. I have declared both client and clientProxy globally instead of defining it into the method. &lt;/p&gt;

&lt;p&gt;Thank for your support, hope that this helps to improve this great project.&lt;/p&gt;

&lt;p&gt;Kind regards,&lt;/p&gt;

&lt;p&gt;Jorge.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>229861</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 38 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0subb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>166388</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>