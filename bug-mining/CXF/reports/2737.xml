<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:19:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-6749] Classloader leak on FileUtils.createTmpDir()</title>
                <link>https://issues.apache.org/jira/browse/CXF-6749</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;FileUtils.createTmpDir() adds a ApplicationShutdownHook to remove the recently created temp folder, creating a indirect reference to the Tomcat WebappClassloader from the hook static attribute at ApplicationShutdownHooks class, preventing the classloader to be collected.&lt;/p&gt;

&lt;p&gt;Actually, it will be collected when the JVM is turned off. But this is a web application container, it won&apos;t be turn off for a while.&lt;/p&gt;

&lt;p&gt;I only checked this with the version I&#180;m currently using (2.7.14), but I checked the code at 3.1.x and master branches and it still the same.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Slackware Linux 14.1 (kernel 3.10.17), Java 1.7.0_75, Tomcat 7.0.39 (this is my production environment)&lt;/p&gt;</environment>
        <key id="12931511">CXF-6749</key>
            <summary>Classloader leak on FileUtils.createTmpDir()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dkulp">Daniel Kulp</assignee>
                                    <reporter username="diogosantana">Diogo Sant&apos;Ana</reporter>
                        <labels>
                            <label>classloader-leak</label>
                    </labels>
                <created>Fri, 15 Jan 2016 16:19:31 +0000</created>
                <updated>Sat, 21 Apr 2018 14:38:08 +0000</updated>
                            <resolved>Mon, 18 Jan 2016 19:37:55 +0000</resolved>
                                    <version>2.7.14</version>
                                    <fixVersion>3.1.5</fixVersion>
                    <fixVersion>3.0.8</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15102011" author="diogosantana" created="Fri, 15 Jan 2016 16:25:14 +0000"  >&lt;p&gt;Screenshot of Eclipse Memory Analyser: &lt;a href=&quot;https://goo.gl/rofvi9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://goo.gl/rofvi9&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15105727" author="dkulp" created="Mon, 18 Jan 2016 19:37:21 +0000"  >
&lt;p&gt;There really isn&apos;t a way to completely avoid having the shutdown hook, even using Java7&apos;s deleteOnExit stuff for directories, without causing a different memory leak.     I&apos;ve added a method to FileUtils to check if the temp dir is empty and remove the directory and hook if it is.   I&apos;ve updated the Servlet to call that method on destroy.   For MOST cases, that should solve this.   If something is holding onto one of the temp files such that it hasn&apos;t been deleted, it WILL attempt to gc()/runFinalizers() to get it released and re-check, but if that doesn&apos;t cause the files to delete, it will leave the hook in place.  &lt;/p&gt;

&lt;p&gt;For non-servlet uses of CXF, they can call the same method on FileUtils during whatever application cleanups they do. (FileUtils.maybeDeleteDefaultTempDir())&lt;/p&gt;

</comment>
                            <comment id="15105782" author="diogosantana" created="Mon, 18 Jan 2016 20:26:53 +0000"  >&lt;p&gt;Thank you, Daniel for the quick response.&lt;br/&gt;
I knew this problem didn&apos;t have a &quot;clean&quot; solution, that&apos;s why I didn&apos;t suggest one, but yours is quite good.&lt;/p&gt;</comment>
                            <comment id="16446836" author="cousins" created="Sat, 21 Apr 2018 14:38:08 +0000"  >&lt;p&gt;maybeDeleteDefaultTempDir causes an IllegalStateException if it tries to remove the shutdown hook while the JVM is already shutting down. &#160;I have seen this error in Jetty after&#160;a failsafe junit validation test suite finishes. &#160;&lt;/p&gt;

&lt;p&gt;I was going to suggest passing a shutdown flag from&#160;CXFNonSpringServlet.destroy via&#160;AbstractHTTPServlet.destroy to&#160;FileUtils.maybeDeleteDefaultTempDir to indicate shutdown in progess, but it seems like&#160;FileUtils.maybeDeleteDefaultTempDir is only called during shutdown. &#160;Is removing the shutdown hook necessary?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 30 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2rj4v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>