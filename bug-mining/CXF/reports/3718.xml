<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:39:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-8940] ws-security.must-understand works only if security.enable.streaming is true</title>
                <link>https://issues.apache.org/jira/browse/CXF-8940</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;I am unfortunately not sure at all how to reproduce this with plain CXF. If a test is required to demonstrate the issue, I&apos;d be thankful for pointing me to an existing test I could adapt.&lt;/p&gt;

&lt;p&gt;I am able to reproduce this with quarkus-cxf - here are the steps to reproduce:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
git clone git@github.com:ppalaga/quarkus-cxf.git
cd quarkus-cxf
git checkout CXF-8940
mvnd clean install -DskipTests -Dquarkus.build.skip
cd integration-tests/ws-security-policy
mvnd clean test -Dtest=UsernameTokenSecurityPolicyTest#helloUsernameTokenNoMustUnderstand
...
[ERROR]   UsernameTokenSecurityPolicyTest&amp;gt;AbstractUsernameTokenSecurityPolicyTest.helloUsernameTokenNoMustUnderstand:180 
Expecting actual:
  &quot;REQ_OUT
    Address: https:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8444/services/helloUsernameToken
&lt;/span&gt;    HttpMethod: POST
    Content-Type: text/xml
    ExchangeId: 03fe3642-ab5b-4b85-b712-b8ed107f5a71
    ServiceName: UsernameTokenPolicyHelloService
    PortName: UsernameTokenPolicyHelloServicePort
    PortTypeName: UsernameTokenPolicyHelloService
    Headers: {SOAPAction=&quot;&quot;, Accept=*/*, Connection=Keep-Alive}
    Payload: &amp;lt;soap:Envelope xmlns:soap=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//schemas.xmlsoap.org/soap/envelope/&quot;&lt;/span&gt;&amp;gt;
&lt;/span&gt;  &amp;lt;soap:Header&amp;gt;
    &amp;lt;wsse:Security xmlns:wsse=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd&quot;&lt;/span&gt; soap:mustUnderstand=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;&amp;gt;
&lt;/span&gt;      &amp;lt;wsse:UsernameToken xmlns:wsu=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot;&lt;/span&gt; wsu:Id=&lt;span class=&quot;code-quote&quot;&gt;&quot;UsernameToken-4e64841c-ad35-48fd-b7ee-70e5f978e098&quot;&lt;/span&gt;&amp;gt;
&lt;/span&gt;        &amp;lt;wsse:Username&amp;gt;cxf-user&amp;lt;/wsse:Username&amp;gt;
        &amp;lt;wsse:Password Type=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText&quot;&lt;/span&gt;&amp;gt;secret&amp;lt;/wsse:Password&amp;gt;
&lt;/span&gt;        &amp;lt;wsse:Nonce EncodingType=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary&quot;&lt;/span&gt;&amp;gt;5rs0Ra3q0FPLXFguajlTwQ==&amp;lt;/wsse:Nonce&amp;gt;
&lt;/span&gt;        &amp;lt;wsu:Created&amp;gt;2023-10-05T22:40:54.436Z&amp;lt;/wsu:Created&amp;gt;
      &amp;lt;/wsse:UsernameToken&amp;gt;
    &amp;lt;/wsse:Security&amp;gt;
  &amp;lt;/soap:Header&amp;gt;
  &amp;lt;soap:Body&amp;gt;
    &amp;lt;ns2:hello xmlns:ns2=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//policy.security.it.cxf.quarkiverse.io/&quot;&lt;/span&gt;&amp;gt;
&lt;/span&gt;      &amp;lt;arg0&amp;gt;helloUsernameTokenNoMustUnderstand&amp;lt;/arg0&amp;gt;
    &amp;lt;/ns2:hello&amp;gt;
  &amp;lt;/soap:Body&amp;gt;
&amp;lt;/soap:Envelope&amp;gt;

&quot;
not to contain:
  &lt;span class=&quot;code-quote&quot;&gt;&quot;soap:mustUnderstand=&quot;&lt;/span&gt;1&quot;&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Running the same logic with &lt;tt&gt;quarkus.cxf.client.helloUsernameTokenNoMustUnderstand.security.enable.streaming = true&lt;/tt&gt; works as expected:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
mvnd clean test -Dtest=UsernameTokenSecurityPolicyStaxTest#helloUsernameTokenNoMustUnderstand
...
BUILD SUCCESS
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13553062">CXF-8940</key>
            <summary>ws-security.must-understand works only if security.enable.streaming is true</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ffang">Freeman Yue Fang</assignee>
                                    <reporter username="ppalaga">Peter Palaga</reporter>
                        <labels>
                    </labels>
                <created>Thu, 5 Oct 2023 22:18:00 +0000</created>
                <updated>Sat, 4 Nov 2023 15:13:35 +0000</updated>
                            <resolved>Wed, 25 Oct 2023 15:03:08 +0000</resolved>
                                                    <fixVersion>3.5.8</fixVersion>
                    <fixVersion>3.6.3</fixVersion>
                    <fixVersion>4.0.4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17772696" author="ffang" created="Fri, 6 Oct 2023 21:01:08 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ppalaga&quot; class=&quot;user-hover&quot; rel=&quot;ppalaga&quot;&gt;ppalaga&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Thanks for raising this issue!&lt;/p&gt;

&lt;p&gt;After the first glance, I don&apos;t think this is the problem in CXF. The problem should be from quarkus-cxf or the test itself. The root cause that the configuration in your test&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
...security.must-understand = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;doesn&apos;t work is that the org.apache.cxf.ws.security.wss4j.PolicyBasedWSS4JOutInterceptor somehow not added into the quarkus cxf client quarkus.cxf.client.helloUsernameTokenNoMustUnderstand. But org.apache.cxf.ws.security.wss4j.PolicyBasedWSS4JOutInterceptor should be added by default in CXF by org.apache.cxf.ws.security.policy.interceptors.WSSecurityInterceptorProvider, together with PolicyBasedWSS4JStaxOutInterceptor. We have test case in CXF source code &lt;br/&gt;
cxf/systests/ws-security/src/test/java/org/apache/cxf/systest/ws/ut/UsernameTokenPolicyTest.java&lt;br/&gt;
and I checked there, the org.apache.cxf.ws.security.wss4j.PolicyBasedWSS4JOutInterceptor in CXF test is added and invoked correctly.&lt;/p&gt;

&lt;p&gt;The PolicyBasedWSS4JStaxOutInterceptor contains the logic when security.enable.streaming is true(Stax API based), while PolicyBasedWSS4JOutInterceptor contains the logic when security.enable.streaming is false(DOM api based).&lt;/p&gt;

&lt;p&gt;If I explicitly add PolicyBasedWSS4JOutInterceptor to your test client, then it works, but surely the real fix should be somewhere else.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
--- a/integration-tests/ws-security-policy/src/main/resources/application.properties
+++ b/integration-tests/ws-security-policy/src/main/resources/application.properties
@@ -94,6 +94,7 @@ quarkus.cxf.client.helloUsernameTokenNoMustUnderstand.trust-store-password = pas
 quarkus.cxf.client.helloUsernameTokenNoMustUnderstand.security.username = ${wss.user}
 quarkus.cxf.client.helloUsernameTokenNoMustUnderstand.security.callback-handler = #usernameTokenPasswordCallback
 quarkus.cxf.client.helloUsernameTokenNoMustUnderstand.security.must-understand = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
+quarkus.cxf.client.helloUsernameTokenNoMustUnderstand.out-interceptors = org.apache.cxf.ws.security.wss4j.PolicyBasedWSS4JOutInterceptor
 quarkus.cxf.client.helloUsernameTokenNoMustUnderstand.features = #messageCollector
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In your testcase you can see that PolicyBasedWSS4JStaxOutInterceptor can be added and invoked(that&apos;s why stax stream works as expected) by default while PolicyBasedWSS4JOutInterceptor can&apos;t. I don&apos;t know why now but this should be the direction to investigate.&lt;/p&gt;

&lt;p&gt;Best Regards&lt;br/&gt;
Freeman&lt;/p&gt;


</comment>
                            <comment id="17775302" author="ppalaga" created="Sat, 14 Oct 2023 19:10:14 +0000"  >&lt;p&gt;I can see WSSecurityInterceptorProvider being created and registered at PolicyInterceptorProviderRegistryImpl, but WSSecurityInterceptorProvider.getOutInterceptors() is never called. Is that perhaps because mustUnderstand is actually not policy driven and there is no  qname through which it could be retrieved from the registry?&lt;/p&gt;</comment>
                            <comment id="17775308" author="ffang" created="Sat, 14 Oct 2023 21:06:49 +0000"  >&lt;p&gt;Hi Peter,&lt;/p&gt;

&lt;p&gt;I think the problem comes from that if in the policy files only have Supporting Tokens(like UsernameToken) but no Security Binding(like HTTPS TransportBinding), the PolicyBasedWSS4JOutInterceptor can&apos;t be added, this is the difference between your test and current test in CXF codebase.&lt;/p&gt;

&lt;p&gt;And I think we should address it in UsernameTokenInterceptorProvider, I have a PR ready here&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cxf/pull/1473&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/1473&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Cheers&lt;br/&gt;
Freeman&lt;/p&gt;</comment>
                            <comment id="17782895" author="ppalaga" created="Sat, 4 Nov 2023 15:13:35 +0000"  >&lt;p&gt;Thanks for fixing this &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ffang&quot; class=&quot;user-hover&quot; rel=&quot;ffang&quot;&gt;ffang&lt;/a&gt;! The &lt;tt&gt;io.quarkiverse.cxf.it.security.policy.UsernameTokenSecurityPolicyTest.helloUsernameTokenNoMustUnderstand()&lt;/tt&gt; in Quarkus CXF is passing with your patch applied.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 1 week, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1krmg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>