<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:42:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-2835] ConcurrentModificationException in ClientImpl caused by toString-method on requestContext</title>
                <link>https://issues.apache.org/jira/browse/CXF-2835</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;We have about 10 threads running at the same time against the same web service. Some of the requests fail with the following stacktrace:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;javax.xml.ws.soap.SOAPFaultException: Fault string, and possibly fault code, not set
	at org.apache.cxf.jaxws.JaxWsClientProxy.invoke(JaxWsClientProxy.java:146)
	at $Proxy218.getFlightData(Unknown Source)
	at com.example.FlightDataAction.run(FlightDataAction.java:94)
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:619)
Caused by: java.util.ConcurrentModificationException
	at java.util.HashMap$HashIterator.nextEntry(HashMap.java:793)
	at java.util.HashMap$EntryIterator.next(HashMap.java:834)
	at java.util.HashMap$EntryIterator.next(HashMap.java:832)
	at java.util.AbstractMap.toString(AbstractMap.java:485)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.valueOf(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.java:2826)
	at java.lang.StringBuilder.append(StringBuilder.java:115)
	at java.util.AbstractMap.toString(AbstractMap.java:490)
	at java.util.Collections$SynchronizedMap.toString(Collections.java:2026)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.valueOf(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.java:2826)
	at java.lang.StringBuilder.append(StringBuilder.java:115)
	at org.apache.cxf.endpoint.ClientImpl.processResult(ClientImpl.java:535)
	at org.apache.cxf.endpoint.ClientImpl.invoke(ClientImpl.java:486)
	at org.apache.cxf.endpoint.ClientImpl.invoke(ClientImpl.java:310)
	at org.apache.cxf.endpoint.ClientImpl.invoke(ClientImpl.java:262)
	at org.apache.cxf.frontend.ClientProxy.invokeSync(ClientProxy.java:73)
	at org.apache.cxf.jaxws.JaxWsClientProxy.invoke(JaxWsClientProxy.java:124)
	... 5 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;From ClientImpl:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;, Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt;&amp;gt; responseContext 
        = Collections.synchronizedMap(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; WeakHashMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;, Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt;&amp;gt;());
....

    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[] processResult(Message message,
                                   Exchange exchange,
                                   BindingOperationInfo oi,
                                   Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; resContext) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
....

        &lt;span class=&quot;code-comment&quot;&gt;// Grab the response objects &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; there are any
&lt;/span&gt;        List resList = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
        Message inMsg = exchange.getInMessage();
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (inMsg != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; != resContext) {
                resContext.putAll(inMsg);
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (LOG.isLoggable(Level.FINE)) {
                    LOG.fine(&lt;span class=&quot;code-quote&quot;&gt;&quot;set responseContext to be&quot;&lt;/span&gt; + responseContext);
                }
            }
            resList = inMsg.getContent(List.class);
        }
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The use of toString on responseContext is causing a ConcurrentModificationException when there are many threads working at the same time on the same service. The LOG.fine -line is not optimal since the string is actually resolved no matter if the log line is going to be written to the log file or not. Using String.format() would fix the issue when log level is not FINE, but would not fix the actual problem caused by many threads at the same time. I&apos;m not sure what the developer wish to log in this cause, but limiting the object traversal and not using toString should do the trick. &lt;/p&gt;

</description>
                <environment></environment>
        <key id="12465768">CXF-2835</key>
            <summary>ConcurrentModificationException in ClientImpl caused by toString-method on requestContext</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dkulp">Daniel Kulp</assignee>
                                    <reporter username="henningjensen">Henning Jensen</reporter>
                        <labels>
                    </labels>
                <created>Mon, 31 May 2010 07:19:26 +0000</created>
                <updated>Mon, 9 Jul 2012 16:36:12 +0000</updated>
                            <resolved>Tue, 1 Jun 2010 16:41:17 +0000</resolved>
                                    <version>2.2.6</version>
                                    <fixVersion>2.2.9</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="12873618" author="henningjensen" created="Mon, 31 May 2010 10:44:45 +0000"  >&lt;p&gt;Seems like we had a glitch in our configuration of the log level for CXF. The log line string was not evaluated when no the isLoggable-check correctly returned false. This fixes the issue for us now, but perhaps the log line should be fixed anyway?&lt;/p&gt;</comment>
                            <comment id="13409597" author="flyingkiwiguy" created="Mon, 9 Jul 2012 16:12:07 +0000"  >&lt;p&gt;We seem to be intermittently reproducing this issue with 2.2.9, so it doesn&apos;t seem to be fixed.&lt;/p&gt;


&lt;p&gt;Caused by: javax.xml.ws.soap.SOAPFaultException: Fault string, and possibly fault code, not set&lt;br/&gt;
        at org.apache.cxf.jaxws.JaxWsClientProxy.invoke(JaxWsClientProxy.java:146)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;..&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at net.sf.cglib.proxy.MethodProxy.invoke(MethodProxy.java:149)&lt;br/&gt;
        at org.springframework.aop.framework.Cglib2AopProxy$CglibMethodInvocation.invokeJoinpoint(Cglib2AopProxy.java:700)&lt;br/&gt;
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:149)&lt;br/&gt;
        at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:77)&lt;br/&gt;
        at com.betfair.monitoring.kpi.aop.KPIMeasuringAspect.measureDuration(KPIMeasuringAspect.java:67)&lt;br/&gt;
        at sun.reflect.GeneratedMethodAccessor56.invoke(Unknown Source)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
        at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:627)&lt;br/&gt;
        at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:616)&lt;br/&gt;
        at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:64)&lt;br/&gt;
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:160)&lt;br/&gt;
        at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:89)&lt;br/&gt;
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:171)&lt;br/&gt;
        at org.springframework.aop.framework.Cglib2AopProxy$DynamicAdvisedInterceptor.intercept(Cglib2AopProxy.java:635)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;..&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at sun.reflect.GeneratedMethodAccessor58.invoke(Unknown Source)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
        at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:307)&lt;br/&gt;
        at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:182)&lt;br/&gt;
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:149)&lt;br/&gt;
        at org.springframework.aop.aspectj.MethodInvocationProceedingJoinPoint.proceed(MethodInvocationProceedingJoinPoint.java:77)&lt;br/&gt;
        at com.betfair.monitoring.kpi.aop.KPIMeasuringAspect.measureDuration(KPIMeasuringAspect.java:67)&lt;br/&gt;
        at sun.reflect.GeneratedMethodAccessor56.invoke(Unknown Source)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
        at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethodWithGivenArgs(AbstractAspectJAdvice.java:627)&lt;br/&gt;
        at org.springframework.aop.aspectj.AbstractAspectJAdvice.invokeAdviceMethod(AbstractAspectJAdvice.java:616)&lt;br/&gt;
        at org.springframework.aop.aspectj.AspectJAroundAdvice.invoke(AspectJAroundAdvice.java:64)&lt;br/&gt;
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:160)&lt;br/&gt;
        at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:89)&lt;br/&gt;
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:171)&lt;br/&gt;
        at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:204)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;..&amp;#93;&lt;/span&gt;&lt;br/&gt;
        ... 5 more&lt;br/&gt;
Caused by: java.util.ConcurrentModificationException&lt;br/&gt;
        at java.util.HashMap$HashIterator.nextEntry(HashMap.java:793)&lt;br/&gt;
        at java.util.HashMap$EntryIterator.next(HashMap.java:834)&lt;br/&gt;
        at java.util.HashMap$EntryIterator.next(HashMap.java:832)&lt;br/&gt;
        at java.util.AbstractMap.toString(AbstractMap.java:485)&lt;br/&gt;
        at java.lang.String.valueOf(String.java:2826)&lt;br/&gt;
        at java.lang.StringBuilder.append(StringBuilder.java:115)&lt;br/&gt;
        at java.util.AbstractMap.toString(AbstractMap.java:490)&lt;br/&gt;
        at java.util.Collections$SynchronizedMap.toString(Collections.java:2026)&lt;/p&gt;

&lt;p&gt;        at java.lang.String.valueOf(String.java:2826)&lt;br/&gt;
        at java.lang.StringBuilder.append(StringBuilder.java:115)&lt;br/&gt;
        at org.apache.cxf.endpoint.ClientImpl.processResult(ClientImpl.java:563)&lt;br/&gt;
        at org.apache.cxf.endpoint.ClientImpl.invoke(ClientImpl.java:514)&lt;br/&gt;
        at org.apache.cxf.endpoint.ClientImpl.invoke(ClientImpl.java:313)&lt;br/&gt;
        at org.apache.cxf.endpoint.ClientImpl.invoke(ClientImpl.java:265)&lt;br/&gt;
        at org.apache.cxf.frontend.ClientProxy.invokeSync(ClientProxy.java:73)&lt;br/&gt;
        at org.apache.cxf.jaxws.JaxWsClientProxy.invoke(JaxWsClientProxy.java:124)&lt;br/&gt;
        ... 52 more&lt;/p&gt;</comment>
                            <comment id="13409616" author="gmazza" created="Mon, 9 Jul 2012 16:31:34 +0000"  >&lt;p&gt;Can you upgrade to a recent version of CXF?  We&apos;re up to 2.6.1 now, and 2.2.x (as well as 2.3.x) is no longer supported.&lt;/p&gt;</comment>
                            <comment id="13409620" author="flyingkiwiguy" created="Mon, 9 Jul 2012 16:36:12 +0000"  >&lt;p&gt;Will try to do and see if I can repro. Thanks for the quick reply.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>113450</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 20 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0dein:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>76281</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>