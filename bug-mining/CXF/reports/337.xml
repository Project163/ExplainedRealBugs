<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:38:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-2356] WS-SecurityPolicy and faults</title>
                <link>https://issues.apache.org/jira/browse/CXF-2356</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;I have a secure WS that is described by a WS-Policy document that&apos;s&lt;br/&gt;
pasted below.&lt;br/&gt;
Policy A is attached to the wsdl:binding while policy B is attached to&lt;br/&gt;
the wsdl:input,wsdl:output and wsdl:fault&lt;/p&gt;

&lt;p&gt;When my WS throws a soap fault there&apos;s a couple of problems:&lt;br/&gt;
1) the soap:Body element is not encrypted&lt;br/&gt;
2) the soap:Body element is not signed&lt;br/&gt;
3) the WS client fails to validate the WS-Security header with the&lt;br/&gt;
that&apos;s also pasted below.&lt;/p&gt;

&lt;p&gt;The problem seems to be in the way CXF handles WS-Security header using&lt;br/&gt;
the PolicyBasedWSS4JInterceptor.&lt;br/&gt;
When the response arrives it passes through the in interceptor chain and&lt;br/&gt;
the encrypted parts are decrypted. The way wss4j handles decryption is&lt;br/&gt;
that it replaces the xmlenc:EncryptedData element in the SOAP document&lt;br/&gt;
with the decrypted content but it does not remove the corresponding&lt;br/&gt;
xmlenc:ReferenceData/xmlenc:DataReference element from the Security&lt;br/&gt;
header. After decryption is done some other interceptor detects that the&lt;br/&gt;
message is actually a fault and triggers the inFault interceptor chain.&lt;/p&gt;

&lt;p&gt;The inFault interceptor chain again contains the&lt;br/&gt;
PolicyBasedWSS4JInterceptor and it should contain it since not all the&lt;br/&gt;
policy assertions have been asserted by the &apos;in&apos; chain. (e.g.&lt;br/&gt;
UsingAddressing  assertion).&lt;br/&gt;
The PolicyBasedWSS4JInterceptor runs wss4j again on a document that has&lt;br/&gt;
already been decrypted and fails with the error below because the&lt;br/&gt;
xmlenc:ReferenceData/xmlenc:DataReference elements point to nothing.&lt;/p&gt;

&lt;p&gt;Has anyone ever hit a problem like that? Is there any workaround for&lt;br/&gt;
that  (other than chainging the WS-Policy document)?&lt;/p&gt;

&lt;p&gt;thanks in advance,&lt;/p&gt;

&lt;p&gt;7038 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; WARN org.apache.cxf.ws.security.wss4j.WSS4JInInterceptor  - &lt;br/&gt;
org.apache.ws.security.WSSecurityException: An error was discovered&lt;br/&gt;
processing the &amp;lt;wsse:Security&amp;gt; header (WSSecurityEngine: DataReference -&lt;br/&gt;
referenced data not found)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.ws.security.processor.ReferenceListProcessor.decryptDataRefEmbedded(ReferenceListProcessor.java:141)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.ws.security.processor.ReferenceListProcessor.handleReferenceList(ReferenceListProcessor.java:113)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.ws.security.processor.ReferenceListProcessor.handleToken(ReferenceListProcessor.java:76)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.ws.security.WSSecurityEngine.processSecurityHeader(WSSecurityEngine.java:326)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.ws.security.WSSecurityEngine.processSecurityHeader(WSSecurityEngine.java:243)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.cxf.ws.security.wss4j.WSS4JInInterceptor.handleMessage(WSS4JInInterceptor.java:179)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.cxf.ws.security.wss4j.WSS4JInInterceptor.handleMessage(WSS4JInInterceptor.java:77)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:236)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.cxf.interceptor.AbstractFaultChainInitiatorObserver.onMessage(AbstractFaultChainInitiatorObserver.java:96)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.cxf.binding.soap.interceptor.CheckFaultInterceptor.handleMessage(CheckFaultInterceptor.java:69)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.cxf.binding.soap.interceptor.CheckFaultInterceptor.handleMessage(CheckFaultInterceptor.java:34)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:236)&lt;br/&gt;
        at org.apache.cxf.endpoint.ClientImpl.onMessage(ClientImpl.java:645)&lt;br/&gt;
        at org.apache.cxf.transport.http.HTTPConduit&lt;br/&gt;
$WrappedOutputStream.handleResponseInternal(HTTPConduit.java:2132)&lt;br/&gt;
        at org.apache.cxf.transport.http.HTTPConduit&lt;br/&gt;
$WrappedOutputStream.handleResponse(HTTPConduit.java:2015)&lt;br/&gt;
        at org.apache.cxf.transport.http.HTTPConduit&lt;br/&gt;
$WrappedOutputStream.close(HTTPConduit.java:1940)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.cxf.io.CacheAndWriteOutputStream.postClose(CacheAndWriteOutputStream.java:47)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.cxf.io.CachedOutputStream.close(CachedOutputStream.java:180)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.cxf.transport.AbstractConduit.close(AbstractConduit.java:66)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.cxf.transport.http.HTTPConduit.close(HTTPConduit.java:627)&lt;br/&gt;
        at org.apache.cxf.interceptor.MessageSenderInterceptor&lt;br/&gt;
$MessageSenderEndingInterceptor.handleMessage(MessageSenderInterceptor.java:62)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:236)&lt;br/&gt;
        at org.apache.cxf.endpoint.ClientImpl.invoke(ClientImpl.java:471)&lt;br/&gt;
        at org.apache.cxf.endpoint.ClientImpl.invoke(ClientImpl.java:301)&lt;br/&gt;
        at org.apache.cxf.endpoint.ClientImpl.invoke(ClientImpl.java:253)&lt;br/&gt;
        at org.apache.cxf.frontend.ClientProxy.invokeSync(ClientProxy.java:73)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.cxf.jaxws.JaxWsClientProxy.invoke(JaxWsClientProxy.java:121)&lt;br/&gt;
        at $Proxy38.sendMessage(Unknown Source)&lt;/p&gt;

&lt;p&gt;&amp;lt;wsp:Policy wsu:Id=&quot;A&quot;&amp;gt;&lt;br/&gt;
                &amp;lt;wsp:ExactlyOne&amp;gt;&lt;br/&gt;
                        &amp;lt;wsp:All&amp;gt;&lt;br/&gt;
                                &amp;lt;sp:SymmetricBinding&lt;br/&gt;
xmlns:sp=&quot;http://schemas.xmlsoap.org/ws/2005/07/securitypolicy&quot;&amp;gt;&lt;br/&gt;
                                        &amp;lt;wsp:Policy&amp;gt;&lt;br/&gt;
                                                &amp;lt;sp:ProtectionToken&amp;gt;&lt;br/&gt;
                                                        &amp;lt;wsp:Policy&amp;gt;&lt;br/&gt;
                                                                &amp;lt;sp:X509Token&lt;br/&gt;
sp:IncludeToken=&quot;http://schemas.xmlsoap.org/ws/2005/07/securitypolicy/IncludeToken/Never&quot;&amp;gt;&lt;br/&gt;
                                                                        &amp;lt;wsp:Policy&amp;gt;&lt;br/&gt;
                                                                                &amp;lt;sp:RequireDerivedKeys /&amp;gt;&lt;br/&gt;
                                                                                &amp;lt;sp:RequireThumbprintReference /&amp;gt;&lt;br/&gt;
                                                                                &amp;lt;sp:WssX509V3Token10 /&amp;gt;&lt;br/&gt;
                                                                        &amp;lt;/wsp:Policy&amp;gt;&lt;br/&gt;
                                                                &amp;lt;/sp:X509Token&amp;gt;&lt;br/&gt;
                                                        &amp;lt;/wsp:Policy&amp;gt;&lt;br/&gt;
                                                &amp;lt;/sp:ProtectionToken&amp;gt;&lt;br/&gt;
                                                &amp;lt;sp:AlgorithmSuite&amp;gt;&lt;br/&gt;
                                                        &amp;lt;wsp:Policy&amp;gt;&lt;br/&gt;
                                                                &amp;lt;sp:Basic128 /&amp;gt;&lt;br/&gt;
                                                        &amp;lt;/wsp:Policy&amp;gt;&lt;br/&gt;
                                                &amp;lt;/sp:AlgorithmSuite&amp;gt;&lt;br/&gt;
                                                &amp;lt;sp:Layout&amp;gt;&lt;br/&gt;
                                                        &amp;lt;wsp:Policy&amp;gt;&lt;br/&gt;
                                                                &amp;lt;sp:Strict /&amp;gt;&lt;br/&gt;
                                                        &amp;lt;/wsp:Policy&amp;gt;&lt;br/&gt;
                                                &amp;lt;/sp:Layout&amp;gt;&lt;br/&gt;
                                                &amp;lt;sp:IncludeTimestamp /&amp;gt;&lt;br/&gt;
                                                &amp;lt;sp:EncryptSignature /&amp;gt;&lt;br/&gt;
                                                &amp;lt;sp:OnlySignEntireHeadersAndBody /&amp;gt;&lt;br/&gt;
                                        &amp;lt;/wsp:Policy&amp;gt;&lt;br/&gt;
                                &amp;lt;/sp:SymmetricBinding&amp;gt;&lt;br/&gt;
                                &amp;lt;sp:EndorsingSupportingTokens&lt;br/&gt;
xmlns:sp=&quot;http://schemas.xmlsoap.org/ws/2005/07/securitypolicy&quot;&amp;gt;&lt;br/&gt;
                                        &amp;lt;wsp:Policy&amp;gt;&lt;br/&gt;
                                                &amp;lt;sp:X509Token&lt;br/&gt;
sp:IncludeToken=&quot;http://schemas.xmlsoap.org/ws/2005/07/securitypolicy/IncludeToken/AlwaysToRecipient&quot;&amp;gt;&lt;br/&gt;
                                                        &amp;lt;wsp:Policy&amp;gt;&lt;br/&gt;
                                                                &amp;lt;sp:RequireThumbprintReference /&amp;gt;&lt;br/&gt;
                                                                &amp;lt;sp:WssX509V3Token10 /&amp;gt;&lt;br/&gt;
                                                        &amp;lt;/wsp:Policy&amp;gt;&lt;br/&gt;
                                                &amp;lt;/sp:X509Token&amp;gt;&lt;br/&gt;
                                        &amp;lt;/wsp:Policy&amp;gt;&lt;br/&gt;
                                &amp;lt;/sp:EndorsingSupportingTokens&amp;gt;&lt;br/&gt;
                                &amp;lt;sp:Wss11&lt;br/&gt;
xmlns:sp=&quot;http://schemas.xmlsoap.org/ws/2005/07/securitypolicy&quot;&amp;gt;&lt;br/&gt;
                                        &amp;lt;wsp:Policy&amp;gt;&lt;br/&gt;
                                                &amp;lt;sp:MustSupportRefKeyIdentifier /&amp;gt;&lt;br/&gt;
                                                &amp;lt;sp:MustSupportRefIssuerSerial /&amp;gt;&lt;br/&gt;
                                                &amp;lt;sp:MustSupportRefThumbprint /&amp;gt;&lt;br/&gt;
                                                &amp;lt;sp:MustSupportRefEncryptedKey /&amp;gt;&lt;br/&gt;
                                                &amp;lt;sp:RequireSignatureConfirmation /&amp;gt;&lt;br/&gt;
                                        &amp;lt;/wsp:Policy&amp;gt;&lt;br/&gt;
                                &amp;lt;/sp:Wss11&amp;gt;&lt;br/&gt;
                                &amp;lt;sp:Trust10&lt;br/&gt;
xmlns:sp=&quot;http://schemas.xmlsoap.org/ws/2005/07/securitypolicy&quot;&amp;gt;&lt;br/&gt;
                                        &amp;lt;wsp:Policy&amp;gt;&lt;br/&gt;
                                                &amp;lt;sp:MustSupportIssuedTokens /&amp;gt;&lt;br/&gt;
                                                &amp;lt;sp:RequireClientEntropy /&amp;gt;&lt;br/&gt;
                                                &amp;lt;sp:RequireServerEntropy /&amp;gt;&lt;br/&gt;
                                        &amp;lt;/wsp:Policy&amp;gt;&lt;br/&gt;
                                &amp;lt;/sp:Trust10&amp;gt;&lt;br/&gt;
                                &amp;lt;wsaw:UsingAddressing /&amp;gt;&lt;br/&gt;
                        &amp;lt;/wsp:All&amp;gt;&lt;br/&gt;
                &amp;lt;/wsp:ExactlyOne&amp;gt;&lt;br/&gt;
        &amp;lt;/wsp:Policy&amp;gt;&lt;br/&gt;
        &amp;lt;wsp:Policy wsu:Id=&quot;B&quot;&amp;gt;&lt;br/&gt;
                &amp;lt;wsp:ExactlyOne&amp;gt;&lt;br/&gt;
                        &amp;lt;wsp:All&amp;gt;&lt;br/&gt;
                                &amp;lt;sp:SignedParts&lt;br/&gt;
xmlns:sp=&quot;http://schemas.xmlsoap.org/ws/2005/07/securitypolicy&quot;&amp;gt;&lt;br/&gt;
                                        &amp;lt;sp:Body /&amp;gt;&lt;br/&gt;
                                        &amp;lt;sp:Header Name=&quot;To&quot;&lt;br/&gt;
Namespace=&quot;http://www.w3.org/2005/08/addressing&quot; /&amp;gt;&lt;br/&gt;
                                        &amp;lt;sp:Header Name=&quot;From&quot;&lt;br/&gt;
Namespace=&quot;http://www.w3.org/2005/08/addressing&quot; /&amp;gt;&lt;br/&gt;
                                        &amp;lt;sp:Header Name=&quot;FaultTo&quot;&lt;br/&gt;
Namespace=&quot;http://www.w3.org/2005/08/addressing&quot; /&amp;gt;&lt;br/&gt;
                                        &amp;lt;sp:Header Name=&quot;ReplyTo&quot;&lt;br/&gt;
Namespace=&quot;http://www.w3.org/2005/08/addressing&quot; /&amp;gt;&lt;br/&gt;
                                        &amp;lt;sp:Header Name=&quot;MessageID&quot;&lt;br/&gt;
Namespace=&quot;http://www.w3.org/2005/08/addressing&quot; /&amp;gt;&lt;br/&gt;
                                        &amp;lt;sp:Header Name=&quot;RelatesTo&quot;&lt;br/&gt;
Namespace=&quot;http://www.w3.org/2005/08/addressing&quot; /&amp;gt;&lt;br/&gt;
                                        &amp;lt;sp:Header Name=&quot;Action&quot;&lt;br/&gt;
Namespace=&quot;http://www.w3.org/2005/08/addressing&quot; /&amp;gt;&lt;br/&gt;
                                &amp;lt;/sp:SignedParts&amp;gt;&lt;br/&gt;
                                &amp;lt;sp:EncryptedParts&lt;br/&gt;
xmlns:sp=&quot;http://schemas.xmlsoap.org/ws/2005/07/securitypolicy&quot;&amp;gt;&lt;br/&gt;
                                        &amp;lt;sp:Body /&amp;gt;&lt;br/&gt;
                                &amp;lt;/sp:EncryptedParts&amp;gt;&lt;br/&gt;
                        &amp;lt;/wsp:All&amp;gt;&lt;br/&gt;
                &amp;lt;/wsp:ExactlyOne&amp;gt;&lt;br/&gt;
        &amp;lt;/wsp:Policy&amp;gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;cxf-2.2.2, wss4j-1.5.7, xmlsec-1.4.2&lt;/p&gt;</environment>
        <key id="12431367">CXF-2356</key>
            <summary>WS-SecurityPolicy and faults</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dkulp">Daniel Kulp</assignee>
                                    <reporter username="lipkap">Pawel Lipka</reporter>
                        <labels>
                    </labels>
                <created>Fri, 24 Jul 2009 13:25:54 +0000</created>
                <updated>Mon, 3 Aug 2009 20:07:05 +0000</updated>
                            <resolved>Fri, 24 Jul 2009 18:02:08 +0000</resolved>
                                    <version>2.2.2</version>
                                    <fixVersion>2.2.3</fixVersion>
                                    <component>WS-* Components</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12735050" author="lipkap" created="Fri, 24 Jul 2009 13:26:32 +0000"  >&lt;p&gt;A maven project with a test that shows the bug&lt;/p&gt;</comment>
                            <comment id="12735051" author="lipkap" created="Fri, 24 Jul 2009 13:27:02 +0000"  >&lt;p&gt;Unzip the attachment and run mvn test.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12414438" name="wssecuritypolicy-tests.zip" size="17119" author="lipkap" created="Fri, 24 Jul 2009 13:26:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10063"><![CDATA[Advanced]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>113783</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 18 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i14eyf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>233886</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>