<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:41:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-2792] Custom Executor for Service object is ignored by the CXF JAX-WS run-time when Disaptch.invokeAsync is used</title>
                <link>https://issues.apache.org/jira/browse/CXF-2792</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;Hi, &lt;/p&gt;

&lt;p&gt;I&apos;m trying to invoke 10000 external services using invokeAsync from my standalone JAX-WS  client. &lt;br/&gt;
I set my custom Executor on the Service objects. This executor is a ThreadPool with 3 threads. But it looks like it is ignored completely by the CXF &lt;br/&gt;
run-time. Instead of an Executor, an instance of AutomaticWorkQueueImpl  is used. &lt;/p&gt;

&lt;p&gt;BTW, by default, AutomaticWorkQueueImpl  is an unbounded queue, so that a few thousands threads are created for processing asynchronous responses. This is of cause problematic and has a big performance impact. By providing the configuration for AutomaticWorkQueueImpl  in cxf.xml, the AutomaticWorkQueueImpl  can be configured to have a required number of threads and required maximum capacity.&lt;/p&gt;

&lt;p&gt;So, I did some debugging to see, why and where AutomaticWorkQueueImpl is called at all during asynchronous WS invocations using Dispatch.invokeAsync(). &lt;/p&gt;

&lt;p&gt;This is the stack trace I got: &lt;br/&gt;
Thread &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; (Suspended (entry into method execute in AutomaticWorkQueueImpl))	&lt;br/&gt;
        AutomaticWorkQueueImpl.execute(Runnable) line: 247	&lt;br/&gt;
        HTTPConduit$WrappedOutputStream.handleResponse() line: 2153	&lt;br/&gt;
        HTTPConduit$WrappedOutputStream.close() line: 1988	&lt;br/&gt;
        HTTPConduit(AbstractConduit).close(Message) line: 66	&lt;br/&gt;
        HTTPConduit.close(Message) line: 639	&lt;br/&gt;
        MessageSenderInterceptor$MessageSenderEndingInterceptor.handleMessage(Message) line: 62	&lt;br/&gt;
        PhaseInterceptorChain.doIntercept(Message) line: 243	&lt;br/&gt;
        ClientImpl.invoke(ClientCallback, BindingOperationInfo, Object...) line: 422	&lt;br/&gt;
        ClientImpl.invokeWrapped(ClientCallback, QName, Object...) line: 371	&lt;br/&gt;
        DispatchImpl&amp;lt;T&amp;gt;.invokeAsync(T, AsyncHandler&amp;lt;T&amp;gt;) line: 288	&lt;br/&gt;
        TestAsyncProviderClient.invokeMyDispatch(Dispatch&amp;lt;Source&amp;gt;, Object, AsyncHandler&amp;lt;Source&amp;gt;) line: 298	&lt;br/&gt;
        TestAsyncProviderClient.testManyAsyncResponses() line: 218	&lt;br/&gt;
        TestAsyncProviderClient.main(String[]) line: 159	&lt;/p&gt;


&lt;p&gt;According to this trace, WS-response processing at the HTTP level is put for the execution on a dedicated working queue in the HTTPConduit.handleResponse method: &lt;/p&gt;

&lt;p&gt;protected void handleResponse() throws IOException { &lt;/p&gt;

&lt;p&gt;            handleRetransmits(); &lt;/p&gt;

&lt;p&gt;            if (outMessage == null  || outMessage.getExchange() == null  || outMessage.getExchange().isSynchronous()) &lt;/p&gt;
{ 
                handleResponseInternal(); 
            }
&lt;p&gt; else { &lt;br/&gt;
                Runnable runnable = new Runnable() { &lt;br/&gt;
                    public void run() { &lt;br/&gt;
                        try &lt;/p&gt;
{ 
                            handleResponseInternal(); 
                        }
&lt;p&gt; catch (Exception e) &lt;/p&gt;
{ 
                            Message inMessage = new MessageImpl(); 
                            inMessage.setExchange(outMessage.getExchange()); 
                            inMessage.setContent(Exception.class, e); 
                            incomingObserver.onMessage(inMessage); 
                        }
&lt;p&gt; &lt;br/&gt;
                    } &lt;br/&gt;
                }; &lt;br/&gt;
                WorkQueueManager mgr = outMessage.getExchange().get(Bus.class) &lt;br/&gt;
                    .getExtension(WorkQueueManager.class); &lt;br/&gt;
                AutomaticWorkQueue queue = mgr.getNamedWorkQueue(&quot;http-conduit&quot;); &lt;br/&gt;
                if (queue == null) &lt;/p&gt;
{ 
                    queue = mgr.getAutomaticWorkQueue(); 
                }
&lt;p&gt; &lt;br/&gt;
                queue.execute(runnable); &lt;br/&gt;
            } &lt;br/&gt;
 } &lt;/p&gt;

&lt;p&gt;It is easy to see that Executor set for the JAX-WS Service is not propagated down to the HTTP transoport level, which required dedicated configuration for AutomaticWorkQueue, be it http-conduit queue or automatic work queue. &lt;/p&gt;

&lt;p&gt;For WS-responses at the user-level, i.e. by means of the JAX-WS AsyncHandler handlers, the proper Executor is taken from the Service object. &lt;/p&gt;

&lt;p&gt;See also the discussion on the mailing list:&lt;br/&gt;
&lt;a href=&quot;http://old.nabble.com/RejectedExecutionException-when-doing-many-invokeAsync-invocations-ts28266640.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://old.nabble.com/RejectedExecutionException-when-doing-many-invokeAsync-invocations-ts28266640.html&lt;/a&gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;Standalone CXF-client used on Windows Vista&lt;/p&gt;</environment>
        <key id="12463343">CXF-2792</key>
            <summary>Custom Executor for Service object is ignored by the CXF JAX-WS run-time when Disaptch.invokeAsync is used</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dkulp">Daniel Kulp</assignee>
                                    <reporter username="romixlev">Leo Romanoff</reporter>
                        <labels>
                            <label>Executor</label>
                            <label>asynchronous</label>
                            <label>concurrency</label>
                            <label>invokeasync</label>
                    </labels>
                <created>Thu, 29 Apr 2010 15:48:55 +0000</created>
                <updated>Mon, 10 May 2010 18:06:12 +0000</updated>
                            <resolved>Wed, 5 May 2010 06:36:38 +0000</resolved>
                                    <version>2.2.7</version>
                                    <fixVersion>2.2.8</fixVersion>
                                    <component>JAX-WS Runtime</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114166</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 30 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0uzxz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178964</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>