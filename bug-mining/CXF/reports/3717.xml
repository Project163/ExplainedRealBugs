<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:39:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-8946] HttpClient in CXF causing memory leak</title>
                <link>https://issues.apache.org/jira/browse/CXF-8946</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;When processing requests using the JAX RS client which used the new HttpClient, there is a memory leak.&lt;/p&gt;

&lt;p&gt;We found this when running it in spring boot using&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Async&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I have tried to reproduce it using the attached code, and it seems to work with a low heap size.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;You can execute the code like so:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
mvn compile exec:exec&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13554653">CXF-8946</key>
            <summary>HttpClient in CXF causing memory leak</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dkulp">Daniel Kulp</assignee>
                                    <reporter username="sebastian_violet">Sebastian Violet</reporter>
                        <labels>
                    </labels>
                <created>Wed, 18 Oct 2023 21:37:26 +0000</created>
                <updated>Fri, 2 Feb 2024 18:20:25 +0000</updated>
                            <resolved>Fri, 20 Oct 2023 17:09:04 +0000</resolved>
                                    <version>4.0.3</version>
                                    <fixVersion>3.6.3</fixVersion>
                    <fixVersion>4.0.4</fixVersion>
                                    <component>JAX-RS</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17776918" author="JIRAUSER302659" created="Wed, 18 Oct 2023 21:39:15 +0000"  >&lt;p&gt;Here is a heap dump: &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13063660/13063660_java_pid17394.hprof.zip&quot; title=&quot;java_pid17394.hprof.zip attached to CXF-8946&quot;&gt;java_pid17394.hprof.zip&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17776919" author="JIRAUSER302659" created="Wed, 18 Oct 2023 21:40:01 +0000"  >&lt;p&gt;Using Eclipse MAT, here is the leak suspect report: &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13063659/13063659_java_pid17394_Leak_Suspects.zip&quot; title=&quot;java_pid17394_Leak_Suspects.zip attached to CXF-8946&quot;&gt;java_pid17394_Leak_Suspects.zip&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17776942" author="JIRAUSER302659" created="Wed, 18 Oct 2023 23:21:14 +0000"  >&lt;p&gt;Here is a repo as close to the setting we have on your server: &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13063727/13063727_memory-leak-demo.zip&quot; title=&quot;memory-leak-demo.zip attached to CXF-8946&quot;&gt;memory-leak-demo.zip&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17776943" author="JIRAUSER302659" created="Wed, 18 Oct 2023 23:22:23 +0000"  >&lt;p&gt;However, this seems to cleanup the reference to HttpClient correctly.&lt;/p&gt;</comment>
                            <comment id="17776952" author="reta" created="Wed, 18 Oct 2023 23:57:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dkulp&quot; class=&quot;user-hover&quot; rel=&quot;dkulp&quot;&gt;dkulp&lt;/a&gt; seems like another one, could you please take a look? thank you&lt;/p&gt;</comment>
                            <comment id="17777301" author="dkulp" created="Thu, 19 Oct 2023 14:43:26 +0000"  >&lt;p&gt;Just adding some notes while investigating....&lt;/p&gt;

&lt;p&gt;If the service client is properly closed, it goes forever.&#160; &#160;That&apos;s good news:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; status() {
      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; StatusService service = JAXRSClientFactory.create(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.apiUrl, StatusService.class,
          Collections.singletonList(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GsonJsonProvider()));
      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (AutoCloseable c = (AutoCloseable)service) {
          &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ClientConfiguration config = WebClient.getConfig(service);
    
          &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Slf4jVerboseEventSender slf4jVerboseEventSender = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Slf4jVerboseEventSender();
          config.getInInterceptors().add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; LoggingInInterceptor(slf4jVerboseEventSender));
          config.getOutInterceptors().add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; LoggingOutInterceptor(slf4jVerboseEventSender));
          &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; service.status();
      } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
        &lt;span class=&quot;code-comment&quot;&gt;// TODO Auto-generated &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; block
&lt;/span&gt;        e.printStackTrace();
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
      }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;br/&gt;
Also, if I update the sleep() method to add four calls to System.gc(), it also runs forever. (three is not enough)   Thus, the references ARE being released eventually.   It&apos;s just taking a lot longer that it should.   Not sure why yet.   Still Investigating. &lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17777477" author="JIRAUSER302659" created="Thu, 19 Oct 2023 21:42:10 +0000"  >&lt;p&gt;Just reproduced the Memory Leak! It was the use of Spring Retry that caused the issue!&lt;/p&gt;



&lt;p&gt;&lt;b&gt;The Code; Latest&lt;/b&gt;: &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13063727/13063727_memory-leak-demo.zip&quot; title=&quot;memory-leak-demo.zip attached to CXF-8946&quot;&gt;memory-leak-demo.zip&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Heap Dump&lt;/b&gt;: &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13063725/13063725_java_pid91652.0001.hprof.zip&quot; title=&quot;java_pid91652.0001.hprof.zip attached to CXF-8946&quot;&gt;java_pid91652.0001.hprof.zip&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Leak Report&lt;/b&gt;: &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13063724/13063724_java_pid91652.0001_Leak_Suspects.zip&quot; title=&quot;java_pid91652.0001_Leak_Suspects.zip attached to CXF-8946&quot;&gt;java_pid91652.0001_Leak_Suspects.zip&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;VisualVM&lt;/b&gt;:&lt;/p&gt;

&lt;p&gt;&#160; &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13063722/13063722_Screenshot+2023-10-19+at+2.29.56+PM.png&quot; height=&quot;297&quot; width=&quot;433&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;






&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17777483" author="JIRAUSER302659" created="Thu, 19 Oct 2023 22:00:39 +0000"  >&lt;p&gt;I even tried to use a new RetryTemplate per call, but the leak is still there:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
diff --git a/src/main/java/com/memoryleak/demo/jaxrs/StatusClientImpl.java b/src/main/java/com/memoryleak/demo/jaxrs/StatusClientImpl.java
index 2d2f04f..ea968e6 100644
--- a/src/main/java/com/memoryleak/demo/jaxrs/StatusClientImpl.java
+++ b/src/main/java/com/memoryleak/demo/jaxrs/StatusClientImpl.java
@@ -27,13 +27,17 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;StatusClientImpl &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; StatusClient {
&#160;
&#160; &#160;@Builder.Default
&#160; &#160;@NonNull
- &#160;&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; RetryTemplate retryTemplate = RetryTemplate.builder()
- &#160; &#160; &#160;.maxAttempts(1)
- &#160; &#160; &#160;.noBackoff()
- &#160; &#160; &#160;.build(); &lt;span class=&quot;code-comment&quot;&gt;//No retries
&lt;/span&gt;+ &#160;&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; RetryTemplate retryTemplate = getRetryTemplate(); &lt;span class=&quot;code-comment&quot;&gt;//No retries
&lt;/span&gt;+
+ &#160;&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; RetryTemplate getRetryTemplate() {
+ &#160; &#160;&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; RetryTemplate.builder()
+ &#160; &#160; &#160; &#160;.maxAttempts(1)
+ &#160; &#160; &#160; &#160;.noBackoff()
+ &#160; &#160; &#160; &#160;.build();
+ &#160;}
&#160;
&#160; &#160;&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &amp;lt;T&amp;gt; T doWithRetry(Function&amp;lt;StatusClient, T&amp;gt; functionToRetry) {
- &#160; &#160;&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.doWithRetry(functionToRetry, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.retryTemplate);
+ &#160; &#160;&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.doWithRetry(functionToRetry, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.getRetryTemplate());
&#160; &#160;}
&#160;
&#160; &#160;&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &amp;lt;T&amp;gt; T doWithRetry(Function&amp;lt;StatusClient, T&amp;gt; functionToRetry, RetryTemplate templateToUse) {
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17777485" author="JIRAUSER302659" created="Thu, 19 Oct 2023 22:05:31 +0000"  >&lt;p&gt;Additional background is that this Memory-Leak doesn&apos;t happen on &lt;b&gt;CXF 4.0.0&lt;/b&gt;.&lt;/p&gt;

&lt;p&gt;It is only after the addition of &lt;a href=&quot;https://github.com/apache/cxf/blob/4adb1dc8bbd08f0910c5daef628182fea436523d/rt/transports/http/src/main/java/org/apache/cxf/transport/http/HttpClientHTTPConduit.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;rt/transports/http/src/main/java/org/apache/cxf/transport/http/HttpClientHTTPConduit.java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This is the diff between &lt;a href=&quot;https://github.com/apache/cxf/compare/02310e95fe74c0c031f540f3284e4a9bd856ced2...4adb1dc8bbd08f0910c5daef628182fea436523d#diff-a2fecaaf06665b20d7b6abb440bd118b9e161bc3199e1abeb801397c4395f5bb&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;4.0.0 and 4.0.3&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17777486" author="JIRAUSER302659" created="Thu, 19 Oct 2023 22:06:50 +0000"  >&lt;p&gt;So, why does this memory leak only happen when using &lt;b&gt;CXF 4.0.3&lt;/b&gt; and &lt;b&gt;RestTemplate&lt;/b&gt;(Which works with &lt;b&gt;CXF 4.0.0&lt;/b&gt;)?&lt;/p&gt;</comment>
                            <comment id="17777495" author="reta" created="Thu, 19 Oct 2023 22:39:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sebastian_violet&quot; class=&quot;user-hover&quot; rel=&quot;sebastian_violet&quot;&gt;sebastian_violet&lt;/a&gt; this part I could explain: the CXF 4.0.0 uses HTTPURLConnection (based on URLConnection) whereas 4.0.1 and above - JDK&apos;s HttpClient.&lt;/p&gt;</comment>
                            <comment id="17777496" author="dkulp" created="Thu, 19 Oct 2023 22:47:32 +0000"  >&lt;p&gt;I have no idea how to use your second demo.  &quot;mvn test&quot; runs fine and nothing fails or memory dumps or anything with 4.0.3.   &lt;/p&gt;

&lt;p&gt;Your first one from yesterday is now fixed.     Had it running for 40 minutes this afternoon while running the rest of the CXF tests before pushing the changes.  I&apos;ll deploy a 4.0.4-SNAPSHOT.  Should be available in 20m or so if you want to test with that.&lt;/p&gt;

&lt;p&gt;That all said, as I alluded to, you SHOULD be either (a) closing the StatusClient service when done with it to let it release things immediately, or (b) (likely preferable) Reusing the StatusClient.   Creating a JAXRSClientFactory and the client is a very heavyweight process. &lt;/p&gt;</comment>
                            <comment id="17777500" author="JIRAUSER302659" created="Thu, 19 Oct 2023 23:22:18 +0000"  >&lt;p&gt;My apologies for not giving the command to run the program.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-bash&quot;&gt;
mvn clean install spring-boot:run&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;You can have a simple Express js application that serves the request of the JAX-RS client. In may case, it looks something like so:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-javascript&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt; express = require(&lt;span class=&quot;code-quote&quot;&gt;&apos;express&apos;&lt;/span&gt;);
&lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt; app = express();
&lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt; port = 9899;

&lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt; bodyParser = require(&lt;span class=&quot;code-quote&quot;&gt;&quot;body-parser&quot;&lt;/span&gt;);
app.use(bodyParser.urlencoded({ extended: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; }));

app.post(&lt;span class=&quot;code-quote&quot;&gt;&apos;/status&apos;&lt;/span&gt;, (req, res) =&amp;gt; {
&#160; res.setHeader(&lt;span class=&quot;code-quote&quot;&gt;&apos;Content-Type&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;application/json&apos;&lt;/span&gt;);
&#160; &lt;span class=&quot;code-comment&quot;&gt;// res.send(501, &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;bad&quot;&lt;/span&gt;}&apos;&lt;/span&gt;);
&lt;/span&gt;&#160; &lt;span class=&quot;code-comment&quot;&gt;// res.send(404, &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;bad&quot;&lt;/span&gt;}&apos;&lt;/span&gt;);
&lt;/span&gt;&#160; &lt;span class=&quot;code-comment&quot;&gt;// res.send(200, &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;ok&quot;&lt;/span&gt;}&apos;&lt;/span&gt;);
&lt;/span&gt;&#160; res.send(204, &apos;&apos;);
});

&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; server = app.listen(port, () =&amp;gt; {
&#160; console.log(&lt;span class=&quot;code-quote&quot;&gt;`Example app listening at http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:${port}`&lt;/span&gt;);
&lt;/span&gt;})

server.keepAliveTimeout = 1200 * 1000;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And the script to run the load against the SpringBoot app is here: &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13063726/13063726_call_mem_leak.sh&quot; title=&quot;call_mem_leak.sh attached to CXF-8946&quot;&gt;call_mem_leak.sh&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;You can execute it like so:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
./call_mem_leak.sh -c 50000 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;br/&gt;
P.S. I have updated the code from above to contain a README.md file for these instructions.&lt;br/&gt;
&#160;&lt;/p&gt;</comment>
                            <comment id="17777501" author="JIRAUSER302659" created="Thu, 19 Oct 2023 23:25:04 +0000"  >&lt;p&gt;Also, what maven repository should I add to my &lt;b&gt;settings.xml&lt;/b&gt; to get &lt;b&gt;4.0.4-SNAPSHOT&lt;/b&gt;?&lt;/p&gt;</comment>
                            <comment id="17777508" author="dkulp" created="Fri, 20 Oct 2023 00:09:55 +0000"  >
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;repositories&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;repository&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;id&amp;gt;&lt;/span&gt;apache.snapshots&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/id&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;url&amp;gt;&lt;/span&gt;https://repository.apache.org/snapshots/&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/url&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;name&amp;gt;&lt;/span&gt;Apache Snapshot Repo&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/name&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;snapshots&amp;gt;&lt;/span&gt;
                &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;enabled&amp;gt;&lt;/span&gt;true&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/enabled&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/snapshots&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;releases&amp;gt;&lt;/span&gt;
                &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;enabled&amp;gt;&lt;/span&gt;false&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/enabled&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/releases&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/repository&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/repositories&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17777803" author="JIRAUSER302659" created="Fri, 20 Oct 2023 14:22:10 +0000"  >&lt;p&gt;I have also updated the standalone CXF test which has an internal mock http server:  &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13063750/13063750_CXF-HTTPClient-MemoryLeak.zip&quot; title=&quot;CXF-HTTPClient-MemoryLeak.zip attached to CXF-8946&quot;&gt;CXF-HTTPClient-MemoryLeak.zip&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; &lt;/p&gt;

&lt;p&gt;You can run it like so till it fails; which should take just &lt;b&gt;50&lt;/b&gt; seconds:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-bash&quot;&gt;
mvn compile exec:exec
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17777816" author="JIRAUSER302659" created="Fri, 20 Oct 2023 14:41:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dkulp&quot; class=&quot;user-hover&quot; rel=&quot;dkulp&quot;&gt;dkulp&lt;/a&gt;, I just tested with &lt;b&gt;4.0.4-SNAPSHOT&lt;/b&gt; locally, and it looks great!&lt;/p&gt;

&lt;p&gt;&lt;b&gt;MemoryLeakCreator&lt;/b&gt;:&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13063751/13063751_screenshot-1.png&quot; height=&quot;397&quot; width=&quot;581&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;br/&gt;
&lt;b&gt;DemoApplication&lt;/b&gt;:&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13063752/13063752_screenshot-2.png&quot; height=&quot;397&quot; width=&quot;581&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;br/&gt;
&#160;&lt;/p&gt;</comment>
                            <comment id="17777921" author="JIRAUSER302659" created="Fri, 20 Oct 2023 19:00:10 +0000"  >&lt;p&gt;Thanks for all the hard work &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dkulp&quot; class=&quot;user-hover&quot; rel=&quot;dkulp&quot;&gt;dkulp&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="17813789" author="bocamel" created="Fri, 2 Feb 2024 18:20:25 +0000"  >&lt;p&gt;I am getting OutOfMemoryException with CXF 3.6.2 and OpenJ9 (IBM Semeru ibm-semeru-open-jre_x64_windows_17.0.9_9_openj9-0.41.0).&#160; In the dump, there are two thousands of threads &quot;HttpClient-xxxx-SelectorManager&quot;.&#160; Not sure whether it is related to this issue or &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-8885&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CXF-8885&lt;/a&gt;.&#160; I do not see this issue if using Hotspot JVM.&#160; If it is not related to this issue, I will open a new one.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13555437">CXF-8950</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13063750" name="CXF-HTTPClient-MemoryLeak.zip" size="147270" author="sebastian_violet" created="Fri, 20 Oct 2023 14:22:06 +0000"/>
                            <attachment id="13063722" name="Screenshot 2023-10-19 at 2.29.56 PM.png" size="510502" author="sebastian_violet" created="Thu, 19 Oct 2023 21:33:15 +0000"/>
                            <attachment id="13063726" name="call_mem_leak.sh" size="212" author="sebastian_violet" created="Thu, 19 Oct 2023 23:18:47 +0000"/>
                            <attachment id="13063660" name="java_pid17394.hprof.zip" size="15359089" author="sebastian_violet" created="Wed, 18 Oct 2023 21:42:06 +0000"/>
                            <attachment id="13063659" name="java_pid17394_Leak_Suspects.zip" size="205642" author="sebastian_violet" created="Wed, 18 Oct 2023 21:39:57 +0000"/>
                            <attachment id="13063725" name="java_pid91652.0001.hprof.zip" size="50522654" author="sebastian_violet" created="Thu, 19 Oct 2023 21:41:49 +0000"/>
                            <attachment id="13063724" name="java_pid91652.0001_Leak_Suspects.zip" size="106578" author="sebastian_violet" created="Thu, 19 Oct 2023 21:39:19 +0000"/>
                            <attachment id="13063727" name="memory-leak-demo.zip" size="43889547" author="sebastian_violet" created="Thu, 19 Oct 2023 23:34:13 +0000"/>
                            <attachment id="13063751" name="screenshot-1.png" size="636708" author="sebastian_violet" created="Fri, 20 Oct 2023 14:34:50 +0000"/>
                            <attachment id="13063752" name="screenshot-2.png" size="601439" author="sebastian_violet" created="Fri, 20 Oct 2023 14:40:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>10.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 40 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1l1fs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>