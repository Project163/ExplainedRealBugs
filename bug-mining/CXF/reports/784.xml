<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:44:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-3230] CXF over JMS leaks JMS resources  when no replay queue is specified</title>
                <link>https://issues.apache.org/jira/browse/CXF-3230</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;This issue was found both when testing with ActiveMQ 5.4.2 and HornetQ 2.1.2 as JMS provider. The JMS settings is  set in the WSDL file:&lt;/p&gt;

&lt;p&gt;	&amp;lt;service name=&quot;TestJMS&quot;&amp;gt;&lt;br/&gt;
			&amp;lt;port binding=&quot;tns:TestBinding&quot; name=&quot;Test&quot;&amp;gt;&lt;br/&gt;
			&amp;lt;address destinationStyle=&quot;queue&quot; &lt;br/&gt;
						jndiConnectionFactoryName=&quot;ConnectionFactory&quot; &lt;br/&gt;
						jndiDestinationName=&quot;dynamicQueues/messageDestination&quot;&lt;br/&gt;
						xmlns=&quot;http://cxf.apache.org/transports/jms&quot;&amp;gt;&lt;br/&gt;
				&amp;lt;JMSNamingProperty name=&quot;java.naming.provider.url&quot; value=&quot;tcp://localhost:61616?jms.watchTopicAdvisories=false&quot;/&amp;gt;&lt;br/&gt;
				&amp;lt;JMSNamingProperty name=&quot;java.naming.factory.initial&quot; value=&quot;org.apache.activemq.jndi.ActiveMQInitialContextFactory&quot;/&amp;gt;&lt;br/&gt;
			&amp;lt;/address&amp;gt;&lt;br/&gt;
		&amp;lt;/port&amp;gt;&lt;br/&gt;
	&amp;lt;/service&amp;gt;&lt;/p&gt;

&lt;p&gt;The issue was found when performing a test with a server and a client both created with CXF. The client has an infinite loop that performs a request on the server and waits for a response before the next iteration is executed. After a couple of thousands  of request response iterations have been performed the JMS provider starts to get very slow and ActiveMQ gets out of memory if the test is run long enough. First I thought it was a configuration problem with the JMS provider or a bug in ActiveMQ, but because the same problem exists both with HornetQ and several configurations of ActiveMQ it seems like it is a problem with CXF. &lt;/p&gt;

&lt;p&gt;When monitoring ActiveMQ with jconsole it can be seen that when ActiveMQ is set to not use a thread pool (-Dorg.apache.activemq.UseDedicatedTaskRunner=true), the number of threads grows while the test is running and no threads seem to be deallocated. When a thread pool is used the number of threads is quite constant but the amount of memory on the heap still grows. No leak is observed when a response queue is specified with jndiReplyDestinationName. So when a temporary queue should be used to send back the replay it seems like one replay queue is created for every replay and they never get removed.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux, ActiveMQ 5.4.2 and HornetQ 2.1.2&lt;/p&gt;</environment>
        <key id="12494625">CXF-3230</key>
            <summary>CXF over JMS leaks JMS resources  when no replay queue is specified</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cschneider">Christian Schneider</assignee>
                                    <reporter username="kjell">Kjell Winblad</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 Jan 2011 18:07:24 +0000</created>
                <updated>Tue, 1 Mar 2011 15:53:34 +0000</updated>
                            <resolved>Thu, 3 Feb 2011 06:48:23 +0000</resolved>
                                    <version>2.3.1</version>
                                    <fixVersion>2.3.3</fixVersion>
                                    <component>Transports</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12977386" author="kjell" created="Tue, 4 Jan 2011 18:12:41 +0000"  >&lt;p&gt;Simple test programs that can be used to reproduce the issue. It is an eclipse project. Just run the Server and then the Client to start the test.&lt;/p&gt;</comment>
                            <comment id="12978015" author="chris@die-schneider.net" created="Wed, 5 Jan 2011 22:54:25 +0000"  >&lt;p&gt;I was able to reproduce the issue with cxf 2.3.1 and ActiveMQ 5.4.2 as well as ActiveMQ 4.0.2. &lt;/p&gt;

&lt;p&gt;At the moment I have no idea though what is the cause of the problem. The Heap Memory and JVM THreads do not seem to grow. Only the native threads seem to grow.&lt;/p&gt;

&lt;p&gt;When googling the problem that exception &quot;unable to create new native thread&quot; seems not uncommon in ActiveMQ. As the problem is also reported for other jms providers it can&#180;t be a pure ActiveMQ problem though.&lt;/p&gt;</comment>
                            <comment id="12978022" author="chris@die-schneider.net" created="Wed, 5 Jan 2011 23:01:51 +0000"  >&lt;p&gt;I found something on &lt;a href=&quot;http://activemq.apache.org/javalangoutofmemory.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://activemq.apache.org/javalangoutofmemory.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Number of Threads&lt;/p&gt;

&lt;p&gt;By default, ActiveMQ uses a dedicated thread per destination. If there are large numbers of Destinations there will be a large number of threads and their associated memory resource usage. ActiveMQ can be configured to use a thread pool through the use of the system property: -Dorg.apache.activemq.UseDedicatedTaskRunner=false. This is currently specified in the activemq start script via ACTIVEMQ_OPTS. Using a thread pool can restrict the number of threads required by ActiveMQ and hence reduce memory usage.&lt;/p&gt;</comment>
                            <comment id="12978026" author="chris@die-schneider.net" created="Wed, 5 Jan 2011 23:10:49 +0000"  >&lt;p&gt;I guess I found the problem ... should have read the description of the issue better ... I was so concerned to find the thread leak that I overread that we do not remove the temporary destinations.&lt;br/&gt;
We really do not remove the temporary queues. &lt;/p&gt;

&lt;p&gt;So I think there are two solutions. We could either not create so many temp queues at all or delete each one after the request. The second option is probably easier to do.&lt;/p&gt;</comment>
                            <comment id="12978284" author="chris@die-schneider.net" created="Thu, 6 Jan 2011 11:45:14 +0000"  >&lt;p&gt;Added a patch to delete the temp queue after the request is finished. On my system this fixes the problem.&lt;/p&gt;

&lt;p&gt;I have also committed this to the trunk so you can test this by applying the patch yourself or you can wait till the snapshot release is deployed (tomorrow I guess) and use this. &lt;/p&gt;</comment>
                            <comment id="12981799" author="kjell" created="Fri, 14 Jan 2011 15:46:03 +0000"  >&lt;p&gt;Thanks for the fast fix attempt. Unfortunately it seems like there still is a problem.&lt;/p&gt;

&lt;p&gt;When testing with ActiveMQ it works when adversary messages is switched on. The ActiveMQ documentation (&lt;a href=&quot;http://activemq.apache.org/advisory-message.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://activemq.apache.org/advisory-message.html&lt;/a&gt;) says that adversary messages must be enabled for temporary queues to work. &lt;/p&gt;

&lt;p&gt;When doing the same test but with ActiveMQ replaced with HornetQ the client crashes with the following exception. The same test worked before the patch but then the mq was leaking resources. It seems like the session for which the temp queue is created has been closed before the attempt to to delete the queue. Is that the case or shall this issue be reported to HornetQ?&lt;/p&gt;

&lt;p&gt;INFO: Established shared JMS Connection: org.hornetq.jms.client.HornetQConnection@12381a9c&lt;br/&gt;
Jan 14, 2011 10:46:41 AM org.apache.cxf.phase.PhaseInterceptorChain doDefaultLogging&lt;br/&gt;
WARNING: Interceptor for &lt;/p&gt;
{http://testjms}
&lt;p&gt;TestJMS#&lt;/p&gt;
{http://testjms}
&lt;p&gt;testOp has thrown exception, unwinding now&lt;br/&gt;
java.lang.RuntimeException: Unable to remove temporary queue&lt;br/&gt;
	at org.apache.cxf.transport.jms.JMSConduit.sendExchange(JMSConduit.java:249)&lt;br/&gt;
	at org.apache.cxf.transport.jms.JMSOutputStream.doClose(JMSOutputStream.java:56)&lt;br/&gt;
	at org.apache.cxf.io.CachedOutputStream.close(CachedOutputStream.java:185)&lt;br/&gt;
	at org.apache.cxf.transport.AbstractConduit.close(AbstractConduit.java:56)&lt;br/&gt;
	at org.apache.cxf.interceptor.MessageSenderInterceptor$MessageSenderEndingInterceptor.handleMessage(MessageSenderInterceptor.java:62)&lt;br/&gt;
	at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:247)&lt;br/&gt;
	at org.apache.cxf.endpoint.ClientImpl.invoke(ClientImpl.java:516)&lt;br/&gt;
	at org.apache.cxf.endpoint.ClientImpl.invoke(ClientImpl.java:313)&lt;br/&gt;
	at org.apache.cxf.endpoint.ClientImpl.invoke(ClientImpl.java:265)&lt;br/&gt;
	at org.apache.cxf.frontend.ClientProxy.invokeSync(ClientProxy.java:73)&lt;br/&gt;
	at org.apache.cxf.jaxws.JaxWsClientProxy.invoke(JaxWsClientProxy.java:124)&lt;br/&gt;
	at $Proxy39.testOp(Unknown Source)&lt;br/&gt;
	at Client.main(Client.java:28)&lt;br/&gt;
Caused by: javax.jms.IllegalStateException: Session is closed&lt;br/&gt;
	at org.hornetq.core.client.impl.ClientSessionImpl.checkClosed(ClientSessionImpl.java:1643)&lt;br/&gt;
	at org.hornetq.core.client.impl.ClientSessionImpl.queueQuery(ClientSessionImpl.java:346)&lt;br/&gt;
	at org.hornetq.core.client.impl.DelegatingSession.queueQuery(DelegatingSession.java:436)&lt;br/&gt;
	at org.hornetq.jms.client.HornetQSession.deleteTemporaryQueue(HornetQSession.java:922)&lt;br/&gt;
	at org.hornetq.jms.client.HornetQDestination.delete(HornetQDestination.java:266)&lt;br/&gt;
	at org.apache.cxf.transport.jms.JMSConduit.sendExchange(JMSConduit.java:247)&lt;br/&gt;
	... 12 more&lt;br/&gt;
Caused by: HornetQException&lt;span class=&quot;error&quot;&gt;&amp;#91;errorCode=102 message=Session is closed&amp;#93;&lt;/span&gt;&lt;br/&gt;
	... 18 more&lt;br/&gt;
Exception in thread &quot;main&quot; javax.xml.ws.soap.SOAPFaultException: Unable to remove temporary queue&lt;br/&gt;
	at org.apache.cxf.jaxws.JaxWsClientProxy.invoke(JaxWsClientProxy.java:146)&lt;br/&gt;
	at $Proxy39.testOp(Unknown Source)&lt;br/&gt;
	at Client.main(Client.java:28)&lt;br/&gt;
Caused by: java.lang.RuntimeException: Unable to remove temporary queue&lt;br/&gt;
	at org.apache.cxf.transport.jms.JMSConduit.sendExchange(JMSConduit.java:249)&lt;br/&gt;
	at org.apache.cxf.transport.jms.JMSOutputStream.doClose(JMSOutputStream.java:56)&lt;br/&gt;
	at org.apache.cxf.io.CachedOutputStream.close(CachedOutputStream.java:185)&lt;br/&gt;
	at org.apache.cxf.transport.AbstractConduit.close(AbstractConduit.java:56)&lt;br/&gt;
	at org.apache.cxf.interceptor.MessageSenderInterceptor$MessageSenderEndingInterceptor.handleMessage(MessageSenderInterceptor.java:62)&lt;br/&gt;
	at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:247)&lt;br/&gt;
	at org.apache.cxf.endpoint.ClientImpl.invoke(ClientImpl.java:516)&lt;br/&gt;
	at org.apache.cxf.endpoint.ClientImpl.invoke(ClientImpl.java:313)&lt;br/&gt;
	at org.apache.cxf.endpoint.ClientImpl.invoke(ClientImpl.java:265)&lt;br/&gt;
	at org.apache.cxf.frontend.ClientProxy.invokeSync(ClientProxy.java:73)&lt;br/&gt;
	at org.apache.cxf.jaxws.JaxWsClientProxy.invoke(JaxWsClientProxy.java:124)&lt;br/&gt;
	... 2 more&lt;br/&gt;
Caused by: javax.jms.IllegalStateException: Session is closed&lt;br/&gt;
	at org.hornetq.core.client.impl.ClientSessionImpl.checkClosed(ClientSessionImpl.java:1643)&lt;br/&gt;
	at org.hornetq.core.client.impl.ClientSessionImpl.queueQuery(ClientSessionImpl.java:346)&lt;br/&gt;
	at org.hornetq.core.client.impl.DelegatingSession.queueQuery(DelegatingSession.java:436)&lt;br/&gt;
	at org.hornetq.jms.client.HornetQSession.deleteTemporaryQueue(HornetQSession.java:922)&lt;br/&gt;
	at org.hornetq.jms.client.HornetQDestination.delete(HornetQDestination.java:266)&lt;br/&gt;
	at org.apache.cxf.transport.jms.JMSConduit.sendExchange(JMSConduit.java:247)&lt;br/&gt;
	... 12 more&lt;br/&gt;
Caused by: HornetQException&lt;span class=&quot;error&quot;&gt;&amp;#91;errorCode=102 message=Session is closed&amp;#93;&lt;/span&gt;&lt;br/&gt;
	... 18 more&lt;/p&gt;</comment>
                            <comment id="12981821" author="chris@die-schneider.net" created="Fri, 14 Jan 2011 16:45:18 +0000"  >&lt;p&gt;I am not sure. Could you post your example for Hornetq? Btw. it would be great if you could use maven for the example. It was quite some work to configure the classpath by hand.&lt;/p&gt;

&lt;p&gt;I will also try with HornetQ in the mean time.&lt;/p&gt;</comment>
                            <comment id="12982528" author="kjell" created="Mon, 17 Jan 2011 08:57:24 +0000"  >&lt;p&gt;I use the default settings for HornetQ 2.1.2. The example I used is the same as the one I have attached to this bug with the difference that the address tag in the WSDL is replaced with the following:&lt;/p&gt;

&lt;p&gt;&amp;lt;address destinationStyle=&quot;queue&quot; &lt;br/&gt;
jndiConnectionFactoryName=&quot;/ConnectionFactory&quot; &lt;br/&gt;
jndiDestinationName=&quot;/queue/ExampleQueue&quot;&lt;br/&gt;
connectionUserName=&quot;guest&quot;&lt;br/&gt;
connectionPassword=&quot;guest&quot;&lt;br/&gt;
xmlns=&quot;http://cxf.apache.org/transports/jms&quot;&amp;gt;&lt;br/&gt;
&amp;lt;JMSNamingProperty name=&quot;java.naming.provider.url&quot; value=&quot;jnp://127.0.0.1:1099&quot;/&amp;gt;&lt;br/&gt;
&amp;lt;JMSNamingProperty name=&quot;java.naming.factory.initial&quot; value=&quot;org.jnp.interfaces.NamingContextFactory&quot;/&amp;gt;&lt;br/&gt;
&amp;lt;JMSNamingProperty name=&quot;java.naming.factory.url.pkgs&quot; value=&quot;org.jboss.naming:org.jnp.interfaces&quot;/&amp;gt;&lt;br/&gt;
&amp;lt;/address&amp;gt;&lt;/p&gt;

&lt;p&gt;I will try to learn maven before I send another bug report.&lt;/p&gt;</comment>
                            <comment id="12982661" author="chris@die-schneider.net" created="Mon, 17 Jan 2011 15:01:04 +0000"  >&lt;p&gt;I reopen the issue to check with hornetq. The fix for activemq is in trunk and will go into 2.3.2&lt;/p&gt;</comment>
                            <comment id="12982698" author="chris@die-schneider.net" created="Mon, 17 Jan 2011 16:37:39 +0000"  >&lt;p&gt;Don&#180;t let maven keep you from reporting bugs. It just makes life a little easier for us. I will also help you without an easy test. It is only that the easier you make it for the people that have to solve the problem the faster things get solved usually &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; At least this is what I experienced when reporting bugs myself. The nice thing when I have a maven project is that I can simply import it in eclipse and get all dependencies (with the sonatype eclipse maven plugin). So I can simply start debugging. The plugin even downloads and attaches the source for all dependencies.&lt;br/&gt;
If you want to look into maven projects you best start with the examples from the cxf distribution. &lt;/p&gt;</comment>
                            <comment id="12988720" author="chris@die-schneider.net" created="Mon, 31 Jan 2011 10:32:23 +0000"  >&lt;p&gt;I was able to confirm the exception with HornetQ. HornetQ tries to access a session that is linked to the temp queue to delete the queue. As this session was closed in the mean time this does not work. I believe that this is a bug in hornetq as temporary queues should live as long as a connection. So it must be possible to access them from different sessions and it should not be necessary that the session that created the temp queue is still open. I will file an issue at the hornetq jira. Hopefully a hornetq expert can help us with this.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.jboss.org/browse/HORNETQ-637&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://issues.jboss.org/browse/HORNETQ-637&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12989987" author="chris@die-schneider.net" created="Thu, 3 Feb 2011 06:48:23 +0000"  >&lt;p&gt;The problem with deleting the temp queue in HornetQ can probably be fixed by the HornetQ team. The workaround for CXF 2.3.3 will allow users to have their calls working even if the temp queue is not deleted. Will reopen the issue if the HornetQ team can not fix the problem.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12467627" name="CXF-3230.patch" size="5523" author="cschneider" created="Thu, 6 Jan 2011 11:45:14 +0000"/>
                            <attachment id="12467447" name="CXFJMSResourceLeaking.tar.gz" size="7194" author="kjell" created="Tue, 4 Jan 2011 18:12:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>46988</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 42 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0a37j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>56793</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>