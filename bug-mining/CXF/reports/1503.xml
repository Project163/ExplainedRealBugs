<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:56:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-4570] Attachment Header Content-ID conversion</title>
                <link>https://issues.apache.org/jira/browse/CXF-4570</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;I have a migrating problem for headers in attachment. &lt;br/&gt;
For example, the message sent out contains Content-ID:&amp;lt;foo&amp;gt;,&lt;br/&gt;
Content-ID header value is &quot;&amp;lt;foo&amp;gt;&quot; instead of &quot;foo&quot; at server side.&lt;/p&gt;

&lt;p&gt;When creating attachment of the following code:&lt;br/&gt;
org.apache.cxf.attachment.AttachmentUtil.createAttachment(InputStream, InternetHeaders)&lt;br/&gt;
There&apos;s a id conversion at first. But in the following header processing, there&apos;s no id conversion for Content-ID.&lt;/p&gt;

&lt;p&gt;Since Content-ID conversion is needed for id(&quot;new AttachmentImpl(id)&quot;), I think it is also useful for headers.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12611957">CXF-4570</key>
            <summary>Attachment Header Content-ID conversion</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dkulp">Daniel Kulp</assignee>
                                    <reporter username="ivywjhua">Jinhua Wang</reporter>
                        <labels>
                    </labels>
                <created>Tue, 16 Oct 2012 03:42:16 +0000</created>
                <updated>Wed, 19 Dec 2012 14:38:37 +0000</updated>
                            <resolved>Wed, 17 Oct 2012 15:51:00 +0000</resolved>
                                                    <fixVersion>2.5.7</fixVersion>
                    <fixVersion>2.6.4</fixVersion>
                    <fixVersion>2.7.1</fixVersion>
                                    <component>JAX-WS Runtime</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13477209" author="dkulp" created="Tue, 16 Oct 2012 17:50:09 +0000"  >

&lt;p&gt;Personally, I&apos;m against this change.   Per various specs (such as SAAJ), the Headers map for the attachment should be the exact headers that are passing in the mime part on the wire.  &lt;/p&gt;</comment>
                            <comment id="13477479" author="ffang" created="Wed, 17 Oct 2012 00:12:35 +0000"  >&lt;p&gt;OK, as this behavior is from spec, we need keep it as is.&lt;/p&gt;</comment>
                            <comment id="13477637" author="ivywjhua" created="Wed, 17 Oct 2012 05:51:40 +0000"  >&lt;p&gt;Hello&lt;br/&gt;
If keep the exact headers, we will get two header named &quot;Content-ID&quot; with different values.&lt;br/&gt;
For example, the message contains &quot;Content-ID:&amp;lt;foo&amp;gt;&quot;&lt;br/&gt;
headers in jdk Attachment object is&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Content-ID:foo
Content-ID:&amp;lt;foo&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It is caused by the following code:&lt;br/&gt;
method: &lt;b&gt;org.apache.cxf.binding.soap.saaj.SAAJInInterceptor.handleMessage(SoapMessage)&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;AttachmentPart ap = soapMessage.createAttachmentPart(a.getDataHandler());
ap.setContentId(a.getId());	&lt;span class=&quot;code-comment&quot;&gt;// 1. jdk invoke setMimeHeader(&lt;span class=&quot;code-quote&quot;&gt;&quot;Content-ID&quot;&lt;/span&gt;, paramString);
&lt;/span&gt;Iterator&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; i = a.getHeaderNames();
&lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (i != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; i.hasNext()) {
	&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; h = i.next();
	&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; val = a.getHeader(h);
	ap.addMimeHeader(h, val);	&lt;span class=&quot;code-comment&quot;&gt;// 2. jdk invoke headers.addHeader(paramString1, paramString2);
&lt;/span&gt;}
soapMessage.addAttachmentPart(ap);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&quot;&lt;b&gt;ap.setContentId(a.getId())&lt;/b&gt;&quot; set &quot;Content-ID&quot; header with &quot;foo&quot;.&lt;br/&gt;
&quot;&lt;b&gt;ap.addMimeHeader(h, val)&lt;/b&gt;&quot;  add &quot;Content-ID&quot; header with &quot;&amp;lt;foo&amp;gt;&quot;&lt;/p&gt;

&lt;p&gt;It is confused to get headers with the same header name but different header values.&lt;br/&gt;
I think there is somtehing wrong in &lt;b&gt;create attachment for cxf&lt;/b&gt; or &lt;b&gt;copy header to jdk attachment&lt;/b&gt;.&lt;/p&gt;</comment>
                            <comment id="13477654" author="ivywjhua" created="Wed, 17 Oct 2012 06:20:00 +0000"  >&lt;p&gt;Snippet code for copying attachment from cxf to jdk simulation.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.Iterator;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.xml.soap.AttachmentPart;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.xml.soap.MessageFactory;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.xml.soap.MimeHeader;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.xml.soap.SOAPMessage;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;JDKAttachmentTest {

	&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; STR_CONTENT_ID = &lt;span class=&quot;code-quote&quot;&gt;&quot;Content-ID&quot;&lt;/span&gt;;

	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
		MessageFactory messageFactory = MessageFactory.newInstance();
		SOAPMessage soapMessage = messageFactory.createMessage();
		AttachmentPart attachmentPart = soapMessage.createAttachmentPart();
		attachmentPart.setContentId(&lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;);
		attachmentPart.addMimeHeader(STR_CONTENT_ID, &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;foo&amp;gt;&quot;&lt;/span&gt;);
		soapMessage.addAttachmentPart(attachmentPart);
		
		Iterator&amp;lt;?&amp;gt; attIterator = soapMessage.getAttachments();
		&lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt;(attIterator.hasNext()){
			AttachmentPart att = (AttachmentPart)attIterator.next();
			Iterator&amp;lt;?&amp;gt; headerIterator = att.getAllMimeHeaders();
			&lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt;(headerIterator.hasNext()){
				MimeHeader header = (MimeHeader)headerIterator.next();
				&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(header.getName() + &lt;span class=&quot;code-quote&quot;&gt;&quot;:&quot;&lt;/span&gt; + header.getValue());
			}
		}
	}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;output:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Content-ID:foo
Content-ID:&amp;lt;foo&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13477752" author="ay" created="Wed, 17 Oct 2012 10:17:00 +0000"  >&lt;p&gt;org.apache.cxf.attachment.AttachmentDeserializerTest&apos;s testDeserializerSwA uses this create attachment method and this is not getting any issue (only the bracketed id is placed in the headers and when this message is reserialized, you see only the bracketed content id). So, I don&apos;t know why you are getting the unbracketed one. So, I am not sure if AttachmentUtil itself really has some issue.&lt;/p&gt;</comment>
                            <comment id="13477784" author="ivywjhua" created="Wed, 17 Oct 2012 11:06:37 +0000"  >&lt;p&gt;There are two attachment implementation classes, one is from cxf framework and another if from jdk. &quot;Content-ID&quot; is stored in &lt;b&gt;id&lt;/b&gt; field in cxf implementation. On the contrary &quot;Content-ID&quot; is stroed in &quot;headers&quot; in jdk implementation.&lt;br/&gt;
&lt;b&gt;org.apache.cxf.attachment.AttachmentImpl&lt;/b&gt;(cxf framework)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; id;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; headers = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;b&gt;com.sun.xml.internal.messaging.saaj.soap.AttachmentPartImpl&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; MimeHeaders headers;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setMimeHeader(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; paramString1, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; paramString2) {
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.headers.setHeader(paramString1, paramString2);
  }

  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void addMimeHeader(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; paramString1, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; paramString2) {
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.headers.addHeader(paramString1, paramString2);
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;b&gt;javax.xml.soap.MimeHeaders&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; Vector headers;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When copying content from cxf attachment to jdk attachment, both &quot;Content-ID&quot; values are copied to &lt;b&gt;Vector headers&lt;/b&gt;.&lt;/p&gt;
</comment>
                            <comment id="13477785" author="ivywjhua" created="Wed, 17 Oct 2012 11:09:23 +0000"  >&lt;p&gt;Attachment &lt;b&gt;04.png&lt;/b&gt; is for org.apache.cxf.attachment.AttachmentImpl instance when running test org.apache.cxf.attachment.AttachmentDeserializerTest.testDeserializerSwA()&lt;/p&gt;</comment>
                            <comment id="13477972" author="dkulp" created="Wed, 17 Oct 2012 15:51:00 +0000"  >&lt;p&gt;&lt;br/&gt;
Cleaned up the SAAJIn/Out stuff a little to only call the setContentID if a getContentID call returns null after setting all the headers.   Thus, this should fix the double header issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12549487" name="04.png" size="33888" author="ivywjhua" created="Wed, 17 Oct 2012 11:09:23 +0000"/>
                            <attachment id="12549251" name="AttachmentUtil.java.patch" size="1229" author="ivywjhua" created="Tue, 16 Oct 2012 03:43:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>248894</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 5 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0a2bj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>56649</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>