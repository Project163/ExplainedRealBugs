<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:34:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-8041] Error resolving relative XSD Schema on Tomcat</title>
                <link>https://issues.apache.org/jira/browse/CXF-8041</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;We found an issue in a CXF JAX-WS project when running in WSDL-first mode with schema-validation enabled on Tomcat. The WSDL references an external XSD schema using a relative path. The WSDL and XSD are bundled with the application and are present on the classpath.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Expectation:&lt;/b&gt;&lt;br/&gt;
The XSD should be resolved successfully and schema validation should work.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Actual behavior:&lt;/b&gt;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The resource lookup runs through CXF &lt;tt&gt;EndpointReferenceUtils&lt;/tt&gt;&apos; &lt;tt&gt;SchemaLSResourceResolver&lt;/tt&gt;. This one runs through multiple strategies for resolving the imported XSD URL to a resource. One of them (currently around line 150) is an attempt to ask a &lt;tt&gt;ResourceManager&lt;/tt&gt; for the URL.&lt;/li&gt;
	&lt;li&gt;In a Servlet context, this will be handled by CXF&apos;s &lt;tt&gt;ServletContextResourceResolver&lt;/tt&gt;. This one (currently starting around line 82) will ask the actual &lt;tt&gt;ServletContext&lt;/tt&gt; for the URL. While doing so, it will catch and ignore &lt;tt&gt;MalformedURLException&lt;/tt&gt; s as documented in the &lt;tt&gt;ServletContext&lt;/tt&gt; interface as well as &lt;tt&gt;URISyntaxException&lt;/tt&gt; s (probably precautionary).&lt;/li&gt;
	&lt;li&gt;Entering Tomcat&apos;s implementation: the call will go through Tomcat&apos;s &lt;tt&gt;ApplicationContext&lt;/tt&gt; and end up in the &lt;tt&gt;StandardRoot&lt;/tt&gt;&apos;s &lt;tt&gt;#validate(String)&lt;/tt&gt; method. Unfortunately, while validating the provided URL, this one throws &lt;tt&gt;IllegalArgumentException&lt;/tt&gt; s instead of just returning &lt;tt&gt;null&lt;/tt&gt;. In our case, since we resolve the XSD schema relative to the WSDL and need to go up some levels (../../) from it, Tomcat thinks we&apos;re trying to escape the application context and will trigger the &lt;tt&gt;IllegalArgumentException&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;Unfortunately though, this exception never gets caught and propagates up the stack back to CXF&apos;s &lt;tt&gt;SchemaLSResourceResolver#resolveResource&lt;/tt&gt;. This method had several strategies for resolving resources, remember? The annoying part is: we didn&apos;t even need that particular ServletContext strategy for our XSD, and one of the other methods (classpath lookup) would have resolved the XSD just fine, &lt;b&gt;had the ServletContext lookup not thrown the &lt;tt&gt;IllegalArgumentException&lt;/tt&gt;&lt;/b&gt;. That uncaught exception however, breaks the lookup entirely.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;b&gt;Solution proposal:&lt;/b&gt;&lt;br/&gt;
I think the least invasive solution would be for &lt;tt&gt;ServletContextResourceResolver&lt;/tt&gt; to additionally catch &lt;tt&gt;IllegalArgumentException&lt;/tt&gt; when calling &lt;tt&gt;ServletContext#getResource&lt;/tt&gt;. It already catches &lt;tt&gt;URISyntaxException&lt;/tt&gt; even though that one isn&apos;t documented by the &lt;tt&gt;ServletContext&lt;/tt&gt; API. Catching an exception that basically says &quot;Hey, this argument isn&apos;t valid&quot; would be semantically similar imho.&lt;br/&gt;
A more drastic approach would be catching all &lt;tt&gt;RuntimeException&lt;/tt&gt; s from the Servlet Container in order to fulfill &lt;tt&gt;ResourceResolver#resolve&lt;/tt&gt;&apos;s contract, namely: &quot;@return an instance of the resource or null if the resource cannot be resolved&quot;.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Reproducing the error:&lt;/b&gt;&lt;br/&gt;
I attached a sample project to this ticket that reproduces the issue. Make sure to follow the instructions in its README.md.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13233212">CXF-8041</key>
            <summary>Error resolving relative XSD Schema on Tomcat</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ffang">Freeman Yue Fang</assignee>
                                    <reporter username="netmikey">Mike M.</reporter>
                        <labels>
                    </labels>
                <created>Tue, 14 May 2019 10:57:44 +0000</created>
                <updated>Wed, 14 Aug 2019 13:29:58 +0000</updated>
                            <resolved>Fri, 24 May 2019 06:15:55 +0000</resolved>
                                    <version>3.3.1</version>
                                    <fixVersion>3.2.10</fixVersion>
                    <fixVersion>3.3.3</fixVersion>
                                    <component>Core</component>
                    <component>Transports</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16845695" author="netmikey" created="Wed, 22 May 2019 09:16:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ffang&quot; class=&quot;user-hover&quot; rel=&quot;ffang&quot;&gt;ffang&lt;/a&gt; thanks for looking into this! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I ran my attached test project against the current CXF 3.3.3 SNAPSHOT and found that the exception creeps through another execution path now, but the effect is the same:&lt;/p&gt;

&lt;p&gt;The &lt;tt&gt;org.apache.cxf.resource.DefaultResourceManager&lt;/tt&gt; asks any registered ResourceResolver for the resource. Besides the &lt;tt&gt;ServletContextResourceResolver&lt;/tt&gt; (that has been patched now), the call also goes through Spring and ends up (again) in the Tomcat Implementation that throws the very same &lt;tt&gt;IllegalArgumentException&lt;/tt&gt; back up the stack (see attached stack trace below).&lt;/p&gt;

&lt;p&gt;As a solution proposal, maybe the initial proposal should be rolled back and instead, the &lt;tt&gt;DefaultResourceManager#findResource&lt;/tt&gt; method should catch either precisely that &lt;tt&gt;IllegalArgumentException&lt;/tt&gt; or any potential &lt;tt&gt;RuntimeException&lt;/tt&gt; thrown by any ResourceResolver while iterating through them around lines 113-122.&lt;/p&gt;

&lt;p&gt;This problem can also be reproduced using my attached example project.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.IllegalArgumentException: The resource path [/../../../../com/example/ws/1/XML-Schema_Example.xsd] has been normalized to [&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] which is not valid
        at org.apache.catalina.webresources.StandardRoot.validate(StandardRoot.java:266) ~[tomcat-embed-core-9.0.16.jar!/:9.0.16]
        at org.apache.catalina.webresources.StandardRoot.getResource(StandardRoot.java:212) ~[tomcat-embed-core-9.0.16.jar!/:9.0.16]
        at org.apache.catalina.webresources.StandardRoot.getResource(StandardRoot.java:206) ~[tomcat-embed-core-9.0.16.jar!/:9.0.16]
        at org.apache.catalina.core.ApplicationContext.getResource(ApplicationContext.java:539) ~[tomcat-embed-core-9.0.16.jar!/:9.0.16]
        at org.apache.catalina.core.ApplicationContextFacade.getResource(ApplicationContextFacade.java:200) ~[tomcat-embed-core-9.0.16.jar!/:9.0.16]
        at org.springframework.web.context.support.ServletContextResource.exists(ServletContextResource.java:103) ~[spring-web-5.1.5.RELEASE.jar!/:5.1.5.RELEASE]
        at org.apache.cxf.bus.spring.BusApplicationContextResourceResolver.resolve(BusApplicationContextResourceResolver.java:87) ~[cxf-core-3.3.3-SNAPSHOT.jar!/:3.3.3.SNAPSHOT]
        at org.apache.cxf.resource.DefaultResourceManager.findResource(DefaultResourceManager.java:117) ~[cxf-core-3.3.3-SNAPSHOT.jar!/:3.3.3.SNAPSHOT]
        at org.apache.cxf.resource.DefaultResourceManager.resolveResource(DefaultResourceManager.java:58) ~[cxf-core-3.3.3-SNAPSHOT.jar!/:3.3.3.SNAPSHOT]
        at org.apache.cxf.ws.addressing.EndpointReferenceUtils$SchemaLSResourceResolver.resolveResource(EndpointReferenceUtils.java:149) ~[cxf-core-3.3.3-SNAPSHOT.jar!/:3.3.3.SNAPSHOT]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16846918" author="ffang" created="Thu, 23 May 2019 17:48:33 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=netmikey&quot; class=&quot;user-hover&quot; rel=&quot;netmikey&quot;&gt;netmikey&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Thanks for the feedback! Please see latest commit here&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/cxf/commit/513f83ecbadcae805d541ee246bf1ae0e80fda53&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/commit/513f83ecbadcae805d541ee246bf1ae0e80fda53&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Let me know if this works for you.&lt;/p&gt;

&lt;p&gt;Cheers&lt;/p&gt;

&lt;p&gt;Freeman&lt;/p&gt;</comment>
                            <comment id="16847266" author="netmikey" created="Fri, 24 May 2019 06:15:55 +0000"  >&lt;p&gt;I can confirm that with the latest 3.3.3-SNAPSHOT, my test now passes: CXF is able to resolve the XSD&apos;s and Schema Validation works.&lt;/p&gt;

&lt;p&gt;Thanks a lot, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ffang&quot; class=&quot;user-hover&quot; rel=&quot;ffang&quot;&gt;ffang&lt;/a&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12968672" name="cxf-tomcat-resource-resolver.zip" size="67065" author="netmikey" created="Tue, 14 May 2019 10:57:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10061"><![CDATA[Novice]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 25 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z02o3c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>