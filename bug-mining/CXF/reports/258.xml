<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:37:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-2158] Mix up of ID and ID reference of security token in signature causes WCF service to throw Cannot resolve KeyInfo for verifying signature</title>
                <link>https://issues.apache.org/jira/browse/CXF-2158</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;Issue&lt;/p&gt;

&lt;p&gt;CXF client causes WCF to throw the error Cannot resolve KeyInfo for verifying signature: KeyInfo &apos;SecurityKeyIdentifier when connecting to a secured WCF service set up following the tutorial &quot;WCF Getting Started Sample Tutorial with Message Security User Name&quot; @ &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/ms752233.aspx&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://msdn.microsoft.com/en-us/library/ms752233.aspx&lt;/a&gt;. (WSDL attached on CXF ticket)&lt;/p&gt;

&lt;p&gt;See analysis below for summary of the issue and indication of resolution.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;edit&amp;#93;&lt;/span&gt; CXF Client Test Case&lt;/p&gt;

&lt;p&gt;$ java -version&lt;br/&gt;
java version &quot;1.6.0_07&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.6.0_07-b06-153)&lt;br/&gt;
Java HotSpot(TM) 64-Bit Server VM (build 1.6.0_07-b06-57, mixed mode)&lt;/p&gt;

&lt;p&gt;MacOS 10.5 and Windows Vista&lt;br/&gt;
CXF Version 2.2&lt;/p&gt;

&lt;p&gt;import static org.junit.Assert.assertEquals;&lt;br/&gt;
import groovyx.net.ws.cxf.SSLHelper;&lt;/p&gt;

&lt;p&gt;import java.util.ArrayList;&lt;br/&gt;
import java.util.HashMap;&lt;br/&gt;
import java.util.List;&lt;br/&gt;
import java.util.Map;&lt;/p&gt;

&lt;p&gt;import javax.security.auth.callback.Callback;&lt;br/&gt;
import javax.security.auth.callback.CallbackHandler;&lt;br/&gt;
import javax.xml.namespace.QName;&lt;/p&gt;

&lt;p&gt;import org.apache.commons.logging.Log;&lt;br/&gt;
import org.apache.commons.logging.LogFactory;&lt;br/&gt;
import org.apache.cxf.Bus;&lt;br/&gt;
import org.apache.cxf.binding.soap.SoapMessage;&lt;br/&gt;
import org.apache.cxf.endpoint.Client;&lt;br/&gt;
import org.apache.cxf.endpoint.Endpoint;&lt;br/&gt;
import org.apache.cxf.endpoint.EndpointImpl;&lt;br/&gt;
import org.apache.cxf.endpoint.dynamic.DynamicClientFactory;&lt;br/&gt;
import org.apache.cxf.interceptor.Fault;&lt;br/&gt;
import org.apache.cxf.interceptor.LoggingInInterceptor;&lt;br/&gt;
import org.apache.cxf.interceptor.LoggingOutInterceptor;&lt;br/&gt;
import org.apache.cxf.message.Exchange;&lt;br/&gt;
import org.apache.cxf.message.Message;&lt;br/&gt;
import org.apache.cxf.message.MessageUtils;&lt;br/&gt;
import org.apache.cxf.phase.Phase;&lt;br/&gt;
import org.apache.cxf.service.model.BindingOperationInfo;&lt;br/&gt;
import org.apache.cxf.service.model.EndpointInfo;&lt;br/&gt;
import org.apache.cxf.ws.policy.AbstractPolicyInterceptor;&lt;br/&gt;
import org.apache.cxf.ws.policy.EffectivePolicy;&lt;br/&gt;
import org.apache.cxf.ws.policy.PolicyEngine;&lt;br/&gt;
import org.apache.cxf.ws.policy.PolicyException;&lt;br/&gt;
import org.apache.cxf.ws.security.policy.model.SignedEncryptedParts;&lt;br/&gt;
import org.apache.cxf.ws.security.wss4j.WSS4JOutInterceptor;&lt;br/&gt;
import org.apache.neethi.AbstractPolicyOperator;&lt;br/&gt;
import org.apache.ws.security.WSConstants;&lt;br/&gt;
import org.apache.ws.security.WSPasswordCallback;&lt;br/&gt;
import org.apache.ws.security.handler.WSHandlerConstants;&lt;br/&gt;
import org.junit.Test;&lt;/p&gt;

&lt;p&gt;public class SSLAWSWCFCalculatorIssueTestCase {&lt;br/&gt;
	protected static Log log = LogFactory.getLog(SSLAWSWCFCalculatorIssueTestCase.class);&lt;/p&gt;

&lt;p&gt;	public static final String WCF_HOST = &quot;host&quot;;&lt;br/&gt;
	private static final String WSDL_URI_REMOTE = &quot;http://&quot; + WCF_HOST&lt;br/&gt;
			+ &quot;/ServiceModelSamples/service.svc?wsdl&quot;;&lt;br/&gt;
	/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Filters for a default WCF_SSLA integration&lt;br/&gt;
	 */&lt;br/&gt;
	public static final Class&amp;lt;?&amp;gt;[] WCF_SSLA = new Class&amp;lt;?&amp;gt;[] 
{ SignedEncryptedParts.class }
&lt;p&gt;;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;	@Test&lt;br/&gt;
	public void testOperationsOfSSLClientWithSoapAuthentication() throws Exception {&lt;br/&gt;
		QName service = new QName(&quot;http://tempuri.org/&quot;, &quot;CalculatorService&quot;);&lt;br/&gt;
		QName port = new QName(&quot;http://tempuri.org/&quot;, &quot;SSLCalculatorA&quot;);&lt;/p&gt;

&lt;p&gt;		Client client = DynamicClientFactory.newInstance().createClient(WSDL_URI_REMOTE, service,&lt;br/&gt;
				SSLAWSWCFCalculatorIssueTestCase.class.getClassLoader(), port);&lt;/p&gt;

&lt;p&gt;		SSLHelper sslHelper = new SSLHelper();&lt;br/&gt;
		sslHelper.initialize();&lt;br/&gt;
		sslHelper.enable(client);&lt;/p&gt;

&lt;p&gt;		Bus bus = ((EndpointImpl) client.getEndpoint()).getBus();&lt;br/&gt;
		/*&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Apply default policy filter in interceptor to filter out the&lt;/li&gt;
	&lt;li&gt;mandatory signing of body parts. Otherwise CXF policy validation&lt;/li&gt;
	&lt;li&gt;fails since the response from WCF is not compliant with this&lt;br/&gt;
		 */&lt;br/&gt;
		bus.getInInterceptors().add(new PolicyFilterOutInterceptor(WCF_SSLA));&lt;br/&gt;
		Map&amp;lt;String, Object&amp;gt; outProps = new HashMap&amp;lt;String, Object&amp;gt;();&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;		outProps.put(WSHandlerConstants.ACTION, WSHandlerConstants.USERNAME_TOKEN);&lt;br/&gt;
		outProps.put(WSHandlerConstants.USER, &quot;bart&lt;br class=&quot;atl-forced-newline&quot; /&gt;myname&quot;);&lt;br/&gt;
		outProps.put(WSHandlerConstants.PASSWORD_TYPE, WSConstants.PW_TEXT);&lt;br/&gt;
		outProps.put(WSHandlerConstants.MUST_UNDERSTAND, &quot;true&quot;);&lt;br/&gt;
		outProps.put(WSHandlerConstants.PW_CALLBACK_REF, new PasswordHandler(&quot;password&quot;));&lt;/p&gt;

&lt;p&gt;		bus.getOutInterceptors().add(new JustOnceWSS4JOutInterceptor(outProps));&lt;/p&gt;

&lt;p&gt;		/*&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Add logging interceptors&lt;br/&gt;
		 */&lt;br/&gt;
		bus.getInInterceptors().add(new LoggingInInterceptor());&lt;br/&gt;
		bus.getOutInterceptors().add(new LoggingOutInterceptor());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;		BindingOperationInfo add = client.getEndpoint().getEndpointInfo().getBinding()&lt;br/&gt;
				.getOperation(new QName(&quot;http://Microsoft.ServiceModel.Samples&quot;, &quot;Add&quot;))&lt;br/&gt;
				.getUnwrappedOperation();&lt;br/&gt;
		/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Now call some operations&lt;br/&gt;
		 */&lt;br/&gt;
		if (log.isDebugEnabled()) 
{
			log.debug(&quot;Invoking method add&quot;);
		}
&lt;p&gt;		Object[] answer = client.invoke(add, new Object[] &lt;/p&gt;
{ &quot;1&quot;, &quot;2&quot; }
&lt;p&gt;);&lt;br/&gt;
		if (log.isDebugEnabled()) &lt;/p&gt;
{
			log.debug(&quot;1 + 2 = &quot; + answer[0]);
		}
&lt;p&gt;		assertEquals(&quot;Add method not correct&quot;, new Double(3.0), answer&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;);&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;		if (log.isDebugEnabled()) &lt;/p&gt;
{
			log.debug(&quot;Invoking method multiply&quot;);
		}
&lt;p&gt;		BindingOperationInfo multiply = client.getEndpoint().getEndpointInfo().getBinding()&lt;br/&gt;
				.getOperation(new QName(&quot;http://Microsoft.ServiceModel.Samples&quot;, &quot;Multiply&quot;))&lt;br/&gt;
				.getUnwrappedOperation();&lt;/p&gt;

&lt;p&gt;		answer = client.invoke(multiply, new Object[] &lt;/p&gt;
{ &quot;3&quot;, &quot;2&quot; }
&lt;p&gt;);&lt;br/&gt;
		assertEquals(&quot;Multiply method not correct&quot;, new Double(6.0), answer);&lt;br/&gt;
		if (log.isDebugEnabled()) &lt;/p&gt;
{
			log.debug(&quot;3 x 2 = &quot; + answer);
		}
&lt;p&gt;	}&lt;/p&gt;

&lt;p&gt;	/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Handler to get the password&lt;br/&gt;
	 */&lt;br/&gt;
	public class PasswordHandler implements CallbackHandler {&lt;br/&gt;
		private static final String DEFAULT_PASSWORD = &quot;password&quot;;&lt;br/&gt;
		String password;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;		public PasswordHandler() &lt;/p&gt;
{
			this.password = DEFAULT_PASSWORD;
		}

&lt;p&gt;		public PasswordHandler(String password) &lt;/p&gt;
{
			this.password = password;
		}

&lt;p&gt;		public void handle(Callback[] callbacks) &lt;/p&gt;
{
			WSPasswordCallback pc = (WSPasswordCallback) callbacks[0];
			pc.setPassword(password);
		}
&lt;p&gt;	}&lt;/p&gt;

&lt;p&gt;	/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;An WSS4J Interceptor that only includes the security header once, without&lt;/li&gt;
	&lt;li&gt;this WCF service throws a security exception when username and password&lt;/li&gt;
	&lt;li&gt;sent along with the SecurityContextToken in the second request&lt;br/&gt;
	 */&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;	public class JustOnceWSS4JOutInterceptor extends WSS4JOutInterceptor {&lt;br/&gt;
		int count = 0;&lt;/p&gt;

&lt;p&gt;		/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;@param outProps&lt;br/&gt;
		 */&lt;br/&gt;
		public JustOnceWSS4JOutInterceptor(Map&amp;lt;String, Object&amp;gt; outProps) 
{
			super(outProps);
		}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;		@Override&lt;br/&gt;
		public void handleMessage(SoapMessage mc) throws Fault {&lt;br/&gt;
			if (count == 0) {&lt;br/&gt;
				if (log.isDebugEnabled()) &lt;/p&gt;
{
					log.debug(&quot;Calling WSS4J interceptor : count = &quot; + count);
				}
&lt;p&gt;				super.handleMessage(mc);&lt;br/&gt;
			} else {&lt;br/&gt;
				if (log.isDebugEnabled()) &lt;/p&gt;
{
					log.debug(&quot;Skipping WSS4J interceptor : count = &quot; + count);
				}
&lt;p&gt;			}&lt;br/&gt;
			count++;&lt;br/&gt;
		}&lt;br/&gt;
	}&lt;/p&gt;

&lt;p&gt;	public class PolicyFilterOutInterceptor extends AbstractPolicyInterceptor {&lt;/p&gt;

&lt;p&gt;		private Class&amp;lt;?&amp;gt;[] filters;&lt;/p&gt;

&lt;p&gt;		public PolicyFilterOutInterceptor(Class&amp;lt;?&amp;gt;[] filters) &lt;/p&gt;
{
			super(Phase.PRE_STREAM);
			this.filters = filters;
		}

&lt;p&gt;		@Override&lt;br/&gt;
		protected void handle(Message message) throws PolicyException {&lt;br/&gt;
			if (log.isDebugEnabled()) &lt;/p&gt;
{
				log.debug(&quot;Filtering policies for &quot; + this.getClass().getName());
			}

&lt;p&gt;			Exchange exchange = message.getExchange();&lt;br/&gt;
			BindingOperationInfo boi = exchange.get(BindingOperationInfo.class);&lt;br/&gt;
			if (null == boi) {&lt;br/&gt;
				if (log.isDebugEnabled()) &lt;/p&gt;
{
					log.debug(&quot;No binding operation info.&quot;);
				}
&lt;p&gt;				return;&lt;br/&gt;
			}&lt;/p&gt;

&lt;p&gt;			Endpoint e = exchange.get(Endpoint.class);&lt;br/&gt;
			if (null == e) {&lt;br/&gt;
				if (log.isDebugEnabled()) &lt;/p&gt;
{
					log.debug(&quot;No endpoint.&quot;);
				}
&lt;p&gt;				return;&lt;br/&gt;
			}&lt;br/&gt;
			EndpointInfo ei = e.getEndpointInfo();&lt;/p&gt;

&lt;p&gt;			Bus bus = exchange.get(Bus.class);&lt;br/&gt;
			PolicyEngine pe = bus.getExtension(PolicyEngine.class);&lt;br/&gt;
			if (null == pe) &lt;/p&gt;
{
				return;
			}

&lt;p&gt;			if (MessageUtils.isPartialResponse(message)) {&lt;br/&gt;
				if (log.isDebugEnabled()) &lt;/p&gt;
{
					log.debug(&quot;Not verifying policies on inbound partial response.&quot;);
				}
&lt;p&gt;				return;&lt;br/&gt;
			}&lt;/p&gt;

&lt;p&gt;			getTransportAssertions(message);&lt;/p&gt;

&lt;p&gt;			EffectivePolicy effectivePolicy = message.get(EffectivePolicy.class);&lt;br/&gt;
			if (effectivePolicy == null) {&lt;br/&gt;
				if (MessageUtils.isRequestor(message)) &lt;/p&gt;
{
					effectivePolicy = pe.getEffectiveClientResponsePolicy(ei, boi);
				}
&lt;p&gt; else &lt;/p&gt;
{
					effectivePolicy = pe.getEffectiveServerRequestPolicy(ei, boi);
				}
&lt;p&gt;			}&lt;/p&gt;

&lt;p&gt;			removePolicies(effectivePolicy.getPolicy(), filters);&lt;br/&gt;
		}&lt;/p&gt;

&lt;p&gt;		public void removePolicy(AbstractPolicyOperator operator, Class&amp;lt;?&amp;gt; clazz) {&lt;br/&gt;
			removePolicies(operator, new Class&amp;lt;?&amp;gt;[] &lt;/p&gt;
{ clazz }
&lt;p&gt;);&lt;br/&gt;
		}&lt;/p&gt;

&lt;p&gt;		@SuppressWarnings(&quot;unchecked&quot;)&lt;br/&gt;
		public void removePolicies(AbstractPolicyOperator operator, Class&amp;lt;?&amp;gt;[] classes) {&lt;br/&gt;
			List&amp;lt;Object&amp;gt; childrenForRemoval = new ArrayList&amp;lt;Object&amp;gt;();&lt;/p&gt;

&lt;p&gt;			for (Object child : operator.getPolicyComponents()) {&lt;br/&gt;
				if (child instanceof AbstractPolicyOperator) &lt;/p&gt;
{
					removePolicies((AbstractPolicyOperator) child, classes);
				}
&lt;p&gt; else {&lt;br/&gt;
					for (int i = 0; i &amp;lt; classes.length; i++) {&lt;br/&gt;
						if (child.getClass() == classes&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;) {&lt;br/&gt;
							childrenForRemoval.add(child);&lt;br/&gt;
							if (log.isDebugEnabled()) &lt;/p&gt;
{
								log.debug(&quot;Removing policy : &quot; + child);
							}
&lt;p&gt;						}&lt;br/&gt;
					}&lt;br/&gt;
				}&lt;br/&gt;
			}&lt;/p&gt;

&lt;p&gt;			/*&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Remove all the children that have been marked for removal&lt;br/&gt;
			 */&lt;br/&gt;
			operator.getPolicyComponents().removeAll(childrenForRemoval);&lt;br/&gt;
		}&lt;br/&gt;
	}&lt;br/&gt;
}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;edit&amp;#93;&lt;/span&gt; WCF Exception&lt;/p&gt;

&lt;p&gt;&amp;lt;Exception&amp;gt;&lt;br/&gt;
&amp;lt;ExceptionType&amp;gt;System.ServiceModel.Security.MessageSecurityException, System.ServiceModel, Version=3.0.0.0, Culture=neutral, &lt;br/&gt;
PublicKeyToken=b77a5c561934e089&amp;lt;/ExceptionType&amp;gt;&lt;br/&gt;
&amp;lt;Message&amp;gt;Cannot resolve KeyInfo for verifying signature: KeyInfo &apos;SecurityKeyIdentifier&lt;br/&gt;
   (&lt;br/&gt;
   IsReadOnly = False,&lt;br/&gt;
   Count = 1,&lt;br/&gt;
   Clause&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; = LocalIdKeyIdentifierClause(LocalId = &apos;urn:uuid:67422cf9-69c5-4e15-802d-4c6d39cdc57d&apos;, Owner = &apos;System.ServiceModel.Security.Tokens.SecurityContextSecurityToken&apos;)&lt;br/&gt;
   )&lt;br/&gt;
&apos;, available tokens &apos;SecurityTokenResolver&lt;br/&gt;
   (&lt;br/&gt;
   TokenCount = 1,&lt;br/&gt;
   TokenEntry&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; = (AllowedReferenceStyle=Internal, Token=System.ServiceModel.Security.Tokens.SecurityContextSecurityToken, &lt;br/&gt;
Parameters=System.ServiceModel.Security.Tokens.SecureConversationSecurityTokenParameters:&lt;br/&gt;
InclusionMode: AlwaysToRecipient&lt;br/&gt;
ReferenceStyle: Internal&lt;br/&gt;
RequireDerivedKeys: False&lt;br/&gt;
RequireCancellation: True&lt;br/&gt;
BootstrapSecurityBindingElement:&lt;br/&gt;
 System.ServiceModel.Channels.TransportSecurityBindingElement:&lt;br/&gt;
 DefaultAlgorithmSuite: Basic256&lt;br/&gt;
 IncludeTimestamp: True&lt;br/&gt;
 KeyEntropyMode: CombinedEntropy&lt;br/&gt;
 MessageSecurityVersion: WSSecurity11WSTrustFebruary2005WSSecureConversationFebruary2005WSSecurityPolicy11BasicSecurityProfile10&lt;br/&gt;
 SecurityHeaderLayout: Strict&lt;br/&gt;
 EndpointSupportingTokenParameters:&lt;br/&gt;
   No endorsing tokens.&lt;br/&gt;
   No signed tokens.&lt;br/&gt;
   SignedEncrypted&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;&lt;br/&gt;
     System.ServiceModel.Security.Tokens.UserNameSecurityTokenParameters:&lt;br/&gt;
     InclusionMode: AlwaysToRecipient&lt;br/&gt;
     ReferenceStyle: Internal&lt;br/&gt;
     RequireDerivedKeys: False&lt;br/&gt;
   No signed endorsing tokens.&lt;br/&gt;
 OptionalEndpointSupportingTokenParameters:&lt;br/&gt;
   No endorsing tokens.&lt;br/&gt;
   No signed tokens.&lt;br/&gt;
   No signed encrypted tokens.&lt;br/&gt;
   No signed endorsing tokens.&lt;br/&gt;
 OperationSupportingTokenParameters: none&lt;br/&gt;
 OptionalOperationSupportingTokenParameters: none)&lt;br/&gt;
   )&lt;br/&gt;
&apos;.&amp;lt;/Message&amp;gt;&lt;br/&gt;
&amp;lt;StackTrace&amp;gt;&lt;br/&gt;
at System.ServiceModel.Security.WSSecurityOneDotZeroReceiveSecurityHeader.ResolveSignatureToken(SecurityKeyIdentifier &lt;br/&gt;
keyIdentifier, SecurityTokenResolver resolver, Boolean isPrimarySignature)&lt;br/&gt;
at System.ServiceModel.Security.WSSecurityOneDotZeroReceiveSecurityHeader.VerifySignature(SignedXml signedXml, Boolean isPrimarySignature, SecurityHeaderTokenResolver resolver, Object signatureTarget, String id)&lt;br/&gt;
at System.ServiceModel.Security.ReceiveSecurityHeader.ProcessSupportingSignature(SignedXml signedXml, Boolean isFromDecryptedSource)&lt;br/&gt;
at System.ServiceModel.Security.ReceiveSecurityHeader.ExecuteFullPass(XmlDictionaryReader reader)&lt;br/&gt;
at System.ServiceModel.Security.ReceiveSecurityHeader.Process(TimeSpan timeout)&lt;br/&gt;
at System.ServiceModel.Security.AcceptorSessionSymmetricTransportSecurityProtocol.VerifyIncomingMessageCore(Message&amp;amp; message, TimeSpan timeout)&lt;br/&gt;
at System.ServiceModel.Security.TransportSecurityProtocol.VerifyIncomingMessage(Message&amp;amp; message, TimeSpan timeout)&lt;br/&gt;
at System.ServiceModel.Security.SecurityProtocol.VerifyIncomingMessage(Message&amp;amp; message, TimeSpan timeout, SecurityProtocolCorrelationState[] correlationStates)&lt;br/&gt;
at System.ServiceModel.Security.SecuritySessionServerSettings.ServerSecuritySessionChannel.ProcessRequestContext(RequestContext requestContext, TimeSpan timeout, SecurityProtocolCorrelationState&amp;amp; correlationState, Boolean&amp;amp; isSecurityProcessingFailure)&lt;br/&gt;
at System.ServiceModel.Security.SecuritySessionServerSettings.ServerSecuritySessionChannel.ReceiveRequestAsyncResult.WaitComplete()&lt;br/&gt;
at System.ServiceModel.Security.SecuritySessionServerSettings.ServerSecuritySessionChannel.ReceiveRequestAsyncResult..ctor(ServerSecuritySessionChannel channel, TimeSpan timeout, AsyncCallback callback, Object state)&lt;br/&gt;
at System.ServiceModel.Security.SecuritySessionServerSettings.ServerSecuritySessionChannel.BeginTryReceiveRequest(TimeSpan timeout, AsyncCallback callback, Object state)&lt;br/&gt;
at System.ServiceModel.Dispatcher.ReplyChannelBinder.BeginTryReceive(TimeSpan timeout, AsyncCallback callback, Object state)&lt;br/&gt;
at System.ServiceModel.Dispatcher.ErrorHandlingReceiver.BeginTryReceive(TimeSpan timeout, AsyncCallback callback, Object state)&lt;br/&gt;
at System.ServiceModel.Dispatcher.ChannelHandler.EnsurePump()&lt;br/&gt;
at System.ServiceModel.Dispatcher.ChannelHandler.OpenAndEnsurePump()&lt;br/&gt;
at System.ServiceModel.Channels.IOThreadScheduler.CriticalHelper.WorkItem.Invoke2()&lt;br/&gt;
at System.Security.SecurityContext.Run(SecurityContext securityContext, ContextCallback callback, Object state)&lt;br/&gt;
at System.ServiceModel.Channels.IOThreadScheduler.CriticalHelper.WorkItem.Invoke()&lt;br/&gt;
at System.ServiceModel.Channels.IOThreadScheduler.CriticalHelper.ProcessCallbacks()&lt;br/&gt;
at System.ServiceModel.Channels.IOThreadScheduler.CriticalHelper.CompletionCallback(Object state)&lt;br/&gt;
at System.ServiceModel.Channels.IOThreadScheduler.CriticalHelper.ScheduledOverlapped.IOCallback(UInt32 errorCode, UInt32 numBytes, NativeOverlapped* nativeOverlapped)&lt;br/&gt;
at System.ServiceModel.Diagnostics.Utility.IOCompletionThunk.UnhandledExceptionFrame(UInt32 error, UInt32 bytesRead, NativeOverlapped* nativeOverlapped)&lt;br/&gt;
at System.Threading._IOCompletionCallback.PerformIOCompletionCallback(UInt32 errorCode, UInt32 numBytes, NativeOverlapped* pOVERLAP)&lt;br/&gt;
&amp;lt;/StackTrace&amp;gt;&lt;br/&gt;
&amp;lt;ExceptionString&amp;gt;System.ServiceModel.Security.MessageSecurityException: Cannot resolve KeyInfo for verifying signature: KeyInfo &apos;SecurityKeyIdentifier&lt;br/&gt;
   (&lt;br/&gt;
   IsReadOnly = False,&lt;br/&gt;
   Count = 1,&lt;br/&gt;
   Clause&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; = LocalIdKeyIdentifierClause(LocalId = &apos;urn:uuid:67422cf9-69c5-4e15-802d-4c6d39cdc57d&apos;, Owner = &apos;System.ServiceModel.Security.Tokens.SecurityContextSecurityToken&apos;)&lt;br/&gt;
   )&lt;br/&gt;
&apos;, available tokens &apos;SecurityTokenResolver&lt;br/&gt;
   (&lt;br/&gt;
   TokenCount = 1,&lt;br/&gt;
   TokenEntry&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; = (AllowedReferenceStyle=Internal, Token=System.ServiceModel.Security.Tokens.SecurityContextSecurityToken, Parameters=System.ServiceModel.Security.Tokens.SecureConversationSecurityTokenParameters:&lt;br/&gt;
InclusionMode: AlwaysToRecipient&lt;br/&gt;
ReferenceStyle: Internal&lt;br/&gt;
RequireDerivedKeys: False&lt;br/&gt;
RequireCancellation: True&lt;br/&gt;
BootstrapSecurityBindingElement:&lt;br/&gt;
 System.ServiceModel.Channels.TransportSecurityBindingElement:&lt;br/&gt;
 DefaultAlgorithmSuite: Basic256&lt;br/&gt;
 IncludeTimestamp: True&lt;br/&gt;
 KeyEntropyMode: CombinedEntropy&lt;br/&gt;
 MessageSecurityVersion: WSSecurity11WSTrustFebruary2005WSSecureConversationFebruary2005WSSecurityPolicy11BasicSecurityProfile10&lt;br/&gt;
 SecurityHeaderLayout: Strict&lt;br/&gt;
 EndpointSupportingTokenParameters:&lt;br/&gt;
   No endorsing tokens.&lt;br/&gt;
   No signed tokens.&lt;br/&gt;
   SignedEncrypted&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;&lt;br/&gt;
     System.ServiceModel.Security.Tokens.UserNameSecurityTokenParameters:&lt;br/&gt;
     InclusionMode: AlwaysToRecipient&lt;br/&gt;
     ReferenceStyle: Internal&lt;br/&gt;
     RequireDerivedKeys: False&lt;br/&gt;
   No signed endorsing tokens.&lt;br/&gt;
 OptionalEndpointSupportingTokenParameters:&lt;br/&gt;
   No endorsing tokens.&lt;br/&gt;
   No signed tokens.&lt;br/&gt;
   No signed encrypted tokens.&lt;br/&gt;
   No signed endorsing tokens.&lt;br/&gt;
 OperationSupportingTokenParameters: none&lt;br/&gt;
 OptionalOperationSupportingTokenParameters: none)&lt;br/&gt;
   )&lt;br/&gt;
&apos;.&amp;lt;/ExceptionString&amp;gt;&lt;br/&gt;
&amp;lt;/Exception&amp;gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;edit&amp;#93;&lt;/span&gt; WCF Client with WCF Server&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;edit&amp;#93;&lt;/span&gt; WCF Client Request 1&lt;/p&gt;

&lt;p&gt;&amp;lt;s:Envelope xmlns:s=&quot;http://www.w3.org/2003/05/soap-envelope&quot; xmlns:a=&quot;http://www.w3.org/2005/08/addressing&quot; &lt;br/&gt;
        xmlns:u=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot;&amp;gt;&lt;br/&gt;
    &amp;lt;s:Header&amp;gt;&lt;br/&gt;
        &amp;lt;a:Action s:mustUnderstand=&quot;1&quot;&amp;gt;&lt;a href=&quot;http://schemas.xmlsoap.org/ws/2005/02/trust/RST/SCT&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://schemas.xmlsoap.org/ws/2005/02/trust/RST/SCT&lt;/a&gt;&amp;lt;/a:Action&amp;gt;&lt;br/&gt;
        &amp;lt;a:MessageID&amp;gt;urn:uuid:8151f398-b043-485e-a443-681fb698d334&amp;lt;/a:MessageID&amp;gt;&lt;br/&gt;
        &amp;lt;a:ReplyTo&amp;gt;&lt;br/&gt;
            &amp;lt;a:Address&amp;gt;&lt;a href=&quot;http://www.w3.org/2005/08/addressing/anonymous&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.w3.org/2005/08/addressing/anonymous&lt;/a&gt;&amp;lt;/a:Address&amp;gt;&lt;br/&gt;
        &amp;lt;/a:ReplyTo&amp;gt;&lt;br/&gt;
        &amp;lt;a:To s:mustUnderstand=&quot;1&quot;&amp;gt;&lt;a href=&quot;https://host/servicemodelsamples/service.svc/SSLA&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://host/servicemodelsamples/service.svc/SSLA&lt;/a&gt;&amp;lt;/a:To&amp;gt;&lt;br/&gt;
        &amp;lt;o:Security s:mustUnderstand=&quot;1&quot; xmlns:o=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd&quot;&amp;gt;&lt;br/&gt;
            &amp;lt;u:Timestamp u:Id=&quot;_0&quot;&amp;gt;&lt;br/&gt;
                &amp;lt;u:Created&amp;gt;2009-04-06T08:25:00.988Z&amp;lt;/u:Created&amp;gt;&lt;br/&gt;
                &amp;lt;u:Expires&amp;gt;2009-04-06T08:30:00.988Z&amp;lt;/u:Expires&amp;gt;&lt;br/&gt;
            &amp;lt;/u:Timestamp&amp;gt;&lt;br/&gt;
            &amp;lt;o:UsernameToken u:Id=&quot;uuid-0403819d-3bc9-4fc8-be6f-0c1b01da7397-1&quot;&amp;gt;&lt;br/&gt;
                &amp;lt;o:Username&amp;gt;&lt;br/&gt;
                    &amp;lt;!-- Removed--&amp;gt;&lt;br/&gt;
                &amp;lt;/o:Username&amp;gt;&lt;br/&gt;
                &amp;lt;o:Password&amp;gt;&lt;br/&gt;
                    &amp;lt;!-- Removed--&amp;gt;&lt;br/&gt;
                &amp;lt;/o:Password&amp;gt;&lt;br/&gt;
            &amp;lt;/o:UsernameToken&amp;gt;&lt;br/&gt;
        &amp;lt;/o:Security&amp;gt;&lt;br/&gt;
    &amp;lt;/s:Header&amp;gt;&lt;br/&gt;
    &amp;lt;s:Body&amp;gt;&lt;br/&gt;
        &amp;lt;t:RequestSecurityToken xmlns:t=&quot;http://schemas.xmlsoap.org/ws/2005/02/trust&quot;&amp;gt;&lt;br/&gt;
            &amp;lt;t:TokenType&amp;gt;&lt;a href=&quot;http://schemas.xmlsoap.org/ws/2005/02/sc/sct&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://schemas.xmlsoap.org/ws/2005/02/sc/sct&lt;/a&gt;&amp;lt;/t:TokenType&amp;gt;&lt;br/&gt;
            &amp;lt;t:RequestType&amp;gt;&lt;a href=&quot;http://schemas.xmlsoap.org/ws/2005/02/trust/Issue&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://schemas.xmlsoap.org/ws/2005/02/trust/Issue&lt;/a&gt;&amp;lt;/t:RequestType&amp;gt;&lt;br/&gt;
            &amp;lt;t:Entropy&amp;gt;&lt;br/&gt;
                &amp;lt;!-- Removed--&amp;gt;&lt;br/&gt;
            &amp;lt;/t:Entropy&amp;gt;&lt;br/&gt;
            &amp;lt;t:KeySize&amp;gt;256&amp;lt;/t:KeySize&amp;gt;&lt;br/&gt;
        &amp;lt;/t:RequestSecurityToken&amp;gt;&lt;br/&gt;
    &amp;lt;/s:Body&amp;gt;&lt;br/&gt;
&amp;lt;/s:Envelope&amp;gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;edit&amp;#93;&lt;/span&gt; WCF Client Response from Server 1&lt;/p&gt;

&lt;p&gt;&amp;lt;s:Envelope xmlns:s=&quot;http://www.w3.org/2003/05/soap-envelope&quot; xmlns:a=&quot;http://www.w3.org/2005/08/addressing&quot; &lt;br/&gt;
xmlns:u=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot;&amp;gt;&lt;br/&gt;
    &amp;lt;s:Header&amp;gt;&lt;br/&gt;
        &amp;lt;a:Action s:mustUnderstand=&quot;1&quot;&amp;gt;&lt;a href=&quot;http://schemas.xmlsoap.org/ws/2005/02/trust/RSTR/SCT&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://schemas.xmlsoap.org/ws/2005/02/trust/RSTR/SCT&lt;/a&gt;&amp;lt;/a:Action&amp;gt;&lt;br/&gt;
        &amp;lt;a:RelatesTo&amp;gt;urn:uuid:4f4996b9-4d71-47d8-91b8-ba75df9b3de6&amp;lt;/a:RelatesTo&amp;gt;&lt;br/&gt;
        &amp;lt;o:Security s:mustUnderstand=&quot;1&quot; xmlns:o=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd&quot;&amp;gt;&lt;br/&gt;
            &amp;lt;u:Timestamp u:Id=&quot;_0&quot;&amp;gt;&lt;br/&gt;
                &amp;lt;u:Created&amp;gt;2009-04-06T08:59:01.713Z&amp;lt;/u:Created&amp;gt;&lt;br/&gt;
                &amp;lt;u:Expires&amp;gt;2009-04-06T09:04:01.713Z&amp;lt;/u:Expires&amp;gt;&lt;br/&gt;
            &amp;lt;/u:Timestamp&amp;gt;&lt;br/&gt;
        &amp;lt;/o:Security&amp;gt;&lt;br/&gt;
    &amp;lt;/s:Header&amp;gt;&lt;br/&gt;
    &amp;lt;s:Body&amp;gt;&lt;br/&gt;
        &amp;lt;t:RequestSecurityTokenResponse xmlns:t=&quot;http://schemas.xmlsoap.org/ws/2005/02/trust&quot;&amp;gt;&lt;br/&gt;
            &amp;lt;t:TokenType&amp;gt;&lt;a href=&quot;http://schemas.xmlsoap.org/ws/2005/02/sc/sct&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://schemas.xmlsoap.org/ws/2005/02/sc/sct&lt;/a&gt;&amp;lt;/t:TokenType&amp;gt;&lt;br/&gt;
            &amp;lt;t:RequestedSecurityToken&amp;gt;&lt;br/&gt;
                &amp;lt;c:SecurityContextToken u:Id=&quot;uuid-75ea67a3-c521-4a6c-8fff-f23ff9e793bc-1&quot; xmlns:c=&quot;http://schemas.xmlsoap.org/ws/2005/02/sc&quot;&amp;gt;&lt;br/&gt;
                    &amp;lt;c:Identifier&amp;gt;urn:uuid:33b535ab-9f44-431a-87c9-0d1cf8c71d8e&amp;lt;/c:Identifier&amp;gt;&lt;br/&gt;
                &amp;lt;/c:SecurityContextToken&amp;gt;&lt;br/&gt;
            &amp;lt;/t:RequestedSecurityToken&amp;gt;&lt;br/&gt;
            &amp;lt;t:RequestedAttachedReference&amp;gt;&lt;br/&gt;
                &amp;lt;o:SecurityTokenReference xmlns:o=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd&quot;&amp;gt;&lt;br/&gt;
                    &amp;lt;o:Reference ValueType=&quot;http://schemas.xmlsoap.org/ws/2005/02/sc/sct&quot; URI=&quot;#uuid-75ea67a3-c521-4a6c-8fff-f23ff9e793bc-1&quot;&amp;gt;&amp;lt;/o:Reference&amp;gt;&lt;br/&gt;
                &amp;lt;/o:SecurityTokenReference&amp;gt;&lt;br/&gt;
            &amp;lt;/t:RequestedAttachedReference&amp;gt;&lt;br/&gt;
            &amp;lt;t:RequestedUnattachedReference&amp;gt;&lt;br/&gt;
                &amp;lt;o:SecurityTokenReference xmlns:o=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd&quot;&amp;gt;&lt;br/&gt;
                    &amp;lt;o:Reference URI=&quot;urn:uuid:33b535ab-9f44-431a-87c9-0d1cf8c71d8e&quot; ValueType=&quot;http://schemas.xmlsoap.org/ws/2005/02/sc/sct&quot;&amp;gt;&amp;lt;/o:Reference&amp;gt;&lt;br/&gt;
                &amp;lt;/o:SecurityTokenReference&amp;gt;&lt;br/&gt;
            &amp;lt;/t:RequestedUnattachedReference&amp;gt;&lt;br/&gt;
            &amp;lt;t:RequestedProofToken&amp;gt;&lt;br/&gt;
                &amp;lt;t:ComputedKey&amp;gt;&lt;a href=&quot;http://schemas.xmlsoap.org/ws/2005/02/trust/CK/PSHA1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://schemas.xmlsoap.org/ws/2005/02/trust/CK/PSHA1&lt;/a&gt;&amp;lt;/t:ComputedKey&amp;gt;&lt;br/&gt;
            &amp;lt;/t:RequestedProofToken&amp;gt;&lt;br/&gt;
            &amp;lt;t:Entropy&amp;gt;&lt;br/&gt;
                &amp;lt;!-- Removed--&amp;gt;&lt;br/&gt;
            &amp;lt;/t:Entropy&amp;gt;&lt;br/&gt;
            &amp;lt;t:Lifetime&amp;gt;&lt;br/&gt;
                &amp;lt;u:Created&amp;gt;2009-04-06T08:59:01.701Z&amp;lt;/u:Created&amp;gt;&lt;br/&gt;
                &amp;lt;u:Expires&amp;gt;2009-04-06T23:59:01.701Z&amp;lt;/u:Expires&amp;gt;&lt;br/&gt;
            &amp;lt;/t:Lifetime&amp;gt;&lt;br/&gt;
            &amp;lt;t:KeySize&amp;gt;256&amp;lt;/t:KeySize&amp;gt;&lt;br/&gt;
        &amp;lt;/t:RequestSecurityTokenResponse&amp;gt;&lt;br/&gt;
    &amp;lt;/s:Body&amp;gt;&lt;br/&gt;
&amp;lt;/s:Envelope&amp;gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;edit&amp;#93;&lt;/span&gt; WCF Client Request 2&lt;/p&gt;

&lt;p&gt;&amp;lt;s:Envelope xmlns:s=&quot;http://www.w3.org/2003/05/soap-envelope&quot; xmlns:a=&quot;http://www.w3.org/2005/08/addressing&quot; &lt;br/&gt;
xmlns:u=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot;&amp;gt;&lt;br/&gt;
    &amp;lt;s:Header&amp;gt;&lt;br/&gt;
        &amp;lt;a:Action s:mustUnderstand=&quot;1&quot;&amp;gt;&lt;a href=&quot;http://Microsoft.ServiceModel.Samples/ICalculator/Add&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://Microsoft.ServiceModel.Samples/ICalculator/Add&lt;/a&gt;&amp;lt;/a:Action&amp;gt;&lt;br/&gt;
        &amp;lt;a:MessageID&amp;gt;urn:uuid:3363fc9e-17e1-4e15-a0dc-ef56d63fa541&amp;lt;/a:MessageID&amp;gt;&lt;br/&gt;
        &amp;lt;a:ReplyTo&amp;gt;&lt;br/&gt;
            &amp;lt;a:Address&amp;gt;&lt;a href=&quot;http://www.w3.org/2005/08/addressing/anonymous&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.w3.org/2005/08/addressing/anonymous&lt;/a&gt;&amp;lt;/a:Address&amp;gt;&lt;br/&gt;
        &amp;lt;/a:ReplyTo&amp;gt;&lt;br/&gt;
        &amp;lt;a:To s:mustUnderstand=&quot;1&quot;&amp;gt;&lt;a href=&quot;https://host/servicemodelsamples/service.svc/SSLA&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://host/servicemodelsamples/service.svc/SSLA&lt;/a&gt;&amp;lt;/a:To&amp;gt;&lt;br/&gt;
        &amp;lt;o:Security s:mustUnderstand=&quot;1&quot; xmlns:o=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd&quot;&amp;gt;&lt;br/&gt;
            &amp;lt;u:Timestamp u:Id=&quot;_0&quot;&amp;gt;&lt;br/&gt;
                &amp;lt;u:Created&amp;gt;2009-04-06T08:59:01.737Z&amp;lt;/u:Created&amp;gt;&lt;br/&gt;
                &amp;lt;u:Expires&amp;gt;2009-04-06T09:04:01.737Z&amp;lt;/u:Expires&amp;gt;&lt;br/&gt;
            &amp;lt;/u:Timestamp&amp;gt;&lt;br/&gt;
            &amp;lt;c:SecurityContextToken u:Id=&quot;uuid-75ea67a3-c521-4a6c-8fff-f23ff9e793bc-1&quot; xmlns:c=&quot;http://schemas.xmlsoap.org/ws/2005/02/sc&quot;&amp;gt;&lt;br/&gt;
                &amp;lt;c:Identifier&amp;gt;urn:uuid:33b535ab-9f44-431a-87c9-0d1cf8c71d8e&amp;lt;/c:Identifier&amp;gt;&lt;br/&gt;
            &amp;lt;/c:SecurityContextToken&amp;gt;&lt;br/&gt;
            &amp;lt;Signature xmlns=&quot;http://www.w3.org/2000/09/xmldsig#&quot;&amp;gt;&lt;br/&gt;
                &amp;lt;SignedInfo&amp;gt;&lt;br/&gt;
                    &amp;lt;CanonicalizationMethod Algorithm=&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;&amp;gt;&amp;lt;/CanonicalizationMethod&amp;gt;&lt;br/&gt;
                    &amp;lt;SignatureMethod Algorithm=&quot;http://www.w3.org/2000/09/xmldsig#hmac-sha1&quot;&amp;gt;&amp;lt;/SignatureMethod&amp;gt;&lt;br/&gt;
                    &amp;lt;Reference URI=&quot;#_0&quot;&amp;gt;&lt;br/&gt;
                        &amp;lt;Transforms&amp;gt;&lt;br/&gt;
                            &amp;lt;Transform Algorithm=&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;&amp;gt;&amp;lt;/Transform&amp;gt;&lt;br/&gt;
                        &amp;lt;/Transforms&amp;gt;&lt;br/&gt;
                        &amp;lt;DigestMethod Algorithm=&quot;http://www.w3.org/2000/09/xmldsig#sha1&quot;&amp;gt;&amp;lt;/DigestMethod&amp;gt;&lt;br/&gt;
                        &amp;lt;DigestValue&amp;gt;2VuDOwhOC2mm4YhQJEAzutsXuiU=&amp;lt;/DigestValue&amp;gt;&lt;br/&gt;
                    &amp;lt;/Reference&amp;gt;&lt;br/&gt;
                &amp;lt;/SignedInfo&amp;gt;&lt;br/&gt;
                &amp;lt;SignatureValue&amp;gt;AZzmujJH/wkgEzq9jopInPW3exQ=&amp;lt;/SignatureValue&amp;gt;&lt;br/&gt;
                &amp;lt;KeyInfo&amp;gt;&lt;br/&gt;
                    &amp;lt;o:SecurityTokenReference&amp;gt;&lt;br/&gt;
                        &amp;lt;o:Reference ValueType=&quot;http://schemas.xmlsoap.org/ws/2005/02/sc/sct&quot; URI=&quot;#uuid-75ea67a3-c521-4a6c-8fff-f23ff9e793bc-1&quot;&amp;gt;&amp;lt;/o:Reference&amp;gt;&lt;br/&gt;
                    &amp;lt;/o:SecurityTokenReference&amp;gt;&lt;br/&gt;
                &amp;lt;/KeyInfo&amp;gt;&lt;br/&gt;
            &amp;lt;/Signature&amp;gt;&lt;br/&gt;
        &amp;lt;/o:Security&amp;gt;&lt;br/&gt;
    &amp;lt;/s:Header&amp;gt;&lt;br/&gt;
    &amp;lt;s:Body&amp;gt;&lt;br/&gt;
        &amp;lt;Add xmlns=&quot;http://Microsoft.ServiceModel.Samples&quot;&amp;gt;&lt;br/&gt;
            &amp;lt;n1&amp;gt;100&amp;lt;/n1&amp;gt;&lt;br/&gt;
            &amp;lt;n2&amp;gt;15.99&amp;lt;/n2&amp;gt;&lt;br/&gt;
        &amp;lt;/Add&amp;gt;&lt;br/&gt;
    &amp;lt;/s:Body&amp;gt;&lt;br/&gt;
&amp;lt;/s:Envelope&amp;gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;edit&amp;#93;&lt;/span&gt; WCF Client Response from Server 2&lt;/p&gt;

&lt;p&gt;&amp;lt;s:Envelope xmlns:s=&quot;http://www.w3.org/2003/05/soap-envelope&quot; xmlns:a=&quot;http://www.w3.org/2005/08/addressing&quot; &lt;br/&gt;
xmlns:u=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot;&amp;gt;&lt;br/&gt;
    &amp;lt;s:Header&amp;gt;&lt;br/&gt;
        &amp;lt;a:Action s:mustUnderstand=&quot;1&quot;&amp;gt;&lt;a href=&quot;http://Microsoft.ServiceModel.Samples/ICalculator/AddResponse&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://Microsoft.ServiceModel.Samples/ICalculator/AddResponse&lt;/a&gt;&amp;lt;/a:Action&amp;gt;&lt;br/&gt;
        &amp;lt;a:RelatesTo&amp;gt;urn:uuid:3363fc9e-17e1-4e15-a0dc-ef56d63fa541&amp;lt;/a:RelatesTo&amp;gt;&lt;br/&gt;
        &amp;lt;o:Security s:mustUnderstand=&quot;1&quot; xmlns:o=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd&quot;&amp;gt;&lt;br/&gt;
            &amp;lt;u:Timestamp u:Id=&quot;_0&quot;&amp;gt;&lt;br/&gt;
                &amp;lt;u:Created&amp;gt;2009-04-06T08:59:01.773Z&amp;lt;/u:Created&amp;gt;&lt;br/&gt;
                &amp;lt;u:Expires&amp;gt;2009-04-06T09:04:01.773Z&amp;lt;/u:Expires&amp;gt;&lt;br/&gt;
            &amp;lt;/u:Timestamp&amp;gt;&lt;br/&gt;
        &amp;lt;/o:Security&amp;gt;&lt;br/&gt;
    &amp;lt;/s:Header&amp;gt;&lt;br/&gt;
    &amp;lt;s:Body&amp;gt;&lt;br/&gt;
        &amp;lt;AddResponse xmlns=&quot;http://Microsoft.ServiceModel.Samples&quot;&amp;gt;&lt;br/&gt;
            &amp;lt;AddResult&amp;gt;115.99&amp;lt;/AddResult&amp;gt;&lt;br/&gt;
        &amp;lt;/AddResponse&amp;gt;&lt;br/&gt;
    &amp;lt;/s:Body&amp;gt;&lt;br/&gt;
&amp;lt;/s:Envelope&amp;gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;edit&amp;#93;&lt;/span&gt; CXF Client with WCF Server&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;edit&amp;#93;&lt;/span&gt; CXF Client Request 1&lt;/p&gt;

&lt;p&gt;&amp;lt;soap:Envelope xmlns:soap=&quot;http://www.w3.org/2003/05/soap-envelope&quot;&amp;gt;&lt;br/&gt;
	&amp;lt;soap:Header&amp;gt;&lt;br/&gt;
		&amp;lt;Action xmlns=&quot;http://www.w3.org/2005/08/addressing&quot;&amp;gt;&lt;br/&gt;
			&lt;a href=&quot;http://schemas.xmlsoap.org/ws/2005/02/trust/RST/SCT&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://schemas.xmlsoap.org/ws/2005/02/trust/RST/SCT&lt;/a&gt;&amp;lt;/Action&amp;gt;&lt;br/&gt;
		&amp;lt;MessageID xmlns=&quot;http://www.w3.org/2005/08/addressing&quot;&amp;gt;&lt;br/&gt;
			urn:uuid:ee3fd188-2a43-4d0e-b202-aac81f803bc5&amp;lt;/MessageID&amp;gt;&lt;br/&gt;
		&amp;lt;To xmlns=&quot;http://www.w3.org/2005/08/addressing&quot;&amp;gt;&lt;br/&gt;
			&lt;a href=&quot;https://host/ServiceModelSamples/service.svc/SSLA&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://host/ServiceModelSamples/service.svc/SSLA&lt;/a&gt;&amp;lt;/To&amp;gt;&lt;br/&gt;
		&amp;lt;ReplyTo xmlns=&quot;http://www.w3.org/2005/08/addressing&quot;&amp;gt;&lt;br/&gt;
			&amp;lt;Address&amp;gt;&lt;a href=&quot;http://www.w3.org/2005/08/addressing/anonymous&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.w3.org/2005/08/addressing/anonymous&lt;/a&gt;&lt;br/&gt;
			&amp;lt;/Address&amp;gt;&lt;br/&gt;
		&amp;lt;/ReplyTo&amp;gt;&lt;br/&gt;
		&amp;lt;wsse:Security&lt;br/&gt;
			xmlns:wsse=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd&quot;&lt;br/&gt;
			soap:mustUnderstand=&quot;true&quot;&amp;gt;&lt;br/&gt;
			&amp;lt;wsu:Timestamp&lt;br/&gt;
				xmlns:wsu=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot;&lt;br/&gt;
				wsu:Id=&quot;Timestamp-1763636894&quot;&amp;gt;&lt;br/&gt;
				&amp;lt;wsu:Created&amp;gt;2009-04-06T10:00:47.466Z&lt;br/&gt;
				&amp;lt;/wsu:Created&amp;gt;&lt;br/&gt;
				&amp;lt;wsu:Expires&amp;gt;2009-04-06T10:05:47.466Z&lt;br/&gt;
				&amp;lt;/wsu:Expires&amp;gt;&lt;br/&gt;
			&amp;lt;/wsu:Timestamp&amp;gt;&lt;br/&gt;
			&amp;lt;wsse:UsernameToken&lt;br/&gt;
				xmlns:wsse=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd&quot;&lt;br/&gt;
				xmlns:wsu=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot;&lt;br/&gt;
				wsu:Id=&quot;UsernameToken-2095036283&quot;&amp;gt;&lt;br/&gt;
				&amp;lt;wsse:Username&amp;gt;bart\myuser&amp;lt;/wsse:Username&amp;gt;&lt;br/&gt;
				&amp;lt;wsse:Password&lt;br/&gt;
					Type=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText&quot;&amp;gt;password&amp;lt;/wsse:Password&amp;gt;&lt;br/&gt;
			&amp;lt;/wsse:UsernameToken&amp;gt;&lt;br/&gt;
		&amp;lt;/wsse:Security&amp;gt;&lt;br/&gt;
	&amp;lt;/soap:Header&amp;gt;&lt;br/&gt;
	&amp;lt;soap:Body&amp;gt;&lt;br/&gt;
		&amp;lt;wst:RequestSecurityToken&lt;br/&gt;
			xmlns:wst=&quot;http://schemas.xmlsoap.org/ws/2005/02/trust&quot;&amp;gt;&lt;br/&gt;
			&amp;lt;wst:RequestType&amp;gt;&lt;a href=&quot;http://schemas.xmlsoap.org/ws/2005/02/trust/Issue&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://schemas.xmlsoap.org/ws/2005/02/trust/Issue&lt;/a&gt;&lt;br/&gt;
			&amp;lt;/wst:RequestType&amp;gt;&lt;br/&gt;
			&amp;lt;wsp:AppliesTo xmlns:wsp=&quot;http://schemas.xmlsoap.org/ws/2004/09/policy&quot;&amp;gt;&lt;br/&gt;
				&amp;lt;wsa:EndpointReference xmlns:wsa=&quot;http://www.w3.org/2005/08/addressing&quot;&amp;gt;&lt;br/&gt;
					&amp;lt;wsa:Address&amp;gt;&lt;br/&gt;
						&lt;a href=&quot;https://host/ServiceModelSamples/service.svc/SSLA&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://host/ServiceModelSamples/service.svc/SSLA&lt;/a&gt;&lt;br/&gt;
					&amp;lt;/wsa:Address&amp;gt;&lt;br/&gt;
				&amp;lt;/wsa:EndpointReference&amp;gt;&lt;br/&gt;
			&amp;lt;/wsp:AppliesTo&amp;gt;&lt;br/&gt;
			&amp;lt;wst:Lifetime&amp;gt;&lt;br/&gt;
				&amp;lt;wsu:Created&lt;br/&gt;
					xmlns:wsu=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot;&amp;gt;2009-04-06T10:00:46.692Z&lt;br/&gt;
				&amp;lt;/wsu:Created&amp;gt;&lt;br/&gt;
				&amp;lt;wsu:Expires&lt;br/&gt;
					xmlns:wsu=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot;&amp;gt;2009-04-06T10:05:46.692Z&lt;br/&gt;
				&amp;lt;/wsu:Expires&amp;gt;&lt;br/&gt;
			&amp;lt;/wst:Lifetime&amp;gt;&lt;br/&gt;
			&amp;lt;wst:TokenType&amp;gt;&lt;a href=&quot;http://schemas.xmlsoap.org/ws/2005/02/sc/sct&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://schemas.xmlsoap.org/ws/2005/02/sc/sct&lt;/a&gt;&lt;br/&gt;
			&amp;lt;/wst:TokenType&amp;gt;&lt;br/&gt;
			&amp;lt;wst:Entropy&amp;gt;&lt;br/&gt;
				&amp;lt;wst:BinarySecret&lt;br/&gt;
					Type=&quot;http://schemas.xmlsoap.org/ws/2005/02/trust/Nonce&quot;&amp;gt;7pPJRu/vrIfSeAzoq48kAd+55khFFbU/sLw0PeYkIKA=&lt;br/&gt;
				&amp;lt;/wst:BinarySecret&amp;gt;&lt;br/&gt;
			&amp;lt;/wst:Entropy&amp;gt;&lt;br/&gt;
			&amp;lt;wst:ComputedKeyAlgorithm&amp;gt;&lt;br/&gt;
				&lt;a href=&quot;http://schemas.xmlsoap.org/ws/2005/02/trust/CK/PSHA1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://schemas.xmlsoap.org/ws/2005/02/trust/CK/PSHA1&lt;/a&gt;&lt;br/&gt;
			&amp;lt;/wst:ComputedKeyAlgorithm&amp;gt;&lt;br/&gt;
		&amp;lt;/wst:RequestSecurityToken&amp;gt;&lt;br/&gt;
	&amp;lt;/soap:Body&amp;gt;&lt;br/&gt;
&amp;lt;/soap:Envelope&amp;gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;edit&amp;#93;&lt;/span&gt; CXF Client Response from Server 1&lt;/p&gt;

&lt;p&gt;&amp;lt;s:Envelope xmlns:s=&quot;http://www.w3.org/2003/05/soap-envelope&quot;&lt;br/&gt;
	xmlns:a=&quot;http://www.w3.org/2005/08/addressing&quot;&lt;br/&gt;
	xmlns:u=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot;&amp;gt;&lt;br/&gt;
	&amp;lt;s:Header&amp;gt;&lt;br/&gt;
		&amp;lt;a:Action s:mustUnderstand=&quot;1&quot;&amp;gt;&lt;br/&gt;
			&lt;a href=&quot;http://schemas.xmlsoap.org/ws/2005/02/trust/RSTR/SCT&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://schemas.xmlsoap.org/ws/2005/02/trust/RSTR/SCT&lt;/a&gt;&amp;lt;/a:Action&amp;gt;&lt;br/&gt;
		&amp;lt;a:RelatesTo&amp;gt;urn:uuid:ee3fd188-2a43-4d0e-b202-aac81f803bc5&lt;br/&gt;
		&amp;lt;/a:RelatesTo&amp;gt;&lt;br/&gt;
		&amp;lt;o:Security s:mustUnderstand=&quot;1&quot;&lt;br/&gt;
			xmlns:o=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd&quot;&amp;gt;&lt;br/&gt;
			&amp;lt;u:Timestamp u:Id=&quot;_0&quot;&amp;gt;&lt;br/&gt;
				&amp;lt;u:Created&amp;gt;2009-04-06T10:00:28.212Z&lt;br/&gt;
				&amp;lt;/u:Created&amp;gt;&lt;br/&gt;
				&amp;lt;u:Expires&amp;gt;2009-04-06T10:05:28.212Z&lt;br/&gt;
				&amp;lt;/u:Expires&amp;gt;&lt;br/&gt;
			&amp;lt;/u:Timestamp&amp;gt;&lt;br/&gt;
		&amp;lt;/o:Security&amp;gt;&lt;br/&gt;
	&amp;lt;/s:Header&amp;gt;&lt;br/&gt;
	&amp;lt;s:Body&amp;gt;&lt;br/&gt;
		&amp;lt;t:RequestSecurityTokenResponse&lt;br/&gt;
			xmlns:t=&quot;http://schemas.xmlsoap.org/ws/2005/02/trust&quot;&amp;gt;&lt;br/&gt;
			&amp;lt;t:TokenType&amp;gt;&lt;a href=&quot;http://schemas.xmlsoap.org/ws/2005/02/sc/sct&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://schemas.xmlsoap.org/ws/2005/02/sc/sct&lt;/a&gt;&lt;br/&gt;
			&amp;lt;/t:TokenType&amp;gt;&lt;br/&gt;
			&amp;lt;t:RequestedSecurityToken&amp;gt;&lt;br/&gt;
				&amp;lt;c:SecurityContextToken&lt;br/&gt;
					u:Id=&quot;uuid-e19e1759-7ef7-452b-9055-17ed4b15114c-3&quot; xmlns:c=&quot;http://schemas.xmlsoap.org/ws/2005/02/sc&quot;&amp;gt;&lt;br/&gt;
					&amp;lt;c:Identifier&amp;gt;urn:uuid:cc05aea2-c53b-417e-9527-5d81102d6b20&lt;br/&gt;
					&amp;lt;/c:Identifier&amp;gt;&lt;br/&gt;
				&amp;lt;/c:SecurityContextToken&amp;gt;&lt;br/&gt;
			&amp;lt;/t:RequestedSecurityToken&amp;gt;&lt;br/&gt;
			&amp;lt;wsp:AppliesTo xmlns:wsp=&quot;http://schemas.xmlsoap.org/ws/2004/09/policy&quot;&amp;gt;&lt;br/&gt;
				&amp;lt;EndpointReference xmlns=&quot;http://www.w3.org/2005/08/addressing&quot;&amp;gt;&lt;br/&gt;
					&amp;lt;Address&amp;gt;&lt;br/&gt;
						&lt;a href=&quot;https://host/ServiceModelSamples/service.svc/SSLA&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://host/ServiceModelSamples/service.svc/SSLA&lt;/a&gt;&lt;br/&gt;
					&amp;lt;/Address&amp;gt;&lt;br/&gt;
				&amp;lt;/EndpointReference&amp;gt;&lt;br/&gt;
			&amp;lt;/wsp:AppliesTo&amp;gt;&lt;br/&gt;
			&amp;lt;t:RequestedAttachedReference&amp;gt;&lt;br/&gt;
				&amp;lt;o:SecurityTokenReference&lt;br/&gt;
					xmlns:o=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd&quot;&amp;gt;&lt;br/&gt;
					&amp;lt;o:Reference ValueType=&quot;http://schemas.xmlsoap.org/ws/2005/02/sc/sct&quot;&lt;br/&gt;
						URI=&quot;#uuid-e19e1759-7ef7-452b-9055-17ed4b15114c-3&quot;&amp;gt;&amp;lt;/o:Reference&amp;gt;&lt;br/&gt;
				&amp;lt;/o:SecurityTokenReference&amp;gt;&lt;br/&gt;
			&amp;lt;/t:RequestedAttachedReference&amp;gt;&lt;br/&gt;
			&amp;lt;t:RequestedUnattachedReference&amp;gt;&lt;br/&gt;
				&amp;lt;o:SecurityTokenReference&lt;br/&gt;
					xmlns:o=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd&quot;&amp;gt;&lt;br/&gt;
					&amp;lt;o:Reference URI=&quot;urn:uuid:cc05aea2-c53b-417e-9527-5d81102d6b20&quot;&lt;br/&gt;
						ValueType=&quot;http://schemas.xmlsoap.org/ws/2005/02/sc/sct&quot;&amp;gt;&amp;lt;/o:Reference&amp;gt;&lt;br/&gt;
				&amp;lt;/o:SecurityTokenReference&amp;gt;&lt;br/&gt;
			&amp;lt;/t:RequestedUnattachedReference&amp;gt;&lt;br/&gt;
			&amp;lt;t:RequestedProofToken&amp;gt;&lt;br/&gt;
				&amp;lt;t:ComputedKey&amp;gt;&lt;a href=&quot;http://schemas.xmlsoap.org/ws/2005/02/trust/CK/PSHA1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://schemas.xmlsoap.org/ws/2005/02/trust/CK/PSHA1&lt;/a&gt;&lt;br/&gt;
				&amp;lt;/t:ComputedKey&amp;gt;&lt;br/&gt;
			&amp;lt;/t:RequestedProofToken&amp;gt;&lt;br/&gt;
			&amp;lt;t:Entropy&amp;gt;&lt;br/&gt;
				&amp;lt;t:BinarySecret u:Id=&quot;uuid-e19e1759-7ef7-452b-9055-17ed4b15114c-4&quot;&lt;br/&gt;
					Type=&quot;http://schemas.xmlsoap.org/ws/2005/02/trust/Nonce&quot;&amp;gt;f6m4wEJy9gPMttOxzM+7yf1i5biWxbNaBfbx1sWvVPw=&lt;br/&gt;
				&amp;lt;/t:BinarySecret&amp;gt;&lt;br/&gt;
			&amp;lt;/t:Entropy&amp;gt;&lt;br/&gt;
			&amp;lt;t:Lifetime&amp;gt;&lt;br/&gt;
				&amp;lt;u:Created&amp;gt;2009-04-06T10:00:28.208Z&lt;br/&gt;
				&amp;lt;/u:Created&amp;gt;&lt;br/&gt;
				&amp;lt;u:Expires&amp;gt;2009-04-07T01:00:28.208Z&lt;br/&gt;
				&amp;lt;/u:Expires&amp;gt;&lt;br/&gt;
			&amp;lt;/t:Lifetime&amp;gt;&lt;br/&gt;
			&amp;lt;t:KeySize&amp;gt;256&amp;lt;/t:KeySize&amp;gt;&lt;br/&gt;
		&amp;lt;/t:RequestSecurityTokenResponse&amp;gt;&lt;br/&gt;
	&amp;lt;/s:Body&amp;gt;&lt;br/&gt;
&amp;lt;/s:Envelope&amp;gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;edit&amp;#93;&lt;/span&gt; CXF Client Request 2&lt;/p&gt;

&lt;p&gt;&amp;lt;soap:Envelope xmlns:soap=&quot;http://www.w3.org/2003/05/soap-envelope&quot;&amp;gt;&lt;br/&gt;
	&amp;lt;soap:Header&amp;gt;&lt;br/&gt;
		&amp;lt;Action xmlns=&quot;http://www.w3.org/2005/08/addressing&quot;&amp;gt;&lt;br/&gt;
			&lt;a href=&quot;http://Microsoft.ServiceModel.Samples/ICalculator/Add&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://Microsoft.ServiceModel.Samples/ICalculator/Add&lt;/a&gt;&amp;lt;/Action&amp;gt;&lt;br/&gt;
		&amp;lt;MessageID xmlns=&quot;http://www.w3.org/2005/08/addressing&quot;&amp;gt;&lt;br/&gt;
			urn:uuid:b879526c-68c1-4713-8912-6ee23264715f&amp;lt;/MessageID&amp;gt;&lt;br/&gt;
		&amp;lt;To xmlns=&quot;http://www.w3.org/2005/08/addressing&quot;&amp;gt;&lt;br/&gt;
			&lt;a href=&quot;https://host/ServiceModelSamples/service.svc/SSLA&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://host/ServiceModelSamples/service.svc/SSLA&lt;/a&gt;&amp;lt;/To&amp;gt;&lt;br/&gt;
		&amp;lt;ReplyTo xmlns=&quot;http://www.w3.org/2005/08/addressing&quot;&amp;gt;&lt;br/&gt;
			&amp;lt;Address&amp;gt;&lt;a href=&quot;http://www.w3.org/2005/08/addressing/anonymous&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.w3.org/2005/08/addressing/anonymous&lt;/a&gt;&lt;br/&gt;
			&amp;lt;/Address&amp;gt;&lt;br/&gt;
		&amp;lt;/ReplyTo&amp;gt;&lt;br/&gt;
		&amp;lt;wsse:Security&lt;br/&gt;
			xmlns:wsse=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd&quot;&lt;br/&gt;
			soap:mustUnderstand=&quot;true&quot;&amp;gt;&lt;br/&gt;
			&amp;lt;wsu:Timestamp&lt;br/&gt;
				xmlns:wsu=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot;&lt;br/&gt;
				wsu:Id=&quot;Timestamp-937741416&quot;&amp;gt;&lt;br/&gt;
				&amp;lt;wsu:Created&amp;gt;2009-04-06T10:00:48.903Z&lt;br/&gt;
				&amp;lt;/wsu:Created&amp;gt;&lt;br/&gt;
				&amp;lt;wsu:Expires&amp;gt;2009-04-06T10:05:48.903Z&lt;br/&gt;
				&amp;lt;/wsu:Expires&amp;gt;&lt;br/&gt;
			&amp;lt;/wsu:Timestamp&amp;gt;&lt;br/&gt;
			&amp;lt;c:SecurityContextToken xmlns:c=&quot;http://schemas.xmlsoap.org/ws/2005/02/sc&quot;&lt;br/&gt;
				xmlns:u=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot;&lt;br/&gt;
				u:Id=&quot;uuid-e19e1759-7ef7-452b-9055-17ed4b15114c-3&quot;&amp;gt;&lt;br/&gt;
				&amp;lt;c:Identifier&amp;gt;urn:uuid:cc05aea2-c53b-417e-9527-5d81102d6b20&lt;br/&gt;
				&amp;lt;/c:Identifier&amp;gt;&lt;br/&gt;
			&amp;lt;/c:SecurityContextToken&amp;gt;&lt;br/&gt;
			&amp;lt;ds:Signature xmlns:ds=&quot;http://www.w3.org/2000/09/xmldsig#&quot;&lt;br/&gt;
				Id=&quot;Signature-1670444352&quot;&amp;gt;&lt;br/&gt;
				&amp;lt;ds:SignedInfo&amp;gt;&lt;br/&gt;
					&amp;lt;ds:CanonicalizationMethod&lt;br/&gt;
						Algorithm=&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot; /&amp;gt;&lt;br/&gt;
					&amp;lt;ds:SignatureMethod Algorithm=&quot;http://www.w3.org/2000/09/xmldsig#hmac-sha1&quot; /&amp;gt;&lt;br/&gt;
					&amp;lt;ds:Reference URI=&quot;#Timestamp-937741416&quot;&amp;gt;&lt;br/&gt;
						&amp;lt;ds:Transforms&amp;gt;&lt;br/&gt;
							&amp;lt;ds:Transform Algorithm=&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot; /&amp;gt;&lt;br/&gt;
						&amp;lt;/ds:Transforms&amp;gt;&lt;br/&gt;
						&amp;lt;ds:DigestMethod Algorithm=&quot;http://www.w3.org/2000/09/xmldsig#sha1&quot; /&amp;gt;&lt;br/&gt;
						&amp;lt;ds:DigestValue&amp;gt;/gRfeAVaxWCey/0KWfXh4VDIdGA=&lt;br/&gt;
						&amp;lt;/ds:DigestValue&amp;gt;&lt;br/&gt;
					&amp;lt;/ds:Reference&amp;gt;&lt;br/&gt;
				&amp;lt;/ds:SignedInfo&amp;gt;&lt;br/&gt;
				&amp;lt;ds:SignatureValue&amp;gt;rhEDDQNJHxAKgsBz5ZVPma1TkeY=&lt;br/&gt;
				&amp;lt;/ds:SignatureValue&amp;gt;&lt;br/&gt;
				&amp;lt;ds:KeyInfo Id=&quot;KeyId-451036744&quot;&amp;gt;&lt;br/&gt;
					&amp;lt;wsse:SecurityTokenReference&lt;br/&gt;
						xmlns:wsse=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd&quot;&lt;br/&gt;
						xmlns:wsu=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd&quot;&lt;br/&gt;
						wsu:Id=&quot;STRId-187592160&quot;&amp;gt;&lt;br/&gt;
						&amp;lt;wsse:Reference&lt;br/&gt;
							xmlns:wsse=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd&quot;&lt;br/&gt;
							URI=&quot;#urn:uuid:cc05aea2-c53b-417e-9527-5d81102d6b20&quot; ValueType=&quot;http://schemas.xmlsoap.org/ws/2005/02/sc/sct&quot; /&amp;gt;&lt;br/&gt;
					&amp;lt;/wsse:SecurityTokenReference&amp;gt;&lt;br/&gt;
				&amp;lt;/ds:KeyInfo&amp;gt;&lt;br/&gt;
			&amp;lt;/ds:Signature&amp;gt;&lt;br/&gt;
		&amp;lt;/wsse:Security&amp;gt;&lt;br/&gt;
	&amp;lt;/soap:Header&amp;gt;&lt;br/&gt;
	&amp;lt;soap:Body&amp;gt;&lt;br/&gt;
		&amp;lt;ns1:Add xmlns:ns1=&quot;http://Microsoft.ServiceModel.Samples&quot;&amp;gt;&lt;br/&gt;
			&amp;lt;ns1:n1 xmlns:ns2=&quot;http://schemas.microsoft.com/2003/10/Serialization/&quot;&lt;br/&gt;
				xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&lt;br/&gt;
				xsi:type=&quot;xs:string&quot;&amp;gt;1&amp;lt;/ns1:n1&amp;gt;&lt;br/&gt;
			&amp;lt;ns1:n2 xmlns:ns2=&quot;http://schemas.microsoft.com/2003/10/Serialization/&quot;&lt;br/&gt;
				xmlns:xs=&quot;http://www.w3.org/2001/XMLSchema&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&lt;br/&gt;
				xsi:type=&quot;xs:string&quot;&amp;gt;2&amp;lt;/ns1:n2&amp;gt;&lt;br/&gt;
		&amp;lt;/ns1:Add&amp;gt;&lt;br/&gt;
	&amp;lt;/soap:Body&amp;gt;&lt;br/&gt;
&amp;lt;/soap:Envelope&amp;gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;edit&amp;#93;&lt;/span&gt; CXF Client Response from Server 2&lt;/p&gt;

&lt;p&gt;&amp;lt;s:Envelope xmlns:s=&quot;http://www.w3.org/2003/05/soap-envelope&quot;&lt;br/&gt;
	xmlns:a=&quot;http://www.w3.org/2005/08/addressing&quot;&amp;gt;&lt;br/&gt;
	&amp;lt;s:Header&amp;gt;&lt;br/&gt;
		&amp;lt;a:Action s:mustUnderstand=&quot;1&quot;&amp;gt;&lt;br/&gt;
			&lt;a href=&quot;http://www.w3.org/2005/08/addressing/soap/fault&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.w3.org/2005/08/addressing/soap/fault&lt;/a&gt;&amp;lt;/a:Action&amp;gt;&lt;br/&gt;
		&amp;lt;a:RelatesTo&amp;gt;urn:uuid:c20c8ac5-3e6d-4189-8db8-97dda22f7cdc&lt;br/&gt;
		&amp;lt;/a:RelatesTo&amp;gt;&lt;br/&gt;
	&amp;lt;/s:Header&amp;gt;&lt;br/&gt;
	&amp;lt;s:Body&amp;gt;&lt;br/&gt;
		&amp;lt;s:Fault&amp;gt;&lt;br/&gt;
			&amp;lt;s:Code&amp;gt;&lt;br/&gt;
				&amp;lt;s:Value&amp;gt;s:Sender&amp;lt;/s:Value&amp;gt;&lt;br/&gt;
				&amp;lt;s:Subcode&amp;gt;&lt;br/&gt;
					&amp;lt;s:Value&lt;br/&gt;
						xmlns:a=&quot;http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd&quot;&amp;gt;a:InvalidSecurity&amp;lt;/s:Value&amp;gt;&lt;br/&gt;
				&amp;lt;/s:Subcode&amp;gt;&lt;br/&gt;
			&amp;lt;/s:Code&amp;gt;&lt;br/&gt;
			&amp;lt;s:Reason&amp;gt;&lt;br/&gt;
				&amp;lt;s:Text xml:lang=&quot;en-GB&quot;&amp;gt;An error occurred when verifying security&lt;br/&gt;
					for the message.&amp;lt;/s:Text&amp;gt;&lt;br/&gt;
			&amp;lt;/s:Reason&amp;gt;&lt;br/&gt;
		&amp;lt;/s:Fault&amp;gt;&lt;br/&gt;
	&amp;lt;/s:Body&amp;gt;&lt;br/&gt;
&amp;lt;/s:Envelope&amp;gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;edit&amp;#93;&lt;/span&gt; Analysis&lt;/p&gt;

&lt;p&gt;CXF client sends the following on request 2 with the URI attribute of the Reference element equal to the element content of the Identifier element.&lt;/p&gt;

&lt;p&gt;&amp;lt;c:SecurityContextToken u:Id=&quot;uuid-e19e1759-7ef7-452b-9055-17ed4b15114c-3&quot;&amp;gt;&lt;br/&gt;
	&amp;lt;c:Identifier&amp;gt;urn:uuid:cc05aea2-c53b-417e-9527-5d81102d6b20&amp;lt;/c:Identifier&amp;gt;&lt;br/&gt;
&amp;lt;/c:SecurityContextToken&amp;gt;&lt;br/&gt;
...&lt;br/&gt;
&amp;lt;ds:KeyInfo Id=&quot;KeyId-451036744&quot;&amp;gt;&lt;br/&gt;
	&amp;lt;wsse:SecurityTokenReference&amp;gt;&lt;br/&gt;
		&amp;lt;wsse:Reference&lt;br/&gt;
			URI=&quot;#urn:uuid:cc05aea2-c53b-417e-9527-5d81102d6b20&quot; &lt;br/&gt;
			ValueType=&quot;http://schemas.xmlsoap.org/ws/2005/02/sc/sct&quot; /&amp;gt;&lt;br/&gt;
	&amp;lt;/wsse:SecurityTokenReference&amp;gt;&lt;br/&gt;
&amp;lt;/ds:KeyInfo&amp;gt;&lt;/p&gt;

&lt;p&gt;however, the WCF client sends the following for its second request with the URI element of the Reference element equal to the Id attribute of the SecurityContextToken element&lt;/p&gt;

&lt;p&gt;&amp;lt;c:SecurityContextToken u:Id=&quot;uuid-75ea67a3-c521-4a6c-8fff-f23ff9e793bc-1&quot; xmlns:c=&quot;http://schemas.xmlsoap.org/ws/2005/02/sc&quot;&amp;gt;&lt;br/&gt;
    &amp;lt;c:Identifier&amp;gt;urn:uuid:33b535ab-9f44-431a-87c9-0d1cf8c71d8e&amp;lt;/c:Identifier&amp;gt;&lt;br/&gt;
&amp;lt;/c:SecurityContextToken&amp;gt;&lt;br/&gt;
...&lt;br/&gt;
&amp;lt;KeyInfo&amp;gt;&lt;br/&gt;
    &amp;lt;o:SecurityTokenReference&amp;gt;&lt;br/&gt;
        &amp;lt;o:Reference &lt;br/&gt;
                ValueType=&quot;http://schemas.xmlsoap.org/ws/2005/02/sc/sct&quot; &lt;br/&gt;
                URI=&quot;#uuid-75ea67a3-c521-4a6c-8fff-f23ff9e793bc-1&quot;&amp;gt;&amp;lt;/o:Reference&amp;gt;&lt;br/&gt;
    &amp;lt;/o:SecurityTokenReference&amp;gt;&lt;br/&gt;
&amp;lt;/KeyInfo&amp;gt;&lt;/p&gt;

&lt;p&gt;If the following change is made in the org.apache.cxf.ws.security.wss4j.policyhandler.TransportBindingHandler:&lt;/p&gt;

&lt;p&gt;CXF trunk 2.2 version&lt;/p&gt;

&lt;p&gt;sig.setCustomTokenId(secTok.getId());&lt;/p&gt;

&lt;p&gt;changed to&lt;/p&gt;

&lt;p&gt;Node firstChild = securityToken.getAttachedReference().getFirstChild();&lt;br/&gt;
Attr referenceUriAttribute = (Attr) firstChild.getAttributes().getNamedItem(&quot;URI&quot;);&lt;br/&gt;
String referenceUri = referenceUriAttribute.getValue().substring(1);&lt;br/&gt;
sig.setCustomTokenId(referenceUri)&lt;/p&gt;

&lt;p&gt;then the CXF client communicates with the WCF server successfully. It is not expected that this is the correct place for the fix, since there are other places in the CXF source which set the custom token id on the signature. It is more likely that a correction is required earlier in the logic such that security token allows the id reference (i.e. the Reference URI) to be set correctly and made available for configuring in the signature. &lt;/p&gt;</description>
                <environment>&lt;p&gt;Java(TM) SE Runtime Environment (build 1.6.0_07-b06-153) - MacOS 10.5 and Windows Vista&lt;/p&gt;</environment>
        <key id="12422133">CXF-2158</key>
            <summary>Mix up of ID and ID reference of security token in signature causes WCF service to throw Cannot resolve KeyInfo for verifying signature</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dkulp">Daniel Kulp</assignee>
                                    <reporter username="ian.homer">ian homer</reporter>
                        <labels>
                    </labels>
                <created>Mon, 6 Apr 2009 16:02:43 +0000</created>
                <updated>Fri, 24 Apr 2009 21:17:12 +0000</updated>
                            <resolved>Wed, 8 Apr 2009 18:15:07 +0000</resolved>
                                    <version>2.2</version>
                                    <fixVersion>2.2.1</fixVersion>
                                    <component>WS-* Components</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12696148" author="ian.homer" created="Mon, 6 Apr 2009 16:05:16 +0000"  >&lt;p&gt;WSDL for WCF service&lt;/p&gt;</comment>
                            <comment id="12696161" author="ian.homer" created="Mon, 6 Apr 2009 16:29:10 +0000"  >&lt;p&gt;Raised question on CXF user group on how best to send the username token once @ &lt;a href=&quot;http://www.nabble.com/WCF-Service-not-accepting-UsernameToken-in-security-header-along-with-SecurityContextToken-sent-by-CXF-client-td22912335.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.nabble.com/WCF-Service-not-accepting-UsernameToken-in-security-header-along-with-SecurityContextToken-sent-by-CXF-client-td22912335.html&lt;/a&gt; - this is to discuss the work around applied in the test case with&lt;/p&gt;

&lt;p&gt;  bus.getOutInterceptors().add(new JustOnceWSS4JOutInterceptor(outProps)); &lt;/p&gt;</comment>
                            <comment id="12696169" author="ian.homer" created="Mon, 6 Apr 2009 16:42:46 +0000"  >&lt;p&gt;Raised question on CXF user group on the failure with service response not having the body signed @ &lt;a href=&quot;http://www.nabble.com/SignedParts-policy-alternatives-can-not-be-satisfied-in-response-from-WCF-server-to-CXF-client-td22912577.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.nabble.com/SignedParts-policy-alternatives-can-not-be-satisfied-in-response-from-WCF-server-to-CXF-client-td22912577.html&lt;/a&gt; - this is discuss the work around in the test case above with ...&lt;/p&gt;

&lt;p&gt;  bus.getInInterceptors().add(new PolicyFilterOutInterceptor(WCF_SSLA)); &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12404741" name="CalculatorService1339.wsdl" size="25602" author="ian.homer" created="Mon, 6 Apr 2009 16:05:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>113607</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 34 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i13zmn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>231402</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>