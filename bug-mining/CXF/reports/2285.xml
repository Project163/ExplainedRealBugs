<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:10:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-5835] Two issues in org.apache.cxf.jaxrs.provider.DataSourceProvider</title>
                <link>https://issues.apache.org/jira/browse/CXF-5835</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;Issue 1: ClassCastException if you post a FileDataSource in your resource class: &lt;br/&gt;
@Path(&quot;providers/standard/datasource&quot;)&lt;br/&gt;
public class DataSourceResource {&lt;br/&gt;
    @POST&lt;br/&gt;
    public DataSource postDataSource(FileDataSource  ds) &lt;/p&gt;
{
        return ds;
    }
&lt;p&gt;   }&lt;br/&gt;
The error stack is like below:&lt;br/&gt;
Caused by: java.lang.ClassCastException: Cannot cast class org.apache.cxf.jaxrs.ext.multipart.InputStreamDataSource to class javax.activation.FileDataSource&lt;br/&gt;
	at java.lang.Class.cast(Class.java:1730)&lt;br/&gt;
	at org.apache.cxf.jaxrs.provider.DataSourceProvider.readFrom(DataSourceProvider.java:55)&lt;br/&gt;
	at org.apache.cxf.jaxrs.utils.JAXRSUtils.readFromMessageBodyReader(JAXRSUtils.java:1311)&lt;br/&gt;
	at org.apache.cxf.jaxrs.utils.JAXRSUtils.readFromMessageBody(JAXRSUtils.java:1262)&lt;br/&gt;
	at org.apache.cxf.jaxrs.utils.JAXRSUtils.processParameter(JAXRSUtils.java:801)&lt;br/&gt;
	at org.apache.cxf.jaxrs.utils.JAXRSUtils.processParameters(JAXRSUtils.java:764)&lt;br/&gt;
	at org.apache.cxf.jaxrs.interceptor.JAXRSInInterceptor.processRequest(JAXRSInInterceptor.java:212)&lt;br/&gt;
	at org.apache.cxf.jaxrs.interceptor.JAXRSInInterceptor.handleMessage(JAXRSInInterceptor.java:76)&lt;br/&gt;
	at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:307)&lt;/p&gt;

&lt;p&gt;Since there are several implementation class for DataSource, we can not use the logic below:&lt;br/&gt;
    public T readFrom(Class&amp;lt;T&amp;gt; cls, Type genericType, Annotation[] annotations, &lt;br/&gt;
                               MediaType type, &lt;br/&gt;
                               MultivaluedMap&amp;lt;String, String&amp;gt; headers, InputStream is)&lt;br/&gt;
        throws IOException &lt;/p&gt;
{
        DataSource ds = new InputStreamDataSource(is, type.toString());
        return cls.cast(DataSource.class.isAssignableFrom(cls) ? ds : new DataHandler(ds));
    }

&lt;p&gt;Issue 2: Return the original InputStream directly in InputStreamDataSource.getInputStream().&lt;/p&gt;

&lt;p&gt;I have checked Jersy and Wink&apos;s implementation for this part, both of them will replace the incomming InputStream with ByteArrayInputStream. Using this way, the inputStream.available() will be correctly be called.&lt;br/&gt;
My resource  can run successfully both in Jersey and Wink. But failed with CXF. The resource class snippet is like below:&lt;/p&gt;

&lt;p&gt;@POST&lt;br/&gt;
    public Response post(DataSource dataSource) {&lt;br/&gt;
        Response resp = null;&lt;br/&gt;
        try &lt;/p&gt;
{
            InputStream inputStream = dataSource.getInputStream();
            byte[] inputBytes = new byte[inputStream.available()];
            ..........
    }

&lt;p&gt;From my understanding, we need to this conversion for InputStream to convert it to a standard java.io.ByteArrayInputStream. Because only in such way, we can return to users a standard InputStream. For example, the incomming InputStream might be a specific type to J2ee container.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12724611">CXF-5835</key>
            <summary>Two issues in org.apache.cxf.jaxrs.provider.DataSourceProvider</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sergey_beryozkin">Sergey Beryozkin</assignee>
                                    <reporter username="irisding">Iris Ding</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Jul 2014 01:00:51 +0000</created>
                <updated>Mon, 16 Feb 2015 16:09:28 +0000</updated>
                            <resolved>Tue, 1 Jul 2014 12:45:21 +0000</resolved>
                                    <version>3.0</version>
                                    <fixVersion>2.7.12</fixVersion>
                    <fixVersion>3.0.1</fixVersion>
                                    <component>JAX-RS</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14048820" author="sergey_beryozkin" created="Tue, 1 Jul 2014 12:44:36 +0000"  >&lt;p&gt;I&apos;ve added an explicit support for FileDataSource. It does not really make sense to have in the method signature because it implies a temporary file will need to be created, and you will see a warning in the logs coming from BinaryDataProvider. I&apos;m only adding this code because as it happens TCK enforces MBR support for File and indeed because having class cast exception is not cool.&lt;/p&gt;

&lt;p&gt;I agree about an InputStream related issue being not an issue. It is strange other implementations copy it in memory, it can be a massive stream after all.&lt;/p&gt;

&lt;p&gt;Cheers, Sergey&lt;/p&gt;</comment>
                            <comment id="14049516" author="irisding" created="Wed, 2 Jul 2014 01:40:26 +0000"  >&lt;p&gt;Thanks Sergey for your fix for this issue.&lt;/p&gt;

&lt;p&gt;Your fix will support &quot;FileDataSource&quot; as a parameter type.  But as said by Daniel: &quot;Per spec, we need to just support &#8220;DataSource&#8221; as a parameter type.  Not any of the subclasses or concrete implementations.&quot;&lt;/p&gt;

&lt;p&gt;So I do not think we should support this case.  You mentioned TCK enforces MBR support for File. But if we support FileDataSource, it is against spec, so it should not pass TCK as well, right?&lt;/p&gt;

&lt;p&gt;Iris&lt;/p&gt;</comment>
                            <comment id="14052077" author="irisding" created="Fri, 4 Jul 2014 01:30:48 +0000"  >&lt;p&gt;Sergey,&lt;/p&gt;

&lt;p&gt;We also have ClassCastException in  org.apache.cxf.jaxrs.provider.BinaryDataProvider and org.apache.cxf.jaxrs.provider.SourceProvider. &lt;/p&gt;

&lt;p&gt;Can we modify them as well? Since this issue is closed, I opened a new one to track this:&lt;br/&gt;
 &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-5846&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CXF-5846&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Iris Ding&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10062"><![CDATA[Moderate]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>402794</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 20 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1xbuf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>402859</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>