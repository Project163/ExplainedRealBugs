<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:25:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-7374] Concurrent calls to refreshAccessToken() fails with SQL constraint violation</title>
                <link>https://issues.apache.org/jira/browse/CXF-7374</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;When recycleRefreshTokens=false concurrent calls to refreshAccessToken() cause SQLException (2 accessTokens are created simultaneously and added to RefreshToken#accessTokens with the same index from different threads) &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Batch entry 0 insert into RefreshToken_accessTokens (RefreshToken_tokenKey, accessTokens_ORDER, accessTokens) values (&lt;span class=&quot;code-quote&quot;&gt;&apos;fced31aaba6723ecc5956721e8f029f1&apos;&lt;/span&gt;, 1, &lt;span class=&quot;code-quote&quot;&gt;&apos;8c559d9f738f33a1b866e7172c9e5644&apos;&lt;/span&gt;) was aborted: ERROR: duplicate key value violates unique constraint &lt;span class=&quot;code-quote&quot;&gt;&quot;refreshtoken_accesstokens_pkey&quot;&lt;/span&gt;
  Detail: Key (refreshtoken_tokenkey, accesstokens_order)=(fced31aaba6723ecc5956721e8f029f1, 1) already exists. 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13073146">CXF-7374</key>
            <summary>Concurrent calls to refreshAccessToken() fails with SQL constraint violation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sergey_beryozkin">Sergey Beryozkin</assignee>
                                    <reporter username="vgagara-talend">Viacheslav Gagara</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 May 2017 13:49:04 +0000</created>
                <updated>Tue, 1 Aug 2017 16:42:14 +0000</updated>
                            <resolved>Fri, 19 May 2017 20:47:19 +0000</resolved>
                                    <version>3.2.0</version>
                                    <fixVersion>3.1.12</fixVersion>
                    <fixVersion>3.2.0</fixVersion>
                                    <component>JAX-RS Security</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16015909" author="githubbot" created="Thu, 18 May 2017 15:09:18 +0000"  >&lt;p&gt;GitHub user vgagara-talend opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cxf/pull/273&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/273&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    lock RefreshToken entity with pissimistic locking to avoid concurrent updates&lt;/p&gt;

&lt;p&gt;    issue: &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7374&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CXF-7374&lt;/a&gt;&lt;br/&gt;
    orig issue: &lt;a href=&quot;https://jira.talendforge.org/browse/TPSVC-2439&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jira.talendforge.org/browse/TPSVC-2439&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/vgagara-talend/cxf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/vgagara-talend/cxf&lt;/a&gt; cxf-7374-concurrent-access-token-refresh&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cxf/pull/273.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/273.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #273&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 17f3a8bff79a29ae74a3bc12317519fb50863e86&lt;br/&gt;
Author: Viacheslav Gagara &amp;lt;vgagara@talend.com&amp;gt;&lt;br/&gt;
Date:   2017-05-18T15:02:01Z&lt;/p&gt;

&lt;p&gt;    lock RefreshToken entity with pissimistic locking to avoid concurrent updates (unit test added)&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16017981" author="githubbot" created="Fri, 19 May 2017 20:39:48 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cxf/pull/273&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/273&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16017990" author="sergey_beryozkin" created="Fri, 19 May 2017 20:47:19 +0000"  >&lt;p&gt;I&apos;ve re-enabled the test - the expected value must be equal to 2. &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7376&quot; title=&quot;Refreshing the non-recyclable RTs does not remove linked ATs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7376&quot;&gt;CXF-7376&lt;/a&gt; will deal with it further - there must be an option to have only a single AT being around at a time&lt;/p&gt;</comment>
                            <comment id="16018389" author="sergey_beryozkin" created="Sat, 20 May 2017 10:10:57 +0000"  >&lt;p&gt;Actually, I got confused a bit. There appears to be an underlying issue with JPA2 provider somewhere to do with saving the access tokens, will need to be investigated as part of a sep issue &lt;/p&gt;</comment>
                            <comment id="16027968" author="githubbot" created="Sun, 28 May 2017 22:48:35 +0000"  >&lt;p&gt;GitHub user gonzalad opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cxf/pull/275&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/275&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7374&quot; title=&quot;Concurrent calls to refreshAccessToken() fails with SQL constraint violation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7374&quot;&gt;&lt;del&gt;CXF-7374&lt;/del&gt;&lt;/a&gt; Fix for jpa refreshToken writeLock&lt;/p&gt;

&lt;p&gt;    Fix for Jpa refreshToken writeLock:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;writeLock is only called if RT already exist in db&lt;br/&gt;
       (rt.accessTokens &amp;gt; 0)&lt;/li&gt;
	&lt;li&gt;writeLock is moved to JPACMTCodeDataProvider&lt;br/&gt;
       it can only be used on CMT managed entityManagers&lt;br/&gt;
       since the transaction must span all the refreshAccessToken method&lt;br/&gt;
       (in non-CMTs, we have multiple tx for this single method).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/gonzalad/cxf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/gonzalad/cxf&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7374&quot; title=&quot;Concurrent calls to refreshAccessToken() fails with SQL constraint violation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7374&quot;&gt;&lt;del&gt;CXF-7374&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cxf/pull/275.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/275.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #275&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 07a1641b6d27d73d77b18371b473dcb1500908c7&lt;br/&gt;
Author: gonzalad &amp;lt;adr_gonzalez@yahoo.fr&amp;gt;&lt;br/&gt;
Date:   2017-05-28T22:45:41Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7374&quot; title=&quot;Concurrent calls to refreshAccessToken() fails with SQL constraint violation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7374&quot;&gt;&lt;del&gt;CXF-7374&lt;/del&gt;&lt;/a&gt; Fix for jpa refreshToken writeLock&lt;/p&gt;

&lt;p&gt;    Fix for Jpa refreshToken writeLock:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;writeLock is only called if RT already exist in db&lt;br/&gt;
       (rt.accessTokens &amp;gt; 0)&lt;/li&gt;
	&lt;li&gt;writeLock is moved to JPACMTCodeDataProvider&lt;br/&gt;
       it can only be used on CMT managed entityManagers&lt;br/&gt;
       since the transaction must span all the refreshAccessToken method&lt;br/&gt;
       (in non-CMTs, we have multiple tx for this single method).&lt;/li&gt;
&lt;/ul&gt;


&lt;hr /&gt;</comment>
                            <comment id="16028488" author="githubbot" created="Mon, 29 May 2017 16:05:04 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/cxf/pull/275&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/cxf/pull/275&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 25 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3f69j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>