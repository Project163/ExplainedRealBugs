<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:44:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-3180] Jaxrs/Jaxb unmarshaller code regularly causing performance problems &amp; thread lock-up</title>
                <link>https://issues.apache.org/jira/browse/CXF-3180</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;Please find below the details of the XML parsing performance bottleneck we are seeing when processing REST POST requests with XML bodies.&lt;br/&gt;
The performance issue is caused by the fact that CXF code creates a new JAXB Unmarshaller for every incoming request. The Unmarshaller is created quickly enough but when it is used to do the unmarshalling, it needs to create a Xerces SAXParser, which in turn calls DTDDVFactory.getInstance() and that method is synchronized. When we try to process more than 200-300 requests per second we start seeing a lot of threads blocked in DTDDVFactory.getInstance().&lt;/p&gt;

&lt;p&gt;The thread stack of one of the blocked threads is:&lt;/p&gt;

&lt;p&gt;1390532156@qtp-69728034-390&quot; prio=10 tid=0x00002aab449c0000 nid=0x28f4 waiting for monitor entry &lt;span class=&quot;error&quot;&gt;&amp;#91;0x000000004da26000&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.Thread.State: BLOCKED (on object monitor)&lt;br/&gt;
at com.sun.org.apache.xerces.internal.impl.dv.DTDDVFactory.getInstance(DTDDVFactory.java:44)&lt;/p&gt;

&lt;p&gt;waiting to lock &amp;lt;0x00002aaab279ed48&amp;gt; (a java.lang.Class for com.sun.org.apache.xerces.internal.impl.dv.DTDDVFactory)&lt;br/&gt;
at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.&amp;lt;init&amp;gt;(XML11Configuration.java:538)&lt;br/&gt;
at com.sun.org.apache.xerces.internal.parsers.XIncludeAwareParserConfiguration.&amp;lt;init&amp;gt;(XIncludeAwareParserConfiguration.java:125)&lt;br/&gt;
at com.sun.org.apache.xerces.internal.parsers.XIncludeAwareParserConfiguration.&amp;lt;init&amp;gt;(XIncludeAwareParserConfiguration.java:86)&lt;br/&gt;
at sun.reflect.GeneratedConstructorAccessor4.newInstance(Unknown Source)&lt;br/&gt;
at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27)&lt;br/&gt;
at java.lang.reflect.Constructor.newInstance(Constructor.java:513)&lt;br/&gt;
at java.lang.Class.newInstance0(Class.java:355)&lt;br/&gt;
at java.lang.Class.newInstance(Class.java:308)&lt;br/&gt;
at com.sun.org.apache.xerces.internal.parsers.ObjectFactory.newInstance(ObjectFactory.java:349)&lt;br/&gt;
at com.sun.org.apache.xerces.internal.parsers.ObjectFactory.createObject(ObjectFactory.java:154)&lt;br/&gt;
at com.sun.org.apache.xerces.internal.parsers.ObjectFactory.createObject(ObjectFactory.java:97)&lt;br/&gt;
at com.sun.org.apache.xerces.internal.parsers.SAXParser.&amp;lt;init&amp;gt;(SAXParser.java:102)&lt;br/&gt;
at com.sun.org.apache.xerces.internal.parsers.SAXParser.&amp;lt;init&amp;gt;(SAXParser.java:87)&lt;br/&gt;
at com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl$JAXPSAXParser.&amp;lt;init&amp;gt;(SAXParserImpl.java:332)&lt;br/&gt;
at com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl.&amp;lt;init&amp;gt;(SAXParserImpl.java:122)&lt;br/&gt;
at com.sun.org.apache.xerces.internal.jaxp.SAXParserFactoryImpl.newSAXParser(SAXParserFactoryImpl.java:76)&lt;br/&gt;
at javax.xml.bind.helpers.AbstractUnmarshallerImpl.getXMLReader(AbstractUnmarshallerImpl.java:75)&lt;br/&gt;
at javax.xml.bind.helpers.AbstractUnmarshallerImpl.unmarshal(AbstractUnmarshallerImpl.java:184)&lt;br/&gt;
at javax.xml.bind.helpers.AbstractUnmarshallerImpl.unmarshal(AbstractUnmarshallerImpl.java:191)&lt;br/&gt;
at org.apache.cxf.jaxrs.provider.JAXBElementProvider.unmarshalFromInputStream(JAXBElementProvider.java:216)&lt;br/&gt;
at org.apache.cxf.jaxrs.provider.JAXBElementProvider.doUnmarshal(JAXBElementProvider.java:186)&lt;br/&gt;
at org.apache.cxf.jaxrs.provider.JAXBElementProvider.readFrom(JAXBElementProvider.java:157)&lt;br/&gt;
at org.apache.cxf.jaxrs.utils.JAXRSUtils.readFromMessageBody(JAXRSUtils.java:947)&lt;br/&gt;
at org.apache.cxf.jaxrs.utils.JAXRSUtils.processParameter(JAXRSUtils.java:560)&lt;br/&gt;
at org.apache.cxf.jaxrs.utils.JAXRSUtils.processParameters(JAXRSUtils.java:525)&lt;br/&gt;
at org.apache.cxf.jaxrs.interceptor.JAXRSInInterceptor.processRequest(JAXRSInInterceptor.java:230)&lt;br/&gt;
at org.apache.cxf.jaxrs.interceptor.JAXRSInInterceptor.handleMessage(JAXRSInInterceptor.java:88)&lt;br/&gt;
at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:243)&lt;br/&gt;
locked &amp;lt;0x00002aab1e41a0e8&amp;gt; (a org.apache.cxf.phase.PhaseInterceptorChain)&lt;br/&gt;
at org.apache.cxf.transport.ChainInitiationObserver.onMessage(ChainInitiationObserver.java:109)&lt;br/&gt;
at org.apache.cxf.transport.http_jetty.JettyHTTPDestination.serviceRequest(JettyHTTPDestination.java:312)&lt;br/&gt;
...&lt;br/&gt;
The application where the problem is seen defines an XSD file and uses theJAXB compiler to create the data binding java class. It then creates a &quot;RESTResouce&quot; java class that is CXF/JAXRS annotated and contains a method that defines the processing of incoming POST requests. That method has one argument, the JAXB-compiled class, which tells CXF to unmarshall the XML body of the incoming request.&lt;/p&gt;

&lt;p&gt;Just in case, you need more context, here is the top portion of the stack of the thread that is inside the synchronized method:&lt;/p&gt;

&lt;p&gt;&quot;1840040935@qtp-69728034-391&quot; prio=10 tid=0x00002aab44810000 nid=0x2dfa waiting on condition &lt;span class=&quot;error&quot;&gt;&amp;#91;0x000000005be59000&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.lang.Thread.State: RUNNABLE&lt;br/&gt;
at org.eclipse.osgi.internal.baseadaptor.DefaultClassLoader.findLocalClass(DefaultClassLoader.java:211)&lt;br/&gt;
at org.eclipse.osgi.internal.loader.BundleLoader.findLocalClass(BundleLoader.java:381)&lt;br/&gt;
at org.eclipse.osgi.internal.loader.BundleLoader.findClassInternal(BundleLoader.java:457)&lt;br/&gt;
at org.eclipse.osgi.internal.loader.BundleLoader.findClass(BundleLoader.java:410)&lt;br/&gt;
at org.eclipse.osgi.internal.loader.BundleLoader.findClass(BundleLoader.java:398)&lt;br/&gt;
at org.eclipse.osgi.internal.baseadaptor.DefaultClassLoader.loadClass(DefaultClassLoader.java:105)&lt;br/&gt;
at java.lang.ClassLoader.loadClass(ClassLoader.java:248)&lt;br/&gt;
at org.eclipse.osgi.internal.loader.BundleLoader.loadClass(BundleLoader.java:326)&lt;br/&gt;
at org.eclipse.osgi.framework.internal.core.BundleHost.loadClass(BundleHost.java:231)&lt;br/&gt;
at org.eclipse.osgi.framework.internal.core.AbstractBundle.loadClass(AbstractBundle.java:1193)&lt;br/&gt;
at org.springframework.osgi.util.BundleDelegatingClassLoader.findClass(BundleDelegatingClassLoader.java:99)&lt;br/&gt;
at org.springframework.osgi.util.BundleDelegatingClassLoader.loadClass(BundleDelegatingClassLoader.java:156)&lt;br/&gt;
at java.lang.ClassLoader.loadClass(ClassLoader.java:248)&lt;br/&gt;
at com.sun.org.apache.xerces.internal.impl.dv.ObjectFactory.findProviderClass(ObjectFactory.java:395)&lt;br/&gt;
at com.sun.org.apache.xerces.internal.impl.dv.ObjectFactory.newInstance(ObjectFactory.java:350)&lt;br/&gt;
at com.sun.org.apache.xerces.internal.impl.dv.DTDDVFactory.getInstance(DTDDVFactory.java:59)&lt;/p&gt;

&lt;p&gt;locked &amp;lt;0x00002aaab279ed48&amp;gt; (a java.lang.Class for com.sun.org.apache.xerces.internal.impl.dv.DTDDVFactory)&lt;br/&gt;
at com.sun.org.apache.xerces.internal.impl.dv.DTDDVFactory.getInstance(DTDDVFactory.java:44)&lt;br/&gt;
locked &amp;lt;0x00002aaab279ed48&amp;gt; (a java.lang.Class for com.sun.org.apache.xerces.internal.impl.dv.DTDDVFactory)&lt;br/&gt;
at com.sun.org.apache.xerces.internal.parsers.XML11Configuration.&amp;lt;init&amp;gt;(XML11Configuration.java:538)&lt;br/&gt;
at com.sun.org.apache.xerces.internal.parsers.XIncludeAwareParserConfiguration.&amp;lt;init&amp;gt;(XIncludeAwareParserConfiguration.java:125)&lt;br/&gt;
at com.sun.org.apache.xerces.internal.parsers.XIncludeAwareParserConfiguration.&amp;lt;init&amp;gt;(XIncludeAwareParserConfiguration.java:86)&lt;br/&gt;
at sun.reflect.GeneratedConstructorAccessor4.newInstance(Unknown Source)&lt;br/&gt;
...&lt;/p&gt;</description>
                <environment></environment>
        <key id="12492904">CXF-3180</key>
            <summary>Jaxrs/Jaxb unmarshaller code regularly causing performance problems &amp; thread lock-up</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="njiang">Willem Jiang</assignee>
                                    <reporter username="njiang">Willem Jiang</reporter>
                        <labels>
                    </labels>
                <created>Fri, 10 Dec 2010 02:35:47 +0000</created>
                <updated>Tue, 16 Jul 2013 19:29:11 +0000</updated>
                            <resolved>Tue, 14 Dec 2010 14:07:14 +0000</resolved>
                                    <version>2.2.6</version>
                    <version>2.2.7</version>
                    <version>2.2.8</version>
                    <version>2.2.9</version>
                    <version>2.2.10</version>
                    <version>2.3</version>
                    <version>2.2.11</version>
                    <version>2.2.12</version>
                    <version>2.3.1</version>
                                    <fixVersion>2.3.2</fixVersion>
                    <fixVersion>2.4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12971233" author="sergey_beryozkin" created="Tue, 14 Dec 2010 11:26:52 +0000"  >&lt;p&gt;Hi Willem - many thanks for dealing with this issue.&lt;/p&gt;

&lt;p&gt;Just FYI, the users working with the released CXFs can get this issue tackled by registering a custom provider extending JAXBElementProvider and overriding getStreamReader() and using StaxUtils.createXMLStreamReader to wrap the input stream&lt;/p&gt;

&lt;p&gt;cheers, Sergey&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>47032</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 50 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0v0pz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>179090</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>