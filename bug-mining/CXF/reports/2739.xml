<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:19:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-6754] Determin Media Type in Response</title>
                <link>https://issues.apache.org/jira/browse/CXF-6754</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;    @GET&lt;br/&gt;
    @Path(&quot;text&quot;)&lt;br/&gt;
    @Produces(value = &quot;text/*&quot;)&lt;br/&gt;
    public String geText() &lt;/p&gt;
{
        return &quot;text/* is ok&quot;;
    }

&lt;p&gt;request Accept=text/*&lt;/p&gt;

&lt;p&gt;Per spec 3.8|2&lt;br/&gt;
2. Gather the set of producible media types P:&lt;br/&gt;
&#8226; If the method is annotated with @Produces, set P = fV (method)g where V (t) represents the&lt;br/&gt;
values of @Produces on the specified target t.&lt;br/&gt;
&#8226; Else if the class is annotated with @Produces, set P = fV (class)g.&lt;br/&gt;
&#8226; Else set P = fV (writers)g where &#8216;writers&#8217; is the set of MessageBodyWriter that support the&lt;br/&gt;
class of the returned entity object.&lt;/p&gt;

&lt;p&gt;Check the resource method anno first then class anno, at last check writers.&lt;/p&gt;

&lt;p&gt;So the response code should be 406.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows&lt;/p&gt;</environment>
        <key id="12933299">CXF-6754</key>
            <summary>Determin Media Type in Response</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sergey_beryozkin">Sergey Beryozkin</assignee>
                                    <reporter username="nbqyqx@163.com">Neal Hu</reporter>
                        <labels>
                    </labels>
                <created>Fri, 22 Jan 2016 10:04:19 +0000</created>
                <updated>Fri, 14 Oct 2016 14:15:47 +0000</updated>
                            <resolved>Tue, 26 Jan 2016 10:12:45 +0000</resolved>
                                    <version>3.0.7</version>
                    <version>3.1.4</version>
                                    <fixVersion>3.1.5</fixVersion>
                    <fixVersion>3.0.8</fixVersion>
                    <fixVersion>3.2.0</fixVersion>
                                    <component>JAX-RS</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15112420" author="sergey_beryozkin" created="Fri, 22 Jan 2016 13:55:23 +0000"  >&lt;p&gt;I do not understand why given Accept: &quot;text/&lt;b&gt;&quot; and Produces(&quot;text/&lt;/b&gt;&quot;) and the quoted spec text we should have 406.&lt;/p&gt;

&lt;p&gt;Can you explain ?&lt;br/&gt;
Thanks, Sergey&lt;/p&gt;</comment>
                            <comment id="15113443" author="nbqyqx@163.com" created="Sat, 23 Jan 2016 01:37:40 +0000"  >&lt;p&gt;It is the TCK case in order to verify the determination of Response media type. Only if there is no @Produces at resource method or class, we get the media type from write candidates. Now cxf always get from write candidates when request Accept has subwild. I made a path check if there is @Produces in matched resource method or class. Please review the patch. Thanks.&lt;/p&gt;

&lt;p&gt;Neal&lt;/p&gt;

</comment>
                            <comment id="15113997" author="sergey_beryozkin" created="Sat, 23 Jan 2016 22:22:06 +0000"  >&lt;p&gt;Sorry, still does not make sense to me. Given your example I do expect text/wildcard be the response.&lt;br/&gt;
Please given a clear step by step explanation why exactly these identical Accept and Produces types do not match. So far I&apos;m seeing this JIRA being invalid. TCK tests can be faulty.&lt;/p&gt;

&lt;p&gt;Cheers, Sergey&lt;/p&gt;</comment>
                            <comment id="15114064" author="nbqyqx@163.com" created="Sun, 24 Jan 2016 00:39:40 +0000"  >&lt;p&gt;Hi Sergey,&lt;br/&gt;
I think the case is valid. The mediaType of the response MUST be concrete, which means the text/wildcard in the response http header is invalid. Currently JAXRSOutInterceptor check the Accept header from request first, if it contains sub wildcard, then check all writer candidates to get the nearest mediaType from writer&apos;s @Produces. However, in the spec 3.8|2 mentioned the implementation should check the resource method or class&apos;s @Produces first, if all return null then check the writer to get the final mediaType of response.&lt;/p&gt;

&lt;p&gt;I do agree with the TCK case looks strange how we expect 406 when the Accept matches the @Produces on method. But if the @Produces on method is contains sub wildcard, the Accept contains sub wildcard is not acceptable.&lt;br/&gt;
Any further question please let me know.&lt;/p&gt;

&lt;p&gt;Neal&lt;/p&gt;

</comment>
                            <comment id="15114931" author="sergey_beryozkin" created="Mon, 25 Jan 2016 09:17:14 +0000"  >&lt;p&gt;Hi Neal&lt;/p&gt;

&lt;p&gt;406 is only returned when Accept is &lt;b&gt;not acceptable&lt;/b&gt;.&lt;br/&gt;
However text/wildcard intersects with text/wildcard and the runtime does select and invoke the getText() method.&lt;br/&gt;
So we can not really return 406 after actually &lt;b&gt;accepting&lt;/b&gt; the request.&lt;/p&gt;

&lt;p&gt;You are right a text/star would not be a proper response content type - but the spec says that when a content type has a wildcard subtype, then, unless it is application/star it has to become application/octet-stream.&lt;/p&gt;

&lt;p&gt;I suspect that someone in the TCK team assumed that a text/wildcard does not intersect and therefore asserted it had to be 406. But text/wildcard does intersect with text/wildcard, it is: text/wildcard;q=0;qs=0;d=0. The test outcome should be:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Content-Type:application/octet-stream

text/* is OK
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Cheers, Sergey&lt;/p&gt;

</comment>
                            <comment id="15114952" author="nbqyqx@163.com" created="Mon, 25 Jan 2016 09:33:40 +0000"  >&lt;p&gt;If user writes @Produces(text/wildcard) in its resource method, then the Accept: text/wildcard isn&apos;t acceptable. Please go throw Spec 3.8|2. &lt;br/&gt;
By the way, currently CXF returns text/plain instead of application/octet stream.&lt;/p&gt;

&lt;p&gt;Neal&lt;/p&gt;

</comment>
                            <comment id="15114965" author="sergey_beryozkin" created="Mon, 25 Jan 2016 09:42:48 +0000"  >&lt;p&gt;You quoted 3.8/2 - where does it say it is not acceptable ?&lt;/p&gt;

&lt;p&gt;re text/plain vs application/octet-stream - lets talk about it next ( I think I may have submitted a spec improvement/bug request - I definitely had a discussion where I was challenging the idea of a media type with the main &apos;text&apos; type being replaced by application/octet-stream. Or perhaps because the final content type is derived from the intersection between the string writer which produces text/plain... We will discuss it later&lt;/p&gt;

&lt;p&gt;Sergey &lt;/p&gt;</comment>
                            <comment id="15115436" author="nbqyqx@163.com" created="Mon, 25 Jan 2016 15:52:40 +0000"  >&lt;p&gt;in 3.8|2 we get from method annotation is text/wildcard, 3.8|5 intersect with Accept=text/wildcard, text/wildcard is the result. Then in 3.8|8, it isn&apos;t concrete type, in 3.8|9 it isn&apos;t application/wildcard or wildcard/wildcard , 3.8|10 return 406.&lt;/p&gt;

&lt;p&gt;Neal&lt;/p&gt;

</comment>
                            <comment id="15115510" author="sergey_beryozkin" created="Mon, 25 Jan 2016 16:44:04 +0000"  >&lt;p&gt;This is better and this is what I was hoping to read, all those references to 3.8/2 were confusing and the patch is invalid.&lt;br/&gt;
checkFinalContentType is where 406 is reported - right now it has the code that if a subtype is a wildcard then it tries to intersect with the writer Produces and thus, given text/wildcard you see a text/plain - which is the intersection between text/wildcard and String writer&apos;s Produces, without that code you&apos;d see 406.&lt;br/&gt;
I&apos;ll need to investigate what to do with that code&lt;/p&gt;



</comment>
                            <comment id="15115552" author="sergey_beryozkin" created="Mon, 25 Jan 2016 17:02:41 +0000"  >&lt;p&gt;Actually, your patch may be just fine, though it may be optimized a bit as Produces are available on OperationResourceInfo/ClassResourceInfo, though I might tweak few things there too.&lt;br/&gt;
We are getting closer...&lt;/p&gt;</comment>
                            <comment id="15116455" author="nbqyqx@163.com" created="Tue, 26 Jan 2016 01:19:40 +0000"  >&lt;p&gt;Have added flag to check writer or not in the patch, which means if Produces exists in the ori or cri the check in writer will be skipped.&lt;/p&gt;

&lt;p&gt;&#21457;&#33258;&#25105;&#30340; iPhone&lt;/p&gt;

</comment>
                            <comment id="15117022" author="sergey_beryozkin" created="Tue, 26 Jan 2016 10:09:42 +0000"  >&lt;p&gt;Neal, I&apos;ve applied your patch with a very minor tweak (check the annotations only if a wildcard subtype is there). &lt;br/&gt;
Sorry I did not pay enough attention to your patch from a start with other projects being under way. I honestly do not like this spec piece where 406 is returned, text/star and with a text/plain writer being available, which is a spec bug but I&apos;m afraid there&apos;s a little chance of JAX-RS 2.1 fixing it, so I&apos;d rather get this issue resolved &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;br/&gt;
Thanks for your effort and please keep the patches coming&lt;br/&gt;
Sergey   &lt;/p&gt;</comment>
                            <comment id="15117033" author="nbqyqx@163.com" created="Tue, 26 Jan 2016 10:18:40 +0000"  >&lt;p&gt;It&apos;s ok. I do agree the spec is not elegant enough. However we need pass the TCK. Thanks for your time.&lt;/p&gt;

&lt;p&gt;Neal&lt;/p&gt;

</comment>
                    </comments>
                    <attachments>
                            <attachment id="12783821" name="JAXRSOutInterceptor.patch" size="2093" author="nbqyqx@163.com" created="Fri, 22 Jan 2016 12:25:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 43 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ru5j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>