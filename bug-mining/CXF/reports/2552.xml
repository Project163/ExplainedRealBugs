<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:15:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-6398] AlgorithmSuitePolicyValidator rejects enveloped-signature Transform</title>
                <link>https://issues.apache.org/jira/browse/CXF-6398</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;I&apos;m receiving a response from a (.NET) webservice, where the security requirements are set by a WS-SecurityPolicy section in the WSDL.&lt;/p&gt;

&lt;p&gt;The response contains a set of Reference elements, thave have both the enveloped-signature transform and the c14n transform, example below&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Reference URI=&lt;span class=&quot;code-quote&quot;&gt;&quot;#action&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Transforms&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Transform Algorithm=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2000/09/xmldsig#enveloped-signature&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Transform&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Transform Algorithm=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Transform&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Transforms&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;DigestMethod Algorithm=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2000/09/xmldsig#sha1&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/DigestMethod&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;DigestValue&amp;gt;&lt;/span&gt;1hj8fpM7T5rcOsNRPpnxA3p3AkM=&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/DigestValue&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Reference&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Unfortunately, the AlgorithmSuitePolicyValidator does not like the enveloped-signature transform, and the response is rejected, exception shown below&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; javax.xml.ws.soap.SOAPFaultException: These policy alternatives can not be satisfied: 
{http:&lt;span class=&quot;code-comment&quot;&gt;//docs.oasis-open.org/ws-sx/ws-securitypolicy/200702}AlgorithmSuite: The transform algorithms &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; not match the requirement
&lt;/span&gt;{http:&lt;span class=&quot;code-comment&quot;&gt;//docs.oasis-open.org/ws-sx/ws-securitypolicy/200702}Basic256
&lt;/span&gt;	at org.apache.cxf.jaxws.JaxWsClientProxy.invoke(JaxWsClientProxy.java:160)
	at com.sun.proxy.$Proxy33.helloWorld(Unknown Source)
	at client.WSClient.hello(WSClient.java:19)
	at client.WSClient.main(WSClient.java:12)
Caused by: org.apache.cxf.ws.policy.PolicyException: These policy alternatives can not be satisfied: 
{http:&lt;span class=&quot;code-comment&quot;&gt;//docs.oasis-open.org/ws-sx/ws-securitypolicy/200702}AlgorithmSuite: The transform algorithms &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; not match the requirement
&lt;/span&gt;{http:&lt;span class=&quot;code-comment&quot;&gt;//docs.oasis-open.org/ws-sx/ws-securitypolicy/200702}Basic256
&lt;/span&gt;	at org.apache.cxf.ws.policy.AssertionInfoMap.checkEffectivePolicy(AssertionInfoMap.java:203)
	at org.apache.cxf.ws.policy.PolicyVerificationInInterceptor.handle(PolicyVerificationInInterceptor.java:102)
	at org.apache.cxf.ws.policy.AbstractPolicyInterceptor.handleMessage(AbstractPolicyInterceptor.java:44)
	at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:307)
	at org.apache.cxf.endpoint.ClientImpl.onMessage(ClientImpl.java:802)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I took a look at the AlgorithmSuitePolicyValidator that does the actual validation, and it scans through all the Transforms, and reject the Reference if ANY of the Transform elements are not on an approved list.&lt;/p&gt;

&lt;p&gt;Should it not just validate that the list of Transforms contains at least one transform that is c14n (or similar), and allow the eveloped-signature transform?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12828782">CXF-6398</key>
            <summary>AlgorithmSuitePolicyValidator rejects enveloped-signature Transform</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10001">Pending Closed</resolution>
                                        <assignee username="coheigea">Colm O hEigeartaigh</assignee>
                                    <reporter username="BSGraversen">Brian Storm Graversen</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 May 2015 11:43:47 +0000</created>
                <updated>Fri, 14 Oct 2016 14:25:28 +0000</updated>
                            <resolved>Tue, 12 May 2015 15:41:34 +0000</resolved>
                                    <version>3.0.5</version>
                                    <fixVersion>3.1.1</fixVersion>
                    <fixVersion>3.0.6</fixVersion>
                                    <component>WS-* Components</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14537854" author="bsgraversen" created="Mon, 11 May 2015 11:50:48 +0000"  >&lt;p&gt;For reference, the validation happens in the checkDataRefs() method found in the AlgorithmSuitePolicyValidator&lt;/p&gt;</comment>
                            <comment id="14537877" author="bsgraversen" created="Mon, 11 May 2015 12:28:52 +0000"  >&lt;p&gt;I think that this validation code might have been inspired by the Basic Security Profile 1.1 rule 5412, as it states that the LAST Transform must be one of the Transforms that the code in checkDataRefs() validates against&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.ws-i.org/profiles/basicsecurityprofile-1.1.html#Last_Transform_Algorithm&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.ws-i.org/profiles/basicsecurityprofile-1.1.html#Last_Transform_Algorithm&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I think the problem is that the validation is to strict, as it requires ALL Transforms to be on this list, and not just the LAST Transform&lt;/p&gt;</comment>
                            <comment id="14537946" author="coheigea" created="Mon, 11 May 2015 13:42:30 +0000"  >
&lt;p&gt;Could I see the complete security header of the response?&lt;/p&gt;

&lt;p&gt;Colm.&lt;/p&gt;</comment>
                            <comment id="14539257" author="bsgraversen" created="Tue, 12 May 2015 05:14:16 +0000"  >&lt;p&gt;Certainly, it looks like this&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;wsse:Security S11:mustUnderstand=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;wsu:Timestamp wsu:Id=&lt;span class=&quot;code-quote&quot;&gt;&quot;sec_timestamp&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;wsu:Created&amp;gt;&lt;/span&gt;2015-05-12T05:13:12.953Z&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/wsu:Created&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;wsu:Expires&amp;gt;&lt;/span&gt;2015-05-12T13:13:12.953Z&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/wsu:Expires&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/wsu:Timestamp&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Signature xmlns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2000/09/xmldsig#&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;SignedInfo&amp;gt;&lt;/span&gt;
					&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;CanonicalizationMethod Algorithm=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/CanonicalizationMethod&amp;gt;&lt;/span&gt;
					&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;SignatureMethod Algorithm=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2000/09/xmldsig#rsa-sha1&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/SignatureMethod&amp;gt;&lt;/span&gt;
					&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Reference URI=&lt;span class=&quot;code-quote&quot;&gt;&quot;#action&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
						&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Transforms&amp;gt;&lt;/span&gt;
							&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Transform Algorithm=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2000/09/xmldsig#enveloped-signature&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Transform&amp;gt;&lt;/span&gt;
							&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Transform Algorithm=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Transform&amp;gt;&lt;/span&gt;
						&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Transforms&amp;gt;&lt;/span&gt;
						&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;DigestMethod Algorithm=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2000/09/xmldsig#sha1&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/DigestMethod&amp;gt;&lt;/span&gt;
						&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;DigestValue&amp;gt;&lt;/span&gt;1hj8fpM7T5rcOsNRPpnxA3p3AkM=&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/DigestValue&amp;gt;&lt;/span&gt;
					&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Reference&amp;gt;&lt;/span&gt;
					&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Reference URI=&lt;span class=&quot;code-quote&quot;&gt;&quot;#messageid&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
						&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Transforms&amp;gt;&lt;/span&gt;
							&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Transform Algorithm=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2000/09/xmldsig#enveloped-signature&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Transform&amp;gt;&lt;/span&gt;
							&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Transform Algorithm=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Transform&amp;gt;&lt;/span&gt;
						&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Transforms&amp;gt;&lt;/span&gt;
						&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;DigestMethod Algorithm=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2000/09/xmldsig#sha1&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/DigestMethod&amp;gt;&lt;/span&gt;
						&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;DigestValue&amp;gt;&lt;/span&gt;ALh9N6nRIAs/RouHzRwJC/8jTwc=&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/DigestValue&amp;gt;&lt;/span&gt;
					&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Reference&amp;gt;&lt;/span&gt;
					&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Reference URI=&lt;span class=&quot;code-quote&quot;&gt;&quot;#relatesto&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
						&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Transforms&amp;gt;&lt;/span&gt;
							&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Transform Algorithm=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2000/09/xmldsig#enveloped-signature&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Transform&amp;gt;&lt;/span&gt;
							&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Transform Algorithm=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Transform&amp;gt;&lt;/span&gt;
						&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Transforms&amp;gt;&lt;/span&gt;
						&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;DigestMethod Algorithm=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2000/09/xmldsig#sha1&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/DigestMethod&amp;gt;&lt;/span&gt;
						&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;DigestValue&amp;gt;&lt;/span&gt;J8Kw5vHYfKO4VFsblOFQCzahtT4=&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/DigestValue&amp;gt;&lt;/span&gt;
					&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Reference&amp;gt;&lt;/span&gt;
					&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Reference URI=&lt;span class=&quot;code-quote&quot;&gt;&quot;#sec_timestamp&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
						&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Transforms&amp;gt;&lt;/span&gt;
							&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Transform Algorithm=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2000/09/xmldsig#enveloped-signature&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Transform&amp;gt;&lt;/span&gt;
							&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Transform Algorithm=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Transform&amp;gt;&lt;/span&gt;
						&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Transforms&amp;gt;&lt;/span&gt;
						&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;DigestMethod Algorithm=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2000/09/xmldsig#sha1&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/DigestMethod&amp;gt;&lt;/span&gt;
						&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;DigestValue&amp;gt;&lt;/span&gt;GUD+jt+n6AINFBmyzJaK5LjupiE=&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/DigestValue&amp;gt;&lt;/span&gt;
					&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Reference&amp;gt;&lt;/span&gt;
					&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Reference URI=&lt;span class=&quot;code-quote&quot;&gt;&quot;#body&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
						&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Transforms&amp;gt;&lt;/span&gt;
							&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Transform Algorithm=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2000/09/xmldsig#enveloped-signature&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Transform&amp;gt;&lt;/span&gt;
							&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Transform Algorithm=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Transform&amp;gt;&lt;/span&gt;
						&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Transforms&amp;gt;&lt;/span&gt;
						&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;DigestMethod Algorithm=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2000/09/xmldsig#sha1&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/DigestMethod&amp;gt;&lt;/span&gt;
						&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;DigestValue&amp;gt;&lt;/span&gt;fsTrPTLBf66FMbP9loRXsMpkGT4=&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/DigestValue&amp;gt;&lt;/span&gt;
					&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Reference&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/SignedInfo&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;SignatureValue&amp;gt;&lt;/span&gt;B5vE2dySowVd4JQtvAJzRdMeh54ygU4jBgVnbvVTgLgk89Lo13V3bYH12LxS2n1YgjEnEVZQL42+wP10giFdPdfTZnIlCvoPr+pT7uF2dBkvsIYY03iMvx1F/Z0H1yeqeWTwM2X1vZlnTUafwNXLXRmzSNXf2XfTPNF5eaPmTSeUHtLueUDynUn9R6Z0pIKUVodkKu/Ax2fpyVIHHrE58hOhT95B+uxhNd0tOW2uzG8zh/iebb6yp62CRS92P2rRV9i8yL5HC+CR0oDd/P0gVgfuxPpQtNxXXU3g8RmzETJXWS+4Nr89Eu+HHa7t9ly+7fV8KYfviTZRZU635MuC8g==&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/SignatureValue&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Signature&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/wsse:Security&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14539280" author="bsgraversen" created="Tue, 12 May 2015 05:43:06 +0000"  >&lt;p&gt;I modified the checkDataRefs() method to this in AlgorithmSuitePolicyValidator class, which h&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; checkDataRefs(List&amp;lt;WSDataRef&amp;gt; dataRefs, AlgorithmSuite algorithmPolicy, AssertionInfo ai) {
        AlgorithmSuiteType algorithmSuiteType = algorithmPolicy.getAlgorithmSuiteType();
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (WSDataRef dataRef : dataRefs) {
            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; digestMethod = dataRef.getDigestAlgorithm();
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!algorithmSuiteType.getDigest().equals(digestMethod)) {
                ai.setNotAsserted(&lt;span class=&quot;code-quote&quot;&gt;&quot;The digest method does not match the requirement&quot;&lt;/span&gt;);
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
            }
            
            List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; transformAlgorithms = dataRef.getTransformAlgorithms();

            &lt;span class=&quot;code-comment&quot;&gt;// Only a max of 2 transforms per reference is allowed
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (transformAlgorithms == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || transformAlgorithms.size() &amp;gt; 2) {
                ai.setNotAsserted(&lt;span class=&quot;code-quote&quot;&gt;&quot;The transform algorithms &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; not match the requirement&quot;&lt;/span&gt;);
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
            }
            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; transformAlgorithm = transformAlgorithms.get(transformAlgorithms.size() - 1);

            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!(algorithmPolicy.getC14n().getValue().equals(transformAlgorithm)
                || WSConstants.C14N_EXCL_OMIT_COMMENTS.equals(transformAlgorithm)
                || STRTransform.TRANSFORM_URI.equals(transformAlgorithm)
                || WSConstants.SWA_ATTACHMENT_CONTENT_SIG_TRANS.equals(transformAlgorithm)
                || WSConstants.SWA_ATTACHMENT_COMPLETE_SIG_TRANS.equals(transformAlgorithm))) {

                ai.setNotAsserted(&lt;span class=&quot;code-quote&quot;&gt;&quot;The transform algorithms &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; not match the requirement&quot;&lt;/span&gt;);
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
            }
        }

        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The only difference is that it just checks the last Transform and not all of them.&lt;/p&gt;

&lt;p&gt;In SignatureProcessor there is a method called checkBSPCompliance() that checks all the references. It allows enveloped-signature as a Transform as long as it is not the last Transform, here it only allows the c14n variants&lt;/p&gt;

&lt;p&gt;Snippet from that method is shown here&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-comment&quot;&gt;// Check References
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; refObject : xmlSignature.getSignedInfo().getReferences()) {
            Reference reference = (Reference)refObject;
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (reference.getTransforms().isEmpty()) {
                bspEnforcer.handleBSPRule(BSPRule.R5416);
            }
            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; reference.getTransforms().size(); i++) {
                Transform transform = (Transform)reference.getTransforms().get(i);
                &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; algorithm = transform.getAlgorithm();
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!(WSConstants.C14N_EXCL_OMIT_COMMENTS.equals(algorithm)
                    || STRTransform.TRANSFORM_URI.equals(algorithm)
                    || WSConstants.NS_XMLDSIG_FILTER2.equals(algorithm)
                    || WSConstants.NS_XMLDSIG_ENVELOPED_SIGNATURE.equals(algorithm)
                    || WSConstants.SWA_ATTACHMENT_COMPLETE_SIG_TRANS.equals(algorithm)
                    || WSConstants.SWA_ATTACHMENT_CONTENT_SIG_TRANS.equals(algorithm))) {
                    bspEnforcer.handleBSPRule(BSPRule.R5423);
                }
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (i == (reference.getTransforms().size() - 1)
                    &amp;amp;&amp;amp; !(WSConstants.C14N_EXCL_OMIT_COMMENTS.equals(algorithm)
                        || STRTransform.TRANSFORM_URI.equals(algorithm)
                        || WSConstants.SWA_ATTACHMENT_COMPLETE_SIG_TRANS.equals(algorithm)
                        || WSConstants.SWA_ATTACHMENT_CONTENT_SIG_TRANS.equals(algorithm))) {
                    bspEnforcer.handleBSPRule(BSPRule.R5412);
                }
                
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (WSConstants.C14N_EXCL_OMIT_COMMENTS.equals(algorithm)) {
                    parameterSpec = transform.getParameterSpec();
                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (parameterSpec != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; !(parameterSpec &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; ExcC14NParameterSpec)) {
                        bspEnforcer.handleBSPRule(BSPRule.R5407);
                    }
                }
            }
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It is interesting to note that BSP rule 5423 explicitly allows enveloped-signature (&lt;a href=&quot;http://www.ws-i.org/profiles/basicsecurityprofile-1.1.html#SignatureTransforms&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.ws-i.org/profiles/basicsecurityprofile-1.1.html#SignatureTransforms&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="14539609" author="coheigea" created="Tue, 12 May 2015 10:02:12 +0000"  >
&lt;p&gt;Hmm looking at the security header, it appears that the enveloped transform is not being used correctly at all. The enveloped transform is used when the Signature is a child Element of the Element that is signed, in which case the transform tells the signature calculation process to remove the Signature from the digest calculation. In your case, it appears that none of the elements that are signed are parent elements of the Signature Element, and hence the enveloped transform can be left out altogether.&lt;/p&gt;

&lt;p&gt;Colm.&lt;/p&gt;</comment>
                            <comment id="14539616" author="bsgraversen" created="Tue, 12 May 2015 10:06:43 +0000"  >&lt;p&gt;Correct, and I have informed the service provider of this, though I&apos;m not sure exactly when they will fix the issue in their end.&lt;/p&gt;

&lt;p&gt;I still think the validation is wrong, and that CXF should allow the Transform, even though the Transform has no effect, but I&apos;ll leave that up to you - I have no idea when (if ever) the web service will change its behavior, so I&apos;m currently running with my above &quot;fix&quot; to the validation algorithm.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 28 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ejvj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>