<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:35:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-8242] Stop blocking executor thread on microprofile rest asynchronous call  </title>
                <link>https://issues.apache.org/jira/browse/CXF-8242</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;Hello, while digging into the way implementation for microprofile was done to understand how I can override the default executor and how it is used behind the scene, I found that the microprofile futures are actually created using CompletableFuture.supplyAsync using the given executor or default one defined by CXF and calling wait on it. If not mistaken this should block the executor thread until it is resumed by async handler. This is a major issue for us as we were expecting pure asynchronous processing to avoid defining executors with many threads.&lt;/p&gt;

&lt;p&gt;If everything I say is correct I have tried to implement a naive implementation creating a future using constructor that is not waiting but will be completed by asynchronous handler&lt;/p&gt;</description>
                <environment></environment>
        <key id="13291897">CXF-8242</key>
            <summary>Stop blocking executor thread on microprofile rest asynchronous call  </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="reta">Andriy Redko</assignee>
                                    <reporter username="baiglin">Baptiste AIGLIN</reporter>
                        <labels>
                    </labels>
                <created>Mon, 16 Mar 2020 07:36:43 +0000</created>
                <updated>Wed, 22 Dec 2021 20:43:51 +0000</updated>
                            <resolved>Thu, 14 May 2020 23:44:18 +0000</resolved>
                                    <version>3.3.6</version>
                    <version>3.2.13</version>
                                    <fixVersion>3.2.14</fixVersion>
                    <fixVersion>3.3.7</fixVersion>
                    <fixVersion>3.4.0</fixVersion>
                                    <component>MicroProfile</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="17063032" author="reta" created="Fri, 20 Mar 2020 01:46:36 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=baiglin&quot; class=&quot;user-hover&quot; rel=&quot;baiglin&quot;&gt;baiglin&lt;/a&gt; ,&lt;/p&gt;

&lt;p&gt;Thanks for bringing up this issue. I had a chance to look at it but unfortunately the fix is not as easy as it sounds. To briefly summarize the problem, MPRestClientCallback is a Future&amp;lt;?&amp;gt; itself, with a completely own lifecycle. What MPRestClientCallback tries to do at the moment is attempting to convert itself (Future&amp;lt;?&amp;gt;) to CompletableFuture&amp;lt;?&amp;gt; (which is basically a blocking call to get()). By introducing an ad-hoc CompletableFuture&amp;lt;?&amp;gt;, as you suggesting, would work for most cases, but:&lt;/p&gt;

&lt;p&gt;&#160;- introduces parallel completion chain (Future&amp;lt;?&amp;gt; + CompletableFuture&amp;lt;?&amp;gt;)&lt;br/&gt;
&#160;- does not properly propagate cancellation (even now the MPRestClientCallback does not handle it properly)&lt;/p&gt;

&lt;p&gt;I understand that this clarification does not solve the problem but just wanted to share the findings with you. I am looking at a couple of options right now, will try to suggest an acceptable fix shortly.&lt;/p&gt;

&lt;p&gt;Thank you.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17063163" author="baiglin" created="Fri, 20 Mar 2020 08:23:45 +0000"  >&lt;p&gt;Hi Andriy,&lt;/p&gt;

&lt;p&gt;Many thanks for the explanation, so the idea would be to try having only one level of future without introducing new one on top? (Sounds easy saying it...).&#160;&lt;/p&gt;

&lt;p&gt;No chance on making the&#160;ClientCallback class extends CompletableFuture to have it implement the Future ? This could also benefit the Jax-ws &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Much appreciated your findings, I am really interested so do not hesitate to post. Thanks&lt;/p&gt;</comment>
                            <comment id="17063315" author="reta" created="Fri, 20 Mar 2020 11:45:49 +0000"  >&lt;p&gt;Hi Baptiste,&lt;/p&gt;

&lt;p&gt;Thank you, yes, having only one single level of futures would be the best outcome. Sub-classing CompletableFuture is one of the options I am considering&#160;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; (another one is delegating). Thank you.&lt;/p&gt;</comment>
                            <comment id="17065429" author="coheigea" created="Tue, 24 Mar 2020 08:46:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reta&quot; class=&quot;user-hover&quot; rel=&quot;reta&quot;&gt;reta&lt;/a&gt; Is a fix for this imminent, or can it go in the next release?&lt;/p&gt;</comment>
                            <comment id="17065912" author="reta" created="Tue, 24 Mar 2020 15:52:56 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=coheigea&quot; class=&quot;user-hover&quot; rel=&quot;coheigea&quot;&gt;coheigea&lt;/a&gt; , I already have a fix but I need to make sure it won&apos;t have impact on threading / synchronization, working on tests but very likely it should better go to next release.&lt;/p&gt;</comment>
                            <comment id="17070185" author="reta" created="Sun, 29 Mar 2020 02:26:45 +0000"  >&lt;p&gt;PS: The fix also gets rid of errors during the TCK run (&lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-7996&quot; title=&quot;Jakarta EE TCKs and compatibility&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-7996&quot;&gt;&lt;del&gt;CXF-7996&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="17070401" author="reta" created="Sun, 29 Mar 2020 15:37:28 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=baiglin&quot; class=&quot;user-hover&quot; rel=&quot;baiglin&quot;&gt;baiglin&lt;/a&gt; , the fix went in into latest 3.3.7-SNAPSHOT, could you please give it a try? Thanks!&lt;/p&gt;</comment>
                            <comment id="17071962" author="coheigea" created="Tue, 31 Mar 2020 16:49:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reta&quot; class=&quot;user-hover&quot; rel=&quot;reta&quot;&gt;reta&lt;/a&gt; Looks like this merge breaks one of the jaxrs systests - JAXRS20ClientServerBookTest#testPostBookAsyncHandler&lt;/p&gt;

&lt;p&gt;The test works when you run it on its own, but fails when you run all the JAXRS20ClientServerBookTest together:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.AssertionError: expected same:&amp;lt;org.apache.cxf.systest.jaxrs.Book@5d05ef57&amp;gt; was not:&amp;lt;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&amp;gt;
	at org.apache.cxf.systest.jaxrs.JAXRS20ClientServerBookTest.doTestPostBookAsyncHandler(JAXRS20ClientServerBookTest.java:663)
	at org.apache.cxf.systest.jaxrs.JAXRS20ClientServerBookTest.testPostBookAsyncHandler(JAXRS20ClientServerBookTest.java:818)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17071995" author="reta" created="Tue, 31 Mar 2020 17:28:07 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=coheigea&quot; class=&quot;user-hover&quot; rel=&quot;coheigea&quot;&gt;coheigea&lt;/a&gt; , I will take a look shortly!&lt;/p&gt;</comment>
                            <comment id="17072282" author="reta" created="Wed, 1 Apr 2020 01:10:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=coheigea&quot; class=&quot;user-hover&quot; rel=&quot;coheigea&quot;&gt;coheigea&lt;/a&gt; the tests should be all good now, it was all about timing issues. In the nutshell, when I did the refactoring, unintentionally the sequence of callback completion and handler invocation was impacted. I restored this behavior by ensuring that handler is always called first, than callback completes. Thanks a lot for spotting this regression.&lt;/p&gt;</comment>
                            <comment id="17072410" author="coheigea" created="Wed, 1 Apr 2020 06:11:20 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reta&quot; class=&quot;user-hover&quot; rel=&quot;reta&quot;&gt;reta&lt;/a&gt; , it&apos;s looking good now.&lt;/p&gt;</comment>
                            <comment id="17108901" author="baiglin" created="Sat, 16 May 2020 07:30:35 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reta&quot; class=&quot;user-hover&quot; rel=&quot;reta&quot;&gt;reta&lt;/a&gt;, can I get the snapshot version other than building the whole project, in order to test it ?&lt;/p&gt;

&lt;p&gt;I have another question if you know the answer, is it possible to acces the response context, it looks impossible without the asynchandler now. Thanks again&lt;/p&gt;</comment>
                            <comment id="17109059" author="reta" created="Sat, 16 May 2020 13:05:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=baiglin&quot; class=&quot;user-hover&quot; rel=&quot;baiglin&quot;&gt;baiglin&lt;/a&gt; the snapshots are available at &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; (for 3.2.x, 3.3.x and 3.4.x). The response context is available through `getResponseContext()` method for all callbacks, or you have different case in mind?&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17109194" author="baiglin" created="Sat, 16 May 2020 19:55:59 +0000"  >&lt;p&gt;I should have been clearer, sorry, I meant from the response future object, in jaxws, we can access the response context from the Response interface, but here with the future, after the exchange is done, I cannot access anymore the context linked to a given response. For synchronous case it is less tricky as I think I can get it from the proxy object but in case of async, I dont see how to access the callback after my call is performed (I could store the callback in the interceptor chain but I would like to get it from the response object itself)&lt;/p&gt;</comment>
                            <comment id="17109282" author="reta" created="Sun, 17 May 2020 02:38:25 +0000"  >&lt;p&gt;I think you should still be able to access the context, the only change is the internal implementation with respect to value / exception propagation (delegated to CompleatableFuture now). If you could attach a test scenario to demonstrate the problem we could go over, it would be great, thank you.&lt;/p&gt;</comment>
                            <comment id="17131036" author="baiglin" created="Wed, 10 Jun 2020 17:21:46 +0000"  >&lt;p&gt;Yes anyway what I wanted to do is not really standard so no need to check further, thanks for your time.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13221645">CXF-7996</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12996811" name="cxf-microprofile.zip" size="6168" author="baiglin" created="Mon, 16 Mar 2020 07:36:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 22 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ck8o:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>