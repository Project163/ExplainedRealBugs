<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:58:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-4817] JAX-RS AsyncResponse implementation needs to call AsyncContext.complete after the request is done</title>
                <link>https://issues.apache.org/jira/browse/CXF-4817</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;This will help with a better recycling of threads plus will get AsyncListener onComplete and onError callbacks called - for the registered completion callbacks be notified&lt;/p&gt;</description>
                <environment></environment>
        <key id="12631450">CXF-4817</key>
            <summary>JAX-RS AsyncResponse implementation needs to call AsyncContext.complete after the request is done</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sergey_beryozkin">Sergey Beryozkin</assignee>
                                    <reporter username="sergey_beryozkin">Sergey Beryozkin</reporter>
                        <labels>
                    </labels>
                <created>Fri, 8 Feb 2013 13:55:27 +0000</created>
                <updated>Mon, 8 Dec 2014 10:48:40 +0000</updated>
                            <resolved>Tue, 12 Feb 2013 11:44:53 +0000</resolved>
                                                    <fixVersion>2.7.4</fixVersion>
                    <fixVersion>3.0.0-milestone1</fixVersion>
                                    <component>JAX-RS</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13574867" author="sergey_beryozkin" created="Fri, 8 Feb 2013 22:06:20 +0000"  >&lt;p&gt;r1444117,r1444252&lt;/p&gt;</comment>
                            <comment id="13576562" author="sergey_beryozkin" created="Tue, 12 Feb 2013 11:44:53 +0000"  >&lt;p&gt;Lets limit the fix to the trunk for now and push to 2.7.x on request&lt;/p&gt;</comment>
                            <comment id="14235341" author="efouret" created="Fri, 5 Dec 2014 10:29:53 +0000"  >&lt;p&gt;The fix for this issue was rollbacked with &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-5414&quot; title=&quot;XMLStreamException when using Continuations in versions &amp;gt; 2.7.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-5414&quot;&gt;&lt;del&gt;CXF-5414&lt;/del&gt;&lt;/a&gt;, so this issue is still present in CXF 3.0.X, could it be reopened?&lt;/p&gt;</comment>
                            <comment id="14235377" author="sergey_beryozkin" created="Fri, 5 Dec 2014 11:06:14 +0000"  >&lt;p&gt;Hi - I&apos;ve just rerun a test and I can see a registered CompletionCallback being called - are you seeing it is not in your case ?&lt;/p&gt;
</comment>
                            <comment id="14235473" author="efouret" created="Fri, 5 Dec 2014 13:34:05 +0000"  >&lt;p&gt;Thanks for your quick reply. &lt;tt&gt;javax.ws.rs.container.CompletionCallback.onComplete()&lt;/tt&gt; is called but &lt;tt&gt;javax.servlet.AsyncContext.complete()&lt;/tt&gt; is not and thus any &lt;tt&gt;javax.servlet.AsyncListener&lt;/tt&gt; declared (e.g. inside a servlet filter) won&apos;t see a call to &lt;tt&gt;onComplete()&lt;/tt&gt;.&lt;br/&gt;
It seems the code initially committed to fix this issue resulted in calling &lt;tt&gt;AsyncContext.complete()&lt;/tt&gt; (through &lt;tt&gt;Servlet3ContinuationProvider.reset()&lt;/tt&gt;) which is no longer the case.&lt;/p&gt;</comment>
                            <comment id="14235497" author="sergey_beryozkin" created="Fri, 5 Dec 2014 13:59:28 +0000"  >&lt;p&gt;It appears to be something very subtle. CXF AbstractHttpDestination does call ContinuationProvider complete(), in case of Servlet3Continuation it leads to an immediate call to asyncContext.complete().&lt;/p&gt;

&lt;p&gt;Did you have your custom listeners called before this change ? &lt;br/&gt;
It migh be that the current container you useis too sensitive to having a context.complete() method being called - the exception is ignored in such cases.&lt;br/&gt;
Can you please investigate and check if it is the case for you ?&lt;/p&gt;

&lt;p&gt;Cheers, Sergey&lt;/p&gt;
</comment>
                            <comment id="14235647" author="efouret" created="Fri, 5 Dec 2014 15:42:37 +0000"  >&lt;p&gt;I continued investigating and found that the real issue is that the custom &lt;tt&gt;AsyncListener&lt;/tt&gt; gets lost when the response is ready. Indeed, this will indirectly cause a call to &lt;tt&gt;Servlet3ContinuationProvider.getContinuation()&lt;/tt&gt; which will call &lt;tt&gt;Servlet3Continuation.startAsyncAgain()&lt;/tt&gt; which will then call &lt;tt&gt;req.startAsync()&lt;/tt&gt;. This last call erases previously registered listeners and thus no call to &lt;tt&gt;onComplete()&lt;/tt&gt; will be seen on any custom listener.&lt;br/&gt;
Perhaps &lt;tt&gt;Servlet3ContinuationProvider.getContinuation()&lt;/tt&gt; shouldn&apos;t call startAsync() when a continuation already exist?&lt;/p&gt;</comment>
                            <comment id="14235691" author="sergey_beryozkin" created="Fri, 5 Dec 2014 16:24:15 +0000"  >&lt;p&gt;Calling startAsync is the only way, as far as I know, to ensure that multiple timeouts (those managed by TimeoutHandler) work. &lt;/p&gt;

&lt;p&gt;However, I think we can try and optionally avoid restarting a context if a contextual property is set, for example, if the application knows TimeoutHandler, if any, will never re-suspend the continuation, then setting a property would do.&lt;/p&gt;
</comment>
                            <comment id="14235711" author="sergey_beryozkin" created="Fri, 5 Dec 2014 16:47:47 +0000"  >&lt;p&gt;Actually, see&lt;br/&gt;
&lt;a href=&quot;https://docs.oracle.com/javaee/6/api/javax/servlet/AsyncListener.html#onStartAsync%28javax.servlet.AsyncEvent%29&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/javaee/6/api/javax/servlet/AsyncListener.html#onStartAsync%28javax.servlet.AsyncEvent%29&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The custom listener is expected to re-register itself. &lt;/p&gt;

&lt;p&gt;thanks&lt;/p&gt;</comment>
                            <comment id="14235734" author="efouret" created="Fri, 5 Dec 2014 17:05:37 +0000"  >&lt;p&gt;Thanks. This seems to be a tomcat issue then, since tomcat clears the list of listeners after firing the &lt;tt&gt;onStartAsync&lt;/tt&gt; event with the same &lt;tt&gt;AsyncContext&lt;/tt&gt;, thus preventing listeners from re-registering themselves.&lt;br/&gt;
Thanks again for your time.&lt;/p&gt;</comment>
                            <comment id="14235753" author="sergey_beryozkin" created="Fri, 5 Dec 2014 17:24:48 +0000"  >&lt;p&gt;np, I&apos;ll experiment with the JAXRS tests and check if the optional blocking of restartAsync does not affect them, if not then I guess we can optionally block a restart&lt;/p&gt;</comment>
                            <comment id="14237277" author="sergey_beryozkin" created="Sun, 7 Dec 2014 21:22:45 +0000"  >&lt;p&gt;Just a quick question: is there a technical reason the servlet filter-level listeners can not be impemented as a CompletionCallback ?&lt;br/&gt;
thanks, Sergey&lt;/p&gt;</comment>
                            <comment id="14237645" author="efouret" created="Mon, 8 Dec 2014 09:07:04 +0000"  >&lt;p&gt;We need to log I/O along with some stats. &lt;tt&gt;CompletionCallback&lt;/tt&gt; doesn&apos;t provide access to the response and &lt;tt&gt;ContainerResponseFilter&lt;/tt&gt; doesn&apos;t allow to retrieve data stored in the &lt;tt&gt;ContainerRequestContext&lt;/tt&gt; (within a &lt;tt&gt;ContainerRequestFilter&lt;/tt&gt;). This is why we resorted to using a servlet filter.&lt;/p&gt;</comment>
                            <comment id="14237710" author="sergey_beryozkin" created="Mon, 8 Dec 2014 10:07:35 +0000"  >&lt;p&gt;Thanks for the clarification. &lt;br/&gt;
ContainerRequestContext has a set/get Property method, and this context is available to the response filters so I think the data should be available - if it does not work in your case then it is a bug - please open a JIRA issue. You can also get HttpServletResponse passed as a context parameter to a JAX-RS service and then to a CompletionCallback instance.&lt;br/&gt;
I&apos;m still open though to the optional blocking of async context restarts&lt;/p&gt;
</comment>
                            <comment id="14237749" author="sergey_beryozkin" created="Mon, 8 Dec 2014 10:48:40 +0000"  >&lt;p&gt;I&apos;ve updated the code to check an &quot;org.apache.cxf.continuation.block.restart&quot; contextual property. This property needs to be used with care, enabling it is in conflict with making a JAX-RS TimeoutHandler perform a new suspend action. It can only make sense if the application is not doing multiple suspend actions (can be JAX-RS or JAX-WS)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>311946</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 50 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1hu0v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>312292</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>