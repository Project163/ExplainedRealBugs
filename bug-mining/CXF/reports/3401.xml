<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:33:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-7983] JweClientResponseFilter fails to decrypt response, when it has status 204 No Content</title>
                <link>https://issues.apache.org/jira/browse/CXF-7983</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;JweClientResponseFilter fails to decrypt response, when it has status 204 No Content&lt;br/&gt;
For my current project I am trying to get familiar with the cxf JOSE framework. Currently I am running into a problem with JWE trying to encrypt request and response with compact serialization. I have a GET request where the response is correctly encrypted and decrypted, and I have a POST request where the response sends status code 204 and the body is obviously empty.&lt;br/&gt;
The response fails with a warning &quot;WARNUNG: 5 JWE parts are expected&quot; and an exception&lt;br/&gt;
org.apache.cxf.rs.security.jose.jwe.JweException: INVALID_COMPACT_JWE&lt;br/&gt;
&#160;&#160; &#160;at org.apache.cxf.rs.security.jose.jwe.JweCompactConsumer.&amp;lt;init&amp;gt;(JweCompactConsumer.java:40)&lt;br/&gt;
&#160;&#160; &#160;at org.apache.cxf.rs.security.jose.jaxrs.AbstractJweDecryptingFilter.decrypt(AbstractJweDecryptingFilter.java:44)&lt;br/&gt;
&#160;&#160; &#160;at org.apache.cxf.rs.security.jose.jaxrs.JweClientResponseFilter.filter(JweClientResponseFilter.java:42)&lt;br/&gt;
...&lt;br/&gt;
Test case and test log with exception are attached.&lt;br/&gt;
I debugged the code a bit and it seems to me the filter method in JweClientResponseFilter fails to identify the body is empty and therefor calls the decrypt method, which it shouldn&apos;t&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I ran the test case using 3.2.4 and 3.3.0, but also other versions will be affected.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13218304">CXF-7983</key>
            <summary>JweClientResponseFilter fails to decrypt response, when it has status 204 No Content</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ashakirin">Andrei Shakirin</assignee>
                                    <reporter username="zbeothy">Zsolt Beothy-Elo</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Feb 2019 10:05:28 +0000</created>
                <updated>Mon, 13 May 2019 18:08:46 +0000</updated>
                            <resolved>Thu, 9 May 2019 08:57:43 +0000</resolved>
                                    <version>3.2.4</version>
                    <version>3.3.0</version>
                                    <fixVersion>3.2.9</fixVersion>
                    <fixVersion>3.3.2</fixVersion>
                                    <component>JAX-RS Security</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16791653" author="coheigea" created="Wed, 13 Mar 2019 12:44:42 +0000"  >&lt;p&gt;Do you need the fix backported for 3.2.x as well?&lt;/p&gt;</comment>
                            <comment id="16791677" author="ashakirin" created="Wed, 13 Mar 2019 13:04:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=coheigea&quot; class=&quot;user-hover&quot; rel=&quot;coheigea&quot;&gt;coheigea&lt;/a&gt;: yep, I will backport to 3.2.x (is not explicitly asked, but makes sense)&lt;/p&gt;</comment>
                            <comment id="16791878" author="zbeothy" created="Wed, 13 Mar 2019 16:51:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=coheigea&quot; class=&quot;user-hover&quot; rel=&quot;coheigea&quot;&gt;coheigea&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashakirin&quot; class=&quot;user-hover&quot; rel=&quot;ashakirin&quot;&gt;ashakirin&lt;/a&gt;: We may subclass the filter and fix it ourselves. Still would be good to have it in 3.2.x. in case we might be able to migrate to the latest 3.2.x version.&lt;/p&gt;</comment>
                            <comment id="16808584" author="zbeothy" created="Wed, 3 Apr 2019 10:24:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=coheigea&quot; class=&quot;user-hover&quot; rel=&quot;coheigea&quot;&gt;coheigea&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashakirin&quot; class=&quot;user-hover&quot; rel=&quot;ashakirin&quot;&gt;ashakirin&lt;/a&gt;: fix works, thx for that.&#160; I saw you only fixed the problem for the JWEClientResponseFilter, but I would assume the same scenario will also cause problems for other filters, e.g. &lt;a href=&quot;https://github.com/apache/cxf/blob/master/rt/rs/security/jose-parent/jose-jaxrs/src/main/java/org/apache/cxf/rs/security/jose/jaxrs/JwsClientResponseFilter.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;JwsClientResponseFilter.java&lt;/a&gt; I think it would make sense to fix all filters where the problem can occur. ShalI create a new Jira for it?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16808621" author="coheigea" created="Wed, 3 Apr 2019 11:30:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zbeothy&quot; class=&quot;user-hover&quot; rel=&quot;zbeothy&quot;&gt;zbeothy&lt;/a&gt; - Yes it makes sense to fix those as well. No need for a new JIRA, I&apos;ll fix it as part of this one.&lt;/p&gt;</comment>
                            <comment id="16808628" author="ashakirin" created="Wed, 3 Apr 2019 11:37:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zbeothy&quot; class=&quot;user-hover&quot; rel=&quot;zbeothy&quot;&gt;zbeothy&lt;/a&gt;: yes, it makes sense&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=coheigea&quot; class=&quot;user-hover&quot; rel=&quot;coheigea&quot;&gt;coheigea&lt;/a&gt;: I can complete it, if you have no objections&lt;/p&gt;</comment>
                            <comment id="16808633" author="coheigea" created="Wed, 3 Apr 2019 11:39:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashakirin&quot; class=&quot;user-hover&quot; rel=&quot;ashakirin&quot;&gt;ashakirin&lt;/a&gt; - Apologies, I&apos;ve already merged it. Please feel free to review and see if I&apos;ve missed anything.&lt;/p&gt;</comment>
                            <comment id="16808683" author="ashakirin" created="Wed, 3 Apr 2019 12:47:21 +0000"  >&lt;p&gt;ok, no problem &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16833786" author="jan4talend" created="Mon, 6 May 2019 12:47:02 +0000"  >&lt;p&gt;Hi Andrei,&lt;/p&gt;

&lt;p&gt;I think this bug is not completely resolved. The status code can be &quot;OK 200&quot; but still no content in the stream. In my case I get an EmptyInputStream inside my HTTP stream which validates all current tests to true so JWE/JWS filter try to parse body but fail because body is still empty (see attached screenshot).&lt;/p&gt;</comment>
                            <comment id="16833925" author="ashakirin" created="Mon, 6 May 2019 15:37:18 +0000"  >&lt;p&gt;Yes, you right. The issue was fixed only &quot;204 No Content&quot; as it states in the issue name.&lt;br/&gt;
Of course empty body is possible for 200 as well.&lt;br/&gt;
I will provide more generic fix ASAP.&lt;/p&gt;</comment>
                            <comment id="16834431" author="ashakirin" created="Tue, 7 May 2019 06:46:23 +0000"  >&lt;p&gt;Hi Jan,&lt;/p&gt;

&lt;p&gt;Could you please try version 3.2.9-SNAPSHOT or 3.3.2-SNAPSHOT? The issue should be fixed now&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12967930" name="EmptyInputStream-screenshot.png" size="120859" author="jan4talend" created="Mon, 6 May 2019 12:44:25 +0000"/>
                            <attachment id="12960333" name="encryption-exception.zip" size="32211" author="zbeothy" created="Wed, 27 Feb 2019 10:04:38 +0000"/>
                            <attachment id="12960332" name="test-output.txt" size="18662" author="zbeothy" created="Wed, 27 Feb 2019 10:04:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 28 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z004rs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>