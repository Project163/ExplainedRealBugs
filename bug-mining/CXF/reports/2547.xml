<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:15:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-6307] Wrong select the message body reader</title>
                <link>https://issues.apache.org/jira/browse/CXF-6307</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;This is a CTS testcase, the resource class is like this:   &lt;br/&gt;
   @POST&lt;br/&gt;
    @Path(&quot;boolean&quot;)&lt;br/&gt;
    public Boolean postBoolean(Boolean bool) {&lt;br/&gt;
    	if(bool)&lt;/p&gt;
{    		 
    		throw new WebApplicationException(Status.NOT_ACCEPTABLE);
    	}
&lt;p&gt;        return false;&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;The application provided provider is like this:&lt;/p&gt;

&lt;p&gt;public class MyReader implements MessageBodyReader&amp;lt;Boolean&amp;gt; {&lt;/p&gt;

&lt;p&gt;    @Override&lt;br/&gt;
    public boolean isReadable(Class&amp;lt;?&amp;gt; type, Type type1, Annotation[] antns, MediaType mt) &lt;/p&gt;
{
    	return type== Boolean.class;
    }

&lt;p&gt;    @Override&lt;br/&gt;
    public Object readFrom(Class&amp;lt;Object &amp;gt; type,&lt;br/&gt;
                             Type type1,&lt;br/&gt;
                             Annotation[] antns,&lt;br/&gt;
                             MediaType mt, MultivaluedMap&amp;lt;String, String&amp;gt; mm,&lt;br/&gt;
                             InputStream in) throws IOException, WebApplicationException &lt;/p&gt;
{
		return Boolean.valueOf(&quot;true&quot;);        
    }
&lt;p&gt;}&lt;/p&gt;

&lt;p&gt;The request&lt;br/&gt;
Content-Type:text/plain&lt;br/&gt;
Accept:text/plain &lt;br/&gt;
Method:POST&lt;br/&gt;
Body:false&lt;/p&gt;

&lt;p&gt;According to jsr339 section 4.2.4 Standard Entity Providers java.lang.Boolean, java.lang.Character, java.lang.Number Only for text/plain. Corresponding primitive types supported via boxing/unboxing conversion.&lt;/p&gt;

&lt;p&gt;An implementation MUST support application-provided entity providers and MUST use those in preference to its own pre-packaged providers when either could handle the same request. More precisely, step 4 in Section 4.2.1 and step 5 in Section 4.2.2 MUST prefer application-provided over pre-packaged entity providers.&lt;/p&gt;

&lt;p&gt;4.2.1 Message Body Reader&lt;br/&gt;
3. Select the set of MessageBodyReader classes that support the media type of the request, see Section&lt;br/&gt;
4.2.3.&lt;br/&gt;
4. Iterate through the selected MessageBodyReader classes and, utilizing the isReadable method of&lt;br/&gt;
each, choose a MessageBodyReader provider that supports the desired Java type.&lt;/p&gt;

&lt;p&gt;It says the entity providers should be sorted by media type firstly then(the media type is the same) on Section 4.2.1 and step 5 in Section 4.2.2 MUST prefer application-provided over pre-packaged entity providers. So org.apache.cxf.jaxrs.provider.PrimitiveTextProvider should be selected as its media type MUST be text/plain and the application provider&apos;s media type is &lt;b&gt;/&lt;/b&gt;.(x/y&amp;gt;x/&lt;b&gt;&amp;gt;&lt;/b&gt;/*)&lt;/p&gt;

&lt;p&gt;So at this point the CTS expected response code is 200 instead of 406, the application provided provider should not be chosen.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows&lt;/p&gt;</environment>
        <key id="12783533">CXF-6307</key>
            <summary>Wrong select the message body reader</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sergey_beryozkin">Sergey Beryozkin</assignee>
                                    <reporter username="nbqyqx@163.com">Neal Hu</reporter>
                        <labels>
                    </labels>
                <created>Fri, 20 Mar 2015 08:43:56 +0000</created>
                <updated>Fri, 14 Oct 2016 14:28:12 +0000</updated>
                            <resolved>Tue, 9 Jun 2015 13:42:53 +0000</resolved>
                                    <version>3.0.3</version>
                                    <fixVersion>3.0.6</fixVersion>
                    <fixVersion>3.1.2</fixVersion>
                                    <component>JAX-RS</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14381583" author="xingjhu@cn.ibm.com" created="Thu, 26 Mar 2015 08:47:19 +0000"  >&lt;p&gt;Any update on this?&lt;/p&gt;</comment>
                            <comment id="14381753" author="sergey_beryozkin" created="Thu, 26 Mar 2015 11:37:50 +0000"  >&lt;p&gt;I think it is pretty confusing, the lack of the explicit text/plain does not mean the provider does not support text/plain.&lt;br/&gt;
Overall your analysis is probably correct; some clarity is needed re the spec text which says the application provider providers are preferred, in this simple case, if we start sorting with media types, the default provider (should it have text/plain) would be chosen first but it is clearly losing to the custom provider because the latter is typed on Boolean, the former - on Object.&lt;/p&gt;

&lt;p&gt;Here is a relevant text from selecting MessageBodyWriters:&lt;/p&gt;

&lt;p&gt;&quot;Sort the selected MessageBodyWriter providers with a primary key of generic type where providers&lt;br/&gt;
whose generic type is the nearest superclass of the object class are sorted first and a secondary key of&lt;br/&gt;
media type (see Section 4.2.3).&quot;&lt;/p&gt;

&lt;p&gt;So if it were a writer case, the custom provider would obviously win.&lt;br/&gt;
I wonder why the reader selection process does not mention the generic types, can it be a spec bug ?&lt;/p&gt;

&lt;p&gt;I&apos;ll clarify and please investigate on your end too&lt;/p&gt;</comment>
                            <comment id="14383520" author="xingjhu@cn.ibm.com" created="Fri, 27 Mar 2015 08:37:12 +0000"  >&lt;p&gt;Sorry, I have shorted the case. The original one is typed on Object too:&lt;br/&gt;
@Override&lt;br/&gt;
public Object readFrom(Class&amp;lt;Boolean&amp;gt; type,&lt;br/&gt;
Type type1,&lt;br/&gt;
Annotation[] antns,&lt;br/&gt;
MediaType mt, MultivaluedMap&amp;lt;String, String&amp;gt; mm,&lt;br/&gt;
InputStream in) throws IOException, WebApplicationException&lt;/p&gt;
{ return Boolean.valueOf(&quot;true&quot;);// the original case will invoke one method and return the Boolean type here }
&lt;p&gt;}&lt;/p&gt;

&lt;p&gt;The key point here is the spec mentioned the pre-packaged provided provider ONLY support text/plain, and the application&apos;s provider supports &amp;#42;/&amp;#42;. So the  pre-packaged  MUST be chosen. I went through the CXF code and found the provider lack of text/plain. What&apos;s more CXF matchs Application provided providers first(in this case the text/plain matches &amp;#42;/&amp;#42; and skip to match the  pre-packaged providered, even when explicit text/plain on  pre-packaged).&lt;/p&gt;

&lt;p&gt;If my understanding is incorrect please advise. Thanks.&lt;/p&gt;</comment>
                            <comment id="14388699" author="xingjhu@cn.ibm.com" created="Tue, 31 Mar 2015 15:22:30 +0000"  >&lt;p&gt;Any comment or question?&lt;/p&gt;</comment>
                            <comment id="14390348" author="sergey_beryozkin" created="Wed, 1 Apr 2015 10:24:01 +0000"  >&lt;p&gt;It is typed on Boolean, you have a Boolean class parameter in the signature - meaning you have a generic Boolean type.&lt;br/&gt;
I&apos;ve also mentioned that one does not have to provide explicit Consumes(text/plain) in the default provider for the spec requirement to be met, this is an implementation detail, a provider may have a check done in isReadable for example (CXF does not actually restrict it to text/plain only for Boolean - needs to be tuned too).&lt;/p&gt;

&lt;p&gt;I&apos;m still investigating...&lt;/p&gt;




</comment>
                            <comment id="14390849" author="sergey_beryozkin" created="Wed, 1 Apr 2015 15:49:06 +0000"  >&lt;p&gt;FYI, I&apos;ve updated a primitive provider not to support Boolean/Number/Character if it is not text/plain. Check the source, it is done inside of isReadable.&lt;/p&gt;

&lt;p&gt;Right now this provider also supports String which is not very clean, but it is marginally more optimal for the runtime (one less provider to deal with). A dedicated string based provider can be introduced but even in the current form one can add Consumes(&quot;text/plain, *&quot;) would work but as I said the current approach where the provider checks it internally is also valid.&lt;/p&gt;

&lt;p&gt;I think this test case has been written with the assumption that a relevant RI provider is directly typed with Consumes(text/plain). But it is absolutely not a spec requirement that the Boolean/etc + text/plain requirement must be implemented this way, as I said it is an implementation detail.&lt;/p&gt;

&lt;p&gt;CXF ProviderFactory has been implemented, as you&apos;ve seen, to delegate to the default factory if the the custom factory has no matching providers. Getting a default (primtive) provider to have explicit Consumes and mixing both default and custom providers would be a very sensitive operation, unlikely to be done for 3.0.5. Given that the provider does not have to have an explicit Consumes there may be no need to do it at all. &lt;/p&gt;

&lt;p&gt;I&apos;m still investigating and might recommend you to prepare a challenge, lets see.&lt;/p&gt;



</comment>
                            <comment id="14392250" author="xingjhu@cn.ibm.com" created="Thu, 2 Apr 2015 06:58:43 +0000"  >&lt;p&gt;Correct the signature to&lt;br/&gt;
public Object readFrom(Class&amp;lt;Object &amp;gt; type,&lt;br/&gt;
Type type1,&lt;br/&gt;
Annotation[] antns,&lt;br/&gt;
MediaType mt, MultivaluedMap&amp;lt;String, String&amp;gt; mm,&lt;br/&gt;
InputStream in) throws IOException, WebApplicationException&lt;/p&gt;

&lt;p&gt;I guess that add media type checking in the isReadable will not impact the result of Reader sorting(depends on @Consume), right?&lt;/p&gt;

&lt;p&gt;According to the spec, we may need mix the default and custom providers and sort. If they all match the Java type and media type is the same then choose custom provider. Any comment please let me know.&lt;/p&gt;</comment>
                            <comment id="14392579" author="sergey_beryozkin" created="Thu, 2 Apr 2015 11:13:28 +0000"  >&lt;p&gt;Spec does not require providers to use Consumes in order for these providers support a given media type.&lt;/p&gt;</comment>
                            <comment id="14394579" author="sergey_beryozkin" created="Fri, 3 Apr 2015 15:38:21 +0000"  >&lt;p&gt;Just a short summary based on the analysis/conversations I&apos;ve done so far.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;MBR can depend on the declarative Consumes support or do the checks dynamically in its isReadable. Both options are valid/compliant. Either option can be used independently or both options can be combined.&lt;/li&gt;
	&lt;li&gt;MBR can provide a valid implementation of &quot;Boolean/etc for text/plain only&quot; by using either declarative Consumes or dynamic checks. Spec can not/does not enforce which approach is used to implement a given requirement&lt;/li&gt;
	&lt;li&gt;This test is technically valid&lt;/li&gt;
	&lt;li&gt;This test should not be at the CTS level but at a concrete JAX-RS implementation level (example, at RI level) because it was written with the assumption that a default MBR uses a declarative approach as opposed to a dynamic check approach.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Base on the above, but also on the fact that having all of CXF default providers (many of them with wildcard Consumes as per the spec) will slowdown a selection process but also be a very sensitive operation in the short term, my recommendation is to challenge this test.&lt;/p&gt;

&lt;p&gt;I&apos;m not opposed in principle to refactoring ProviderFactory and hence I will keep this issue open and will review how this can be addressed. But given that we have major releases coming in now, and also because it is very important that a validity of MBRs doing the dynamic checks is enforced, IMHO the faster solution to getting behind this test is to challenge it&lt;/p&gt;

&lt;p&gt;Cheers, Sergey  &lt;/p&gt;



</comment>
                            <comment id="14394592" author="sergey_beryozkin" created="Fri, 3 Apr 2015 15:45:22 +0000"  >&lt;p&gt;Either way, thanks for the help with trying to get CXF more compliant - I&apos;m sure we will get it to the top compliance level eventually &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;
</comment>
                            <comment id="14502184" author="xingjhu@cn.ibm.com" created="Mon, 20 Apr 2015 00:23:41 +0000"  >&lt;p&gt;Hi Sergey,&lt;/p&gt;

&lt;p&gt;We have fixed the problem of wrong select the message body reader/writer&lt;br/&gt;
and passed the TCK test. Paste the reader example here and the new class&lt;br/&gt;
for your referrence. &lt;/p&gt;


&lt;p&gt;org.apache.cxf.jaxrs.provider.ProviderFactory.createMessageBodyReader&lt;br/&gt;
	...&lt;br/&gt;
	ProviderInfo&amp;lt;MessageBodyReader&amp;lt;?&amp;gt;&amp;gt; mr =&lt;br/&gt;
(ProviderInfo&amp;lt;MessageBodyReader&amp;lt;?&amp;gt;&amp;gt;) chooseMessageReader(bodyType,&lt;br/&gt;
parameterType, parameterAnnotations, mediaType, m);&lt;br/&gt;
        ProviderInfo&amp;lt;MessageBodyReader&amp;lt;?&amp;gt;&amp;gt; baseMr =&lt;br/&gt;
(ProviderInfo&amp;lt;MessageBodyReader&amp;lt;?&amp;gt;&amp;gt;) baseFactory.chooseMessageReader&lt;br/&gt;
(bodyType,  parameterType, parameterAnnotations, mediaType, m);&lt;br/&gt;
        if (mr != null &amp;amp;&amp;amp; baseMr != null) &lt;/p&gt;
{
            MessageBodyReaderComparator comparator = new
MessageBodyReaderComparator();
            int res = comparator.compare(mr, baseMr);
            candidateProviderInfos.add(res &amp;gt; 0 ? baseMr : mr);
        }
&lt;p&gt; else if (mr != null) &lt;/p&gt;
{ candidateProviderInfos.add(mr);
        }
&lt;p&gt; else if (baseMr != null) &lt;/p&gt;
{ candidateProviderInfos.add(baseMr);  }
&lt;p&gt;...&lt;br/&gt;
 return (MessageBodyReader&amp;lt;T&amp;gt;) candidateProviderInfos.get(0).getProvider();&lt;br/&gt;
---------&lt;br/&gt;
    private &amp;lt;T&amp;gt; ProviderInfo&amp;lt;?&amp;gt; chooseMessageReader(Class&amp;lt;T&amp;gt; type,&lt;br/&gt;
                                                    Type genericType,&lt;br/&gt;
                                                    Annotation[] annotations,&lt;br/&gt;
                                                    MediaType mediaType,&lt;br/&gt;
                                                    Message m,&lt;br/&gt;
                                                    List&amp;lt;ProviderInfo&amp;lt;?&amp;gt;&amp;gt; candidateProviderInfos) {&lt;/p&gt;

&lt;p&gt;        List&amp;lt;MessageBodyReader&amp;lt;?&amp;gt;&amp;gt; candidates = new LinkedList&amp;lt;MessageBodyReader&amp;lt;?&amp;gt;&amp;gt;();&lt;br/&gt;
        ProviderInfo&amp;lt;?&amp;gt; pi = null;&lt;br/&gt;
        for (ProviderInfo&amp;lt;MessageBodyReader&amp;lt;?&amp;gt;&amp;gt; ep : messageReaders) {&lt;br/&gt;
            if (matchesReaderCriterias(ep, type, genericType, annotations, mediaType, m)) {&lt;/p&gt;

&lt;p&gt;                candidateProviderInfos.add(ep);&lt;br/&gt;
                boolean isReadable = ep.getProvider().isReadable(type, genericType, annotations, mediaType);&lt;/p&gt;

&lt;p&gt;                if (isBaseFactory()) {&lt;br/&gt;
                    if (candidates.isEmpty() &amp;amp;&amp;amp; isReadable) &lt;/p&gt;
{
                        pi = ep;
                        candidates.add(ep.getProvider());
                    }
&lt;p&gt;                    continue;&lt;br/&gt;
                }&lt;br/&gt;
                if (isReadable &amp;amp;&amp;amp; candidates.isEmpty()) &lt;/p&gt;
{
                    handleMapper(candidates, ep, type, m, MessageBodyReader.class, false);
                    if (!candidates.isEmpty())
                        pi = ep;
                }

&lt;p&gt;            }&lt;br/&gt;
        }&lt;/p&gt;

&lt;p&gt;        return pi;&lt;/p&gt;

&lt;p&gt;    }&lt;/p&gt;

&lt;p&gt;    private &amp;lt;T&amp;gt; boolean matchesReaderCriterias(ProviderInfo&amp;lt;MessageBodyReader&amp;lt;?&amp;gt;&amp;gt; pi,&lt;br/&gt;
                                               Class&amp;lt;T&amp;gt; type,&lt;br/&gt;
                                               Type genericType,&lt;br/&gt;
                                               Annotation[] annotations,&lt;br/&gt;
                                               MediaType mediaType,&lt;br/&gt;
                                               Message m) {&lt;br/&gt;
        MessageBodyReader&amp;lt;?&amp;gt; ep = pi.getProvider();&lt;br/&gt;
        List&amp;lt;MediaType&amp;gt; supportedMediaTypes = JAXRSUtils.getProviderConsumeTypes(ep);&lt;/p&gt;

&lt;p&gt;        List&amp;lt;MediaType&amp;gt; availableMimeTypes =&lt;br/&gt;
                        JAXRSUtils.intersectMimeTypes(Collections.singletonList(mediaType), supportedMediaTypes, false);&lt;/p&gt;

&lt;p&gt;        if (availableMimeTypes.size() == 0) &lt;/p&gt;
{
            return false;
        }
&lt;p&gt;        if (m.get(ACTIVE_JAXRS_PROVIDER_KEY) != ep || pi.getProvider() != null) &lt;/p&gt;
{
            injectContextValues(pi, m);
        }
&lt;p&gt;        return true;&lt;br/&gt;
    }&lt;br/&gt;
---------------&lt;br/&gt;
org.apache.cxf.jaxrs.provider.PrimitiveTextProvider&lt;br/&gt;
@Produces(MediaType.TEXT_PLAIN)&lt;br/&gt;
@Consumes(MediaType.TEXT_PLAIN)&lt;br/&gt;
public class PrimitiveTextProvider&amp;lt;T&amp;gt; extends AbstractConfigurableProvider&lt;br/&gt;
implements MessageBodyReader&amp;lt;T&amp;gt;, MessageBodyWriter&amp;lt;T&amp;gt; {&lt;br/&gt;
...&lt;br/&gt;
}&lt;br/&gt;
 add org.apache.cxf.jaxrs.provider.StringProvider -  Only for none&lt;br/&gt;
text/plain String&lt;br/&gt;
 public class StringProvider&amp;lt;T&amp;gt; implements MessageBodyReader&amp;lt;T&amp;gt;,&lt;br/&gt;
MessageBodyWriter&amp;lt;T&amp;gt; {&lt;br/&gt;
    private static boolean isSupported(Class&amp;lt;?&amp;gt; type) &lt;/p&gt;
{
        return String.class == type;
    }
&lt;p&gt;    @Override&lt;br/&gt;
    public boolean isReadable(Class&amp;lt;?&amp;gt; type, Type genericType, Annotation[]&lt;br/&gt;
annotations, MediaType mt) &lt;/p&gt;
{
        return isSupported(type);
    }
&lt;p&gt;...&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;Best Regards,&lt;/p&gt;

&lt;p&gt;From:	&quot;Sergey Beryozkin (JIRA)&quot; &amp;lt;jira@apache.org&amp;gt;&lt;br/&gt;
Date:	2015/04/03 23:39&lt;br/&gt;
Subject:	&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;Comment Edited&amp;#93;&lt;/span&gt; (&lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-6307&quot; title=&quot;Wrong select the message body reader&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-6307&quot;&gt;&lt;del&gt;CXF-6307&lt;/del&gt;&lt;/a&gt;) Wrong select the message&lt;br/&gt;
            body reader&lt;/p&gt;




&lt;p&gt;    [&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-6307?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel&amp;amp;focusedCommentId=14394579#comment-14394579&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CXF-6307?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel&amp;amp;focusedCommentId=14394579#comment-14394579&lt;/a&gt;&lt;br/&gt;
 ]&lt;/p&gt;

&lt;p&gt;Sergey Beryozkin edited comment on &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-6307&quot; title=&quot;Wrong select the message body reader&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-6307&quot;&gt;&lt;del&gt;CXF-6307&lt;/del&gt;&lt;/a&gt; at 4/3/15 3:38 PM:&lt;br/&gt;
---------------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Just a short summary based on the analysis/conversations I&apos;ve done so far.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;MBR can depend on the declarative Consumes support or do the checks&lt;br/&gt;
dynamically in its isReadable. Both options are valid/compliant. Either&lt;br/&gt;
option can be used independently or both options can be combined.&lt;/li&gt;
	&lt;li&gt;MBR can provide a valid implementation of &quot;Boolean/etc for text/plain&lt;br/&gt;
only&quot; by using either declarative Consumes or dynamic checks. Spec can&lt;br/&gt;
not/does not enforce which approach is used to implement a given&lt;br/&gt;
requirement&lt;/li&gt;
	&lt;li&gt;This test is technically valid&lt;/li&gt;
	&lt;li&gt;This test should not be at the CTS level but at a concrete JAX-RS&lt;br/&gt;
implementation level (example, at RI level) because it was written with the&lt;br/&gt;
assumption that a default MBR uses a declarative approach as opposed to a&lt;br/&gt;
dynamic check approach.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Base on the above, but also on the fact that having all of CXF default&lt;br/&gt;
providers (many of them with wildcard Consumes as per the spec) will&lt;br/&gt;
slowdown a selection process but also be a very sensitive operation in the&lt;br/&gt;
short term, my recommendation is to challenge this test.&lt;/p&gt;

&lt;p&gt;I&apos;m not opposed in principle to refactoring ProviderFactory and hence I&lt;br/&gt;
will keep this issue open and will review how this can be addressed. But&lt;br/&gt;
given that we have major releases coming in now, and also because it is&lt;br/&gt;
very important that a validity of MBRs doing the dynamic checks is&lt;br/&gt;
enforced, IMHO the faster solution to getting behind this test is to&lt;br/&gt;
challenge it&lt;/p&gt;

&lt;p&gt;Cheers, Sergey&lt;/p&gt;







&lt;p&gt;was (Author: sergey_beryozkin):&lt;br/&gt;
Just a short summary based on the anslysis/conversations I&apos;ve done so far.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;MBR can depend on the declarative Consumes support or do the checks&lt;br/&gt;
dynamically in its isReadable. Both options are valid/compliant. Either&lt;br/&gt;
option can be used independently or both options can be combined.&lt;/li&gt;
	&lt;li&gt;MBR can provide a valid implementation of &quot;Boolean/etc for text/plain&lt;br/&gt;
only&quot; by using either declarative Consumes or dynamic checks. Spec can&lt;br/&gt;
not/does not enforce which approach is used to implement a given&lt;br/&gt;
requirement&lt;/li&gt;
	&lt;li&gt;This test is technically valid&lt;/li&gt;
	&lt;li&gt;This test should not be at the CTS level but at a concrete JAX-RS&lt;br/&gt;
implementation level (example, at RI level) because it was written with the&lt;br/&gt;
assumption that a default MBR uses a declarative approach as opposed to a&lt;br/&gt;
dynamic check approach.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Base on the above, but also on the fact that having all of CXF default&lt;br/&gt;
providers (many of them with wildcard Consumes as per the spec) will&lt;br/&gt;
slowdown a selection process but also be a very sensitive operation in the&lt;br/&gt;
short term, my recommendation is to challenge this test.&lt;/p&gt;

&lt;p&gt;I&apos;m not opposed in principle to refactoring ProviderFactory and hence I&lt;br/&gt;
will keep this issue open and will review how this can be addressed. But&lt;br/&gt;
given that we have major releases coming in now, and also because it is&lt;br/&gt;
very important that a validity of MBRs doing the dynamic checks is&lt;br/&gt;
enforced, IMHO the faster solution to getting behind this test is to&lt;br/&gt;
challenge it&lt;/p&gt;

&lt;p&gt;Cheers, Sergey&lt;/p&gt;






&lt;p&gt;(Status.NOT_ACCEPTABLE);&lt;br/&gt;
antns, MediaType mt) {&lt;br/&gt;
mm,&lt;br/&gt;
WebApplicationException {&lt;br/&gt;
java.lang.Boolean, java.lang.Character, java.lang.Number Only for&lt;br/&gt;
text/plain. Corresponding primitive types supported via boxing/unboxing&lt;br/&gt;
conversion.&lt;br/&gt;
MUST use those in preference to its own pre-packaged providers when either&lt;br/&gt;
could handle the same request. More precisely, step 4 in Section 4.2.1 and&lt;br/&gt;
step 5 in Section 4.2.2 MUST prefer application-provided over pre-packaged&lt;br/&gt;
entity providers.&lt;br/&gt;
type of the request, see Section&lt;br/&gt;
the isReadable method of&lt;br/&gt;
type.&lt;br/&gt;
(the media type is the same) on Section 4.2.1 and step 5 in Section 4.2.2&lt;br/&gt;
MUST prefer application-provided over pre-packaged entity providers. So&lt;br/&gt;
org.apache.cxf.jaxrs.provider.PrimitiveTextProvider should be selected as&lt;br/&gt;
its media type MUST be text/plain and the application provider&apos;s media type&lt;br/&gt;
is &lt;b&gt;/&lt;/b&gt;.(x/y&amp;gt;x/&lt;b&gt;&amp;gt;&lt;/b&gt;/*)&lt;br/&gt;
the application provided provider should not be chosen.&lt;/p&gt;



&lt;p&gt;&amp;#8211;&lt;br/&gt;
This message was sent by Atlassian JIRA&lt;br/&gt;
(v6.3.4#6332)&lt;/p&gt;
</comment>
                            <comment id="14502731" author="sergey_beryozkin" created="Mon, 20 Apr 2015 12:47:39 +0000"  >&lt;p&gt;Thank you for this effort. &lt;br/&gt;
I&apos;ve commented earlier (see my previous comment) and explained why IMHO this test needs to be challenged.&lt;br/&gt;
Please follow that procedure first (send a request to an Oracle test lead to challenge this test based on my comments). Copy and paste the text from&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-6307?focusedCommentId=14394579&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14394579&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CXF-6307?focusedCommentId=14394579&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14394579&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I will do the refactoring if the challenge fails - it is not a matter of principle for me. But I think that it is important to assert that a runtime should be able  to control the internals of its implementation. Once again: the spec does not require that a default provider uses a &lt;b&gt;static&lt;/b&gt; Consumes and hence using a dynamic selection (in its isReadable) should also be possible. &lt;/p&gt;

&lt;p&gt;Please work on a challenge and I&apos;ll do the work on it if the challenge fails&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="14502853" author="nbqyqx@163.com" created="Mon, 20 Apr 2015 13:48:27 +0000"  >&lt;p&gt;Yes, I understand the spec doesnot suppose the implementation MUST use @Consumes instead of isReadable. I will try to challenge the test case. But the current behavior of CXF provider sorting is wrong. If matches in application provided provider stops to find the closer in pre-packaged provider list.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="14502876" author="sergey_beryozkin" created="Mon, 20 Apr 2015 14:01:30 +0000"  >&lt;p&gt;If we talk about message body writers - the custom matching providers always selected in preference to the default ones, media types are checked next.&lt;br/&gt;
It is a bit unfortunate the sorting is different for readers (media types first, the custom vs pre-packaged next).&lt;br/&gt;
However if we take the static vs dynamic media type consideration into account, the actual CXF implementation is actually more optimized.&lt;/p&gt;

&lt;p&gt;But as I&apos;ve said - we will get this issue resolved properly and your effort is appreciated. Please give it a try with a challenge. Once we know what the challenge result is we will discuss what to do next. If the challenge fails: I will obviously refactor and take your code as an input. If the challenge gets accepted: we will discuss if we want to do the refactoring at all...&lt;/p&gt;

&lt;p&gt;Thanks again !&lt;/p&gt;
</comment>
                            <comment id="14504100" author="nbqyqx@163.com" created="Tue, 21 Apr 2015 01:14:42 +0000"  >&lt;p&gt;4.2.3 Declaring Media Type Capabilities&lt;br/&gt;
Message body readers and writers MAY restrict the media types they support using the @Consumes and&lt;br/&gt;
@Produces annotations respectively. The absence of these annotations is equivalent to their inclusion with&lt;br/&gt;
media type (&#8220;&lt;b&gt;/&lt;/b&gt;&#8221;), i.e. absence implies that any media type is supported. An implementation MUST NOT&lt;br/&gt;
use an entity provider for a media type that is not supported by that provider.&lt;/p&gt;</comment>
                            <comment id="14504644" author="sergey_beryozkin" created="Tue, 21 Apr 2015 08:59:33 +0000"  >&lt;p&gt;That is fine, the current text provider uses a static default wildcard but it restricts the actual support to text/plain only for Boolean/etc, i.e the runtime does not use it support the conversion of text/bar to Boolean/etc, only text/plain to Boolean/etc. No conflict there.&lt;/p&gt;</comment>
                            <comment id="14521534" author="sergey_beryozkin" created="Thu, 30 Apr 2015 14:07:48 +0000"  >&lt;p&gt;Unfortunately, another issue is related, &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-6380&quot; title=&quot;Context provider not working&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-6380&quot;&gt;&lt;del&gt;CXF-6380&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14527303" author="sergey_beryozkin" created="Mon, 4 May 2015 21:09:08 +0000"  >&lt;p&gt;I&apos;ll try and get it fixed for 3.1.1/3.0.6&lt;/p&gt;</comment>
                            <comment id="14550408" author="irisding" created="Tue, 19 May 2015 13:14:29 +0000"  >&lt;p&gt;Sergey,&lt;/p&gt;

&lt;p&gt;We have this issue fixed in our side. We want to share our fix with you and get your comments. I will post the fix tomorrow. &lt;/p&gt;

&lt;p&gt;Thanks &amp;amp; Best Regards,&lt;/p&gt;

&lt;p&gt;Iris Ding&lt;/p&gt;</comment>
                            <comment id="14558282" author="irisding" created="Mon, 25 May 2015 14:17:17 +0000"  >&lt;p&gt;Hi Sergey,&lt;/p&gt;

&lt;p&gt;Sorry for the late. I have attached the fix for this problem. The basic idea is to sort the base provider and application provided provider separately and get candidate from each of them. Then compare the two candidates and get the final selected one.&lt;/p&gt;

&lt;p&gt;Please review, all change are in ProviderFactory.java.&lt;/p&gt;

&lt;p&gt;Thanks &amp;amp; Best Regards,&lt;/p&gt;

&lt;p&gt;Iris Ding&lt;/p&gt;</comment>
                            <comment id="14568965" author="sergey_beryozkin" created="Tue, 2 Jun 2015 11:24:38 +0000"  >&lt;p&gt;Hi, I&apos;ve been wondering if the whole concept of the parent ProviderFactory needs to be revisited, need to think about it, &lt;br/&gt;
cheers, Sergey&lt;/p&gt;</comment>
                            <comment id="14570578" author="sergey_beryozkin" created="Wed, 3 Jun 2015 10:05:43 +0000"  >&lt;p&gt;Both issues are resolved in my local snapshot now; however I&apos;ll postpone the merge until after the forthcoming release due to the fact the changes are very sensitive&lt;/p&gt;</comment>
                            <comment id="14578893" author="sergey_beryozkin" created="Tue, 9 Jun 2015 13:43:09 +0000"  >&lt;p&gt;See &lt;a href=&quot;http://git-wip-us.apache.org/repos/asf/cxf/commit/7fa6a4b5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://git-wip-us.apache.org/repos/asf/cxf/commit/7fa6a4b5&lt;/a&gt;&lt;br/&gt;
thanks&lt;/p&gt;</comment>
                            <comment id="15241128" author="xingjhu@cn.ibm.com" created="Thu, 14 Apr 2016 13:17:02 +0000"  >&lt;p&gt;Sergey, would you please migrate this jira from id xingjhu@cn.ibm.com to nbqyqx@163.com.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12826185">CXF-6380</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12834167">CXF-6429</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12735168" name="ProviderFactory.java" size="57230" author="irisding" created="Mon, 25 May 2015 14:14:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 31 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2712f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>