<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:38:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-2345] Returning AOP/CGLIB proxy as Subresource throws Fault &quot;object is not an instance of declaring class&quot;</title>
                <link>https://issues.apache.org/jira/browse/CXF-2345</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;Test case:&lt;/p&gt;

&lt;p&gt;RootResource.java :&lt;/p&gt;

&lt;p&gt;public class RootResource &lt;/p&gt;
{

  @Path(&quot;subresource&quot;)
  public abstract SubResource getSubResource();

}

&lt;p&gt;In spring-beans.xml:&lt;/p&gt;

&lt;p&gt;&amp;lt;bean class=&quot;RootResource&quot;&amp;gt;&lt;br/&gt;
  &amp;lt;lookup-method name=&quot;getSubResource&quot; bean=&quot;subResource&quot; /&amp;gt;&lt;br/&gt;
&amp;lt;/bean&amp;gt;&lt;br/&gt;
&amp;lt;bean id=&quot;subResource&quot; class=&quot;SubResource&quot; /&amp;gt;&lt;/p&gt;

&lt;p&gt;Then the AOP proxied SubResource:&lt;/p&gt;

&lt;p&gt;@RolesAllowed(&lt;/p&gt;
{&quot;ROLE_USER&quot;}
&lt;p&gt;) // activate Spring Security global method annotations&lt;br/&gt;
public class SubResource {&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;Getting the /subresource will throw exception:&lt;/p&gt;

&lt;p&gt;org.apache.cxf.interceptor.Fault: object is not an instance of declaring class while invoking&lt;/p&gt;

&lt;p&gt;Tried this workaround but not working: Make SubResource implement an interface then on RootResource.getSubResource() use interface as the return type, not the class&lt;/p&gt;</description>
                <environment></environment>
        <key id="12430733">CXF-2345</key>
            <summary>Returning AOP/CGLIB proxy as Subresource throws Fault &quot;object is not an instance of declaring class&quot;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sergey_beryozkin">Sergey Beryozkin</assignee>
                                    <reporter username="ceefour">Hendy Irawan</reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 Jul 2009 01:17:11 +0000</created>
                <updated>Mon, 3 Aug 2009 20:07:01 +0000</updated>
                            <resolved>Fri, 17 Jul 2009 11:23:54 +0000</resolved>
                                    <version>2.2.2</version>
                                    <fixVersion>2.2.3</fixVersion>
                    <fixVersion>2.3</fixVersion>
                                    <component>JAX-RS</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12732292" author="ceefour" created="Fri, 17 Jul 2009 01:20:01 +0000"  >&lt;p&gt;Bug &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-1494&quot; title=&quot;Issue Using JAX-RS / REST When AOP Proxy In Place&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-1494&quot;&gt;&lt;del&gt;CXF-1494&lt;/del&gt;&lt;/a&gt; is similar to this one, it was a more general issue that did not fix the particular issue of &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-2345&quot; title=&quot;Returning AOP/CGLIB proxy as Subresource throws Fault &amp;quot;object is not an instance of declaring class&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-2345&quot;&gt;&lt;del&gt;CXF-2345&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;PS: Wow, this bug number is &quot;beautiful&quot; .. 2345 &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12732471" author="sergey_beryozkin" created="Fri, 17 Jul 2009 11:19:10 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;turns out it&apos;s a bug in SpringAopClassHelper which actually prevents the subresource locator method &quot;getSubResources&quot; from being invoked. &amp;lt;lookupMethod/&amp;gt; causes a double Cglib proxy being created, with the top one being recognized as AopProxy and the next one being not. So the fix will go in now.&lt;/p&gt;

&lt;p&gt;In meantine you may want to try :&lt;/p&gt;

&lt;p&gt;1. ensure &apos;getSubResources&apos; is actually an interface method so your resource class just implements it&lt;br/&gt;
2. given that in your case you just want to apply global permissions, you might want just to add @RolesAllowed on the subresource method itself&lt;/p&gt;

&lt;p&gt;thanks for stressing CXF JAX-RS so well...&lt;/p&gt;</comment>
                            <comment id="12732585" author="ceefour" created="Fri, 17 Jul 2009 16:02:51 +0000"  >&lt;p&gt;Thank you so much Sergey for the confirmed fix.&lt;/p&gt;

&lt;p&gt;I&apos;ll try if the following workaround will work for now:&lt;/p&gt;

&lt;p&gt;public SubResource getSub() {&lt;br/&gt;
  return (SubResource)appCtx.getBean(&quot;subResource&quot;);&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;Since it&apos;s on topic, I&apos;d like to ask:&lt;br/&gt;
1. what&apos;s the CXF recommended best practice of subresource with Spring+CXF? Java new with manual setters; Spring AOP lookup-method, Spring appCtx.getBean(), or Spring AOP with @Configurable ? or another technique?&lt;br/&gt;
2. what&apos;s really the difference between  @RolesAllowed in JAX-RS class and in JAX-RS method? Isn&apos;t annotating the class means the whole resource is &quot;secured&quot;? (i.e. I don&apos;t see a point in annotating all methods of a class with the same annotation)&lt;/p&gt;</comment>
                            <comment id="12732610" author="sergey_beryozkin" created="Fri, 17 Jul 2009 16:59:14 +0000"  >&lt;p&gt;Hi&lt;/p&gt;

&lt;p&gt;You probably don&apos;t need to deal with the application context.&lt;br/&gt;
With the fix being in (you can try 2.2.3-snapshot may be on Monday or tomorrow) you won&apos;t need to change anything at all.&lt;/p&gt;

&lt;p&gt;Without the fix, you can do :&lt;/p&gt;

&lt;p&gt;1. interface ResourceInterface &lt;/p&gt;
{
         SubResource getSubResource();
    }

&lt;p&gt;   public ResourceImpl implements ResourceInterface {&lt;br/&gt;
   }&lt;/p&gt;

&lt;p&gt;and it will work, I&apos;ve confirmed it in the Spring security system test. In this case you can still have @RolesAllowed on SubResource  &lt;/p&gt;

&lt;p&gt;2. public ResourceImpl {&lt;/p&gt;

&lt;p&gt;         @RolesAllowed(...)&lt;br/&gt;
         @Path(&quot;sub&quot;)&lt;br/&gt;
         public SubResource getSubResource() &lt;/p&gt;
{...}
&lt;p&gt;    }&lt;/p&gt;

&lt;p&gt;in your case it would be equivalent to putting it on the SubResource class, because users would need to be authorized to start working with this subresource, so I didn&apos;t recommend putting RolesAllowed on every SubResource method&lt;/p&gt;

&lt;p&gt;Does it clarify things a bit ?&lt;br/&gt;
cheers, Sergey&lt;/p&gt;
</comment>
                            <comment id="12732613" author="sergey_beryozkin" created="Fri, 17 Jul 2009 17:07:15 +0000"  >&lt;p&gt;Actually, I meant 2.3-SNAPSHOT as 2.2.3-SNAPSHOT is not being built regularly.&lt;/p&gt;

&lt;p&gt;You might also want to inject a SubResource from Spring, as a root resource property, rather than using &amp;lt;lookupMethod/&amp;gt;. I have atest for it too, but the injected resource implements the JAX-RS annotated interface, haven&apos;t tried injecting a CGLIB proxy - but given that I can see a test working now with &amp;lt;lookupMethod/&amp;gt; I&apos;m pretty sure it will work too&lt;/p&gt;</comment>
                            <comment id="12732616" author="ceefour" created="Fri, 17 Jul 2009 17:19:26 +0000"  >&lt;p&gt;Thank you Sergey for your excellent explanation. That definitely clears up everything.&lt;/p&gt;

&lt;p&gt;I mistook your #2 point above as putting annotations on all methods on the subresource class, as opposed to what you suggested putting the annotation on the rootresource method.&lt;/p&gt;

&lt;p&gt;In fact, my use case is that the rootresource class itself is secured, so I guess that means in my specific use case, there&apos;s actually no need to protect any of its methods and its subresources, is my assumption is correct?&lt;/p&gt;

&lt;p&gt;Your explanation is so excellent it begs inclusion in : &lt;a href=&quot;http://cwiki.apache.org/CXF20DOC/jax-rs.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cwiki.apache.org/CXF20DOC/jax-rs.html&lt;/a&gt;&lt;br/&gt;
There is very little discussion (or more accurately: example) on security there.&lt;/p&gt;

&lt;p&gt;I&apos;m new with JSR-250 security annotations but currently I&apos;m thinking that for me, it&apos;s a best practice approach to use CXF with Spring, Spring AOP, Spring Security Tiger, and JSR-250, for all security/authn/authz needs.&lt;/p&gt;

&lt;p&gt;Regarding injecting a SubResource to a property, I couldn&apos;t do it because the subresource bean is a prototype one. It&apos;s still possible to,  say, inject a factory of SubResource to the RootResource property, and then invoke that factory upon RootResource.getSubResource() call, but I guess that&apos;s too much jumping hoops. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12732698" author="sergey_beryozkin" created="Fri, 17 Jul 2009 19:42:35 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;&amp;gt; In fact, my use case is that the rootresource class itself is secured, so I guess that means in my specific use case, there&apos;s actually no need to protect any of its methods and its subresources, is my assumption is correct? &lt;/p&gt;

&lt;p&gt;If your global root resource security rules apply to all &apos;leafs&apos;/subresources, then yes, no need to secure the subresources or individual methods. One may want to do apply more fine-grained authorization rules in other cases.&lt;/p&gt;

&lt;p&gt;I&apos;ll update the docs, there&apos;s so much that has to be added...&lt;br/&gt;
thanks, Sergey  &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12430799">CXF-2346</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12392587">CXF-1494</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>113773</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 19 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i14e27:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>233741</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>