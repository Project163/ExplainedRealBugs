<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:34:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-1730] The Exception handling if it is thrown from a RequestHandler is not correct i guess.</title>
                <link>https://issues.apache.org/jira/browse/CXF-1730</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;Hello again&lt;/p&gt;

&lt;p&gt;i&apos; ve used an implementation of RequestHandler to perform authentication stuff. So&lt;br/&gt;
if the Authentication failed a RuntimeException is thrown.  I&apos;ve also wrote a ExceptionMapper implementation to transform occurred Exception into Http Status codes. If the RuntimeException from the Authentication was thrown than this is translated to an HTTP 403 status code.&lt;/p&gt;

&lt;p&gt;But this Http status code is not send as response. This sends a 200 status code. After a time of debugging i found the code that is responsible for that. The processResponse method of the org.apache.cxf.jaxrs.interceptor.JAXRSOutInterceptor work not correct is guess. Because code with the following code block this methods ends.&lt;/p&gt;

&lt;p&gt;OperationResourceInfo operation = (OperationResourceInfo)exchange.get(OperationResourceInfo.class&lt;br/&gt;
            .getName());&lt;/p&gt;

&lt;p&gt;        if (operation == null) &lt;/p&gt;
{
            return;
        }

&lt;p&gt;because the operation variable is null. The code after this is responsible to but the Response from the ExceptionMapper class into the message object so that i received a 403 http status code.&lt;/p&gt;

&lt;p&gt;I&apos;ve searched the code again and i found the code block how put the OperationResourceInfo into the Exchange object. That is done by the processRequest method of the org.apache.cxf.jaxrs.interceptor.JAXRSInInterceptor class. But before the OperationResourceInfo object is putted in the registered ResourceHandler are called see the code block below.&lt;/p&gt;

&lt;p&gt; for (ProviderInfo&amp;lt;RequestHandler&amp;gt; sh : shs) {&lt;br/&gt;
            Response response = sh.getProvider().handleRequest(message, resource);&lt;br/&gt;
            if (response != null) &lt;/p&gt;
{
                message.getExchange().put(Response.class, response);
                return;
            }
&lt;p&gt;        }&lt;/p&gt;

&lt;p&gt;I guess the code how put in the OperationresourceInfo object could be performed before the RequestHandlers are called maybe? &lt;/p&gt;

&lt;p&gt;Or it&apos;s forbidden to throw a Runtimeexception inside the RequestHandler ?&lt;/p&gt;

&lt;p&gt;I&apos;ve also tried to return an Response object from the RequestHandler but the effect was the same it never arrives the client. It received also the Response object with http code 200.&lt;/p&gt;

&lt;p&gt;The CXF framework is great and very flexible good work. The opportunities to register own code is very great.&lt;/p&gt;

&lt;p&gt;Good work.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows XP,  jdk1.6, Apache Tomcat 6.0.16&lt;/p&gt;</environment>
        <key id="12401426">CXF-1730</key>
            <summary>The Exception handling if it is thrown from a RequestHandler is not correct i guess.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dkulp">Daniel Kulp</assignee>
                                    <reporter username="pussinboost">Frank Ittermann</reporter>
                        <labels>
                    </labels>
                <created>Thu, 31 Jul 2008 17:31:48 +0000</created>
                <updated>Fri, 24 Apr 2009 21:18:02 +0000</updated>
                            <resolved>Tue, 2 Sep 2008 20:27:57 +0000</resolved>
                                    <version>2.1.2</version>
                                    <fixVersion>2.1.2</fixVersion>
                                    <component>JAX-RS</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12618772" author="pussinboost" created="Thu, 31 Jul 2008 17:45:24 +0000"  >&lt;p&gt;I changed the code that i mentioned and build cxf 2.1.2 on my local machine new. And now the behavior is what i expected. I received the 403 http status code.&lt;/p&gt;</comment>
                            <comment id="12618870" author="sergey_beryozkin" created="Thu, 31 Jul 2008 21:47:15 +0000"  >&lt;p&gt;Hi, I think I&apos;ve actually fixed it yesterday - please do the trunk update and give it a go...&lt;/p&gt;</comment>
                            <comment id="12618871" author="sergey_beryozkin" created="Thu, 31 Jul 2008 21:50:27 +0000"  >&lt;p&gt;&amp;gt; changed the code that i mentioned&lt;/p&gt;

&lt;p&gt;can you just  post the code you changed just in case my update does not work for you ?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;

</comment>
                            <comment id="12618909" author="pussinboost" created="Fri, 1 Aug 2008 00:10:50 +0000"  >&lt;p&gt;This was the original code (class org.apache.cxf.jaxrs.interceptor.JAXRSInInterceptor) :&lt;/p&gt;

&lt;p&gt;private void processRequest(Message message) {&lt;br/&gt;
        RequestPreprocessor rp = &lt;br/&gt;
            ProviderFactory.getInstance().getRequestPreprocessor();&lt;br/&gt;
        if (rp != null) &lt;/p&gt;
{
            rp.preprocess(message, new UriInfoImpl(message, null));
        }

&lt;p&gt;        String path = (String)message.get(Message.PATH_INFO);&lt;br/&gt;
        String address = (String)message.get(Message.BASE_PATH);&lt;br/&gt;
        String httpMethod = (String)message.get(Message.HTTP_REQUEST_METHOD);&lt;br/&gt;
        String requestContentType = (String)message.get(Message.CONTENT_TYPE);&lt;br/&gt;
        if (requestContentType == null) &lt;/p&gt;
{
            requestContentType = &quot;*/*&quot;;
        }

&lt;p&gt;        if (address.startsWith(&quot;http&quot;)) {&lt;br/&gt;
            int idx = address.indexOf(&apos;/&apos;, 7);&lt;br/&gt;
            if (idx != -1) &lt;/p&gt;
{
                address = address.substring(idx);
            }
&lt;p&gt;        }&lt;/p&gt;

&lt;p&gt;        if (path.startsWith(address)) {&lt;br/&gt;
            path = path.substring(address.length());&lt;br/&gt;
            if (!path.startsWith(&quot;/&quot;)) &lt;/p&gt;
{
                path = &quot;/&quot; + path;
            }
&lt;p&gt;        }&lt;/p&gt;

&lt;p&gt;        if (!path.endsWith(&quot;/&quot;)) &lt;/p&gt;
{
            path = path + &quot;/&quot;;
        }


&lt;p&gt;        //1. Matching target resource class&lt;br/&gt;
        Service service = message.getExchange().get(Service.class);&lt;br/&gt;
        List&amp;lt;ClassResourceInfo&amp;gt; resources = ((JAXRSServiceImpl)service).getClassResourceInfos();&lt;/p&gt;

&lt;p&gt;        MultivaluedMap&amp;lt;String, String&amp;gt; values = new MetadataMap&amp;lt;String, String&amp;gt;();&lt;br/&gt;
        ClassResourceInfo resource = JAXRSUtils.selectResourceClass(resources, path, values);&lt;br/&gt;
        if (resource == null) &lt;/p&gt;
{
            org.apache.cxf.common.i18n.Message errorMsg = 
                new org.apache.cxf.common.i18n.Message(&quot;NO_ROOT_EXC&quot;, 
                                                   BUNDLE, 
                                                   path);
            LOG.severe(errorMsg.toString());
            throw new Fault(errorMsg);
        }

&lt;p&gt;        List&amp;lt;ProviderInfo&amp;lt;RequestHandler&amp;gt;&amp;gt; shs = &lt;br/&gt;
            ProviderFactory.getInstance().getRequestHandlers();&lt;br/&gt;
        for (ProviderInfo&amp;lt;RequestHandler&amp;gt; sh : shs) {&lt;br/&gt;
            Response response = sh.getProvider().handleRequest(message, resource);&lt;br/&gt;
            if (response != null) &lt;/p&gt;
{
                message.getExchange().put(Response.class, response);
                return;
            }
&lt;p&gt;        }&lt;/p&gt;

&lt;p&gt;        String acceptTypes = (String)message.get(Message.ACCEPT_CONTENT_TYPE);&lt;br/&gt;
        if (acceptTypes == null) &lt;/p&gt;
{
            acceptTypes = &quot;*/*&quot;;
        }

&lt;p&gt;        List&amp;lt;MediaType&amp;gt; acceptContentTypes = JAXRSUtils.sortMediaTypes(acceptTypes);&lt;br/&gt;
        message.getExchange().put(Message.ACCEPT_CONTENT_TYPE, acceptContentTypes);&lt;br/&gt;
        message.getExchange().put(ROOT_RESOURCE_CLASS, resource);&lt;/p&gt;

&lt;p&gt;        LOG.fine(&quot;Request path is: &quot; + path);&lt;br/&gt;
        LOG.fine(&quot;Request HTTP method is: &quot; + httpMethod);&lt;br/&gt;
        LOG.fine(&quot;Request contentType is: &quot; + requestContentType);&lt;br/&gt;
        LOG.fine(&quot;Accept contentType is: &quot; + acceptTypes);&lt;/p&gt;


&lt;p&gt;        OperationResourceInfo ori = &lt;br/&gt;
            JAXRSUtils.findTargetMethod(resource, values.getFirst(URITemplate.FINAL_MATCH_GROUP), &lt;br/&gt;
                                       httpMethod, values, requestContentType, acceptContentTypes);&lt;/p&gt;

&lt;p&gt;        if (ori == null) &lt;/p&gt;
{
            org.apache.cxf.common.i18n.Message errorMsg = 
                new org.apache.cxf.common.i18n.Message(&quot;NO_OP_EXC&quot;, 
                                                   BUNDLE, 
                                                   path,
                                                   requestContentType,
                                                   acceptTypes);
            LOG.severe(errorMsg.toString());
            throw new Fault(errorMsg);
        }
&lt;p&gt;        LOG.fine(&quot;Found operation: &quot; + ori.getMethodToInvoke().getName());&lt;/p&gt;

&lt;p&gt;        message.getExchange().put(OperationResourceInfo.class, ori);&lt;br/&gt;
        message.put(RELATIVE_PATH, values.getFirst(URITemplate.FINAL_MATCH_GROUP));&lt;br/&gt;
        message.put(URITemplate.TEMPLATE_PARAMETERS, values);&lt;/p&gt;

&lt;p&gt;        //2. Process parameters&lt;br/&gt;
        List&amp;lt;Object&amp;gt; params = JAXRSUtils&lt;br/&gt;
            .processParameters(ori, values, message);&lt;/p&gt;

&lt;p&gt;        message.setContent(List.class, params);&lt;br/&gt;
    }&lt;/p&gt;</comment>
                            <comment id="12618910" author="pussinboost" created="Fri, 1 Aug 2008 00:11:57 +0000"  >&lt;p&gt;And i moved the resolving of the OperationResourceInfo  before the Request Hadnler&apos;s are invoked.&lt;br/&gt;
look here:&lt;/p&gt;

&lt;p&gt;private void processRequest(Message message) {&lt;br/&gt;
        RequestPreprocessor rp = &lt;br/&gt;
            ProviderFactory.getInstance().getRequestPreprocessor();&lt;br/&gt;
        if (rp != null) &lt;/p&gt;
{
            rp.preprocess(message, new UriInfoImpl(message, null));
        }

&lt;p&gt;        String path = (String)message.get(Message.PATH_INFO);&lt;br/&gt;
        String address = (String)message.get(Message.BASE_PATH);&lt;br/&gt;
        String httpMethod = (String)message.get(Message.HTTP_REQUEST_METHOD);&lt;br/&gt;
        String requestContentType = (String)message.get(Message.CONTENT_TYPE);&lt;br/&gt;
        if (requestContentType == null) &lt;/p&gt;
{
            requestContentType = &quot;*/*&quot;;
        }

&lt;p&gt;        if (address.startsWith(&quot;http&quot;)) {&lt;br/&gt;
            int idx = address.indexOf(&apos;/&apos;, 7);&lt;br/&gt;
            if (idx != -1) &lt;/p&gt;
{
                address = address.substring(idx);
            }
&lt;p&gt;        }&lt;/p&gt;

&lt;p&gt;        if (path.startsWith(address)) {&lt;br/&gt;
            path = path.substring(address.length());&lt;br/&gt;
            if (!path.startsWith(&quot;/&quot;)) &lt;/p&gt;
{
                path = &quot;/&quot; + path;
            }
&lt;p&gt;        }&lt;/p&gt;

&lt;p&gt;        if (!path.endsWith(&quot;/&quot;)) &lt;/p&gt;
{
            path = path + &quot;/&quot;;
        }


&lt;p&gt;        //1. Matching target resource class&lt;br/&gt;
        Service service = message.getExchange().get(Service.class);&lt;br/&gt;
        List&amp;lt;ClassResourceInfo&amp;gt; resources = ((JAXRSServiceImpl)service).getClassResourceInfos();&lt;/p&gt;

&lt;p&gt;        MultivaluedMap&amp;lt;String, String&amp;gt; values = new MetadataMap&amp;lt;String, String&amp;gt;();&lt;br/&gt;
        ClassResourceInfo resource = JAXRSUtils.selectResourceClass(resources, path, values);&lt;br/&gt;
        if (resource == null) &lt;/p&gt;
{
            org.apache.cxf.common.i18n.Message errorMsg = 
                new org.apache.cxf.common.i18n.Message(&quot;NO_ROOT_EXC&quot;, 
                                                   BUNDLE, 
                                                   path);
            LOG.severe(errorMsg.toString());
            throw new Fault(errorMsg);
        }


&lt;p&gt;        String acceptTypes = (String)message.get(Message.ACCEPT_CONTENT_TYPE);&lt;br/&gt;
        if (acceptTypes == null) &lt;/p&gt;
{
            acceptTypes = &quot;*/*&quot;;
        }

&lt;p&gt;        List&amp;lt;MediaType&amp;gt; acceptContentTypes = JAXRSUtils.sortMediaTypes(acceptTypes);&lt;br/&gt;
        message.getExchange().put(Message.ACCEPT_CONTENT_TYPE, acceptContentTypes);&lt;br/&gt;
        message.getExchange().put(ROOT_RESOURCE_CLASS, resource);&lt;/p&gt;

&lt;p&gt;        LOG.fine(&quot;Request path is: &quot; + path);&lt;br/&gt;
        LOG.fine(&quot;Request HTTP method is: &quot; + httpMethod);&lt;br/&gt;
        LOG.fine(&quot;Request contentType is: &quot; + requestContentType);&lt;br/&gt;
        LOG.fine(&quot;Accept contentType is: &quot; + acceptTypes);&lt;/p&gt;


&lt;p&gt;        OperationResourceInfo ori = &lt;br/&gt;
            JAXRSUtils.findTargetMethod(resource, values.getFirst(URITemplate.FINAL_MATCH_GROUP), &lt;br/&gt;
                                       httpMethod, values, requestContentType, acceptContentTypes);&lt;/p&gt;

&lt;p&gt;        if (ori == null) &lt;/p&gt;
{
            org.apache.cxf.common.i18n.Message errorMsg = 
                new org.apache.cxf.common.i18n.Message(&quot;NO_OP_EXC&quot;, 
                                                   BUNDLE, 
                                                   path,
                                                   requestContentType,
                                                   acceptTypes);
            LOG.severe(errorMsg.toString());
            throw new Fault(errorMsg);
        }
&lt;p&gt;        LOG.fine(&quot;Found operation: &quot; + ori.getMethodToInvoke().getName());&lt;/p&gt;

&lt;p&gt;        message.getExchange().put(OperationResourceInfo.class, ori);&lt;br/&gt;
        message.put(RELATIVE_PATH, values.getFirst(URITemplate.FINAL_MATCH_GROUP));&lt;br/&gt;
        message.put(URITemplate.TEMPLATE_PARAMETERS, values);&lt;/p&gt;

&lt;p&gt;        List&amp;lt;ProviderInfo&amp;lt;RequestHandler&amp;gt;&amp;gt; shs = &lt;br/&gt;
            ProviderFactory.getInstance().getRequestHandlers();&lt;br/&gt;
        for (ProviderInfo&amp;lt;RequestHandler&amp;gt; sh : shs) {&lt;br/&gt;
            Response response = sh.getProvider().handleRequest(message, resource);&lt;br/&gt;
            if (response != null) &lt;/p&gt;
{
                message.getExchange().put(Response.class, response);
                return;
            }
&lt;p&gt;        }&lt;/p&gt;

&lt;p&gt;        //2. Process parameters&lt;br/&gt;
        List&amp;lt;Object&amp;gt; params = JAXRSUtils&lt;br/&gt;
            .processParameters(ori, values, message);&lt;/p&gt;

&lt;p&gt;        message.setContent(List.class, params);&lt;br/&gt;
    }&lt;/p&gt;</comment>
                            <comment id="12619152" author="sergey_beryozkin" created="Fri, 1 Aug 2008 22:12:29 +0000"  >&lt;p&gt;Frank - did you try the latest trunk ? I did some fix there to make sure 404 is returned if no root resource class is found and I had to ensure the exceptions thrown at the input path could be mapped and processed properly.&lt;/p&gt;

&lt;p&gt;I&apos;m on holidays till the end of August&lt;/p&gt;</comment>
                            <comment id="12619194" author="pussinboost" created="Sat, 2 Aug 2008 04:22:54 +0000"  >&lt;p&gt;Hello Sergey okay i will try it.  I&apos;am also on vacation but i will take the time tomorrow to check the trunk version. &lt;br/&gt;
Great work and thanks for your fast responses.&lt;/p&gt;

&lt;p&gt;Enjoy your holiday.&lt;/p&gt;</comment>
                            <comment id="12619808" author="pussinboost" created="Tue, 5 Aug 2008 07:37:10 +0000"  >&lt;p&gt;Hello, yesterday I tried the latest trunk version and i couldn&apos;t checked if this bug was fixed or not. Because&lt;br/&gt;
the following Exception was thrown.&lt;/p&gt;

&lt;p&gt;java.lang.NullPointerException&lt;br/&gt;
	at org.apache.cxf.jaxrs.utils.JAXRSUtils.intersectMimeTypes(JAXRSUtils.java:709)&lt;br/&gt;
	at org.apache.cxf.jaxrs.interceptor.JAXRSOutInterceptor.computeAvailableContentTypes(JAXRSOutInterceptor.java:200)&lt;br/&gt;
	at org.apache.cxf.jaxrs.interceptor.JAXRSOutInterceptor.processResponse(JAXRSOutInterceptor.java:113)&lt;br/&gt;
	at org.apache.cxf.jaxrs.interceptor.JAXRSOutInterceptor.handleMessage(JAXRSOutInterceptor.java:61)&lt;br/&gt;
	at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:221)&lt;br/&gt;
	at org.apache.cxf.interceptor.OutgoingChainInterceptor.handleMessage(OutgoingChainInterceptor.java:74)&lt;br/&gt;
	at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:221)&lt;br/&gt;
	at org.apache.cxf.transport.ChainInitiationObserver.onMessage(ChainInitiationObserver.java:78)&lt;br/&gt;
	at org.apache.cxf.transport.servlet.ServletDestination.invoke(ServletDestination.java:92)&lt;br/&gt;
	at org.apache.cxf.transport.servlet.ServletController.invokeDestination(ServletController.java:283)&lt;br/&gt;
	at org.apache.cxf.transport.servlet.ServletController.invoke(ServletController.java:128)&lt;br/&gt;
	at org.apache.cxf.transport.servlet.AbstractCXFServlet.invoke(AbstractCXFServlet.java:174)&lt;br/&gt;
	at org.apache.cxf.transport.servlet.AbstractCXFServlet.doGet(AbstractCXFServlet.java:156)&lt;br/&gt;
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:690)&lt;br/&gt;
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:803)&lt;br/&gt;
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)&lt;br/&gt;
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)&lt;br/&gt;
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)&lt;br/&gt;
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:175)&lt;br/&gt;
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:128)&lt;br/&gt;
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)&lt;br/&gt;
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)&lt;br/&gt;
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:286)&lt;br/&gt;
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:844)&lt;br/&gt;
	at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:583)&lt;br/&gt;
	at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:447)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:619)&lt;/p&gt;</comment>
                            <comment id="12620249" author="dkulp" created="Wed, 6 Aug 2008 13:42:07 +0000"  >

&lt;p&gt;I added an NPE guard there.  Just committed to trunk. &lt;/p&gt;</comment>
                            <comment id="12620646" author="pussinboost" created="Thu, 7 Aug 2008 15:13:26 +0000"  >&lt;p&gt;Okay i updated my local cxf project and now i got something new for you.&lt;/p&gt;

&lt;p&gt;java.lang.NullPointerException&lt;br/&gt;
        at org.apache.cxf.jaxrs.interceptor.JAXRSOutInterceptor.processResponse(JAXRSOutInterceptor.java:150)&lt;br/&gt;
        at org.apache.cxf.jaxrs.interceptor.JAXRSOutInterceptor.handleMessage(JAXRSOutInterceptor.java:61)&lt;br/&gt;
        at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:221)&lt;br/&gt;
        at org.apache.cxf.interceptor.OutgoingChainInterceptor.handleMessage(OutgoingChainInterceptor.java:74)&lt;br/&gt;
        at org.apache.cxf.phase.PhaseInterceptorChain.doIntercept(PhaseInterceptorChain.java:221)&lt;br/&gt;
        at org.apache.cxf.transport.ChainInitiationObserver.onMessage(ChainInitiationObserver.java:78)&lt;br/&gt;
        at org.apache.cxf.transport.servlet.ServletDestination.invoke(ServletDestination.java:92)&lt;br/&gt;
        at org.apache.cxf.transport.servlet.ServletController.invokeDestination(ServletController.java:283)&lt;br/&gt;
        at org.apache.cxf.transport.servlet.ServletController.invoke(ServletController.java:128)&lt;br/&gt;
        at org.apache.cxf.transport.servlet.AbstractCXFServlet.invoke(AbstractCXFServlet.java:174)&lt;br/&gt;
        at org.apache.cxf.transport.servlet.AbstractCXFServlet.doGet(AbstractCXFServlet.java:156)&lt;br/&gt;
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:690)&lt;br/&gt;
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:803)&lt;br/&gt;
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)&lt;br/&gt;
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)&lt;br/&gt;
        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)&lt;br/&gt;
        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:175)&lt;br/&gt;
        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:128)&lt;br/&gt;
        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)&lt;br/&gt;
        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)&lt;br/&gt;
        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:286)&lt;br/&gt;
        at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:844)&lt;br/&gt;
        at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:583)&lt;br/&gt;
        at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:447)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:619)&lt;/p&gt;

&lt;p&gt;I guess there is a deeper problem with that. With my local patched version of cxf 2.1.2 that i mentioned before all works fine and i wrote no new code i only change the order of the code a little bit. I looked in the trunk source code and what i see was that in the processResponse method of the JAXRSOutInterceptor class you put a lot of if checks for the OperationResourceInfo local variable. Because in my scenario see above this variable was never set.&lt;/p&gt;

&lt;p&gt;So let me give you an advice set the OperationResourceInfo varaiable before the RequestHandler are called. With this solution the lot of null checks you are now performed not needed.&lt;/p&gt;

&lt;p&gt;Last but not least you have forgot one of this null checks.&lt;/p&gt;

&lt;p&gt;writer.writeTo(responseObj, targetType, invoked.getGenericReturnType(), &lt;br/&gt;
                               invoked != null ? invoked.getAnnotations() : new Annotation[]{}, &lt;br/&gt;
                               responseType, &lt;br/&gt;
                               response.getMetadata(), &lt;br/&gt;
                               out);&lt;/p&gt;

&lt;p&gt;This line of code cause the trouble because the invoked variable is null and this code fragment invoked.getGenericReturnType() cause the NullPointerException.&lt;/p&gt;

&lt;p&gt;Another thing about the RequestHandler feature is that i want used this possibility to write Authentication code. To do that i need the OperationResourceInfo variable setted in the Message instance. So please say if this is a bad idear.&lt;/p&gt;

&lt;p&gt;Thanks for your attention&lt;/p&gt;</comment>
                            <comment id="12621105" author="dkulp" created="Sat, 9 Aug 2008 00:42:29 +0000"  >&lt;p&gt;OK, I put another fix in place to try and make sure the operationResourceINfo thing is filled in.   Let me know how that works out.&lt;/p&gt;</comment>
                            <comment id="12621728" author="pussinboost" created="Tue, 12 Aug 2008 08:21:17 +0000"  >&lt;p&gt;I tried again and it&apos;s not working. But I think we are on the right way. I take a look into the source code and I see they are a misunderstanding. The following line of source code:&lt;/p&gt;

&lt;p&gt;OperationResourceInfo ori = &lt;br/&gt;
                    JAXRSUtils.findTargetMethod(resource, values.getFirst(URITemplate.FINAL_MATCH_GROUP), &lt;br/&gt;
                                               httpMethod, values, requestContentType, acceptContentTypes);&lt;br/&gt;
                message.getExchange().put(OperationResourceInfo.class, ori);&lt;/p&gt;

&lt;p&gt;has to be performed before the following loop starts&lt;/p&gt;

&lt;p&gt;for (ProviderInfo&amp;lt;RequestHandler&amp;gt; sh : shs) {&lt;br/&gt;
            Response response = sh.getProvider().handleRequest(message, resource);&lt;br/&gt;
....&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;This code snippets are from the JAXRSInInterceptor class.&lt;/p&gt;

&lt;p&gt;So good luck.&lt;/p&gt;</comment>
                            <comment id="12624896" author="sergey_beryozkin" created="Fri, 22 Aug 2008 16:30:08 +0000"  >&lt;p&gt;Frank, can you please attach a test case (or just some sample handlers) ?&lt;/p&gt;

&lt;p&gt;What you suggest won&apos;t work - the exception may get thrown much earlier before the operation resource info has been resolved - for ex, at the point when a root resource is checked.&lt;/p&gt;</comment>
                            <comment id="12626089" author="pussinboost" created="Wed, 27 Aug 2008 12:17:12 +0000"  >&lt;p&gt;Hello again,&lt;/p&gt;

&lt;p&gt;how was your holiday?&lt;/p&gt;

&lt;p&gt;First of all now it works. I&apos;ve downloaded the 2.1.2 version and now it works. So thanks for your help.&lt;/p&gt;

&lt;p&gt;Here a little piece of sample code for my RequestHandler implementation.&lt;/p&gt;

&lt;p&gt;import javax.ws.rs.core.Response;&lt;/p&gt;

&lt;p&gt;import org.apache.cxf.jaxrs.ext.RequestHandler;&lt;br/&gt;
import org.apache.cxf.jaxrs.model.ClassResourceInfo;&lt;br/&gt;
import org.apache.cxf.jaxrs.model.OperationResourceInfo;&lt;br/&gt;
import org.apache.cxf.message.Message;&lt;/p&gt;

&lt;p&gt;public class TestRequestHanler implements RequestHandler {&lt;/p&gt;

&lt;p&gt;    public Response handleRequest(Message message, ClassResourceInfo resourceClass) {&lt;/p&gt;

&lt;p&gt;        OperationResourceInfo ori = message.getExchange().get(OperationResourceInfo.class);&lt;br/&gt;
        // no resource method was found for incoming request&lt;br/&gt;
        if (ori == null) &lt;/p&gt;
{
            return null;
        }
&lt;p&gt;        // do some stuff with the ori variable get meta information something like that&lt;/p&gt;

&lt;p&gt;        throw new RuntimeException(&quot;access denied&quot;);&lt;br/&gt;
//        return null;&lt;br/&gt;
    }&lt;br/&gt;
}&lt;br/&gt;
go on with your great work.&lt;/p&gt;</comment>
                            <comment id="12627799" author="dkulp" created="Tue, 2 Sep 2008 20:27:57 +0000"  >&lt;p&gt;&lt;br/&gt;
Confirmed fixed in 2.1.2.&lt;/p&gt;</comment>
                            <comment id="12628336" author="sergey_beryozkin" created="Thu, 4 Sep 2008 13:23:08 +0000"  >&lt;p&gt;Hi Frank&lt;/p&gt;

&lt;p&gt;&amp;gt; how was your holiday? &lt;br/&gt;
thanks, it was good &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&amp;gt; First of all now it works. I&apos;ve downloaded the 2.1.2 version and now it works. So thanks for your help.&lt;/p&gt;

&lt;p&gt;Unfortunately, even though it works, the fact that your filter depends on OperationResourceInfo be set&lt;br/&gt;
in the message makes your filter a bit brittle.&lt;/p&gt;

&lt;p&gt;The problem is that selecting OperationResourceInfo before filters are invoked brings the necessity to reselect OperationResourceInfo after every individual filter is invoked - as an individual filter may have the Accept header value updated in the message - with this value affecting the selection of the OperationResourceInfo in the first place. In other words, you reckon that OperationResourceInfo you&apos;re dealing with in the filter represents the method which will be invoked upon - but it might not be the case - well at least in  the looser environment.&lt;/p&gt;

&lt;p&gt;I feel it would be better to do this kind of authentication using Spring AOP.  This current dependency is a bit brittle - I may need to refactor for 2.1.3 it again (basically revert some of the changes that were needed for this JIRA be solved) - unless we find a smarter solution&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>112512</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 12 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0v1sf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>179263</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>