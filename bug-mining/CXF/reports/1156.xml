<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:50:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-3949] NoClassDefFoundError when using CXF JAX-RS in OSGi environment</title>
                <link>https://issues.apache.org/jira/browse/CXF-3949</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;When using the CXF JAX-RS implementation in an OSGi environment, the CXF implementation might fail to initialize properly.&lt;br/&gt;
The problem is non-consistently reproduceable, but more likely to occur on machines with high parallelism (due to several cores/threads).&lt;br/&gt;
The CXF bundle (&quot;org.apache.cxf.bundle&quot;) has a dependency on the JSR 311 API JAR (&quot;org.apache.servicemix.specs.jsr311-api-1.1&quot;).&lt;br/&gt;
But the dependency is marked as &quot;resolution=optional&quot; in the OSGi headers of the CXF bundle manifest.&lt;br/&gt;
As a result, if the JSR-311 bundle is not yet fully started when the CXF bundle is started, OSGi does not &quot;wire&quot; these packages into the imports of the CXF bundle:&lt;br/&gt;
javax.ws.rs&lt;br/&gt;
javax.ws.rs.core&lt;br/&gt;
javax.ws.rs.ext&lt;/p&gt;

&lt;p&gt;The error is the following : &lt;br/&gt;
java.lang.NoClassDefFoundError: Could not initialize class org.apache.cxf.jaxrs.utils.JAXRSUtils&lt;br/&gt;
See similar error &lt;a href=&quot;https://issues.apache.org/jira/browse/DOSGI-1&quot; title=&quot;DOSGI CXF Distributed Software Bundle (1.1.0.SNAPSHOT) fails on startup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DOSGI-1&quot;&gt;&lt;del&gt;DOSGI-1&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I guess that these packages are marked as optional because CXF can be used in an environment where no JAX-RS is available, and it works fine as long as the application does not use this API.  However, when an application is known to use the API, the dependency marked as &quot;optional&quot; is not correct.&lt;/p&gt;

&lt;p&gt;Long-term solution : split CXF bundle into smaller bundles (like Jetty).&lt;/p&gt;

&lt;p&gt;Workaround : edit the manifest of the CXF bundle, and remove the &quot;resolution=optional&quot; for the packages which are known to be used by the application.  Tip : replace &quot;resolution&quot; by &quot;resolutio2&quot;, this tricks prevents from changing the alignment of the 80-characters columns.&lt;/p&gt;
</description>
                <environment>&lt;p&gt;ServiceMix 4.3&lt;/p&gt;</environment>
        <key id="12533635">CXF-3949</key>
            <summary>NoClassDefFoundError when using CXF JAX-RS in OSGi environment</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sergey_beryozkin">Sergey Beryozkin</assignee>
                                    <reporter username="metatech">metatech</reporter>
                        <labels>
                    </labels>
                <created>Fri, 2 Dec 2011 14:54:53 +0000</created>
                <updated>Thu, 2 May 2013 02:29:48 +0000</updated>
                            <resolved>Mon, 9 Jul 2012 12:13:53 +0000</resolved>
                                    <version>2.3.2</version>
                                    <fixVersion>2.4.9</fixVersion>
                    <fixVersion>2.5.5</fixVersion>
                    <fixVersion>2.6.2</fixVersion>
                    <fixVersion>2.7</fixVersion>
                                    <component>JAX-RS</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="28800">8h</timeoriginalestimate>
                            <timeestimate seconds="28800">8h</timeestimate>
                                        <comments>
                            <comment id="13162847" author="dkulp" created="Mon, 5 Dec 2011 15:59:00 +0000"  >
&lt;p&gt;This is working properly at this point.   The JSR-311 bundle needs to be installed prior to installing the CXF bundle.  (or the CXF bundle would need to be refreshed after installing it)&lt;/p&gt;

&lt;p&gt;If you use the karaf features file that we provide with CXF, all of this is taken care of for you and the api jars are set with a much earlier start level to make sure they are installed and started first.&lt;/p&gt;</comment>
                            <comment id="13162880" author="sergey_beryozkin" created="Mon, 5 Dec 2011 17:18:03 +0000"  >&lt;p&gt;I updated the cxf-jaxrs bundle only to drop the resolution=optional.&lt;/p&gt;

&lt;p&gt;Metatech, I guess we should document what needs to be done in case of the DOSGi multibundle distribution (which depends on cxf-minimal bundle); if you could experiment with setting up the start-up levels then it would be great.&lt;/p&gt;

&lt;p&gt;Cheers, Sergey&lt;/p&gt;</comment>
                            <comment id="13163472" author="metatech" created="Tue, 6 Dec 2011 09:43:41 +0000"  >&lt;p&gt;Daniel,&lt;br/&gt;
I did not install CXF manuallly, it got installed by default in the ServiceMix 4.3 distribution.&lt;br/&gt;
The problem is, I think, that the CXF bundle gets installed a few milliseconds too early, before the JSR 311 is completely installed, which means that the OSGi framework does not wait for the JSR 311 bundle to become available, but ignores this dependency and installs the CXF bundle without it.&lt;br/&gt;
In Felix 3.0.9 (provided in SMX 4.3), manually executing a OSGI refresh of both bundles does not help, because the class ModuleImpl caches the dependencies (in member variable &quot;m_cachedRequirements&quot;), and the only way to update the dependencies is to uninstall/install the bundle, which cannot be practically performed if many other bundles depend on it.&lt;br/&gt;
Regarding the change of the start-level, I experienced that it does not work in all cases, but that it merely reduces the window of the race condition, see my comment in &lt;a href=&quot;https://issues.apache.org/jira/browse/SMX4-744&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SMX4-744&lt;/a&gt;.&lt;br/&gt;
The ideal solution would be that the optional features of the CXF bundle are delivered as separate optional bundles, but I understand that this will create a higher complexity for the CXF distribution.&lt;br/&gt;
Regards.&lt;/p&gt;</comment>
                            <comment id="13172300" author="metatech" created="Mon, 19 Dec 2011 14:19:20 +0000"  >&lt;p&gt;New info : the problem happened again, with the edited manifest workaround present, therefore the origin of the race condition is not the dependency of the CXF bundle, but something else, most probably not related to CXF itself.&lt;/p&gt;

&lt;p&gt;Unfortunately, the &quot;PropertyBatchUpdateException&quot; of Spring seems to drop one level of &quot;caused by&quot; on the exception, so it is not easy to tell which class exactly is not found.&lt;/p&gt;

&lt;p&gt;Caused by: org.springframework.beans.PropertyBatchUpdateException; nested PropertyAccessExceptions (1) are:&lt;br/&gt;
PropertyAccessException 1: org.springframework.beans.MethodInvocationException: Property &apos;myBean&apos; threw exception; nested exception is java.lang.NoClassDefFoundError: Could not initialize class org.apache.cxf.jaxrs.utils.JAXRSUtils&lt;/p&gt;</comment>
                            <comment id="13172894" author="ffang" created="Tue, 20 Dec 2011 03:50:03 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;Is there any chance that you can append a testcase(src project which we can build and deploy) to reproduce it?&lt;/p&gt;

&lt;p&gt;Freeman&lt;/p&gt;</comment>
                            <comment id="13173020" author="metatech" created="Tue, 20 Dec 2011 08:23:50 +0000"  >&lt;p&gt;Freeman,&lt;br/&gt;
The problem is not really reproduceable.  It occurred only twice : &lt;br/&gt;
1. on one of the 2 nodes on a large machine (similar to our production machine)&lt;br/&gt;
2. on a laptop under a debugging session, with breakpoints in SMX deploying/starting tasks (SpringOsgiExtenderThread, FelixStartLevel, Blueprint Extender, DirectoryWatcher, ...).  &lt;br/&gt;
This leads me to believe that this is really a narrow race condition that can occur under some very specific timings, which the &quot;start-level&quot; workaround does not allow to fix.&lt;/p&gt;
</comment>
                            <comment id="13183964" author="metatech" created="Wed, 11 Jan 2012 10:27:57 +0000"  >&lt;p&gt;The problem happened again, this time with a possibility to debug.&lt;br/&gt;
It looks like a race condition in the OsgiLocator between the JSR 311 bundle still starting (trying to register the RuntimeDelegate) and the application bundle trying to retrieve the RuntimeDelegate.&lt;br/&gt;
The problem still happens even after several SMX restarts.&lt;br/&gt;
Any idea ?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;SpringOsgiExtenderThread-16&quot;&lt;/span&gt; prio=10 tid=0x08ba1400 nid=0x316c runnable [0x8aeb9000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
	at org.apache.servicemix.specs.locator.OsgiLocator.locate(OsgiLocator.java:58)
	- locked &amp;lt;0x925e62d8&amp;gt; (a java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; org.apache.servicemix.specs.locator.OsgiLocator)
	at javax.ws.rs.ext.FactoryFinder.find(FactoryFinder.java:79)
	at javax.ws.rs.ext.RuntimeDelegate.findDelegate(RuntimeDelegate.java:105)
	at javax.ws.rs.ext.RuntimeDelegate.getInstance(RuntimeDelegate.java:91)
	- locked &amp;lt;0x91fd0a48&amp;gt; (a java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; javax.ws.rs.ext.RuntimeDelegate)
	at javax.ws.rs.core.MediaType.&amp;lt;clinit&amp;gt;(MediaType.java:44)
	at org.apache.cxf.jaxrs.utils.JAXRSUtils.&amp;lt;clinit&amp;gt;(JAXRSUtils.java:104)
	at org.apache.cxf.jaxrs.model.OperationResourceInfo.checkMediaTypes(OperationResourceInfo.java:169)
	at org.apache.cxf.jaxrs.model.OperationResourceInfo.&amp;lt;init&amp;gt;(OperationResourceInfo.java:74)
	at org.apache.cxf.jaxrs.utils.ResourceUtils.createOperationInfo(ResourceUtils.java:341)
	at org.apache.cxf.jaxrs.utils.ResourceUtils.evaluateResourceClass(ResourceUtils.java:218)
	at org.apache.cxf.jaxrs.utils.ResourceUtils.createClassResourceInfo(ResourceUtils.java:204)
	at org.apache.cxf.jaxrs.JAXRSServiceFactoryBean.setResourceClassesFromBeans(JAXRSServiceFactoryBean.java:214)
	at org.apache.cxf.jaxrs.JAXRSServerFactoryBean.setServiceBeans(JAXRSServerFactoryBean.java:188)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.springframework.beans.BeanWrapperImpl.setPropertyValue(BeanWrapperImpl.java:1114)
	at org.springframework.beans.BeanWrapperImpl.setPropertyValue(BeanWrapperImpl.java:900)
	at org.springframework.beans.AbstractPropertyAccessor.setPropertyValues(AbstractPropertyAccessor.java:76)
	at org.springframework.beans.AbstractPropertyAccessor.setPropertyValues(AbstractPropertyAccessor.java:58)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyPropertyValues(AbstractAutowireCapableBeanFactory.java:1358)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;FelixStartLevel&quot;&lt;/span&gt; daemon prio=10 tid=0x8e39ec00 nid=0x3003 waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; monitor entry [0x8ec73000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: BLOCKED (on object monitor)
	at org.apache.servicemix.specs.locator.OsgiLocator.register(OsgiLocator.java:44)
	- waiting to lock &amp;lt;0x925e62d8&amp;gt; (a java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; org.apache.servicemix.specs.locator.OsgiLocator)
	at org.apache.servicemix.specs.locator.Activator.register(Activator.java:116)
	at org.apache.servicemix.specs.locator.Activator.start(Activator.java:70)
	- locked &amp;lt;0x970ce220&amp;gt; (a org.apache.servicemix.specs.locator.Activator)
	at org.apache.felix.framework.util.SecureAction.startActivator(SecureAction.java:629)
	at org.apache.felix.framework.Felix.activateBundle(Felix.java:1842)
	at org.apache.felix.framework.Felix.startBundle(Felix.java:1759)
	at org.apache.felix.framework.Felix.setActiveStartLevel(Felix.java:1163)
	at org.apache.felix.framework.StartLevelImpl.run(StartLevelImpl.java:264)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:662)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13183968" author="metatech" created="Wed, 11 Jan 2012 10:29:58 +0000"  >&lt;p&gt;Maybe &lt;a href=&quot;https://issues.apache.org/jira/browse/SMX4-860&quot; title=&quot;ServiceMix specs should wait for an implementation for a certain amount of time when in OSGi &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SMX4-860&quot;&gt;&lt;del&gt;SMX4-860&lt;/del&gt;&lt;/a&gt; will make the problem disappear ?&lt;/p&gt;</comment>
                            <comment id="13183986" author="sergey_beryozkin" created="Wed, 11 Jan 2012 10:55:28 +0000"  >&lt;p&gt;&amp;gt; Maybe &lt;a href=&quot;https://issues.apache.org/jira/browse/SMX4-860&quot; title=&quot;ServiceMix specs should wait for an implementation for a certain amount of time when in OSGi &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SMX4-860&quot;&gt;&lt;del&gt;SMX4-860&lt;/del&gt;&lt;/a&gt; will make the problem disappear ?&lt;/p&gt;

&lt;p&gt;Hopefully, CXF &amp;amp; DOSGi 1.3-snapshot also have a 1.9.0 dependency&lt;/p&gt;
</comment>
                            <comment id="13184084" author="metatech" created="Wed, 11 Jan 2012 14:11:55 +0000"  >&lt;p&gt;I found 2 workarounds to make it work with ServiceMix 4.3 (which includes component &quot;specs-1.7.0&quot;) : &lt;br/&gt;
1. osgi:bundle-level &amp;lt;ID of org.apache.servicemix.specs.jsr311-api-1.1&amp;gt; 50&lt;br/&gt;
2. osgi:bundle-level &amp;lt;ID of application using CXF&amp;gt; 80 #for &lt;b&gt;all&lt;/b&gt; applications using CXF&lt;/p&gt;</comment>
                            <comment id="13252274" author="klevenzs" created="Thu, 12 Apr 2012 07:45:25 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I found another workaround to get rid of this issue:&lt;/p&gt;

&lt;p&gt;public class CXFNonSpringJaxrsServlet2 extends CXFNonSpringJaxrsServlet {&lt;/p&gt;

&lt;p&gt;  static &lt;/p&gt;
{
    // workaround for OSGi environment
    // ensure that the correct JAX-RS implementation is loaded
    RuntimeDelegate runtimeDelegate = new org.apache.cxf.jaxrs.impl.RuntimeDelegateImpl();
    RuntimeDelegate.setInstance(runtimeDelegate);
  }
&lt;p&gt;}&lt;/p&gt;

&lt;p&gt;Maybe you can make this as standard for the original CXFNonSpringJaxrsServlet. &lt;/p&gt;</comment>
                            <comment id="13409374" author="sergey_beryozkin" created="Mon, 9 Jul 2012 12:13:07 +0000"  >&lt;p&gt;Hi Stephan, I added the static initializer to CXFNonSpringJaxrsServlet, thanks &lt;/p&gt;</comment>
                            <comment id="13622164" author="sergey_beryozkin" created="Thu, 4 Apr 2013 13:14:37 +0000"  >&lt;p&gt;FYI, I had to move the static initializer from CXFNonSpringJaxrsServlet to its new subclass, CXFJaxrsRuntimeDelegateServlet, in order to fix the regression reported at &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-4825&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CXF-4825&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Also, check &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-4825:&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CXF-4825:&lt;/a&gt; the idea is to have the runtime not depending on RuntimeDelegate completely and make sure the &apos;foreign&apos; instances like Response are copied, for example, when the application code uses an active RuntimeDelegate. I&apos;m actually hoping that this new CXFJaxrsRuntimeDelegateServlet will prove to be redundant, if not now then soon enough  &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12509709">SMX4-860</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10062"><![CDATA[Moderate]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>219362</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 33 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i05u4n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31978</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>