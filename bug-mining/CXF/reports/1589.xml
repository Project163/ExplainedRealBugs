<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:57:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-4684] SOAPFault message improvement in CXF when there is unchecked NPE</title>
                <link>https://issues.apache.org/jira/browse/CXF-4684</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;When there is unchecked NPE thrown, the SOAPFault in CXF will only throw the &quot;Fault occurred while processing.&quot; message rather than the original NPE message.&lt;/p&gt;

&lt;p&gt;Analysis:&lt;br/&gt;
1. In org.apache.cxf.binding.soap.interceptor.Soap11FaultOutInterceptor and org.apache.cxf.binding.soap.interceptor.Soap12FaultOutInterceptor,&lt;br/&gt;
It will check fault.getMessage() :&lt;br/&gt;
                if (fault.getMessage() != null) {&lt;br/&gt;
                    if (message.get(&quot;forced.faultstring&quot;) != null) &lt;/p&gt;
{
                        writer.writeCharacters((String) message.get(&quot;forced.faultstring&quot;));
                    }
&lt;p&gt; else &lt;/p&gt;
{
                        writer.writeCharacters(fault.getMessage());
                    }

&lt;p&gt;                } else &lt;/p&gt;
{
                    writer.writeCharacters(&quot;Fault occurred while processing.&quot;);
                }
&lt;p&gt;But for NPE, the fault.getMessage() will return null instead of the &quot;java.lang.NullPointerException&quot; in the getMessage() in NPE.&lt;/p&gt;

&lt;p&gt;2. &lt;br/&gt;
Fault.getMessage will return null in the NPE scenario while it&apos;s super class Throwable will not.&lt;br/&gt;
When there is NPE, the message attribute in Fault is null while the detailMessageAtrribute is &quot;java.lang.NullPointerException&quot;.&lt;br/&gt;
Details:&lt;br/&gt;
SoapFault-&amp;gt;Fault-&amp;gt;UncheckedException-&amp;gt;RuntimeException-&amp;gt;Exception-&amp;gt;Throwable. //  SoapFault-&amp;gt;Fault means SoapFault class extends Fault class&lt;br/&gt;
UncheckedException.getMessage:&lt;br/&gt;
    public String getMessage() {&lt;br/&gt;
        if (null != message) &lt;/p&gt;
{
            return message.toString();
        }
&lt;p&gt;        return null;&lt;br/&gt;
    }&lt;br/&gt;
Throwable.getMessage:&lt;br/&gt;
public String getMessage() {&lt;br/&gt;
	return detailMessage;&lt;br/&gt;
}&lt;/p&gt;


</description>
                <environment></environment>
        <key id="12622881">CXF-4684</key>
            <summary>SOAPFault message improvement in CXF when there is unchecked NPE</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ay">Akitoshi Yoshida</assignee>
                                    <reporter username="zhubinbj">Bin Zhu</reporter>
                        <labels>
                    </labels>
                <created>Fri, 7 Dec 2012 09:29:00 +0000</created>
                <updated>Thu, 28 Feb 2013 17:27:22 +0000</updated>
                            <resolved>Sun, 23 Dec 2012 22:47:55 +0000</resolved>
                                    <version>2.6.2</version>
                                    <fixVersion>2.5.8</fixVersion>
                    <fixVersion>2.6.5</fixVersion>
                    <fixVersion>2.7.2</fixVersion>
                                    <component>WS-* Components</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13530421" author="ay" created="Wed, 12 Dec 2012 22:15:48 +0000"  >&lt;p&gt;I was not sure if the jaxws spec section 10.2.2 was implying this faultstring rule of ex.toString() to be used only for unexpected service endpoints excetptions or also for handlers exceptions.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/cxf-dev/201212.mbox/%3CCAF8t5XtpOovD10k-nVGy%2BGbPH1kzVRhn%3D0qnFXdCs1EhrKKbbQ%40mail.gmail.com%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://mail-archives.apache.org/mod_mbox/cxf-dev/201212.mbox/%3CCAF8t5XtpOovD10k-nVGy%2BGbPH1kzVRhn%3D0qnFXdCs1EhrKKbbQ%40mail.gmail.com%3E&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I didn&apos;t get a definitive answer to it.&lt;/p&gt;

&lt;p&gt;I checked what RI 2.2 is doing and it uses toString() for handler exceptions as well.&lt;/p&gt;

&lt;p&gt;So we can resolve this issue by making CXF follow the same rule.&lt;/p&gt;

</comment>
                            <comment id="13530704" author="zhubinbj" created="Thu, 13 Dec 2012 05:47:02 +0000"  >&lt;p&gt;Thanks Aki for the investigation.&lt;br/&gt;
My assumption is that we can fix the issue in UncheckedException.java.&lt;br/&gt;
I attached the patch and can you help review it? &lt;/p&gt;</comment>
                            <comment id="13530894" author="ay" created="Thu, 13 Dec 2012 10:47:39 +0000"  >&lt;p&gt;Hi Bin,&lt;br/&gt;
Thanks for spotting this issue and providing a patch.&lt;/p&gt;

&lt;p&gt;But I don&apos;t think your change in UncheckedException will work if it calls its super&apos;s getMessage() because that is null. You wanted to call toString(), no? However, that will also not work, as this getMessage method is overwritten by its extended class like CXF&apos;s Fault. Besides, UncheckedException is too deep in the layer (almost like java.lang.RuntimeException) and we shouldn&apos;t be touching it to just comply to a rule given for a higher layer like jaxws. &lt;/p&gt;

&lt;p&gt;The change should go into either CXF&apos;s Fault itself or where the soap fault is serialized. I had an impression that changing the soap fault serialization part is simpler than changing Fault itself when I commented on this issue sometime ago at users@cxf. I will look at it again today.&lt;/p&gt;

&lt;p&gt;regards, aki&lt;/p&gt;</comment>
                            <comment id="13532374" author="ay" created="Fri, 14 Dec 2012 15:20:57 +0000"  >&lt;p&gt;Hi Bin,&lt;br/&gt;
I submitted the correction in trunk (2.7.2-SNAPSHOT) and 2.6.x (2.6.5-SNAPSHOT).&lt;br/&gt;
Could you try it out to see if it works for your case?&lt;br/&gt;
Thanks.&lt;br/&gt;
Regards, Aki&lt;/p&gt;</comment>
                            <comment id="13533257" author="zhubinbj" created="Sun, 16 Dec 2012 02:56:28 +0000"  >&lt;p&gt;Hi Aki,&lt;br/&gt;
I tested the code you submitted and it works in my scenario. Thanks.&lt;/p&gt;</comment>
                            <comment id="13533265" author="gmazza" created="Sun, 16 Dec 2012 04:10:16 +0000"  >&lt;p&gt;Wait a second...we&apos;re not returning server-side error specifics to the SOAP client are we?  That would be a security bug, allowing hackers to see the internal implementation of the web service provider.  For unexpected internal errors like NPE&apos;s, database failures, etc. SOAP clients should be getting a generic &quot;Fault occurred while processing&quot; while the server-side log should detail what the specific problem is.&lt;/p&gt;</comment>
                            <comment id="13533793" author="ay" created="Mon, 17 Dec 2012 09:48:09 +0000"  >&lt;p&gt;Hi Glen,&lt;br/&gt;
Yes. This touches exactly that security point. There was a discussion thread started by Bin.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://cxf.547215.n5.nabble.com/SOAPFault-message-improvement-in-CXF-when-there-is-unchecked-NPE-tc5719398.html#a5719568&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cxf.547215.n5.nabble.com/SOAPFault-message-improvement-in-CXF-when-there-is-unchecked-NPE-tc5719398.html#a5719568&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Initially I suggested for the exceptionCauseEnabled property. However, this property only wrote the cause message but not the cause itself (e.g. NPE). In addition, Ivan pointed us to the jaxws spec section 10.2.2 that specifies that the faultstring must come from the cause.toString() in some cases.&lt;/p&gt;

&lt;p&gt;So, I asked at dev@cxf asking the interpretation of this rule.&lt;br/&gt;
&lt;a href=&quot;http://cxf.547215.n5.nabble.com/interpretation-of-jaxws-10-2-2-exception-handling-tc5719946.html#a5720008&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cxf.547215.n5.nabble.com/interpretation-of-jaxws-10-2-2-exception-handling-tc5719946.html#a5720008&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The rest is stated in my comment from Dec 12 above.&lt;/p&gt;

&lt;p&gt;Personally, I think the jaxws spec could have left this toString rule out of its normative part. I am not really concerned about just writing the class name like NPE. But I am more concerned about some unknown user extended runtime exception that overwrites its toString to do more than writing its class name. &lt;/p&gt;

&lt;p&gt;However, this rule is there, so we need to comply to it right? Or supposing the jaxws 10.2.2 itself is a security issue, should we only enable this rule with an option? That was the point of my original question in dev@cxf. Any definitive answers will be appreciated.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;br/&gt;
regards, aki&lt;/p&gt;</comment>
                            <comment id="13533931" author="gmazza" created="Mon, 17 Dec 2012 14:08:45 +0000"  >&lt;p&gt;Hi Aki, sorry I hadn&apos;t gotten to your dev list message, and my knowledge in this area is incomplete.  The fact that the original submitter of this bug wrote &quot;The SOAPFault in CXF will only throw the &apos;Fault occurred while processing.&apos; message rather than the original NPE message.&quot; shows he doesn&apos;t understand the Pen-testing 101 rule &lt;b&gt;not&lt;/b&gt; to pass service-side exception bug details back to the client.  He didn&apos;t mention anything about the JAX-WS specification, so that wasn&apos;t his motivation.&lt;/p&gt;

&lt;p&gt;Why is his motivation important?  Right now, he apparently feels that if you have a database space error, somehow the SOAP client should receive a message like &quot;Wizard RDMBS error: Table AdminAccountName.MY_STUFF on server camel07 is full, please expand more space for it.&quot;  That&apos;s a training issue, and once he understands that&apos;s a no-no, I suspect he would be likely going to request a return to &apos;Fault occurred while processing&apos; again, rather than defend the new implementation based on the apparent rule in JAX-WS 10.2.2.  Very few people indeed truly want service-side error messages propagated back to the client (incidentally, NPEs are embarrassing for all concerned and developers don&apos;t like it when their web service stacks embarrass them to their customers in such a manner.)&lt;/p&gt;

&lt;p&gt;Further, &quot;NullPointerException&quot; is a Java-language construct, while SOAP is language-independent.  There shouldn&apos;t be any need to return Java-language constructs to the client, as that would incorrectly imply the SOAP client base may base logic on the fact that the SOAP service is implemented in Java.&lt;/p&gt;

&lt;p&gt;I&apos;m confused a little about your statement: &quot;But I am more concerned about some unknown user extended runtime exception that overwrites its toString to do more than writing its class name.&quot;  Does this new change &lt;b&gt;facilitate&lt;/b&gt; that (they can override toString() now?) or &lt;b&gt;hinder&lt;/b&gt; that (now if they tried to overwrite it, the client will still get an &quot;NPE&quot; message)?  If the latter, perhaps this change does more good than harm, but if the former, I would say CXF should tighten up and not allow this, to protect systems against sloppier developers putting too much info in their error messages back to the client.&lt;/p&gt;

&lt;p&gt;Anyway, CXF has several masters-&lt;del&gt;the WSDL, JAX-WS, JAX-RS and WS-I Basic Profile (and Basic Security Profile) specs&lt;/del&gt;-and as you know, we can&apos;t serve more than one perfectly.  I believe CXF has already tightened itself up in a few places w.r.t. the WS-I profiles, becoming invalid as a consequence with the more-easygoing WSDL and JAX-WS specs, both of which allow more than what WS-I does.  This would appear to be something where going the safer route rather than strict compliance with any specific JAX-WS rule would appear justified.  I don&apos;t think this change is vetoable but my instinct would be to revert it, because I think its going to happen anyway (someone several months down the road will complain about CXF improperly sending internal error messages to the client) but if you wait several months to revert you may have to deal with backwards compatibility issues of many SOAP clients now incorrectly basing logic based on specific Java class exceptions being returned from the web service provider.&lt;/p&gt;</comment>
                            <comment id="13534099" author="ay" created="Mon, 17 Dec 2012 17:32:35 +0000"  >&lt;p&gt;Hi Glen,&lt;br/&gt;
I agree with you that there is no point in setting the faultstring with e.toString() except under some debugging purpose and the jaxws spec shouldn&apos;t have included this rule. I expressed my concern which you quoted &quot;But I am more ...&quot;. The change does not facilitate nor hinder overriding of the exception. It simply applies this faulstring rule that can lead to not only those internal exception message being exposed as you mentioned but also to some unknown consequences depending on how the toString of the relevant runtime exception is implemented. &lt;/p&gt;

&lt;p&gt;So, I am perfectly fine with optionally enabling this rule using a configuration property. In fact, if there is a vote to take, I choose for this option. Maybe we could reuse the enableCause thing to align its behavior with this jaxws rule under some condition. The current behavior of enableCause thing is not practical in some situations (e.g. when cause.getMessage() is null).&lt;/p&gt;

&lt;p&gt;I&apos;ll look at it again to see what we can do.&lt;br/&gt;
regards, aki&lt;/p&gt;</comment>
                            <comment id="13534306" author="gmazza" created="Mon, 17 Dec 2012 21:08:31 +0000"  >&lt;p&gt;Thanks.  A configuration property seems like a very workable idea; if you go that route you might wish to default it to what it was before this patch was applied, lest we wait and end up needing to default it to the less-secure option out of concern for backwards compatibility.  Also, by keeping &quot;Fault occurred while processing&quot; as the default we can get people wanting something else to show up on the mailing list, where we can (1) inform them of this new property and (2) make sure they are in fact aware that they shouldn&apos;t be sending sensitive internal error messages back to the client (if that is, in fact, their intention.)&lt;/p&gt;</comment>
                            <comment id="13538428" author="ay" created="Fri, 21 Dec 2012 21:28:09 +0000"  >&lt;p&gt;Hi Bin,&lt;br/&gt;
As you probably followed the discussion above, I modified the previous change so that you can still configure CXF to construct the faulstring using cause.toString() for no-message runtime exception without the message but keep us all on the safer side from the security perspective.&lt;/p&gt;

&lt;p&gt;In short, to enable this configuration, you can set the endpoint property exceptionMessageCauseEnabled as described in &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://cxf.apache.org/docs/debugging-and-logging.html#DebuggingandLogging-Stacktraceinfaultdetails&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cxf.apache.org/docs/debugging-and-logging.html#DebuggingandLogging-Stacktraceinfaultdetails&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Programmatically, you can use the following constant from Message, as in&lt;/p&gt;

&lt;p&gt;   ep.getProperties().put(org.apache.cxf.message.Message.EXCEPTION_MESSAGE_CAUSE_ENABLED, &quot;true&quot;)&lt;/p&gt;

&lt;p&gt;I hope you are satisfied with solution.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;br/&gt;
regards, aki&lt;/p&gt;
</comment>
                            <comment id="13538455" author="gmazza" created="Fri, 21 Dec 2012 21:55:26 +0000"  >&lt;p&gt;Thanks for all your attention to this, Aki.  Yoku dekimashita!  &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13539350" author="zhubinbj" created="Tue, 25 Dec 2012 01:26:21 +0000"  >&lt;p&gt;Hi Aki,&lt;br/&gt;
Sorry for the late response. The final changes looks fine for me. Many thanks to all of you.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12560720" name="CXF-4684.patch" size="448" author="zhubinbj" created="Thu, 13 Dec 2012 05:45:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>296458</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 48 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i149jb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>233008</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>