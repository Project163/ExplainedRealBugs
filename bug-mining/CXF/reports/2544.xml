<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 12:15:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CXF-6007] WebClient does not resend request in Digest authentication for HTTP methods GET, HEAD, DELETE, OPTIONS (with no body).</title>
                <link>https://issues.apache.org/jira/browse/CXF-6007</link>
                <project id="12310511" key="CXF">CXF</project>
                    <description>&lt;p&gt;Hi guys,&lt;/p&gt;

&lt;p&gt;I try to send DELETE, GET (auto-redirect disabled), HEAD, OPTIONS or any other HTTP requests with no body used digest authentication to RESTful service. In this case I always get &quot;first&quot; HTTP response with status code 401 - Unathorized but client does not resend &quot;answer&quot; with &quot;WWW-Authenticate&quot; header.&lt;/p&gt;

&lt;p&gt;I had the assumption that the problem arises due to incorrect cache settings in methods:&lt;br/&gt;
1) HTTPConduit.WrappedOutputStream.handleHeadersTrustCaching()&lt;br/&gt;
and&lt;br/&gt;
2) HTTPConduit.WrappedOutputStream.handleRetransmits()).&lt;br/&gt;
in package org.apache.cxf.transport.http.&lt;/p&gt;

&lt;p&gt;Is there any way to be properly authorized by the service (digest mode) in these cases? &lt;/p&gt;

&lt;p&gt;In my application I use, depending on the following versions of products:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;javax.ws.rs-api: 2.0&lt;/li&gt;
	&lt;li&gt;javax.annotation-api: 1.2&lt;/li&gt;
	&lt;li&gt;cxf-core: 3.0.1&lt;/li&gt;
	&lt;li&gt;cxf-rt-rs-client: 3.0.1&lt;/li&gt;
	&lt;li&gt;cxf-rt-frontend-jaxrs: 3.0.1&lt;/li&gt;
	&lt;li&gt;cxf-rt-transports-http: 3.0.1&lt;/li&gt;
	&lt;li&gt;cxf-rt-transports-http-hc: 3.0.1&lt;/li&gt;
	&lt;li&gt;httpasyncclient: 4.0.1&lt;/li&gt;
	&lt;li&gt;httpclient: 4.3.2&lt;/li&gt;
	&lt;li&gt;httpcore: 4.3.2&lt;/li&gt;
	&lt;li&gt;httpcore-nio:4.3.2&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I look forward to your assistance. Thank you.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows 7, jdk1.7.0_65, cxf-rt-transports-http: 3.0.x&lt;/p&gt;</environment>
        <key id="12742111">CXF-6007</key>
            <summary>WebClient does not resend request in Digest authentication for HTTP methods GET, HEAD, DELETE, OPTIONS (with no body).</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sergey_beryozkin">Sergey Beryozkin</assignee>
                                    <reporter username="ParanoidUser">Capt. Cutlass</reporter>
                        <labels>
                    </labels>
                <created>Wed, 17 Sep 2014 11:29:39 +0000</created>
                <updated>Fri, 14 Oct 2016 14:24:01 +0000</updated>
                            <resolved>Thu, 30 Apr 2015 16:04:52 +0000</resolved>
                                    <version>3.0</version>
                    <version>3.0.1</version>
                                    <fixVersion>3.1</fixVersion>
                    <fixVersion>2.7.16</fixVersion>
                    <fixVersion>3.0.5</fixVersion>
                                    <component>JAX-RS</component>
                    <component>Transports</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14138760" author="sergey_beryozkin" created="Thu, 18 Sep 2014 10:18:40 +0000"  >&lt;p&gt;Hi&lt;/p&gt;

&lt;p&gt;Can you clarify please which parts of 1) or 2) may be affecting the digest re-try in case of the empty requests ? &lt;br/&gt;
If you had a chance to debug, what is different there when say a POST with body is done, which does make a digest re-try to succeed ?&lt;/p&gt;

&lt;p&gt;Cheers, Sergey&lt;/p&gt;</comment>
                            <comment id="14138961" author="paranoiduser" created="Thu, 18 Sep 2014 13:49:09 +0000"  >&lt;p&gt;Hi Sergey,&lt;/p&gt;

&lt;p&gt;Thank you for reply.&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt; Can you clarify please which parts of 1) or 2) may be affecting the digest re-try in case of the empty requests ? &lt;br/&gt;
Code is responsible for setting the &quot;WWW-Authenticate&quot; header located in method - authorizationRetransmit(HttpURLConnection connection, Message message, CacheAndWriteOutputStream cachedStream) line: 1047&lt;/p&gt;

&lt;p&gt;If we go up the call stack, we can find that the only one place is it calling this is the method (1).&lt;br/&gt;
So, what I think is wrong that is condition in line: 1448.&lt;/p&gt;

&lt;p&gt;if (cachedStream != null || (&quot;GET&quot;.equals(connection.getRequestMethod()) &amp;amp;&amp;amp; getClient().isAutoRedirect())) {&lt;br/&gt;
 ...&lt;br/&gt;
connection = processRetransmit(connection, outMessage, cachedStream); &lt;br/&gt;
 ...&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;It allows retransmits (needed for digest authorization) only for HTTP methods whose body is cached (like POST and PUT) or GET method, provided that the auto-redirection is enabled.&lt;/p&gt;

&lt;p&gt;Code responsible for caching (creating cachedStream) located in the method (2) line: 1353.&lt;/p&gt;

&lt;p&gt;...&lt;br/&gt;
if (!&quot;POST&quot;.equals(connection.getRequestMethod()) &amp;amp;&amp;amp; !&quot;PUT&quot;.equals(connection.getRequestMethod())) {&lt;br/&gt;
    return;&lt;br/&gt;
}&lt;br/&gt;
if (outMessage.get(&quot;org.apache.cxf.post.empty&quot;) != null) {&lt;br/&gt;
    return;&lt;br/&gt;
}&lt;br/&gt;
if (cachingForRetransmission) {&lt;br/&gt;
    cachedStream =  new CacheAndWriteOutputStream(connection.getOutputStream());&lt;br/&gt;
    wrappedStream = cachedStream;&lt;br/&gt;
} else {&lt;br/&gt;
     wrappedStream = connection.getOutputStream();&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;If you had a chance to debug, what is different there when say a POST with body is done, which does make a digest re-try to succeed ?&lt;br/&gt;
In this part of code we can see that cachedStream create only for POST and PUT methods with not empty body. This is the difference.&lt;/p&gt;

&lt;p&gt;Thanks and regards,&lt;br/&gt;
Dmitriy.&lt;/p&gt;</comment>
                            <comment id="14143084" author="sergey_beryozkin" created="Mon, 22 Sep 2014 10:44:13 +0000"  >&lt;p&gt;thanks, I updated the code to allow for the retransmits for well-known HTTP verbs with no request content provided a given auth supplier allows for it, Digest and Spnego providers provide &apos;indirect&apos; hints via its requiresRequestCaching method &lt;/p&gt;</comment>
                            <comment id="14143250" author="paranoiduser" created="Mon, 22 Sep 2014 14:34:58 +0000"  >&lt;p&gt;Many thanks for a work. Could you please provide me information when will be available a 3.0.2 or 3.1.0 version for maven?&lt;/p&gt;</comment>
                            <comment id="14143279" author="sergey_beryozkin" created="Mon, 22 Sep 2014 15:04:19 +0000"  >&lt;p&gt;3.0.2 may be available end of this week or some time next week, depends on when Dan start the relesse process...&lt;/p&gt;

&lt;p&gt;Try 3.0.2-SNAPSHOT, if you can test it before the release then it will help to validate the fix actually works&lt;/p&gt;</comment>
                            <comment id="14143286" author="dkulp" created="Mon, 22 Sep 2014 15:09:32 +0000"  >&lt;p&gt;We need to get some releases of Santuario and WSS4J first.  Waiting on some confirmations of some important fixes at those levels.  Thus, likely a little longer. &lt;/p&gt;</comment>
                            <comment id="14338724" author="prasad.deshpande" created="Thu, 26 Feb 2015 17:23:35 +0000"  >&lt;p&gt;Hi Dan &amp;amp; Sergey,&lt;/p&gt;

&lt;p&gt;I see that you fixed this issue in v3.0.2. I also see that KNOWN_HTTP_VERBS_WITH_NO_CONTENT =&amp;gt; &lt;/p&gt;
{&quot;GET&quot;, &quot;HEAD&quot;, &quot;OPTIONS&quot;, &quot;TRACE&quot;}

&lt;p&gt;But I still have problem with DELETE &amp;amp; POST (empty message body) requests. Could you please check if this is a bug?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Prasad&lt;/p&gt;</comment>
                            <comment id="14339245" author="sergey_beryozkin" created="Thu, 26 Feb 2015 21:54:48 +0000"  >&lt;p&gt;Hmm, may be the whole condition there should be changed from:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void handleRetransmits() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
            &lt;span class=&quot;code-comment&quot;&gt;// If we have a cachedStream, we are caching the request.
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (cachedStream != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
                || KNOWN_HTTP_VERBS_WITH_NO_CONTENT.contains(getMethod()) 
                   &amp;amp;&amp;amp; (getClient().isAutoRedirect()) 
                       || authSupplier != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; authSupplier.requiresRequestCaching()) {
   &lt;span class=&quot;code-comment&quot;&gt;//....
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;to&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void handleRetransmits() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
            &lt;span class=&quot;code-comment&quot;&gt;// If we have a cachedStream, we are caching the request.
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (cachedStream != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
                || 
                (getClient().isAutoRedirect() &amp;amp;&amp;amp;   KNOWN_HTTP_VERBS_WITH_NO_CONTENT.contains(getMethod())) 
                 || 
                 (authSupplier != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; authSupplier.requiresRequestCaching())) {
   &lt;span class=&quot;code-comment&quot;&gt;//....
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;so if the cachedStream != null or it is an auto-redirect and it is a retrieval method or if the authSupplier just requires caching&lt;/p&gt;</comment>
                            <comment id="14339909" author="prasad.deshpande" created="Fri, 27 Feb 2015 09:05:20 +0000"  >&lt;p&gt;Is there a way I can re-open this jira or do I have to file separate one?&lt;/p&gt;</comment>
                            <comment id="14340047" author="sergey_beryozkin" created="Fri, 27 Feb 2015 11:54:23 +0000"  >&lt;p&gt;Hi - I guess this should be reopened because it refers to DELETE and the fix I did was incomplete, I&apos;ll reopen it, thanks&lt;/p&gt;</comment>
                            <comment id="14340058" author="sergey_beryozkin" created="Fri, 27 Feb 2015 11:55:01 +0000"  >&lt;p&gt;DELETE and empty POST (PUT) are still not handled&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 38 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i205iv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>