{"url":"https://api.github.com/repos/redis/go-redis/issues/1386","repository_url":"https://api.github.com/repos/redis/go-redis","labels_url":"https://api.github.com/repos/redis/go-redis/issues/1386/labels{/name}","comments_url":"https://api.github.com/repos/redis/go-redis/issues/1386/comments","events_url":"https://api.github.com/repos/redis/go-redis/issues/1386/events","html_url":"https://github.com/redis/go-redis/issues/1386","id":644062549,"node_id":"MDU6SXNzdWU2NDQwNjI1NDk=","number":1386,"title":"v7 transaction pipeline returns incorrect results sometimes","user":{"login":"ambersmit","id":59581997,"node_id":"MDQ6VXNlcjU5NTgxOTk3","avatar_url":"https://avatars.githubusercontent.com/u/59581997?v=4","gravatar_id":"","url":"https://api.github.com/users/ambersmit","html_url":"https://github.com/ambersmit","followers_url":"https://api.github.com/users/ambersmit/followers","following_url":"https://api.github.com/users/ambersmit/following{/other_user}","gists_url":"https://api.github.com/users/ambersmit/gists{/gist_id}","starred_url":"https://api.github.com/users/ambersmit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ambersmit/subscriptions","organizations_url":"https://api.github.com/users/ambersmit/orgs","repos_url":"https://api.github.com/users/ambersmit/repos","events_url":"https://api.github.com/users/ambersmit/events{/privacy}","received_events_url":"https://api.github.com/users/ambersmit/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2020-06-23T18:42:47Z","updated_at":"2020-09-18T06:09:23Z","closed_at":"2020-09-18T06:09:23Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Trying to upgrade to v7.4.0 from v6.15.2 but I am running into issues with the new transaction pipeline code. \r\n\r\nWhen executing the transaction pipeline, I am sometimes getting the MULTI StatusCmd back in our result set now. Before, I would always just get back the BoolCmds. Now it seems that in certain situations I lose one of the BoolCmds I should be getting back and instead get a StatusCmd back of the MULTI command.  \r\n\r\nI am using the Client in redis.go and initializing the transactional pipeline by calling the func TxPipeline() on that client. \r\nUsing that pipeline, I then add each item. See example code below. \r\n\r\n```\r\npipe := client.TxPipeline()\r\n\r\n// for each item I issue the SetNX\r\npipe.SetNX(key, value, expiration)\r\n\r\nresponse, err := pipe.Exec()\r\n```\r\n\r\nIf no error is returned, I then loop through the response array of []redis.Cmder's. This array is where I am having the issue. Before it would always just return BoolCmd's where as now it seems to sometimes return the first item as the StatusCmd from the MULTI cmd. So, when I had 6 items to set in redis, I got back 6 items in the response array but the first would be StatusCmd and the remaining 5 would be BoolCmds. I'd be missing one BoolCmd and have an extra StatusCmd that I don't expect.\r\n\r\nIt doesn't seem to always happen though... another time when I had 7 items to set in redis, I correctly got back all 7 items and they were all BoolCmds. \r\n\r\nAdditionally, from my testing I believe this might be the problem commit: 218b17f0fc567ce62f7d6d0607caff1d8100354f \r\nWhen I test with commit 709e543f16bf20d4f6df33bc7d24fb4b6a0991bc I don't see this issue. ","closed_by":{"login":"vmihailenco","id":290976,"node_id":"MDQ6VXNlcjI5MDk3Ng==","avatar_url":"https://avatars.githubusercontent.com/u/290976?v=4","gravatar_id":"","url":"https://api.github.com/users/vmihailenco","html_url":"https://github.com/vmihailenco","followers_url":"https://api.github.com/users/vmihailenco/followers","following_url":"https://api.github.com/users/vmihailenco/following{/other_user}","gists_url":"https://api.github.com/users/vmihailenco/gists{/gist_id}","starred_url":"https://api.github.com/users/vmihailenco/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vmihailenco/subscriptions","organizations_url":"https://api.github.com/users/vmihailenco/orgs","repos_url":"https://api.github.com/users/vmihailenco/repos","events_url":"https://api.github.com/users/vmihailenco/events{/privacy}","received_events_url":"https://api.github.com/users/vmihailenco/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/redis/go-redis/issues/1386/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/redis/go-redis/issues/1386/timeline","performed_via_github_app":null,"state_reason":"completed"}