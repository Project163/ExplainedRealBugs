{"url":"https://api.github.com/repos/redis/go-redis/issues/135","repository_url":"https://api.github.com/repos/redis/go-redis","labels_url":"https://api.github.com/repos/redis/go-redis/issues/135/labels{/name}","comments_url":"https://api.github.com/repos/redis/go-redis/issues/135/comments","events_url":"https://api.github.com/repos/redis/go-redis/issues/135/events","html_url":"https://github.com/redis/go-redis/issues/135","id":94685777,"node_id":"MDU6SXNzdWU5NDY4NTc3Nw==","number":135,"title":"nil dereference in singleConnPool","user":{"login":"abustany","id":2526296,"node_id":"MDQ6VXNlcjI1MjYyOTY=","avatar_url":"https://avatars.githubusercontent.com/u/2526296?v=4","gravatar_id":"","url":"https://api.github.com/users/abustany","html_url":"https://github.com/abustany","followers_url":"https://api.github.com/users/abustany/followers","following_url":"https://api.github.com/users/abustany/following{/other_user}","gists_url":"https://api.github.com/users/abustany/gists{/gist_id}","starred_url":"https://api.github.com/users/abustany/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abustany/subscriptions","organizations_url":"https://api.github.com/users/abustany/orgs","repos_url":"https://api.github.com/users/abustany/repos","events_url":"https://api.github.com/users/abustany/events{/privacy}","received_events_url":"https://api.github.com/users/abustany/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2015-07-13T09:59:18Z","updated_at":"2015-07-13T10:52:28Z","closed_at":"2015-07-13T10:51:24Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Using 2cfe5df7d2593e20161594e4c02ebb305c9ccd8e , we do get the following panic (I replaced the workspace path by XXX):\n\n```\n[signal 0xb code=0x1 addr=0x50 pc=0x652f55]\ngoroutine 1657784 [running]:\ngopkg.in/redis%2ev3.(*singleConnPool).remove(0xc209555500, 0x0, 0x0)\n    XXX/src/gopkg.in/redis.v3/pool.go:396 +0x55\ngopkg.in/redis%2ev3.(*singleConnPool).Remove(0xc209555500, 0xc20a3217a0, 0x0, 0x0)\n    XXX/src/gopkg.in/redis.v3/pool.go:392 +0x168\ngopkg.in/redis%2ev3.(*baseClient).putConn(0xc2087b7640, 0xc20a3217a0, 0x7ff04bdbc050, 0xc20bc2b400)\n    XXX/src/gopkg.in/redis.v3/redis.go:32 +0x250\ngopkg.in/redis%2ev3.(*baseClient).process(0xc2087b7640, 0x7ff04bda98e0, 0xc2098a6230)\n    XXX/src/gopkg.in/redis.v3/redis.go:73 +0x2cc\ngopkg.in/redis%2ev3.*baseClient.(gopkg.in/redis%2ev3.process)·fm(0x7ff04bda98e0, 0xc2098a6230)\n    XXX/src/gopkg.in/redis.v3/redis.go:185 +0x3b\ngopkg.in/redis%2ev3.(*commandable).Process(0xc2091ee808, 0x7ff04bda98e0, 0xc2098a6230)\n    XXX/src/gopkg.in/redis.v3/commands.go:30 +0x3b\ngopkg.in/redis%2ev3.(*commandable).Select(0xc2091ee808, 0x22a, 0xc209555500)\n    XXX/src/gopkg.in/redis.v3/commands.go:84 +0x11d\ngopkg.in/redis%2ev3.(*conn).init(0xc20a3217a0, 0xc208162180, 0x0, 0x0)\n    XXX/src/gopkg.in/redis.v3/conn.go:59 +0x225\ngopkg.in/redis%2ev3.func·001(0xc208131c60, 0x0, 0x0)\n    XXX/src/gopkg.in/redis.v3/conn.go:36 +0x1fb\ngopkg.in/redis%2ev3.(*connPool).new(0xc2086325c0, 0x0, 0x0, 0x0)\n    XXX/src/gopkg.in/redis.v3/pool.go:205 +0x169\n```\n\nThis was with a Redis instance that was melting down (latencies above 5 seconds), and `options.ReadTimeout == options.WriteTimeout == 5 * time.Second`.\n\nWe do use many databases on this server, so my guess is that the `Select()` in `conn.init` failed, and lead to the connection being closed. Because the `singleConnPool` in `cn.init` is created with a nil pool, `remove()` does a nil dereference.\n","closed_by":{"login":"vmihailenco","id":290976,"node_id":"MDQ6VXNlcjI5MDk3Ng==","avatar_url":"https://avatars.githubusercontent.com/u/290976?v=4","gravatar_id":"","url":"https://api.github.com/users/vmihailenco","html_url":"https://github.com/vmihailenco","followers_url":"https://api.github.com/users/vmihailenco/followers","following_url":"https://api.github.com/users/vmihailenco/following{/other_user}","gists_url":"https://api.github.com/users/vmihailenco/gists{/gist_id}","starred_url":"https://api.github.com/users/vmihailenco/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vmihailenco/subscriptions","organizations_url":"https://api.github.com/users/vmihailenco/orgs","repos_url":"https://api.github.com/users/vmihailenco/repos","events_url":"https://api.github.com/users/vmihailenco/events{/privacy}","received_events_url":"https://api.github.com/users/vmihailenco/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/redis/go-redis/issues/135/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/redis/go-redis/issues/135/timeline","performed_via_github_app":null,"state_reason":"completed"}