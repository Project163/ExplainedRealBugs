{"url":"https://api.github.com/repos/redis/go-redis/issues/575","repository_url":"https://api.github.com/repos/redis/go-redis","labels_url":"https://api.github.com/repos/redis/go-redis/issues/575/labels{/name}","comments_url":"https://api.github.com/repos/redis/go-redis/issues/575/comments","events_url":"https://api.github.com/repos/redis/go-redis/issues/575/events","html_url":"https://github.com/redis/go-redis/issues/575","id":234299154,"node_id":"MDU6SXNzdWUyMzQyOTkxNTQ=","number":575,"title":"Pub/Sub example no longer working","user":{"login":"holladay-io","id":5393606,"node_id":"MDQ6VXNlcjUzOTM2MDY=","avatar_url":"https://avatars.githubusercontent.com/u/5393606?v=4","gravatar_id":"","url":"https://api.github.com/users/holladay-io","html_url":"https://github.com/holladay-io","followers_url":"https://api.github.com/users/holladay-io/followers","following_url":"https://api.github.com/users/holladay-io/following{/other_user}","gists_url":"https://api.github.com/users/holladay-io/gists{/gist_id}","starred_url":"https://api.github.com/users/holladay-io/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/holladay-io/subscriptions","organizations_url":"https://api.github.com/users/holladay-io/orgs","repos_url":"https://api.github.com/users/holladay-io/repos","events_url":"https://api.github.com/users/holladay-io/events{/privacy}","received_events_url":"https://api.github.com/users/holladay-io/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":11,"created_at":"2017-06-07T18:20:38Z","updated_at":"2017-07-01T10:54:11Z","closed_at":"2017-07-01T10:54:11Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"The latest updates changed pub/sub functionality. The example no longer works. The following will block waiting for messages and not pick up the first message.\r\n\r\n```\r\npackage main\r\n\r\nimport (\r\n\"fmt\"\r\n\"github.com/go-redis/redis\"\r\n)\r\n\r\nfunc main() {\r\n\tclient := redis.NewClient(&redis.Options{\r\n\t\tAddr:     \"127.0.0.1:6379\",\r\n\t\t})\r\n\tdefer client.Close()\r\n\r\n\tpubsub := client.Subscribe(\"mychannel1\")\r\n\tdefer pubsub.Close()\r\n\r\n\terr := client.Publish(\"mychannel1\", \"hello\").Err()\r\n\tif err != nil {\r\n\t\tpanic(err)\r\n\t}\r\n\r\n\tmsg, err := pubsub.ReceiveMessage()\r\n\tif err != nil {\r\n\t\tpanic(err)\r\n\t}\r\n\r\n\tfmt.Println(msg.Channel, msg.Payload)\r\n}\r\n```\r\n\r\nThe subscriber must call `ReceiveMessage()` before publishing the message. This will produce the expected output.\r\n\r\n```\r\npackage main\r\n\r\nimport (\r\n\"fmt\"\r\n\"github.com/go-redis/redis\"\r\n)\r\n\r\nfunc main() {\r\n\tclient := redis.NewClient(&redis.Options{\r\n\t\tAddr:     \"127.0.0.1:6379\",\r\n\t\t})\r\n\tdefer client.Close()\r\n\r\n\tpubsub := client.Subscribe(\"mychannel1\")\r\n\tdefer pubsub.Close()\r\n\r\n\tgo func() {\r\n\t\tmsg, err := pubsub.ReceiveMessage()\r\n\t\tif err != nil {\r\n\t\t\tpanic(err)\r\n\t\t}\r\n\r\n\t\tfmt.Println(msg.Channel, msg.Payload)\r\n\t}()\r\n\terr := client.Publish(\"mychannel1\", \"hello\").Err()\r\n\tif err != nil {\r\n\t\tpanic(err)\r\n\t}\r\n}\r\n```\r\n\r\nIf this is the desired behavior the docs should be updated to reflect the changes","closed_by":{"login":"vmihailenco","id":290976,"node_id":"MDQ6VXNlcjI5MDk3Ng==","avatar_url":"https://avatars.githubusercontent.com/u/290976?v=4","gravatar_id":"","url":"https://api.github.com/users/vmihailenco","html_url":"https://github.com/vmihailenco","followers_url":"https://api.github.com/users/vmihailenco/followers","following_url":"https://api.github.com/users/vmihailenco/following{/other_user}","gists_url":"https://api.github.com/users/vmihailenco/gists{/gist_id}","starred_url":"https://api.github.com/users/vmihailenco/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vmihailenco/subscriptions","organizations_url":"https://api.github.com/users/vmihailenco/orgs","repos_url":"https://api.github.com/users/vmihailenco/repos","events_url":"https://api.github.com/users/vmihailenco/events{/privacy}","received_events_url":"https://api.github.com/users/vmihailenco/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/redis/go-redis/issues/575/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/redis/go-redis/issues/575/timeline","performed_via_github_app":null,"state_reason":"completed"}