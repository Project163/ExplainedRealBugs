{"url":"https://api.github.com/repos/redis/go-redis/issues/3424","repository_url":"https://api.github.com/repos/redis/go-redis","labels_url":"https://api.github.com/repos/redis/go-redis/issues/3424/labels{/name}","comments_url":"https://api.github.com/repos/redis/go-redis/issues/3424/comments","events_url":"https://api.github.com/repos/redis/go-redis/issues/3424/events","html_url":"https://github.com/redis/go-redis/issues/3424","id":3212495249,"node_id":"I_kwDOAE8G286_esmR","number":3424,"title":"OpenTelemetry metrics create a memory leak when using ephemeral redis clients","user":{"login":"rokn","id":4174764,"node_id":"MDQ6VXNlcjQxNzQ3NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/4174764?v=4","gravatar_id":"","url":"https://api.github.com/users/rokn","html_url":"https://github.com/rokn","followers_url":"https://api.github.com/users/rokn/followers","following_url":"https://api.github.com/users/rokn/following{/other_user}","gists_url":"https://api.github.com/users/rokn/gists{/gist_id}","starred_url":"https://api.github.com/users/rokn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rokn/subscriptions","organizations_url":"https://api.github.com/users/rokn/orgs","repos_url":"https://api.github.com/users/rokn/repos","events_url":"https://api.github.com/users/rokn/events{/privacy}","received_events_url":"https://api.github.com/users/rokn/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"htemelski-redis","id":214086837,"node_id":"U_kgDODMK0tQ","avatar_url":"https://avatars.githubusercontent.com/u/214086837?v=4","gravatar_id":"","url":"https://api.github.com/users/htemelski-redis","html_url":"https://github.com/htemelski-redis","followers_url":"https://api.github.com/users/htemelski-redis/followers","following_url":"https://api.github.com/users/htemelski-redis/following{/other_user}","gists_url":"https://api.github.com/users/htemelski-redis/gists{/gist_id}","starred_url":"https://api.github.com/users/htemelski-redis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/htemelski-redis/subscriptions","organizations_url":"https://api.github.com/users/htemelski-redis/orgs","repos_url":"https://api.github.com/users/htemelski-redis/repos","events_url":"https://api.github.com/users/htemelski-redis/events{/privacy}","received_events_url":"https://api.github.com/users/htemelski-redis/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"htemelski-redis","id":214086837,"node_id":"U_kgDODMK0tQ","avatar_url":"https://avatars.githubusercontent.com/u/214086837?v=4","gravatar_id":"","url":"https://api.github.com/users/htemelski-redis","html_url":"https://github.com/htemelski-redis","followers_url":"https://api.github.com/users/htemelski-redis/followers","following_url":"https://api.github.com/users/htemelski-redis/following{/other_user}","gists_url":"https://api.github.com/users/htemelski-redis/gists{/gist_id}","starred_url":"https://api.github.com/users/htemelski-redis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/htemelski-redis/subscriptions","organizations_url":"https://api.github.com/users/htemelski-redis/orgs","repos_url":"https://api.github.com/users/htemelski-redis/repos","events_url":"https://api.github.com/users/htemelski-redis/events{/privacy}","received_events_url":"https://api.github.com/users/htemelski-redis/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":1,"created_at":"2025-07-08T13:07:22Z","updated_at":"2025-07-24T09:48:35Z","closed_at":"2025-07-24T09:48:35Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Issue tracker is used for reporting bugs and discussing new features. Please use\n[stackoverflow](https://stackoverflow.com) for supporting issues.\n\n<!--- Provide a general summary of the issue in the Title above -->\n\n## Expected Behavior\n\n<!--- Tell us what should happen -->\nWhen closing a redis client the open telemetry should stop observing it. Another option is to provide a way to unregister the listener\n\n## Current Behavior\n\nCurrently when instrumenting a redis client there is no way to stop observing it using the otel metrics. This also creates a hanging pointer to the redis client instance which can create memory leaks if the application creates many redis client instances.\n\n## Possible Solution\n\n1. Automatically stop observing the client when it's closed / destroyed in any way. (Prefferred option)\n2. Provide a way for manual stoping of the instrumentation\n\n## Steps to Reproduce\n\nhttps://gist.github.com/rokn/8939cf0be0a70f873801f030218709a3\nThe gist provided is a minimal example which can demonstrate the issue.\n\n1. Run the above gist\n2. check localhost:8080/metrics `curl localhost:8080/metrics | grep db_client_connections_usage`\n\nIt has metrics for both clients.\n3. Wait 10 secs\n\nAfter the clients are closed the connections are 0 as expected but the metrics are still there(and the clients that provide those metrics)\n\n## Context (Environment)\n\nWe are creating many redis connections (1000+) and are sometimes closing them and need to cleanly discard these instances from memory and the metrics they \"provide\"\n","closed_by":{"login":"ndyakov","id":1547186,"node_id":"MDQ6VXNlcjE1NDcxODY=","avatar_url":"https://avatars.githubusercontent.com/u/1547186?v=4","gravatar_id":"","url":"https://api.github.com/users/ndyakov","html_url":"https://github.com/ndyakov","followers_url":"https://api.github.com/users/ndyakov/followers","following_url":"https://api.github.com/users/ndyakov/following{/other_user}","gists_url":"https://api.github.com/users/ndyakov/gists{/gist_id}","starred_url":"https://api.github.com/users/ndyakov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ndyakov/subscriptions","organizations_url":"https://api.github.com/users/ndyakov/orgs","repos_url":"https://api.github.com/users/ndyakov/repos","events_url":"https://api.github.com/users/ndyakov/events{/privacy}","received_events_url":"https://api.github.com/users/ndyakov/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/redis/go-redis/issues/3424/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/redis/go-redis/issues/3424/timeline","performed_via_github_app":null,"state_reason":"completed"}