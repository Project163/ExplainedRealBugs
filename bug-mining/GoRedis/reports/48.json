{"url":"https://api.github.com/repos/redis/go-redis/issues/2681","repository_url":"https://api.github.com/repos/redis/go-redis","labels_url":"https://api.github.com/repos/redis/go-redis/issues/2681/labels{/name}","comments_url":"https://api.github.com/repos/redis/go-redis/issues/2681/comments","events_url":"https://api.github.com/repos/redis/go-redis/issues/2681/events","html_url":"https://github.com/redis/go-redis/issues/2681","id":1867596538,"node_id":"I_kwDOAE8G285vUUL6","number":2681,"title":"Options.CredentialsProvider should support Context and returning an error","user":{"login":"maerlyn5","id":826268,"node_id":"MDQ6VXNlcjgyNjI2OA==","avatar_url":"https://avatars.githubusercontent.com/u/826268?v=4","gravatar_id":"","url":"https://api.github.com/users/maerlyn5","html_url":"https://github.com/maerlyn5","followers_url":"https://api.github.com/users/maerlyn5/followers","following_url":"https://api.github.com/users/maerlyn5/following{/other_user}","gists_url":"https://api.github.com/users/maerlyn5/gists{/gist_id}","starred_url":"https://api.github.com/users/maerlyn5/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maerlyn5/subscriptions","organizations_url":"https://api.github.com/users/maerlyn5/orgs","repos_url":"https://api.github.com/users/maerlyn5/repos","events_url":"https://api.github.com/users/maerlyn5/events{/privacy}","received_events_url":"https://api.github.com/users/maerlyn5/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2023-08-25T19:41:04Z","updated_at":"2024-05-31T21:20:53Z","closed_at":"2024-05-29T02:55:30Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Expected Behavior\r\n\r\nThe interface for `Options.CredentialsProvider` should be `func(ctx context.Context) (username string, password string, err error)`\r\n\r\n`baseClient.initConn` should return any error from `Options.CredentialsProvider`\r\n\r\n## Current Behavior\r\n\r\n`Options.CredentialsProvider` doesn't support context and doesn't pass errors down the call chain.\r\n\r\n## Context (Environment)\r\n\r\nI want to use Options.CredentialsProvider to implement dynamic password fetching from cloud providers. e.g. https://github.com/redis/go-redis/discussions/2343\r\n\r\n## Detailed Description\r\n\r\nLooking at the original commit https://github.com/redis/go-redis/pull/2097, the intent of CredentialsProvider seems to be to memory scrub plaintext passwords, but now people want to use it to dynamically fetch passwords from cloud providers. As the library generally supports Context, i'll skip the explanation for why its idiomatic and appropriate to pass context into code that is intended to make network requests. This would be a breaking change and require a version increment.\r\n\r\n## Possible Implementation\r\n\r\n`CredentialsProvider func(ctx context.Context) (username string, password string, err error)`\r\n\r\n\r\n```\r\nfunc (c *baseClient) initConn(ctx context.Context, cn *pool.Conn) error {\r\n\tif cn.Inited {\r\n\t\treturn nil\r\n\t}\r\n\tcn.Inited = true\r\n\tusername, password := c.opt.Username, c.opt.Password\r\n\tif c.opt.CredentialsProvider != nil {\r\n\t\tvar credentialsProviderErr error\r\n\t\tusername, password, credentialsProviderErr = c.opt.CredentialsProvider(ctx)\r\n\t\tif credentialsProviderErr != nil {\r\n\t\t\treturn credentialsProviderErr\r\n\t\t}\r\n\t}\r\n..\r\n}\r\n```\r\n","closed_by":{"login":"monkey92t","id":23448594,"node_id":"MDQ6VXNlcjIzNDQ4NTk0","avatar_url":"https://avatars.githubusercontent.com/u/23448594?v=4","gravatar_id":"","url":"https://api.github.com/users/monkey92t","html_url":"https://github.com/monkey92t","followers_url":"https://api.github.com/users/monkey92t/followers","following_url":"https://api.github.com/users/monkey92t/following{/other_user}","gists_url":"https://api.github.com/users/monkey92t/gists{/gist_id}","starred_url":"https://api.github.com/users/monkey92t/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/monkey92t/subscriptions","organizations_url":"https://api.github.com/users/monkey92t/orgs","repos_url":"https://api.github.com/users/monkey92t/repos","events_url":"https://api.github.com/users/monkey92t/events{/privacy}","received_events_url":"https://api.github.com/users/monkey92t/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/redis/go-redis/issues/2681/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/redis/go-redis/issues/2681/timeline","performed_via_github_app":null,"state_reason":"completed"}