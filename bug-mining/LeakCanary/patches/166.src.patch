diff --git a/leakcanary-android-core/src/main/java/leakcanary/internal/LeakDirectoryProvider.kt b/leakcanary-android-core/src/main/java/leakcanary/internal/LeakDirectoryProvider.kt
index 0070a4f8f..c971e26b3 100644
--- a/leakcanary-android-core/src/main/java/leakcanary/internal/LeakDirectoryProvider.kt
+++ b/leakcanary-android-core/src/main/java/leakcanary/internal/LeakDirectoryProvider.kt
@@ -101,23 +101,6 @@ internal class LeakDirectoryProvider constructor(
     return File(storageDirectory, fileName)
   }
 
-  fun clearLeakDirectory() {
-    val allFilesExceptPending =
-      listFiles(FilenameFilter { _, filename ->
-        true
-      })
-    for (file in allFilesExceptPending) {
-      val path = file.absolutePath
-      val deleted = file.delete()
-      if (deleted) {
-        filesDeletedClearDirectory += path
-      }
-      if (!deleted) {
-        SharkLog.d { "Could not delete file ${file.path}" }
-      }
-    }
-  }
-
   @TargetApi(M) fun hasStoragePermission(): Boolean {
     if (SDK_INT < M) {
       return true
@@ -201,7 +184,6 @@ internal class LeakDirectoryProvider constructor(
   companion object {
 
     private val filesDeletedTooOld = mutableListOf<String>()
-    private val filesDeletedClearDirectory = mutableListOf<String>()
     val filesDeletedRemoveLeak = mutableListOf<String>()
 
     private const val HPROF_SUFFIX = ".hprof"
@@ -210,7 +192,6 @@ internal class LeakDirectoryProvider constructor(
       val path = file.absolutePath
       return when {
         filesDeletedTooOld.contains(path) -> "older than all other hprof files"
-        filesDeletedClearDirectory.contains(path) -> "hprof directory cleared"
         filesDeletedRemoveLeak.contains(path) -> "leak manually removed"
         else -> "unknown"
       }
diff --git a/leakcanary-android-core/src/main/java/leakcanary/internal/activity/db/HeapAnalysisTable.kt b/leakcanary-android-core/src/main/java/leakcanary/internal/activity/db/HeapAnalysisTable.kt
index 9a13a92e9..2dbb4ab19 100644
--- a/leakcanary-android-core/src/main/java/leakcanary/internal/activity/db/HeapAnalysisTable.kt
+++ b/leakcanary-android-core/src/main/java/leakcanary/internal/activity/db/HeapAnalysisTable.kt
@@ -3,7 +3,6 @@ package leakcanary.internal.activity.db
 import android.content.ContentValues
 import android.database.sqlite.SQLiteDatabase
 import android.os.AsyncTask
-import leakcanary.internal.InternalLeakCanary
 import leakcanary.internal.LeakDirectoryProvider
 import leakcanary.internal.Serializables
 import leakcanary.internal.toByteArray
@@ -140,11 +139,34 @@ internal object HeapAnalysisTable {
   }
 
   fun deleteAll(db: SQLiteDatabase) {
-    val leakDirectoryProvider = InternalLeakCanary.leakDirectoryProvider
-    AsyncTask.SERIAL_EXECUTOR.execute { leakDirectoryProvider.clearLeakDirectory() }
     db.inTransaction {
-      db.delete("heap_analysis", null, null)
-      LeakTable.deleteAll(db)
+      rawQuery(
+          """
+              SELECT
+              id,
+              object
+              FROM heap_analysis
+              """, null
+      )
+          .use { cursor ->
+            val all = mutableListOf<Pair<Long, HeapAnalysis>>()
+            while (cursor.moveToNext()) {
+              val id = cursor.getLong(0)
+              val analysis = Serializables.fromByteArray<HeapAnalysis>(cursor.getBlob(1))
+              if (analysis != null) {
+                all += id to analysis
+              }
+            }
+            all.forEach { (id, _) ->
+              db.delete("heap_analysis", "id=$id", null)
+              LeakTable.deleteByHeapAnalysisId(db, id)
+            }
+            AsyncTask.SERIAL_EXECUTOR.execute {
+              all.forEach { (_, analysis) ->
+                analysis.heapDumpFile.delete()
+              }
+            }
+          }
     }
   }
 
diff --git a/leakcanary-android-core/src/main/java/leakcanary/internal/activity/db/LeakTable.kt b/leakcanary-android-core/src/main/java/leakcanary/internal/activity/db/LeakTable.kt
index e0c892e47..c6922060f 100644
--- a/leakcanary-android-core/src/main/java/leakcanary/internal/activity/db/LeakTable.kt
+++ b/leakcanary-android-core/src/main/java/leakcanary/internal/activity/db/LeakTable.kt
@@ -215,9 +215,4 @@ internal object LeakTable {
       WHERE leak.id = lt.leak_id)
     """)
   }
-
-  fun deleteAll(db: SQLiteDatabase) {
-    db.delete("leak", null, null)
-    LeakTraceTable.deleteAll(db)
-  }
 }
\ No newline at end of file
