diff --git a/.travis.yml b/.travis.yml
index daa632c11..a7994d30b 100644
--- a/.travis.yml
+++ b/.travis.yml
@@ -28,6 +28,7 @@ before_script:
   - adb shell input keyevent 82
 
 script:
+  - ./gradlew leakcanary-android-core:connectedCheck --stacktrace
   - ./gradlew leakcanary-android-instrumentation:connectedCheck --stacktrace
 
 after_success:
diff --git a/leakcanary-android-core/build.gradle b/leakcanary-android-core/build.gradle
index 387dfe7d2..66b5f7da4 100644
--- a/leakcanary-android-core/build.gradle
+++ b/leakcanary-android-core/build.gradle
@@ -12,6 +12,8 @@ dependencies {
   testImplementation deps.junit
   testImplementation deps.mockito
   testImplementation deps.mockito_kotlin
+
+  androidTestImplementation deps.androidx.test.runner
 }
 
 def gitSha() {
@@ -26,6 +28,7 @@ android {
     buildConfigField "String", "LIBRARY_VERSION", "\"${rootProject.ext.VERSION_NAME}\""
     buildConfigField "String", "GIT_SHA", "\"${gitSha()}\""
     consumerProguardFiles 'consumer-proguard-rules.pro'
+    testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
   }
   lintOptions {
     disable 'GoogleAppIndexingWarning'
diff --git a/leakcanary-android-core/src/androidTest/AndroidManifest.xml b/leakcanary-android-core/src/androidTest/AndroidManifest.xml
new file mode 100644
index 000000000..eefba6fa8
--- /dev/null
+++ b/leakcanary-android-core/src/androidTest/AndroidManifest.xml
@@ -0,0 +1,19 @@
+<?xml version="1.0" encoding="utf-8"?>
+<!--
+  ~ Copyright (C) 2019 Square, Inc.
+  ~
+  ~ Licensed under the Apache License, Version 2.0 (the "License");
+  ~ you may not use this file except in compliance with the License.
+  ~ You may obtain a copy of the License at
+  ~
+  ~      http://www.apache.org/licenses/LICENSE-2.0
+  ~
+  ~ Unless required by applicable law or agreed to in writing, software
+  ~ distributed under the License is distributed on an "AS IS" BASIS,
+  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+  ~ See the License for the specific language governing permissions and
+  ~ limitations under the License.
+  -->
+<manifest xmlns:android="http://schemas.android.com/apk/res/android"
+    package="com.squareup.leakcanary.core.test">
+</manifest>
diff --git a/leakcanary-android-core/src/androidTest/assets/leaks-v19-android-16.db b/leakcanary-android-core/src/androidTest/assets/leaks-v19-android-16.db
new file mode 100644
index 000000000..59e30fc0f
Binary files /dev/null and b/leakcanary-android-core/src/androidTest/assets/leaks-v19-android-16.db differ
diff --git a/leakcanary-android-core/src/androidTest/java/leakcanary/DatabaseMigrationTest.kt b/leakcanary-android-core/src/androidTest/java/leakcanary/DatabaseMigrationTest.kt
new file mode 100644
index 000000000..20bc677f1
--- /dev/null
+++ b/leakcanary-android-core/src/androidTest/java/leakcanary/DatabaseMigrationTest.kt
@@ -0,0 +1,103 @@
+package leakcanary
+
+import android.database.sqlite.SQLiteDatabase
+import androidx.test.platform.app.InstrumentationRegistry
+import leakcanary.internal.activity.db.HeapAnalysisTable
+import leakcanary.internal.activity.db.LeakTable
+import leakcanary.internal.activity.db.LeaksDbHelper
+import org.junit.Test
+import shark.HeapAnalysis
+import shark.HeapAnalysisSuccess
+import java.io.FileOutputStream
+import kotlin.reflect.KClass
+
+class DatabaseMigrationTest {
+
+  @Test fun v19_upgraded_to_latest() {
+    DB_V19 upgrade {
+      version assertEquals LeaksDbHelper.VERSION
+    }
+  }
+
+  @Test fun v19_has_2_heap_dumps() {
+    DB_V19 upgrade {
+      HeapAnalysisTable.retrieveAll(this).size assertEquals 2
+    }
+  }
+
+  @Test fun v19_heap_dumps_can_be_deserialized() {
+    DB_V19 upgrade {
+      HeapAnalysisTable.retrieveAll(this)
+          .forEach { projection ->
+            val heapAnalysis = HeapAnalysisTable.retrieve<HeapAnalysis>(this, projection.id)!!
+            heapAnalysis assertIs HeapAnalysisSuccess::class.java
+          }
+    }
+  }
+
+  @Test fun v19_has_3_leak_types() {
+    DB_V19 upgrade {
+      LeakTable.retrieveAllLeaks(this).size assertEquals 3
+    }
+  }
+
+  @Test fun v19_leaks_are_not_new() {
+    DB_V19 upgrade {
+      LeakTable.retrieveAllLeaks(this)
+          .forEach { leak ->
+            leak.isNew assertEquals false
+          }
+    }
+  }
+
+  @Test fun v19_all_8_leaks_can_be_deserialized() {
+    DB_V19 upgrade {
+     val allLeaks = LeakTable.retrieveAllLeaks(this)
+          .flatMap { leakTypeProjection ->
+            LeakTable.retrieveLeaksByHash(this, leakTypeProjection.hash)
+          }
+          .map { leakProjection ->
+            LeakTable.retrieveLeakById(this, leakProjection.id)
+          }
+      allLeaks.size assertEquals 8
+    }
+  }
+
+  private infix fun String.upgrade(
+    block: SQLiteDatabase.() -> Unit
+  ) {
+    val instrumentation = InstrumentationRegistry.getInstrumentation()
+    val context = instrumentation.targetContext
+
+    context.assets.open(this)
+        .use { input ->
+          val databaseFile = context.getDatabasePath(LeaksDbHelper.DATABASE_NAME)
+          databaseFile.parentFile!!.mkdirs()
+          FileOutputStream(databaseFile).use { output ->
+            input.copyTo(output)
+          }
+        }
+    LeaksDbHelper(context).readableDatabase.use { db ->
+      db.block()
+    }
+  }
+
+  private infix fun Any.assertEquals(otherValue: Any) {
+    if (this != otherValue) {
+      throw AssertionError("Expecting <$this> to be equal to <$otherValue> but was not.")
+    }
+  }
+
+  private infix fun Any.assertIs(javaClass: Class<out Any>) {
+    if (!javaClass.isInstance(this)) {
+      throw AssertionError(
+          "Expecting <$this> to be an instance of <${javaClass.name}> but was <${this.javaClass.name}>."
+      )
+    }
+  }
+
+  companion object {
+    const val DB_V19 = "leaks-v19-android-16.db"
+  }
+
+}
\ No newline at end of file
diff --git a/leakcanary-android-core/src/main/java/leakcanary/internal/activity/db/LeaksDbHelper.kt b/leakcanary-android-core/src/main/java/leakcanary/internal/activity/db/LeaksDbHelper.kt
index 750549f84..bb3008f5f 100644
--- a/leakcanary-android-core/src/main/java/leakcanary/internal/activity/db/LeaksDbHelper.kt
+++ b/leakcanary-android-core/src/main/java/leakcanary/internal/activity/db/LeaksDbHelper.kt
@@ -1,11 +1,12 @@
 package leakcanary.internal.activity.db
 
+import android.content.ContentValues
 import android.content.Context
 import android.database.sqlite.SQLiteDatabase
 import android.database.sqlite.SQLiteOpenHelper
 
 internal class LeaksDbHelper(context: Context) : SQLiteOpenHelper(
-    context, "leaks.db", null, VERSION
+    context, DATABASE_NAME, null, VERSION
 ) {
 
   override fun onCreate(db: SQLiteDatabase) {
@@ -19,7 +20,20 @@ internal class LeaksDbHelper(context: Context) : SQLiteOpenHelper(
     oldVersion: Int,
     newVersion: Int
   ) {
-    recreateDb(db)
+    // LeakCanary 2.0 to LeakCanary 2.1
+    if (oldVersion == 19 && newVersion == 21) {
+      db.execSQL(
+          """
+        ALTER TABLE leak
+          ADD is_read INTEGER;
+      """.trimIndent()
+      )
+      db.update("leak", ContentValues().apply {
+        put("is_read", 1)
+      }, null, null)
+    } else {
+      recreateDb(db)
+    }
   }
 
   override fun onDowngrade(
@@ -37,6 +51,7 @@ internal class LeaksDbHelper(context: Context) : SQLiteOpenHelper(
   }
 
   companion object {
-    private const val VERSION = 21
+    internal const val VERSION = 21
+    internal const val DATABASE_NAME = "leaks.db"
   }
 }
\ No newline at end of file
diff --git a/leakcanary-android-instrumentation/build.gradle b/leakcanary-android-instrumentation/build.gradle
index e8cb54365..7ba58419c 100644
--- a/leakcanary-android-instrumentation/build.gradle
+++ b/leakcanary-android-instrumentation/build.gradle
@@ -10,7 +10,6 @@ dependencies {
   androidTestImplementation deps.androidx.test.core
   androidTestImplementation deps.androidx.test.espresso
   androidTestImplementation deps.androidx.test.rules
-  androidTestImplementation deps.androidx.test.runner
   androidTestImplementation deps.androidx.fragment
 }
 
diff --git a/leakcanary-android-sample/build.gradle b/leakcanary-android-sample/build.gradle
index dd517107a..e258a5bb2 100644
--- a/leakcanary-android-sample/build.gradle
+++ b/leakcanary-android-sample/build.gradle
@@ -2,14 +2,14 @@ apply plugin: 'com.android.application'
 apply plugin: 'kotlin-android'
 
 dependencies {
-  debugImplementation project(':leakcanary-android')
+  debugImplementation 'com.squareup.leakcanary:leakcanary-android:2.0'
 
   implementation deps.kotlin.stdlib
 
   testImplementation deps.junit
   testImplementation deps.robolectric
 
-  androidTestImplementation project(':leakcanary-android-instrumentation')
+  androidTestImplementation 'com.squareup.leakcanary:leakcanary-android-instrumentation:2.0'
   androidTestImplementation deps.androidx.test.espresso
   androidTestImplementation deps.androidx.test.rules
   androidTestImplementation deps.androidx.test.runner
