diff --git a/plumber-android-core/src/main/java/leakcanary/AndroidLeakFixes.kt b/plumber-android-core/src/main/java/leakcanary/AndroidLeakFixes.kt
index 650f02a8a..e6d7e7144 100644
--- a/plumber-android-core/src/main/java/leakcanary/AndroidLeakFixes.kt
+++ b/plumber-android-core/src/main/java/leakcanary/AndroidLeakFixes.kt
@@ -6,6 +6,7 @@ import android.app.Activity
 import android.app.Application
 import android.content.Context
 import android.content.Context.INPUT_METHOD_SERVICE
+import android.content.ContextWrapper
 import android.os.Build.MANUFACTURER
 import android.os.Build.VERSION.SDK_INT
 import android.os.Bundle
@@ -504,8 +505,12 @@ enum class AndroidLeakFixes {
         override fun onActivityDestroyed(activity: Activity) {
           try {
             val rootView = mCurRootViewField[inputMethodManager] as View?
-            if (rootView != null && activity.window != null && activity.window.decorView === rootView
-            ) {
+            val isDestroyedActivity = rootView != null &&
+              activity.window != null &&
+              activity.window.decorView === rootView
+            val rootViewActivityContext = rootView?.context?.activityOrNull
+            val isChildWindowOfDestroyedActivity = rootViewActivityContext === activity
+            if (isDestroyedActivity || isChildWindowOfDestroyedActivity) {
               mCurRootViewField[inputMethodManager] = null
             }
           } catch (ignored: Throwable) {
@@ -514,6 +519,29 @@ enum class AndroidLeakFixes {
         }
       })
     }
+
+    private val Context.activityOrNull: Activity?
+      get() {
+        var context = this
+        while (true) {
+          if (context is Application) {
+            return null
+          }
+          if (context is Activity) {
+            return context
+          }
+          if (context is ContextWrapper) {
+            val baseContext = context.baseContext
+            // Prevent Stack Overflow.
+            if (baseContext === this) {
+              return null
+            }
+            context = baseContext
+          } else {
+            return null
+          }
+        }
+      }
   },
 
   /**
