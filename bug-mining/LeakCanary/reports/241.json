{"url":"https://api.github.com/repos/square/leakcanary/issues/2341","repository_url":"https://api.github.com/repos/square/leakcanary","labels_url":"https://api.github.com/repos/square/leakcanary/issues/2341/labels{/name}","comments_url":"https://api.github.com/repos/square/leakcanary/issues/2341/comments","events_url":"https://api.github.com/repos/square/leakcanary/issues/2341/events","html_url":"https://github.com/square/leakcanary/issues/2341","id":1203082491,"node_id":"I_kwDOAhNhM85HtZT7","number":2341,"title":"Fragment view leak detected by LeakCanary with ViewBinding/Databinding","user":{"login":"mazzouzi","id":21988512,"node_id":"MDQ6VXNlcjIxOTg4NTEy","avatar_url":"https://avatars.githubusercontent.com/u/21988512?v=4","gravatar_id":"","url":"https://api.github.com/users/mazzouzi","html_url":"https://github.com/mazzouzi","followers_url":"https://api.github.com/users/mazzouzi/followers","following_url":"https://api.github.com/users/mazzouzi/following{/other_user}","gists_url":"https://api.github.com/users/mazzouzi/gists{/gist_id}","starred_url":"https://api.github.com/users/mazzouzi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mazzouzi/subscriptions","organizations_url":"https://api.github.com/users/mazzouzi/orgs","repos_url":"https://api.github.com/users/mazzouzi/repos","events_url":"https://api.github.com/users/mazzouzi/events{/privacy}","received_events_url":"https://api.github.com/users/mazzouzi/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/square/leakcanary/milestones/23","html_url":"https://github.com/square/leakcanary/milestone/23","labels_url":"https://api.github.com/repos/square/leakcanary/milestones/23/labels","id":7539052,"node_id":"MI_kwDOAhNhM84Acwls","number":23,"title":"2.9","description":"","creator":{"login":"pyricau","id":557033,"node_id":"MDQ6VXNlcjU1NzAzMw==","avatar_url":"https://avatars.githubusercontent.com/u/557033?v=4","gravatar_id":"","url":"https://api.github.com/users/pyricau","html_url":"https://github.com/pyricau","followers_url":"https://api.github.com/users/pyricau/followers","following_url":"https://api.github.com/users/pyricau/following{/other_user}","gists_url":"https://api.github.com/users/pyricau/gists{/gist_id}","starred_url":"https://api.github.com/users/pyricau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pyricau/subscriptions","organizations_url":"https://api.github.com/users/pyricau/orgs","repos_url":"https://api.github.com/users/pyricau/repos","events_url":"https://api.github.com/users/pyricau/events{/privacy}","received_events_url":"https://api.github.com/users/pyricau/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":20,"state":"closed","created_at":"2022-01-04T09:47:49Z","updated_at":"2022-04-20T13:29:07Z","due_on":null,"closed_at":"2022-04-20T00:49:55Z"},"comments":10,"created_at":"2022-04-13T10:07:00Z","updated_at":"2023-02-22T19:58:22Z","closed_at":"2022-04-15T20:49:28Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description\r\n\r\nHi LeakCanary team. \r\nFirst of all, a big thank you for this great library !\r\n\r\nThe issue is super simple to reproduce : \r\nI run my app which displays a fragment called \"MainFragment\" in which I use DataBinding. When the end-user clicks on the button to display a second fragment, I replace current fragment by selected one using FragmentTransactionApi and \"replace()\" along with \"addToBackStack()\". So at this point, \"MainFragment\" gets its view destroyed only. Then second fragment is displayed and if I wait a couple of seconds, LeakCanary reports a leak saying that \"MainFragment\" **view** is leaking while I do set \"_binding\" to null in onDestroyView() : \r\n\r\n`override fun onDestroyView() {\r\n        _binding = null\r\n        super.onDestroyView()\r\n    }\r\n`\r\n\r\n### Steps to Reproduce\r\n\r\nSample app : https://github.com/mazzouzi/MemoryLeakApp\r\n\r\n1. Open the app\r\n2. Tap on any button\r\n3. Wait a couple of seconds. \r\n4. LeakCanary dumps the heap (LeakCanary.config overridden : LeakCanary.config.copy(retainedVisibleThreshold = 1). \r\n\r\n**Expected behavior:** There should be no leak detected as I'm cleaning up \"_binding\" correctly in onDestroyView()\r\n\r\n### Version Information\r\n\r\n* LeakCanary version: 2.7 (but also reproduced on 2.8.1)\r\n* Android OS version: 12\r\n* Gradle version: 7.2\r\n\r\nLeak Trace : \r\n\r\n    ====================================\r\n    HEAP ANALYSIS RESULT\r\n    ====================================\r\n    1 APPLICATION LEAKS\r\n    \r\n    References underlined with \"~~~\" are likely causes.\r\n    Learn more at https://squ.re/leaks.\r\n    \r\n    3616 bytes retained by leaking objects\r\n    Signature: 44d037b667ba0ef18ffa7c961c1765d3220bc66a\r\n    ┬───\r\n    │ GC Root: Global variable in native code\r\n    │\r\n    ├─ android.graphics.animation.RenderNodeAnimator instance\r\n    │    Leaking: UNKNOWN\r\n    │    Retaining 471,5 kB in 10047 objects\r\n    │    mListeners[0] = android.graphics.drawable.RippleAnimationSession$3\r\n    │    ↓ RenderNodeAnimator.mTarget\r\n    │                         ~~~~~~~\r\n    ├─ android.graphics.RenderNode instance\r\n    │    Leaking: UNKNOWN\r\n    │    Retaining 420,7 kB in 9666 objects\r\n    │    ↓ RenderNode.mAnimationHost\r\n    │                 ~~~~~~~~~~~~~~\r\n    ├─ android.view.ViewAnimationHostBridge instance\r\n    │    Leaking: UNKNOWN\r\n    │    Retaining 420,7 kB in 9665 objects\r\n    │    ↓ ViewAnimationHostBridge.mView\r\n    │                              ~~~~~\r\n    ├─ com.google.android.material.button.MaterialButton instance\r\n    │    Leaking: UNKNOWN\r\n    │    Retaining 420,7 kB in 9664 objects\r\n    │    View not part of a window view hierarchy\r\n    │    View.mAttachInfo is null (view detached)\r\n    │    View.mID = R.id.holding_reference_from_background_solution\r\n    │    View.mWindowAttachCount = 1\r\n    │    mContext instance of com.mazzouzi.memoryleak.ui.MainActivity with mDestroyed = false\r\n    │    ↓ View.mParent\r\n    │           ~~~~~~~\r\n    ├─ androidx.constraintlayout.widget.ConstraintLayout instance\r\n    │    Leaking: UNKNOWN\r\n    │    Retaining 2,1 kB in 31 objects\r\n    │    View not part of a window view hierarchy\r\n    │    View.mAttachInfo is null (view detached)\r\n    │    View.mID = R.id.firstBlock\r\n    │    View.mWindowAttachCount = 1\r\n    │    mContext instance of com.mazzouzi.memoryleak.ui.MainActivity with mDestroyed = false\r\n    │    ↓ View.mParent\r\n    │           ~~~~~~~\r\n    ├─ androidx.constraintlayout.widget.ConstraintLayout instance\r\n    │    Leaking: UNKNOWN\r\n    │    Retaining 1,3 kB in 20 objects\r\n    │    View not part of a window view hierarchy\r\n    │    View.mAttachInfo is null (view detached)\r\n    │    View.mID = R.id.main\r\n    │    View.mWindowAttachCount = 1\r\n    │    mContext instance of com.mazzouzi.memoryleak.ui.MainActivity with mDestroyed = false\r\n    │    ↓ View.mParent\r\n    │           ~~~~~~~\r\n    ╰→ android.widget.ScrollView instance\r\n    ​     Leaking: YES (ObjectWatcher was watching this because com.mazzouzi.memoryleak.ui.MainFragment received\r\n    ​     Fragment#onDestroyView() callback (references to its views should be cleared to prevent leaks))\r\n    ​     Retaining 3,6 kB in 68 objects\r\n    ​     key = e8f19633-cca8-4275-9d6e-e74a8d78418f\r\n    ​     watchDurationMillis = 5668\r\n    ​     retainedDurationMillis = 660\r\n    ​     View not part of a window view hierarchy\r\n    ​     View.mAttachInfo is null (view detached)\r\n    ​     View.mWindowAttachCount = 1\r\n    ​     mContext instance of com.mazzouzi.memoryleak.ui.MainActivity with mDestroyed = false\r\n    ====================================\r\n    0 LIBRARY LEAKS\r\n    \r\n    A Library Leak is a leak caused by a known bug in 3rd party code that you do not have control over.\r\n    See https://square.github.io/leakcanary/fundamentals-how-leakcanary-works/#4-categorizing-leaks\r\n    ====================================\r\n    0 UNREACHABLE OBJECTS\r\n    \r\n    An unreachable object is still in memory but LeakCanary could not find a strong reference path\r\n    from GC roots.\r\n    ====================================\r\n    METADATA\r\n    \r\n    Please include this in bug reports and Stack Overflow questions.\r\n    \r\n    Build.VERSION.SDK_INT: 31\r\n    Build.MANUFACTURER: Google\r\n    LeakCanary version: 2.8.1\r\n    App process name: com.mazzouzi.memoryleak\r\n    Stats: LruCache[maxSize=3000,hits=108920,misses=194655,hitRate=35%]\r\n    RandomAccess[bytes=9557724,reads=194655,travel=64601167621,range=29771575,size=36691897]\r\n    Heap dump reason: 1 retained objects, app is visible\r\n    Analysis duration: 9094 ms\r\n    Heap dump file path: /storage/emulated/0/Download/leakcanary-com.mazzouzi.memoryleak/2022-04-13_12-04-09_994.hprof\r\n2022-04-13 12:04:24.098 16642-16724/com.mazzouzi.memoryleak D/LeakCanary: Heap dump timestamp: 1649844264045\r\n    Heap dump duration: 3191 ms\r\n","closed_by":{"login":"pyricau","id":557033,"node_id":"MDQ6VXNlcjU1NzAzMw==","avatar_url":"https://avatars.githubusercontent.com/u/557033?v=4","gravatar_id":"","url":"https://api.github.com/users/pyricau","html_url":"https://github.com/pyricau","followers_url":"https://api.github.com/users/pyricau/followers","following_url":"https://api.github.com/users/pyricau/following{/other_user}","gists_url":"https://api.github.com/users/pyricau/gists{/gist_id}","starred_url":"https://api.github.com/users/pyricau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pyricau/subscriptions","organizations_url":"https://api.github.com/users/pyricau/orgs","repos_url":"https://api.github.com/users/pyricau/repos","events_url":"https://api.github.com/users/pyricau/events{/privacy}","received_events_url":"https://api.github.com/users/pyricau/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/square/leakcanary/issues/2341/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/square/leakcanary/issues/2341/timeline","performed_via_github_app":null,"state_reason":"completed"}