{"url":"https://api.github.com/repos/square/leakcanary/issues/2202","repository_url":"https://api.github.com/repos/square/leakcanary","labels_url":"https://api.github.com/repos/square/leakcanary/issues/2202/labels{/name}","comments_url":"https://api.github.com/repos/square/leakcanary/issues/2202/comments","events_url":"https://api.github.com/repos/square/leakcanary/issues/2202/events","html_url":"https://github.com/square/leakcanary/issues/2202","id":1052907941,"node_id":"I_kwDOAhNhM84-whml","number":2202,"title":"v2.7 causes a android.os.strictmode.DiskWriteViolation crash on API 30","user":{"login":"leinardi","id":273338,"node_id":"MDQ6VXNlcjI3MzMzOA==","avatar_url":"https://avatars.githubusercontent.com/u/273338?v=4","gravatar_id":"","url":"https://api.github.com/users/leinardi","html_url":"https://github.com/leinardi","followers_url":"https://api.github.com/users/leinardi/followers","following_url":"https://api.github.com/users/leinardi/following{/other_user}","gists_url":"https://api.github.com/users/leinardi/gists{/gist_id}","starred_url":"https://api.github.com/users/leinardi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leinardi/subscriptions","organizations_url":"https://api.github.com/users/leinardi/orgs","repos_url":"https://api.github.com/users/leinardi/repos","events_url":"https://api.github.com/users/leinardi/events{/privacy}","received_events_url":"https://api.github.com/users/leinardi/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":205873874,"node_id":"MDU6TGFiZWwyMDU4NzM4NzQ=","url":"https://api.github.com/repos/square/leakcanary/labels/type:%20bug","name":"type: bug","color":"fc2929","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/square/leakcanary/milestones/22","html_url":"https://github.com/square/leakcanary/milestone/22","labels_url":"https://api.github.com/repos/square/leakcanary/milestones/22/labels","id":6597430,"node_id":"MDk6TWlsZXN0b25lNjU5NzQzMA==","number":22,"title":"2.8","description":"","creator":{"login":"pyricau","id":557033,"node_id":"MDQ6VXNlcjU1NzAzMw==","avatar_url":"https://avatars.githubusercontent.com/u/557033?v=4","gravatar_id":"","url":"https://api.github.com/users/pyricau","html_url":"https://github.com/pyricau","followers_url":"https://api.github.com/users/pyricau/followers","following_url":"https://api.github.com/users/pyricau/following{/other_user}","gists_url":"https://api.github.com/users/pyricau/gists{/gist_id}","starred_url":"https://api.github.com/users/pyricau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pyricau/subscriptions","organizations_url":"https://api.github.com/users/pyricau/orgs","repos_url":"https://api.github.com/users/pyricau/repos","events_url":"https://api.github.com/users/pyricau/events{/privacy}","received_events_url":"https://api.github.com/users/pyricau/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":22,"state":"closed","created_at":"2021-03-26T17:54:29Z","updated_at":"2022-01-04T09:47:35Z","due_on":null,"closed_at":"2022-01-04T09:47:35Z"},"comments":2,"created_at":"2021-11-14T10:54:42Z","updated_at":"2021-12-16T00:35:55Z","closed_at":"2021-12-16T00:35:50Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description\r\nLeakCanary is causing a `DiskWriteViolation` when StrickMode is enable on API 30 and 31 (on lower API levels does not seem to happen).\r\nThe problem happens only on the very first boot of the application. Subsequent starts do not cause the `DiskWriteViolation` and LeakCanary seems to work fine.\r\n\r\n### Steps to Reproduce\r\nA reproduction project is available here: https://github.com/leinardi/AndroidTemplateProject/tree/leakcanary\r\n\r\n1. Start an Emulator with API level 30 or 31\r\n2. Remove any previous installation of the repro app (or wipe the data of the app)\r\n3. Start the repro app\r\n\r\n**Expected behavior:**\r\nLeakCanary should not cause any StrickMode violation.\r\n\r\n### Version Information\r\n\r\n* LeakCanary version: 2.7\r\n* Android OS version: API 30 and 31\r\n* Gradle version: 7.3\r\n\r\n### Additional Information\r\nLogcat on API 30:\r\n```\r\n2021-11-14 11:54:05.214 3443-3443/com.leinardi.template D/StrictMode: StrictMode policy violation; ~duration=1507 ms: android.os.strictmode.DiskWriteViolation\r\n        at android.os.StrictMode$AndroidBlockGuardPolicy.onWriteToDisk(StrictMode.java:1552)\r\n        at libcore.io.BlockGuardOs.mkdir(BlockGuardOs.java:235)\r\n        at libcore.io.ForwardingOs.mkdir(ForwardingOs.java:156)\r\n        at android.system.Os.mkdir(Os.java:377)\r\n        at android.app.ContextImpl.ensurePrivateDirExists(ContextImpl.java:684)\r\n        at android.app.ContextImpl.ensurePrivateDirExists(ContextImpl.java:672)\r\n        at android.app.ContextImpl.getFilesDir(ContextImpl.java:717)\r\n        at android.content.ContextWrapper.getFilesDir(ContextWrapper.java:253)\r\n        at leakcanary.internal.LeakCanaryFileProvider$Companion.parsePathStrategy(LeakCanaryFileProvider.kt:480)\r\n        at leakcanary.internal.LeakCanaryFileProvider$Companion.getPathStrategy(LeakCanaryFileProvider.kt:428)\r\n        at leakcanary.internal.LeakCanaryFileProvider$Companion.access$getPathStrategy(LeakCanaryFileProvider.kt:366)\r\n        at leakcanary.internal.LeakCanaryFileProvider.attachInfo(LeakCanaryFileProvider.kt:77)\r\n        at android.app.ActivityThread.installProvider(ActivityThread.java:7239)\r\n        at android.app.ActivityThread.installContentProviders(ActivityThread.java:6780)\r\n        at android.app.ActivityThread.handleBindApplication(ActivityThread.java:6697)\r\n        at android.app.ActivityThread.access$1300(ActivityThread.java:237)\r\n        at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1913)\r\n        at android.os.Handler.dispatchMessage(Handler.java:106)\r\n        at android.os.Looper.loop(Looper.java:223)\r\n        at android.app.ActivityThread.main(ActivityThread.java:7656)\r\n        at java.lang.reflect.Method.invoke(Native Method)\r\n        at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:592)\r\n        at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:947)\r\n2021-11-14 11:54:05.214 3443-3443/com.leinardi.template D/AndroidRuntime: Shutting down VM\r\n2021-11-14 11:54:05.215 3443-3443/com.leinardi.template E/AndroidRuntime: FATAL EXCEPTION: main\r\n    Process: com.leinardi.template, PID: 3443\r\n    java.lang.RuntimeException: StrictMode ThreadPolicy violation\r\n        at android.os.StrictMode$AndroidBlockGuardPolicy.onThreadPolicyViolation(StrictMode.java:1813)\r\n        at android.os.StrictMode$AndroidBlockGuardPolicy.lambda$handleViolationWithTimingAttempt$0$StrictMode$AndroidBlockGuardPolicy(StrictMode.java:1727)\r\n        at android.os.-$$Lambda$StrictMode$AndroidBlockGuardPolicy$9nBulCQKaMajrWr41SB7f7YRT1I.run(Unknown Source:6)\r\n        at android.os.Handler.handleCallback(Handler.java:938)\r\n        at android.os.Handler.dispatchMessage(Handler.java:99)\r\n        at android.os.Looper.loop(Looper.java:223)\r\n        at android.app.ActivityThread.main(ActivityThread.java:7656)\r\n        at java.lang.reflect.Method.invoke(Native Method)\r\n        at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:592)\r\n        at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:947)\r\n     Caused by: android.os.strictmode.DiskWriteViolation\r\n        at android.os.StrictMode$AndroidBlockGuardPolicy.onWriteToDisk(StrictMode.java:1552)\r\n        at libcore.io.BlockGuardOs.mkdir(BlockGuardOs.java:235)\r\n        at libcore.io.ForwardingOs.mkdir(ForwardingOs.java:156)\r\n        at android.system.Os.mkdir(Os.java:377)\r\n        at android.app.ContextImpl.ensurePrivateDirExists(ContextImpl.java:684)\r\n        at android.app.ContextImpl.ensurePrivateDirExists(ContextImpl.java:672)\r\n        at android.app.ContextImpl.getFilesDir(ContextImpl.java:717)\r\n        at android.content.ContextWrapper.getFilesDir(ContextWrapper.java:253)\r\n        at leakcanary.internal.LeakCanaryFileProvider$Companion.parsePathStrategy(LeakCanaryFileProvider.kt:480)\r\n        at leakcanary.internal.LeakCanaryFileProvider$Companion.getPathStrategy(LeakCanaryFileProvider.kt:428)\r\n        at leakcanary.internal.LeakCanaryFileProvider$Companion.access$getPathStrategy(LeakCanaryFileProvider.kt:366)\r\n        at leakcanary.internal.LeakCanaryFileProvider.attachInfo(LeakCanaryFileProvider.kt:77)\r\n        at android.app.ActivityThread.installProvider(ActivityThread.java:7239)\r\n        at android.app.ActivityThread.installContentProviders(ActivityThread.java:6780)\r\n        at android.app.ActivityThread.handleBindApplication(ActivityThread.java:6697)\r\n        at android.app.ActivityThread.access$1300(ActivityThread.java:237)\r\n        at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1913)\r\n        at android.os.Handler.dispatchMessage(Handler.java:106)\r\n        at android.os.Looper.loop(Looper.java:223) \r\n        at android.app.ActivityThread.main(ActivityThread.java:7656) \r\n        at java.lang.reflect.Method.invoke(Native Method) \r\n        at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:592) \r\n        at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:947) \r\n```\r\nLogcat on API 31:\r\n```\r\n2021-11-13 23:58:45.719 7972-7972/? D/StrictMode: StrictMode policy violation; ~duration=1506 ms: android.os.strictmode.DiskWriteViolation\r\n        at android.os.StrictMode$AndroidBlockGuardPolicy.onWriteToDisk(StrictMode.java:1615)\r\n        at libcore.io.BlockGuardOs.mkdir(BlockGuardOs.java:254)\r\n        at libcore.io.ForwardingOs.mkdir(ForwardingOs.java:494)\r\n        at android.system.Os.mkdir(Os.java:466)\r\n        at android.app.ContextImpl.ensurePrivateDirExists(ContextImpl.java:746)\r\n        at android.app.ContextImpl.ensurePrivateDirExists(ContextImpl.java:734)\r\n        at android.app.ContextImpl.getFilesDir(ContextImpl.java:779)\r\n        at android.content.ContextWrapper.getFilesDir(ContextWrapper.java:261)\r\n        at leakcanary.internal.LeakCanaryFileProvider$Companion.parsePathStrategy(LeakCanaryFileProvider.kt:480)\r\n        at leakcanary.internal.LeakCanaryFileProvider$Companion.getPathStrategy(LeakCanaryFileProvider.kt:428)\r\n        at leakcanary.internal.LeakCanaryFileProvider$Companion.access$getPathStrategy(LeakCanaryFileProvider.kt:366)\r\n        at leakcanary.internal.LeakCanaryFileProvider.attachInfo(LeakCanaryFileProvider.kt:77)\r\n        at android.app.ActivityThread.installProvider(ActivityThread.java:7425)\r\n        at android.app.ActivityThread.installContentProviders(ActivityThread.java:6942)\r\n        at android.app.ActivityThread.handleBindApplication(ActivityThread.java:6713)\r\n        at android.app.ActivityThread.access$1500(ActivityThread.java:247)\r\n        at android.app.ActivityThread$H.handleMessage(ActivityThread.java:2057)\r\n        at android.os.Handler.dispatchMessage(Handler.java:106)\r\n        at android.os.Looper.loopOnce(Looper.java:201)\r\n        at android.os.Looper.loop(Looper.java:288)\r\n        at android.app.ActivityThread.main(ActivityThread.java:7842)\r\n        at java.lang.reflect.Method.invoke(Native Method)\r\n        at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:548)\r\n        at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:1003)\r\n2021-11-13 23:58:45.719 7972-7972/? D/AndroidRuntime: Shutting down VM\r\n2021-11-13 23:58:45.720 7972-7972/? E/AndroidRuntime: FATAL EXCEPTION: main\r\n    Process: com.leinardi.template, PID: 7972\r\n    java.lang.RuntimeException: StrictMode ThreadPolicy violation\r\n        at android.os.StrictMode$AndroidBlockGuardPolicy.onThreadPolicyViolation(StrictMode.java:1876)\r\n        at android.os.StrictMode$AndroidBlockGuardPolicy.lambda$handleViolationWithTimingAttempt$0$StrictMode$AndroidBlockGuardPolicy(StrictMode.java:1790)\r\n        at android.os.StrictMode$AndroidBlockGuardPolicy$$ExternalSyntheticLambda0.run(Unknown Source:6)\r\n        at android.os.Handler.handleCallback(Handler.java:938)\r\n        at android.os.Handler.dispatchMessage(Handler.java:99)\r\n        at android.os.Looper.loopOnce(Looper.java:201)\r\n        at android.os.Looper.loop(Looper.java:288)\r\n        at android.app.ActivityThread.main(ActivityThread.java:7842)\r\n        at java.lang.reflect.Method.invoke(Native Method)\r\n        at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:548)\r\n        at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:1003)\r\n     Caused by: android.os.strictmode.DiskWriteViolation\r\n        at android.os.StrictMode$AndroidBlockGuardPolicy.onWriteToDisk(StrictMode.java:1615)\r\n        at libcore.io.BlockGuardOs.mkdir(BlockGuardOs.java:254)\r\n        at libcore.io.ForwardingOs.mkdir(ForwardingOs.java:494)\r\n        at android.system.Os.mkdir(Os.java:466)\r\n        at android.app.ContextImpl.ensurePrivateDirExists(ContextImpl.java:746)\r\n        at android.app.ContextImpl.ensurePrivateDirExists(ContextImpl.java:734)\r\n        at android.app.ContextImpl.getFilesDir(ContextImpl.java:779)\r\n        at android.content.ContextWrapper.getFilesDir(ContextWrapper.java:261)\r\n        at leakcanary.internal.LeakCanaryFileProvider$Companion.parsePathStrategy(LeakCanaryFileProvider.kt:480)\r\n        at leakcanary.internal.LeakCanaryFileProvider$Companion.getPathStrategy(LeakCanaryFileProvider.kt:428)\r\n        at leakcanary.internal.LeakCanaryFileProvider$Companion.access$getPathStrategy(LeakCanaryFileProvider.kt:366)\r\n        at leakcanary.internal.LeakCanaryFileProvider.attachInfo(LeakCanaryFileProvider.kt:77)\r\n        at android.app.ActivityThread.installProvider(ActivityThread.java:7425)\r\n        at android.app.ActivityThread.installContentProviders(ActivityThread.java:6942)\r\n        at android.app.ActivityThread.handleBindApplication(ActivityThread.java:6713)\r\n        at android.app.ActivityThread.access$1500(ActivityThread.java:247)\r\n        at android.app.ActivityThread$H.handleMessage(ActivityThread.java:2057)\r\n        at android.os.Handler.dispatchMessage(Handler.java:106)\r\n        at android.os.Looper.loopOnce(Looper.java:201) \r\n        at android.os.Looper.loop(Looper.java:288) \r\n        at android.app.ActivityThread.main(ActivityThread.java:7842) \r\n        at java.lang.reflect.Method.invoke(Native Method) \r\n        at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:548) \r\n        at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:1003) \r\n```","closed_by":{"login":"pyricau","id":557033,"node_id":"MDQ6VXNlcjU1NzAzMw==","avatar_url":"https://avatars.githubusercontent.com/u/557033?v=4","gravatar_id":"","url":"https://api.github.com/users/pyricau","html_url":"https://github.com/pyricau","followers_url":"https://api.github.com/users/pyricau/followers","following_url":"https://api.github.com/users/pyricau/following{/other_user}","gists_url":"https://api.github.com/users/pyricau/gists{/gist_id}","starred_url":"https://api.github.com/users/pyricau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pyricau/subscriptions","organizations_url":"https://api.github.com/users/pyricau/orgs","repos_url":"https://api.github.com/users/pyricau/repos","events_url":"https://api.github.com/users/pyricau/events{/privacy}","received_events_url":"https://api.github.com/users/pyricau/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/square/leakcanary/issues/2202/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/square/leakcanary/issues/2202/timeline","performed_via_github_app":null,"state_reason":"completed"}