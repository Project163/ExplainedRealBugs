[{"url":"https://api.github.com/repos/evsinev/ber-tlv/issues/comments/545906961","html_url":"https://github.com/evsinev/ber-tlv/issues/13#issuecomment-545906961","issue_url":"https://api.github.com/repos/evsinev/ber-tlv/issues/13","id":545906961,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NTkwNjk2MQ==","user":{"login":"eriknellessen","id":8004039,"node_id":"MDQ6VXNlcjgwMDQwMzk=","avatar_url":"https://avatars.githubusercontent.com/u/8004039?v=4","gravatar_id":"","url":"https://api.github.com/users/eriknellessen","html_url":"https://github.com/eriknellessen","followers_url":"https://api.github.com/users/eriknellessen/followers","following_url":"https://api.github.com/users/eriknellessen/following{/other_user}","gists_url":"https://api.github.com/users/eriknellessen/gists{/gist_id}","starred_url":"https://api.github.com/users/eriknellessen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eriknellessen/subscriptions","organizations_url":"https://api.github.com/users/eriknellessen/orgs","repos_url":"https://api.github.com/users/eriknellessen/repos","events_url":"https://api.github.com/users/eriknellessen/events{/privacy}","received_events_url":"https://api.github.com/users/eriknellessen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-10-24T13:01:55Z","updated_at":"2019-10-24T13:01:55Z","body":"I now understood that what I wanted to do was rather this:\r\n```java\r\nBerTlvBuilder berTlvBuilder = BerTlvBuilder.from(myBerTlv);\r\n```\r\n\r\nAnyhow, this leaves no possibility to configure a custom buffer size. With elements over 5120 bytes (and I do have to handle those), it will lead to the exception posted above.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/evsinev/ber-tlv/issues/comments/545906961/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"eriknellessen","id":8004039,"node_id":"MDQ6VXNlcjgwMDQwMzk=","avatar_url":"https://avatars.githubusercontent.com/u/8004039?v=4","gravatar_id":"","url":"https://api.github.com/users/eriknellessen","html_url":"https://github.com/eriknellessen","followers_url":"https://api.github.com/users/eriknellessen/followers","following_url":"https://api.github.com/users/eriknellessen/following{/other_user}","gists_url":"https://api.github.com/users/eriknellessen/gists{/gist_id}","starred_url":"https://api.github.com/users/eriknellessen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eriknellessen/subscriptions","organizations_url":"https://api.github.com/users/eriknellessen/orgs","repos_url":"https://api.github.com/users/eriknellessen/repos","events_url":"https://api.github.com/users/eriknellessen/events{/privacy}","received_events_url":"https://api.github.com/users/eriknellessen/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/evsinev/ber-tlv/issues/comments/547194724","html_url":"https://github.com/evsinev/ber-tlv/issues/13#issuecomment-547194724","issue_url":"https://api.github.com/repos/evsinev/ber-tlv/issues/13","id":547194724,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NzE5NDcyNA==","user":{"login":"evsinev","id":252958,"node_id":"MDQ6VXNlcjI1Mjk1OA==","avatar_url":"https://avatars.githubusercontent.com/u/252958?v=4","gravatar_id":"","url":"https://api.github.com/users/evsinev","html_url":"https://github.com/evsinev","followers_url":"https://api.github.com/users/evsinev/followers","following_url":"https://api.github.com/users/evsinev/following{/other_user}","gists_url":"https://api.github.com/users/evsinev/gists{/gist_id}","starred_url":"https://api.github.com/users/evsinev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/evsinev/subscriptions","organizations_url":"https://api.github.com/users/evsinev/orgs","repos_url":"https://api.github.com/users/evsinev/repos","events_url":"https://api.github.com/users/evsinev/events{/privacy}","received_events_url":"https://api.github.com/users/evsinev/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-10-28T23:48:49Z","updated_at":"2019-10-28T23:48:49Z","body":"Hi,\r\n\r\nHere is the tests for your issue:\r\n\r\nnew BerTlvBuilder(null, new byte[bufferSize], 0, bufferSize); \r\n```java\r\n    @Test\r\n    public void test_large_value_with_error() {\r\n        try {\r\n            BerTlvBuilder builder = new BerTlvBuilder();\r\n            builder.addBytes(new BerTag(0x82), new byte[6 * 1024]);\r\n            Assert.fail(\"Should throw ArrayIndexOutOfBoundsException because default buffer size is 5KB\");\r\n        } catch (ArrayIndexOutOfBoundsException e) {\r\n            Assert.assertNull(e.getMessage());\r\n        }\r\n    }\r\n\r\n    @Test\r\n    public void test_large_value() {\r\n        final int     sixKilobytes = 6 * 1024;\r\n        final int     tagLength    = 1;\r\n        final int     valueLength  = 3;\r\n        final int     bufferSize   = sixKilobytes + tagLength + valueLength;\r\n\r\n        BerTlvBuilder builder = new BerTlvBuilder(null, new byte[bufferSize], 0, bufferSize);\r\n        builder.addBytes(new BerTag(0x82), new byte[sixKilobytes]);\r\n\r\n        byte[] bytes = builder.buildArray();\r\n        Assert.assertEquals(bufferSize, bytes.length);\r\n    }\r\n\r\n```\r\n\r\nIt seems that we can use large buffer size for elements more the 5kb.\r\n\r\n","author_association":"OWNER","reactions":{"url":"https://api.github.com/repos/evsinev/ber-tlv/issues/comments/547194724/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"evsinev","id":252958,"node_id":"MDQ6VXNlcjI1Mjk1OA==","avatar_url":"https://avatars.githubusercontent.com/u/252958?v=4","gravatar_id":"","url":"https://api.github.com/users/evsinev","html_url":"https://github.com/evsinev","followers_url":"https://api.github.com/users/evsinev/followers","following_url":"https://api.github.com/users/evsinev/following{/other_user}","gists_url":"https://api.github.com/users/evsinev/gists{/gist_id}","starred_url":"https://api.github.com/users/evsinev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/evsinev/subscriptions","organizations_url":"https://api.github.com/users/evsinev/orgs","repos_url":"https://api.github.com/users/evsinev/repos","events_url":"https://api.github.com/users/evsinev/events{/privacy}","received_events_url":"https://api.github.com/users/evsinev/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/evsinev/ber-tlv/issues/comments/547301391","html_url":"https://github.com/evsinev/ber-tlv/issues/13#issuecomment-547301391","issue_url":"https://api.github.com/repos/evsinev/ber-tlv/issues/13","id":547301391,"node_id":"MDEyOklzc3VlQ29tbWVudDU0NzMwMTM5MQ==","user":{"login":"eriknellessen","id":8004039,"node_id":"MDQ6VXNlcjgwMDQwMzk=","avatar_url":"https://avatars.githubusercontent.com/u/8004039?v=4","gravatar_id":"","url":"https://api.github.com/users/eriknellessen","html_url":"https://github.com/eriknellessen","followers_url":"https://api.github.com/users/eriknellessen/followers","following_url":"https://api.github.com/users/eriknellessen/following{/other_user}","gists_url":"https://api.github.com/users/eriknellessen/gists{/gist_id}","starred_url":"https://api.github.com/users/eriknellessen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eriknellessen/subscriptions","organizations_url":"https://api.github.com/users/eriknellessen/orgs","repos_url":"https://api.github.com/users/eriknellessen/repos","events_url":"https://api.github.com/users/eriknellessen/events{/privacy}","received_events_url":"https://api.github.com/users/eriknellessen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-10-29T08:03:08Z","updated_at":"2019-10-29T08:05:45Z","body":"Hi,\r\n\r\nthanks for your response. As far as I can see, you use the `addBytes` method, not the `addBerTlv` method. The `addBytes` method does not lead to the error, as far as I can see.\r\n\r\nA test like this should lead to the error (I did not compile or test this code, just trying to give the idea):\r\n```\r\n@Test\r\npublic void test_large_value() {\r\n    final int     sixKilobytes = 6 * 1024;\r\n    final int     tagLength    = 1;\r\n    final int     valueLength  = 3;\r\n    final int     bufferSize   = sixKilobytes + tagLength + valueLength;\r\n\r\n    BerTlvBuilder builder = new BerTlvBuilder(null, new byte[bufferSize], 0, bufferSize);\r\n    BerTlv berTlv = new BerTlv(new BerTag(0x82), new byte[sixKilobytes]);\r\n    builder.addBerTlv(berTlv);\r\n\r\n    byte[] bytes = builder.buildArray();\r\n    Assert.assertEquals(bufferSize, bytes.length);\r\n}\r\n```","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/evsinev/ber-tlv/issues/comments/547301391/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"eriknellessen","id":8004039,"node_id":"MDQ6VXNlcjgwMDQwMzk=","avatar_url":"https://avatars.githubusercontent.com/u/8004039?v=4","gravatar_id":"","url":"https://api.github.com/users/eriknellessen","html_url":"https://github.com/eriknellessen","followers_url":"https://api.github.com/users/eriknellessen/followers","following_url":"https://api.github.com/users/eriknellessen/following{/other_user}","gists_url":"https://api.github.com/users/eriknellessen/gists{/gist_id}","starred_url":"https://api.github.com/users/eriknellessen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eriknellessen/subscriptions","organizations_url":"https://api.github.com/users/eriknellessen/orgs","repos_url":"https://api.github.com/users/eriknellessen/repos","events_url":"https://api.github.com/users/eriknellessen/events{/privacy}","received_events_url":"https://api.github.com/users/eriknellessen/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":2783165344,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDI3ODMxNjUzNDQ=","url":"https://api.github.com/repos/evsinev/ber-tlv/issues/events/2783165344","actor":{"login":"eriknellessen","id":8004039,"node_id":"MDQ6VXNlcjgwMDQwMzk=","avatar_url":"https://avatars.githubusercontent.com/u/8004039?v=4","gravatar_id":"","url":"https://api.github.com/users/eriknellessen","html_url":"https://github.com/eriknellessen","followers_url":"https://api.github.com/users/eriknellessen/followers","following_url":"https://api.github.com/users/eriknellessen/following{/other_user}","gists_url":"https://api.github.com/users/eriknellessen/gists{/gist_id}","starred_url":"https://api.github.com/users/eriknellessen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eriknellessen/subscriptions","organizations_url":"https://api.github.com/users/eriknellessen/orgs","repos_url":"https://api.github.com/users/eriknellessen/repos","events_url":"https://api.github.com/users/eriknellessen/events{/privacy}","received_events_url":"https://api.github.com/users/eriknellessen/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"a800b874196be65ea071dd46196ee2b44dd48c77","commit_url":"https://api.github.com/repos/eriknellessen/ber-tlv/commits/a800b874196be65ea071dd46196ee2b44dd48c77","created_at":"2019-11-08T14:28:50Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/evsinev/ber-tlv/issues/comments/551850299","html_url":"https://github.com/evsinev/ber-tlv/issues/13#issuecomment-551850299","issue_url":"https://api.github.com/repos/evsinev/ber-tlv/issues/13","id":551850299,"node_id":"MDEyOklzc3VlQ29tbWVudDU1MTg1MDI5OQ==","user":{"login":"eriknellessen","id":8004039,"node_id":"MDQ6VXNlcjgwMDQwMzk=","avatar_url":"https://avatars.githubusercontent.com/u/8004039?v=4","gravatar_id":"","url":"https://api.github.com/users/eriknellessen","html_url":"https://github.com/eriknellessen","followers_url":"https://api.github.com/users/eriknellessen/followers","following_url":"https://api.github.com/users/eriknellessen/following{/other_user}","gists_url":"https://api.github.com/users/eriknellessen/gists{/gist_id}","starred_url":"https://api.github.com/users/eriknellessen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eriknellessen/subscriptions","organizations_url":"https://api.github.com/users/eriknellessen/orgs","repos_url":"https://api.github.com/users/eriknellessen/repos","events_url":"https://api.github.com/users/eriknellessen/events{/privacy}","received_events_url":"https://api.github.com/users/eriknellessen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-11-08T14:33:06Z","updated_at":"2019-11-08T14:33:06Z","body":"I tried the test code I posted and found out that it did not reproduce the problem, because the BerTlv was not constructed.\r\n\r\nI created a pull request with a test reproducing the problem and proposing a solution: #14 ","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/evsinev/ber-tlv/issues/comments/551850299/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"eriknellessen","id":8004039,"node_id":"MDQ6VXNlcjgwMDQwMzk=","avatar_url":"https://avatars.githubusercontent.com/u/8004039?v=4","gravatar_id":"","url":"https://api.github.com/users/eriknellessen","html_url":"https://github.com/eriknellessen","followers_url":"https://api.github.com/users/eriknellessen/followers","following_url":"https://api.github.com/users/eriknellessen/following{/other_user}","gists_url":"https://api.github.com/users/eriknellessen/gists{/gist_id}","starred_url":"https://api.github.com/users/eriknellessen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eriknellessen/subscriptions","organizations_url":"https://api.github.com/users/eriknellessen/orgs","repos_url":"https://api.github.com/users/eriknellessen/repos","events_url":"https://api.github.com/users/eriknellessen/events{/privacy}","received_events_url":"https://api.github.com/users/eriknellessen/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":2783211816,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDI3ODMyMTE4MTY=","url":"https://api.github.com/repos/evsinev/ber-tlv/issues/events/2783211816","actor":{"login":"eriknellessen","id":8004039,"node_id":"MDQ6VXNlcjgwMDQwMzk=","avatar_url":"https://avatars.githubusercontent.com/u/8004039?v=4","gravatar_id":"","url":"https://api.github.com/users/eriknellessen","html_url":"https://github.com/eriknellessen","followers_url":"https://api.github.com/users/eriknellessen/followers","following_url":"https://api.github.com/users/eriknellessen/following{/other_user}","gists_url":"https://api.github.com/users/eriknellessen/gists{/gist_id}","starred_url":"https://api.github.com/users/eriknellessen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eriknellessen/subscriptions","organizations_url":"https://api.github.com/users/eriknellessen/orgs","repos_url":"https://api.github.com/users/eriknellessen/repos","events_url":"https://api.github.com/users/eriknellessen/events{/privacy}","received_events_url":"https://api.github.com/users/eriknellessen/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"647fe5f84b36018cdd81c2d1c5c2cab30297b39d","commit_url":"https://api.github.com/repos/eriknellessen/ber-tlv/commits/647fe5f84b36018cdd81c2d1c5c2cab30297b39d","created_at":"2019-11-08T14:37:20Z","performed_via_github_app":null},{"id":2783231590,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDI3ODMyMzE1OTA=","url":"https://api.github.com/repos/evsinev/ber-tlv/issues/events/2783231590","actor":{"login":"eriknellessen","id":8004039,"node_id":"MDQ6VXNlcjgwMDQwMzk=","avatar_url":"https://avatars.githubusercontent.com/u/8004039?v=4","gravatar_id":"","url":"https://api.github.com/users/eriknellessen","html_url":"https://github.com/eriknellessen","followers_url":"https://api.github.com/users/eriknellessen/followers","following_url":"https://api.github.com/users/eriknellessen/following{/other_user}","gists_url":"https://api.github.com/users/eriknellessen/gists{/gist_id}","starred_url":"https://api.github.com/users/eriknellessen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eriknellessen/subscriptions","organizations_url":"https://api.github.com/users/eriknellessen/orgs","repos_url":"https://api.github.com/users/eriknellessen/repos","events_url":"https://api.github.com/users/eriknellessen/events{/privacy}","received_events_url":"https://api.github.com/users/eriknellessen/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"5f6bdef7604cd9e787da1d9ebd55d1d660ad98e3","commit_url":"https://api.github.com/repos/eriknellessen/ber-tlv/commits/5f6bdef7604cd9e787da1d9ebd55d1d660ad98e3","created_at":"2019-11-08T14:40:48Z","performed_via_github_app":null},{"id":3104091571,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDMxMDQwOTE1NzE=","url":"https://api.github.com/repos/evsinev/ber-tlv/issues/events/3104091571","actor":{"login":"evsinev","id":252958,"node_id":"MDQ6VXNlcjI1Mjk1OA==","avatar_url":"https://avatars.githubusercontent.com/u/252958?v=4","gravatar_id":"","url":"https://api.github.com/users/evsinev","html_url":"https://github.com/evsinev","followers_url":"https://api.github.com/users/evsinev/followers","following_url":"https://api.github.com/users/evsinev/following{/other_user}","gists_url":"https://api.github.com/users/evsinev/gists{/gist_id}","starred_url":"https://api.github.com/users/evsinev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/evsinev/subscriptions","organizations_url":"https://api.github.com/users/evsinev/orgs","repos_url":"https://api.github.com/users/evsinev/repos","events_url":"https://api.github.com/users/evsinev/events{/privacy}","received_events_url":"https://api.github.com/users/evsinev/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"e3f58a4b9c3d36ff2c50b22bab6996b5bbf8f161","commit_url":"https://api.github.com/repos/evsinev/ber-tlv/commits/e3f58a4b9c3d36ff2c50b22bab6996b5bbf8f161","created_at":"2020-03-06T05:57:09Z","performed_via_github_app":null}]