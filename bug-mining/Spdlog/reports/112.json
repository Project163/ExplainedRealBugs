{"url":"https://api.github.com/repos/gabime/spdlog/issues/3073","repository_url":"https://api.github.com/repos/gabime/spdlog","labels_url":"https://api.github.com/repos/gabime/spdlog/issues/3073/labels{/name}","comments_url":"https://api.github.com/repos/gabime/spdlog/issues/3073/comments","events_url":"https://api.github.com/repos/gabime/spdlog/issues/3073/events","html_url":"https://github.com/gabime/spdlog/issues/3073","id":2255863827,"node_id":"I_kwDOAY1ReM6GdcAT","number":3073,"title":"Make source_loc more resilient to invalid data","user":{"login":"serhii-muchychka","id":17470298,"node_id":"MDQ6VXNlcjE3NDcwMjk4","avatar_url":"https://avatars.githubusercontent.com/u/17470298?v=4","gravatar_id":"","url":"https://api.github.com/users/serhii-muchychka","html_url":"https://github.com/serhii-muchychka","followers_url":"https://api.github.com/users/serhii-muchychka/followers","following_url":"https://api.github.com/users/serhii-muchychka/following{/other_user}","gists_url":"https://api.github.com/users/serhii-muchychka/gists{/gist_id}","starred_url":"https://api.github.com/users/serhii-muchychka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/serhii-muchychka/subscriptions","organizations_url":"https://api.github.com/users/serhii-muchychka/orgs","repos_url":"https://api.github.com/users/serhii-muchychka/repos","events_url":"https://api.github.com/users/serhii-muchychka/events{/privacy}","received_events_url":"https://api.github.com/users/serhii-muchychka/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2024-04-22T08:02:11Z","updated_at":"2024-04-25T21:04:01Z","closed_at":"2024-04-25T21:04:01Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I use spdlog as a logging system for the C++/QML application. The C++ part uses built-in macros for logging: `SPDLOG_*`. For QML part I redirect standard Qt logger via [qInstallMessageHandler](https://doc.qt.io/qt-6/qtlogging.html#qInstallMessageHandler) function\r\n```\r\nqInstallMessageHandler([](QtMsgType type, const QMessageLogContext &context, const QString &msg) {\r\n        auto spdLogLevelType = convertQtToSpdLogLevel(type);\r\n        spdlog::source_loc loc{ context.file, context.line, context.function};\r\n        spdlog::log(loc, spdLogLevelType, msg.toStdString());\r\n    });\r\n```\r\nBut different invalid values come from different parts of QML code:\r\n\r\n1. `context.line` can be equal `-1`\r\n2. `context.function` can be equal `nullptr`, while `context.file` is non-empty string\r\n\r\nSo as a result, I added workaround to my code:\r\n```\r\nconst char *notNullCString(const char *string)\r\n{\r\n    return string ? string : \"\";\r\n}\r\n...\r\nspdlog::source_loc loc{ notNullCString(context.file), std::max(context.line, 0), notNullCString(context.function) };\r\n```\r\nAfter that everything works fine, no more crashes. But would it be possible to add these checks to the SPDLOG to simplify the integration of other projects?\r\n\r\n**My suggestions:**\r\n\r\n1. Treat all source_loc with a zero or negative line as empty (now this is only for zero)\r\n2. Add `nullptr` checks for `filename` and `funcname`  so there are no crashes","closed_by":{"login":"gabime","id":6052198,"node_id":"MDQ6VXNlcjYwNTIxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/6052198?v=4","gravatar_id":"","url":"https://api.github.com/users/gabime","html_url":"https://github.com/gabime","followers_url":"https://api.github.com/users/gabime/followers","following_url":"https://api.github.com/users/gabime/following{/other_user}","gists_url":"https://api.github.com/users/gabime/gists{/gist_id}","starred_url":"https://api.github.com/users/gabime/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gabime/subscriptions","organizations_url":"https://api.github.com/users/gabime/orgs","repos_url":"https://api.github.com/users/gabime/repos","events_url":"https://api.github.com/users/gabime/events{/privacy}","received_events_url":"https://api.github.com/users/gabime/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/gabime/spdlog/issues/3073/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/gabime/spdlog/issues/3073/timeline","performed_via_github_app":null,"state_reason":"completed"}