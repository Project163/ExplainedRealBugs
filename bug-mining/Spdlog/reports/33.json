{"url":"https://api.github.com/repos/gabime/spdlog/issues/1147","repository_url":"https://api.github.com/repos/gabime/spdlog","labels_url":"https://api.github.com/repos/gabime/spdlog/issues/1147/labels{/name}","comments_url":"https://api.github.com/repos/gabime/spdlog/issues/1147/comments","events_url":"https://api.github.com/repos/gabime/spdlog/issues/1147/events","html_url":"https://github.com/gabime/spdlog/issues/1147","id":467824121,"node_id":"MDU6SXNzdWU0Njc4MjQxMjE=","number":1147,"title":"spdlog::stderr_color_mt on windows breaks when stderr is not console.","user":{"login":"scudette","id":3856546,"node_id":"MDQ6VXNlcjM4NTY1NDY=","avatar_url":"https://avatars.githubusercontent.com/u/3856546?v=4","gravatar_id":"","url":"https://api.github.com/users/scudette","html_url":"https://github.com/scudette","followers_url":"https://api.github.com/users/scudette/followers","following_url":"https://api.github.com/users/scudette/following{/other_user}","gists_url":"https://api.github.com/users/scudette/gists{/gist_id}","starred_url":"https://api.github.com/users/scudette/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scudette/subscriptions","organizations_url":"https://api.github.com/users/scudette/orgs","repos_url":"https://api.github.com/users/scudette/repos","events_url":"https://api.github.com/users/scudette/events{/privacy}","received_events_url":"https://api.github.com/users/scudette/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-07-14T11:16:02Z","updated_at":"2019-07-14T15:35:21Z","closed_at":"2019-07-14T15:35:21Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Our application selects `spdlog::stderr_color_mt` which works when the program is run in the windows console but if a user redirects stderr then spdlog loses all messages. I think we still creates the wincolor sink and this calls WriteConsoleA on the (non console) handle. Note also that the wincolor sink ignores the error status of WriteConsole (It probably should repeat the logging with WriteFile) \r\n\r\nThis should fallback gracefully to simply writing to the handle as recommended in the MSDN article:\r\n\r\nhttps://docs.microsoft.com/en-us/windows/console/writeconsole\r\n\r\nWriteConsole fails if it is used with a standard handle that is redirected to a file. If an application processes multilingual output that can be redirected, determine whether the output handle is a console handle (one method is to call the GetConsoleMode function and check whether it succeeds). If the handle is a console handle, call WriteConsole. If the handle is not a console handle, the output is redirected and you should call WriteFile to perform the I/O. \r\n\r\n\r\n\r\n","closed_by":{"login":"gabime","id":6052198,"node_id":"MDQ6VXNlcjYwNTIxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/6052198?v=4","gravatar_id":"","url":"https://api.github.com/users/gabime","html_url":"https://github.com/gabime","followers_url":"https://api.github.com/users/gabime/followers","following_url":"https://api.github.com/users/gabime/following{/other_user}","gists_url":"https://api.github.com/users/gabime/gists{/gist_id}","starred_url":"https://api.github.com/users/gabime/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gabime/subscriptions","organizations_url":"https://api.github.com/users/gabime/orgs","repos_url":"https://api.github.com/users/gabime/repos","events_url":"https://api.github.com/users/gabime/events{/privacy}","received_events_url":"https://api.github.com/users/gabime/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/gabime/spdlog/issues/1147/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/gabime/spdlog/issues/1147/timeline","performed_via_github_app":null,"state_reason":"completed"}