{"url":"https://api.github.com/repos/gabime/spdlog/issues/761","repository_url":"https://api.github.com/repos/gabime/spdlog","labels_url":"https://api.github.com/repos/gabime/spdlog/issues/761/labels{/name}","comments_url":"https://api.github.com/repos/gabime/spdlog/issues/761/comments","events_url":"https://api.github.com/repos/gabime/spdlog/issues/761/events","html_url":"https://github.com/gabime/spdlog/issues/761","id":343092101,"node_id":"MDU6SXNzdWUzNDMwOTIxMDE=","number":761,"title":"Level 4 warnings when building with Visual Studio 2017 with 2015 XP toolset","user":{"login":"JoelTroch","id":4483707,"node_id":"MDQ6VXNlcjQ0ODM3MDc=","avatar_url":"https://avatars.githubusercontent.com/u/4483707?v=4","gravatar_id":"","url":"https://api.github.com/users/JoelTroch","html_url":"https://github.com/JoelTroch","followers_url":"https://api.github.com/users/JoelTroch/followers","following_url":"https://api.github.com/users/JoelTroch/following{/other_user}","gists_url":"https://api.github.com/users/JoelTroch/gists{/gist_id}","starred_url":"https://api.github.com/users/JoelTroch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JoelTroch/subscriptions","organizations_url":"https://api.github.com/users/JoelTroch/orgs","repos_url":"https://api.github.com/users/JoelTroch/repos","events_url":"https://api.github.com/users/JoelTroch/events{/privacy}","received_events_url":"https://api.github.com/users/JoelTroch/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-07-20T12:38:43Z","updated_at":"2018-07-22T08:57:13Z","closed_at":"2018-07-20T20:31:42Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Building spdlog through CMake using Visual Studio 2017 with the 2015 XP toolset (`v140_xp`) and setting the warning level to 4 (`/W4`) will provoke the following warnings:\r\n\r\nCommit: https://github.com/gabime/spdlog/commit/ddb3002bc16a68148d55b0280c4ce843ea415969\r\n\r\n**C4127 - Conditional expression is a constant**\r\nConcerned file: `format.h`.\r\nConcerned line: 3538\r\n\r\n```cpp\r\nbasic_memory_buffer<char_type> buffer;\r\nif (FMT_USE_GRISU && sizeof(T) <= sizeof(double) && std::numeric_limits<double>::is_iec559) // C4127\r\n{\r\n    internal::fp fp_value(static_cast<double>(value));\r\n    fp_value.normalize();\r\n\r\n    // ...\r\n```\r\n\r\n**C4244 - Argument conversion from 'int' to 'const char', possible data loss**\r\nConcerned file: `fmt_helper.h`.\r\nConcerned lines: 54, 61, 79, 87.\r\n\r\nCode:\r\n\r\n```cpp\r\ninline void pad2(int n, fmt::basic_memory_buffer<char, Buffer_Size> &dest)\r\n{\r\n    if (n > 99)\r\n    {\r\n        append_int(n, dest);\r\n        return;\r\n    }\r\n    if (n > 9) // 10-99\r\n    {\r\n        dest.push_back('0' + (n / 10)); // C4244\r\n        dest.push_back('0' + (n % 10));\r\n        return;\r\n    }\r\n    if (n >= 0) // 0-9\r\n    {\r\n        dest.push_back('0');\r\n        dest.push_back('0' + n); // C4244\r\n        return;\r\n    }\r\n    // negatives (unlikely, but just in case, let fmt deal with it)\r\n    fmt::format_to(dest, \"{:02}\", n);\r\n}\r\n\r\ntemplate<size_t Buffer_Size>\r\ninline void pad3(int n, fmt::basic_memory_buffer<char, Buffer_Size> &dest)\r\n{\r\n    if (n > 99)\r\n    {\r\n        append_int(n, dest);\r\n        return;\r\n    }\r\n    if (n > 9) // 10-99\r\n    {\r\n        dest.push_back('0');\r\n        dest.push_back('0' + n / 10); // C4244\r\n        dest.push_back('0' + n % 10);\r\n        return;\r\n    }\r\n    if (n >= 0)\r\n    {\r\n        dest.push_back('0');\r\n        dest.push_back('0');\r\n        dest.push_back('0' + n); // C4244\r\n        return;\r\n    }\r\n    // negatives (unlikely, but just in case let fmt deal with it)\r\n    fmt::format_to(dest, \"{:03}\", n);\r\n}\r\n```\r\n\r\n**C4702 - Unreachable code**\r\nConcerned file: `thread_pool.h`\r\nConcerned line: 213\r\n\r\nCode:\r\n```cpp\r\n// process next message in the queue\r\n// return true if this thread should still be active (while no terminate msg was received)\r\nbool process_next_msg_()\r\n{\r\n    async_msg incoming_async_msg;\r\n    bool dequeued = q_.dequeue_for(incoming_async_msg, std::chrono::seconds(10));\r\n    if (!dequeued)\r\n    {\r\n        return true;\r\n    }\r\n\r\n    switch (incoming_async_msg.msg_type)\r\n    {\r\n    case async_msg_type::flush:\r\n    {\r\n        incoming_async_msg.worker_ptr->backend_flush_();\r\n        return true;\r\n    }\r\n\r\n    case async_msg_type::terminate:\r\n    {\r\n        return false;\r\n    }\r\n\r\n    default:\r\n    {\r\n        log_msg msg;\r\n        incoming_async_msg.to_log_msg(msg);\r\n        incoming_async_msg.worker_ptr->backend_log_(msg);\r\n        return true;\r\n    }\r\n    }\r\n    assert(false); // C4702\r\n    return true; // should not be reached\r\n}\r\n```","closed_by":{"login":"gabime","id":6052198,"node_id":"MDQ6VXNlcjYwNTIxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/6052198?v=4","gravatar_id":"","url":"https://api.github.com/users/gabime","html_url":"https://github.com/gabime","followers_url":"https://api.github.com/users/gabime/followers","following_url":"https://api.github.com/users/gabime/following{/other_user}","gists_url":"https://api.github.com/users/gabime/gists{/gist_id}","starred_url":"https://api.github.com/users/gabime/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gabime/subscriptions","organizations_url":"https://api.github.com/users/gabime/orgs","repos_url":"https://api.github.com/users/gabime/repos","events_url":"https://api.github.com/users/gabime/events{/privacy}","received_events_url":"https://api.github.com/users/gabime/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/gabime/spdlog/issues/761/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/gabime/spdlog/issues/761/timeline","performed_via_github_app":null,"state_reason":"completed"}