{"url":"https://api.github.com/repos/gabime/spdlog/issues/1452","repository_url":"https://api.github.com/repos/gabime/spdlog","labels_url":"https://api.github.com/repos/gabime/spdlog/issues/1452/labels{/name}","comments_url":"https://api.github.com/repos/gabime/spdlog/issues/1452/comments","events_url":"https://api.github.com/repos/gabime/spdlog/issues/1452/events","html_url":"https://github.com/gabime/spdlog/issues/1452","id":569854810,"node_id":"MDU6SXNzdWU1Njk4NTQ4MTA=","number":1452,"title":"buffer overflow in color_sinks","user":{"login":"dominicpoeschko","id":45942148,"node_id":"MDQ6VXNlcjQ1OTQyMTQ4","avatar_url":"https://avatars.githubusercontent.com/u/45942148?v=4","gravatar_id":"","url":"https://api.github.com/users/dominicpoeschko","html_url":"https://github.com/dominicpoeschko","followers_url":"https://api.github.com/users/dominicpoeschko/followers","following_url":"https://api.github.com/users/dominicpoeschko/following{/other_user}","gists_url":"https://api.github.com/users/dominicpoeschko/gists{/gist_id}","starred_url":"https://api.github.com/users/dominicpoeschko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dominicpoeschko/subscriptions","organizations_url":"https://api.github.com/users/dominicpoeschko/orgs","repos_url":"https://api.github.com/users/dominicpoeschko/repos","events_url":"https://api.github.com/users/dominicpoeschko/events{/privacy}","received_events_url":"https://api.github.com/users/dominicpoeschko/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-02-24T13:26:41Z","updated_at":"2020-02-24T15:02:20Z","closed_at":"2020-02-24T15:01:35Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"``` c++\r\nint main() {\r\n    auto sink1 = std::make_shared<spdlog::sinks::stdout_color_sink_mt>();\r\n    auto sink2 = std::make_shared<spdlog::sinks::stderr_color_sink_mt>();\r\n\r\n    sink1->set_pattern(\"test%^%v%$test\");\r\n    sink2->set_pattern(\"%v\");\r\n\r\n    auto logger = std::make_shared<spdlog::logger>(\"\",sink1);\r\n    logger->sinks().push_back(sink2);\r\n\r\n    logger->error(\"foo\");\r\n}\r\n```\r\nWhen executing the above example ```sink2``` prints garbage.\r\nThe reason for that is the the formatter in ```sink1``` sets the ```color_range_end``` and ```color_range_start``` members. The formatter in ```sink2``` does not set them since there are no flags for that in the pattern. The Problem is that they are still set from ```sink1``` when running over all sinks in the ```logger::sink_it_``` method.\r\n\r\n``` c++\r\nvoid logger::sink_it_(const details::log_msg &msg)\r\n{\r\n    for (auto &sink : sinks_)\r\n    {\r\n        if (sink->should_log(msg.level))\r\n        {\r\n            SPDLOG_TRY\r\n            {\r\n                sink->log(msg);\r\n            }\r\n            SPDLOG_LOGGER_CATCH()\r\n        }\r\n    }\r\n\r\n    if (should_flush_(msg))\r\n    {\r\n        flush_();\r\n    }\r\n}\r\n```\r\nOne solution would be to reset them in ```pattern_formatter::format``` before running the individual formatters. But IÂ´m not sure if that is the best solution.\r\n\r\n\r\n\r\n\r\n","closed_by":{"login":"gabime","id":6052198,"node_id":"MDQ6VXNlcjYwNTIxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/6052198?v=4","gravatar_id":"","url":"https://api.github.com/users/gabime","html_url":"https://github.com/gabime","followers_url":"https://api.github.com/users/gabime/followers","following_url":"https://api.github.com/users/gabime/following{/other_user}","gists_url":"https://api.github.com/users/gabime/gists{/gist_id}","starred_url":"https://api.github.com/users/gabime/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gabime/subscriptions","organizations_url":"https://api.github.com/users/gabime/orgs","repos_url":"https://api.github.com/users/gabime/repos","events_url":"https://api.github.com/users/gabime/events{/privacy}","received_events_url":"https://api.github.com/users/gabime/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/gabime/spdlog/issues/1452/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/gabime/spdlog/issues/1452/timeline","performed_via_github_app":null,"state_reason":"completed"}