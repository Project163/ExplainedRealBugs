{"url":"https://api.github.com/repos/gabime/spdlog/issues/3016","repository_url":"https://api.github.com/repos/gabime/spdlog","labels_url":"https://api.github.com/repos/gabime/spdlog/issues/3016/labels{/name}","comments_url":"https://api.github.com/repos/gabime/spdlog/issues/3016/comments","events_url":"https://api.github.com/repos/gabime/spdlog/issues/3016/events","html_url":"https://github.com/gabime/spdlog/issues/3016","id":2140744241,"node_id":"I_kwDOAY1ReM5_mSox","number":3016,"title":"[Possible Bug] : undesired deletion of logger from registry(loggers_ map) ","user":{"login":"raj17ce","id":116947399,"node_id":"U_kgDOBvh5xw","avatar_url":"https://avatars.githubusercontent.com/u/116947399?v=4","gravatar_id":"","url":"https://api.github.com/users/raj17ce","html_url":"https://github.com/raj17ce","followers_url":"https://api.github.com/users/raj17ce/followers","following_url":"https://api.github.com/users/raj17ce/following{/other_user}","gists_url":"https://api.github.com/users/raj17ce/gists{/gist_id}","starred_url":"https://api.github.com/users/raj17ce/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/raj17ce/subscriptions","organizations_url":"https://api.github.com/users/raj17ce/orgs","repos_url":"https://api.github.com/users/raj17ce/repos","events_url":"https://api.github.com/users/raj17ce/events{/privacy}","received_events_url":"https://api.github.com/users/raj17ce/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2024-02-18T04:49:21Z","updated_at":"2024-04-25T22:32:21Z","closed_at":"2024-04-25T22:32:21Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Steps to produce\r\n1. Created a shared pointer of logger class and added it to registry.\r\n```C++\r\nstd::shared_ptr<spdlog::logger> myLogger = std::make_shared<spdlog::logger>(\"myLogger\");\r\nspdlog::register_logger(myLogger);\r\n```\r\n2. Set this logger to default logger\r\n```C++\r\nspdlog::set_default_logger(myLogger);\r\n```\r\n\r\n3. Create another shared pointer to a new logger object and set it default.\r\n```C++\r\nstd::shared_ptr<spdlog::logger> myLogger2 = std::make_shared<spdlog::logger>(\"myLogger2\");\r\nspdlog::set_default_logger(myLogger2);\r\n```\r\n\r\n4. when trying to access the first pointer(myLogger) from registry using get(\"myLogger\") method, it returns nullptr.\r\n```C++\r\nauto myLogger = spdlog::get(\"myLogger\");\r\n```\r\n\r\nThis is undesirable, as I registered myLogger into the registry. But changing the default logger not only changed the default logger but also deleted it from the registry map loggers_ .\r\n\r\nI tried to track the issue, and I found that while setting another default logger, the entry for the previous logger is erased from the registry map loggers_. \r\n\r\n[File] : registry-inl.h\r\n[Function]  : \r\n\r\n```C++\r\nSPDLOG_INLINE void registry::set_default_logger(std::shared_ptr<logger> new_default_logger) {\r\n    std::lock_guard<std::mutex> lock(logger_map_mutex_);\r\n    // remove previous default logger from the map\r\n    if (default_logger_ != nullptr) {\r\n        loggers_.erase(default_logger_->name());\r\n    }\r\n    if (new_default_logger != nullptr) {\r\n        loggers_[new_default_logger->name()] = new_default_logger;\r\n    }\r\n    default_logger_ = std::move(new_default_logger);\r\n}\r\n```\r\n\r\nInside the first if block, the entry is being erased.","closed_by":{"login":"gabime","id":6052198,"node_id":"MDQ6VXNlcjYwNTIxOTg=","avatar_url":"https://avatars.githubusercontent.com/u/6052198?v=4","gravatar_id":"","url":"https://api.github.com/users/gabime","html_url":"https://github.com/gabime","followers_url":"https://api.github.com/users/gabime/followers","following_url":"https://api.github.com/users/gabime/following{/other_user}","gists_url":"https://api.github.com/users/gabime/gists{/gist_id}","starred_url":"https://api.github.com/users/gabime/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gabime/subscriptions","organizations_url":"https://api.github.com/users/gabime/orgs","repos_url":"https://api.github.com/users/gabime/repos","events_url":"https://api.github.com/users/gabime/events{/privacy}","received_events_url":"https://api.github.com/users/gabime/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/gabime/spdlog/issues/3016/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/gabime/spdlog/issues/3016/timeline","performed_via_github_app":null,"state_reason":"completed"}