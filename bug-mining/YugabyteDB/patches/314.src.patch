diff --git a/src/yb/consensus/consensus_peers-test.cc b/src/yb/consensus/consensus_peers-test.cc
index 50bbf1f4e5..d9fa7fbc0e 100644
--- a/src/yb/consensus/consensus_peers-test.cc
+++ b/src/yb/consensus/consensus_peers-test.cc
@@ -47,10 +47,8 @@
 
 #include "yb/server/hybrid_clock.h"
 
-#include "yb/util/logging.h"
 #include "yb/util/metrics.h"
 #include "yb/util/scope_exit.h"
-#include "yb/util/source_location.h"
 #include "yb/util/status_log.h"
 #include "yb/util/test_macros.h"
 #include "yb/util/test_util.h"
@@ -63,8 +61,7 @@ METRIC_DECLARE_entity(tablet);
 DECLARE_int32(stuck_peer_call_threshold_ms);
 DECLARE_bool(force_recover_from_stuck_peer_call);
 
-namespace yb {
-namespace consensus {
+namespace yb::consensus {
 
 using log::Log;
 using log::LogOptions;
@@ -102,9 +99,10 @@ class ConsensusPeersTest : public YBTest {
                        fs_manager_->GetFirstTabletWalDirOrDie(kTableId, kTabletId),
                        fs_manager_->uuid(),
                        schema_,
-                       0, // schema_version
-                       nullptr, // table_metric_entity
-                       nullptr, // tablet_metric_entity
+                       /*schema_version=*/0,
+                       /*table_metric_entity=*/nullptr,
+                       /*tablet_metric_entity=*/nullptr,
+                       /*read_wal_mem_tracker=*/nullptr,
                        log_thread_pool_.get(),
                        log_thread_pool_.get(),
                        log_thread_pool_.get(),
@@ -120,12 +118,12 @@ class ConsensusPeersTest : public YBTest {
     message_queue_.reset(new PeerMessageQueue(
         metric_entity_,
         log_.get(),
-        nullptr /* server_tracker */,
-        nullptr /* parent_tracker */,
+        /*server_tracker=*/nullptr,
+        /*parent_tracker=*/nullptr,
         FakeRaftPeerPB(kLeaderUuid),
         kTabletId,
         clock_,
-        nullptr /* consensus_context */,
+        /*context=*/nullptr,
         std::make_unique<rpc::Strand>(raft_notifications_pool_.get())));
     message_queue_->RegisterObserver(consensus_.get());
 
@@ -421,5 +419,4 @@ TEST_F(ConsensusPeersTest, TestDontSendOneRpcPerWriteWhenPeerIsDown) {
   ASSERT_LT(mock_proxy->update_count() - initial_update_count, 5);
 }
 
-}  // namespace consensus
-}  // namespace yb
+} // namespace yb::consensus
diff --git a/src/yb/consensus/consensus_queue-test.cc b/src/yb/consensus/consensus_queue-test.cc
index 61222295c2..5d642b7b40 100644
--- a/src/yb/consensus/consensus_queue-test.cc
+++ b/src/yb/consensus/consensus_queue-test.cc
@@ -60,8 +60,7 @@ DECLARE_uint64(consensus_max_batch_size_bytes);
 
 METRIC_DECLARE_entity(tablet);
 
-namespace yb {
-namespace consensus {
+namespace yb::consensus {
 
 static const char* kLeaderUuid = "peer-0";
 static const char* kPeerUuid = "peer-1";
@@ -91,8 +90,9 @@ class ConsensusQueueTest : public YBTest {
                             fs_manager_->uuid(),
                             schema_,
                             0, // schema_version
-                            nullptr,
-                            nullptr,
+                            /*table_metric_entity=*/nullptr,
+                            /*tablet_metric_entity=*/nullptr,
+                            /*read_wal_mem_tracker=*/nullptr,
                             log_thread_pool_.get(),
                             log_thread_pool_.get(),
                             log_thread_pool_.get(),
@@ -116,12 +116,12 @@ class ConsensusQueueTest : public YBTest {
     auto notify_observers_strand = std::make_unique<rpc::Strand>(raft_notifications_pool_.get());
     queue_.reset(new PeerMessageQueue(metric_entity_,
                                       log_.get(),
-                                      nullptr /* server_tracker */,
-                                      nullptr /* parent_tracker */,
+                                      /*server_tracker=*/nullptr,
+                                      /*parent_tracker=*/nullptr,
                                       FakeRaftPeerPB(kLeaderUuid),
                                       kTestTablet,
                                       clock_,
-                                      nullptr /* consensus_context */,
+                                      /*context=*/nullptr,
                                       std::move(notify_observers_strand)));
     SetupConsensus();
     queue_->RegisterObserver(consensus_.get());
@@ -1058,5 +1058,4 @@ TEST_F(ConsensusQueueDelayedCommitTest, TestReadReplicatedMessagesForXCluster) {
   ASSERT_EQ(received_op_id.index, read_result.majority_replicated_index);
 }
 
-}  // namespace consensus
-}  // namespace yb
+} // namespace yb::consensus
diff --git a/src/yb/consensus/log-dump.cc b/src/yb/consensus/log-dump.cc
index d4dd274a61..1ca7d61e17 100644
--- a/src/yb/consensus/log-dump.cc
+++ b/src/yb/consensus/log-dump.cc
@@ -58,8 +58,8 @@
 #include "yb/util/metric_entity.h"
 #include "yb/util/pb_util.h"
 #include "yb/util/result.h"
-#include "yb/util/slice.h"
 #include "yb/util/size_literals.h"
+#include "yb/util/slice.h"
 #include "yb/util/status_format.h"
 
 DEFINE_NON_RUNTIME_bool(print_headers, true, "print the log segment headers/footers");
@@ -89,8 +89,7 @@ DEFINE_NON_RUNTIME_int64(max_op_index_to_omit, yb::OpId::Invalid().index,
 DEFINE_NON_RUNTIME_string(output_wal_dir, "",
              "WAL directory for the output of --filter_log_segment");
 
-namespace yb {
-namespace log {
+namespace yb::log {
 
 using consensus::ReplicateMsg;
 using std::string;
@@ -105,11 +104,11 @@ enum PrintEntryType {
 };
 
 static PrintEntryType ParsePrintType() {
-  if (!ParseLeadingBoolValue(FLAGS_print_entries.c_str(), true)) {
+  if (!ParseLeadingBoolValue(FLAGS_print_entries.c_str(), /*deflt=*/true)) {
     return DONT_PRINT;
   }
 
-  if (ParseLeadingBoolValue(FLAGS_print_entries.c_str(), false) ||
+  if (ParseLeadingBoolValue(FLAGS_print_entries.c_str(), /*deflt=*/false) ||
       FLAGS_print_entries == "decoded") {
     return PRINT_DECODED;
   }
@@ -173,7 +172,7 @@ Status PrintDecodedWriteRequestPB(const string& indent, const tablet::WritePB& w
       if (kv.has_value()) {
         Result<std::string> formatted_value = DocDBValueToDebugStr(
             kv.key(), ::yb::docdb::StorageDbType::kRegular, kv.value(),
-            nullptr /*schema_packing_provider*/);
+            /*schema_packing_provider=*/nullptr);
         cout << indent << indent << indent << indent << "Value: " << formatted_value << endl;
       }
       if (kv.has_external_hybrid_time()) {
@@ -302,6 +301,7 @@ Status DumpLog(const string& tablet_id, const string& tablet_wal_path) {
                                 tablet_wal_path,
                                 scoped_refptr<MetricEntity>(),
                                 scoped_refptr<MetricEntity>(),
+                                /*read_wal_mem_tracker=*/nullptr,
                                 &reader));
 
   SegmentSequence segments;
@@ -314,9 +314,10 @@ Status DumpLog(const string& tablet_id, const string& tablet_wal_path) {
   return Status::OK();
 }
 
-Status DumpSegment(const string &segment_path) {
-  Env *env = Env::Default();
-  auto segment = VERIFY_RESULT(ReadableLogSegment::Open(env, segment_path));
+Status DumpSegment(const string& segment_path) {
+  Env* env = Env::Default();
+  auto segment =
+      VERIFY_RESULT(ReadableLogSegment::Open(env, segment_path, /*read_wal_mem_tracker=*/nullptr));
   RETURN_NOT_OK(PrintSegment(segment));
 
   return Status::OK();
@@ -337,7 +338,8 @@ Status FilterLogSegment(const string& segment_path) {
   output_wal_dir = VERIFY_RESULT(env->Canonicalize(output_wal_dir));
   LOG(INFO) << "Created directory " << output_wal_dir;
 
-  auto segment = VERIFY_RESULT(ReadableLogSegment::Open(env, segment_path));
+  auto segment =
+      VERIFY_RESULT(ReadableLogSegment::Open(env, segment_path, /*read_wal_mem_tracker=*/nullptr));
   Schema tablet_schema;
   const auto& segment_header = segment->header();
 
@@ -405,8 +407,9 @@ Status FilterLogSegment(const string& segment_path) {
       "log-dump-tool",
       tablet_schema,
       segment_header.deprecated_schema_version(),
-      /* table_metric_entity */ nullptr,
-      /* tablet_metric_entity */ nullptr,
+      /*table_metric_entity=*/nullptr,
+      /*tablet_metric_entity=*/nullptr,
+      /*read_wal_mem_tracker=*/nullptr,
       log_thread_pool.get(),
       log_thread_pool.get(),
       log_thread_pool.get(),
@@ -444,11 +447,10 @@ Status FilterLogSegment(const string& segment_path) {
   return Status::OK();
 }
 
-}  // namespace log
-}  // namespace yb
+} // namespace yb::log
 
 int main(int argc, char **argv) {
-  yb::ParseCommandLineFlags(&argc, &argv, true);
+  yb::ParseCommandLineFlags(&argc, &argv, /*remove_flags=*/true);
   using yb::Status;
 
   if (argc != 2 && argc != 3) {
diff --git a/src/yb/consensus/log-test-base.h b/src/yb/consensus/log-test-base.h
index 6f7d2a2396..3438081e97 100644
--- a/src/yb/consensus/log-test-base.h
+++ b/src/yb/consensus/log-test-base.h
@@ -34,7 +34,6 @@
 #include <utility>
 #include <vector>
 
-#include "yb/util/logging.h"
 #include <gtest/gtest.h>
 
 #include "yb/common/hybrid_time.h"
@@ -45,14 +44,13 @@
 #include "yb/consensus/consensus.messages.h"
 #include "yb/consensus/log.h"
 #include "yb/consensus/log_anchor_registry.h"
+#include "yb/consensus/log_index.h"
 #include "yb/consensus/log_reader.h"
 #include "yb/consensus/opid_util.h"
 
 #include "yb/fs/fs_manager.h"
 
 #include "yb/gutil/bind.h"
-#include "yb/gutil/stl_util.h"
-#include "yb/gutil/stringprintf.h"
 #include "yb/gutil/strings/substitute.h"
 #include "yb/gutil/strings/util.h"
 
@@ -64,22 +62,19 @@
 #include "yb/tserver/tserver.pb.h"
 
 #include "yb/util/async_util.h"
-#include "yb/util/env_util.h"
 #include "yb/util/metrics.h"
 #include "yb/util/path_util.h"
 #include "yb/util/result.h"
 #include "yb/util/test_macros.h"
 #include "yb/util/test_util.h"
 #include "yb/util/threadpool.h"
-#include "yb/consensus/log_index.h"
 
 METRIC_DECLARE_entity(table);
 METRIC_DECLARE_entity(tablet);
 
 DECLARE_int32(log_min_seconds_to_retain);
 
-namespace yb {
-namespace log {
+namespace yb::log {
 
 using consensus::ReplicateMsg;
 using consensus::WRITE_OP;
@@ -145,9 +140,9 @@ static Status AppendNoOpToLogSync(const scoped_refptr<Clock>& clock,
 class LogTestBase : public YBTest {
  public:
 
-  typedef std::pair<int, int> DeltaId;
+  using DeltaId = std::pair<int, int>;
 
-  typedef std::tuple<int, int, std::string> TupleForAppend;
+  using TupleForAppend = std::tuple<int, int, std::string>;
 
   LogTestBase()
       : schema_({
@@ -191,6 +186,7 @@ class LogTestBase : public YBTest {
                        0, // schema_version
                        table_metric_entity_.get(),
                        tablet_metric_entity_.get(),
+                       /*read_wal_mem_tracker=*/nullptr,
                        log_thread_pool_.get(),
                        log_thread_pool_.get(),
                        log_thread_pool_.get(),
@@ -401,8 +397,9 @@ Status CorruptLogFile(Env* env, const std::string& log_path,
 Result<SegmentSequence> GetReadableSegments(const std::string& wal_dir_path) {
   SegmentSequence segments;
   std::unique_ptr<LogReader> reader;
-  RETURN_NOT_OK(LogReader::Open(Env::Default(), nullptr, "Log reader", wal_dir_path,
-                                 nullptr, nullptr, &reader));
+  RETURN_NOT_OK(LogReader::Open(
+      Env::Default(), nullptr, "Log reader", wal_dir_path, nullptr, nullptr,
+      /*read_wal_mem_tracker=*/nullptr, &reader));
   RETURN_NOT_OK(reader->GetSegmentsSnapshot(&segments));
   return segments;
 }
@@ -426,5 +423,4 @@ Result<size_t> GetSegmentsCount(const std::string& wal_dir_path) {
   return segments.size();
 }
 
-} // namespace log
-} // namespace yb
+} // namespace yb::log
diff --git a/src/yb/consensus/log-test.cc b/src/yb/consensus/log-test.cc
index 7fa759833a..353c0b663a 100644
--- a/src/yb/consensus/log-test.cc
+++ b/src/yb/consensus/log-test.cc
@@ -52,10 +52,8 @@
 #include "yb/gutil/strings/substitute.h"
 
 #include "yb/util/backoff_waiter.h"
-#include "yb/util/random.h"
 #include "yb/util/size_literals.h"
 #include "yb/util/stopwatch.h"
-#include "yb/util/flags.h"
 
 DEFINE_NON_RUNTIME_int32(num_batches, 10000,
              "Number of batches to write to/read from the Log in TestWriteManyBatches");
@@ -70,8 +68,7 @@ DECLARE_bool(TEST_skip_file_close);
 DECLARE_int64(reuse_unclosed_segment_threshold_bytes);
 DECLARE_int32(min_segment_size_bytes_to_rollover_at_flush);
 
-namespace yb {
-namespace log {
+namespace yb::log {
 
 using namespace std::literals;
 
@@ -132,8 +129,8 @@ class LogTest : public LogTestBase {
     std::unique_ptr<RandomAccessFile> r_log_seg;
     RETURN_NOT_OK(fs_manager_->env()->NewRandomAccessFile(fqp, &r_log_seg));
 
-    scoped_refptr<ReadableLogSegment> readable_segment(
-        new ReadableLogSegment(fqp, shared_ptr<RandomAccessFile>(r_log_seg.release())));
+    scoped_refptr<ReadableLogSegment> readable_segment(new ReadableLogSegment(
+        fqp, shared_ptr<RandomAccessFile>(r_log_seg.release()), /*read_wal_mem_tracker=*/nullptr));
 
     LogSegmentHeaderPB header;
     header.set_sequence_number(sequence_number);
@@ -181,9 +178,10 @@ class LogTest : public LogTestBase {
     std::unique_ptr<LogReader> copied_log_reader;
     auto log_index = VERIFY_RESULT(LogIndex::NewLogIndex(log_copy_dir));
     RETURN_NOT_OK(LogReader::Open(
-        fs_manager_->env(), log_index, "Log reader: ",
-        log_copy_dir, /* table_metric_entity = */ nullptr,
-        /* tablet_metric_entity = */ nullptr, &copied_log_reader));
+        fs_manager_->env(), log_index, "Log reader: ", log_copy_dir,
+        /*table_metric_entity=*/nullptr,
+        /*tablet_metric_entity=*/nullptr,
+        /*read_wal_mem_tracker=*/nullptr, &copied_log_reader));
 
     return copied_log_reader;
   }
@@ -549,7 +547,8 @@ void LogTest::DoCorruptionTest(CorruptionType type, CorruptionPosition place,
   auto log_index = ASSERT_RESULT(LogIndex::NewLogIndex(log_->wal_dir_));
   ASSERT_OK(LogReader::Open(
       fs_manager_->env(), log_index, "Log reader: ", tablet_wal_path_,
-      /* table_metric_entity = */ nullptr, /* tablet_metric_entity = */ nullptr, &reader));
+      /*table_metric_entity=*/nullptr, /*tablet_metric_entity=*/nullptr,
+      /*read_wal_mem_tracker=*/nullptr, &reader));
   ASSERT_EQ(1, reader->num_segments());
 
   SegmentSequence segments;
@@ -678,7 +677,9 @@ TEST_F(LogTest, TestSegmentRollover) {
 
   std::unique_ptr<LogReader> reader;
   ASSERT_OK(LogReader::Open(
-      fs_manager_->env(), nullptr, "Log reader: ", tablet_wal_path_, nullptr, nullptr, &reader));
+      fs_manager_->env(), /*index=*/nullptr, "Log reader: ", tablet_wal_path_,
+      /*table_metric_entity=*/nullptr, /*tablet_metric_entity=*/nullptr,
+      /*read_wal_mem_tracker=*/nullptr, &reader));
   ASSERT_OK(reader->GetSegmentsSnapshot(&segments));
 
   last_segment = ASSERT_RESULT(segments.back());
@@ -1013,8 +1014,9 @@ TEST_F(LogTest, TestWriteManyBatches) {
 
     std::unique_ptr<LogReader> reader;
     ASSERT_OK(LogReader::Open(
-        fs_manager_->env(), /* index= */ nullptr, "Log reader: ", tablet_wal_path_,
-        /* table_metric_entity= */ nullptr, /* tablet_metric_entity= */ nullptr, &reader));
+        fs_manager_->env(), /*index=*/nullptr, "Log reader: ", tablet_wal_path_,
+        /*table_metric_entity=*/nullptr, /*tablet_metric_entity=*/nullptr,
+        /*read_wal_mem_tracker=*/nullptr, &reader));
 
     SegmentSequence segments;
     ASSERT_OK(reader->GetSegmentsSnapshot(&segments));
@@ -1036,11 +1038,9 @@ TEST_F(LogTest, TestWriteManyBatches) {
 // seg003: 0.20 through 0.29
 // seg004: 0.30 through 0.39
 TEST_F(LogTest, TestLogReader) {
-  LogReader reader(fs_manager_->env(),
-                   scoped_refptr<LogIndex>(),
-                   "Log reader: ",
-                   nullptr,
-                   nullptr);
+  LogReader reader(
+      fs_manager_->env(), scoped_refptr<LogIndex>(), "Log reader: ", nullptr, nullptr,
+      /*read_wal_mem_tracker=*/nullptr);
   ASSERT_OK(reader.InitEmptyReaderForTests());
   ASSERT_OK(AppendNewEmptySegmentToReader(2, 10, &reader));
   ASSERT_OK(AppendNewEmptySegmentToReader(3, 20, &reader));
@@ -1832,5 +1832,4 @@ TEST_F(LogTest, AsyncRolloverMarker) {
   ASSERT_EQ(log_->active_segment_sequence_number(), seq_no + 1);
 }
 
-} // namespace log
-} // namespace yb
+} // namespace yb::log
diff --git a/src/yb/consensus/log.cc b/src/yb/consensus/log.cc
index 28f212d8b7..e6792c9189 100644
--- a/src/yb/consensus/log.cc
+++ b/src/yb/consensus/log.cc
@@ -40,7 +40,6 @@
 #include <mutex>
 #include <thread>
 #include <vector>
-#include <shared_mutex>
 
 #include <boost/algorithm/string/predicate.hpp>
 
@@ -60,24 +59,19 @@
 #include "yb/fs/fs_manager.h"
 
 #include "yb/gutil/bind.h"
-#include "yb/gutil/map-util.h"
 #include "yb/gutil/ref_counted.h"
-#include "yb/gutil/stl_util.h"
 #include "yb/gutil/strings/substitute.h"
 #include "yb/gutil/walltime.h"
 
 #include "yb/util/async_util.h"
 #include "yb/util/callsite_profiling.h"
-#include "yb/util/countdown_latch.h"
-#include "yb/util/crc.h"
 #include "yb/util/debug-util.h"
 #include "yb/util/debug/long_operation_tracker.h"
 #include "yb/util/debug/trace_event.h"
 #include "yb/util/env_util.h"
 #include "yb/util/fault_injection.h"
-#include "yb/util/file_util.h"
-#include "yb/util/flags.h"
 #include "yb/util/flag_validators.h"
+#include "yb/util/flags.h"
 #include "yb/util/format.h"
 #include "yb/util/logging.h"
 #include "yb/util/metrics.h"
@@ -88,9 +82,9 @@
 #include "yb/util/scope_exit.h"
 #include "yb/util/shared_lock.h"
 #include "yb/util/size_literals.h"
+#include "yb/util/status.h"
 #include "yb/util/status_format.h"
 #include "yb/util/status_log.h"
-#include "yb/util/status.h"
 #include "yb/util/stopwatch.h"
 #include "yb/util/taskstream.h"
 #include "yb/util/trace.h"
@@ -276,8 +270,7 @@ DEFINE_RUNTIME_AUTO_bool(store_last_wal_op_log_ht, kLocalPersisted, false, true,
 static std::string kSegmentPlaceholderFilePrefix = ".tmp.newsegment";
 static std::string kSegmentPlaceholderFileTemplate = kSegmentPlaceholderFilePrefix + "XXXXXX";
 
-namespace yb {
-namespace log {
+namespace yb::log {
 
 using env_util::OpenFileForRandom;
 using std::shared_ptr;
@@ -629,6 +622,7 @@ Status Log::Open(const LogOptions &options,
                  uint32_t schema_version,
                  const scoped_refptr<MetricEntity>& table_metric_entity,
                  const scoped_refptr<MetricEntity>& tablet_metric_entity,
+                 std::shared_ptr<MemTracker> read_wal_mem_tracker,
                  ThreadPool* append_thread_pool,
                  ThreadPool* allocation_thread_pool,
                  ThreadPool* background_sync_threadpool,
@@ -651,6 +645,7 @@ Status Log::Open(const LogOptions &options,
                                      schema_version,
                                      table_metric_entity,
                                      tablet_metric_entity,
+                                     std::move(read_wal_mem_tracker),
                                      append_thread_pool,
                                      allocation_thread_pool,
                                      background_sync_threadpool,
@@ -672,6 +667,7 @@ Log::Log(
     uint32_t schema_version,
     const scoped_refptr<MetricEntity>& table_metric_entity,
     const scoped_refptr<MetricEntity>& tablet_metric_entity,
+    std::shared_ptr<MemTracker> read_wal_mem_tracker,
     ThreadPool* append_thread_pool,
     ThreadPool* allocation_thread_pool,
     ThreadPool* background_sync_threadpool,
@@ -702,6 +698,7 @@ Log::Log(
       allocation_state_(SegmentAllocationState::kAllocationNotStarted),
       table_metric_entity_(table_metric_entity),
       tablet_metric_entity_(tablet_metric_entity),
+      read_wal_mem_tracker_(std::move(read_wal_mem_tracker)),
       on_disk_size_(0),
       log_prefix_(consensus::MakeTabletLogPrefix(tablet_id_, peer_uuid_)),
       create_new_segment_at_start_(create_new_segment),
@@ -737,6 +734,7 @@ Status Log::Init() {
                                 wal_dir_,
                                 table_metric_entity_.get(),
                                 tablet_metric_entity_.get(),
+                                read_wal_mem_tracker_,
                                 &reader_));
 
   // The case where we are continuing an existing log.  We must pick up where the previous WAL left
@@ -1356,8 +1354,8 @@ Status Log::Sync() {
         break;
       }
       fsync_task_in_queue_.store(true, std::memory_order_release);
-      auto status = background_sync_threadpool_token_->SubmitFunc(
-          std::bind(&Log::DoSyncAndResetTaskInQueue, this));
+      auto status =
+          background_sync_threadpool_token_->SubmitFunc([this] { DoSyncAndResetTaskInQueue(); });
       if (!status.ok()) {
         LOG_WITH_PREFIX(WARNING) << "Pushing sync operation to log-sync queue failed with "
                                  << "status " << status;
@@ -2051,9 +2049,9 @@ Status Log::SwitchToAllocatedSegment() {
   std::unique_ptr<RandomAccessFile> readable_file;
   RETURN_NOT_OK(get_env()->NewRandomAccessFile(new_segment_path, &readable_file));
 
-  scoped_refptr<ReadableLogSegment> readable_segment(
-    new ReadableLogSegment(new_segment_path,
-                           shared_ptr<RandomAccessFile>(readable_file.release())));
+  scoped_refptr<ReadableLogSegment> readable_segment(new ReadableLogSegment(
+      new_segment_path, shared_ptr<RandomAccessFile>(readable_file.release()),
+      read_wal_mem_tracker_));
   RETURN_NOT_OK(readable_segment->Init(header, new_segment->first_entry_offset()));
   RETURN_NOT_OK(reader_->AppendEmptySegment(readable_segment));
   // Now set 'active_segment_' to the new segment.
@@ -2079,7 +2077,7 @@ Status Log::ReplaceSegmentInReaderUnlocked() {
       get_env(), active_segment_->path(), &readable_file));
 
   scoped_refptr<ReadableLogSegment> readable_segment(
-      new ReadableLogSegment(active_segment_->path(), readable_file));
+      new ReadableLogSegment(active_segment_->path(), readable_file, read_wal_mem_tracker_));
   // Note: active_segment->header() will only contain an initialized PB if we wrote the header out.
   RETURN_NOT_OK(readable_segment->Init(active_segment_->header(),
                                        active_segment_->footer(),
@@ -2311,5 +2309,4 @@ void Log::UpdateMinStartTimeRunningTxnsFromGCSegments(const SegmentSequence& seg
   }
 }
 
-}  // namespace log
-}  // namespace yb
+} // namespace yb::log
diff --git a/src/yb/consensus/log.h b/src/yb/consensus/log.h
index ee02ace844..80e9cddebc 100644
--- a/src/yb/consensus/log.h
+++ b/src/yb/consensus/log.h
@@ -37,11 +37,9 @@
 
 #include <atomic>
 #include <condition_variable>
-#include <map>
 #include <memory>
 #include <mutex>
 #include <string>
-#include <vector>
 
 #include <boost/atomic.hpp>
 
@@ -51,23 +49,18 @@
 #include "yb/common/hybrid_time.h"
 #include "yb/common/opid.h"
 
-#include "yb/consensus/consensus_fwd.h"
 #include "yb/consensus/log_util.h"
 
 #include "yb/fs/fs_manager.h"
 
 #include "yb/gutil/macros.h"
 #include "yb/gutil/ref_counted.h"
-#include "yb/gutil/spinlock.h"
 
-#include "yb/util/status_fwd.h"
 #include "yb/util/locks.h"
-#include "yb/util/logging.h"
 #include "yb/util/monotime.h"
-#include "yb/util/mutex.h"
 #include "yb/util/promise.h"
-#include "yb/util/shared_lock.h"
 #include "yb/util/status_callback.h"
+#include "yb/util/status_fwd.h"
 #include "yb/util/threadpool.h"
 
 namespace yb {
@@ -152,6 +145,7 @@ class Log : public RefCountedThreadSafe<Log> {
       uint32_t schema_version,
       const scoped_refptr<MetricEntity>& table_metric_entity,
       const scoped_refptr<MetricEntity>& tablet_metric_entity,
+      std::shared_ptr<MemTracker> read_wal_mem_tracker,
       ThreadPool* append_thread_pool,
       ThreadPool* allocation_thread_pool,
       ThreadPool* background_sync_threadpool,
@@ -382,6 +376,7 @@ class Log : public RefCountedThreadSafe<Log> {
       uint32_t schema_version,
       const scoped_refptr<MetricEntity>& table_metric_entity,
       const scoped_refptr<MetricEntity>& tablet_metric_entity,
+      std::shared_ptr<MemTracker> read_wal_mem_tracker,
       ThreadPool* append_thread_pool,
       ThreadPool* allocation_thread_pool,
       ThreadPool* background_sync_threadpool,
@@ -504,8 +499,7 @@ class Log : public RefCountedThreadSafe<Log> {
   // Returns true if max_included_op_id is before or inside the segment and false otherwise.
 
   Result<bool> CopySegmentUpTo(
-      ReadableLogSegment* segment, const std::string& dest_wal_dir,
-      const OpId& max_included_op_id);
+      ReadableLogSegment* segment, const std::string& dest_wal_dir, const OpId& max_included_op_id);
 
   // Asynchronously appends 'entry' to the log. Once the append completes and is synced, 'callback'
   // will be invoked.
@@ -653,6 +647,8 @@ class Log : public RefCountedThreadSafe<Log> {
   scoped_refptr<MetricEntity> tablet_metric_entity_;
   std::unique_ptr<LogMetrics> metrics_;
 
+  std::shared_ptr<MemTracker> read_wal_mem_tracker_;
+
   // The cached on-disk size of the log, used to track its size even if it has been closed.
   std::atomic<uint64_t> on_disk_size_;
 
diff --git a/src/yb/consensus/log_cache-test.cc b/src/yb/consensus/log_cache-test.cc
index 6bcb9913e2..6dc71421a2 100644
--- a/src/yb/consensus/log_cache-test.cc
+++ b/src/yb/consensus/log_cache-test.cc
@@ -31,7 +31,6 @@
 //
 
 #include <atomic>
-#include <chrono>
 #include <memory>
 #include <string>
 #include <thread>
@@ -49,7 +48,6 @@
 #include "yb/fs/fs_manager.h"
 
 #include "yb/gutil/bind.h"
-#include "yb/gutil/stl_util.h"
 
 #include "yb/server/hybrid_clock.h"
 
@@ -78,8 +76,7 @@ using std::vector;
 using std::thread;
 using namespace std::chrono_literals;
 
-namespace yb {
-namespace consensus {
+namespace yb::consensus {
 
 static const char* kPeerUuid = "leader";
 static const char* kTestTable = "test-table";
@@ -111,9 +108,10 @@ class LogCacheTest : public YBTest {
                             fs_manager_->GetFirstTabletWalDirOrDie(kTestTable, kTestTablet),
                             fs_manager_->uuid(),
                             schema_,
-                            0, // schema_version
-                            nullptr, // table_metrics_entity
-                            nullptr, // tablet_metrics_entity
+                            /*schema_version=*/0,
+                            /*table_metrics_entity=*/nullptr,
+                            /*tablet_metrics_entity=*/nullptr,
+                            /*read_wal_mem_tracker=*/nullptr,
                             log_thread_pool_.get(),
                             log_thread_pool_.get(),
                             log_thread_pool_.get(),
@@ -484,5 +482,4 @@ TEST_F(LogCacheTest, TestMTReadAndWrite) {
   ASSERT_GT(num_appended, 0);
 }
 
-} // namespace consensus
-} // namespace yb
+} // namespace yb::consensus
diff --git a/src/yb/consensus/log_reader.cc b/src/yb/consensus/log_reader.cc
index 56520d3bcc..6cac6a6187 100644
--- a/src/yb/consensus/log_reader.cc
+++ b/src/yb/consensus/log_reader.cc
@@ -36,21 +36,17 @@
 #include <mutex>
 
 #include "yb/consensus/consensus.messages.h"
-#include "yb/consensus/consensus_util.h"
 #include "yb/consensus/log.messages.h"
 #include "yb/consensus/log_index.h"
 #include "yb/consensus/log_util.h"
 
 #include "yb/gutil/dynamic_annotations.h"
 
-#include "yb/util/env_util.h"
-#include "yb/util/flags.h"
 #include "yb/util/logging.h"
 #include "yb/util/metrics.h"
 #include "yb/util/monotime.h"
 #include "yb/util/path_util.h"
 #include "yb/util/result.h"
-#include "yb/util/std_util.h"
 
 using std::string;
 
@@ -93,8 +89,7 @@ DEFINE_test_flag(int32, get_changes_read_loop_delay_ms, 0,
                  "Amount of time to sleep for between each iteration of the loop in "
                  "ReadReplicatesInRange. This is used to test the return of partial results.");
 
-namespace yb {
-namespace log {
+namespace yb::log {
 
 namespace {
 struct LogSegmentSeqnoComparator {
@@ -109,15 +104,14 @@ using strings::Substitute;
 
 const int64_t LogReader::kNoSizeLimit = -1;
 
-Status LogReader::Open(Env *env,
-                       const scoped_refptr<LogIndex>& index,
-                       std::string log_prefix,
-                       const std::string& tablet_wal_path,
-                       const scoped_refptr<MetricEntity>& table_metric_entity,
-                       const scoped_refptr<MetricEntity>& tablet_metric_entity,
-                       std::unique_ptr<LogReader> *reader) {
+Status LogReader::Open(
+    Env* env, const scoped_refptr<LogIndex>& index, std::string log_prefix,
+    const std::string& tablet_wal_path, const scoped_refptr<MetricEntity>& table_metric_entity,
+    const scoped_refptr<MetricEntity>& tablet_metric_entity,
+    std::shared_ptr<MemTracker> read_wal_mem_tracker, std::unique_ptr<LogReader>* reader) {
   std::unique_ptr<LogReader> log_reader(new LogReader(
-      env, index, std::move(log_prefix), table_metric_entity, tablet_metric_entity));
+      env, index, std::move(log_prefix), table_metric_entity, tablet_metric_entity,
+      std::move(read_wal_mem_tracker)));
 
   RETURN_NOT_OK(log_reader->Init(tablet_wal_path));
   *reader = std::move(log_reader);
@@ -128,10 +122,12 @@ LogReader::LogReader(Env* env,
                      const scoped_refptr<LogIndex>& index,
                      std::string log_prefix,
                      const scoped_refptr<MetricEntity>& table_metric_entity,
-                     const scoped_refptr<MetricEntity>& tablet_metric_entity)
+                     const scoped_refptr<MetricEntity>& tablet_metric_entity,
+                     std::shared_ptr<MemTracker> read_wal_mem_tracker)
     : env_(env),
       log_index_(index),
       log_prefix_(std::move(log_prefix)),
+      read_wal_mem_tracker_(std::move(read_wal_mem_tracker)),
       state_(kLogReaderInitialized) {
   if (table_metric_entity) {
     read_batch_latency_ = METRIC_log_reader_read_batch_latency.Instantiate(table_metric_entity);
@@ -149,8 +145,7 @@ LogReader::LogReader(Env* env,
   }
 }
 
-LogReader::~LogReader() {
-}
+LogReader::~LogReader() = default;
 
 Status LogReader::Init(const string& tablet_wal_path) {
   {
@@ -178,8 +173,9 @@ Status LogReader::Init(const string& tablet_wal_path) {
     }
 
     string fqp = JoinPathSegments(tablet_wal_path, potential_log_file);
-    auto segment = VERIFY_RESULT_PREPEND(ReadableLogSegment::Open(env_, fqp),
-                                         Format("Unable to open readable log segment: $0", fqp));
+    auto segment = VERIFY_RESULT_PREPEND(
+        ReadableLogSegment::Open(env_, fqp, read_wal_mem_tracker_),
+        Format("Unable to open readable log segment: $0", fqp));
     if (!segment) {
       LOG_WITH_PREFIX(INFO) << "Log segment w/o header: " << fqp << ", skipping";
       continue;
@@ -732,5 +728,4 @@ Result<LogIndexEntry> LogReader::TEST_GetIndexEntry(const int64_t index) const {
   return GetIndexEntry(index);
 }
 
-}  // namespace log
-}  // namespace yb
+} // namespace yb::log
diff --git a/src/yb/consensus/log_reader.h b/src/yb/consensus/log_reader.h
index 4e759834bc..90f21339de 100644
--- a/src/yb/consensus/log_reader.h
+++ b/src/yb/consensus/log_reader.h
@@ -31,9 +31,7 @@
 //
 #pragma once
 
-#include <map>
 #include <string>
-#include <utility>
 #include <vector>
 
 #include <gtest/gtest.h>
@@ -44,11 +42,10 @@
 #include "yb/consensus/log_fwd.h"
 
 #include "yb/gutil/ref_counted.h"
-#include "yb/gutil/spinlock.h"
 
 #include "yb/util/locks.h"
+#include "yb/util/mem_tracker.h"
 #include "yb/util/monotime.h"
-#include "yb/util/numbered_deque.h"
 
 namespace yb {
 
@@ -73,13 +70,11 @@ class LogReader {
   // LogReader.
   //
   // 'index' may be nullptr, but if it is, ReadReplicatesInRange() may not be used.
-  static Status Open(Env *env,
-                             const scoped_refptr<LogIndex>& index,
-                             std::string log_prefix,
-                             const std::string& tablet_wal_path,
-                             const scoped_refptr<MetricEntity>& table_metric_entity,
-                             const scoped_refptr<MetricEntity>& tablet_metric_entity,
-                             std::unique_ptr<LogReader> *reader);
+  static Status Open(
+      Env* env, const scoped_refptr<LogIndex>& index, std::string log_prefix,
+      const std::string& tablet_wal_path, const scoped_refptr<MetricEntity>& table_metric_entity,
+      const scoped_refptr<MetricEntity>& tablet_metric_entity,
+      std::shared_ptr<MemTracker> read_wal_mem_tracker, std::unique_ptr<LogReader>* reader);
 
   // Returns the biggest prefix of segments, from the current sequence, guaranteed
   // not to include any replicate messages with indexes >= 'index'.
@@ -208,10 +203,11 @@ class LogReader {
   Result<std::shared_ptr<LWLogEntryBatchPB>> ReadBatchUsingIndexEntry(
       const LogIndexEntry& index_entry) const;
 
-  LogReader(Env* env, const scoped_refptr<LogIndex>& index,
-            std::string log_prefix,
-            const scoped_refptr<MetricEntity>& table_metric_entity,
-            const scoped_refptr<MetricEntity>& tablet_metric_entity);
+  LogReader(
+      Env* env, const scoped_refptr<LogIndex>& index, std::string log_prefix,
+      const scoped_refptr<MetricEntity>& table_metric_entity,
+      const scoped_refptr<MetricEntity>& tablet_metric_entity,
+      std::shared_ptr<MemTracker> read_wal_mem_tracker);
 
   // Reads the headers of all segments in 'path_'.
   Status Init(const std::string& path);
@@ -238,6 +234,8 @@ class LogReader {
   scoped_refptr<Counter> entries_read_;
   scoped_refptr<EventStats> read_batch_latency_;
 
+  std::shared_ptr<MemTracker> read_wal_mem_tracker_;
+
   // The sequence of all current log segments in increasing sequence number order.
   SegmentSequence segments_;
 
diff --git a/src/yb/consensus/log_util.cc b/src/yb/consensus/log_util.cc
index 7d7f47e5d8..cb4b8d9d87 100644
--- a/src/yb/consensus/log_util.cc
+++ b/src/yb/consensus/log_util.cc
@@ -34,7 +34,6 @@
 
 #include <algorithm>
 #include <array>
-#include <limits>
 #include <utility>
 
 #include "yb/ash/wait_state.h"
@@ -42,7 +41,6 @@
 #include "yb/common/hybrid_time.h"
 
 #include "yb/consensus/consensus.messages.h"
-#include "yb/consensus/opid_util.h"
 #include "yb/consensus/log.messages.h"
 #include "yb/consensus/log_index.h"
 
@@ -59,8 +57,8 @@
 #include "yb/util/debug-util.h"
 #include "yb/util/debug/trace_event.h"
 #include "yb/util/env_util.h"
-#include "yb/util/flags.h"
 #include "yb/util/logging.h"
+#include "yb/util/mem_tracker.h"
 #include "yb/util/pb_util.h"
 #include "yb/util/ref_cnt_buffer.h"
 #include "yb/util/result.h"
@@ -124,8 +122,7 @@ TAG_FLAG(save_index_into_wal_segments, advanced);
 
 DECLARE_bool(store_min_start_ht_running_txns);
 
-namespace yb {
-namespace log {
+namespace yb::log {
 
 using env_util::ReadFully;
 using std::vector;
@@ -172,13 +169,14 @@ LogOptions::LogOptions()
 }
 
 Result<scoped_refptr<ReadableLogSegment>> ReadableLogSegment::Open(
-    Env* env, const std::string& path) {
+    Env* env, const std::string& path, std::shared_ptr<MemTracker> read_wal_mem_tracker) {
   VLOG(1) << "Parsing wal segment: " << path;
   shared_ptr<RandomAccessFile> readable_file;
-  RETURN_NOT_OK_PREPEND(env_util::OpenFileForRandom(env, path, &readable_file),
-                        "Unable to open file for reading");
+  RETURN_NOT_OK_PREPEND(
+      env_util::OpenFileForRandom(env, path, &readable_file), "Unable to open file for reading");
 
-  auto segment = make_scoped_refptr<ReadableLogSegment>(path, readable_file);
+  auto segment =
+      make_scoped_refptr<ReadableLogSegment>(path, readable_file, std::move(read_wal_mem_tracker));
   if (!VERIFY_RESULT_PREPEND(segment->Init(), "Unable to initialize segment")) {
     return nullptr;
   }
@@ -186,13 +184,15 @@ Result<scoped_refptr<ReadableLogSegment>> ReadableLogSegment::Open(
 }
 
 ReadableLogSegment::ReadableLogSegment(
-    std::string path, shared_ptr<RandomAccessFile> readable_file)
+    std::string path, shared_ptr<RandomAccessFile> readable_file,
+    std::shared_ptr<MemTracker> read_wal_mem_tracker)
     : path_(std::move(path)),
       file_size_(0),
       readable_to_offset_(0),
       readable_file_(std::move(readable_file)),
       is_initialized_(false),
-      footer_was_rebuilt_(false) {
+      footer_was_rebuilt_(false),
+      read_wal_mem_tracker_(std::move(read_wal_mem_tracker)) {
   CHECK_OK(env_util::OpenFileForRandom(Env::Default(), path_, &readable_file_checkpoint_));
 }
 
@@ -945,11 +945,45 @@ Result<std::shared_ptr<LWLogEntryBatchPB>> ReadableLogSegment::ReadEntryBatch(
                    header.msg_length, *offset, path_, limit));
   }
 
+  // Use standard arena starting size for now; this seems too big in many cases though.
+  static constexpr uint32_t kStartBlockSize = ThreadSafeArena::kStartBlockSize;
+
+  // TODO(lw_uc) embed buffer and first arena block into holder itself.
+  struct DataHolder {
+    RefCntBuffer buffer;
+    ThreadSafeArena arena{/*initial_buffer_size=*/kStartBlockSize};
+    int64_t consumed = 0;
+    std::shared_ptr<MemTracker> read_wal_mem_tracker;
+
+    explicit DataHolder(
+        const RefCntBuffer& buffer_, std::shared_ptr<MemTracker> read_wal_mem_tracker_)
+        : buffer(buffer_), read_wal_mem_tracker(std::move(read_wal_mem_tracker_)) {}
+
+    ~DataHolder() {
+      if (read_wal_mem_tracker) {
+        read_wal_mem_tracker->Release(consumed);
+      }
+    }
+  };
+
+  // Estimate that arena after deserializing message will take about the same space as the message
+  // unless that would be below the arena minimum size.
+  int64_t estimated_memory_needed = header.msg_length;
+  if (estimated_memory_needed < kStartBlockSize) {
+    estimated_memory_needed = kStartBlockSize;
+  }
+  // Space for RefCntBuffer buffer.
+  estimated_memory_needed += header.msg_length;
+
+  if (read_wal_mem_tracker_) {
+    read_wal_mem_tracker_->Consume(estimated_memory_needed);
+  }
   RefCntBuffer buffer(header.msg_length);
-  Slice entry_batch_slice;
+  auto holder = std::make_shared<DataHolder>(buffer, read_wal_mem_tracker_);
+  holder->consumed = estimated_memory_needed;
 
+  Slice entry_batch_slice;
   Status s = readable_file()->Read(*offset, header.msg_length, &entry_batch_slice, buffer.data());
-
   if (!s.ok()) {
     return STATUS_FORMAT(
         IOError, "Could not read entry at offset: $0, length: $1. Cause: $2", *offset,
@@ -965,24 +999,22 @@ Result<std::shared_ptr<LWLogEntryBatchPB>> ReadableLogSegment::ReadEntryBatch(
                                          header.msg_crc, read_crc));
   }
 
-  // TODO(lw_uc) embed buffer and first arena block into holder itself.
-  struct DataHolder {
-    RefCntBuffer buffer;
-    ThreadSafeArena arena;
-
-    explicit DataHolder(const RefCntBuffer& buffer_) : buffer(buffer_) {}
-  };
-
-  auto holder = std::make_shared<DataHolder>(buffer);
   auto batch = holder->arena.NewArenaObject<LWLogEntryBatchPB>();
   s = batch->ParseFromSlice(entry_batch_slice.Prefix(header.msg_length));
-
   if (!s.ok()) {
     return STATUS_FORMAT(
         Corruption, "Failed to parse PB at offset: $0, length: $1. Cause: $2", *offset,
         header.msg_length, s);
   }
 
+  if (read_wal_mem_tracker_) {
+    int64_t actual_memory_used =
+        header.msg_length + static_cast<int64_t>(holder->arena.memory_footprint());
+    int64_t adjustment = actual_memory_used - holder->consumed;
+    read_wal_mem_tracker_->Consume(adjustment);  // This is a Release if adjustment is negative.
+    holder->consumed = actual_memory_used;
+  }
+
   *offset += entry_batch_slice.size();
   return SharedField(holder, batch);
 }
@@ -1325,5 +1357,4 @@ void UpdateSegmentFooterIndexes(
 }
 
 
-}  // namespace log
-}  // namespace yb
+} // namespace yb::log
diff --git a/src/yb/consensus/log_util.h b/src/yb/consensus/log_util.h
index 02cfdfbbf2..eaec3a225a 100644
--- a/src/yb/consensus/log_util.h
+++ b/src/yb/consensus/log_util.h
@@ -32,11 +32,8 @@
 
 #pragma once
 
-#include <iosfwd>
-#include <map>
 #include <memory>
 #include <string>
-#include <utility>
 #include <vector>
 
 #include <gtest/gtest_prod.h>
@@ -64,6 +61,9 @@ DECLARE_bool(require_durable_wal_write);
 DECLARE_string(fs_wal_dirs);
 
 namespace yb {
+
+class MemTracker;
+
 namespace log {
 
 // Suffix for temporary files
@@ -128,7 +128,7 @@ struct LogEntryMetadata {
 };
 
 // A sequence of segments, ordered by increasing sequence number.
-typedef std::vector<std::shared_ptr<LWLogEntryPB>> LogEntries;
+using LogEntries = std::vector<std::shared_ptr<LWLogEntryPB>>;
 
 struct ReadEntriesResult {
   // Read entries
@@ -167,11 +167,14 @@ YB_DEFINE_ENUM(EntriesToRead, (kAll)(kReplicate));
 class ReadableLogSegment : public RefCountedThreadSafe<ReadableLogSegment> {
  public:
   // Factory method to construct a ReadableLogSegment from a file on the FS.
-  static Result<scoped_refptr<ReadableLogSegment>> Open(Env* env, const std::string& path);
+  static Result<scoped_refptr<ReadableLogSegment>> Open(
+      Env* env, const std::string& path, std::shared_ptr<MemTracker> read_wal_mem_tracker);
 
   // Build a readable segment to read entries from the provided path.
-  ReadableLogSegment(std::string path,
-                     std::shared_ptr<RandomAccessFile> readable_file);
+  // read_wal_mem_tracker may be nullptr in tests.
+  ReadableLogSegment(
+      std::string path, std::shared_ptr<RandomAccessFile> readable_file,
+      std::shared_ptr<MemTracker> read_wal_mem_tracker);
 
   // Initialize the ReadableLogSegment.
   // This initializer provides methods for avoiding disk IO when creating a
@@ -320,7 +323,7 @@ class ReadableLogSegment : public RefCountedThreadSafe<ReadableLogSegment> {
     uint32_t header_crc;
   };
 
-  ~ReadableLogSegment() {}
+  ~ReadableLogSegment() = default;
 
   // Helper functions called by Init().
 
@@ -403,6 +406,9 @@ class ReadableLogSegment : public RefCountedThreadSafe<ReadableLogSegment> {
   // the offset of the first entry in the log.
   int64_t first_entry_offset_;
 
+  // May be nullptr in tests.
+  std::shared_ptr<MemTracker> read_wal_mem_tracker_;
+
   DISALLOW_COPY_AND_ASSIGN(ReadableLogSegment);
 };
 
diff --git a/src/yb/consensus/mt-log-test.cc b/src/yb/consensus/mt-log-test.cc
index 64fa549d56..6fbca02fe3 100644
--- a/src/yb/consensus/mt-log-test.cc
+++ b/src/yb/consensus/mt-log-test.cc
@@ -39,17 +39,14 @@
 #include "yb/consensus/log-test-base.h"
 #include "yb/consensus/log_index.h"
 
-#include "yb/gutil/algorithm.h"
 #include "yb/gutil/ref_counted.h"
 #include "yb/gutil/strings/substitute.h"
 
 #include "yb/util/locks.h"
-#include "yb/util/metrics.h"
 #include "yb/util/random.h"
 #include "yb/util/status_log.h"
 #include "yb/util/stopwatch.h"
 #include "yb/util/thread.h"
-#include "yb/util/flags.h"
 
 // TODO: Semantics of the Log and Appender thread interactions changed and now multi-threaded
 // writing is no longer allowed, or to be more precise, does no longer guarantee the ordering of
@@ -58,8 +55,7 @@ DEFINE_NON_RUNTIME_int32(num_writer_threads, 1, "Number of threads writing to th
 DEFINE_NON_RUNTIME_int32(num_batches_per_thread, 2000, "Number of batches per thread");
 DEFINE_NON_RUNTIME_int32(num_ops_per_batch_avg, 5, "Target average number of ops per batch");
 
-namespace yb {
-namespace log {
+namespace yb::log {
 
 using std::vector;
 using consensus::ReplicateMsgPtr;
@@ -176,9 +172,11 @@ TEST_F(MultiThreadedLogTest, TestAppends) {
   ASSERT_OK(log_->Close());
 
   std::unique_ptr<LogReader> reader;
-  ASSERT_OK(LogReader::Open(fs_manager_->env(), nullptr, "Log reader: ",
-                            fs_manager_->GetFirstTabletWalDirOrDie(kTestTable, kTestTablet),
-                            nullptr, nullptr, &reader));
+  ASSERT_OK(LogReader::Open(
+      fs_manager_->env(), /*index=*/nullptr,
+      "Log reader: ", fs_manager_->GetFirstTabletWalDirOrDie(kTestTable, kTestTablet),
+      /*table_metric_entity=*/nullptr, /*tablet_metric_entity=*/nullptr,
+      /*read_wal_mem_tracker=*/nullptr, &reader));
   SegmentSequence segments;
   ASSERT_OK(reader->GetSegmentsSnapshot(&segments));
 
@@ -197,5 +195,4 @@ TEST_F(MultiThreadedLogTest, TestAppends) {
   ASSERT_TRUE(std::is_sorted(ids.begin(), ids.end()));
 }
 
-} // namespace log
-} // namespace yb
+} // namespace yb::log
diff --git a/src/yb/consensus/raft_consensus-test.cc b/src/yb/consensus/raft_consensus-test.cc
index 4acd7d010d..001398098a 100644
--- a/src/yb/consensus/raft_consensus-test.cc
+++ b/src/yb/consensus/raft_consensus-test.cc
@@ -45,13 +45,11 @@
 #include "yb/fs/fs_manager.h"
 
 #include "yb/gutil/bind.h"
-#include "yb/gutil/stl_util.h"
 
 #include "yb/rpc/thread_pool.h"
 
 #include "yb/server/logical_clock.h"
 
-#include "yb/util/async_util.h"
 #include "yb/util/mem_tracker.h"
 #include "yb/util/metrics.h"
 #include "yb/util/status_log.h"
@@ -69,8 +67,7 @@ using std::shared_ptr;
 using std::string;
 using std::vector;
 
-namespace yb {
-namespace consensus {
+namespace yb::consensus {
 
 using log::Log;
 using log::LogOptions;
@@ -87,7 +84,7 @@ const char* kTestTablet = "TestTablet";
 const char* kLocalPeerUuid = "peer-0";
 
 // A simple map to collect the results of a sequence of transactions.
-typedef std::map<OpIdPB, Status, OpIdCompareFunctor> StatusesMap;
+using StatusesMap = std::map<OpIdPB, Status, OpIdCompareFunctor>;
 
 class MockQueue : public PeerMessageQueue {
  public:
@@ -96,7 +93,7 @@ class MockQueue : public PeerMessageQueue {
                      std::unique_ptr<rpc::Strand> observers_strand)
       : PeerMessageQueue(
           tablet_metric_entity, log, nullptr /* server_tracker */, nullptr /* parent_tracker */,
-          FakeRaftPeerPB(kLocalPeerUuid), kTestTablet, clock, nullptr /* consensus_queue */,
+          FakeRaftPeerPB(kLocalPeerUuid), kTestTablet, clock, /*context=*/nullptr,
           std::move(observers_strand)) {}
 
   MOCK_METHOD1(Init, void(const OpId& locally_replicated_index));
@@ -127,7 +124,10 @@ class MockQueue : public PeerMessageQueue {
 
 class MockPeerManager : public PeerManager {
  public:
-  MockPeerManager() : PeerManager("", "", nullptr, nullptr, nullptr, nullptr) {}
+  MockPeerManager()
+      : PeerManager(
+            "", "", /*peer_proxy_factory=*/nullptr, /*queue=*/nullptr, /*raft_pool_token=*/nullptr,
+            /*multi_raft_manager=*/nullptr) {}
   MOCK_METHOD1(UpdateRaftConfig, void(const consensus::RaftConfigPB& config));
   MOCK_METHOD1(SignalRequest, void(RequestTriggerMode trigger_mode));
   MOCK_METHOD0(Close, void());
@@ -135,7 +135,7 @@ class MockPeerManager : public PeerManager {
 
 class RaftConsensusSpy : public RaftConsensus {
  public:
-  typedef Callback<Status(const scoped_refptr<ConsensusRound>& round)> AppendCallback;
+  using AppendCallback = Callback<Status (const scoped_refptr<ConsensusRound> &)>;
 
   RaftConsensusSpy(const ConsensusOptions& options,
                    std::unique_ptr<ConsensusMetadata> cmeta,
@@ -241,9 +241,10 @@ class RaftConsensusTest : public YBTest {
                        fs_manager_->GetFirstTabletWalDirOrDie(kTestTable, kTestTablet),
                        fs_manager_->uuid(),
                        schema_,
-                       0, // schema_version
-                       nullptr, // table_metric_entity
-                       nullptr, // tablet_metric_entity
+                       /*schema_version=*/0,
+                       /*table_metric_entity=*/nullptr,
+                       /*tablet_metric_entity=*/nullptr,
+                       /*read_wal_mem_tracker=*/nullptr,
                        log_thread_pool_.get(),
                        log_thread_pool_.get(),
                        log_thread_pool_.get(),
@@ -920,5 +921,4 @@ TEST_F(RaftConsensusTest, TestLastLeaderReceivedNotMinimum) {
   ASSERT_EQ(OpId::FromPB(response.status().last_received_current_leader()),  replicating_op_id);
 }
 
-}  // namespace consensus
-}  // namespace yb
+} // namespace yb::consensus
diff --git a/src/yb/consensus/raft_consensus_quorum-test.cc b/src/yb/consensus/raft_consensus_quorum-test.cc
index 647dd62164..19626b4372 100644
--- a/src/yb/consensus/raft_consensus_quorum-test.cc
+++ b/src/yb/consensus/raft_consensus_quorum-test.cc
@@ -79,9 +79,7 @@ using std::unique_ptr;
 using std::vector;
 using std::string;
 
-namespace yb {
-
-namespace consensus {
+namespace yb::consensus {
 
 using log::Log;
 using log::LogOptions;
@@ -144,9 +142,10 @@ class RaftConsensusQuorumTest : public YBTest {
                               fs_manager->GetFirstTabletWalDirOrDie(kTestTable, kTestTablet),
                               fs_manager->uuid(),
                               schema_,
-                              0, // schema_version
-                              nullptr, // table_metric_entity
-                              nullptr, // tablet_metric_entity
+                              /*schema_version=*/0,
+                              /*table_metric_entity=*/nullptr,
+                              /*tablet_metric_entity=*/nullptr,
+                              /*read_wal_mem_tracker=*/nullptr,
                               log_thread_pool_.get(),
                               log_thread_pool_.get(),
                               log_thread_pool_.get(),
@@ -425,6 +424,7 @@ class RaftConsensusQuorumTest : public YBTest {
                                                                                 kTestTablet),
                                    table_metric_entity_.get(),
                                    tablet_metric_entity_.get(),
+                                   /*read_wal_mem_tracker=*/nullptr,
                                    &log_reader));
     log::LogEntries ret;
     log::SegmentSequence segments;
@@ -572,7 +572,7 @@ class RaftConsensusQuorumTest : public YBTest {
     YBTest::TearDown();
   }
 
-  ~RaftConsensusQuorumTest() {
+  ~RaftConsensusQuorumTest() override {
     peers_->Clear();
     operation_factories_.clear();
     // We need to clear the logs before deleting the fs_managers_ or we'll
@@ -1059,5 +1059,4 @@ TEST_F(RaftConsensusQuorumTest, TestRequestVote) {
   LOG(INFO) << "Follower rejected old heartbeat, as expected: " << res.ShortDebugString();
 }
 
-}  // namespace consensus
-}  // namespace yb
+} // namespace yb::consensus
diff --git a/src/yb/integration-tests/stateful_services/stateful_service-itest.cc b/src/yb/integration-tests/stateful_services/stateful_service-itest.cc
index 3f2f7610c5..49d133ad1d 100644
--- a/src/yb/integration-tests/stateful_services/stateful_service-itest.cc
+++ b/src/yb/integration-tests/stateful_services/stateful_service-itest.cc
@@ -11,23 +11,27 @@
 // under the License.
 //
 
-#include <chrono>
-
 #include "yb/client/stateful_services/test_echo_service_client.h"
 #include "yb/client/table_handle.h"
 #include "yb/client/yb_table_name.h"
+#include "yb/common/ql_value.h"
+
 #include "yb/integration-tests/cluster_itest_util.h"
 #include "yb/integration-tests/mini_cluster.h"
 #include "yb/integration-tests/yb_mini_cluster_test_base.h"
+
 #include "yb/master/master_cluster.proxy.h"
 #include "yb/master/master_defaults.h"
 #include "yb/master/mini_master.h"
+
 #include "yb/tablet/tablet.h"
 #include "yb/tablet/tablet_metadata.h"
+
 #include "yb/tserver/mini_tablet_server.h"
 #include "yb/tserver/service_util.h"
 #include "yb/tserver/stateful_services/stateful_service_base.h"
 #include "yb/tserver/tablet_server.h"
+
 #include "yb/util/backoff_waiter.h"
 #include "yb/util/monotime.h"
 #include "yb/util/sync_point.h"
@@ -65,7 +69,7 @@ class StatefulServiceTest : public MiniClusterTestWithClient<MiniCluster> {
     ASSERT_OK(CreateClient());
     ASSERT_OK(client_->WaitForCreateTableToFinish(service_table_name));
     std::vector<TabletId> tablet_ids;
-    ASSERT_OK(client_->GetTablets(service_table_name, 0 /* max_tablets */, &tablet_ids, NULL));
+    ASSERT_OK(client_->GetTablets(service_table_name, 0 /* max_tablets */, &tablet_ids, nullptr));
     ASSERT_EQ(tablet_ids.size(), 1);
     tablet_id_.swap(tablet_ids[0]);
     ASSERT_OK(cluster_->WaitForLoadBalancerToStabilize(kTimeout));
@@ -224,7 +228,6 @@ TEST_F(StatefulServiceTest, TestEchoService) {
   auto echo_resp = ASSERT_RESULT(service_client_->GetEcho(echo_req, kTimeout));
 
   ASSERT_EQ(echo_resp.message(), "Hello World! World! World!");
-  auto initial_node_id = echo_resp.node_id();
 
   // Make sure the tablet leader is the one serving the request.
   auto initial_leader = GetLeaderForTablet(cluster_.get(), tablet_id_);
@@ -301,10 +304,10 @@ TEST_F(StatefulServiceTest, TestLeadershipChange) {
   ASSERT_EQ(count_resp.count(), 0);
 
   yb::SyncPoint::GetInstance()->LoadDependency(
-      {{"StatefulRpcServiceBase::HandleRpcRequestWithTermCheck::AfterMethodImpl1",
-        "StatefulServiceTest::TestLeadershipChange::BeforeLeaderChange"},
-       {"StatefulServiceTest::TestLeadershipChange::AfterLeaderChange",
-        "StatefulRpcServiceBase::HandleRpcRequestWithTermCheck::AfterMethodImpl2"}});
+      {{.predecessor = "StatefulRpcServiceBase::HandleRpcRequestWithTermCheck::AfterMethodImpl1",
+        .successor = "StatefulServiceTest::TestLeadershipChange::BeforeLeaderChange"},
+       {.predecessor = "StatefulServiceTest::TestLeadershipChange::AfterLeaderChange",
+        .successor = "StatefulRpcServiceBase::HandleRpcRequestWithTermCheck::AfterMethodImpl2"}});
 
   uint64 attempts = 0;
   yb::SyncPoint::GetInstance()->SetCallBack(
@@ -350,10 +353,10 @@ TEST_F(StatefulServiceTest, TestWriteDuringLeadershipChange) {
   ANNOTATE_UNPROTECTED_WRITE(FLAGS_TEST_combine_batcher_errors) = true;
 
   yb::SyncPoint::GetInstance()->LoadDependency(
-      {{"TestEchoService::RecordRequestInTable::BeforeApply1",
-        "StatefulServiceTest::TestWriteDuringLeadershipChange::BeforeLeaderChange"},
-       {"StatefulServiceTest::TestWriteDuringLeadershipChange::AfterLeaderChange",
-        "TestEchoService::RecordRequestInTable::BeforeApply2"}});
+      {{.predecessor = "TestEchoService::RecordRequestInTable::BeforeApply1",
+        .successor = "StatefulServiceTest::TestWriteDuringLeadershipChange::BeforeLeaderChange"},
+       {.predecessor = "StatefulServiceTest::TestWriteDuringLeadershipChange::AfterLeaderChange",
+        .successor = "TestEchoService::RecordRequestInTable::BeforeApply2"}});
 
   uint32 count_ok = 0, count_term_err = 0, count_err = 0;
   yb::SyncPoint::GetInstance()->SetCallBack(
diff --git a/src/yb/master/sys_catalog.cc b/src/yb/master/sys_catalog.cc
index 1e8e4c1b8e..3a10cf633a 100644
--- a/src/yb/master/sys_catalog.cc
+++ b/src/yb/master/sys_catalog.cc
@@ -620,6 +620,7 @@ Status SysCatalogTable::OpenTablet(const scoped_refptr<tablet::RaftGroupMetadata
       .clock = scoped_refptr<server::Clock>(master_->clock()),
       .parent_mem_tracker = mem_manager_->tablets_overhead_mem_tracker(),
       .block_based_table_mem_tracker = mem_manager_->block_based_table_mem_tracker(),
+      .read_wal_mem_tracker = mem_manager_->read_wal_mem_tracker(),
       .metric_registry = metric_registry_,
       .log_anchor_registry = tablet_peer()->log_anchor_registry(),
       .tablet_options = tablet_options,
diff --git a/src/yb/tablet/tablet-test-harness.cc b/src/yb/tablet/tablet-test-harness.cc
index b7f44b42ce..0140a2cbe0 100644
--- a/src/yb/tablet/tablet-test-harness.cc
+++ b/src/yb/tablet/tablet-test-harness.cc
@@ -13,9 +13,11 @@
 
 #include "yb/tablet/tablet-test-harness.h"
 
+#include "yb/consensus/log_anchor_registry.h"
+
 #include "yb/dockv/partition.h"
 
-#include "yb/consensus/log_anchor_registry.h"
+#include "yb/qlexpr/index.h"
 
 #include "yb/server/logical_clock.h"
 
@@ -98,6 +100,7 @@ TabletInitData TabletTestHarness::MakeTabletInitData(const RaftGroupMetadataPtr&
       .clock = clock_,
       .parent_mem_tracker = std::shared_ptr<MemTracker>(),
       .block_based_table_mem_tracker = std::shared_ptr<MemTracker>(),
+      .read_wal_mem_tracker = std::shared_ptr<MemTracker>(),
       .metric_registry = metrics_registry_.get(),
       .log_anchor_registry = new log::LogAnchorRegistry(),
       .tablet_options = TabletOptions(),
diff --git a/src/yb/tablet/tablet_bootstrap-test.cc b/src/yb/tablet/tablet_bootstrap-test.cc
index 6fd3b2dc93..339318c7cb 100644
--- a/src/yb/tablet/tablet_bootstrap-test.cc
+++ b/src/yb/tablet/tablet_bootstrap-test.cc
@@ -32,9 +32,7 @@
 
 #include <vector>
 
-#include "yb/qlexpr/index.h"
-
-#include "yb/consensus/consensus-test-util.h"
+#include "yb/consensus/consensus.h"
 #include "yb/consensus/consensus_meta.h"
 #include "yb/consensus/log-test-base.h"
 #include "yb/consensus/log_util.h"
@@ -62,6 +60,8 @@ DECLARE_bool(skip_flushed_entries);
 DECLARE_bool(skip_flushed_entries_in_first_replayed_segment);
 DECLARE_int32(retryable_request_timeout_secs);
 
+using namespace std::literals;
+
 using std::shared_ptr;
 using std::string;
 using std::vector;
@@ -112,7 +112,7 @@ struct BootstrapReport {
 };
 
 struct BootstrapTestHooksImpl : public TabletBootstrapTestHooksIf {
-  virtual ~BootstrapTestHooksImpl() {}
+  ~BootstrapTestHooksImpl() override = default;
 
   void Clear() { *this = BootstrapTestHooksImpl(); }
 
@@ -226,6 +226,7 @@ class BootstrapTest : public LogTestBase {
       .clock = scoped_refptr<Clock>(LogicalClock::CreateStartingAt(HybridTime::kInitial)),
       .parent_mem_tracker = shared_ptr<MemTracker>(),
       .block_based_table_mem_tracker = shared_ptr<MemTracker>(),
+      .read_wal_mem_tracker = shared_ptr<MemTracker>(),
       .metric_registry = nullptr,
       .log_anchor_registry = log_anchor_registry,
       .tablet_options = tablet_options,
@@ -432,7 +433,8 @@ TEST_F(BootstrapTest, TestOperationOverwriting) {
 TEST_F(BootstrapTest, OverwriteTailWithFlushedIndex) {
   BuildLog();
 
-  test_hooks_->flushed_op_ids = DocDbOpIds{{3, 2}, {3, 2}, {}};
+  test_hooks_->flushed_op_ids =
+      DocDbOpIds{.regular = {3, 2}, .intents = {3, 2}, .vector_indexes = {}};
 
   const std::string kTestStr("this is a test insert");
   const auto get_test_tuple = [kTestStr](int i) {
@@ -1022,7 +1024,8 @@ TEST_F(BootstrapTest, ReplayOpsFromLastOpId) {
     SleepFor(10ms);
   }
 
-  test_hooks_->flushed_op_ids = DocDbOpIds{{1, 3}, {1, 3}, {}};
+  test_hooks_->flushed_op_ids =
+      DocDbOpIds{.regular = {1, 3}, .intents = {1, 3}, .vector_indexes = {}};
   test_hooks_->flushed_retryable_requests_id = OpId{1, 3};
   TabletPtr tablet;
   ConsensusBootstrapInfo boot_info;
@@ -1058,7 +1061,8 @@ TEST_F(BootstrapTest, ReplayOpsFromFirstOpForUnflushedTablet) {
     SleepFor(10ms);
   }
 
-  test_hooks_->flushed_op_ids = DocDbOpIds{OpId::Invalid(), OpId::Invalid(), {}};
+  test_hooks_->flushed_op_ids =
+      DocDbOpIds{.regular = OpId::Invalid(), .intents = OpId::Invalid(), .vector_indexes = {}};
   test_hooks_->flushed_retryable_requests_id = OpId{1, 3};
   TabletPtr tablet;
   ConsensusBootstrapInfo boot_info;
@@ -1093,7 +1097,8 @@ TEST_F(BootstrapTest, ReplayOpsFromFirstOpIfSegmentUnclosed) {
     AppendReplicateBatchToLog(1);
   }
 
-  test_hooks_->flushed_op_ids = DocDbOpIds{{1, 2}, {1, 2}, {}};
+  test_hooks_->flushed_op_ids =
+      DocDbOpIds{.regular = {1, 2}, .intents = {1, 2}, .vector_indexes = {}};
   test_hooks_->flushed_retryable_requests_id = OpId{1, 2};
   TabletPtr tablet;
   ConsensusBootstrapInfo boot_info;
diff --git a/src/yb/tablet/tablet_bootstrap.cc b/src/yb/tablet/tablet_bootstrap.cc
index 1b00e813a2..93b307651a 100644
--- a/src/yb/tablet/tablet_bootstrap.cc
+++ b/src/yb/tablet/tablet_bootstrap.cc
@@ -33,7 +33,6 @@
 #include "yb/tablet/tablet_bootstrap.h"
 
 #include <map>
-#include <set>
 
 #include <boost/preprocessor/cat.hpp>
 #include <boost/preprocessor/stringize.hpp>
@@ -63,16 +62,11 @@
 #include "yb/docdb/consensus_frontier.h"
 #include "yb/dockv/value_type.h"
 
-#include "yb/gutil/casts.h"
 #include "yb/gutil/ref_counted.h"
 #include "yb/gutil/strings/substitute.h"
-#include "yb/gutil/thread_annotations.h"
 
-#include "yb/master/sys_catalog_constants.h"
 #include "yb/rpc/rpc_fwd.h"
-#include "yb/rpc/lightweight_message.h"
 
-#include "yb/tablet/tablet_fwd.h"
 #include "yb/tablet/mvcc.h"
 #include "yb/tablet/operations/change_auto_flags_config_operation.h"
 #include "yb/tablet/operations/change_metadata_operation.h"
@@ -86,6 +80,7 @@
 #include "yb/tablet/snapshot_coordinator.h"
 #include "yb/tablet/tablet.h"
 #include "yb/tablet/tablet_bootstrap_state_manager.h"
+#include "yb/tablet/tablet_fwd.h"
 #include "yb/tablet/tablet_metadata.h"
 #include "yb/tablet/tablet_options.h"
 #include "yb/tablet/tablet_snapshots.h"
@@ -93,20 +88,17 @@
 #include "yb/tablet/transaction_coordinator.h"
 #include "yb/tablet/transaction_participant.h"
 
-#include "yb/tserver/backup.pb.h"
 #include "yb/tserver/ysql_advisory_lock_table.h"
 
 #include "yb/util/atomic.h"
 #include "yb/util/env_util.h"
 #include "yb/util/fault_injection.h"
-#include "yb/util/flags.h"
 #include "yb/util/format.h"
 #include "yb/util/logging.h"
-#include "yb/util/metric_entity.h"
 #include "yb/util/monotime.h"
 #include "yb/util/scope_exit.h"
-#include "yb/util/status_format.h"
 #include "yb/util/status.h"
+#include "yb/util/status_format.h"
 #include "yb/util/stopwatch.h"
 #include "yb/util/to_stream.h"
 
@@ -166,8 +158,7 @@ DEFINE_NON_RUNTIME_bool(skip_wal_replay_from_beginning_with_cdc, true,
 
 DECLARE_bool(enable_flush_retryable_requests);
 
-namespace yb {
-namespace tablet {
+namespace yb::tablet {
 
 using namespace std::literals; // NOLINT
 using namespace std::placeholders;
@@ -220,7 +211,7 @@ struct Entry {
   }
 };
 
-typedef std::map<int64_t, Entry> OpIndexToEntryMap;
+using OpIndexToEntryMap = std::map<int64_t, Entry>;
 
 // State kept during replay.
 struct ReplayState {
@@ -800,6 +791,7 @@ class TabletBootstrap {
             wal_path,
             tablet_->GetTableMetricsEntity().get(),
             tablet_->GetTabletMetricsEntity().get(),
+            data_.tablet_init_data.read_wal_mem_tracker,
             &log_reader_),
         "Could not open LogReader. Reason");
     return Status::OK();
@@ -873,6 +865,7 @@ class TabletBootstrap {
         metadata.primary_table_schema_version(),
         tablet_->GetTableMetricsEntity(),
         tablet_->GetTabletMetricsEntity(),
+        data_.tablet_init_data.read_wal_mem_tracker,
         append_pool_,
         allocation_pool_,
         log_sync_pool_,
@@ -2061,5 +2054,4 @@ Status BootstrapTabletImpl(
   return bootstrap_status;
 }
 
-} // namespace tablet
-} // namespace yb
+} // namespace yb::tablet
diff --git a/src/yb/tablet/tablet_options.h b/src/yb/tablet/tablet_options.h
index e69af449af..099c628f10 100644
--- a/src/yb/tablet/tablet_options.h
+++ b/src/yb/tablet/tablet_options.h
@@ -88,6 +88,7 @@ struct TabletInitData {
   scoped_refptr<server::Clock> clock;
   std::shared_ptr<MemTracker> parent_mem_tracker;
   std::shared_ptr<MemTracker> block_based_table_mem_tracker;
+  std::shared_ptr<MemTracker> read_wal_mem_tracker;
   MetricRegistry* metric_registry = nullptr;
   log::LogAnchorRegistryPtr log_anchor_registry;
   TabletOptions tablet_options;
diff --git a/src/yb/tablet/tablet_peer-test.cc b/src/yb/tablet/tablet_peer-test.cc
index 5a2c58826a..1ab5b4905d 100644
--- a/src/yb/tablet/tablet_peer-test.cc
+++ b/src/yb/tablet/tablet_peer-test.cc
@@ -66,7 +66,6 @@
 #include "yb/tserver/tserver.pb.h"
 
 #include "yb/util/backoff_waiter.h"
-#include "yb/util/logging.h"
 #include "yb/util/metrics.h"
 #include "yb/util/result.h"
 #include "yb/util/status_log.h"
@@ -201,13 +200,13 @@ class TabletPeerTest : public YBTabletTest {
       return HybridTime::kInitial;
     };
 
-    ASSERT_OK(Log::Open(LogOptions(), tablet()->tablet_id(), metadata->wal_dir(),
-                        metadata->fs_manager()->uuid(), *tablet()->schema(),
-                        metadata->primary_table_schema_version(), table_metric_entity_.get(),
-                        tablet_metric_entity_.get(), log_thread_pool_.get(), log_thread_pool_.get(),
-                        log_thread_pool_.get(), &log,
-                        pre_log_rollover_callback, new_segment_allocation_callback,
-                        log::CreateNewSegment::kTrue, min_start_ht_running_txns_callback));
+    ASSERT_OK(Log::Open(
+        LogOptions(), tablet()->tablet_id(), metadata->wal_dir(), metadata->fs_manager()->uuid(),
+        *tablet()->schema(), metadata->primary_table_schema_version(), table_metric_entity_.get(),
+        tablet_metric_entity_.get(),
+        /*read_wal_mem_tracker=*/nullptr, log_thread_pool_.get(), log_thread_pool_.get(),
+        log_thread_pool_.get(), &log, pre_log_rollover_callback, new_segment_allocation_callback,
+        log::CreateNewSegment::kTrue, min_start_ht_running_txns_callback));
 
     auto bootstrap_state_manager = std::make_shared<TabletBootstrapStateManager>(
         tablet()->tablet_id(), metadata->fs_manager(), metadata->wal_dir());
@@ -596,9 +595,9 @@ TEST_F(TabletPeerTest, TestMinStartTimeRunningTxnsOnLogSegmentRollover) {
 
   std::unique_ptr<log::LogReader> reader;
   ASSERT_OK(log::LogReader::Open(
-      metadata->fs_manager()->env(), /* log_index */ nullptr, "Log reader: ", metadata->wal_dir(),
-      /* table_metric_entity = */ nullptr,
-      /* tablet_metric_entity = */ nullptr, &reader));
+      metadata->fs_manager()->env(), /*index=*/nullptr, "Log reader: ", metadata->wal_dir(),
+      /*table_metric_entity=*/nullptr,
+      /*tablet_metric_entity=*/nullptr, /*read_wal_mem_tracker=*/nullptr, &reader));
 
   ASSERT_OK(reader->GetSegmentsSnapshot(&segments));
   VerifyNonDecreasingTxnStartTimeInClosedSegments(segments);
diff --git a/src/yb/tools/data-patcher.cc b/src/yb/tools/data-patcher.cc
index cb06d63291..ac30580c74 100644
--- a/src/yb/tools/data-patcher.cc
+++ b/src/yb/tools/data-patcher.cc
@@ -22,13 +22,12 @@
 #include "yb/consensus/log_util.h"
 
 #include "yb/docdb/consensus_frontier.h"
+#include "yb/docdb/docdb-internal.h"
 #include "yb/docdb/docdb_rocksdb_util.h"
 #include "yb/docdb/docdb_types.h"
-#include "yb/dockv/value_type.h"
 #include "yb/docdb/kv_debug.h"
-#include "yb/docdb/docdb-internal.h"
-#include "yb/dockv/schema_packing.h"
 #include "yb/dockv/value.h"
+#include "yb/dockv/value_type.h"
 
 #include "yb/fs/fs_manager.h"
 
@@ -38,7 +37,6 @@
 #include "yb/rocksdb/db/dbformat.h"
 #include "yb/rocksdb/db/filename.h"
 #include "yb/rocksdb/db/version_set.h"
-#include "yb/rocksdb/db/writebuffer.h"
 #include "yb/rocksdb/table/block_based_table_reader.h"
 #include "yb/rocksdb/table/internal_iterator.h"
 #include "yb/rocksdb/table/table_builder.h"
@@ -48,11 +46,10 @@
 
 #include "yb/util/bytes_formatter.h"
 #include "yb/util/date_time.h"
+#include "yb/util/enums.h"
 #include "yb/util/env.h"
 #include "yb/util/env_util.h"
-#include "yb/util/enums.h"
 #include "yb/util/logging.h"
-#include "yb/util/metrics.h"
 #include "yb/util/path_util.h"
 #include "yb/util/pb_util.h"
 #include "yb/util/random_util.h"
@@ -60,9 +57,9 @@
 #include "yb/util/scope_exit.h"
 #include "yb/util/status.h"
 #include "yb/util/status_format.h"
+#include "yb/util/string_util.h"
 #include "yb/util/threadpool.h"
 #include "yb/util/tostring.h"
-#include "yb/util/string_util.h"
 
 using namespace std::placeholders;
 namespace po = boost::program_options;
@@ -72,8 +69,7 @@ DECLARE_int32(rocksdb_base_background_compactions);
 DECLARE_int32(rocksdb_max_background_compactions);
 DECLARE_int32(priority_thread_pool_size);
 
-namespace yb {
-namespace tools {
+namespace yb::tools {
 
 const std::regex kTabletRegex(".*/tablet-[0-9a-f]{32}");
 const std::regex kTabletDbRegex(".*/tablet-[0-9a-f]{32}(?:\\.intents)?");
@@ -342,7 +338,6 @@ Status AddDeltaToSstFile(
 
   rocksdb::ReadOptions read_options;
   std::unique_ptr<rocksdb::InternalIterator> iterator(table_reader->NewIterator(read_options));
-  auto data_fname = rocksdb::TableBaseToDataFileName(fname);
 
   auto out_dir = DirName(fname) + kPatchedExtension;
   auto& env = *Env::Default();
@@ -370,7 +365,7 @@ Status AddDeltaToSstFile(
                   << ", rocksdb_value_type=" << static_cast<uint64_t>(rocksdb_value_type)
                   << "): " << docdb::DocDBKeyToDebugStr(user_key, storage_db_type) << " => "
                   << docdb::DocDBValueToDebugStr(
-                         key_type, user_key, v, nullptr /*schema_packing_provider*/);
+                         key_type, user_key, v, /*schema_packing_provider=*/nullptr);
       }
       builder->Add(k, v);
     };
@@ -520,7 +515,7 @@ Status AddDeltaToSstFile(
                       << "decoded value "
                       << DocDBValueToDebugStr(
                              docdb::KeyType::kReverseTxnKey, iterator->key(), iterator->value(),
-                             nullptr /*schema_packing_provider*/);
+                             /*schema_packing_provider=*/nullptr);
             return doc_ht_result.status();
           }
           delta_data.AddEarlyTime(doc_ht_result->hybrid_time());
@@ -601,8 +596,9 @@ Status ChangeTimeInWalDir(
   auto log_index = VERIFY_RESULT(log::LogIndex::NewLogIndex(dir));
   std::unique_ptr<log::LogReader> log_reader;
   RETURN_NOT_OK(log::LogReader::Open(
-      env, log_index, kLogPrefix, dir, /* table_metric_entity= */ nullptr,
-      /* tablet_metric_entity= */ nullptr, &log_reader));
+      env, log_index, kLogPrefix, dir, /*table_metric_entity=*/nullptr,
+      /*tablet_metric_entity=*/nullptr,
+      /*read_wal_mem_tracker=*/nullptr, &log_reader));
   log::SegmentSequence segments;
   RETURN_NOT_OK(log_reader->GetSegmentsSnapshot(&segments));
   auto patched_dir = dir + kPatchedExtension;
@@ -1109,8 +1105,7 @@ Status ApplyPatchExecute(const ApplyPatchArguments& args) {
 
 YB_TOOL_ARGUMENTS(DataPatcherAction, DATA_PATCHER_ACTIONS);
 
-} // namespace tools
-} // namespace yb
+} // namespace yb::tools
 
 int main(int argc, char** argv) {
   yb::HybridTime::TEST_SetPrettyToString(true);
diff --git a/src/yb/tools/fs_tool.cc b/src/yb/tools/fs_tool.cc
index f95cc8bcbf..bd1bf1652c 100644
--- a/src/yb/tools/fs_tool.cc
+++ b/src/yb/tools/fs_tool.cc
@@ -59,8 +59,7 @@
 #include "yb/util/env.h"
 #include "yb/util/status.h"
 
-namespace yb {
-namespace tools {
+namespace yb::tools {
 
 using log::ReadableLogSegment;
 using std::shared_ptr;
@@ -86,8 +85,7 @@ FsTool::FsTool(DetailLevel detail_level)
       detail_level_(detail_level) {
 }
 
-FsTool::~FsTool() {
-}
+FsTool::~FsTool() = default;
 
 Status FsTool::Init() {
   CHECK(!initialized_) << "Already initialized";
@@ -212,9 +210,9 @@ Status FsTool::ListSegmentsInDir(const string& segments_dir) {
   return Status::OK();
 }
 
-Status FsTool::PrintLogSegmentHeader(const string& path,
-                                     int indent) {
-  auto segment_result = ReadableLogSegment::Open(fs_manager_->env(), path);
+Status FsTool::PrintLogSegmentHeader(const string& path, int indent) {
+  auto segment_result =
+      ReadableLogSegment::Open(fs_manager_->env(), path, /*read_wal_mem_tracker=*/nullptr);
   if (!segment_result.ok()) {
     auto s = segment_result.status();
     if (s.IsUninitialized() || s.IsCorruption()) {
@@ -269,6 +267,7 @@ Status FsTool::DumpTabletData(const std::string& tablet_id) {
       .clock = scoped_refptr<server::Clock>(),
       .parent_mem_tracker = shared_ptr<MemTracker>(),
       .block_based_table_mem_tracker = shared_ptr<MemTracker>(),
+      .read_wal_mem_tracker = nullptr,
       .metric_registry = nullptr,
       .log_anchor_registry = reg.get(),
       .tablet_options = tablet_options,
@@ -303,5 +302,4 @@ Status FsTool::PrintUUID(int indent) {
   return Status::OK();
 }
 
-} // namespace tools
-} // namespace yb
+} // namespace yb::tools
diff --git a/src/yb/tools/sys-catalog-tool.cc b/src/yb/tools/sys-catalog-tool.cc
index 91a71894d7..01cbb6a5b8 100644
--- a/src/yb/tools/sys-catalog-tool.cc
+++ b/src/yb/tools/sys-catalog-tool.cc
@@ -202,6 +202,7 @@ Status MiniSysCatalogTable::OpenTablet(const scoped_refptr<tablet::RaftGroupMeta
       .clock = clock_,
       .parent_mem_tracker = nullptr,
       .block_based_table_mem_tracker = nullptr,
+      .read_wal_mem_tracker = nullptr,
       .metric_registry = metric_registry_.get(),
       .log_anchor_registry = nullptr,
       .tablet_options = tablet_options_,
@@ -249,7 +250,7 @@ Status MiniSysCatalogTable::OpenTablet(const scoped_refptr<tablet::RaftGroupMeta
 class StatusException : public std::exception {
  public:
   explicit StatusException(const Status& s) : status_(s), what_(s.ToString()) {}
-  virtual ~StatusException() throw() = default;
+  ~StatusException() throw() override = default;
   const char* what() const throw() override {
     return what_.c_str();
   }
@@ -410,7 +411,7 @@ class SysRowJsonWriter : public JsonWriter {
   // Stream 'out' and 'filters' must be alive during the object life-time.
   SysRowJsonWriter(std::stringstream* out, Mode mode, const ReadFilters& filters) :
       JsonWriter(out, mode), filters_(filters) {}
-  virtual ~SysRowJsonWriter() = default;
+  ~SysRowJsonWriter() override = default;
 
   Status WriteEntryPB(SysRowEntryType type, const Slice& id, const Slice& data);
 
@@ -566,8 +567,8 @@ class SysRowHandlerIf {
 
 class SysRowJsonReader : public JsonReader {
  public:
-  typedef std::function<unique_ptr<SysRowHandlerIf>(
-      const rapidjson::Value& value, master::SysRowEntry* entry)> CreateSysRowHandlerFn;
+  using CreateSysRowHandlerFn =
+      std::function<unique_ptr<SysRowHandlerIf>(const rapidjson::Value&, master::SysRowEntry*)>;
 
   explicit SysRowJsonReader(string text) : JsonReader(std::move(text)) {}
 
diff --git a/src/yb/tserver/remote_bootstrap_session-test.cc b/src/yb/tserver/remote_bootstrap_session-test.cc
index 03fb847997..5975afe16c 100644
--- a/src/yb/tserver/remote_bootstrap_session-test.cc
+++ b/src/yb/tserver/remote_bootstrap_session-test.cc
@@ -15,15 +15,11 @@
 
 #include <memory>
 
-#include "yb/common/wire_protocol.h"
-
 #include "yb/consensus/consensus_fwd.h"
 #include "yb/consensus/consensus.h"
 #include "yb/consensus/log.h"
 #include "yb/consensus/state_change_context.h"
 
-#include "yb/gutil/bind.h"
-
 #include "yb/tablet/tablet.h"
 #include "yb/tablet/tablet_metadata.h"
 #include "yb/tablet/tablet_peer.h"
@@ -37,8 +33,7 @@ using std::string;
 
 DECLARE_int32(retryable_request_timeout_secs);
 
-namespace yb {
-namespace tserver {
+namespace yb::tserver {
 
 void RemoteBootstrapSessionTest::SetUp() {
   ASSERT_OK(ThreadPoolBuilder("raft").Build(&raft_pool_));
@@ -82,9 +77,10 @@ void RemoteBootstrapSessionTest::SetUpTabletPeer() {
                                                              tablet_id),
                      fs_manager()->uuid(),
                      *tablet()->schema(),
-                     0,  // schema_version
-                     nullptr, // table_metric_entity
-                     nullptr, // tablet_metric_entity
+                     /*schema_version=*/0,
+                     /*table_metric_entity=*/nullptr,
+                     /*tablet_metric_entity=*/nullptr,
+                     /*read_wal_mem_tracker=*/nullptr,
                      log_thread_pool_.get(),
                      log_thread_pool_.get(),
                      log_thread_pool_.get(),
@@ -111,7 +107,7 @@ void RemoteBootstrapSessionTest::SetUpTabletPeer() {
           Unretained(this),
           tablet_id),
       &metric_registry_,
-      nullptr /* tablet_splitter */,
+      /*tablet_splitter=*/nullptr,
       std::shared_future<client::YBClient*>()));
 
   // TODO similar to code in tablet_peer-test, consider refactor.
@@ -206,9 +202,8 @@ void RemoteBootstrapSessionTest::PopulateTablet() {
 
 void RemoteBootstrapSessionTest::InitSession() {
   session_.reset(new RemoteBootstrapSession(
-      tablet_peer_, "TestSession", "FakeUUID", nullptr /* nsessions */));
+      tablet_peer_, "TestSession", "FakeUUID", /*nsessions=*/nullptr));
   ASSERT_OK(session_->InitBootstrapSession());
 }
 
-}  // namespace tserver
-}  // namespace yb
+} // namespace yb::tserver
diff --git a/src/yb/tserver/tablet_memory_manager.cc b/src/yb/tserver/tablet_memory_manager.cc
index f78eb11485..616dea785e 100644
--- a/src/yb/tserver/tablet_memory_manager.cc
+++ b/src/yb/tserver/tablet_memory_manager.cc
@@ -18,7 +18,6 @@
 #include "yb/consensus/raft_consensus.h"
 
 #include "yb/gutil/bits.h"
-#include "yb/gutil/casts.h"
 #include "yb/gutil/strings/human_readable.h"
 #include "yb/gutil/sysinfo.h"
 
@@ -197,6 +196,8 @@ TabletMemoryManager::TabletMemoryManager(
   // See #20667 for why removing this limit temporarily was necessary.
   tablets_overhead_mem_tracker_ = MemTracker::FindOrCreateTracker(
       /*no limit*/ -1, "Tablets_overhead", server_mem_tracker_);
+  read_wal_mem_tracker_ = MemTracker::FindOrCreateTracker(
+     /*no limit*/ -1, "Log Reader Memory", server_mem_tracker_);
 
   InitBlockCache(metrics, default_block_cache_size_percentage, options);
   InitLogCacheGC();
@@ -221,6 +222,10 @@ std::shared_ptr<MemTracker> TabletMemoryManager::block_based_table_mem_tracker()
   return block_based_table_mem_tracker_;
 }
 
+std::shared_ptr<MemTracker> TabletMemoryManager::read_wal_mem_tracker() {
+  return read_wal_mem_tracker_;
+}
+
 std::shared_ptr<MemTracker> TabletMemoryManager::tablets_overhead_mem_tracker() {
   return tablets_overhead_mem_tracker_;
 }
diff --git a/src/yb/tserver/tablet_memory_manager.h b/src/yb/tserver/tablet_memory_manager.h
index 6fe0b5409a..ab262e9a4b 100644
--- a/src/yb/tserver/tablet_memory_manager.h
+++ b/src/yb/tserver/tablet_memory_manager.h
@@ -20,8 +20,7 @@
 #include "yb/util/background_task.h"
 #include "yb/util/mem_tracker.h"
 
-namespace yb {
-namespace tserver {
+namespace yb::tserver {
 
 class TabletMemoryManagerListenerIf {
  public:
@@ -56,6 +55,8 @@ class TabletMemoryManager {
   // The MemTracker associated with the block cache.
   std::shared_ptr<MemTracker> block_based_table_mem_tracker();
 
+  std::shared_ptr<MemTracker> read_wal_mem_tracker();
+
   std::shared_ptr<MemTracker> tablets_overhead_mem_tracker();
 
   std::shared_ptr<MemTracker> FindOrCreateOverheadMemTrackerForTablet(const TabletId& id);
@@ -96,6 +97,7 @@ class TabletMemoryManager {
 
   std::shared_ptr<MemTracker> server_mem_tracker_;
   std::shared_ptr<MemTracker> block_based_table_mem_tracker_;
+  std::shared_ptr<MemTracker> read_wal_mem_tracker_;
   std::shared_ptr<MemTracker> tablets_overhead_mem_tracker_;
 
   std::shared_ptr<GarbageCollector> block_based_table_gc_;
@@ -112,5 +114,4 @@ int64 ComputeTabletOverheadLimit();
 int32_t GetDbBlockCacheNumShardBits();
 int64_t GetTargetBlockCacheSize(int32_t default_block_cache_size_percentage);
 
-}  // namespace tserver
-}  // namespace yb
+} // namespace yb::tserver
diff --git a/src/yb/tserver/ts_tablet_manager.cc b/src/yb/tserver/ts_tablet_manager.cc
index 24b17309c2..867f35bfd2 100644
--- a/src/yb/tserver/ts_tablet_manager.cc
+++ b/src/yb/tserver/ts_tablet_manager.cc
@@ -2073,6 +2073,7 @@ void TSTabletManager::OpenTablet(const RaftGroupMetadataPtr& meta,
         .clock = scoped_refptr<server::Clock>(server_->clock()),
         .parent_mem_tracker = mem_manager_->tablets_overhead_mem_tracker(),
         .block_based_table_mem_tracker = mem_manager_->block_based_table_mem_tracker(),
+        .read_wal_mem_tracker = mem_manager_->read_wal_mem_tracker(),
         .metric_registry = metric_registry_,
         .log_anchor_registry = tablet_peer->log_anchor_registry(),
         .tablet_options = tablet_options_,
