{"url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/25885","repository_url":"https://api.github.com/repos/yugabyte/yugabyte-db","labels_url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/25885/labels{/name}","comments_url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/25885/comments","events_url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/25885/events","html_url":"https://github.com/yugabyte/yugabyte-db/issues/25885","id":2831123073,"node_id":"I_kwDOBlCVUc6ov4KB","number":25885,"title":"[xCluster] Make automatic replication mode work with temporary objects","user":{"login":"mdbridge","id":15827795,"node_id":"MDQ6VXNlcjE1ODI3Nzk1","avatar_url":"https://avatars.githubusercontent.com/u/15827795?v=4","gravatar_id":"","url":"https://api.github.com/users/mdbridge","html_url":"https://github.com/mdbridge","followers_url":"https://api.github.com/users/mdbridge/followers","following_url":"https://api.github.com/users/mdbridge/following{/other_user}","gists_url":"https://api.github.com/users/mdbridge/gists{/gist_id}","starred_url":"https://api.github.com/users/mdbridge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdbridge/subscriptions","organizations_url":"https://api.github.com/users/mdbridge/orgs","repos_url":"https://api.github.com/users/mdbridge/repos","events_url":"https://api.github.com/users/mdbridge/events{/privacy}","received_events_url":"https://api.github.com/users/mdbridge/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":894667487,"node_id":"MDU6TGFiZWw4OTQ2Njc0ODc=","url":"https://api.github.com/repos/yugabyte/yugabyte-db/labels/kind/new-feature","name":"kind/new-feature","color":"c2e0c6","default":false,"description":"This is a request for a completely new feature"},{"id":1290759928,"node_id":"MDU6TGFiZWwxMjkwNzU5OTI4","url":"https://api.github.com/repos/yugabyte/yugabyte-db/labels/area/docdb","name":"area/docdb","color":"0c4fcc","default":false,"description":"YugabyteDB core features"},{"id":5270144347,"node_id":"LA_kwDOBlCVUc8AAAABOiAFWw","url":"https://api.github.com/repos/yugabyte/yugabyte-db/labels/priority/highest","name":"priority/highest","color":"ffdc5e","default":false,"description":"Highest priority issue"}],"state":"closed","locked":false,"assignee":{"login":"mdbridge","id":15827795,"node_id":"MDQ6VXNlcjE1ODI3Nzk1","avatar_url":"https://avatars.githubusercontent.com/u/15827795?v=4","gravatar_id":"","url":"https://api.github.com/users/mdbridge","html_url":"https://github.com/mdbridge","followers_url":"https://api.github.com/users/mdbridge/followers","following_url":"https://api.github.com/users/mdbridge/following{/other_user}","gists_url":"https://api.github.com/users/mdbridge/gists{/gist_id}","starred_url":"https://api.github.com/users/mdbridge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdbridge/subscriptions","organizations_url":"https://api.github.com/users/mdbridge/orgs","repos_url":"https://api.github.com/users/mdbridge/repos","events_url":"https://api.github.com/users/mdbridge/events{/privacy}","received_events_url":"https://api.github.com/users/mdbridge/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"mdbridge","id":15827795,"node_id":"MDQ6VXNlcjE1ODI3Nzk1","avatar_url":"https://avatars.githubusercontent.com/u/15827795?v=4","gravatar_id":"","url":"https://api.github.com/users/mdbridge","html_url":"https://github.com/mdbridge","followers_url":"https://api.github.com/users/mdbridge/followers","following_url":"https://api.github.com/users/mdbridge/following{/other_user}","gists_url":"https://api.github.com/users/mdbridge/gists{/gist_id}","starred_url":"https://api.github.com/users/mdbridge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdbridge/subscriptions","organizations_url":"https://api.github.com/users/mdbridge/orgs","repos_url":"https://api.github.com/users/mdbridge/repos","events_url":"https://api.github.com/users/mdbridge/events{/privacy}","received_events_url":"https://api.github.com/users/mdbridge/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":4,"created_at":"2025-02-04T19:32:26Z","updated_at":"2025-11-05T17:54:16Z","closed_at":"2025-11-05T17:54:16Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Jira Link: [DB-15192](https://yugabyte.atlassian.net/browse/DB-15192)\r\n### Description\n\nCurrently the code for automatic xCluster replication of objects does not correctly handle object temporary-ness.\n\nIn particular, it's supposed to do the following:\n  * do not replicate DDLs that manipulate temporary objects\n    * this includes creates, alters, and drops of temporary objects\n    * essentially any DDL that would be incorrect due to the absence of temporary objects present on the source but not on the target must not be replicated\n  * replicate DDLs manipulate non-temporary objects\n\nThese conflicts, so:\n  * block attempts to drop temporary and non-temporary objects in the same DDL\n  * in general, block DDLs that manipulate both temporary and non-temporary objects\n\nThe current code incorrectly blocks DROPs of temporary tables containing nameless parts (see below).  It also allows through creation of temporary nameless parts like triggers on tables.\n\n--------------------\n\nMy current understanding of Postgres object temporary-ness:\n\n\nSome independent top level relations can be marked temporary using a keyword\n\n  * CREATE TEMP TABLE\n  * CREATE TEMP SEQUENCE\n  * CREATE TEMP VIEW\n\nsometimes these become temporary anyways:\n\n  * SERIAL columns in temporary tables produce temporary sequences\n  * creating views on temporary tables produce temporary views\n    * I haven't tried all the cases here but this is true for at least one case\n\nindexes are temporary if and only if the table they are on is temporary\n\n\nAll of these will be in a temporary schema named pg_temp*; only\ntemporary objects can be in such schemas.\n\nYou can make a temporary table use a permanent object like a sequence\nbut you cannot make it depend on that object.  That is, the default\nvalue for a column can take values from a permanent sequence but you\ncannot make the table own that sequence so that the sequence would be\ndropped if the table was dropped.\n\nIn general, I suspect you cannot have an object in one schema own an\nobject in a different schema; this would have the effect of preventing\ndependencies of temporary relations on permanent ones.\n\n\nThe above is the story for relations; tables also contain \"nameless\nparts\" that do not have names or belong to schemas.  Nameless parts I\nknow of:\n  * default column values\n  * rules\n  * triggers on tables\n  * security policies on tables\n\nSimilarly there are named parts like table columns, constraints, and\nassociated types (each table has an associated row type and array\ntype); these also belong to the same schema as the relation they are\nattached to.\n\nThese parts are tightly coupled to the relation they belong to and are\ndropped when the relation is dropped.  They are thus effectively\ntemporary if and only if the original relation is temporary.\n\nNote that in many cases you can independently drop parts; for example\nyou can drop a default value or constraint.\n\n\nThe DDL drop/end triggers treat nameless parts differently from the\nother objects, requiring different methods to determine if they are\ntemporary.\n\n\n### Issue Type\n\nkind/new-feature\n\n### Warning: Please confirm that this issue does not contain any sensitive information\n\n- [x] I confirm this issue does not contain any sensitive information.\n\n[DB-15192]: https://yugabyte.atlassian.net/browse/DB-15192?atlOrigin=eyJpIjoiNWRkNTljNzYxNjVmNDY3MDlhMDU5Y2ZhYzA5YTRkZjUiLCJwIjoiZ2l0aHViLWNvbS1KU1cifQ","closed_by":{"login":"yugabyte-ci","id":17281578,"node_id":"MDQ6VXNlcjE3MjgxNTc4","avatar_url":"https://avatars.githubusercontent.com/u/17281578?v=4","gravatar_id":"","url":"https://api.github.com/users/yugabyte-ci","html_url":"https://github.com/yugabyte-ci","followers_url":"https://api.github.com/users/yugabyte-ci/followers","following_url":"https://api.github.com/users/yugabyte-ci/following{/other_user}","gists_url":"https://api.github.com/users/yugabyte-ci/gists{/gist_id}","starred_url":"https://api.github.com/users/yugabyte-ci/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yugabyte-ci/subscriptions","organizations_url":"https://api.github.com/users/yugabyte-ci/orgs","repos_url":"https://api.github.com/users/yugabyte-ci/repos","events_url":"https://api.github.com/users/yugabyte-ci/events{/privacy}","received_events_url":"https://api.github.com/users/yugabyte-ci/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/25885/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/25885/timeline","performed_via_github_app":null,"state_reason":"completed"}