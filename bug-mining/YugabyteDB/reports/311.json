{"url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/28317","repository_url":"https://api.github.com/repos/yugabyte/yugabyte-db","labels_url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/28317/labels{/name}","comments_url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/28317/comments","events_url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/28317/events","html_url":"https://github.com/yugabyte/yugabyte-db/issues/28317","id":3335133752,"node_id":"I_kwDOBlCVUc7Gyho4","number":28317,"title":"[DocDB] Transactions always started as region-local with table-level locking","user":{"login":"es1024","id":6742815,"node_id":"MDQ6VXNlcjY3NDI4MTU=","avatar_url":"https://avatars.githubusercontent.com/u/6742815?v=4","gravatar_id":"","url":"https://api.github.com/users/es1024","html_url":"https://github.com/es1024","followers_url":"https://api.github.com/users/es1024/followers","following_url":"https://api.github.com/users/es1024/following{/other_user}","gists_url":"https://api.github.com/users/es1024/gists{/gist_id}","starred_url":"https://api.github.com/users/es1024/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/es1024/subscriptions","organizations_url":"https://api.github.com/users/es1024/orgs","repos_url":"https://api.github.com/users/es1024/repos","events_url":"https://api.github.com/users/es1024/events{/privacy}","received_events_url":"https://api.github.com/users/es1024/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":711841622,"node_id":"MDU6TGFiZWw3MTE4NDE2MjI=","url":"https://api.github.com/repos/yugabyte/yugabyte-db/labels/kind/bug","name":"kind/bug","color":"c2e0c6","default":false,"description":"This issue is a bug"},{"id":1290759928,"node_id":"MDU6TGFiZWwxMjkwNzU5OTI4","url":"https://api.github.com/repos/yugabyte/yugabyte-db/labels/area/docdb","name":"area/docdb","color":"0c4fcc","default":false,"description":"YugabyteDB core features"},{"id":1419821900,"node_id":"MDU6TGFiZWwxNDE5ODIxOTAw","url":"https://api.github.com/repos/yugabyte/yugabyte-db/labels/priority/medium","name":"priority/medium","color":"ffdc5e","default":false,"description":"Medium priority issue"},{"id":8290156317,"node_id":"LA_kwDOBlCVUc8AAAAB7iG_HQ","url":"https://api.github.com/repos/yugabyte/yugabyte-db/labels/2025.2_blocker","name":"2025.2_blocker","color":"ededed","default":false,"description":null},{"id":9380979947,"node_id":"LA_kwDOBlCVUc8AAAACLyZk6w","url":"https://api.github.com/repos/yugabyte/yugabyte-db/labels/2025.2%20Backport%20Required","name":"2025.2 Backport Required","color":"aaaaaa","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"es1024","id":6742815,"node_id":"MDQ6VXNlcjY3NDI4MTU=","avatar_url":"https://avatars.githubusercontent.com/u/6742815?v=4","gravatar_id":"","url":"https://api.github.com/users/es1024","html_url":"https://github.com/es1024","followers_url":"https://api.github.com/users/es1024/followers","following_url":"https://api.github.com/users/es1024/following{/other_user}","gists_url":"https://api.github.com/users/es1024/gists{/gist_id}","starred_url":"https://api.github.com/users/es1024/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/es1024/subscriptions","organizations_url":"https://api.github.com/users/es1024/orgs","repos_url":"https://api.github.com/users/es1024/repos","events_url":"https://api.github.com/users/es1024/events{/privacy}","received_events_url":"https://api.github.com/users/es1024/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"es1024","id":6742815,"node_id":"MDQ6VXNlcjY3NDI4MTU=","avatar_url":"https://avatars.githubusercontent.com/u/6742815?v=4","gravatar_id":"","url":"https://api.github.com/users/es1024","html_url":"https://github.com/es1024","followers_url":"https://api.github.com/users/es1024/followers","following_url":"https://api.github.com/users/es1024/following{/other_user}","gists_url":"https://api.github.com/users/es1024/gists{/gist_id}","starred_url":"https://api.github.com/users/es1024/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/es1024/subscriptions","organizations_url":"https://api.github.com/users/es1024/orgs","repos_url":"https://api.github.com/users/es1024/repos","events_url":"https://api.github.com/users/es1024/events{/privacy}","received_events_url":"https://api.github.com/users/es1024/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":0,"created_at":"2025-08-19T17:28:09Z","updated_at":"2025-10-22T21:36:16Z","closed_at":"2025-10-22T21:36:16Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Jira Link: [DB-17999](https://yugabyte.atlassian.net/browse/DB-17999)\n### Description\n\nGiven the following transaction:\n```sql\nBEGIN;\nINSERT INTO global_table ...;\nCOMMIT;\n```\nWithout table-level locking, the first RPC of this transaction is the Perform, which sets force_global_transaction in PgPerformOptionsPB based on the force_global_transaction GUC and whether the table accessed (global_table in this case) is in the local region (in this case, no). So the above transaction will start the transaction as global and pick a transaction from the global transaction pool.\n\nBut with table-level locking, the first RPC is to acquire an object lock, and this RPC does not set force_global_transaction, so the transaction is always started as region-local, and then later promoted to global during the Perform RPC.\n\nIn the first case, we mask the latency of the CREATED heartbeat by use of the transaction pool, but in the second case, we cannot mask the latency of the PROMOTED heartbeat, so this results in an extra global roundtrip for global transactions.\n\nIn the context of #11268, since there is no good default tablespace-local locality, it also means that every transaction will be started global.\n\n### Issue Type\n\nkind/bug\n\n### Warning: Please confirm that this issue does not contain any sensitive information\n\n- [x] I confirm this issue does not contain any sensitive information.\n\n[DB-17999]: https://yugabyte.atlassian.net/browse/DB-17999?atlOrigin=eyJpIjoiNWRkNTljNzYxNjVmNDY3MDlhMDU5Y2ZhYzA5YTRkZjUiLCJwIjoiZ2l0aHViLWNvbS1KU1cifQ","closed_by":{"login":"es1024","id":6742815,"node_id":"MDQ6VXNlcjY3NDI4MTU=","avatar_url":"https://avatars.githubusercontent.com/u/6742815?v=4","gravatar_id":"","url":"https://api.github.com/users/es1024","html_url":"https://github.com/es1024","followers_url":"https://api.github.com/users/es1024/followers","following_url":"https://api.github.com/users/es1024/following{/other_user}","gists_url":"https://api.github.com/users/es1024/gists{/gist_id}","starred_url":"https://api.github.com/users/es1024/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/es1024/subscriptions","organizations_url":"https://api.github.com/users/es1024/orgs","repos_url":"https://api.github.com/users/es1024/repos","events_url":"https://api.github.com/users/es1024/events{/privacy}","received_events_url":"https://api.github.com/users/es1024/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/28317/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/28317/timeline","performed_via_github_app":null,"state_reason":"completed"}