{"url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/19340","repository_url":"https://api.github.com/repos/yugabyte/yugabyte-db","labels_url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/19340/labels{/name}","comments_url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/19340/comments","events_url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/19340/events","html_url":"https://github.com/yugabyte/yugabyte-db/issues/19340","id":1917883878,"node_id":"I_kwDOBlCVUc5yUJXm","number":19340,"title":"[DocDB] TEST_docdb_log_write_batches flag doesn't work for RocksDB writes done without using DirectWriter","user":{"login":"mdbridge","id":15827795,"node_id":"MDQ6VXNlcjE1ODI3Nzk1","avatar_url":"https://avatars.githubusercontent.com/u/15827795?v=4","gravatar_id":"","url":"https://api.github.com/users/mdbridge","html_url":"https://github.com/mdbridge","followers_url":"https://api.github.com/users/mdbridge/followers","following_url":"https://api.github.com/users/mdbridge/following{/other_user}","gists_url":"https://api.github.com/users/mdbridge/gists{/gist_id}","starred_url":"https://api.github.com/users/mdbridge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdbridge/subscriptions","organizations_url":"https://api.github.com/users/mdbridge/orgs","repos_url":"https://api.github.com/users/mdbridge/repos","events_url":"https://api.github.com/users/mdbridge/events{/privacy}","received_events_url":"https://api.github.com/users/mdbridge/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":711841624,"node_id":"MDU6TGFiZWw3MTE4NDE2MjQ=","url":"https://api.github.com/repos/yugabyte/yugabyte-db/labels/kind/enhancement","name":"kind/enhancement","color":"c2e0c6","default":false,"description":"This is an enhancement of an existing feature"},{"id":1290759928,"node_id":"MDU6TGFiZWwxMjkwNzU5OTI4","url":"https://api.github.com/repos/yugabyte/yugabyte-db/labels/area/docdb","name":"area/docdb","color":"0c4fcc","default":false,"description":"YugabyteDB core features"},{"id":1419821900,"node_id":"MDU6TGFiZWwxNDE5ODIxOTAw","url":"https://api.github.com/repos/yugabyte/yugabyte-db/labels/priority/medium","name":"priority/medium","color":"ffdc5e","default":false,"description":"Medium priority issue"}],"state":"closed","locked":false,"assignee":{"login":"mdbridge","id":15827795,"node_id":"MDQ6VXNlcjE1ODI3Nzk1","avatar_url":"https://avatars.githubusercontent.com/u/15827795?v=4","gravatar_id":"","url":"https://api.github.com/users/mdbridge","html_url":"https://github.com/mdbridge","followers_url":"https://api.github.com/users/mdbridge/followers","following_url":"https://api.github.com/users/mdbridge/following{/other_user}","gists_url":"https://api.github.com/users/mdbridge/gists{/gist_id}","starred_url":"https://api.github.com/users/mdbridge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdbridge/subscriptions","organizations_url":"https://api.github.com/users/mdbridge/orgs","repos_url":"https://api.github.com/users/mdbridge/repos","events_url":"https://api.github.com/users/mdbridge/events{/privacy}","received_events_url":"https://api.github.com/users/mdbridge/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"mdbridge","id":15827795,"node_id":"MDQ6VXNlcjE1ODI3Nzk1","avatar_url":"https://avatars.githubusercontent.com/u/15827795?v=4","gravatar_id":"","url":"https://api.github.com/users/mdbridge","html_url":"https://github.com/mdbridge","followers_url":"https://api.github.com/users/mdbridge/followers","following_url":"https://api.github.com/users/mdbridge/following{/other_user}","gists_url":"https://api.github.com/users/mdbridge/gists{/gist_id}","starred_url":"https://api.github.com/users/mdbridge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdbridge/subscriptions","organizations_url":"https://api.github.com/users/mdbridge/orgs","repos_url":"https://api.github.com/users/mdbridge/repos","events_url":"https://api.github.com/users/mdbridge/events{/privacy}","received_events_url":"https://api.github.com/users/mdbridge/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":1,"created_at":"2023-09-28T16:30:23Z","updated_at":"2024-11-08T17:14:34Z","closed_at":"2024-11-08T17:14:34Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Jira Link: [DB-8142](https://yugabyte.atlassian.net/browse/DB-8142)\r\n### Description\n\nCurrently when you use `--TEST_docdb_log_write_batches=true` it fails to log any RocksDB writes not written using a DirectWriter.  Most of the writes done on the consumer side for xCluster replication fall into this category.\r\n\r\nYou can test this using:\r\n```\r\nyb_build.sh --cxx-test xcluster_ysql-test --gtest_filter '*TransactionWithSavepoints2' --test-args '--gtest_also_run_disabled_tests --ysql_enable_packed_row=false'  \r\n```\r\n\r\nSample fixed output looks like:\r\n\r\n     [C-ts-2] I0421 12:38:50.585454  6751 tablet.cc:1501] T 3a4a0c4022fa41d0ac92468886ad3845 P 220b8290cf754960ab61df9ca91de3df: Wrote 2 key/value pairs to kRegular RocksDB:  \r\n       T 3a4a0c4022fa41d0ac92468886ad3845 P 220b8290cf754960ab61df9ca91de3df [R]: Frontiers: { smallest: { op_id: 1.2 hybrid_time: { physical: 1682105930577352 } history_cutoff: <invalid> hybrid_time_filter: <invalid> max_value_level_ttl_expiration_time: <invalid> primary_schema_version: <NULL> cotable_schema_versions: [] } largest: { op_id: 1.2 hybrid_time: { physical: 1682105930577352 } history_cutoff: <invalid> hybrid_time_filter: <invalid> max_value_level_ttl_expiration_time: <initial> primary_schema_version: <NULL> cotable_schema_versions: [] } }  \r\n       T 3a4a0c4022fa41d0ac92468886ad3845 P 220b8290cf754960ab61df9ca91de3df [R]: 1. PutCF: SubDocKey(DocKey(0x56f1, [1777777], []), [SystemColumnId(0); HT{ physical: 1682105930530597 }]) => null  \r\n       T 3a4a0c4022fa41d0ac92468886ad3845 P 220b8290cf754960ab61df9ca91de3df [R]: 2. PutCF: SubDocKey(DocKey(0x58db, [4777777], []), [SystemColumnId(0); HT{ physical: 1682105930530597 w: 1 }]) => null  \r\n\r\nand  \r\n       \r\n     [C-ts-3] I0421 12:41:21.727046 11028 tablet.cc:1501] T 0d8bede434074cb984963bc1a38638bd P 71d085f6ef324ed0b3b455fb3e16eb57: Wrote 2 key/value pairs to kIntents RocksDB:  \r\n       T 0d8bede434074cb984963bc1a38638bd P 71d085f6ef324ed0b3b455fb3e16eb57 [I]: Frontiers: { smallest: { op_id: 1.2 hybrid_time: { physical: 1682106081724482 } history_cutoff: <invalid> hybrid_time_filter: <invalid> max_value_level_ttl_expiration_time: <invalid> primary_schema_version: <NULL> cotable_schema_versions: [] } largest: { op_id: 1.2 hybrid_time: { physical: 1682106081724482 } history_cutoff: <invalid> hybrid_time_filter: <invalid> max_value_level_ttl_expiration_time: <initial> primary_schema_version: <NULL> cotable_schema_versions: [] } }  \r\n       T 0d8bede434074cb984963bc1a38638bd P 71d085f6ef324ed0b3b455fb3e16eb57 [I]: 1. PutCF: TXN EXT 4dc245c7-55c2-409e-981d-b486311b6fe1 HT{ physical: 1682106081676896 } => IT 4d8d210a32394502911e5e7ecc5a8877 [SubDocKey(DocKey(0x56f1, [1777777], []), [SystemColumnId(0)]) -> null]  \r\n       T 0d8bede434074cb984963bc1a38638bd P 71d085f6ef324ed0b3b455fb3e16eb57 [I]: 2. PutCF: TXN EXT 4dc245c7-55c2-409e-981d-b486311b6fe1 HT{ physical: 1682106081676896 w: 1 } => IT 4d8d210a32394502911e5e7ecc5a8877 [SubDocKey(DocKey(0x58db, [4777777], []), [SystemColumnId(0)]) -> null]  \r\n\r\nWithout a fix, those messages just say Wrote 0 key/value pairs and provided no other information.\r\n\n\n### Warning: Please confirm that this issue does not contain any sensitive information\n\n- [X] I confirm this issue does not contain any sensitive information.\n\n[DB-8142]: https://yugabyte.atlassian.net/browse/DB-8142?atlOrigin=eyJpIjoiNWRkNTljNzYxNjVmNDY3MDlhMDU5Y2ZhYzA5YTRkZjUiLCJwIjoiZ2l0aHViLWNvbS1KU1cifQ","closed_by":{"login":"mdbridge","id":15827795,"node_id":"MDQ6VXNlcjE1ODI3Nzk1","avatar_url":"https://avatars.githubusercontent.com/u/15827795?v=4","gravatar_id":"","url":"https://api.github.com/users/mdbridge","html_url":"https://github.com/mdbridge","followers_url":"https://api.github.com/users/mdbridge/followers","following_url":"https://api.github.com/users/mdbridge/following{/other_user}","gists_url":"https://api.github.com/users/mdbridge/gists{/gist_id}","starred_url":"https://api.github.com/users/mdbridge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdbridge/subscriptions","organizations_url":"https://api.github.com/users/mdbridge/orgs","repos_url":"https://api.github.com/users/mdbridge/repos","events_url":"https://api.github.com/users/mdbridge/events{/privacy}","received_events_url":"https://api.github.com/users/mdbridge/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/19340/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/19340/timeline","performed_via_github_app":null,"state_reason":"completed"}