{"url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/25787","repository_url":"https://api.github.com/repos/yugabyte/yugabyte-db","labels_url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/25787/labels{/name}","comments_url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/25787/comments","events_url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/25787/events","html_url":"https://github.com/yugabyte/yugabyte-db/issues/25787","id":2816655185,"node_id":"I_kwDOBlCVUc6n4r9R","number":25787,"title":"[DocDB] Column id is still incremented on ADD COLUMN rollback - breaks ddl replication","user":{"login":"Arjun-yb","id":86099578,"node_id":"MDQ6VXNlcjg2MDk5NTc4","avatar_url":"https://avatars.githubusercontent.com/u/86099578?v=4","gravatar_id":"","url":"https://api.github.com/users/Arjun-yb","html_url":"https://github.com/Arjun-yb","followers_url":"https://api.github.com/users/Arjun-yb/followers","following_url":"https://api.github.com/users/Arjun-yb/following{/other_user}","gists_url":"https://api.github.com/users/Arjun-yb/gists{/gist_id}","starred_url":"https://api.github.com/users/Arjun-yb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Arjun-yb/subscriptions","organizations_url":"https://api.github.com/users/Arjun-yb/orgs","repos_url":"https://api.github.com/users/Arjun-yb/repos","events_url":"https://api.github.com/users/Arjun-yb/events{/privacy}","received_events_url":"https://api.github.com/users/Arjun-yb/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":711841622,"node_id":"MDU6TGFiZWw3MTE4NDE2MjI=","url":"https://api.github.com/repos/yugabyte/yugabyte-db/labels/kind/bug","name":"kind/bug","color":"c2e0c6","default":false,"description":"This issue is a bug"},{"id":1290759928,"node_id":"MDU6TGFiZWwxMjkwNzU5OTI4","url":"https://api.github.com/repos/yugabyte/yugabyte-db/labels/area/docdb","name":"area/docdb","color":"0c4fcc","default":false,"description":"YugabyteDB core features"},{"id":1353907004,"node_id":"MDU6TGFiZWwxMzUzOTA3MDA0","url":"https://api.github.com/repos/yugabyte/yugabyte-db/labels/priority/high","name":"priority/high","color":"ffdc5e","default":false,"description":"High Priority"},{"id":3788247489,"node_id":"LA_kwDOBlCVUc7hzBHB","url":"https://api.github.com/repos/yugabyte/yugabyte-db/labels/xCluster","name":"xCluster","color":"F2BE93","default":false,"description":"Label for xCluster related issues/improvements"},{"id":7657007763,"node_id":"LA_kwDOBlCVUc8AAAAByGSqkw","url":"https://api.github.com/repos/yugabyte/yugabyte-db/labels/2025.1.0_blocker","name":"2025.1.0_blocker","color":"ededed","default":false,"description":null},{"id":8068531554,"node_id":"LA_kwDOBlCVUc8AAAAB4OwFYg","url":"https://api.github.com/repos/yugabyte/yugabyte-db/labels/ddl_replication","name":"ddl_replication","color":"aaaaaa","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"mdbridge","id":15827795,"node_id":"MDQ6VXNlcjE1ODI3Nzk1","avatar_url":"https://avatars.githubusercontent.com/u/15827795?v=4","gravatar_id":"","url":"https://api.github.com/users/mdbridge","html_url":"https://github.com/mdbridge","followers_url":"https://api.github.com/users/mdbridge/followers","following_url":"https://api.github.com/users/mdbridge/following{/other_user}","gists_url":"https://api.github.com/users/mdbridge/gists{/gist_id}","starred_url":"https://api.github.com/users/mdbridge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdbridge/subscriptions","organizations_url":"https://api.github.com/users/mdbridge/orgs","repos_url":"https://api.github.com/users/mdbridge/repos","events_url":"https://api.github.com/users/mdbridge/events{/privacy}","received_events_url":"https://api.github.com/users/mdbridge/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"mdbridge","id":15827795,"node_id":"MDQ6VXNlcjE1ODI3Nzk1","avatar_url":"https://avatars.githubusercontent.com/u/15827795?v=4","gravatar_id":"","url":"https://api.github.com/users/mdbridge","html_url":"https://github.com/mdbridge","followers_url":"https://api.github.com/users/mdbridge/followers","following_url":"https://api.github.com/users/mdbridge/following{/other_user}","gists_url":"https://api.github.com/users/mdbridge/gists{/gist_id}","starred_url":"https://api.github.com/users/mdbridge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdbridge/subscriptions","organizations_url":"https://api.github.com/users/mdbridge/orgs","repos_url":"https://api.github.com/users/mdbridge/repos","events_url":"https://api.github.com/users/mdbridge/events{/privacy}","received_events_url":"https://api.github.com/users/mdbridge/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":0,"created_at":"2025-01-28T20:29:20Z","updated_at":"2025-05-29T19:35:08Z","closed_at":"2025-05-29T19:35:07Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Jira Link: [DB-15076](https://yugabyte.atlassian.net/browse/DB-15076)\n### Description\n\nWhen we fail the add column command and rollback, we don't rollback the last used column id. This results in the column id continuing to increment.\n\nFor xCluster DDL Replication, this breaks replication as we cannot guarantee that each side will have the same column id when performing an ADD COLUMN. \n\nProposed Fix: Do not increment column id on failed ADD COLUMN operations.\n\n\n**Version**: `2.25.1.0-b245`\n\n**Steps**:\n1. Create database and tables at both sides and setup DR replication from source to target\n2. Run `SET yb_test_fail_next_ddl TO true;` at source and run `ALTER TABLE ADD COLUMN` DDL (ex: `alter table t1 add column c2 int;`)\n3. It fails, run again and check the replication -- it works\n4. Load some data to table and check the replication\n\n**Noticed**:\n1. DDL replication happens but data replication to the altered column is not happening, \nSource:\n```\n select * from t1;\n id | name | age | c1 | c2 \n----+------+-----+----+----\n  1 | a    |   1 |  1 |  1\n  2 | b    |   1 |  1 |  1\n```\nTarget:\n```\nselect * from t1;\n id | name | age | c1 | c2 \n----+------+-----+----+----\n  1 | a    |   1 |  1 |   \n  2 | b    |   1 |  1 |   \n```\n\n### Issue Type\n\nkind/bug\n\n### Warning: Please confirm that this issue does not contain any sensitive information\n\n- [x] I confirm this issue does not contain any sensitive information.\n\n[DB-15076]: https://yugabyte.atlassian.net/browse/DB-15076?atlOrigin=eyJpIjoiNWRkNTljNzYxNjVmNDY3MDlhMDU5Y2ZhYzA5YTRkZjUiLCJwIjoiZ2l0aHViLWNvbS1KU1cifQ","closed_by":{"login":"yugabyte-ci","id":17281578,"node_id":"MDQ6VXNlcjE3MjgxNTc4","avatar_url":"https://avatars.githubusercontent.com/u/17281578?v=4","gravatar_id":"","url":"https://api.github.com/users/yugabyte-ci","html_url":"https://github.com/yugabyte-ci","followers_url":"https://api.github.com/users/yugabyte-ci/followers","following_url":"https://api.github.com/users/yugabyte-ci/following{/other_user}","gists_url":"https://api.github.com/users/yugabyte-ci/gists{/gist_id}","starred_url":"https://api.github.com/users/yugabyte-ci/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yugabyte-ci/subscriptions","organizations_url":"https://api.github.com/users/yugabyte-ci/orgs","repos_url":"https://api.github.com/users/yugabyte-ci/repos","events_url":"https://api.github.com/users/yugabyte-ci/events{/privacy}","received_events_url":"https://api.github.com/users/yugabyte-ci/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/25787/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/25787/timeline","performed_via_github_app":null,"state_reason":"completed"}