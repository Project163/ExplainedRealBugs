{"url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/19523","repository_url":"https://api.github.com/repos/yugabyte/yugabyte-db","labels_url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/19523/labels{/name}","comments_url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/19523/comments","events_url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/19523/events","html_url":"https://github.com/yugabyte/yugabyte-db/issues/19523","id":1942114658,"node_id":"I_kwDOBlCVUc5zwlFi","number":19523,"title":"[xCluster][Unit Test] TSAN race in XClusterTestParams","user":{"login":"arybochkin","id":79331145,"node_id":"MDQ6VXNlcjc5MzMxMTQ1","avatar_url":"https://avatars.githubusercontent.com/u/79331145?v=4","gravatar_id":"","url":"https://api.github.com/users/arybochkin","html_url":"https://github.com/arybochkin","followers_url":"https://api.github.com/users/arybochkin/followers","following_url":"https://api.github.com/users/arybochkin/following{/other_user}","gists_url":"https://api.github.com/users/arybochkin/gists{/gist_id}","starred_url":"https://api.github.com/users/arybochkin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/arybochkin/subscriptions","organizations_url":"https://api.github.com/users/arybochkin/orgs","repos_url":"https://api.github.com/users/arybochkin/repos","events_url":"https://api.github.com/users/arybochkin/events{/privacy}","received_events_url":"https://api.github.com/users/arybochkin/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":711841624,"node_id":"MDU6TGFiZWw3MTE4NDE2MjQ=","url":"https://api.github.com/repos/yugabyte/yugabyte-db/labels/kind/enhancement","name":"kind/enhancement","color":"c2e0c6","default":false,"description":"This is an enhancement of an existing feature"},{"id":1281039316,"node_id":"MDU6TGFiZWwxMjgxMDM5MzE2","url":"https://api.github.com/repos/yugabyte/yugabyte-db/labels/kind/failing-test","name":"kind/failing-test","color":"c2e0c6","default":false,"description":"Tests and testing infra"},{"id":1290759928,"node_id":"MDU6TGFiZWwxMjkwNzU5OTI4","url":"https://api.github.com/repos/yugabyte/yugabyte-db/labels/area/docdb","name":"area/docdb","color":"0c4fcc","default":false,"description":"YugabyteDB core features"},{"id":1353907004,"node_id":"MDU6TGFiZWwxMzUzOTA3MDA0","url":"https://api.github.com/repos/yugabyte/yugabyte-db/labels/priority/high","name":"priority/high","color":"ffdc5e","default":false,"description":"High Priority"},{"id":3788247489,"node_id":"LA_kwDOBlCVUc7hzBHB","url":"https://api.github.com/repos/yugabyte/yugabyte-db/labels/xCluster","name":"xCluster","color":"F2BE93","default":false,"description":"Label for xCluster related issues/improvements"}],"state":"closed","locked":false,"assignee":{"login":"hari90","id":12418230,"node_id":"MDQ6VXNlcjEyNDE4MjMw","avatar_url":"https://avatars.githubusercontent.com/u/12418230?v=4","gravatar_id":"","url":"https://api.github.com/users/hari90","html_url":"https://github.com/hari90","followers_url":"https://api.github.com/users/hari90/followers","following_url":"https://api.github.com/users/hari90/following{/other_user}","gists_url":"https://api.github.com/users/hari90/gists{/gist_id}","starred_url":"https://api.github.com/users/hari90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hari90/subscriptions","organizations_url":"https://api.github.com/users/hari90/orgs","repos_url":"https://api.github.com/users/hari90/repos","events_url":"https://api.github.com/users/hari90/events{/privacy}","received_events_url":"https://api.github.com/users/hari90/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"hari90","id":12418230,"node_id":"MDQ6VXNlcjEyNDE4MjMw","avatar_url":"https://avatars.githubusercontent.com/u/12418230?v=4","gravatar_id":"","url":"https://api.github.com/users/hari90","html_url":"https://github.com/hari90","followers_url":"https://api.github.com/users/hari90/followers","following_url":"https://api.github.com/users/hari90/following{/other_user}","gists_url":"https://api.github.com/users/hari90/gists{/gist_id}","starred_url":"https://api.github.com/users/hari90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hari90/subscriptions","organizations_url":"https://api.github.com/users/hari90/orgs","repos_url":"https://api.github.com/users/hari90/repos","events_url":"https://api.github.com/users/hari90/events{/privacy}","received_events_url":"https://api.github.com/users/hari90/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":1,"created_at":"2023-10-13T14:54:30Z","updated_at":"2023-10-16T03:12:18Z","closed_at":"2023-10-16T03:09:01Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Jira Link: [DB-8316](https://yugabyte.atlassian.net/browse/DB-8316)\r\n### Description\r\n\r\nThe following tests have tsan race on the master:\r\nXClusterTestParams/XClusterTest.SetupUniverseReplicationWithTLSEncryption/0\r\nXClusterTestTransactionalOnly.SetupUniverseReplicationWithTLSEncryption\r\nXClusterTestTransactionalOnly.TransactionsWithRestart\r\n\r\nThe following tests have tsan race for a revision run:\r\nCDCServiceTestDurableMinReplicatedIndex.TestLogCDCMinReplicatedIndexIsDurable\r\nXClusterTabletSplitMetricsTest.VerifyReplicationLagMetricsOnChildren\r\nXClusterTestParams/XClusterTest.PollWithProducerNodesRestart/0\r\nXClusterTestParams/XClusterTest.PollWithProducerNodesRestart/1\r\nXClusterTestParams/XClusterTest.SetupUniverseReplication/0\r\nXClusterTestParams/XClusterTest.TestAlterDDLWithRestarts/0\r\nXClusterTestParams/XClusterTest.TestAlterDDLWithRestarts/1\r\nXClusterTestParams/XClusterTest.TestFailedDeleteOnRestart/0\r\nXClusterTestParams/XClusterTest.TestFailedDeleteOnRestart/1\r\n\r\nPattern is the same:\r\n```\r\n==================\r\nWARNING: ThreadSanitizer: data race (pid=16650)\r\n  Write of size 4 at 0x7b500015c9c8 by thread T31 (mutexes: read M0, write M1):\r\n    #0 std::enable_if<is_move_constructible<unsigned int>::value && is_move_assignable<unsigned int>::value, void>::type std::swap[abi:v160006]<unsigned int>(unsigned int&, unsigned int&) /opt/yb-build/thirdparty/yugabyte-db-thirdparty-v20230920205330-09031a51d0-centos7-x86_64-clang16/installed/tsan/libcxx/include/c++/v1/__utility/swap.h:41:7 (libmaster_proto.so+0x873692)\r\n    #1 yb::master::SysXClusterConfigEntryPB::InternalSwap(yb::master::SysXClusterConfigEntryPB*) ${BUILD_ROOT}/src/yb/master/catalog_entity_info.pb.cc:10105:3 (libmaster_proto.so+0x873692)\r\n    #2 yb::master::SysXClusterConfigEntryPB::operator=(yb::master::SysXClusterConfigEntryPB&&) ${BUILD_ROOT}/src/yb/master/catalog_entity_info.pb.h:3268:26 (libmaster.so+0x911c78)\r\n    #3 yb::master::SysXClusterConfigEntryPB::SysXClusterConfigEntryPB(yb::master::SysXClusterConfigEntryPB&&) ${BUILD_ROOT}/src/yb/master/catalog_entity_info.pb.h:3263:11 (libmaster.so+0x911c78)\r\n    #4 yb::master::Persistent<yb::master::SysXClusterConfigEntryPB, (yb::master::SysRowEntryType)16>::Persistent(yb::master::Persistent<yb::master::SysXClusterConfigEntryPB, (yb::master::SysRowEntryType)16>&&) ${BUILD_ROOT}/../../src/yb/master/catalog_entity_info.h:188:8 (libmaster.so+0x911c78)\r\n    #5 yb::master::PersistentXClusterConfigInfo::PersistentXClusterConfigInfo(yb::master::PersistentXClusterConfigInfo&&) ${BUILD_ROOT}/../../src/yb/master/catalog_entity_info.h:1023:8 (libmaster.so+0x911c78)\r\n    #6 std::enable_if<is_move_constructible<yb::master::PersistentXClusterConfigInfo>::value && is_move_assignable<yb::master::PersistentXClusterConfigInfo>::value, void>::type std::swap[abi:v160006]<yb::master::PersistentXClusterConfigInfo>(yb::master::PersistentXClusterConfigInfo&, yb::master::PersistentXClusterConfigInfo&) /opt/yb-build/thirdparty/yugabyte-db-thirdparty-v20230920205330-09031a51d0-centos7-x86_64-clang16/installed/tsan/libcxx/include/c++/v1/__utility/swap.h:39:7 (libmaster.so+0x911c78)\r\n    #7 yb::CowObject<yb::master::PersistentXClusterConfigInfo>::CommitMutation() ${BUILD_ROOT}/../../src/yb/util/cow_object.h:98:5 (libmaster.so+0x911b87)\r\n    #8 yb::CowWriteLock<yb::master::PersistentXClusterConfigInfo>::Commit() ${BUILD_ROOT}/../../src/yb/util/cow_object.h:249:11 (libmaster.so+0x91059b)\r\n    #9 yb::master::XClusterConfig::BumpVersionUpsertAndCommit(yb::master::LeaderEpoch const&, yb::CowWriteLock<yb::master::PersistentXClusterConfigInfo>&) ${BUILD_ROOT}/../../src/yb/master/xcluster/xcluster_config.cc:103:5 (libmaster.so+0x91059b)\r\n    #10 yb::master::XClusterConfig::RemoveStreams(yb::master::LeaderEpoch const&, std::vector<yb::master::CDCStreamInfo*, std::allocator<yb::master::CDCStreamInfo*>> const&) ${BUILD_ROOT}/../../src/yb/master/xcluster/xcluster_config.cc:121:10 (libmaster.so+0x9107e3)\r\n    #11 yb::master::XClusterManager::RemoveStreamFromXClusterProducerConfig(yb::master::LeaderEpoch const&, std::vector<yb::master::CDCStreamInfo*, std::allocator<yb::master::CDCStreamInfo*>> const&) ${BUILD_ROOT}/../../src/yb/master/xcluster/xcluster_manager.cc:121:28 (libmaster.so+0x92d3b2)\r\n    #12 yb::master::CatalogManager::CleanUpDeletedCDCStreams(yb::master::LeaderEpoch const&, std::vector<scoped_refptr<yb::master::CDCStreamInfo>, std::allocator<scoped_refptr<yb::master::CDCStreamInfo>>> const&) ${BUILD_ROOT}/../../src/yb/master/xrepl_catalog_manager.cc:1650:3 (libmaster.so+0x947191)\r\n    #13 yb::master::CatalogManager::RunXClusterBgTasks(yb::master::LeaderEpoch const&) ${BUILD_ROOT}/../../src/yb/master/xrepl_catalog_manager.cc:5509:5 (libmaster.so+0x98b3ac)\r\n    #14 yb::master::CatalogManagerBgTasks::Run() ${BUILD_ROOT}/../../src/yb/master/catalog_manager_bg_tasks.cc:304:7 (libmaster.so+0x68173a)\r\n    #15 decltype(*std::declval<yb::master::CatalogManagerBgTasks*&>().*std::declval<void (yb::master::CatalogManagerBgTasks::*&)()>()()) std::__invoke[abi:v160006]<void (yb::master::CatalogManagerBgTasks::*&)(), yb::master::CatalogManagerBgTasks*&, void>(void (yb::master::CatalogManagerBgTasks::*&)(), yb::master::CatalogManagerBgTasks*&) /opt/yb-build/thirdparty/yugabyte-db-thirdparty-v20230920205330-09031a51d0-centos7-x86_64-clang16/installed/tsan/libcxx/include/c++/v1/__functional/invoke.h:359:23 (libmaster.so+0x6835fb)\r\n    #16 std::__bind_return<void (yb::master::CatalogManagerBgTasks::*)(), std::tuple<yb::master::CatalogManagerBgTasks*>, std::tuple<>, __is_valid_bind_return<void (yb::master::CatalogManagerBgTasks::*)(), std::tuple<yb::master::CatalogManagerBgTasks*>, std::tuple<>>::value>::type std::__apply_functor[abi:v160006]<void (yb::master::CatalogManagerBgTasks::*)(), std::tuple<yb::master::CatalogManagerBgTasks*>, 0ul, std::tuple<>>(void (yb::master::CatalogManagerBgTasks::*&)(), std::tuple<yb::master::CatalogManagerBgTasks*>&, std::__tuple_indices<0ul>, std::tuple<>&&) /opt/yb-build/thirdparty/yugabyte-db-thirdparty-v20230920205330-09031a51d0-centos7-x86_64-clang16/installed/tsan/libcxx/include/c++/v1/__functional/bind.h:263:12 (libmaster.so+0x6835fb)\r\n    #17 std::__bind_return<void (yb::master::CatalogManagerBgTasks::*)(), std::tuple<yb::master::CatalogManagerBgTasks*>, std::tuple<>, __is_valid_bind_return<void (yb::master::CatalogManagerBgTasks::*)(), std::tuple<yb::master::CatalogManagerBgTasks*>, std::tuple<>>::value>::type std::__bind<void (yb::master::CatalogManagerBgTasks::* const&)(), yb::master::CatalogManagerBgTasks* const&>::operator()[abi:v160006]<>() /opt/yb-build/thirdparty/yugabyte-db-thirdparty-v20230920205330-09031a51d0-centos7-x86_64-clang16/installed/tsan/libcxx/include/c++/v1/__functional/bind.h:295:20 (libmaster.so+0x6835fb)\r\n    #18 decltype(std::declval<std::__bind<void (yb::master::CatalogManagerBgTasks::* const&)(), yb::master::CatalogManagerBgTasks* const&>&>()()) std::__invoke[abi:v160006]<std::__bind<void (yb::master::CatalogManagerBgTasks::* const&)(), yb::master::CatalogManagerBgTasks* const&>&>(std::__bind<void (yb::master::CatalogManagerBgTasks::* const&)(), yb::master::CatalogManagerBgTasks* const&>&) /opt/yb-build/thirdparty/yugabyte-db-thirdparty-v20230920205330-09031a51d0-centos7-x86_64-clang16/installed/tsan/libcxx/include/c++/v1/__functional/invoke.h:394:23 (libmaster.so+0x6835fb)\r\n    #19 void std::__invoke_void_return_wrapper<void, true>::__call<std::__bind<void (yb::master::CatalogManagerBgTasks::* const&)(), yb::master::CatalogManagerBgTasks* const&>&>(std::__bind<void (yb::master::CatalogManagerBgTasks::* const&)(), yb::master::CatalogManagerBgTasks* const&>&) /opt/yb-build/thirdparty/yugabyte-db-thirdparty-v20230920205330-09031a51d0-centos7-x86_64-clang16/installed/tsan/libcxx/include/c++/v1/__functional/invoke.h:487:9 (libmaster.so+0x6835fb)\r\n    #20 std::__function::__alloc_func<std::__bind<void (yb::master::CatalogManagerBgTasks::* const&)(), yb::master::CatalogManagerBgTasks* const&>, std::allocator<std::__bind<void (yb::master::CatalogManagerBgTasks::* const&)(), yb::master::CatalogManagerBgTasks* const&>>, void ()>::operator()[abi:v160006]() /opt/yb-build/thirdparty/yugabyte-db-thirdparty-v20230920205330-09031a51d0-centos7-x86_64-clang16/installed/tsan/libcxx/include/c++/v1/__functional/function.h:185:16 (libmaster.so+0x6835fb)\r\n    #21 std::__function::__func<std::__bind<void (yb::master::CatalogManagerBgTasks::* const&)(), yb::master::CatalogManagerBgTasks* const&>, std::allocator<std::__bind<void (yb::master::CatalogManagerBgTasks::* const&)(), yb::master::CatalogManagerBgTasks* const&>>, void ()>::operator()() /opt/yb-build/thirdparty/yugabyte-db-thirdparty-v20230920205330-09031a51d0-centos7-x86_64-clang16/installed/tsan/libcxx/include/c++/v1/__functional/function.h:356:12 (libmaster.so+0x6835fb)\r\n    #22 std::__function::__value_func<void ()>::operator()[abi:v160006]() const /opt/yb-build/thirdparty/yugabyte-db-thirdparty-v20230920205330-09031a51d0-centos7-x86_64-clang16/installed/tsan/libcxx/include/c++/v1/__functional/function.h:510:16 (libyb_util.so+0x3b3562)\r\n    #23 std::function<void ()>::operator()() const /opt/yb-build/thirdparty/yugabyte-db-thirdparty-v20230920205330-09031a51d0-centos7-x86_64-clang16/installed/tsan/libcxx/include/c++/v1/__functional/function.h:1156:12 (libyb_util.so+0x3b3562)\r\n    #24 yb::Thread::SuperviseThread(void*) ${BUILD_ROOT}/../../src/yb/util/thread.cc:853:3 (libyb_util.so+0x3b3562)\r\n\r\n  Previous read of size 4 at 0x7b500015c9c8 by thread T680 (mutexes: read M0):\r\n    #0 yb::master::SysXClusterConfigEntryPB::version() const ${BUILD_ROOT}/src/yb/master/catalog_entity_info.pb.h:11521:10 (libmaster.so+0x91025c)\r\n    #1 yb::master::XClusterConfig::FillHeartbeatResponse(yb::master::TSHeartbeatRequestPB const&, yb::master::TSHeartbeatResponsePB*) const ${BUILD_ROOT}/../../src/yb/master/xcluster/xcluster_config.cc:88:86 (libmaster.so+0x91025c)\r\n    #2 yb::master::XClusterManager::FillHeartbeatResponse(yb::master::TSHeartbeatRequestPB const&, yb::master::TSHeartbeatResponsePB*) const ${BUILD_ROOT}/../../src/yb/master/xcluster/xcluster_manager.cc:116:28 (libmaster.so+0x92d342)\r\n    #3 yb::master::CatalogManager::FillHeartbeatResponseCDC(yb::master::SysClusterConfigEntryPB const&, yb::master::TSHeartbeatRequestPB const*, yb::master::TSHeartbeatResponsePB*) ${BUILD_ROOT}/../../src/yb/master/xrepl_catalog_manager.cc:6400:3 (libmaster.so+0x995c0e)\r\n    #4 yb::master::CatalogManager::FillHeartbeatResponse(yb::master::TSHeartbeatRequestPB const*, yb::master::TSHeartbeatResponsePB*) ${BUILD_ROOT}/../../src/yb/master/catalog_manager_ext.cc:3132:10 (libmaster.so+0x622c54)\r\n    #5 yb::master::(anonymous namespace)::MasterHeartbeatServiceImpl::TSHeartbeat(yb::master::TSHeartbeatRequestPB const*, yb::master::TSHeartbeatResponsePB*, yb::rpc::RpcContext) ${BUILD_ROOT}/../../src/yb/master/master_heartbeat_service.cc:198:42 (libmaster.so+0x786025)\r\n    #6 yb::master::MasterHeartbeatIf::InitMethods(scoped_refptr<yb::MetricEntity> const&)::$_0::operator()(std::shared_ptr<yb::rpc::InboundCall>) const::'lambda'(yb::master::TSHeartbeatRequestPB const*, yb::master::TSHeartbeatResponsePB*, yb::rpc::RpcContext)::operator()(yb::master::TSHeartbeatRequestPB const*, yb::master::TSHeartbeatResponsePB*, yb::rpc::RpcContext) const ${BUILD_ROOT}/src/yb/master/master_heartbeat.service.cc:68:9 (libmaster_proto.so+0x6326e6)\r\n    #7 auto yb::rpc::HandleCall<yb::rpc::RpcCallPBParamsImpl<yb::master::TSHeartbeatRequestPB, yb::master::TSHeartbeatResponsePB>, yb::master::MasterHeartbeatIf::InitMethods(scoped_refptr<yb::MetricEntity> const&)::$_0::operator()(std::shared_ptr<yb::rpc::InboundCall>) const::'lambda'(yb::master::TSHeartbeatRequestPB const*, yb::master::TSHeartbeatResponsePB*, yb::rpc::RpcContext)>(std::shared_ptr<yb::rpc::InboundCall>, yb::master::MasterHeartbeatIf::InitMethods(scoped_refptr<yb::MetricEntity> const&)::$_0::operator()(std::shared_ptr<yb::rpc::InboundCall>) const::'lambda'(yb::master::TSHeartbeatRequestPB const*, yb::master::TSHeartbeatResponsePB*, yb::rpc::RpcContext)) ${BUILD_ROOT}/../../src/yb/rpc/local_call.h:122:7 (libmaster_proto.so+0x6326e6)\r\n    #8 yb::master::MasterHeartbeatIf::InitMethods(scoped_refptr<yb::MetricEntity> const&)::$_0::operator()(std::shared_ptr<yb::rpc::InboundCall>) const ${BUILD_ROOT}/src/yb/master/master_heartbeat.service.cc:66:7 (libmaster_proto.so+0x6326e6)\r\n    #9 decltype(std::declval<yb::master::MasterHeartbeatIf::InitMethods(scoped_refptr<yb::MetricEntity> const&)::$_0&>()(std::declval<std::shared_ptr<yb::rpc::InboundCall>>())) std::__invoke[abi:v160006]<yb::master::MasterHeartbeatIf::InitMethods(scoped_refptr<yb::MetricEntity> const&)::$_0&, std::shared_ptr<yb::rpc::InboundCall>>(yb::master::MasterHeartbeatIf::InitMethods(scoped_refptr<yb::MetricEntity> const&)::$_0&, std::shared_ptr<yb::rpc::InboundCall>&&) /opt/yb-build/thirdparty/yugabyte-db-thirdparty-v20230920205330-09031a51d0-centos7-x86_64-clang16/installed/tsan/libcxx/include/c++/v1/__functional/invoke.h:394:23 (libmaster_proto.so+0x6326e6)\r\n    #10 void std::__invoke_void_return_wrapper<void, true>::__call<yb::master::MasterHeartbeatIf::InitMethods(scoped_refptr<yb::MetricEntity> const&)::$_0&, std::shared_ptr<yb::rpc::InboundCall>>(yb::master::MasterHeartbeatIf::InitMethods(scoped_refptr<yb::MetricEntity> const&)::$_0&, std::shared_ptr<yb::rpc::InboundCall>&&) /opt/yb-build/thirdparty/yugabyte-db-thirdparty-v20230920205330-09031a51d0-centos7-x86_64-clang16/installed/tsan/libcxx/include/c++/v1/__functional/invoke.h:487:9 (libmaster_proto.so+0x6326e6)\r\n    #11 std::__function::__alloc_func<yb::master::MasterHeartbeatIf::InitMethods(scoped_refptr<yb::MetricEntity> const&)::$_0, std::allocator<yb::master::MasterHeartbeatIf::InitMethods(scoped_refptr<yb::MetricEntity> const&)::$_0>, void (std::shared_ptr<yb::rpc::InboundCall>)>::operator()[abi:v160006](std::shared_ptr<yb::rpc::InboundCall>&&) /opt/yb-build/thirdparty/yugabyte-db-thirdparty-v20230920205330-09031a51d0-centos7-x86_64-clang16/installed/tsan/libcxx/include/c++/v1/__functional/function.h:185:16 (libmaster_proto.so+0x6326e6)\r\n    #12 std::__function::__func<yb::master::MasterHeartbeatIf::InitMethods(scoped_refptr<yb::MetricEntity> const&)::$_0, std::allocator<yb::master::MasterHeartbeatIf::InitMethods(scoped_refptr<yb::MetricEntity> const&)::$_0>, void (std::shared_ptr<yb::rpc::InboundCall>)>::operator()(std::shared_ptr<yb::rpc::InboundCall>&&) /opt/yb-build/thirdparty/yugabyte-db-thirdparty-v20230920205330-09031a51d0-centos7-x86_64-clang16/installed/tsan/libcxx/include/c++/v1/__functional/function.h:356:12 (libmaster_proto.so+0x6326e6)\r\n    #13 std::__function::__value_func<void (std::shared_ptr<yb::rpc::InboundCall>)>::operator()[abi:v160006](std::shared_ptr<yb::rpc::InboundCall>&&) const /opt/yb-build/thirdparty/yugabyte-db-thirdparty-v20230920205330-09031a51d0-centos7-x86_64-clang16/installed/tsan/libcxx/include/c++/v1/__functional/function.h:510:16 (libmaster_proto.so+0x6320c2)\r\n    #14 std::function<void (std::shared_ptr<yb::rpc::InboundCall>)>::operator()(std::shared_ptr<yb::rpc::InboundCall>) const /opt/yb-build/thirdparty/yugabyte-db-thirdparty-v20230920205330-09031a51d0-centos7-x86_64-clang16/installed/tsan/libcxx/include/c++/v1/__functional/function.h:1156:12 (libmaster_proto.so+0x6320c2)\r\n    #15 yb::master::MasterHeartbeatIf::Handle(std::shared_ptr<yb::rpc::InboundCall>) ${BUILD_ROOT}/src/yb/master/master_heartbeat.service.cc:51:3 (libmaster_proto.so+0x6320c2)\r\n    #16 yb::rpc::ServicePoolImpl::Handle(std::shared_ptr<yb::rpc::InboundCall>) ${BUILD_ROOT}/../../src/yb/rpc/service_pool.cc:261:19 (libyrpc.so+0x197665)\r\n    #17 yb::rpc::InboundCall::InboundCallTask::Run() ${BUILD_ROOT}/../../src/yb/rpc/inbound_call.cc:244:13 (libyrpc.so+0xf9019)\r\n    #18 yb::rpc::(anonymous namespace)::Worker::Execute() ${BUILD_ROOT}/../../src/yb/rpc/thread_pool.cc:104:15 (libyrpc.so+0x1adcb4)\r\n    #19 decltype(*std::declval<yb::rpc::(anonymous namespace)::Worker*&>().*std::declval<void (yb::rpc::(anonymous namespace)::Worker::*&)()>()()) std::__invoke[abi:v160006]<void (yb::rpc::(anonymous namespace)::Worker::*&)(), yb::rpc::(anonymous namespace)::Worker*&, void>(void (yb::rpc::(anonymous namespace)::Worker::*&)(), yb::rpc::(anonymous namespace)::Worker*&) /opt/yb-build/thirdparty/yugabyte-db-thirdparty-v20230920205330-09031a51d0-centos7-x86_64-clang16/installed/tsan/libcxx/include/c++/v1/__functional/invoke.h:359:23 (libyrpc.so+0x1ae10b)\r\n    #20 std::__bind_return<void (yb::rpc::(anonymous namespace)::Worker::*)(), std::tuple<yb::rpc::(anonymous namespace)::Worker*>, std::tuple<>, __is_valid_bind_return<void (yb::rpc::(anonymous namespace)::Worker::*)(), std::tuple<yb::rpc::(anonymous namespace)::Worker*>, std::tuple<>>::value>::type std::__apply_functor[abi:v160006]<void (yb::rpc::(anonymous namespace)::Worker::*)(), std::tuple<yb::rpc::(anonymous namespace)::Worker*>, 0ul, std::tuple<>>(void (yb::rpc::(anonymous namespace)::Worker::*&)(), std::tuple<yb::rpc::(anonymous namespace)::Worker*>&, std::__tuple_indices<0ul>, std::tuple<>&&) /opt/yb-build/thirdparty/yugabyte-db-thirdparty-v20230920205330-09031a51d0-centos7-x86_64-clang16/installed/tsan/libcxx/include/c++/v1/__functional/bind.h:263:12 (libyrpc.so+0x1ae10b)\r\n    #21 std::__bind_return<void (yb::rpc::(anonymous namespace)::Worker::*)(), std::tuple<yb::rpc::(anonymous namespace)::Worker*>, std::tuple<>, __is_valid_bind_return<void (yb::rpc::(anonymous namespace)::Worker::*)(), std::tuple<yb::rpc::(anonymous namespace)::Worker*>, std::tuple<>>::value>::type std::__bind<void (yb::rpc::(anonymous namespace)::Worker::* const&)(), yb::rpc::(anonymous namespace)::Worker* const&>::operator()[abi:v160006]<>() /opt/yb-build/thirdparty/yugabyte-db-thirdparty-v20230920205330-09031a51d0-centos7-x86_64-clang16/installed/tsan/libcxx/include/c++/v1/__functional/bind.h:295:20 (libyrpc.so+0x1ae10b)\r\n    #22 decltype(std::declval<std::__bind<void (yb::rpc::(anonymous namespace)::Worker::* const&)(), yb::rpc::(anonymous namespace)::Worker* const&>&>()()) std::__invoke[abi:v160006]<std::__bind<void (yb::rpc::(anonymous namespace)::Worker::* const&)(), yb::rpc::(anonymous namespace)::Worker* const&>&>(std::__bind<void (yb::rpc::(anonymous namespace)::Worker::* const&)(), yb::rpc::(anonymous namespace)::Worker* const&>&) /opt/yb-build/thirdparty/yugabyte-db-thirdparty-v20230920205330-09031a51d0-centos7-x86_64-clang16/installed/tsan/libcxx/include/c++/v1/__functional/invoke.h:394:23 (libyrpc.so+0x1ae10b)\r\n    #23 void std::__invoke_void_return_wrapper<void, true>::__call<std::__bind<void (yb::rpc::(anonymous namespace)::Worker::* const&)(), yb::rpc::(anonymous namespace)::Worker* const&>&>(std::__bind<void (yb::rpc::(anonymous namespace)::Worker::* const&)(), yb::rpc::(anonymous namespace)::Worker* const&>&) /opt/yb-build/thirdparty/yugabyte-db-thirdparty-v20230920205330-09031a51d0-centos7-x86_64-clang16/installed/tsan/libcxx/include/c++/v1/__functional/invoke.h:487:9 (libyrpc.so+0x1ae10b)\r\n    #24 std::__function::__alloc_func<std::__bind<void (yb::rpc::(anonymous namespace)::Worker::* const&)(), yb::rpc::(anonymous namespace)::Worker* const&>, std::allocator<std::__bind<void (yb::rpc::(anonymous namespace)::Worker::* const&)(), yb::rpc::(anonymous namespace)::Worker* const&>>, void ()>::operator()[abi:v160006]() /opt/yb-build/thirdparty/yugabyte-db-thirdparty-v20230920205330-09031a51d0-centos7-x86_64-clang16/installed/tsan/libcxx/include/c++/v1/__functional/function.h:185:16 (libyrpc.so+0x1ae10b)\r\n    #25 std::__function::__func<std::__bind<void (yb::rpc::(anonymous namespace)::Worker::* const&)(), yb::rpc::(anonymous namespace)::Worker* const&>, std::allocator<std::__bind<void (yb::rpc::(anonymous namespace)::Worker::* const&)(), yb::rpc::(anonymous namespace)::Worker* const&>>, void ()>::operator()() /opt/yb-build/thirdparty/yugabyte-db-thirdparty-v20230920205330-09031a51d0-centos7-x86_64-clang16/installed/tsan/libcxx/include/c++/v1/__functional/function.h:356:12 (libyrpc.so+0x1ae10b)\r\n    #26 std::__function::__value_func<void ()>::operator()[abi:v160006]() const /opt/yb-build/thirdparty/yugabyte-db-thirdparty-v20230920205330-09031a51d0-centos7-x86_64-clang16/installed/tsan/libcxx/include/c++/v1/__functional/function.h:510:16 (libyb_util.so+0x3b3562)\r\n    #27 std::function<void ()>::operator()() const /opt/yb-build/thirdparty/yugabyte-db-thirdparty-v20230920205330-09031a51d0-centos7-x86_64-clang16/installed/tsan/libcxx/include/c++/v1/__functional/function.h:1156:12 (libyb_util.so+0x3b3562)\r\n    #28 yb::Thread::SuperviseThread(void*) ${BUILD_ROOT}/../../src/yb/util/thread.cc:853:3 (libyb_util.so+0x3b3562)\r\n...\r\nSUMMARY: ThreadSanitizer: data race /opt/yb-build/thirdparty/yugabyte-db-thirdparty-v20230920205330-09031a51d0-centos7-x86_64-clang16/installed/tsan/libcxx/include/c++/v1/__utility/swap.h:41:7 in std::enable_if<is_move_constructible<unsigned int>::value && is_move_assignable<unsigned int>::value, void>::type std::swap[abi:v160006]<unsigned int>(unsigned int&, unsigned int&)\r\n==================\r\n```\r\n\r\nStability report:\r\nhttps://detective-gcp.dev.yugabyte.com/stability/test?branch=master&build_type=tsan&class=XClusterTestParams%2FXClusterTest&fail_tag=tsan_race&name=SetupUniverseReplicationWithTLSEncryption%2F0\r\n\r\n### Issue Type\r\n\r\nkind/bug\r\n\r\n### Warning: Please confirm that this issue does not contain any sensitive information\r\n\r\n- [X] I confirm this issue does not contain any sensitive information.\r\n\r\n[DB-8316]: https://yugabyte.atlassian.net/browse/DB-8316?atlOrigin=eyJpIjoiNWRkNTljNzYxNjVmNDY3MDlhMDU5Y2ZhYzA5YTRkZjUiLCJwIjoiZ2l0aHViLWNvbS1KU1cifQ","closed_by":{"login":"hari90","id":12418230,"node_id":"MDQ6VXNlcjEyNDE4MjMw","avatar_url":"https://avatars.githubusercontent.com/u/12418230?v=4","gravatar_id":"","url":"https://api.github.com/users/hari90","html_url":"https://github.com/hari90","followers_url":"https://api.github.com/users/hari90/followers","following_url":"https://api.github.com/users/hari90/following{/other_user}","gists_url":"https://api.github.com/users/hari90/gists{/gist_id}","starred_url":"https://api.github.com/users/hari90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hari90/subscriptions","organizations_url":"https://api.github.com/users/hari90/orgs","repos_url":"https://api.github.com/users/hari90/repos","events_url":"https://api.github.com/users/hari90/events{/privacy}","received_events_url":"https://api.github.com/users/hari90/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/19523/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/19523/timeline","performed_via_github_app":null,"state_reason":"completed"}