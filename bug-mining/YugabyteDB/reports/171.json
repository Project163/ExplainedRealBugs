{"url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/24745","repository_url":"https://api.github.com/repos/yugabyte/yugabyte-db","labels_url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/24745/labels{/name}","comments_url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/24745/comments","events_url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/24745/events","html_url":"https://github.com/yugabyte/yugabyte-db/issues/24745","id":2625318654,"node_id":"I_kwDOBlCVUc6cey7-","number":24745,"title":"[DocDB] Disable XClusterOutboundReplicationGroupParameterized.MasterRestartDuringCheckpoint test until the underlying feature can be fixed","user":{"login":"mdbridge","id":15827795,"node_id":"MDQ6VXNlcjE1ODI3Nzk1","avatar_url":"https://avatars.githubusercontent.com/u/15827795?v=4","gravatar_id":"","url":"https://api.github.com/users/mdbridge","html_url":"https://github.com/mdbridge","followers_url":"https://api.github.com/users/mdbridge/followers","following_url":"https://api.github.com/users/mdbridge/following{/other_user}","gists_url":"https://api.github.com/users/mdbridge/gists{/gist_id}","starred_url":"https://api.github.com/users/mdbridge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdbridge/subscriptions","organizations_url":"https://api.github.com/users/mdbridge/orgs","repos_url":"https://api.github.com/users/mdbridge/repos","events_url":"https://api.github.com/users/mdbridge/events{/privacy}","received_events_url":"https://api.github.com/users/mdbridge/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":711841622,"node_id":"MDU6TGFiZWw3MTE4NDE2MjI=","url":"https://api.github.com/repos/yugabyte/yugabyte-db/labels/kind/bug","name":"kind/bug","color":"c2e0c6","default":false,"description":"This issue is a bug"},{"id":1290759928,"node_id":"MDU6TGFiZWwxMjkwNzU5OTI4","url":"https://api.github.com/repos/yugabyte/yugabyte-db/labels/area/docdb","name":"area/docdb","color":"0c4fcc","default":false,"description":"YugabyteDB core features"},{"id":1419821900,"node_id":"MDU6TGFiZWwxNDE5ODIxOTAw","url":"https://api.github.com/repos/yugabyte/yugabyte-db/labels/priority/medium","name":"priority/medium","color":"ffdc5e","default":false,"description":"Medium priority issue"}],"state":"closed","locked":false,"assignee":{"login":"mdbridge","id":15827795,"node_id":"MDQ6VXNlcjE1ODI3Nzk1","avatar_url":"https://avatars.githubusercontent.com/u/15827795?v=4","gravatar_id":"","url":"https://api.github.com/users/mdbridge","html_url":"https://github.com/mdbridge","followers_url":"https://api.github.com/users/mdbridge/followers","following_url":"https://api.github.com/users/mdbridge/following{/other_user}","gists_url":"https://api.github.com/users/mdbridge/gists{/gist_id}","starred_url":"https://api.github.com/users/mdbridge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdbridge/subscriptions","organizations_url":"https://api.github.com/users/mdbridge/orgs","repos_url":"https://api.github.com/users/mdbridge/repos","events_url":"https://api.github.com/users/mdbridge/events{/privacy}","received_events_url":"https://api.github.com/users/mdbridge/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"mdbridge","id":15827795,"node_id":"MDQ6VXNlcjE1ODI3Nzk1","avatar_url":"https://avatars.githubusercontent.com/u/15827795?v=4","gravatar_id":"","url":"https://api.github.com/users/mdbridge","html_url":"https://github.com/mdbridge","followers_url":"https://api.github.com/users/mdbridge/followers","following_url":"https://api.github.com/users/mdbridge/following{/other_user}","gists_url":"https://api.github.com/users/mdbridge/gists{/gist_id}","starred_url":"https://api.github.com/users/mdbridge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdbridge/subscriptions","organizations_url":"https://api.github.com/users/mdbridge/orgs","repos_url":"https://api.github.com/users/mdbridge/repos","events_url":"https://api.github.com/users/mdbridge/events{/privacy}","received_events_url":"https://api.github.com/users/mdbridge/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":1,"created_at":"2024-10-30T20:53:24Z","updated_at":"2025-05-28T21:24:58Z","closed_at":"2024-10-31T20:07:54Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Jira Link: [DB-13825](https://yugabyte.atlassian.net/browse/DB-13825)\r\n### Description\n\nThe following xCluster test is flaky:\r\n```\r\n~/code/yugabyte-db/src/yb/integration-tests/xcluster/xcluster_outbound_replication_group-itest.cc:419:\r\nTEST_P(XClusterOutboundReplicationGroupParameterized, MasterRestartDuringCheckpoint) {\r\n  // Temporarily disabling this during automatic mode because automatic mode does not yet\r\n  // successfully survive a master restart during a checkpoint.\r\n  // TODO(GitHub issue #23918): fix automatic mode so it passes this test then reenable this test.\r\n  if (UseAutomaticMode()) {\r\n    return;\r\n  }\r\n\r\n  ANNOTATE_UNPROTECTED_WRITE(FLAGS_max_xcluster_streams_to_checkpoint_in_parallel) = 1;\r\n  auto table_id_1 = ASSERT_RESULT(CreateYsqlTable(kNamespaceName, kTableName1));\r\n  auto table_id_2 = ASSERT_RESULT(CreateYsqlTable(kNamespaceName, kTableName2));\r\n\r\n  ANNOTATE_UNPROTECTED_WRITE(FLAGS_TEST_block_xcluster_checkpoint_namespace_task) = true;\r\n\r\n  ASSERT_OK(CreateOutboundReplicationGroupAsync(kReplicationGroupId, {namespace_id_}));\r\n\r\n  std::promise<Result<master::GetXClusterStreamsResponsePB>> promise;\r\n  auto future = promise.get_future();\r\n  ASSERT_OK(XClusterClient().GetXClusterStreams(\r\n      CoarseMonoClock::Now() + kDeadline, kReplicationGroupId, namespace_id_, /*table_names=*/{},\r\n      /*pg_schema_names=*/{}, [&promise](const auto& resp) { promise.set_value(resp); }));\r\n\r\n  ASSERT_EQ(future.wait_for(5s), std::future_status::timeout);\r\n\r\n  LOG(INFO) << \"***** Restarting Master now...\";\r\n  ASSERT_OK(RestartMaster());\r\n\r\n  ANNOTATE_UNPROTECTED_WRITE(FLAGS_TEST_block_xcluster_checkpoint_namespace_task) = false;\r\n\r\n  auto resp = ASSERT_RESULT(future.get());\r\n  size_t stream_count = 2 + OverheadStreamsCount();\r\n  ASSERT_NO_FATALS(VerifyNamespaceCheckpointInfo(table_id_1, table_id_2, stream_count, resp));\r\n\r\n  auto all_xcluster_streams_initial = CleanupAndGetAllXClusterStreams();\r\n  ASSERT_EQ(all_xcluster_streams_initial.size(), stream_count);\r\n}\r\n```\r\n\r\nIn particular, it is flaky in the worst way: it should fail 100% of the time but only fails like one time in 50.\r\n\r\nApparently checkpointing does not in fact survive master restarts even in semi-automatic mode.\r\n\r\nThe failure case is due to:\r\n```\r\n   2188:[P-m-1] W1022 09:10:57.290823 1869164544 xcluster_outbound_replication_group.cc:316] xClusterOutboundReplicationGroup rg1 :Failed to checkpoint namespace 00004000000030008000000000000000: Service unavailable (yb/master/catalog_manager.cc:2105): Catalog manager is shutting down. State: 3\r\n```\r\n\r\nThis particular issue is to disable this test and add a todo to fix the underlying feature.\r\n\n\n### Issue Type\n\nkind/bug\n\n### Warning: Please confirm that this issue does not contain any sensitive information\n\n- [X] I confirm this issue does not contain any sensitive information.\n\n[DB-13825]: https://yugabyte.atlassian.net/browse/DB-13825?atlOrigin=eyJpIjoiNWRkNTljNzYxNjVmNDY3MDlhMDU5Y2ZhYzA5YTRkZjUiLCJwIjoiZ2l0aHViLWNvbS1KU1cifQ","closed_by":{"login":"mdbridge","id":15827795,"node_id":"MDQ6VXNlcjE1ODI3Nzk1","avatar_url":"https://avatars.githubusercontent.com/u/15827795?v=4","gravatar_id":"","url":"https://api.github.com/users/mdbridge","html_url":"https://github.com/mdbridge","followers_url":"https://api.github.com/users/mdbridge/followers","following_url":"https://api.github.com/users/mdbridge/following{/other_user}","gists_url":"https://api.github.com/users/mdbridge/gists{/gist_id}","starred_url":"https://api.github.com/users/mdbridge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdbridge/subscriptions","organizations_url":"https://api.github.com/users/mdbridge/orgs","repos_url":"https://api.github.com/users/mdbridge/repos","events_url":"https://api.github.com/users/mdbridge/events{/privacy}","received_events_url":"https://api.github.com/users/mdbridge/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/24745/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/24745/timeline","performed_via_github_app":null,"state_reason":"completed"}