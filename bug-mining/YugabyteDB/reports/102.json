{"url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/22430","repository_url":"https://api.github.com/repos/yugabyte/yugabyte-db","labels_url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/22430/labels{/name}","comments_url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/22430/comments","events_url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/22430/events","html_url":"https://github.com/yugabyte/yugabyte-db/issues/22430","id":2301553489,"node_id":"I_kwDOBlCVUc6JLutR","number":22430,"title":"[DocDB] Prevent user writes if we are close to disk full by rejecting TabletServiceImpl::PerformWrite","user":{"login":"yugabyte-ci","id":17281578,"node_id":"MDQ6VXNlcjE3MjgxNTc4","avatar_url":"https://avatars.githubusercontent.com/u/17281578?v=4","gravatar_id":"","url":"https://api.github.com/users/yugabyte-ci","html_url":"https://github.com/yugabyte-ci","followers_url":"https://api.github.com/users/yugabyte-ci/followers","following_url":"https://api.github.com/users/yugabyte-ci/following{/other_user}","gists_url":"https://api.github.com/users/yugabyte-ci/gists{/gist_id}","starred_url":"https://api.github.com/users/yugabyte-ci/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yugabyte-ci/subscriptions","organizations_url":"https://api.github.com/users/yugabyte-ci/orgs","repos_url":"https://api.github.com/users/yugabyte-ci/repos","events_url":"https://api.github.com/users/yugabyte-ci/events{/privacy}","received_events_url":"https://api.github.com/users/yugabyte-ci/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":711841624,"node_id":"MDU6TGFiZWw3MTE4NDE2MjQ=","url":"https://api.github.com/repos/yugabyte/yugabyte-db/labels/kind/enhancement","name":"kind/enhancement","color":"c2e0c6","default":false,"description":"This is an enhancement of an existing feature"},{"id":1353907004,"node_id":"MDU6TGFiZWwxMzUzOTA3MDA0","url":"https://api.github.com/repos/yugabyte/yugabyte-db/labels/priority/high","name":"priority/high","color":"ffdc5e","default":false,"description":"High Priority"},{"id":4118183456,"node_id":"LA_kwDOBlCVUc71dn4g","url":"https://api.github.com/repos/yugabyte/yugabyte-db/labels/jira-originated","name":"jira-originated","color":"ededed","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"hari90","id":12418230,"node_id":"MDQ6VXNlcjEyNDE4MjMw","avatar_url":"https://avatars.githubusercontent.com/u/12418230?v=4","gravatar_id":"","url":"https://api.github.com/users/hari90","html_url":"https://github.com/hari90","followers_url":"https://api.github.com/users/hari90/followers","following_url":"https://api.github.com/users/hari90/following{/other_user}","gists_url":"https://api.github.com/users/hari90/gists{/gist_id}","starred_url":"https://api.github.com/users/hari90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hari90/subscriptions","organizations_url":"https://api.github.com/users/hari90/orgs","repos_url":"https://api.github.com/users/hari90/repos","events_url":"https://api.github.com/users/hari90/events{/privacy}","received_events_url":"https://api.github.com/users/hari90/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"hari90","id":12418230,"node_id":"MDQ6VXNlcjEyNDE4MjMw","avatar_url":"https://avatars.githubusercontent.com/u/12418230?v=4","gravatar_id":"","url":"https://api.github.com/users/hari90","html_url":"https://github.com/hari90","followers_url":"https://api.github.com/users/hari90/followers","following_url":"https://api.github.com/users/hari90/following{/other_user}","gists_url":"https://api.github.com/users/hari90/gists{/gist_id}","starred_url":"https://api.github.com/users/hari90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hari90/subscriptions","organizations_url":"https://api.github.com/users/hari90/orgs","repos_url":"https://api.github.com/users/hari90/repos","events_url":"https://api.github.com/users/hari90/events{/privacy}","received_events_url":"https://api.github.com/users/hari90/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":0,"created_at":"2024-05-16T23:41:16Z","updated_at":"2024-07-09T00:46:28Z","closed_at":"2024-06-14T03:59:26Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Jira Link: [DB-11337](https://yugabyte.atlassian.net/browse/DB-11337)\r\n\r\nCustomers can load data into the system until they run out of disk space. Once we run out of disk the tservers will FATAL until extra disk is added.\r\nA simple solution that will cover the majority of cases (not all) will be to check the available disk at `TabletServiceImpl::PerformWrite` and reject incoming writes if we do not have sufficient space (`FLAGS_reject_writes_min_disk_space_mb ` = 3GB).\r\n\r\nPerform the system call to check size only once every 60 seconds(`FLAGS_reject_writes_min_disk_space_check_interval_sec`) to avoid performance issues as long as there is `FLAGS_reject_writes_min_disk_space_aggressive_check_mb` (18GB default) space left. If the free space is under `FLAGS_reject_writes_min_disk_space_aggressive_check_mb` then we check every 10s.\r\n\r\n\r\nThis will cover the majority of cases since all nodes more or less have the same size and data distribution. \r\n\r\n\r\n\r\n[DB-11337]: https://yugabyte.atlassian.net/browse/DB-11337?atlOrigin=eyJpIjoiNWRkNTljNzYxNjVmNDY3MDlhMDU5Y2ZhYzA5YTRkZjUiLCJwIjoiZ2l0aHViLWNvbS1KU1cifQ","closed_by":{"login":"hari90","id":12418230,"node_id":"MDQ6VXNlcjEyNDE4MjMw","avatar_url":"https://avatars.githubusercontent.com/u/12418230?v=4","gravatar_id":"","url":"https://api.github.com/users/hari90","html_url":"https://github.com/hari90","followers_url":"https://api.github.com/users/hari90/followers","following_url":"https://api.github.com/users/hari90/following{/other_user}","gists_url":"https://api.github.com/users/hari90/gists{/gist_id}","starred_url":"https://api.github.com/users/hari90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hari90/subscriptions","organizations_url":"https://api.github.com/users/hari90/orgs","repos_url":"https://api.github.com/users/hari90/repos","events_url":"https://api.github.com/users/hari90/events{/privacy}","received_events_url":"https://api.github.com/users/hari90/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/22430/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/yugabyte/yugabyte-db/issues/22430/timeline","performed_via_github_app":null,"state_reason":"completed"}