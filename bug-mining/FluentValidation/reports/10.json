{"url":"https://api.github.com/repos/FluentValidation/FluentValidation/issues/1674","repository_url":"https://api.github.com/repos/FluentValidation/FluentValidation","labels_url":"https://api.github.com/repos/FluentValidation/FluentValidation/issues/1674/labels{/name}","comments_url":"https://api.github.com/repos/FluentValidation/FluentValidation/issues/1674/comments","events_url":"https://api.github.com/repos/FluentValidation/FluentValidation/issues/1674/events","html_url":"https://github.com/FluentValidation/FluentValidation/issues/1674","id":837812972,"node_id":"MDU6SXNzdWU4Mzc4MTI5NzI=","number":1674,"title":"Nested .When operations causes exception","user":{"login":"mvestergaard","id":2027834,"node_id":"MDQ6VXNlcjIwMjc4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/2027834?v=4","gravatar_id":"","url":"https://api.github.com/users/mvestergaard","html_url":"https://github.com/mvestergaard","followers_url":"https://api.github.com/users/mvestergaard/followers","following_url":"https://api.github.com/users/mvestergaard/following{/other_user}","gists_url":"https://api.github.com/users/mvestergaard/gists{/gist_id}","starred_url":"https://api.github.com/users/mvestergaard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mvestergaard/subscriptions","organizations_url":"https://api.github.com/users/mvestergaard/orgs","repos_url":"https://api.github.com/users/mvestergaard/repos","events_url":"https://api.github.com/users/mvestergaard/events{/privacy}","received_events_url":"https://api.github.com/users/mvestergaard/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/FluentValidation/FluentValidation/milestones/27","html_url":"https://github.com/FluentValidation/FluentValidation/milestone/27","labels_url":"https://api.github.com/repos/FluentValidation/FluentValidation/milestones/27/labels","id":5739727,"node_id":"MDk6TWlsZXN0b25lNTczOTcyNw==","number":27,"title":"10.0","description":"","creator":{"login":"JeremySkinner","id":90130,"node_id":"MDQ6VXNlcjkwMTMw","avatar_url":"https://avatars.githubusercontent.com/u/90130?v=4","gravatar_id":"","url":"https://api.github.com/users/JeremySkinner","html_url":"https://github.com/JeremySkinner","followers_url":"https://api.github.com/users/JeremySkinner/followers","following_url":"https://api.github.com/users/JeremySkinner/following{/other_user}","gists_url":"https://api.github.com/users/JeremySkinner/gists{/gist_id}","starred_url":"https://api.github.com/users/JeremySkinner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JeremySkinner/subscriptions","organizations_url":"https://api.github.com/users/JeremySkinner/orgs","repos_url":"https://api.github.com/users/JeremySkinner/repos","events_url":"https://api.github.com/users/JeremySkinner/events{/privacy}","received_events_url":"https://api.github.com/users/JeremySkinner/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":21,"state":"closed","created_at":"2020-08-06T11:15:05Z","updated_at":"2021-04-15T12:10:23Z","due_on":"2021-07-01T07:00:00Z","closed_at":"2021-04-15T12:10:23Z"},"comments":10,"created_at":"2021-03-22T15:09:10Z","updated_at":"2021-04-06T00:10:59Z","closed_at":"2021-03-22T15:54:30Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\nPlease check the documentation at https://fluentvalidation.net first to see if your question is addressed there.\r\nPlease also check to see if your question has already been answered in the issue tracker. \r\n\r\nIf not, please fill in the details below.\r\nIssues will be closed if the questions below aren't answered. \r\n-->\r\n\r\n**Which version of FluentValidation are you using?**\r\n10.0.0-preview3\r\n\r\n**Describe the issue that you're having**\r\nThe following code causes an exception when the validator is instantiated\r\n```cs\r\npublic class SomeType\r\n{\r\n    public bool Value1 { get; set; }\r\n\r\n    public bool Value2 { get; set; }\r\n}\r\n\r\npublic class SomeTypeValidator : AbstractValidator<SomeType>\r\n{\r\n    public SomeTypeValidator()\r\n    {\r\n        this.When(\r\n                o => o.Value1,\r\n                () =>\r\n                {\r\n                    // do stuff\r\n                })\r\n            .Otherwise(\r\n                () =>\r\n                {\r\n                    this.When(\r\n                        o => o.Value2,\r\n                        () =>\r\n                        {\r\n                            // do stuff\r\n                        });\r\n                });\r\n    }\r\n}\r\n```\r\n\r\n```\r\nSystem.ArgumentException\r\nDelegates must be of the same type.\r\n   at System.MulticastDelegate.CombineImpl(Delegate follow)\r\n   at FluentValidation.Internal.TrackingCollection`1.add_ItemAdded(Action`1 value)\r\n   at FluentValidation.Internal.TrackingCollection`1.OnItemAdded(Action`1 onItemAdded) in C:\\Projects\\FluentValidation\\src\\FluentValidation\\Internal\\TrackingCollection.cs:line 48\r\n   at FluentValidation.Internal.ConditionBuilder`1.When(Func`3 predicate, Action action) in C:\\Projects\\FluentValidation\\src\\FluentValidation\\Internal\\ConditionBuilder.cs:line 40\r\n   at FluentValidation.AbstractValidator`1.When(Func`3 predicate, Action action) in C:\\Projects\\FluentValidation\\src\\FluentValidation\\AbstractValidator.cs:line 302\r\n   at FluentValidation.AbstractValidator`1.When(Func`2 predicate, Action action) in C:\\Projects\\FluentValidation\\src\\FluentValidation\\AbstractValidator.cs:line 292\r\n   at Nordic.Application.Sales.Tests.StructuralRules.ElementToggling.Common.TestObjValidator.<.ctor>b__0_2() in D:\\source\\roadmap\\src\\Core\\Nordic.Application.Sales.Tests\\StructuralRules\\ElementToggling\\Common.cs:line 63\r\n   at FluentValidation.Internal.ConditionOtherwiseBuilder`1.Otherwise(Action action) in C:\\Projects\\FluentValidation\\src\\FluentValidation\\Internal\\ConditionBuilder.cs:line 161\r\n```\r\n\r\nIt appears that it's trying to combine two delegates where one is `Action<IValidationRule<T>>` and the other is `Action<IValidationRuleInternal<T>>`\r\n","closed_by":{"login":"JeremySkinner","id":90130,"node_id":"MDQ6VXNlcjkwMTMw","avatar_url":"https://avatars.githubusercontent.com/u/90130?v=4","gravatar_id":"","url":"https://api.github.com/users/JeremySkinner","html_url":"https://github.com/JeremySkinner","followers_url":"https://api.github.com/users/JeremySkinner/followers","following_url":"https://api.github.com/users/JeremySkinner/following{/other_user}","gists_url":"https://api.github.com/users/JeremySkinner/gists{/gist_id}","starred_url":"https://api.github.com/users/JeremySkinner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JeremySkinner/subscriptions","organizations_url":"https://api.github.com/users/JeremySkinner/orgs","repos_url":"https://api.github.com/users/JeremySkinner/repos","events_url":"https://api.github.com/users/JeremySkinner/events{/privacy}","received_events_url":"https://api.github.com/users/JeremySkinner/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/FluentValidation/FluentValidation/issues/1674/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/FluentValidation/FluentValidation/issues/1674/timeline","performed_via_github_app":null,"state_reason":"completed"}