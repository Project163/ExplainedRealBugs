<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 19:29:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[JAMES-3742] MIME-Version header is changed, breaking DKIM signatures</title>
                <link>https://issues.apache.org/jira/browse/JAMES-3742</link>
                <project id="10411" key="JAMES">James Server</project>
                    <description>&lt;p&gt;We are using James to forward mails from external email servers to customer accounts.&lt;/p&gt;

&lt;p&gt;Some email clients create emails with the following headers:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Mime-Version: 1.0 (Mac OS X Mail 15.0 \(3693.60.0.1.1\))
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
&#160; &#160; &#160; &#160; d=xxxx.gappssmtp.com; s=20210112;
&#160; &#160; &#160; &#160; h=from:content-transfer-encoding:mime-version:subject:message-id:date:to;
&#160; &#160; &#160; &#160; bh=...;
&#160; &#160; &#160; &#160; b=...&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So the message is signed by the originator including the &lt;tt&gt;Mime-Version&lt;/tt&gt; header. The problem is that if we set an additional header with&#160;&lt;tt&gt;SetMimeHeaderHandler&lt;/tt&gt; or invoke the SpamAssassin service then the method &lt;tt&gt;MimeMessage.updateHeaders()&lt;/tt&gt; is invoked which sets a new mime version header:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;MIME-Version: 1.0&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;thereby breaking the DKIM signature from the original sender. We can add our own signature using the new header, but this isn&apos;t aligned with the sender domain so it doesn&apos;t help. It&apos;s probably debatable whether the original Mac mail client mime version header is valid, but it is what it is.&lt;/p&gt;

&lt;p&gt;This seems to be completely broken, but the behaviour is baked into the &lt;tt&gt;MimeMessage&lt;/tt&gt; class and we can&apos;t see any way around it. How can we preserve the original mime-version header and the DKIM signature?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13438003">JAMES-3742</key>
            <summary>MIME-Version header is changed, breaking DKIM signatures</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="paulch">Paul Chown</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 Apr 2022 21:39:16 +0000</created>
                <updated>Fri, 14 Jun 2024 07:32:13 +0000</updated>
                            <resolved>Fri, 14 Jun 2024 07:32:13 +0000</resolved>
                                    <version>2.3.2</version>
                                    <fixVersion>3.9.0</fixVersion>
                                    <component>James Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="17517905" author="btellier" created="Wed, 6 Apr 2022 07:31:11 +0000"  >&lt;p&gt;Hello. Integresting.&lt;/p&gt;

&lt;p&gt;Then of course we should try to get SpamAssassin mailet not to alter this header.&lt;/p&gt;

&lt;p&gt;Contribution welcomed!&lt;/p&gt;

&lt;p&gt;Cheers,&lt;/p&gt;

&lt;p&gt;Benoit&lt;/p&gt;</comment>
                            <comment id="17518034" author="JIRAUSER287643" created="Wed, 6 Apr 2022 11:02:04 +0000"  >&lt;p&gt;Hi Benoit,&lt;/p&gt;

&lt;p&gt;any ideas about how that might be done? There&apos;s a lot going on in MimeMessage and simply not calling saveChanges() doesn&apos;t seem to be a likely option, but as soon as you do that then the header is broken. MimeMessage is also used a lot, so I guess there must be some rationale behind this behaviour that I don&apos;t understand. I just find it hard to believe that we are the only ones with this problem...&lt;/p&gt;

&lt;p&gt;Cheers, Paul&lt;/p&gt;</comment>
                            <comment id="17518590" author="btellier" created="Thu, 7 Apr 2022 05:59:30 +0000"  >&lt;p&gt;James uses its own super class of mime messages: MimeMessageWrapper&lt;/p&gt;

&lt;p&gt;We could use it to override `updateHeaders` method NOT to alter the mime version if present?&lt;/p&gt;
</comment>
                            <comment id="17518810" author="JIRAUSER287643" created="Thu, 7 Apr 2022 11:25:59 +0000"  >&lt;p&gt;Super, thanks! I missed that you have your own superclass. I added a copy of this class to our project and patched the setHeader() method:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; MIME_VERSION_HEADER = &lt;span class=&quot;code-quote&quot;&gt;&quot;MIME-Version&quot;&lt;/span&gt;; 

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setHeader(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; value) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; MessagingException {
    checkModifyHeaders();
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!name.equals(MIME_VERSION_HEADER) || getHeader(MIME_VERSION_HEADER) == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.setHeader(name, value);
    }
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;That fixes our problem.&lt;/p&gt;</comment>
                            <comment id="17519256" author="btellier" created="Fri, 8 Apr 2022 01:28:24 +0000"  >&lt;p&gt;While I&apos;m happy it solved your problem, bypassing user input could be controversial: there might be legitimate reasons to set the MIME-Version header, and with this fix we completly forbid this. Our problem here is implicit changes, not the explicit ones...&lt;/p&gt;</comment>
                            <comment id="17851682" author="btellier" created="Mon, 3 Jun 2024 15:01:32 +0000"  >&lt;p&gt;2 years of inactivity on this important topic.&lt;/p&gt;

&lt;p&gt;I propose to move forward, implement the proposed change AND add a system variable in order to allow bypassing this just in case someone find a legitimate reason to change mime versions...&lt;/p&gt;

&lt;p&gt;We could further improve the proposed code in order to check the mime version is 1.0 with optional comment. and not set it again if this is 1.0.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 22 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z116tc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>