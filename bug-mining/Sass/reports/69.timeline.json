[{"url":"https://api.github.com/repos/sass/sass/issues/comments/1552017830","html_url":"https://github.com/sass/sass/issues/3579#issuecomment-1552017830","issue_url":"https://api.github.com/repos/sass/sass/issues/3579","id":1552017830,"node_id":"IC_kwDOAA4wNc5cgemm","user":{"login":"ntkme","id":899645,"node_id":"MDQ6VXNlcjg5OTY0NQ==","avatar_url":"https://avatars.githubusercontent.com/u/899645?v=4","gravatar_id":"","url":"https://api.github.com/users/ntkme","html_url":"https://github.com/ntkme","followers_url":"https://api.github.com/users/ntkme/followers","following_url":"https://api.github.com/users/ntkme/following{/other_user}","gists_url":"https://api.github.com/users/ntkme/gists{/gist_id}","starred_url":"https://api.github.com/users/ntkme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ntkme/subscriptions","organizations_url":"https://api.github.com/users/ntkme/orgs","repos_url":"https://api.github.com/users/ntkme/repos","events_url":"https://api.github.com/users/ntkme/events{/privacy}","received_events_url":"https://api.github.com/users/ntkme/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-21T16:28:10Z","updated_at":"2023-04-21T16:28:46Z","body":"More specifically, these can be removed and replaced with a single `session_id` on wire:\r\n\r\n- CompileRequest.id\r\n- VersionRequest.id\r\n- ProtocolError.id\r\n- CompileResponse.id\r\n- VersionResponse.id\r\n- LogEvent.compilation_id\r\n- CanonicalizeRequest.compilation_id\r\n- ImportRequest.compilation_id\r\n- FileImportRequest.compilation_id\r\n- FunctionCallRequest.compilation_id\r\n\r\nThese should remain, to reserve the potential of a compiler implementation sending multiple of same kind concurrently in a single compilation:\r\n- CanonicalizeRequest.id\r\n- ImportRequest.id\r\n- FileImportRequest.id\r\n- FunctionCallRequest.id\r\n- CanonicalizeResponse.id\r\n- ImportResponse.id\r\n- FileImportResponse.id\r\n- FunctionCallResponse.id","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sass/sass/issues/comments/1552017830/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ntkme","id":899645,"node_id":"MDQ6VXNlcjg5OTY0NQ==","avatar_url":"https://avatars.githubusercontent.com/u/899645?v=4","gravatar_id":"","url":"https://api.github.com/users/ntkme","html_url":"https://github.com/ntkme","followers_url":"https://api.github.com/users/ntkme/followers","following_url":"https://api.github.com/users/ntkme/following{/other_user}","gists_url":"https://api.github.com/users/ntkme/gists{/gist_id}","starred_url":"https://api.github.com/users/ntkme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ntkme/subscriptions","organizations_url":"https://api.github.com/users/ntkme/orgs","repos_url":"https://api.github.com/users/ntkme/repos","events_url":"https://api.github.com/users/ntkme/events{/privacy}","received_events_url":"https://api.github.com/users/ntkme/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sass/sass/issues/comments/1552017838","html_url":"https://github.com/sass/sass/issues/3579#issuecomment-1552017838","issue_url":"https://api.github.com/repos/sass/sass/issues/3579","id":1552017838,"node_id":"IC_kwDOAA4wNc5cgemu","user":{"login":"nex3","id":188,"node_id":"MDQ6VXNlcjE4OA==","avatar_url":"https://avatars.githubusercontent.com/u/188?v=4","gravatar_id":"","url":"https://api.github.com/users/nex3","html_url":"https://github.com/nex3","followers_url":"https://api.github.com/users/nex3/followers","following_url":"https://api.github.com/users/nex3/following{/other_user}","gists_url":"https://api.github.com/users/nex3/gists{/gist_id}","starred_url":"https://api.github.com/users/nex3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nex3/subscriptions","organizations_url":"https://api.github.com/users/nex3/orgs","repos_url":"https://api.github.com/users/nex3/repos","events_url":"https://api.github.com/users/nex3/events{/privacy}","received_events_url":"https://api.github.com/users/nex3/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-21T22:51:40Z","updated_at":"2023-04-21T22:51:40Z","body":"I was hoping we could extract this information from the serialized protobuf directly, but since [field order isn't guaranteed](https://protobuf.dev/programming-guides/encoding/#order) I guess that's not safe. This is probably the next best option.\r\n\r\nWe should bear in mind the possibility of https://github.com/sass/sass/issues/2745 as we design this. That is, we may want to have the ability to ensure that multiple compilations take place within the same compiler thread. We could _potentially_ track this separately, but that would complicate the compiler's ability to multiplex new compilation requests.\r\n\r\nOne possibility would be to preserve all the existing `id` fields and just declare (for now) that `IncomingRequest`s must have an `id` field that matches their `session_id`.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sass/sass/issues/comments/1552017838/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"nex3","id":188,"node_id":"MDQ6VXNlcjE4OA==","avatar_url":"https://avatars.githubusercontent.com/u/188?v=4","gravatar_id":"","url":"https://api.github.com/users/nex3","html_url":"https://github.com/nex3","followers_url":"https://api.github.com/users/nex3/followers","following_url":"https://api.github.com/users/nex3/following{/other_user}","gists_url":"https://api.github.com/users/nex3/gists{/gist_id}","starred_url":"https://api.github.com/users/nex3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nex3/subscriptions","organizations_url":"https://api.github.com/users/nex3/orgs","repos_url":"https://api.github.com/users/nex3/repos","events_url":"https://api.github.com/users/nex3/events{/privacy}","received_events_url":"https://api.github.com/users/nex3/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sass/sass/issues/comments/1552017853","html_url":"https://github.com/sass/sass/issues/3579#issuecomment-1552017853","issue_url":"https://api.github.com/repos/sass/sass/issues/3579","id":1552017853,"node_id":"IC_kwDOAA4wNc5cgem9","user":{"login":"ntkme","id":899645,"node_id":"MDQ6VXNlcjg5OTY0NQ==","avatar_url":"https://avatars.githubusercontent.com/u/899645?v=4","gravatar_id":"","url":"https://api.github.com/users/ntkme","html_url":"https://github.com/ntkme","followers_url":"https://api.github.com/users/ntkme/followers","following_url":"https://api.github.com/users/ntkme/following{/other_user}","gists_url":"https://api.github.com/users/ntkme/gists{/gist_id}","starred_url":"https://api.github.com/users/ntkme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ntkme/subscriptions","organizations_url":"https://api.github.com/users/ntkme/orgs","repos_url":"https://api.github.com/users/ntkme/repos","events_url":"https://api.github.com/users/ntkme/events{/privacy}","received_events_url":"https://api.github.com/users/ntkme/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-21T23:20:33Z","updated_at":"2023-04-21T23:20:33Z","body":"> One possibility would be to preserve all the existing id fields and just declare (for now) that IncomingRequests must have an id field that matches their session_id.\r\n\r\nThat is a good migration path. We can feature flag dart-sass-embedded to accept and send `session_id` on wire, which developers can opt-in.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sass/sass/issues/comments/1552017853/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ntkme","id":899645,"node_id":"MDQ6VXNlcjg5OTY0NQ==","avatar_url":"https://avatars.githubusercontent.com/u/899645?v=4","gravatar_id":"","url":"https://api.github.com/users/ntkme","html_url":"https://github.com/ntkme","followers_url":"https://api.github.com/users/ntkme/followers","following_url":"https://api.github.com/users/ntkme/following{/other_user}","gists_url":"https://api.github.com/users/ntkme/gists{/gist_id}","starred_url":"https://api.github.com/users/ntkme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ntkme/subscriptions","organizations_url":"https://api.github.com/users/ntkme/orgs","repos_url":"https://api.github.com/users/ntkme/repos","events_url":"https://api.github.com/users/ntkme/events{/privacy}","received_events_url":"https://api.github.com/users/ntkme/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sass/sass/issues/comments/1552017864","html_url":"https://github.com/sass/sass/issues/3579#issuecomment-1552017864","issue_url":"https://api.github.com/repos/sass/sass/issues/3579","id":1552017864,"node_id":"IC_kwDOAA4wNc5cgenI","user":{"login":"ntkme","id":899645,"node_id":"MDQ6VXNlcjg5OTY0NQ==","avatar_url":"https://avatars.githubusercontent.com/u/899645?v=4","gravatar_id":"","url":"https://api.github.com/users/ntkme","html_url":"https://github.com/ntkme","followers_url":"https://api.github.com/users/ntkme/followers","following_url":"https://api.github.com/users/ntkme/following{/other_user}","gists_url":"https://api.github.com/users/ntkme/gists{/gist_id}","starred_url":"https://api.github.com/users/ntkme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ntkme/subscriptions","organizations_url":"https://api.github.com/users/ntkme/orgs","repos_url":"https://api.github.com/users/ntkme/repos","events_url":"https://api.github.com/users/ntkme/events{/privacy}","received_events_url":"https://api.github.com/users/ntkme/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-22T19:12:28Z","updated_at":"2023-04-22T19:12:28Z","body":">  That is, we may want to have the ability to ensure that multiple compilations take place within the same compiler thread.\r\n\r\nThis is more of an issue due to lack of shared memory across isolates in Dart. If we can find a way to share data across isolates, this can potentially be solved differently. Read-write access across isolates would be better, but even with read-only shared data it can work to some degree. E.g. The main isolates owns a shared cache. All isolates can read from the shared cache. When worker isolates mutate the shared cache, they commit to a thread-local cache first, then thread-local cache can be asynchronously send back to main isolate for a persisted commit to the shared cache.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sass/sass/issues/comments/1552017864/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ntkme","id":899645,"node_id":"MDQ6VXNlcjg5OTY0NQ==","avatar_url":"https://avatars.githubusercontent.com/u/899645?v=4","gravatar_id":"","url":"https://api.github.com/users/ntkme","html_url":"https://github.com/ntkme","followers_url":"https://api.github.com/users/ntkme/followers","following_url":"https://api.github.com/users/ntkme/following{/other_user}","gists_url":"https://api.github.com/users/ntkme/gists{/gist_id}","starred_url":"https://api.github.com/users/ntkme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ntkme/subscriptions","organizations_url":"https://api.github.com/users/ntkme/orgs","repos_url":"https://api.github.com/users/ntkme/repos","events_url":"https://api.github.com/users/ntkme/events{/privacy}","received_events_url":"https://api.github.com/users/ntkme/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"ntkme","id":899645,"node_id":"MDQ6VXNlcjg5OTY0NQ==","avatar_url":"https://avatars.githubusercontent.com/u/899645?v=4","gravatar_id":"","url":"https://api.github.com/users/ntkme","html_url":"https://github.com/ntkme","followers_url":"https://api.github.com/users/ntkme/followers","following_url":"https://api.github.com/users/ntkme/following{/other_user}","gists_url":"https://api.github.com/users/ntkme/gists{/gist_id}","starred_url":"https://api.github.com/users/ntkme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ntkme/subscriptions","organizations_url":"https://api.github.com/users/ntkme/orgs","repos_url":"https://api.github.com/users/ntkme/repos","events_url":"https://api.github.com/users/ntkme/events{/privacy}","received_events_url":"https://api.github.com/users/ntkme/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-24T22:11:15Z","updated_at":"2023-05-17T20:22:19Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/dart-lang/sdk/issues/52121","repository_url":"https://api.github.com/repos/dart-lang/sdk","labels_url":"https://api.github.com/repos/dart-lang/sdk/issues/52121/labels{/name}","comments_url":"https://api.github.com/repos/dart-lang/sdk/issues/52121/comments","events_url":"https://api.github.com/repos/dart-lang/sdk/issues/52121/events","html_url":"https://github.com/dart-lang/sdk/issues/52121","id":1678083682,"node_id":"I_kwDOAiEj5s5kBYZi","number":52121,"title":"[breaking change] Remove dart:cli waitFor experiment","user":{"login":"mraleph","id":131846,"node_id":"MDQ6VXNlcjEzMTg0Ng==","avatar_url":"https://avatars.githubusercontent.com/u/131846?v=4","gravatar_id":"","url":"https://api.github.com/users/mraleph","html_url":"https://github.com/mraleph","followers_url":"https://api.github.com/users/mraleph/followers","following_url":"https://api.github.com/users/mraleph/following{/other_user}","gists_url":"https://api.github.com/users/mraleph/gists{/gist_id}","starred_url":"https://api.github.com/users/mraleph/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mraleph/subscriptions","organizations_url":"https://api.github.com/users/mraleph/orgs","repos_url":"https://api.github.com/users/mraleph/repos","events_url":"https://api.github.com/users/mraleph/events{/privacy}","received_events_url":"https://api.github.com/users/mraleph/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":219928184,"node_id":"MDU6TGFiZWwyMTk5MjgxODQ=","url":"https://api.github.com/repos/dart-lang/sdk/labels/area-core-library","name":"area-core-library","color":"c7def8","default":false,"description":"SDK core library issues (core, async, ...); use area-vm or area-web for platform specific libraries."},{"id":1127949154,"node_id":"MDU6TGFiZWwxMTI3OTQ5MTU0","url":"https://api.github.com/repos/dart-lang/sdk/labels/breaking-change-request","name":"breaking-change-request","color":"f79d9b","default":false,"description":"This tracks requests for feedback on breaking changes"},{"id":3799264138,"node_id":"LA_kwDOAiEj5s7idCuK","url":"https://api.github.com/repos/dart-lang/sdk/labels/breaking-change-approved","name":"breaking-change-approved","color":"f9d0c4","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"mraleph","id":131846,"node_id":"MDQ6VXNlcjEzMTg0Ng==","avatar_url":"https://avatars.githubusercontent.com/u/131846?v=4","gravatar_id":"","url":"https://api.github.com/users/mraleph","html_url":"https://github.com/mraleph","followers_url":"https://api.github.com/users/mraleph/followers","following_url":"https://api.github.com/users/mraleph/following{/other_user}","gists_url":"https://api.github.com/users/mraleph/gists{/gist_id}","starred_url":"https://api.github.com/users/mraleph/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mraleph/subscriptions","organizations_url":"https://api.github.com/users/mraleph/orgs","repos_url":"https://api.github.com/users/mraleph/repos","events_url":"https://api.github.com/users/mraleph/events{/privacy}","received_events_url":"https://api.github.com/users/mraleph/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"mraleph","id":131846,"node_id":"MDQ6VXNlcjEzMTg0Ng==","avatar_url":"https://avatars.githubusercontent.com/u/131846?v=4","gravatar_id":"","url":"https://api.github.com/users/mraleph","html_url":"https://github.com/mraleph","followers_url":"https://api.github.com/users/mraleph/followers","following_url":"https://api.github.com/users/mraleph/following{/other_user}","gists_url":"https://api.github.com/users/mraleph/gists{/gist_id}","starred_url":"https://api.github.com/users/mraleph/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mraleph/subscriptions","organizations_url":"https://api.github.com/users/mraleph/orgs","repos_url":"https://api.github.com/users/mraleph/repos","events_url":"https://api.github.com/users/mraleph/events{/privacy}","received_events_url":"https://api.github.com/users/mraleph/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":60,"created_at":"2023-04-21T08:10:20Z","updated_at":"2024-04-03T04:58:48Z","closed_at":"2024-02-29T11:23:38Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":35726310,"node_id":"MDEwOlJlcG9zaXRvcnkzNTcyNjMxMA==","name":"sdk","full_name":"dart-lang/sdk","private":false,"owner":{"login":"dart-lang","id":1609975,"node_id":"MDEyOk9yZ2FuaXphdGlvbjE2MDk5NzU=","avatar_url":"https://avatars.githubusercontent.com/u/1609975?v=4","gravatar_id":"","url":"https://api.github.com/users/dart-lang","html_url":"https://github.com/dart-lang","followers_url":"https://api.github.com/users/dart-lang/followers","following_url":"https://api.github.com/users/dart-lang/following{/other_user}","gists_url":"https://api.github.com/users/dart-lang/gists{/gist_id}","starred_url":"https://api.github.com/users/dart-lang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dart-lang/subscriptions","organizations_url":"https://api.github.com/users/dart-lang/orgs","repos_url":"https://api.github.com/users/dart-lang/repos","events_url":"https://api.github.com/users/dart-lang/events{/privacy}","received_events_url":"https://api.github.com/users/dart-lang/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/dart-lang/sdk","description":"The Dart SDK, including the VM, JS and Wasm compilers, analysis, core libraries, and more.","fork":false,"url":"https://api.github.com/repos/dart-lang/sdk","forks_url":"https://api.github.com/repos/dart-lang/sdk/forks","keys_url":"https://api.github.com/repos/dart-lang/sdk/keys{/key_id}","collaborators_url":"https://api.github.com/repos/dart-lang/sdk/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/dart-lang/sdk/teams","hooks_url":"https://api.github.com/repos/dart-lang/sdk/hooks","issue_events_url":"https://api.github.com/repos/dart-lang/sdk/issues/events{/number}","events_url":"https://api.github.com/repos/dart-lang/sdk/events","assignees_url":"https://api.github.com/repos/dart-lang/sdk/assignees{/user}","branches_url":"https://api.github.com/repos/dart-lang/sdk/branches{/branch}","tags_url":"https://api.github.com/repos/dart-lang/sdk/tags","blobs_url":"https://api.github.com/repos/dart-lang/sdk/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/dart-lang/sdk/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/dart-lang/sdk/git/refs{/sha}","trees_url":"https://api.github.com/repos/dart-lang/sdk/git/trees{/sha}","statuses_url":"https://api.github.com/repos/dart-lang/sdk/statuses/{sha}","languages_url":"https://api.github.com/repos/dart-lang/sdk/languages","stargazers_url":"https://api.github.com/repos/dart-lang/sdk/stargazers","contributors_url":"https://api.github.com/repos/dart-lang/sdk/contributors","subscribers_url":"https://api.github.com/repos/dart-lang/sdk/subscribers","subscription_url":"https://api.github.com/repos/dart-lang/sdk/subscription","commits_url":"https://api.github.com/repos/dart-lang/sdk/commits{/sha}","git_commits_url":"https://api.github.com/repos/dart-lang/sdk/git/commits{/sha}","comments_url":"https://api.github.com/repos/dart-lang/sdk/comments{/number}","issue_comment_url":"https://api.github.com/repos/dart-lang/sdk/issues/comments{/number}","contents_url":"https://api.github.com/repos/dart-lang/sdk/contents/{+path}","compare_url":"https://api.github.com/repos/dart-lang/sdk/compare/{base}...{head}","merges_url":"https://api.github.com/repos/dart-lang/sdk/merges","archive_url":"https://api.github.com/repos/dart-lang/sdk/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/dart-lang/sdk/downloads","issues_url":"https://api.github.com/repos/dart-lang/sdk/issues{/number}","pulls_url":"https://api.github.com/repos/dart-lang/sdk/pulls{/number}","milestones_url":"https://api.github.com/repos/dart-lang/sdk/milestones{/number}","notifications_url":"https://api.github.com/repos/dart-lang/sdk/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/dart-lang/sdk/labels{/name}","releases_url":"https://api.github.com/repos/dart-lang/sdk/releases{/id}","deployments_url":"https://api.github.com/repos/dart-lang/sdk/deployments","created_at":"2015-05-16T14:14:58Z","updated_at":"2025-11-10T10:30:59Z","pushed_at":"2025-11-10T10:30:54Z","git_url":"git://github.com/dart-lang/sdk.git","ssh_url":"git@github.com:dart-lang/sdk.git","clone_url":"https://github.com/dart-lang/sdk.git","svn_url":"https://github.com/dart-lang/sdk","homepage":"https://dart.dev","size":1554553,"stargazers_count":10903,"watchers_count":10903,"language":"Dart","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":1707,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":8385,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause","node_id":"MDc6TGljZW5zZTU="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["dart","language","programming-language","sdk"],"visibility":"public","forks":1707,"open_issues":8385,"watchers":10903,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"### Change Intent\r\n\r\n`waitFor` contradicts Dart's event-loop model in a way that no other old or new feature does: it allows async and synchronous code to interleave. The feature has been marked experimental since the beginning and effectively has only two users: sass and dcli package.  It is not available in Flutter or on the Web because `dart:cli` library is not exposed there.\r\n\r\nSee discussion on https://github.com/dart-lang/sdk/issues/39390 for context. \r\n\r\n### Justification\r\n\r\nWe would like to reduce VM's technical debt by removing this experimental functionality, which we believe was added hastily and without due thought to the consequences. \r\n\r\nWe also have some indications (based on some internal code which has been migrated from `waitFor`) that availability of `waitFor` encourages ineffecient and convoluted coding patterns. \r\n\r\nIf you compare `waitFor` with `Finalizer` (which was added in 2.17) you will observe that we choose to make `Finalizer` less powerful by specifying that finalizers are only invoked at the turn of the event loop for the sake of maintaining semantic purity around interleaving of synchronous code.  \r\n\r\n### Impact\r\n\r\nCurrent users (which basically amounts to dcli and sass) will have to migrate off `waitFor` which will require them to rewrite their code.  \r\n\r\n### Mitigation\r\n\r\nBased on our analysis of dcli and sass multiple migration strategies are available: \r\n\r\n- The usage of asynchronous `dart:io` methods can be replaced with synchronous counterparts, eliminating the need for `waitFor`;\r\n- Asynchronous code can be moved to a helper isolate which communicates with the main isolate through synchronous communication channel built on top of low-level `dart:ffi` primitives;\r\n- Synchronous code be rewritten to become asynchronous, following Dart's canonical style for writing such code.\r\n\r\nNote that it is an explicit non-goal to provide a completely equivalent replacement for `waitFor`, because we believe the feature itself is incompatible with how Dart's async is designed and should be removed.  \r\n\r\n#### Synchronous communication over dart:ffi\r\n\r\nThis [code](https://gist.github.com/mraleph/71cb2c4a7d597c9a9f310f6edb2ef4e5) demonstrates how `dart:ffi` can be used to establish an entirely synchronous communication channel between the main (dispatcher) isolate and a worker isolate. This type of communication channel should cover sass needs. \r\n\r\nTo make migration simpler we will provide a portable synchronization package which implements mutexes and conditional variables, though we leave implementation of cross-isolate communication channels to the developers. \r\n\r\n#### `Isolate.resolvePackageUri`\r\n\r\nSome minor users of `waitFor` use it to synchronously unwrap `Future` returned from `Isolate.resolvePackageUri` API. In reality the underlying implementation of `Isolate.resolvePackageUri` is [entirely synchronous](https://github.com/dart-lang/sdk/blob/a045aea9bc9976a33512f96818c083518cfca087/sdk/lib/_internal/vm/bin/builtin.dart#L607-L634). \r\n\r\nWhile there is migration path for this code using `dart:ffi` and isolates we can simplify things by directly exposing `Isolate.resolvePackageUriSync(...)` and deprecating async version of this API.\r\n\r\n### Timeline\r\n\r\nThe removal will follow this timeline:\r\n\r\n* Dart 2.15: The `waitFor`feature was marked deprecated\r\n* Dart 3.0: We announce the upcoming removal, offering ~1 year migration timeline\r\n* Dart 3.3: `waitFor` is now disabled by default, but can be temporarily enabled by passing the flag `--enable_deprecated_wait_for` to the VM / `dart` command\r\n* Dart 3.4: We'll fully remove `waitFor` and there will be no way of enabling it\r\n","reactions":{"url":"https://api.github.com/repos/dart-lang/sdk/issues/52121/reactions","total_count":9,"+1":7,"-1":0,"laugh":0,"hooray":0,"confused":2,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/dart-lang/sdk/issues/52121/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"id":9273402425,"node_id":"AE_lADOAA4wNc5mMswkzwAAAAIovOQ5","url":"https://api.github.com/repos/sass/sass/issues/events/9273402425","actor":{"login":"nex3","id":188,"node_id":"MDQ6VXNlcjE4OA==","avatar_url":"https://avatars.githubusercontent.com/u/188?v=4","gravatar_id":"","url":"https://api.github.com/users/nex3","html_url":"https://github.com/nex3","followers_url":"https://api.github.com/users/nex3/followers","following_url":"https://api.github.com/users/nex3/following{/other_user}","gists_url":"https://api.github.com/users/nex3/gists{/gist_id}","starred_url":"https://api.github.com/users/nex3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nex3/subscriptions","organizations_url":"https://api.github.com/users/nex3/orgs","repos_url":"https://api.github.com/users/nex3/repos","events_url":"https://api.github.com/users/nex3/events{/privacy}","received_events_url":"https://api.github.com/users/nex3/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2023-04-25T20:20:21Z","assignee":{"login":"nex3","id":188,"node_id":"MDQ6VXNlcjE4OA==","avatar_url":"https://avatars.githubusercontent.com/u/188?v=4","gravatar_id":"","url":"https://api.github.com/users/nex3","html_url":"https://github.com/nex3","followers_url":"https://api.github.com/users/nex3/followers","following_url":"https://api.github.com/users/nex3/following{/other_user}","gists_url":"https://api.github.com/users/nex3/gists{/gist_id}","starred_url":"https://api.github.com/users/nex3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nex3/subscriptions","organizations_url":"https://api.github.com/users/nex3/orgs","repos_url":"https://api.github.com/users/nex3/repos","events_url":"https://api.github.com/users/nex3/events{/privacy}","received_events_url":"https://api.github.com/users/nex3/received_events","type":"User","user_view_type":"public","site_admin":false},"performed_via_github_app":null},{"url":"https://api.github.com/repos/sass/sass/issues/comments/1552017879","html_url":"https://github.com/sass/sass/issues/3579#issuecomment-1552017879","issue_url":"https://api.github.com/repos/sass/sass/issues/3579","id":1552017879,"node_id":"IC_kwDOAA4wNc5cgenX","user":{"login":"nex3","id":188,"node_id":"MDQ6VXNlcjE4OA==","avatar_url":"https://avatars.githubusercontent.com/u/188?v=4","gravatar_id":"","url":"https://api.github.com/users/nex3","html_url":"https://github.com/nex3","followers_url":"https://api.github.com/users/nex3/followers","following_url":"https://api.github.com/users/nex3/following{/other_user}","gists_url":"https://api.github.com/users/nex3/gists{/gist_id}","starred_url":"https://api.github.com/users/nex3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nex3/subscriptions","organizations_url":"https://api.github.com/users/nex3/orgs","repos_url":"https://api.github.com/users/nex3/repos","events_url":"https://api.github.com/users/nex3/events{/privacy}","received_events_url":"https://api.github.com/users/nex3/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-25T21:39:28Z","updated_at":"2023-04-25T21:39:28Z","body":"That's true, I could imagine a situation where we want parallel compilation that still share state with one another. It seems quite tricky to handle given that for a lot of entrypoints almost everything will be cacheable, but it's certainly not impossible.\r\n\r\nIn that case, maybe we should explicitly make the wire-level ID a compilation ID, and plan to have a separate session ID in the `CompileRequest`. That does raise a question for what to do with `VersionRequest`, but we could potentially reserve ID 0 for that. WDYT?","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sass/sass/issues/comments/1552017879/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"nex3","id":188,"node_id":"MDQ6VXNlcjE4OA==","avatar_url":"https://avatars.githubusercontent.com/u/188?v=4","gravatar_id":"","url":"https://api.github.com/users/nex3","html_url":"https://github.com/nex3","followers_url":"https://api.github.com/users/nex3/followers","following_url":"https://api.github.com/users/nex3/following{/other_user}","gists_url":"https://api.github.com/users/nex3/gists{/gist_id}","starred_url":"https://api.github.com/users/nex3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nex3/subscriptions","organizations_url":"https://api.github.com/users/nex3/orgs","repos_url":"https://api.github.com/users/nex3/repos","events_url":"https://api.github.com/users/nex3/events{/privacy}","received_events_url":"https://api.github.com/users/nex3/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sass/sass/issues/comments/1552017889","html_url":"https://github.com/sass/sass/issues/3579#issuecomment-1552017889","issue_url":"https://api.github.com/repos/sass/sass/issues/3579","id":1552017889,"node_id":"IC_kwDOAA4wNc5cgenh","user":{"login":"ntkme","id":899645,"node_id":"MDQ6VXNlcjg5OTY0NQ==","avatar_url":"https://avatars.githubusercontent.com/u/899645?v=4","gravatar_id":"","url":"https://api.github.com/users/ntkme","html_url":"https://github.com/ntkme","followers_url":"https://api.github.com/users/ntkme/followers","following_url":"https://api.github.com/users/ntkme/following{/other_user}","gists_url":"https://api.github.com/users/ntkme/gists{/gist_id}","starred_url":"https://api.github.com/users/ntkme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ntkme/subscriptions","organizations_url":"https://api.github.com/users/ntkme/orgs","repos_url":"https://api.github.com/users/ntkme/repos","events_url":"https://api.github.com/users/ntkme/events{/privacy}","received_events_url":"https://api.github.com/users/ntkme/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-25T23:23:54Z","updated_at":"2023-04-25T23:35:34Z","body":"I think we're having different interpretation on `session_id`:\r\n\r\n- My original interpretation of `session_id` is that a session is a single end-to-end \"conversation\": E.g. a CompilationRequest to CompilationResponse, or a VersionRequest to VersionResponse.\r\n- If I understand correctly, your interpretation seems to be more of a worker affinity concept. At least with the current limitations, cache affinity has to be implemented as worker (isolate) affinity in dart.\r\n\r\nWith your interpretation of worker affinity, I think we can call the `session_id` as `worker_id`. We can even keep the current proto definition as is without change, and just have a top level `worker_id`. - We don't really need to reserve a wire id for handling `VersionRequest` on main isolate. We can just hand it off to a worker like `CompilationRequest` - it is a low frequency use case where the performance cost of handling it off likely does not matter.\r\n\r\nIn other words, no changes to current proto definition at all, just a change to wire encoding as:\r\n\r\n```\r\n[ varint worker_id ][ varint proto_length ][ proto ]\r\n```\r\n\r\nSpecially, the `worker_id` controls the affinity of worker/isolate/thread. Requests sent with same `worker_id` will always be processed by the same worker on the compiler side.\r\n\r\nIf we go with this explicit approach, we need to think about lifecycle of workers:\r\n- They can get created on-demand, but how do we terminate.\r\n  - Do we keep them forever until process is terminated?\r\n  - Do we kill a worker if idling for too long?\r\n  - Do we need an explicit API for managing workers?\r\n\r\nMy take is that we go with the simplest option that we keep created workers until process is terminated. - Host implementation can make the judgement of when to cleanup.\r\n\r\n---\r\n\r\n**However,**\r\n\r\nThe real big issue of worker affinity idea is execution order. In this implementation we would allow enqueuing of multiple CompilationRequests to a single worker. Imagining we have a synchronous compilation A which contains a custom JS function. The JS function starts a synchronous compilation B asking to run on the same worker. We can deadlock a worker with FIFO order. LIFO, on the other hand, risks back into stack overflow, which was part of the reasons we land here.\r\n\r\nThis complexity of worker affinity is why I was thinking to use `session_id` to represent each single end-to-end \"conversation\" between host and compiler. In that design, no concurrent duplicated `session_id` are allowed. There is no queuing, everything runs concurrently. - It is much simpler than worker affinity and does not have the queuing and execution order issue, but obviously, supporting shared cache would be difficult in this model.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sass/sass/issues/comments/1552017889/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ntkme","id":899645,"node_id":"MDQ6VXNlcjg5OTY0NQ==","avatar_url":"https://avatars.githubusercontent.com/u/899645?v=4","gravatar_id":"","url":"https://api.github.com/users/ntkme","html_url":"https://github.com/ntkme","followers_url":"https://api.github.com/users/ntkme/followers","following_url":"https://api.github.com/users/ntkme/following{/other_user}","gists_url":"https://api.github.com/users/ntkme/gists{/gist_id}","starred_url":"https://api.github.com/users/ntkme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ntkme/subscriptions","organizations_url":"https://api.github.com/users/ntkme/orgs","repos_url":"https://api.github.com/users/ntkme/repos","events_url":"https://api.github.com/users/ntkme/events{/privacy}","received_events_url":"https://api.github.com/users/ntkme/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sass/sass/issues/comments/1552017901","html_url":"https://github.com/sass/sass/issues/3579#issuecomment-1552017901","issue_url":"https://api.github.com/repos/sass/sass/issues/3579","id":1552017901,"node_id":"IC_kwDOAA4wNc5cgent","user":{"login":"nex3","id":188,"node_id":"MDQ6VXNlcjE4OA==","avatar_url":"https://avatars.githubusercontent.com/u/188?v=4","gravatar_id":"","url":"https://api.github.com/users/nex3","html_url":"https://github.com/nex3","followers_url":"https://api.github.com/users/nex3/followers","following_url":"https://api.github.com/users/nex3/following{/other_user}","gists_url":"https://api.github.com/users/nex3/gists{/gist_id}","starred_url":"https://api.github.com/users/nex3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nex3/subscriptions","organizations_url":"https://api.github.com/users/nex3/orgs","repos_url":"https://api.github.com/users/nex3/repos","events_url":"https://api.github.com/users/nex3/events{/privacy}","received_events_url":"https://api.github.com/users/nex3/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-25T23:37:19Z","updated_at":"2023-05-15T22:15:03Z","body":"I didn't mean to imply that the wire ID would be tightly semantically tied to workers. Rather, I meant that it would be tied to a single compilation—essentially the same as your idea of `session_id`, but _not_ generalized to all incoming requests.\r\n\r\nYou're right that it's unlikely to be a performance issue in practice to have `VersionRequest` allocate its own isolate, but it's hard to predict what additional compiler requests we'll want in the future. For example, I could imagine giving the host more fine-grained control over the parallelism in the compiler via incoming requests, or the ability to monitor build metrics, in which case we'd probably want a way to easily disambiguate those lightweight requests to the central control from the heavyweight compile requests that need parallelism. Carving out a wire ID for \"things that aren't compile requests\" leaves that door open, while still allowing us to expand the wire ID system beyond compile requests in the future if we do find additional incoming requests that need parallelism.\r\n\r\nTo summarize, here's my proposal:\r\n\r\n* We add a wire ID as described.\r\n* We remove `Compile{Request,Response}.id` and `*.compilation_id` and just use this wire ID instead.\r\n* We reserve the wire ID 0 for `VersionRequest`s and potential future compilation-independent incoming requests.\r\n* We forbid re-using the wire ID for an outstanding `CompileRequest`. This avoids the execution order issues you've described.\r\n\r\nSemantically, the wire ID isn't any different than the compilation ID is today—it doesn't intrinsically map to workers or threads. It's just defined in such a way that a host can efficiently parallelize it as an implementation detail. ","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sass/sass/issues/comments/1552017901/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"nex3","id":188,"node_id":"MDQ6VXNlcjE4OA==","avatar_url":"https://avatars.githubusercontent.com/u/188?v=4","gravatar_id":"","url":"https://api.github.com/users/nex3","html_url":"https://github.com/nex3","followers_url":"https://api.github.com/users/nex3/followers","following_url":"https://api.github.com/users/nex3/following{/other_user}","gists_url":"https://api.github.com/users/nex3/gists{/gist_id}","starred_url":"https://api.github.com/users/nex3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nex3/subscriptions","organizations_url":"https://api.github.com/users/nex3/orgs","repos_url":"https://api.github.com/users/nex3/repos","events_url":"https://api.github.com/users/nex3/events{/privacy}","received_events_url":"https://api.github.com/users/nex3/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sass/sass/issues/comments/1552017915","html_url":"https://github.com/sass/sass/issues/3579#issuecomment-1552017915","issue_url":"https://api.github.com/repos/sass/sass/issues/3579","id":1552017915,"node_id":"IC_kwDOAA4wNc5cgen7","user":{"login":"ntkme","id":899645,"node_id":"MDQ6VXNlcjg5OTY0NQ==","avatar_url":"https://avatars.githubusercontent.com/u/899645?v=4","gravatar_id":"","url":"https://api.github.com/users/ntkme","html_url":"https://github.com/ntkme","followers_url":"https://api.github.com/users/ntkme/followers","following_url":"https://api.github.com/users/ntkme/following{/other_user}","gists_url":"https://api.github.com/users/ntkme/gists{/gist_id}","starred_url":"https://api.github.com/users/ntkme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ntkme/subscriptions","organizations_url":"https://api.github.com/users/ntkme/orgs","repos_url":"https://api.github.com/users/ntkme/repos","events_url":"https://api.github.com/users/ntkme/events{/privacy}","received_events_url":"https://api.github.com/users/ntkme/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-25T23:41:54Z","updated_at":"2023-04-25T23:41:54Z","body":"@nex3 Your proposal sounds good to me.\r\n\r\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sass/sass/issues/comments/1552017915/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ntkme","id":899645,"node_id":"MDQ6VXNlcjg5OTY0NQ==","avatar_url":"https://avatars.githubusercontent.com/u/899645?v=4","gravatar_id":"","url":"https://api.github.com/users/ntkme","html_url":"https://github.com/ntkme","followers_url":"https://api.github.com/users/ntkme/followers","following_url":"https://api.github.com/users/ntkme/following{/other_user}","gists_url":"https://api.github.com/users/ntkme/gists{/gist_id}","starred_url":"https://api.github.com/users/ntkme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ntkme/subscriptions","organizations_url":"https://api.github.com/users/ntkme/orgs","repos_url":"https://api.github.com/users/ntkme/repos","events_url":"https://api.github.com/users/ntkme/events{/privacy}","received_events_url":"https://api.github.com/users/ntkme/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":9273402447,"node_id":"MEE_lADOAA4wNc5mMswkzwAAAAIovORP","url":"https://api.github.com/repos/sass/sass/issues/events/9273402447","actor":{"login":"nex3","id":188,"node_id":"MDQ6VXNlcjE4OA==","avatar_url":"https://avatars.githubusercontent.com/u/188?v=4","gravatar_id":"","url":"https://api.github.com/users/nex3","html_url":"https://github.com/nex3","followers_url":"https://api.github.com/users/nex3/followers","following_url":"https://api.github.com/users/nex3/following{/other_user}","gists_url":"https://api.github.com/users/nex3/gists{/gist_id}","starred_url":"https://api.github.com/users/nex3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nex3/subscriptions","organizations_url":"https://api.github.com/users/nex3/orgs","repos_url":"https://api.github.com/users/nex3/repos","events_url":"https://api.github.com/users/nex3/events{/privacy}","received_events_url":"https://api.github.com/users/nex3/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-04-25T23:41:54Z","performed_via_github_app":null},{"id":9273402466,"node_id":"SE_lADOAA4wNc5mMswkzwAAAAIovORi","url":"https://api.github.com/repos/sass/sass/issues/events/9273402466","actor":{"login":"nex3","id":188,"node_id":"MDQ6VXNlcjE4OA==","avatar_url":"https://avatars.githubusercontent.com/u/188?v=4","gravatar_id":"","url":"https://api.github.com/users/nex3","html_url":"https://github.com/nex3","followers_url":"https://api.github.com/users/nex3/followers","following_url":"https://api.github.com/users/nex3/following{/other_user}","gists_url":"https://api.github.com/users/nex3/gists{/gist_id}","starred_url":"https://api.github.com/users/nex3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nex3/subscriptions","organizations_url":"https://api.github.com/users/nex3/orgs","repos_url":"https://api.github.com/users/nex3/repos","events_url":"https://api.github.com/users/nex3/events{/privacy}","received_events_url":"https://api.github.com/users/nex3/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-04-25T23:41:55Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/sass/sass/issues/comments/1552017922","html_url":"https://github.com/sass/sass/issues/3579#issuecomment-1552017922","issue_url":"https://api.github.com/repos/sass/sass/issues/3579","id":1552017922,"node_id":"IC_kwDOAA4wNc5cgeoC","user":{"login":"ntkme","id":899645,"node_id":"MDQ6VXNlcjg5OTY0NQ==","avatar_url":"https://avatars.githubusercontent.com/u/899645?v=4","gravatar_id":"","url":"https://api.github.com/users/ntkme","html_url":"https://github.com/ntkme","followers_url":"https://api.github.com/users/ntkme/followers","following_url":"https://api.github.com/users/ntkme/following{/other_user}","gists_url":"https://api.github.com/users/ntkme/gists{/gist_id}","starred_url":"https://api.github.com/users/ntkme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ntkme/subscriptions","organizations_url":"https://api.github.com/users/ntkme/orgs","repos_url":"https://api.github.com/users/ntkme/repos","events_url":"https://api.github.com/users/ntkme/events{/privacy}","received_events_url":"https://api.github.com/users/ntkme/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-25T23:46:19Z","updated_at":"2023-04-25T23:46:19Z","body":"Pinging maintainers of other known host implementations for comments:\r\n\r\n@ahabhgk (https://github.com/ahabhgk/sass-embedded-host-rust)\r\n@bep (https://github.com/bep/godartsass)\r\n@johnfairh (https://github.com/johnfairh/swift-sass)\r\n@larsgrefer (https://github.com/larsgrefer/dart-sass-java)\r\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sass/sass/issues/comments/1552017922/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ntkme","id":899645,"node_id":"MDQ6VXNlcjg5OTY0NQ==","avatar_url":"https://avatars.githubusercontent.com/u/899645?v=4","gravatar_id":"","url":"https://api.github.com/users/ntkme","html_url":"https://github.com/ntkme","followers_url":"https://api.github.com/users/ntkme/followers","following_url":"https://api.github.com/users/ntkme/following{/other_user}","gists_url":"https://api.github.com/users/ntkme/gists{/gist_id}","starred_url":"https://api.github.com/users/ntkme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ntkme/subscriptions","organizations_url":"https://api.github.com/users/ntkme/orgs","repos_url":"https://api.github.com/users/ntkme/repos","events_url":"https://api.github.com/users/ntkme/events{/privacy}","received_events_url":"https://api.github.com/users/ntkme/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":9273402483,"node_id":"MEE_lADOAA4wNc5mMswkzwAAAAIovORz","url":"https://api.github.com/repos/sass/sass/issues/events/9273402483","actor":{"login":"bep","id":394382,"node_id":"MDQ6VXNlcjM5NDM4Mg==","avatar_url":"https://avatars.githubusercontent.com/u/394382?v=4","gravatar_id":"","url":"https://api.github.com/users/bep","html_url":"https://github.com/bep","followers_url":"https://api.github.com/users/bep/followers","following_url":"https://api.github.com/users/bep/following{/other_user}","gists_url":"https://api.github.com/users/bep/gists{/gist_id}","starred_url":"https://api.github.com/users/bep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bep/subscriptions","organizations_url":"https://api.github.com/users/bep/orgs","repos_url":"https://api.github.com/users/bep/repos","events_url":"https://api.github.com/users/bep/events{/privacy}","received_events_url":"https://api.github.com/users/bep/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-04-25T23:46:20Z","performed_via_github_app":null},{"id":9273402508,"node_id":"SE_lADOAA4wNc5mMswkzwAAAAIovOSM","url":"https://api.github.com/repos/sass/sass/issues/events/9273402508","actor":{"login":"bep","id":394382,"node_id":"MDQ6VXNlcjM5NDM4Mg==","avatar_url":"https://avatars.githubusercontent.com/u/394382?v=4","gravatar_id":"","url":"https://api.github.com/users/bep","html_url":"https://github.com/bep","followers_url":"https://api.github.com/users/bep/followers","following_url":"https://api.github.com/users/bep/following{/other_user}","gists_url":"https://api.github.com/users/bep/gists{/gist_id}","starred_url":"https://api.github.com/users/bep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bep/subscriptions","organizations_url":"https://api.github.com/users/bep/orgs","repos_url":"https://api.github.com/users/bep/repos","events_url":"https://api.github.com/users/bep/events{/privacy}","received_events_url":"https://api.github.com/users/bep/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-04-25T23:46:20Z","performed_via_github_app":null},{"id":9273402529,"node_id":"MEE_lADOAA4wNc5mMswkzwAAAAIovOSh","url":"https://api.github.com/repos/sass/sass/issues/events/9273402529","actor":{"login":"larsgrefer","id":6069961,"node_id":"MDQ6VXNlcjYwNjk5NjE=","avatar_url":"https://avatars.githubusercontent.com/u/6069961?v=4","gravatar_id":"","url":"https://api.github.com/users/larsgrefer","html_url":"https://github.com/larsgrefer","followers_url":"https://api.github.com/users/larsgrefer/followers","following_url":"https://api.github.com/users/larsgrefer/following{/other_user}","gists_url":"https://api.github.com/users/larsgrefer/gists{/gist_id}","starred_url":"https://api.github.com/users/larsgrefer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/larsgrefer/subscriptions","organizations_url":"https://api.github.com/users/larsgrefer/orgs","repos_url":"https://api.github.com/users/larsgrefer/repos","events_url":"https://api.github.com/users/larsgrefer/events{/privacy}","received_events_url":"https://api.github.com/users/larsgrefer/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-04-25T23:46:20Z","performed_via_github_app":null},{"id":9273402545,"node_id":"SE_lADOAA4wNc5mMswkzwAAAAIovOSx","url":"https://api.github.com/repos/sass/sass/issues/events/9273402545","actor":{"login":"larsgrefer","id":6069961,"node_id":"MDQ6VXNlcjYwNjk5NjE=","avatar_url":"https://avatars.githubusercontent.com/u/6069961?v=4","gravatar_id":"","url":"https://api.github.com/users/larsgrefer","html_url":"https://github.com/larsgrefer","followers_url":"https://api.github.com/users/larsgrefer/followers","following_url":"https://api.github.com/users/larsgrefer/following{/other_user}","gists_url":"https://api.github.com/users/larsgrefer/gists{/gist_id}","starred_url":"https://api.github.com/users/larsgrefer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/larsgrefer/subscriptions","organizations_url":"https://api.github.com/users/larsgrefer/orgs","repos_url":"https://api.github.com/users/larsgrefer/repos","events_url":"https://api.github.com/users/larsgrefer/events{/privacy}","received_events_url":"https://api.github.com/users/larsgrefer/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-04-25T23:46:20Z","performed_via_github_app":null},{"id":9273402553,"node_id":"MEE_lADOAA4wNc5mMswkzwAAAAIovOS5","url":"https://api.github.com/repos/sass/sass/issues/events/9273402553","actor":{"login":"johnfairh","id":26768470,"node_id":"MDQ6VXNlcjI2NzY4NDcw","avatar_url":"https://avatars.githubusercontent.com/u/26768470?v=4","gravatar_id":"","url":"https://api.github.com/users/johnfairh","html_url":"https://github.com/johnfairh","followers_url":"https://api.github.com/users/johnfairh/followers","following_url":"https://api.github.com/users/johnfairh/following{/other_user}","gists_url":"https://api.github.com/users/johnfairh/gists{/gist_id}","starred_url":"https://api.github.com/users/johnfairh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/johnfairh/subscriptions","organizations_url":"https://api.github.com/users/johnfairh/orgs","repos_url":"https://api.github.com/users/johnfairh/repos","events_url":"https://api.github.com/users/johnfairh/events{/privacy}","received_events_url":"https://api.github.com/users/johnfairh/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-04-25T23:46:20Z","performed_via_github_app":null},{"id":9273402567,"node_id":"SE_lADOAA4wNc5mMswkzwAAAAIovOTH","url":"https://api.github.com/repos/sass/sass/issues/events/9273402567","actor":{"login":"johnfairh","id":26768470,"node_id":"MDQ6VXNlcjI2NzY4NDcw","avatar_url":"https://avatars.githubusercontent.com/u/26768470?v=4","gravatar_id":"","url":"https://api.github.com/users/johnfairh","html_url":"https://github.com/johnfairh","followers_url":"https://api.github.com/users/johnfairh/followers","following_url":"https://api.github.com/users/johnfairh/following{/other_user}","gists_url":"https://api.github.com/users/johnfairh/gists{/gist_id}","starred_url":"https://api.github.com/users/johnfairh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/johnfairh/subscriptions","organizations_url":"https://api.github.com/users/johnfairh/orgs","repos_url":"https://api.github.com/users/johnfairh/repos","events_url":"https://api.github.com/users/johnfairh/events{/privacy}","received_events_url":"https://api.github.com/users/johnfairh/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-04-25T23:46:20Z","performed_via_github_app":null},{"id":9273402583,"node_id":"MEE_lADOAA4wNc5mMswkzwAAAAIovOTX","url":"https://api.github.com/repos/sass/sass/issues/events/9273402583","actor":{"login":"ahabhgk","id":42857895,"node_id":"MDQ6VXNlcjQyODU3ODk1","avatar_url":"https://avatars.githubusercontent.com/u/42857895?v=4","gravatar_id":"","url":"https://api.github.com/users/ahabhgk","html_url":"https://github.com/ahabhgk","followers_url":"https://api.github.com/users/ahabhgk/followers","following_url":"https://api.github.com/users/ahabhgk/following{/other_user}","gists_url":"https://api.github.com/users/ahabhgk/gists{/gist_id}","starred_url":"https://api.github.com/users/ahabhgk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ahabhgk/subscriptions","organizations_url":"https://api.github.com/users/ahabhgk/orgs","repos_url":"https://api.github.com/users/ahabhgk/repos","events_url":"https://api.github.com/users/ahabhgk/events{/privacy}","received_events_url":"https://api.github.com/users/ahabhgk/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-04-25T23:46:20Z","performed_via_github_app":null},{"id":9273402592,"node_id":"SE_lADOAA4wNc5mMswkzwAAAAIovOTg","url":"https://api.github.com/repos/sass/sass/issues/events/9273402592","actor":{"login":"ahabhgk","id":42857895,"node_id":"MDQ6VXNlcjQyODU3ODk1","avatar_url":"https://avatars.githubusercontent.com/u/42857895?v=4","gravatar_id":"","url":"https://api.github.com/users/ahabhgk","html_url":"https://github.com/ahabhgk","followers_url":"https://api.github.com/users/ahabhgk/followers","following_url":"https://api.github.com/users/ahabhgk/following{/other_user}","gists_url":"https://api.github.com/users/ahabhgk/gists{/gist_id}","starred_url":"https://api.github.com/users/ahabhgk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ahabhgk/subscriptions","organizations_url":"https://api.github.com/users/ahabhgk/orgs","repos_url":"https://api.github.com/users/ahabhgk/repos","events_url":"https://api.github.com/users/ahabhgk/events{/privacy}","received_events_url":"https://api.github.com/users/ahabhgk/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-04-25T23:46:20Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/sass/sass/issues/comments/1552017937","html_url":"https://github.com/sass/sass/issues/3579#issuecomment-1552017937","issue_url":"https://api.github.com/repos/sass/sass/issues/3579","id":1552017937,"node_id":"IC_kwDOAA4wNc5cgeoR","user":{"login":"johnfairh","id":26768470,"node_id":"MDQ6VXNlcjI2NzY4NDcw","avatar_url":"https://avatars.githubusercontent.com/u/26768470?v=4","gravatar_id":"","url":"https://api.github.com/users/johnfairh","html_url":"https://github.com/johnfairh","followers_url":"https://api.github.com/users/johnfairh/followers","following_url":"https://api.github.com/users/johnfairh/following{/other_user}","gists_url":"https://api.github.com/users/johnfairh/gists{/gist_id}","starred_url":"https://api.github.com/users/johnfairh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/johnfairh/subscriptions","organizations_url":"https://api.github.com/users/johnfairh/orgs","repos_url":"https://api.github.com/users/johnfairh/repos","events_url":"https://api.github.com/users/johnfairh/events{/privacy}","received_events_url":"https://api.github.com/users/johnfairh/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-26T15:59:57Z","updated_at":"2023-04-26T15:59:57Z","body":"Sounds fine to me.\r\n\r\nKeeping in mind 'Version' as a placeholder for 'Version and other slow-path commands that don't exist yet': we would keep `VersionRequest/Response.id` as today, as some [potentially] non-zero ID that is treated as part of the same 'must not overlap' namespace as the `CompilerRequest` 'wire ID's?","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sass/sass/issues/comments/1552017937/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"johnfairh","id":26768470,"node_id":"MDQ6VXNlcjI2NzY4NDcw","avatar_url":"https://avatars.githubusercontent.com/u/26768470?v=4","gravatar_id":"","url":"https://api.github.com/users/johnfairh","html_url":"https://github.com/johnfairh","followers_url":"https://api.github.com/users/johnfairh/followers","following_url":"https://api.github.com/users/johnfairh/following{/other_user}","gists_url":"https://api.github.com/users/johnfairh/gists{/gist_id}","starred_url":"https://api.github.com/users/johnfairh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/johnfairh/subscriptions","organizations_url":"https://api.github.com/users/johnfairh/orgs","repos_url":"https://api.github.com/users/johnfairh/repos","events_url":"https://api.github.com/users/johnfairh/events{/privacy}","received_events_url":"https://api.github.com/users/johnfairh/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sass/sass/issues/comments/1552017948","html_url":"https://github.com/sass/sass/issues/3579#issuecomment-1552017948","issue_url":"https://api.github.com/repos/sass/sass/issues/3579","id":1552017948,"node_id":"IC_kwDOAA4wNc5cgeoc","user":{"login":"bep","id":394382,"node_id":"MDQ6VXNlcjM5NDM4Mg==","avatar_url":"https://avatars.githubusercontent.com/u/394382?v=4","gravatar_id":"","url":"https://api.github.com/users/bep","html_url":"https://github.com/bep","followers_url":"https://api.github.com/users/bep/followers","following_url":"https://api.github.com/users/bep/following{/other_user}","gists_url":"https://api.github.com/users/bep/gists{/gist_id}","starred_url":"https://api.github.com/users/bep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bep/subscriptions","organizations_url":"https://api.github.com/users/bep/orgs","repos_url":"https://api.github.com/users/bep/repos","events_url":"https://api.github.com/users/bep/events{/privacy}","received_events_url":"https://api.github.com/users/bep/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-26T16:22:37Z","updated_at":"2023-04-26T16:22:37Z","body":"I don't see any real problems on my end (godartsass) -- other than some work, but if helps with performance, I'm always thumbs up.\r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sass/sass/issues/comments/1552017948/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"bep","id":394382,"node_id":"MDQ6VXNlcjM5NDM4Mg==","avatar_url":"https://avatars.githubusercontent.com/u/394382?v=4","gravatar_id":"","url":"https://api.github.com/users/bep","html_url":"https://github.com/bep","followers_url":"https://api.github.com/users/bep/followers","following_url":"https://api.github.com/users/bep/following{/other_user}","gists_url":"https://api.github.com/users/bep/gists{/gist_id}","starred_url":"https://api.github.com/users/bep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bep/subscriptions","organizations_url":"https://api.github.com/users/bep/orgs","repos_url":"https://api.github.com/users/bep/repos","events_url":"https://api.github.com/users/bep/events{/privacy}","received_events_url":"https://api.github.com/users/bep/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sass/sass/issues/comments/1552017960","html_url":"https://github.com/sass/sass/issues/3579#issuecomment-1552017960","issue_url":"https://api.github.com/repos/sass/sass/issues/3579","id":1552017960,"node_id":"IC_kwDOAA4wNc5cgeoo","user":{"login":"ntkme","id":899645,"node_id":"MDQ6VXNlcjg5OTY0NQ==","avatar_url":"https://avatars.githubusercontent.com/u/899645?v=4","gravatar_id":"","url":"https://api.github.com/users/ntkme","html_url":"https://github.com/ntkme","followers_url":"https://api.github.com/users/ntkme/followers","following_url":"https://api.github.com/users/ntkme/following{/other_user}","gists_url":"https://api.github.com/users/ntkme/gists{/gist_id}","starred_url":"https://api.github.com/users/ntkme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ntkme/subscriptions","organizations_url":"https://api.github.com/users/ntkme/orgs","repos_url":"https://api.github.com/users/ntkme/repos","events_url":"https://api.github.com/users/ntkme/events{/privacy}","received_events_url":"https://api.github.com/users/ntkme/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-26T21:08:55Z","updated_at":"2023-05-15T22:15:04Z","body":"> as some [potentially] non-zero ID that is treated as part of the same 'must not overlap' namespace as the `CompilerRequest` 'wire ID's?\r\n\r\nWe don’t necessarily need an id on VersionRequest itself if we reserve wire id 0, as we don’t really expect to receive concurrent/repeated requests for checking version, and even that happens the response will always be the same.\r\n\r\nFor other potential future requests, they will be as different protobuf type if any. Since we only have a single wire id 0 reserved for all these, the process of these requests would be always first checking the received message type for wire id 0 and then proceeding to process accordingly depends on the message type.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sass/sass/issues/comments/1552017960/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ntkme","id":899645,"node_id":"MDQ6VXNlcjg5OTY0NQ==","avatar_url":"https://avatars.githubusercontent.com/u/899645?v=4","gravatar_id":"","url":"https://api.github.com/users/ntkme","html_url":"https://github.com/ntkme","followers_url":"https://api.github.com/users/ntkme/followers","following_url":"https://api.github.com/users/ntkme/following{/other_user}","gists_url":"https://api.github.com/users/ntkme/gists{/gist_id}","starred_url":"https://api.github.com/users/ntkme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ntkme/subscriptions","organizations_url":"https://api.github.com/users/ntkme/orgs","repos_url":"https://api.github.com/users/ntkme/repos","events_url":"https://api.github.com/users/ntkme/events{/privacy}","received_events_url":"https://api.github.com/users/ntkme/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sass/sass/issues/comments/1552017972","html_url":"https://github.com/sass/sass/issues/3579#issuecomment-1552017972","issue_url":"https://api.github.com/repos/sass/sass/issues/3579","id":1552017972,"node_id":"IC_kwDOAA4wNc5cgeo0","user":{"login":"nex3","id":188,"node_id":"MDQ6VXNlcjE4OA==","avatar_url":"https://avatars.githubusercontent.com/u/188?v=4","gravatar_id":"","url":"https://api.github.com/users/nex3","html_url":"https://github.com/nex3","followers_url":"https://api.github.com/users/nex3/followers","following_url":"https://api.github.com/users/nex3/following{/other_user}","gists_url":"https://api.github.com/users/nex3/gists{/gist_id}","starred_url":"https://api.github.com/users/nex3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nex3/subscriptions","organizations_url":"https://api.github.com/users/nex3/orgs","repos_url":"https://api.github.com/users/nex3/repos","events_url":"https://api.github.com/users/nex3/events{/privacy}","received_events_url":"https://api.github.com/users/nex3/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-27T01:37:01Z","updated_at":"2023-04-27T01:37:01Z","body":"I think just for consistency it makes sense to retain `VersionRequest.id` even though there's no real risk of getting concurrent version requests confused with one another.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sass/sass/issues/comments/1552017972/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"nex3","id":188,"node_id":"MDQ6VXNlcjE4OA==","avatar_url":"https://avatars.githubusercontent.com/u/188?v=4","gravatar_id":"","url":"https://api.github.com/users/nex3","html_url":"https://github.com/nex3","followers_url":"https://api.github.com/users/nex3/followers","following_url":"https://api.github.com/users/nex3/following{/other_user}","gists_url":"https://api.github.com/users/nex3/gists{/gist_id}","starred_url":"https://api.github.com/users/nex3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nex3/subscriptions","organizations_url":"https://api.github.com/users/nex3/orgs","repos_url":"https://api.github.com/users/nex3/repos","events_url":"https://api.github.com/users/nex3/events{/privacy}","received_events_url":"https://api.github.com/users/nex3/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sass/sass/issues/comments/1552017985","html_url":"https://github.com/sass/sass/issues/3579#issuecomment-1552017985","issue_url":"https://api.github.com/repos/sass/sass/issues/3579","id":1552017985,"node_id":"IC_kwDOAA4wNc5cgepB","user":{"login":"larsgrefer","id":6069961,"node_id":"MDQ6VXNlcjYwNjk5NjE=","avatar_url":"https://avatars.githubusercontent.com/u/6069961?v=4","gravatar_id":"","url":"https://api.github.com/users/larsgrefer","html_url":"https://github.com/larsgrefer","followers_url":"https://api.github.com/users/larsgrefer/followers","following_url":"https://api.github.com/users/larsgrefer/following{/other_user}","gists_url":"https://api.github.com/users/larsgrefer/gists{/gist_id}","starred_url":"https://api.github.com/users/larsgrefer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/larsgrefer/subscriptions","organizations_url":"https://api.github.com/users/larsgrefer/orgs","repos_url":"https://api.github.com/users/larsgrefer/repos","events_url":"https://api.github.com/users/larsgrefer/events{/privacy}","received_events_url":"https://api.github.com/users/larsgrefer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-27T20:10:15Z","updated_at":"2023-04-27T20:10:15Z","body":"The proto decoding and encoding never seemed to be a performance bottleneck for me, but If you have problems there or see the potential for performance improvements, we can definitely look into this.\r\n\r\nHave you already done some tests to see how much improvement is possible here?\r\n\r\nIm also not sure if it's a good idea that the wire-transfer now becomes more than just protobuf.\r\n\r\nThe java protobuf library has dedicated support for writing and reading the currently used var-int delimited messages, which allows me to implement the actual stream communication without any custom code: \r\n\r\nhttps://github.com/larsgrefer/dart-sass-java/blob/cf28c3e3b8b5c43d6c8b6b23c32988135c64de06/sass-embedded-host/src/main/java/de/larsgrefer/sass/embedded/connection/StreamConnection.java#L24-L41\r\n\r\nSo the current protocol is just \"plain old\" protobuf on a stream with no additional IO logic needed.\r\nI only need to work with type-safe and compile-safe protobuf message objects and the protobuf library handles the IO for me. With this proposal, we'd get a new layer of complexity, as the wire protocol would be more than just protobuf.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sass/sass/issues/comments/1552017985/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"larsgrefer","id":6069961,"node_id":"MDQ6VXNlcjYwNjk5NjE=","avatar_url":"https://avatars.githubusercontent.com/u/6069961?v=4","gravatar_id":"","url":"https://api.github.com/users/larsgrefer","html_url":"https://github.com/larsgrefer","followers_url":"https://api.github.com/users/larsgrefer/followers","following_url":"https://api.github.com/users/larsgrefer/following{/other_user}","gists_url":"https://api.github.com/users/larsgrefer/gists{/gist_id}","starred_url":"https://api.github.com/users/larsgrefer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/larsgrefer/subscriptions","organizations_url":"https://api.github.com/users/larsgrefer/orgs","repos_url":"https://api.github.com/users/larsgrefer/repos","events_url":"https://api.github.com/users/larsgrefer/events{/privacy}","received_events_url":"https://api.github.com/users/larsgrefer/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sass/sass/issues/comments/1552017995","html_url":"https://github.com/sass/sass/issues/3579#issuecomment-1552017995","issue_url":"https://api.github.com/repos/sass/sass/issues/3579","id":1552017995,"node_id":"IC_kwDOAA4wNc5cgepL","user":{"login":"ntkme","id":899645,"node_id":"MDQ6VXNlcjg5OTY0NQ==","avatar_url":"https://avatars.githubusercontent.com/u/899645?v=4","gravatar_id":"","url":"https://api.github.com/users/ntkme","html_url":"https://github.com/ntkme","followers_url":"https://api.github.com/users/ntkme/followers","following_url":"https://api.github.com/users/ntkme/following{/other_user}","gists_url":"https://api.github.com/users/ntkme/gists{/gist_id}","starred_url":"https://api.github.com/users/ntkme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ntkme/subscriptions","organizations_url":"https://api.github.com/users/ntkme/orgs","repos_url":"https://api.github.com/users/ntkme/repos","events_url":"https://api.github.com/users/ntkme/events{/privacy}","received_events_url":"https://api.github.com/users/ntkme/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-27T21:40:29Z","updated_at":"2023-05-15T22:15:04Z","body":"The performance issue is mainly on dart-sdk/dart-sass-embedded. Here are some related issues and discussions:\r\n\r\nhttps://github.com/sass/dart-sass/issues/1959\r\nhttps://github.com/dart-lang/sdk/issues/44804\r\nhttps://github.com/dart-lang/sdk/issues/52121","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sass/sass/issues/comments/1552017995/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ntkme","id":899645,"node_id":"MDQ6VXNlcjg5OTY0NQ==","avatar_url":"https://avatars.githubusercontent.com/u/899645?v=4","gravatar_id":"","url":"https://api.github.com/users/ntkme","html_url":"https://github.com/ntkme","followers_url":"https://api.github.com/users/ntkme/followers","following_url":"https://api.github.com/users/ntkme/following{/other_user}","gists_url":"https://api.github.com/users/ntkme/gists{/gist_id}","starred_url":"https://api.github.com/users/ntkme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ntkme/subscriptions","organizations_url":"https://api.github.com/users/ntkme/orgs","repos_url":"https://api.github.com/users/ntkme/repos","events_url":"https://api.github.com/users/ntkme/events{/privacy}","received_events_url":"https://api.github.com/users/ntkme/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sass/sass/issues/comments/1552018012","html_url":"https://github.com/sass/sass/issues/3579#issuecomment-1552018012","issue_url":"https://api.github.com/repos/sass/sass/issues/3579","id":1552018012,"node_id":"IC_kwDOAA4wNc5cgepc","user":{"login":"nex3","id":188,"node_id":"MDQ6VXNlcjE4OA==","avatar_url":"https://avatars.githubusercontent.com/u/188?v=4","gravatar_id":"","url":"https://api.github.com/users/nex3","html_url":"https://github.com/nex3","followers_url":"https://api.github.com/users/nex3/followers","following_url":"https://api.github.com/users/nex3/following{/other_user}","gists_url":"https://api.github.com/users/nex3/gists{/gist_id}","starred_url":"https://api.github.com/users/nex3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nex3/subscriptions","organizations_url":"https://api.github.com/users/nex3/orgs","repos_url":"https://api.github.com/users/nex3/repos","events_url":"https://api.github.com/users/nex3/events{/privacy}","received_events_url":"https://api.github.com/users/nex3/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-27T21:41:38Z","updated_at":"2023-05-15T22:15:04Z","body":"> Have you already done some tests to see how much improvement is possible here?\r\n\r\nIt's difficult to get meaningful test results without a real app that uses custom importers/functions and has a high degree of concurrency. It's certainly the case that double-parsing the protobufs to dispatch between workers is _wasted_ effort.\r\n\r\nThat said, we could also potentially mitigate this by having the dispatcher iterate through the raw bytes to find the message's ID without fully parsing it. This would be more complex to implement on the compiler's side—it effectively requires us to write a protobuf \"lexer\"—but a single-pass traversal should still be fairly efficient, especially if (as I suspect) serializers will tend to put the ID at the beginning of the message. And, crucially, it wouldn't require a change from the current wire format. @ntkme what do you think of that possibility?","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sass/sass/issues/comments/1552018012/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"nex3","id":188,"node_id":"MDQ6VXNlcjE4OA==","avatar_url":"https://avatars.githubusercontent.com/u/188?v=4","gravatar_id":"","url":"https://api.github.com/users/nex3","html_url":"https://github.com/nex3","followers_url":"https://api.github.com/users/nex3/followers","following_url":"https://api.github.com/users/nex3/following{/other_user}","gists_url":"https://api.github.com/users/nex3/gists{/gist_id}","starred_url":"https://api.github.com/users/nex3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nex3/subscriptions","organizations_url":"https://api.github.com/users/nex3/orgs","repos_url":"https://api.github.com/users/nex3/repos","events_url":"https://api.github.com/users/nex3/events{/privacy}","received_events_url":"https://api.github.com/users/nex3/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":9273402601,"node_id":"MEE_lADOAA4wNc5mMswkzwAAAAIovOTp","url":"https://api.github.com/repos/sass/sass/issues/events/9273402601","actor":{"login":"ntkme","id":899645,"node_id":"MDQ6VXNlcjg5OTY0NQ==","avatar_url":"https://avatars.githubusercontent.com/u/899645?v=4","gravatar_id":"","url":"https://api.github.com/users/ntkme","html_url":"https://github.com/ntkme","followers_url":"https://api.github.com/users/ntkme/followers","following_url":"https://api.github.com/users/ntkme/following{/other_user}","gists_url":"https://api.github.com/users/ntkme/gists{/gist_id}","starred_url":"https://api.github.com/users/ntkme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ntkme/subscriptions","organizations_url":"https://api.github.com/users/ntkme/orgs","repos_url":"https://api.github.com/users/ntkme/repos","events_url":"https://api.github.com/users/ntkme/events{/privacy}","received_events_url":"https://api.github.com/users/ntkme/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-04-27T21:41:38Z","performed_via_github_app":null},{"id":9273402612,"node_id":"SE_lADOAA4wNc5mMswkzwAAAAIovOT0","url":"https://api.github.com/repos/sass/sass/issues/events/9273402612","actor":{"login":"ntkme","id":899645,"node_id":"MDQ6VXNlcjg5OTY0NQ==","avatar_url":"https://avatars.githubusercontent.com/u/899645?v=4","gravatar_id":"","url":"https://api.github.com/users/ntkme","html_url":"https://github.com/ntkme","followers_url":"https://api.github.com/users/ntkme/followers","following_url":"https://api.github.com/users/ntkme/following{/other_user}","gists_url":"https://api.github.com/users/ntkme/gists{/gist_id}","starred_url":"https://api.github.com/users/ntkme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ntkme/subscriptions","organizations_url":"https://api.github.com/users/ntkme/orgs","repos_url":"https://api.github.com/users/ntkme/repos","events_url":"https://api.github.com/users/ntkme/events{/privacy}","received_events_url":"https://api.github.com/users/ntkme/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-04-27T21:41:38Z","performed_via_github_app":null}]