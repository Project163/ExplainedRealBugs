{"url":"https://api.github.com/repos/actix/actix-web/issues/2815","repository_url":"https://api.github.com/repos/actix/actix-web","labels_url":"https://api.github.com/repos/actix/actix-web/issues/2815/labels{/name}","comments_url":"https://api.github.com/repos/actix/actix-web/issues/2815/comments","events_url":"https://api.github.com/repos/actix/actix-web/issues/2815/events","html_url":"https://github.com/actix/actix-web/issues/2815","id":1313198216,"node_id":"I_kwDOBkf28c5ORdCI","number":2815,"title":"Streaming & Seeking in large video served using NamedFile doesn't work","user":{"login":"dnlmlr","id":34707428,"node_id":"MDQ6VXNlcjM0NzA3NDI4","avatar_url":"https://avatars.githubusercontent.com/u/34707428?v=4","gravatar_id":"","url":"https://api.github.com/users/dnlmlr","html_url":"https://github.com/dnlmlr","followers_url":"https://api.github.com/users/dnlmlr/followers","following_url":"https://api.github.com/users/dnlmlr/following{/other_user}","gists_url":"https://api.github.com/users/dnlmlr/gists{/gist_id}","starred_url":"https://api.github.com/users/dnlmlr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dnlmlr/subscriptions","organizations_url":"https://api.github.com/users/dnlmlr/orgs","repos_url":"https://api.github.com/users/dnlmlr/repos","events_url":"https://api.github.com/users/dnlmlr/events{/privacy}","received_events_url":"https://api.github.com/users/dnlmlr/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":707286502,"node_id":"MDU6TGFiZWw3MDcyODY1MDI=","url":"https://api.github.com/repos/actix/actix-web/labels/C-bug","name":"C-bug","color":"ee0701","default":false,"description":"Category: bug"},{"id":1286567531,"node_id":"MDU6TGFiZWwxMjg2NTY3NTMx","url":"https://api.github.com/repos/actix/actix-web/labels/A-files","name":"A-files","color":"fff4af","default":false,"description":"project: actix-files"}],"state":"closed","locked":false,"assignee":{"login":"robjtede","id":3316789,"node_id":"MDQ6VXNlcjMzMTY3ODk=","avatar_url":"https://avatars.githubusercontent.com/u/3316789?v=4","gravatar_id":"","url":"https://api.github.com/users/robjtede","html_url":"https://github.com/robjtede","followers_url":"https://api.github.com/users/robjtede/followers","following_url":"https://api.github.com/users/robjtede/following{/other_user}","gists_url":"https://api.github.com/users/robjtede/gists{/gist_id}","starred_url":"https://api.github.com/users/robjtede/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/robjtede/subscriptions","organizations_url":"https://api.github.com/users/robjtede/orgs","repos_url":"https://api.github.com/users/robjtede/repos","events_url":"https://api.github.com/users/robjtede/events{/privacy}","received_events_url":"https://api.github.com/users/robjtede/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"robjtede","id":3316789,"node_id":"MDQ6VXNlcjMzMTY3ODk=","avatar_url":"https://avatars.githubusercontent.com/u/3316789?v=4","gravatar_id":"","url":"https://api.github.com/users/robjtede","html_url":"https://github.com/robjtede","followers_url":"https://api.github.com/users/robjtede/followers","following_url":"https://api.github.com/users/robjtede/following{/other_user}","gists_url":"https://api.github.com/users/robjtede/gists{/gist_id}","starred_url":"https://api.github.com/users/robjtede/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/robjtede/subscriptions","organizations_url":"https://api.github.com/users/robjtede/orgs","repos_url":"https://api.github.com/users/robjtede/repos","events_url":"https://api.github.com/users/robjtede/events{/privacy}","received_events_url":"https://api.github.com/users/robjtede/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":1,"created_at":"2022-07-21T12:40:55Z","updated_at":"2022-07-23T15:27:02Z","closed_at":"2022-07-23T15:27:02Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Expected Behavior\r\nServing a large *(in my case ~2GB)* static video file *(mp4, h264)* from actix on a given route should allow the html5 `video` player to start playback immediately, acting instantly on the arriving video chunks. The player should also be able to seek forward, which should cause a new get request with an offset range.\r\n\r\nThis is the behavior that can be observed when using nodejs + `express`, or `warp` to do the same thing.\r\n\r\n## Current Behavior\r\nFor the large 2GB video file: The video is loading with no playback until the full file is downloaded. Only after the get request is completed, the video can start playing.\r\n\r\nFor smaller video files: The videos do start playing immediately (as would be expected), but seeking beyond the buffered range doesn't work. Instead of stopping the current buffering get request and starting a new one at the seeked range, it doesn't do anything when seeking beyond the buffer. The seek cursor just jumps back.\r\n\r\n## Steps to Reproduce (for bugs)\r\n- Obtain a video file that is playable in browser (mp4, h264), for example [this random test video](http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/Sintel.mp4)\r\n- If the video file is smaller than ~2GB (like the test video), either use another one or make it longer (for the example video: `ffmpeg -stream_loop 10 -i Sintel.mp4 -c copy Sintel_long.mp4`)\r\n- Use the following `actix-web` rust program to serve the video (adjust the filename if needed)\r\n```rust\r\nuse actix_files::NamedFile;\r\nuse actix_web::{get, App, HttpRequest, HttpResponse, HttpServer};\r\n\r\n#[get(\"/video.mp4\")]\r\npub async fn serve_video(req: HttpRequest) -> HttpResponse {\r\n    let istream = NamedFile::open_async(\"Sintel_long.mp4\").await.unwrap();\r\n    istream.into_response(&req)\r\n}\r\n\r\n#[actix_web::main]\r\nasync fn main() -> std::io::Result<()> {\r\n    HttpServer::new(|| App::new().service(serve_video))\r\n        .bind((\"127.0.0.1\", 8080))?\r\n        .run()\r\n        .await\r\n}\r\n```\r\n\r\n- Open the following html file in the browser while the `actix-web` server is running\r\n```html\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head></head>\r\n<body>\r\n    <video controls preload=\"none\">\r\n        <source src=\"http://127.0.0.1:8080/video.mp4\" type=\"video/mp4\">\r\n    </video>\r\n</body>\r\n</html>\r\n```\r\n- Press play in the browser (current behavior: doesn't play until the full get request is completed (2GB download))\r\n- With a smaller video file: Try to seek forward beyond the buffered range (current behavior: current position cursor jumps back instead of seeking forward)\r\n\r\n- Try the same thing with the following `nodejs` / `express` code (should work as described in *expected*)\r\n```javascript\r\nconst express = require(\"express\")\r\nconst app = express()\r\napp.use(\"/video.mp4\", express.static(\"Sintel_long.mp4\"))\r\napp.listen(8080)\r\n```\r\n\r\n- Try the same thing with the following `warp` code (should work as described in *expected*)\r\n```rust\r\nuse warp::Filter;\r\n\r\n#[tokio::main]\r\npub async fn main() {\r\n    let route_file = warp::path(\"video.mp4\").and(warp::fs::file(\"Sintel_long.mp4\"));\r\n    warp::serve(route_file).run(([127, 0, 0, 1], 8080)).await;\r\n}\r\n```\r\n\r\n## Context\r\nI'm trying to serve static video files using `actix-web` and play them using the html5 video player. This should have the *good user experience* of being able to play the video without waiting for multiple minutes and also seeking forward.\r\n\r\n## Your Environment\r\n- Rust Version: `rustc 1.62.0 (a8314ef7d 2022-06-27)`\r\n- Actix Web Version: `4.1.0`\r\n- Actix Files Version: `0.6.1`\r\n- Target: `x86_64-pc-windows-msvc`\r\n- Browser: `Firefox` & `Chromium`\r\n","closed_by":{"login":"robjtede","id":3316789,"node_id":"MDQ6VXNlcjMzMTY3ODk=","avatar_url":"https://avatars.githubusercontent.com/u/3316789?v=4","gravatar_id":"","url":"https://api.github.com/users/robjtede","html_url":"https://github.com/robjtede","followers_url":"https://api.github.com/users/robjtede/followers","following_url":"https://api.github.com/users/robjtede/following{/other_user}","gists_url":"https://api.github.com/users/robjtede/gists{/gist_id}","starred_url":"https://api.github.com/users/robjtede/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/robjtede/subscriptions","organizations_url":"https://api.github.com/users/robjtede/orgs","repos_url":"https://api.github.com/users/robjtede/repos","events_url":"https://api.github.com/users/robjtede/events{/privacy}","received_events_url":"https://api.github.com/users/robjtede/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/actix/actix-web/issues/2815/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/actix/actix-web/issues/2815/timeline","performed_via_github_app":null,"state_reason":"completed"}