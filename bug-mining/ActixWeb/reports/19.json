{"url":"https://api.github.com/repos/actix/actix-web/issues/1384","repository_url":"https://api.github.com/repos/actix/actix-web","labels_url":"https://api.github.com/repos/actix/actix-web/issues/1384/labels{/name}","comments_url":"https://api.github.com/repos/actix/actix-web/issues/1384/comments","events_url":"https://api.github.com/repos/actix/actix-web/issues/1384/events","html_url":"https://github.com/actix/actix-web/issues/1384","id":571729388,"node_id":"MDU6SXNzdWU1NzE3MjkzODg=","number":1384,"title":"actix-web/actix-files doesn't put a Content-Length on range responses","user":{"login":"djahandarie","id":21412,"node_id":"MDQ6VXNlcjIxNDEy","avatar_url":"https://avatars.githubusercontent.com/u/21412?v=4","gravatar_id":"","url":"https://api.github.com/users/djahandarie","html_url":"https://github.com/djahandarie","followers_url":"https://api.github.com/users/djahandarie/followers","following_url":"https://api.github.com/users/djahandarie/following{/other_user}","gists_url":"https://api.github.com/users/djahandarie/gists{/gist_id}","starred_url":"https://api.github.com/users/djahandarie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djahandarie/subscriptions","organizations_url":"https://api.github.com/users/djahandarie/orgs","repos_url":"https://api.github.com/users/djahandarie/repos","events_url":"https://api.github.com/users/djahandarie/events{/privacy}","received_events_url":"https://api.github.com/users/djahandarie/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":707286502,"node_id":"MDU6TGFiZWw3MDcyODY1MDI=","url":"https://api.github.com/repos/actix/actix-web/labels/C-bug","name":"C-bug","color":"ee0701","default":false,"description":"Category: bug"},{"id":1286567531,"node_id":"MDU6TGFiZWwxMjg2NTY3NTMx","url":"https://api.github.com/repos/actix/actix-web/labels/A-files","name":"A-files","color":"fff4af","default":false,"description":"project: actix-files"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2020-02-26T23:45:39Z","updated_at":"2020-05-17T21:54:43Z","closed_at":"2020-05-17T21:54:43Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"It seems that if you do a range request to a [`Files`](https://docs.rs/actix-files/0.2.1/actix_files/struct.Files.html)-backed resource, you will get a `Content-Range` header back in the 206, but not a `Content-Length` back:\r\n\r\n```\r\n  HTTP/1.1 206 Partial Content\r\n  transfer-encoding: chunked\r\n  last-modified: Wed, 26 Feb 2020 18:01:01 GMT\r\n  accept-ranges: bytes\r\n  cache-control: max-age=100\r\n  content-type: application/octet-stream\r\n  content-range: bytes 0-100/3238690816\r\n  etag: \"8e6d2f:c10a8000:5e56b25d:207070e2\"\r\n  content-disposition: attachment; filename=\"data.db\"\r\n  date: Wed, 26 Feb 2020 23:40:44 GMT\r\n```\r\n\r\nWhile [RFC 7223: Hypertext Transfer Protocol (HTTP/1.1): Range Requests](https://tools.ietf.org/html/rfc7233) doesn't seem to explicitly forbid omitting a `Content-Length` header, all of the examples in it do include the `Content-Length` in 206 responses, e.g.:\r\n\r\n```\r\n     HTTP/1.1 206 Partial Content\r\n     Date: Wed, 15 Nov 1995 06:25:24 GMT\r\n     Last-Modified: Wed, 15 Nov 1995 04:58:08 GMT\r\n     Content-Range: bytes 21010-47021/47022\r\n     Content-Length: 26012\r\n     Content-Type: image/gif\r\n\r\n     ... 26012 bytes of partial image data ...\r\n```\r\n(From [section 4.1](https://tools.ietf.org/html/rfc7233#section-4.1))\r\n\r\nIn addition, a reverse proxy/CDN I'm using in front of my app also requires the Content-Length header, which is how I noticed this issue.\r\n\r\nI *think* this is a regression in actix-web 2.","closed_by":{"login":"JohnTitor","id":25030997,"node_id":"MDQ6VXNlcjI1MDMwOTk3","avatar_url":"https://avatars.githubusercontent.com/u/25030997?v=4","gravatar_id":"","url":"https://api.github.com/users/JohnTitor","html_url":"https://github.com/JohnTitor","followers_url":"https://api.github.com/users/JohnTitor/followers","following_url":"https://api.github.com/users/JohnTitor/following{/other_user}","gists_url":"https://api.github.com/users/JohnTitor/gists{/gist_id}","starred_url":"https://api.github.com/users/JohnTitor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JohnTitor/subscriptions","organizations_url":"https://api.github.com/users/JohnTitor/orgs","repos_url":"https://api.github.com/users/JohnTitor/repos","events_url":"https://api.github.com/users/JohnTitor/events{/privacy}","received_events_url":"https://api.github.com/users/JohnTitor/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/actix/actix-web/issues/1384/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/actix/actix-web/issues/1384/timeline","performed_via_github_app":null,"state_reason":"completed"}