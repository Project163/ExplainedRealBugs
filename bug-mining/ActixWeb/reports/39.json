{"url":"https://api.github.com/repos/actix/actix-web/issues/3229","repository_url":"https://api.github.com/repos/actix/actix-web","labels_url":"https://api.github.com/repos/actix/actix-web/issues/3229/labels{/name}","comments_url":"https://api.github.com/repos/actix/actix-web/issues/3229/comments","events_url":"https://api.github.com/repos/actix/actix-web/issues/3229/events","html_url":"https://github.com/actix/actix-web/issues/3229","id":2055187587,"node_id":"I_kwDOBkf28c56f6yD","number":3229,"title":"actix-http 3.5 \"Prevent compression of zero-sized response bodies\" causes delays to close connection","user":{"login":"mrsarm","id":1608415,"node_id":"MDQ6VXNlcjE2MDg0MTU=","avatar_url":"https://avatars.githubusercontent.com/u/1608415?v=4","gravatar_id":"","url":"https://api.github.com/users/mrsarm","html_url":"https://github.com/mrsarm","followers_url":"https://api.github.com/users/mrsarm/followers","following_url":"https://api.github.com/users/mrsarm/following{/other_user}","gists_url":"https://api.github.com/users/mrsarm/gists{/gist_id}","starred_url":"https://api.github.com/users/mrsarm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mrsarm/subscriptions","organizations_url":"https://api.github.com/users/mrsarm/orgs","repos_url":"https://api.github.com/users/mrsarm/repos","events_url":"https://api.github.com/users/mrsarm/events{/privacy}","received_events_url":"https://api.github.com/users/mrsarm/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":707286502,"node_id":"MDU6TGFiZWw3MDcyODY1MDI=","url":"https://api.github.com/repos/actix/actix-web/labels/C-bug","name":"C-bug","color":"ee0701","default":false,"description":"Category: bug"},{"id":1426756839,"node_id":"MDU6TGFiZWwxNDI2NzU2ODM5","url":"https://api.github.com/repos/actix/actix-web/labels/A-http","name":"A-http","color":"fff4af","default":false,"description":"project: actix-http"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2023-12-24T18:49:10Z","updated_at":"2023-12-26T12:25:43Z","closed_at":"2023-12-25T02:28:00Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I was working in some changes in my Actix project with latest dependencies installed, so as soon as I see the new minor versions released Today I wanted to give it a try, and everything continue to working with Actix 4.4.1, but now the endpoints that return no body take considerable time to finish the connection.\r\n\r\nI see that the release of actix-http 3.5.0 has this in it's release note: \"Prevent compression of zero-sized response bodies\", so I changed the dependencies configuration and only updated this dependency (and it's dependencies) and not the rest of the Actix libs, and the problem persist, so looks highly probable that it's the reason why the delay happens. I also tried different clients and browsers: curl, httpie, Firefox and Chrome.\r\n\r\n## Expected Behavior\r\n\r\nIn my service, when a HTTP 404 response is given with no body, the speed at what the response is delivered is as fast or even higher than HTTP responses with body.\r\n\r\n## Current Behavior\r\n\r\nIt's really slow, here is a recording, first I make 2 HTTP calls to an endpoint that return JSON responses when the record is found, and the third call is made to the same endpoint with an id of a record that doesn't exist, in which case the endpoint respond back with HTTP 404 and no body. The first 2 calls are very fast while the third it's very slow to finish the connection:\r\n\r\n![Actix HTTP Delay Error](https://github.com/actix/actix-web/assets/1608415/0e9de7ce-4a53-4146-8b89-643dab9e41c1)\r\n\r\n## Possible Solution\r\n\r\nFor now, the only workaround is avoid updating to the latest actix-http version. Sticking with version 3.4 prevent the error to happen.\r\n\r\n## Steps to Reproduce (for bugs)\r\n\r\nJust update to the latest actix-http, and call a endpoint in your project that gives you no body in the response.\r\n\r\n## Your Environment\r\n\r\n<!--- Include as many relevant details about the environment you experienced the bug in -->\r\n\r\n- Rust Version (I.e, output of `rustc -V`): rustc 1.74.1 (a28077b28 2023-12-04)\r\n- Actix Web Version: 4.4.0 or 4.4.1\r\n- Actix-HTTP: 3.5\r\n- Ubuntu 20.04 x64.\r\n\r\nThe following dependencies were also updated when I did the upgrade to actix-http 3.5:\r\n\r\n- zstd ~0.12.4~ -> 0.13.0\r\n- zstd-safe ~6.0.6~ -> 7.0.0\r\n","closed_by":{"login":"robjtede","id":3316789,"node_id":"MDQ6VXNlcjMzMTY3ODk=","avatar_url":"https://avatars.githubusercontent.com/u/3316789?v=4","gravatar_id":"","url":"https://api.github.com/users/robjtede","html_url":"https://github.com/robjtede","followers_url":"https://api.github.com/users/robjtede/followers","following_url":"https://api.github.com/users/robjtede/following{/other_user}","gists_url":"https://api.github.com/users/robjtede/gists{/gist_id}","starred_url":"https://api.github.com/users/robjtede/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/robjtede/subscriptions","organizations_url":"https://api.github.com/users/robjtede/orgs","repos_url":"https://api.github.com/users/robjtede/repos","events_url":"https://api.github.com/users/robjtede/events{/privacy}","received_events_url":"https://api.github.com/users/robjtede/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/actix/actix-web/issues/3229/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/actix/actix-web/issues/3229/timeline","performed_via_github_app":null,"state_reason":"completed"}