[{"actor":{"login":"fakeshadow","id":7859909,"node_id":"MDQ6VXNlcjc4NTk5MDk=","avatar_url":"https://avatars.githubusercontent.com/u/7859909?v=4","gravatar_id":"","url":"https://api.github.com/users/fakeshadow","html_url":"https://github.com/fakeshadow","followers_url":"https://api.github.com/users/fakeshadow/followers","following_url":"https://api.github.com/users/fakeshadow/following{/other_user}","gists_url":"https://api.github.com/users/fakeshadow/gists{/gist_id}","starred_url":"https://api.github.com/users/fakeshadow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fakeshadow/subscriptions","organizations_url":"https://api.github.com/users/fakeshadow/orgs","repos_url":"https://api.github.com/users/fakeshadow/repos","events_url":"https://api.github.com/users/fakeshadow/events{/privacy}","received_events_url":"https://api.github.com/users/fakeshadow/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-03T02:25:45Z","updated_at":"2022-01-03T02:25:45Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/actix/actix-web/issues/2561","repository_url":"https://api.github.com/repos/actix/actix-web","labels_url":"https://api.github.com/repos/actix/actix-web/issues/2561/labels{/name}","comments_url":"https://api.github.com/repos/actix/actix-web/issues/2561/comments","events_url":"https://api.github.com/repos/actix/actix-web/issues/2561/events","html_url":"https://github.com/actix/actix-web/issues/2561","id":1092021250,"node_id":"I_kwDOBkf28c5BFuwC","number":2561,"title":"Consider remove Clone for HttpRequest","user":{"login":"Kilerd","id":3162379,"node_id":"MDQ6VXNlcjMxNjIzNzk=","avatar_url":"https://avatars.githubusercontent.com/u/3162379?v=4","gravatar_id":"","url":"https://api.github.com/users/Kilerd","html_url":"https://github.com/Kilerd","followers_url":"https://api.github.com/users/Kilerd/followers","following_url":"https://api.github.com/users/Kilerd/following{/other_user}","gists_url":"https://api.github.com/users/Kilerd/gists{/gist_id}","starred_url":"https://api.github.com/users/Kilerd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Kilerd/subscriptions","organizations_url":"https://api.github.com/users/Kilerd/orgs","repos_url":"https://api.github.com/users/Kilerd/repos","events_url":"https://api.github.com/users/Kilerd/events{/privacy}","received_events_url":"https://api.github.com/users/Kilerd/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2345270051,"node_id":"MDU6TGFiZWwyMzQ1MjcwMDUx","url":"https://api.github.com/repos/actix/actix-web/labels/A-web","name":"A-web","color":"fff4af","default":false,"description":"project: actix-web"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2022-01-02T13:30:53Z","updated_at":"2023-02-11T12:16:48Z","closed_at":"2022-01-04T19:36:33Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":105379569,"node_id":"MDEwOlJlcG9zaXRvcnkxMDUzNzk1Njk=","name":"actix-web","full_name":"actix/actix-web","private":false,"owner":{"login":"actix","id":32776943,"node_id":"MDEyOk9yZ2FuaXphdGlvbjMyNzc2OTQz","avatar_url":"https://avatars.githubusercontent.com/u/32776943?v=4","gravatar_id":"","url":"https://api.github.com/users/actix","html_url":"https://github.com/actix","followers_url":"https://api.github.com/users/actix/followers","following_url":"https://api.github.com/users/actix/following{/other_user}","gists_url":"https://api.github.com/users/actix/gists{/gist_id}","starred_url":"https://api.github.com/users/actix/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/actix/subscriptions","organizations_url":"https://api.github.com/users/actix/orgs","repos_url":"https://api.github.com/users/actix/repos","events_url":"https://api.github.com/users/actix/events{/privacy}","received_events_url":"https://api.github.com/users/actix/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/actix/actix-web","description":"Actix Web is a powerful, pragmatic, and extremely fast web framework for Rust.","fork":false,"url":"https://api.github.com/repos/actix/actix-web","forks_url":"https://api.github.com/repos/actix/actix-web/forks","keys_url":"https://api.github.com/repos/actix/actix-web/keys{/key_id}","collaborators_url":"https://api.github.com/repos/actix/actix-web/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/actix/actix-web/teams","hooks_url":"https://api.github.com/repos/actix/actix-web/hooks","issue_events_url":"https://api.github.com/repos/actix/actix-web/issues/events{/number}","events_url":"https://api.github.com/repos/actix/actix-web/events","assignees_url":"https://api.github.com/repos/actix/actix-web/assignees{/user}","branches_url":"https://api.github.com/repos/actix/actix-web/branches{/branch}","tags_url":"https://api.github.com/repos/actix/actix-web/tags","blobs_url":"https://api.github.com/repos/actix/actix-web/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/actix/actix-web/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/actix/actix-web/git/refs{/sha}","trees_url":"https://api.github.com/repos/actix/actix-web/git/trees{/sha}","statuses_url":"https://api.github.com/repos/actix/actix-web/statuses/{sha}","languages_url":"https://api.github.com/repos/actix/actix-web/languages","stargazers_url":"https://api.github.com/repos/actix/actix-web/stargazers","contributors_url":"https://api.github.com/repos/actix/actix-web/contributors","subscribers_url":"https://api.github.com/repos/actix/actix-web/subscribers","subscription_url":"https://api.github.com/repos/actix/actix-web/subscription","commits_url":"https://api.github.com/repos/actix/actix-web/commits{/sha}","git_commits_url":"https://api.github.com/repos/actix/actix-web/git/commits{/sha}","comments_url":"https://api.github.com/repos/actix/actix-web/comments{/number}","issue_comment_url":"https://api.github.com/repos/actix/actix-web/issues/comments{/number}","contents_url":"https://api.github.com/repos/actix/actix-web/contents/{+path}","compare_url":"https://api.github.com/repos/actix/actix-web/compare/{base}...{head}","merges_url":"https://api.github.com/repos/actix/actix-web/merges","archive_url":"https://api.github.com/repos/actix/actix-web/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/actix/actix-web/downloads","issues_url":"https://api.github.com/repos/actix/actix-web/issues{/number}","pulls_url":"https://api.github.com/repos/actix/actix-web/pulls{/number}","milestones_url":"https://api.github.com/repos/actix/actix-web/milestones{/number}","notifications_url":"https://api.github.com/repos/actix/actix-web/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/actix/actix-web/labels{/name}","releases_url":"https://api.github.com/repos/actix/actix-web/releases{/id}","deployments_url":"https://api.github.com/repos/actix/actix-web/deployments","created_at":"2017-09-30T15:30:02Z","updated_at":"2025-11-09T16:10:03Z","pushed_at":"2025-11-10T00:08:48Z","git_url":"git://github.com/actix/actix-web.git","ssh_url":"git@github.com:actix/actix-web.git","clone_url":"https://github.com/actix/actix-web.git","svn_url":"https://github.com/actix/actix-web","homepage":"https://actix.rs","size":17248,"stargazers_count":23872,"watchers_count":23872,"language":"Rust","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":true,"has_pages":true,"has_discussions":true,"forks_count":1808,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":242,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["actix","actix-web","async","rust","web","web-development","websockets"],"visibility":"public","forks":1808,"open_issues":242,"watchers":23872,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"While trying to write a middleware which do some async logic and store result into Request::extensions like do authentication and store user instance.\r\n\r\nand I try to split `ServiceRequest` into parts and get `HttpRequest`, so that I can clone one of `HttpRequest` for storing data, and then wrap parts back to `ServiceRequest`\r\n\r\nMy Code is like:\r\n```rust\r\nfn call(&self, req: ServiceRequest) -> Self::Future {\r\n        info!(\"in authentication service \");\r\n        let (http_request, payload) = req.into_parts();\r\n        let cloned_request = http_request.clone();\r\n\r\n        let wrapped_request = ServiceRequest::from_parts(http_request, payload);\r\n        let call_fut = self.service.call(wrapped_request);\r\n        Box::pin(async move {\r\n            // async logic here\r\n            cloned_request.extensions_mut().insert(123i32);\r\n            call_fut.await\r\n\r\n        })\r\n    }\r\n```\r\nand I try to get the extension in controller like\r\n```rust\r\n let x = request.extensions();\r\n let option: Option<&i32> = x.get();\r\n```\r\nbut it panic on `thread 'actix-rt|system:0|arbiter:0' panicked at 'called `Option::unwrap()` on a `None` value', /Users/xinchen/.cargo/registry/src/github.com-1ecc6299db9ec823/actix-web-4.0.0-beta.18/src/request.rs:140:43`\r\n\r\nso I dig into the reason, I found that maybe the drop of `HttpRequest` cause it, and there is a comment for `HttpRequest`.\r\n> Invariant\r\n> `Rc<HttpRequestInner>` is used exclusively and NO `Weak<HttpRequestInner>` is allowed anywhere in the code. Weak pointer is > purposely ignored when doing Rc's ref counter check. Expect panics if this invariant is violated.\r\n\r\nso why not just considering remove `Clone` derive for `HttpRequest` and add a pub in crate function for clone the `HttpRequest`?\r\n\r\n## Your Environment\r\n<!--- Include as many relevant details about the environment you experienced the bug in -->\r\n\r\n- Rust Version (I.e, output of `rustc -V`): rustc 1.57.0 (f1edd0429 2021-11-29)\r\n- Actix Web Version: 4.0.0-beta.18\r\n","reactions":{"url":"https://api.github.com/repos/actix/actix-web/issues/2561/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/actix/actix-web/issues/2561/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/actix/actix-web/issues/comments/1004004399","html_url":"https://github.com/actix/actix-web/issues/2562#issuecomment-1004004399","issue_url":"https://api.github.com/repos/actix/actix-web/issues/2562","id":1004004399,"node_id":"IC_kwDOBkf28c471-Qv","user":{"login":"robjtede","id":3316789,"node_id":"MDQ6VXNlcjMzMTY3ODk=","avatar_url":"https://avatars.githubusercontent.com/u/3316789?v=4","gravatar_id":"","url":"https://api.github.com/users/robjtede","html_url":"https://github.com/robjtede","followers_url":"https://api.github.com/users/robjtede/followers","following_url":"https://api.github.com/users/robjtede/following{/other_user}","gists_url":"https://api.github.com/users/robjtede/gists{/gist_id}","starred_url":"https://api.github.com/users/robjtede/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/robjtede/subscriptions","organizations_url":"https://api.github.com/users/robjtede/orgs","repos_url":"https://api.github.com/users/robjtede/repos","events_url":"https://api.github.com/users/robjtede/events{/privacy}","received_events_url":"https://api.github.com/users/robjtede/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-03T10:39:35Z","updated_at":"2022-01-03T10:39:35Z","body":"I think it could also beneficial to have a debug warning on from_parts if the Rc count is not 1. ","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/actix/actix-web/issues/comments/1004004399/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"robjtede","id":3316789,"node_id":"MDQ6VXNlcjMzMTY3ODk=","avatar_url":"https://avatars.githubusercontent.com/u/3316789?v=4","gravatar_id":"","url":"https://api.github.com/users/robjtede","html_url":"https://github.com/robjtede","followers_url":"https://api.github.com/users/robjtede/followers","following_url":"https://api.github.com/users/robjtede/following{/other_user}","gists_url":"https://api.github.com/users/robjtede/gists{/gist_id}","starred_url":"https://api.github.com/users/robjtede/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/robjtede/subscriptions","organizations_url":"https://api.github.com/users/robjtede/orgs","repos_url":"https://api.github.com/users/robjtede/repos","events_url":"https://api.github.com/users/robjtede/events{/privacy}","received_events_url":"https://api.github.com/users/robjtede/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":5842482086,"node_id":"LE_lADOBkf28c5BGU7yzwAAAAFcPTOm","url":"https://api.github.com/repos/actix/actix-web/issues/events/5842482086","actor":{"login":"robjtede","id":3316789,"node_id":"MDQ6VXNlcjMzMTY3ODk=","avatar_url":"https://avatars.githubusercontent.com/u/3316789?v=4","gravatar_id":"","url":"https://api.github.com/users/robjtede","html_url":"https://github.com/robjtede","followers_url":"https://api.github.com/users/robjtede/followers","following_url":"https://api.github.com/users/robjtede/following{/other_user}","gists_url":"https://api.github.com/users/robjtede/gists{/gist_id}","starred_url":"https://api.github.com/users/robjtede/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/robjtede/subscriptions","organizations_url":"https://api.github.com/users/robjtede/orgs","repos_url":"https://api.github.com/users/robjtede/repos","events_url":"https://api.github.com/users/robjtede/events{/privacy}","received_events_url":"https://api.github.com/users/robjtede/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2022-01-04T19:36:59Z","label":{"name":"A-web","color":"fff4af"},"performed_via_github_app":null},{"id":5842482090,"node_id":"LE_lADOBkf28c5BGU7yzwAAAAFcPTOq","url":"https://api.github.com/repos/actix/actix-web/issues/events/5842482090","actor":{"login":"robjtede","id":3316789,"node_id":"MDQ6VXNlcjMzMTY3ODk=","avatar_url":"https://avatars.githubusercontent.com/u/3316789?v=4","gravatar_id":"","url":"https://api.github.com/users/robjtede","html_url":"https://github.com/robjtede","followers_url":"https://api.github.com/users/robjtede/followers","following_url":"https://api.github.com/users/robjtede/following{/other_user}","gists_url":"https://api.github.com/users/robjtede/gists{/gist_id}","starred_url":"https://api.github.com/users/robjtede/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/robjtede/subscriptions","organizations_url":"https://api.github.com/users/robjtede/orgs","repos_url":"https://api.github.com/users/robjtede/repos","events_url":"https://api.github.com/users/robjtede/events{/privacy}","received_events_url":"https://api.github.com/users/robjtede/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2022-01-04T19:36:59Z","label":{"name":"C-docs","color":"b9d644"},"performed_via_github_app":null},{"id":5917276684,"node_id":"MIE_lADOBkf28c5BGU7yzwAAAAFgsnoM","url":"https://api.github.com/repos/actix/actix-web/issues/events/5917276684","actor":{"login":"robjtede","id":3316789,"node_id":"MDQ6VXNlcjMzMTY3ODk=","avatar_url":"https://avatars.githubusercontent.com/u/3316789?v=4","gravatar_id":"","url":"https://api.github.com/users/robjtede","html_url":"https://github.com/robjtede","followers_url":"https://api.github.com/users/robjtede/followers","following_url":"https://api.github.com/users/robjtede/following{/other_user}","gists_url":"https://api.github.com/users/robjtede/gists{/gist_id}","starred_url":"https://api.github.com/users/robjtede/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/robjtede/subscriptions","organizations_url":"https://api.github.com/users/robjtede/orgs","repos_url":"https://api.github.com/users/robjtede/repos","events_url":"https://api.github.com/users/robjtede/events{/privacy}","received_events_url":"https://api.github.com/users/robjtede/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"milestoned","commit_id":null,"commit_url":null,"created_at":"2022-01-19T12:19:11Z","milestone":{"title":"actix-web v4"},"performed_via_github_app":null},{"id":5920904300,"node_id":"CE_lADOBkf28c5BGU7yzwAAAAFg6dRs","url":"https://api.github.com/repos/actix/actix-web/issues/events/5920904300","actor":{"login":"robjtede","id":3316789,"node_id":"MDQ6VXNlcjMzMTY3ODk=","avatar_url":"https://avatars.githubusercontent.com/u/3316789?v=4","gravatar_id":"","url":"https://api.github.com/users/robjtede","html_url":"https://github.com/robjtede","followers_url":"https://api.github.com/users/robjtede/followers","following_url":"https://api.github.com/users/robjtede/following{/other_user}","gists_url":"https://api.github.com/users/robjtede/gists{/gist_id}","starred_url":"https://api.github.com/users/robjtede/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/robjtede/subscriptions","organizations_url":"https://api.github.com/users/robjtede/orgs","repos_url":"https://api.github.com/users/robjtede/repos","events_url":"https://api.github.com/users/robjtede/events{/privacy}","received_events_url":"https://api.github.com/users/robjtede/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"81ef12a0fd0b982a43e120f2c0afc1b65772a189","commit_url":"https://api.github.com/repos/actix/actix-web/commits/81ef12a0fd0b982a43e120f2c0afc1b65772a189","created_at":"2022-01-19T22:26:18Z","state_reason":null,"performed_via_github_app":null},{"id":12311117421,"node_id":"REFE_lADOBkf28c5BGU7yzwAAAALdzL5t","url":"https://api.github.com/repos/actix/actix-web/issues/events/12311117421","actor":{"login":"aisq2008","id":4617898,"node_id":"MDQ6VXNlcjQ2MTc4OTg=","avatar_url":"https://avatars.githubusercontent.com/u/4617898?v=4","gravatar_id":"","url":"https://api.github.com/users/aisq2008","html_url":"https://github.com/aisq2008","followers_url":"https://api.github.com/users/aisq2008/followers","following_url":"https://api.github.com/users/aisq2008/following{/other_user}","gists_url":"https://api.github.com/users/aisq2008/gists{/gist_id}","starred_url":"https://api.github.com/users/aisq2008/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aisq2008/subscriptions","organizations_url":"https://api.github.com/users/aisq2008/orgs","repos_url":"https://api.github.com/users/aisq2008/repos","events_url":"https://api.github.com/users/aisq2008/events{/privacy}","received_events_url":"https://api.github.com/users/aisq2008/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"81ef12a0fd0b982a43e120f2c0afc1b65772a189","commit_url":"https://api.github.com/repos/aisq2008/actix-web/commits/81ef12a0fd0b982a43e120f2c0afc1b65772a189","created_at":"2024-04-01T14:03:34Z","performed_via_github_app":null}]