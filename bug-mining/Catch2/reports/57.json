{"url":"https://api.github.com/repos/catchorg/Catch2/issues/741","repository_url":"https://api.github.com/repos/catchorg/Catch2","labels_url":"https://api.github.com/repos/catchorg/Catch2/issues/741/labels{/name}","comments_url":"https://api.github.com/repos/catchorg/Catch2/issues/741/comments","events_url":"https://api.github.com/repos/catchorg/Catch2/issues/741/events","html_url":"https://github.com/catchorg/Catch2/issues/741","id":187886394,"node_id":"MDU6SXNzdWUxODc4ODYzOTQ=","number":741,"title":"Misleading toString documentation regarding overloads","user":{"login":"other-mickk","id":5111293,"node_id":"MDQ6VXNlcjUxMTEyOTM=","avatar_url":"https://avatars.githubusercontent.com/u/5111293?v=4","gravatar_id":"","url":"https://api.github.com/users/other-mickk","html_url":"https://github.com/other-mickk","followers_url":"https://api.github.com/users/other-mickk/followers","following_url":"https://api.github.com/users/other-mickk/following{/other_user}","gists_url":"https://api.github.com/users/other-mickk/gists{/gist_id}","starred_url":"https://api.github.com/users/other-mickk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/other-mickk/subscriptions","organizations_url":"https://api.github.com/users/other-mickk/orgs","repos_url":"https://api.github.com/users/other-mickk/repos","events_url":"https://api.github.com/users/other-mickk/events{/privacy}","received_events_url":"https://api.github.com/users/other-mickk/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":513089685,"node_id":"MDU6TGFiZWw1MTMwODk2ODU=","url":"https://api.github.com/repos/catchorg/Catch2/labels/Bug","name":"Bug","color":"e99695","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2016-11-08T02:33:47Z","updated_at":"2019-04-09T08:49:33Z","closed_at":"2017-05-03T19:09:43Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"The documentation for string conversions offers the [following advice](https://github.com/philsquared/Catch/blob/e27c4ee04282f60aefcc9b1062a74f92cf6c1a2b/docs/tostring.md#catchtostring-overload) (abridged):\r\n\r\n```c++\r\nnamespace Catch {\r\n    std::string toString( T const& value ) {\r\n        return convertMyTypeToString( value );\r\n    }\r\n}\r\n```\r\n> Note that the function must be in the Catch namespace, which itself must be in the global namespace.\r\n\r\nUnfortunately this advice is not quite correct. The following program will not give the desired behaviour when compiled with GCC or Clang:\r\n\r\n```c++\r\n#define CATCH_CONFIG_MAIN\r\n#include \"catch.hpp\"\r\n\r\nnamespace user {\r\n\r\nstruct udt {};\r\nconstexpr bool operator==(udt, udt) { return false; }\r\n\r\n} // user\r\n\r\nnamespace Catch {\r\n\r\nstd::string toString(user::udt) { return \"udt\"; }\r\n\r\n} // Catch\r\n\r\nTEST_CASE( \"demo\" )\r\n{\r\n    CHECK( user::udt {} == user::udt {} );\r\n}\r\n\r\n```\r\n\r\nWhen the resulting program is run, the report displays the expansion as `{?} == {?}`, i.e. the overload provided by the user has not been found. That overload cannot be found because it is declared after the point of use (which is inside `catch.hpp`). This can be observed by tweaking the program so that the overload is declared before use:\r\n\r\n```cpp\r\n#include <string>\r\n\r\nnamespace user {\r\n\r\nstruct udt {};\r\nconstexpr bool operator==(udt, udt) { return false; }\r\n\r\n} // user\r\n\r\nnamespace Catch {\r\n\r\nstd::string toString(user::udt) { return \"udt\"; }\r\n\r\n} // Catch\r\n\r\n#define CATCH_CONFIG_MAIN\r\n#include \"catch.hpp\"\r\n\r\nTEST_CASE( \"demo\" )\r\n{\r\n    CHECK( user::udt {} == user::udt {} );\r\n}\r\n```\r\n\r\nThis time the expansion is shown as `udt == udt`, as expected. Here is a [dumbed-down program schema on Coliru](http://coliru.stacked-crooked.com/a/cdf8130640823c77) to outline the situation more precisely.\r\n\r\nThis is not a problem for the other advice regarding string conversions, namely using `operator<<` or a partial specialization.","closed_by":{"login":"horenmar","id":9026413,"node_id":"MDQ6VXNlcjkwMjY0MTM=","avatar_url":"https://avatars.githubusercontent.com/u/9026413?v=4","gravatar_id":"","url":"https://api.github.com/users/horenmar","html_url":"https://github.com/horenmar","followers_url":"https://api.github.com/users/horenmar/followers","following_url":"https://api.github.com/users/horenmar/following{/other_user}","gists_url":"https://api.github.com/users/horenmar/gists{/gist_id}","starred_url":"https://api.github.com/users/horenmar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/horenmar/subscriptions","organizations_url":"https://api.github.com/users/horenmar/orgs","repos_url":"https://api.github.com/users/horenmar/repos","events_url":"https://api.github.com/users/horenmar/events{/privacy}","received_events_url":"https://api.github.com/users/horenmar/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/catchorg/Catch2/issues/741/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/catchorg/Catch2/issues/741/timeline","performed_via_github_app":null,"state_reason":"completed"}