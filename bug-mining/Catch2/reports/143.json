{"url":"https://api.github.com/repos/catchorg/Catch2/issues/1426","repository_url":"https://api.github.com/repos/catchorg/Catch2","labels_url":"https://api.github.com/repos/catchorg/Catch2/issues/1426/labels{/name}","comments_url":"https://api.github.com/repos/catchorg/Catch2/issues/1426/comments","events_url":"https://api.github.com/repos/catchorg/Catch2/issues/1426/events","html_url":"https://github.com/catchorg/Catch2/issues/1426","id":374795610,"node_id":"MDU6SXNzdWUzNzQ3OTU2MTA=","number":1426,"title":"EventListener does not support verbosity other than \"normal\"","user":{"login":"hlindberg","id":563066,"node_id":"MDQ6VXNlcjU2MzA2Ng==","avatar_url":"https://avatars.githubusercontent.com/u/563066?v=4","gravatar_id":"","url":"https://api.github.com/users/hlindberg","html_url":"https://github.com/hlindberg","followers_url":"https://api.github.com/users/hlindberg/followers","following_url":"https://api.github.com/users/hlindberg/following{/other_user}","gists_url":"https://api.github.com/users/hlindberg/gists{/gist_id}","starred_url":"https://api.github.com/users/hlindberg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hlindberg/subscriptions","organizations_url":"https://api.github.com/users/hlindberg/orgs","repos_url":"https://api.github.com/users/hlindberg/repos","events_url":"https://api.github.com/users/hlindberg/events{/privacy}","received_events_url":"https://api.github.com/users/hlindberg/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":524197132,"node_id":"MDU6TGFiZWw1MjQxOTcxMzI=","url":"https://api.github.com/repos/catchorg/Catch2/labels/Revisit","name":"Revisit","color":"006b75","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-10-28T20:35:10Z","updated_at":"2018-11-05T21:38:43Z","closed_at":"2018-11-05T19:05:36Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Description\r\n`TextEventListenerBase` only supports verbosity \"normal\" and can not be used with a Report Processor that supports other verbosities and using one that is not `-v normal`.\r\n\r\n### Steps to reproduce\r\nDefine a report processor that accepts verbosities other than \"normal\" - i.e. this way:\r\n```cpp\r\n static std::set<Catch::Verbosity> getSupportedVerbosities() {\r\n    return { Catch::Verbosity::Quiet, Catch::Verbosity::Normal, Catch::Verbosity::High};\r\n}\r\n```\r\nThis report processor will then accept runs with `-v quiet` and `-v high` (as well as `-v normal`).\r\n\r\nWhen also adding an Event Listener. It no longer works to run with `-v high` or `-v quiet`. The result\r\nis that the message `Verbosity level not supported by this reporter` is printed.\r\n\r\nIt is not possible to define the `getSupportedVerbosities` in the event listener since the base class\r\nthat is required does not support parametrization. \r\n\r\nI tried this:\r\n```cpp\r\nstruct GlobalStateGuard : Catch::TestEventListenerBase {\r\n\r\nprivate:\r\n    char* tz_env_before   = NULL;\r\n\r\npublic:\r\n    using TestEventListenerBase::TestEventListenerBase; // inherit constructor\r\n\r\n    // This is called before any tests are executed. Use this method to record\r\n    // any global state that needs to be reset after each test.\r\n    //\r\n    // This implementation manages timezone and TZ environment variable\r\n    //\r\n    void testRunStarting(Catch::TestRunInfo const& testRunInfo) override {\r\n        // remember the TZ in effect\r\n        tz_env_before = getenv(\"TZ\");\r\n        // Cause side effects of setting TZ (timezone and other external variables are set).\r\n        tzset();\r\n    }\r\n\r\n    void testCaseEnded( Catch::TestCaseStats const& testCaseStats ) override {\r\n        // Reset timezone and cause side effects (setting external timezone etc) by\r\n        // calling tzset. It is ok if tz_env_before is NULL - that is taken as UTC.\r\n        //\r\n        setenv(\"TZ\", tz_env_before, 1);\r\n        tzset();\r\n    }\r\n\r\n    /*  Must state it accepts all verbosities or it will fail with verbosity\r\n     * is something other than \"normal\"\r\n     */\r\n    static std::set<Catch::Verbosity> getSupportedVerbosities() {\r\n        return { Catch::Verbosity::Quiet, Catch::Verbosity::Normal, Catch::Verbosity::High};\r\n    }\r\n\r\n};\r\nCATCH_REGISTER_LISTENER( GlobalStateGuard )\r\n```\r\nAnd the `getSupportedVerbosities` has no effect since the framework will call the default\r\nversion of that method in `StreamingReporterBase<TestEventListenerBase>`\r\n\r\nIf I patch `StreamingReporterBase<TestEventListenerBase>` and include\r\nthe static `getSupportedVerbosities` there - it works using `-v high` and `-v quiet`\r\n\r\n### Suggestion\r\nEither make event listeners accept all verbosities (is perhaps the best, since why would it matter?), or make the base class for event listeners templated so it is possible to specify\r\nthat it supports different verbosities.\r\n\r\n### Extra information\r\n* Catch Version 2.4.1\r\n","closed_by":{"login":"horenmar","id":9026413,"node_id":"MDQ6VXNlcjkwMjY0MTM=","avatar_url":"https://avatars.githubusercontent.com/u/9026413?v=4","gravatar_id":"","url":"https://api.github.com/users/horenmar","html_url":"https://github.com/horenmar","followers_url":"https://api.github.com/users/horenmar/followers","following_url":"https://api.github.com/users/horenmar/following{/other_user}","gists_url":"https://api.github.com/users/horenmar/gists{/gist_id}","starred_url":"https://api.github.com/users/horenmar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/horenmar/subscriptions","organizations_url":"https://api.github.com/users/horenmar/orgs","repos_url":"https://api.github.com/users/horenmar/repos","events_url":"https://api.github.com/users/horenmar/events{/privacy}","received_events_url":"https://api.github.com/users/horenmar/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/catchorg/Catch2/issues/1426/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/catchorg/Catch2/issues/1426/timeline","performed_via_github_app":null,"state_reason":"completed"}