{"url":"https://api.github.com/repos/catchorg/Catch2/issues/2615","repository_url":"https://api.github.com/repos/catchorg/Catch2","labels_url":"https://api.github.com/repos/catchorg/Catch2/issues/2615/labels{/name}","comments_url":"https://api.github.com/repos/catchorg/Catch2/issues/2615/comments","events_url":"https://api.github.com/repos/catchorg/Catch2/issues/2615/events","html_url":"https://github.com/catchorg/Catch2/issues/2615","id":1525511165,"node_id":"I_kwDOABA2rM5a7XP9","number":2615,"title":"Generator Constructor Exception causes a Null-Pointer-Dereference","user":{"login":"BurningEnlightenment","id":5796962,"node_id":"MDQ6VXNlcjU3OTY5NjI=","avatar_url":"https://avatars.githubusercontent.com/u/5796962?v=4","gravatar_id":"","url":"https://api.github.com/users/BurningEnlightenment","html_url":"https://github.com/BurningEnlightenment","followers_url":"https://api.github.com/users/BurningEnlightenment/followers","following_url":"https://api.github.com/users/BurningEnlightenment/following{/other_user}","gists_url":"https://api.github.com/users/BurningEnlightenment/gists{/gist_id}","starred_url":"https://api.github.com/users/BurningEnlightenment/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BurningEnlightenment/subscriptions","organizations_url":"https://api.github.com/users/BurningEnlightenment/orgs","repos_url":"https://api.github.com/users/BurningEnlightenment/repos","events_url":"https://api.github.com/users/BurningEnlightenment/events{/privacy}","received_events_url":"https://api.github.com/users/BurningEnlightenment/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":513089685,"node_id":"MDU6TGFiZWw1MTMwODk2ODU=","url":"https://api.github.com/repos/catchorg/Catch2/labels/Bug","name":"Bug","color":"e99695","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2023-01-09T12:31:46Z","updated_at":"2023-01-22T15:05:04Z","closed_at":"2023-01-22T15:05:03Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Describe the bug**\r\nIf a constructor of a generator throws a `Catch::GeneratorException` to indicate initialization failure, the catch framework attempts to dereference a null pointer which causes the application to crash. This precludes running any test cases scheduled to run afterwards.\r\n\r\n**Expected behavior**\r\nThe test application should not crash and run any remaining test cases.\r\n\r\n**Reproduction steps / MCVE**\r\n```cpp\r\n#include <catch2/catch_test_macros.hpp>\r\n#include <catch2/generators/catch_generator_exception.hpp>\r\n#include <catch2/generators/catch_generators.hpp>\r\n#include <catch2/generators/catch_generators_range.hpp>\r\n\r\nclass test_generator : public Catch::Generators::IGenerator<int>\r\n{\r\npublic:\r\n    explicit test_generator()\r\n    {\r\n        // removing the following line will cause the program to terminate gracefully.\r\n        throw Catch::GeneratorException(\"failure to init\");\r\n    }\r\n\r\n    [[nodiscard]] auto get() const -> int const & override\r\n    {\r\n        static constexpr int value = 1;\r\n        return value;\r\n    }\r\n\r\n    [[nodiscard]] auto next() -> bool override\r\n    {\r\n        return false;\r\n    }\r\n};\r\n\r\nauto make_test_generator() -> Catch::Generators::GeneratorWrapper<int>\r\n{\r\n    return {new test_generator()};\r\n}\r\n\r\nTEST_CASE(\"this will segfault\")\r\n{\r\n    // this should fail the test case, but not abort the application\r\n    auto sample = GENERATE(make_test_generator());\r\n    // this assertion shouldn't trigger\r\n    REQUIRE(sample == 0U);\r\n}\r\n\r\nTEST_CASE(\"this won't run\")\r\n{\r\n    // this assertion should trigger and be reported\r\n    REQUIRE(1U == 0U);\r\n}\r\n```\r\n[MCVE on godbolt]\r\n\r\n**Platform information:**\r\n<!-- Fill in any extra information that might be important for your issue. -->\r\n|OS|Compiler|Catch version|\r\n|---|---|---|\r\n|Win10|MSVC 14.34.31933|v3.1.1|\r\n|compiler-explorer linux image|GCC 12.2|trunk/v3.2.1|\r\n\r\n\r\n**Additional context**\r\nNone\r\n\r\n[MCVE on godbolt]: https://godbolt.org/#g:!((g:!((g:!((h:codeEditor,i:(filename:'1',fontScale:14,fontUsePx:'0',j:1,lang:c%2B%2B,selection:(endColumn:2,endLineNumber:45,positionColumn:2,positionLineNumber:45,selectionStartColumn:1,selectionStartLineNumber:1,startColumn:1,startLineNumber:1),source:'%23include+%3Ccatch2/catch_test_macros.hpp%3E%0A%23include+%3Ccatch2/generators/catch_generator_exception.hpp%3E%0A%23include+%3Ccatch2/generators/catch_generators.hpp%3E%0A%23include+%3Ccatch2/generators/catch_generators_range.hpp%3E%0A%0Aclass+test_generator+:+public+Catch::Generators::IGenerator%3Cint%3E%0A%7B%0Apublic:%0A++++explicit+test_generator()%0A++++%7B%0A++++++++//+removing+the+following+line+will+cause+the+program+to%0A++++++++//+terminate+gracefully.%0A++++++++throw+Catch::GeneratorException(%22failure+to+init%22)%3B%0A++++%7D%0A%0A++++%5B%5Bnodiscard%5D%5D+auto+get()+const+-%3E+int+const+%26+override%0A++++%7B%0A++++++++static+constexpr+int+value+%3D+1%3B%0A++++++++return+value%3B%0A++++%7D%0A%0A++++%5B%5Bnodiscard%5D%5D+auto+next()+-%3E+bool+override%0A++++%7B%0A++++++++return+false%3B%0A++++%7D%0A%7D%3B%0A%0Aauto+make_test_generator()+-%3E+Catch::Generators::GeneratorWrapper%3Cint%3E%0A%7B%0A++++return+%7Bnew+test_generator()%7D%3B%0A%7D%0A%0ATEST_CASE(%22this+will+segfault%22)%0A%7B%0A++++//+this+should+fail+the+test+case,+but+not+abort+the+application%0A++++auto+sample+%3D+GENERATE(make_test_generator())%3B%0A++++//+this+assertion+shouldn!'t+trigger%0A++++REQUIRE(sample+%3D%3D+0U)%3B%0A%7D%0A%0ATEST_CASE(%22this+won!'t+run%22)%0A%7B%0A++++//+this+assertion+should+trigger+and+be+reported%0A++++REQUIRE(1U+%3D%3D+0U)%3B%0A%7D'),l:'5',n:'0',o:'C%2B%2B+source+%231',t:'0')),k:50,l:'4',n:'0',o:'',s:0,t:'0'),(g:!((h:compiler,i:(compiler:g122,deviceViewOpen:'1',filters:(b:'0',binary:'1',commentOnly:'0',demangle:'0',directives:'0',execute:'1',intel:'0',libraryCode:'0',trim:'1'),flagsViewOpen:'1',fontScale:14,fontUsePx:'0',j:1,lang:c%2B%2B,libs:!((name:catch2,ver:trunk)),options:'-std%3Dc%2B%2B20',selection:(endColumn:1,endLineNumber:1,positionColumn:1,positionLineNumber:1,selectionStartColumn:1,selectionStartLineNumber:1,startColumn:1,startLineNumber:1),source:1),l:'5',n:'0',o:'+x86-64+gcc+12.2+(Editor+%231)',t:'0'),(h:executor,i:(argsPanelShown:'1',compilationPanelShown:'0',compiler:g122,compilerOutShown:'0',execArgs:'',execStdin:'',fontScale:14,fontUsePx:'0',j:1,lang:c%2B%2B,libs:!((name:catch2,ver:trunk)),options:'-std%3Dc%2B%2B20+-lCatch2Maind',source:1,stdinPanelShown:'1',tree:'1',wrap:'1'),l:'5',n:'0',o:'Executor+x86-64+gcc+12.2+(C%2B%2B,+Editor+%231)',t:'0')),k:50,l:'4',m:100,n:'0',o:'',s:1,t:'0')),l:'2',n:'0',o:'',t:'0')),version:4","closed_by":{"login":"horenmar","id":9026413,"node_id":"MDQ6VXNlcjkwMjY0MTM=","avatar_url":"https://avatars.githubusercontent.com/u/9026413?v=4","gravatar_id":"","url":"https://api.github.com/users/horenmar","html_url":"https://github.com/horenmar","followers_url":"https://api.github.com/users/horenmar/followers","following_url":"https://api.github.com/users/horenmar/following{/other_user}","gists_url":"https://api.github.com/users/horenmar/gists{/gist_id}","starred_url":"https://api.github.com/users/horenmar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/horenmar/subscriptions","organizations_url":"https://api.github.com/users/horenmar/orgs","repos_url":"https://api.github.com/users/horenmar/repos","events_url":"https://api.github.com/users/horenmar/events{/privacy}","received_events_url":"https://api.github.com/users/horenmar/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/catchorg/Catch2/issues/2615/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/catchorg/Catch2/issues/2615/timeline","performed_via_github_app":null,"state_reason":"completed"}