{"url":"https://api.github.com/repos/catchorg/Catch2/issues/2344","repository_url":"https://api.github.com/repos/catchorg/Catch2","labels_url":"https://api.github.com/repos/catchorg/Catch2/issues/2344/labels{/name}","comments_url":"https://api.github.com/repos/catchorg/Catch2/issues/2344/comments","events_url":"https://api.github.com/repos/catchorg/Catch2/issues/2344/events","html_url":"https://github.com/catchorg/Catch2/issues/2344","id":1093562160,"node_id":"I_kwDOABA2rM5BLm8w","number":2344,"title":"Add option for disabling trivial ABI attribute on unique_ptr","user":{"login":"psalz","id":791348,"node_id":"MDQ6VXNlcjc5MTM0OA==","avatar_url":"https://avatars.githubusercontent.com/u/791348?v=4","gravatar_id":"","url":"https://api.github.com/users/psalz","html_url":"https://github.com/psalz","followers_url":"https://api.github.com/users/psalz/followers","following_url":"https://api.github.com/users/psalz/following{/other_user}","gists_url":"https://api.github.com/users/psalz/gists{/gist_id}","starred_url":"https://api.github.com/users/psalz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/psalz/subscriptions","organizations_url":"https://api.github.com/users/psalz/orgs","repos_url":"https://api.github.com/users/psalz/repos","events_url":"https://api.github.com/users/psalz/events{/privacy}","received_events_url":"https://api.github.com/users/psalz/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":513139480,"node_id":"MDU6TGFiZWw1MTMxMzk0ODA=","url":"https://api.github.com/repos/catchorg/Catch2/labels/Tweak%20request","name":"Tweak request","color":"c2e0c6","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2022-01-04T16:51:44Z","updated_at":"2022-01-05T15:36:58Z","closed_at":"2022-01-05T09:23:38Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Description**\r\n\r\nAs noted in the message of the commit introducing the `[[trivial_abi]]` attribute for `Detail::unique_ptr` (1d79683e), this optimization breaks linking of objects compiled with Clang and GCC. While that has always been a \"use at your own risk\" feature, in my experience it basically worked in all but the most esoteric scenarios. However, with the aforementioned change, it now consistently produces segfaults for me. I'm wondering whether there would be interest in adding some kind of compile time option for disabling the `[[trivial_abi]]` attribute, restoring the previous works-most-of-the-time behavior.\r\n\r\n**Additional context**\r\n\r\nI'm in the process of migrating the [Khronos Group SYCL Conformance Test Suite](https://github.com/KhronosGroup/SYCL-CTS/) to Catch2. The SYCL ecosystem is still relatively young and different implementors are using different mechanisms for integrating their implementations with CMake. For example they might set `CMAKE_CXX_COMPILER` on the CLI or inside a `CMakeLists.txt`, use a custom compiler launcher or custom build steps with dedicated device compiler passes. Whatever the method, it currently can (and does) happen that object files compiled with GCC (typically the default compiler on a given system) get linked with object files compiled with some Clang derivative (most SYCL implementations rely on LLVM in some form).\r\n\r\nWhile ultimately this is a problem that implementors will have to figure out how to best deal with, sorting this stuff out takes time. So in the interest of completing the Catch2 migration sooner than later, I'm hoping we can find a workaround here!","closed_by":{"login":"horenmar","id":9026413,"node_id":"MDQ6VXNlcjkwMjY0MTM=","avatar_url":"https://avatars.githubusercontent.com/u/9026413?v=4","gravatar_id":"","url":"https://api.github.com/users/horenmar","html_url":"https://github.com/horenmar","followers_url":"https://api.github.com/users/horenmar/followers","following_url":"https://api.github.com/users/horenmar/following{/other_user}","gists_url":"https://api.github.com/users/horenmar/gists{/gist_id}","starred_url":"https://api.github.com/users/horenmar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/horenmar/subscriptions","organizations_url":"https://api.github.com/users/horenmar/orgs","repos_url":"https://api.github.com/users/horenmar/repos","events_url":"https://api.github.com/users/horenmar/events{/privacy}","received_events_url":"https://api.github.com/users/horenmar/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/catchorg/Catch2/issues/2344/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/catchorg/Catch2/issues/2344/timeline","performed_via_github_app":null,"state_reason":"completed"}