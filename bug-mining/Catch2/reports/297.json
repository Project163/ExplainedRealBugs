{"url":"https://api.github.com/repos/catchorg/Catch2/issues/1593","repository_url":"https://api.github.com/repos/catchorg/Catch2","labels_url":"https://api.github.com/repos/catchorg/Catch2/issues/1593/labels{/name}","comments_url":"https://api.github.com/repos/catchorg/Catch2/issues/1593/comments","events_url":"https://api.github.com/repos/catchorg/Catch2/issues/1593/events","html_url":"https://github.com/catchorg/Catch2/issues/1593","id":430581683,"node_id":"MDU6SXNzdWU0MzA1ODE2ODM=","number":1593,"title":"Empty generator results in segmentation fault","user":{"login":"nielsbuwen","id":9267463,"node_id":"MDQ6VXNlcjkyNjc0NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9267463?v=4","gravatar_id":"","url":"https://api.github.com/users/nielsbuwen","html_url":"https://github.com/nielsbuwen","followers_url":"https://api.github.com/users/nielsbuwen/followers","following_url":"https://api.github.com/users/nielsbuwen/following{/other_user}","gists_url":"https://api.github.com/users/nielsbuwen/gists{/gist_id}","starred_url":"https://api.github.com/users/nielsbuwen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nielsbuwen/subscriptions","organizations_url":"https://api.github.com/users/nielsbuwen/orgs","repos_url":"https://api.github.com/users/nielsbuwen/repos","events_url":"https://api.github.com/users/nielsbuwen/events{/privacy}","received_events_url":"https://api.github.com/users/nielsbuwen/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2019-04-08T17:55:44Z","updated_at":"2023-08-06T08:19:48Z","closed_at":"2023-05-31T13:37:29Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Describe the bug**\r\nA test case containing an empty generator (one that will never generate any elements) results in a segmentation fault when that test case is run.\r\n\r\n```\r\nrunner.cpp:6: FAILED:\r\ndue to a fatal error condition:\r\n  SIGABRT - Abort (abnormal termination) signal\r\n\r\n===============================================================================\r\ntest cases: 1 | 1 failed\r\nassertions: 1 | 1 failed\r\n```\r\n\r\n**Expected behavior**\r\nThere should be no segfault. I would guess that the test case should not run at all if the generator is empty.\r\n\r\n**Reproduction steps**\r\nCompile this minimal example and run it.\r\n\r\n```\r\n#define CATCH_CONFIG_MAIN\r\n#include <catch.hpp>\r\n\r\nTEST_CASE(\"Empty Generator\")\r\n{\r\n    GENERATE(take(0, value(1)));\r\n}\r\n```\r\n\r\n\r\n**Platform information:**\r\n<!-- Fill in any extra information that might be important for your issue. -->\r\n - OS: CentOS Linux release 7.4.1708 (Core) \r\n - Compiler+version: gcc 4.8.5 (with `-std=c++11`) or clang 7.0.0 \r\n - Catch version: **v2.7.1**\r\n\r\n\r\n**Additional context**\r\nRational why i use empty generators: I modified to command line interface to accept a number of items i want to test:\r\n\r\n```\r\n./tests --item 42 --item 1337\r\n```\r\n\r\nThese items are put into a vector which is wrapped in a generator.\r\n\r\n```\r\nTEST_CASE(\"Test Items\")\r\n{\r\n    auto item = GENERATE(items());\r\n    // test item\r\n}   \r\n```\r\n\r\nSome test cases use these items and some don't. If i don't specify any items i get a segfault otherwise it works perfectly. As a work-around i could exclude the item tests from the rest but that is annoying.\r\n\r\nIt seems impossible to fix that issue with the current `IGenerator` interface as there is no way to check if the generator is empty **before** calling `next()`.\r\n\r\nI don't know the internals of Catch2, but these ideas came to my mind:\r\n\r\nA different interface could look like this:\r\n- `bool has_next() const` to check whether it is safe to call `get_next`\r\n- `T get_next()` to return the current value and advance the generator\r\n\r\nOr like python does it (i like python :) )\r\n- a single `T next()` that return the current item and advances the generator. If the generator exhausted `throw` an exception instead.\r\n\r\nOr use the C++ iterator concepts (these may be entirely wrong):\r\n- `T operator*() const` to return the current item\r\n- `operator++()` to create the next value\r\n- `operator!=(const IGenerator<T>&) const` to compare two generators\r\n\r\n**Edit:**\r\nAnother idea, that might work with the current interface: Add a `bool empty() const` method to the generator interface with a default implementation that simply returns an internally stored flag which starts with the value `true`. A call to `next()` can then update the flag. An empty generator can then set that flag to `false` in its constructor. The part that runs the tests and pulls out elements from the generator can then check the `empty()` method instead.","closed_by":{"login":"horenmar","id":9026413,"node_id":"MDQ6VXNlcjkwMjY0MTM=","avatar_url":"https://avatars.githubusercontent.com/u/9026413?v=4","gravatar_id":"","url":"https://api.github.com/users/horenmar","html_url":"https://github.com/horenmar","followers_url":"https://api.github.com/users/horenmar/followers","following_url":"https://api.github.com/users/horenmar/following{/other_user}","gists_url":"https://api.github.com/users/horenmar/gists{/gist_id}","starred_url":"https://api.github.com/users/horenmar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/horenmar/subscriptions","organizations_url":"https://api.github.com/users/horenmar/orgs","repos_url":"https://api.github.com/users/horenmar/repos","events_url":"https://api.github.com/users/horenmar/events{/privacy}","received_events_url":"https://api.github.com/users/horenmar/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/catchorg/Catch2/issues/1593/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/catchorg/Catch2/issues/1593/timeline","performed_via_github_app":null,"state_reason":"completed"}