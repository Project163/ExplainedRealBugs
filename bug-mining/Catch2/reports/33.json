{"url":"https://api.github.com/repos/catchorg/Catch2/issues/810","repository_url":"https://api.github.com/repos/catchorg/Catch2","labels_url":"https://api.github.com/repos/catchorg/Catch2/issues/810/labels{/name}","comments_url":"https://api.github.com/repos/catchorg/Catch2/issues/810/comments","events_url":"https://api.github.com/repos/catchorg/Catch2/issues/810/events","html_url":"https://github.com/catchorg/Catch2/issues/810","id":205666814,"node_id":"MDU6SXNzdWUyMDU2NjY4MTQ=","number":810,"title":"catch triggers infinite SEH exceptions in some cases","user":{"login":"blastrock","id":1370530,"node_id":"MDQ6VXNlcjEzNzA1MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1370530?v=4","gravatar_id":"","url":"https://api.github.com/users/blastrock","html_url":"https://github.com/blastrock","followers_url":"https://api.github.com/users/blastrock/followers","following_url":"https://api.github.com/users/blastrock/following{/other_user}","gists_url":"https://api.github.com/users/blastrock/gists{/gist_id}","starred_url":"https://api.github.com/users/blastrock/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/blastrock/subscriptions","organizations_url":"https://api.github.com/users/blastrock/orgs","repos_url":"https://api.github.com/users/blastrock/repos","events_url":"https://api.github.com/users/blastrock/events{/privacy}","received_events_url":"https://api.github.com/users/blastrock/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":513089685,"node_id":"MDU6TGFiZWw1MTMwODk2ODU=","url":"https://api.github.com/repos/catchorg/Catch2/labels/Bug","name":"Bug","color":"e99695","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2017-02-06T18:18:39Z","updated_at":"2017-03-02T17:20:12Z","closed_at":"2017-03-02T17:19:30Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Description\r\n\r\nOn windows, when a crash occur, catch may make the program crash a second time instead of gracefully handling the crash and quitting. This goes on infinitely, until the stack overflows I think.\r\n\r\n### Steps to reproduce\r\n\r\n```cpp\r\n  std::vector<char>* str = reinterpret_cast<std::vector<char>*>(0x1234458);\r\n  CHECK(*str == std::vector<char>());\r\n```\r\n\r\n### Extra information\r\n\r\nOn my machine, this bug happens only when compiled in RelWithDebInfo, not in Debug. Also, I am using the JUnit reporter and writing the output to a file, but I'm not sure this matters.\r\n\r\nIt seems that the comparison doesn't crash, somehow, but Catch tries to expand the expression. When it tries to do that, the program crashes and handleVectoredException is called, which in turn tries to print the capture exception and makes another exception trigger again.\r\n\r\nHere is the full stack trace. The first exception is at the ntdll.dll marker, and the second is at the top.\r\n\r\n    test_submarine.exe!Catch::Detail::rangeToString<std::_Vector_const_iterator<std::_Vector_val<std::_Simple_types<char> > > >(std::_Vector_const_iterator<std::_Vector_val<std::_Simple_types<char> > > first, std::_Vector_const_iterator<std::_Vector_val<std::_Simple_types<char> > > last) Line 1853\tC++\r\n    test_submarine.exe!Catch::toString<char,std::allocator<char> >(const std::vector<char,std::allocator<char> > & v) Line 1783\tC++\r\n    test_submarine.exe!Catch::BinaryExpression<std::vector<char,std::allocator<char> > const &,0,std::vector<char,std::allocator<char> > const &>::reconstructExpression(std::basic_string<char,std::char_traits<char>,std::allocator<char> > & dest) Line 1969\tC++\r\n    test_submarine.exe!Catch::AssertionResult::getExpandedExpression() Line 7750\tC++\r\n    test_submarine.exe!Catch::JunitReporter::writeAssertion(const Catch::AssertionStats & stats) Line 10006\tC++\r\n    test_submarine.exe!Catch::JunitReporter::writeSection(const std::basic_string<char,std::char_traits<char>,std::allocator<char> > & className, const std::basic_string<char,std::char_traits<char>,std::allocator<char> > & rootName, const Catch::CumulativeReporterBase::SectionNode & sectionNode) Line 9949\tC++\r\n    test_submarine.exe!Catch::JunitReporter::writeTestCase(const Catch::CumulativeReporterBase::Node<Catch::TestCaseStats,Catch::CumulativeReporterBase::SectionNode> & testCaseNode) Line 9925\tC++\r\n    test_submarine.exe!Catch::JunitReporter::writeGroup(const Catch::CumulativeReporterBase::Node<Catch::TestGroupStats,Catch::CumulativeReporterBase::Node<Catch::TestCaseStats,Catch::CumulativeReporterBase::SectionNode> > & groupNode, double suiteTime) Line 9904\tC++\r\n    test_submarine.exe!Catch::JunitReporter::testGroupEnded(const Catch::TestGroupStats & testGroupStats) Line 9878\tC++\r\n    test_submarine.exe!Catch::RunContext::testGroupEnded(const std::basic_string<char,std::char_traits<char>,std::allocator<char> > & testSpec, const Catch::Totals & totals, unsigned int groupIndex, unsigned int groupsCount) Line 6325\tC++\r\n    test_submarine.exe!Catch::RunContext::handleFatalErrorCondition(const std::basic_string<char,std::char_traits<char>,std::allocator<char> > & message) Line 6492\tC++\r\n    test_submarine.exe!Catch::reportFatal(const std::basic_string<char,std::char_traits<char>,std::allocator<char> > & message) Line 6115\tC++\r\n    >\ttest_submarine.exe!Catch::FatalConditionHandler::handleVectoredException(_EXCEPTION_POINTERS * ExceptionInfo) Line 6147\tC++\r\n    ntdll.dll!770367e2()\tUnknown\r\n    [Frames below may be incorrect and/or missing, no symbols loaded for ntdll.dll]\t\r\n    test_submarine.exe!std::allocator<char>::allocate(unsigned int _Count) Line 625\tC++\r\n    test_submarine.exe!Catch::AssertionResult::expandDecomposedExpression() Line 7769\tC++\r\n    test_submarine.exe!Catch::CumulativeReporterBase::prepareExpandedExpression(Catch::AssertionResult & result) Line 9237\tC++\r\n    test_submarine.exe!Catch::JunitReporter::assertionEnded(const Catch::AssertionStats & assertionStats) Line 9866\tC++\r\n    test_submarine.exe!Catch::RunContext::assertionEnded(const Catch::AssertionResult & result) Line 6386\tC++\r\n    test_submarine.exe!Catch::ResultBuilder::handleResult(const Catch::AssertionResult & result) Line 8752\tC++\r\n    test_submarine.exe!Catch::ResultBuilder::endExpression(const Catch::DecomposedExpression & expr) Line 8707\tC++\r\n    test_submarine.exe!____C_A_T_C_H____T_E_S_T____2() Line 21\tC++\r\n\r\nCatch should somehow not try to expand expressions when it is handling a fatal exception.\r\n\r\n* Catch version: **v1.7.0**\r\n* Operating System: **Windows 8.1**\r\n* Compiler+version: **visual studio 2015 update 2**\r\n","closed_by":{"login":"horenmar","id":9026413,"node_id":"MDQ6VXNlcjkwMjY0MTM=","avatar_url":"https://avatars.githubusercontent.com/u/9026413?v=4","gravatar_id":"","url":"https://api.github.com/users/horenmar","html_url":"https://github.com/horenmar","followers_url":"https://api.github.com/users/horenmar/followers","following_url":"https://api.github.com/users/horenmar/following{/other_user}","gists_url":"https://api.github.com/users/horenmar/gists{/gist_id}","starred_url":"https://api.github.com/users/horenmar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/horenmar/subscriptions","organizations_url":"https://api.github.com/users/horenmar/orgs","repos_url":"https://api.github.com/users/horenmar/repos","events_url":"https://api.github.com/users/horenmar/events{/privacy}","received_events_url":"https://api.github.com/users/horenmar/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/catchorg/Catch2/issues/810/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/catchorg/Catch2/issues/810/timeline","performed_via_github_app":null,"state_reason":"completed"}