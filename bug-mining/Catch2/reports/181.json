{"url":"https://api.github.com/repos/catchorg/Catch2/issues/1649","repository_url":"https://api.github.com/repos/catchorg/Catch2","labels_url":"https://api.github.com/repos/catchorg/Catch2/issues/1649/labels{/name}","comments_url":"https://api.github.com/repos/catchorg/Catch2/issues/1649/comments","events_url":"https://api.github.com/repos/catchorg/Catch2/issues/1649/events","html_url":"https://github.com/catchorg/Catch2/issues/1649","id":451150700,"node_id":"MDU6SXNzdWU0NTExNTA3MDA=","number":1649,"title":"Better support for testing exception","user":{"login":"AlexisWilke","id":1028617,"node_id":"MDQ6VXNlcjEwMjg2MTc=","avatar_url":"https://avatars.githubusercontent.com/u/1028617?v=4","gravatar_id":"","url":"https://api.github.com/users/AlexisWilke","html_url":"https://github.com/AlexisWilke","followers_url":"https://api.github.com/users/AlexisWilke/followers","following_url":"https://api.github.com/users/AlexisWilke/following{/other_user}","gists_url":"https://api.github.com/users/AlexisWilke/gists{/gist_id}","starred_url":"https://api.github.com/users/AlexisWilke/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlexisWilke/subscriptions","organizations_url":"https://api.github.com/users/AlexisWilke/orgs","repos_url":"https://api.github.com/users/AlexisWilke/repos","events_url":"https://api.github.com/users/AlexisWilke/events{/privacy}","received_events_url":"https://api.github.com/users/AlexisWilke/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":513089975,"node_id":"MDU6TGFiZWw1MTMwODk5NzU=","url":"https://api.github.com/repos/catchorg/Catch2/labels/Feature%20Request","name":"Feature Request","color":"0e8a16","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-06-02T04:08:58Z","updated_at":"2019-10-13T18:37:38Z","closed_at":"2019-10-13T18:37:38Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Description**\r\n\r\nI was thinking I could just check the `what()` string of an exception in Catch2. The fact is I had to write my own Matcher.\r\n\r\nIt seems to me that since a fairly standard exception is expected to have a `what()` returning a string which we could match, that it would make sense to offer such a generic Matcher.\r\n\r\n**Example Matcher**\r\n\r\nI wrote my own `std::exception` Matcher which looks as follow. Using it with `CATCH_REQUIRE_THROWS_MATCHES()` is very simple:\r\n\r\n        CATCH_REQUIRE_THROWS_MATCHES(std::make_shared<advgetopt::getopt>(options_environment, sub_argc, sub_argv)\r\n                    , advgetopt::getopt_exception_logic\r\n                    , Catch::Matchers::ExceptionMessage(\r\n                              \"section \\\"invalid::name\\\" includes a section separator (::) in \\\"\"\r\n                            + options_filename\r\n                            + \"\\\". We only support one level.\"));\r\n\r\nI think this is much cleaner than having to have a `toString()` or and `operator std::string()` in your exceptions. This is much more generic.\r\n\r\n    namespace Catch\r\n    {\r\n    namespace Matchers\r\n    {\r\n\r\n\r\n    class ExceptionWatcher\r\n        : public MatcherBase<std::exception>\r\n    {\r\n    public:\r\n        ExceptionWatcher(std::string const & expected_message)\r\n            : m_expected_message(expected_message)\r\n        {\r\n        }\r\n\r\n        /** \\brief Check whether we got a match.\r\n         *\r\n         * This function compares the expected string with the actual exception\r\n         * what() output.\r\n         */\r\n        bool match(std::exception const & e) const override\r\n        {\r\n            return e.what() == m_expected_message;\r\n        }\r\n\r\n        /** \\brief Describe this matcher.\r\n         *\r\n         * This function produces a string describing what this matcher does.\r\n         *\r\n         * \\return The description of this matcher.\r\n         */\r\n        virtual std::string describe() const override\r\n        {\r\n            return \"compare the exception what() message with \\\"\"\r\n                 + m_expected_message\r\n                 + \"\\\".\";\r\n        }\r\n\r\n    private:\r\n        std::string     m_expected_message = std::string();\r\n    };\r\n\r\n\r\n    inline ExceptionWatcher ExceptionMessage(std::string const & expeted_message)\r\n    {\r\n        return ExceptionWatcher(expeted_message);\r\n    }\r\n\r\n\r\n\r\n    }\r\n    // Matchers namespace\r\n    }\r\n    // Catch namespace\r\n\r\n**Cons?**\r\n\r\nI know some people like to create their own exceptions from scratch, although I've seen many projects and more and more I see exceptions being properly derived from `std::runtime_error` or `std::logic_error`. So I have hope that having such a generic Watcher in Catch2 will be considered. Maybe even have a `<string>_e` which automatically converts said string to that generic exception Watcher.\r\n\r\nSo in effect I don't personally see any cons (outside of having to maintain one more class and maybe a few more functions.)\r\n\r\nAlso I was wondering how I could have access to all the string Watchers functionality (i.e. StartWith, EndsWith, Contains... instead of just `return e.what() == m_expected_message;` because that can prove difficult when a exception message contains a run-time value.)","closed_by":{"login":"horenmar","id":9026413,"node_id":"MDQ6VXNlcjkwMjY0MTM=","avatar_url":"https://avatars.githubusercontent.com/u/9026413?v=4","gravatar_id":"","url":"https://api.github.com/users/horenmar","html_url":"https://github.com/horenmar","followers_url":"https://api.github.com/users/horenmar/followers","following_url":"https://api.github.com/users/horenmar/following{/other_user}","gists_url":"https://api.github.com/users/horenmar/gists{/gist_id}","starred_url":"https://api.github.com/users/horenmar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/horenmar/subscriptions","organizations_url":"https://api.github.com/users/horenmar/orgs","repos_url":"https://api.github.com/users/horenmar/repos","events_url":"https://api.github.com/users/horenmar/events{/privacy}","received_events_url":"https://api.github.com/users/horenmar/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/catchorg/Catch2/issues/1649/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/catchorg/Catch2/issues/1649/timeline","performed_via_github_app":null,"state_reason":"completed"}