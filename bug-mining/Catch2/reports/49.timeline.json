[{"url":"https://api.github.com/repos/catchorg/Catch2/issues/comments/290479003","html_url":"https://github.com/catchorg/Catch2/issues/875#issuecomment-290479003","issue_url":"https://api.github.com/repos/catchorg/Catch2/issues/875","id":290479003,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MDQ3OTAwMw==","user":{"login":"horenmar","id":9026413,"node_id":"MDQ6VXNlcjkwMjY0MTM=","avatar_url":"https://avatars.githubusercontent.com/u/9026413?v=4","gravatar_id":"","url":"https://api.github.com/users/horenmar","html_url":"https://github.com/horenmar","followers_url":"https://api.github.com/users/horenmar/followers","following_url":"https://api.github.com/users/horenmar/following{/other_user}","gists_url":"https://api.github.com/users/horenmar/gists{/gist_id}","starred_url":"https://api.github.com/users/horenmar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/horenmar/subscriptions","organizations_url":"https://api.github.com/users/horenmar/orgs","repos_url":"https://api.github.com/users/horenmar/repos","events_url":"https://api.github.com/users/horenmar/events{/privacy}","received_events_url":"https://api.github.com/users/horenmar/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-03-30T17:14:48Z","updated_at":"2017-03-30T17:14:48Z","body":"[I probably should have mentioned other macros as well as assertions, but Catch is not thread safe.](/philsquared/Catch/blob/master/docs/limitations.md#thread-safe-assertions)","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/catchorg/Catch2/issues/comments/290479003/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"horenmar","id":9026413,"node_id":"MDQ6VXNlcjkwMjY0MTM=","avatar_url":"https://avatars.githubusercontent.com/u/9026413?v=4","gravatar_id":"","url":"https://api.github.com/users/horenmar","html_url":"https://github.com/horenmar","followers_url":"https://api.github.com/users/horenmar/followers","following_url":"https://api.github.com/users/horenmar/following{/other_user}","gists_url":"https://api.github.com/users/horenmar/gists{/gist_id}","starred_url":"https://api.github.com/users/horenmar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/horenmar/subscriptions","organizations_url":"https://api.github.com/users/horenmar/orgs","repos_url":"https://api.github.com/users/horenmar/repos","events_url":"https://api.github.com/users/horenmar/events{/privacy}","received_events_url":"https://api.github.com/users/horenmar/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/catchorg/Catch2/issues/comments/290481767","html_url":"https://github.com/catchorg/Catch2/issues/875#issuecomment-290481767","issue_url":"https://api.github.com/repos/catchorg/Catch2/issues/875","id":290481767,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MDQ4MTc2Nw==","user":{"login":"theWayofthecode","id":493190,"node_id":"MDQ6VXNlcjQ5MzE5MA==","avatar_url":"https://avatars.githubusercontent.com/u/493190?v=4","gravatar_id":"","url":"https://api.github.com/users/theWayofthecode","html_url":"https://github.com/theWayofthecode","followers_url":"https://api.github.com/users/theWayofthecode/followers","following_url":"https://api.github.com/users/theWayofthecode/following{/other_user}","gists_url":"https://api.github.com/users/theWayofthecode/gists{/gist_id}","starred_url":"https://api.github.com/users/theWayofthecode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/theWayofthecode/subscriptions","organizations_url":"https://api.github.com/users/theWayofthecode/orgs","repos_url":"https://api.github.com/users/theWayofthecode/repos","events_url":"https://api.github.com/users/theWayofthecode/events{/privacy}","received_events_url":"https://api.github.com/users/theWayofthecode/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-03-30T17:24:31Z","updated_at":"2017-03-30T17:24:31Z","body":"I see. In that case I believe it would be helpful to mention it also in the \"Assertion macros\" \"Logging macros\" doc files in the reference section. ","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/catchorg/Catch2/issues/comments/290481767/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"theWayofthecode","id":493190,"node_id":"MDQ6VXNlcjQ5MzE5MA==","avatar_url":"https://avatars.githubusercontent.com/u/493190?v=4","gravatar_id":"","url":"https://api.github.com/users/theWayofthecode","html_url":"https://github.com/theWayofthecode","followers_url":"https://api.github.com/users/theWayofthecode/followers","following_url":"https://api.github.com/users/theWayofthecode/following{/other_user}","gists_url":"https://api.github.com/users/theWayofthecode/gists{/gist_id}","starred_url":"https://api.github.com/users/theWayofthecode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/theWayofthecode/subscriptions","organizations_url":"https://api.github.com/users/theWayofthecode/orgs","repos_url":"https://api.github.com/users/theWayofthecode/repos","events_url":"https://api.github.com/users/theWayofthecode/events{/privacy}","received_events_url":"https://api.github.com/users/theWayofthecode/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":1029911524,"node_id":"MDEyOkxhYmVsZWRFdmVudDEwMjk5MTE1MjQ=","url":"https://api.github.com/repos/catchorg/Catch2/issues/events/1029911524","actor":{"login":"horenmar","id":9026413,"node_id":"MDQ6VXNlcjkwMjY0MTM=","avatar_url":"https://avatars.githubusercontent.com/u/9026413?v=4","gravatar_id":"","url":"https://api.github.com/users/horenmar","html_url":"https://github.com/horenmar","followers_url":"https://api.github.com/users/horenmar/followers","following_url":"https://api.github.com/users/horenmar/following{/other_user}","gists_url":"https://api.github.com/users/horenmar/gists{/gist_id}","starred_url":"https://api.github.com/users/horenmar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/horenmar/subscriptions","organizations_url":"https://api.github.com/users/horenmar/orgs","repos_url":"https://api.github.com/users/horenmar/repos","events_url":"https://api.github.com/users/horenmar/events{/privacy}","received_events_url":"https://api.github.com/users/horenmar/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2017-04-05T08:25:00Z","label":{"name":"Won't Fix","color":"006b75"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/catchorg/Catch2/issues/comments/291793603","html_url":"https://github.com/catchorg/Catch2/issues/875#issuecomment-291793603","issue_url":"https://api.github.com/repos/catchorg/Catch2/issues/875","id":291793603,"node_id":"MDEyOklzc3VlQ29tbWVudDI5MTc5MzYwMw==","user":{"login":"horenmar","id":9026413,"node_id":"MDQ6VXNlcjkwMjY0MTM=","avatar_url":"https://avatars.githubusercontent.com/u/9026413?v=4","gravatar_id":"","url":"https://api.github.com/users/horenmar","html_url":"https://github.com/horenmar","followers_url":"https://api.github.com/users/horenmar/followers","following_url":"https://api.github.com/users/horenmar/following{/other_user}","gists_url":"https://api.github.com/users/horenmar/gists{/gist_id}","starred_url":"https://api.github.com/users/horenmar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/horenmar/subscriptions","organizations_url":"https://api.github.com/users/horenmar/orgs","repos_url":"https://api.github.com/users/horenmar/repos","events_url":"https://api.github.com/users/horenmar/events{/privacy}","received_events_url":"https://api.github.com/users/horenmar/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-05T08:39:33Z","updated_at":"2017-04-05T08:39:33Z","body":"I will think about it","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/catchorg/Catch2/issues/comments/291793603/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"horenmar","id":9026413,"node_id":"MDQ6VXNlcjkwMjY0MTM=","avatar_url":"https://avatars.githubusercontent.com/u/9026413?v=4","gravatar_id":"","url":"https://api.github.com/users/horenmar","html_url":"https://github.com/horenmar","followers_url":"https://api.github.com/users/horenmar/followers","following_url":"https://api.github.com/users/horenmar/following{/other_user}","gists_url":"https://api.github.com/users/horenmar/gists{/gist_id}","starred_url":"https://api.github.com/users/horenmar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/horenmar/subscriptions","organizations_url":"https://api.github.com/users/horenmar/orgs","repos_url":"https://api.github.com/users/horenmar/repos","events_url":"https://api.github.com/users/horenmar/events{/privacy}","received_events_url":"https://api.github.com/users/horenmar/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":1038281920,"node_id":"MDExOkNsb3NlZEV2ZW50MTAzODI4MTkyMA==","url":"https://api.github.com/repos/catchorg/Catch2/issues/events/1038281920","actor":{"login":"philsquared","id":92878,"node_id":"MDQ6VXNlcjkyODc4","avatar_url":"https://avatars.githubusercontent.com/u/92878?v=4","gravatar_id":"","url":"https://api.github.com/users/philsquared","html_url":"https://github.com/philsquared","followers_url":"https://api.github.com/users/philsquared/followers","following_url":"https://api.github.com/users/philsquared/following{/other_user}","gists_url":"https://api.github.com/users/philsquared/gists{/gist_id}","starred_url":"https://api.github.com/users/philsquared/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/philsquared/subscriptions","organizations_url":"https://api.github.com/users/philsquared/orgs","repos_url":"https://api.github.com/users/philsquared/repos","events_url":"https://api.github.com/users/philsquared/events{/privacy}","received_events_url":"https://api.github.com/users/philsquared/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"b591cb9a03848f11c401617977482291996a9d58","commit_url":"https://api.github.com/repos/catchorg/Catch2/commits/b591cb9a03848f11c401617977482291996a9d58","created_at":"2017-04-11T13:25:50Z","state_reason":null,"performed_via_github_app":null},{"actor":{"login":"jeremy-rifkin","id":51220084,"node_id":"MDQ6VXNlcjUxMjIwMDg0","avatar_url":"https://avatars.githubusercontent.com/u/51220084?v=4","gravatar_id":"","url":"https://api.github.com/users/jeremy-rifkin","html_url":"https://github.com/jeremy-rifkin","followers_url":"https://api.github.com/users/jeremy-rifkin/followers","following_url":"https://api.github.com/users/jeremy-rifkin/following{/other_user}","gists_url":"https://api.github.com/users/jeremy-rifkin/gists{/gist_id}","starred_url":"https://api.github.com/users/jeremy-rifkin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeremy-rifkin/subscriptions","organizations_url":"https://api.github.com/users/jeremy-rifkin/orgs","repos_url":"https://api.github.com/users/jeremy-rifkin/repos","events_url":"https://api.github.com/users/jeremy-rifkin/events{/privacy}","received_events_url":"https://api.github.com/users/jeremy-rifkin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-01-18T00:08:33Z","updated_at":"2025-01-18T00:08:33Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/catchorg/Catch2/issues/2948","repository_url":"https://api.github.com/repos/catchorg/Catch2","labels_url":"https://api.github.com/repos/catchorg/Catch2/issues/2948/labels{/name}","comments_url":"https://api.github.com/repos/catchorg/Catch2/issues/2948/comments","events_url":"https://api.github.com/repos/catchorg/Catch2/issues/2948/events","html_url":"https://github.com/catchorg/Catch2/pull/2948","id":2796501805,"node_id":"PR_kwDOABA2rM6INgPi","number":2948,"title":"Make assertions thread-safe","user":{"login":"jeremy-rifkin","id":51220084,"node_id":"MDQ6VXNlcjUxMjIwMDg0","avatar_url":"https://avatars.githubusercontent.com/u/51220084?v=4","gravatar_id":"","url":"https://api.github.com/users/jeremy-rifkin","html_url":"https://github.com/jeremy-rifkin","followers_url":"https://api.github.com/users/jeremy-rifkin/followers","following_url":"https://api.github.com/users/jeremy-rifkin/following{/other_user}","gists_url":"https://api.github.com/users/jeremy-rifkin/gists{/gist_id}","starred_url":"https://api.github.com/users/jeremy-rifkin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeremy-rifkin/subscriptions","organizations_url":"https://api.github.com/users/jeremy-rifkin/orgs","repos_url":"https://api.github.com/users/jeremy-rifkin/repos","events_url":"https://api.github.com/users/jeremy-rifkin/events{/privacy}","received_events_url":"https://api.github.com/users/jeremy-rifkin/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2025-01-18T00:08:31Z","updated_at":"2025-07-24T08:10:39Z","closed_at":"2025-07-24T08:10:14Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":1062572,"node_id":"MDEwOlJlcG9zaXRvcnkxMDYyNTcy","name":"Catch2","full_name":"catchorg/Catch2","private":false,"owner":{"login":"catchorg","id":33321405,"node_id":"MDEyOk9yZ2FuaXphdGlvbjMzMzIxNDA1","avatar_url":"https://avatars.githubusercontent.com/u/33321405?v=4","gravatar_id":"","url":"https://api.github.com/users/catchorg","html_url":"https://github.com/catchorg","followers_url":"https://api.github.com/users/catchorg/followers","following_url":"https://api.github.com/users/catchorg/following{/other_user}","gists_url":"https://api.github.com/users/catchorg/gists{/gist_id}","starred_url":"https://api.github.com/users/catchorg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/catchorg/subscriptions","organizations_url":"https://api.github.com/users/catchorg/orgs","repos_url":"https://api.github.com/users/catchorg/repos","events_url":"https://api.github.com/users/catchorg/events{/privacy}","received_events_url":"https://api.github.com/users/catchorg/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/catchorg/Catch2","description":"A modern, C++-native, test framework for unit-tests, TDD and BDD - using C++14, C++17 and later (C++11 support is in v2.x branch, and C++03 on the Catch1.x branch)","fork":false,"url":"https://api.github.com/repos/catchorg/Catch2","forks_url":"https://api.github.com/repos/catchorg/Catch2/forks","keys_url":"https://api.github.com/repos/catchorg/Catch2/keys{/key_id}","collaborators_url":"https://api.github.com/repos/catchorg/Catch2/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/catchorg/Catch2/teams","hooks_url":"https://api.github.com/repos/catchorg/Catch2/hooks","issue_events_url":"https://api.github.com/repos/catchorg/Catch2/issues/events{/number}","events_url":"https://api.github.com/repos/catchorg/Catch2/events","assignees_url":"https://api.github.com/repos/catchorg/Catch2/assignees{/user}","branches_url":"https://api.github.com/repos/catchorg/Catch2/branches{/branch}","tags_url":"https://api.github.com/repos/catchorg/Catch2/tags","blobs_url":"https://api.github.com/repos/catchorg/Catch2/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/catchorg/Catch2/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/catchorg/Catch2/git/refs{/sha}","trees_url":"https://api.github.com/repos/catchorg/Catch2/git/trees{/sha}","statuses_url":"https://api.github.com/repos/catchorg/Catch2/statuses/{sha}","languages_url":"https://api.github.com/repos/catchorg/Catch2/languages","stargazers_url":"https://api.github.com/repos/catchorg/Catch2/stargazers","contributors_url":"https://api.github.com/repos/catchorg/Catch2/contributors","subscribers_url":"https://api.github.com/repos/catchorg/Catch2/subscribers","subscription_url":"https://api.github.com/repos/catchorg/Catch2/subscription","commits_url":"https://api.github.com/repos/catchorg/Catch2/commits{/sha}","git_commits_url":"https://api.github.com/repos/catchorg/Catch2/git/commits{/sha}","comments_url":"https://api.github.com/repos/catchorg/Catch2/comments{/number}","issue_comment_url":"https://api.github.com/repos/catchorg/Catch2/issues/comments{/number}","contents_url":"https://api.github.com/repos/catchorg/Catch2/contents/{+path}","compare_url":"https://api.github.com/repos/catchorg/Catch2/compare/{base}...{head}","merges_url":"https://api.github.com/repos/catchorg/Catch2/merges","archive_url":"https://api.github.com/repos/catchorg/Catch2/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/catchorg/Catch2/downloads","issues_url":"https://api.github.com/repos/catchorg/Catch2/issues{/number}","pulls_url":"https://api.github.com/repos/catchorg/Catch2/pulls{/number}","milestones_url":"https://api.github.com/repos/catchorg/Catch2/milestones{/number}","notifications_url":"https://api.github.com/repos/catchorg/Catch2/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/catchorg/Catch2/labels{/name}","releases_url":"https://api.github.com/repos/catchorg/Catch2/releases{/id}","deployments_url":"https://api.github.com/repos/catchorg/Catch2/deployments","created_at":"2010-11-08T18:22:56Z","updated_at":"2025-11-09T16:52:13Z","pushed_at":"2025-11-09T22:14:04Z","git_url":"git://github.com/catchorg/Catch2.git","ssh_url":"git@github.com:catchorg/Catch2.git","clone_url":"https://github.com/catchorg/Catch2.git","svn_url":"https://github.com/catchorg/Catch2","homepage":"https://discord.gg/4CWS9zD","size":29422,"stargazers_count":19944,"watchers_count":19944,"language":"C++","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":3165,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":415,"license":{"key":"bsl-1.0","name":"Boost Software License 1.0","spdx_id":"BSL-1.0","url":"https://api.github.com/licenses/bsl-1.0","node_id":"MDc6TGljZW5zZTI4"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["bdd","cpp","cpp14","framework","no-dependencies","tdd","test-framework","testing"],"visibility":"public","forks":3165,"open_issues":415,"watchers":19944,"default_branch":"devel","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/catchorg/Catch2/pulls/2948","html_url":"https://github.com/catchorg/Catch2/pull/2948","diff_url":"https://github.com/catchorg/Catch2/pull/2948.diff","patch_url":"https://github.com/catchorg/Catch2/pull/2948.patch","merged_at":null},"body":"## Description\r\nThis PR makes Catch2 assertion and logging macros thread-safe, allowing threads spawned in test cases to perform checks. It does this by introducing a global lock and locking at entry points called from these macros. This was easier and safer than trying to track down every use of static storage in the library and locking only around those, however, at some point that might be desirable.\r\n\r\nA `std::recursive_mutex` is used for the global lock. There is some overhead associated with taking out the lock, however, it's extremely minimal in the uncontested (single-thread) case. In a benchmark locally I found that for a debug build on linux the overhead of the lock is around 300ns on my machine, meaning that a user would have to perform a million assertions in order to add a second of run-time overhead to their program.\r\n```\r\nbenchmark name                       samples       iterations    est run time\r\n                                     mean          low mean      high mean\r\n                                     std dev       low std dev   high std dev\r\n-------------------------------------------------------------------------------\r\nno lock                                        100          1604     5.9348 ms \r\n                                        37.1058 ns     36.915 ns    37.4472 ns \r\n                                        1.26649 ns    0.80055 ns    1.98121 ns \r\n                                                                               \r\nwith std::recursive_mutex                      100           203     6.0088 ms \r\n                                        303.559 ns    299.777 ns    313.273 ns \r\n                                        28.6615 ns    11.6045 ns    56.3121 ns \r\n```\r\n\r\nOn release the overhead is far smaller:\r\n```\r\nbenchmark name                       samples       iterations    est run time\r\n                                     mean          low mean      high mean\r\n                                     std dev       low std dev   high std dev\r\n-------------------------------------------------------------------------------\r\nno lock                                        100         20405     2.0405 ms \r\n                                        1.29613 ns    1.28875 ns    1.31015 ns \r\n                                      0.0501252 ns  0.0300847 ns  0.0787845 ns \r\n                                                                               \r\nwith std::recursive_mutex                      100           226      2.712 ms \r\n                                        137.018 ns    128.907 ns    150.877 ns \r\n                                        53.1962 ns    37.1166 ns    85.6079 ns \r\n```\r\n\r\nMSVC debug:\r\n```\r\nbenchmark name                       samples       iterations    est run time\r\n                                     mean          low mean      high mean\r\n                                     std dev       low std dev   high std dev\r\n-------------------------------------------------------------------------------\r\nno lock                                        100          6510      1.302 ms \r\n                                        2.07343 ns     2.0573 ns    2.10123 ns \r\n                                       0.105615 ns  0.0698496 ns    0.14992 ns\r\n\r\nwith std::recursive_mutex                      100           567     1.5309 ms \r\n                                        25.3474 ns    24.8342 ns    27.2275 ns \r\n                                        4.45937 ns    1.13563 ns    10.2695 ns\r\n```\r\n\r\nIf this impact is deemed too high I have ideas for reducing the overhead in debug mode and optimizing for the uncontested case.\r\n\r\n## GitHub Issues\r\n#99\r\n#246\r\n#875\r\n#1043\r\n#1169\r\n#1252\r\n#1302\r\n#1714\r\n#1904\r\n#2641\r\nAnd probably others\r\n\r\n","reactions":{"url":"https://api.github.com/repos/catchorg/Catch2/issues/2948/reactions","total_count":3,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":3,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/catchorg/Catch2/issues/2948/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"}]