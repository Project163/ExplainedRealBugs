<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:23:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HTTPCORE-434] Handling of HEAD responses without payload headers</title>
                <link>https://issues.apache.org/jira/browse/HTTPCORE-434</link>
                <project id="12310340" key="HTTPCORE">HttpComponents HttpCore</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I&apos;m not sure if this is a problem with HttpClient itself or with Squid (3.3.8) proxy server, but maybe you could please advise.&lt;/p&gt;

&lt;p&gt;Our client application first sends a HEAD request for NTLM authentication with the proxy and then re-uses the execution context as described in &lt;a href=&quot;https://hc.apache.org/httpcomponents-client-ga/tutorial/html/authentication.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hc.apache.org/httpcomponents-client-ga/tutorial/html/authentication.html&lt;/a&gt; for the following POST requests.&lt;/p&gt;

&lt;p&gt;Using more recent versions of Tomcat on the server-side, re-using the execution context does not work anymore, the NTLM authentication negotiate-challenge is repeated forever and following POST requests with chunked transfer-encoding don&apos;t work  since they are interrupted by the authentication challenge.&lt;/p&gt;

&lt;p&gt;I figured out the difference betweeen newer and older Tomcat versions and found the reason: previously, Tomcat automatically added a &quot;Content-Length: 0&quot; header to the reponse of HEAD requests. With &quot;Bug 59310 - Content-Length of HEAD requests incorrectly computed as 0&quot; (&lt;a href=&quot;https://bz.apache.org/bugzilla/show_bug.cgi?id=59310&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://bz.apache.org/bugzilla/show_bug.cgi?id=59310&lt;/a&gt;), this behavior was changed and without this header,  NTLM connections to the proxy don&apos;t persist anymore. &lt;/p&gt;

&lt;p&gt;As the content-length header is optional in a response to a HEAD request (RFC 7230), the problem must be either in HttpClient or Squid proxy. &lt;/p&gt;

&lt;p&gt;Thanks in advance!&lt;/p&gt;


&lt;p&gt;Best regards&lt;br/&gt;
Reinhold &lt;/p&gt;</description>
                <environment></environment>
        <key id="13009495">HTTPCORE-434</key>
            <summary>Handling of HEAD responses without payload headers</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="FruesmerRe">Reinhold Fr&#252;smer</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 Oct 2016 10:44:44 +0000</created>
                <updated>Tue, 11 Oct 2016 08:02:25 +0000</updated>
                            <resolved>Sat, 8 Oct 2016 11:19:03 +0000</resolved>
                                    <version>4.4.5</version>
                                    <fixVersion>4.4.6</fixVersion>
                    <fixVersion>5.0-alpha2</fixVersion>
                                    <component>HttpCore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15545043" author="fruesmerre" created="Tue, 4 Oct 2016 10:45:34 +0000"  >&lt;p&gt;Wireshark logs showing the different behaviour&lt;/p&gt;</comment>
                            <comment id="15545088" author="olegk" created="Tue, 4 Oct 2016 11:10:52 +0000"  >&lt;p&gt;Reinhold, &lt;br/&gt;
Please note HttpClient is RFC 7230 compliant in the 5.x series, but not in 4.x.&lt;/p&gt;

&lt;p&gt;Please produce a complete wire / context log of the session exhibiting the problem as described here&lt;br/&gt;
&lt;a href=&quot;http://hc.apache.org/httpcomponents-client-4.5.x/logging.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hc.apache.org/httpcomponents-client-4.5.x/logging.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="15545429" author="fruesmerre" created="Tue, 4 Oct 2016 14:03:55 +0000"  >&lt;p&gt;Complete wire/context log of three consecutive HEAD requests&lt;/p&gt;</comment>
                            <comment id="15546441" author="olegk" created="Tue, 4 Oct 2016 19:44:42 +0000"  >&lt;p&gt;Reinhold,&lt;br/&gt;
According to the wire log and Wireshark dumps your application uses HttpClient version 4.5 and not version 4.5.2.&lt;/p&gt;

&lt;p&gt;Could you lease upgrade the latest 4.5.3-SNAPSHOT and run the test again? You will have to build the snapshot from source &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; or pull it from the ASF snapshot repository &lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/apache/httpclient/tree/4.5.x&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpclient/tree/4.5.x&lt;/a&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;  &lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Oleg  &lt;/p&gt;</comment>
                            <comment id="15549106" author="fruesmerre" created="Wed, 5 Oct 2016 15:43:36 +0000"  >&lt;p&gt;Added wire log running with HttpClient 4.5.3-SNAPSHOT &lt;/p&gt;</comment>
                            <comment id="15552094" author="olegk" created="Thu, 6 Oct 2016 14:37:29 +0000"  >&lt;p&gt;It turned out that the problem is caused by differences in HEAD message delineation as defined by RFC 2616 and RFC 7231&lt;/p&gt;

&lt;p&gt;RFC 2616&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;
9.4 HEAD

   The HEAD method is identical to GET except that the server MUST NOT
   return a message-body in the response. The metainformation contained
   in the HTTP headers in response to a HEAD request SHOULD be identical
   to the information sent in response to a GET request. 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;RFC 7231&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;
4.3.2.  HEAD

   The HEAD method is identical to GET except that the server MUST NOT
   send a message body in the response (i.e., the response terminates at
   the end of the header section).  The server SHOULD send the same
   header fields in response to a HEAD request as it would have sent if
   the request had been a GET, except that the payload header fields
   (Section 3.3) MAY be omitted.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Tomcat developers chose to omit  payload header, which is perfectly fine. However HttpClient 4.x is compliant with RFC 2616 only. I do not feel comfortable making it partially compliant with RFC 7231 in some aspects and non-compliant in others. &lt;/p&gt;

&lt;p&gt;I suggest that we leave things as is in the 4.5.x branch and fix the issue in trunk. One could still use a custom &lt;tt&gt;ConnectionReuseStrategy&lt;/tt&gt; to make HttpClient 4.5 ignore payload header fields for HEAD responses if needed.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="15552134" author="olegk" created="Thu, 6 Oct 2016 14:56:04 +0000"  >&lt;p&gt;Forget my suggestion. Absense of payload header in a response to HEAD request should not prevent re-use of the connection. &lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="15557784" author="olegk" created="Sat, 8 Oct 2016 11:19:03 +0000"  >&lt;p&gt;Fixed in SVN trunk and 4.4.x branch. Please verify the fix and close.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="15562779" author="fruesmerre" created="Mon, 10 Oct 2016 16:47:54 +0000"  >&lt;p&gt;Oleg,&lt;/p&gt;

&lt;p&gt;verified with HttpCore-4.4.6-SNAPSHOT,  the problem is solved for us - thanks a lot!! &lt;/p&gt;

&lt;p&gt;But unfortunately, I&apos;m currently unable to verify with 5.0-alpha2 ... after checking out and building HttpCore and HttpClient from SVN trunk, it&apos;s not possible to compile a simple example for testing. &lt;/p&gt;

&lt;p&gt;The compiler complains that class org.apache.hc.core5.http.message.AbstractHttpMessage is missing - it&apos;s referenced (extended) by HttpRequestWrapper for example, but can&apos;t be found anywhere inside HttpCore source and jar. &lt;/p&gt;

&lt;p&gt;Please advise.&lt;/p&gt;


&lt;p&gt;Reinhold&lt;/p&gt;




</comment>
                            <comment id="15564777" author="olegk" created="Tue, 11 Oct 2016 07:38:46 +0000"  >&lt;p&gt;Reinhold,&lt;/p&gt;

&lt;p&gt;HttpCore and HttpClient trunks (5.0) are out of sync and are likely to be API unstable for months to come. Verification of the stable branch is perfectly enough.&lt;/p&gt;

&lt;p&gt;Cheers&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="15564833" author="fruesmerre" created="Tue, 11 Oct 2016 08:02:13 +0000"  >&lt;p&gt;Okay, since verified with HttpCore-4.4.6-SNAPSHOT, I wil close this issue now.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12831505" name="tomcat-squid-ntlm-not-stateful.pcapng" size="13624" author="FruesmerRe" created="Tue, 4 Oct 2016 10:45:34 +0000"/>
                            <attachment id="12831504" name="tomcat-squid-ntlm-stateful.pcapng" size="9092" author="FruesmerRe" created="Tue, 4 Oct 2016 10:45:34 +0000"/>
                            <attachment id="12831532" name="wire-context-log.txt" size="92712" author="FruesmerRe" created="Tue, 4 Oct 2016 14:03:55 +0000"/>
                            <attachment id="12831758" name="wirelog-4.5.3.txt" size="94213" author="FruesmerRe" created="Wed, 5 Oct 2016 15:43:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 5 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i34ep3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>