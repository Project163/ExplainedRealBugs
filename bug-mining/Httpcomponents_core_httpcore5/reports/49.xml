<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:24:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HTTPCORE-631] HttpAsyncClient 5.0 file descriptor leak</title>
                <link>https://issues.apache.org/jira/browse/HTTPCORE-631</link>
                <project id="12310340" key="HTTPCORE">HttpComponents HttpCore</project>
                    <description>&lt;p&gt;It seems that HttpAsyncClient doesn&apos;t close all its file descriptors with the close() operation. Consider the following test:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void leakApache() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; 10000; i++) {
            CloseableHttpAsyncClient client = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                client = HttpAsyncClientBuilder.create().build();
                &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(i);
            } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Throwable e) {
                e.printStackTrace();
            } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (client != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
                    client.close();
            }
            &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(10);
        }

        &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(300000);
    }
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;After around 280 iterations I start seeing this error message (java.io.IOException: &lt;b&gt;Too many open files&lt;/b&gt;):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.IllegalStateException: Unexpected failure opening I/O selector
 at org.apache.hc.core5.reactor.AbstractSingleCoreIOReactor.&amp;lt;init&amp;gt;(AbstractSingleCoreIOReactor.java:60)
 at org.apache.hc.core5.reactor.SingleCoreIOReactor.&amp;lt;init&amp;gt;(SingleCoreIOReactor.java:81)
 at org.apache.hc.core5.reactor.DefaultConnectingIOReactor.&amp;lt;init&amp;gt;(DefaultConnectingIOReactor.java:71)
 at org.apache.hc.client5.http.impl.async.HttpAsyncClientBuilder.build(HttpAsyncClientBuilder.java:924)
 at com.mimecast.micro.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.BenTest.leakApache(BenTest.java:77)
 at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
 at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
 at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
 at java.lang.reflect.Method.invoke(Method.java:498)
 at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
 at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
 at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
 at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
 at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
 at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)
 at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)
 at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
 at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
 at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
 at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
 at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
 at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
 at org.junit.runner.JUnitCore.run(JUnitCore.java:137)
 at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:68)
 at com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:33)
 at com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:230)
 at com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:58)
 Caused by: java.io.IOException: Too many open files
 at sun.nio.ch.IOUtil.makePipe(Native Method)
 at sun.nio.ch.KQueueSelectorImpl.&amp;lt;init&amp;gt;(KQueueSelectorImpl.java:84)
 at sun.nio.ch.KQueueSelectorProvider.openSelector(KQueueSelectorProvider.java:42)
 at java.nio.channels.Selector.open(Selector.java:227)
 at org.apache.hc.core5.reactor.AbstractSingleCoreIOReactor.&amp;lt;init&amp;gt;(AbstractSingleCoreIOReactor.java:58)
 ... 26 more &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If I run lsof i see around 10k files. These files do not get released until the whole test closes.&lt;/p&gt;

&lt;p&gt;Is there something I&apos;m missing?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
 Ben&lt;/p&gt;</description>
                <environment></environment>
        <key id="13302284">HTTPCORE-631</key>
            <summary>HttpAsyncClient 5.0 file descriptor leak</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="bentindall">Ben Tindall</reporter>
                        <labels>
                    </labels>
                <created>Fri, 1 May 2020 10:01:51 +0000</created>
                <updated>Tue, 5 May 2020 15:17:08 +0000</updated>
                            <resolved>Mon, 4 May 2020 16:35:33 +0000</resolved>
                                    <version>5.0</version>
                                    <fixVersion>5.0.1</fixVersion>
                                    <component>HttpCore NIO</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17097281" author="michael-o" created="Fri, 1 May 2020 10:10:06 +0000"  >&lt;p&gt;&lt;tt&gt;sun.nio.ch.KQueueSelectorImpl&lt;/tt&gt;: Are you running on macOS or FreeSBD?&lt;/p&gt;</comment>
                            <comment id="17097284" author="bentindall" created="Fri, 1 May 2020 10:27:38 +0000"  >&lt;p&gt;Thanks for getting back to me so quickly. I ran that test on OSX 10.14.6 running OpenJDK 1.8.0_221, but i&apos;m also seeing it on a load testing box running CentOS&#160;7.7.1908 and OpenJDK 11.0.1:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: java.io.IOException: Too many open files
        at sun.nio.ch.EPoll.create(Native Method) ~[?:?]
        at sun.nio.ch.EPollSelectorImpl.&amp;lt;init&amp;gt;(EPollSelectorImpl.java:79) ~[?:?]
        at sun.nio.ch.EPollSelectorProvider.openSelector(EPollSelectorProvider.java:36) ~[?:?]
        at java.nio.channels.Selector.open(Selector.java:295) ~[?:?]
        at org.apache.hc.core5.reactor.AbstractSingleCoreIOReactor.&amp;lt;init&amp;gt;(AbstractSingleCoreIOReactor.java:58) ~[httpcore5-5.0.jar:5.0] &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17097293" author="michael-o" created="Fri, 1 May 2020 10:50:21 +0000"  >&lt;p&gt;I believe your analysis is correct. KQueue requires an open FD for every item which is observed. There is a leak. Can you check on macOS &lt;tt&gt;kern.maxfiles&lt;/tt&gt; with &lt;tt&gt;sysctl&lt;/tt&gt; and increase and see whether you can increase the amount of open FDs? Is there a &lt;tt&gt;procstat&lt;/tt&gt; on macOS from FreeBSD? This will easily display all open FDs with &lt;tt&gt;procstat -f &amp;lt;pid&amp;gt;&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17097301" author="bentindall" created="Fri, 1 May 2020 11:05:28 +0000"  >&lt;p&gt;I tried increasing the kern.maxfiles:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
~ sudo sysctl kern.maxfiles=118304
kern.maxfiles: 98304 -&amp;gt; 118304
~ sysctl kern.maxfiles
kern.maxfiles: 118304 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;But after increasing it I still am only able to run that test 280 times. It seems that every time IOReactor is created it creates 12 threads (I have 12 cores) for a maximum of 3360 threads.&lt;/p&gt;</comment>
                            <comment id="17097304" author="olegk" created="Fri, 1 May 2020 11:14:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bentindall&quot; class=&quot;user-hover&quot; rel=&quot;bentindall&quot;&gt;bentindall&lt;/a&gt; Regardless of whether or not this is a defect in HttpClient I have a simple question. Why? Why would anyone in their sane mind want to create more than one HttpAsyncClient instance at all?&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17097313" author="bentindall" created="Fri, 1 May 2020 11:27:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt; I am using HttpClient in a MicroService to make calls to another MicroService endpoint. I therefore create an HttpAsyncClient, perform the request and close it again.&lt;/p&gt;</comment>
                            <comment id="17097315" author="olegk" created="Fri, 1 May 2020 11:29:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bentindall&quot; class=&quot;user-hover&quot; rel=&quot;bentindall&quot;&gt;bentindall&lt;/a&gt; This is completely unnecessary and wasteful.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17097322" author="michael-o" created="Fri, 1 May 2020 11:44:04 +0000"  >&lt;p&gt;Ben, the clients are threadsafe. You should not re-create them. I use a Client instance in a Spring application and happily runs for weeks and months. Try to save the instance.&lt;/p&gt;</comment>
                            <comment id="17097386" author="olegk" created="Fri, 1 May 2020 14:02:50 +0000"  >&lt;p&gt;I reviewed HttpAsyncClient &lt;tt&gt;#close()&lt;/tt&gt; method implementation. By default it uses graceful shutdown sequence when individual I/O reactor threads may still linger even after the method returns. In case of an immediate shutdown  I/O reactor threads get interrupted immediately without any grace period. &lt;/p&gt;

&lt;p&gt;As far as I am concerned I see no evidence of a thread leak.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;

</comment>
                            <comment id="17097462" author="bentindall" created="Fri, 1 May 2020 15:47:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;&#160;there is definitely a leak - I have tried closing the client with both client.close(CloseMethod.GRACEFUL) and client.close(CloseMethod.IMMEDIATE) and both show exactly the same results. I can create and close a new client 280 times before I get the &quot;Too many open files&quot; error message. And then i have a Thread.sleep(300000) during which I am seeing if the threads come down and they never do, and lsof shows 10k PIPE entries that never clear. Have you tried the code in the description?&lt;/p&gt;</comment>
                            <comment id="17097487" author="olegk" created="Fri, 1 May 2020 16:30:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bentindall&quot; class=&quot;user-hover&quot; rel=&quot;bentindall&quot;&gt;bentindall&lt;/a&gt; I took regular thread dumps during the unit test run . I see no thread build-up. All threads terminate correctly.&lt;/p&gt;

&lt;p&gt;Oleg  &lt;/p&gt;</comment>
                            <comment id="17097497" author="bentindall" created="Fri, 1 May 2020 16:43:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;&#160;I&apos;m seeing a file descriptor leak - not necessarily a thread leak, hence the&#160;&quot;Too many open files&quot; error. When I run lsof during that sleep period I see at least 10000 entries that look like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java 17979 &amp;lt;user&amp;gt; 7061 PIPE 0xbbd322ffcf94c013 16384 -&amp;gt;0xbbd322ffcf949313 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Could I ask:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Are you getting the &quot;Too many open files&quot; error message?&lt;/li&gt;
	&lt;li&gt;After the 10000 clients are created and closed what does lsof show?&lt;/li&gt;
	&lt;li&gt;What OS are you running this on and what Java version?&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Cheers,&lt;/p&gt;

&lt;p&gt;Ben&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17097499" author="michael-o" created="Fri, 1 May 2020 16:48:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bentindall&quot; class=&quot;user-hover&quot; rel=&quot;bentindall&quot;&gt;bentindall&lt;/a&gt;, can you create a tarball with a minimal test case? I can test that on FreeBSD which is the origin of the KQueue impl on macOS.&lt;/p&gt;</comment>
                            <comment id="17097502" author="olegk" created="Fri, 1 May 2020 16:51:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bentindall&quot; class=&quot;user-hover&quot; rel=&quot;bentindall&quot;&gt;bentindall&lt;/a&gt; A file descriptor leak and a thread leak is completely different thing. From what I know about TCP one can easily run out if FDs when opening and closing sockets in a tight loop due to SO_LINGER. &lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17097537" author="bentindall" created="Fri, 1 May 2020 17:34:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=michael-o&quot; class=&quot;user-hover&quot; rel=&quot;michael-o&quot;&gt;michael-o&lt;/a&gt;&#160;please find attached a tar ball containing a jar that you can use to test this:&#160;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13001839/13001839_apacheleaktest.tar&quot; title=&quot;apacheleaktest.tar attached to HTTPCORE-631&quot;&gt;apacheleaktest.tar&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;. I&apos;ve attached the source code and maven project should you want to modify it, along with a jar binary.&lt;/p&gt;

&lt;p&gt;Extract and run:&lt;/p&gt;

&lt;p&gt;java -jar target/apacheleaktest-1.0-SNAPSHOT.jar&lt;/p&gt;

&lt;p&gt;It should start failing before it is able to complete the 10000 iterations. You can also configure the wait time between iterations, by default it&apos;s 10ms, e.g. for 100ms:&lt;/p&gt;

&lt;p&gt;java -jar target/apacheleaktest-1.0-SNAPSHOT.jar 100&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17097541" author="bentindall" created="Fri, 1 May 2020 17:40:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;&#160;you are correct about thread leaks vs FD leaks, my apologies for the miscommunication. I have amended the ticket details.&lt;/p&gt;

&lt;p&gt;Regarding FD leaks, I am also seeing this if I create 1 HttpAsyncClient and close it.&lt;/p&gt;

&lt;p&gt;Before:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ lsof | grep java | grep KQUEUE | wc -l
 6
$ lsof | grep java | grep PIPE | wc -l
 33 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;After creating and closing one HttpAsyncClient (and during a Thread.sleep):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ lsof | grep java | grep KQUEUE | wc -l
 18
$ lsof | grep java | grep PIPE | wc -l
 60 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The number of KQUEUE and PIPE stay like this and never close down.&lt;/p&gt;

&lt;p&gt;So it doesn&apos;t seem to be because of the tight loop and an SO_LINGER, it happens after one call and never clears down.&lt;/p&gt;</comment>
                            <comment id="17097554" author="olegk" created="Fri, 1 May 2020 17:59:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bentindall&quot; class=&quot;user-hover&quot; rel=&quot;bentindall&quot;&gt;bentindall&lt;/a&gt; Running out of FDs can be perfectly normal. That does not mean there is anything wrong but I am still reviewing and re-testing the resource management code. &lt;/p&gt;

&lt;p&gt;Oleg &lt;/p&gt;</comment>
                            <comment id="17097601" author="michael-o" created="Fri, 1 May 2020 18:57:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bentindall&quot; class=&quot;user-hover&quot; rel=&quot;bentindall&quot;&gt;bentindall&lt;/a&gt;, tried on FreeBSD 11.3-RELEASE. Something is really really wrong here. After a few hunders attempts procstat shows thousands of open FDs. Every other invocation of an application exits with &quot;Cannot allocate memory.&quot;. Then it completely stalls at &quot;Attempt 2078...&quot; and takes way longer than 10 ms to allocate another attempt. By then it has &quot; 868 java             24961 k - rw------   2       0 -   -&quot; more than 25 000 open FDs here.&lt;/p&gt;</comment>
                            <comment id="17097939" author="olegk" created="Sat, 2 May 2020 12:04:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bentindall&quot; class=&quot;user-hover&quot; rel=&quot;bentindall&quot;&gt;bentindall&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=michael-o&quot; class=&quot;user-hover&quot; rel=&quot;michael-o&quot;&gt;michael-o&lt;/a&gt; If the test is modified to allow HttpAsyncClient to properly start and initialize its i/o dispatch threads before getting shut down all FDs get released correctly. This is the reason we have never seen this problem in our integration tests.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;client = HttpAsyncClientBuilder.create().build();
```
client.start();
Thread.sleep(1000);
```
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Fundamentally the core of the problem is HttpAyncClient instance jerking. &lt;/p&gt;

&lt;p&gt;I am going to fix the leak but this is a minor problem for me now.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17098007" author="michael-o" created="Sat, 2 May 2020 16:30:53 +0000"  >&lt;p&gt;I can confirm &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;&apos;s proposal. procstat has shown only a limited number of open FDs 26 to 38. The sleep should not be too short otherwise the client will try to allocate resourcest too fast.&lt;/p&gt;</comment>
                            <comment id="17098061" author="bentindall" created="Sat, 2 May 2020 18:58:51 +0000"  >&lt;p&gt;Thanks for getting back to me &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;&#160;and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=michael-o&quot; class=&quot;user-hover&quot; rel=&quot;michael-o&quot;&gt;michael-o&lt;/a&gt;. I can also confirm &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;&apos;s proposal. My observations are:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;If you don&apos;t call client.start() before client.close() file descriptors will leak every time&lt;/li&gt;
	&lt;li&gt;If I add a delay of 100ms between client.start() and client.close() there are no FD leaks&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Here is my new test which successfully executes until the end and in which client.close() closes the FDs successfully every time:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; 1000; i++) {
    CloseableHttpAsyncClient client = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Attempt &quot;&lt;/span&gt; + i + &lt;span class=&quot;code-quote&quot;&gt;&quot;...&quot;&lt;/span&gt;);
        client = HttpAsyncClientBuilder.create().build();
        client.start();
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Attempt &quot;&lt;/span&gt; + i + &lt;span class=&quot;code-quote&quot;&gt;&quot; succeeded&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(100); &lt;span class=&quot;code-comment&quot;&gt;//sleep to let client start up properly
&lt;/span&gt;    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Throwable e) {
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Attempt &quot;&lt;/span&gt; + i + &lt;span class=&quot;code-quote&quot;&gt;&quot; failed: &quot;&lt;/span&gt; + e.getMessage());
        e.printStackTrace();
    } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (client != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
            client.close();
    }
    &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(10); &lt;span class=&quot;code-comment&quot;&gt;//sleep before the next iteration
&lt;/span&gt;}

&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Now sleeping&quot;&lt;/span&gt;);
&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(300000);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;During the test:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#10140;  ~ lsof -p 27598 | grep KQUEUE | wc -l
      12 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;During the sleep period at the end of the test:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#10140;  ~ lsof -p 27598 | grep KQUEUE | wc -l
       0 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Do you want me to raise a ticket to look at the leak occurring when you close a client that has not been started yet? I&apos;m happy to also try to fix this as I have consumed a lot of your time already and am happy to contribute in any way I can &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&#160;&lt;/p&gt;

&lt;p&gt;Also what could be nice is to have a callback when the ioReactor.start() has finished initialising, so that we know when the client is ready for requests. But as Oleg said, this is a minor thing.&lt;/p&gt;

&lt;p&gt;Thanks again,&lt;/p&gt;

&lt;p&gt;Ben&lt;/p&gt;</comment>
                            <comment id="17098433" author="jira-bot" created="Sun, 3 May 2020 13:35:05 +0000"  >&lt;p&gt;Commit 31deceb09644cbe369e40a0da4518ea6ea75e83c in httpcomponents-core&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-631&quot; title=&quot;HttpAsyncClient 5.0 file descriptor leak&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-631&quot;&gt;&lt;del&gt;HTTPCORE-631&lt;/del&gt;&lt;/a&gt; from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=31deceb&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=31deceb&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-631&quot; title=&quot;HttpAsyncClient 5.0 file descriptor leak&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-631&quot;&gt;&lt;del&gt;HTTPCORE-631&lt;/del&gt;&lt;/a&gt;: Revised i/o reactor shutdown sequence and resource de-allocation&lt;/p&gt;</comment>
                            <comment id="17098434" author="olegk" created="Sun, 3 May 2020 13:43:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bentindall&quot; class=&quot;user-hover&quot; rel=&quot;bentindall&quot;&gt;bentindall&lt;/a&gt; Please test / review the proposed fix:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/httpcomponents-core/commit/31deceb09644cbe369e40a0da4518ea6ea75e83c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-core/commit/31deceb09644cbe369e40a0da4518ea6ea75e83c&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17098475" author="bentindall" created="Sun, 3 May 2020 15:30:00 +0000"  >&lt;p&gt;Sure, will take a look.&lt;/p&gt;</comment>
                            <comment id="17098534" author="bentindall" created="Sun, 3 May 2020 18:52:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;&#160;in the situation where we create the client then close it immediately the code performs much better than before, i&apos;ve tested it with 1000 iterations and at the end there are almost always 12 KQUEUEs left. I have observed though that sometimes there are 24 or 36 KQUEUEs left, which means that there is still a very small possibility of leaking FDs. However, a) the chance is almost negligible and b) even if it did leak the amount is so small that it wouldn&apos;t cause an issue.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure if this is related but what I also observed is that it always takes 5 seconds to close the client if you close it immediately after creating it (5 seconds is the awaitShutdown timeout). What seems to happen is that for some reason in AbstractSingleCoreIOReactor.awaitShutdown the status never changes from INACTIVE to SHUT_DOWN and therefore it waits for 5 seconds. This could be a race condition potentially where the shutdown occurs before the ioReactor is in a state where it could change state?&lt;/p&gt;

&lt;p&gt;As I said, a minor thing but just wanted to let you know.&lt;/p&gt;

&lt;p&gt;Cheers,&lt;/p&gt;

&lt;p&gt;Ben&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17098803" author="olegk" created="Mon, 4 May 2020 09:19:55 +0000"  >&lt;p&gt;&amp;gt;  I have observed though that sometimes there are 24 or 36 KQUEUEs left, which means that there is still a very small possibility of leaking FDs&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bentindall&quot; class=&quot;user-hover&quot; rel=&quot;bentindall&quot;&gt;bentindall&lt;/a&gt; That is not good enough. There should be no FD leak. Please post code of the test case.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17098831" author="jira-bot" created="Mon, 4 May 2020 10:18:10 +0000"  >&lt;p&gt;Commit 425e5b4feeb4549889dbd3dc0d8e2fffdafc110d in httpcomponents-core&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-631&quot; title=&quot;HttpAsyncClient 5.0 file descriptor leak&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-631&quot;&gt;&lt;del&gt;HTTPCORE-631&lt;/del&gt;&lt;/a&gt; from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=425e5b4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=425e5b4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-631&quot; title=&quot;HttpAsyncClient 5.0 file descriptor leak&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-631&quot;&gt;&lt;del&gt;HTTPCORE-631&lt;/del&gt;&lt;/a&gt;: Revised i/o reactor shutdown sequence and resource de-allocation&lt;/p&gt;</comment>
                            <comment id="17098833" author="olegk" created="Mon, 4 May 2020 10:19:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bentindall&quot; class=&quot;user-hover&quot; rel=&quot;bentindall&quot;&gt;bentindall&lt;/a&gt; Please give it another try. Both issues should be fixed now:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/httpcomponents-core/commit/425e5b4feeb4549889dbd3dc0d8e2fffdafc110d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-core/commit/425e5b4feeb4549889dbd3dc0d8e2fffdafc110d&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17098860" author="bentindall" created="Mon, 4 May 2020 11:49:48 +0000"  >&lt;p&gt;Thanks, i&apos;ll take a look &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17099044" author="bentindall" created="Mon, 4 May 2020 15:31:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;&#160;I tested your latest version and it looks to be totally fixed, good work &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&#160;&lt;/p&gt;

&lt;p&gt;Here&apos;s my test code (I tested both with and without the client.start() line):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; 10000; i++) {
    CloseableHttpAsyncClient client = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Attempt &quot;&lt;/span&gt; + i + &lt;span class=&quot;code-quote&quot;&gt;&quot;...&quot;&lt;/span&gt;);
        client = HttpAsyncClientBuilder.create().build();
        client.start();
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Attempt &quot;&lt;/span&gt; + i + &lt;span class=&quot;code-quote&quot;&gt;&quot; succeeded&quot;&lt;/span&gt;);
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Throwable e) {
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Attempt &quot;&lt;/span&gt; + i + &lt;span class=&quot;code-quote&quot;&gt;&quot; failed: &quot;&lt;/span&gt; + e.getMessage());
        e.printStackTrace();
    } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (client != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
            client.close();
    }
    &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(10); &lt;span class=&quot;code-comment&quot;&gt;//sleep before the next iteration
&lt;/span&gt;}

&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Date() + &lt;span class=&quot;code-quote&quot;&gt;&quot;: Now sleeping&quot;&lt;/span&gt;);
&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(300000); &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;At the same time I am running lsof every 2 seconds and monitoring the KQUEUE state:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; i in {1..1000}; &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; date; lsof -p 23508 | grep KQUEUE | wc -l ; sleep 2; done &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The results are that it successfully executes all 10k calls, KQUEUE never goes above 12 and at the end lsof shows 0 KQUEUE items. Closing the client is also instantaneous, we no longer have the 5 second timeout.&#160;&lt;/p&gt;

&lt;p&gt;I&apos;m happy to say that this issue is totally resolved &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&#160;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=michael-o&quot; class=&quot;user-hover&quot; rel=&quot;michael-o&quot;&gt;michael-o&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17099097" author="jira-bot" created="Mon, 4 May 2020 16:34:36 +0000"  >&lt;p&gt;Commit 425e5b4feeb4549889dbd3dc0d8e2fffdafc110d in httpcomponents-core&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=425e5b4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=425e5b4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-631&quot; title=&quot;HttpAsyncClient 5.0 file descriptor leak&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-631&quot;&gt;&lt;del&gt;HTTPCORE-631&lt;/del&gt;&lt;/a&gt;: Revised i/o reactor shutdown sequence and resource de-allocation&lt;/p&gt;</comment>
                            <comment id="17099104" author="olegk" created="Mon, 4 May 2020 16:38:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bentindall&quot; class=&quot;user-hover&quot; rel=&quot;bentindall&quot;&gt;bentindall&lt;/a&gt; I am glad to hear that. Nevertheless please do follow the recommended best practices and use the same HttpAsyncClient instance to execute requests.&lt;/p&gt;

&lt;p&gt;Oleg &lt;/p&gt;</comment>
                            <comment id="17099203" author="bentindall" created="Mon, 4 May 2020 18:07:29 +0000"  >&lt;p&gt;Sure, will do. Can I find out when you&apos;d be planning to do the next release (5.0.1)? Or whether we&apos;d be able to use a SNAPSHOT version until then?&lt;/p&gt;</comment>
                            <comment id="17099993" author="olegk" created="Tue, 5 May 2020 15:17:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bentindall&quot; class=&quot;user-hover&quot; rel=&quot;bentindall&quot;&gt;bentindall&lt;/a&gt;  I deployed the latest snapshot to the official ASF snapshot repository. I am not going to rush the release given that there should be no FD leak as long as HttpAsyncClient instances get fully initialized. &lt;/p&gt;

&lt;p&gt;I suppose 5.0.1 can be released sometime in early June.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13001839" name="apacheleaktest.tar" size="2303488" author="bentindall" created="Fri, 1 May 2020 17:33:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 27 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0eajk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>