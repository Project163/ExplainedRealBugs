<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:24:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HTTPCORE-599] Capacity feedback does not throttle AsyncDataConsumer.consume() for Http1</title>
                <link>https://issues.apache.org/jira/browse/HTTPCORE-599</link>
                <project id="12310340" key="HTTPCORE">HttpComponents HttpCore</project>
                    <description>&lt;p&gt;The capacity window mechanism in AbstractHttp1StreamDuplexer does not appear to be throttling calls to AsyncDataConsumer.consume(). This affects both client and server asynchronous entity consumers.&lt;/p&gt;

&lt;p&gt;The attached test program implements a simple 5.0 asynchronous HTTP/1.1 server. Aside from boilerplate code, the significant parts are:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Set the HTTP1 initial window size to 8192.&lt;/li&gt;
	&lt;li&gt;Add an AsyncExchangeHandler that creates an empty response and logs the AsyncDataConsumer method calls to the console.&lt;/li&gt;
	&lt;li&gt;Updating the capacity channel is intentionally omitted, effectively providing an infinitely slow consumer.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;To test, post data of more than 8 KB to the server (e.g. using curl). I expect to see in the log consume() calls totaling at least 8192 and nothing after that until the socket times out. Instead, what I see is consume() calls delivering all the data and then streamEnd().&lt;/p&gt;

&lt;p&gt;Here is sample output for uploading almost 32 KB.&#160;I have used my IDE to add a logging breakpoint to show the capacity window on&#160;this line:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/httpcomponents-core/blob/a60528ea58877d55dab266bd2813e065aac6ff2c/httpcore5/src/main/java/org/apache/hc/core5/http/impl/nio/AbstractHttp1StreamDuplexer.java#L313&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-core/blob/a60528ea58877d55dab266bd2813e065aac6ff2c/httpcore5/src/main/java/org/apache/hc/core5/http/impl/nio/AbstractHttp1StreamDuplexer.java#L313&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;so those are also included in the output below.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;Mon Sep 09, 2019 10:27:18.893 AM SlowConsumerTest main FINE: Listening on /0:0:0:0:0:0:0:0:8080&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;Mon Sep 09, 2019 10:27:31.294 AM SlowConsumerTest$MyExchangeHandler handleRequest FINEST: handleRequest called&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;Mon Sep 09, 2019 10:27:31.332 AM SlowConsumerTest$MyExchangeHandler consume FINEST: consume 8192 total 8192&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;AbstractHttp1StreamDuplexer:313 capacity=0&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;Mon Sep 09, 2019 10:27:31.341 AM SlowConsumerTest$MyExchangeHandler updateCapacity FINEST: updateCapacity called&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;Mon Sep 09, 2019 10:27:31.342 AM SlowConsumerTest$MyExchangeHandler consume FINEST: consume 8192 total 16384&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;AbstractHttp1StreamDuplexer:313 capacity=-8192&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;Mon Sep 09, 2019 10:27:31.346 AM SlowConsumerTest$MyExchangeHandler updateCapacity FINEST: updateCapacity called&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;Mon Sep 09, 2019 10:27:31.348 AM SlowConsumerTest$MyExchangeHandler consume FINEST: consume 8192 total 24576&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;AbstractHttp1StreamDuplexer:313 capacity=-16384&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;Mon Sep 09, 2019 10:27:31.352 AM SlowConsumerTest$MyExchangeHandler updateCapacity FINEST: updateCapacity called&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;Mon Sep 09, 2019 10:27:31.354 AM SlowConsumerTest$MyExchangeHandler consume FINEST: consume 8150 total 32726&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;AbstractHttp1StreamDuplexer:313 capacity=-24534&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;Mon Sep 09, 2019 10:27:31.357 AM SlowConsumerTest$MyExchangeHandler streamEnd FINEST: streamEnd called&lt;/tt&gt;&lt;/p&gt;</description>
                <environment>macOS Mojave using the IntelliJ CE 2019.2.1 runtime</environment>
        <key id="13255732">HTTPCORE-599</key>
            <summary>Capacity feedback does not throttle AsyncDataConsumer.consume() for Http1</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rhashimoto">Roy Hashimoto</reporter>
                        <labels>
                    </labels>
                <created>Mon, 9 Sep 2019 21:24:37 +0000</created>
                <updated>Fri, 27 Sep 2019 09:26:17 +0000</updated>
                            <resolved>Thu, 12 Sep 2019 08:12:52 +0000</resolved>
                                    <version>5.0-beta8</version>
                                    <fixVersion>5.0-beta9</fixVersion>
                                    <component>HttpCore NIO</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3000">50m</timespent>
                                <comments>
                            <comment id="16926601" author="olegk" created="Tue, 10 Sep 2019 12:53:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhashimoto&quot; class=&quot;user-hover&quot; rel=&quot;rhashimoto&quot;&gt;rhashimoto&lt;/a&gt;&#160;The cause of the problem turns out the HTTP/1.1 protocol handler being a bit too greedy when reading data. It would not break the loop in the `readable ` event as long as it could read some data from the underlying channel, so cleared interest in read events would never get a change to take effect. This issue probably only really manifests itself in extreme scenarios with literally zero latency but it did not get around to verifying that assumption.&#160;&lt;/p&gt;

&lt;p&gt;The fix was to moderate the protocol handler greed when interest in read events got disabled as a result of the actual message exchange running out of capacity. It however required some changes in the &lt;tt&gt;IOSession&lt;/tt&gt; API that now acts as a &lt;tt&gt;ByteChannel&lt;/tt&gt; and exercises extra control over read / write operations.&lt;/p&gt;

&lt;p&gt;Pull request coming soon.&lt;/p&gt;

&lt;p&gt;Oleg&#160; &#160; &#160; &#160; &#160; &#160;&lt;/p&gt;</comment>
                            <comment id="16926693" author="rhashimoto" created="Tue, 10 Sep 2019 14:33:04 +0000"  >&lt;p&gt;The fix branch looks much better to me. It doesn&apos;t look quite as good with https as it does with http. I changed this line in Http1IntegrationTest.testSlowResponseConsumer():&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/httpcomponents-core/blob/6614b42f35e7511e9e582314c77ce0e5032cf44f/httpcore5-testing/src/test/java/org/apache/hc/core5/testing/nio/Http1IntegrationTest.java#L992&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-core/blob/6614b42f35e7511e9e582314c77ce0e5032cf44f/httpcore5-testing/src/test/java/org/apache/hc/core5/testing/nio/Http1IntegrationTest.java#L992&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;to:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;client.start(Http1Config.custom().setBufferSize(256).setInitialWindowSize(256).build());&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;to set the initial window size. Tracking the capacity at AbstractHttp1StreamDuplexer.java:313 when running this test looks like this for http:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;capacity = 5&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = -251&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = -16&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = -37&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = 221&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = -35&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = -104&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;and like this for https:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;capacity = 5&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = -251&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = -507&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = -763&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = -768&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = -11&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = 490&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = 421&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;I would expect the capacity to stay between -256 and +256 as it does for http. Maybe there is extra buffering for the TLS socket? It is throttling with https, just not as rigidly, so maybe that&apos;s okay.&lt;/p&gt;

&lt;p&gt;Aside from that the fixed behavior looks as expected.&lt;/p&gt;</comment>
                            <comment id="16926708" author="olegk" created="Tue, 10 Sep 2019 14:54:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhashimoto&quot; class=&quot;user-hover&quot; rel=&quot;rhashimoto&quot;&gt;rhashimoto&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&#160;Maybe there is extra buffering for the TLS socket&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, indeed. There is an extra layer of buffering for read / write operations. SSL buffers also need to be configured to be below the initial window size for TLS connections to behave similarly to plain connections. I can look at the whole session buffer / initial window size / SSL configuration as the next step.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="16928345" author="jira-bot" created="Thu, 12 Sep 2019 08:07:45 +0000"  >&lt;p&gt;Commit 44cab548cb4e15d56235aa12eaf0898d028351d0 in httpcomponents-core&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=44cab54&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=44cab54&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-599&quot; title=&quot;Capacity feedback does not throttle AsyncDataConsumer.consume() for Http1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-599&quot;&gt;&lt;del&gt;HTTPCORE-599&lt;/del&gt;&lt;/a&gt;: I/O sessions to stop reading from the underlying network channel of READ interest is disabled&lt;/p&gt;</comment>
                            <comment id="16928350" author="olegk" created="Thu, 12 Sep 2019 08:12:52 +0000"  >&lt;p&gt;Merged to master in as is. I am however considering a major refactoring of TLS/SSL buffering code as a separate work item.&lt;/p&gt;

&lt;p&gt;Oleg &lt;/p&gt;</comment>
                            <comment id="16928354" author="jira-bot" created="Thu, 12 Sep 2019 08:17:40 +0000"  >&lt;p&gt;Commit 44cab548cb4e15d56235aa12eaf0898d028351d0 in httpcomponents-core&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-596&quot; title=&quot;Closing idle connections may end up in a blocked connection pool&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-596&quot;&gt;&lt;del&gt;HTTPCORE-596&lt;/del&gt;&lt;/a&gt; from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=44cab54&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=44cab54&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-599&quot; title=&quot;Capacity feedback does not throttle AsyncDataConsumer.consume() for Http1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-599&quot;&gt;&lt;del&gt;HTTPCORE-599&lt;/del&gt;&lt;/a&gt;: I/O sessions to stop reading from the underlying network channel of READ interest is disabled&lt;/p&gt;</comment>
                            <comment id="16936679" author="jira-bot" created="Tue, 24 Sep 2019 11:24:31 +0000"  >&lt;p&gt;Commit ad241d1cb1137f039eba0da6d9e435dec650fafb in httpcomponents-core&apos;s branch refs/heads/tls-nio from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=ad241d1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=ad241d1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Simplification of HTTP/1.1 read event handling logic; better fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-599&quot; title=&quot;Capacity feedback does not throttle AsyncDataConsumer.consume() for Http1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-599&quot;&gt;&lt;del&gt;HTTPCORE-599&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16936680" author="jira-bot" created="Tue, 24 Sep 2019 11:26:14 +0000"  >&lt;p&gt;Commit d0876a971945061d91d208cccdd18613a9786e53 in httpcomponents-core&apos;s branch refs/heads/tls-nio from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=d0876a9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=d0876a9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Simplification of HTTP/1.1 read event handling logic; better fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-599&quot; title=&quot;Capacity feedback does not throttle AsyncDataConsumer.consume() for Http1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-599&quot;&gt;&lt;del&gt;HTTPCORE-599&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16936886" author="rhashimoto" created="Tue, 24 Sep 2019 14:50:37 +0000"  >&lt;p&gt;It looks like the change broke the fix for HTTP and isn&apos;t obviously better for HTTPS.&lt;/p&gt;

&lt;p&gt;When I run my initial test attached to the original submission (which tests HTTP only) I get this output which doesn&apos;t seem to be throttling at all:&lt;/p&gt;

&lt;p&gt;{{2019-09-24 7:38:07.973 -0700 SlowConsumerTest main FINE: Listening on /0:0:0:0:0:0:0:0:8080 }}&lt;br/&gt;
{{2019-09-24 7:42:15.085 -0700 SlowConsumerTest$MyExchangeHandler handleRequest FINEST: handleRequest called }}&lt;br/&gt;
{{2019-09-24 7:42:15.110 -0700 SlowConsumerTest$MyExchangeHandler consume FINEST: consume 8192 total 8192 }}&lt;br/&gt;
&lt;tt&gt;capacity = 0&lt;/tt&gt;&lt;br/&gt;
{{2019-09-24 7:42:15.116 -0700 SlowConsumerTest$MyExchangeHandler updateCapacity FINEST: updateCapacity called }}&lt;br/&gt;
{{2019-09-24 7:42:15.118 -0700 SlowConsumerTest$MyExchangeHandler consume FINEST: consume 8192 total 16384 }}&lt;br/&gt;
&lt;tt&gt;capacity = -8192&lt;/tt&gt;&lt;br/&gt;
{{2019-09-24 7:42:15.130 -0700 SlowConsumerTest$MyExchangeHandler updateCapacity FINEST: updateCapacity called }}&lt;br/&gt;
{{2019-09-24 7:42:15.131 -0700 SlowConsumerTest$MyExchangeHandler consume FINEST: consume 8192 total 24576 }}&lt;br/&gt;
&lt;tt&gt;capacity = -16384&lt;/tt&gt;&lt;br/&gt;
{{2019-09-24 7:42:15.137 -0700 SlowConsumerTest$MyExchangeHandler updateCapacity FINEST: updateCapacity called }}&lt;br/&gt;
{{2019-09-24 7:42:15.138 -0700 SlowConsumerTest$MyExchangeHandler consume FINEST: consume 8192 total 32768 }}&lt;br/&gt;
&lt;tt&gt;capacity = -24576&lt;/tt&gt;&lt;br/&gt;
{{2019-09-24 7:42:15.141 -0700 SlowConsumerTest$MyExchangeHandler updateCapacity FINEST: updateCapacity called }}&lt;br/&gt;
{{2019-09-24 7:42:15.142 -0700 SlowConsumerTest$MyExchangeHandler consume FINEST: consume 8192 total 40960 }}&lt;br/&gt;
&lt;tt&gt;capacity = -32768&lt;/tt&gt;&lt;br/&gt;
{{2019-09-24 7:42:15.147 -0700 SlowConsumerTest$MyExchangeHandler updateCapacity FINEST: updateCapacity called }}&lt;br/&gt;
{{2019-09-24 7:42:15.148 -0700 SlowConsumerTest$MyExchangeHandler consume FINEST: consume 8192 total 49152 }}&lt;br/&gt;
&lt;tt&gt;capacity = -40960&lt;/tt&gt;&lt;br/&gt;
{{2019-09-24 7:42:15.152 -0700 SlowConsumerTest$MyExchangeHandler updateCapacity FINEST: updateCapacity called }}&lt;br/&gt;
{{2019-09-24 7:42:15.153 -0700 SlowConsumerTest$MyExchangeHandler consume FINEST: consume 1882 total 51034 }}&lt;br/&gt;
&lt;tt&gt;capacity = -42842&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;2019-09-24 7:42:15.156 -0700 SlowConsumerTest$MyExchangeHandler streamEnd FINEST: streamEnd called&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;I also reran the test described in my comment on the first fix:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-599?focusedCommentId=16926693&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-16926693&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HTTPCORE-599?focusedCommentId=16926693&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-16926693&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It now looks worse for HTTP and about the same for HTTPS:&lt;/p&gt;

&lt;p&gt;HTTP&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;capacity = 5&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = -251&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = -507&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = -763&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = -1017&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = -1273&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = -1344&#160;&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;HTTPS&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;capacity = 0&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = -240&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = -496&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = -752&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = 0&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = 496&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = 432&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16937063" author="olegk" created="Tue, 24 Sep 2019 18:08:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhashimoto&quot; class=&quot;user-hover&quot; rel=&quot;rhashimoto&quot;&gt;rhashimoto&lt;/a&gt; I reverted the change that affected the throttling. Many thanks for testing the PR!&lt;/p&gt;

&lt;p&gt;Oleg &lt;/p&gt;</comment>
                            <comment id="16937091" author="rhashimoto" created="Tue, 24 Sep 2019 18:39:08 +0000"  >&lt;p&gt;I&apos;m happy to help. Behavior now looks essentially identical to after the original fix, i.e. throttling works within buffer size / initial window for HTTP, and with some additional buffering for HTTPS.&lt;/p&gt;</comment>
                            <comment id="16937595" author="jira-bot" created="Wed, 25 Sep 2019 10:19:34 +0000"  >&lt;p&gt;Commit 4ac49aa03445e4c7b70f5403f2d49d80353120e1 in httpcomponents-core&apos;s branch refs/heads/tls-nio from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=4ac49aa&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=4ac49aa&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Simplification of HTTP/1.1 read event handling logic; better fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-599&quot; title=&quot;Capacity feedback does not throttle AsyncDataConsumer.consume() for Http1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-599&quot;&gt;&lt;del&gt;HTTPCORE-599&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16937641" author="olegk" created="Wed, 25 Sep 2019 11:26:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhashimoto&quot; class=&quot;user-hover&quot; rel=&quot;rhashimoto&quot;&gt;rhashimoto&lt;/a&gt; Could you please try out the latest revision from this branch and let me know if input throttling works as expected? &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/httpcomponents-core/tree/tls-nio&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-core/tree/tls-nio&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="16937663" author="rhashimoto" created="Wed, 25 Sep 2019 11:57:41 +0000"  >&lt;p&gt;Behavior looks the same as my previous comment - both HTTP and HTTPS throttle, with HTTPS using wider bounds. I don&apos;t know if that is &quot;as expected&quot; with the new code or not.&lt;/p&gt;

&lt;p&gt;HTTP&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;capacity = 5&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = -251&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = -16&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = -37&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = 221&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = -35&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = -104&#160;&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;HTTPS&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;capacity = 0&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = -240&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = -496&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = -752&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = 0&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = 496&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;capacity = 432&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="16937672" author="olegk" created="Wed, 25 Sep 2019 12:11:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhashimoto&quot; class=&quot;user-hover&quot; rel=&quot;rhashimoto&quot;&gt;rhashimoto&lt;/a&gt;&#160;This is still expected. Now that the buffering logic has been simplified and application data buffering moved to the protocol handling layer I can start working on making the behavior of the HTTP/1.1 capacity window more predictable. But this is something for post 5.0 GA releases.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="16938951" author="jira-bot" created="Thu, 26 Sep 2019 20:38:07 +0000"  >&lt;p&gt;Commit dac54708766ece837f2755b7928ef83e12f9e384 in httpcomponents-core&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=dac5470&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=dac5470&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Simplification of HTTP/1.1 read event handling logic; better fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-599&quot; title=&quot;Capacity feedback does not throttle AsyncDataConsumer.consume() for Http1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-599&quot;&gt;&lt;del&gt;HTTPCORE-599&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16939250" author="jira-bot" created="Fri, 27 Sep 2019 09:26:17 +0000"  >&lt;p&gt;Commit dac54708766ece837f2755b7928ef83e12f9e384 in httpcomponents-core&apos;s branch refs/heads/development from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=dac5470&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=dac5470&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Simplification of HTTP/1.1 read event handling logic; better fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-599&quot; title=&quot;Capacity feedback does not throttle AsyncDataConsumer.consume() for Http1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-599&quot;&gt;&lt;del&gt;HTTPCORE-599&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12979896" name="SlowConsumerTest.java" size="4050" author="rhashimoto" created="Mon, 9 Sep 2019 21:07:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 7 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z06haw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>