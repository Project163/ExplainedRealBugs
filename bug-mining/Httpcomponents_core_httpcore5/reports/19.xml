<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:23:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HTTPCORE-513] ExpandableBuffer breaks on large response</title>
                <link>https://issues.apache.org/jira/browse/HTTPCORE-513</link>
                <project id="12310340" key="HTTPCORE">HttpComponents HttpCore</project>
                    <description>&lt;p&gt;Steps:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;create a PHP page with the following content:&#160;
	&lt;ol&gt;
		&lt;li&gt;&amp;lt;?php&lt;br/&gt;
 $response=&apos;abc&apos;;&lt;br/&gt;
 echo str_pad($response, 2147483647);&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
	&lt;li&gt;send a request using jMeter to the said page&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Expected result: the request is received&lt;/p&gt;

&lt;p&gt;Actual result: the VM fails with:&lt;/p&gt;

&lt;p&gt;java.lang.OutOfMemoryError: Requested array size exceeds VM limit&lt;br/&gt;
 Dumping heap to java_pid20344.hprof ...&lt;br/&gt;
 Heap dump file created &lt;span class=&quot;error&quot;&gt;&amp;#91;3275879706 bytes in 7.490 secs&amp;#93;&lt;/span&gt;&lt;br/&gt;
 Uncaught Exception java.lang.OutOfMemoryError: Requested array size exceeds VM limit. See log file for details.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Proposed solution:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;rewrite&#160;org.apache.http.nio.util.ExpandableBuffer.expand() to:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/**
* Expands buffer&apos;s capacity.
*/
&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void expand() {
  &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; newcapacity = (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.buffer.capacity() + 1) &amp;lt;&amp;lt; 1;
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (newcapacity &amp;lt; 0) {
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; headRoom = &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.max(&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;.BYTES, 8);
    &lt;span class=&quot;code-comment&quot;&gt;// Reason: In GC the size of objects is passed as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; (2 bytes). 
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// Then, the header size of the objects is added to the size. 
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; has the longest header available. &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; header seems to be linked to it. 
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// Details: I added a minimum of 8 just to be safe and because 8 is used in 
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.ArrayList: &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; MAX_ARRAY_SIZE = 2147483639.
&lt;/span&gt;
    newcapacity = &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.MAX_VALUE - headRoom; 
  } 
  expandCapacity(newcapacity); 
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13137403">HTTPCORE-513</key>
            <summary>ExpandableBuffer breaks on large response</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="herrmess">Ion Moldovan</reporter>
                        <labels>
                    </labels>
                <created>Fri, 9 Feb 2018 10:45:03 +0000</created>
                <updated>Tue, 18 Feb 2020 08:51:54 +0000</updated>
                            <resolved>Tue, 13 Feb 2018 18:30:09 +0000</resolved>
                                    <version>4.4.9</version>
                                    <fixVersion>4.4.10</fixVersion>
                    <fixVersion>5.0-beta3</fixVersion>
                                    <component>HttpCore</component>
                    <component>HttpCore NIO</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16358239" author="olegk" created="Fri, 9 Feb 2018 10:53:44 +0000"  >&lt;p&gt;Could you please raise a PR at Github with the changes you are proposing?&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="16358378" author="herrmess" created="Fri, 9 Feb 2018 13:34:57 +0000"  >&lt;p&gt;Not sure how to do that, but ok.&lt;/p&gt;</comment>
                            <comment id="16358508" author="herrmess" created="Fri, 9 Feb 2018 15:06:10 +0000"  >&lt;p&gt;I need committer rights, correct?&lt;/p&gt;

&lt;p&gt;How do I get them?&lt;/p&gt;</comment>
                            <comment id="16358564" author="olegk" created="Fri, 9 Feb 2018 15:36:42 +0000"  >&lt;p&gt;No, you do not. You just need your own private fork of the repository. If you are not familiar with Git and Github, could you submit your changes as a patch in udiff format?&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="16358572" author="herrmess" created="Fri, 9 Feb 2018 15:40:07 +0000"  >&lt;p&gt;I&apos;ll do the fork.&lt;/p&gt;

&lt;p&gt;Thanks for the help!&lt;/p&gt;</comment>
                            <comment id="16360844" author="githubbot" created="Mon, 12 Feb 2018 15:03:43 +0000"  >&lt;p&gt;GitHub user imoldovan-intacct opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/httpcomponents-core/pull/58&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-core/pull/58&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    ExpandableBuffer breaks on large response&lt;/p&gt;

&lt;p&gt;    Ticket: &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-513&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HTTPCORE-513&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/imoldovan-intacct/httpcomponents-core&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/imoldovan-intacct/httpcomponents-core&lt;/a&gt; master&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/httpcomponents-core/pull/58.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-core/pull/58.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #58&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 0f16a5b320d46831231ae4e52a77a3e479b9db1d&lt;br/&gt;
Author: imoldovan-intacct &amp;lt;imoldovan@...&amp;gt;&lt;br/&gt;
Date:   2018-02-12T15:02:06Z&lt;/p&gt;

&lt;p&gt;    ExpandableBuffer breaks on large response&lt;/p&gt;

&lt;p&gt;    Ticket: &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-513&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HTTPCORE-513&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16362396" author="githubbot" created="Tue, 13 Feb 2018 14:27:23 +0000"  >&lt;p&gt;Github user imoldovan-intacct closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/httpcomponents-core/pull/58&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-core/pull/58&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16362399" author="githubbot" created="Tue, 13 Feb 2018 14:28:02 +0000"  >&lt;p&gt;GitHub user imoldovan-intacct reopened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/httpcomponents-core/pull/58&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-core/pull/58&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    ExpandableBuffer breaks on large response&lt;/p&gt;

&lt;p&gt;    Ticket: &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-513&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HTTPCORE-513&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/imoldovan-intacct/httpcomponents-core&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/imoldovan-intacct/httpcomponents-core&lt;/a&gt; master&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/httpcomponents-core/pull/58.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-core/pull/58.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #58&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 0f16a5b320d46831231ae4e52a77a3e479b9db1d&lt;br/&gt;
Author: imoldovan-intacct &amp;lt;imoldovan@...&amp;gt;&lt;br/&gt;
Date:   2018-02-12T15:02:06Z&lt;/p&gt;

&lt;p&gt;    ExpandableBuffer breaks on large response&lt;/p&gt;

&lt;p&gt;    Ticket: &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-513&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HTTPCORE-513&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;commit 021bb0ee2ed5f3252e3bb0ce153e52369cefaead&lt;br/&gt;
Author: imoldovan-intacct &amp;lt;imoldovan@...&amp;gt;&lt;br/&gt;
Date:   2018-02-13T13:51:08Z&lt;/p&gt;

&lt;p&gt;    ExpandableBuffer breaks on large response&lt;/p&gt;

&lt;p&gt;    Ticket: &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-513&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HTTPCORE-513&lt;/a&gt;&lt;br/&gt;
    This closes #58&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16362837" author="jira-bot" created="Tue, 13 Feb 2018 18:26:55 +0000"  >&lt;p&gt;Commit a96f30b9072904e346272d2262c01c76a08f7ebb in httpcomponents-core&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=herrmess&quot; class=&quot;user-hover&quot; rel=&quot;herrmess&quot;&gt;herrmess&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=httpcomponents-core.git;h=a96f30b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=httpcomponents-core.git;h=a96f30b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;ExpandableBuffer breaks on large response&lt;/p&gt;

&lt;p&gt;Ticket: &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-513&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HTTPCORE-513&lt;/a&gt;&lt;br/&gt;
This closes #58&lt;/p&gt;</comment>
                            <comment id="16362838" author="githubbot" created="Tue, 13 Feb 2018 18:27:11 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/httpcomponents-core/pull/58&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-core/pull/58&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16362844" author="jira-bot" created="Tue, 13 Feb 2018 18:29:13 +0000"  >&lt;p&gt;Commit 11909bdcc33fbc29037338d870dd2f8a4e507ec7 in httpcomponents-core&apos;s branch refs/heads/4.4.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=herrmess&quot; class=&quot;user-hover&quot; rel=&quot;herrmess&quot;&gt;herrmess&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=httpcomponents-core.git;h=11909bd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=httpcomponents-core.git;h=11909bd&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;ExpandableBuffer breaks on large response&lt;/p&gt;

&lt;p&gt;Ticket: &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-513&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HTTPCORE-513&lt;/a&gt;&lt;br/&gt;
This closes #58&lt;/p&gt;</comment>
                            <comment id="16362846" author="olegk" created="Tue, 13 Feb 2018 18:30:09 +0000"  >&lt;p&gt;Fixed in 4.4.x and master.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="16367375" author="jira-bot" created="Fri, 16 Feb 2018 14:31:25 +0000"  >&lt;p&gt;Commit b8ff4c30677de86f4ec2ee0fadffb8d961a1193c in httpcomponents-core&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=herrmess&quot; class=&quot;user-hover&quot; rel=&quot;herrmess&quot;&gt;herrmess&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=httpcomponents-core.git;h=b8ff4c3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=httpcomponents-core.git;h=b8ff4c3&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;ExpandableBuffer breaks on large response&lt;br/&gt;
Missed an endless loop when the size is in (Integer.MAX_VALUE - headRoom, Integer.MAX_VALUE] .&lt;/p&gt;

&lt;p&gt;Ticket: &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-513&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HTTPCORE-513&lt;/a&gt;&lt;br/&gt;
This closes #59&lt;/p&gt;</comment>
                            <comment id="16367379" author="jira-bot" created="Fri, 16 Feb 2018 14:35:27 +0000"  >&lt;p&gt;Commit 890aa8da9eabfbcf5125942aa955c371f8945bf3 in httpcomponents-core&apos;s branch refs/heads/4.4.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=herrmess&quot; class=&quot;user-hover&quot; rel=&quot;herrmess&quot;&gt;herrmess&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=httpcomponents-core.git;h=890aa8d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=httpcomponents-core.git;h=890aa8d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;ExpandableBuffer breaks on large response&lt;br/&gt;
Missed an endless loop when the size is in (Integer.MAX_VALUE - headRoom, Integer.MAX_VALUE] .&lt;/p&gt;

&lt;p&gt;Ticket: &lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-513&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HTTPCORE-513&lt;/a&gt;&lt;br/&gt;
This closes #59&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 39 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3pzqv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>