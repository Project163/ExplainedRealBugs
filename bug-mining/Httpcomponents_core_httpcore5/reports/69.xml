<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:24:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HTTPCORE-727] EndpointDetails.getReceivedBytesCount() won&apos;t work under TLS</title>
                <link>https://issues.apache.org/jira/browse/HTTPCORE-727</link>
                <project id="12310340" key="HTTPCORE">HttpComponents HttpCore</project>
                    <description>&lt;p&gt;When using TLS, endpointDetails.getReceivedBytesCount(), called on disconnection(), always returns 0. I have modified AsyncFileServerExample (attached) to enable TLS and get EndpointDetails to get that metric to reproduce this issue.&lt;/p&gt;

&lt;p&gt;After executing AsyncFileServerExample, I run&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;wget --no-check-certificate https://localhost:8080/xxx&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;(it will get a 404), and the output is:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Sun, 30 Oct 2022 14:34:07 GMT | Listening on /[0:0:0:0:0:0:0:0]:8080
Sun, 30 Oct 2022 14:34:11 GMT | handle() EndpointDetails: sent=0, received=0
Sun, 30 Oct 2022 14:34:11 GMT | File .\xxx not found
Sun, 30 Oct 2022 14:34:11 GMT | disconnected() EndpointDetails: sent=252, received=0&#160;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Notice how sent bytes is updated after handle(), but received is always 0.&lt;/p&gt;

&lt;p&gt;This is the output when switching to HTTP:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Mon, 31 Oct 2022 08:09:29 GMT | Listening on /[0:0:0:0:0:0:0:0]:8080
Mon, 31 Oct 2022 08:09:46 GMT | handle() EndpointDetails: sent=0, received=114
Mon, 31 Oct 2022 08:09:46 GMT | File .\xxx not found
Mon, 31 Oct 2022 08:09:46 GMT | disconnected() EndpointDetails: sent=252, received=114&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13493682">HTTPCORE-727</key>
            <summary>EndpointDetails.getReceivedBytesCount() won&apos;t work under TLS</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="icruz">Isaac Cruz Ballesteros</reporter>
                        <labels>
                    </labels>
                <created>Mon, 31 Oct 2022 08:10:18 +0000</created>
                <updated>Wed, 2 Nov 2022 13:34:06 +0000</updated>
                            <resolved>Wed, 2 Nov 2022 09:13:11 +0000</resolved>
                                    <version>5.1.4</version>
                                    <fixVersion>5.1.5</fixVersion>
                    <fixVersion>5.2</fixVersion>
                                    <component>HttpCore NIO</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17626827" author="jira-bot" created="Mon, 31 Oct 2022 20:20:29 +0000"  >&lt;p&gt;Commit 3bc973a9ea822f6cf433982ded5894f760e74541 in httpcomponents-core&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-727&quot; title=&quot;EndpointDetails.getReceivedBytesCount() won&amp;#39;t work under TLS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-727&quot;&gt;&lt;del&gt;HTTPCORE-727&lt;/del&gt;&lt;/a&gt; from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=3bc973a9e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=3bc973a9e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-727&quot; title=&quot;EndpointDetails.getReceivedBytesCount() won&amp;#39;t work under TLS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-727&quot;&gt;&lt;del&gt;HTTPCORE-727&lt;/del&gt;&lt;/a&gt;: Protocol handlers fail to update input metrics when receive input data from a TLS encrypted I/O session&lt;/p&gt;</comment>
                            <comment id="17626829" author="olegk" created="Mon, 31 Oct 2022 20:22:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=icruz&quot; class=&quot;user-hover&quot; rel=&quot;icruz&quot;&gt;icruz&lt;/a&gt; Please test this patch and let me know if it fixes the issue for you:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/httpcomponents-core/commit/3bc973a9ea822f6cf433982ded5894f760e74541&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-core/commit/3bc973a9ea822f6cf433982ded5894f760e74541&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17627537" author="jira-bot" created="Wed, 2 Nov 2022 08:58:39 +0000"  >&lt;p&gt;Commit 3bc973a9ea822f6cf433982ded5894f760e74541 in httpcomponents-core&apos;s branch refs/heads/5.1.x from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=3bc973a9e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=3bc973a9e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-727&quot; title=&quot;EndpointDetails.getReceivedBytesCount() won&amp;#39;t work under TLS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-727&quot;&gt;&lt;del&gt;HTTPCORE-727&lt;/del&gt;&lt;/a&gt;: Protocol handlers fail to update input metrics when receive input data from a TLS encrypted I/O session&lt;/p&gt;</comment>
                            <comment id="17627538" author="jira-bot" created="Wed, 2 Nov 2022 08:58:40 +0000"  >&lt;p&gt;Commit a8f13137b554ba6bd0152fbbea15048cf4a9564f in httpcomponents-core&apos;s branch refs/heads/5.1.x from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=a8f13137b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=a8f13137b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-727&quot; title=&quot;EndpointDetails.getReceivedBytesCount() won&amp;#39;t work under TLS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-727&quot;&gt;&lt;del&gt;HTTPCORE-727&lt;/del&gt;&lt;/a&gt;: Protocol handlers fail to update input metrics when receive input data from a TLS encrypted I/O session&lt;/p&gt;</comment>
                            <comment id="17627544" author="jira-bot" created="Wed, 2 Nov 2022 09:05:12 +0000"  >&lt;p&gt;Commit 28d0a9634a63f2363b5411e1f2246c2e4e46e632 in httpcomponents-core&apos;s branch refs/heads/5.1.x from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=28d0a9634&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=28d0a9634&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-727&quot; title=&quot;EndpointDetails.getReceivedBytesCount() won&amp;#39;t work under TLS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-727&quot;&gt;&lt;del&gt;HTTPCORE-727&lt;/del&gt;&lt;/a&gt;: Protocol handlers fail to update input metrics when receive input data from a TLS encrypted I/O session&lt;/p&gt;</comment>
                            <comment id="17627551" author="jira-bot" created="Wed, 2 Nov 2022 09:12:26 +0000"  >&lt;p&gt;Commit 5ace3062a54a3d0fc5e7b1074eb759a3c9e951a8 in httpcomponents-core&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=5ace3062a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=5ace3062a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-727&quot; title=&quot;EndpointDetails.getReceivedBytesCount() won&amp;#39;t work under TLS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-727&quot;&gt;&lt;del&gt;HTTPCORE-727&lt;/del&gt;&lt;/a&gt;: Protocol handlers fail to update input metrics when receive input data from a TLS encrypted I/O session&lt;/p&gt;</comment>
                            <comment id="17627559" author="icruz" created="Wed, 2 Nov 2022 09:19:58 +0000"  >&lt;p&gt;Yes, it works now, I have only tested HTTP1 version since I&apos;m not using HTTP2 at the moment.&lt;/p&gt;

&lt;p&gt;There is another related issue, I always get sentBytesCount = 0 when handling an upload (PUT method), but I get correct values when handling a download (GET method)... but in this case I&apos;m not sure if the bug is in my own code so I will keep testing.&lt;/p&gt;</comment>
                            <comment id="17627575" author="jira-bot" created="Wed, 2 Nov 2022 09:41:35 +0000"  >&lt;p&gt;Commit 350bd4f119489ef25b16d1e87ec09c0cf0bf33bd in httpcomponents-core&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=350bd4f11&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=350bd4f11&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-727&quot; title=&quot;EndpointDetails.getReceivedBytesCount() won&amp;#39;t work under TLS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-727&quot;&gt;&lt;del&gt;HTTPCORE-727&lt;/del&gt;&lt;/a&gt;: Protocol handlers fail to update input metrics when receive input data from a TLS encrypted I/O session&lt;/p&gt;</comment>
                            <comment id="17627619" author="icruz" created="Wed, 2 Nov 2022 11:15:58 +0000"  >&lt;p&gt;So I think there is also a missing incrementBytesTransferred() call, for sentBytesCount, on following stack trace (it should be added to commitMessageHead() method after call to outbuf.flush(ioSession)):&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&#160; &#160; SessionOutputBufferImpl.flush(WritableByteChannel) line: 119 &#160; &#160;
&#160; &#160; ServerHttp1StreamDuplexer(AbstractHttp1StreamDuplexer&amp;lt;IncomingMessage,OutgoingMessage&amp;gt;).commitMessageHead(OutgoingMessage, boolean, FlushMode) line: 450 &#160; &#160;
&#160; &#160; ServerHttp1StreamDuplexer$1.submit(HttpResponse, boolean, FlushMode) line: 132 &#160; &#160;
&#160; &#160; ServerHttp1StreamDuplexer$1.submit(HttpMessage, boolean, FlushMode) line: 1 &#160; &#160;
&#160; &#160; ServerHttp1StreamHandler.commitInformation(HttpResponse) line: 205 &#160; &#160;
&#160; &#160; ServerHttp1StreamHandler.access$2(ServerHttp1StreamHandler, HttpResponse) line: 197 &#160; &#160;
&#160; &#160; ServerHttp1StreamHandler$2.sendInformation(HttpResponse, HttpContext) line: 122 &#160; &#160;
&#160; &#160; DataTransferModule$3(BasicAsyncServerExpectationDecorator).handleRequest(HttpRequest, EntityDetails, ResponseChannel, HttpContext) line: 96 &#160; &#160;
&#160; &#160; ServerHttp1StreamHandler.consumeHeader(HttpRequest, EntityDetails) line: 271 &#160; &#160;
&#160; &#160; ServerHttp1StreamDuplexer.consumeHeader(HttpRequest, EntityDetails) line: 366 &#160; &#160;
&#160; &#160; ServerHttp1StreamDuplexer.consumeHeader(HttpMessage, EntityDetails) line: 1 &#160; &#160;
&#160; &#160; ServerHttp1StreamDuplexer(AbstractHttp1StreamDuplexer&amp;lt;IncomingMessage,OutgoingMessage&amp;gt;).onInput(ByteBuffer) line: 296 &#160; &#160;
&#160; &#160; ServerHttp1IOEventHandler(AbstractHttp1IOEventHandler).inputReady(IOSession, ByteBuffer) line: 64 &#160; &#160;
&#160; &#160; ServerHttp1IOEventHandler.inputReady(IOSession, ByteBuffer) line: 1 &#160; &#160;
&#160; &#160; InternalDataChannel.onIOEvent(int) line: 133 &#160; &#160;
&#160; &#160; InternalDataChannel(InternalChannel).handleIOEvent(int) line: 51 &#160; &#160;
&#160; &#160; SingleCoreIOReactor.processEvents(Set&amp;lt;SelectionKey&amp;gt;) line: 178 &#160; &#160;
&#160; &#160; SingleCoreIOReactor.doExecute() line: 127 &#160; &#160;
&#160; &#160; SingleCoreIOReactor(AbstractSingleCoreIOReactor).execute() line: 85 &#160; &#160;
&#160; &#160; IOReactorWorker.run() line: 44 &#160; &#160;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt; do you want me to create a separate ticket for that?&lt;/p&gt;</comment>
                            <comment id="17627660" author="jira-bot" created="Wed, 2 Nov 2022 12:04:40 +0000"  >&lt;p&gt;Commit 5fdba9b535d1147a57c445cfd09b98d2367d2762 in httpcomponents-core&apos;s branch refs/heads/5.1.x from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=5fdba9b53&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=5fdba9b53&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-727&quot; title=&quot;EndpointDetails.getReceivedBytesCount() won&amp;#39;t work under TLS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-727&quot;&gt;&lt;del&gt;HTTPCORE-727&lt;/del&gt;&lt;/a&gt; (follow-up): async HTTP/1.1 protocol handler fails to count bytes transferred while flushing session buffer when writing out a message head or suspending session output.&lt;/p&gt;</comment>
                            <comment id="17627661" author="olegk" created="Wed, 2 Nov 2022 12:05:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=icruz&quot; class=&quot;user-hover&quot; rel=&quot;icruz&quot;&gt;icruz&lt;/a&gt; Please pull the latest code from 5.1.x and let me know if that fixes the problem.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17627675" author="icruz" created="Wed, 2 Nov 2022 12:27:29 +0000"  >&lt;p&gt;Yes, both sent and received bytes work now, thanks!&lt;/p&gt;</comment>
                            <comment id="17627709" author="jira-bot" created="Wed, 2 Nov 2022 13:34:06 +0000"  >&lt;p&gt;Commit 8fabd3dc130a6a3ebb037faf736acd0cb46e0b0e in httpcomponents-core&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=8fabd3dc1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=8fabd3dc1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-727&quot; title=&quot;EndpointDetails.getReceivedBytesCount() won&amp;#39;t work under TLS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-727&quot;&gt;&lt;del&gt;HTTPCORE-727&lt;/del&gt;&lt;/a&gt; (follow-up): async HTTP/1.1 protocol handler fails to count bytes transferred while flushing session buffer when writing out a message head or suspending session output.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13051625" name="AsyncFileServerExample.java" size="10708" author="icruz" created="Mon, 31 Oct 2022 08:04:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 1 week, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1amq0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>