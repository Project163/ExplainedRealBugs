<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:24:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HTTPCORE-604] HttpClient5 double-closes IOSessions for HTTP/1.1 HEAD requests</title>
                <link>https://issues.apache.org/jira/browse/HTTPCORE-604</link>
                <project id="12310340" key="HTTPCORE">HttpComponents HttpCore</project>
                    <description>&lt;p&gt;HttpClient5 consistently fails HEAD requests that have the &quot;Connection: close&quot; header on the response because the runtime always attempts to close the IOSession handling the connection twice. The second close triggers a ConnectionClosedException, causing the request to fail.&lt;/p&gt;

&lt;p&gt;For some reason, this only affects HEAD requests. All other HTTP methods work fine.&lt;/p&gt;

&lt;p&gt;I don&apos;t have a repro that I can share yet, but I&apos;m working on a fix. I&apos;m letting you know because I don&apos;t know if I&apos;ll need to make any changes in core (I suspect I will). Can you wait to release beta9 until I have a root cause?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13259341">HTTPCORE-604</key>
            <summary>HttpClient5 double-closes IOSessions for HTTP/1.1 HEAD requests</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rhernandez">Richard Hernandez</reporter>
                        <labels>
                    </labels>
                <created>Fri, 27 Sep 2019 20:19:35 +0000</created>
                <updated>Tue, 1 Oct 2019 12:58:55 +0000</updated>
                            <resolved>Tue, 1 Oct 2019 07:04:41 +0000</resolved>
                                                    <fixVersion>5.0-beta9</fixVersion>
                                    <component>HttpCore NIO</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16939798" author="rhernandez" created="Sat, 28 Sep 2019 00:26:19 +0000"  >&lt;p&gt;It&apos;s looking like I&apos;ll need to make some changes to AbstractHttp1StreamDuplexer, and maybe some of the event handling code that calls into it.&lt;/p&gt;</comment>
                            <comment id="16939799" author="rhernandez" created="Sat, 28 Sep 2019 00:29:16 +0000"  >&lt;p&gt;This bug should also affect any response that &lt;a href=&quot;https://github.com/apache/httpcomponents-core/blob/master/httpcore5/src/main/java/org/apache/hc/core5/http/message/MessageSupport.java#L175-L186&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;MessageSupport#canHaveResponseBody&lt;/tt&gt;&lt;/a&gt; thinks shouldn&apos;t have a body.&lt;/p&gt;

&lt;p&gt;edit: confirmed it affects the CONNECT case &#8211; my test originally only used methods defined in SimpleHttpRequests, which understandably lacks a CONNECT option.&lt;/p&gt;</comment>
                            <comment id="16939897" author="olegk" created="Sat, 28 Sep 2019 08:26:09 +0000"  >&lt;blockquote&gt;&lt;p&gt;Can you wait to release beta9 until I have a root cause?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhernandez&quot; class=&quot;user-hover&quot; rel=&quot;rhernandez&quot;&gt;rhernandez&lt;/a&gt; Sure. Please let me know if you need a helping hand with the fix.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="16940036" author="olegk" created="Sat, 28 Sep 2019 14:32:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhernandez&quot; class=&quot;user-hover&quot; rel=&quot;rhernandez&quot;&gt;rhernandez&lt;/a&gt; Interestingly enough, I was unable to reproduce the defect, at least with the latest core. See &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/ok2c/httpcore/commit/8c39dba4bbad9d3639580aa4490225726f22343e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ok2c/httpcore/commit/8c39dba4bbad9d3639580aa4490225726f22343e&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Am I missing some details? Could you please share a test app or a integration test reproducing the defect?&lt;/p&gt;

&lt;p&gt;Oleg &lt;/p&gt;</comment>
                            <comment id="16940534" author="rhernandez" created="Sun, 29 Sep 2019 21:03:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt; Here&apos;s a simple test which reproduces it: &lt;a href=&quot;https://gist.github.com/rhernandez35/399f646f7a0e69a595741980ce1dce15&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/rhernandez35/399f646f7a0e69a595741980ce1dce15&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Change &lt;tt&gt;HEAD&lt;/tt&gt; to &lt;tt&gt;GET&lt;/tt&gt; and it no longer fails with a &lt;tt&gt;ConnectionClosedException&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="16940536" author="rhernandez" created="Sun, 29 Sep 2019 21:06:21 +0000"  >&lt;p&gt;I want to point out that this doesn&apos;t happen if you block on getting each response in the loop, which is what the existing tests do. The test only fails if we submit all of the requests at once.&lt;/p&gt;</comment>
                            <comment id="16940943" author="jira-bot" created="Mon, 30 Sep 2019 13:09:12 +0000"  >&lt;p&gt;Commit e326a64971573cd9a42dc77d65174a906bad85c0 in httpcomponents-core&apos;s branch refs/heads/bug-fixes from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=e326a64&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=e326a64&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-604&quot; title=&quot;HttpClient5 double-closes IOSessions for HTTP/1.1 HEAD requests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-604&quot;&gt;&lt;del&gt;HTTPCORE-604&lt;/del&gt;&lt;/a&gt;: async HTTP/1.1 protocol handler must close the i/o session if it cannot be kept alive before passing control to the message exchange hanlder&lt;/p&gt;</comment>
                            <comment id="16940946" author="olegk" created="Mon, 30 Sep 2019 13:13:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhernandez&quot; class=&quot;user-hover&quot; rel=&quot;rhernandez&quot;&gt;rhernandez&lt;/a&gt; I was able to reproduce the defect with your instructions. It turned out the HTTP/1.1 i/o event handler was keeping sessions that could not be kept alive open for a bit too long, so some queued up message exchanges got assigned to connections that were about to get closed as non-reusable.&lt;/p&gt;

&lt;p&gt;Please review the fix:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/httpcomponents-core/commit/e326a64971573cd9a42dc77d65174a906bad85c0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-core/commit/e326a64971573cd9a42dc77d65174a906bad85c0&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Oleg  &lt;/p&gt;</comment>
                            <comment id="16941054" author="jira-bot" created="Mon, 30 Sep 2019 15:23:55 +0000"  >&lt;p&gt;Commit bf67d7838f1e0f378b0d28df6f55781d6b9f6154 in httpcomponents-core&apos;s branch refs/heads/bug-fixes from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=bf67d78&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=bf67d78&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-604&quot; title=&quot;HttpClient5 double-closes IOSessions for HTTP/1.1 HEAD requests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-604&quot;&gt;&lt;del&gt;HTTPCORE-604&lt;/del&gt;&lt;/a&gt;: async HTTP/1.1 protocol handler must close the i/o session if it cannot be kept alive before passing control to the message exchange hanlder&lt;/p&gt;</comment>
                            <comment id="16941299" author="rhernandez" created="Mon, 30 Sep 2019 20:03:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt; This fixes the bug for now, but I think it&apos;s a bit weird that the exchange handler the client uses is &lt;a href=&quot;https://github.com/apache/httpcomponents-client/blob/b717fde2897c338566a95494dd392be046e5050f/httpclient5/src/main/java/org/apache/hc/client5/http/impl/async/HttpAsyncMainClientExec.java#L202&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;still willing to mark this connection as reusable&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16941317" author="olegk" created="Mon, 30 Sep 2019 20:47:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhernandez&quot; class=&quot;user-hover&quot; rel=&quot;rhernandez&quot;&gt;rhernandez&lt;/a&gt; I am not sure I see that as a problem.  The actual exchange handler considers the connection as potentially re-usable but it can still be closed by the protocol handler.  What would you do differently? &lt;/p&gt;

&lt;p&gt;Oleg   &lt;/p&gt;</comment>
                            <comment id="16941591" author="jira-bot" created="Tue, 1 Oct 2019 07:01:26 +0000"  >&lt;p&gt;Commit 5d7d11bf87e8445cdb3a00562e2d7df7d6364544 in httpcomponents-core&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=5d7d11b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=5d7d11b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-604&quot; title=&quot;HttpClient5 double-closes IOSessions for HTTP/1.1 HEAD requests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-604&quot;&gt;&lt;del&gt;HTTPCORE-604&lt;/del&gt;&lt;/a&gt;: async HTTP/1.1 protocol handler must close the i/o session if it cannot be kept alive before passing control to the message exchange hanlder&lt;/p&gt;</comment>
                            <comment id="16941592" author="olegk" created="Tue, 1 Oct 2019 07:04:41 +0000"  >&lt;p&gt;Merged to master.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="16941802" author="olegk" created="Tue, 1 Oct 2019 12:58:55 +0000"  >&lt;blockquote&gt;&lt;p&gt;This fixes the bug for now, but I think it&apos;s a bit weird that the exchange handler the client uses is still willing to mark this connection as reusable.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhernandez&quot; class=&quot;user-hover&quot; rel=&quot;rhernandez&quot;&gt;rhernandez&lt;/a&gt; Would that make it less offending?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/ok2c/httpclient/commit/5812c44bf1acda8a8c21631219a5de949fa030d6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ok2c/httpclient/commit/5812c44bf1acda8a8c21631219a5de949fa030d6&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 6 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z073k0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>