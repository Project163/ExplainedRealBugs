<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:24:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HTTPCORE-676] TLS renegotiation seems to not be handled properly</title>
                <link>https://issues.apache.org/jira/browse/HTTPCORE-676</link>
                <project id="12310340" key="HTTPCORE">HttpComponents HttpCore</project>
                    <description>&lt;p&gt;Hi there,&lt;/p&gt;

&lt;p&gt;I noticed that TLS&#160;renegotiation seems to not be handled by HTTP-Core (I stumbled across this while using the Async HTTP-Client with HTTP1.1).&lt;/p&gt;

&lt;p&gt;Trying to perform an HTTP-Request to a server that requires to renegotiate the TLS connection by sending a&#160;&lt;a href=&quot;http://tools.ietf.org/html/rfc5246#section-7.4.1.1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;TLS Hello Request&lt;/a&gt; causes the request to hang (I guess until a server or a client timeout kicks in)&#160;and then fail with a generic error (e.g. &quot;execution failed: Connection is closed&quot;).&lt;/p&gt;

&lt;p&gt;I was able to reproduce the issue using &lt;tt&gt;httpd&lt;/tt&gt; and a &lt;tt&gt;Location&lt;/tt&gt; entry inside a virtual host that requests a client certificate (as in mTLS).&lt;/p&gt;

&lt;p&gt;The following minimal Apache-Configuration can be used to reproduce the problem (note that - for the sake of painless testing - the client cert is optional so the client does not have to present a certificate for performing the request successfully):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Listen 8445
SSLProtocol -all +TLSv1.2
&amp;lt;VirtualHost *:8445&amp;gt;
    ServerName some.host.de
    SSLEngine on
    
    SSLCertificateFile &lt;span class=&quot;code-quote&quot;&gt;&quot;path_to_some_cert.crt&quot;&lt;/span&gt;
    SSLCertificateKeyFile &lt;span class=&quot;code-quote&quot;&gt;&quot;path_to_some_key.key&quot;&lt;/span&gt;
    
    ProxyPass /                     http:&lt;span class=&quot;code-comment&quot;&gt;//some.target/
&lt;/span&gt;    
    &amp;lt;Location /the_resource_with_optional_client_cert&amp;gt;
        SSLVerifyClient optional_no_ca
    &amp;lt;/Location&amp;gt;
&amp;lt;/VirtualHost&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;With HTTP-Client 5 a call to &lt;tt&gt;&lt;a href=&quot;https://localhost:8445/the_resource_with_optional_client_cert&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://localhost:8445/the_resource_with_optional_client_cert&lt;/a&gt;&lt;/tt&gt; will not succeed&lt;/li&gt;
	&lt;li&gt;The &lt;tt&gt;java.net.http.HttpClient&lt;/tt&gt;, popular Browsers and Postman had no problem with performing the request
	&lt;ul&gt;
		&lt;li&gt;(at first I was not sure if that&apos;s an rather exotic thing that no one understands anyway)&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;&lt;a name=&quot;Somelogs&quot;&gt;&lt;/a&gt;Some logs&lt;/h2&gt;

&lt;p&gt;I Attached two excerpts of logs with &lt;tt&gt;javax.net.debug=all&lt;/tt&gt; and DEBUG-output for HC5:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;tt&gt;apache_hc5_tls_log_excerpt.log&lt;/tt&gt; the log-output produced by HC5&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;java_httpclient_tls_log_excerpt.log&lt;/tt&gt; the log-output produced by &lt;tt&gt;java.net.http.HttpClient&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The interesting part in &lt;tt&gt;apache_hc5_tls_log_excerpt.log&lt;/tt&gt; starts at &lt;tt&gt;10:59:39.454&lt;/tt&gt; where HC then waits 20 seconds until it consumes the &lt;tt&gt;HelloRequest&lt;/tt&gt;.&lt;br/&gt;
 The comparable part in &lt;tt&gt;java_httpclient_tls_log_excerpt.log&lt;/tt&gt; starts at &lt;tt&gt;11:37:30.017&lt;/tt&gt;.&lt;/p&gt;
&lt;h2&gt;&lt;a name=&quot;Tests&quot;&gt;&lt;/a&gt;Tests&lt;/h2&gt;

&lt;p&gt;I looked into adjusting the configuration at &lt;a href=&quot;https://github.com/apache/httpcomponents-core/tree/master/httpcore5-testing/docker/apache-httpd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-core/tree/master/httpcore5-testing/docker/apache-httpd&lt;/a&gt;, but I had some trouble understanding where the exposed ports for the image are configured in the configuration (and where to configure/expose the new https port). In the HTTP-Client project it is more clear as there are the &lt;tt&gt;EXPOSE&lt;/tt&gt;-entries in the dockerfile.&lt;/p&gt;

&lt;p&gt;Another thing I asked myself is: Where to best place a test?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13375447">HTTPCORE-676</key>
            <summary>TLS renegotiation seems to not be handled properly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="synth3">synth3</reporter>
                        <labels>
                    </labels>
                <created>Tue, 27 Apr 2021 21:18:30 +0000</created>
                <updated>Sat, 1 May 2021 14:04:09 +0000</updated>
                            <resolved>Sat, 1 May 2021 14:04:09 +0000</resolved>
                                    <version>5.1</version>
                                    <fixVersion>5.0.4</fixVersion>
                    <fixVersion>5.1.1</fixVersion>
                    <fixVersion>5.2-alpha1</fixVersion>
                                    <component>HttpCore NIO</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17334475" author="olegk" created="Wed, 28 Apr 2021 06:12:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=synth3&quot; class=&quot;user-hover&quot; rel=&quot;synth3&quot;&gt;synth3&lt;/a&gt; Would it be a big deal for you to create a Docker image with this necessary configuration?&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17334522" author="synth3" created="Wed, 28 Apr 2021 07:35:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;&#160;This should be no problem, I will look into that tonight.&lt;/p&gt;

&lt;p&gt;Best regards,&lt;br/&gt;
 Andy&lt;/p&gt;</comment>
                            <comment id="17336868" author="synth3" created="Thu, 29 Apr 2021 23:44:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;&#160;I created a reproducer with Docker image:&#160;&lt;a href=&quot;https://github.com/synth3/httpclient-tls-renegotiation-reproducer&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/synth3/httpclient-tls-renegotiation-reproducer&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;For details please see the README.&lt;/p&gt;

&lt;p&gt;Let me know if you have any questions.&lt;/p&gt;

&lt;p&gt;...unfortunately it took me a bit longer than I thought.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Best regards,&lt;br/&gt;
 Andy&lt;/p&gt;</comment>
                            <comment id="17337789" author="olegk" created="Sat, 1 May 2021 12:09:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=synth3&quot; class=&quot;user-hover&quot; rel=&quot;synth3&quot;&gt;synth3&lt;/a&gt;&#160;Thank you for a super-quality reproducer. I can now reproduce the issue with the latest snapshot of HttpCore. I am looking into it.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17337793" author="jira-bot" created="Sat, 1 May 2021 13:32:47 +0000"  >&lt;p&gt;Commit 5e15a6fe12c53273b1de629e49c3a1cda0e2a3dc in httpcomponents-core&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=5e15a6f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=5e15a6f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-676&quot; title=&quot;TLS renegotiation seems to not be handled properly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-676&quot;&gt;&lt;del&gt;HTTPCORE-676&lt;/del&gt;&lt;/a&gt;: fixed incorrect handling of TLS renegotiation by non-blocking i/o sessions&lt;/p&gt;</comment>
                            <comment id="17337794" author="jira-bot" created="Sat, 1 May 2021 13:34:23 +0000"  >&lt;p&gt;Commit 32620d1005fead628fe728c7e8e6a69930a1b6ac in httpcomponents-core&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=32620d1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=32620d1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-676&quot; title=&quot;TLS renegotiation seems to not be handled properly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-676&quot;&gt;&lt;del&gt;HTTPCORE-676&lt;/del&gt;&lt;/a&gt;: fixed incorrect handling of TLS renegotiation by non-blocking i/o sessions&lt;/p&gt;</comment>
                            <comment id="17337796" author="jira-bot" created="Sat, 1 May 2021 13:35:07 +0000"  >&lt;p&gt;Commit 352ffce12385896a31d2569cc9e904dcab966177 in httpcomponents-core&apos;s branch refs/heads/5.1.x from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=352ffce&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=352ffce&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-676&quot; title=&quot;TLS renegotiation seems to not be handled properly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-676&quot;&gt;&lt;del&gt;HTTPCORE-676&lt;/del&gt;&lt;/a&gt;: fixed incorrect handling of TLS renegotiation by non-blocking i/o sessions&lt;/p&gt;</comment>
                            <comment id="17337797" author="jira-bot" created="Sat, 1 May 2021 13:36:00 +0000"  >&lt;p&gt;Commit c70fabd67b264f7d67cf2c88a8c5ce796cb273de in httpcomponents-core&apos;s branch refs/heads/5.0.x from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=c70fabd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=c70fabd&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-676&quot; title=&quot;TLS renegotiation seems to not be handled properly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-676&quot;&gt;&lt;del&gt;HTTPCORE-676&lt;/del&gt;&lt;/a&gt;: fixed incorrect handling of TLS renegotiation by non-blocking i/o sessions&lt;/p&gt;</comment>
                            <comment id="17337805" author="olegk" created="Sat, 1 May 2021 14:04:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=synth3&quot; class=&quot;user-hover&quot; rel=&quot;synth3&quot;&gt;synth3&lt;/a&gt;&#160;Please re-test with a snapshot from one of the active 5.x branches (5.0.x, 5.1.x or master).&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13024679" name="apache_hc5_tls_log_excerpt.log" size="31849" author="synth3" created="Tue, 27 Apr 2021 21:17:54 +0000"/>
                            <attachment id="13024680" name="java_httpclient_tls_log_excerpt.log" size="44645" author="synth3" created="Tue, 27 Apr 2021 21:17:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 28 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0qip4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>