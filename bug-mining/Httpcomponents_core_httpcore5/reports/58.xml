<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:24:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HTTPCORE-658] Closing a connection triggers a javax.net.debug error to be logged</title>
                <link>https://issues.apache.org/jira/browse/HTTPCORE-658</link>
                <project id="12310340" key="HTTPCORE">HttpComponents HttpCore</project>
                    <description>&lt;p&gt;Hi,&lt;br/&gt;
 I noticed that on each SSL/TLS Connection closing the following Exception is logged when &lt;tt&gt;-Djavax.net.debug=ssl&lt;/tt&gt; is enabled:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;javax.net.ssl|ERROR|01|main|2021-01-11 11:38:11.259 CET|TransportContext.java:318|Fatal (INTERNAL_ERROR): closing inbound before receiving peer&apos;s close_notify (
&quot;throwable&quot; : {
  javax.net.ssl.SSLException: closing inbound before receiving peer&apos;s close_notify
        at java.base/sun.security.ssl.Alert.createSSLException(Alert.java:133)
        at java.base/sun.security.ssl.Alert.createSSLException(Alert.java:117)
        at java.base/sun.security.ssl.TransportContext.fatal(TransportContext.java:313)
        at java.base/sun.security.ssl.TransportContext.fatal(TransportContext.java:269)
        at java.base/sun.security.ssl.TransportContext.fatal(TransportContext.java:260)
        at java.base/sun.security.ssl.SSLSocketImpl.shutdownInput(SSLSocketImpl.java:737)
        at java.base/sun.security.ssl.SSLSocketImpl.shutdownInput(SSLSocketImpl.java:716)
        at org.apache.http.impl.BHttpConnectionBase.close(BHttpConnectionBase.java:325)
        at org.apache.http.impl.conn.LoggingManagedHttpClientConnection.close(LoggingManagedHttpClientConnection.java:81)
        at org.apache.http.impl.conn.CPoolEntry.closeConnection(CPoolEntry.java:70)
        at org.apache.http.impl.conn.CPoolEntry.close(CPoolEntry.java:96)
        at org.apache.http.pool.AbstractConnPool.shutdown(AbstractConnPool.java:149)
        at org.apache.http.impl.conn.PoolingHttpClientConnectionManager.shutdown(PoolingHttpClientConnectionManager.java:430)
        at org.apache.http.impl.client.HttpClientBuilder$2.close(HttpClientBuilder.java:1244)
        at org.apache.http.impl.client.InternalHttpClient.close(InternalHttpClient.java:201)
        at TLSCloseBug.main(TLSCloseBug.java:83)}

)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I tracked down the Problem to the BHttpConnectionBase.close code, where socket.shutdownOutput and socket.shutdownInput are called before socket.close().&lt;br/&gt;
 Why is that? The code is pretty old so maybe it was required at some point.&lt;br/&gt;
 But for the JDK 11 SSLSocketImpl this triggers the error to be logged.&lt;br/&gt;
 In general, I think it would be better to remove the shutdownOutput and shutdownInput calls and only rely on the &lt;tt&gt;Closeable&lt;/tt&gt; contract to clean up the socket.&lt;br/&gt;
 For the JDK 11 SSLSocketImpl this would fix the Problem.&lt;/p&gt;

&lt;p&gt;I also wrote a small example app to trigger the error: &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13018513/13018513_tls-close-bug.zip&quot; title=&quot;tls-close-bug.zip attached to HTTPCORE-658&quot;&gt;tls-close-bug.zip&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13351448">HTTPCORE-658</key>
            <summary>Closing a connection triggers a javax.net.debug error to be logged</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ydylla">Yannick Dylla</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 Jan 2021 12:01:50 +0000</created>
                <updated>Fri, 2 Apr 2021 10:46:31 +0000</updated>
                            <resolved>Wed, 13 Jan 2021 19:00:24 +0000</resolved>
                                    <version>4.4.13</version>
                                    <fixVersion>4.4.15</fixVersion>
                    <fixVersion>5.1-beta3</fixVersion>
                    <fixVersion>5.1</fixVersion>
                                    <component>HttpCore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17262885" author="jira-bot" created="Mon, 11 Jan 2021 19:21:15 +0000"  >&lt;p&gt;Commit f7e876bbb9ca165918e5826aa8bbba0f8b6d2268 in httpcomponents-core&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-658&quot; title=&quot;Closing a connection triggers a javax.net.debug error to be logged&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-658&quot;&gt;&lt;del&gt;HTTPCORE-658&lt;/del&gt;&lt;/a&gt; from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=f7e876b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=f7e876b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-658&quot; title=&quot;Closing a connection triggers a javax.net.debug error to be logged&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-658&quot;&gt;&lt;del&gt;HTTPCORE-658&lt;/del&gt;&lt;/a&gt;: removed explicit inbound / outbound socket shutdown from the `#close` method of classic HTTP connections&lt;/p&gt;</comment>
                            <comment id="17263210" author="ydylla" created="Tue, 12 Jan 2021 10:02:17 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;,&lt;br/&gt;
looks exactly like the fix I already tested locally &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/thumbs_up.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="17263603" author="olegk" created="Tue, 12 Jan 2021 18:59:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ydylla&quot; class=&quot;user-hover&quot; rel=&quot;ydylla&quot;&gt;ydylla&lt;/a&gt; I am somewhat conflicted about this change because I am still seeing similar warning with Adopt JDK 1.8.0.265. &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;javax.net.ssl|FINE|0F|HTTP-worker-1|2021-01-12 19:47:32.424 CET|Logger.java:765|duplex close of SSLSocket
javax.net.ssl|FINE|0F|HTTP-worker-1|2021-01-12 19:47:32.426 CET|Logger.java:765|close the underlying socket
javax.net.ssl|FINE|0F|HTTP-worker-1|2021-01-12 19:47:32.426 CET|Logger.java:765|close the SSL connection (initiative)
javax.net.ssl|FINE|0F|HTTP-worker-1|2021-01-12 19:47:32.426 CET|Logger.java:765|close inbound of SSLSocket
javax.net.ssl|WARNING|0F|HTTP-worker-1|2021-01-12 19:47:32.428 CET|Logger.java:765|SSLSocket duplex close failed (
&quot;throwable&quot; : {
  java.net.SocketException: Socket is closed
  	at java.net.Socket.shutdownInput(Socket.java:1539)
  	at sun.security.ssl.BaseSSLSocketImpl.shutdownInput(BaseSSLSocketImpl.java:216)
  	at sun.security.ssl.SSLSocketImpl.shutdownInput(SSLSocketImpl.java:643)
  	at sun.security.ssl.SSLSocketImpl.bruteForceCloseInput(SSLSocketImpl.java:598)
  	at sun.security.ssl.SSLSocketImpl.duplexCloseOutput(SSLSocketImpl.java:558)
  	at sun.security.ssl.SSLSocketImpl.close(SSLSocketImpl.java:471)
  	at org.apache.hc.core5.http.impl.io.BHttpConnectionBase.close(BHttpConnectionBase.java:255)
  	at org.apache.hc.core5.http.impl.io.DefaultBHttpServerConnection.close(DefaultBHttpServerConnection.java:59)
  	at org.apache.hc.core5.http.impl.io.HttpService$1.submitResponse(HttpService.java:234)
  	at org.apache.hc.core5.http.io.support.HttpServerFilterChainRequestHandler$1.submitResponse(HttpServerFilterChainRequestHandler.java:68)
  	at org.apache.hc.core5.testing.classic.ClassicServerAndRequesterTest$1$1$1.submitResponse(ClassicServerAndRequesterTest.java:126)
  	at org.apache.hc.core5.http.io.support.TerminalServerFilter.handle(TerminalServerFilter.java:79)
  	at org.apache.hc.core5.http.io.support.HttpServerFilterChainElement.handle(HttpServerFilterChainElement.java:68)
  	at org.apache.hc.core5.http.io.support.HttpServerFilterChainElement$1.proceed(HttpServerFilterChainElement.java:59)
  	at org.apache.hc.core5.testing.classic.ClassicServerAndRequesterTest$1$1.handle(ClassicServerAndRequesterTest.java:112)
  	at org.apache.hc.core5.http.io.support.HttpServerFilterChainElement.handle(HttpServerFilterChainElement.java:68)
  	at org.apache.hc.core5.http.io.support.HttpServerFilterChainElement$1.proceed(HttpServerFilterChainElement.java:59)
  	at org.apache.hc.core5.http.io.support.HttpServerExpectationFilter.handle(HttpServerExpectationFilter.java:100)
  	at org.apache.hc.core5.http.io.support.HttpServerFilterChainElement.handle(HttpServerFilterChainElement.java:68)
  	at org.apache.hc.core5.http.io.support.HttpServerFilterChainRequestHandler.handle(HttpServerFilterChainRequestHandler.java:59)
  	at org.apache.hc.core5.http.impl.io.HttpService.handleRequest(HttpService.java:190)
  	at org.apache.hc.core5.http.impl.bootstrap.Worker.run(Worker.java:62)
  	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
  	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
  	at java.lang.Thread.run(Thread.java:748)}

)
javax.net.ssl|FINE|01|main|2021-01-12 19:47:32.429 CET|Logger.java:765|duplex close of SSLSocket
javax.net.ssl|FINE|01|main|2021-01-12 19:47:32.429 CET|Logger.java:765|close the underlying socket
javax.net.ssl|FINE|01|main|2021-01-12 19:47:32.430 CET|Logger.java:765|close the SSL connection (initiative)
javax.net.ssl|FINE|01|main|2021-01-12 19:47:32.430 CET|Logger.java:765|close inbound of SSLSocket
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However Adopt JDK 11.0.8 does seem to be able to close out connections cleanly &lt;/p&gt;

&lt;p&gt;What I think I will do is committing the change to HttpCore 5.1.x and 5.2.x while leaving HttpCore 4.4.x and 5.0.x as it.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17264045" author="ydylla" created="Wed, 13 Jan 2021 10:30:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt; I think you should change it everywhere.&lt;/p&gt;

&lt;p&gt;I could also reproduce the &quot;Socket is closed&quot; Exception with AdoptOpenJDK 1.8.0_275 but note that the logging level for this is only WARNING instead of SERVE like for the &quot;closing inbound before receiving peer&apos;s close_notify&quot; Exception.&lt;br/&gt;
So I would still see the fix as an improvement.&lt;/p&gt;

&lt;p&gt;But further when I try it with an old OpenJdk 1.8.0_181 the issue is also fixed. No warning or exceptions anymore.&lt;br/&gt;
For me it looks like a bug in AdoptOpenJDK 1.8, how else would you close the Socket if not with its close function?&lt;/p&gt;

&lt;p&gt;And lastly the selfish reason we are probably not able to upgrade to 5.x soon, so a fix in 4.4.x would be nice &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17264324" author="jira-bot" created="Wed, 13 Jan 2021 18:00:37 +0000"  >&lt;p&gt;Commit f7e876bbb9ca165918e5826aa8bbba0f8b6d2268 in httpcomponents-core&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=f7e876b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=f7e876b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-658&quot; title=&quot;Closing a connection triggers a javax.net.debug error to be logged&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-658&quot;&gt;&lt;del&gt;HTTPCORE-658&lt;/del&gt;&lt;/a&gt;: removed explicit inbound / outbound socket shutdown from the `#close` method of classic HTTP connections&lt;/p&gt;</comment>
                            <comment id="17264347" author="jira-bot" created="Wed, 13 Jan 2021 18:42:10 +0000"  >&lt;p&gt;Commit 78d29c4a556bd5f39529d8e9d69dda901653f2ad in httpcomponents-core&apos;s branch refs/heads/5.0.x from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=78d29c4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=78d29c4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-658&quot; title=&quot;Closing a connection triggers a javax.net.debug error to be logged&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-658&quot;&gt;&lt;del&gt;HTTPCORE-658&lt;/del&gt;&lt;/a&gt;: removed explicit inbound / outbound socket shutdown from the `#close` method of classic HTTP connections&lt;/p&gt;</comment>
                            <comment id="17264360" author="jira-bot" created="Wed, 13 Jan 2021 18:59:20 +0000"  >&lt;p&gt;Commit 574e69d88fd34db06c1223d27b908b3fbb2a321c in httpcomponents-core&apos;s branch refs/heads/4.4.x from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=574e69d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=574e69d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-658&quot; title=&quot;Closing a connection triggers a javax.net.debug error to be logged&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-658&quot;&gt;&lt;del&gt;HTTPCORE-658&lt;/del&gt;&lt;/a&gt;: removed explicit inbound / outbound socket shutdown from the  method of classic HTTP connections&lt;/p&gt;</comment>
                            <comment id="17264361" author="jira-bot" created="Wed, 13 Jan 2021 19:01:27 +0000"  >&lt;p&gt;Commit 0351d81a50a24f07c9dfb5a4e2ccf0378a71e060 in httpcomponents-core&apos;s branch refs/heads/4.4.x from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=0351d81&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=0351d81&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-658&quot; title=&quot;Closing a connection triggers a javax.net.debug error to be logged&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-658&quot;&gt;&lt;del&gt;HTTPCORE-658&lt;/del&gt;&lt;/a&gt;: removed explicit inbound / outbound socket shutdown from the `#close` method of classic HTTP connections&lt;/p&gt;</comment>
                            <comment id="17264362" author="olegk" created="Wed, 13 Jan 2021 19:02:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ydylla&quot; class=&quot;user-hover&quot; rel=&quot;ydylla&quot;&gt;ydylla&lt;/a&gt; I applied the same fix to all supported barches.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17264711" author="ydylla" created="Thu, 14 Jan 2021 09:25:56 +0000"  >&lt;p&gt;Perfect, thank you again &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12359886">HTTPCORE-22</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13018513" name="tls-close-bug.zip" size="1364212" author="ydylla" created="Mon, 11 Jan 2021 12:00:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 43 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0mg60:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>