<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:24:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HTTPCORE-757] AbstractCharDataConsumer jams up with incomplete UTF-8 data</title>
                <link>https://issues.apache.org/jira/browse/HTTPCORE-757</link>
                <project id="12310340" key="HTTPCORE">HttpComponents HttpCore</project>
                    <description>&lt;p&gt;While streaming UTF-8-encoded data with the async HTTP client, we observed the following behaviour:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;After several minutes of consuming from our stream, the client jammed up permanently and did not recover without a restart&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Upon closer inspection, we realised that `AbstractCharDataConsumer` (which we were extending to parse our data) was receiving incomplete UTF-8 characters from the end of the stream (i.e. the last character in the stream was multi-byte and we hadn&apos;t yet received all bytes for it), and this was causing it to go into an infinite loop on the following code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Override
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; void consume(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ByteBuffer src) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; CharsetDecoder charsetDecoder = getCharsetDecoder();
    &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (src.hasRemaining()) {
        checkResult(charsetDecoder.decode(src, charBuffer, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;));
        doDecode(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
    }
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This was fairly time-consuming to figure out and required us to go deep into the brain of the library.&lt;/p&gt;

&lt;p&gt;We don&apos;t know how this could be improved exactly, but a couple of thoughts:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;If this class expects a completely valid text string in the buffer with no trailing bytes:
	&lt;ul&gt;
		&lt;li&gt;Then it should throw some exception once it detects that it&apos;s failing to completely process the buffer&lt;/li&gt;
		&lt;li&gt;And the caller could deal with this somehow (either by catching this exception and waiting for more data, or otherwise ensuring that the input is valid before calling the consumer - though it&apos;s not clear how it could do that without also having knowledge of the encoding)&lt;/li&gt;
		&lt;li&gt;Alternatively, the caller could simply bubble up the exception and let us know that we shouldn&apos;t be using this class when there is only partial data. That would also have helped us to diagnose the issue&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;OTOH if this class is expected to be able to handle partially complete input:
	&lt;ul&gt;
		&lt;li&gt;Then it should store the trailing unprocessable bytes into a buffer, and prepend them to the beginning of the next input (hopefully resulting in a valid UTF-8 string, though it would also have to handle the case where it didn&apos;t)&lt;/li&gt;
		&lt;li&gt;This was roughly how we solved the issue on our side - we extended `&lt;br/&gt;
AbstractBinDataConsumer` instead and handled the encoding ourselves&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="13549465">HTTPCORE-757</key>
            <summary>AbstractCharDataConsumer jams up with incomplete UTF-8 data</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="simon.white">Simon White</reporter>
                        <labels>
                    </labels>
                <created>Sat, 2 Sep 2023 12:05:28 +0000</created>
                <updated>Wed, 20 Sep 2023 17:13:59 +0000</updated>
                            <resolved>Fri, 15 Sep 2023 09:19:45 +0000</resolved>
                                    <version>5.2.2</version>
                                    <fixVersion>5.2.3</fixVersion>
                    <fixVersion>5.3-alpha1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17761575" author="olegk" created="Sun, 3 Sep 2023 10:06:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=simon.white&quot; class=&quot;user-hover&quot; rel=&quot;simon.white&quot;&gt;simon.white&lt;/a&gt;&#160;It would help a great deal if you could capture the response body or reproduce the issue with a unit test or a test app.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17761576" author="michael-o" created="Sun, 3 Sep 2023 10:24:34 +0000"  >&lt;p&gt;W/o looking into it, I bet you need a four-byte buffer to read bytes until you reach a valid UTF-8 sequences instead of single bytes.&lt;/p&gt;</comment>
                            <comment id="17761577" author="JIRAUSER302090" created="Sun, 3 Sep 2023 10:40:27 +0000"  >&lt;p&gt;Hey guys, thanks for the quick response and for looking into this!&lt;/p&gt;

&lt;p&gt;I will try to put together a quick test app to demonstrate the jamming issue we encountered in its entirety. (I could write a unit test to show the infinite loop in the consumer class, but I don&apos;t think it would prove very much on its own.)&lt;/p&gt;</comment>
                            <comment id="17761583" author="JIRAUSER302090" created="Sun, 3 Sep 2023 11:40:56 +0000"  >&lt;p&gt;It&apos;s a little quick and dirty (so please just let me know if it doesn&apos;t work for you or is insufficient to show the issue): &lt;a href=&quot;https://bitbucket.org/RedNacho/httpcore-757-reproduction/src/main/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://bitbucket.org/RedNacho/httpcore-757-reproduction/src/main/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17761800" author="jira-bot" created="Mon, 4 Sep 2023 11:55:53 +0000"  >&lt;p&gt;Commit fa6dbd47bdb222fedc7f50ee8be6c7399d2d8603 in httpcomponents-core&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-757&quot; title=&quot;AbstractCharDataConsumer jams up with incomplete UTF-8 data&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-757&quot;&gt;&lt;del&gt;HTTPCORE-757&lt;/del&gt;&lt;/a&gt; from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=fa6dbd47b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=fa6dbd47b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-757&quot; title=&quot;AbstractCharDataConsumer jams up with incomplete UTF-8 data&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-757&quot;&gt;&lt;del&gt;HTTPCORE-757&lt;/del&gt;&lt;/a&gt;: AbstractCharDataConsumer fails to correctly handle incomplete UTF8 encoded data split across multiple data packets&lt;/p&gt;</comment>
                            <comment id="17761802" author="olegk" created="Mon, 4 Sep 2023 11:57:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=simon.white&quot; class=&quot;user-hover&quot; rel=&quot;simon.white&quot;&gt;simon.white&lt;/a&gt; Please review / test the proposed fix:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/httpcomponents-core/compare/master...HTTPCORE-757&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-core/compare/master...HTTPCORE-757&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17761876" author="JIRAUSER302090" created="Mon, 4 Sep 2023 19:14:42 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I&apos;ve tested that and it&apos;s working as expected. Will take a closer look at the implementation tomorrow.&lt;/p&gt;

&lt;p&gt;Thanks for the quick fix!&lt;/p&gt;</comment>
                            <comment id="17763415" author="michael-o" created="Sun, 10 Sep 2023 12:03:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt;, I think we can conclude this issue, no?&lt;/p&gt;</comment>
                            <comment id="17764066" author="olegk" created="Tue, 12 Sep 2023 08:03:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=michael-o&quot; class=&quot;user-hover&quot; rel=&quot;michael-o&quot;&gt;michael-o&lt;/a&gt; I would give &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=simon.white&quot; class=&quot;user-hover&quot; rel=&quot;simon.white&quot;&gt;simon.white&lt;/a&gt; a few more days to review and test the change but will merge the branch in a few days regardless.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17765519" author="jira-bot" created="Fri, 15 Sep 2023 09:18:57 +0000"  >&lt;p&gt;Commit a61583a076483f61914a33840d006918b2a094bd in httpcomponents-core&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=a61583a07&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=a61583a07&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-757&quot; title=&quot;AbstractCharDataConsumer jams up with incomplete UTF-8 data&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-757&quot;&gt;&lt;del&gt;HTTPCORE-757&lt;/del&gt;&lt;/a&gt;: AbstractCharDataConsumer fails to correctly handle incomplete UTF8 encoded data split across multiple data packets&lt;/p&gt;</comment>
                            <comment id="17765640" author="jira-bot" created="Fri, 15 Sep 2023 13:30:13 +0000"  >&lt;p&gt;Commit 6f8f5794b6795f7d22a24b6ea5ca24269f5a34f2 in httpcomponents-core&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=6f8f5794b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=6f8f5794b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-757&quot; title=&quot;AbstractCharDataConsumer jams up with incomplete UTF-8 data&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-757&quot;&gt;&lt;del&gt;HTTPCORE-757&lt;/del&gt;&lt;/a&gt;: AbstractCharDataConsumer fails to correctly handle incomplete UTF8 encoded data split across multiple data packets&lt;/p&gt;</comment>
                            <comment id="17766680" author="JIRAUSER302090" created="Tue, 19 Sep 2023 07:34:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt; Sorry for the delay here, I was on vacation.&lt;/p&gt;

&lt;p&gt;I did take a look at the code beforehand, and it all made sense to me.&lt;/p&gt;

&lt;p&gt;Thank you for the fix.&lt;/p&gt;</comment>
                            <comment id="17767207" author="jira-bot" created="Wed, 20 Sep 2023 17:13:59 +0000"  >&lt;p&gt;Commit 6f8f5794b6795f7d22a24b6ea5ca24269f5a34f2 in httpcomponents-core&apos;s branch refs/heads/dependabot/maven/io.reactivex.rxjava3-rxjava-3.1.7 from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=6f8f5794b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=6f8f5794b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-757&quot; title=&quot;AbstractCharDataConsumer jams up with incomplete UTF-8 data&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-757&quot;&gt;&lt;del&gt;HTTPCORE-757&lt;/del&gt;&lt;/a&gt;: AbstractCharDataConsumer fails to correctly handle incomplete UTF8 encoded data split across multiple data packets&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 7 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1k5gg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>