diff --git a/httpcore5/src/main/java/org/apache/hc/core5/http/nio/support/classic/SharedOutputBuffer.java b/httpcore5/src/main/java/org/apache/hc/core5/http/nio/support/classic/SharedOutputBuffer.java
index ee494f4e6..bf25a9b78 100644
--- a/httpcore5/src/main/java/org/apache/hc/core5/http/nio/support/classic/SharedOutputBuffer.java
+++ b/httpcore5/src/main/java/org/apache/hc/core5/http/nio/support/classic/SharedOutputBuffer.java
@@ -43,10 +43,12 @@ public final class SharedOutputBuffer extends AbstractSharedBuffer implements Co
 
     private volatile DataStreamChannel dataStreamChannel;
     private volatile boolean hasCapacity;
+    private volatile boolean endStreamPropagated;
 
     public SharedOutputBuffer(final ReentrantLock lock, final int initialBufferSize) {
         super(lock, initialBufferSize);
         this.hasCapacity = false;
+        this.endStreamPropagated = false;
     }
 
     public SharedOutputBuffer(final int bufferSize) {
@@ -63,7 +65,7 @@ public void flush(final DataStreamChannel channel) throws IOException {
                 dataStreamChannel.write(buffer());
             }
             if (!buffer().hasRemaining() && endStream) {
-                dataStreamChannel.endStream();
+                propagateEndStream();
             }
             condition.signalAll();
         } finally {
@@ -135,7 +137,7 @@ public void writeCompleted() throws IOException {
                     if (buffer().hasRemaining()) {
                         dataStreamChannel.requestOutput();
                     } else {
-                        dataStreamChannel.endStream();
+                        propagateEndStream();
                     }
                 }
             }
@@ -162,4 +164,11 @@ private void waitFlush() throws InterruptedIOException {
         setInputMode();
     }
 
+    private void propagateEndStream() throws IOException {
+        if (!endStreamPropagated) {
+            dataStreamChannel.endStream();
+            endStreamPropagated = true;
+        }
+    }
+
 }
diff --git a/httpcore5/src/test/java/org/apache/hc/core5/http/nio/support/classic/TestSharedOutputBuffer.java b/httpcore5/src/test/java/org/apache/hc/core5/http/nio/support/classic/TestSharedOutputBuffer.java
index 428b14da8..6858dc288 100644
--- a/httpcore5/src/test/java/org/apache/hc/core5/http/nio/support/classic/TestSharedOutputBuffer.java
+++ b/httpcore5/src/test/java/org/apache/hc/core5/http/nio/support/classic/TestSharedOutputBuffer.java
@@ -229,5 +229,19 @@ public Boolean call() throws Exception {
         }
     }
 
+    @Test
+    public void testEndStreamOnlyCalledOnce() throws IOException {
+
+        final DataStreamChannel channel = Mockito.mock(DataStreamChannel.class);
+        final SharedOutputBuffer outputBuffer = new SharedOutputBuffer(20);
+
+        outputBuffer.flush(channel);
+
+        outputBuffer.writeCompleted();
+        outputBuffer.flush(channel);
+
+        Mockito.verify(channel, Mockito.times(1)).endStream();
+    }
+
 }
 
