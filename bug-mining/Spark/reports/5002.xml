<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:54:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-21219] Task retry occurs on same executor due to race condition with blacklisting</title>
                <link>https://issues.apache.org/jira/browse/SPARK-21219</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;When a task fails it is (1) added into the pending task list and then (2) corresponding black list policy is enforced (ie, specifying if it can/can&apos;t run on a particular node/executor/etc.)  Unfortunately the ordering is such that retrying the task could assign the task to the same executor, which, incidentally could be shutting down and immediately fail the retry.   Instead the order should be (1) the black list state should be updated and then (2) the task assigned, ensuring that the black list policy is properly enforced.&lt;/p&gt;

&lt;p&gt;The attached logs demonstrate the race condition.&lt;/p&gt;

&lt;p&gt;See spark_executor.log.anon:&lt;/p&gt;

&lt;p&gt;1. Task 55.2 fails on the executor&lt;/p&gt;

&lt;p&gt;17/06/20 13:25:07 ERROR Executor: Exception in task 55.2 in stage 5.0 (TID 39575)&lt;br/&gt;
java.lang.OutOfMemoryError: Java heap space&lt;/p&gt;

&lt;p&gt;2. Immediately the same executor is assigned the retry task:&lt;/p&gt;

&lt;p&gt;17/06/20 13:25:07 INFO CoarseGrainedExecutorBackend: Got assigned task 39651&lt;br/&gt;
17/06/20 13:25:07 INFO Executor: Running task 55.3 in stage 5.0 (TID 39651)&lt;/p&gt;

&lt;p&gt;3. The retry task of course fails since the executor is also shutting down due to the original task 55.2 OOM failure.&lt;/p&gt;

&lt;p&gt;See the spark_driver.log.anon:&lt;/p&gt;

&lt;p&gt;The driver processes the lost task 55.2:&lt;/p&gt;

&lt;p&gt;17/06/20 13:25:07 WARN TaskSetManager: Lost task 55.2 in stage 5.0 (TID 39575, foobar####.masked-server.com, executor attempt_foobar####.masked-server.com-####&lt;em&gt;####&lt;/em&gt;####&lt;em&gt;####.masked-server.com-####&lt;/em&gt;####&lt;em&gt;####&lt;/em&gt;####_0): java.lang.OutOfMemoryError: Java heap space&lt;/p&gt;

&lt;p&gt;The driver then receives the ExecutorLostFailure for the retry task 55.3 (although it&apos;s obfuscated in these logs, the server info is same...)&lt;/p&gt;

&lt;p&gt;17/06/20 13:25:10 WARN TaskSetManager: Lost task 55.3 in stage 5.0 (TID 39651, foobar####.masked-server.com, executor attempt_foobar####.masked-server.com-####&lt;em&gt;####&lt;/em&gt;####&lt;em&gt;####.masked-server.com-####&lt;/em&gt;####&lt;em&gt;####&lt;/em&gt;####&lt;em&gt;0): ExecutorLostFailure (executor attempt_foobar####.masked-server.com-####&lt;/em&gt;####&lt;em&gt;####&lt;/em&gt;####.masked-server.com-####&lt;em&gt;####&lt;/em&gt;####_####_0 exited caused by one of the running tasks) Reason: Remote RPC client disassociated. Likely due to containers exceeding thresholds, or network issues. Check driver logs for WARN messages.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13082643">SPARK-21219</key>
            <summary>Task retry occurs on same executor due to race condition with blacklisting</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ericvandenbergfb">Eric Vandenberg</assignee>
                                    <reporter username="ericvandenbergfb">Eric Vandenberg</reporter>
                        <labels>
                    </labels>
                <created>Mon, 26 Jun 2017 21:41:57 +0000</created>
                <updated>Sun, 17 May 2020 17:46:49 +0000</updated>
                            <resolved>Mon, 10 Jul 2017 06:41:02 +0000</resolved>
                                    <version>2.1.1</version>
                                    <fixVersion>2.2.1</fixVersion>
                    <fixVersion>2.3.0</fixVersion>
                                    <component>Scheduler</component>
                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16063909" author="apachespark" created="Mon, 26 Jun 2017 22:27:03 +0000"  >&lt;p&gt;User &apos;ericvandenbergfb&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18427&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18427&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16079923" author="cloud_fan" created="Mon, 10 Jul 2017 06:41:02 +0000"  >&lt;p&gt;Issue resolved by pull request 18427&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18427&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18427&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16083082" author="jsoltren" created="Tue, 11 Jul 2017 22:13:28 +0000"  >&lt;p&gt;I think it would be good to backport this to 2.2 and 2.1. Any objections? I&apos;ll start putting together backport PRs shortly, assuming there are none.&lt;/p&gt;</comment>
                            <comment id="16083134" author="apachespark" created="Tue, 11 Jul 2017 22:58:04 +0000"  >&lt;p&gt;User &apos;jsoltren&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18604&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18604&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12874566" name="spark_driver.log.anon" size="4516" author="ericvandenbergfb" created="Mon, 26 Jun 2017 21:42:31 +0000"/>
                            <attachment id="12874567" name="spark_executor.log.anon" size="7889" author="ericvandenbergfb" created="Mon, 26 Jun 2017 21:42:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 18 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3gr7b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>