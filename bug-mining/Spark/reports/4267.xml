<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:49:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-18504] Scalar subquery with extra group by columns returning incorrect result</title>
                <link>https://issues.apache.org/jira/browse/SPARK-18504</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description></description>
                <environment></environment>
        <key id="13021856">SPARK-18504</key>
            <summary>Scalar subquery with extra group by columns returning incorrect result</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nsyca">Nattavut Sutyanyong</assignee>
                                    <reporter username="nsyca">Nattavut Sutyanyong</reporter>
                        <labels>
                            <label>correctness</label>
                    </labels>
                <created>Fri, 18 Nov 2016 21:11:49 +0000</created>
                <updated>Tue, 14 May 2019 06:28:19 +0000</updated>
                            <resolved>Tue, 22 Nov 2016 20:07:34 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.3</fixVersion>
                    <fixVersion>2.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15677765" author="nsyca" created="Fri, 18 Nov 2016 21:13:35 +0000"  >&lt;p&gt;// Incorrect result&lt;br/&gt;
Seq(1).toDF(&quot;c1&quot;).createOrReplaceTempView(&quot;t1&quot;)&lt;br/&gt;
Seq((1,1),(1,2)).toDF(&quot;c1&quot;,&quot;c2&quot;).createOrReplaceTempView(&quot;t2&quot;)&lt;br/&gt;
sql(&quot;select (select sum(-1) from t2 where t1.c1=t2.c1 group by t2.c2) from t1&quot;).show&lt;/p&gt;

&lt;p&gt;// How can selecting a scalar subquery from a 1-row table return 2 rows?&lt;/p&gt;</comment>
                            <comment id="15677848" author="hvanhovell" created="Fri, 18 Nov 2016 21:45:41 +0000"  >&lt;p&gt;Is this a valid correlated scalar subquery?&lt;/p&gt;

&lt;p&gt;They only way to prevent this is to add a check in the analyzer (as long as we don&apos;t have a subquery processing node which would be able to enforce a single row result per key at runtime). What makes this a bit more complicated that this only applies scalar subqueries and not to predicate subqueries.&lt;/p&gt;</comment>
                            <comment id="15677849" author="hvanhovell" created="Fri, 18 Nov 2016 21:45:53 +0000"  >&lt;p&gt;Could you open a PR?&lt;/p&gt;</comment>
                            <comment id="15677991" author="apachespark" created="Fri, 18 Nov 2016 22:41:06 +0000"  >&lt;p&gt;User &apos;nsyca&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/15936&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/15936&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15678001" author="nsyca" created="Fri, 18 Nov 2016 22:45:10 +0000"  >&lt;p&gt;While we have &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-18455&quot; title=&quot;General support for correlated subquery processing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-18455&quot;&gt;&lt;del&gt;SPARK-18455&lt;/del&gt;&lt;/a&gt; to track the progress of a better solution to process Subquery, I feel we should close this loophole as soon as possible. The fix simply blocks the scenario where there are extra GROUP BY columns beyond the ones in the correlated predicates of the same scalar subquery.&lt;/p&gt;</comment>
                            <comment id="15685461" author="nsyca" created="Tue, 22 Nov 2016 02:32:07 +0000"  >&lt;p&gt;Revise the reproduction script to be more concise&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Seq((1,1),(1,2)).toDF(&lt;span class=&quot;code-quote&quot;&gt;&quot;c1&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;c2&quot;&lt;/span&gt;).createOrReplaceTempView(&lt;span class=&quot;code-quote&quot;&gt;&quot;t&quot;&lt;/span&gt;)
sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;select (select sum(-1) from t t2 where t1.c2=t2.c1 group by t2.c2) from t t1&quot;&lt;/span&gt;).show

+---------------------------+
|scalarsubquery((c2 = c1#5))|
+---------------------------+
|                         -1|
|                         -1|
|                       &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;|
+---------------------------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The result should return only one &quot;-1&quot; row, not two.&lt;/p&gt;

&lt;p&gt;This JIRA will block this type of query where the column(s) in the GROUP BY clause are not part of the WHERE clause.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13020945">SPARK-18455</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i36itb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>