<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:36:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-12662] Add a local sort operator to DataFrame used by randomSplit</title>
                <link>https://issues.apache.org/jira/browse/SPARK-12662</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;With &lt;tt&gt;./bin/spark-shell --master=local-cluster&lt;span class=&quot;error&quot;&gt;&amp;#91;2,1,2014&amp;#93;&lt;/span&gt;&lt;/tt&gt;, the following code will provide overlapped rows for two DFs returned by the randomSplit. &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;sqlContext.sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;drop table &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; exists test&quot;&lt;/span&gt;)
val x = sc.parallelize(1 to 210)
&lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;R(ID : Int)
sqlContext.createDataFrame(x.map {R(_)}).write.format(&lt;span class=&quot;code-quote&quot;&gt;&quot;json&quot;&lt;/span&gt;).saveAsTable(&lt;span class=&quot;code-quote&quot;&gt;&quot;bugsc1597&quot;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; df = sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;select distinct ID from test&quot;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; Array(a, b) = df.randomSplit(Array(0.333, 0.667), 1234L)
a.registerTempTable(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;)
b.registerTempTable(&lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;)
val intersectDF = a.intersect(b)
intersectDF.show
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The reason is that {{sql(&quot;select distinct ID from test&quot;)} does not guarantee the ordering rows in a partition. It will be good to add a local sort operator to make row ordering within a partition deterministic.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12927394">SPARK-12662</key>
            <summary>Add a local sort operator to DataFrame used by randomSplit</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sameerag">Sameer Agarwal</assignee>
                                    <reporter username="yhuai">Yin Huai</reporter>
                        <labels>
                    </labels>
                <created>Wed, 6 Jan 2016 00:02:21 +0000</created>
                <updated>Thu, 7 Jan 2016 18:37:40 +0000</updated>
                            <resolved>Thu, 7 Jan 2016 18:37:40 +0000</resolved>
                                                    <fixVersion>1.6.1</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>Documentation</component>
                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>11</watches>
                                                                                                                <comments>
                            <comment id="15084106" author="yhuai" created="Wed, 6 Jan 2016 00:03:10 +0000"  >&lt;p&gt;Another option is to always add local sort operator to make sure the row ordering is deterministic.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davies&quot; class=&quot;user-hover&quot; rel=&quot;davies&quot;&gt;davies&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rxin&quot; class=&quot;user-hover&quot; rel=&quot;rxin&quot;&gt;rxin&lt;/a&gt; what do you think?&lt;/p&gt;</comment>
                            <comment id="15084109" author="rxin" created="Wed, 6 Jan 2016 00:04:22 +0000"  >&lt;p&gt;Seems like that should be the user &apos;s choice? We can improve documentation.&lt;/p&gt;</comment>
                            <comment id="15084429" author="yhuai" created="Wed, 6 Jan 2016 00:27:11 +0000"  >&lt;p&gt;OK. Let&apos;s use this jira to track the work of adding document.&lt;/p&gt;</comment>
                            <comment id="15085005" author="bpasley" created="Wed, 6 Jan 2016 05:37:22 +0000"  >&lt;p&gt;Users&apos; expectation for randomSplit probably doesn&apos;t realize the disjoint sets depend on sorted data. randomSplit is used in ML pipeline to split training/validation/test sets which is common operation that doesn&apos;t assume sorted data in general.  e.g.:&lt;br/&gt;
&lt;a href=&quot;http://github.com/apache/spark/blob/master/mllib/src/main/scala/org/apache/spark/ml/tuning/TrainValidationSplit.scala&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://github.com/apache/spark/blob/master/mllib/src/main/scala/org/apache/spark/ml/tuning/TrainValidationSplit.scala&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If user misses the documentation, they may end up with overlapping train/test sets without realizing it.  Can we add local sort operator or warn user there is overlap? &lt;/p&gt;</comment>
                            <comment id="15085007" author="rxin" created="Wed, 6 Jan 2016 05:39:05 +0000"  >&lt;p&gt;Yea &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yhuai&quot; class=&quot;user-hover&quot; rel=&quot;yhuai&quot;&gt;yhuai&lt;/a&gt; and I talked offline and thought just adding a local sort would be a better solution. It&apos;d make performance worse, but at least guarantee correctness.&lt;/p&gt;</comment>
                            <comment id="15085764" author="yhuai" created="Wed, 6 Jan 2016 16:27:04 +0000"  >&lt;p&gt;btw, with local sort operator, we can make row ordering in a partition deterministic. However, if the partition that a row belongs to is not deterministic (e.g. the DF shuffles data randomly), the returned DFs of randomSplit still have this issue. Let&apos;s also add doc to the randomSplit to let users know that random shuffle should not be used for the input DF of randomSplit.&lt;/p&gt;</comment>
                            <comment id="15086056" author="davies" created="Wed, 6 Jan 2016 18:54:03 +0000"  >&lt;p&gt;Another way to make the DataFrame deterministic is materialize it, via cache.&lt;/p&gt;</comment>
                            <comment id="15086770" author="apachespark" created="Thu, 7 Jan 2016 04:04:04 +0000"  >&lt;p&gt;User &apos;sameeragarwal&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/10626&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/10626&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 45 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2qtqv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12334009">1.6.1</customfieldvalue>
    <customfieldvalue id="12329449">2.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>