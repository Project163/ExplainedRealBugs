<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:18:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-32010] Thread leaks in pinned thread mode</title>
                <link>https://issues.apache.org/jira/browse/SPARK-32010</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-22340&quot; title=&quot;pyspark setJobGroup doesn&amp;#39;t match java threads&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-22340&quot;&gt;&lt;del&gt;SPARK-22340&lt;/del&gt;&lt;/a&gt; introduced a pin thread mode which guarantees you to sync Python thread and JVM thread.&lt;/p&gt;

&lt;p&gt;However, looks like the JVM threads are not finished even when the Python thread is finished. It can be debugged via YourKit, and run multiple jobs with multiple threads at the same time.&lt;/p&gt;

&lt;p&gt;Easiest reproducer is:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
PYSPARK_PIN_THREAD=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; ./bin/pyspark
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;gt;&amp;gt;&amp;gt; from threading &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;
&amp;gt;&amp;gt;&amp;gt; &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;(target=lambda: spark.range(1000).collect()).start()
&amp;gt;&amp;gt;&amp;gt; &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;(target=lambda: spark.range(1000).collect()).start()
&amp;gt;&amp;gt;&amp;gt; &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;(target=lambda: spark.range(1000).collect()).start()
&amp;gt;&amp;gt;&amp;gt; spark._jvm._gateway_client.deque
deque([&amp;lt;py4j.clientserver.ClientServerConnection object at 0x119f7aba8&amp;gt;, &amp;lt;py4j.clientserver.ClientServerConnection object at 0x119fc9b70&amp;gt;, &amp;lt;py4j.clientserver.ClientServerConnection object at 0x119fc9e10&amp;gt;, &amp;lt;py4j.clientserver.ClientServerConnection object at 0x11a015358&amp;gt;, &amp;lt;py4j.clientserver.ClientServerConnection object at 0x119fc00f0&amp;gt;])
&amp;gt;&amp;gt;&amp;gt; &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;(target=lambda: spark.range(1000).collect()).start()
&amp;gt;&amp;gt;&amp;gt; spark._jvm._gateway_client.deque
deque([&amp;lt;py4j.clientserver.ClientServerConnection object at 0x119f7aba8&amp;gt;, &amp;lt;py4j.clientserver.ClientServerConnection object at 0x119fc9b70&amp;gt;, &amp;lt;py4j.clientserver.ClientServerConnection object at 0x119fc9e10&amp;gt;, &amp;lt;py4j.clientserver.ClientServerConnection object at 0x11a015358&amp;gt;, &amp;lt;py4j.clientserver.ClientServerConnection object at 0x119fc08d0&amp;gt;, &amp;lt;py4j.clientserver.ClientServerConnection object at 0x119fc00f0&amp;gt;])
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The connection doesn&apos;t get closed, and it holds JVM thread running.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13311850">SPARK-32010</key>
            <summary>Thread leaks in pinned thread mode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gurwls223">Hyukjin Kwon</assignee>
                                    <reporter username="gurwls223">Hyukjin Kwon</reporter>
                        <labels>
                    </labels>
                <created>Wed, 17 Jun 2020 01:19:41 +0000</created>
                <updated>Mon, 12 Dec 2022 18:11:05 +0000</updated>
                            <resolved>Thu, 30 Jul 2020 01:15:43 +0000</resolved>
                                    <version>3.1.0</version>
                                    <fixVersion>3.1.0</fixVersion>
                                    <component>PySpark</component>
                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17138012" author="gurwls223" created="Wed, 17 Jun 2020 01:34:16 +0000"  >&lt;p&gt;I have a kind of a POC fix already. Will open a PR later.&lt;/p&gt;</comment>
                            <comment id="17141259" author="gurwls223" created="Sun, 21 Jun 2020 02:31:53 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=irashid&quot; class=&quot;user-hover&quot; rel=&quot;irashid&quot;&gt;irashid&lt;/a&gt; FYI&lt;/p&gt;</comment>
                            <comment id="17149511" author="apachespark" created="Wed, 1 Jul 2020 15:11:33 +0000"  >&lt;p&gt;User &apos;HyukjinKwon&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28968&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28968&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17149512" author="apachespark" created="Wed, 1 Jul 2020 15:12:29 +0000"  >&lt;p&gt;User &apos;HyukjinKwon&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28968&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28968&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17167584" author="gurwls223" created="Thu, 30 Jul 2020 01:15:43 +0000"  >&lt;p&gt;Issue resolved by pull request 28968&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28968&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28968&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13311851">SPARK-32011</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 15 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0fx4w:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>