<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:27:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-6743] Join with empty projection on one side produces invalid results</title>
                <link>https://issues.apache.org/jira/browse/SPARK-6743</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;val sqlContext = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SQLContext(sc)
val tab0 = sc.parallelize(Seq(
      (83,0,38),
      (26,0,79),
      (43,81,24)
    ))
    sqlContext.registerDataFrameAsTable(sqlContext.createDataFrame(tab0), &lt;span class=&quot;code-quote&quot;&gt;&quot;tab0&quot;&lt;/span&gt;)
sqlContext.cacheTable(&lt;span class=&quot;code-quote&quot;&gt;&quot;tab0&quot;&lt;/span&gt;)   
val df1 = sqlContext.sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT tab0._2, cor0._2 FROM tab0, tab0 cor0 GROUP BY tab0._2, cor0._2&quot;&lt;/span&gt;)
val result1 = df1.collect()
val df2 = sqlContext.sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT cor0._2 FROM tab0, tab0 cor0 GROUP BY cor0._2&quot;&lt;/span&gt;)
val result2 = df2.collect()
val df3 = sqlContext.sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT cor0._2 FROM tab0 cor0 GROUP BY cor0._2&quot;&lt;/span&gt;)
val result3 = df3.collect()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Given the previous code, result2 equals to Row(43), Row(83), Row(26), which is wrong. These results correspond to cor0._1, instead of cor0._2. Correct results would be Row(0), Row(81), which are ok for the third query. The first query also produces valid results, and the only difference is that the left side of the join is not empty.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12818951">SPARK-6743</key>
            <summary>Join with empty projection on one side produces invalid results</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marmbrus">Michael Armbrust</assignee>
                                    <reporter username="smolav">Santiago M. Mola</reporter>
                        <labels>
                            <label>correctness</label>
                    </labels>
                <created>Tue, 7 Apr 2015 14:49:47 +0000</created>
                <updated>Tue, 14 May 2019 06:21:35 +0000</updated>
                            <resolved>Fri, 22 May 2015 16:45:45 +0000</resolved>
                                    <version>1.3.0</version>
                                    <fixVersion>1.4.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14538737" author="smolav" created="Mon, 11 May 2015 22:07:55 +0000"  >&lt;p&gt;Any thoughts on this?&lt;/p&gt;</comment>
                            <comment id="14543435" author="smolav" created="Thu, 14 May 2015 09:39:58 +0000"  >&lt;p&gt;Sorry, my first example was not very clear. Here is a more precise one:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; val sqlc = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SQLContext(sc)

    val tab0 = sc.parallelize(Seq(
      Tuple1(&lt;span class=&quot;code-quote&quot;&gt;&quot;A1&quot;&lt;/span&gt;),
      Tuple1(&lt;span class=&quot;code-quote&quot;&gt;&quot;A2&quot;&lt;/span&gt;)
    ))
    sqlc.registerDataFrameAsTable(sqlc.createDataFrame(tab0), &lt;span class=&quot;code-quote&quot;&gt;&quot;tab0&quot;&lt;/span&gt;)
    sqlc.cacheTable(&lt;span class=&quot;code-quote&quot;&gt;&quot;tab0&quot;&lt;/span&gt;)

    val tab1 = sc.parallelize(Seq(
      Tuple1(&lt;span class=&quot;code-quote&quot;&gt;&quot;B1&quot;&lt;/span&gt;),
      Tuple1(&lt;span class=&quot;code-quote&quot;&gt;&quot;B2&quot;&lt;/span&gt;)
    ))
    sqlc.registerDataFrameAsTable(sqlc.createDataFrame(tab1), &lt;span class=&quot;code-quote&quot;&gt;&quot;tab1&quot;&lt;/span&gt;)
    sqlc.cacheTable(&lt;span class=&quot;code-quote&quot;&gt;&quot;tab1&quot;&lt;/span&gt;)

    &lt;span class=&quot;code-comment&quot;&gt;/* Succeeds */&lt;/span&gt;
    val result1 = sqlc.sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT tab0._1,tab1._1 FROM tab0, tab1 GROUP BY tab0._1,tab1._1 ORDER BY tab0._1, tab1._1&quot;&lt;/span&gt;).collect()
    assertResult(Array(Row(&lt;span class=&quot;code-quote&quot;&gt;&quot;A1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;B1&quot;&lt;/span&gt;), Row(&lt;span class=&quot;code-quote&quot;&gt;&quot;A1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;B2&quot;&lt;/span&gt;), Row(&lt;span class=&quot;code-quote&quot;&gt;&quot;A2&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;B1&quot;&lt;/span&gt;), Row(&lt;span class=&quot;code-quote&quot;&gt;&quot;A2&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;B2&quot;&lt;/span&gt;)))(result1)

    &lt;span class=&quot;code-comment&quot;&gt;/* Fails. Got: Array([A1], [A2]) */&lt;/span&gt;
    val result2 = sqlc.sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT tab1._1 FROM tab0, tab1 GROUP BY tab1._1 ORDER BY tab1._1&quot;&lt;/span&gt;).collect()
    assertResult(Array(Row(&lt;span class=&quot;code-quote&quot;&gt;&quot;B1&quot;&lt;/span&gt;), Row(&lt;span class=&quot;code-quote&quot;&gt;&quot;B2&quot;&lt;/span&gt;)))(result2)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14543466" author="smolav" created="Thu, 14 May 2015 10:26:08 +0000"  >&lt;p&gt;Note that the bug is not related to GROUP BY, that&apos;s just a quick way to produce a Project logical plan with an empty projection list from SQL. Builing upon my previous test case, here are some further instances of the bug using logical plans and DataFrames:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.sql.catalyst.dsl.plans._
    &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.sql.catalyst.dsl.expressions._
    
    val plan0 = sqlc.table(&lt;span class=&quot;code-quote&quot;&gt;&quot;tab0&quot;&lt;/span&gt;).logicalPlan.subquery(&apos;tab0)
    val plan1 = sqlc.table(&lt;span class=&quot;code-quote&quot;&gt;&quot;tab1&quot;&lt;/span&gt;).logicalPlan.subquery(&apos;tab1)
    
    &lt;span class=&quot;code-comment&quot;&gt;/* Succeeds */&lt;/span&gt;
    val planA = plan0.select(&apos;_1 as &lt;span class=&quot;code-quote&quot;&gt;&quot;c0&quot;&lt;/span&gt;)
      .join(plan1.select(&apos;_1 as &lt;span class=&quot;code-quote&quot;&gt;&quot;c1&quot;&lt;/span&gt;))
      .select(&lt;span class=&quot;code-quote&quot;&gt;&apos;c0, &apos;&lt;/span&gt;c1)
      .orderBy(&lt;span class=&quot;code-quote&quot;&gt;&apos;c0.asc, &apos;&lt;/span&gt;c1.asc)
    assertResult(Array(Row(&lt;span class=&quot;code-quote&quot;&gt;&quot;A1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;B1&quot;&lt;/span&gt;), Row(&lt;span class=&quot;code-quote&quot;&gt;&quot;A1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;B2&quot;&lt;/span&gt;), Row(&lt;span class=&quot;code-quote&quot;&gt;&quot;A2&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;B1&quot;&lt;/span&gt;), Row(&lt;span class=&quot;code-quote&quot;&gt;&quot;A2&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;B2&quot;&lt;/span&gt;)))(DataFrame(sqlc, planA).collect())

    &lt;span class=&quot;code-comment&quot;&gt;/* Fails. Got: Array([A1], [A1], [A2], [A2]) */&lt;/span&gt;
    val planB = plan0.select(&apos;_1 as &lt;span class=&quot;code-quote&quot;&gt;&quot;c0&quot;&lt;/span&gt;)
      .join(plan1.select(&apos;_1 as &lt;span class=&quot;code-quote&quot;&gt;&quot;c1&quot;&lt;/span&gt;))
      .select(&apos;c1)
      .orderBy(&apos;c1.asc)
    assertResult(Array(Row(&lt;span class=&quot;code-quote&quot;&gt;&quot;B1&quot;&lt;/span&gt;), Row(&lt;span class=&quot;code-quote&quot;&gt;&quot;B1&quot;&lt;/span&gt;), Row(&lt;span class=&quot;code-quote&quot;&gt;&quot;B2&quot;&lt;/span&gt;), Row(&lt;span class=&quot;code-quote&quot;&gt;&quot;B2&quot;&lt;/span&gt;)))(DataFrame(sqlc, planB).collect())

    &lt;span class=&quot;code-comment&quot;&gt;/* Fails. Got: Array([A1], [A1], [A2], [A2]) */&lt;/span&gt;
    val planC = plan0.select()
      .join(plan1.select(&apos;_1 as &lt;span class=&quot;code-quote&quot;&gt;&quot;c1&quot;&lt;/span&gt;))
      .select(&apos;c1)
      .orderBy(&apos;c1.asc)
    assertResult(Array(Row(&lt;span class=&quot;code-quote&quot;&gt;&quot;B1&quot;&lt;/span&gt;), Row(&lt;span class=&quot;code-quote&quot;&gt;&quot;B1&quot;&lt;/span&gt;), Row(&lt;span class=&quot;code-quote&quot;&gt;&quot;B2&quot;&lt;/span&gt;), Row(&lt;span class=&quot;code-quote&quot;&gt;&quot;B2&quot;&lt;/span&gt;)))(DataFrame(sqlc, planC).collect())
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14543602" author="smolav" created="Thu, 14 May 2015 12:31:37 +0000"  >&lt;p&gt;This problem only happens for cached relations. Here is the root of the problem:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;/* Fails. Got: Array(Row(&lt;span class=&quot;code-quote&quot;&gt;&quot;A1&quot;&lt;/span&gt;), Row(&lt;span class=&quot;code-quote&quot;&gt;&quot;A2&quot;&lt;/span&gt;) */&lt;/span&gt;
assertResult(Array(Row(), Row()))(
  InMemoryColumnarTableScan(Nil, Nil, sqlc.table(&lt;span class=&quot;code-quote&quot;&gt;&quot;tab0&quot;&lt;/span&gt;).queryExecution.sparkPlan.asInstanceOf[InMemoryColumnarTableScan].relation)
    .execute().collect()
)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;InMemoryColumnarTableScan returns the narrowest column when no attributes are requested:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &lt;span class=&quot;code-comment&quot;&gt;// Find the ordinals and data types of the requested columns.  If none are requested, use the
&lt;/span&gt; &lt;span class=&quot;code-comment&quot;&gt;// narrowest (the field with minimum &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; element size).
&lt;/span&gt;      val (requestedColumnIndices, requestedColumnDataTypes) = &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (attributes.isEmpty) {
        val (narrowestOrdinal, narrowestDataType) =
          relation.output.zipWithIndex.map { &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; (a, ordinal) =&amp;gt;
            ordinal -&amp;gt; a.dataType
          } minBy { &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; (_, dataType) =&amp;gt;
            ColumnType(dataType).defaultSize
          }
        Seq(narrowestOrdinal) -&amp;gt; Seq(narrowestDataType)
      } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
        attributes.map { a =&amp;gt;
          relation.output.indexWhere(_.exprId == a.exprId) -&amp;gt; a.dataType
        }.unzip
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It seems this is what leads to incorrect results.&lt;/p&gt;</comment>
                            <comment id="14544782" author="apachespark" created="Fri, 15 May 2015 02:08:03 +0000"  >&lt;p&gt;User &apos;marmbrus&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/6165&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/6165&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14544783" author="marmbrus" created="Fri, 15 May 2015 02:08:03 +0000"  >&lt;p&gt;Thanks for narrowing this down.  I&apos;ve opened a PR with a fix.&lt;/p&gt;</comment>
                            <comment id="14556420" author="marmbrus" created="Fri, 22 May 2015 16:45:45 +0000"  >&lt;p&gt;Issue resolved by pull request 6165&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/6165&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/6165&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 26 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cwuv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>