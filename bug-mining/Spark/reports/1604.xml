<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:25:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-3570] Shuffle write time does not include time to open shuffle files</title>
                <link>https://issues.apache.org/jira/browse/SPARK-3570</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Currently, the reported shuffle write time does not include time to open the shuffle files.  This time can be very significant when the disk is highly utilized and many shuffle files exist on the machine (I&apos;m not sure how severe this is in 1.0 onward &amp;#8211; since shuffle files are automatically deleted, this may be less of an issue because there are fewer old files sitting around).  In experiments I did, in extreme cases, adding the time to open files can increase the shuffle write time from 5ms (of a 2 second task) to 1 second.  We should fix this for better performance debugging.&lt;/p&gt;

&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shivaram&quot; class=&quot;user-hover&quot; rel=&quot;shivaram&quot;&gt;shivaram&lt;/a&gt; for helping to diagnose this problem.  cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pwendell&quot; class=&quot;user-hover&quot; rel=&quot;pwendell&quot;&gt;pwendell&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12742258">SPARK-3570</key>
            <summary>Shuffle write time does not include time to open shuffle files</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kayousterhout">Kay Ousterhout</assignee>
                                    <reporter username="kayousterhout">Kay Ousterhout</reporter>
                        <labels>
                    </labels>
                <created>Wed, 17 Sep 2014 19:57:24 +0000</created>
                <updated>Tue, 24 Mar 2015 23:29:45 +0000</updated>
                            <resolved>Tue, 24 Mar 2015 23:29:45 +0000</resolved>
                                    <version>0.9.2</version>
                    <version>1.0.2</version>
                    <version>1.1.0</version>
                                    <fixVersion>1.3.1</fixVersion>
                    <fixVersion>1.4.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14137870" author="kayousterhout" created="Wed, 17 Sep 2014 20:01:09 +0000"  >&lt;p&gt;In case anyone is extra curious about this...here are two plots of the same job, with the fixed logging (that includes file open time) in the first job.  You can see that fixing this metric can be the difference between mysterious stragglers tasks and stragglers that are clearly due to disk activity.&lt;/p&gt;</comment>
                            <comment id="14317495" author="apachespark" created="Thu, 12 Feb 2015 03:11:14 +0000"  >&lt;p&gt;User &apos;kayousterhout&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/4550&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/4550&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14318960" author="kayousterhout" created="Thu, 12 Feb 2015 20:54:17 +0000"  >&lt;p&gt;There are a bunch of times when files are opened and written to that are not currently logged, so I did some investigation of this to figure out when the time may be significant and is therefore worth logging.  I did this on a 5-machine cluster using ext3 (which exacerbates disk access issues, making it easy to see when times may be long) running query 3a of the big data benchmark (which struggles with disk access because of the many shuffle files).  Here&apos;s what I found:&lt;/p&gt;

&lt;p&gt;SortShuffleWriter.write, call to shuffleBlockManager.getDataFile: this just opens 1 file, and typically takes about 100us, so not worth adding logging&lt;/p&gt;

&lt;p&gt;SortShuffleWriter.write, call to shuffleBlockManager.getIndexFile: this writes a single index file and typically took about 0.1ms (as high as 1ms). Also doesn&apos;t seem worth logging.&lt;/p&gt;

&lt;p&gt;ExternalSorter.spillToPartitionFiles, creating the disk writers for each partition: because this creates one file for each partition, the time to create all of the files adds up: this took 75-100ms&lt;/p&gt;

&lt;p&gt;ExternalSorter.writePartitionedFile, copying the data from the partitioned files to a single file: because this reads and writes all of the shuffle data, it can be long; ~13ms on the workload I looked at.&lt;/p&gt;

&lt;p&gt;ExternalSorter.writePartitionedFile, time to call blockManager.getDiskWriter on line 748: getDiskWriter &lt;b&gt;CAN&lt;/b&gt; take a long time because of the call to file.length(), which may hit disk. However, in this case, each call takes 20us or less (and this is likely noisy &amp;#8211; getting small to measure). To totally speculate, I&apos;d guess that because this is called many times on the same file, as opposed to different files, and the file is actively being written to, the length is cached in memory by the OS.&lt;/p&gt;

&lt;p&gt;To summarize, this all leads to the intuitive conclusion that we only need to long when we&apos;re writing lots of data (e.g., when copying all of the shuffle data to a single file) or when we&apos;re opening a lot of files.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12669493" name="3a_1410854905_0_job_log_waterfall.pdf" size="134172" author="kayousterhout" created="Wed, 17 Sep 2014 20:01:09 +0000"/>
                            <attachment id="12669494" name="3a_1410957857_0_job_log_waterfall.pdf" size="138623" author="kayousterhout" created="Wed, 17 Sep 2014 20:03:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 40 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i206dr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12329486">1.3.1</customfieldvalue>
    <customfieldvalue id="12329359">1.4.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>