<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:59:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-21945] pyspark --py-files doesn&apos;t work in yarn client mode</title>
                <link>https://issues.apache.org/jira/browse/SPARK-21945</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;I tried running pyspark with --py-files pythonfiles.zip  but it doesn&apos;t properly add the zip file to the PYTHONPATH.&lt;/p&gt;

&lt;p&gt;I can work around by exporting PYTHONPATH.&lt;/p&gt;

&lt;p&gt;Looking in SparkSubmitCommandBuilder.buildPySparkShellCommand  I don&apos;t see this supported at all.   If that is the case perhaps it should be moved to improvement.&lt;/p&gt;

&lt;p&gt;Note it works via spark-submit in both client and cluster mode to run python script.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13100565">SPARK-21945</key>
            <summary>pyspark --py-files doesn&apos;t work in yarn client mode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gurwls223">Hyukjin Kwon</assignee>
                                    <reporter username="tgraves">Thomas Graves</reporter>
                        <labels>
                    </labels>
                <created>Thu, 7 Sep 2017 20:01:20 +0000</created>
                <updated>Mon, 12 Dec 2022 18:11:03 +0000</updated>
                            <resolved>Thu, 17 May 2018 04:09:23 +0000</resolved>
                                    <version>2.2.0</version>
                                    <fixVersion>2.3.1</fixVersion>
                    <fixVersion>2.4.0</fixVersion>
                                    <component>PySpark</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="16467052" author="apachespark" created="Tue, 8 May 2018 08:12:06 +0000"  >&lt;p&gt;User &apos;HyukjinKwon&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/21267&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/21267&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16478482" author="gurwls223" created="Thu, 17 May 2018 04:09:23 +0000"  >&lt;p&gt;Fixed in &lt;a href=&quot;https://github.com/apache/spark/pull/21267&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/21267&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16479574" author="dongjoon" created="Thu, 17 May 2018 19:06:59 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vanzin&quot; class=&quot;user-hover&quot; rel=&quot;vanzin&quot;&gt;vanzin&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tgraves&quot; class=&quot;user-hover&quot; rel=&quot;tgraves&quot;&gt;tgraves&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hyukjin.kwon&quot; class=&quot;user-hover&quot; rel=&quot;hyukjin.kwon&quot;&gt;hyukjin.kwon&lt;/a&gt;.&lt;br/&gt;
I&apos;m wondering if we can have this at 2.3.1 RC2, too? Or, at least, `branch-2.3` sometime?&lt;/p&gt;</comment>
                            <comment id="16479610" author="vanzin" created="Thu, 17 May 2018 19:47:47 +0000"  >&lt;p&gt;Let me run some tests and if they&apos;re ok, I&apos;ll cherry pick.&lt;/p&gt;</comment>
                            <comment id="16479765" author="vanzin" created="Thu, 17 May 2018 21:35:27 +0000"  >&lt;p&gt;This works for cluster mode and pyspark (shell), but does not for spark-submit in client mode. Still this is an improvement, so I&apos;ll cherry pick.&lt;/p&gt;

&lt;p&gt;It would be nice to open a separate bug to close the remaining gap.&lt;/p&gt;</comment>
                            <comment id="16480199" author="dongjoon" created="Fri, 18 May 2018 05:53:10 +0000"  >&lt;p&gt;Thank you for verifying and including this in 2.3.1 RC2, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vanzin&quot; class=&quot;user-hover&quot; rel=&quot;vanzin&quot;&gt;vanzin&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16486610" author="gurwls223" created="Wed, 23 May 2018 02:24:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vanzin&quot; class=&quot;user-hover&quot; rel=&quot;vanzin&quot;&gt;vanzin&lt;/a&gt;, I tried spark-submit in client mode and cluster mode with both zip and .py files and look working fine. Mind if I how you did? I tried as written in the PR description FYI.&lt;/p&gt;</comment>
                            <comment id="16487707" author="vanzin" created="Wed, 23 May 2018 17:27:01 +0000"  >&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ cat test.py 
from pyspark import SparkContext, SparkConf
import funcs

sc = SparkContext()
funcs.test()
sc.stop()

$ cat lib/funcs.py 

def test():
  print &quot;This is a test.&quot;

$ spark-submit --master yarn --py-files lib/funcs.py test.py         
SLF4J: Class path contains multiple SLF4J bindings.
SLF4J: Found binding in [jar:file:/opt/cloudera/parcels/SPARK2-2.3.0.cloudera3-1.cdh5.13.3.p0.378171/lib/spark2/jars/slf4j-log4j12-1.7.16.jar!/org/slf4j/impl/StaticLoggerBinder.class]
SLF4J: Found binding in [jar:file:/opt/cloudera/parcels/CDH-5.15.1-1.cdh5.15.1.p0.10/jars/slf4j-log4j12-1.7.5.jar!/org/slf4j/impl/StaticLoggerBinder.class]
SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.
SLF4J: Actual binding is of type [org.slf4j.impl.Log4jLoggerFactory]
Traceback (most recent call last):
  File &quot;/home/systest/test.py&quot;, line 2, in &amp;lt;module&amp;gt;
    import funcs
ImportError: No module named funcs

$ pyspark --master yarn --py-files lib/funcs.py
[blah blah blah]
Using Python version 2.7.5 (default, Sep 15 2016 22:37:39)
SparkSession available as &apos;spark&apos;.
&amp;gt;&amp;gt;&amp;gt; import funcs
&amp;gt;&amp;gt;&amp;gt; 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16488486" author="gurwls223" created="Thu, 24 May 2018 06:12:45 +0000"  >&lt;p&gt;Right. This case looks weird again. In case the given Python file is .py file (zip file seems fine), seems the python path is dynamically added after the context is got initialized.&lt;/p&gt;

&lt;p&gt;with this pyFile:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ cat /home/spark/tmp.py
def testtest():
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; 1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This works:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ cat app.py
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; pyspark
pyspark.sql.SparkSession.builder.getOrCreate()
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; tmp
print(&lt;span class=&quot;code-quote&quot;&gt;&quot;************************%s&quot;&lt;/span&gt; % tmp.testtest())

$ ./bin/spark-submit --master yarn --deploy-mode client --py-files /home/spark/tmp.py app.py
...
************************1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;but this doesn&apos;t:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ cat app.py
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; pyspark
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; tmp
pyspark.sql.SparkSession.builder.getOrCreate()
print(&lt;span class=&quot;code-quote&quot;&gt;&quot;************************%s&quot;&lt;/span&gt; % tmp.testtest())

$ ./bin/spark-submit --master yarn --deploy-mode client --py-files /home/spark/tmp.py app.py
Traceback (most recent call last):
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/spark/spark/app.py&quot;&lt;/span&gt;, line 2, in &amp;lt;module&amp;gt;
    &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; tmp
ImportError: No module named tmp
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="16488570" author="gurwls223" created="Thu, 24 May 2018 07:22:17 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryshao&quot; class=&quot;user-hover&quot; rel=&quot;jerryshao&quot;&gt;jerryshao&lt;/a&gt; FYI.&lt;/p&gt;</comment>
                            <comment id="16488686" author="gurwls223" created="Thu, 24 May 2018 09:07:21 +0000"  >&lt;p&gt;Same thing happens in standalone mode too.&lt;/p&gt;</comment>
                            <comment id="16489338" author="vanzin" created="Thu, 24 May 2018 16:37:10 +0000"  >&lt;p&gt;It happens because the import happens before the context is initialized, and your fix only copies the files during initialization of the context.&lt;/p&gt;

&lt;p&gt;To fix this case you&apos;d have to add logic to perform the copy into the launcher library, which would be kinda weird...&lt;/p&gt;</comment>
                            <comment id="16489367" author="gurwls223" created="Thu, 24 May 2018 16:47:30 +0000"  >&lt;p&gt;To be more correct, the paths are added as are given my investigation so far. It&apos;s fine for zip archive but for .py file the paths shouldn&apos;t be added as are (but its parent directory) ...&lt;br/&gt;
so for py files, yes, we should copy them too.&lt;/p&gt;

&lt;p&gt;It&apos;s weird but I think this is all because we happened to support .py file in the same option whereas PYTHONPATH doesn&apos;t expect a .py file.&lt;/p&gt;</comment>
                            <comment id="16489369" author="gurwls223" created="Thu, 24 May 2018 16:48:05 +0000"  >&lt;p&gt;Just for clarification, zip file works fine because the python paths are added as are to PythonRunner given my investigation so far.&lt;/p&gt;</comment>
                            <comment id="16489397" author="gurwls223" created="Thu, 24 May 2018 17:02:14 +0000"  >&lt;p&gt;For another clarification, the launch execution codepath is diverted for shell (and also Yarn) specifically. So, I believe the merged PR itself is a-okay.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 25 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3js4f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>