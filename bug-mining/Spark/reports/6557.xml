<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:05:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-27609] from_json expects values of options dictionary to be </title>
                <link>https://issues.apache.org/jira/browse/SPARK-27609</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;When reading a column of a DataFrame that consists of serialized JSON, one of the options for inferring the schema and then parsing the JSON is to do a two step process consisting of:&lt;br/&gt;
&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
# &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; results in a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; dataframe where the top-level keys of the JSON # are columns
df_parsed_direct&#160;= spark.read.json(df.rdd.map(lambda row: row.json_col))

# &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; does that &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; preserving the &lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt; of df
schema = df_parsed_direct.schema
df_parsed = df.withColumn(&lt;span class=&quot;code-quote&quot;&gt;&apos;parsed&apos;&lt;/span&gt;, from_json(df.json_col, schema)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;When I do this, I sometimes find myself passing in options. My understanding is, from the documentation &lt;a href=&quot;http://spark.apache.org/docs/2.1.0/api/python/pyspark.sql.html#pyspark.sql.functions.from_json&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;,&#160;that the nature of these options passed should be the same whether I do&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
spark.read.option(&lt;span class=&quot;code-quote&quot;&gt;&apos;option&apos;&lt;/span&gt;,value)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;or&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
from_json(df.json_col, schema, options={&lt;span class=&quot;code-quote&quot;&gt;&apos;option&apos;&lt;/span&gt;:value})
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&#160;&lt;br/&gt;
However, I&apos;ve found that the latter expects value to be a string representation of the value that can be decoded by JSON. So, for example options={&apos;multiLine&apos;:True} fails with&#160;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.ClassCastException: java.lang.&lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt; cannot be &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; to java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;whereas &lt;tt&gt;options={&apos;multiLine&apos;:&apos;true&apos;&lt;/tt&gt;} works just fine.&#160;&lt;/p&gt;

&lt;p&gt;Notably, providing &lt;tt&gt;spark.read.option(&apos;multiLine&apos;,True)&lt;/tt&gt; works fine!&lt;/p&gt;

&lt;p&gt;The code for reproducing this issue as well as the stacktrace from hitting it are provided in &lt;a href=&quot;https://gist.github.com/zmjjmz/0af5cf9b059b4969951e825565e266aa&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this gist&lt;/a&gt;.&#160;&lt;/p&gt;

&lt;p&gt;I also noticed that from_json doesn&apos;t complain if you give it a garbage option key &#8211; but that seems separate.&lt;/p&gt;</description>
                <environment>&lt;p&gt;I&apos;ve found this issue&#160;on an AWS Glue development endpoint which is running Spark 2.2.1 and being given jobs through a SparkMagic Python 2 kernel, running through livy and all that. I don&apos;t know how much of that is important for reproduction, and can get more details if needed.&#160;&lt;/p&gt;</environment>
        <key id="13231004">SPARK-27609</key>
            <summary>from_json expects values of options dictionary to be </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="maxgekk">Max Gekk</assignee>
                                    <reporter username="zmjjmz">Zachary Jablons</reporter>
                        <labels>
                    </labels>
                <created>Tue, 30 Apr 2019 21:42:51 +0000</created>
                <updated>Mon, 12 Dec 2022 18:11:00 +0000</updated>
                            <resolved>Thu, 18 Jul 2019 04:37:32 +0000</resolved>
                                    <version>2.2.1</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>PySpark</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16832350" author="gurwls223" created="Fri, 3 May 2019 08:37:08 +0000"  >&lt;p&gt;Okay, we can match to {read.option(...)}.&lt;/p&gt;</comment>
                            <comment id="16832352" author="gurwls223" created="Fri, 3 May 2019 08:37:26 +0000"  >&lt;p&gt;We can do from_json, from_csv too while we&apos;re here. Wanna PR for that?&lt;/p&gt;</comment>
                            <comment id="16832629" author="zmjjmz" created="Fri, 3 May 2019 16:20:01 +0000"  >&lt;p&gt;I can try, but I have exactly 0 experience developing any Spark stuff, so it&apos;ll likely take me a while.&lt;/p&gt;</comment>
                            <comment id="16832933" author="gurwls223" created="Fri, 3 May 2019 23:46:47 +0000"  >&lt;p&gt;It&apos;s fine. Take a look at&#160;&lt;a href=&quot;https://spark.apache.org/contributing.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://spark.apache.org/contributing.html&lt;/a&gt;&#160;and similar PRs in the history via Github blame, and form the PR similarily. Don&apos;t forget to add a test.&lt;/p&gt;</comment>
                            <comment id="16882885" author="maxgekk" created="Thu, 11 Jul 2019 11:48:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zmjjmz&quot; class=&quot;user-hover&quot; rel=&quot;zmjjmz&quot;&gt;zmjjmz&lt;/a&gt; Please, let us know if you are working on this. If not, I could prepare a PR.&lt;/p&gt;</comment>
                            <comment id="16883249" author="zmjjmz" created="Thu, 11 Jul 2019 18:31:07 +0000"  >&lt;p&gt;Sorry, no I haven&apos;t had the time to do this and I don&apos;t anticipate being able to anytime soon.&lt;/p&gt;</comment>
                            <comment id="16887611" author="gurwls223" created="Thu, 18 Jul 2019 04:37:32 +0000"  >&lt;p&gt;Issue resolved by pull request 25182&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/25182&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/25182&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 17 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z02aig:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>