<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:47:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-17721] Erroneous computation in multiplication of transposed SparseMatrix with SparseVector</title>
                <link>https://issues.apache.org/jira/browse/SPARK-17721</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;There is a bug in how a transposed SparseMatrix (isTransposed=true) does multiplication with a SparseVector. The bug is present (for v. &amp;gt; 2.0.0) in both org.apache.spark.mllib.linalg.BLAS (mllib) and org.apache.spark.ml.linalg.BLAS (mllib-local) in the private gemv method with signature:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;gemv(alpha: Double, A: SparseMatrix, x: SparseVector, beta: Double, y: DenseVector).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This bug can be verified by running the following snippet in a Spark shell (here using v1.6.1):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.holdenkarau.spark.testing.SharedSparkContext
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.mllib.linalg._

val A = Matrices.dense(3, 2, Array[&lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;](0, 2, 1, 1, 2, 0)).asInstanceOf[DenseMatrix].toSparse.transpose
val b = Vectors.sparse(3, Seq[(Int, &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;)]((1, 2), (2, 1))).asInstanceOf[SparseVector]

A.multiply(b)
A.multiply(b.toDense)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The first multiply with the SparseMatrix returns the incorrect result:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;org.apache.spark.mllib.linalg.DenseVector = [5.0,0.0]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;whereas the correct result is returned by the second multiply:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;org.apache.spark.mllib.linalg.DenseVector = [5.0,4.0]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Verified on OS X with Spark 1.6.1 and on Databricks running Spark 1.6.1&lt;/p&gt;</environment>
        <key id="13008479">SPARK-17721</key>
            <summary>Erroneous computation in multiplication of transposed SparseMatrix with SparseVector</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bfruergaard">Bjarne Fruergaard</assignee>
                                    <reporter username="bfruergaard">Bjarne Fruergaard</reporter>
                        <labels>
                            <label>correctness</label>
                    </labels>
                <created>Thu, 29 Sep 2016 09:22:07 +0000</created>
                <updated>Sun, 2 Oct 2016 02:30:53 +0000</updated>
                            <resolved>Sun, 2 Oct 2016 02:29:43 +0000</resolved>
                                    <version>1.4.1</version>
                    <version>1.5.2</version>
                    <version>1.6.2</version>
                    <version>2.0.0</version>
                                    <fixVersion>1.5.3</fixVersion>
                    <fixVersion>1.6.3</fixVersion>
                    <fixVersion>2.0.2</fixVersion>
                    <fixVersion>2.1.0</fixVersion>
                                    <component>ML</component>
                    <component>MLlib</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15532299" author="bfruergaard" created="Thu, 29 Sep 2016 09:34:46 +0000"  >&lt;p&gt;I already have a suggested fix in the pipeline; expect a PR soon&lt;/p&gt;</comment>
                            <comment id="15532409" author="srowen" created="Thu, 29 Sep 2016 10:26:56 +0000"  >&lt;p&gt;Am I missing something or should this result in an error? A is 3x2 and b is 3x1 and so A x b is invalid. &lt;/p&gt;</comment>
                            <comment id="15532465" author="bfruergaard" created="Thu, 29 Sep 2016 10:59:50 +0000"  >&lt;p&gt;The 3x2 matrix gets transposed, so it becomes a 2x3 matrix which is multiplied with the 3x1, so it is valid. Also note, that if I construct an equivalent SparseMatrix that is 2x3 directly (i.e., not the transpose of the 3x2 matrix), then it works. There only exists an error when the matrix I&apos;m calling multiply on is transposed.&lt;/p&gt;</comment>
                            <comment id="15532524" author="apachespark" created="Thu, 29 Sep 2016 11:27:05 +0000"  >&lt;p&gt;User &apos;bwahlgreen&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/15296&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/15296&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15532543" author="srowen" created="Thu, 29 Sep 2016 11:36:41 +0000"  >&lt;p&gt;Oh right I somehow didn&apos;t read the .transpose.&lt;/p&gt;</comment>
                            <comment id="15534041" author="josephkb" created="Thu, 29 Sep 2016 21:02:08 +0000"  >&lt;p&gt;Noting here: We should audit MLlib for uses of this multiply to see what algorithms it might have affected.  I&apos;m hoping the effects will have been minimal.&lt;/p&gt;</comment>
                            <comment id="15534375" author="josephkb" created="Thu, 29 Sep 2016 23:13:22 +0000"  >&lt;p&gt;OK I did an audit, and this will not have affected any algorithms in 2.0 or before.  But it will affect sparse logistic regression in 2.1!  Thanks for finding this bug.&lt;/p&gt;

&lt;p&gt;If users have called Matrix.multiply directly, then they could be affected.&lt;/p&gt;</comment>
                            <comment id="15535525" author="apachespark" created="Fri, 30 Sep 2016 09:26:04 +0000"  >&lt;p&gt;User &apos;bwahlgreen&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/15311&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/15311&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15539566" author="josephkb" created="Sun, 2 Oct 2016 02:29:43 +0000"  >&lt;p&gt;Issue resolved by pull request 15311&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/15311&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/15311&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 7 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i348fz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12333969">1.5.3</customfieldvalue>
    <customfieldvalue id="12336854">1.6.3</customfieldvalue>
    <customfieldvalue id="12338301">2.0.2</customfieldvalue>
    <customfieldvalue id="12335644">2.1.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>