<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:17:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-3217] Shaded Guava jar doesn&apos;t play well with Maven build when SPARK_PREPEND_CLASSES is set</title>
                <link>https://issues.apache.org/jira/browse/SPARK-3217</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;PR &lt;a href=&quot;https://github.com/apache/spark/pull/1813&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;#1813&lt;/a&gt; shaded Guava jar file and moved Guava classes to package &lt;tt&gt;org.spark-project.guava&lt;/tt&gt; when Spark is built by Maven. But if developers set the environment variable &lt;tt&gt;SPARK_PREPEND_CLASSES&lt;/tt&gt; to &lt;tt&gt;true&lt;/tt&gt;, commands like &lt;tt&gt;bin/spark-shell&lt;/tt&gt; throws &lt;tt&gt;ClassNotFoundException&lt;/tt&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;# Set the env &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;
$ export SPARK_PREPEND_CLASSES=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;

# Build Spark with Maven
$ mvn clean &lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; -Phive,hadoop-2.3 -Dhadoop.version=2.3.0 -DskipTests
...

# Then spark-shell complains
$ ./bin/spark-shell
Spark assembly has been built with Hive, including Datanucleus jars on classpath
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.NoClassDefFoundError: com/google/common/util/concurrent/ThreadFactoryBuilder
        at org.apache.spark.util.Utils$.&amp;lt;init&amp;gt;(Utils.scala:636)
        at org.apache.spark.util.Utils$.&amp;lt;clinit&amp;gt;(Utils.scala)
        at org.apache.spark.repl.SparkILoop.&amp;lt;init&amp;gt;(SparkILoop.scala:134)
        at org.apache.spark.repl.SparkILoop.&amp;lt;init&amp;gt;(SparkILoop.scala:65)
        at org.apache.spark.repl.Main$.main(Main.scala:30)
        at org.apache.spark.repl.Main.main(Main.scala)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:606)
        at org.apache.spark.deploy.SparkSubmit$.launch(SparkSubmit.scala:317)
        at org.apache.spark.deploy.SparkSubmit$.main(SparkSubmit.scala:73)
        at org.apache.spark.deploy.SparkSubmit.main(SparkSubmit.scala)
Caused by: java.lang.ClassNotFoundException: com.google.common.util.concurrent.ThreadFactoryBuilder
        at java.net.URLClassLoader$1.run(URLClassLoader.java:366)
        at java.net.URLClassLoader$1.run(URLClassLoader.java:355)
        at java.security.AccessController.doPrivileged(Native Method)
        at java.net.URLClassLoader.findClass(URLClassLoader.java:354)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:425)
        at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:308)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:358)
        ... 13 more

# Check the assembly jar file
$ jar tf assembly/target/scala-2.10/spark-assembly-1.1.0-SNAPSHOT-hadoop2.3.0.jar | grep -i ThreadFactoryBuilder
org/spark-project/guava/common/util/concurrent/ThreadFactoryBuilder$1.&lt;span class=&quot;code-keyword&quot;&gt;class
&lt;/span&gt;org/spark-project/guava/common/util/concurrent/ThreadFactoryBuilder.class
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;SBT build is fine since we don&apos;t shade Guava with SBT right now.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12736661">SPARK-3217</key>
            <summary>Shaded Guava jar doesn&apos;t play well with Maven build when SPARK_PREPEND_CLASSES is set</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vanzin">Marcelo Masiero Vanzin</assignee>
                                    <reporter username="lian cheng">Cheng Lian</reporter>
                        <labels>
                    </labels>
                <created>Mon, 25 Aug 2014 23:12:46 +0000</created>
                <updated>Sat, 1 Nov 2014 14:02:19 +0000</updated>
                            <resolved>Fri, 12 Sep 2014 21:55:24 +0000</resolved>
                                    <version>1.2.0</version>
                                    <fixVersion>1.2.0</fixVersion>
                                    <component>Build</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14110035" author="vanzin" created="Tue, 26 Aug 2014 00:14:14 +0000"  >&lt;p&gt;Just did a &quot;git clean -dfx&quot; on master and rebuilt using maven. This works fine for me.&lt;/p&gt;

&lt;p&gt;Did you by any chance do one of the following:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;forget to &quot;clean&quot; after pulling that change&lt;/li&gt;
	&lt;li&gt;mix sbt and mvn built artifacts in the same build&lt;/li&gt;
	&lt;li&gt;set SPARK_PREPEND_CLASSES&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I can see any of those causing this issue. I think only the last one is something we need to worry about; we now need to figure out a way to add the guava jar to the classpath when using that option.&lt;/p&gt;</comment>
                            <comment id="14110142" author="lian cheng" created="Tue, 26 Aug 2014 01:36:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vanzin&quot; class=&quot;user-hover&quot; rel=&quot;vanzin&quot;&gt;vanzin&lt;/a&gt; Thanks, I did set &lt;tt&gt;SPARK_PREPEND_CLASSES&lt;/tt&gt;. Will change the title and description of this issue after verifying it.&lt;/p&gt;</comment>
                            <comment id="14111130" author="apachespark" created="Tue, 26 Aug 2014 18:47:27 +0000"  >&lt;p&gt;User &apos;vanzin&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/2141&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/2141&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14111138" author="lian cheng" created="Tue, 26 Aug 2014 18:53:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vanzin&quot; class=&quot;user-hover&quot; rel=&quot;vanzin&quot;&gt;vanzin&lt;/a&gt; Verified locally, everything is OK after unsetting &lt;tt&gt;SPARK_PREPEND_CLASSES&lt;/tt&gt;, updated issue title/description and changed priority to Major. Thanks for the tips!&lt;/p&gt;</comment>
                            <comment id="14132187" author="pwendell" created="Fri, 12 Sep 2014 21:55:24 +0000"  >&lt;p&gt;Fixed by &lt;a href=&quot;https://github.com/apache/spark/pull/2141/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/2141/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14193177" author="qiaohaijun" created="Sat, 1 Nov 2014 14:02:19 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12731833">SPARK-2848</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 3 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1zbg7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12327369">1.2.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>