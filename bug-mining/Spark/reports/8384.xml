<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:29:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-37932] Analyzer can fail when join left side and right side are the same view</title>
                <link>https://issues.apache.org/jira/browse/SPARK-37932</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;See the attachment for details, including SQL and the exception information.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;sql1, there is a normal filter (LO_SUPPKEY &amp;gt; 10) in the right side subquery, Analyzer works as expected;&lt;/li&gt;
	&lt;li&gt;sql2, there is a HAVING filter(HAVING COUNT(DISTINCT LO_SUPPKEY) &amp;gt; 1) in the right side subquery, Analyzer failed with &quot;Resolved attribute(s) LO_SUPPKEY#337 missing ...&quot;.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160; &#160; &#160; From the debug info, the problem seems to be occurred after the rule DeduplicateRelations is applied.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13423013">SPARK-37932</key>
            <summary>Analyzer can fail when join left side and right side are the same view</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chen">Zhixiong Chen</assignee>
                                    <reporter username="fishcus">Feng Zhu</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 17 Jan 2022 10:49:54 +0000</created>
                <updated>Thu, 7 Mar 2024 17:46:29 +0000</updated>
                            <resolved>Tue, 1 Mar 2022 17:25:25 +0000</resolved>
                                    <version>3.2.0</version>
                                    <fixVersion>3.3.0</fixVersion>
                    <fixVersion>3.2.2</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17478542" author="fishcus" created="Wed, 19 Jan 2022 10:29:05 +0000"  >&lt;p&gt;test&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-scala&quot;&gt;
test(&lt;span class=&quot;code-quote&quot;&gt;&quot;SPARK-37932: view join view self &lt;span class=&quot;code-keyword&quot;&gt;with&lt;/span&gt; having filter&quot;&lt;/span&gt;) {
  withTable(&lt;span class=&quot;code-quote&quot;&gt;&quot;t&quot;&lt;/span&gt;) {
    withView(&lt;span class=&quot;code-quote&quot;&gt;&quot;v1&quot;&lt;/span&gt;) {
      Seq((2, &lt;span class=&quot;code-quote&quot;&gt;&quot;test2&quot;&lt;/span&gt;), (3, &lt;span class=&quot;code-quote&quot;&gt;&quot;test3&quot;&lt;/span&gt;), (1, &lt;span class=&quot;code-quote&quot;&gt;&quot;test1&quot;&lt;/span&gt;)).toDF(&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;)
        .write.format(&lt;span class=&quot;code-quote&quot;&gt;&quot;parquet&quot;&lt;/span&gt;).saveAsTable(&lt;span class=&quot;code-quote&quot;&gt;&quot;t&quot;&lt;/span&gt;)
      sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;CREATE VIEW v1 (id, name) AS SELECT id, name FROM t&quot;&lt;/span&gt;)

      sql(&quot;&quot;&quot;
        |SELECT l1.id
        | FROM v1 l1
        | INNER JOIN (
        | SELECT id
        | FROM v1
        | GROUP BY id
        | HAVING COUNT(DISTINCT name) &amp;gt; 1
        | ) l2
        | ON l1.id = l2.id
        | GROUP BY l1.name, l1.id;
        &quot;&quot;&quot;.stripMargin)

    }
  }
}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;exception&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.spark.sql.AnalysisException: Resolved attribute(s) name#25 missing from id#29,name#30 in &lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt; !Aggregate [id#29], [id#29, count(distinct name#25) AS count(distinct name#25)#31L]. Attribute(s) with the same name appear in the operation: name. Please check &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the right attribute(s) are used.;
Aggregate [name#25, id#24], [id#24]
+- Join Inner, (id#24 = id#29)
&#160; &#160;:- SubqueryAlias l1
&#160; &#160;: &#160;+- SubqueryAlias spark_catalog.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;.v1
&#160; &#160;: &#160; &#160; +- View (`&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;`.`v1`, [id#24,name#25])
&#160; &#160;: &#160; &#160; &#160; &#160;+- Project [&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(id#20 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) AS id#24, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(name#21 as string) AS name#25]
&#160; &#160;: &#160; &#160; &#160; &#160; &#160; +- Project [id#20, name#21]
&#160; &#160;: &#160; &#160; &#160; &#160; &#160; &#160; &#160;+- SubqueryAlias spark_catalog.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;.t
&#160; &#160;: &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; +- Relation &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;.t[id#20,name#21] parquet
&#160; &#160;+- SubqueryAlias l2
&#160; &#160; &#160; +- Project [id#29]
&#160; &#160; &#160; &#160; &#160;+- Filter (count(distinct name#25)#31L &amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(1 as bigint))
&#160; &#160; &#160; &#160; &#160; &#160; +- !Aggregate [id#29], [id#29, count(distinct name#25) AS count(distinct name#25)#31L]
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;+- SubqueryAlias spark_catalog.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;.v1
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; +- View (`&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;`.`v1`, [id#29,name#30])
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;+- Project [&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(id#26 as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) AS id#29, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(name#27 as string) AS name#30]
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; +- Project [id#26, name#27]
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;+- SubqueryAlias spark_catalog.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;.t
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; +- Relation &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;.t[id#26,name#27] parquet

&#160; &#160; at org.apache.spark.sql.catalyst.analysis.CheckAnalysis.failAnalysis(CheckAnalysis.scala:51)
&#160; &#160; at org.apache.spark.sql.catalyst.analysis.CheckAnalysis.failAnalysis$(CheckAnalysis.scala:50)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17478590" author="zhixiong chen" created="Wed, 19 Jan 2022 11:23:28 +0000"  >&lt;p&gt;I&apos;m working on&lt;/p&gt;</comment>
                            <comment id="17484075" author="apachespark" created="Sat, 29 Jan 2022 05:15:47 +0000"  >&lt;p&gt;User &apos;chenzhx&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/35361&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/35361&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17497324" author="apachespark" created="Thu, 24 Feb 2022 10:33:38 +0000"  >&lt;p&gt;User &apos;chenzhx&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/35649&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/35649&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17497329" author="apachespark" created="Thu, 24 Feb 2022 10:34:10 +0000"  >&lt;p&gt;User &apos;chenzhx&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/35649&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/35649&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17498016" author="apachespark" created="Fri, 25 Feb 2022 09:52:54 +0000"  >&lt;p&gt;User &apos;chenzhx&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/35660&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/35660&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17499008" author="apachespark" created="Mon, 28 Feb 2022 16:29:13 +0000"  >&lt;p&gt;User &apos;chenzhx&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/35684&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/35684&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17499009" author="apachespark" created="Mon, 28 Feb 2022 16:30:39 +0000"  >&lt;p&gt;User &apos;chenzhx&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/35684&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/35684&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17499670" author="cloud_fan" created="Tue, 1 Mar 2022 17:25:25 +0000"  >&lt;p&gt;Issue resolved by pull request 35684&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/35684&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/35684&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13038943" name="sql_and_exception" size="6037" author="fishcus" created="Mon, 17 Jan 2022 12:43:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 37 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0yn88:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>