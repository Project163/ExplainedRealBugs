<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:56:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-21762] FileFormatWriter/BasicWriteTaskStatsTracker metrics collection fails if a new file isn&apos;t yet visible</title>
                <link>https://issues.apache.org/jira/browse/SPARK-21762</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;The metrics collection of &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-20703&quot; title=&quot;Add an operator for writing data out&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-20703&quot;&gt;&lt;del&gt;SPARK-20703&lt;/del&gt;&lt;/a&gt; can trigger premature failure if the newly written object isn&apos;t actually visible yet, that is if, after &lt;tt&gt;writer.close()&lt;/tt&gt;, a &lt;tt&gt;getFileStatus(path)&lt;/tt&gt; returns a &lt;tt&gt;FileNotFoundException&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Strictly speaking, not having a file immediately visible goes against the fundamental expectations of the Hadoop FS APIs, namely full consistent data &amp;amp; medata across all operations, with immediate global visibility of all changes. However, not all object stores make that guarantee, be it only newly created data or updated blobs. And so spurious FNFEs can get raised, ones which &lt;b&gt;should&lt;/b&gt; have gone away by the time the actual task is committed. Or if they haven&apos;t, the job is in such deep trouble.&lt;/p&gt;

&lt;p&gt;What to do?&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;leave as is: fail fast &amp;amp; so catch blobstores/blobstore clients which don&apos;t behave as required. One issue here: will that trigger retries, what happens there, etc, etc.&lt;/li&gt;
	&lt;li&gt;Swallow the FNFE and hope the file is observable later.&lt;/li&gt;
	&lt;li&gt;Swallow all IOEs and hope that whatever problem the FS has is transient.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Options 2 &amp;amp; 3 aren&apos;t going to collect metrics in the event of a FNFE, or at least, not the counter of bytes written.&lt;/p&gt;</description>
                <environment>&lt;p&gt;object stores without complete creation consistency (this includes AWS S3&apos;s caching of negative GET results)&lt;/p&gt;</environment>
        <key id="13095385">SPARK-21762</key>
            <summary>FileFormatWriter/BasicWriteTaskStatsTracker metrics collection fails if a new file isn&apos;t yet visible</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stevel@apache.org">Steve Loughran</assignee>
                                    <reporter username="stevel@apache.org">Steve Loughran</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 Aug 2017 15:58:18 +0000</created>
                <updated>Sat, 14 Oct 2017 06:08:58 +0000</updated>
                            <resolved>Sat, 14 Oct 2017 06:08:58 +0000</resolved>
                                    <version>2.3.0</version>
                                    <fixVersion>2.3.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16131190" author="stevel@apache.org" created="Thu, 17 Aug 2017 19:41:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-21669&quot; title=&quot;Internal API for collecting metrics/stats during FileFormatWriter jobs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-21669&quot;&gt;&lt;del&gt;SPARK-21669&lt;/del&gt;&lt;/a&gt; simplifies this, especially testing, as it&apos;s isolated from FileFormatWriter. Same problem exists though: if you are getting any Create inconsistency, metrics probes trigger failures which may not be present by the time task commit actually takes place&lt;/p&gt;</comment>
                            <comment id="16144045" author="apachespark" created="Mon, 28 Aug 2017 16:56:54 +0000"  >&lt;p&gt;User &apos;steveloughran&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18979&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18979&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16201418" author="dongjoon" created="Thu, 12 Oct 2017 04:20:41 +0000"  >&lt;p&gt;Since this is a regression like &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-22258&quot; title=&quot;Writing empty dataset fails with ORC format&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-22258&quot;&gt;&lt;del&gt;SPARK-22258&lt;/del&gt;&lt;/a&gt;, I updated the priority.&lt;br/&gt;
FileNotFoundException occurs always on ORC file format.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="13075230">SPARK-20901</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13108778">SPARK-22258</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13071017">SPARK-20703</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13093167">SPARK-21669</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 5 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3iww7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>