<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:50:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-18853] Project (UnaryNode) is way too aggressive in estimating statistics </title>
                <link>https://issues.apache.org/jira/browse/SPARK-18853</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;We currently define statistics in UnaryNode: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  override def statistics: Statistics = {
    &lt;span class=&quot;code-comment&quot;&gt;// There should be some overhead in Row object, the size should not be zero when there is
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// no columns, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; help to prevent divide-by-zero error.
&lt;/span&gt;    val childRowSize = child.output.map(_.dataType.defaultSize).sum + 8
    val outputRowSize = output.map(_.dataType.defaultSize).sum + 8
    &lt;span class=&quot;code-comment&quot;&gt;// Assume there will be the same number of rows as child has.
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; sizeInBytes = (child.statistics.sizeInBytes * outputRowSize) / childRowSize
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (sizeInBytes == 0) {
      &lt;span class=&quot;code-comment&quot;&gt;// sizeInBytes can&apos;t be zero, or sizeInBytes of BinaryNode will also be zero
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// (product of children).
&lt;/span&gt;      sizeInBytes = 1
    }

    child.statistics.copy(sizeInBytes = sizeInBytes)
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This has a few issues:&lt;/p&gt;

&lt;p&gt;1. This can aggressively underestimate the size for Project. We assume each array/map has 100 elements, which is an overestimate. If the user projects a single field out of a deeply nested field, this would lead to huge underestimation. A safer sane default is probably 1.&lt;/p&gt;

&lt;p&gt;2. It is not a property of UnaryNode to propagate statistics this way. It should be a property of Project.&lt;/p&gt;


</description>
                <environment></environment>
        <key id="13027949">SPARK-18853</key>
            <summary>Project (UnaryNode) is way too aggressive in estimating statistics </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rxin">Reynold Xin</assignee>
                                    <reporter username="rxin">Reynold Xin</reporter>
                        <labels>
                    </labels>
                <created>Wed, 14 Dec 2016 00:27:06 +0000</created>
                <updated>Wed, 14 Dec 2016 20:33:18 +0000</updated>
                            <resolved>Wed, 14 Dec 2016 20:24:06 +0000</resolved>
                                                    <fixVersion>2.0.3</fixVersion>
                    <fixVersion>2.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15746888" author="apachespark" created="Wed, 14 Dec 2016 01:38:05 +0000"  >&lt;p&gt;User &apos;rxin&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/16274&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/16274&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15748961" author="michael" created="Wed, 14 Dec 2016 17:48:52 +0000"  >&lt;p&gt;Should we link this to &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-18676?&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-18676?&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15748962" author="michael" created="Wed, 14 Dec 2016 17:49:37 +0000"  >&lt;p&gt;I&apos;ll just add another issue with overestimating the array type is you can get into integer overflow.&lt;/p&gt;</comment>
                            <comment id="15748964" author="rxin" created="Wed, 14 Dec 2016 17:50:24 +0000"  >&lt;p&gt;Can you say more? Are you talking about deeply nested arrays?&lt;/p&gt;</comment>
                            <comment id="15748968" author="michael" created="Wed, 14 Dec 2016 17:51:45 +0000"  >&lt;p&gt;Yes, nested arrays.&lt;/p&gt;</comment>
                            <comment id="15749397" author="michael" created="Wed, 14 Dec 2016 20:30:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rxin&quot; class=&quot;user-hover&quot; rel=&quot;rxin&quot;&gt;rxin&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hvanhovell&quot; class=&quot;user-hover&quot; rel=&quot;hvanhovell&quot;&gt;hvanhovell&lt;/a&gt; Should we move the overridden &lt;tt&gt;statistics&lt;/tt&gt; method to &lt;tt&gt;Project&lt;/tt&gt; before marking this issue as resolved?&lt;/p&gt;</comment>
                            <comment id="15749405" author="rxin" created="Wed, 14 Dec 2016 20:33:18 +0000"  >&lt;p&gt;Let&apos;s do that separately (I thought about doing it but it might be better to be done together with the CBO work anyway).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13024868">SPARK-18676</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 48 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i37kf3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12338608">2.0.3</customfieldvalue>
    <customfieldvalue id="12338779">2.1.1</customfieldvalue>
    <customfieldvalue id="12338275">2.2.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>