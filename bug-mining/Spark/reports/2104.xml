<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:29:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-8501] ORC data source may give empty schema if an ORC file containing zero rows is picked for schema discovery</title>
                <link>https://issues.apache.org/jira/browse/SPARK-8501</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Not sure whether this should be considered as a bug of ORC bundled with Hive 0.13.1: for an ORC file containing zero rows, the schema written in its footer contains zero fields (e.g. &lt;tt&gt;struct&amp;lt;&amp;gt;&lt;/tt&gt;).&lt;/p&gt;

&lt;p&gt;To reproduce this issue, let&apos;s first produce an empty ORC file.  Copy data file &lt;tt&gt;sql/hive/src/test/resources/data/files/kv1.txt&lt;/tt&gt; in Spark code repo to &lt;tt&gt;/tmp/kv1.txt&lt;/tt&gt; (I just picked a random simple test data file), then run the following lines in Hive 0.13.1 CLI:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ hive
hive&amp;gt; CREATE TABLE foo(key INT, value STRING);
hive&amp;gt; LOAD DATA LOCAL INPATH &apos;/tmp/kv1.txt&apos; INTO TABLE foo;
hive&amp;gt; CREATE TABLE bar STORED AS ORC AS SELECT * FROM foo WHERE key = -1;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Now inspect the empty ORC file we just wrote:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ hive --orcfiledump /user/hive/warehouse_hive13/bar/000000_0
Structure for /user/hive/warehouse_hive13/bar/000000_0
15/06/20 00:42:54 INFO orc.ReaderImpl: Reading ORC rows from /user/hive/warehouse_hive13/bar/000000_0 with {include: null, offset: 0, length: 9223372036854775807}
Rows: 0
Compression: ZLIB
Compression size: 262144
Type: struct&amp;lt;&amp;gt;

Stripe Statistics:

File Statistics:
  Column 0: count: 0

Stripes:
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Notice the &lt;tt&gt;struct&amp;lt;&amp;gt;&lt;/tt&gt; part.&lt;/p&gt;

&lt;p&gt;This &quot;feature&quot; is OK for Hive, which has a central metastore to save table schema.  But for users who read raw data files without Hive metastore with Spark SQL 1.4.0, it causes problem because currently the ORC data source just picks a random part-file whichever comes the first for schema discovery.&lt;/p&gt;

&lt;p&gt;Expected behavior can be:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Try all files one by one until we find a part-file with non-empty schema.&lt;/li&gt;
	&lt;li&gt;Throws &lt;tt&gt;AnalysisException&lt;/tt&gt; if no such part-file can be found.&lt;/li&gt;
&lt;/ol&gt;
</description>
                <environment>&lt;p&gt;Hive 0.13.1&lt;/p&gt;</environment>
        <key id="12839314">SPARK-8501</key>
            <summary>ORC data source may give empty schema if an ORC file containing zero rows is picked for schema discovery</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lian cheng">Cheng Lian</assignee>
                                    <reporter username="lian cheng">Cheng Lian</reporter>
                        <labels>
                    </labels>
                <created>Sat, 20 Jun 2015 08:04:42 +0000</created>
                <updated>Wed, 11 Oct 2017 06:22:25 +0000</updated>
                            <resolved>Fri, 3 Jul 2015 04:33:19 +0000</resolved>
                                    <version>1.4.0</version>
                                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14612599" author="apachespark" created="Thu, 2 Jul 2015 22:01:03 +0000"  >&lt;p&gt;User &apos;liancheng&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/7199&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/7199&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14612624" author="apachespark" created="Thu, 2 Jul 2015 22:23:02 +0000"  >&lt;p&gt;User &apos;liancheng&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/7200&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/7200&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14612643" author="zzhan" created="Thu, 2 Jul 2015 22:48:22 +0000"  >&lt;p&gt;Because in spark, we will not create the orc file if the record is empty. It is only happens with the ORC file created by hive, right? &lt;/p&gt;</comment>
                            <comment id="14612646" author="lian cheng" created="Thu, 2 Jul 2015 22:50:04 +0000"  >&lt;p&gt;Exactly. Please see my PR description here &lt;a href=&quot;https://github.com/apache/spark/pull/7199&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/7199&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14612818" author="lian cheng" created="Fri, 3 Jul 2015 04:33:19 +0000"  >&lt;p&gt;Fixed by &lt;a href=&quot;https://github.com/apache/spark/pull/7199&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/7199&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Backported to 1.4.1 by &lt;a href=&quot;https://github.com/apache/spark/pull/7200&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/7200&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12971867">SPARK-15474</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 20 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2gap3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311620" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Shepherd</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>yhuai</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332153">1.4.1</customfieldvalue>
    <customfieldvalue id="12332078">1.5.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>