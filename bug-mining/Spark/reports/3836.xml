<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:46:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-16416] Logging in shutdown hook does not work properly with Log4j 2.x</title>
                <link>https://issues.apache.org/jira/browse/SPARK-16416</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Spark registers some shutdown hooks, and they log messages during shutdown:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/util/ShutdownHookManager.scala#L58&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/util/ShutdownHookManager.scala#L58&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Since the &lt;tt&gt;Logging&lt;/tt&gt; trait creates SLF4J loggers lazily:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/internal/Logging.scala#L47&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/internal/Logging.scala#L47&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;a SLF4J logger is created during the execution of the shutdown hook.&lt;/p&gt;

&lt;p&gt;This does not work when Log4j 2.x is used as SLF4J implementation:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1222&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/LOG4J2-1222&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Even though Log4j 2.6 handles this more gracefully than before, it still does emit a warning and will not be able to process the log message properly.&lt;/p&gt;

&lt;p&gt;Proposed solution: make sure to eagerly create the SLF4J logger to be used in shutdown hooks when registering the hook.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12987462">SPARK-16416</key>
            <summary>Logging in shutdown hook does not work properly with Log4j 2.x</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikaelstaldal">Mikael St&#229;ldal</assignee>
                                    <reporter username="mikaelstaldal">Mikael St&#229;ldal</reporter>
                        <labels>
                    </labels>
                <created>Thu, 7 Jul 2016 12:09:44 +0000</created>
                <updated>Tue, 26 Jul 2016 09:56:52 +0000</updated>
                            <resolved>Sun, 24 Jul 2016 10:16:38 +0000</resolved>
                                    <version>1.6.2</version>
                                    <fixVersion>2.1.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15366030" author="srowen" created="Thu, 7 Jul 2016 12:39:47 +0000"  >&lt;p&gt;Certainly not Major. Can you propose a change? I am not sure how to do this unless the loggers are always instantiated eagerly.&lt;/p&gt;</comment>
                            <comment id="15367442" author="mikaelstaldal" created="Fri, 8 Jul 2016 09:26:05 +0000"  >&lt;p&gt;Maybe just add a log statement in &lt;tt&gt;ShutdownHookManager&lt;/tt&gt; before adding any hook to force the logger to be created:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;logDebug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Adding shutdown hook&quot;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;can be added here:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/util/ShutdownHookManager.scala#L56&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/util/ShutdownHookManager.scala#L56&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15367493" author="srowen" created="Fri, 8 Jul 2016 10:17:51 +0000"  >&lt;p&gt;OK, make a pull request?&lt;/p&gt;</comment>
                            <comment id="15389800" author="apachespark" created="Fri, 22 Jul 2016 16:40:05 +0000"  >&lt;p&gt;User &apos;mikaelstaldal&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/14320&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/14320&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15389802" author="mikaelstaldal" created="Fri, 22 Jul 2016 16:40:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/spark/pull/14320&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/14320&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15391018" author="srowen" created="Sun, 24 Jul 2016 10:16:38 +0000"  >&lt;p&gt;Issue resolved by pull request 14320&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/14320&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/14320&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15391531" author="mikaelstaldal" created="Mon, 25 Jul 2016 08:27:57 +0000"  >&lt;p&gt;Latest master works fine.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12781494">SPARK-6305</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 17 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30ndb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>