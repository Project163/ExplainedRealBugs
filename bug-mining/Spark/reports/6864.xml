<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:08:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-29043] [History Server]Only one replay thread of FsHistoryProvider work because of straggler</title>
                <link>https://issues.apache.org/jira/browse/SPARK-29043</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;As shown in the attachment, we set spark.history.fs.numReplayThreads=30 for spark history server.&lt;br/&gt;
However, there is only one replay thread work because of straggler.&lt;/p&gt;

&lt;p&gt;Let&apos;s check the code.&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/blob/7f36cd2aa5e066a807d498b8c51645b136f08a75/core/src/main/scala/org/apache/spark/deploy/history/FsHistoryProvider.scala#L509-L547&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/7f36cd2aa5e066a807d498b8c51645b136f08a75/core/src/main/scala/org/apache/spark/deploy/history/FsHistoryProvider.scala#L509-L547&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;There is a synchronous operation for all replay tasks.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13256012">SPARK-29043</key>
            <summary>[History Server]Only one replay thread of FsHistoryProvider work because of straggler</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hzfeiwang">feiwang</assignee>
                                    <reporter username="hzfeiwang">feiwang</reporter>
                        <labels>
                    </labels>
                <created>Wed, 11 Sep 2019 01:56:54 +0000</created>
                <updated>Mon, 2 May 2022 05:27:01 +0000</updated>
                            <resolved>Mon, 16 Dec 2019 22:46:21 +0000</resolved>
                                    <version>2.4.4</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16927198" author="hzfeiwang" created="Wed, 11 Sep 2019 02:25:27 +0000"  >&lt;p&gt;I think it is better to replay logs asynchronously.&lt;/p&gt;</comment>
                            <comment id="16927205" author="kabhwan" created="Wed, 11 Sep 2019 02:39:58 +0000"  >&lt;p&gt;It&apos;s asynchronous for replaying logs: it&apos;s synchronous for waiting for replaying logs to be finished, but it wouldn&apos;t matter much. So you may want to post full thread dump to show what other threads are doing when one thread is running for replaying logs. If it really doesn&apos;t work concurrently, there might be some other place being locked.&lt;/p&gt;</comment>
                            <comment id="16927305" author="hzfeiwang" created="Wed, 11 Sep 2019 07:08:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kabhwan&quot; class=&quot;user-hover&quot; rel=&quot;kabhwan&quot;&gt;kabhwan&lt;/a&gt; Other replay threads are waiting for the straggler replay thread.&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12980032/12980032_image-2019-09-11-15-10-25-326.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12980033/12980033_image-2019-09-11-15-09-22-912.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;br/&gt;
I think we can set a status for replaying log into application listing, such as Processing and Completed.&lt;/p&gt;

&lt;p&gt;When we checking logs to replay, we could filter the logs which are processing to prevent been replayed repeatedly.&lt;/p&gt;</comment>
                            <comment id="16927345" author="kabhwan" created="Wed, 11 Sep 2019 07:48:43 +0000"  >&lt;p&gt;Hmm... it would be better for us if you can elaborate what you have been struggling about, as the code is intended to wait for all tasks being finished, as commented in code. So we may need to be careful on trying to change it, and may need to find alternative approach to resolve the problem you&apos;re encountering.&lt;/p&gt;

&lt;p&gt;To understand the problem:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;How long &quot;spark.history.fs.update.interval&quot; has been set?&lt;/li&gt;
	&lt;li&gt;How many applications are reloaded per each call of checkForLogs?&lt;/li&gt;
	&lt;li&gt;How big the event log for each application is?&lt;/li&gt;
	&lt;li&gt;Do you think the improvements planned for event log help?
	&lt;ul&gt;
		&lt;li&gt;&lt;a href=&quot;http://issues.apache.org/jira/browse/SPARK-28867&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/SPARK-28867&lt;/a&gt;&lt;/li&gt;
		&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-28594&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-28594&lt;/a&gt;&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16927402" author="hzfeiwang" created="Wed, 11 Sep 2019 08:41:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kabhwan&quot; class=&quot;user-hover&quot; rel=&quot;kabhwan&quot;&gt;kabhwan&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;How long &quot;spark.history.fs.update.interval&quot; has been set?    20s&lt;/li&gt;
	&lt;li&gt;How many applications are reloaded per each call of checkForLogs?   50000+&lt;/li&gt;
	&lt;li&gt;How big the event log for each application is?    there maybe many large logs.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I think &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-28594&quot; title=&quot;Allow event logs for running streaming apps to be rolled over&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-28594&quot;&gt;&lt;del&gt;SPARK-28594&lt;/del&gt;&lt;/a&gt; is more helpful for our case.&lt;/p&gt;</comment>
                            <comment id="16927533" author="kabhwan" created="Wed, 11 Sep 2019 12:45:26 +0000"  >&lt;p&gt;50000+! I&apos;m very surprised to hear that, as it means 50000+ of files are stored in same directory and being listed via SHS, and 50000+ of UI objects are loaded and rendered in SHS (one JVM).&lt;/p&gt;

&lt;p&gt;I&apos;d be appreciated if you can review design doc for &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-28594&quot; title=&quot;Allow event logs for running streaming apps to be rolled over&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-28594&quot;&gt;&lt;del&gt;SPARK-28594&lt;/del&gt;&lt;/a&gt; to see whether it helps your case, and participate code review. Thanks!&lt;/p&gt;</comment>
                            <comment id="16929939" author="hzfeiwang" created="Sun, 15 Sep 2019 08:58:56 +0000"  >&lt;p&gt;Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kabhwan&quot; class=&quot;user-hover&quot; rel=&quot;kabhwan&quot;&gt;kabhwan&lt;/a&gt;. &lt;/p&gt;</comment>
                            <comment id="16997683" author="vanzin" created="Mon, 16 Dec 2019 22:46:21 +0000"  >&lt;p&gt;Issue resolved by pull request 25797&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/25797&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/25797&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13442741">SPARK-39083</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12980033" name="image-2019-09-11-15-09-22-912.png" size="284237" author="hzfeiwang" created="Wed, 11 Sep 2019 07:09:23 +0000"/>
                            <attachment id="12980032" name="image-2019-09-11-15-10-25-326.png" size="445340" author="hzfeiwang" created="Wed, 11 Sep 2019 07:10:26 +0000"/>
                            <attachment id="12980012" name="screenshot-1.png" size="214216" author="hzfeiwang" created="Wed, 11 Sep 2019 02:01:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 48 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z06j14:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>