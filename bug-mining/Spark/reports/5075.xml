<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:54:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-21567] Dataset with Tuple of type alias throws error</title>
                <link>https://issues.apache.org/jira/browse/SPARK-21567</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;returning from a map a thing that is a tuple containg another tuple - defined as a type alias - we receive an error.&lt;/p&gt;

&lt;p&gt;minimal reproducible case:&lt;/p&gt;

&lt;p&gt;having a structure like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;object C {
  type TwoInt = (Int,Int)
  def tupleTypeAlias: TwoInt = (1,1)
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;when I do:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    Seq(1).toDS().map(_ =&amp;gt; (&quot;&quot;,C.tupleTypeAlias))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;I get exception:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;type T1 is not a &lt;span class=&quot;code-keyword&quot;&gt;class
&lt;/span&gt;scala.ScalaReflectionException: type T1 is not a class
	at scala.reflect.api.Symbols$SymbolApi$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;asClass(Symbols.scala:275)
	at scala.reflect.internal.Symbols$SymbolContextApiImpl.asClass(Symbols.scala:84)
	at org.apache.spark.sql.catalyst.ScalaReflection$.getClassFromType(ScalaReflection.scala:682)
	at org.apache.spark.sql.catalyst.ScalaReflection$.org$apache$spark$sql$catalyst$ScalaReflection$$dataTypeFor(ScalaReflection.scala:84)
	at org.apache.spark.sql.catalyst.ScalaReflection$$anonfun$10.apply(ScalaReflection.scala:614)
	at org.apache.spark.sql.catalyst.ScalaReflection$$anonfun$10.apply(ScalaReflection.scala:607)
	at scala.collection.TraversableLike$$anonfun$flatMap$1.apply(TraversableLike.scala:241)
	at scala.collection.TraversableLike$$anonfun$flatMap$1.apply(TraversableLike.scala:241)
	at scala.collection.immutable.List.foreach(List.scala:381)
	at scala.collection.TraversableLike$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;flatMap(TraversableLike.scala:241)
	at scala.collection.immutable.List.flatMap(List.scala:344)
	at org.apache.spark.sql.catalyst.ScalaReflection$.org$apache$spark$sql$catalyst$ScalaReflection$$serializerFor(ScalaReflection.scala:607)
	at org.apache.spark.sql.catalyst.ScalaReflection$$anonfun$10.apply(ScalaReflection.scala:619)
	at org.apache.spark.sql.catalyst.ScalaReflection$$anonfun$10.apply(ScalaReflection.scala:607)
	at scala.collection.TraversableLike$$anonfun$flatMap$1.apply(TraversableLike.scala:241)
	at scala.collection.TraversableLike$$anonfun$flatMap$1.apply(TraversableLike.scala:241)
	at scala.collection.immutable.List.foreach(List.scala:381)
	at scala.collection.TraversableLike$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;flatMap(TraversableLike.scala:241)
	at scala.collection.immutable.List.flatMap(List.scala:344)
	at org.apache.spark.sql.catalyst.ScalaReflection$.org$apache$spark$sql$catalyst$ScalaReflection$$serializerFor(ScalaReflection.scala:607)
	at org.apache.spark.sql.catalyst.ScalaReflection$.serializerFor(ScalaReflection.scala:438)
	at org.apache.spark.sql.catalyst.encoders.ExpressionEncoder$.apply(ExpressionEncoder.scala:71)
	at org.apache.spark.sql.Encoders$.product(Encoders.scala:275)
	at org.apache.spark.sql.LowPrioritySQLImplicits$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;newProductEncoder(SQLImplicits.scala:233)
	at org.apache.spark.sql.SQLImplicits.newProductEncoder(SQLImplicits.scala:33)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;in spark 2.1.1 the last exception was &apos;head of an empty list&apos;&lt;/p&gt;</description>
                <environment>&lt;p&gt;verified for spark 2.1.1 and 2.2.0 in sbt build&lt;/p&gt;</environment>
        <key id="13090904">SPARK-21567</key>
            <summary>Dataset with Tuple of type alias throws error</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="viirya">L. C. Hsieh</assignee>
                                    <reporter username="kretes">Tomasz Bartczak</reporter>
                        <labels>
                    </labels>
                <created>Fri, 28 Jul 2017 21:25:52 +0000</created>
                <updated>Mon, 12 Dec 2022 18:10:44 +0000</updated>
                            <resolved>Tue, 8 Aug 2017 08:33:58 +0000</resolved>
                                    <version>2.1.1</version>
                    <version>2.2.0</version>
                                    <fixVersion>2.3.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16106317" author="viirya" created="Sun, 30 Jul 2017 04:37:44 +0000"  >&lt;p&gt;I tried it. Seems Scala fails to find implicit encoder for type alias. You can manually set the encoder:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.sql.Encoder
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.sql.catalyst.encoders
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.sql.catalyst.encoders.ExpressionEncoder

val tupleTypeAliasEncoder: Encoder[TwoInt] = ExpressionEncoder[(Int, Int)]()
val encoder: Encoder[(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, TwoInt)] = ExpressionEncoder.tuple(
    encoders.encoderFor[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;],
    encoders.encoderFor(tupleTypeAliasEncoder))

Seq(1).toDS().map(_ =&amp;gt; (&quot;&quot;,C.tupleTypeAlias))(encoder).show

+-----+-----+
|value|   _2|
+-----+-----+
|     |[1,1]|
+-----+-----+

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16106781" author="viirya" created="Mon, 31 Jul 2017 03:56:11 +0000"  >&lt;p&gt;If there is no more questions about this, we can close this.&lt;/p&gt;</comment>
                            <comment id="16106920" author="kretes" created="Mon, 31 Jul 2017 07:43:49 +0000"  >&lt;p&gt;That&apos;s good there is a workaround. &lt;/p&gt;

&lt;p&gt;However as I think about that - spark implicits should get encoders right for basic data types and case classes and other primitives like tuples?&lt;/p&gt;

&lt;p&gt;I am not sure if it is a Spark bug or a Scala bug but from a user perspective - it is some kind of an unexpected behaviour.&lt;/p&gt;</comment>
                            <comment id="16110432" author="viirya" created="Wed, 2 Aug 2017 07:06:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kretes&quot; class=&quot;user-hover&quot; rel=&quot;kretes&quot;&gt;kretes&lt;/a&gt; I&apos;ve made a mistake when trying to solve this previously, so I was thinking it can&apos;t be fixed in Spark side. I think we can have a better solution now.&lt;/p&gt;

&lt;p&gt;A PR is submitted to fix this at: &lt;a href=&quot;https://github.com/apache/spark/pull/18813&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18813&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16111597" author="gurwls223" created="Wed, 2 Aug 2017 19:22:44 +0000"  >&lt;p&gt;User &apos;viirya&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18813&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18813&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 15 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3i5lr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>