<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:31:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-5754] Spark AM not launching on Windows</title>
                <link>https://issues.apache.org/jira/browse/SPARK-5754</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;I&apos;m trying to run Spark Pi on a YARN cluster running on Windows and the AM container fails to start. The problem seems to be in the generation of the YARN command which adds single quotes (&apos;) surrounding some of the java options. In particular, the part of the code that is adding those is the escapeForShell function in YarnSparkHadoopUtil. Apparently, Windows does not like the quotes for these options. Here is an example of the command that the container tries to execute:&lt;/p&gt;

&lt;p&gt;@call %JAVA_HOME%/bin/java -server -Xmx512m -Djava.io.tmpdir=%PWD%/tmp &apos;-Dspark.yarn.secondary.jars=&apos; &apos;-Dspark.app.name=org.apache.spark.examples.SparkPi&apos; &apos;-Dspark.master=yarn-cluster&apos; org.apache.spark.deploy.yarn.ApplicationMaster --class &apos;org.apache.spark.examples.SparkPi&apos; --jar  &apos;file:/D:/data/spark-1.1.1-bin-hadoop2.4/bin/../lib/spark-examples-1.1.1-hadoop2.4.0.jar&apos;  --executor-memory 1024 --executor-cores 1 --num-executors 2&lt;/p&gt;

&lt;p&gt;Once I transform it into:&lt;/p&gt;

&lt;p&gt;@call %JAVA_HOME%/bin/java -server -Xmx512m -Djava.io.tmpdir=%PWD%/tmp -Dspark.yarn.secondary.jars= -Dspark.app.name=org.apache.spark.examples.SparkPi -Dspark.master=yarn-cluster org.apache.spark.deploy.yarn.ApplicationMaster --class &apos;org.apache.spark.examples.SparkPi&apos; --jar  &apos;file:/D:/data/spark-1.1.1-bin-hadoop2.4/bin/../lib/spark-examples-1.1.1-hadoop2.4.0.jar&apos;  --executor-memory 1024 --executor-cores 1 --num-executors 2&lt;/p&gt;

&lt;p&gt;Everything seems to start.&lt;/p&gt;

&lt;p&gt;How should I deal with this? Creating a separate function like escapeForShell for Windows and call it whenever I detect this is for Windows? Or should I add some sanity check on YARN?&lt;/p&gt;

&lt;p&gt;I checked a little and there seems to be people that is able to run Spark on YARN on Windows, so it might be something else. I didn&apos;t find anything related on Jira either.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows Server 2012, Hadoop 2.4.1.&lt;/p&gt;</environment>
        <key id="12774433">SPARK-5754</key>
            <summary>Spark AM not launching on Windows</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cbvoxel">Carsten Blank</assignee>
                                    <reporter username="goiri">Inigo</reporter>
                        <labels>
                    </labels>
                <created>Thu, 12 Feb 2015 04:28:15 +0000</created>
                <updated>Thu, 20 Aug 2015 13:48:37 +0000</updated>
                            <resolved>Wed, 19 Aug 2015 17:20:47 +0000</resolved>
                                    <version>1.1.1</version>
                    <version>1.2.0</version>
                                    <fixVersion>1.6.0</fixVersion>
                                    <component>Windows</component>
                    <component>YARN</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="14317850" author="srowen" created="Thu, 12 Feb 2015 09:08:49 +0000"  >&lt;p&gt;We just resolved &lt;a href=&quot;http://issues.apache.org/jira/browse/SPARK-4267&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/SPARK-4267&lt;/a&gt; which is kind of the flip side to this problem. Now, all arguments are quoted since they may contain spaces, and spaces would break the command.&lt;/p&gt;

&lt;p&gt;Some quoting seems to be needed at some level to handle this case. I wonder why single quote is problematic in Windows? does it have to be double quote?&lt;/p&gt;

&lt;p&gt;Maybe the logic can be improved to only quote args with a space in them but that still leaves the question of how to correctly quote args with spaces in Windows.&lt;/p&gt;</comment>
                            <comment id="14318654" author="goiri" created="Thu, 12 Feb 2015 18:04:29 +0000"  >&lt;p&gt;So, I did some test of what works and what doesn&apos;t:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&apos;-Dspark.driver.port=21390&apos;: Error: Could not find or load main class &apos;-Dspark.driver.port=21390&apos;&lt;/li&gt;
	&lt;li&gt;-Dspark.driver.port=21390: OK&lt;/li&gt;
	&lt;li&gt;&quot;-Dspark.driver.port=21390&quot;: OK&lt;/li&gt;
	&lt;li&gt;-Dspark.driver.port=&apos;21390&apos;: OK&lt;/li&gt;
	&lt;li&gt;-Dspark.driver.port=&quot;21390&quot;: OK&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Another one that is problematic is:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;-XX:OnOutOfMemoryError=&apos;kill %p&apos;: Error: Could not find or load main class ...&lt;/li&gt;
	&lt;li&gt;-XX:OnOutOfMemoryError=&quot;kill %p&quot;: Java cannot parse the option&lt;/li&gt;
	&lt;li&gt;&quot;-XX:OnOutOfMemoryError=&apos;kill %p&apos;&quot;: Java cannot parse the option&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="14533315" author="stevel@apache.org" created="Thu, 7 May 2015 20:20:49 +0000"  >&lt;p&gt;I had a look at what we did for slider via our &lt;a href=&quot;https://github.com/apache/incubator-slider/blob/develop/slider-core/src/main/java/org/apache/slider/core/launch/JavaCommandLineBuilder.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;JavaCommandLineBuilder&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We just seem to be building up the full command line for %JAVA_HOME%/bin/java without needing spaces between things. (what we do have is &lt;a href=&quot;https://issues.apache.org/jira/browse/SLIDER-87&quot; title=&quot;slider can&amp;#39;t handle JVM heap args with , in them&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SLIDER-87&quot;&gt;&lt;del&gt;SLIDER-87&lt;/del&gt;&lt;/a&gt;, commas in JVM args on unix...)&lt;/p&gt;

&lt;p&gt;Hadoop on windows starts a container process in the native file &lt;tt&gt;service.c&lt;/tt&gt;, which uses the windows &lt;tt&gt;CreateProcess(&lt;/tt&gt; call, there&apos;s some coverage of its quotation logic in &lt;a href=&quot;https://msdn.microsoft.com/en-us/library/windows/desktop/ms682425%28v=vs.85%29.aspx&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;MSDN&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;one possibility here is that java home has a space in and that is causing confusion. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=goiri&quot; class=&quot;user-hover&quot; rel=&quot;goiri&quot;&gt;goiri&lt;/a&gt; -what is your JAVA_HOME value?&lt;/p&gt;</comment>
                            <comment id="14533317" author="elgoiri" created="Thu, 7 May 2015 20:23:36 +0000"  >&lt;p&gt;My JAVA_HOME is D:\data\OpenJDK7. Thanks for looking into this.&lt;/p&gt;</comment>
                            <comment id="14533318" author="elgoiri" created="Thu, 7 May 2015 20:24:29 +0000"  >&lt;p&gt;By the way, I manually tried to run those commands from cmd.exe and that&apos;s when I got:&lt;br/&gt;
&#8226;&apos;-Dspark.driver.port=21390&apos;: Error: Could not find or load main class &apos;-Dspark.driver.port=21390&apos;&lt;br/&gt;
&#8226;-Dspark.driver.port=21390: OK&lt;br/&gt;
&#8226;&quot;-Dspark.driver.port=21390&quot;: OK&lt;br/&gt;
&#8226;-Dspark.driver.port=&apos;21390&apos;: OK&lt;br/&gt;
&#8226;-Dspark.driver.port=&quot;21390&quot;: OK&lt;/p&gt;</comment>
                            <comment id="14533360" author="stevel@apache.org" created="Thu, 7 May 2015 20:52:18 +0000"  >&lt;p&gt;I think windows will need its own escaping logic -once we can work out what it is. Something like that should really go into hadoop common (with a test); then it can be ported into spark until the versions are in sync.&lt;/p&gt;</comment>
                            <comment id="14593230" author="snnn" created="Fri, 19 Jun 2015 09:01:30 +0000"  >&lt;p&gt;Still exist in spark 1.4.&lt;/p&gt;</comment>
                            <comment id="14646733" author="cbvoxel" created="Wed, 29 Jul 2015 20:43:51 +0000"  >&lt;p&gt;And in 1.5.0. Actually I have quickly hacked a couple of lines to fix this issue. However, I also suggest that a command helper should be written, such that we populate a List of CommandEntry-Objects (oho creative naming!!) that each have key, value and a keyValueSeparator. We could assemble the correct command (either as a String or a List of Strings) plattform dependent. That way we could make sure, that commands don&apos;t break the container, regardless of the plattform. &lt;/p&gt;

&lt;p&gt;One more thought regarding the above mentioned persisting problem with &lt;/p&gt;

&lt;p&gt;-XX:OnOutOfMemoryError=&apos;kill %p&apos;&lt;/p&gt;

&lt;p&gt;I have checked and it seems to come from the fact, that cmd expects a environment variable at %p. Consequently every thing breaks. One way to deal with this is using &apos;%%&apos;. Again, this kind of stuff should be in a helper class. I could contribute if that is okay. However, I never have so a bit of help would be appreciated!&lt;/p&gt;</comment>
                            <comment id="14646768" author="elgoiri" created="Wed, 29 Jul 2015 21:14:28 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cbvoxel&quot; class=&quot;user-hover&quot; rel=&quot;cbvoxel&quot;&gt;cbvoxel&lt;/a&gt;] for looking into this.&lt;br/&gt;
I can send any patches you need, just let me know what you need.&lt;/p&gt;</comment>
                            <comment id="14649068" author="apachespark" created="Fri, 31 Jul 2015 10:52:05 +0000"  >&lt;p&gt;User &apos;dharmeshkakadia&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/7829&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/7829&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14649364" author="cbvoxel" created="Fri, 31 Jul 2015 15:38:51 +0000"  >&lt;p&gt;Thanks, I will put in more time and come up with a suggestion. &lt;br/&gt;
Catch ya later&lt;/p&gt;</comment>
                            <comment id="14650444" author="cbvoxel" created="Sat, 1 Aug 2015 16:40:47 +0000"  >&lt;p&gt;Okay so I have thought about this more and kinda have a &quot;qualified&quot; opinion now.&lt;/p&gt;

&lt;p&gt;I assume that you have fixed this issue for your problem? Did you write a separate escapeForShell for Windows? &lt;/p&gt;

&lt;p&gt;I have and I would like to suggest something like that for a PR. How did you solve this?&lt;/p&gt;</comment>
                            <comment id="14650551" author="elgoiri" created="Sat, 1 Aug 2015 23:02:05 +0000"  >&lt;p&gt;I overwrote the existing escapeForShell to use single quotes instead of double and I removed the &quot;-XX:OnOutOfMemoryError=&apos;kill %p&apos;&quot; part in the command. This is just an internal solution for me but ideally this should check the OS and so on.&lt;/p&gt;</comment>
                            <comment id="14650677" author="cbvoxel" created="Sun, 2 Aug 2015 10:01:39 +0000"  >&lt;p&gt;Ah I see! Yes for a single situation such as yours, mine and the others here that need to use spark on hadoop/yarn/windows this will work. I actually did something like that too ^^ &lt;/p&gt;

&lt;p&gt;It seems however to me we should find a good solution to fix this, for good. The discussion on dharmeshkakadia PR is useful.&lt;/p&gt;</comment>
                            <comment id="14651140" author="apachespark" created="Sun, 2 Aug 2015 19:10:03 +0000"  >&lt;p&gt;User &apos;cbvoxel&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/7872&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/7872&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14662919" author="cbvoxel" created="Sat, 8 Aug 2015 12:40:15 +0000"  >&lt;p&gt;Okay, looking over the case and not making the project admin&apos;s happy with my solution (and damn rightly so!!) I revisited the problem. &lt;/p&gt;

&lt;p&gt;It occurs to me, that this is &lt;b&gt;not&lt;/b&gt; really a Windows cmd Problem. It rather seems to be a problem with the jvm in combination with cmd. My findings:&lt;/p&gt;

&lt;p&gt;Firstly,&lt;br/&gt;
-XX:OnOutOfMemoryError=&apos;kill %p&apos;&lt;br/&gt;
will never ever work on Windows cmd. So far this is a cmd-specific situation. The reason why this is an issue lies in the fact that only double quotes are respected by cmd for arguments that belong together. (See &lt;a href=&quot;http://ss64.com/nt/syntax-esc.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ss64.com/nt/syntax-esc.html&lt;/a&gt;) Everything with a space thus must be enclosed by double quotes! That was in essence dharmeshkakadia suggestion as a PR.&lt;/p&gt;

&lt;p&gt;Secondly,&lt;br/&gt;
-XX:OnOutOfMemoryError=&apos;kill %p&apos;&lt;br/&gt;
will only work if you got &apos;kill&apos; installed. As having GNU Tools a must for anyone that needs to build hadoop from scratch on Windows it will not really come up as a problem. Still, should be fixed to &lt;br/&gt;
-XX:OnOutOfMemoryError=&quot;taskkill /F /PID %p&quot;&lt;br/&gt;
see e.g. &lt;a href=&quot;https://www.java.net/node/692850&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.java.net/node/692850&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thirdly, &lt;br/&gt;
Usually cmd expects, as written earlier, that if a % is read, that a environment variable is about to be parsed. Although I wasn&apos;t able to really verify that this is a problem on the command line, it seems to be an issue in .cmd files. The correct way to avoid any hassle is using %%. In fact, please look at &lt;br/&gt;
&lt;a href=&quot;http://www.oracle.com/technetwork/java/javase/clopts-139448.html#gbmum&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.oracle.com/technetwork/java/javase/clopts-139448.html#gbmum&lt;/a&gt;&lt;br/&gt;
it is explained that %p and %%p are treated equally and that they map to the current PID. &lt;/p&gt;

&lt;p&gt;Thus, I suggest the basic escaping logic in spark to distuingish the quoting between unix (&apos;) and windows (&quot;). Furthermore, all option variables shall be written with %%, as the JVM interprets them as a single % completely platform independent. The last change suggestion should be in distuingishing which &quot;kill&quot; command to use, according to platform.&lt;/p&gt;

&lt;p&gt;I will close my PR and open a new one, once I have verified in action all that I have written here. I would be very glad about comments and experience.&lt;/p&gt;</comment>
                            <comment id="14662975" author="cbvoxel" created="Sat, 8 Aug 2015 13:16:34 +0000"  >&lt;p&gt;BTW, the reason why &lt;br/&gt;
&apos;-Dspark.driver.port=21390&apos;&lt;br/&gt;
doesn&apos;t work is a JVM issue, since it takes the enclosed information &quot;as is&quot; if single quotes are used, so it thinks this is a java class which happens to start with a &apos;-&apos;. I am not sure, if this is a Windows JVM specific situation, or if this happens in Linux just the same.&lt;/p&gt;</comment>
                            <comment id="14663194" author="apachespark" created="Sat, 8 Aug 2015 22:41:04 +0000"  >&lt;p&gt;User &apos;cbvoxel&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/8053&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/8053&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12722774">SPARK-2221</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12764366">SPARK-5033</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12830595">SPARK-7700</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12764367">SPARK-5034</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 15 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i25irj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>