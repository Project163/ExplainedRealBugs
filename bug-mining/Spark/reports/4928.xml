<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:54:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-21057] Do not use a PascalDistribution in countApprox</title>
                <link>https://issues.apache.org/jira/browse/SPARK-21057</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;I was reading the source of Spark, and found this:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/blob/v2.1.1/core/src/main/scala/org/apache/spark/partial/CountEvaluator.scala#L50-L72&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/v2.1.1/core/src/main/scala/org/apache/spark/partial/CountEvaluator.scala#L50-L72&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This is the function that estimates the probability distribution of the total count of elements in an RDD given the count of only some partitions.&lt;/p&gt;

&lt;p&gt;This function does a strange thing: when the number of elements counted so far is less than 10 000, it models the total count with a negative binomial (Pascal) law, else, it models it with a Poisson law.&lt;/p&gt;

&lt;p&gt;Modeling our number of uncounted elements with a negative binomial law is like saying that we ran over elements, counting only some, and stopping after having counted a given number of elements.&lt;br/&gt;
But this does not model what really happened.  Our counting was limited in time, not in number of counted elements, and we can&apos;t count only some of the elements in a partition.&lt;/p&gt;

&lt;p&gt;I propose to use the Poisson distribution in every case, as it can be justified under the hypothesis that the number of elements in each partition is independent and follows a Poisson law.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13078956">SPARK-21057</key>
            <summary>Do not use a PascalDistribution in countApprox</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="srowen">Sean R. Owen</assignee>
                                    <reporter username="lovasoa">Lovasoa</reporter>
                        <labels>
                    </labels>
                <created>Sun, 11 Jun 2017 16:36:29 +0000</created>
                <updated>Wed, 14 Jun 2017 08:01:49 +0000</updated>
                            <resolved>Wed, 14 Jun 2017 08:01:30 +0000</resolved>
                                    <version>2.1.1</version>
                                    <fixVersion>2.3.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16046051" author="srowen" created="Sun, 11 Jun 2017 18:36:22 +0000"  >&lt;p&gt;That&apos;s not the intended interpretation of the negative binomial. The hypothetical is that you pick elements from the total data set at random, and a fraction p of the time you &apos;succeed &apos; in picking from among the elements already counted. The rest of the time you &apos;fail&apos;. But if this goes on long enough to reach the observed count as the number of successes, then the number of failures models the size of the rest of the data.&lt;/p&gt;

&lt;p&gt;Certainly, they both have the same expected value (good). I recall this had something to do with problems for very small counts, but this doesn&apos;t appear to be a problem in this code, now. If anything the condition should be a function of r and p. I also can&apos;t go back and see a clear theoretical justification. I agree, the Poisson analysis seems fine even for small p and r.&lt;/p&gt;

&lt;p&gt;Try the change and see how it affects the tests.&lt;/p&gt;</comment>
                            <comment id="16046145" author="lovasoa" created="Sun, 11 Jun 2017 22:43:33 +0000"  >&lt;blockquote&gt;
&lt;p&gt;The hypothetical is that you pick elements from the total data set at random, and a fraction p of the time you &apos;succeed &apos; in picking from among the elements already counted.&lt;br/&gt;
The rest of the time you &apos;fail&apos;. But if this goes on long enough to reach the observed count as the number of successes, then the number of failures models the size of the rest of the data.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The thing is, if you pick elements until you&apos;ve picked all the ones that were counted, and don&apos;t want to pick the same element twice, then the probability of picking a &apos;counted&apos; element is not constant. The more you pick counted elements, the less the probability to pick a counted element next time. &lt;/p&gt;

&lt;p&gt;If you don&apos;t care about picking the same element twice, then you may well pick every time the same counted element and stop. The number of uncounted elements you picked before ending is not the total number of uncounted elements.&lt;/p&gt;

&lt;p&gt;This model doesn&apos;t model the random process we are trying to describe. The fact it has a correct expected value (and thus doesn&#8217;t give nonsensical results) doesn&apos;t mean anything. Most probability laws could be made to fit our expected value.&lt;/p&gt;

&lt;p&gt;I currently don&#8217;t have a lot of free time as I&apos;m finishing my master thesis, but I will make a pull request as soon as I find the time. Thank you for your quick answer !&lt;/p&gt;</comment>
                            <comment id="16046150" author="srowen" created="Sun, 11 Jun 2017 22:57:33 +0000"  >&lt;p&gt;I don&apos;t know if that&apos;s relevant to the analysis. Nothing is literally picking elements with or without replacement. Neither does the Poisson model literally model what&apos;s actually taking place, either. The argument isn&apos;t solely that the expect value is correct, of course. Still I don&apos;t see the reason NB was introduced here, and it looks no longer useful or even valid. I have a PR ready anyway as I needed to test it.&lt;/p&gt;</comment>
                            <comment id="16046402" author="apachespark" created="Mon, 12 Jun 2017 09:59:03 +0000"  >&lt;p&gt;User &apos;srowen&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18276&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18276&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16048826" author="srowen" created="Wed, 14 Jun 2017 08:01:30 +0000"  >&lt;p&gt;Issue resolved by pull request 18276&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18276&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18276&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 22 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3g5c7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>