<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:37:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-12026] ChiSqTest gets slower and slower over time when number of features is large</title>
                <link>https://issues.apache.org/jira/browse/SPARK-12026</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;I&apos;ve been running a ChiSqTest to pick features for feature reduction.  My understanding is that internally it creates jobs to run on batches of 1000 features at a time.&lt;/p&gt;

&lt;p&gt;I was under the impression that the features are treated as independant, but this does not appear to be the case.  When the number of features is large (160k in my case), each batch gets slower and slower.  As an example, running on 25 m3.2xlarges on Amazon EMR, it started at just over 1 minute per batch.  By the end, batches were taking over 30 minutes per batch.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12916624">SPARK-12026</key>
            <summary>ChiSqTest gets slower and slower over time when number of features is large</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yuhaoyan">yuhao yang</assignee>
                                    <reporter username="retnuH">Hunter Kelly</reporter>
                        <labels>
                            <label>mllib</label>
                            <label>stats</label>
                    </labels>
                <created>Fri, 27 Nov 2015 12:32:26 +0000</created>
                <updated>Thu, 14 Jan 2016 01:44:00 +0000</updated>
                            <resolved>Thu, 14 Jan 2016 01:44:00 +0000</resolved>
                                    <version>1.5.2</version>
                                    <fixVersion>1.6.1</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>MLlib</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15029843" author="srowen" created="Fri, 27 Nov 2015 12:47:11 +0000"  >&lt;p&gt;Can you narrow down what&apos;s slow? this isn&apos;t much to go on and doesn&apos;t rule out cluster issues. Like, what stages are taking longer? is the data size increasing? do you have a proposed PR?&lt;/p&gt;</comment>
                            <comment id="15029929" author="retnuh" created="Fri, 27 Nov 2015 14:39:57 +0000"  >&lt;p&gt;Here&apos;s the bumpf from the details button on the UI:&lt;/p&gt;

&lt;p&gt;org.apache.spark.rdd.RDD.countByValue(RDD.scala:1156)&lt;br/&gt;
org.apache.spark.mllib.stat.test.ChiSqTest$.chiSquaredFeatures(ChiSqTest.scala:117)&lt;br/&gt;
org.apache.spark.mllib.stat.Statistics$.chiSqTest(Statistics.scala:178)&lt;br/&gt;
org.apache.spark.mllib.stat.Statistics$.chiSqTest(Statistics.scala:183)&lt;br/&gt;
org.apache.spark.mllib.stat.Statistics.chiSqTest(Statistics.scala)&lt;br/&gt;
sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)&lt;br/&gt;
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
java.lang.reflect.Method.invoke(Method.java:606)&lt;br/&gt;
clojure.lang.Reflector.invokeMatchingMethod(Reflector.java:93)&lt;br/&gt;
clojure.lang.Reflector.invokeStaticMethod(Reflector.java:207)&lt;br/&gt;
bow.optimized$chi_square_exploration.doInvoke(optimized.clj:99)&lt;br/&gt;
clojure.lang.RestFn.applyTo(RestFn.java:137)&lt;br/&gt;
clojure.core$apply.invoke(core.clj:630)&lt;br/&gt;
util.cli$_main.doInvoke(cli.clj:63)&lt;br/&gt;
clojure.lang.RestFn.applyTo(RestFn.java:139)&lt;br/&gt;
util.cli.main(Unknown Source)&lt;br/&gt;
sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)&lt;br/&gt;
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;/p&gt;

&lt;p&gt;Basically it seems to run 2 stages per batch (each batch of 1000 is it&apos;s own job, I believe).  The first countByValue is the one that gets slower; a second countByValue on the same line runs in a few seconds (as opposed to minutes).&lt;/p&gt;

&lt;p&gt;I&apos;ll attach some screenshots from the SparkUI.&lt;/p&gt;</comment>
                            <comment id="15029932" author="retnuh" created="Fri, 27 Nov 2015 14:42:10 +0000"  >&lt;p&gt;As for cluster issues; I&apos;ve done this several times over the past few weeks on different data sets and it exhibits the same behaviour.  Pretty sure it&apos;s algorithmic issue; not a networking one.  The Input, ShuffleRead and ShuffleWrite times are pretty consistent across the board.&lt;/p&gt;</comment>
                            <comment id="15029942" author="retnuh" created="Fri, 27 Nov 2015 14:55:56 +0000"  >&lt;p&gt;Here&apos;s what the start of one of the jobs looks like&lt;/p&gt;</comment>
                            <comment id="15029943" author="retnuh" created="Fri, 27 Nov 2015 14:56:23 +0000"  >&lt;p&gt;Here&apos;s what the final stages of one of the jobs looks like&lt;/p&gt;</comment>
                            <comment id="15041620" author="apachespark" created="Fri, 4 Dec 2015 14:49:04 +0000"  >&lt;p&gt;User &apos;hhbyyh&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/10146&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/10146&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15097436" author="josephkb" created="Thu, 14 Jan 2016 01:44:00 +0000"  >&lt;p&gt;Issue resolved by pull request 10146&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/10146&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/10146&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12774632" name="First Stages.png" size="473238" author="retnuH" created="Fri, 27 Nov 2015 14:55:56 +0000"/>
                            <attachment id="12774633" name="Latest Stages.png" size="397031" author="retnuH" created="Fri, 27 Nov 2015 14:56:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 44 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2p0bz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12334009">1.6.1</customfieldvalue>
    <customfieldvalue id="12329449">2.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>