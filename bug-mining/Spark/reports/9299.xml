<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:35:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-45182] Ignore task completion from old stage after retrying indeterminate stages</title>
                <link>https://issues.apache.org/jira/browse/SPARK-45182</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-25342&quot; title=&quot;Support rolling back a result stage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-25342&quot;&gt;SPARK-25342&lt;/a&gt; Added a support for rolling back shuffle map stage so that all tasks of the stage can be retried when the stage output is indeterminate. This is done by clearing all map outputs at the time of stage submission. This approach workouts well except for this case:&lt;/p&gt;

&lt;p&gt;Assume both Shuffle 1 and 2 are indeterminate&lt;/p&gt;

&lt;p&gt;ShuffleMapStage1 &#8211;&lt;del&gt;&#8211;&lt;/del&gt;&amp;gt; Shuffle 1 ---&#8211;&amp;gt; ShuffleMapStage2 ----&amp;gt; Shuffle 2 ----&amp;gt; ResultStage&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;ShuffleMapStage1 is complete&lt;/li&gt;
	&lt;li&gt;A task from ShuffleMapStage2 fails with FetchFailed. Other tasks are still running&lt;/li&gt;
	&lt;li&gt;Both ShuffleMapStage1 and ShuffleMapStage2 are retried&lt;/li&gt;
	&lt;li&gt;ShuffleMapStage1 is retried and completes&lt;/li&gt;
	&lt;li&gt;ShuffleMapStage2 reattempt is scheduled for execution&lt;/li&gt;
	&lt;li&gt;Before all tasks of ShuffleMapStage2 reattempt could finish, one/more laggard tasks from the original attempt of ShuffleMapStage2 finish and ShuffleMapStage2 also gets marked as complete&lt;/li&gt;
	&lt;li&gt;Result Stage gets scheduled and finishes&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Internally within Uber, we have been using the stage rollback functionality even for deterministic stages from Spark 2.4.3 to add fault tolerance from server going down in &lt;a href=&quot;https://github.com/uber/RemoteShuffleService&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;remote shuffle service &lt;/a&gt;and have faced this scenario quite often&lt;/p&gt;

&lt;p&gt;Ideally, such laggard tasks should not be considered towards the partition completion.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13550884">SPARK-45182</key>
            <summary>Ignore task completion from old stage after retrying indeterminate stages</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mayurb31">Mayur Bhosale</assignee>
                                    <reporter username="mayurb31">Mayur Bhosale</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 15 Sep 2023 18:39:29 +0000</created>
                <updated>Tue, 26 Sep 2023 03:06:10 +0000</updated>
                            <resolved>Tue, 26 Sep 2023 03:06:10 +0000</resolved>
                                    <version>3.3.2</version>
                                    <fixVersion>3.5.1</fixVersion>
                    <fixVersion>4.0.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17768975" author="cloud_fan" created="Tue, 26 Sep 2023 03:06:10 +0000"  >&lt;p&gt;Issue resolved by pull request 42950&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/42950&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/42950&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 7 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1ke7k:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>