<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:58:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-17088] IsolatedClientLoader fails to load Hive client when sharesHadoopClasses is false</title>
                <link>https://issues.apache.org/jira/browse/SPARK-17088</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;There&apos;s a bug in a very rare code path in &lt;tt&gt;IsolatedClientLoader&lt;/tt&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;          &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; e: RuntimeException &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; e.getMessage.contains(&lt;span class=&quot;code-quote&quot;&gt;&quot;hadoop&quot;&lt;/span&gt;) =&amp;gt;
            &lt;span class=&quot;code-comment&quot;&gt;// If the error message contains hadoop, it is probably because the hadoop
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;// version cannot be resolved (e.g. it is a vendor specific version like
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;// 2.0.0-cdh4.1.1). If it is the &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt;, we will &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; just
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.hadoop:hadoop-client:2.4.0&quot;&lt;/span&gt;. &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.hadoop:hadoop-client:2.4.0&quot;&lt;/span&gt;
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;// is used just because we used to hard code it as the hadoop artifact to download.
&lt;/span&gt;            logWarning(s&lt;span class=&quot;code-quote&quot;&gt;&quot;Failed to resolve Hadoop artifacts &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the version ${hadoopVersion}. &quot;&lt;/span&gt; +
              s&lt;span class=&quot;code-quote&quot;&gt;&quot;We will change the hadoop version from ${hadoopVersion} to 2.4.0 and &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; again. &quot;&lt;/span&gt; +
              &lt;span class=&quot;code-quote&quot;&gt;&quot;Hadoop classes will not be shared between Spark and Hive metastore client. &quot;&lt;/span&gt; +
              &lt;span class=&quot;code-quote&quot;&gt;&quot;It is recommended to set jars used by Hive metastore client through &quot;&lt;/span&gt; +
              &lt;span class=&quot;code-quote&quot;&gt;&quot;spark.sql.hive.metastore.jars in the production environment.&quot;&lt;/span&gt;)
            sharesHadoopClasses = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That&apos;s the rare part. But when &lt;tt&gt;sharesHadoopClasses&lt;/tt&gt; is set to false, the instantiation of &lt;tt&gt;HiveClientImpl&lt;/tt&gt; fails:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;      classLoader
        .loadClass(classOf[HiveClientImpl].getName)
        .getConstructors.head
        .newInstance(version, sparkConf, hadoopConf, config, classLoader, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;)
        .asInstanceOf[HiveClient]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;tt&gt;hadoopConf&lt;/tt&gt; here is an instance of &lt;tt&gt;Configuration&lt;/tt&gt; loaded by the main Spark class loader, but in this case &lt;tt&gt;HiveClientImpl&lt;/tt&gt; expects an instance of &lt;tt&gt;Configuration&lt;/tt&gt; loaded by the isolated class loader (yay class loaders are fun). So you get an error like this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2016-08-10 13:51:20.742 - stderr&amp;gt; Exception in thread &quot;main&quot; java.lang.IllegalArgumentException: argument type mismatch
2016-08-10 13:51:20.743 - stderr&amp;gt; 	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
2016-08-10 13:51:20.743 - stderr&amp;gt; 	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:57)
2016-08-10 13:51:20.743 - stderr&amp;gt; 	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
2016-08-10 13:51:20.743 - stderr&amp;gt; 	at java.lang.reflect.Constructor.newInstance(Constructor.java:526)
2016-08-10 13:51:20.744 - stderr&amp;gt; 	at org.apache.spark.sql.hive.client.IsolatedClientLoader.createClient(IsolatedClientLoader.scala:264)
2016-08-10 13:51:20.744 - stderr&amp;gt; 	at org.apache.spark.sql.hive.HiveUtils$.newClientForMetadata(HiveUtils.scala:354)
2016-08-10 13:51:20.744 - stderr&amp;gt; 	at org.apache.spark.sql.hive.HiveUtils$.newClientForMetadata(HiveUtils.scala:258)
2016-08-10 13:51:20.744 - stderr&amp;gt; 	at org.apache.spark.sql.hive.HiveSharedState.metadataHive$lzycompute(HiveSharedState.scala:39)
2016-08-10 13:51:20.745 - stderr&amp;gt; 	at org.apache.spark.sql.hive.HiveSharedState.metadataHive(HiveSharedState.scala:38)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12997646">SPARK-17088</key>
            <summary>IsolatedClientLoader fails to load Hive client when sharesHadoopClasses is false</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vanzin">Marcelo Masiero Vanzin</assignee>
                                    <reporter username="vanzin">Marcelo Masiero Vanzin</reporter>
                        <labels>
                    </labels>
                <created>Tue, 16 Aug 2016 17:18:02 +0000</created>
                <updated>Sat, 22 Dec 2018 19:36:53 +0000</updated>
                            <resolved>Tue, 23 Jan 2018 20:52:00 +0000</resolved>
                                                    <fixVersion>2.4.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16314029" author="apachespark" created="Fri, 5 Jan 2018 22:33:04 +0000"  >&lt;p&gt;User &apos;vanzin&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/20169&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/20169&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16336357" author="vanzin" created="Tue, 23 Jan 2018 20:52:00 +0000"  >&lt;p&gt;Issue resolved by pull request 20169&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/20169&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/20169&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16336913" author="apachespark" created="Wed, 24 Jan 2018 05:08:03 +0000"  >&lt;p&gt;User &apos;gatorsmile&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/20377&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/20377&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 42 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i32do7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>