<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:15:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-2646] log4j initialization not quite compatible with log4j 2.x</title>
                <link>https://issues.apache.org/jira/browse/SPARK-2646</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;The logging code that handles log4j initialization leads to an stack overflow error when used with log4j 2.x, which has just been released. This occurs even a downstream project has correctly adjusted SLF4J bindings, and that is the right thing to do for log4j 2.x, since it is effectively a separate project from 1.x.&lt;/p&gt;

&lt;p&gt;Here is the relevant bit of Logging.scala:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; def initializeLogging() {
    &lt;span class=&quot;code-comment&quot;&gt;// If Log4j is being used, but is not initialized, load a &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; properties file
&lt;/span&gt;    val binder = StaticLoggerBinder.getSingleton
    val usingLog4j = binder.getLoggerFactoryClassStr.endsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;Log4jLoggerFactory&quot;&lt;/span&gt;)
    val log4jInitialized = LogManager.getRootLogger.getAllAppenders.hasMoreElements
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!log4jInitialized &amp;amp;&amp;amp; usingLog4j) {
      val defaultLogProps = &lt;span class=&quot;code-quote&quot;&gt;&quot;org/apache/spark/log4j-defaults.properties&quot;&lt;/span&gt;
      Option(Utils.getSparkClassLoader.getResource(defaultLogProps)) match {
        &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; Some(url) =&amp;gt;
          PropertyConfigurator.configure(url)
          log.info(s&lt;span class=&quot;code-quote&quot;&gt;&quot;Using Spark&apos;s &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; log4j profile: $defaultLogProps&quot;&lt;/span&gt;)
        &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; None =&amp;gt;
          &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.err.println(s&lt;span class=&quot;code-quote&quot;&gt;&quot;Spark was unable to load $defaultLogProps&quot;&lt;/span&gt;)
      }
    }
    Logging.initialized = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;

    &lt;span class=&quot;code-comment&quot;&gt;// Force a call into slf4j to initialize it. Avoids &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; happening from mutliple threads
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// and triggering &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;: http://mailman.qos.ch/pipermail/slf4j-dev/2010-April/002956.html
&lt;/span&gt;    log
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The first minor issue is that there is a call to a logger inside this method, which is initializing logging. In this situation, it ends up causing the initialization to be called recursively until the stack overflow. It would be slightly tidier to log this only after Logging.initialized = true. Or not at all. But it&apos;s not the root problem, or else, it would not work at all now. &lt;/p&gt;

&lt;p&gt;The calls to log4j classes here always reference log4j 1.2 no matter what. For example, there is not getAllAppenders in log4j 2.x. That&apos;s fine. Really, &quot;usingLog4j&quot; means &quot;using log4j 1.2&quot; and &quot;log4jInitialized&quot; means &quot;log4j 1.2 is initialized&quot;.&lt;/p&gt;

&lt;p&gt;usingLog4j should be false for log4j 2.x, because the initialization only matters for log4j 1.2. But, it&apos;s true, and that&apos;s the real issue. And log4jInitialized is always false, since calls to the log4j 1.2 API are stubs and no-ops in this setup, where the caller has swapped in log4j 2.x. Hence the loop.&lt;/p&gt;

&lt;p&gt;This is fixed, I believe, if &quot;usingLog4j&quot; can be false for log4j 2.x. The SLF4J static binding class has the same name for both versions, unfortunately, which causes the issue. However they&apos;re in different packages. For example, if the test included &quot;... and begins with org.slf4j&quot;, it should work, as the SLF4J binding for log4j 2.x is provided by log4j 2.x at the moment, and is in package org.apache.logging.slf4j.&lt;/p&gt;

&lt;p&gt;Of course, I assume that SLF4J will eventually offer its own binding. I hope to goodness they at least name the binding class differently, or else this will again not work. But then some other check can probably be made.&lt;/p&gt;

&lt;p&gt;(Credit to Agust Egilsson for finding this; at his request I&apos;m opening a JIRA for him. I&apos;ll propose a PR too.)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12729161">SPARK-2646</key>
            <summary>log4j initialization not quite compatible with log4j 2.x</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="srowen">Sean R. Owen</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Jul 2014 13:05:34 +0000</created>
                <updated>Thu, 12 Mar 2015 13:11:14 +0000</updated>
                            <resolved>Thu, 31 Jul 2014 19:27:12 +0000</resolved>
                                    <version>1.0.0</version>
                    <version>1.0.1</version>
                                    <fixVersion>1.1.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14071745" author="apachespark" created="Wed, 23 Jul 2014 14:00:44 +0000"  >&lt;p&gt;User &apos;srowen&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/1547&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/1547&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14081307" author="pwendell" created="Thu, 31 Jul 2014 19:27:12 +0000"  >&lt;p&gt;Issue resolved by pull request 1547&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/1547&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/1547&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12781494">SPARK-6305</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>407235</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 16 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1y2rz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>407251</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>