<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:57:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-23021] AnalysisBarrier should not cut off the explain output for Parsed Logical Plan</title>
                <link>https://issues.apache.org/jira/browse/SPARK-23021</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;In PR#20094 as a follow up to &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-20392&quot; title=&quot;Slow performance when calling fit on ML pipeline for dataset with many columns but few rows&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-20392&quot;&gt;&lt;del&gt;SPARK-20392&lt;/del&gt;&lt;/a&gt;, there were some fixes to the handling of &lt;tt&gt;AnalysisBarrier&lt;/tt&gt;, but there seem to be more cases that need to be fixed.&lt;/p&gt;

&lt;p&gt;One such case is that right now the Parsed Logical Plan in explain output would be cutoff by &lt;tt&gt;AnalysisBarrier&lt;/tt&gt;, e.g.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-none&quot;&gt;
scala&amp;gt; val df1 = spark.range(1).select(&apos;id as &apos;x, &apos;id + 1 as &apos;y).repartition(1).select(&apos;x === &apos;y)
df1: org.apache.spark.sql.DataFrame = [(x = y): boolean]

scala&amp;gt; df1.explain(true)
== Parsed Logical Plan ==
&apos;Project [(&apos;x = &apos;y) AS (x = y)#22]
+- AnalysisBarrier Repartition 1, true

== Analyzed Logical Plan ==
(x = y): boolean
Project [(x#16L = y#17L) AS (x = y)#22]
+- Repartition 1, true
   +- Project [id#13L AS x#16L, (id#13L + cast(1 as bigint)) AS y#17L]
      +- Range (0, 1, step=1, splits=Some(8))

== Optimized Logical Plan ==
Project [(x#16L = y#17L) AS (x = y)#22]
+- Repartition 1, true
   +- Project [id#13L AS x#16L, (id#13L + 1) AS y#17L]
      +- Range (0, 1, step=1, splits=Some(8))

== Physical Plan ==
*Project [(x#16L = y#17L) AS (x = y)#22]
+- Exchange RoundRobinPartitioning(1)
   +- *Project [id#13L AS x#16L, (id#13L + 1) AS y#17L]
      +- *Range (0, 1, step=1, splits=8)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13129724">SPARK-23021</key>
            <summary>AnalysisBarrier should not cut off the explain output for Parsed Logical Plan</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="maropu">Takeshi Yamamuro</assignee>
                                    <reporter username="rednaxelafx">Kris Mok</reporter>
                        <labels>
                    </labels>
                <created>Wed, 10 Jan 2018 01:24:28 +0000</created>
                <updated>Sun, 14 Jan 2018 14:34:01 +0000</updated>
                            <resolved>Sun, 14 Jan 2018 14:33:42 +0000</resolved>
                                    <version>2.3.0</version>
                                    <fixVersion>2.3.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16323599" author="maropu" created="Fri, 12 Jan 2018 06:02:17 +0000"  >&lt;p&gt;hi, kris, you&apos;re working on it?&lt;br/&gt;
I think we just forget to override innerChildren in AnalysisBarrier.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

&amp;gt;&amp;gt; Before
scala&amp;gt; Seq((1, 1)).toDF(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;).groupBy(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;).count().sample(0.1).explain(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
== Parsed Logical Plan ==
Sample 0.0, 0.1, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, -7661439431999668039
+- AnalysisBarrier Aggregate [a#5], [a#5, count(1) AS count#14L]

&amp;gt;&amp;gt; After
scala&amp;gt; Seq((1, 1)).toDF(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;).groupBy(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;).count().sample(0.1).explain(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
== Parsed Logical Plan ==
Sample 0.0, 0.1, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, -5086223488015741426
+- AnalysisBarrier
      +- Aggregate [a#5], [a#5, count(1) AS count#14L]
         +- Project [_1#2 AS a#5, _2#3 AS b#6]
            +- LocalRelation [_1#2, _2#3]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16323612" author="rednaxelafx" created="Fri, 12 Jan 2018 06:29:38 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maropu&quot; class=&quot;user-hover&quot; rel=&quot;maropu&quot;&gt;maropu&lt;/a&gt;-san,&lt;/p&gt;

&lt;p&gt;Thanks for looking at it! No, I only noticed this behavior while working on something else. I wasn&apos;t planning on working on this ticket, unless no one takes it and I get too curious &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Would you like to submit that patch as a PR?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Kris&lt;/p&gt;</comment>
                            <comment id="16323623" author="maropu" created="Fri, 12 Jan 2018 06:37:56 +0000"  >&lt;p&gt;yea, sure, I have bandwidth to do &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;)&lt;br/&gt;
Is the fix above is correct? cc: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smilegator&quot; class=&quot;user-hover&quot; rel=&quot;smilegator&quot;&gt;smilegator&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=viirya&quot; class=&quot;user-hover&quot; rel=&quot;viirya&quot;&gt;viirya&lt;/a&gt;&lt;br/&gt;
Or, we need to totally cut off AnalysisBarrier in explain results?&lt;/p&gt;</comment>
                            <comment id="16323672" author="rednaxelafx" created="Fri, 12 Jan 2018 07:58:21 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maropu&quot; class=&quot;user-hover&quot; rel=&quot;maropu&quot;&gt;maropu&lt;/a&gt;-san,&lt;/p&gt;

&lt;p&gt;Thanks! I&apos;m not familiar with this part of the code, but IIUC there&apos;s two points to this:&lt;br/&gt;
1. The explain output shouldn&apos;t be changed because of the newly added &lt;tt&gt;AnalysisBarrier&lt;/tt&gt;. The current behavior (with the cutoff) should be considered a regression, although it&apos;s not a major behavioral one.&lt;br/&gt;
2. The reason why &lt;tt&gt;AnalysisBarrier&lt;/tt&gt; didn&apos;t override &lt;tt&gt;innerChildren&lt;/tt&gt; was by design: it wanted to cut off the recursion to help avoid stack overflows when the analyzer needs to walk the plan tree.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cloud_fan&quot; class=&quot;user-hover&quot; rel=&quot;cloud_fan&quot;&gt;cloud_fan&lt;/a&gt; may have recently fixed a similar issue where the &quot;analyzed logical plan&quot; was cut off by &lt;tt&gt;AnalysisBarrier&lt;/tt&gt; in the same way. Is that the case, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cloud_fan&quot; class=&quot;user-hover&quot; rel=&quot;cloud_fan&quot;&gt;cloud_fan&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="16323813" author="cloud_fan" created="Fri, 12 Jan 2018 10:40:55 +0000"  >&lt;p&gt;`AnalysisBarrier` didn&apos;t override `children` by design. I think `innerChildren` is fine, as it&apos;s for explain/UI only.&lt;/p&gt;</comment>
                            <comment id="16323822" author="maropu" created="Fri, 12 Jan 2018 10:50:13 +0000"  >&lt;p&gt;ok, I&apos;ll make a pr that way&lt;/p&gt;</comment>
                            <comment id="16323910" author="viirya" created="Fri, 12 Jan 2018 12:58:04 +0000"  >&lt;p&gt;To override &lt;tt&gt;innerChildren&lt;/tt&gt; sounds good to me. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maropu&quot; class=&quot;user-hover&quot; rel=&quot;maropu&quot;&gt;maropu&lt;/a&gt; Please ping me if you submit the PR. Thanks.&lt;/p&gt;</comment>
                            <comment id="16324034" author="apachespark" created="Fri, 12 Jan 2018 14:37:08 +0000"  >&lt;p&gt;User &apos;maropu&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/20247&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/20247&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16324318" author="rednaxelafx" created="Fri, 12 Jan 2018 18:08:42 +0000"  >&lt;p&gt;Thank you very much for explaining the differences between &lt;tt&gt;children&lt;/tt&gt; and &lt;tt&gt;innerChildren&lt;/tt&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=viirya&quot; class=&quot;user-hover&quot; rel=&quot;viirya&quot;&gt;viirya&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cloud_fan&quot; class=&quot;user-hover&quot; rel=&quot;cloud_fan&quot;&gt;cloud_fan&lt;/a&gt;! TIL &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 44 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3opvj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12339551">2.3.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>