<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:49:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-18614] Incorrect predicate pushdown from ExistenceJoin</title>
                <link>https://issues.apache.org/jira/browse/SPARK-18614</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;This is a follow-up work from &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-18597&quot; title=&quot;Do not push down filters for LEFT ANTI JOIN&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-18597&quot;&gt;&lt;del&gt;SPARK-18597&lt;/del&gt;&lt;/a&gt; to close a potential incorrect rewrite in &lt;tt&gt;PushPredicateThroughJoin&lt;/tt&gt; rule of the Optimizer phase.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13023865">SPARK-18614</key>
            <summary>Incorrect predicate pushdown from ExistenceJoin</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nsyca">Nattavut Sutyanyong</assignee>
                                    <reporter username="nsyca">Nattavut Sutyanyong</reporter>
                        <labels>
                    </labels>
                <created>Mon, 28 Nov 2016 21:19:30 +0000</created>
                <updated>Tue, 29 Nov 2016 23:28:46 +0000</updated>
                            <resolved>Tue, 29 Nov 2016 23:28:46 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15703185" author="nsyca" created="Mon, 28 Nov 2016 21:28:27 +0000"  >&lt;p&gt;&lt;tt&gt;ExistenceJoin&lt;/tt&gt; should be treated the same as &lt;tt&gt;LeftOuter&lt;/tt&gt; and &lt;tt&gt;LeftAnti&lt;/tt&gt;, not &lt;tt&gt;InnerLike&lt;/tt&gt; and &lt;tt&gt;LeftSemi&lt;/tt&gt;. This is not currently exposed because the rewrite of &lt;tt&gt;[NOT] EXISTS OR ...&lt;/tt&gt; to &lt;tt&gt;ExistenceJoin&lt;/tt&gt; happens in rule &lt;tt&gt;RewritePredicateSubquery&lt;/tt&gt;, which is in a separate rule set and placed after the rule &lt;tt&gt;PushPredicateThroughJoin&lt;/tt&gt;. During the transformation in the rule &lt;tt&gt;PushPredicateThroughJoin&lt;/tt&gt;, an ExistenceJoin never exists.&lt;/p&gt;

&lt;p&gt;The semantics of &lt;tt&gt;ExistenceJoin&lt;/tt&gt; says we need to preserve all the rows from the left table through the join operation as if it is a regular &lt;tt&gt;LeftOuter&lt;/tt&gt; join. The &lt;tt&gt;ExistenceJoin&lt;/tt&gt; augments the &lt;tt&gt;LeftOuter&lt;/tt&gt; operation with a new column called &lt;tt&gt;exists&lt;/tt&gt;, set to true when the join condition in the ON clause is true and false otherwise. The filter of any rows will happen in the &lt;tt&gt;Filter&lt;/tt&gt; operation above the &lt;tt&gt;ExistenceJoin&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Example:&lt;/p&gt;

&lt;p&gt;A(c1, c2): { (1, 1), (1, 2) }&lt;br/&gt;
// B can be any value as it is irrelevant in this example&lt;br/&gt;
B(c1): { (NULL) }&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;A&lt;/span&gt;.*
&lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt;   &lt;span class=&quot;code-keyword&quot;&gt;A&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;where&lt;/span&gt;  &lt;span class=&quot;code-keyword&quot;&gt;exists&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;select&lt;/span&gt; 1 &lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; B &lt;span class=&quot;code-keyword&quot;&gt;where&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;A&lt;/span&gt;.c1 = &lt;span class=&quot;code-keyword&quot;&gt;A&lt;/span&gt;.c2)
       &lt;span class=&quot;code-keyword&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;A&lt;/span&gt;.c2=2
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In this example, the correct result is all the rows from A. If the pattern &lt;tt&gt;ExistenceJoin&lt;/tt&gt; at line 935 in &lt;tt&gt;Optimizer.scala&lt;/tt&gt; added by the work in &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-18597&quot; title=&quot;Do not push down filters for LEFT ANTI JOIN&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-18597&quot;&gt;&lt;del&gt;SPARK-18597&lt;/del&gt;&lt;/a&gt; is indeed active, the code will push down the predicate A.c1 = A.c2 to be a &lt;tt&gt;Filter&lt;/tt&gt; on relation A, which will filter the row (1,2) from A.&lt;/p&gt;</comment>
                            <comment id="15703190" author="smilegator" created="Mon, 28 Nov 2016 21:31:35 +0000"  >&lt;p&gt;Since it does not affect the correctness of the query results, I remove the label `correctness`&lt;/p&gt;</comment>
                            <comment id="15703240" author="apachespark" created="Mon, 28 Nov 2016 21:48:04 +0000"  >&lt;p&gt;User &apos;nsyca&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/16044&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/16044&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13023579">SPARK-18597</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 51 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i36v7r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311620" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Shepherd</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>hvanhovell</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>