<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:57:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-22393] spark-shell can&apos;t find imported types in class constructors, extends clause</title>
                <link>https://issues.apache.org/jira/browse/SPARK-22393</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ spark-shell
&#8230;
scala&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.Partition
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.Partition

scala&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;P(p: Partition)
&amp;lt;console&amp;gt;:11: error: not found: type Partition
       &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;P(p: Partition)
                  ^

scala&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;P(val index: Int) &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Partition
&amp;lt;console&amp;gt;:11: error: not found: type Partition
       &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;P(val index: Int) &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Partition
                                       ^
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Any class that I &lt;tt&gt;import&lt;/tt&gt; gives &quot;not found: type ___&quot; when used as a parameter to a class, or in an extends clause; this applies to classes I import from JARs I provide via &lt;tt&gt;--jars&lt;/tt&gt; as well as core Spark classes as above.&lt;/p&gt;

&lt;p&gt;This worked in 1.6.3 but has been broken since 2.0.0.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13112883">SPARK-22393</key>
            <summary>spark-shell can&apos;t find imported types in class constructors, extends clause</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mpetruska">Mark Petruska</assignee>
                                    <reporter username="rdub">Ryan Williams</reporter>
                        <labels>
                    </labels>
                <created>Sun, 29 Oct 2017 14:42:04 +0000</created>
                <updated>Tue, 3 Apr 2018 05:33:55 +0000</updated>
                            <resolved>Fri, 1 Dec 2017 11:14:26 +0000</resolved>
                                    <version>2.0.2</version>
                    <version>2.1.2</version>
                    <version>2.2.0</version>
                                    <fixVersion>2.3.0</fixVersion>
                                    <component>Spark Shell</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="16224040" author="srowen" created="Sun, 29 Oct 2017 15:29:05 +0000"  >&lt;p&gt;That&apos;s a weird one. &lt;tt&gt;class P(p: org.apache.spark.Partition)&lt;/tt&gt; works fine as does {{ &lt;/p&gt;
{import org.apache.spark.Partition; class P(p: Partition)}
&lt;p&gt; }}. I think this is some subtlety of how the scala shell interpreter works.&lt;/p&gt;</comment>
                            <comment id="16224158" author="rdub" created="Sun, 29 Oct 2017 19:46:08 +0000"  >&lt;p&gt;Everything works fine in a Scala shell (&lt;tt&gt;scala -cp $SPARK_HOME/jars/spark-core_2.11-2.2.0.jar&lt;/tt&gt;) and via &lt;tt&gt;sbt console&lt;/tt&gt; in a project that depends on Spark, so the problem seems specific to &lt;tt&gt;spark-shell&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="16224194" author="srowen" created="Sun, 29 Oct 2017 20:34:25 +0000"  >&lt;p&gt;I&apos;m guessing it&apos;s something to do with how it overrides the shell initialization or classloader. It could be worth trying the 2.12 build and shell as the shell integration is a little less hacky. But really no idea off the top of my head.&lt;/p&gt;</comment>
                            <comment id="16258441" author="mpetruska" created="Sun, 19 Nov 2017 10:58:06 +0000"  >&lt;p&gt;Tested with spark-shell build 2.11:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.Partition
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Code &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Result &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;P(p: Partition) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt; not found: type Partition &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;P(x: Int) &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Partition &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt; not found: type Partition &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; p: Partition = _ &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;   &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; OK &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; def a(p: Partition): Int = 0 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; OK &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; def a(): Partition = p &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; OK &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
object P {
  &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;P(p: Partition)
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; OK &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
:paste
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.Partition
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;P(p: Partition)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; OK &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
type Partition = org.apache.spark.Partition
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;P(p: Partition)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; OK &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;p&gt;To start spark shell and the underlying scala repl with &lt;em&gt;trace&lt;/em&gt;, &lt;em&gt;info&lt;/em&gt; and &lt;em&gt;debug&lt;/em&gt; settings:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$JAVA_HOME/bin/java -cp $SPARK_HOME/conf/:$SPARK_HOME/assembly/target/scala-2.11/jars/* -Dscala.usejavacp=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dscala.repl.trace=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dscala.repl.info=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dscala.repl.debug=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dscala.repl.prompt=&lt;span class=&quot;code-quote&quot;&gt;&quot;spark&amp;gt;&amp;gt;&amp;gt;  &quot;&lt;/span&gt; -Xmx1g org.apache.spark.deploy.SparkSubmit --&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.spark.repl.Main --name &lt;span class=&quot;code-quote&quot;&gt;&quot;Spark shell&quot;&lt;/span&gt; spark-shell
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16258468" author="mpetruska" created="Sun, 19 Nov 2017 12:28:06 +0000"  >&lt;p&gt;With the 2.12 build:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.Partition
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Code &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Result &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;P(p: Partition) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; OK &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;P(val index: Int) &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Partition &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; OK &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; p: Partition = _ &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;   &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; OK &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; def a(p: Partition): Int = 0 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; OK &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; def a(): Partition = p &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; OK &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
object P {
  &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;P(p: Partition)
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; OK &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
:paste
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.Partition
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;P(p: Partition)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; OK &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
type Partition = org.apache.spark.Partition
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;P(p: Partition)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt; OK &lt;/font&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;p&gt;To start spark shell 2.12 and the underlying scala repl with &lt;em&gt;trace&lt;/em&gt;, &lt;em&gt;info&lt;/em&gt; and &lt;em&gt;debug&lt;/em&gt; settings:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$JAVA_HOME/bin/java -cp $SPARK_HOME/conf/:$SPARK_HOME/assembly/target/scala-2.11/jars/* -Dscala.usejavacp=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dscala.repl.trace=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dscala.repl.info=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dscala.repl.debug=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dscala.repl.prompt=&lt;span class=&quot;code-quote&quot;&gt;&quot;spark&amp;gt;&amp;gt;&amp;gt;  &quot;&lt;/span&gt; -Xmx1g org.apache.spark.deploy.SparkSubmit --&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.spark.repl.Main --name &lt;span class=&quot;code-quote&quot;&gt;&quot;Spark shell&quot;&lt;/span&gt; spark-shell
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16258469" author="mpetruska" created="Sun, 19 Nov 2017 12:35:30 +0000"  >&lt;p&gt;The difference between scala repls 2.11 and 2.12 is seen with &lt;em&gt;trace&lt;/em&gt; options enabled.&lt;br/&gt;
2.12:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
...
parse(&quot;

sealed class $read &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; _root_.java.io.Serializable { 
  ;

sealed class $iw &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; _root_.java.io.Serializable { 
&lt;span class=&quot;code-comment&quot;&gt;// $line14.$read.INSTANCE definedNames List(), curImps Set()
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.Partition
sealed class $iw &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; _root_.java.io.Serializable { 

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;P(p: Partition)


}
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Whereas in 2.11, scala repl does not insert `import org.apache.spark.Partition`, but only for `ClassDef`s. The underlying reason is unknown, will need more investigation.&lt;/p&gt;

&lt;p&gt;Until then the workaround `type Partition = org.apache.spark.Partition` seems feasible.&lt;/p&gt;</comment>
                            <comment id="16258476" author="mpetruska" created="Sun, 19 Nov 2017 12:54:05 +0000"  >&lt;p&gt;Trace of the 2.11 version:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
...
parse(&quot;

class $read &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Serializable { 
  ;

class $iw &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Serializable { 
class $iw &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Serializable { 

          &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;P(p: Partition) 



}
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Strangely the missing import and others are there if the class is wrapped inside an object:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
...
parse(&quot;

class $read &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Serializable { 
  ;

class $iw &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Serializable { 
val $line3$read = $line3.$read.INSTANCE
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; $line3$read.$iw.$iw.`spark`;
class $iw &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Serializable { 
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.SparkContext._
class $iw &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Serializable { 
class $iw &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Serializable { 
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; spark.implicits._
class $iw &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Serializable { 
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; spark.sql
class $iw &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Serializable { 
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.sql.functions._
class $iw &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Serializable { 
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.Partition
class $iw &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Serializable { 

          object P {
            &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;P(p: Partition)
          } 



}
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16264102" author="mpetruska" created="Thu, 23 Nov 2017 10:13:07 +0000"  >&lt;p&gt;The problem is also reproducible with non-spark related classes.&lt;br/&gt;
Example:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.UUID
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;U(u: UUID)
...
error: not found: type UUID
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16265385" author="mpetruska" created="Fri, 24 Nov 2017 16:02:56 +0000"  >&lt;p&gt;After digging in deeper, I found that there is a high chance that this is the underlying problem: &lt;a href=&quot;https://issues.scala-lang.org/browse/SI-9881&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://issues.scala-lang.org/browse/SI-9881&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16265394" author="mpetruska" created="Fri, 24 Nov 2017 16:14:59 +0000"  >&lt;p&gt;Proof for the above statement:&lt;br/&gt;
Tracing the import handler generated by `import java.util.UUID` yields&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
MemberHandlers$ImportHandler (refs: java)
expr: java.util
selectors: List(ImportSelector(UUID,17,UUID,17))
targetType: &amp;lt;noprefix&amp;gt;
importsWildcard: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
implicitSymbols: List()
importedSymbols: List()
importString: &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.UUID
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(also in `scala.tools.nsc.interpreter.MemberHandlers.ImportHandler` (excerpt):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
def importedSymbols = individualSymbols ++ wildcardSymbols

...

&lt;span class=&quot;code-comment&quot;&gt;/** Complete list of names imported by a wildcard */&lt;/span&gt;
lazy val wildcardNames: List[Name]   = wildcardSymbols map (_.name)
lazy val individualNames: List[Name] = individualSymbols map (_.name)

&lt;span class=&quot;code-comment&quot;&gt;/** The names imported by &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; statement */&lt;/span&gt;
override lazy val importedNames: List[Name] = wildcardNames ++ individualNames
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;)&lt;/p&gt;

&lt;p&gt;and the source code of `scala.tools.nsc.interpreter.Imports.importsCode` (excerpt):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// Single symbol imports might be implicits! See bug #1752.  Rather than
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; to finesse &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, we will mimic all imports &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; now.
&lt;/span&gt;def keepHandler(handler: MemberHandler) = handler match {
  &lt;span class=&quot;code-comment&quot;&gt;// While defining classes in &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;based mode - implicits are not needed.
&lt;/span&gt;  &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; h: ImportHandler &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; isClassBased &amp;amp;&amp;amp; definesClass =&amp;gt; h.importedNames.exists(x =&amp;gt; wanted.contains(x))
  &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; _: ImportHandler     =&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; x &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; generousImports =&amp;gt; x.definesImplicit || (x.definedNames exists (d =&amp;gt; wanted.exists(w =&amp;gt; d.startsWith(w))))
  &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; x                    =&amp;gt; x.definesImplicit || (x.definedNames exists wanted)
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16265398" author="mpetruska" created="Fri, 24 Nov 2017 16:17:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/scala/bug/issues/9881&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/scala/bug/issues/9881&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16265401" author="mpetruska" created="Fri, 24 Nov 2017 16:23:02 +0000"  >&lt;p&gt;The fix for this went into the 2.12 branch of scala: &lt;a href=&quot;https://github.com/scala/scala/pull/5640&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/scala/scala/pull/5640&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16265445" author="mpetruska" created="Fri, 24 Nov 2017 17:13:59 +0000"  >&lt;p&gt;Created a PR to retrofit the fix to scala repl 2.11: &lt;a href=&quot;https://github.com/scala/scala/pull/6195&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/scala/scala/pull/6195&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16265522" author="srowen" created="Fri, 24 Nov 2017 20:36:35 +0000"  >&lt;p&gt;That&apos;s great detective work. You may be able to tell better than I then: does this entail changing the way in which spark-shell overrides stuff in the Scala shell? or really just something that has to be fixed and picked up from Scala?&lt;/p&gt;

&lt;p&gt;2.12 support is mostly there in Spark, and will require 2.12.4, which has this fix, so OK there. &lt;br/&gt;
For 2.11, I think Spark is mostly stuck on 2.11.8 because the Scala shell changed between 2.11.8 and 2.11.11 and it was very hard to make one set of code that worked on both. So I&apos;m not sure if it will help in the end for Spark if it&apos;s back ported for Scala 2.11.&lt;/p&gt;</comment>
                            <comment id="16265543" author="rdub" created="Fri, 24 Nov 2017 22:02:35 +0000"  >&lt;p&gt;Just confirming: it&apos;s expected that the Scala 2.11 repl works fine, but spark-shell does not? Is spark-shell using repl code paths that have this bug that the Scala repl avoids?&lt;/p&gt;</comment>
                            <comment id="16265666" author="mpetruska" created="Sat, 25 Nov 2017 10:38:40 +0000"  >&lt;p&gt;I believe the scala repl fix would also fix this. Forcing the interpreter to a non-class based behaviour should also fix this issue (`isClassBased`) in my opinion. I think the problem is not caused by code and overrides added to `SparkILoop`. (Sorry about being this vague, but I have some evidence strengthening the above statements, but nothing that would prove it completely.)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rdub&quot; class=&quot;user-hover&quot; rel=&quot;rdub&quot;&gt;rdub&lt;/a&gt; Will do additional tests/experimentation with repl 2.11.8 to confirm; maybe find a way to force the non-class based behaviour...&lt;/p&gt;</comment>
                            <comment id="16270605" author="mpetruska" created="Wed, 29 Nov 2017 11:16:01 +0000"  >&lt;p&gt;Based on the comments above and the comments in the Scala PR (&lt;a href=&quot;https://github.com/scala/scala/pull/6195):&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/scala/scala/pull/6195):&lt;/a&gt; it is not practical to push a fix to the Scala repo for this.&lt;br/&gt;
It seems that we should also avoid changing the &quot;class based&quot; implementation to fix this issue.&lt;br/&gt;
Adding a workaround for the &quot;scala-2.11&quot; code.&lt;/p&gt;</comment>
                            <comment id="16270897" author="srowen" created="Wed, 29 Nov 2017 14:59:27 +0000"  >&lt;p&gt;OK, so this is basically &quot;fixed for Scala 2.12 only&quot;?&lt;/p&gt;</comment>
                            <comment id="16270903" author="apachespark" created="Wed, 29 Nov 2017 15:05:04 +0000"  >&lt;p&gt;User &apos;mpetruska&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/19846&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/19846&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16270912" author="mpetruska" created="Wed, 29 Nov 2017 15:11:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srowen&quot; class=&quot;user-hover&quot; rel=&quot;srowen&quot;&gt;srowen&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rdub&quot; class=&quot;user-hover&quot; rel=&quot;rdub&quot;&gt;rdub&lt;/a&gt;, I can now confirm that the original bug fix that was pushed to Scala 2.12 fixes this issue. Succeeded in retrofitting the same changes into Spark-shell, see: &lt;a href=&quot;https://github.com/apache/spark/pull/19846&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/19846&lt;/a&gt;.&lt;br/&gt;
The original fix for Scala 2.12 can be found at: &lt;a href=&quot;https://github.com/scala/scala/pull/5640&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/scala/scala/pull/5640&lt;/a&gt;&lt;br/&gt;
The downside is that the code/fix is not the most approachable, could not refactor for better readability (and also making sure it compiles &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ).&lt;/p&gt;</comment>
                            <comment id="16273985" author="jerryshao" created="Fri, 1 Dec 2017 06:06:02 +0000"  >&lt;p&gt;Shall we wait for this before 2.2.1 is out? &lt;/p&gt;</comment>
                            <comment id="16274269" author="srowen" created="Fri, 1 Dec 2017 11:14:26 +0000"  >&lt;p&gt;Issue resolved by pull request 19846&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/19846&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/19846&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16421548" author="jpallas" created="Sun, 1 Apr 2018 01:26:32 +0000"  >&lt;p&gt;The changes that were imported in&#160;&lt;a href=&quot;https://github.com/apache/spark/pull/19846&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/19846&lt;/a&gt;&#160;don&apos;t seem to cover all the cases that the Scala 2.12 changes covered. &#160;To be specific, this sequence:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; scala.reflect.runtime.{universe =&amp;gt; ru}
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; ru.TypeTag
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;C[T: TypeTag](value: T)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;works correctly in Scala 2.12 with -Yrepl-class-based, but does not work in spark-shell 2.3.0.&lt;/p&gt;

&lt;p&gt;I don&apos;t understand the import-handling code enough to understand the problem, however. &#160;It figures out that it needs the import for TypeTag but it doesn&apos;t recognize that the import depends on the previous import:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;console&amp;gt;:9: error: not found: value ru
import ru.TypeTag
       ^
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16423495" author="jpallas" created="Tue, 3 Apr 2018 05:33:55 +0000"  >&lt;p&gt;Following up to my previous comment: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mpetruska&quot; class=&quot;user-hover&quot; rel=&quot;mpetruska&quot;&gt;mpetruska&lt;/a&gt;, It looks like the Spark retrofit is missing a change that should appear in&#160;&lt;tt&gt;SparkILoopInterpreter.SparkImportHandler&lt;/tt&gt;. I believe it should&#160;include&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
override lazy val individualNames: List[Name] = importableSymbolsWithRenames map (_._2)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The corresponding change is in the&#160;&lt;a href=&quot;https://github.com/scala/scala/pull/6195&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;2.11 retrofit of SI-9881&lt;/a&gt;. &#160;Does that look right?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 33 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3luc7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>