<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:01:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-25175] Field resolution should fail if there&apos;s ambiguity for ORC native reader</title>
                <link>https://issues.apache.org/jira/browse/SPARK-25175</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-25132&quot; title=&quot;Case-insensitive field resolution when reading from Parquet&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-25132&quot;&gt;&lt;del&gt;SPARK-25132&lt;/del&gt;&lt;/a&gt; adds support for case-insensitive field resolution when reading from Parquet files. We found ORC files have similar issues, but not identical to Parquet. Spark has two OrcFileFormat.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Since &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-2883&quot; title=&quot;Spark Support for ORCFile format&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-2883&quot;&gt;&lt;del&gt;SPARK-2883&lt;/del&gt;&lt;/a&gt;, Spark supports ORC inside sql/hive module with Hive dependency. This hive OrcFileFormat always do case-insensitive field resolution regardless of case sensitivity mode. When there is ambiguity, hive OrcFileFormat always returns the first matched field, rather than failing the reading operation.&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-20682&quot; title=&quot;Add new ORCFileFormat based on Apache ORC&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-20682&quot;&gt;&lt;del&gt;SPARK-20682&lt;/del&gt;&lt;/a&gt; adds a new ORC data source inside sql/core. This native OrcFileFormat supports case-insensitive field resolution, however it cannot handle duplicate fields.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Besides data source tables, hive serde tables also have issues. If ORC data file has more fields than table schema, we just can&apos;t read hive serde tables. If ORC data file does not have more fields, hive serde tables always do field resolution by ordinal, rather than by name.&lt;/p&gt;

&lt;p&gt;Both ORC data source hive impl and hive serde table rely on the hive orc InputFormat/SerDe to read table. I&apos;m not sure whether we can change underlying hive classes to make all orc read behaviors consistent.&lt;/p&gt;

&lt;p&gt;This ticket aims to make read behavior of ORC data source native impl consistent with Parquet data source.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13180172">SPARK-25175</key>
            <summary>Field resolution should fail if there&apos;s ambiguity for ORC native reader</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="seancxmao">Chenxiao Mao</assignee>
                                    <reporter username="seancxmao">Chenxiao Mao</reporter>
                        <labels>
                    </labels>
                <created>Tue, 21 Aug 2018 09:23:35 +0000</created>
                <updated>Mon, 10 Sep 2018 02:26:18 +0000</updated>
                            <resolved>Mon, 10 Sep 2018 02:24:52 +0000</resolved>
                                    <version>2.3.1</version>
                                    <fixVersion>2.4.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16587206" author="seancxmao" created="Tue, 21 Aug 2018 09:28:54 +0000"  >&lt;p&gt;This is followup of&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-25132&quot; title=&quot;Case-insensitive field resolution when reading from Parquet&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-25132&quot;&gt;&lt;del&gt;SPARK-25132&lt;/del&gt;&lt;/a&gt;. I&apos;m working on this.&lt;/p&gt;</comment>
                            <comment id="16592419" author="dongjoon" created="Sat, 25 Aug 2018 03:10:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=seancxmao&quot; class=&quot;user-hover&quot; rel=&quot;seancxmao&quot;&gt;seancxmao&lt;/a&gt;. I know you are working, but could you give us some failure examples?&lt;/p&gt;</comment>
                            <comment id="16593013" author="dongjoon" created="Sun, 26 Aug 2018 20:08:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=seancxmao&quot; class=&quot;user-hover&quot; rel=&quot;seancxmao&quot;&gt;seancxmao&lt;/a&gt;. If there is no example, we can not help you. In that case, we usually close this as `Cannot Reproduce`.&lt;/p&gt;</comment>
                            <comment id="16593152" author="yucai" created="Mon, 27 Aug 2018 03:08:58 +0000"  >&lt;p&gt;I pinged &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=seancxmao&quot; class=&quot;user-hover&quot; rel=&quot;seancxmao&quot;&gt;seancxmao&lt;/a&gt; offline, he will give more details.&lt;/p&gt;</comment>
                            <comment id="16593155" author="dongjoon" created="Mon, 27 Aug 2018 03:10:31 +0000"  >&lt;p&gt;I followed the same direction given by &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-25132&quot; title=&quot;Case-insensitive field resolution when reading from Parquet&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-25132&quot;&gt;&lt;del&gt;SPARK-25132&lt;/del&gt;&lt;/a&gt;, but I cannot reproduce this in Spark 2.3.1.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
scala&amp;gt; spark.version
res8: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = 2.3.1

scala&amp;gt; spark.range(5).toDF.write.mode(&lt;span class=&quot;code-quote&quot;&gt;&quot;overwrite&quot;&lt;/span&gt;).format(&lt;span class=&quot;code-quote&quot;&gt;&quot;orc&quot;&lt;/span&gt;).saveAsTable(&lt;span class=&quot;code-quote&quot;&gt;&quot;t3&quot;&lt;/span&gt;)

scala&amp;gt; sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;create table t4 (`ID` BIGINT) USING orc LOCATION &lt;span class=&quot;code-quote&quot;&gt;&apos;/Users/dongjoon/spark-release/spark-2.3.1-bin-hadoop2.7/spark-warehouse/t3&apos;&lt;/span&gt;&quot;&lt;/span&gt;)

scala&amp;gt; sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;select * from t3&quot;&lt;/span&gt;).show
+---+
| id|
+---+
|  2|
|  3|
|  4|
|  1|
|  0|
+---+

scala&amp;gt; sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;select * from t4&quot;&lt;/span&gt;).show
+---+
| ID|
+---+
|  2|
|  3|
|  4|
|  1|
|  0|
+---+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Please reopen this with a reproducible example. Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=seancxmao&quot; class=&quot;user-hover&quot; rel=&quot;seancxmao&quot;&gt;seancxmao&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16593156" author="dongjoon" created="Mon, 27 Aug 2018 03:11:32 +0000"  >&lt;p&gt;Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yucai&quot; class=&quot;user-hover&quot; rel=&quot;yucai&quot;&gt;yucai&lt;/a&gt;. I&apos;m highly interested in this case. I&apos;ll wait for his reopening. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16593185" author="seancxmao" created="Mon, 27 Aug 2018 04:58:54 +0000"  >&lt;p&gt;Investigation about ORC tables with duplicate fields (c and C), thus also data file has more fields than table schema.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
val data = spark.range(5).selectExpr(&lt;span class=&quot;code-quote&quot;&gt;&quot;id as a&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;id * 2 as B&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;id * 3 as c&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;id * 4 as C&quot;&lt;/span&gt;)
spark.conf.set(&lt;span class=&quot;code-quote&quot;&gt;&quot;spark.sql.caseSensitive&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
data.write.format(&lt;span class=&quot;code-quote&quot;&gt;&quot;orc&quot;&lt;/span&gt;).mode(&lt;span class=&quot;code-quote&quot;&gt;&quot;overwrite&quot;&lt;/span&gt;).save(&lt;span class=&quot;code-quote&quot;&gt;&quot;/user/hive/warehouse/orc_data&quot;&lt;/span&gt;)

$&amp;gt; hive --orcfiledump /user/hive/warehouse/orc_data/part-00001-9716d241-9ad9-4d56-8de3-7bc482067614-c000.snappy.orc
Structure &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; /user/hive/warehouse/orc_data/part-00001-9716d241-9ad9-4d56-8de3-7bc482067614-c000.snappy.orc
Type: struct&amp;lt;a:bigint,B:bigint,c:bigint,C:bigint&amp;gt;

CREATE TABLE orc_data_source_lower (a LONG, b LONG, c LONG) USING orc LOCATION &lt;span class=&quot;code-quote&quot;&gt;&apos;/user/hive/warehouse/orc_data&apos;&lt;/span&gt;
CREATE TABLE orc_data_source_upper (A LONG, B LONG, C LONG) USING orc LOCATION &lt;span class=&quot;code-quote&quot;&gt;&apos;/user/hive/warehouse/orc_data&apos;&lt;/span&gt;
CREATE TABLE orc_hive_serde_lower (a LONG, b LONG, c LONG) STORED AS orc LOCATION &lt;span class=&quot;code-quote&quot;&gt;&apos;/user/hive/warehouse/orc_data&apos;&lt;/span&gt;
CREATE TABLE orc_hive_serde_upper (A LONG, B LONG, C LONG) STORED AS orc LOCATION &lt;span class=&quot;code-quote&quot;&gt;&apos;/user/hive/warehouse/orc_data&apos;&lt;/span&gt;

DESC EXTENDED orc_data_source_lower;
DESC EXTENDED orc_data_source_upper;
DESC EXTENDED orc_hive_serde_lower;
DESC EXTENDED orc_hive_serde_upper;

spark.conf.set(&lt;span class=&quot;code-quote&quot;&gt;&quot;spark.sql.hive.convertMetastoreOrc&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;no.&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;caseSensitive&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;table columns&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;select column&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;orc column&lt;br/&gt;
 (select via data source table, hive impl)&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;orc column&lt;br/&gt;
 (select via data source table, native impl)&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;orc column&lt;br/&gt;
 (select via hive serde table)&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;true&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a, b, c&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;IndexOutOfBoundsException&#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;b&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;B&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;null&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;IndexOutOfBoundsException&#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;c&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;c&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;c&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;IndexOutOfBoundsException&#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;A&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;AnalysisException&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;AnalysisException&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;AnalysisException&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;5&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;B&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;AnalysisException&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;AnalysisException&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;AnalysisException&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;6&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;C&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;AnalysisException&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;AnalysisException&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;AnalysisException&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;A, B, C&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;AnalysisException&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;AnalysisException&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;AnalysisException&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;8&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;b&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;AnalysisException&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;AnalysisException&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;AnalysisException&#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;9&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;c&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;AnalysisException&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;AnalysisException&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;AnalysisException&#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;10&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;A&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;null&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;IndexOutOfBoundsException&#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;11&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;B&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;B&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;B&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;IndexOutOfBoundsException&#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;12&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;C&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;c&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;C&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;IndexOutOfBoundsException&#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;13&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;false&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a, b, c&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;IndexOutOfBoundsException&#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;14&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;b&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;B&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;B&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;IndexOutOfBoundsException&#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;15&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;c&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;c&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;c&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;IndexOutOfBoundsException&#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;16&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;A&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;IndexOutOfBoundsException&#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;17&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;B&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;B&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;B&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;IndexOutOfBoundsException&#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;18&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;C&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;c&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;c&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;IndexOutOfBoundsException&#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;19&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;A, B, C&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;IndexOutOfBoundsException&#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;20&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;b&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;B&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;B&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;IndexOutOfBoundsException&#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;21&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;c&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;c&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;c&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;IndexOutOfBoundsException&#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;22&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;A&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;IndexOutOfBoundsException&#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;23&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;B&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;B&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;B&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;IndexOutOfBoundsException&#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;24&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;C&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;c&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;c&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;IndexOutOfBoundsException&#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;Followup tests that use ORC files with no duplicate fields (only a,B).&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
val data = spark.range(5).selectExpr(&lt;span class=&quot;code-quote&quot;&gt;&quot;id as a&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;id * 2 as B&quot;&lt;/span&gt;)
spark.conf.set(&lt;span class=&quot;code-quote&quot;&gt;&quot;spark.sql.caseSensitive&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
data.write.format(&lt;span class=&quot;code-quote&quot;&gt;&quot;orc&quot;&lt;/span&gt;).mode(&lt;span class=&quot;code-quote&quot;&gt;&quot;overwrite&quot;&lt;/span&gt;).save(&lt;span class=&quot;code-quote&quot;&gt;&quot;/user/hive/warehouse/orc_data_nodup&quot;&lt;/span&gt;)

$&amp;gt; hive --orcfiledump /user/hive/warehouse/orc_data_nodup&lt;span class=&quot;code-comment&quot;&gt;//user/hive/warehouse/orc_data_nodup/part-00001-4befd318-9ed5-4d77-b51b-09848d71d9cd-c000.snappy.orc
&lt;/span&gt;Structure &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; /user/hive/warehouse/orc_data_nodup/part-00001-4befd318-9ed5-4d77-b51b-09848d71d9cd-c000.snappy.orc
Type: struct&amp;lt;a:bigint,B:bigint&amp;gt;

CREATE TABLE orc_nodup_hive_serde_lower (a LONG, b LONG) STORED AS orc LOCATION &lt;span class=&quot;code-quote&quot;&gt;&apos;/user/hive/warehouse/orc_data_nodup&apos;&lt;/span&gt;
CREATE TABLE orc_nodup_hive_serde_upper (A LONG, B LONG) STORED AS orc LOCATION &lt;span class=&quot;code-quote&quot;&gt;&apos;/user/hive/warehouse/orc_data_nodup&apos;&lt;/span&gt;

DESC EXTENDED orc_nodup_hive_serde_lower;
DESC EXTENDED orc_nodup_hive_serde_upper;

spark.conf.set(&lt;span class=&quot;code-quote&quot;&gt;&quot;spark.sql.hive.convertMetastoreOrc&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;no.&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;caseSensitive&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;table columns&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;select column&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;orc column&lt;br/&gt;
 (select via hive serde table)&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;true&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a, b&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;b&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;B&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;A&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;AnalysisException&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;5&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;B&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;AnalysisException&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;A, B&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;AnalysisException&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;8&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;b&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;AnalysisException&#160;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;10&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;A&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;11&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;B&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;B&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;13&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;false&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a, b&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;14&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;b&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;B&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;16&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;A&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;17&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;B&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;B&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;19&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;A, B&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;20&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;b&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;B&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;22&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;A&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;a&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;23&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;B&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;B&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;Tests show that for hive serde table field resolution is by ordinal, not by name.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
spark.conf.set(&lt;span class=&quot;code-quote&quot;&gt;&quot;spark.sql.caseSensitive&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
spark.conf.set(&lt;span class=&quot;code-quote&quot;&gt;&quot;spark.sql.hive.convertMetastoreOrc&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
val data = spark.range(1).selectExpr(&lt;span class=&quot;code-quote&quot;&gt;&quot;id + 1 as x&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;id + 2 as y&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;id + 3 as z&quot;&lt;/span&gt;)
data.write.format(&lt;span class=&quot;code-quote&quot;&gt;&quot;orc&quot;&lt;/span&gt;).mode(&lt;span class=&quot;code-quote&quot;&gt;&quot;overwrite&quot;&lt;/span&gt;).save(&lt;span class=&quot;code-quote&quot;&gt;&quot;/user/hive/warehouse/orc_data_xyz&quot;&lt;/span&gt;)
sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;CREATE TABLE orc_table_ABC (A LONG, B LONG, C LONG) STORED AS orc LOCATION &lt;span class=&quot;code-quote&quot;&gt;&apos;/user/hive/warehouse/orc_data_xyz&apos;&lt;/span&gt;&quot;&lt;/span&gt;)
sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;select B from orc_table_ABC&quot;&lt;/span&gt;).show
+---+
|  B|
+---+
|  2|
+---+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16593194" author="seancxmao" created="Mon, 27 Aug 2018 05:22:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dongjoon&quot; class=&quot;user-hover&quot; rel=&quot;dongjoon&quot;&gt;dongjoon&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yucai&quot; class=&quot;user-hover&quot; rel=&quot;yucai&quot;&gt;yucai&lt;/a&gt;&#160;Here is a brief summary. We can see that&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The data source tables with hive impl always return a,B,c, no matter whether spark.sql.caseSensitive is set to true or false and no matter metastore table schema is in lower case or upper case. They always do case-insensitive field resolution, and if there is ambiguity they return the first matched one. Given ORC file schema is (a,B,c,C)
	&lt;ul&gt;
		&lt;li&gt;Is it better to return null in scenario 2 and 10?&#160;&lt;/li&gt;
		&lt;li&gt;Is it better to return C in scenario 12?&lt;/li&gt;
		&lt;li&gt;Is it better to fail due to ambiguity in scenario 15, 18, 21, 24, rather than always return lower case one?&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;The data source tables with native impl, compared to hive impl, handle scenario 2, 10, 12 in a more reasonable way. However, they handles ambiguity in the same way as hive impl, which is not consistent with Parquet data source.&lt;/li&gt;
	&lt;li&gt;The hive serde tables always throw&#160;IndexOutOfBoundsException at runtime when ORC file schema has more fields than table schema. If ORC schema does NOT have more fields, hive serde tables do field resolution by ordinal rather than by name.&lt;/li&gt;
	&lt;li&gt;Since in case-sensitive mode analysis should fail if a column name in query and metastore schema are in different cases, all AnalysisException(s) are reasonable.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Stacktrace of IndexOutOfBoundsException:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.IndexOutOfBoundsException: toIndex = 4
	at java.util.ArrayList.subListRangeCheck(ArrayList.java:1004)
	at java.util.ArrayList.subList(ArrayList.java:996)
	at org.apache.hadoop.hive.ql.io.orc.RecordReaderFactory.getSchemaOnRead(RecordReaderFactory.java:161)
	at org.apache.hadoop.hive.ql.io.orc.RecordReaderFactory.createTreeReader(RecordReaderFactory.java:66)
	at org.apache.hadoop.hive.ql.io.orc.RecordReaderImpl.&amp;lt;init&amp;gt;(RecordReaderImpl.java:202)
	at org.apache.hadoop.hive.ql.io.orc.ReaderImpl.rowsOptions(ReaderImpl.java:539)
	at org.apache.hadoop.hive.ql.io.orc.OrcRawRecordMerger$ReaderPair.&amp;lt;init&amp;gt;(OrcRawRecordMerger.java:183)
	at org.apache.hadoop.hive.ql.io.orc.OrcRawRecordMerger$OriginalReaderPair.&amp;lt;init&amp;gt;(OrcRawRecordMerger.java:226)
	at org.apache.hadoop.hive.ql.io.orc.OrcRawRecordMerger.&amp;lt;init&amp;gt;(OrcRawRecordMerger.java:437)
	at org.apache.hadoop.hive.ql.io.orc.OrcInputFormat.getReader(OrcInputFormat.java:1215)
	at org.apache.hadoop.hive.ql.io.orc.OrcInputFormat.getRecordReader(OrcInputFormat.java:1113)
	at org.apache.spark.rdd.HadoopRDD$$anon$1.liftedTree1$1(HadoopRDD.scala:257)
	at org.apache.spark.rdd.HadoopRDD$$anon$1.&amp;lt;init&amp;gt;(HadoopRDD.scala:256)
	at org.apache.spark.rdd.HadoopRDD.compute(HadoopRDD.scala:214)
	at org.apache.spark.rdd.HadoopRDD.compute(HadoopRDD.scala:94)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:324)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:288)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:38)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:324)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:288)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:38)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:324)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:288)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:38)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:324)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:288)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:38)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:324)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:288)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:38)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:324)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:288)
	at org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:38)
	at org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:324)
	at org.apache.spark.rdd.RDD.iterator(RDD.scala:288)
	at org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:87)
	at org.apache.spark.scheduler.Task.run(Task.scala:109)
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:345)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16593200" author="seancxmao" created="Mon, 27 Aug 2018 05:32:29 +0000"  >&lt;p&gt;Also here is similar investigation I did for parquet tables. Just for your information:&#160;&lt;a href=&quot;https://github.com/apache/spark/pull/22184/files#r212405373&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22184/files#r212405373&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16594213" author="dongjoon" created="Mon, 27 Aug 2018 20:54:23 +0000"  >&lt;p&gt;Okay, thank you for the details, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=seancxmao&quot; class=&quot;user-hover&quot; rel=&quot;seancxmao&quot;&gt;seancxmao&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;BTW, for me, the higher purpose is JIRA is the reverse of this JIRA title. What you are aiming is to support `Case Sensitivity` in Spark, right?&lt;/p&gt;

&lt;p&gt;In general, `spark.sql.caseSensitive=true` has been `false` by default since Spark 2.0.0. And, by default, Spark prevents you from generating such data. (not only ORC.)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
scala&amp;gt; data.write.format(&lt;span class=&quot;code-quote&quot;&gt;&quot;orc&quot;&lt;/span&gt;).mode(&lt;span class=&quot;code-quote&quot;&gt;&quot;overwrite&quot;&lt;/span&gt;).save(&lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/orc&quot;&lt;/span&gt;)
org.apache.spark.sql.AnalysisException: Found duplicate column(s) when inserting into file:/tmp/orc: `c`;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Thus, your use case is specifically &lt;b&gt;generating&lt;/b&gt; data with `spark.sql.caseSensitive=true` and reading data with `spark.sql.caseSensitive=false` (without problems).&lt;br/&gt;
Do you really have a &lt;b&gt;case-sensitive&lt;/b&gt; data(schema)? Could you elaborate more why you hit this situation?&lt;/p&gt;</comment>
                            <comment id="16595225" author="seancxmao" created="Tue, 28 Aug 2018 16:20:37 +0000"  >&lt;p&gt;After a deep dive into ORC file read paths (data source native, data source hive, hive serde), I realized that this is a little complicated. I&apos;m not sure whether it&apos;s technically possible to make all three read paths consistent with respect to case sensitivity, because we rely on hive InputFormat/SerDe which we might not be able to change.&lt;/p&gt;

&lt;p&gt;Please also see&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cloud_fan&quot; class=&quot;user-hover&quot; rel=&quot;cloud_fan&quot;&gt;cloud_fan&lt;/a&gt;&apos;s comment on Parquet: &lt;a href=&quot;https://github.com/apache/spark/pull/22184/files#r212849852&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22184/files#r212849852&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;So I changed the title of this Jira to reduce the scope. This ticket aims to make ORC data source native impl consistent with Parquet data source. The gap is that field resolution should fail if there is ambiguity in case-insensitive mode when reading from ORC. Does it make sense?&lt;/p&gt;

&lt;p&gt;As for duplicate fields with different letter cases, we don&apos;t have real use cases. It&apos;s just for testing purpose.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16595240" author="seancxmao" created="Tue, 28 Aug 2018 16:29:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cloud_fan&quot; class=&quot;user-hover&quot; rel=&quot;cloud_fan&quot;&gt;cloud_fan&lt;/a&gt; Does it make sense?&lt;/p&gt;</comment>
                            <comment id="16595994" author="apachespark" created="Wed, 29 Aug 2018 06:46:05 +0000"  >&lt;p&gt;User &apos;seancxmao&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22262&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22262&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16608636" author="dongjoon" created="Mon, 10 Sep 2018 02:24:52 +0000"  >&lt;p&gt;Issue resolved by pull request 22262&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22262&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22262&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="13075230">SPARK-20901</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13179358">SPARK-25132</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 10 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3x97z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>