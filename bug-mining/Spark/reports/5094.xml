<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:55:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-17742] Spark Launcher does not get failed state in Listener </title>
                <link>https://issues.apache.org/jira/browse/SPARK-17742</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;I tried to launch an application using the below code. This is dummy code to reproduce the problem. I tried exiting spark with status -1, throwing an exception etc. but in no case did the listener give me failed status. But if a spark job returns -1 or throws an exception from the main method it should be considered as a failure. &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; com.example;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.launcher.SparkAppHandle;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.launcher.SparkLauncher;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.IOException;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Main2 {

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException, InterruptedException {
        SparkLauncher launcher = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SparkLauncher()
                .setSparkHome(&lt;span class=&quot;code-quote&quot;&gt;&quot;/opt/spark2&quot;&lt;/span&gt;)
                .setAppResource(&lt;span class=&quot;code-quote&quot;&gt;&quot;/home/aseem/projects/testsparkjob/build/libs/testsparkjob-1.0-SNAPSHOT.jar&quot;&lt;/span&gt;)
                .setMainClass(&lt;span class=&quot;code-quote&quot;&gt;&quot;com.example.Main&quot;&lt;/span&gt;)
                .setMaster(&lt;span class=&quot;code-quote&quot;&gt;&quot;local[2]&quot;&lt;/span&gt;);

        launcher.startApplication(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MyListener());

        &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(1000 * 60);
    }

}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MyListener &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; SparkAppHandle.Listener {

    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void stateChanged(SparkAppHandle handle) {

        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;state changed &quot;&lt;/span&gt; + handle.getState());
    }

    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void infoChanged(SparkAppHandle handle) {
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;info changed &quot;&lt;/span&gt; + handle.getState());
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The spark job is &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; com.example;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.sql.SparkSession;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.IOException;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Main {

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
        SparkSession sparkSession = SparkSession
                .builder()
                .appName(&quot;&quot; + &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis())
                .getOrCreate();


        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; 15; i++) {
                &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(1000);
                &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;sleeping 1&quot;&lt;/span&gt;);
            }
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) {
            e.printStackTrace();
        }
&lt;span class=&quot;code-comment&quot;&gt;//        sparkSession.stop();
&lt;/span&gt;
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.exit(-1);
    }

}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13008817">SPARK-17742</key>
            <summary>Spark Launcher does not get failed state in Listener </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vanzin">Marcelo Masiero Vanzin</assignee>
                                    <reporter username="anshbansal">Aseem Bansal</reporter>
                        <labels>
                    </labels>
                <created>Fri, 30 Sep 2016 07:25:11 +0000</created>
                <updated>Thu, 30 Aug 2018 07:45:05 +0000</updated>
                            <resolved>Fri, 25 Aug 2017 17:04:51 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.3.0</fixVersion>
                                    <component>Spark Submit</component>
                        <due></due>
                            <votes>3</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="15535315" author="anshbansal" created="Fri, 30 Sep 2016 07:35:18 +0000"  >&lt;p&gt;I dug into the launcher code to see if I can figure out how it is working and see if I could find the bug. But when I reached LauncherServer&apos;s ServerConnection&apos;s handle method and found that this is socket programming I found it harder to find where the messages are coming from. Still trying to figure out but maybe someone who knows spark code better will find it easier to find the bug.&lt;/p&gt;</comment>
                            <comment id="15543048" author="vanzin" created="Mon, 3 Oct 2016 18:19:08 +0000"  >&lt;p&gt;This code in &quot;LocalSchedulerBackend&quot; causes the issue you&apos;re seeing:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  override def stop() {
    stop(SparkAppHandle.State.FINISHED)
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That code is run both when you explicitly stop a SparkContext, or when the VM shuts down, via a shutdown hook. You could remove that line (and similar lines in other backends), and change so that if the child process exist with a 0 exit code, then the app is &quot;successful&quot;. But need to make sure it still works with YARN (both client and cluster mode), since the logic to report app state is different there.&lt;/p&gt;</comment>
                            <comment id="15954698" author="daanvdn" created="Tue, 4 Apr 2017 07:24:20 +0000"  >&lt;p&gt;Hi, is there already a fix for this issue? Because it effectively renders the SparkLauncher unusable.. Or does anybody know at least a workaround for it? Any thoughts &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anshbansal&quot; class=&quot;user-hover&quot; rel=&quot;anshbansal&quot;&gt;anshbansal&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vanzin&quot; class=&quot;user-hover&quot; rel=&quot;vanzin&quot;&gt;vanzin&lt;/a&gt; ? Thanks!&lt;/p&gt;</comment>
                            <comment id="15954714" author="anshbansal" created="Tue, 4 Apr 2017 07:32:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daanvdn&quot; class=&quot;user-hover&quot; rel=&quot;daanvdn&quot;&gt;daanvdn&lt;/a&gt; We ended up using kafka messages to communicate to the web app that was using the launcher to launch the job  whether the job was complete or failed. Dumped Launcher&apos;s states as they are broken.&lt;/p&gt;</comment>
                            <comment id="15954903" author="daanvdn" created="Tue, 4 Apr 2017 09:29:24 +0000"  >&lt;p&gt;Thanks for the advice &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anshbansal&quot; class=&quot;user-hover&quot; rel=&quot;anshbansal&quot;&gt;anshbansal&lt;/a&gt;, I&apos;ll give that a try. &lt;br/&gt;
A question to the spark developers: is a fix for this bug already on the roadmap for a next release of spark?&lt;/p&gt;
</comment>
                            <comment id="15954905" author="srowen" created="Tue, 4 Apr 2017 09:31:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daanvdn&quot; class=&quot;user-hover&quot; rel=&quot;daanvdn&quot;&gt;daanvdn&lt;/a&gt; did you implement Marcelo&apos;s suggestion? this is pretty WYSIWYG &amp;#8211; if you want to push a change, investigate it and test and then open a PR. If you don&apos;t see anything here, nobody&apos;s working on it.&lt;/p&gt;</comment>
                            <comment id="15954988" author="daanvdn" created="Tue, 4 Apr 2017 10:57:25 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srowen&quot; class=&quot;user-hover&quot; rel=&quot;srowen&quot;&gt;srowen&lt;/a&gt;, unfortunately I&apos;m a java dev, so changing stuff in a scala code base is quite a bit out of my comfort zone. In case that changes, I will definitely look into it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, &lt;/p&gt;

&lt;p&gt;Cheers&lt;/p&gt;</comment>
                            <comment id="16079959" author="sleefd" created="Mon, 10 Jul 2017 07:10:56 +0000"  >&lt;p&gt;Is anybody working on this? If no, I can help.&lt;/p&gt;</comment>
                            <comment id="16127672" author="vanzin" created="Tue, 15 Aug 2017 18:26:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/spark/pull/18877&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18877&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16135862" author="vanzin" created="Mon, 21 Aug 2017 21:22:56 +0000"  >&lt;p&gt;Reopening temporarily for a follow up fix:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/19012&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/19012&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16150941" author="apachespark" created="Fri, 1 Sep 2017 18:02:04 +0000"  >&lt;p&gt;User &apos;vanzin&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/19012&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/19012&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16597155" author="apachespark" created="Thu, 30 Aug 2018 07:45:05 +0000"  >&lt;p&gt;User &apos;vanzin&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18877&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18877&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13017534">SPARK-18241</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 11 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i34aj3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>