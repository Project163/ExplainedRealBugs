<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:23:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-5841] Memory leak in DiskBlockManager</title>
                <link>https://issues.apache.org/jira/browse/SPARK-5841</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;DiskBlockManager registers a Runtime shutdown hook, which creates a hard reference to the entire Driver ActorSystem.  If a long-running JVM repeatedly creates and destroys SparkContext instances, it leaks memory.  &lt;/p&gt;

&lt;p&gt;I suggest we deregister the shutdown hook if DiskBlockManager.stop is called.  It&apos;s redundant at that point.&lt;/p&gt;

&lt;p&gt;PR coming.&lt;/p&gt;

&lt;p&gt;See also &lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/spark-user/201501.mbox/%3CCA+kjH+w_DDTEBE9XB6NrPxLTUXD=NC_d-3ogxTUMk_5v-E0bLQ@mail.gmail.com%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://mail-archives.apache.org/mod_mbox/spark-user/201501.mbox/%3CCA+kjH+w_DDTEBE9XB6NrPxLTUXD=NC_d-3ogxTUMk_5v-E0bLQ@mail.gmail.com%3E&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12775439">SPARK-5841</key>
            <summary>Memory leak in DiskBlockManager</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="matt.whelan">Matt Whelan</assignee>
                                    <reporter username="matt.whelan">Matt Whelan</reporter>
                        <labels>
                    </labels>
                <created>Mon, 16 Feb 2015 19:29:20 +0000</created>
                <updated>Sun, 17 May 2020 18:20:56 +0000</updated>
                            <resolved>Mon, 16 Feb 2015 22:54:53 +0000</resolved>
                                    <version>1.2.1</version>
                                    <fixVersion>1.3.0</fixVersion>
                                    <component>Block Manager</component>
                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14323169" author="matt.whelan" created="Mon, 16 Feb 2015 19:35:48 +0000"  >&lt;p&gt;PR: &lt;a href=&quot;https://github.com/apache/spark/pull/4627&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/4627&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14323170" author="apachespark" created="Mon, 16 Feb 2015 19:36:17 +0000"  >&lt;p&gt;User &apos;MattWhelan&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/4627&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/4627&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14323419" author="srowen" created="Mon, 16 Feb 2015 22:54:53 +0000"  >&lt;p&gt;Issue resolved by pull request 4627&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/4627&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/4627&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14323990" author="apachespark" created="Tue, 17 Feb 2015 09:33:22 +0000"  >&lt;p&gt;User &apos;srowen&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/4648&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/4648&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14324691" author="yhuai" created="Tue, 17 Feb 2015 19:06:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=matt.whelan&quot; class=&quot;user-hover&quot; rel=&quot;matt.whelan&quot;&gt;matt.whelan&lt;/a&gt; I noticed that after SQL unit tests, the following will be logged&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;10:59:28.721 ERROR org.apache.spark.util.Utils: Uncaught exception in thread delete Spark local dirs
java.lang.IllegalStateException: Shutdown in progress
	at java.lang.ApplicationShutdownHooks.remove(ApplicationShutdownHooks.java:82)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Runtime&lt;/span&gt;.removeShutdownHook(&lt;span class=&quot;code-object&quot;&gt;Runtime&lt;/span&gt;.java:239)
	at org.apache.spark.storage.DiskBlockManager.stop(DiskBlockManager.scala:151)
	at org.apache.spark.storage.DiskBlockManager$$anon$1$$anonfun$run$1.apply$mcV$sp(DiskBlockManager.scala:141)
	at org.apache.spark.storage.DiskBlockManager$$anon$1$$anonfun$run$1.apply(DiskBlockManager.scala:139)
	at org.apache.spark.storage.DiskBlockManager$$anon$1$$anonfun$run$1.apply(DiskBlockManager.scala:139)
	at org.apache.spark.util.Utils$.logUncaughtExceptions(Utils.scala:1613)
	at org.apache.spark.storage.DiskBlockManager$$anon$1.run(DiskBlockManager.scala:139)
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;delete Spark local dirs&quot;&lt;/span&gt; java.lang.IllegalStateException: Shutdown in progress
	at java.lang.ApplicationShutdownHooks.remove(ApplicationShutdownHooks.java:82)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Runtime&lt;/span&gt;.removeShutdownHook(&lt;span class=&quot;code-object&quot;&gt;Runtime&lt;/span&gt;.java:239)
	at org.apache.spark.storage.DiskBlockManager.stop(DiskBlockManager.scala:151)
	at org.apache.spark.storage.DiskBlockManager$$anon$1$$anonfun$run$1.apply$mcV$sp(DiskBlockManager.scala:141)
	at org.apache.spark.storage.DiskBlockManager$$anon$1$$anonfun$run$1.apply(DiskBlockManager.scala:139)
	at org.apache.spark.storage.DiskBlockManager$$anon$1$$anonfun$run$1.apply(DiskBlockManager.scala:139)
	at org.apache.spark.util.Utils$.logUncaughtExceptions(Utils.scala:1613)
	at org.apache.spark.storage.DiskBlockManager$$anon$1.run(DiskBlockManager.scala:139)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Seems the log is related to this commit. Is it expected? You can try &quot;test-only org.apache.spark.sql.sources.InsertSuite&quot; to see it.&lt;/p&gt;</comment>
                            <comment id="14324719" author="srowen" created="Tue, 17 Feb 2015 19:18:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yhuai&quot; class=&quot;user-hover&quot; rel=&quot;yhuai&quot;&gt;yhuai&lt;/a&gt; Fixed (I think) in &lt;a href=&quot;https://github.com/apache/spark/pull/4648&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/4648&lt;/a&gt;  &amp;#8211; will merge shortly unless anyone objects as I think it&apos;s causing test problems.&lt;/p&gt;</comment>
                            <comment id="14324729" author="yhuai" created="Tue, 17 Feb 2015 19:24:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sowen&quot; class=&quot;user-hover&quot; rel=&quot;sowen&quot;&gt;sowen&lt;/a&gt; I see. Thank you for the pointer!&lt;/p&gt;</comment>
                            <comment id="14327086" author="apachespark" created="Thu, 19 Feb 2015 07:52:02 +0000"  >&lt;p&gt;User &apos;nishkamravi2&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/4690&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/4690&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14568312" author="cqnguyen" created="Tue, 2 Jun 2015 00:46:50 +0000"  >&lt;p&gt;We are using Luigi with Spark 1.3.1 to manage our jobs&lt;/p&gt;

&lt;p&gt;However we run into a unique rare case with the following conditions that trigger this resolved Block Manger Bug:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dataset is relatively large ~ 1.5TB&lt;/li&gt;
	&lt;li&gt;Spark job is ran with Luigi&lt;/li&gt;
	&lt;li&gt;save to local HDFS&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The spark job would process data and mappings just fine, until the very end when it proceeds to save the files to local hdfs this is when it triggers this bug. &lt;/p&gt;

&lt;p&gt;However, the job saves and complete data successfully if it was saved to s3:// location.&lt;/p&gt;

&lt;p&gt;wondering what might cause this resolved bug to trigger when ran with luigi saving to local hdfs but not trigger when saved to s3 with luigi or ran without luigi?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12775708">SPARK-5869</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12834439">SPARK-8024</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 25 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i25ovz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>