<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:08:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-30267] avro deserializer: ArrayList cannot be cast to GenericData$Array</title>
                <link>https://issues.apache.org/jira/browse/SPARK-30267</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;On some more complex avro objects, the Avro Deserializer fails with the following stack trace:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.ClassCastException: java.util.ArrayList cannot be &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; to org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericData$Array
	at org.apache.spark.sql.avro.AvroDeserializer.$anonfun$newWriter$19(AvroDeserializer.scala:170)
	at org.apache.spark.sql.avro.AvroDeserializer.$anonfun$newWriter$19$adapted(AvroDeserializer.scala:169)
	at org.apache.spark.sql.avro.AvroDeserializer.$anonfun$getRecordWriter$1(AvroDeserializer.scala:314)
	at org.apache.spark.sql.avro.AvroDeserializer.$anonfun$getRecordWriter$1$adapted(AvroDeserializer.scala:310)
	at org.apache.spark.sql.avro.AvroDeserializer.$anonfun$getRecordWriter$2(AvroDeserializer.scala:332)
	at org.apache.spark.sql.avro.AvroDeserializer.$anonfun$getRecordWriter$2$adapted(AvroDeserializer.scala:329)
	at org.apache.spark.sql.avro.AvroDeserializer.$anonfun$converter$3(AvroDeserializer.scala:56)
	at org.apache.spark.sql.avro.AvroDeserializer.deserialize(AvroDeserializer.scala:70)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is because the Deserializer assumes that an array is always of the very specific &lt;tt&gt;org.apache.avro.generic.GenericData$Array&lt;/tt&gt; which is not always the case.&lt;/p&gt;

&lt;p&gt;Making it a normal list works.&lt;br/&gt;
A github PR is coming up to fix this.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13274758">SPARK-30267</key>
            <summary>avro deserializer: ArrayList cannot be cast to GenericData$Array</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="3" iconUrl="https://issues.apache.org/jira/images/icons/statuses/inprogress.png" description="This issue is being actively worked on at the moment by the assignee.">In Progress</status>
                    <statusCategory id="4" key="indeterminate" colorName="yellow"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="steven.aerts">Steven Aerts</assignee>
                                    <reporter username="steven.aerts">Steven Aerts</reporter>
                        <labels>
                    </labels>
                <created>Mon, 16 Dec 2019 13:08:24 +0000</created>
                <updated>Mon, 18 May 2020 17:36:57 +0000</updated>
                                            <version>2.4.4</version>
                    <version>3.0.0</version>
                                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17007755" author="gengliang.wang" created="Fri, 3 Jan 2020 20:50:07 +0000"  >&lt;p&gt;This issue is resolved in &lt;a href=&quot;https://github.com/apache/spark/pull/26907&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/26907&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17102917" author="tashoyan" created="Fri, 8 May 2020 20:31:38 +0000"  >&lt;p&gt;With Spark 3.0.0 preview 2, I have the following failure here:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.ClassCastException: scala.collection.convert.Wrappers$SeqWrapper cannot be &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; to org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericData$Array
  at org.apache.spark.sql.avro.AvroDeserializer.$anonfun$newWriter$19(AvroDeserializer.scala:170)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This means that the fix here &lt;a href=&quot;https://github.com/apache/spark/pull/26907&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/26907&lt;/a&gt;&#160;is not actually a fix, because Scala Seq cannot be cast to&#160;java.util.Collection&lt;span class=&quot;error&quot;&gt;&amp;#91;Any&amp;#93;&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;I have Scala Seq, because my Avro GenericRecord is generated from a case class by Avro4s. We can expect, that everybody using Avro4s (or other Scala-written generator like Avrohugger) will face the same ClassCastException.&lt;/p&gt;</comment>
                            <comment id="17102919" author="gengliang.wang" created="Fri, 8 May 2020 20:36:39 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tashoyan&quot; class=&quot;user-hover&quot; rel=&quot;tashoyan&quot;&gt;tashoyan&lt;/a&gt;, &lt;br/&gt;
could you provide a simple reproduce step?&lt;/p&gt;</comment>
                            <comment id="17103869" author="apachespark" created="Sun, 10 May 2020 16:23:16 +0000"  >&lt;p&gt;User &apos;tashoyan&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28491&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28491&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17103870" author="apachespark" created="Sun, 10 May 2020 16:24:00 +0000"  >&lt;p&gt;User &apos;tashoyan&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28491&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28491&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17103871" author="tashoyan" created="Sun, 10 May 2020 16:28:28 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Gengliang.Wang&quot; class=&quot;user-hover&quot; rel=&quot;Gengliang.Wang&quot;&gt;Gengliang.Wang&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Surprisingly, my tests run fine with the master branch. The reason is that&#160;&lt;em&gt;scala.collection.convert.Wrappers$SeqWrapper&lt;/em&gt; is a descendant of &lt;em&gt;java.util.Collection&lt;/em&gt;, hence the cast is possible.&lt;/p&gt;

&lt;p&gt;Nevertheless, I have opened a PR with interoperability tests: &lt;a href=&quot;https://github.com/apache/spark/pull/28491&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28491&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I believe, these tests give us more certainty.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 27 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z09ptk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>