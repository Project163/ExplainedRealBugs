<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:30:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-9277] SparseVector constructor must throw an error when declared number of elements less than array length</title>
                <link>https://issues.apache.org/jira/browse/SPARK-9277</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;I found that one can create SparseVector inconsistently and it will lead to an Java error in runtime, for example when training LogisticRegressionWithSGD.&lt;/p&gt;

&lt;p&gt;Here is the test case:&lt;/p&gt;


&lt;p&gt;In &lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;:&lt;br/&gt;
sc.version&lt;br/&gt;
Out&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;:&lt;br/&gt;
u&apos;1.3.1&apos;&lt;br/&gt;
In &lt;span class=&quot;error&quot;&gt;&amp;#91;13&amp;#93;&lt;/span&gt;:&lt;br/&gt;
from pyspark.mllib.linalg import SparseVector&lt;br/&gt;
from pyspark.mllib.regression import LabeledPoint&lt;br/&gt;
from pyspark.mllib.classification import LogisticRegressionWithSGD&lt;br/&gt;
In &lt;span class=&quot;error&quot;&gt;&amp;#91;3&amp;#93;&lt;/span&gt;:&lt;br/&gt;
x =  SparseVector(2, &lt;/p&gt;
{1:1, 2:2, 3:3, 4:4, 5:5}
&lt;p&gt;)&lt;br/&gt;
In &lt;span class=&quot;error&quot;&gt;&amp;#91;10&amp;#93;&lt;/span&gt;:&lt;br/&gt;
l = LabeledPoint(0, x)&lt;br/&gt;
In &lt;span class=&quot;error&quot;&gt;&amp;#91;12&amp;#93;&lt;/span&gt;:&lt;br/&gt;
r = sc.parallelize(&lt;span class=&quot;error&quot;&gt;&amp;#91;l&amp;#93;&lt;/span&gt;)&lt;br/&gt;
In &lt;span class=&quot;error&quot;&gt;&amp;#91;14&amp;#93;&lt;/span&gt;:&lt;br/&gt;
m = LogisticRegressionWithSGD.train(r)&lt;/p&gt;

&lt;p&gt;Error:&lt;/p&gt;


&lt;p&gt;Py4JJavaError: An error occurred while calling o86.trainLogisticRegressionModelWithSGD.&lt;br/&gt;
: org.apache.spark.SparkException: Job aborted due to stage failure: Task 7 in stage 11.0 failed 1 times, most recent failure: Lost task 7.0 in stage 11.0 (TID 47, localhost): java.lang.ArrayIndexOutOfBoundsException: 2&lt;/p&gt;


&lt;p&gt;Attached is the notebook with the scenario and the full message&lt;/p&gt;</description>
                <environment></environment>
        <key id="12848541">SPARK-9277</key>
            <summary>SparseVector constructor must throw an error when declared number of elements less than array length</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="srowen">Sean R. Owen</assignee>
                                    <reporter username="vykhand">Andrey Vykhodtsev</reporter>
                        <labels>
                            <label>starter</label>
                    </labels>
                <created>Thu, 23 Jul 2015 12:46:28 +0000</created>
                <updated>Thu, 30 Jul 2015 16:20:23 +0000</updated>
                            <resolved>Thu, 30 Jul 2015 16:20:15 +0000</resolved>
                                    <version>1.3.1</version>
                                    <fixVersion>1.5.0</fixVersion>
                                    <component>MLlib</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14638747" author="vykhand" created="Thu, 23 Jul 2015 12:47:48 +0000"  >&lt;p&gt;&lt;br/&gt;
Attached is the notebook with the scenario and the full message:&lt;/p&gt;</comment>
                            <comment id="14640055" author="mechcoder" created="Fri, 24 Jul 2015 07:13:35 +0000"  >&lt;p&gt;I have labelled this as started. Will fix this in 4 days, if no one comes forward by then.&lt;/p&gt;</comment>
                            <comment id="14640969" author="josephkb" created="Fri, 24 Jul 2015 19:34:47 +0000"  >&lt;p&gt;Checking that the length of the array is &amp;lt; size sounds good.  Thanks for pointing this out!&lt;/p&gt;

&lt;p&gt;Side note: We should not check the full array of indices for validity since Vector construction needs to be cheap (to facilitate translating to and from other vector types such as Breeze and numpy).&lt;/p&gt;</comment>
                            <comment id="14641555" author="vykhand" created="Sat, 25 Jul 2015 11:45:15 +0000"  >&lt;p&gt;Hi Joseph,&lt;/p&gt;

&lt;p&gt;will it be too expensive performance wize to add the following check : &lt;/p&gt;

&lt;p&gt;max index in the array &amp;lt; size?&lt;/p&gt;

&lt;p&gt;From the correctness perspective it is a better thing to do.&lt;/p&gt;</comment>
                            <comment id="14641787" author="vykhand" created="Sat, 25 Jul 2015 21:40:52 +0000"  >&lt;p&gt;btw here is the case that shows that just checking that len(array) &amp;lt; size is unreliable:&lt;/p&gt;

&lt;p&gt;In &lt;span class=&quot;error&quot;&gt;&amp;#91;4&amp;#93;&lt;/span&gt;:&lt;/p&gt;

&lt;p&gt;x =  SparseVector(2, &lt;/p&gt;
{1:1, 1:2, 1:3, 1:4, 5:5}
&lt;p&gt;)&lt;br/&gt;
In &lt;span class=&quot;error&quot;&gt;&amp;#91;5&amp;#93;&lt;/span&gt;:&lt;/p&gt;

&lt;p&gt;l = LabeledPoint(0, x)&lt;br/&gt;
In &lt;span class=&quot;error&quot;&gt;&amp;#91;6&amp;#93;&lt;/span&gt;:&lt;/p&gt;

&lt;p&gt;r = sc.parallelize(&lt;span class=&quot;error&quot;&gt;&amp;#91;l&amp;#93;&lt;/span&gt;)&lt;br/&gt;
In &lt;span class=&quot;error&quot;&gt;&amp;#91;7&amp;#93;&lt;/span&gt;:&lt;/p&gt;

&lt;p&gt;m = LogisticRegressionWithSGD.train(r)&lt;/p&gt;

&lt;p&gt;Result :&lt;/p&gt;

&lt;p&gt;Py4JJavaError: An error occurred while calling o38.trainLogisticRegressionModelWithSGD.&lt;br/&gt;
: org.apache.spark.SparkException: Job aborted due to stage failure: Task 0 in stage 5.0 failed 1 times, most recent failure: Lost task 0.0 in stage 5.0 (TID 5, localhost): java.lang.ArrayIndexOutOfBoundsException: 5&lt;/p&gt;</comment>
                            <comment id="14641878" author="srowen" created="Sun, 26 Jul 2015 07:37:49 +0000"  >&lt;p&gt;Yes, it&apos;s clear this doesn&apos;t catch all cases. The cost of checking the entire input every time may be high, as this code path is used so heavily internally. This change is more of a fail-faster convenience for user code.&lt;/p&gt;</comment>
                            <comment id="14644871" author="josephkb" created="Tue, 28 Jul 2015 19:12:10 +0000"  >&lt;p&gt;I think a constant-time check is OK, but scanning the full array is too expensive.  We want construction to be constant-time (a simple copying of a reference).&lt;/p&gt;</comment>
                            <comment id="14645629" author="srowen" created="Wed, 29 Jul 2015 07:37:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=MechCoder&quot; class=&quot;user-hover&quot; rel=&quot;MechCoder&quot;&gt;MechCoder&lt;/a&gt; Are you working on this?&lt;/p&gt;</comment>
                            <comment id="14647380" author="mechcoder" created="Thu, 30 Jul 2015 09:19:12 +0000"  >&lt;p&gt;I will not have access to a development environment till Saturday. Feel free to fix it. Thanks.&lt;/p&gt;</comment>
                            <comment id="14647490" author="apachespark" created="Thu, 30 Jul 2015 11:32:05 +0000"  >&lt;p&gt;User &apos;srowen&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/7794&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/7794&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14647883" author="mengxr" created="Thu, 30 Jul 2015 16:20:15 +0000"  >&lt;p&gt;Issue resolved by pull request 7794&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/7794&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/7794&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12746794" name="SparseVector test.html" size="211579" author="vykhand" created="Thu, 23 Jul 2015 12:47:48 +0000"/>
                            <attachment id="12746795" name="SparseVector test.ipynb" size="17640" author="vykhand" created="Thu, 23 Jul 2015 12:47:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 16 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2hu4f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>