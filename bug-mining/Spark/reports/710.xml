<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:17:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-3404] SparkSubmitSuite fails with &quot;spark-submit exits with code 1&quot;</title>
                <link>https://issues.apache.org/jira/browse/SPARK-3404</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Maven-based Jenkins builds have been failing for over a month. For example:&lt;br/&gt;
&lt;a href=&quot;https://amplab.cs.berkeley.edu/jenkins/job/Spark-Master-Maven-pre-YARN/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://amplab.cs.berkeley.edu/jenkins/job/Spark-Master-Maven-pre-YARN/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It&apos;s SparkSubmitSuite that fails. For example:&lt;br/&gt;
&lt;a href=&quot;https://amplab.cs.berkeley.edu/jenkins/job/Spark-Master-Maven-pre-YARN/541/hadoop.version=2.0.0-mr1-cdh4.1.2,label=centos/consoleFull&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://amplab.cs.berkeley.edu/jenkins/job/Spark-Master-Maven-pre-YARN/541/hadoop.version=2.0.0-mr1-cdh4.1.2,label=centos/consoleFull&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;SparkSubmitSuite
...
- launch simple application with spark-submit *** FAILED ***
  org.apache.spark.SparkException: &lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt; List(./bin/spark-submit, --class, org.apache.spark.deploy.SimpleApplicationTest, --name, testApp, --master, local, file:/tmp/1409815981504-0/testJar-1409815981505.jar) exited with code 1
  at org.apache.spark.util.Utils$.executeAndGetOutput(Utils.scala:837)
  at org.apache.spark.deploy.SparkSubmitSuite.runSparkSubmit(SparkSubmitSuite.scala:311)
  at org.apache.spark.deploy.SparkSubmitSuite$$anonfun$14.apply$mcV$sp(SparkSubmitSuite.scala:291)
  at org.apache.spark.deploy.SparkSubmitSuite$$anonfun$14.apply(SparkSubmitSuite.scala:284)
  at org.apache.spark.deploy.SparkSubmitSuite$$anonfun$14.apply(SparkSubmitSuite.scala:284)
  at org.scalatest.Transformer$$anonfun$apply$1.apply(Transformer.scala:22)
  at org.scalatest.Transformer$$anonfun$apply$1.apply(Transformer.scala:22)
  at org.scalatest.OutcomeOf$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;outcomeOf(OutcomeOf.scala:85)
  at org.scalatest.OutcomeOf$.outcomeOf(OutcomeOf.scala:104)
  at org.scalatest.Transformer.apply(Transformer.scala:22)
  ...
- spark submit includes jars passed in through --jar *** FAILED ***
  org.apache.spark.SparkException: &lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt; List(./bin/spark-submit, --class, org.apache.spark.deploy.JarCreationTest, --name, testApp, --master, local-cluster[2,1,512], --jars, file:/tmp/1409815984960-0/testJar-1409815985029.jar,file:/tmp/1409815985030-0/testJar-1409815985087.jar, file:/tmp/1409815984959-0/testJar-1409815984959.jar) exited with code 1
  at org.apache.spark.util.Utils$.executeAndGetOutput(Utils.scala:837)
  at org.apache.spark.deploy.SparkSubmitSuite.runSparkSubmit(SparkSubmitSuite.scala:311)
  at org.apache.spark.deploy.SparkSubmitSuite$$anonfun$15.apply$mcV$sp(SparkSubmitSuite.scala:305)
  at org.apache.spark.deploy.SparkSubmitSuite$$anonfun$15.apply(SparkSubmitSuite.scala:294)
  at org.apache.spark.deploy.SparkSubmitSuite$$anonfun$15.apply(SparkSubmitSuite.scala:294)
  at org.scalatest.Transformer$$anonfun$apply$1.apply(Transformer.scala:22)
  at org.scalatest.Transformer$$anonfun$apply$1.apply(Transformer.scala:22)
  at org.scalatest.OutcomeOf$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;outcomeOf(OutcomeOf.scala:85)
  at org.scalatest.OutcomeOf$.outcomeOf(OutcomeOf.scala:104)
  at org.scalatest.Transformer.apply(Transformer.scala:22)
  ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;SBT builds don&apos;t fail, so it is likely to be due to some difference in how the tests are run rather than a problem with test or core project.&lt;/p&gt;

&lt;p&gt;This is related to &lt;a href=&quot;http://issues.apache.org/jira/browse/SPARK-3330&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/SPARK-3330&lt;/a&gt; but the cause identified in that JIRA is, at least, not the only cause. (Although, it wouldn&apos;t hurt to be doubly-sure this is not an issue by changing the Jenkins config to invoke &lt;tt&gt;mvn clean &amp;amp;&amp;amp; mvn ... package&lt;/tt&gt; &lt;tt&gt;mvn ... clean package&lt;/tt&gt;.)&lt;/p&gt;

&lt;p&gt;This JIRA tracks investigation into a different cause. Right now I have some further information but not a PR yet.&lt;/p&gt;

&lt;p&gt;Part of the issue is that there is no clue in the log about why &lt;tt&gt;spark-submit&lt;/tt&gt; exited with status 1. See &lt;a href=&quot;https://github.com/apache/spark/pull/2108/files&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/2108/files&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-3193&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-3193&lt;/a&gt; for a change that would at least print stdout to the log too.&lt;/p&gt;

&lt;p&gt;The SparkSubmit program exits with 1 when the main class it is supposed to run is not found (&lt;a href=&quot;https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/deploy/SparkSubmit.scala#L322&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/deploy/SparkSubmit.scala#L322&lt;/a&gt;) This is for example SimpleApplicationTest (&lt;a href=&quot;https://github.com/apache/spark/blob/master/core/src/test/scala/org/apache/spark/deploy/SparkSubmitSuite.scala#L339&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/master/core/src/test/scala/org/apache/spark/deploy/SparkSubmitSuite.scala#L339&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;The test actually submits an empty JAR not containing this class. It relies on &lt;tt&gt;spark-submit&lt;/tt&gt; finding the class within the compiled test-classes of the Spark project. However it does seem to be compiled and present even with Maven.&lt;/p&gt;

&lt;p&gt;If modified to print stdout and stderr, and dump the actual command, I see an empty stdout, and only the command to stderr:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Spark Command: /Library/Java/JavaVirtualMachines/jdk1.8.0_20.jdk/Contents/Home/bin/java -cp &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;::/Users/srowen/Documents/spark/conf:/Users/srowen/Documents/spark/assembly/target/scala-2.10/spark-assembly-1.1.0-SNAPSHOT-hadoop1.0.4.jar:/Users/srowen/Documents/spark/core/target/scala-2.10/test-classes:/Users/srowen/Documents/spark/repl/target/scala-2.10/test-classes:/Users/srowen/Documents/spark/mllib/target/scala-2.10/test-classes:/Users/srowen/Documents/spark/bagel/target/scala-2.10/test-classes:/Users/srowen/Documents/spark/graphx/target/scala-2.10/test-classes:/Users/srowen/Documents/spark/streaming/target/scala-2.10/test-classes:/Users/srowen/Documents/spark/sql/catalyst/target/scala-2.10/test-classes:/Users/srowen/Documents/spark/sql/core/target/scala-2.10/test-classes:/Users/srowen/Documents/spark/sql/hive/target/scala-2.10/test-classes:/Users/srowen/Documents/Cloudera/bottou/hadoop-conf/ -Xms512m -Xmx512m org.apache.spark.deploy.SparkSubmit --&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.spark.deploy.JarCreationTest --name testApp --master local-cluster[2,1,512] --jars file:/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/folders/vl/nbmbr36j0692ch5r98b5cn040000gn/T/1409845282367-0/testJar-1409845282404.jar,file:/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/folders/vl/nbmbr36j0692ch5r98b5cn040000gn/T/1409845282405-0/testJar-1409845282436.jar file:/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/folders/vl/nbmbr36j0692ch5r98b5cn040000gn/T/1409845282366-0/testJar-1409845282366.jar
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Strangely, while tests fail under &lt;tt&gt;mvn test&lt;/tt&gt;, they &lt;b&gt;pass&lt;/b&gt; if I run just &lt;tt&gt;SparkSubmitSuite&lt;/tt&gt; in Maven with &lt;tt&gt;mvn -DwildcardSuites=org.apache.spark.deploy.SparkSubmitSuite test -rf :spark-core_2.10&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;It does seem to do with the classpath that gets picked up by &lt;tt&gt;spark-submit&lt;/tt&gt; varying in these different scenarios.&lt;/p&gt;

&lt;p&gt;I verified that the test suite and Jenkins set &lt;tt&gt;SPARK_TESTING=1&lt;/tt&gt;, since that affects access to &lt;tt&gt;test-classes&lt;/tt&gt; on the classpath in &lt;tt&gt;spark-submit&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I&apos;m still investigating but posting this to track the issue, which is kind of bothersome since it means Jenkins isn&apos;t catching (other) build problems from Maven. And to see if anyone has bright ideas.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12739168">SPARK-3404</key>
            <summary>SparkSubmitSuite fails with &quot;spark-submit exits with code 1&quot;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="srowen">Sean R. Owen</reporter>
                        <labels>
                    </labels>
                <created>Thu, 4 Sep 2014 16:50:14 +0000</created>
                <updated>Tue, 9 Sep 2014 21:15:01 +0000</updated>
                            <resolved>Tue, 9 Sep 2014 21:15:01 +0000</resolved>
                                    <version>1.0.2</version>
                    <version>1.1.0</version>
                                    <fixVersion>1.1.1</fixVersion>
                    <fixVersion>1.2.0</fixVersion>
                                    <component>Build</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14121646" author="andrewor14" created="Thu, 4 Sep 2014 17:48:19 +0000"  >&lt;p&gt;Thanks for looking into this Sean. Does this happen all the time or only once in a while? We have observed the same tests failing on our Jenkins, which runs the test through sbt. The behavior is consistent with running it through maven. If we run it through &apos;sbt test-only SparkSubmitSuite&apos; then it always passes, but if we run &apos;sbt test&apos; then sometimes it fails.&lt;/p&gt;

&lt;p&gt;This has also been failing for a while for sbt. Very roughly I remember we began seeing it after &lt;a href=&quot;https://github.com/apache/spark/pull/1777&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/1777&lt;/a&gt; went in. Though I have gone down that path to debug any possibilities of port collision to no avail. A related test failure is in DriverSuite, which also calls `Utils.executeAndGetOutput`. Have you seen that failing in maven?&lt;/p&gt;

&lt;p&gt;I will keep investigating it in parallel for sbt, though I suspect the root cause is the same. Let me know if you find anything.&lt;/p&gt;</comment>
                            <comment id="14121650" author="andrewor14" created="Thu, 4 Sep 2014 17:50:26 +0000"  >&lt;p&gt;I have updated the title to reflect this.&lt;/p&gt;</comment>
                            <comment id="14121653" author="srowen" created="Thu, 4 Sep 2014 17:52:38 +0000"  >&lt;p&gt;It&apos;s 100% repeatable in Maven for me locally, which seems to be Jenkins&apos; experience too. I don&apos;t see the same problem with SBT (/dev/run-tests) locally, although I can&apos;t say I run that regularly.&lt;/p&gt;

&lt;p&gt;I could rewrite the SparkSubmitSuite to submit a JAR file that actually contains the class it&apos;s trying to invoke. Maybe that&apos;s smarter? the problem here seems to be the vagaries of what the run-time classpath is during an SBT vs Maven test. Would anyone second that?&lt;/p&gt;

&lt;p&gt;Separately it would probably not hurt to get in that change that logs stdout / stderr from the Utils method.&lt;/p&gt;</comment>
                            <comment id="14126698" author="apachespark" created="Tue, 9 Sep 2014 06:47:48 +0000"  >&lt;p&gt;User &apos;srowen&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/2328&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/2328&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14127566" author="srowen" created="Tue, 9 Sep 2014 21:15:01 +0000"  >&lt;p&gt;Tests are now failing due to HiveQL test problems, but you can see they have passed SparkSubmitSuite:&lt;br/&gt;
&lt;a href=&quot;https://amplab.cs.berkeley.edu/jenkins/view/Spark/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://amplab.cs.berkeley.edu/jenkins/view/Spark/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I think this one&apos;s resolved now.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12723000">SPARK-2232</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 10 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1zouv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12327368">1.1.1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>