<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:28:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-37575] null values should be saved as nothing rather than quoted empty Strings &quot;&quot; with default settings</title>
                <link>https://issues.apache.org/jira/browse/SPARK-37575</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;As mentioned in sql migration guide(&lt;a href=&quot;https://spark.apache.org/docs/latest/sql-migration-guide.html#upgrading-from-spark-sql-23-to-24&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://spark.apache.org/docs/latest/sql-migration-guide.html#upgrading-from-spark-sql-23-to-24&lt;/a&gt;),&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Since Spark 2.4, empty strings are saved as quoted empty strings &quot;&quot;. In version 2.3 and earlier, empty strings are equal to null values and do not reflect to any characters in saved CSV files. For example, the row of &quot;a&quot;, null, &quot;&quot;, 1 was written as a,,,1. Since Spark 2.4, the same row is saved as a,,&quot;&quot;,1. To restore the previous behavior, set the CSV option emptyValue to empty (not quoted) string.&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;But actually, both empty strings and null values are saved as quoted empty Strings &quot;&quot; rather than &quot;&quot; (for empty strings) and nothing(for null values)&#12290;&lt;/p&gt;

&lt;p&gt;code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
val data = List(&lt;span class=&quot;code-quote&quot;&gt;&quot;spark&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;).toDF(&quot;&lt;/span&gt;name&quot;)
data.coalesce(1).write.csv(&lt;span class=&quot;code-quote&quot;&gt;&quot;spark_csv_test&quot;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;actual result:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;line1: spark
line2: &quot;&quot;
line3: &quot;&quot;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;expected result:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;line1: spark
line2: 
line3: &quot;&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13415955">SPARK-37575</key>
            <summary>null values should be saved as nothing rather than quoted empty Strings &quot;&quot; with default settings</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Wayne Guo">Wei Guo</assignee>
                                    <reporter username="Wayne Guo">Wei Guo</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Dec 2021 05:20:43 +0000</created>
                <updated>Mon, 12 Dec 2022 18:10:49 +0000</updated>
                            <resolved>Tue, 14 Dec 2021 08:32:27 +0000</resolved>
                                    <version>2.4.0</version>
                    <version>3.2.0</version>
                                    <fixVersion>3.3.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17454966" author="wayne guo" created="Wed, 8 Dec 2021 05:45:58 +0000"  >&lt;p&gt;related issues:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-17916&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-17916&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-25241&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-25241&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17454968" author="gurwls223" created="Wed, 8 Dec 2021 05:51:53 +0000"  >&lt;p&gt;can you set nullValue and emptyValue options?&lt;/p&gt;</comment>
                            <comment id="17454974" author="wayne guo" created="Wed, 8 Dec 2021 06:01:18 +0000"  >&lt;p&gt;As default writerSettings in CSVOptions, &#160;nullValue is &quot;&quot;,&#160; &#160;emptyValueInWrite is &quot;\&quot;\&quot;&quot;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
val nullValue = parameters.getOrElse(&lt;span class=&quot;code-quote&quot;&gt;&quot;nullValue&quot;&lt;/span&gt;, &quot;&quot;)
val emptyValue = parameters.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;emptyValue&quot;&lt;/span&gt;)
val emptyValueInWrite = emptyValue.getOrElse(&lt;span class=&quot;code-quote&quot;&gt;&quot;\&quot;&lt;/span&gt;\&quot;&quot;)
writerSettings.setNullValue(nullValue)
writerSettings.setEmptyValue(emptyValueInWrite) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;but the final result is not expected?&lt;/p&gt;</comment>
                            <comment id="17454976" author="gurwls223" created="Wed, 8 Dec 2021 06:06:05 +0000"  >&lt;p&gt;Spark 2.4.X is EOL so it won&apos;t likely be fixed. Does it work with Spark 3+?&lt;/p&gt;</comment>
                            <comment id="17454989" author="wayne guo" created="Wed, 8 Dec 2021 06:38:33 +0000"  >&lt;p&gt;Spark 3.2.0 has the same behavior.&lt;/p&gt;</comment>
                            <comment id="17455043" author="wayne guo" created="Wed, 8 Dec 2021 08:39:33 +0000"  >&lt;p&gt;I think I maybe have found the root cause through debug Spark source code.&lt;/p&gt;

&lt;p&gt;In &lt;font color=&quot;#0747a6&quot;&gt;UnivocityGenerator&lt;/font&gt;, when the value of column is null values, column&apos;s value&#160;has been changed&#160; to &lt;font color=&quot;#00875a&quot;&gt;options.nullValue&lt;/font&gt;, default value&#160; is &quot;&quot;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; def convertRow(row: InternalRow): Seq[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;] = {
  &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; i = 0
  val values = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Array[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;](row.numFields)
  &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (i &amp;lt; row.numFields) {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!row.isNullAt(i)) {
      values(i) = valueConverters(i).apply(row, i)
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
      values(i) = options.nullValue
    }
    i += 1
  }
  values
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;So&#65292;in &lt;font color=&quot;#0747a6&quot;&gt;univocity-parsers lib&lt;/font&gt;(depended by Spark) &lt;font color=&quot;#0747a6&quot;&gt;AbstractWriter&lt;/font&gt; class, element( is original null values) has been changed to&#160; &quot;&quot; in UnivocityGenerator&#65292;not satisfied condition(element == null)&#65292;finally equals emptyValue, default value&#160; is &quot;\&quot;\&quot;&quot;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getStringValue(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; element) {
   usingNullOrEmptyValue = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
   &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (element == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      usingNullOrEmptyValue = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; nullValue;
   }
   &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; string = &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.valueOf(element);
   &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (string.isEmpty()) {
      usingNullOrEmptyValue = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; emptyValue;
   }
   &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; string;
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hyukjin.kwon&quot; class=&quot;user-hover&quot; rel=&quot;hyukjin.kwon&quot;&gt;hyukjin.kwon&lt;/a&gt; &#160;Should we fix the change(isNullAt) in &lt;font color=&quot;#0747a6&quot;&gt;UnivocityGenerator?&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17455053" author="wayne guo" created="Wed, 8 Dec 2021 08:51:45 +0000"  >&lt;p&gt;I think I can make a fast repair to verify my conclusion and add some test cases.&lt;/p&gt;</comment>
                            <comment id="17455055" author="gurwls223" created="Wed, 8 Dec 2021 08:54:51 +0000"  >&lt;p&gt;Yeah, it would be great to fix it, and upgrade the version used in Apache Spark.&lt;/p&gt;</comment>
                            <comment id="17456168" author="wayne guo" created="Thu, 9 Dec 2021 06:52:01 +0000"  >&lt;p&gt;I&#160; have made some bug fix in my local repo and add some test cases that passed, can you assign this issue to me?&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hyukjin.kwon&quot; class=&quot;user-hover&quot; rel=&quot;hyukjin.kwon&quot;&gt;hyukjin.kwon&lt;/a&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17456172" author="gurwls223" created="Thu, 9 Dec 2021 06:55:57 +0000"  >&lt;p&gt;We don&apos;t usually assign issues to someone. Once you open a PR, that will automatically assign appropriate ones. You can just add a comment that saying you&apos;re working on this ticket.&lt;/p&gt;</comment>
                            <comment id="17456662" author="apachespark" created="Thu, 9 Dec 2021 18:32:00 +0000"  >&lt;p&gt;User &apos;wayneguow&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/34853&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/34853&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17458981" author="maxgekk" created="Tue, 14 Dec 2021 08:32:27 +0000"  >&lt;p&gt;Issue resolved by pull request 34853&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/34853&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/34853&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17459647" author="apachespark" created="Wed, 15 Dec 2021 04:43:39 +0000"  >&lt;p&gt;User &apos;itholic&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/34905&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/34905&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17519235" author="apachespark" created="Thu, 7 Apr 2022 23:31:01 +0000"  >&lt;p&gt;User &apos;anchovYu&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/36110&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/36110&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17524600" author="apachespark" created="Tue, 19 Apr 2022 21:48:37 +0000"  >&lt;p&gt;User &apos;anchovYu&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/36268&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/36268&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 29 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0xg88:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>