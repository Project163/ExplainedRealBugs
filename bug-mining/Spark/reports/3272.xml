<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:40:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-14081] DataFrameNaFunctions fill should not convert float fields to double</title>
                <link>https://issues.apache.org/jira/browse/SPARK-14081</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/spark/blob/master/sql/core/src/main/scala/org/apache/spark/sql/DataFrameNaFunctions.scala&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;DataFrameNaFunctions&lt;/a&gt; provides useful function for dealing with null values in a DataFrame. Currently it changes FloatType columns to DoubleType when zero filling. Spark should preserve the column data type.&lt;/p&gt;

&lt;p&gt;In the following example, notice how `zeroFilledDF` has its `floatField` converted from float to double.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;scala&amp;gt; :paste
&lt;span class=&quot;code-comment&quot;&gt;// Entering paste mode (ctrl-D to finish)
&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.sql._
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.sql.types._

val schema = StructType(Seq(
  StructField(&lt;span class=&quot;code-quote&quot;&gt;&quot;intField&quot;&lt;/span&gt;, IntegerType),
  StructField(&lt;span class=&quot;code-quote&quot;&gt;&quot;longField&quot;&lt;/span&gt;, LongType),
  StructField(&lt;span class=&quot;code-quote&quot;&gt;&quot;floatField&quot;&lt;/span&gt;, FloatType),
  StructField(&lt;span class=&quot;code-quote&quot;&gt;&quot;doubleField&quot;&lt;/span&gt;, DoubleType)))

val rdd = sc.parallelize(Seq(Row(1,1L,1f,1d), Row(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)))

val df = sqlContext.createDataFrame(rdd, schema)

val zeroFilledDF = df.na.fill(0)

&lt;span class=&quot;code-comment&quot;&gt;// Exiting paste mode, now interpreting.
&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.sql._
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.sql.types._
schema: org.apache.spark.sql.types.StructType = StructType(StructField(intField,IntegerType,&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;), StructField(longField,LongType,&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;), StructField(floatField,FloatType,&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;), StructField(doubleField,DoubleType,&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;))
rdd: org.apache.spark.rdd.RDD[org.apache.spark.sql.Row] = ParallelCollectionRDD[2] at parallelize at &amp;lt;console&amp;gt;:48
df: org.apache.spark.sql.DataFrame = [intField: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, longField: bigint, floatField: &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;, doubleField: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;]
zeroFilledDF: org.apache.spark.sql.DataFrame = [intField: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, longField: bigint, floatField: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;, doubleField: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12952606">SPARK-14081</key>
            <summary>DataFrameNaFunctions fill should not convert float fields to double</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="traviscrawford">Travis Crawford</assignee>
                                    <reporter username="traviscrawford">Travis Crawford</reporter>
                        <labels>
                    </labels>
                <created>Tue, 22 Mar 2016 21:55:04 +0000</created>
                <updated>Thu, 31 Mar 2016 00:00:20 +0000</updated>
                            <resolved>Thu, 31 Mar 2016 00:00:20 +0000</resolved>
                                    <version>1.6.1</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15207692" author="rxin" created="Wed, 23 Mar 2016 01:33:56 +0000"  >&lt;p&gt;This is actually somewhat tricky, because we will lose information when the missing value (what user specifies) is being converted from double to float. In the case of 0 this is obviously not a problem, but in other cases it might be. Also it might be weird to do this only for float but not ints. What do you think?&lt;/p&gt;</comment>
                            <comment id="15207823" author="traviscrawford" created="Wed, 23 Mar 2016 03:19:36 +0000"  >&lt;p&gt;Agreed all data types should allow filling without changing their data type. From what I have observed only FloatType changes. Here&apos;s an example using the more specific fill that allows users to provide a replacement value map per column. Notice how just &lt;tt&gt;floatField&lt;/tt&gt; changes its data type.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;scala&amp;gt; :paste
&lt;span class=&quot;code-comment&quot;&gt;// Entering paste mode (ctrl-D to finish)
&lt;/span&gt;
val zeroFilledMapDF = df.na.fill(Map(
  &lt;span class=&quot;code-quote&quot;&gt;&quot;intField&quot;&lt;/span&gt; -&amp;gt; 0,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;longField&quot;&lt;/span&gt; -&amp;gt; 0L,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;floatField&quot;&lt;/span&gt; -&amp;gt; 0f,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;doubleField&quot;&lt;/span&gt; -&amp;gt; 0d
))

&lt;span class=&quot;code-comment&quot;&gt;// Exiting paste mode, now interpreting.
&lt;/span&gt;
zeroFilledMapDF: org.apache.spark.sql.DataFrame = [intField: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, longField: bigint, floatField: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;, doubleField: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If what I&apos;m proposing sounds like the correct behavior I&apos;ll put together a change and send a pull request. It looks relatively self-contained, perhaps with some overzealous casting in &lt;tt&gt;fill0&lt;/tt&gt; or &lt;tt&gt;fillCol&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15207843" author="rxin" created="Wed, 23 Mar 2016 04:05:39 +0000"  >&lt;p&gt;Yes a pull request would be great. Probably an one line change. Can you also add a test case for them? Thanks!&lt;/p&gt;</comment>
                            <comment id="15212140" author="traviscrawford" created="Fri, 25 Mar 2016 17:37:27 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rxin&quot; class=&quot;user-hover&quot; rel=&quot;rxin&quot;&gt;rxin&lt;/a&gt; - In &lt;a href=&quot;https://github.com/apache/spark/compare/master...traviscrawford:SPARK-14081-dataframena&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/compare/master...traviscrawford:SPARK-14081-dataframena&lt;/a&gt; I have a change that passes local tests, and I&apos;m running the full test suite now.&lt;/p&gt;

&lt;p&gt;I&apos;d like to update the docs to clarify how data type mismatches are handled. To double-check, the intended behavior is casting the replacement value to match the existing column type? I can add tests for this behavior too.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Current Docstring&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;The key of the map is the column name, and the value of the map is the replacement value.
The value must be of the following type:
`&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;`, `&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;`, `&lt;span class=&quot;code-object&quot;&gt;Float&lt;/span&gt;`, `&lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;`, `&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;`, `&lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;`.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Proposed Docstring&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;The key of the map is the column name, and the value of the map is the replacement value.
The value must be of the following type:
`&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;`, `&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;`, `&lt;span class=&quot;code-object&quot;&gt;Float&lt;/span&gt;`, `&lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;`, `&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;`, `&lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;`.
Replacement values are &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; to the column data type.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15212237" author="rxin" created="Fri, 25 Mar 2016 18:47:04 +0000"  >&lt;p&gt;That would be great Travis!&lt;/p&gt;</comment>
                            <comment id="15212395" author="apachespark" created="Fri, 25 Mar 2016 21:00:04 +0000"  >&lt;p&gt;User &apos;traviscrawford&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/11967&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/11967&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 34 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2v1zj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>