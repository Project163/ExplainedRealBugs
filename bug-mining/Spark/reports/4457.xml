<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:50:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-18905] Potential Issue of Semantics of BatchCompleted</title>
                <link>https://issues.apache.org/jira/browse/SPARK-18905</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;the current implementation of Spark streaming considers a batch is completed no matter the results of the jobs (&lt;a href=&quot;https://github.com/apache/spark/blob/1169db44bc1d51e68feb6ba2552520b2d660c2c0/streaming/src/main/scala/org/apache/spark/streaming/scheduler/JobScheduler.scala#L203&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/1169db44bc1d51e68feb6ba2552520b2d660c2c0/streaming/src/main/scala/org/apache/spark/streaming/scheduler/JobScheduler.scala#L203&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;Let&apos;s consider the following case:&lt;/p&gt;

&lt;p&gt;A micro batch contains 2 jobs and they read from two different kafka topics respectively. One of these jobs is failed due to some problem in the user defined logic, after the other one is finished successfully. &lt;/p&gt;

&lt;p&gt;1. The main thread in the Spark streaming application will execute the line mentioned above, &lt;/p&gt;

&lt;p&gt;2. and another thread (checkpoint writer) will make a checkpoint file immediately after this line is executed. &lt;/p&gt;

&lt;p&gt;3. Then due to the current error handling mechanism in Spark Streaming, StreamingContext will be closed (&lt;a href=&quot;https://github.com/apache/spark/blob/1169db44bc1d51e68feb6ba2552520b2d660c2c0/streaming/src/main/scala/org/apache/spark/streaming/scheduler/JobScheduler.scala#L214&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/1169db44bc1d51e68feb6ba2552520b2d660c2c0/streaming/src/main/scala/org/apache/spark/streaming/scheduler/JobScheduler.scala#L214&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;the user recovers from the checkpoint file, and because the JobSet containing the failed job has been removed (taken as completed) before the checkpoint is constructed, the data being processed by the failed job would never be reprocessed?&lt;/p&gt;


&lt;p&gt;I might have missed something in the checkpoint thread or this handleJobCompletion()....or it is a potential bug &lt;/p&gt;</description>
                <environment></environment>
        <key id="13028767">SPARK-18905</key>
            <summary>Potential Issue of Semantics of BatchCompleted</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="codingcat">Nan Zhu</assignee>
                                    <reporter username="codingcat">Nan Zhu</reporter>
                        <labels>
                    </labels>
                <created>Fri, 16 Dec 2016 20:32:14 +0000</created>
                <updated>Mon, 27 Nov 2017 11:02:08 +0000</updated>
                            <resolved>Tue, 17 Jan 2017 02:34:04 +0000</resolved>
                                    <version>1.5.1</version>
                    <version>1.5.2</version>
                    <version>1.6.1</version>
                    <version>1.6.2</version>
                    <version>1.6.3</version>
                    <version>2.0.0</version>
                    <version>2.0.1</version>
                    <version>2.0.2</version>
                                    <fixVersion>2.1.1</fixVersion>
                    <fixVersion>2.2.0</fixVersion>
                                    <component>DStreams</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15813405" author="zsxwing" created="Tue, 10 Jan 2017 00:53:13 +0000"  >&lt;p&gt;Sorry for the late reply. Yeah, good catch. However, even if it doesn&apos;t complete job, the failed job won&apos;t be run after recovery. Right? I think the root cause is that a failed job doesn&apos;t stop the StreamingContext. This might be a huge behavior change.&lt;/p&gt;

&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tdas&quot; class=&quot;user-hover&quot; rel=&quot;tdas&quot;&gt;tdas&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15813434" author="codingcat" created="Tue, 10 Jan 2017 01:05:26 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zsxwing&quot; class=&quot;user-hover&quot; rel=&quot;zsxwing&quot;&gt;zsxwing&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thanks for the reply, &lt;/p&gt;

&lt;p&gt;After testing in our environment for more times, I feel that this is not a problem anymore. The failed job would be recovered &lt;a href=&quot;https://github.com/apache/spark/blob/master/streaming/src/main/scala/org/apache/spark/streaming/scheduler/JobGenerator.scala#L216&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/master/streaming/src/main/scala/org/apache/spark/streaming/scheduler/JobGenerator.scala#L216&lt;/a&gt;, as counted in the downTime&lt;/p&gt;

&lt;p&gt;The question right now is, why we need to have pendingTime + downTime in the above method, &lt;/p&gt;</comment>
                            <comment id="15813455" author="zsxwing" created="Tue, 10 Jan 2017 01:13:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=CodingCat&quot; class=&quot;user-hover&quot; rel=&quot;codingcat&quot;&gt;CodingCat&lt;/a&gt; I think `pendingTime` is the jobs that have been generated but not completed.&lt;/p&gt;

&lt;p&gt;I think you are right in the JIRA description. The failed job should not be removed so that they can be included in the `getPendingTimes`. Could you submit a PR to fix it?&lt;/p&gt;</comment>
                            <comment id="15813459" author="codingcat" created="Tue, 10 Jan 2017 01:15:56 +0000"  >&lt;p&gt;yeah, but the downTime includes all batches from &quot;checkpoint time&quot; to &quot;restart time&quot;&lt;/p&gt;

&lt;p&gt;the jobs that have been generated but not completed shall be the first batch in downTime...no?&lt;/p&gt;</comment>
                            <comment id="15813560" author="codingcat" created="Tue, 10 Jan 2017 02:06:34 +0000"  >&lt;p&gt;eat my words...&lt;/p&gt;

&lt;p&gt;when we have queued up batches, we do need pendingTime, &lt;/p&gt;

&lt;p&gt;and yes, the original description in the JIRA still holds, &lt;/p&gt;</comment>
                            <comment id="15813632" author="codingcat" created="Tue, 10 Jan 2017 02:46:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zsxwing&quot; class=&quot;user-hover&quot; rel=&quot;zsxwing&quot;&gt;zsxwing&lt;/a&gt; If you agree on the conclusion above, I will file a PR&lt;/p&gt;</comment>
                            <comment id="15815815" author="zsxwing" created="Tue, 10 Jan 2017 18:46:25 +0000"  >&lt;p&gt;Sure. Please go ahead.&lt;/p&gt;</comment>
                            <comment id="15816646" author="apachespark" created="Wed, 11 Jan 2017 00:27:04 +0000"  >&lt;p&gt;User &apos;CodingCat&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/16542&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/16542&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16266655" author="apachespark" created="Mon, 27 Nov 2017 11:02:08 +0000"  >&lt;p&gt;User &apos;victor-wong&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/19824&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/19824&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 51 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i37pgv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>