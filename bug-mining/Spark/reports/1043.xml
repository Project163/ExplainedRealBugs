<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:20:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-3721] Broadcast Variables above 2GB break in PySpark</title>
                <link>https://issues.apache.org/jira/browse/SPARK-3721</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;The bug displays 3 unique failure modes in PySpark, all of which seem to be related to broadcast variable size. Note that the tests below ran python 2.7.3 on all machines and used the Spark 1.1.0 binaries.&lt;/p&gt;

&lt;p&gt;*&lt;b&gt;BLOCK 1&lt;/b&gt;* &lt;span class=&quot;error&quot;&gt;&amp;#91;no problem&amp;#93;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;import cPickle
from pyspark import SparkContext

def check_pre_serialized(size):
    msg = cPickle.dumps(range(2 ** size))
    print &apos;serialized length:&apos;, len(msg)
    bvar = sc.broadcast(msg)
    print &apos;length recovered from broadcast variable:&apos;, len(bvar.value)
    print &apos;correct value recovered:&apos;, msg == bvar.value
    bvar.unpersist()    

def check_unserialized(size):
    msg = range(2 ** size)
    bvar = sc.broadcast(msg)
    print &apos;correct value recovered:&apos;, msg == bvar.value
    bvar.unpersist()

SparkContext.setSystemProperty(&apos;spark.executor.memory&apos;, &apos;15g&apos;)
SparkContext.setSystemProperty(&apos;spark.cores.max&apos;, &apos;5&apos;)
sc = SparkContext(&apos;spark://crosby.research.intel-research.net:7077&apos;, &apos;broadcast_bug&apos;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;*&lt;b&gt;BLOCK 2&lt;/b&gt;*  &lt;span class=&quot;error&quot;&gt;&amp;#91;no problem&amp;#93;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;check_pre_serialized(20)
&amp;gt; serialized length: 9374656
&amp;gt; length recovered from broadcast variable: 9374656
&amp;gt; correct value recovered: True
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;*&lt;b&gt;BLOCK 3&lt;/b&gt;*  &lt;span class=&quot;error&quot;&gt;&amp;#91;no problem&amp;#93;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;check_unserialized(20)
&amp;gt; correct value recovered: True
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;*&lt;b&gt;BLOCK 4&lt;/b&gt;*  &lt;span class=&quot;error&quot;&gt;&amp;#91;no problem&amp;#93;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;check_pre_serialized(27)
&amp;gt; serialized length: 1499501632
&amp;gt; length recovered from broadcast variable: 1499501632
&amp;gt; correct value recovered: True
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;*&lt;b&gt;BLOCK 5&lt;/b&gt;*  &lt;span class=&quot;error&quot;&gt;&amp;#91;no problem&amp;#93;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;check_unserialized(27)
&amp;gt; correct value recovered: True
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;*&lt;b&gt;BLOCK 6&lt;/b&gt;*  *&lt;b&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR 1: unhandled error from cPickle.dumps inside sc.broadcast&amp;#93;&lt;/span&gt;&lt;/b&gt;*&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;check_pre_serialized(28)
.....
&amp;gt; /home/spark/greatest/python/pyspark/serializers.py in dumps(self, obj)
&amp;gt;     354
&amp;gt;     355     def dumps(self, obj):
&amp;gt; --&amp;gt; 356         return cPickle.dumps(obj, 2)
&amp;gt;     357
&amp;gt;     358     loads = cPickle.loads
&amp;gt;
&amp;gt; SystemError: error return without exception set
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;*&lt;b&gt;BLOCK 7&lt;/b&gt;*  &lt;span class=&quot;error&quot;&gt;&amp;#91;no problem&amp;#93;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;check_unserialized(28)
&amp;gt; correct value recovered: True
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;*&lt;b&gt;BLOCK 8&lt;/b&gt;*  *&lt;b&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR 2: no error occurs and *incorrect result* is returned&amp;#93;&lt;/span&gt;&lt;/b&gt;*&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;check_pre_serialized(29)
&amp;gt; serialized length: 6331339840
&amp;gt; length recovered from broadcast variable: 2036372544
&amp;gt; correct value recovered: False
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;*&lt;b&gt;BLOCK 9&lt;/b&gt;*  *&lt;b&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR 3: unhandled error from zlib.compress inside sc.broadcast&amp;#93;&lt;/span&gt;&lt;/b&gt;*&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;check_unserialized(29)
......
&amp;gt; /home/spark/greatest/python/pyspark/serializers.py in dumps(self, obj)
&amp;gt;     418 
&amp;gt;     419     def dumps(self, obj):
&amp;gt; --&amp;gt; 420         return zlib.compress(self.serializer.dumps(obj), 1)
&amp;gt;     421 
&amp;gt;     422     def loads(self, obj):
&amp;gt; 
&amp;gt; OverflowError: size does not fit in an int
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;*&lt;b&gt;BLOCK 10&lt;/b&gt;*  &lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR 1&amp;#93;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;check_pre_serialized(30)
...same as above...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;*&lt;b&gt;BLOCK 11&lt;/b&gt;*  &lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR 3&amp;#93;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;check_unserialized(30)
...same as above...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12744704">SPARK-3721</key>
            <summary>Broadcast Variables above 2GB break in PySpark</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davies">Davies Liu</assignee>
                                    <reporter username="bmiller1">Brad Miller</reporter>
                        <labels>
                    </labels>
                <created>Mon, 29 Sep 2014 15:49:39 +0000</created>
                <updated>Wed, 19 Nov 2014 00:18:53 +0000</updated>
                            <resolved>Wed, 19 Nov 2014 00:18:53 +0000</resolved>
                                    <version>1.1.0</version>
                                    <fixVersion>1.2.0</fixVersion>
                                    <component>PySpark</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="14159453" author="davies" created="Sun, 5 Oct 2014 06:29:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bmiller1&quot; class=&quot;user-hover&quot; rel=&quot;bmiller1&quot;&gt;bmiller1&lt;/a&gt; This is an PR for this &lt;a href=&quot;https://github.com/apache/spark/pull/2659&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/2659&lt;/a&gt;, could you help to test it?&lt;/p&gt;</comment>
                            <comment id="14159454" author="apachespark" created="Sun, 5 Oct 2014 06:30:26 +0000"  >&lt;p&gt;User &apos;davies&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/2659&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/2659&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14185189" author="darabos" created="Mon, 27 Oct 2014 14:34:48 +0000"  >&lt;p&gt;We are hitting all kinds of MaxInt and array size limits when broadcasting a 12GB beast from Scala too.&lt;/p&gt;</comment>
                            <comment id="14217109" author="joshrosen" created="Wed, 19 Nov 2014 00:18:53 +0000"  >&lt;p&gt;Issue resolved by pull request 2659&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/2659&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/2659&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i20lcn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>