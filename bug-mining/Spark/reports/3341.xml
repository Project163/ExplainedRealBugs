<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:40:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-14537] [CORE] SparkContext init hangs if master removes application before backend is ready.</title>
                <link>https://issues.apache.org/jira/browse/SPARK-14537</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;During the course of the init of the spark context, the following code is executed.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    setupAndStartListenerBus()
    postEnvironmentUpdate()
    postApplicationStart()

    &lt;span class=&quot;code-comment&quot;&gt;// Post init
&lt;/span&gt;    _taskScheduler.postStartHook()
    _env.metricsSystem.registerSource(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BlockManagerSource(_env.blockManager))
    _executorAllocationManager.foreach { e =&amp;gt;
      _env.metricsSystem.registerSource(e.executorAllocationManagerSource)
    }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;If the _taskScheduler.postStartHook() is waiting for a signal from the backend that it is ready, AND the driver is disconnected from the master scheduler due to a message similar to the one below:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR [sparkDriver-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-20] org.apache.spark.rpc.akka.AkkaRpcEnv - Ignore error: Exiting due to error from cluster scheduler: Master removed our application: FAILED
org.apache.spark.SparkException: Exiting due to error from cluster scheduler: Master removed our application: FAILED
	at org.apache.spark.scheduler.TaskSchedulerImpl.error(TaskSchedulerImpl.scala:431) ~[spark-core_2.10-1.5.2-mmx1.jar:1.5.2-mmx1]
	at org.apache.spark.scheduler.cluster.SparkDeploySchedulerBackend.dead(SparkDeploySchedulerBackend.scala:122) ~[spark-core_2.10-1.5.2-mmx1.jar:1.5.2-mmx1]
	at org.apache.spark.deploy.client.AppClient$ClientEndpoint.markDead(AppClient.scala:243) ~[spark-core_2.10-1.5.2-mmx1.jar:1.5.2-mmx1]
	at org.apache.spark.deploy.client.AppClient$ClientEndpoint$$anonfun$receive$1.applyOrElse(AppClient.scala:167) ~[spark-core_2.10-1.5.2-mmx1.jar:1.5.2-mmx1]
	at org.apache.spark.rpc.akka.AkkaRpcEnv.org$apache$spark$rpc$akka$AkkaRpcEnv$$processMessage(AkkaRpcEnv.scala:177) [spark-core_2.10-1.5.2-mmx1.jar:1.5.2-mmx1]
	at org.apache.spark.rpc.akka.AkkaRpcEnv$$anonfun$actorRef$lzycompute$1$1$$anon$1$$anonfun$receiveWithLogging$1$$anonfun$applyOrElse$4.apply$mcV$sp(AkkaRpcEnv.scala:126) ~[spark-core_2.10-1.5.2-mmx1.jar:1.5.2-mmx1]
	at org.apache.spark.rpc.akka.AkkaRpcEnv.org$apache$spark$rpc$akka$AkkaRpcEnv$$safelyCall(AkkaRpcEnv.scala:197) [spark-core_2.10-1.5.2-mmx1.jar:1.5.2-mmx1]
	at org.apache.spark.rpc.akka.AkkaRpcEnv$$anonfun$actorRef$lzycompute$1$1$$anon$1$$anonfun$receiveWithLogging$1.applyOrElse(AkkaRpcEnv.scala:125) [spark-core_2.10-1.5.2-mmx1.jar:1.5.2-mmx1]
	at scala.runtime.AbstractPartialFunction$mcVL$sp.apply$mcVL$sp(AbstractPartialFunction.scala:33) [scala-library-2.10.5.jar:?]
	at scala.runtime.AbstractPartialFunction$mcVL$sp.apply(AbstractPartialFunction.scala:33) [scala-library-2.10.5.jar:?]
	at scala.runtime.AbstractPartialFunction$mcVL$sp.apply(AbstractPartialFunction.scala:25) [scala-library-2.10.5.jar:?]
	at org.apache.spark.util.ActorLogReceive$$anon$1.apply(ActorLogReceive.scala:59) [spark-core_2.10-1.5.2-mmx1.jar:1.5.2-mmx1]
	at org.apache.spark.util.ActorLogReceive$$anon$1.apply(ActorLogReceive.scala:42) [spark-core_2.10-1.5.2-mmx1.jar:1.5.2-mmx1]
	at scala.PartialFunction$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;applyOrElse(PartialFunction.scala:118) [scala-library-2.10.5.jar:?]
	at org.apache.spark.util.ActorLogReceive$$anon$1.applyOrElse(ActorLogReceive.scala:42) [spark-core_2.10-1.5.2-mmx1.jar:1.5.2-mmx1]
	at akka.actor.Actor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;aroundReceive(Actor.scala:467) [akka-actor_2.10-2.3.11.jar:?]
	at org.apache.spark.rpc.akka.AkkaRpcEnv$$anonfun$actorRef$lzycompute$1$1$$anon$1.aroundReceive(AkkaRpcEnv.scala:92) [spark-core_2.10-1.5.2-mmx1.jar:1.5.2-mmx1]
	at akka.actor.ActorCell.receiveMessage(ActorCell.scala:516) [akka-actor_2.10-2.3.11.jar:?]
	at akka.actor.ActorCell.invoke(ActorCell.scala:487) [akka-actor_2.10-2.3.11.jar:?]
	at akka.dispatch.Mailbox.processMailbox(Mailbox.scala:238) [akka-actor_2.10-2.3.11.jar:?]
	at akka.dispatch.Mailbox.run(Mailbox.scala:220) [akka-actor_2.10-2.3.11.jar:?]
	at akka.dispatch.ForkJoinExecutorConfigurator$AkkaForkJoinTask.exec(AbstractDispatcher.scala:397) [akka-actor_2.10-2.3.11.jar:?]
	at scala.concurrent.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260) [scala-library-2.10.5.jar:?]
	at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1339) [scala-library-2.10.5.jar:?]
	at scala.concurrent.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979) [scala-library-2.10.5.jar:?]
	at scala.concurrent.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107) [scala-library-2.10.5.jar:?]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then the SparkContext will hang on init because the waiting for the backend to be ready never checks to make sure the context is still running:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;TaskSchedulerImpl.scala&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; def waitBackendReady(): Unit = {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (backend.isReady) {
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;
    }
    &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (!backend.isReady) {
      &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; {
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.wait(100)
      }
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Proposed patch is at &lt;a href=&quot;https://github.com/metamx/spark/pull/17/commits/bbb11ba088d30c30d083972ccc556fef0131c3bf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/metamx/spark/pull/17/commits/bbb11ba088d30c30d083972ccc556fef0131c3bf&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ll get a PR going shortly.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12957762">SPARK-14537</key>
            <summary>[CORE] SparkContext init hangs if master removes application before backend is ready.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="drcrallen">Charles R Allen</assignee>
                                    <reporter username="drcrallen">Charles R Allen</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 Apr 2016 16:35:56 +0000</created>
                <updated>Sun, 17 May 2020 17:48:23 +0000</updated>
                            <resolved>Wed, 13 Apr 2016 15:03:05 +0000</resolved>
                                    <version>1.5.2</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>Scheduler</component>
                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15235449" author="apachespark" created="Mon, 11 Apr 2016 16:41:04 +0000"  >&lt;p&gt;User &apos;drcrallen&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/12301&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/12301&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15239376" author="srowen" created="Wed, 13 Apr 2016 15:03:05 +0000"  >&lt;p&gt;Issue resolved by pull request 12301&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/12301&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/12301&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15256071" author="jlaskowski" created="Mon, 25 Apr 2016 08:32:58 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=drcrallen&quot; class=&quot;user-hover&quot; rel=&quot;drcrallen&quot;&gt;drcrallen&lt;/a&gt;, I can&apos;t seem to figure out how this fix is supposed to help.&lt;/p&gt;

&lt;p&gt;The code &lt;tt&gt;_taskScheduler.postStartHook()&lt;/tt&gt; is executed while &lt;tt&gt;SparkContext&lt;/tt&gt; is being initialized. It means that &lt;tt&gt;sc&lt;/tt&gt; is not initialized yet and the thread that is initializing the instance has not finished and so nobody could ever use the instance of &lt;tt&gt;SparkContext&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;If I&apos;m not mistaken, how could anybody call &lt;tt&gt;sc.stop&lt;/tt&gt;? When could &lt;tt&gt;sc.stopped.get&lt;/tt&gt; be &lt;tt&gt;true&lt;/tt&gt;?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 30 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2vxrz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>