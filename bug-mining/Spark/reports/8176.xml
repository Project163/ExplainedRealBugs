<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:27:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-36772] FinalizeShuffleMerge fails with an exception due to attempt id not matching</title>
                <link>https://issues.apache.org/jira/browse/SPARK-36772</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;As part of driver request to external shuffle services (ESS) to finalize the merge, it also passes its &lt;a href=&quot;https://github.com/apache/spark/blob/3f09093a21306b0fbcb132d4c9f285e56ac6b43c/common/network-shuffle/src/main/java/org/apache/spark/network/shuffle/ExternalBlockStoreClient.java#L180&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;application attempt id&lt;/a&gt; so that ESS can validate the request is from the correct attempt.&lt;br/&gt;
This attempt id is fetched from the TransportConf passed in when creating the &lt;a href=&quot;https://github.com/apache/spark/blob/67421d80b8935d91b86e8cd3becb211fa2abd54f/core/src/main/scala/org/apache/spark/SparkEnv.scala#L352&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ExternalBlockStoreClient&lt;/a&gt; - and the transport conf leverages a &lt;a href=&quot;https://github.com/apache/spark/blob/0494dc90af48ce7da0625485a4dc6917a244d580/core/src/main/scala/org/apache/spark/network/netty/SparkTransportConf.scala#L47&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cloned copy&lt;/a&gt; of the SparkConf passed to it.&lt;/p&gt;


&lt;p&gt;Application attempt id is set as part of SparkContext &lt;a href=&quot;https://github.com/apache/spark/blob/67421d80b8935d91b86e8cd3becb211fa2abd54f/core/src/main/scala/org/apache/spark/SparkContext.scala#L586&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;initialization&lt;/a&gt;.&lt;br/&gt;
But this happens after driver SparkEnv has &lt;a href=&quot;https://github.com/apache/spark/blob/67421d80b8935d91b86e8cd3becb211fa2abd54f/core/src/main/scala/org/apache/spark/SparkContext.scala#L460&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;already been created&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Hence the attempt id that ExternalBlockStoreClient uses will always end up being -1 : which will not match the attempt id at ESS (which is based on spark.app.attempt.id) : resulting in merge finalization to always fail (&quot; java.lang.IllegalArgumentException: The attempt id -1 in this FinalizeShuffleMerge message does not match with the current attempt id 1 stored in shuffle service for application ...&quot;)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13401481">SPARK-36772</key>
            <summary>FinalizeShuffleMerge fails with an exception due to attempt id not matching</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zhouyejoe">Ye Zhou</assignee>
                                    <reporter username="mridulm80">Mridul Muralidharan</reporter>
                        <labels>
                    </labels>
                <created>Wed, 15 Sep 2021 23:53:48 +0000</created>
                <updated>Sat, 18 Sep 2021 07:52:45 +0000</updated>
                            <resolved>Sat, 18 Sep 2021 07:52:45 +0000</resolved>
                                    <version>3.2.0</version>
                                    <fixVersion>3.2.0</fixVersion>
                                    <component>Shuffle</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17415803" author="mridulm80" created="Wed, 15 Sep 2021 23:55:18 +0000"  >&lt;p&gt;+CC &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Gengliang.Wang&quot; class=&quot;user-hover&quot; rel=&quot;Gengliang.Wang&quot;&gt;Gengliang.Wang&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Ngone51&quot; class=&quot;user-hover&quot; rel=&quot;Ngone51&quot;&gt;Ngone51&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17415810" author="gengliang.wang" created="Thu, 16 Sep 2021 00:30:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mridulm80&quot; class=&quot;user-hover&quot; rel=&quot;mridulm80&quot;&gt;mridulm80&lt;/a&gt;Thanks for the ping. I will cut RC3 after this one is resolved.&lt;/p&gt;</comment>
                            <comment id="17415879" author="zhouyejoe" created="Thu, 16 Sep 2021 05:36:06 +0000"  >&lt;p&gt;I will work on this one and post PR ASAP.&lt;/p&gt;</comment>
                            <comment id="17415891" author="mridulm80" created="Thu, 16 Sep 2021 05:57:08 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Gengliang.Wang&quot; class=&quot;user-hover&quot; rel=&quot;Gengliang.Wang&quot;&gt;Gengliang.Wang&lt;/a&gt; !&lt;br/&gt;
And thanks for working on the PR &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhouyejoe&quot; class=&quot;user-hover&quot; rel=&quot;zhouyejoe&quot;&gt;zhouyejoe&lt;/a&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17415940" author="apachespark" created="Thu, 16 Sep 2021 07:44:07 +0000"  >&lt;p&gt;User &apos;zhouyejoe&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/34018&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/34018&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17417068" author="gengliang.wang" created="Sat, 18 Sep 2021 07:52:45 +0000"  >&lt;p&gt;Issue resolved by pull request 34018&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/34018&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/34018&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 8 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0uz4o:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12349407">3.2.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>