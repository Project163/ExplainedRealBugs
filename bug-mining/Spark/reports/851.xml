<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:18:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-3889] JVM dies with SIGBUS, resulting in ConnectionManager failed ACK</title>
                <link>https://issues.apache.org/jira/browse/SPARK-3889</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Here&apos;s the first part of the core dump, possibly caused by a job which shuffles a lot of very small partitions.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;#
# A fatal error has been detected by the Java &lt;span class=&quot;code-object&quot;&gt;Runtime&lt;/span&gt; Environment:
#
#  SIGBUS (0x7) at pc=0x00007fa5885fcdb0, pid=488, tid=140343502632704
#
# JRE version: 7.0_25-b30
# Java VM: OpenJDK 64-Bit Server VM (23.7-b01 mixed mode linux-amd64 compressed oops)
# Problematic frame:
# v  ~StubRoutines::jbyte_disjoint_arraycopy
#
# Failed to write core dump. Core dumps have been disabled. To enable core dumping, &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;ulimit -c unlimited&quot;&lt;/span&gt; before starting Java again
#
# If you would like to submit a bug report, please include
# instructions on how to reproduce the bug and visit:
#   https:&lt;span class=&quot;code-comment&quot;&gt;//bugs.launchpad.net/ubuntu/+source/openjdk-7/
&lt;/span&gt;#

---------------  T H R E A D  ---------------

Current thread (0x00007fa4b0631000):  JavaThread &lt;span class=&quot;code-quote&quot;&gt;&quot;Executor task launch worker-170&quot;&lt;/span&gt; daemon [_thread_in_Java, id=6783, stack(0x00007fa4448ef000,0x00007fa4449f0000)]

siginfo:si_signo=SIGBUS: si_errno=0, si_code=2 (BUS_ADRERR), si_addr=0x00007fa428f79000
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here is the only useful content I can find related to JVM and SIGBUS from Google: &lt;a href=&quot;https://bugzilla.redhat.com/show_bug.cgi?format=multiple&amp;amp;id=976664&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://bugzilla.redhat.com/show_bug.cgi?format=multiple&amp;amp;id=976664&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It appears it may be related to disposing byte buffers, which we do in the ConnectionManager &amp;#8211; we mmap shuffle files via ManagedBuffer and dispose of them in BufferMessage.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12747167">SPARK-3889</key>
            <summary>JVM dies with SIGBUS, resulting in ConnectionManager failed ACK</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ilikerps">Aaron Davidson</assignee>
                                    <reporter username="ilikerps">Aaron Davidson</reporter>
                        <labels>
                    </labels>
                <created>Fri, 10 Oct 2014 00:50:38 +0000</created>
                <updated>Sun, 1 Mar 2015 06:58:57 +0000</updated>
                            <resolved>Fri, 10 Oct 2014 08:44:51 +0000</resolved>
                                    <version>1.2.0</version>
                                    <fixVersion>1.2.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14167303" author="mridulm80" created="Fri, 10 Oct 2014 18:57:32 +0000"  >&lt;p&gt;The status says fixed - what was done to resolve this ? I did not see a PR ...&lt;/p&gt;</comment>
                            <comment id="14167647" author="ilikerps" created="Fri, 10 Oct 2014 22:14:53 +0000"  >&lt;p&gt;Sorry, it was not linked: &lt;a href=&quot;https://github.com/apache/spark/pull/2742&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/2742&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14177410" author="fryz" created="Mon, 20 Oct 2014 20:10:29 +0000"  >&lt;p&gt;Any chance of getting this backported to 1.1.1? &lt;br/&gt;
If not, what about the possibility of investigation another fix for 1.1.1? &lt;/p&gt;

&lt;p&gt;Its a pretty big bummer that this just causes the JVM to crash, and I was wondering if this is something that would be considered for backport. &lt;/p&gt;

</comment>
                            <comment id="14177925" author="pwendell" created="Tue, 21 Oct 2014 04:25:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fryz&quot; class=&quot;user-hover&quot; rel=&quot;fryz&quot;&gt;fryz&lt;/a&gt; I think the relevant code path here did not exist in Spark 1.1, so this can&apos;t be backported. Have you observed SIGBUS errors in Spark 1.1?&lt;/p&gt;</comment>
                            <comment id="14313544" author="idanzalz" created="Tue, 10 Feb 2015 04:33:59 +0000"  >&lt;p&gt;I actually got this error on 1.1:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; #
 # A fatal error has been detected by the Java Runtime Environment:
 #
 #  SIGBUS (0x7) at pc=0x00007f8c7d0420a0, pid=57386, tid=140240086370048
 #
 # JRE version: Java(TM) SE Runtime Environment (7.0_55-b13) (build 1.7.0_55-b13)
 # Java VM: Java HotSpot(TM) 64-Bit Server VM (24.55-b03 mixed mode linux-amd64 compressed oops)
 # Problematic frame:
 # v  ~StubRoutines::jshort_disjoint_arraycopy
 #
 # Failed to write core dump. Core dumps have been disabled. To enable core dumping, try &quot;ulimit -c unlimited&quot; before starting Java again
 #
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14314651" author="ilikerps" created="Tue, 10 Feb 2015 18:51:51 +0000"  >&lt;p&gt;The only place we memory map in 1.1 is this method: &lt;a href=&quot;https://github.com/apache/spark/blob/branch-1.1/core/src/main/scala/org/apache/spark/storage/DiskStore.scala#L106&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/branch-1.1/core/src/main/scala/org/apache/spark/storage/DiskStore.scala#L106&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This threshold is configurable with &quot;spark.storage.memoryMapThreshold&quot; &amp;#8211; we upped the default from 2 KB to 2 MB in 1.2, which you could try here as well.&lt;/p&gt;</comment>
                            <comment id="14341922" author="idanzalz" created="Sun, 1 Mar 2015 04:04:58 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
I am still getting the same error with spark 1.2.1 (sporadically):&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;#
# A fatal error has been detected by the Java Runtime Environment:
# 
#  SIGBUS (0x7) at pc=0x00007ff5ed042220, pid=3694, tid=140692916811520
#
# JRE version: Java(TM) SE Runtime Environment (7.0_55-b13) (build 1.7.0_55-b13)
# Java VM: Java HotSpot(TM) 64-Bit Server VM (24.55-b03 mixed mode linux-amd64 compressed oops)
# Problematic frame:
# v  ~StubRoutines::jint_disjoint_arraycopy
#
# Failed to write core dump. Core dumps have been disabled. To enable core dumping, try &quot;ulimit -c unlimited&quot; before starting Java again
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Should we re-open this one, or open a new ticket?&lt;/p&gt;</comment>
                            <comment id="14341962" author="ilikerps" created="Sun, 1 Mar 2015 06:13:56 +0000"  >&lt;p&gt;This may be a new issue. I would open a new ticket, especially because the &quot;ConnectionManager failed ACK&quot; thing shouldn&apos;t be happening in 1.2.1; there should be different symptoms and perhaps a different cause as well.&lt;/p&gt;

&lt;p&gt;A last ditch thing to try, by the way, is to up spark.storage.memoryMapThreshold to a very large number (e.g., 1 GB in bytes) and see if it still occurs &amp;#8211; if so, then please report more details about your workload and any other possible symptoms you see.&lt;/p&gt;</comment>
                            <comment id="14341997" author="mridulm80" created="Sun, 1 Mar 2015 06:58:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adav&quot; class=&quot;user-hover&quot; rel=&quot;adav&quot;&gt;adav&lt;/a&gt; I have seen this a lot in my recent tests with the latest 1.3 and with the stable 1.2.1 version.&lt;br/&gt;
Though usually the reasons are legitimate upon investigation - like remote side died via SIGTERM from yarn, etc.&lt;/p&gt;

&lt;p&gt;So would be good to know if this happened legitimately or due to some other bug/issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 38 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i210f3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>