<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:12:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-1210] Prevent ContextClassLoader of Actor from becoming ClassLoader of Executor</title>
                <link>https://issues.apache.org/jira/browse/SPARK-1210</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Constructor of &lt;tt&gt;org.apache.spark.executor.Executor&lt;/tt&gt; should not set context class loader of current thread, which is backend Actor&apos;s thread.&lt;/p&gt;

&lt;p&gt;Run the following code in local-mode REPL.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;scala&amp;gt; case class Foo(i: Int)&lt;br/&gt;
scala&amp;gt; val ret = sc.parallelize((1 to 100).map(Foo), 10).collect&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This causes errors as follows:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;ERROR actor.OneForOneStrategy: [L$line5.$read$$iwC$$iwC$$iwC$$iwC$Foo;&lt;br/&gt;
java.lang.ArrayStoreException: [L$line5.$read$$iwC$$iwC$$iwC$$iwC$Foo;&lt;br/&gt;
     at scala.runtime.ScalaRunTime$.array_update(ScalaRunTime.scala:88)&lt;br/&gt;
     at org.apache.spark.SparkContext$$anonfun$runJob$3.apply(SparkContext.scala:870)&lt;br/&gt;
     at org.apache.spark.SparkContext$$anonfun$runJob$3.apply(SparkContext.scala:870)&lt;br/&gt;
     at org.apache.spark.scheduler.JobWaiter.taskSucceeded(JobWaiter.scala:56)&lt;br/&gt;
     at org.apache.spark.scheduler.DAGScheduler.handleTaskCompletion(DAGScheduler.scala:859)&lt;br/&gt;
     at org.apache.spark.scheduler.DAGScheduler.processEvent(DAGScheduler.scala:616)&lt;br/&gt;
     at org.apache.spark.scheduler.DAGScheduler$$anonfun$start$1$$anon$2$$anonfun$receive$1.applyOrElse(DAGScheduler.scala:207)&lt;br/&gt;
     at akka.actor.ActorCell.receiveMessage(ActorCell.scala:498)&lt;br/&gt;
     at akka.actor.ActorCell.invoke(ActorCell.scala:456)&lt;br/&gt;
     at akka.dispatch.Mailbox.processMailbox(Mailbox.scala:237)&lt;br/&gt;
     at akka.dispatch.Mailbox.run(Mailbox.scala:219)&lt;br/&gt;
     at akka.dispatch.ForkJoinExecutorConfigurator$AkkaForkJoinTask.exec(AbstractDispatcher.scala:386)&lt;br/&gt;
     at scala.concurrent.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260)&lt;br/&gt;
     at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1339)&lt;br/&gt;
     at scala.concurrent.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979)&lt;br/&gt;
     at scala.concurrent.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is because the class loaders to deserialize result &lt;tt&gt;Foo&lt;/tt&gt; instances might be different from backend Actor&apos;s, and the Actor&apos;s class loader should be the same as Driver&apos;s.&lt;/p&gt;

&lt;p&gt;See PR: &lt;a href=&quot;https://github.com/apache/spark/pull/15&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/15&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12704906">SPARK-1210</key>
            <summary>Prevent ContextClassLoader of Actor from becoming ClassLoader of Executor</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ueshin">Takuya Ueshin</assignee>
                                    <reporter username="ueshin">Takuya Ueshin</reporter>
                        <labels>
                    </labels>
                <created>Mon, 10 Mar 2014 01:34:36 +0000</created>
                <updated>Fri, 28 Mar 2014 10:32:05 +0000</updated>
                            <resolved>Thu, 27 Mar 2014 22:18:09 +0000</resolved>
                                    <version>0.9.0</version>
                                    <fixVersion>1.0.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13954207" author="patrick" created="Wed, 26 Mar 2014 10:28:54 +0000"  >&lt;p&gt;[edited from an earlier comment]&lt;/p&gt;

&lt;p&gt;Just to clarify there are two different issues going on here. One is that the classloader used in the executors is not set-up to correctly delegate to the active classloader in the thread that created it. Instead it delegates to the class loader of the class that defines Executor.scala. This is incorrect delegation and results in a problem where, when running in local mode, the Executor things there isn&apos;t an existing definition of a case class defined in the repl (e.g. Foo) and it goes and gets one over the HTTP served and ends up with a technically different definition of Foo. When that ends up back in the driver code it thinks the types are different and freaks out.&lt;/p&gt;

&lt;p&gt;A second issue is that there is code that, when the executor is created, sets the ClassLoader of  the thread in which the Executor is created. This is not actually needed because user classes can only be created/referenced inside of the run() method of a TaskRunner. Also in some cases, such as when an Executor is created inside of an Actor with multiple threads, this leads to an inconstent state amongst threads in which executor code is executed. This can have bad consequences when the Executor and the DAGScheduler are sharing an ActorSystem because the DAGScheduler&apos;s classloader can get redefined. The code was added here:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/commit/b864c36a#diff-40f975518e47d34cc8ecd7a49440228dR50&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/commit/b864c36a#diff-40f975518e47d34cc8ecd7a49440228dR50&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13954221" author="patrick" created="Thu, 27 Mar 2014 22:19:21 +0000"  >&lt;p&gt;I merged this into master. This might be worth back porting into 0.9 at some point.&lt;/p&gt;</comment>
                            <comment id="13954231" author="patrick" created="Fri, 28 Mar 2014 10:32:05 +0000"  >&lt;p&gt;I&apos;ve created &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-1346&quot; title=&quot;Backport SPARK-1210 into 0.9 branch&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-1346&quot;&gt;&lt;del&gt;SPARK-1346&lt;/del&gt;&lt;/a&gt; to track back-porting this into 0.9.2&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12704612">SPARK-1152</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12704515">SPARK-1346</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>382874</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 34 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1tynj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>383142</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>