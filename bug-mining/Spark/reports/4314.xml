<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:49:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-18274] Memory leak in PySpark StringIndexer</title>
                <link>https://issues.apache.org/jira/browse/SPARK-18274</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;StringIndexerModel won&apos;t get collected by GC in Java even when deleted in Python. It can be reproduced by this code, which fails after couple of iterations (around 7 if you set driver memory to 600MB): &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; random, string
from pyspark.ml.feature &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; StringIndexer

l = [(&apos;&apos;.join(random.choice(string.ascii_uppercase) &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; _ in range(10)), ) &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; _ in range(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;(7e5))]  # 700000 random strings of 10 characters
df = spark.createDataFrame(l, [&lt;span class=&quot;code-quote&quot;&gt;&apos;string&apos;&lt;/span&gt;])

&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; i in range(50):
    indexer = StringIndexer(inputCol=&lt;span class=&quot;code-quote&quot;&gt;&apos;string&apos;&lt;/span&gt;, outputCol=&lt;span class=&quot;code-quote&quot;&gt;&apos;index&apos;&lt;/span&gt;)
    indexer.fit(df)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Explicit call to Python GC fixes the issue - following code runs fine:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; i in range(50):
    indexer = StringIndexer(inputCol=&lt;span class=&quot;code-quote&quot;&gt;&apos;string&apos;&lt;/span&gt;, outputCol=&lt;span class=&quot;code-quote&quot;&gt;&apos;index&apos;&lt;/span&gt;)
    indexer.fit(df)
    gc.collect()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The issue is similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-6194&quot; title=&quot;collect() in PySpark will cause memory leak in JVM&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-6194&quot;&gt;&lt;del&gt;SPARK-6194&lt;/del&gt;&lt;/a&gt; and can be probably fixed by calling jvm detach in model&apos;s destructor. This is implemented in pyspark.mlib.common.JavaModelWrapper but missing in pyspark.ml.wrapper.JavaWrapper. Other models in ml package may also be affected by this memory leak. &lt;/p&gt;</description>
                <environment></environment>
        <key id="13018145">SPARK-18274</key>
            <summary>Memory leak in PySpark StringIndexer</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="techaddict">Sandeep Singh</assignee>
                                    <reporter username="jonasamrich">Jonas Amrich</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 Nov 2016 15:31:43 +0000</created>
                <updated>Thu, 8 Dec 2016 07:29:12 +0000</updated>
                            <resolved>Thu, 1 Dec 2016 21:23:35 +0000</resolved>
                                    <version>1.5.2</version>
                    <version>1.6.3</version>
                    <version>2.0.1</version>
                    <version>2.0.2</version>
                    <version>2.1.0</version>
                                    <fixVersion>2.0.3</fixVersion>
                    <fixVersion>2.1.0</fixVersion>
                    <fixVersion>2.2.0</fixVersion>
                                    <component>ML</component>
                    <component>PySpark</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15654461" author="apachespark" created="Thu, 10 Nov 2016 16:25:06 +0000"  >&lt;p&gt;User &apos;techaddict&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/15843&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/15843&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15656431" author="josephkb" created="Fri, 11 Nov 2016 07:48:37 +0000"  >&lt;p&gt;Adding one more TODO for this task:&lt;br/&gt;
The current fix for this is to put a &lt;tt&gt;_&lt;em&gt;del&lt;/em&gt;_&lt;/tt&gt; method in JavaWrapper which releases the Java object.  But that exposes another bug: copy should be implemented within JavaParams, not JavaModel.  Otherwise, JavaEvaluator (which inherits from JavaParams) can be copied to produce multiple Python instances (which should be treated independently) all of which link to the same Java object.  Changing one instance will then change others.&lt;/p&gt;</comment>
                            <comment id="15713122" author="josephkb" created="Thu, 1 Dec 2016 21:23:35 +0000"  >&lt;p&gt;Issue resolved by pull request 15843&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/15843&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/15843&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15731418" author="mlnick" created="Thu, 8 Dec 2016 07:29:12 +0000"  >&lt;p&gt;Went ahead and re-marked fix version to &lt;tt&gt;2.1.0&lt;/tt&gt; since RC2 has been cut.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13024176">SPARK-18630</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 49 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i35vwv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311620" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Shepherd</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>josephkb</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12338608">2.0.3</customfieldvalue>
    <customfieldvalue id="12335644">2.1.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>