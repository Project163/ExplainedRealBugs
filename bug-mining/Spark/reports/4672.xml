<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:52:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-19980] Basic Dataset transformation on POJOs does not preserves nulls.</title>
                <link>https://issues.apache.org/jira/browse/SPARK-19980</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Applying an identity map transformation on a statically typed Dataset with a POJO produces an unexpected result.&lt;/p&gt;

&lt;p&gt;Given POJOs:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Stuff &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; Serializable {
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setName(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name) { &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.name = name; }
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getName() { &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; name; }
}

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Outer &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; Serializable {
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; Stuff stuff;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setName(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name) { &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.name = name; }
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getName() { &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; name; }
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setStuff(Stuff stuff) { &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.stuff = stuff; }
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Stuff getStuff() { &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; stuff; }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Produces the result:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;scala&amp;gt; val encoder = Encoders.bean(classOf[Outer])
encoder: org.apache.spark.sql.Encoder[pojos.Outer] = &lt;span class=&quot;code-keyword&quot;&gt;class[&lt;/span&gt;name[0]: string, stuff[0]: struct&amp;lt;name:string&amp;gt;]

scala&amp;gt; val schema = encoder.schema
schema: org.apache.spark.sql.types.StructType = StructType(StructField(name,StringType,&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;), StructField(stuff,StructType(StructField(name,StringType,&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)),&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;))

scala&amp;gt; schema.printTreeString
root
 |-- name: string (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- stuff: struct (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |    |-- name: string (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)


scala&amp;gt; val df = spark.read.schema(schema).json(&lt;span class=&quot;code-quote&quot;&gt;&quot;stuff.json&quot;&lt;/span&gt;).as[Outer](encoder)
df: org.apache.spark.sql.Dataset[pojos.Outer] = [name: string, stuff: struct&amp;lt;name: string&amp;gt;]

scala&amp;gt; df.show()
+----+-----+
|name|stuff|
+----+-----+
|  v1| &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;|
+----+-----+

scala&amp;gt; df.map(x =&amp;gt; x)(encoder).show()
+----+------+
|name| stuff|
+----+------+
|  v1|[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;]|
+----+------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After identity transformation, `stuff` becomes an object with null values inside it instead of staying null itself.&lt;/p&gt;

&lt;p&gt;Doing the same with case classes preserves the nulls:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;scala&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ScalaStuff(name: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;)
defined &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ScalaStuff

scala&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ScalaOuter(name: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, stuff: ScalaStuff)
defined &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ScalaOuter

scala&amp;gt; val encoder2 = Encoders.product[ScalaOuter]
encoder2: org.apache.spark.sql.Encoder[ScalaOuter] = &lt;span class=&quot;code-keyword&quot;&gt;class[&lt;/span&gt;name[0]: string, stuff[0]: struct&amp;lt;name:string&amp;gt;]

scala&amp;gt; val schema2 = encoder2.schema
schema2: org.apache.spark.sql.types.StructType = StructType(StructField(name,StringType,&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;), StructField(stuff,StructType(StructField(name,StringType,&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)),&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;))

scala&amp;gt; schema2.printTreeString
root
 |-- name: string (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- stuff: struct (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |    |-- name: string (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)


scala&amp;gt;

scala&amp;gt; val df2 = spark.read.schema(schema2).json(&lt;span class=&quot;code-quote&quot;&gt;&quot;stuff.json&quot;&lt;/span&gt;).as[ScalaOuter]
df2: org.apache.spark.sql.Dataset[ScalaOuter] = [name: string, stuff: struct&amp;lt;name: string&amp;gt;]

scala&amp;gt; df2.show()
+----+-----+
|name|stuff|
+----+-----+
|  v1| &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;|
+----+-----+


scala&amp;gt; df2.map(x =&amp;gt; x).show()
+----+-----+
|name|stuff|
+----+-----+
|  v1| &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;|
+----+-----+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;stuff.json:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;{&lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;v1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;stuff&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13056695">SPARK-19980</key>
            <summary>Basic Dataset transformation on POJOs does not preserves nulls.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="maropu">Takeshi Yamamuro</assignee>
                                    <reporter username="FlamingMike">Michel Lemay</reporter>
                        <labels>
                    </labels>
                <created>Thu, 16 Mar 2017 15:24:05 +0000</created>
                <updated>Wed, 22 Mar 2017 00:38:56 +0000</updated>
                            <resolved>Tue, 21 Mar 2017 03:33:14 +0000</resolved>
                                    <version>2.1.0</version>
                                    <fixVersion>2.1.1</fixVersion>
                    <fixVersion>2.2.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15931650" author="apachespark" created="Sun, 19 Mar 2017 11:37:02 +0000"  >&lt;p&gt;User &apos;maropu&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/17347&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/17347&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15934238" author="apachespark" created="Tue, 21 Mar 2017 08:16:05 +0000"  >&lt;p&gt;User &apos;maropu&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/17372&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/17372&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 35 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3cdfz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>