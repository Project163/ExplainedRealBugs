<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:36:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-12218] Invalid splitting of nested AND expressions in Data Source filter API</title>
                <link>https://issues.apache.org/jira/browse/SPARK-12218</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Two identical queries produce different results&lt;/p&gt;


&lt;p&gt;In &lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;: sqlContext.read.parquet(&apos;prp_enh1&apos;).where(&quot; LoanID=62231 and not( PaymentsReceived=0 and ExplicitRoll in (&apos;PreviouslyPaidOff&apos;, &apos;PreviouslyChargedOff&apos;))&quot;).count()&lt;/p&gt;

&lt;p&gt;Out&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;: 18&lt;/p&gt;

&lt;p&gt;In &lt;span class=&quot;error&quot;&gt;&amp;#91;3&amp;#93;&lt;/span&gt;: sqlContext.read.parquet(&apos;prp_enh1&apos;).where(&quot; LoanID=62231 and ( not(PaymentsReceived=0) or not (ExplicitRoll in (&apos;PreviouslyPaidOff&apos;, &apos;PreviouslyChargedOff&apos;)))&quot;).count()&lt;br/&gt;
Out&lt;span class=&quot;error&quot;&gt;&amp;#91;3&amp;#93;&lt;/span&gt;: 28&lt;/p&gt;</description>
                <environment></environment>
        <key id="12920210">SPARK-12218</key>
            <summary>Invalid splitting of nested AND expressions in Data Source filter API</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yhuai">Yin Huai</assignee>
                                    <reporter username="imachabeli">Irakli Machabeli</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Dec 2015 22:04:54 +0000</created>
                <updated>Mon, 12 Dec 2022 18:10:59 +0000</updated>
                            <resolved>Fri, 18 Dec 2015 18:56:05 +0000</resolved>
                                    <version>1.5.2</version>
                                    <fixVersion>1.5.3</fixVersion>
                    <fixVersion>1.6.0</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="15047928" author="smilegator" created="Wed, 9 Dec 2015 02:57:13 +0000"  >&lt;p&gt;Could you provide the plan by explain(true)? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=imachabeli&quot; class=&quot;user-hover&quot; rel=&quot;imachabeli&quot;&gt;imachabeli&lt;/a&gt; Thanks!&lt;/p&gt;</comment>
                            <comment id="15048256" author="smilegator" created="Wed, 9 Dec 2015 08:08:32 +0000"  >&lt;p&gt;That is what I did in my environment. &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    val df1 = Seq(1, 2, 3).map(i =&amp;gt; (i, i, i.toString)).toDF(&lt;span class=&quot;code-quote&quot;&gt;&quot;int1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;int2&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;str&quot;&lt;/span&gt;)
    df1.where(&lt;span class=&quot;code-quote&quot;&gt;&quot;not (int1=0 and int2=0)&quot;&lt;/span&gt;).explain(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
    df1.where(&lt;span class=&quot;code-quote&quot;&gt;&quot;not(int1=0) or not(int2=0)&quot;&lt;/span&gt;).explain(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Their physical plans are exactly the same. &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;== Parsed Logical Plan ==
&lt;span class=&quot;code-quote&quot;&gt;&apos;Filter NOT ((&apos;&lt;/span&gt;int1 = 0) &amp;amp;&amp;amp; (&apos;int2 = 0))
+- Project [_1#0 AS int1#3,_2#1 AS int2#4,_3#2 AS str#5]
   +- LocalRelation [_1#0,_2#1,_3#2], [[1,1,1],[2,2,2],[3,3,3]]

== Analyzed Logical Plan ==
int1: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, int2: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, str: string
Filter NOT ((int1#3 = 0) &amp;amp;&amp;amp; (int2#4 = 0))
+- Project [_1#0 AS int1#3,_2#1 AS int2#4,_3#2 AS str#5]
   +- LocalRelation [_1#0,_2#1,_3#2], [[1,1,1],[2,2,2],[3,3,3]]

== Optimized Logical Plan ==
Project [_1#0 AS int1#3,_2#1 AS int2#4,_3#2 AS str#5]
+- Filter (NOT (_1#0 = 0) || NOT (_2#1 = 0))
   +- LocalRelation [_1#0,_2#1,_3#2], [[1,1,1],[2,2,2],[3,3,3]]

== Physical Plan ==
Project [_1#0 AS int1#3,_2#1 AS int2#4,_3#2 AS str#5]
+- Filter (NOT (_1#0 = 0) || NOT (_2#1 = 0))
   +- LocalTableScan [_1#0,_2#1,_3#2], [[1,1,1],[2,2,2],[3,3,3]]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;== Parsed Logical Plan ==
&lt;span class=&quot;code-quote&quot;&gt;&apos;Filter (NOT (&apos;&lt;/span&gt;int1 = 0) || NOT (&apos;int2 = 0))
+- Project [_1#0 AS int1#3,_2#1 AS int2#4,_3#2 AS str#5]
   +- LocalRelation [_1#0,_2#1,_3#2], [[1,1,1],[2,2,2],[3,3,3]]

== Analyzed Logical Plan ==
int1: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, int2: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, str: string
Filter (NOT (int1#3 = 0) || NOT (int2#4 = 0))
+- Project [_1#0 AS int1#3,_2#1 AS int2#4,_3#2 AS str#5]
   +- LocalRelation [_1#0,_2#1,_3#2], [[1,1,1],[2,2,2],[3,3,3]]

== Optimized Logical Plan ==
Project [_1#0 AS int1#3,_2#1 AS int2#4,_3#2 AS str#5]
+- Filter (NOT (_1#0 = 0) || NOT (_2#1 = 0))
   +- LocalRelation [_1#0,_2#1,_3#2], [[1,1,1],[2,2,2],[3,3,3]]

== Physical Plan ==
Project [_1#0 AS int1#3,_2#1 AS int2#4,_3#2 AS str#5]
+- Filter (NOT (_1#0 = 0) || NOT (_2#1 = 0))
   +- LocalTableScan [_1#0,_2#1,_3#2], [[1,1,1],[2,2,2],[3,3,3]]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15048619" author="imachabeli" created="Wed, 9 Dec 2015 12:46:40 +0000"  >&lt;p&gt;Below is the explain plan.&lt;br/&gt;
To make it clear, query that contains not (A and B) :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;and not( PaymentsReceived=0 and ExplicitRoll in (&lt;span class=&quot;code-quote&quot;&gt;&apos;PreviouslyPaidOff&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;PreviouslyChargedOff&apos;&lt;/span&gt;))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;	
&lt;p&gt;produces wrong results, &lt;br/&gt;
and query that is already expanded as (not A) or (not B) produces correct output.&lt;/p&gt;



&lt;p&gt;Physical plan look like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;wrong results-- Filter ((LoanID#8629 = 62231) &amp;amp;&amp;amp; NOT ((PaymentsReceived#8642 = 0.0) &amp;amp;&amp;amp; ExplicitRoll#8652 IN (PreviouslyPaidOff,PreviouslyChargedOff)))
correct results -- Filter ((LoanID#8803 = 62231) &amp;amp;&amp;amp; (NOT (PaymentsReceived#8816 = 0.0) || NOT ExplicitRoll#8826 IN (PreviouslyPaidOff,PreviouslyChargedOff)))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Explain plan results: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Wrong:
In [15]: sqlContext.read.parquet(&lt;span class=&quot;code-quote&quot;&gt;&apos;prp_enh1&apos;&lt;/span&gt;).where(&lt;span class=&quot;code-quote&quot;&gt;&quot; LoanID=62231 and not( PaymentsReceived=0.0 and ExplicitRoll in (&lt;span class=&quot;code-quote&quot;&gt;&apos;PreviouslyPaidOff&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;PreviouslyChargedOff&apos;&lt;/span&gt;))&quot;&lt;/span&gt;).explain(True)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;== Parsed Logical Plan ==
&apos;Filter ((&apos;LoanID = 62231) &amp;amp;&amp;amp; NOT ((&apos;PaymentsReceived = 0.0) &amp;amp;&amp;amp; &apos;ExplicitRoll IN (PreviouslyPaidOff,PreviouslyChargedOff)))
 Relation[BorrowerRate#8625,MnthRate#8626,ObservationMonth#8627,CycleCounter#8628,LoanID#8629,Loankey#8630,OriginationDate#8631,OriginationQuarter#8632,LoanAmount#8633,Term#8634,LenderRate#8635,ProsperRating#8636,ScheduledMonthlyPaymentAmount#8637,ChargeoffMonth#8638,ChargeoffAmount#8639,CompletedMonth#8640,MonthOfLastPayment#8641,PaymentsReceived#8642,CollectionFees#8643,PrincipalPaid#8644,InterestPaid#8645,LateFees#8646,ServicingFees#8647,RecoveryPayments#8648,RecoveryPrin#8649,DaysPastDue#8650,PriorMonthDPD#8651,ExplicitRoll#8652,SummaryRoll#8653,CumulPrin#8654,EOMPrin#8655,ScheduledPrinRemaining#8656,ScheduledCumulPrin#8657,ScheduledPeriodicPrin#8658,BOMPrin#8659,ListingNumber#8660,DebtSaleMonth#8661,GrossCashFromDebtSale#8662,DebtSaleFee#8663,NetCashToInvestorsFromDebtSale#8664,OZVintage#8665] ParquetRelation[file:/d:/MktLending/prp_enh1]

== Analyzed Logical Plan ==
BorrowerRate: double, MnthRate: double, ObservationMonth: date, CycleCounter: int, LoanID: int, Loankey: string, OriginationDate: date, OriginationQuarter: string, LoanAmount: double, Term: int, LenderRate: double, ProsperRating: string, ScheduledMonthlyPaymentAmount: double, ChargeoffMonth: date, ChargeoffAmount: double, CompletedMonth: date, MonthOfLastPayment: date, PaymentsReceived: double, CollectionFees: double, PrincipalPaid: double, InterestPaid: double, LateFees: double, ServicingFees: double, RecoveryPayments: double, RecoveryPrin: double, DaysPastDue: int, PriorMonthDPD: int, ExplicitRoll: string, SummaryRoll: string, CumulPrin: double, EOMPrin: double, ScheduledPrinRemaining: double, ScheduledCumulPrin: double, ScheduledPeriodicPrin: double, BOMPrin: double, ListingNumber: int, DebtSaleMonth: int, GrossCashFromDebtSale: double, DebtSaleFee: double, NetCashToInvestorsFromDebtSale: double, OZVintage: string
Filter ((LoanID#8629 = 62231) &amp;amp;&amp;amp; NOT ((PaymentsReceived#8642 = cast(0.0 as double)) &amp;amp;&amp;amp; ExplicitRoll#8652 IN (PreviouslyPaidOff,PreviouslyChargedOff)))
 Relation[BorrowerRate#8625,MnthRate#8626,ObservationMonth#8627,CycleCounter#8628,LoanID#8629,Loankey#8630,OriginationDate#8631,OriginationQuarter#8632,LoanAmount#8633,Term#8634,LenderRate#8635,ProsperRating#8636,ScheduledMonthlyPaymentAmount#8637,ChargeoffMonth#8638,ChargeoffAmount#8639,CompletedMonth#8640,MonthOfLastPayment#8641,PaymentsReceived#8642,CollectionFees#8643,PrincipalPaid#8644,InterestPaid#8645,LateFees#8646,ServicingFees#8647,RecoveryPayments#8648,RecoveryPrin#8649,DaysPastDue#8650,PriorMonthDPD#8651,ExplicitRoll#8652,SummaryRoll#8653,CumulPrin#8654,EOMPrin#8655,ScheduledPrinRemaining#8656,ScheduledCumulPrin#8657,ScheduledPeriodicPrin#8658,BOMPrin#8659,ListingNumber#8660,DebtSaleMonth#8661,GrossCashFromDebtSale#8662,DebtSaleFee#8663,NetCashToInvestorsFromDebtSale#8664,OZVintage#8665] ParquetRelation[file:/d:/MktLending/prp_enh1]

== Optimized Logical Plan ==
Filter ((LoanID#8629 = 62231) &amp;amp;&amp;amp; NOT ((PaymentsReceived#8642 = 0.0) &amp;amp;&amp;amp; ExplicitRoll#8652 IN (PreviouslyPaidOff,PreviouslyChargedOff)))
 Relation[BorrowerRate#8625,MnthRate#8626,ObservationMonth#8627,CycleCounter#8628,LoanID#8629,Loankey#8630,OriginationDate#8631,OriginationQuarter#8632,LoanAmount#8633,Term#8634,LenderRate#8635,ProsperRating#8636,ScheduledMonthlyPaymentAmount#8637,ChargeoffMonth#8638,ChargeoffAmount#8639,CompletedMonth#8640,MonthOfLastPayment#8641,PaymentsReceived#8642,CollectionFees#8643,PrincipalPaid#8644,InterestPaid#8645,LateFees#8646,ServicingFees#8647,RecoveryPayments#8648,RecoveryPrin#8649,DaysPastDue#8650,PriorMonthDPD#8651,ExplicitRoll#8652,SummaryRoll#8653,CumulPrin#8654,EOMPrin#8655,ScheduledPrinRemaining#8656,ScheduledCumulPrin#8657,ScheduledPeriodicPrin#8658,BOMPrin#8659,ListingNumber#8660,DebtSaleMonth#8661,GrossCashFromDebtSale#8662,DebtSaleFee#8663,NetCashToInvestorsFromDebtSale#8664,OZVintage#8665] ParquetRelation[file:/d:/MktLending/prp_enh1]

== Physical Plan ==
Filter ((LoanID#8629 = 62231) &amp;amp;&amp;amp; NOT ((PaymentsReceived#8642 = 0.0) &amp;amp;&amp;amp; ExplicitRoll#8652 IN (PreviouslyPaidOff,PreviouslyChargedOff)))
 Scan ParquetRelation[file:/d:/MktLending/prp_enh1][BorrowerRate#8625,MnthRate#8626,ObservationMonth#8627,CycleCounter#8628,LoanID#8629,Loankey#8630,OriginationDate#8631,OriginationQuarter#8632,LoanAmount#8633,Term#8634,LenderRate#8635,ProsperRating#8636,ScheduledMonthlyPaymentAmount#8637,ChargeoffMonth#8638,ChargeoffAmount#8639,CompletedMonth#8640,MonthOfLastPayment#8641,PaymentsReceived#8642,CollectionFees#8643,PrincipalPaid#8644,InterestPaid#8645,LateFees#8646,ServicingFees#8647,RecoveryPayments#8648,RecoveryPrin#8649,DaysPastDue#8650,PriorMonthDPD#8651,ExplicitRoll#8652,SummaryRoll#8653,CumulPrin#8654,EOMPrin#8655,ScheduledPrinRemaining#8656,ScheduledCumulPrin#8657,ScheduledPeriodicPrin#8658,BOMPrin#8659,ListingNumber#8660,DebtSaleMonth#8661,GrossCashFromDebtSale#8662,DebtSaleFee#8663,NetCashToInvestorsFromDebtSale#8664,OZVintage#8665]

Code Generation: true
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Correct:
In [19]:  sqlContext.read.parquet(&lt;span class=&quot;code-quote&quot;&gt;&apos;prp_enh1&apos;&lt;/span&gt;).where(&lt;span class=&quot;code-quote&quot;&gt;&quot; LoanID=62231 and ( not(PaymentsReceived=0) or not (ExplicitRoll in (&lt;span class=&quot;code-quote&quot;&gt;&apos;PreviouslyPaidOff&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;PreviouslyChargedOff&apos;&lt;/span&gt;)))&quot;&lt;/span&gt;).explain(True)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;In [19]:  sqlContext.read.parquet(&apos;prp_enh1&apos;).where(&quot; LoanID=62231 and ( not(PaymentsReceived=0) or not (ExplicitRoll in (&apos;PreviouslyPaidOff&apos;, &apos;PreviouslyChargedOff&apos;)))&quot;).explain(True)
== Parsed Logical Plan ==
&apos;Filter ((&apos;LoanID = 62231) &amp;amp;&amp;amp; (NOT (&apos;PaymentsReceived = 0) || NOT &apos;ExplicitRoll IN (PreviouslyPaidOff,PreviouslyChargedOff)))
 Relation[BorrowerRate#8799,MnthRate#8800,ObservationMonth#8801,CycleCounter#8802,LoanID#8803,Loankey#8804,OriginationDate#8805,OriginationQuarter#8806,LoanAmount#8807,Term#8808,LenderRate#8809,ProsperRating#8810,ScheduledMonthlyPaymentAmount#8811,ChargeoffMonth#8812,ChargeoffAmount#8813,CompletedMonth#8814,MonthOfLastPayment#8815,PaymentsReceived#8816,CollectionFees#8817,PrincipalPaid#8818,InterestPaid#8819,LateFees#8820,ServicingFees#8821,RecoveryPayments#8822,RecoveryPrin#8823,DaysPastDue#8824,PriorMonthDPD#8825,ExplicitRoll#8826,SummaryRoll#8827,CumulPrin#8828,EOMPrin#8829,ScheduledPrinRemaining#8830,ScheduledCumulPrin#8831,ScheduledPeriodicPrin#8832,BOMPrin#8833,ListingNumber#8834,DebtSaleMonth#8835,GrossCashFromDebtSale#8836,DebtSaleFee#8837,NetCashToInvestorsFromDebtSale#8838,OZVintage#8839] ParquetRelation[file:/d:/MktLending/prp_enh1]

== Analyzed Logical Plan ==
BorrowerRate: double, MnthRate: double, ObservationMonth: date, CycleCounter: int, LoanID: int, Loankey: string, OriginationDate: date, OriginationQuarter: string, LoanAmount: double, Term: int, LenderRate: double, ProsperRating: string, ScheduledMonthlyPaymentAmount: double, ChargeoffMonth: date, ChargeoffAmount: double, CompletedMonth: date, MonthOfLastPayment: date, PaymentsReceived: double, CollectionFees: double, PrincipalPaid: double, InterestPaid: double, LateFees: double, ServicingFees: double, RecoveryPayments: double, RecoveryPrin: double, DaysPastDue: int, PriorMonthDPD: int, ExplicitRoll: string, SummaryRoll: string, CumulPrin: double, EOMPrin: double, ScheduledPrinRemaining: double, ScheduledCumulPrin: double, ScheduledPeriodicPrin: double, BOMPrin: double, ListingNumber: int, DebtSaleMonth: int, GrossCashFromDebtSale: double, DebtSaleFee: double, NetCashToInvestorsFromDebtSale: double, OZVintage: string
Filter ((LoanID#8803 = 62231) &amp;amp;&amp;amp; (NOT (PaymentsReceived#8816 = cast(0 as double)) || NOT ExplicitRoll#8826 IN (PreviouslyPaidOff,PreviouslyChargedOff)))
 Relation[BorrowerRate#8799,MnthRate#8800,ObservationMonth#8801,CycleCounter#8802,LoanID#8803,Loankey#8804,OriginationDate#8805,OriginationQuarter#8806,LoanAmount#8807,Term#8808,LenderRate#8809,ProsperRating#8810,ScheduledMonthlyPaymentAmount#8811,ChargeoffMonth#8812,ChargeoffAmount#8813,CompletedMonth#8814,MonthOfLastPayment#8815,PaymentsReceived#8816,CollectionFees#8817,PrincipalPaid#8818,InterestPaid#8819,LateFees#8820,ServicingFees#8821,RecoveryPayments#8822,RecoveryPrin#8823,DaysPastDue#8824,PriorMonthDPD#8825,ExplicitRoll#8826,SummaryRoll#8827,CumulPrin#8828,EOMPrin#8829,ScheduledPrinRemaining#8830,ScheduledCumulPrin#8831,ScheduledPeriodicPrin#8832,BOMPrin#8833,ListingNumber#8834,DebtSaleMonth#8835,GrossCashFromDebtSale#8836,DebtSaleFee#8837,NetCashToInvestorsFromDebtSale#8838,OZVintage#8839] ParquetRelation[file:/d:/MktLending/prp_enh1]

== Optimized Logical Plan ==
Filter ((LoanID#8803 = 62231) &amp;amp;&amp;amp; (NOT (PaymentsReceived#8816 = 0.0) || NOT ExplicitRoll#8826 IN (PreviouslyPaidOff,PreviouslyChargedOff)))
 Relation[BorrowerRate#8799,MnthRate#8800,ObservationMonth#8801,CycleCounter#8802,LoanID#8803,Loankey#8804,OriginationDate#8805,OriginationQuarter#8806,LoanAmount#8807,Term#8808,LenderRate#8809,ProsperRating#8810,ScheduledMonthlyPaymentAmount#8811,ChargeoffMonth#8812,ChargeoffAmount#8813,CompletedMonth#8814,MonthOfLastPayment#8815,PaymentsReceived#8816,CollectionFees#8817,PrincipalPaid#8818,InterestPaid#8819,LateFees#8820,ServicingFees#8821,RecoveryPayments#8822,RecoveryPrin#8823,DaysPastDue#8824,PriorMonthDPD#8825,ExplicitRoll#8826,SummaryRoll#8827,CumulPrin#8828,EOMPrin#8829,ScheduledPrinRemaining#8830,ScheduledCumulPrin#8831,ScheduledPeriodicPrin#8832,BOMPrin#8833,ListingNumber#8834,DebtSaleMonth#8835,GrossCashFromDebtSale#8836,DebtSaleFee#8837,NetCashToInvestorsFromDebtSale#8838,OZVintage#8839] ParquetRelation[file:/d:/MktLending/prp_enh1]

== Physical Plan ==
Filter ((LoanID#8803 = 62231) &amp;amp;&amp;amp; (NOT (PaymentsReceived#8816 = 0.0) || NOT ExplicitRoll#8826 IN (PreviouslyPaidOff,PreviouslyChargedOff)))
 Scan ParquetRelation[file:/d:/MktLending/prp_enh1][BorrowerRate#8799,MnthRate#8800,ObservationMonth#8801,CycleCounter#8802,LoanID#8803,Loankey#8804,OriginationDate#8805,OriginationQuarter#8806,LoanAmount#8807,Term#8808,LenderRate#8809,ProsperRating#8810,ScheduledMonthlyPaymentAmount#8811,ChargeoffMonth#8812,ChargeoffAmount#8813,CompletedMonth#8814,MonthOfLastPayment#8815,PaymentsReceived#8816,CollectionFees#8817,PrincipalPaid#8818,InterestPaid#8819,LateFees#8820,ServicingFees#8821,RecoveryPayments#8822,RecoveryPrin#8823,DaysPastDue#8824,PriorMonthDPD#8825,ExplicitRoll#8826,SummaryRoll#8827,CumulPrin#8828,EOMPrin#8829,ScheduledPrinRemaining#8830,ScheduledCumulPrin#8831,ScheduledPeriodicPrin#8832,BOMPrin#8833,ListingNumber#8834,DebtSaleMonth#8835,GrossCashFromDebtSale#8836,DebtSaleFee#8837,NetCashToInvestorsFromDebtSale#8838,OZVintage#8839]

Code Generation: true
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15048974" author="smilegator" created="Wed, 9 Dec 2015 17:03:11 +0000"  >&lt;p&gt;Thanks for the info! I will reproduce it soon. Will keep you posted. : )&lt;/p&gt;</comment>
                            <comment id="15049029" author="smilegator" created="Wed, 9 Dec 2015 17:37:14 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=imachabeli&quot; class=&quot;user-hover&quot; rel=&quot;imachabeli&quot;&gt;imachabeli&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Sorry, in the latest 1.6 build, I am unable to reproduce it. I guess the problem has been fixed. I need to confirm if 1.5.2 still has such a problem. Could you run the following code? I want to see the plan. Thanks!&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        val pathOne = YOUR_FILE_PATH
        (1 to 5).map(i =&amp;gt; (i, i.toString, i)).toDF(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;c&quot;&lt;/span&gt;).write.parquet(pathOne)

        val df = sqlContext.read.parquet(pathOne).where(&lt;span class=&quot;code-quote&quot;&gt;&quot;c &amp;lt; 6 and not (a = 2 and b in (&lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;2&apos;&lt;/span&gt;))&quot;&lt;/span&gt;)
        df.explain(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)

        val df2 = sqlContext.read.parquet(pathOne).where(&lt;span class=&quot;code-quote&quot;&gt;&quot;c &amp;lt; 6 and (not(a = 2) or not(b in (&lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;2&apos;&lt;/span&gt;)))&quot;&lt;/span&gt;)
        df2.explain(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15049038" author="smilegator" created="Wed, 9 Dec 2015 17:39:36 +0000"  >&lt;p&gt;Below is the tree I got. Both explain returns the same tree except the node IDs are different&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;== Parsed Logical Plan ==
&lt;span class=&quot;code-quote&quot;&gt;&apos;Filter ((&apos;&lt;/span&gt;c &amp;lt; 6) &amp;amp;&amp;amp; NOT ((&lt;span class=&quot;code-quote&quot;&gt;&apos;a = 2) &amp;amp;&amp;amp; &apos;&lt;/span&gt;b IN (1,2)))
+- Relation[a#9,b#10,c#11] ParquetRelation[file:/&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt;/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/folders/4b/sgmfldk15js406vk7lw5llzw0000gn/T/spark-c9681942-d699-4a3c-9ab7-bae84cb36245/table1]

== Analyzed Logical Plan ==
a: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, b: string, c: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;
Filter ((c#11 &amp;lt; 6) &amp;amp;&amp;amp; NOT ((a#9 = 2) &amp;amp;&amp;amp; b#10 IN (1,2)))
+- Relation[a#9,b#10,c#11] ParquetRelation[file:/&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt;/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/folders/4b/sgmfldk15js406vk7lw5llzw0000gn/T/spark-c9681942-d699-4a3c-9ab7-bae84cb36245/table1]

== Optimized Logical Plan ==
Filter ((c#11 &amp;lt; 6) &amp;amp;&amp;amp; (NOT (a#9 = 2) || NOT b#10 IN (1,2)))
+- Relation[a#9,b#10,c#11] ParquetRelation[file:/&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt;/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/folders/4b/sgmfldk15js406vk7lw5llzw0000gn/T/spark-c9681942-d699-4a3c-9ab7-bae84cb36245/table1]

== Physical Plan ==
Filter ((c#11 &amp;lt; 6) &amp;amp;&amp;amp; (NOT (a#9 = 2) || NOT b#10 IN (1,2)))
+- Scan ParquetRelation[file:/&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt;/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/folders/4b/sgmfldk15js406vk7lw5llzw0000gn/T/spark-c9681942-d699-4a3c-9ab7-bae84cb36245/table1] PushedFilter: [LessThan(c,6),Or(Not(EqualTo(a,2)),Not(In(b,[Ljava.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;;@4bf8a635)))] [a#9,b#10,c#11]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15049194" author="imachabeli" created="Wed, 9 Dec 2015 18:59:04 +0000"  >
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;scala&amp;gt; val df = sqlContext.read.parquet(pathOne).where(&lt;span class=&quot;code-quote&quot;&gt;&quot;c &amp;lt; 6 and not (a = 2 and b in (&lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;2&apos;&lt;/span&gt;))&quot;&lt;/span&gt;)
df: org.apache.spark.sql.DataFrame = [a: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, b: string, c: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;]

scala&amp;gt; df.explain(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;== Parsed Logical Plan ==
&apos;Filter ((&apos;c &amp;lt; 6) &amp;amp;&amp;amp; NOT ((&apos;a = 2) &amp;amp;&amp;amp; &apos;b IN (1,2)))
 Relation[a#30,b#31,c#32] ParquetRelation[file:/D:/tmp/test]

== Analyzed Logical Plan ==
a: int, b: string, c: int
Filter ((c#32 &amp;lt; 6) &amp;amp;&amp;amp; NOT ((a#30 = 2) &amp;amp;&amp;amp; b#31 IN (1,2)))
 Relation[a#30,b#31,c#32] ParquetRelation[file:/D:/tmp/test]

== Optimized Logical Plan ==
Filter ((c#32 &amp;lt; 6) &amp;amp;&amp;amp; NOT ((a#30 = 2) &amp;amp;&amp;amp; b#31 IN (1,2)))
 Relation[a#30,b#31,c#32] ParquetRelation[file:/D:/tmp/test]

== Physical Plan ==
Filter ((c#32 &amp;lt; 6) &amp;amp;&amp;amp; NOT ((a#30 = 2) &amp;amp;&amp;amp; b#31 IN (1,2)))
 Scan ParquetRelation[file:/D:/tmp/test][a#30,b#31,c#32]

Code Generation: true

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;



&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;scala&amp;gt; val df2 = sqlContext.read.parquet(pathOne).where(&lt;span class=&quot;code-quote&quot;&gt;&quot;c &amp;lt; 6 and (not(a = 2) or not(b in (&lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;2&apos;&lt;/span&gt;)))&quot;&lt;/span&gt;)
df2: org.apache.spark.sql.DataFrame = [a: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, b: string, c: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;]

scala&amp;gt; df2.explain(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;== Parsed Logical Plan ==
&apos;Filter ((&apos;c &amp;lt; 6) &amp;amp;&amp;amp; (NOT (&apos;a = 2) || NOT &apos;b IN (1,2)))
 Relation[a#34,b#35,c#36] ParquetRelation[file:/D:/tmp/test]

== Analyzed Logical Plan ==
a: int, b: string, c: int
Filter ((c#36 &amp;lt; 6) &amp;amp;&amp;amp; (NOT (a#34 = 2) || NOT b#35 IN (1,2)))
 Relation[a#34,b#35,c#36] ParquetRelation[file:/D:/tmp/test]

== Optimized Logical Plan ==
Filter ((c#36 &amp;lt; 6) &amp;amp;&amp;amp; (NOT (a#34 = 2) || NOT b#35 IN (1,2)))
 Relation[a#34,b#35,c#36] ParquetRelation[file:/D:/tmp/test]

== Physical Plan ==
Filter ((c#36 &amp;lt; 6) &amp;amp;&amp;amp; (NOT (a#34 = 2) || NOT b#35 IN (1,2)))
 Scan ParquetRelation[file:/D:/tmp/test][a#34,b#35,c#36]

Code Generation: true
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15049201" author="smilegator" created="Wed, 9 Dec 2015 19:04:20 +0000"  >&lt;p&gt;Great! That means, the problem has been resolved in Spark 1.6, which will be released this month. : )&lt;/p&gt;</comment>
                            <comment id="15052172" author="gurwls223" created="Fri, 11 Dec 2015 04:54:56 +0000"  >&lt;p&gt;Then, does this mean closing this issue? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smilegator&quot; class=&quot;user-hover&quot; rel=&quot;smilegator&quot;&gt;smilegator&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15052181" author="smilegator" created="Fri, 11 Dec 2015 05:02:39 +0000"  >&lt;p&gt;Yeah, I hope so. &lt;/p&gt;</comment>
                            <comment id="15052759" author="imachabeli" created="Fri, 11 Dec 2015 13:40:00 +0000"  >&lt;p&gt;The bug itself is really dangerous, it&apos;s ok if it was simply crushing , throwing exception etc but it silently produces wrong results. &lt;br/&gt;
Imagine coding in java and you have to worry if compiler correctly interprets &amp;amp;&amp;amp;,  || in if statement. that&apos;s disaster.&lt;br/&gt;
For me this is not critical, I&apos;m still in try out mode and can always upgrade to 1.6 but for someone who uses spark 1.5  for real job, that&apos;s really bad.&lt;/p&gt;</comment>
                            <comment id="15052763" author="smilegator" created="Fri, 11 Dec 2015 13:42:37 +0000"  >&lt;p&gt;Agree! I will do a search to find out what happened in the push down and which PR fixes the logical plan changes. Will keep you posted. Thanks!&lt;/p&gt;</comment>
                            <comment id="15054142" author="smilegator" created="Sat, 12 Dec 2015 08:40:31 +0000"  >&lt;p&gt;Found the fix, but that fix is not merged into 1.5.2. Tomorrow I will open a PR and let them merge the fix to 1.5.3. Thanks! &lt;/p&gt;</comment>
                            <comment id="15061415" author="apachespark" created="Thu, 17 Dec 2015 03:53:04 +0000"  >&lt;p&gt;User &apos;gatorsmile&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/10344&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/10344&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15062835" author="apachespark" created="Thu, 17 Dec 2015 21:15:04 +0000"  >&lt;p&gt;User &apos;yhuai&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/10362&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/10362&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15064465" author="yhuai" created="Fri, 18 Dec 2015 18:56:05 +0000"  >&lt;p&gt;Issue resolved by pull request 10362&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/10362&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/10362&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15072901" author="yhuai" created="Mon, 28 Dec 2015 16:51:54 +0000"  >&lt;p&gt;Just a note. &lt;a href=&quot;https://github.com/apache/spark/pull/10377&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/10377&lt;/a&gt; is a follow-up optimization for ORC. I only merged it in branch master and it will be released with 2.0.0 because it is not a bug fix.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 47 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2pmfr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12333969">1.5.3</customfieldvalue>
    <customfieldvalue id="12334009">1.6.1</customfieldvalue>
    <customfieldvalue id="12329449">2.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>