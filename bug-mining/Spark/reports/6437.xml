<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:05:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-27512] Decimal parsing leads to unexpected type inference</title>
                <link>https://issues.apache.org/jira/browse/SPARK-27512</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-bash&quot;&gt;
$ hadoop fs -text test.bsv
x|y
1|1,2
2|2,3
3|3,4
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;in spark 2.4.1:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-bash&quot;&gt;
scala&amp;gt; val data = spark.read.format(&lt;span class=&quot;code-quote-red&quot;&gt;&quot;csv&quot;&lt;/span&gt;).option(&lt;span class=&quot;code-quote-red&quot;&gt;&quot;header&quot;&lt;/span&gt;, true).option(&lt;span class=&quot;code-quote-red&quot;&gt;&quot;delimiter&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote-red&quot;&gt;&quot;|&quot;&lt;/span&gt;).option(&lt;span class=&quot;code-quote-red&quot;&gt;&quot;inferSchema&quot;&lt;/span&gt;, true).load(&lt;span class=&quot;code-quote-red&quot;&gt;&quot;test.bsv&quot;&lt;/span&gt;)

scala&amp;gt; data.printSchema
root
 |-- x: integer (nullable = true)
 |-- y: string (nullable = true)

scala&amp;gt; data.show
+---+---+
|  x|  y|
+---+---+
|  1|1,2|
|  2|2,3|
|  3|3,4|
+---+---+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;in spark 3.0.0-SNAPSHOT:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-bash&quot;&gt;
scala&amp;gt; val data = spark.read.format(&lt;span class=&quot;code-quote-red&quot;&gt;&quot;csv&quot;&lt;/span&gt;).option(&lt;span class=&quot;code-quote-red&quot;&gt;&quot;header&quot;&lt;/span&gt;, true).option(&lt;span class=&quot;code-quote-red&quot;&gt;&quot;delimiter&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote-red&quot;&gt;&quot;|&quot;&lt;/span&gt;).option(&lt;span class=&quot;code-quote-red&quot;&gt;&quot;inferSchema&quot;&lt;/span&gt;, true).load(&lt;span class=&quot;code-quote-red&quot;&gt;&quot;test.bsv&quot;&lt;/span&gt;)

scala&amp;gt; data.printSchema
root
 |-- x: integer (nullable = true)
 |-- y: decimal(2,0) (nullable = true)

scala&amp;gt; data.show
+---+---+
|  x|  y|
+---+---+
|  1| 12|
|  2| 23|
|  3| 34|
+---+---+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;spark 3.0.0-SNAPSHOT from this commit:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-bash&quot;&gt;
commit 3ab96d7acf870e53c9016b0b63d0b328eec23bed
Author: Dilip Biswal &amp;lt;dbiswal@us.ibm.com&amp;gt;
Date:   Mon Apr 15 21:26:45 2019 +0800
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</environment>
        <key id="13228926">SPARK-27512</key>
            <summary>Decimal parsing leads to unexpected type inference</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gurwls223">Hyukjin Kwon</assignee>
                                    <reporter username="koert">koert kuipers</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 Apr 2019 18:42:30 +0000</created>
                <updated>Mon, 12 Dec 2022 18:11:09 +0000</updated>
                            <resolved>Wed, 24 Apr 2019 07:22:49 +0000</resolved>
                                    <version>3.0.0</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16821846" author="gurwls223" created="Fri, 19 Apr 2019 11:11:19 +0000"  >&lt;p&gt;You can specify `locale` option from Spark 3.0.&lt;/p&gt;</comment>
                            <comment id="16821954" author="koert" created="Fri, 19 Apr 2019 14:25:23 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-bash&quot;&gt;
$ hadoop fs -cat test.bsv
x|y
1|1,2,3
2|4,5,6
3|7,8,9

scala&amp;gt; data.printSchema
root
 |-- x: integer (nullable = true)
 |-- y: decimal(3,0) (nullable = true)

scala&amp;gt; data.show
+---+---+
|  x|  y|
+---+---+
|  1|123|
|  2|456|
|  3|789|
+---+---+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;its great we can provide locale, but that also means there is a default locale. somehow the default locale interprets  1,2,3 is a decimal. i cannot think of any locale where this would be true, and if it existed it should not be our default.&lt;/p&gt;</comment>
                            <comment id="16822525" author="koert" created="Sat, 20 Apr 2019 17:47:47 +0000"  >&lt;p&gt;default locale is US, which now has this logic for parsing :&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  def getDecimalParser(locale: Locale): &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; =&amp;gt; java.math.BigDecimal = {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (locale == Locale.US) { &lt;span class=&quot;code-comment&quot;&gt;// Special handling the &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; locale &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; backward compatibility                                                                                                                    
&lt;/span&gt;      (s: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;) =&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; java.math.BigDecimal(s.replaceAll(&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;, &quot;&quot;))
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;but as i have shown above this is not backwards compatible, nor does the result make sense to me.&lt;/p&gt;</comment>
                            <comment id="16822790" author="koert" created="Sun, 21 Apr 2019 23:02:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maxgekk&quot; class=&quot;user-hover&quot; rel=&quot;maxgekk&quot;&gt;maxgekk&lt;/a&gt; maxim do you know why getDecimalParser has that if condition for Locale US where it calls&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 (s: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;) =&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; java.math.BigDecimal(s.replaceAll(&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;, &quot;&quot;)) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;i think it&apos;s that&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
s.replaceAll(&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;, &quot;&quot;)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;that is causing my issues.&lt;br/&gt;
 i saw it was introduced in:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
commit 7a83d71403edf7d24fa5efc0ef913f3ce76d88b8
Author: Maxim Gekk &amp;lt;max.gekk@gmail.com&amp;gt;
Date:   Thu Nov 29 22:15:12 2018 +0800

    [SPARK-26163][SQL] Parsing decimals from JSON using locale
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16822796" author="koert" created="Sun, 21 Apr 2019 23:23:44 +0000"  >&lt;p&gt;seems DecimalFormat.parse also simply ignores commas. still unclear to me why we have to do same in the &quot;special handling of default locale for backwards compatibility&quot; but i am guessing that has to do with json parsing backwards compatibility, not csv backwards compatibility.&lt;/p&gt;</comment>
                            <comment id="16823028" author="gurwls223" created="Mon, 22 Apr 2019 11:20:27 +0000"  >&lt;p&gt;I see a behaviour change. Yes, looks for schema inference path, how to handle decimals looks changed. But I think the current change makes sense rather than having two difference decimal parser for schema inference and data parse.&lt;br/&gt;
Still the workaround is to set &lt;tt&gt;locale&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="16823115" author="koert" created="Mon, 22 Apr 2019 13:58:59 +0000"  >&lt;p&gt;i agree it is better than having two different decimal parsers. note that i was not able to get the old behavior back by using a a locale, so that is not a workaround in sofar i can see.&lt;/p&gt;

&lt;p&gt;i think this is just a change we won&apos;t fix.&lt;/p&gt;</comment>
                            <comment id="16824867" author="gurwls223" created="Wed, 24 Apr 2019 07:22:49 +0000"  >&lt;p&gt;Issue resolved by pull request 24437&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/24437&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/24437&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 29 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z01xqw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>