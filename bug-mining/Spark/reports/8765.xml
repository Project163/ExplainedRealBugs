<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:31:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-40987] Avoid creating a directory when deleting a block, causing DAGScheduler to not work</title>
                <link>https://issues.apache.org/jira/browse/SPARK-40987</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;When the driver submits a job, DAGScheduler calls sc.broadcast(taskBinaryBytes).&lt;/p&gt;

&lt;p&gt;TorrentBroadcast#writeBlocks may fail due to disk problems during blockManager#putBytes.&lt;/p&gt;

&lt;p&gt;BlockManager#doPut calls BlockManager#removeBlockInternal to clean up the block.&lt;/p&gt;

&lt;p&gt;BlockManager#removeBlockInternal calls DiskStore#remove to clean up blocks on disk.&lt;/p&gt;

&lt;p&gt;DiskStore#remove will try to create the directory because the directory does not exist, and an exception will be thrown at this time.&lt;/p&gt;

&lt;p&gt;BlockInfoManager#blockInfoWrappers block info and lock not removed.&lt;/p&gt;

&lt;p&gt;The catch block in TorrentBroadcast#writeBlocks will call blockManager.removeBroadcast to clean up the broadcast.&lt;br/&gt;
Because the block lock in BlockInfoManager#blockInfoWrappers is not released, the dag-scheduler-event-loop thread of DAGScheduler will wait forever.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
22/11/01 18:27:48 WARN BlockManager: Putting block broadcast_0_piece0 failed due to exception java.io.IOException: XXXXX.
22/11/01 18:27:48 ERROR TorrentBroadcast: Store broadcast broadcast_0 fail, remove all pieces of the broadcast &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;dag-scheduler-event-loop&quot;&lt;/span&gt; #54 daemon prio=5 os_prio=31 tid=0x00007fc98e3fa800 nid=0x7203 waiting on condition [0x0000700008c1e000]
&#160; &#160;java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: WAITING (parking)
&#160; &#160; at sun.misc.Unsafe.park(Native Method)
&#160; &#160; - parking to wait &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &#160;&amp;lt;0x00000007add3d8c8&amp;gt; (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)
&#160; &#160; at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)
&#160; &#160; at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039)
&#160; &#160; at org.apache.spark.storage.BlockInfoManager.$anonfun$acquireLock$1(BlockInfoManager.scala:221)
&#160; &#160; at org.apache.spark.storage.BlockInfoManager.$anonfun$acquireLock$1$adapted(BlockInfoManager.scala:214)
&#160; &#160; at org.apache.spark.storage.BlockInfoManager$$Lambda$3038/1307533457.apply(Unknown Source)
&#160; &#160; at org.apache.spark.storage.BlockInfoWrapper.withLock(BlockInfoManager.scala:105)
&#160; &#160; at org.apache.spark.storage.BlockInfoManager.acquireLock(BlockInfoManager.scala:214)
&#160; &#160; at org.apache.spark.storage.BlockInfoManager.lockForWriting(BlockInfoManager.scala:293)
&#160; &#160; at org.apache.spark.storage.BlockManager.removeBlock(BlockManager.scala:1979)
&#160; &#160; at org.apache.spark.storage.BlockManager.$anonfun$removeBroadcast$3(BlockManager.scala:1970)
&#160; &#160; at org.apache.spark.storage.BlockManager.$anonfun$removeBroadcast$3$adapted(BlockManager.scala:1970)
&#160; &#160; at org.apache.spark.storage.BlockManager$$Lambda$3092/1241801156.apply(Unknown Source)
&#160; &#160; at scala.collection.Iterator.foreach(Iterator.scala:943)
&#160; &#160; at scala.collection.Iterator.foreach$(Iterator.scala:943)
&#160; &#160; at scala.collection.AbstractIterator.foreach(Iterator.scala:1431)
&#160; &#160; at org.apache.spark.storage.BlockManager.removeBroadcast(BlockManager.scala:1970)
&#160; &#160; at org.apache.spark.broadcast.TorrentBroadcast.writeBlocks(TorrentBroadcast.scala:179)
&#160; &#160; at org.apache.spark.broadcast.TorrentBroadcast.&amp;lt;init&amp;gt;(TorrentBroadcast.scala:99)
&#160; &#160; at org.apache.spark.broadcast.TorrentBroadcastFactory.newBroadcast(TorrentBroadcastFactory.scala:38)
&#160; &#160; at org.apache.spark.broadcast.BroadcastManager.newBroadcast(BroadcastManager.scala:78)
&#160; &#160; at org.apache.spark.SparkContext.broadcastInternal(SparkContext.scala:1538)
&#160; &#160; at org.apache.spark.SparkContext.broadcast(SparkContext.scala:1520)
&#160; &#160; at org.apache.spark.scheduler.DAGScheduler.submitMissingTasks(DAGScheduler.scala:1539)
&#160; &#160; at org.apache.spark.scheduler.DAGScheduler.submitStage(DAGScheduler.scala:1355)
&#160; &#160; at org.apache.spark.scheduler.DAGScheduler.handleJobSubmitted(DAGScheduler.scala:1297)
&#160; &#160; at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.doOnReceive(DAGScheduler.scala:2929)
&#160; &#160; at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.onReceive(DAGScheduler.scala:2921)
&#160; &#160; at org.apache.spark.scheduler.DAGSchedulerEventProcessLoop.onReceive(DAGScheduler.scala:2910)
&#160; &#160; at org.apache.spark.util.EventLoop$$anon$1.run(EventLoop.scala:49) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13493997">SPARK-40987</key>
            <summary>Avoid creating a directory when deleting a block, causing DAGScheduler to not work</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dzcxzl">dzcxzl</assignee>
                                    <reporter username="dzcxzl">dzcxzl</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Nov 2022 11:16:37 +0000</created>
                <updated>Wed, 30 Nov 2022 03:55:36 +0000</updated>
                            <resolved>Wed, 30 Nov 2022 03:55:36 +0000</resolved>
                                    <version>3.2.2</version>
                    <version>3.3.1</version>
                                    <fixVersion>3.2.3</fixVersion>
                    <fixVersion>3.3.2</fixVersion>
                    <fixVersion>3.4.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17627113" author="apachespark" created="Tue, 1 Nov 2022 11:26:18 +0000"  >&lt;p&gt;User &apos;cxzl25&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/38467&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/38467&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17627116" author="apachespark" created="Tue, 1 Nov 2022 11:27:23 +0000"  >&lt;p&gt;User &apos;cxzl25&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/38467&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/38467&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17641052" author="mridulm80" created="Wed, 30 Nov 2022 03:55:36 +0000"  >&lt;p&gt;Issue resolved by pull request 38467&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/38467&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/38467&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 49 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1aon4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>