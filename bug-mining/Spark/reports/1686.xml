<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:26:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-6431] Couldn&apos;t find leader offsets exception when creating KafkaDirectStream</title>
                <link>https://issues.apache.org/jira/browse/SPARK-6431</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;When I try to create an InputDStream using the createDirectStream method of the KafkaUtils class and the kafka topic does not have any messages yet am getting the following error:&lt;/p&gt;

&lt;p&gt;org.apache.spark.SparkException: Couldn&apos;t find leader offsets for Set()&lt;br/&gt;
org.apache.spark.SparkException: org.apache.spark.SparkException: Couldn&apos;t find leader offsets for Set()&lt;br/&gt;
	at org.apache.spark.streaming.kafka.KafkaUtils$$anonfun$createDirectStream$2.apply(KafkaUtils.scala:413)&lt;/p&gt;

&lt;p&gt;If I put a message in the topic before creating the DirectStream everything works fine.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12783532">SPARK-6431</key>
            <summary>Couldn&apos;t find leader offsets exception when creating KafkaDirectStream</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="koeninger">Cody Koeninger</assignee>
                                    <reporter username="ardlema">Alberto Rodriguez</reporter>
                        <labels>
                    </labels>
                <created>Fri, 20 Mar 2015 08:39:51 +0000</created>
                <updated>Fri, 25 Aug 2017 08:33:45 +0000</updated>
                            <resolved>Sun, 12 Apr 2015 16:37:41 +0000</resolved>
                                    <version>1.3.0</version>
                                    <fixVersion>1.4.0</fixVersion>
                                    <component>DStreams</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14481266" author="cody@koeninger.org" created="Mon, 6 Apr 2015 14:37:30 +0000"  >&lt;p&gt;I think this got mis-diagnosed on the mailing list, sorry for the confusion.&lt;/p&gt;

&lt;p&gt;The only way I&apos;ve been able to reproduce that exception is by trying to start a stream for a topic that doesn&apos;t exist at all.  Alberto, did you actually run kafka-topics.sh --create before starting the job, or in some other way create the topic?  Pretty sure what happened here is that your topic didn&apos;t exist the first time you ran the job.  Your brokers were set to auto-create topics, so it did exist the next time you ran the job.  Putting a message into the topic didn&apos;t have anything to do with it.&lt;/p&gt;

&lt;p&gt;Here&apos;s why I think that&apos;s what happened.  Following console session is an example, where &quot;empty&quot; topic existed prior to starting the console, but had no messages.  Topic &quot;hasonemesssage&quot; existed and had one message in it.  Topic &quot;doesntexistyet&quot; didn&apos;t exist at the beginning of the console.&lt;/p&gt;

&lt;p&gt;The metadata apis return the same info for existing-but-empty topics as they do for topics with messages in them:&lt;/p&gt;

&lt;p&gt;scala&amp;gt; kc.getPartitions(Set(&quot;empty&quot;)).right&lt;br/&gt;
res0: scala.util.Either.RightProjection[org.apache.spark.streaming.kafka.KafkaCluster.Err,Set&lt;span class=&quot;error&quot;&gt;&amp;#91;kafka.common.TopicAndPartition&amp;#93;&lt;/span&gt;] = RightProjection(Right(&lt;br/&gt;
Set(&lt;span class=&quot;error&quot;&gt;&amp;#91;empty,0&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;empty,1&amp;#93;&lt;/span&gt;)))&lt;/p&gt;

&lt;p&gt;scala&amp;gt; kc.getPartitions(Set(&quot;hasonemessage&quot;)).right&lt;br/&gt;
res1: scala.util.Either.RightProjection[org.apache.spark.streaming.kafka.KafkaCluster.Err,Set&lt;span class=&quot;error&quot;&gt;&amp;#91;kafka.common.TopicAndPartition&amp;#93;&lt;/span&gt;] = RightProjection(Right(Set(&lt;span class=&quot;error&quot;&gt;&amp;#91;hasonemessage,0&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;hasonemessage,1&amp;#93;&lt;/span&gt;)))&lt;/p&gt;


&lt;p&gt;Leader offsets are both 0 for the empty topic, as you&apos;d expect:&lt;/p&gt;

&lt;p&gt;scala&amp;gt; kc.getLatestLeaderOffsets(kc.getPartitions(Set(&quot;empty&quot;)).right.get)&lt;br/&gt;
res5: Either[org.apache.spark.streaming.kafka.KafkaCluster.Err,Map&lt;span class=&quot;error&quot;&gt;&amp;#91;kafka.common.TopicAndPartition,org.apache.spark.streaming.kafka.KafkaCluster.LeaderOffset&amp;#93;&lt;/span&gt;] = Right(Map(&lt;span class=&quot;error&quot;&gt;&amp;#91;empty,1&amp;#93;&lt;/span&gt; -&amp;gt; LeaderOffset(localhost,9094,0), &lt;span class=&quot;error&quot;&gt;&amp;#91;empty,0&amp;#93;&lt;/span&gt; -&amp;gt; LeaderOffset(localhost,9093,0)))&lt;/p&gt;

&lt;p&gt;And one of the leader offsets is 1 for the topic with one message:&lt;/p&gt;

&lt;p&gt;scala&amp;gt; kc.getLatestLeaderOffsets(kc.getPartitions(Set(&quot;hasonemessage&quot;)).right.get)&lt;br/&gt;
res6: Either[org.apache.spark.streaming.kafka.KafkaCluster.Err,Map&lt;span class=&quot;error&quot;&gt;&amp;#91;kafka.common.TopicAndPartition,org.apache.spark.streaming.kafka.KafkaCluster.LeaderOffset&amp;#93;&lt;/span&gt;] = Right(Map(&lt;span class=&quot;error&quot;&gt;&amp;#91;hasonemessage,0&amp;#93;&lt;/span&gt; -&amp;gt; LeaderOffset(localhost,9092,1), &lt;span class=&quot;error&quot;&gt;&amp;#91;hasonemessage,1&amp;#93;&lt;/span&gt; -&amp;gt; LeaderOffset(localhost,9093,0)))&lt;/p&gt;


&lt;p&gt;The first time a metadata request is made against the non-existing topic, it returns empty:&lt;/p&gt;

&lt;p&gt;kc.getPartitions(Set(&quot;doesntexistyet&quot;)).right&lt;br/&gt;
res2: scala.util.Either.RightProjection[org.apache.spark.streaming.kafka.KafkaCluster.Err,Set&lt;span class=&quot;error&quot;&gt;&amp;#91;kafka.common.TopicAndPartition&amp;#93;&lt;/span&gt;] = RightProjection(Right(Set()))&lt;/p&gt;


&lt;p&gt;But if your brokers are configured with auto.create.topics.enable set to true, that metadata request alone is enough to trigger creation of the topic.  Requesting it again shows that the topic has been created:&lt;/p&gt;

&lt;p&gt;scala&amp;gt; kc.getPartitions(Set(&quot;doesntexistyet&quot;)).right&lt;br/&gt;
res3: scala.util.Either.RightProjection[org.apache.spark.streaming.kafka.KafkaCluster.Err,Set&lt;span class=&quot;error&quot;&gt;&amp;#91;kafka.common.TopicAndPartition&amp;#93;&lt;/span&gt;] = RightProjection(Right(Set(&lt;span class=&quot;error&quot;&gt;&amp;#91;doesntexistyet,0&amp;#93;&lt;/span&gt;, &lt;span class=&quot;error&quot;&gt;&amp;#91;doesntexistyet,1&amp;#93;&lt;/span&gt;)))&lt;/p&gt;


&lt;p&gt;If you don&apos;t think that explains what happened, please let me know if you have a way of reproducing that exception against an existing-but-empty topic, because I cant.&lt;/p&gt;

&lt;p&gt;As far as what to do about this, my instinct is to just improve the error handling for the getPartitions call.  If the topic doesn&apos;t exist yet, It shouldn&apos;t be returning an empty set, it should be returning an error.&lt;/p&gt;</comment>
                            <comment id="14482752" author="ardlema" created="Tue, 7 Apr 2015 07:43:30 +0000"  >&lt;p&gt;You&apos;re absolutely right Cody. I&apos;ve been having a look at my code and I&apos;ve found out that I&apos;m not creating the topic before creating the DirectStream. If you are interested here is the test I am running: &lt;a href=&quot;https://github.com/ardlema/big-brother/blob/master/src/test/scala/org/ardlema/spark/DwellDetectorTest.scala&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ardlema/big-brother/blob/master/src/test/scala/org/ardlema/spark/DwellDetectorTest.scala&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I completely agree with you, If the topic doesn&apos;t exist it should be returning an error and not a misleading empty set.&lt;/p&gt;
</comment>
                            <comment id="14489675" author="apachespark" created="Fri, 10 Apr 2015 14:00:15 +0000"  >&lt;p&gt;User &apos;koeninger&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/5454&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/5454&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14491568" author="srowen" created="Sun, 12 Apr 2015 16:37:41 +0000"  >&lt;p&gt;Issue resolved by pull request 5454&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/5454&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/5454&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12783607">SPARK-6434</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12929488">SPARK-12775</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13097517">SPARK-21836</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 32 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i27127:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>