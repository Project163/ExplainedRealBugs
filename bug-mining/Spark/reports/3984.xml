<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:47:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-17335] Creating Hive table from Spark data</title>
                <link>https://issues.apache.org/jira/browse/SPARK-17335</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Recently my team started using Spark for analysis of huge JSON objects. Spark itself handles it well. The problem starts when we try to create a Hive table from it using steps from this part of doc: &lt;a href=&quot;http://spark.apache.org/docs/latest/sql-programming-guide.html#hive-tables&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://spark.apache.org/docs/latest/sql-programming-guide.html#hive-tables&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;After running command `spark.sql(&quot;CREATE TABLE x AS (SELECT * FROM y)&quot;) we get following exception (sorry for obfuscating, confidential data):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; org.apache.spark.sql.AnalysisException: org.apache.hadoop.hive.ql.metadata.HiveException: java.lang.IllegalArgumentException: Error: : expected at the position 993 of &lt;span class=&quot;code-quote&quot;&gt;&apos;string:struct&amp;lt;a:&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;,b:array&amp;lt;string&amp;gt;,c:&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;,d:struct&amp;lt;e:&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;,f:&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;,[...(few others)],z:&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;,... 4 more fields&amp;gt;,[...(&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt; of valid struct string)]&amp;gt;&apos;&lt;/span&gt; but &lt;span class=&quot;code-quote&quot;&gt;&apos; &apos;&lt;/span&gt; is found.;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It turned out that the exception was raised because of `... 4 more fields` part as it is not a valid representation of data structure.&lt;/p&gt;

&lt;p&gt;An easy workaround is to set `spark.debug.maxToStringFields` to some large value. Nevertheless it shouldn&apos;t be required and the stringifying process should use methods targeted at giving valid data structure for Hive.&lt;/p&gt;

&lt;p&gt;In my opinion the root problem is here:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/blob/9d7a47406ed538f0005cdc7a62bc6e6f20634815/sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/encoders/ExpressionEncoder.scala#L318&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/9d7a47406ed538f0005cdc7a62bc6e6f20634815/sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/encoders/ExpressionEncoder.scala#L318&lt;/a&gt; when calling `simpleString` method instead of `catalogString`. Nevertheless this class is used at many places and I don&apos;t feel that experienced with Spark to automatically submit PR.&lt;/p&gt;

&lt;p&gt;We believe this issue is indirectly caused by this PR: &lt;a href=&quot;https://github.com/apache/spark/pull/13537&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/13537&lt;/a&gt;&lt;br/&gt;
There has been almost the same issue in the past. You can find it here: &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-16415&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-16415&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13001636">SPARK-17335</key>
            <summary>Creating Hive table from Spark data</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hvanhovell">Herman van H&#246;vell</assignee>
                                    <reporter username="jupblb">Michal Kielbowicz</reporter>
                        <labels>
                    </labels>
                <created>Wed, 31 Aug 2016 12:34:31 +0000</created>
                <updated>Sat, 3 Sep 2016 17:03:34 +0000</updated>
                            <resolved>Sat, 3 Sep 2016 17:03:33 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.1</fixVersion>
                    <fixVersion>2.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15452175" author="hvanhovell" created="Wed, 31 Aug 2016 12:57:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jupblb&quot; class=&quot;user-hover&quot; rel=&quot;jupblb&quot;&gt;jupblb&lt;/a&gt; Could you open a PR for this?&lt;/p&gt;</comment>
                            <comment id="15452220" author="jupblb" created="Wed, 31 Aug 2016 13:18:06 +0000"  >&lt;p&gt;Sure, I just need a while to get my hands on it. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15455293" author="jupblb" created="Thu, 1 Sep 2016 12:54:45 +0000"  >&lt;p&gt;It turned out I was a bit wrong, the problem doesn&apos;t lie within StructType.simpleString method as ExpressionEncoder.toString is not used (simpleString is only called when initializing the schemaString value).&lt;br/&gt;
We do not know why truncation is being used when stringifying the data structure. Please find our stacktrace below:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.IllegalArgumentException: Error: : expected at the position 1012 of &lt;span class=&quot;code-quote&quot;&gt;&apos;[VERY LONG STRUCTTYPE STRING]&apos;&lt;/span&gt; but &lt;span class=&quot;code-quote&quot;&gt;&apos; &apos;&lt;/span&gt; is found.
    at org.apache.hadoop.hive.serde2.typeinfo.TypeInfoUtils$TypeInfoParser.expect(TypeInfoUtils.java:360)
    at org.apache.hadoop.hive.serde2.typeinfo.TypeInfoUtils$TypeInfoParser.expect(TypeInfoUtils.java:331)
    at org.apache.hadoop.hive.serde2.typeinfo.TypeInfoUtils$TypeInfoParser.parseType(TypeInfoUtils.java:483)
    at org.apache.hadoop.hive.serde2.typeinfo.TypeInfoUtils$TypeInfoParser.parseType(TypeInfoUtils.java:484)
    at org.apache.hadoop.hive.serde2.typeinfo.TypeInfoUtils$TypeInfoParser.parseType(TypeInfoUtils.java:447)
    at org.apache.hadoop.hive.serde2.typeinfo.TypeInfoUtils$TypeInfoParser.parseType(TypeInfoUtils.java:484)
    at org.apache.hadoop.hive.serde2.typeinfo.TypeInfoUtils$TypeInfoParser.parseTypeInfos(TypeInfoUtils.java:305)
    at org.apache.hadoop.hive.serde2.typeinfo.TypeInfoUtils.getTypeInfosFromTypeString(TypeInfoUtils.java:765)
    at org.apache.hadoop.hive.ql.io.orc.OrcSerde.initialize(OrcSerde.java:104)
    at org.apache.spark.sql.hive.orc.OrcSerializer.&amp;lt;init&amp;gt;(OrcFileFormat.scala:178)
    at org.apache.spark.sql.hive.orc.OrcOutputWriter.&amp;lt;init&amp;gt;(OrcFileFormat.scala:220)
    at org.apache.spark.sql.hive.orc.OrcFileFormat$$anon$1.newInstance(OrcFileFormat.scala:93)
    at org.apache.spark.sql.execution.datasources.BaseWriterContainer.newOutputWriter(WriterContainer.scala:131)
    at org.apache.spark.sql.execution.datasources.DefaultWriterContainer.writeRows(WriterContainer.scala:247)
    at org.apache.spark.sql.execution.datasources.InsertIntoHadoopFsRelationCommand$$anonfun$run$1$$anonfun$apply$mcV$sp$1.apply(InsertIntoHadoopFsRelationCommand.scala:143)
    at org.apache.spark.sql.execution.datasources.InsertIntoHadoopFsRelationCommand$$anonfun$run$1$$anonfun$apply$mcV$sp$1.apply(InsertIntoHadoopFsRelationCommand.scala:143)
    at org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:70)
    at org.apache.spark.scheduler.Task.run(Task.scala:85)
    at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:274)
    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
    at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15455529" author="hvanhovell" created="Thu, 1 Sep 2016 14:16:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jupblb&quot; class=&quot;user-hover&quot; rel=&quot;jupblb&quot;&gt;jupblb&lt;/a&gt; Are you using a nested schema? If you do then this line is probably causing you grief: &lt;a href=&quot;https://github.com/apache/spark/blob/master/sql/catalyst/src/main/scala/org/apache/spark/sql/types/DataType.scala#L66&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/master/sql/catalyst/src/main/scala/org/apache/spark/sql/types/DataType.scala#L66&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;That will mess up the catalog string of any struct.&lt;/p&gt;</comment>
                            <comment id="15455671" author="hvanhovell" created="Thu, 1 Sep 2016 14:54:58 +0000"  >&lt;p&gt;Turns out this is not correct, StructType handles this correctly.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jupblb&quot; class=&quot;user-hover&quot; rel=&quot;jupblb&quot;&gt;jupblb&lt;/a&gt; Could you check the log for the following message:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;16/09/01 16:41:45 WARN Utils: Truncated the string representation of a plan since it was too large. This behavior can be adjusted by setting &apos;spark.debug.maxToStringFields&apos; in SparkEnv.conf.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15455709" author="hvanhovell" created="Thu, 1 Sep 2016 15:07:04 +0000"  >&lt;p&gt;&lt;tt&gt;ArrayType&lt;/tt&gt; and &lt;tt&gt;MapType&lt;/tt&gt; do not have a proper &lt;tt&gt;catalogString&lt;/tt&gt; implementation. They call `simpleString` on their child data types, which is problematic if the child data type is a struct.&lt;/p&gt;

&lt;p&gt;You can reproduce this with the following code:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;import org.apache.spark.sql.types._
def complex = new StructType((0 to 25).map(i =&amp;gt; new StructField((&apos;a&apos; + i).toChar.toString, IntegerType, false)).toArray)
val schema = new StructType().add(&quot;elements&quot;, ArrayType(complex))
println(schema.catalogString)

&amp;gt;struct&amp;lt;elements:array&amp;lt;struct&amp;lt;a:int,b:int,c:int,d:int,e:int,f:int,g:int,h:int,i:int,j:int,k:int,l:int,m:int,n:int,o:int,p:int,q:int,r:int,s:int,t:int,u:int,v:int,w:int,x:int,... 2 more fields&amp;gt;&amp;gt;&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15458811" author="apachespark" created="Fri, 2 Sep 2016 15:23:05 +0000"  >&lt;p&gt;User &apos;hvanhovell&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/14938&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/14938&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15458827" author="jupblb" created="Fri, 2 Sep 2016 15:28:19 +0000"  >&lt;p&gt;Cool! I unfortunately was limited by my company open-source policy. Thanks a lot to you Herman!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 11 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3329z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>