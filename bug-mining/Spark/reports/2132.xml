<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:29:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-8928] CatalystSchemaConverter doesn&apos;t stick to behavior of old versions of Spark SQL when dealing with LISTs</title>
                <link>https://issues.apache.org/jira/browse/SPARK-8928</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Spark SQL 1.4.x and prior versions doesn&apos;t follow Parquet format spec when dealing with complex types (because the spec wasn&apos;t clear about this part at the time Spark SQL Parquet support was authored). &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-6777&quot; title=&quot;Implement backwards-compatibility rules in Parquet schema converters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-6777&quot;&gt;&lt;del&gt;SPARK-6777&lt;/del&gt;&lt;/a&gt; partly fixes this problem with &lt;tt&gt;CatalystSchemaConverter&lt;/tt&gt; and introduces a feature flag to indicate whether we should stick to Parquet format spec (standard mode) or older Spark versions behavior (compatible mode). However, when dealing with LISTs (i.e. Spark SQL arrays), &lt;tt&gt;CatalystSchemaConverter&lt;/tt&gt; doesn&apos;t give exactly the same schema as before in compatible mode.&lt;/p&gt;

&lt;p&gt;For a nullable int array, 1.4.x- sticks to parquet-avro and gives:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;message root {
  &amp;lt;repetition&amp;gt; group &amp;lt;field-name&amp;gt; (LIST) {
    required int32 array;
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The inner most field name is &lt;tt&gt;array&lt;/tt&gt;. However, &lt;tt&gt;CatalystSchemaConverter&lt;/tt&gt; uses &lt;tt&gt;element&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Similarly, for a nullable int array, 1.4.x- sticks to parquet-hive, and gives:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;optional group &amp;lt;field-name&amp;gt; (LIST) {
  optional group bag {
    optional int32 array_element;
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The inner most field name is &lt;tt&gt;array_element&lt;/tt&gt;. However, &lt;tt&gt;CatalystSchemaConverter&lt;/tt&gt; still uses &lt;tt&gt;element&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;This issue doesn&apos;t affect Parquet read path since all the schemas above are covered by &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-6776&quot; title=&quot;Implement backwards-compatibility rules in Catalyst converters (which convert Parquet record to rows)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-6776&quot;&gt;&lt;del&gt;SPARK-6776&lt;/del&gt;&lt;/a&gt;. But this issue affects the write path. Ideally, we&apos;d like Spark SQL 1.5.x to write Parquet files sticking to either exactly the same format used in 1.4.x- or the most recent Parquet format spec.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12843704">SPARK-8928</key>
            <summary>CatalystSchemaConverter doesn&apos;t stick to behavior of old versions of Spark SQL when dealing with LISTs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lian cheng">Cheng Lian</assignee>
                                    <reporter username="lian cheng">Cheng Lian</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Jul 2015 23:42:37 +0000</created>
                <updated>Thu, 9 Jul 2015 05:18:03 +0000</updated>
                            <resolved>Thu, 9 Jul 2015 05:09:50 +0000</resolved>
                                    <version>1.5.0</version>
                                    <fixVersion>1.5.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14619603" author="apachespark" created="Wed, 8 Jul 2015 23:49:02 +0000"  >&lt;p&gt;User &apos;liancheng&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/7304&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/7304&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14619903" author="lian cheng" created="Thu, 9 Jul 2015 05:09:50 +0000"  >&lt;p&gt;Issue resolved by pull request 7304&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/7304&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/7304&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14619912" author="apachespark" created="Thu, 9 Jul 2015 05:18:03 +0000"  >&lt;p&gt;User &apos;liancheng&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/7314&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/7314&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 19 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2h0wv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332078">1.5.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>