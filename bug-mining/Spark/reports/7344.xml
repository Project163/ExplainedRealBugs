<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:18:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-32237] Cannot resolve column when put hint in the views of common table expression</title>
                <link>https://issues.apache.org/jira/browse/SPARK-32237</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Suppose we have a table:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TABLE&lt;/span&gt; DEMO_DATA (
  ID &lt;span class=&quot;code-keyword&quot;&gt;VARCHAR&lt;/span&gt;(10),
  &lt;span class=&quot;code-keyword&quot;&gt;NAME&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;VARCHAR&lt;/span&gt;(10),
  BATCH &lt;span class=&quot;code-keyword&quot;&gt;VARCHAR&lt;/span&gt;(10),
  TEAM &lt;span class=&quot;code-keyword&quot;&gt;VARCHAR&lt;/span&gt;(1)
) STORED &lt;span class=&quot;code-keyword&quot;&gt;AS&lt;/span&gt; PARQUET;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and some data in it:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
0: jdbc:hive2://HOSTNAME:10000&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; T.* &lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt; DEMO_DATA T;
+&lt;span class=&quot;code-comment&quot;&gt;-------+---------+-------------+---------+
&lt;/span&gt;| t.id  | t.&lt;span class=&quot;code-keyword&quot;&gt;name&lt;/span&gt;  |   t.batch   | t.team  |
+&lt;span class=&quot;code-comment&quot;&gt;-------+---------+-------------+---------+
&lt;/span&gt;| 1     | mike    | 2020-07-08  | &lt;span class=&quot;code-keyword&quot;&gt;A&lt;/span&gt;       |
| 2     | john    | 2020-07-07  | B       |
| 3     | rose    | 2020-07-06  | B       |
| ....                                    |
+&lt;span class=&quot;code-comment&quot;&gt;-------+---------+-------------+---------+&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If I put query hint in va or vb and run it in spark-shell:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;sql&lt;/span&gt;(&quot;&quot;&quot;
&lt;span class=&quot;code-keyword&quot;&gt;WITH&lt;/span&gt; VA &lt;span class=&quot;code-keyword&quot;&gt;AS&lt;/span&gt;
 (&lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; T.ID, T.&lt;span class=&quot;code-keyword&quot;&gt;NAME&lt;/span&gt;, T.BATCH, T.TEAM 
    &lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt; DEMO_DATA T &lt;span class=&quot;code-keyword&quot;&gt;WHERE&lt;/span&gt; T.TEAM = &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;A&lt;/span&gt;&apos;&lt;/span&gt;),
VB &lt;span class=&quot;code-keyword&quot;&gt;AS&lt;/span&gt;
 (&lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; /*+ REPARTITION(3) */ T.ID, T.&lt;span class=&quot;code-keyword&quot;&gt;NAME&lt;/span&gt;, T.BATCH, T.TEAM
    &lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt; VA T)
&lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; T.ID, T.&lt;span class=&quot;code-keyword&quot;&gt;NAME&lt;/span&gt;, T.BATCH, T.TEAM 
  &lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt; VB T
&quot;&quot;&quot;).&lt;span class=&quot;code-keyword&quot;&gt;show&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In Spark-2.4.4 it works fine.&lt;br/&gt;
 But in Spark-3.0.0, it throws AnalysisException with Unrecognized hint warning:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-scala&quot;&gt;
20/07/09 13:51:14 WARN analysis.HintErrorLogger: Unrecognized hint: REPARTITION(3)
org.apache.spark.sql.AnalysisException: cannot resolve &apos;`T.ID`&apos; given input columns: [T.BATCH, T.ID, T.NAME, T.TEAM]; line 8 pos 7;
&apos;Project [&apos;T.ID, &apos;T.NAME, &apos;T.BATCH, &apos;T.TEAM]
+- SubqueryAlias T
   +- SubqueryAlias VB
      +- Project [ID#0, NAME#1, BATCH#2, TEAM#3]
         +- SubqueryAlias T
            +- SubqueryAlias VA
               +- Project [ID#0, NAME#1, BATCH#2, TEAM#3]
                  +- Filter (TEAM#3 = A)
                     +- SubqueryAlias T
                        +- SubqueryAlias spark_catalog.default.demo_data
                           +- Relation[ID#0,NAME#1,BATCH#2,TEAM#3] parquet

  at org.apache.spark.sql.catalyst.analysis.&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;$AnalysisErrorAt.failAnalysis(&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;.scala:42)
  at org.apache.spark.sql.catalyst.analysis.CheckAnalysis$$anonfun$$nestedInanonfun$checkAnalysis$1$2.applyOrElse(CheckAnalysis.scala:143)
  at org.apache.spark.sql.catalyst.analysis.CheckAnalysis$$anonfun$$nestedInanonfun$checkAnalysis$1$2.applyOrElse(CheckAnalysis.scala:140)
  at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$transformUp$2(TreeNode.scala:333)
  at org.apache.spark.sql.catalyst.trees.CurrentOrigin$.withOrigin(TreeNode.scala:72)
  at org.apache.spark.sql.catalyst.trees.TreeNode.transformUp(TreeNode.scala:333)
  at org.apache.spark.sql.catalyst.plans.QueryPlan.$anonfun$transformExpressionsUp$1(QueryPlan.scala:106)
  at org.apache.spark.sql.catalyst.plans.QueryPlan.$anonfun$mapExpressions$1(QueryPlan.scala:118)
  at org.apache.spark.sql.catalyst.trees.CurrentOrigin$.withOrigin(TreeNode.scala:72)
  at org.apache.spark.sql.catalyst.plans.QueryPlan.transformExpression$1(QueryPlan.scala:118)
  at org.apache.spark.sql.catalyst.plans.QueryPlan.recursiveTransform$1(QueryPlan.scala:129)
  at org.apache.spark.sql.catalyst.plans.QueryPlan.$anonfun$mapExpressions$3(QueryPlan.scala:134)
  at scala.collection.TraversableLike.$anonfun$map$1(TraversableLike.scala:238)
  at scala.collection.immutable.List.foreach(List.scala:392)
  at scala.collection.TraversableLike.map(TraversableLike.scala:238)
  at scala.collection.TraversableLike.map$(TraversableLike.scala:231)
  at scala.collection.immutable.List.map(List.scala:298)
  at org.apache.spark.sql.catalyst.plans.QueryPlan.recursiveTransform$1(QueryPlan.scala:134)
  at org.apache.spark.sql.catalyst.plans.QueryPlan.$anonfun$mapExpressions$4(QueryPlan.scala:139)
  at org.apache.spark.sql.catalyst.trees.TreeNode.mapProductIterator(TreeNode.scala:237)
  at org.apache.spark.sql.catalyst.plans.QueryPlan.mapExpressions(QueryPlan.scala:139)
  at org.apache.spark.sql.catalyst.plans.QueryPlan.transformExpressionsUp(QueryPlan.scala:106)
  at org.apache.spark.sql.catalyst.analysis.CheckAnalysis.$anonfun$checkAnalysis$1(CheckAnalysis.scala:140)
  at org.apache.spark.sql.catalyst.analysis.CheckAnalysis.$anonfun$checkAnalysis$1$adapted(CheckAnalysis.scala:92)
  at org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:177)
  at org.apache.spark.sql.catalyst.analysis.CheckAnalysis.checkAnalysis(CheckAnalysis.scala:92)
  at org.apache.spark.sql.catalyst.analysis.CheckAnalysis.checkAnalysis$(CheckAnalysis.scala:89)
  at org.apache.spark.sql.catalyst.analysis.Analyzer.checkAnalysis(Analyzer.scala:130)
  at org.apache.spark.sql.catalyst.analysis.Analyzer.$anonfun$executeAndCheck$1(Analyzer.scala:156)
  at org.apache.spark.sql.catalyst.plans.logical.AnalysisHelper$.markInAnalyzer(AnalysisHelper.scala:201)
  at org.apache.spark.sql.catalyst.analysis.Analyzer.executeAndCheck(Analyzer.scala:153)
  at org.apache.spark.sql.execution.QueryExecution.$anonfun$analyzed$1(QueryExecution.scala:68)
  at org.apache.spark.sql.catalyst.QueryPlanningTracker.measurePhase(QueryPlanningTracker.scala:111)
  at org.apache.spark.sql.execution.QueryExecution.$anonfun$executePhase$1(QueryExecution.scala:133)
  at org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:763)
  at org.apache.spark.sql.execution.QueryExecution.executePhase(QueryExecution.scala:133)
  at org.apache.spark.sql.execution.QueryExecution.analyzed$lzycompute(QueryExecution.scala:68)
  at org.apache.spark.sql.execution.QueryExecution.analyzed(QueryExecution.scala:66)
  at org.apache.spark.sql.execution.QueryExecution.assertAnalyzed(QueryExecution.scala:58)
  at org.apache.spark.sql.Dataset$.$anonfun$ofRows$2(Dataset.scala:99)
  at org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:763)
  at org.apache.spark.sql.Dataset$.ofRows(Dataset.scala:97)
  at org.apache.spark.sql.SparkSession.$anonfun$sql$1(SparkSession.scala:606)
  at org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:763)
  at org.apache.spark.sql.SparkSession.sql(SparkSession.scala:601)
  ... 56 elided
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I think the analysis procedure should not be disturbed even though there was any hint could not be recognized.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Hadoop-2.7.7&lt;br/&gt;
Hive-2.3.6&lt;br/&gt;
Spark-3.0.0&lt;/p&gt;</environment>
        <key id="13315797">SPARK-32237</key>
            <summary>Cannot resolve column when put hint in the views of common table expression</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cltlfcjin">Lantao Jin</assignee>
                                    <reporter username="kernelforce">Kernel Force</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Jul 2020 06:38:36 +0000</created>
                <updated>Wed, 5 Aug 2020 07:02:48 +0000</updated>
                            <resolved>Fri, 24 Jul 2020 03:48:44 +0000</resolved>
                                    <version>3.0.0</version>
                                    <fixVersion>3.0.1</fixVersion>
                    <fixVersion>3.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="604800">168h</timeoriginalestimate>
                            <timeestimate seconds="604800">168h</timeestimate>
                                        <comments>
                            <comment id="17155085" author="cltlfcjin" created="Fri, 10 Jul 2020 04:09:05 +0000"  >&lt;p&gt;Thanks to report this. I am going to fix it.&lt;/p&gt;</comment>
                            <comment id="17155093" author="apachespark" created="Fri, 10 Jul 2020 04:37:58 +0000"  >&lt;p&gt;User &apos;LantaoJin&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/29062&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/29062&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17163304" author="apachespark" created="Thu, 23 Jul 2020 07:50:47 +0000"  >&lt;p&gt;User &apos;LantaoJin&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/29201&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/29201&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17163305" author="apachespark" created="Thu, 23 Jul 2020 07:50:53 +0000"  >&lt;p&gt;User &apos;LantaoJin&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/29201&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/29201&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17164118" author="cloud_fan" created="Fri, 24 Jul 2020 03:48:44 +0000"  >&lt;p&gt;Issue resolved by pull request 29201&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/29201&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/29201&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13320982">SPARK-32535</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13317432">SPARK-32347</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 16 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0gl9s:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>