<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:27:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-7504] NullPointerException when initializing SparkContext in YARN-cluster mode</title>
                <link>https://issues.apache.org/jira/browse/SPARK-7504</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;It is not clear for most users that, while running Spark on YARN a &lt;tt&gt;SparkContext&lt;/tt&gt; with a given execution plan can be run locally as &lt;tt&gt;yarn-client&lt;/tt&gt;, but can not deploy itself to the cluster. This is currently performed using &lt;tt&gt;org.apache.spark.deploy.yarn.Client&lt;/tt&gt;. &lt;font color=&quot;gray&quot;&gt; I think we should support deployment through &lt;tt&gt;SparkContext&lt;/tt&gt;, but this is not the point I wish to make here. &lt;/font&gt;&lt;/p&gt;

&lt;p&gt;Configuring a &lt;tt&gt;SparkContext&lt;/tt&gt; to deploy itself currently will yield an &lt;tt&gt;ERROR&lt;/tt&gt; while accessing &lt;tt&gt;spark.yarn.app.id&lt;/tt&gt; in  &lt;tt&gt;YarnClusterSchedulerBackend&lt;/tt&gt;, and after that a &lt;tt&gt;NullPointerException&lt;/tt&gt; while referencing the &lt;tt&gt;ApplicationMaster&lt;/tt&gt; instance.&lt;/p&gt;

&lt;p&gt;Spark should clearly inform the user that it might be running in &lt;tt&gt;yarn-cluster&lt;/tt&gt; mode without a proper submission using &lt;tt&gt;Client&lt;/tt&gt; and that deploying is not supported directly from &lt;tt&gt;SparkContext&lt;/tt&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12828579">SPARK-7504</key>
            <summary>NullPointerException when initializing SparkContext in YARN-cluster mode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Ehnalis">Zolt&#225;n Zvara</assignee>
                                    <reporter username="Ehnalis">Zolt&#225;n Zvara</reporter>
                        <labels>
                            <label>deployment</label>
                            <label>yarn</label>
                            <label>yarn-client</label>
                    </labels>
                <created>Sat, 9 May 2015 14:31:05 +0000</created>
                <updated>Sat, 16 May 2015 11:07:03 +0000</updated>
                            <resolved>Fri, 15 May 2015 19:17:31 +0000</resolved>
                                                    <fixVersion>1.4.0</fixVersion>
                                    <component>Deploy</component>
                    <component>YARN</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14536677" author="apachespark" created="Sat, 9 May 2015 15:19:20 +0000"  >&lt;p&gt;User &apos;ehnalis&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/6029&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/6029&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14536727" author="srowen" created="Sat, 9 May 2015 15:36:26 +0000"  >&lt;p&gt;I don&apos;t understand the scenario. How do you accidentally run in yarn-cluster mode?&lt;/p&gt;</comment>
                            <comment id="14536729" author="ehnalis" created="Sat, 9 May 2015 15:46:06 +0000"  >&lt;p&gt;I did not run in by accident. I was writing applications using IntelliJ IDEA and changed &lt;tt&gt;spark.master&lt;/tt&gt; on each run to test and debug in &lt;tt&gt;local&lt;/tt&gt; or &lt;tt&gt;yarn-client&lt;/tt&gt; mode. Both modes are supported by &lt;tt&gt;SparkContext&lt;/tt&gt;, but it can not deploy itself, so as I&apos;ve changed to &lt;tt&gt;yarn-cluster&lt;/tt&gt; (to deploy my app for a longer run), &lt;tt&gt;NullPointerExceptions&lt;/tt&gt; were thrown. I did not realize on the first and second time, deploying is only available through &lt;tt&gt;org.apache.spark.deploy.yarn.Client&lt;/tt&gt;. I thought there&apos;s an issue with my remote YARN cluster or the configuration.&lt;/p&gt;</comment>
                            <comment id="14536734" author="srowen" created="Sat, 9 May 2015 15:52:12 +0000"  >&lt;p&gt;I don&apos;t think that&apos;s supported, but in any event the error you seem to be solving is that you tried to run the AM but not through main()? This doesn&apos;t sound like something that should work.&lt;/p&gt;</comment>
                            <comment id="14536744" author="ehnalis" created="Sat, 9 May 2015 16:06:51 +0000"  >&lt;p&gt;I did not run ApplicationMaster directly myself. You can easily reproduce the problem simply by:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;picking a Spark example and&lt;/li&gt;
	&lt;li&gt;adding &lt;tt&gt;-Dspark.master=yarn-cluster&lt;/tt&gt; to VM options, or setting &lt;tt&gt;spark.master&lt;/tt&gt; through &lt;tt&gt;SparkContext&lt;/tt&gt;&apos;s configuration&lt;/li&gt;
	&lt;li&gt;then run it.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This seems to be a very common scenario to me.&lt;/p&gt;</comment>
                            <comment id="14536799" author="andrewor14" created="Sat, 9 May 2015 18:05:33 +0000"  >&lt;p&gt;Zoltan, what do you mean configuring a SparkContext to deploy itself? Did you run the application using the following command?&lt;/p&gt;

&lt;p&gt;bin/spark-submit --master yarn-cluster &lt;span class=&quot;error&quot;&gt;&amp;#91;... other options ...&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="14536820" author="ehnalis" created="Sat, 9 May 2015 18:31:28 +0000"  >&lt;p&gt;No, I did not use &lt;tt&gt;spark-submit&lt;/tt&gt;, but I ran a Spark program with &lt;tt&gt;java&lt;/tt&gt; (using IntelliJ basically) - as I&apos;ve said a few comments earlier.&lt;/p&gt;

&lt;p&gt;The problem from user point of view:&lt;br/&gt;
There is a user-facing API provided by &lt;tt&gt;SparkContext&lt;/tt&gt;, which can be configured with a &lt;tt&gt;SparkConf&lt;/tt&gt; that has a valid parameter named &lt;tt&gt;spark.master&lt;/tt&gt; with a valid value &lt;tt&gt;yarn-cluster&lt;/tt&gt;. If I use &lt;tt&gt;SparkContext&lt;/tt&gt; with this configuration and define a valid chain of RDDs, compile and run my JAVA code, it simply blows up. For example:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;pick any Spark example,&lt;/li&gt;
	&lt;li&gt;set &lt;tt&gt;spark.master&lt;/tt&gt; to &lt;tt&gt;yarn-cluster&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;run your code with JAVA.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Instead of blowing up with &lt;tt&gt;NullPointerExceptions&lt;/tt&gt;, Spark should warn the user that he or she can not deploy his or her application that way, because it is not supported.&lt;/p&gt;</comment>
                            <comment id="14537339" author="srowen" created="Sun, 10 May 2015 20:23:30 +0000"  >&lt;p&gt;&lt;tt&gt;SparkContext&lt;/tt&gt; isn&apos;t an API for launching a Spark app; &lt;tt&gt;spark-submit&lt;/tt&gt; is. Although you can get this to work it often takes more manual footwork to get it right. There&apos;s a new launcher API in 1.4 that is supposed to be a proper programmatic submission API.&lt;/p&gt;

&lt;p&gt;I can appreciate giving better errors in any event, even if it&apos;s something one isn&apos;t supposed to do. This seems pretty harmless as an improved error message, just in case.&lt;/p&gt;</comment>
                            <comment id="14537369" author="ehnalis" created="Sun, 10 May 2015 20:57:18 +0000"  >&lt;p&gt;&lt;tt&gt;SparkContext&lt;/tt&gt; can be easily configured to operate on local mode without any additional manual change, and can run in &lt;tt&gt;yarn-client&lt;/tt&gt; mode directly from IntelliJ &lt;tt&gt;java&lt;/tt&gt;, just needs an additional &lt;tt&gt;datanucleus-*&lt;/tt&gt; dependency to class-path and a JAR to be set.&lt;/p&gt;

&lt;p&gt;As far as I see this problem: if I buy a washing machine, configure it at home and if it blows up with &lt;tt&gt;ERROR&lt;/tt&gt; on the display, well, I would return it ASAP. But if it tells me &lt;tt&gt;The configured mode is not supported!&lt;/tt&gt;, I wouldn&apos;t think the object is malfunctioning.&lt;/p&gt;

&lt;p&gt;I&apos;m pleased that you think this could be improved.&lt;/p&gt;</comment>
                            <comment id="14538159" author="vanzin" created="Mon, 11 May 2015 16:48:07 +0000"  >&lt;p&gt;If I understand correctly, what you&apos;re doing is running the equivalent of this in you code, right:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SparkContext(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SparkConf().set(&lt;span class=&quot;code-quote&quot;&gt;&quot;spark.master&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;yarn-cluster&quot;&lt;/span&gt;))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That&apos;s not really supported, since that will not work in yarn-cluster mode, even if the ApplicationMaster launches successfully. I also took a look at your PR and that won&apos;t help. The fix here, if any, is to not allow the above code to work by throwing an exception early.&lt;/p&gt;</comment>
                            <comment id="14538337" author="ehnalis" created="Mon, 11 May 2015 18:14:45 +0000"  >&lt;p&gt;You are making a point. I will extend my solution to throw an error message earlier.&lt;/p&gt;</comment>
                            <comment id="14540017" author="apachespark" created="Tue, 12 May 2015 15:18:03 +0000"  >&lt;p&gt;User &apos;ehnalis&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/6083&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/6083&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14540019" author="ehnalis" created="Tue, 12 May 2015 15:18:39 +0000"  >&lt;p&gt;I&apos;ve extended my solution. It will throw an exception early by detecting if it has been run by the AM.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 28 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2eim7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12329359">1.4.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>