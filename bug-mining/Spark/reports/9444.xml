<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:35:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-46275] Protobuf: Permissive mode should return null rather than struct with null fields</title>
                <link>https://issues.apache.org/jira/browse/SPARK-46275</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Consider a protobuf with two fields &lt;tt&gt;message Person { string name = 1; int id = 2;&#160;&lt;/tt&gt;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The struct returned by &lt;tt&gt;from_protobuf(&quot;Person&quot;)&lt;/tt&gt; like this:
	&lt;ul&gt;
		&lt;li&gt;STRUCT&amp;lt;name STRING, id INT&amp;gt;&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;If the underlying binary record fails to deserialize, it results in a exception and query fails.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Buf if the option &lt;tt&gt;mode&lt;/tt&gt; is set to &lt;tt&gt;PERMISSIVE&lt;/tt&gt; , malformed records are tolerated &lt;tt&gt;null&lt;/tt&gt; is returned.
	&lt;ul&gt;
		&lt;li&gt;&lt;b&gt;BUT&lt;/b&gt;: The retuned struct looks like this {&quot;name: null, id: &quot;null&quot;}&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;This is not convenient to the user.&lt;/li&gt;
			&lt;li&gt;&lt;b&gt;Ideally,&lt;/b&gt; &lt;tt&gt;from_protobuf()&lt;/tt&gt; &lt;b&gt;should return&lt;/b&gt; &lt;tt&gt;null&lt;/tt&gt; &lt;b&gt;.&lt;/b&gt;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
		&lt;li&gt;&lt;tt&gt;from_protobuf()&lt;/tt&gt; borrowed the current behavior from &lt;tt&gt;from_avro()&lt;/tt&gt; implementation. It is not clear what the motivation was.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I think we should update the implementation to return &lt;tt&gt;null&lt;/tt&gt; rather than a struct with null-fields inside.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13560728">SPARK-46275</key>
            <summary>Protobuf: Permissive mode should return null rather than struct with null fields</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rangadi">Raghu Angadi</assignee>
                                    <reporter username="rangadi">Raghu Angadi</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 5 Dec 2023 22:54:49 +0000</created>
                <updated>Fri, 8 Dec 2023 22:42:58 +0000</updated>
                            <resolved>Fri, 8 Dec 2023 07:44:36 +0000</resolved>
                                    <version>3.4.2</version>
                    <version>3.5.0</version>
                    <version>4.0.0</version>
                                    <fixVersion>3.5.1</fixVersion>
                    <fixVersion>3.4.3</fixVersion>
                    <fixVersion>4.0.0</fixVersion>
                                    <component>Protobuf</component>
                    <component>Structured Streaming</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17793453" author="rangadi" created="Tue, 5 Dec 2023 23:00:04 +0000"  >&lt;p&gt;Context from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gengliang&quot; class=&quot;user-hover&quot; rel=&quot;gengliang&quot;&gt;gengliang&lt;/a&gt; about `from_avro()` behavior:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;This is the following JSON/CSV data source. On read failure, those file sources still try to fill the partial results instead of nulls. In Avro, it is hard to get partial parser result on error, so we simply create a row with all empty values.&#160;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17794566" author="gurwls223" created="Fri, 8 Dec 2023 07:44:36 +0000"  >&lt;p&gt;Fixed in &lt;a href=&quot;https://github.com/apache/spark/pull/44214&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/44214&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311120" key="com.pyxis.greenhopper.jira:gh-epic-link">
                        <customfieldname>Epic Link</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>SPARK-40653</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 48 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1m2kw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>