<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:42:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-23015] spark-submit fails when submitting several jobs in parallel</title>
                <link>https://issues.apache.org/jira/browse/SPARK-23015</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Spark Submit&apos;s launching library prints the command to execute the launcher (org.apache.spark.launcher.main) to a temporary text file, reads the result back into a variable, and then executes that command.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
set LAUNCHER_OUTPUT=%temp%\spark-&lt;span class=&quot;code-keyword&quot;&gt;class-&lt;/span&gt;launcher-output-%RANDOM%.txt
&lt;span class=&quot;code-quote&quot;&gt;&quot;%RUNNER%&quot;&lt;/span&gt; -Xmx128m -cp &lt;span class=&quot;code-quote&quot;&gt;&quot;%LAUNCH_CLASSPATH%&quot;&lt;/span&gt; org.apache.spark.launcher.Main %* &amp;gt; %LAUNCHER_OUTPUT%
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/apache/spark/blob/master/bin/spark-class2.cmd#L66&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;bin/spark-class2.cmd, L67&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;That temporary text file is given a pseudo-random name by the %RANDOM% env variable generator, which generates a number between 0 and 32767.&lt;/p&gt;

&lt;p&gt;This appears to be the cause of an error occurring when several spark-submit jobs are launched simultaneously. The following error is returned from stderr:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The process cannot access the file because it is being used by another process. The system cannot find the file&lt;br/&gt;
USER/AppData/Local/Temp/spark-class-launcher-output-RANDOM.txt.&lt;br/&gt;
The process cannot access the file because it is being used by another process.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;My hypothesis is that %RANDOM% is returning the same value for multiple jobs, causing the launcher library to attempt to write to the same file from multiple processes. Another mechanism is needed for reliably generating the names of the temporary files so that the concurrency issue is resolved.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows 10 (1709/16299.125)&lt;br/&gt;
Spark 2.3.0&lt;br/&gt;
Java 8, Update 151&lt;/p&gt;</environment>
        <key id="13129698">SPARK-23015</key>
            <summary>spark-submit fails when submitting several jobs in parallel</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="hughza">Hugh Zabriskie</reporter>
                        <labels>
                            <label>bulk-closed</label>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 9 Jan 2018 23:06:13 +0000</created>
                <updated>Wed, 29 May 2024 02:09:31 +0000</updated>
                            <resolved>Wed, 29 May 2024 02:09:17 +0000</resolved>
                                    <version>2.0.0</version>
                    <version>2.0.1</version>
                    <version>2.0.2</version>
                    <version>2.1.0</version>
                    <version>2.1.1</version>
                    <version>2.1.2</version>
                    <version>2.2.0</version>
                    <version>2.2.1</version>
                                    <fixVersion>4.0.0</fixVersion>
                                    <component>Spark Submit</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16319395" author="srowen" created="Tue, 9 Jan 2018 23:23:50 +0000"  >&lt;p&gt;CC &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vanzin&quot; class=&quot;user-hover&quot; rel=&quot;vanzin&quot;&gt;vanzin&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16319399" author="vanzin" created="Tue, 9 Jan 2018 23:26:22 +0000"  >&lt;p&gt;The &lt;tt&gt;%RANDOM%&lt;/tt&gt; thing is not something I added originally - I avoided it exactly because of this kind of problem. Need to figure out why it was added later, but Windows is not really on my list of things to prioritize at the moment...&lt;/p&gt;</comment>
                            <comment id="16654072" author="parvesh.bansal@netapp.com" created="Wed, 17 Oct 2018 19:21:00 +0000"  >&lt;p&gt;Hi Hugh Zabriskie&lt;/p&gt;

&lt;p&gt;I was following the issue , as I am also facing the same challenges while working under windows environment &lt;span class=&quot;error&quot;&gt;&amp;#91;using python threads to launch multiple spark-submit&amp;#93;&lt;/span&gt;&lt;br/&gt;
Can you please let me know the current resolution or workaround for windows, is it fixed for Linux environment?&lt;/p&gt;

&lt;p&gt;Please suggest.&lt;/p&gt;

&lt;p&gt;Thanks and Regards&lt;br/&gt;
Parvesh K Bansal&lt;br/&gt;
--------------------------------------&lt;/p&gt;</comment>
                            <comment id="16662750" author="kevingre" created="Wed, 24 Oct 2018 19:44:22 +0000"  >&lt;p&gt;One workaround is to create a temp directory in temp and set that to be the TEMP directory for that process being launched. This way each process you launch gets its on temp speace. For example, when launching from C#:&lt;/p&gt;

&lt;p&gt;{{&lt;br/&gt;
            // Workaround for Spark bug &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-23015&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-23015&lt;/a&gt;&lt;br/&gt;
            // Spark Submit&apos;s launching library prints the command to execute the launcher (org.apache.spark.launcher.main) &lt;br/&gt;
            // to a temporary text file (&quot;%TEMP%\spark-class-launcher-output-%RANDOM%.txt&quot;), reads the result back into a variable,&lt;br/&gt;
            // and then executes that command. %RANDOM% does not have sufficent range to avoid collisions when launching many Spark processes.&lt;br/&gt;
            // As a result the Spark processes end up running one anothers&apos; commands (silently) or gives an error like:&lt;br/&gt;
            // &quot;The process cannot access the file because it is being used by another process.&quot;&lt;br/&gt;
            // &quot;The system cannot find the file C:\VsoAgent&amp;#95;work&amp;#95;temp\spark-class-launcher-output-654.txt.&quot;&lt;br/&gt;
            // As a workaround, we give each run its own TEMP directory, we create using a GUID.&lt;br/&gt;
            string newTemp = null;&lt;br/&gt;
            if (AppRuntimeEnvironment.IsRunningOnWindows())&lt;/p&gt;
            {
                var ourTemp = Environment.GetEnvironmentVariable(&quot;TEMP&quot;);
                var newDirName = &quot;dprep&quot; + Convert.ToBase64String(Guid.NewGuid().ToByteArray()).Substring(0, 22).Replace(&apos;/&apos;, &apos;-&apos;);
                newTemp = Path.Combine(ourTemp, newDirName);
                Directory.CreateDirectory(newTemp);
                start.Environment[&quot;TEMP&quot;] = newTemp;
            }
&lt;p&gt;}}&lt;/p&gt;</comment>
                            <comment id="16996080" author="lartcev" created="Sat, 14 Dec 2019 02:22:27 +0000"  >&lt;p&gt;Guys, why not to invoke %RANDOM% multiple times? Just change the&#160;spark-class2.cmd&lt;/p&gt;

&lt;p&gt;set LAUNCHER_OUTPUT=%temp%\spark-class-launcher-output-%RANDOM%.txt&lt;/p&gt;

&lt;p&gt;to&lt;/p&gt;

&lt;p&gt;set LAUNCHER_OUTPUT=%temp%\spark-class-launcher-output-%RANDOM%%RANDOM%%RANDOM%.txt&lt;/p&gt;</comment>
                            <comment id="16996082" author="lartcev" created="Sat, 14 Dec 2019 02:24:26 +0000"  >&lt;p&gt;We invoke spark-submit from Java code in parallel too&lt;/p&gt;</comment>
                            <comment id="16997604" author="lartcev" created="Mon, 16 Dec 2019 19:56:30 +0000"  >&lt;p&gt;Here is working solution:&lt;/p&gt;

&lt;p&gt;set LAUNCHER_OUTPUT=%temp%\spark-class-launcher-output-%RANDOM%%TIME::=0%.txt&lt;/p&gt;

&lt;p&gt;instruction&#160;::=0 is about to remove char &apos;:&apos; from timestamp&lt;/p&gt;

&lt;p&gt;I&apos;ve checked and tested this solution. No need to make a crutches in code.&lt;/p&gt;</comment>
                            <comment id="16997669" author="kevingre" created="Mon, 16 Dec 2019 22:02:51 +0000"  >&lt;p&gt;%TIME% has a granularity of 10ms, so while this does reduce the probability of collision, it does not remove the problem. Neither does using multiple RANDOM&apos;s as this is pseudo random number. See &lt;a href=&quot;https://devblogs.microsoft.com/oldnewthing/20100617-00/?p=13673&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://devblogs.microsoft.com/oldnewthing/20100617-00/?p=13673&lt;/a&gt; &quot;Why cmd.exe&apos;s %RANDOM% isn&apos;t so random&quot;. Once the seed is set from the current time using a granularity of a second, the sequence of numbers coming from %RANDOM% is fixed, so if using %RANDOM% will cause a collision, then so will %RANDOM%%RANDOM%%RANDOM%%RANDOM%...&lt;/p&gt;</comment>
                            <comment id="16997724" author="kevingre" created="Tue, 17 Dec 2019 00:05:16 +0000"  >&lt;p&gt;Here is something that may help craft a complete solution that you can change in the Spark the scripts. This uses VB script to create a GUID and assign it to an environment variable. It depends on cscript which is part of Windows since Windows 95. Change the two %%i it just %i to run outside a batch program. Instead of writing a temp .vbs file, just include it with the script now using %RANDOM%.&lt;/p&gt;

&lt;p&gt;echo WScript.StdOut.WriteLine Mid(CreateObject(&quot;Scriptlet.TypeLib&quot;).GUID, 2, 36) &amp;gt; %TEMP%\uuid.vbs&lt;br/&gt;
for /f %%i in (&apos;cscript //NoLogo %TEMP%\uuid.vbs&apos;) do @set UUID=%%i&lt;br/&gt;
echo made a UUID: %UUID%&lt;/p&gt;

&lt;p&gt;This code will collide on writing uudi.vbs so instead, a uuid.vbs (say called makeuuid.vbs) file should be added to the scripts.&lt;/p&gt;</comment>
                            <comment id="17850230" author="gurwls223" created="Wed, 29 May 2024 02:09:31 +0000"  >&lt;p&gt;Fixed in &lt;a href=&quot;https://github.com/apache/spark/pull/43706&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/43706&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 23 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3oppr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>