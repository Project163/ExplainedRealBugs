<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:57:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-22585] Url encoding of jar path expected?</title>
                <link>https://issues.apache.org/jira/browse/SPARK-22585</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;I am calling &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;sparkContext.addJar&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; method with path to a local jar I want to add. Example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;/home/me/.coursier/cache/v1/https/artifactory.com%3A443/path/to.jar&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;. As a result I get an exception saying&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Failed to add /home/me/.coursier/cache/v1/https/artifactory.com%3A443/path/to.jar to Spark environment. Stacktrace:
java.io.FileNotFoundException: Jar /home/me/.coursier/cache/v1/https/artifactory.com:443/path/to.jar not found
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Important part to notice here is that colon character is url encoded in path I want to use but exception is complaining about path in decoded form. This is caused by this line of code from implementation (&lt;a href=&quot;https://github.com/apache/spark/blob/v2.2.0/core/src/main/scala/org/apache/spark/SparkContext.scala#L1833&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;see here&lt;/a&gt;):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; | &lt;span class=&quot;code-quote&quot;&gt;&quot;file&quot;&lt;/span&gt; =&amp;gt; addJarFile(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(uri.getPath))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It uses &lt;a href=&quot;https://docs.oracle.com/javase/7/docs/api/java/net/URI.html#getPath()&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;getPath&lt;/a&gt; method of &lt;a href=&quot;https://docs.oracle.com/javase/7/docs/api/java/net/URI.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java.net.URI&lt;/a&gt; which url decodes the path. I believe method &lt;a href=&quot;https://docs.oracle.com/javase/7/docs/api/java/net/URI.html#getRawPath()&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;getRawPath&lt;/a&gt; should be used here which keeps path string in original form.&lt;/p&gt;

&lt;p&gt;I tend to see this as a bug since I want to use my dependencies resolved from artifactory with port directly. Is there some specific reason for this or can we fix this?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</description>
                <environment></environment>
        <key id="13120325">SPARK-22585</key>
            <summary>Url encoding of jar path expected?</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dubovsky">Jakub Dubovsky</assignee>
                                    <reporter username="dubovsky">Jakub Dubovsky</reporter>
                        <labels>
                    </labels>
                <created>Wed, 22 Nov 2017 20:52:21 +0000</created>
                <updated>Mon, 12 Dec 2022 18:10:36 +0000</updated>
                            <resolved>Thu, 30 Nov 2017 01:25:20 +0000</resolved>
                                    <version>2.2.0</version>
                                    <fixVersion>2.3.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16263512" author="srowen" created="Wed, 22 Nov 2017 22:53:57 +0000"  >&lt;p&gt;Does the real file name contain &quot;%3A443&quot; or &quot;:443&quot;? &lt;/p&gt;</comment>
                            <comment id="16263979" author="dubovsky" created="Thu, 23 Nov 2017 08:36:18 +0000"  >&lt;p&gt;Real file path is exactly the same as one I am passing into add jar. It contains &quot;%3A443&quot;.&lt;/p&gt;</comment>
                            <comment id="16264129" author="srowen" created="Thu, 23 Nov 2017 10:31:54 +0000"  >&lt;p&gt;Hm, I think the issue is rather than the path needs to be encoded before becoming part of the URI. The URI &lt;tt&gt;&lt;a href=&quot;file:/home/me/.coursier/cache/v1/https/artifactory.com%3A443/path/to.jar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:/home/me/.coursier/cache/v1/https/artifactory.com%3A443/path/to.jar&lt;/a&gt;&lt;/tt&gt; is not one that names your file; it&apos;s &lt;tt&gt;&lt;a href=&quot;file:/home/me/.coursier/cache/v1/https/artifactory.com%253A443/path/to.jar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:/home/me/.coursier/cache/v1/https/artifactory.com%253A443/path/to.jar&lt;/a&gt;&lt;/tt&gt; (escaped %). That may be a workaround here.&lt;br/&gt;
&lt;tt&gt;/home/me/.coursier/cache/v1/https/artifactory.com%3A443/path/to.jar&lt;/tt&gt; is however a valid and correct local path to the file, and that&apos;s what the argument is meant to be. So the code should do the encoding. I&apos;m aware that there are a number of places that probably turn paths into URIs, so would be best to try to update all issues of this form. I think it&apos;s low-risk as URI encoding won&apos;t do anything for most paths, and where it does, it&apos;s probably essential.&lt;/p&gt;</comment>
                            <comment id="16264234" author="dubovsky" created="Thu, 23 Nov 2017 11:54:33 +0000"  >&lt;p&gt;I am not sure about adding encoding step into implementation of addJar method. It&apos;s not about encoding whole path as a string since you want to keep some characters literally (&apos;:&apos;, &apos;/&apos; possibly others). So the code would first need to parse the path to get only path segments and encode those. This most probably leads to using URI again at which point this starts to be circular problem. Moreover I am not sure what is the point of encoding path segments only to ask URI to decode it...&lt;/p&gt;

&lt;p&gt;I also think that it makes sense to decode the segment only inside of a logic accessing a value of that segment. If I work with url/path as a whole I want to keep it parsable and therefore keep special characters encoded. This is the thinking I would personally use to decide which version (getPath/getRawPath) should be used in particular scenarios across spark code base even though I must admit I have very little insight into these other URI usecases &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16264392" author="srowen" created="Thu, 23 Nov 2017 14:25:54 +0000"  >&lt;p&gt;Yes, I mean escaping the path only; the host and scheme and so on may use reserved characters for their intended usage. I think that&apos;s the context here where it&apos;s just paths being turned into local file URIs.&lt;/p&gt;

&lt;p&gt;A URI is the right representation in this code but needs to represent the right path. I don&apos;t see any issue with that, nor decoding. It&apos;s not round-tripping for nothing.&lt;/p&gt;

&lt;p&gt;I don&apos;t think the representation depends on usage. The URI&apos;s representation simply needs to correctly represent the resource. That&apos;s not quite happening here, and it&apos;s because special chars aren&apos;t escaped in the right places.&lt;/p&gt;</comment>
                            <comment id="16264456" author="dubovsky" created="Thu, 23 Nov 2017 15:14:04 +0000"  >&lt;p&gt;I just tried how URI behaves on some examples and learned that it is doing something else then I think. So yes either encoding a path or using getRawPath are both valid solutions to me. Should I create PR for this or what is next step?&lt;/p&gt;</comment>
                            <comment id="16266859" author="dubovsky" created="Mon, 27 Nov 2017 14:19:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srowen&quot; class=&quot;user-hover&quot; rel=&quot;srowen&quot;&gt;srowen&lt;/a&gt; I&apos;d like to understand more about solution you prefer. So by addJar scaladoc these schemes are supported: null, file, local, hdfs, http, https, ftp. Now semantics of argument to addJar is the same as for URI single arg constructor (with exception of local scheme). This means for example that path is expected to be url encoded.&lt;/p&gt;

&lt;p&gt;Here as a fix we want to remove requirement for path to be encoded. Do we want to do this for all supported schemes named above? Or only for null, file and local?&lt;/p&gt;

&lt;p&gt;After we sync in this question I will post a code suggestion how to handle this. Discussion over code will be more fruitful I believe.&lt;/p&gt;</comment>
                            <comment id="16266941" author="srowen" created="Mon, 27 Nov 2017 15:30:25 +0000"  >&lt;p&gt;URI encoding applies to all of those URI schemes. I don&apos;t think they even differ in semantics for the URI path part.&lt;/p&gt;

&lt;p&gt;I would expect that where users supply URIs, that they are already valid URIs &amp;#8211; properly encoded.&lt;br/&gt;
Where users supply a local file path, there is no reason to expect that path is URI-encoded. A path is not a URI. Hence if it is made into a URI, it needs to be encoded somehow.&lt;/p&gt;</comment>
                            <comment id="16268888" author="apachespark" created="Tue, 28 Nov 2017 15:18:04 +0000"  >&lt;p&gt;User &apos;james64&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/19834&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/19834&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16268892" author="dubovsky" created="Tue, 28 Nov 2017 15:19:21 +0000"  >&lt;p&gt;I have created a PR where we can agree on a code to address this.&lt;/p&gt;</comment>
                            <comment id="16271976" author="gurwls223" created="Thu, 30 Nov 2017 01:25:20 +0000"  >&lt;p&gt;Issue resolved by pull request 19834&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/19834&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/19834&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 50 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3n45r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>