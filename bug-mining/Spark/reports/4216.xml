<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:48:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-18086] Regression: Hive variables no longer work in Spark 2.0</title>
                <link>https://issues.apache.org/jira/browse/SPARK-18086</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;The behavior of variables in the SQL shell has changed from 1.6 to 2.0. Specifically, --hivevar name=value and &lt;tt&gt;SET hivevar:name=value&lt;/tt&gt; no longer work. Queries that worked correctly in 1.6 will either fail or produce unexpected results in 2.0 so I think this is a regression that should be addressed.&lt;/p&gt;

&lt;p&gt;Hive and Spark 1.6 work like this:&lt;br/&gt;
1. Command-line args --hiveconf and --hivevar can be used to set session properties. --hiveconf properties are added to the Hadoop Configuration.&lt;br/&gt;
2. &lt;tt&gt;SET&lt;/tt&gt; adds a Hive Configuration property, &lt;tt&gt;SET hivevar:&amp;lt;name&amp;gt;=&amp;lt;value&amp;gt;&lt;/tt&gt; adds a Hive var.&lt;br/&gt;
3. Hive vars can be substituted into queries by name, and Configuration properties can be substituted using &lt;tt&gt;hiveconf:name&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;In 2.0, hiveconf, sparkconf, and conf variable prefixes are all removed, then the value in SQLConf for the rest of the key is returned. SET adds properties to the session config and (according to &lt;a href=&quot;https://github.com/apache/spark/blob/master/sql/core/src/main/scala/org/apache/spark/sql/RuntimeConfig.scala#L28&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;a comment&lt;/a&gt;) the Hadoop configuration &quot;during I/O&quot;.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Hive and Spark 1.6.1 behavior&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[user@host:~]: spark-sql --hiveconf test.conf=1 --hivevar test.&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;=2
spark-sql&amp;gt; select &lt;span class=&quot;code-quote&quot;&gt;&quot;${hiveconf:test.conf}&quot;&lt;/span&gt;;
1
spark-sql&amp;gt; select &lt;span class=&quot;code-quote&quot;&gt;&quot;${test.conf}&quot;&lt;/span&gt;;
${test.conf}
spark-sql&amp;gt; select &lt;span class=&quot;code-quote&quot;&gt;&quot;${hivevar:test.&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;}&quot;&lt;/span&gt;;
2
spark-sql&amp;gt; select &lt;span class=&quot;code-quote&quot;&gt;&quot;${test.&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;}&quot;&lt;/span&gt;;
2
spark-sql&amp;gt; set test.set=3;
SET test.set=3
spark-sql&amp;gt; select &lt;span class=&quot;code-quote&quot;&gt;&quot;${test.set}&quot;&lt;/span&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;${test.set}&quot;&lt;/span&gt;
spark-sql&amp;gt; select &lt;span class=&quot;code-quote&quot;&gt;&quot;${hivevar:test.set}&quot;&lt;/span&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;${hivevar:test.set}&quot;&lt;/span&gt;
spark-sql&amp;gt; select &lt;span class=&quot;code-quote&quot;&gt;&quot;${hiveconf:test.set}&quot;&lt;/span&gt;
3
spark-sql&amp;gt; set hivevar:test.setvar=4;
SET hivevar:test.setvar=4
spark-sql&amp;gt; select &lt;span class=&quot;code-quote&quot;&gt;&quot;${hivevar:test.setvar}&quot;&lt;/span&gt;;
4
spark-sql&amp;gt; select &lt;span class=&quot;code-quote&quot;&gt;&quot;${test.setvar}&quot;&lt;/span&gt;;
4
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Spark 2.0.0 behavior&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[user@host:~]: spark-sql --hiveconf test.conf=1 --hivevar test.&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;=2
spark-sql&amp;gt; select &lt;span class=&quot;code-quote&quot;&gt;&quot;${hiveconf:test.conf}&quot;&lt;/span&gt;;
1
spark-sql&amp;gt; select &lt;span class=&quot;code-quote&quot;&gt;&quot;${test.conf}&quot;&lt;/span&gt;;
1
spark-sql&amp;gt; select &lt;span class=&quot;code-quote&quot;&gt;&quot;${hivevar:test.&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;}&quot;&lt;/span&gt;;
${hivevar:test.&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;}
spark-sql&amp;gt; select &lt;span class=&quot;code-quote&quot;&gt;&quot;${test.&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;}&quot;&lt;/span&gt;;
${test.&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;}
spark-sql&amp;gt; set test.set=3;
test.set        3
spark-sql&amp;gt; select &lt;span class=&quot;code-quote&quot;&gt;&quot;${test.set}&quot;&lt;/span&gt;;
3
spark-sql&amp;gt; set hivevar:test.setvar=4;
hivevar:test.setvar      4
spark-sql&amp;gt; select &lt;span class=&quot;code-quote&quot;&gt;&quot;${hivevar:test.setvar}&quot;&lt;/span&gt;;
4
spark-sql&amp;gt; select &lt;span class=&quot;code-quote&quot;&gt;&quot;${test.setvar}&quot;&lt;/span&gt;;
${test.setvar}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13014946">SPARK-18086</key>
            <summary>Regression: Hive variables no longer work in Spark 2.0</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rdblue">Ryan Blue</assignee>
                                    <reporter username="rdblue">Ryan Blue</reporter>
                        <labels>
                    </labels>
                <created>Tue, 25 Oct 2016 00:35:19 +0000</created>
                <updated>Sun, 7 May 2017 04:07:59 +0000</updated>
                            <resolved>Tue, 8 Nov 2016 01:35:37 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15630027" author="apachespark" created="Wed, 2 Nov 2016 18:47:05 +0000"  >&lt;p&gt;User &apos;rdblue&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/15738&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/15738&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15630045" author="rdblue" created="Wed, 2 Nov 2016 18:50:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rxin&quot; class=&quot;user-hover&quot; rel=&quot;rxin&quot;&gt;rxin&lt;/a&gt;, I think the fix for this should go into 2.1.0&lt;/p&gt;

&lt;p&gt;The linked PR stores Hive variables in the Hive SessionState and makes them accessable as either &lt;tt&gt;hivevar:&amp;lt;name&amp;gt;&lt;/tt&gt; or &lt;tt&gt;&amp;lt;name&amp;gt;&lt;/tt&gt; with higher precedence than configuration variables, to match the behavior of Hive if there is a conflict.&lt;/p&gt;</comment>
                            <comment id="15630057" author="rxin" created="Wed, 2 Nov 2016 18:55:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rdblue&quot; class=&quot;user-hover&quot; rel=&quot;rdblue&quot;&gt;rdblue&lt;/a&gt; There are two separate issues here I believe:&lt;/p&gt;

&lt;p&gt;1. Parsing hiveconf in spark-sql shell.&lt;br/&gt;
2. Having separate config values.&lt;/p&gt;

&lt;p&gt;1 makes sense to me for backward compatibility. How much do you care about 2? I&apos;d argue it&apos;s a somewhat esoteric feature to require precedence in hvieconf vs hivevar....&lt;/p&gt;</comment>
                            <comment id="15630132" author="rdblue" created="Wed, 2 Nov 2016 19:20:46 +0000"  >&lt;p&gt;Hive variables are set on the Hive SessionState and I think it is a good idea to continue storing them there in case Hive needs to access them. If that is the case, then it is necessary to decide which set of values is checked first: configuration or variables. To match Hive&apos;s behavior, I went with variables.&lt;/p&gt;</comment>
                            <comment id="15630718" author="rxin" created="Wed, 2 Nov 2016 22:18:03 +0000"  >&lt;p&gt;The thing is that we don&apos;t really propagate Hive&apos;s session state over to most places, except to the part that connects to the metastore. What we do propagate is to send all the settings from SQLConf over to Hadoop Configuration and HiveConf.&lt;/p&gt;

&lt;p&gt;It seems like this would solve almost all your problems by just implementing parsing hiveconf in spark-sql shell.&lt;/p&gt;</comment>
                            <comment id="15630849" author="rdblue" created="Wed, 2 Nov 2016 23:11:25 +0000"  >&lt;p&gt;What is the rationale for propagating configuration but not variables?&lt;/p&gt;

&lt;p&gt;This also handles the case where there are collisions, though that is unlikely.&lt;/p&gt;</comment>
                            <comment id="15630855" author="rxin" created="Wed, 2 Nov 2016 23:13:51 +0000"  >&lt;p&gt;Because the execution code no longer depends on Hive&apos;s internals. Only the catalog (metastore) depends on Hive internals, which doesn&apos;t use session variables I believe.&lt;/p&gt;</comment>
                            <comment id="15634172" author="rxin" created="Thu, 3 Nov 2016 20:37:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rdblue&quot; class=&quot;user-hover&quot; rel=&quot;rdblue&quot;&gt;rdblue&lt;/a&gt; Does my explanation make sense? Can you change the pr (or have a new pr) to just do the command line argument so we can get that into 2.1?&lt;/p&gt;</comment>
                            <comment id="15634605" author="rdblue" created="Thu, 3 Nov 2016 23:05:54 +0000"  >&lt;p&gt;Yeah, I&apos;ll update the PR.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12951324">SPARK-13983</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 2 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i35c6v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>