<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:29:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-9109] Unpersist a graph object does not work properly</title>
                <link>https://issues.apache.org/jira/browse/SPARK-9109</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Unpersist a graph object does not work properly.&lt;/p&gt;

&lt;p&gt;Here is the code to produce &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.graphx._
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.rdd.RDD
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.slf4j.LoggerFactory
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.graphx.util.GraphGenerators

val graph: Graph[&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;] =
  GraphGenerators.logNormalGraph(sc, numVertices = 100).mapVertices( (id, _) =&amp;gt; id.toLong ).mapEdges( e =&amp;gt; e.attr.toLong)
  
graph.cache().numEdges
graph.unpersist()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There should not be any cached RDDs in storage (&lt;a href=&quot;http://localhost:4040/storage/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:4040/storage/&lt;/a&gt;).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12845635">SPARK-9109</key>
            <summary>Unpersist a graph object does not work properly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tien-dung.le">Tien-Dung LE</assignee>
                                    <reporter username="tien-dung.le">Tien-Dung LE</reporter>
                        <labels>
                    </labels>
                <created>Thu, 16 Jul 2015 15:44:31 +0000</created>
                <updated>Sun, 19 Jul 2015 08:13:48 +0000</updated>
                            <resolved>Sat, 18 Jul 2015 21:28:14 +0000</resolved>
                                    <version>1.3.1</version>
                    <version>1.4.0</version>
                                    <fixVersion>1.4.2</fixVersion>
                    <fixVersion>1.5.0</fixVersion>
                                    <component>GraphX</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14630459" author="srowen" created="Thu, 16 Jul 2015 22:32:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tien-dung.le&quot; class=&quot;user-hover&quot; rel=&quot;tien-dung.le&quot;&gt;tien-dung.le&lt;/a&gt; you need to read &lt;a href=&quot;https://cwiki.apache.org/confluence/display/SPARK/Contributing+to+Spark&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/display/SPARK/Contributing+to+Spark&lt;/a&gt;  This JIRA has some problems I fixed, like priority and component.&lt;/p&gt;</comment>
                            <comment id="14630467" author="srowen" created="Thu, 16 Jul 2015 22:41:49 +0000"  >&lt;p&gt;unpersist() works correctly actually; it&apos;s that the cached RDDs are attached to other Graphs you create in this process. There are 3 here; think of it as &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;val graph1 = GraphGenerators.logNormalGraph(sc, numVertices = 100)
val graph2 = graph1.mapVertices( (id, _) =&amp;gt; id.toLong )
val graph3 = graph2.mapEdges( e =&amp;gt; e.attr.toLong)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You&apos;ll find 1 of the 2 RDDs left over is from graph1, so call unpersist() on it.&lt;/p&gt;

&lt;p&gt;There is a &apos;leaked&apos; cached edges RDD in here somewhere though, I think, since I&apos;m still left with one when I try this.&lt;br/&gt;
I think there are a number of issues like this in Graphx, where RDDs are cached but not obviously cleaned up by an unpersist().&lt;/p&gt;

&lt;p&gt;Can you try this out, debug, and see if you can pinpoint where the edges RDD comes from? &lt;/p&gt;</comment>
                            <comment id="14630941" author="tien-dung.le" created="Fri, 17 Jul 2015 08:05:35 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sowen&quot; class=&quot;user-hover&quot; rel=&quot;sowen&quot;&gt;sowen&lt;/a&gt;. Indeed, there is still a cached edges RDD. I think this RDD is left from the graph construction in GraphImpl.scala, more precisely at fromEdgeRDD() function.&lt;/p&gt;

&lt;p&gt;Here is the latest code follow your suggestion.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.graphx._
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.rdd.RDD
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.slf4j.LoggerFactory
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.graphx.util.GraphGenerators

val graph1 = GraphGenerators.logNormalGraph(sc, numVertices = 100)
val graph2 = graph1.mapVertices( (id, _) =&amp;gt; id.toLong )
val graph3 = graph2.mapEdges( e =&amp;gt; e.attr.toLong)
  
graph3.cache().numEdges
graph3.unpersist()
graph2.unpersist()
graph1.unpersist()
graph2.unpersist()
graph3.unpersist()

sc.getPersistentRDDs.foreach( r =&amp;gt; println( r._2.toString))

/*  
GraphImpl.scala

&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; def fromEdgeRDD[VD: ClassTag, ED: ClassTag](
      edges: EdgeRDDImpl[ED, VD],
      defaultVertexAttr: VD,
      edgeStorageLevel: StorageLevel,
      vertexStorageLevel: StorageLevel): GraphImpl[VD, ED] = {
    val edgesCached = edges.withTargetStorageLevel(edgeStorageLevel).cache()
    val vertices = VertexRDD.fromEdges(edgesCached, edgesCached.partitions.size, defaultVertexAttr)
      .withTargetStorageLevel(vertexStorageLevel)
    fromExistingRDDs(vertices, edgesCached)
  }
*/
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

</comment>
                            <comment id="14631018" author="srowen" created="Fri, 17 Jul 2015 08:39:17 +0000"  >&lt;p&gt;Yes, we should expect that calling unpersist() (just once) on all Graph objects that have been created should result in no cached RDDs. Either this should not be cached, or, it should somehow be un-persisted in unpersist(). Can you propose a PR with a change along these lines, for &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ankurd&quot; class=&quot;user-hover&quot; rel=&quot;ankurd&quot;&gt;ankurd&lt;/a&gt; to look at?&lt;/p&gt;</comment>
                            <comment id="14631081" author="tien-dung.le" created="Fri, 17 Jul 2015 09:19:16 +0000"  >&lt;p&gt;I think the cache is done in purpose so we should keep it. The solution is to keep all cached RDDs and unpersist them later (when the graph.unpersist is called. &lt;/p&gt;

&lt;p&gt;I can propose a change for that but it would be very kind of you to refer me to a document (produce) how to make a change and create a PR.&lt;/p&gt;</comment>
                            <comment id="14631094" author="srowen" created="Fri, 17 Jul 2015 09:35:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/SPARK/Contributing+to+Spark&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/display/SPARK/Contributing+to+Spark&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14631404" author="apachespark" created="Fri, 17 Jul 2015 14:33:03 +0000"  >&lt;p&gt;User &apos;tien-dungle&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/7469&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/7469&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14631412" author="tien-dung.le" created="Fri, 17 Jul 2015 14:37:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sowen&quot; class=&quot;user-hover&quot; rel=&quot;sowen&quot;&gt;sowen&lt;/a&gt; This is my first PR for spark so I am not sure how to process. Could you kindly have a first look?&lt;/p&gt;

&lt;p&gt;PS: I did run ./dev/run-tests. It passed &quot;Scalastyle checks&quot; but il failed on python part&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;.../spark/dev/lint-python: line 64: syntax error near unexpected token `&amp;gt;&apos;
.../spark/dev/lint-python: line 64: `    easy_install -d &lt;span class=&quot;code-quote&quot;&gt;&quot;$PYLINT_HOME&quot;&lt;/span&gt; pylint==1.4.4 &amp;amp;&amp;gt;&amp;gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;$PYLINT_INSTALL_INFO&quot;&lt;/span&gt;&apos;
[error] running .../spark/dev/lint-python ; received &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; code 2
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14632613" author="tien-dung.le" created="Sat, 18 Jul 2015 21:28:14 +0000"  >&lt;p&gt;The change has been merged at &lt;a href=&quot;https://github.com/apache/spark/pull/7469&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/7469&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 18 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2hcgf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>