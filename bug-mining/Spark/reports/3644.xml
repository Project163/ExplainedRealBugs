<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:44:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-15678] Not use cache on appends and overwrites</title>
                <link>https://issues.apache.org/jira/browse/SPARK-15678</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;SparkSQL currently doesn&apos;t drop caches if the underlying data is overwritten.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;val dir = &lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/test&quot;&lt;/span&gt;
sqlContext.range(1000).write.mode(&lt;span class=&quot;code-quote&quot;&gt;&quot;overwrite&quot;&lt;/span&gt;).parquet(dir)
val df = sqlContext.read.parquet(dir).cache()
df.count() &lt;span class=&quot;code-comment&quot;&gt;// outputs 1000
&lt;/span&gt;
sqlContext.range(10).write.mode(&lt;span class=&quot;code-quote&quot;&gt;&quot;overwrite&quot;&lt;/span&gt;).parquet(dir)
sqlContext.read.parquet(dir).count() &lt;span class=&quot;code-comment&quot;&gt;// outputs 1000 instead of 10 &amp;lt;---- We are still using the cached dataset&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12974322">SPARK-15678</key>
            <summary>Not use cache on appends and overwrites</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sameerag">Sameer Agarwal</assignee>
                                    <reporter username="sameerag">Sameer Agarwal</reporter>
                        <labels>
                    </labels>
                <created>Tue, 31 May 2016 18:58:47 +0000</created>
                <updated>Sat, 25 Feb 2017 05:57:12 +0000</updated>
                            <resolved>Sat, 11 Jun 2016 03:43:40 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="15308372" author="apachespark" created="Tue, 31 May 2016 19:03:04 +0000"  >&lt;p&gt;User &apos;sameeragarwal&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/13419&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/13419&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15321249" author="apachespark" created="Wed, 8 Jun 2016 19:06:07 +0000"  >&lt;p&gt;User &apos;sameeragarwal&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/13566&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/13566&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15325685" author="davies" created="Sat, 11 Jun 2016 03:43:40 +0000"  >&lt;p&gt;Issue resolved by pull request 13566&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/13566&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/13566&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15877513" author="gen" created="Wed, 22 Feb 2017 05:38:19 +0000"  >&lt;p&gt;hi, I found a bug which is probably related with this issue.&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sameerag&quot; class=&quot;user-hover&quot; rel=&quot;sameerag&quot;&gt;sameerag&lt;/a&gt;&lt;br/&gt;
Please consider the following code.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.sql.DataFrame

def f(data: DataFrame): DataFrame = {
  val df = data.filter(&lt;span class=&quot;code-quote&quot;&gt;&quot;id&amp;gt;10&quot;&lt;/span&gt;)
  df.cache
  df.count
  df
}

f(spark.range(100).asInstanceOf[DataFrame]).count &lt;span class=&quot;code-comment&quot;&gt;// output 89 which is correct
&lt;/span&gt;f(spark.range(1000).asInstanceOf[DataFrame]).count &lt;span class=&quot;code-comment&quot;&gt;// output 989 which is correct
&lt;/span&gt;
val dir = &lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/test&quot;&lt;/span&gt;
spark.range(100).write.mode(&lt;span class=&quot;code-quote&quot;&gt;&quot;overwrite&quot;&lt;/span&gt;).parquet(dir)
val df = spark.read.parquet(dir)
df.count &lt;span class=&quot;code-comment&quot;&gt;// output 100 which is correct
&lt;/span&gt;f(df).count &lt;span class=&quot;code-comment&quot;&gt;// output 89 which is correct
&lt;/span&gt;
spark.range(1000).write.mode(&lt;span class=&quot;code-quote&quot;&gt;&quot;overwrite&quot;&lt;/span&gt;).parquet(dir)
val df1 = spark.read.parquet(dir)
df1.count &lt;span class=&quot;code-comment&quot;&gt;// output 1000 which is correct, in fact other operation expect df1.filter(&lt;span class=&quot;code-quote&quot;&gt;&quot;id&amp;gt;10&quot;&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; correct result.
&lt;/span&gt;f(df1).count &lt;span class=&quot;code-comment&quot;&gt;// output 89 which is incorrect&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In fact, when we use df1.filter(&quot;id&amp;gt;10&quot;), spark will use old cached dataFrame.&lt;/p&gt;</comment>
                            <comment id="15877575" author="kiszk" created="Wed, 22 Feb 2017 06:36:51 +0000"  >&lt;p&gt;How about inserting &lt;tt&gt;spark.catalog.refreshByPath()&lt;/tt&gt; as follows?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;spark.range(1000).write.mode(&lt;span class=&quot;code-quote&quot;&gt;&quot;overwrite&quot;&lt;/span&gt;).parquet(dir)
spark.catalog.refreshByPath(dir)  &lt;span class=&quot;code-comment&quot;&gt;// insert a NEW statement
&lt;/span&gt;val df1 = spark.read.parquet(dir)
df1.count
f(df1).count
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15877618" author="robin shao" created="Wed, 22 Feb 2017 06:59:48 +0000"  >&lt;p&gt;I  checked  code with  refreshByPath, it worked well.&lt;br/&gt;
But  I do not think it is reasonable solution,  can we make it work without refreshByPath please?&lt;br/&gt;
Or why we should call refreshByPath before please? Is there any special reason please?&lt;/p&gt;</comment>
                            <comment id="15877735" author="gen" created="Wed, 22 Feb 2017 08:07:25 +0000"  >&lt;p&gt;Hi, All &lt;/p&gt;

&lt;p&gt;It seems that refreshByPath(&lt;em&gt;path&lt;/em&gt;) should be called 2 times if there are n (n &amp;gt; 1) cache operation on dataFrame from the &lt;em&gt;path&lt;/em&gt;. &lt;/p&gt;

&lt;p&gt;Therefore please reopen this issue&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;not work code&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.sql.DataFrame
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.sql.SparkSession

def f(path: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, spark: SparkSession): DataFrame = {
  spark.catalog.refreshByPath(path)
  val data = spark.read.option(&lt;span class=&quot;code-quote&quot;&gt;&quot;mergeSchema&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;).parquet(path)
  println(data.count)  &lt;span class=&quot;code-comment&quot;&gt;// always correct
&lt;/span&gt;  val df = data.filter(&lt;span class=&quot;code-quote&quot;&gt;&quot;id&amp;gt;10&quot;&lt;/span&gt;)
  df.cache
  println(df.count) &lt;span class=&quot;code-comment&quot;&gt;// always correct
&lt;/span&gt;  val df1 = df.filter(&lt;span class=&quot;code-quote&quot;&gt;&quot;id&amp;gt;11&quot;&lt;/span&gt;)
  df1.cache
  println(df1.count)
  df1
}

val dir = &lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/test&quot;&lt;/span&gt;
spark.range(100).write.mode(&lt;span class=&quot;code-quote&quot;&gt;&quot;overwrite&quot;&lt;/span&gt;).parquet(dir)
f(dir, spark).count &lt;span class=&quot;code-comment&quot;&gt;// output 88 which is correct
&lt;/span&gt;
spark.range(1000).write.mode(&lt;span class=&quot;code-quote&quot;&gt;&quot;overwrite&quot;&lt;/span&gt;).parquet(dir)
f(dir, spark).count &lt;span class=&quot;code-comment&quot;&gt;// output 88 which is incorrect&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;work code&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.sql.DataFrame
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.sql.SparkSession

def f(path: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, spark: SparkSession): DataFrame = {
  spark.catalog.refreshByPath(path)
  spark.catalog.refreshByPath(path)
  val data = spark.read.option(&lt;span class=&quot;code-quote&quot;&gt;&quot;mergeSchema&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;).parquet(path)
  println(data.count)
  val df = data.filter(&lt;span class=&quot;code-quote&quot;&gt;&quot;id&amp;gt;10&quot;&lt;/span&gt;)
  df.cache
  println(df.count)
  val df1 = df.filter(&lt;span class=&quot;code-quote&quot;&gt;&quot;id&amp;gt;11&quot;&lt;/span&gt;)
  df1.cache
  println(df1.count)
  df1
}

val dir = &lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/test&quot;&lt;/span&gt;
spark.range(100).write.mode(&lt;span class=&quot;code-quote&quot;&gt;&quot;overwrite&quot;&lt;/span&gt;).parquet(dir)
f(dir, spark).count &lt;span class=&quot;code-comment&quot;&gt;// output 88 which is correct
&lt;/span&gt;
spark.range(1000).write.mode(&lt;span class=&quot;code-quote&quot;&gt;&quot;overwrite&quot;&lt;/span&gt;).parquet(dir)
f(dir, spark).count &lt;span class=&quot;code-comment&quot;&gt;// output 988 which is incorrect&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15883035" author="kiszk" created="Fri, 24 Feb 2017 16:34:14 +0000"  >&lt;p&gt;Sorry for being late to reply.&lt;/p&gt;

&lt;p&gt;According to the comment of &lt;tt&gt;refreshByPath()&lt;/tt&gt;, I think that it should work by calling &lt;tt&gt;refreshByPath()&lt;/tt&gt; once.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;   Invalidate and refresh all the cached data (and the associated metadata) for any dataframe that&lt;br/&gt;
   contains the given data source path. Path matching is by prefix, i.e. &quot;/&quot; would invalidate&lt;br/&gt;
   everything that is cached.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think that it is better to create a new JIRA entry. This JIRA entry is not for reporting issues of &lt;tt&gt;refreshByPath()&lt;/tt&gt;.&lt;br/&gt;
What do you think?&lt;/p&gt;
</comment>
                            <comment id="15884061" author="viirya" created="Sat, 25 Feb 2017 05:57:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kiszk&quot; class=&quot;user-hover&quot; rel=&quot;kiszk&quot;&gt;kiszk&lt;/a&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gen&quot; class=&quot;user-hover&quot; rel=&quot;gen&quot;&gt;gen&lt;/a&gt; I created &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-19736&quot; title=&quot;refreshByPath should clear all cached plans with the specified path&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-19736&quot;&gt;&lt;del&gt;SPARK-19736&lt;/del&gt;&lt;/a&gt; for the reported issue. A PR is also submitted.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 38 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2yr7r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>