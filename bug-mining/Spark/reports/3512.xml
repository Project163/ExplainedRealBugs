<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:43:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-14463] read.text broken for partitioned tables</title>
                <link>https://issues.apache.org/jira/browse/SPARK-14463</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Strongly typing the return values of &lt;tt&gt;read.text&lt;/tt&gt; as &lt;tt&gt;Dataset[String]&lt;/tt&gt; breaks when trying to load a partitioned table (or any table where the path looks partitioned)&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Seq((1, &lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;))
  .toDF(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;)
  .write
  .format(&lt;span class=&quot;code-quote&quot;&gt;&quot;text&quot;&lt;/span&gt;)
  .partitionBy(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;)
  .save(&lt;span class=&quot;code-quote&quot;&gt;&quot;/home/michael/text-part-bug&quot;&lt;/span&gt;)

sqlContext.read.text(&lt;span class=&quot;code-quote&quot;&gt;&quot;/home/michael/text-part-bug&quot;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;org.apache.spark.sql.AnalysisException: Try to map struct&amp;lt;value:string,a:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt; to Tuple1, but failed as the number of fields does not line up.
 - Input schema: struct&amp;lt;value:string,a:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
 - Target schema: struct&amp;lt;value:string&amp;gt;;
	at org.apache.spark.sql.catalyst.encoders.ExpressionEncoder.org$apache$spark$sql$catalyst$encoders$ExpressionEncoder$$fail$1(ExpressionEncoder.scala:265)
	at org.apache.spark.sql.catalyst.encoders.ExpressionEncoder.validate(ExpressionEncoder.scala:279)
	at org.apache.spark.sql.Dataset.&amp;lt;init&amp;gt;(Dataset.scala:197)
	at org.apache.spark.sql.Dataset.&amp;lt;init&amp;gt;(Dataset.scala:168)
	at org.apache.spark.sql.Dataset$.apply(Dataset.scala:57)
	at org.apache.spark.sql.Dataset.as(Dataset.scala:357)
	at org.apache.spark.sql.DataFrameReader.text(DataFrameReader.scala:450)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12956989">SPARK-14463</key>
            <summary>read.text broken for partitioned tables</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jurriaanpruis">Jurriaan Pruis</assignee>
                                    <reporter username="marmbrus">Michael Armbrust</reporter>
                        <labels>
                    </labels>
                <created>Thu, 7 Apr 2016 19:58:34 +0000</created>
                <updated>Wed, 18 May 2016 23:22:04 +0000</updated>
                            <resolved>Wed, 18 May 2016 23:15:51 +0000</resolved>
                                                    <fixVersion>2.0.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="15230946" author="marmbrus" created="Thu, 7 Apr 2016 19:58:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rxin&quot; class=&quot;user-hover&quot; rel=&quot;rxin&quot;&gt;rxin&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15231035" author="rxin" created="Thu, 7 Apr 2016 20:49:00 +0000"  >&lt;p&gt;oh - i guess we should drop the partitioned value?&lt;/p&gt;</comment>
                            <comment id="15239617" author="lian cheng" created="Wed, 13 Apr 2016 17:07:42 +0000"  >&lt;p&gt;Seems that this is because &lt;tt&gt;buildReader()&lt;/tt&gt; doesn&apos;t append partitioned columns like other data sources.&lt;/p&gt;</comment>
                            <comment id="15239630" author="rxin" created="Wed, 13 Apr 2016 17:09:00 +0000"  >&lt;p&gt;The problem is that the return type is String, and as a result we can&apos;t really add another field to the text method.&lt;/p&gt;</comment>
                            <comment id="15240640" author="lian cheng" created="Thu, 14 Apr 2016 05:39:53 +0000"  >&lt;p&gt;Should we simply throw an exception when text data source is used together with partitioning?&lt;/p&gt;</comment>
                            <comment id="15246211" author="jurriaanpruis" created="Mon, 18 Apr 2016 18:10:09 +0000"  >&lt;p&gt;Why? I guess this can be quite useful, at least while reading them (I&apos;ve got some partitioned text files, and want to be able to quickly filter them based on the partitions before processing them any further). This kinda worked with Spark 1.6.x but having some problems when trying to work with the partition values themselves (&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-14343&quot; title=&quot;Dataframe operations on a partitioned dataset (using partition discovery) return invalid results&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-14343&quot;&gt;&lt;del&gt;SPARK-14343&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="15246222" author="rxin" created="Mon, 18 Apr 2016 18:15:49 +0000"  >&lt;p&gt;This is just a problem with the text method because it returns Dataset&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt;. I think we can disable partitioning in this case.&lt;/p&gt;

&lt;p&gt;If they want to load a two level folder, they can use glob&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;read.text(&lt;span class=&quot;code-quote&quot;&gt;&quot;/path/to/data/*/*&quot;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If users want to use partitioning, they can still use&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;format(&lt;span class=&quot;code-quote&quot;&gt;&quot;text&quot;&lt;/span&gt;).load(&lt;span class=&quot;code-quote&quot;&gt;&quot;...&quot;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which returns a DataFrame rather than a Dataset&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt;.&lt;/p&gt;</comment>
                            <comment id="15271207" author="jurriaanpruis" created="Wed, 4 May 2016 18:59:10 +0000"  >&lt;p&gt;Any idea if &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-14343&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-14343&lt;/a&gt; is somehow related?&lt;/p&gt;</comment>
                            <comment id="15283044" author="jurriaanpruis" created="Fri, 13 May 2016 19:24:11 +0000"  >&lt;p&gt;Actually, this functionality is broken (explicitly disabled) in Spark 2.0&apos;s text datasource. See &lt;a href=&quot;https://github.com/apache/spark/pull/13104&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/13104&lt;/a&gt; for a fix.&lt;/p&gt;</comment>
                            <comment id="15288690" author="apachespark" created="Wed, 18 May 2016 09:44:05 +0000"  >&lt;p&gt;User &apos;jurriaan&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/13104&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/13104&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15290078" author="apachespark" created="Wed, 18 May 2016 23:22:04 +0000"  >&lt;p&gt;User &apos;rxin&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/13184&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/13184&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 26 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2vt07:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12329449">2.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>