<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:35:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-45424] Regression in CSV schema inference when timestamps do not match specified timestampFormat</title>
                <link>https://issues.apache.org/jira/browse/SPARK-45424</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;There is a regression in Spark 3.5.0 when inferring the schema of CSV files containing timestamps, where a column will be inferred as a timestamp even if the contents do not match the specified timestampFormat.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Test Data&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;I have the following CSV file:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2884-06-24T02:45:51.138
2884-06-24T02:45:51.138
2884-06-24T02:45:51.138
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;b&gt;Spark 3.4.0 Behavior (correct)&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;In Spark 3.4.0, if I specify the correct timestamp format, then the schema is inferred as timestamp:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
scala&amp;gt; val df = spark.read.option(&lt;span class=&quot;code-quote&quot;&gt;&quot;timestampFormat&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;yyyy-MM-dd&lt;span class=&quot;code-quote&quot;&gt;&apos;T&apos;&lt;/span&gt;HH:mm:ss.SSS&quot;&lt;/span&gt;).option(&lt;span class=&quot;code-quote&quot;&gt;&quot;inferSchema&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;).csv(&lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/timestamps.csv&quot;&lt;/span&gt;)
df: org.apache.spark.sql.DataFrame = [_c0: timestamp]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If I specify an incompatible timestampFormat, then the schema is inferred as string:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
scala&amp;gt; val df = spark.read.option(&lt;span class=&quot;code-quote&quot;&gt;&quot;timestampFormat&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;yyyy-MM-dd&lt;span class=&quot;code-quote&quot;&gt;&apos;T&apos;&lt;/span&gt;HH:mm:ss&quot;&lt;/span&gt;).option(&lt;span class=&quot;code-quote&quot;&gt;&quot;inferSchema&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;).csv(&lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/timestamps.csv&quot;&lt;/span&gt;)
df: org.apache.spark.sql.DataFrame = [_c0: string]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;b&gt;Spark 3.5.0&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;In Spark 3.5.0, the column will be inferred as timestamp even if the data does not match the specified timestampFormat.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
scala&amp;gt; val df = spark.read.option(&lt;span class=&quot;code-quote&quot;&gt;&quot;timestampFormat&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;yyyy-MM-dd&lt;span class=&quot;code-quote&quot;&gt;&apos;T&apos;&lt;/span&gt;HH:mm:ss&quot;&lt;/span&gt;).option(&lt;span class=&quot;code-quote&quot;&gt;&quot;inferSchema&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;).csv(&lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/timestamps.csv&quot;&lt;/span&gt;)
df: org.apache.spark.sql.DataFrame = [_c0: timestamp]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Reading the DataFrame then results in an error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: java.time.format.DateTimeParseException: Text &lt;span class=&quot;code-quote&quot;&gt;&apos;2884-06-24T02:45:51.138&apos;&lt;/span&gt; could not be parsed, unparsed text found at index 19
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13553041">SPARK-45424</key>
            <summary>Regression in CSV schema inference when timestamps do not match specified timestampFormat</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fanjia">Jia Fan</assignee>
                                    <reporter username="andygrove">Andy Grove</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 5 Oct 2023 17:25:19 +0000</created>
                <updated>Mon, 9 Oct 2023 09:30:52 +0000</updated>
                            <resolved>Mon, 9 Oct 2023 09:30:52 +0000</resolved>
                                    <version>3.5.0</version>
                                    <fixVersion>3.5.1</fixVersion>
                    <fixVersion>4.0.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17772365" author="andygrove" created="Thu, 5 Oct 2023 20:07:20 +0000"  >&lt;p&gt;The regression seems to have been introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-39280&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-39280&lt;/a&gt; and/or &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-39281&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-39281&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Commits:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/spark/commit/b1c0d599ba32a4562ae1697e3f488264f1d03c76&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/commit/b1c0d599ba32a4562ae1697e3f488264f1d03c76&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/spark/commit/3192bbd29585607d43d0819c6c2d3ac00180261a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/commit/3192bbd29585607d43d0819c6c2d3ac00180261a&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fanjia&quot; class=&quot;user-hover&quot; rel=&quot;fanjia&quot;&gt;fanjia&lt;/a&gt; Do you understand why this behavior has changed?&lt;/p&gt;</comment>
                            <comment id="17772442" author="fanjia" created="Fri, 6 Oct 2023 05:22:22 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=andygrove&quot; class=&quot;user-hover&quot; rel=&quot;andygrove&quot;&gt;andygrove&lt;/a&gt; , I found the reason of the bug. Let me create a PR for this.&lt;/p&gt;</comment>
                            <comment id="17773204" author="maxgekk" created="Mon, 9 Oct 2023 09:30:52 +0000"  >&lt;p&gt;Issue resolved by pull request 43245&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/43245&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/43245&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 5 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1krhs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>