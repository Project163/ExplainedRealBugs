<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:34:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-6152] Spark does not support Java 8 compiled Scala classes</title>
                <link>https://issues.apache.org/jira/browse/SPARK-6152</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Spark uses reflectasm to check Scala closures which fails if the &lt;b&gt;user defined Scala closures&lt;/b&gt; are compiled to Java 8 class version&lt;/p&gt;

&lt;p&gt;The cause is reflectasm does not support Java 8&lt;br/&gt;
&lt;a href=&quot;https://github.com/EsotericSoftware/reflectasm/issues/35&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/EsotericSoftware/reflectasm/issues/35&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Workaround:&lt;br/&gt;
Don&apos;t compile Scala classes to Java 8, Scala 2.11 does not support nor require any Java 8 features&lt;/p&gt;

&lt;p&gt;Stack trace:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.IllegalArgumentException
	at com.esotericsoftware.reflectasm.shaded.org.objectweb.asm.ClassReader.&amp;lt;init&amp;gt;(Unknown Source)
	at com.esotericsoftware.reflectasm.shaded.org.objectweb.asm.ClassReader.&amp;lt;init&amp;gt;(Unknown Source)
	at com.esotericsoftware.reflectasm.shaded.org.objectweb.asm.ClassReader.&amp;lt;init&amp;gt;(Unknown Source)
	at org.apache.spark.util.ClosureCleaner$.org$apache$spark$util$ClosureCleaner$$getClassReader(ClosureCleaner.scala:41)
	at org.apache.spark.util.ClosureCleaner$.getInnerClasses(ClosureCleaner.scala:84)
	at org.apache.spark.util.ClosureCleaner$.clean(ClosureCleaner.scala:107)
	at org.apache.spark.SparkContext.clean(SparkContext.scala:1478)
	at org.apache.spark.rdd.RDD.map(RDD.scala:288)
	at ...my Scala 2.11 compiled to Java 8 code calling into spark
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Java 8+&lt;br/&gt;
Scala 2.11&lt;/p&gt;</environment>
        <key id="12779285">SPARK-6152</key>
            <summary>Spark does not support Java 8 compiled Scala classes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="joshrosen">Josh Rosen</assignee>
                                    <reporter username="pyrolistical">Ronald Chen</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Mar 2015 03:05:34 +0000</created>
                <updated>Fri, 13 Nov 2015 06:59:39 +0000</updated>
                            <resolved>Wed, 11 Nov 2015 19:18:23 +0000</resolved>
                                    <version>1.2.1</version>
                                    <fixVersion>1.6.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>8</votes>
                                    <watches>23</watches>
                                                                                                                <comments>
                            <comment id="14346650" author="srowen" created="Wed, 4 Mar 2015 09:43:52 +0000"  >&lt;p&gt;Spark is not compiled with Java 8. What problem are you reporting?&lt;/p&gt;</comment>
                            <comment id="14347220" author="pyrolistical" created="Wed, 4 Mar 2015 17:38:24 +0000"  >&lt;p&gt;I&apos;ve made the description more clear.  The problem is occurs when I create a Scala 2.11 project that imports Spark 1.2.1 and I compile my Scala code to Java 8 using &quot;scalac -target:jvm-1.8 ...&quot;&lt;/p&gt;</comment>
                            <comment id="14368242" author="srowen" created="Thu, 19 Mar 2015 00:42:39 +0000"  >&lt;p&gt;To your deleted comment &amp;#8211; yes indeed it looks like the library explicitly does not work with Java 8 since class file version 52 == Java 8&lt;/p&gt;</comment>
                            <comment id="14371252" author="martin.grotzke" created="Fri, 20 Mar 2015 13:01:01 +0000"  >&lt;p&gt;I just released reflectasm-1.10.1 (which now should support java 8 due to the upgrade to asm 5) to maven central.&lt;/p&gt;</comment>
                            <comment id="14371254" author="srowen" created="Fri, 20 Mar 2015 13:04:52 +0000"  >&lt;p&gt;Nice one. It looks like &lt;tt&gt;reflectasm&lt;/tt&gt; comes in via &lt;tt&gt;chill&lt;/tt&gt;. Do you know if/when &lt;tt&gt;chill&lt;/tt&gt; might consume the newer version? then we could consume that.&lt;/p&gt;</comment>
                            <comment id="14371608" author="pyrolistical" created="Fri, 20 Mar 2015 16:52:17 +0000"  >&lt;p&gt;If you want to get the new version via &lt;tt&gt;chill&lt;/tt&gt;, you will also need to wait for a release of &lt;tt&gt;kryo&lt;/tt&gt; as &lt;tt&gt;chill&lt;/tt&gt; gets the dependency via &lt;tt&gt;kryo&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&lt;del&gt;I think the root cause here is we are using a shaded library in a third party dependency.  Sounds like a bad practise.  We should just depend on an unshaded &lt;tt&gt;reflectasm&lt;/tt&gt; directly&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;kyro&lt;/tt&gt; just updated to &lt;tt&gt;reflectasm-1.10.1&lt;/tt&gt; four hours ago, so this dependency train will take a while to arrive.&lt;/p&gt;

&lt;p&gt;EDIT: Actually, that was a silly idea.  We do need to upgrade &lt;tt&gt;chill&lt;/tt&gt; otherwise we will just move the failure into &lt;tt&gt;kyro&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="14371648" author="martin.grotzke" created="Fri, 20 Mar 2015 17:10:45 +0000"  >&lt;p&gt;I&apos;ll try to get out a new kryo version as soon as possible...&lt;/p&gt;</comment>
                            <comment id="14371658" author="martin.grotzke" created="Fri, 20 Mar 2015 17:17:32 +0000"  >&lt;p&gt;Btw, chill guys are still on kryo 2.21, kryo right now is 3.0.0. IIRC there were some compatibility issues in kryo they complained about. Perhaps you already should open an issue for chill java 8 support to see what they think about it.&lt;/p&gt;</comment>
                            <comment id="14372048" author="pyrolistical" created="Fri, 20 Mar 2015 20:34:53 +0000"  >&lt;p&gt;Done: &lt;a href=&quot;https://github.com/twitter/chill/issues/223&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/twitter/chill/issues/223&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14378918" author="martin.grotzke" created="Tue, 24 Mar 2015 23:26:28 +0000"  >&lt;p&gt;Btw, we just released kryo 3.0.1: &lt;a href=&quot;https://github.com/EsotericSoftware/kryo/blob/master/CHANGES.md#2240---300-2014-0-04&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/EsotericSoftware/kryo/blob/master/CHANGES.md#2240---300-2014-0-04&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14575540" author="malcolmgreaves" created="Sat, 6 Jun 2015 03:02:48 +0000"  >&lt;p&gt;It appears as if progress on updating chill to use a version of reflectasm that is compatible with Java 1.8 has stalled: &lt;a href=&quot;https://github.com/twitter/chill/pull/224&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/twitter/chill/pull/224&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14646699" author="stevel@apache.org" created="Wed, 29 Jul 2015 20:25:40 +0000"  >&lt;p&gt;Chill and Kryo need to be in sync; there&apos;s also the need to be compatible with the version Hive uses, (which has historically been addressed with custom versions of Hive).&lt;/p&gt;

&lt;p&gt;If spark could jump to Kryo 3.x, classpath conflict with hive would go away, provided the wire formats of serialized classes were compatible: hive&apos;s spark-client JAR uses kryo 2.2.x to talk to spark.&lt;/p&gt;</comment>
                            <comment id="14697716" author="malcolmgreaves" created="Fri, 14 Aug 2015 20:40:57 +0000"  >&lt;p&gt;Interesting &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stevel%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;stevel@apache.org&quot;&gt;stevel@apache.org&lt;/a&gt;! What kinds of changes do you think this would require &amp;#8211; mostly verifying that there&apos;s backward compatibility with those serialized classes?&lt;/p&gt;</comment>
                            <comment id="14745278" author="stevel@apache.org" created="Tue, 15 Sep 2015 11:31:50 +0000"  >&lt;p&gt;what changes? Yes, making sure there are no regressions. Hive had to upgrade to deal with bugs Kryo 2.21; for Spark 1.5 there&apos;s a special org.spark-project.hive artifact which downgraded to Kryo 2.21; the subset of Hive that spark-hive and spark-hive-thriftserver all work there. Hive would certainly veto any reverting to 2.21; I don&apos;t know what their stance would be to a 3.x upgrade on the 1.2 branch ... reluctant would be the default response, I suspect.&lt;/p&gt;

&lt;p&gt;Getting everything to 2.24 is more likely, though if 3.x is needed for Java 8 compatibility it could be argued for&lt;/p&gt;</comment>
                            <comment id="14992639" author="joshrosen" created="Thu, 5 Nov 2015 22:47:53 +0000"  >&lt;p&gt;Do we actually need reflectasm itself for the closure cleaner or are we just using it as a convenient way to pull in a shaded ASM artifact? Why not publish our own shaded ASM 5 and use that instead?&lt;/p&gt;</comment>
                            <comment id="14992660" author="joshrosen" created="Thu, 5 Nov 2015 22:59:03 +0000"  >&lt;p&gt;It turns out that Apache Geronimo has already published shaded ASM 5 artifacts:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://mvnrepository.com/artifact/org.apache.xbean/xbean-asm5-shaded/4.4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://mvnrepository.com/artifact/org.apache.xbean/xbean-asm5-shaded/4.4&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Here&apos;s the source that was used to produce that shaded artifact:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/geronimo-xbean/tree/xbean-4.4/xbean-asm5-shaded&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/geronimo-xbean/tree/xbean-4.4/xbean-asm5-shaded&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This corresponds to ASM 5.0.4, which is the latest release:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/geronimo-xbean/blob/xbean-4.4/pom.xml#L67&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/geronimo-xbean/blob/xbean-4.4/pom.xml#L67&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ll investigate changing Spark to use this instead of reflectASM&apos;s shaded copy.&lt;/p&gt;</comment>
                            <comment id="14992725" author="apachespark" created="Thu, 5 Nov 2015 23:46:05 +0000"  >&lt;p&gt;User &apos;JoshRosen&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/9512&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/9512&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14999190" author="joshrosen" created="Tue, 10 Nov 2015 19:42:07 +0000"  >&lt;p&gt;Does anyone have a standalone reproduction of this issue that I can use to test my PR? &lt;a href=&quot;https://github.com/apache/spark/pull/9512&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/9512&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;EDIT: just realized that this issue pertains to &lt;em&gt;Scala&lt;/em&gt; classes that were compiled with Java 8. Will add a new test to try that out.&lt;/p&gt;</comment>
                            <comment id="14999222" author="joshrosen" created="Tue, 10 Nov 2015 19:57:07 +0000"  >&lt;p&gt;Yep, was able to reproduce trivially by running Spark&apos;s existing Scala unit tests with JDK 8. I&apos;m going to add some plumbing to the build in order to let us test this in Jenkins.&lt;/p&gt;</comment>
                            <comment id="15000918" author="marmbrus" created="Wed, 11 Nov 2015 19:18:23 +0000"  >&lt;p&gt;Issue resolved by pull request 9512&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/9512&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/9512&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15003634" author="oskar blom" created="Fri, 13 Nov 2015 06:59:39 +0000"  >&lt;p&gt;Nice - when is 1.6.0 due for release?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 1 week, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i26buf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12333083">1.6.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>