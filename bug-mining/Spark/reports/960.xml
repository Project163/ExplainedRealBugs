<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:19:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-4121] Master build failures after shading commons-math3</title>
                <link>https://issues.apache.org/jira/browse/SPARK-4121</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;The Spark master Maven build kept failing after we replace colt with commons-math3 and shade the latter:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://amplab.cs.berkeley.edu/jenkins/job/Spark-Master-Maven-with-YARN/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://amplab.cs.berkeley.edu/jenkins/job/Spark-Master-Maven-with-YARN/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The error message is:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;KMeansClusterSuite:
Spark assembly has been built with Hive, including Datanucleus jars on classpath
Spark assembly has been built with Hive, including Datanucleus jars on classpath
- task size should be small in both training and prediction *** FAILED ***
  org.apache.spark.SparkException: Job aborted due to stage failure: Task 1 in stage 1.0 failed 4 times, most recent failure: Lost task 1.3 in stage 1.0 (TID 9, localhost): java.io.InvalidClassException: org.apache.spark.util.random.PoissonSampler; local &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;incompatible: stream classdesc serialVersionUID = -795011761847245121, local &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;serialVersionUID = 4249244967777318419
        java.io.ObjectStreamClass.initNonProxy(ObjectStreamClass.java:617)
        java.io.ObjectInputStream.readNonProxyDesc(ObjectInputStream.java:1622)
        java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1517)
        java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1771)
        java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1350)
        java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:1990)
        java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1915)
        java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1798)
        java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1350)
        java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:1990)
        java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1915)
        java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1798)
        java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1350)
        java.io.ObjectInputStream.readObject(ObjectInputStream.java:370)
        org.apache.spark.serializer.JavaDeserializationStream.readObject(JavaSerializer.scala:62)
        org.apache.spark.serializer.JavaSerializerInstance.deserialize(JavaSerializer.scala:87)
        org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:57)
        org.apache.spark.scheduler.Task.run(Task.scala:56)
        org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:186)
        java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
        java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
        java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This test passed in local sbt build. So the issue should be caused by shading. Maybe there are two versions of commons-math3 (hadoop depends on it), or MLlib doesn&apos;t use the shaded version at compile.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srowen&quot; class=&quot;user-hover&quot; rel=&quot;srowen&quot;&gt;srowen&lt;/a&gt; Could you take a look? Thanks!&lt;/p&gt;</description>
                <environment></environment>
        <key id="12751232">SPARK-4121</key>
            <summary>Master build failures after shading commons-math3</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mengxr">Xiangrui Meng</assignee>
                                    <reporter username="mengxr">Xiangrui Meng</reporter>
                        <labels>
                    </labels>
                <created>Tue, 28 Oct 2014 20:54:55 +0000</created>
                <updated>Mon, 24 Nov 2014 19:44:32 +0000</updated>
                            <resolved>Sat, 1 Nov 2014 22:22:16 +0000</resolved>
                                    <version>1.2.0</version>
                                    <fixVersion>1.2.0</fixVersion>
                                    <component>Build</component>
                    <component>MLlib</component>
                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14187453" author="pwendell" created="Tue, 28 Oct 2014 21:01:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srowen&quot; class=&quot;user-hover&quot; rel=&quot;srowen&quot;&gt;srowen&lt;/a&gt; - can you help with this? This is likely happening because the PoissonSampler on the driver is using the classpath from Maven (with the unmodified version of PoissonSampler) and the executors are using the version from the assembly jar, which has package relocations of the commons math dependency in the byte code. This is a test that uses &quot;local-cluster&quot; mode.&lt;/p&gt;

&lt;p&gt;Is there a reason we are doing these relocations in the assembly only? Would it be better to actually shade-and-inline commons-math in both the spark-core and spark-mllib package jars?&lt;/p&gt;

&lt;p&gt;Having discrepancies between the assmebly and package jars I&apos;m guessing could lead to problems other than just this test issue. It also means that applications which compile against Spark&apos;s dependencies rather than running through the Spark assembly packages won&apos;t get the benefit of the shading we&apos;ve done.&lt;/p&gt;</comment>
                            <comment id="14187458" author="joshrosen" created="Tue, 28 Oct 2014 21:03:44 +0000"  >&lt;p&gt;Here&apos;s an easy command to reproduce this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;mvn -DskipTests &lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;
mvn test -DwildcardSuites=org.apache.spark.mllib.clustering.KMeansClusterSuite
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14187475" author="srowen" created="Tue, 28 Oct 2014 21:12:29 +0000"  >&lt;p&gt;Yeah I was seeing this locally, but not on the Jenkins test build, so chalked it up to weirdness in my build.&lt;br/&gt;
I think the answer may indeed be to do the relocating in core/mllib itself. I&apos;ll get on that.&lt;/p&gt;</comment>
                            <comment id="14190500" author="mengxr" created="Thu, 30 Oct 2014 18:04:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srowen&quot; class=&quot;user-hover&quot; rel=&quot;srowen&quot;&gt;srowen&lt;/a&gt; Are you working on this? I played with the pom files yesterday. I found the serialVersionUID mismatch was because the `rng` in `PoissonSampler` is compiled to a public API in Java. Even I changed it to `private&lt;span class=&quot;error&quot;&gt;&amp;#91;this&amp;#93;&lt;/span&gt; val`, it is still public in Java. The problem is similar to:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.scala-lang.org/old/node/11418.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.scala-lang.org/old/node/11418.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If I declare it as an `AnyRef`, it solved the serialVersionUID problem, then I got ClassNotFound from executors, because commons-math3 is not in the assembly jar nor on worker classpath. To not block the release, I suggest that we do not shade commons-math3 but set its version based on the hadoop profile. I can prepare a PR, but please let us know if you have a better solution.&lt;/p&gt;</comment>
                            <comment id="14190699" author="apachespark" created="Thu, 30 Oct 2014 19:52:04 +0000"  >&lt;p&gt;User &apos;mengxr&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/3023&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/3023&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14190708" author="srowen" created="Thu, 30 Oct 2014 19:57:29 +0000"  >&lt;p&gt;Sorry I have been traveling without internet. When I tried revising the shading last night, tests hung. Probably due to network weirdness. &lt;/p&gt;

&lt;p&gt;My concern was that by shading just 2 modules you have to watch for other modules that accidentally start using Math3. &lt;/p&gt;

&lt;p&gt;I think a less drastic solution like modulating the version with hadoop profile sounds fine in principle. I&apos;d have to look up what version goes with what. I think we are not using any very new methods. &lt;/p&gt;

&lt;p&gt;Sorry about that and please proceed as you see fit though I will have another look tonight. &lt;/p&gt;</comment>
                            <comment id="14190754" author="mengxr" created="Thu, 30 Oct 2014 20:22:31 +0000"  >&lt;p&gt;No, we are not using fancy methods. v3.1.1 is good for us. I just sent out the PR. Please help review. Thanks!&lt;/p&gt;</comment>
                            <comment id="14193525" author="pwendell" created="Sat, 1 Nov 2014 22:22:16 +0000"  >&lt;p&gt;Okay I merged this. Let&apos;s see how it goes.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12749398">SPARK-4022</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 3 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i21oyn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12327369">1.2.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>