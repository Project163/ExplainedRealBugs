<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:33:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-10790] Dynamic Allocation does not request any executors if first stage needs less than or equal to spark.dynamicAllocation.initialExecutors</title>
                <link>https://issues.apache.org/jira/browse/SPARK-10790</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;If you set spark.dynamicAllocation.initialExecutors &amp;gt; 0 (or spark.dynamicAllocation.minExecutors, since spark.dynamicAllocation.initialExecutors defaults to spark.dynamicAllocation.minExecutors), and the number of tasks in the first stage of your job is less than or equal to this min/init number of executors, dynamic allocation won&apos;t actually request any executors and will just hang indefinitely with the warning &quot;Initial job has not accepted any resources; check your cluster UI to ensure that workers are registered and have sufficient resources&quot;.&lt;/p&gt;

&lt;p&gt;The cause appears to be that ExecutorAllocationManager does not request any executors while the application is still initializing, but it still sets the initial value of numExecutorsTarget to spark.dynamicAllocation.initialExecutors. Once the job is running and has submitted its first task, if the first task does not need more than spark.dynamicAllocation.initialExecutors, ExecutorAllocationManager.updateAndSyncNumExecutorsTarget() does not think that it needs to request any executors, so it doesn&apos;t.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12896017">SPARK-10790</key>
            <summary>Dynamic Allocation does not request any executors if first stage needs less than or equal to spark.dynamicAllocation.initialExecutors</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jerryshao">Saisai Shao</assignee>
                                    <reporter username="jonathak">Jonathan Kelly</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 Sep 2015 07:18:59 +0000</created>
                <updated>Sun, 17 May 2020 17:47:27 +0000</updated>
                            <resolved>Mon, 28 Sep 2015 13:58:54 +0000</resolved>
                                    <version>1.5.0</version>
                                    <fixVersion>1.5.2</fixVersion>
                    <fixVersion>1.6.0</fixVersion>
                                    <component>Scheduler</component>
                    <component>Spark Core</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14905989" author="srowen" created="Thu, 24 Sep 2015 08:17:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jonathak&quot; class=&quot;user-hover&quot; rel=&quot;jonathak&quot;&gt;jonathak&lt;/a&gt; A number of quite similar sounding things were fixed in 1.5. Can you check vs master before opening a JIRA? I suspect it&apos;s a duplicate.&lt;/p&gt;</comment>
                            <comment id="14906047" author="jonathak" created="Thu, 24 Sep 2015 08:52:33 +0000"  >&lt;p&gt;I did search through all dynamicAllocation-related JIRAs targeted for 1.5.1+ before cutting this one, and I didn&apos;t find anything. Also, I don&apos;t see any diff at all  in core/src/main/scala/org/apache/spark/ExecutorAllocationManager.scala between v1.5.0 and the current master (d91967e), though maybe it&apos;s possible for this issue to have been fixed elsewhere. I can try the latest master, but it doesn&apos;t seem like it will have been fixed. Thanks for the response though.&lt;/p&gt;</comment>
                            <comment id="14906055" author="srowen" created="Thu, 24 Sep 2015 08:56:16 +0000"  >&lt;p&gt;In your email I think you said you were using 1.4.1; just to be clear you are using 1.5.0 already?&lt;/p&gt;</comment>
                            <comment id="14906505" author="jonathak" created="Thu, 24 Sep 2015 15:33:50 +0000"  >&lt;p&gt;Yes, this is on Spark 1.5.0. That&apos;s why I chose 1.5.0 for the Affected Version(s). In my email, I said, &quot;I&apos;m running into a problem with YARN dynamicAllocation on Spark 1.5.0 after using it successfully on an identically configured cluster with Spark 1.4.1.&quot; I was just stating up front that I know that what I was doing worked in 1.4.1 but broke after the upgrade to 1.5.0, rather than me never having gotten it to work.&lt;/p&gt;

&lt;p&gt;So in your initial correspondence above when you said that there were fixes in 1.5, you meant 1.5.0? I had assumed you knew that I was using 1.5.0 and you just meant that there were fixes in 1.5.1+.&lt;/p&gt;

&lt;p&gt;When I look at the diff for this file between v1.4.1 and v1.5.0, I see that this is when the &quot;initializing&quot; check was added, so this is most likely the cause of this issue. See &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-7699&quot; title=&quot;Dynamic allocation: initial executors may be canceled before first job&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-7699&quot;&gt;&lt;del&gt;SPARK-7699&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14906535" author="srowen" created="Thu, 24 Sep 2015 15:49:33 +0000"  >&lt;p&gt;Yeah if so then ignore most of this since I thought you were on 1.4.1. I realize you say 1.5.0 here.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryshao&quot; class=&quot;user-hover&quot; rel=&quot;jerryshao&quot;&gt;jerryshao&lt;/a&gt; what do you think of this? It looks like there&apos;s a missed step in here; when the stage is submitted and it&apos;s then allowed to request executors, it never does actually request the initial set of executors? whereas before it happened to have already done that at the outset?&lt;/p&gt;

&lt;p&gt;Of course, you probably want to set your initial number of executors lower anyway, and that&apos;s a workaround, but it shouldn&apos;t work this way.&lt;/p&gt;</comment>
                            <comment id="14906696" author="jerryshao" created="Thu, 24 Sep 2015 17:31:04 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srowen&quot; class=&quot;user-hover&quot; rel=&quot;srowen&quot;&gt;srowen&lt;/a&gt;, let me check it.&lt;/p&gt;</comment>
                            <comment id="14906787" author="jerryshao" created="Thu, 24 Sep 2015 18:24:44 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jonathak&quot; class=&quot;user-hover&quot; rel=&quot;jonathak&quot;&gt;jonathak&lt;/a&gt;, let me trying to understand your scenario:&lt;/p&gt;

&lt;p&gt;1. In your Spark cluster you have dynamic allocation enabled with minimum and initial number of executors set, for example:&lt;/p&gt;

&lt;p&gt;spark.dynamicAllocation.minExecutors 2&lt;br/&gt;
spark.dynamicAllocation.initialExecutors 3&lt;/p&gt;

&lt;p&gt;2. You run a Spark job with resource requirements that is enough using current executors (don&apos;t need to request new executors), for example:&lt;/p&gt;

&lt;p&gt;sc.parallelize(1 to 100, 1).collect()&lt;/p&gt;

&lt;p&gt;Here this job will only have ONE task, so the current 2 executors (with 2 cores for each executors) can satisfy the resource requirement and no need to request new executors.&lt;/p&gt;

&lt;p&gt;Is that the scenario you described?&lt;/p&gt;

&lt;p&gt;I assume it is right. I tested locally in my environment, seems no such &quot;hang&quot; or &quot;Initial job has not accepted any resources; check your cluster UI to ensure that workers are registered and have sufficient resources&quot; as you mentioned.&lt;/p&gt;

&lt;p&gt;1. Take this as example, Spark already has 2 executors with 4 cores, so submitting jobs will not occur &quot;Initial job has not accepted any resources; check your cluster UI to ensure that workers are registered and have sufficient resources&quot; problem, since resource is enough.&lt;br/&gt;
2. &quot;ExecutorAllocationManager.updateAndSyncNumExecutorsTarget() does not think that it needs to request any executors&quot; is expected, since your current resource is enough.&lt;br/&gt;
3. &quot;ExecutorAllocationManager does not request any executors while the application is still initializing&quot;. The initializing state will be finished once you submitted a job. So here when you submit a job, actually ExecutorAllocationManager&apos;s internal state is not yet initializing, so it can bring up and ramp down executors according to load.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure is this exactly your scenario, basically I cannot reproduce your problem, can you describe more specifically?&lt;/p&gt;



</comment>
                            <comment id="14906912" author="jonathak" created="Thu, 24 Sep 2015 20:05:25 +0000"  >&lt;p&gt;I can reproduce it with minExecutors=N and initialExecutors=unset and having the job&apos;s first stage require &amp;lt;= N tasks. I just realized that for some reason I can&apos;t reproduce it with minExecutors=N and initialExecutors=N, even though that should be the same as minExecutors=N and initialExecutors=unset, right?&lt;/p&gt;

&lt;p&gt;Anyway, please try the following:&lt;/p&gt;

&lt;p&gt;spark-submit -c spark.dynamicAllocation.minExecutors=1 --class org.apache.spark.examples.SparkPi spark-examples-1.5.0-hadoop2.6.0.jar 1&lt;/p&gt;

&lt;p&gt;This one hangs for me.&lt;/p&gt;

&lt;p&gt;This one does not:&lt;/p&gt;

&lt;p&gt;spark-submit -c spark.dynamicAllocation.minExecutors=1 -c spark.dynamicAllocation.initialExecutors=1 --class org.apache.spark.examples.SparkPi spark-examples-1.5.0-hadoop2.6.0.jar 1&lt;/p&gt;

&lt;p&gt;So maybe the problem has more to do with a hang being possible if initialExecutors is left unset?&lt;/p&gt;</comment>
                            <comment id="14906969" author="jerryshao" created="Thu, 24 Sep 2015 20:40:51 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jonathak&quot; class=&quot;user-hover&quot; rel=&quot;jonathak&quot;&gt;jonathak&lt;/a&gt;, I think I reproduced the problem you mentioned, I don&apos;t think it is the cause of &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-7699&quot; title=&quot;Dynamic allocation: initial executors may be canceled before first job&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-7699&quot;&gt;&lt;del&gt;SPARK-7699&lt;/del&gt;&lt;/a&gt;, in fact it is introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-9092&quot; title=&quot;Make --num-executors compatible with dynamic allocation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-9092&quot;&gt;&lt;del&gt;SPARK-9092&lt;/del&gt;&lt;/a&gt;, which does not consider if initial executor is not set. &lt;/p&gt;

&lt;p&gt;Also what you mentioned in the mail about:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Then on this line, it returns numExecutorsTarget (1) - oldNumExecutorsTarget (still 1, even though there aren&apos;t any executors running yet) = 0, for the number of executors it should request. Then the app hangs forever because it never requests any executors.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think you might be a little misunderstand the code, here return value 0 is of no use at anywhere, if the current target executor is equal to old target executor, Spark will simply not send resource request to AM. If current target executor is less than old target executor, Spark will update the resource requests to AM to try to ramp down some pending container requests. You might be dig more into the code &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;

&lt;p&gt;Yeah, it is actually a bug, let me fix it.&lt;/p&gt;</comment>
                            <comment id="14907180" author="apachespark" created="Thu, 24 Sep 2015 22:44:02 +0000"  >&lt;p&gt;User &apos;jerryshao&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/8910&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/8910&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14939060" author="jonathak" created="Wed, 30 Sep 2015 23:35:21 +0000"  >&lt;p&gt;Thank you for the explanation and for such a quick fix, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryshao&quot; class=&quot;user-hover&quot; rel=&quot;jerryshao&quot;&gt;jerryshao&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 7 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2lhzb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>