<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:20:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-4584] 2x Performance regression for Spark-on-YARN</title>
                <link>https://issues.apache.org/jira/browse/SPARK-4584</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Significant performance regression observed for Spark-on-YARN (upto 2x) after 1.2 rebase. The offending commit is: 70e824f750aa8ed446eec104ba158b0503ba58a9  from Oct 7th. Problem can be reproduced with JavaWordCount against a large enough input dataset in YARN cluster mode.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12757591">SPARK-4584</key>
            <summary>2x Performance regression for Spark-on-YARN</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vanzin">Marcelo Masiero Vanzin</assignee>
                                    <reporter username="nravi">Nishkam Ravi</reporter>
                        <labels>
                    </labels>
                <created>Tue, 25 Nov 2014 02:01:05 +0000</created>
                <updated>Fri, 28 Nov 2014 20:17:41 +0000</updated>
                            <resolved>Fri, 28 Nov 2014 20:17:11 +0000</resolved>
                                    <version>1.2.0</version>
                                    <fixVersion>1.2.0</fixVersion>
                                    <component>YARN</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14224185" author="sandyr" created="Tue, 25 Nov 2014 08:10:57 +0000"  >&lt;p&gt;I took a look at the jobs Nishkam ran before and after that commit.  The second stage in the &quot;before&quot; job takes 69 seconds and the second stage in the &quot;after&quot; job takes 158 seconds.  This seems to be caused by the individual tasks taking longer.&lt;/p&gt;

&lt;p&gt;Totally confused about how that commit could have caused the regression.&lt;/p&gt;</comment>
                            <comment id="14225313" author="nravi" created="Tue, 25 Nov 2014 22:24:26 +0000"  >&lt;p&gt;Looked into this issue a bit more. Source of the problem is setupSystemSecurityManager(). If I comment out the invocation, we get the performance back. &lt;/p&gt;</comment>
                            <comment id="14225321" author="nravi" created="Tue, 25 Nov 2014 22:33:55 +0000"  >&lt;p&gt;Looks like java.lang.SecurityManager is a hog. I&apos;m looking to see if we use it elsewhere in Spark. If so, we might want to reconsider removing it everywhere and replacing it by something more efficient.&lt;/p&gt;</comment>
                            <comment id="14225471" author="nravi" created="Wed, 26 Nov 2014 00:25:44 +0000"  >&lt;p&gt;I don&apos;t see SecurityManager anywhere else in Spark, which is great. &lt;/p&gt;

&lt;p&gt;Marcelo and I tried a lightweight version of SecurityManager with all methods except for checkExit() stubbed out and continue to see the performance issue. &lt;/p&gt;

&lt;p&gt;Maybe something like Runtime.addShutdownHook could be used instead?&lt;/p&gt;</comment>
                            <comment id="14225479" author="nravi" created="Wed, 26 Nov 2014 00:28:39 +0000"  >&lt;p&gt;Use of SecurityManager may be suppressing a JIT compiler optimization.&lt;/p&gt;</comment>
                            <comment id="14225554" author="andrewor14" created="Wed, 26 Nov 2014 01:28:02 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nravi&quot; class=&quot;user-hover&quot; rel=&quot;nravi&quot;&gt;nravi&lt;/a&gt; how much data are you shuffling? Can you check the &quot;Shuffle Write&quot; field on the Spark UI?&lt;/p&gt;</comment>
                            <comment id="14225563" author="nravi" created="Wed, 26 Nov 2014 01:35:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=andrewor14&quot; class=&quot;user-hover&quot; rel=&quot;andrewor14&quot;&gt;andrewor14&lt;/a&gt; Just curious, why is that relevant here? &lt;/p&gt;</comment>
                            <comment id="14225567" author="nravi" created="Wed, 26 Nov 2014 01:38:50 +0000"  >&lt;p&gt;Around 2GB in the map stage and 1.5GB in the collect phase.&lt;/p&gt;</comment>
                            <comment id="14225593" author="andrewor14" created="Wed, 26 Nov 2014 02:00:39 +0000"  >&lt;p&gt;It may not be, but I just wanted to get a sense of how large your dataset is. I wasn&apos;t able to reproduce the performance discrepancy between the two commits on my end. I&apos;m doing a simple groupBy on spark-perf that shuffles about 16GB with 2000 partitions, and I haven&apos;t observed a significant performance difference (~2%, likely just noise). These results are based on the median over 10 runs.&lt;/p&gt;

&lt;p&gt;The other thing is that this only seems to affect the application master, which becomes the driver in cluster mode but otherwise shouldn&apos;t affect the application performance at all. What mode were you running in, client or cluster mode? How many partitions did you have?&lt;/p&gt;</comment>
                            <comment id="14225603" author="nravi" created="Wed, 26 Nov 2014 02:17:35 +0000"  >&lt;p&gt;I would recommend working with JavaWordCount. We don&apos;t see this regression for most of our other workloads either, including those from spark-perf. Don&apos;t think you would need a large input dataset to reproduce the problem. To see the perf diff, commenting out invocation to setupSystemSecurityManager() would suffice. I&apos;m running YARN cluster mode and have 450 partitions. &lt;/p&gt;</comment>
                            <comment id="14225899" author="srowen" created="Wed, 26 Nov 2014 08:27:03 +0000"  >&lt;p&gt;&lt;tt&gt;SecurityManager&lt;/tt&gt; is something that loads of the JVM code consults, if it exists:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;SecurityManager&lt;/span&gt; sm = &lt;span class=&quot;code-object&quot;&gt;SecurityManager&lt;/span&gt;.getSystemSecurityManager();
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (sm != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
  ...
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Setting any &lt;tt&gt;SecurityManager&lt;/tt&gt; is like turning on a whole lot of not-cheap permission checks throughout the JDK. I think setting one is pretty undesirable from a performance perspective. It also precludes the possibility of enabling a real SecurityManager for contexts that want to although I find it unlikely that would ever really work with Spark.&lt;/p&gt;

&lt;p&gt;How about just documenting and telling users &quot;don&apos;t System.exit in your code&quot;, which is widely accepted as a no-no in Java/Scala anyway?&lt;/p&gt;</comment>
                            <comment id="14226506" author="vanzin" created="Wed, 26 Nov 2014 17:35:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sowen&quot; class=&quot;user-hover&quot; rel=&quot;sowen&quot;&gt;sowen&lt;/a&gt; that was going to be my suggestion. For 1.2, I&apos;ll just remote the security manager and declare &quot;use System.exit() at your own risk&quot; - the behavior should then be the same as 1.1. Post 1.2, we could add some new exception (e.g. &lt;tt&gt;SparkAppException&lt;/tt&gt;) that users can throw if they want the runtime to exit with a specific error code. But even that I don&apos;t think is strictly necessary - just a nice to have.&lt;/p&gt;

&lt;p&gt;BTW, we&apos;ve tried to extend the security manager so that all operations except for &lt;tt&gt;checkExit&lt;/tt&gt; are no-ops, but even that doesn&apos;t help.&lt;/p&gt;</comment>
                            <comment id="14226637" author="apachespark" created="Wed, 26 Nov 2014 18:50:07 +0000"  >&lt;p&gt;User &apos;vanzin&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/3484&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/3484&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 51 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i22qvr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12327369">1.2.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>