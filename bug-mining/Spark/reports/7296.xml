<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:17:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-32131] Fix AnalysisException messages at UNION/INTERSECT/EXCEPT/MINUS operations</title>
                <link>https://issues.apache.org/jira/browse/SPARK-32131</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Union and set operations can only be performed on tables with the compatible column types,while when we have more than two column, the warning messages will have wrong column index.Steps to reproduce.&lt;/p&gt;

&lt;p&gt;Step1:prepare test data&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
drop table &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; exists test1; 
drop table &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; exists test2; 
drop table &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; exists test3;
create table &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; not exists test1(id &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, age &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, name timestamp);
create table &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; not exists test2(id &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, age timestamp, name timestamp);
create table &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; not exists test3(id &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, age &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, name &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;);
insert into test1 select 1,2,&lt;span class=&quot;code-quote&quot;&gt;&apos;2020-01-01 01:01:01&apos;&lt;/span&gt;;
insert into test2 select 1,&lt;span class=&quot;code-quote&quot;&gt;&apos;2020-01-01 01:01:01&apos;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&apos;2020-01-01 01:01:01&apos;&lt;/span&gt;; 
insert into test3 select 1,3,4;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Step2:do query:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Query1:
select * from test1 except select * from test2;
Result1:
Error: org.apache.spark.sql.AnalysisException: Except can only be performed on tables with the compatible column types. timestamp &amp;lt;&amp;gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; at the second column of the second table;; &apos;Except &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; :- Project [id#620, age#621, name#622] : +- SubqueryAlias `&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;`.`test1` : +- HiveTableRelation `&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;`.`test1`, org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe, [id#620, age#621, name#622] +- Project [id#623, age#624, name#625] +- SubqueryAlias `&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;`.`test2` +- HiveTableRelation `&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;`.`test2`, org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe, [id#623, age#624, name#625] (state=,code=0)
Query2:
select * from test1 except select * from test3;
Result2:
Error: org.apache.spark.sql.AnalysisException: Except can only be performed on tables with the compatible column types. &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; &amp;lt;&amp;gt; timestamp at the 2th column of the second table;; &apos;Except &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; :- Project [id#632, age#633, name#634] : +- SubqueryAlias `&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;`.`test1` : +- HiveTableRelation `&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;`.`test1`, org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe, [id#632, age#633, name#634] +- Project [id#635, age#636, name#637] +- SubqueryAlias `&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;`.`test3` +- HiveTableRelation `&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;`.`test3`, org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe, [id#635, age#636, name#637] (state=,code=0)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;the result of query1 is correct, while query2 have the wrong errors,it should be&#160;the third column&lt;/p&gt;

&lt;p&gt;Here has the wrong column index.&lt;/p&gt;

&lt;p&gt;&lt;ins&gt;Error: org.apache.spark.sql.AnalysisException: Except can only be performed on tables with the compatible column types. int &amp;lt;&amp;gt; timestamp at the &lt;b&gt;2th&lt;/b&gt; column of the second table&lt;/ins&gt;&lt;/p&gt;

&lt;p&gt;We may need to change to the following&lt;/p&gt;

&lt;p&gt;&lt;ins&gt;Error: org.apache.spark.sql.AnalysisException: Except can only be performed on tables with the compatible column types. int &amp;lt;&amp;gt; timestamp at the &lt;b&gt;third&lt;/b&gt; column of the second table&lt;/ins&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13314100">SPARK-32131</key>
            <summary>Fix AnalysisException messages at UNION/INTERSECT/EXCEPT/MINUS operations</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="&#23567;&#37101;&#39134;&#39134;&#20992;">philipse</assignee>
                                    <reporter username="&#23567;&#37101;&#39134;&#39134;&#20992;">philipse</reporter>
                        <labels>
                    </labels>
                <created>Mon, 29 Jun 2020 16:45:55 +0000</created>
                <updated>Wed, 1 Jul 2020 06:40:51 +0000</updated>
                            <resolved>Wed, 1 Jul 2020 06:40:51 +0000</resolved>
                                    <version>2.1.3</version>
                    <version>2.2.3</version>
                    <version>2.3.4</version>
                    <version>2.4.6</version>
                    <version>3.0.0</version>
                                    <fixVersion>2.4.7</fixVersion>
                    <fixVersion>3.0.1</fixVersion>
                    <fixVersion>3.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17147959" author="apachespark" created="Mon, 29 Jun 2020 16:54:50 +0000"  >&lt;p&gt;User &apos;GuoPhilipse&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28951&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28951&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17147960" author="apachespark" created="Mon, 29 Jun 2020 16:54:53 +0000"  >&lt;p&gt;User &apos;GuoPhilipse&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28951&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28951&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17149108" author="dongjoon" created="Wed, 1 Jul 2020 05:08:24 +0000"  >&lt;p&gt;I also verified that this bug exists at 2.1.3 ~ 2.3.7 and updated the affected versions.&lt;/p&gt;</comment>
                            <comment id="17149165" author="dongjoon" created="Wed, 1 Jul 2020 06:40:51 +0000"  >&lt;p&gt;Issue resolved by pull request 28951&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28951&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28951&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 19 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0gazk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>