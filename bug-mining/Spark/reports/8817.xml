<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:31:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-41937] SparkR datetime column compare with Sys.time() throws error in R (&gt;= 4.2.0)</title>
                <link>https://issues.apache.org/jira/browse/SPARK-41937</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Base R 4.2.0 introduced a change (&lt;a href=&quot;https://stat.ethz.ch/pipermail/r-announce/2022/000683.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;[Rd] R 4.2.0 is released&lt;/a&gt;), &quot;&lt;tt&gt;Calling if() or while() with a condition of length greater than one gives an error rather than a warning.&lt;/tt&gt;&quot;&lt;/p&gt;

&lt;p&gt;The below code is a reproducible example of the issue. If it is executed in R &amp;gt;=4.2.0 then it will generate an error, or else just a warning message. `&lt;tt&gt;Sys.time()`&lt;/tt&gt; is a multi-class object in R, and throughout the Spark R repository &apos;&lt;tt&gt;if&lt;/tt&gt;&apos; statement is used as: `&lt;tt&gt;if(class&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; == &quot;Column&quot;)&lt;/tt&gt;` - this causes error in the latest R version &amp;gt;= 4.2.0. Note that R allows an object to have multiple &apos;&lt;tt&gt;class&lt;/tt&gt;&apos; names as a character vector (&lt;a href=&quot;https://stat.ethz.ch/R-manual/R-devel/library/base/html/class.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;R: Object Classes&lt;/a&gt;); hence this type of check itself was not a good idea in the first place.&lt;/p&gt;

&lt;p&gt;The below chunks are executed on R version 4.1.3.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{
&#160;SparkR::sparkR.session()
&#160;t &amp;lt;- Sys.time()
 sdf &amp;lt;- SparkR::createDataFrame(data.frame(x = t + c(-1, 1, -1, 1, -1)))
 SparkR::collect(SparkR::filter(sdf, SparkR::column(&lt;span class=&quot;code-quote&quot;&gt;&apos;x&apos;&lt;/span&gt;) &amp;gt; t))
}
#&amp;gt; Warning in &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;class(&lt;/span&gt;e2) == &lt;span class=&quot;code-quote&quot;&gt;&apos;Column&apos;&lt;/span&gt;) {: the condition has length &amp;gt; 1&#160;
#&amp;gt; and only the first element will be used
#&amp;gt; x
#&amp;gt; 1 2023-01-07 20:40:20
#&amp;gt; 2 2023-01-07 20:40:20&#160;

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{
 Sys.setenv(`_R_CHECK_LENGTH_1_CONDITION_` = &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;)
&#160;SparkR::sparkR.session()
&#160;t &amp;lt;- Sys.time()
 sdf &amp;lt;- SparkR::createDataFrame(data.frame(x = t + c(-1, 1, -1, 1, -1)))
 SparkR::collect(SparkR::filter(sdf, SparkR::column(&lt;span class=&quot;code-quote&quot;&gt;&apos;x&apos;&lt;/span&gt;) &amp;gt; t))
}
#&amp;gt; Error in h(simpleError(msg, call)): error in evaluating the argument &lt;span class=&quot;code-quote&quot;&gt;&apos;x&apos;&lt;/span&gt; 
#&amp;gt; in selecting a method &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; function &lt;span class=&quot;code-quote&quot;&gt;&apos;collect&apos;&lt;/span&gt;: error in evaluating the 
#&amp;gt; argument &lt;span class=&quot;code-quote&quot;&gt;&apos;condition&apos;&lt;/span&gt; in selecting a method &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; function &lt;span class=&quot;code-quote&quot;&gt;&apos;filter&apos;&lt;/span&gt;: the
#&amp;gt; condition has length &amp;gt; 1 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Similar issue is noted for these SparkR functions where &lt;tt&gt;Sys.time()&lt;/tt&gt; type of multi-class data might be used: &lt;tt&gt;lit, fillna, when, otherwise, contains, ifelse&#160;&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;The suggested change is to add the `&lt;tt&gt;all&lt;/tt&gt;` function (or `&lt;tt&gt;any&lt;/tt&gt;`, as appropriate) while doing the check of whether `&lt;tt&gt;class(.)&lt;/tt&gt;` is `&lt;tt&gt;Column&lt;/tt&gt;` or not: `&lt;tt&gt;if(all(class(.) == &quot;Column&quot;))&lt;/tt&gt;`. Or, better to use `&lt;tt&gt;base::inherits&lt;/tt&gt;` for this check as `&lt;tt&gt;if(inherits(., &quot;Column&quot;))&lt;/tt&gt;`.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13517141">SPARK-41937</key>
            <summary>SparkR datetime column compare with Sys.time() throws error in R (&gt;= 4.2.0)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="atalvivek">Vivek Atal</assignee>
                                    <reporter username="atalvivek">Vivek Atal</reporter>
                        <labels>
                            <label>newbie</label>
                    </labels>
                <created>Sun, 8 Jan 2023 02:37:10 +0000</created>
                <updated>Mon, 9 Jan 2023 00:41:17 +0000</updated>
                            <resolved>Mon, 9 Jan 2023 00:41:17 +0000</resolved>
                                    <version>3.3.0</version>
                                    <fixVersion>3.4.0</fixVersion>
                                    <component>R</component>
                    <component>SparkR</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17655760" author="apachespark" created="Sun, 8 Jan 2023 03:39:36 +0000"  >&lt;p&gt;User &apos;atalv&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/39454&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/39454&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17655761" author="apachespark" created="Sun, 8 Jan 2023 03:40:25 +0000"  >&lt;p&gt;User &apos;atalv&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/39454&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/39454&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17655855" author="gurwls223" created="Mon, 9 Jan 2023 00:41:17 +0000"  >&lt;p&gt;Issue resolved by pull request 39454&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/39454&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/39454&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12314421" key="com.atlassian.jira.plugin.system.customfieldtypes:labels">
                        <customfieldname>Language</customfieldname>
                        <customfieldvalues>
                                        <label>R</label>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 44 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1en68:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311620" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Shepherd</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>atalvivek</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>