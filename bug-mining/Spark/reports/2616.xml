<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:33:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-10562] .partitionBy() creates the metastore partition columns in all lowercase, but persists the data path as MixedCase resulting in an error when the data is later attempted to query.</title>
                <link>https://issues.apache.org/jira/browse/SPARK-10562</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;When using DataFrame.write.partitionBy().saveAsTable() it creates the partiton by columns in all lowercase in the meta-store.  However, it writes the data to the filesystem using mixed-case.&lt;/p&gt;

&lt;p&gt;This causes an error when running a select against the table.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;from pyspark.sql import Row

# Create a data frame with mixed case column names
myRDD = sc.parallelize([Row(Name=&quot;John Terry&quot;, Goals=1, Year=2015),
                       Row(Name=&quot;Frank Lampard&quot;, Goals=15, Year=2012)])

myDF = sqlContext.createDataFrame(myRDD)

# Write this data out to a parquet file and partition by the Year (which is a mixedCase name)
myDF.write.partitionBy(&quot;Year&quot;).saveAsTable(&quot;chelsea_goals&quot;)

%sql show create table chelsea_goals;
--The metastore is showwing a partition column name of all lowercase &quot;year&quot;

# Verify that the data is written with appropriate partitions
display(dbutils.fs.ls(&quot;/user/hive/warehouse/chelsea_goals&quot;))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;%&lt;span class=&quot;code-keyword&quot;&gt;sql&lt;/span&gt; &lt;span class=&quot;code-comment&quot;&gt;-- Now try &lt;span class=&quot;code-keyword&quot;&gt;to&lt;/span&gt; run &lt;span class=&quot;code-keyword&quot;&gt;a&lt;/span&gt; query against this &lt;span class=&quot;code-keyword&quot;&gt;table&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;select&lt;/span&gt; * &lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; chelsea_goals
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Error in SQL statement: UncheckedExecutionException: java.lang.RuntimeException: Partition column year not found in schema StructType(StructField(Goals,LongType,true), StructField(Name,StringType,true), StructField(Year,LongType,true))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;# Now lets try this again using a lowercase column name
myRDD2 = sc.parallelize([Row(Name=&quot;John Terry&quot;, Goals=1, year=2015),
                         Row(Name=&quot;Frank Lampard&quot;, Goals=15, year=2012)])

myDF2 = sqlContext.createDataFrame(myRDD2)

myDF2.write.partitionBy(&quot;year&quot;).saveAsTable(&quot;chelsea_goals2&quot;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;%&lt;span class=&quot;code-keyword&quot;&gt;sql&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;select&lt;/span&gt; * &lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; chelsea_goals2;
&lt;span class=&quot;code-comment&quot;&gt;--Now everything works&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12863452">SPARK-10562</key>
            <summary>.partitionBy() creates the metastore partition columns in all lowercase, but persists the data path as MixedCase resulting in an error when the data is later attempted to query.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cloud_fan">Wenchen Fan</assignee>
                                    <reporter username="pohl.position">Jason Pohl</reporter>
                        <labels>
                    </labels>
                <created>Fri, 11 Sep 2015 16:19:57 +0000</created>
                <updated>Tue, 17 Nov 2015 04:08:46 +0000</updated>
                            <resolved>Tue, 27 Oct 2015 04:14:40 +0000</resolved>
                                    <version>1.4.1</version>
                                    <fixVersion>1.6.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14741066" author="pohl.position" created="Fri, 11 Sep 2015 16:21:03 +0000"  >&lt;p&gt;Databricks Notebook with code&lt;/p&gt;</comment>
                            <comment id="14969356" author="apachespark" created="Thu, 22 Oct 2015 16:02:06 +0000"  >&lt;p&gt;User &apos;cloud-fan&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/9226&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/9226&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14971042" author="apachespark" created="Fri, 23 Oct 2015 14:10:04 +0000"  >&lt;p&gt;User &apos;cloud-fan&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/9251&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/9251&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14975694" author="yhuai" created="Tue, 27 Oct 2015 04:14:40 +0000"  >&lt;p&gt;Issue resolved by pull request 9226&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/9226&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/9226&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15007739" author="lockwobr" created="Tue, 17 Nov 2015 01:04:27 +0000"  >&lt;p&gt;It seems that I am running into this in version 1.5.1, are the Affects Version/s: correct?&lt;/p&gt;</comment>
                            <comment id="15007980" author="yhuai" created="Tue, 17 Nov 2015 04:08:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lockwobr&quot; class=&quot;user-hover&quot; rel=&quot;lockwobr&quot;&gt;lockwobr&lt;/a&gt; Looks like this is a problem with 1.4.x and 1.5.x releases. It has been fixed in 1.6.0.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12755439" name="MixedCasePartitionBy.dbc" size="5952" author="pohl.position" created="Fri, 11 Sep 2015 16:21:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 1 week ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2k2br:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>