<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:44:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-15370] Some correlated subqueries return incorrect answers</title>
                <link>https://issues.apache.org/jira/browse/SPARK-15370</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;The rewrite introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-14785&quot; title=&quot;Support correlated scalar subquery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-14785&quot;&gt;&lt;del&gt;SPARK-14785&lt;/del&gt;&lt;/a&gt; has the COUNT bug. The rewrite changes the semantics of some correlated subqueries when there are tuples from the outer query block that do not join with the subquery. For example:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;spark-sql&amp;gt; create table R(a integer) as values (1);
spark-sql&amp;gt; create table S(b integer);
spark-sql&amp;gt; select R.a from R 
         &amp;gt;     where (select count(*) from S where R.a = S.b) = 0;
Time taken: 2.139 seconds                                                       
spark-sql&amp;gt; 
(returns zero rows; the answer should be one row of &apos;1&apos;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This problem also affects the SELECT clause:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;spark-sql&amp;gt; select R.a, 
         &amp;gt;     (select count(*) from S where R.a = S.b) as cnt 
         &amp;gt; from R;
1	NULL
(the answer should be &quot;1 0&quot;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Some subqueries with COUNT aggregates are &lt;b&gt;not&lt;/b&gt; affected:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;spark-sql&amp;gt; select R.a from R 
         &amp;gt;     where (select count(*) from S where R.a = S.b) &amp;gt; 0;
Time taken: 0.609 seconds
spark-sql&amp;gt;
(Correct answer)

spark-sql&amp;gt; select R.a from R 
         &amp;gt;     where (select count(*) + sum(S.b) from S where R.a = S.b) = 0;
Time taken: 0.553 seconds
spark-sql&amp;gt; 
(Correct answer)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Other cases can trigger the variant of the COUNT bug for expressions involving NULL checks:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;spark-sql&amp;gt; select R.a from R 
         &amp;gt; where (select sum(S.b) is null from S where R.a = S.b);
(returns zero rows, should return one row)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12970540">SPARK-15370</key>
            <summary>Some correlated subqueries return incorrect answers</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10003">Resolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="freiss">Frederick Reiss</reporter>
                        <labels>
                    </labels>
                <created>Tue, 17 May 2016 21:09:26 +0000</created>
                <updated>Tue, 15 Nov 2016 22:22:18 +0000</updated>
                            <resolved>Sun, 12 Jun 2016 21:23:37 +0000</resolved>
                                    <version>2.0.0</version>
                                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15287567" author="apachespark" created="Tue, 17 May 2016 21:12:05 +0000"  >&lt;p&gt;User &apos;frreiss&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/13155&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/13155&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15293496" author="freiss" created="Fri, 20 May 2016 15:01:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hvanhovell&quot; class=&quot;user-hover&quot; rel=&quot;hvanhovell&quot;&gt;hvanhovell&lt;/a&gt;&apos;s comments on the first PR pointed out some additional cases that this fix needs to cover. Thanks for the help! I&apos;m running regression tests on a second change set with additional code to cover these other cases.&lt;/p&gt;</comment>
                            <comment id="15326643" author="hvanhovell" created="Sun, 12 Jun 2016 21:29:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=freiss&quot; class=&quot;user-hover&quot; rel=&quot;freiss&quot;&gt;freiss&lt;/a&gt; For some reason I cannot assign the ticket to you.&lt;/p&gt;</comment>
                            <comment id="15326652" author="apachespark" created="Sun, 12 Jun 2016 21:59:03 +0000"  >&lt;p&gt;User &apos;hvanhovell&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/13626&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/13626&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15326699" author="apachespark" created="Mon, 13 Jun 2016 00:02:03 +0000"  >&lt;p&gt;User &apos;hvanhovell&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/13629&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/13629&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15327683" author="luciano resende" created="Mon, 13 Jun 2016 16:22:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hvanhovell&quot; class=&quot;user-hover&quot; rel=&quot;hvanhovell&quot;&gt;hvanhovell&lt;/a&gt; You might need to add &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=freiss&quot; class=&quot;user-hover&quot; rel=&quot;freiss&quot;&gt;freiss&lt;/a&gt; to contributor group in Spark jira admin console in order to assign the ticket to Fred. If you don&apos;t have access to it, maybe &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rxin&quot; class=&quot;user-hover&quot; rel=&quot;rxin&quot;&gt;rxin&lt;/a&gt; might be able to help sort this out.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13020945">SPARK-18455</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 23 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2y3wf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12329449">2.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>