<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:00:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-23778] SparkContext.emptyRDD confuses SparkContext.union</title>
                <link>https://issues.apache.org/jira/browse/SPARK-23778</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;SparkContext.emptyRDD is an unpartitioned RDD. Clearly it&apos;s empty so whether it&apos;s partitioned or not should be just a academic debate. Unfortunately it doesn&apos;t seem to be like this and the issue has side effects.&lt;/p&gt;

&lt;p&gt;Namely, it confuses the RDD union.&lt;/p&gt;

&lt;p&gt;When there are N classic RDDs partitioned the same way, the union is implemented with the optimized PartitionerAwareUnionRDD, that retains the common partitioner in the result. If one of the N RDDs happens to be an emptyRDD, as it doesn&apos;t have a partitioner, the union is implemented by just appending all the partitions of the N RDDs, dropping the partitioner. But there&apos;s no need for this, as the emptyRDD contains no elements. This results in further unneeded shuffles once the result of the union is used.&lt;/p&gt;

&lt;p&gt;See for example:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;val p = new HashPartitioner(3)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;val a = context.parallelize(List(10, 20, 30, 40, 50)).keyBy(_ / 10).partitionBy(p)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;val b1 = a.mapValues(_ + 1)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;val b2 = a.mapValues(_ - 1)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;val e = context.emptyRDD&lt;span class=&quot;error&quot;&gt;&amp;#91;(Int, Int)&amp;#93;&lt;/span&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;val x = context.union(a, b1, b2, e)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;val y = x.reduceByKey(_ + _)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;assert(x.partitioner.contains(p))&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;y.collect()&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;The assert fails. Disabling it, it&apos;s possible to see that reduceByKey introduced a shuffles, although all the input RDDs are already partitioned the same way, but the emptyRDD.&lt;/p&gt;

&lt;p&gt;Forcing a partitioner on the emptyRDD:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;val e = context.emptyRDD&lt;span class=&quot;error&quot;&gt;&amp;#91;(Int, Int)&amp;#93;&lt;/span&gt;.partitionBy(p)&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;solves the problem with the assert and doesn&apos;t introduce the unneeded extra stage and shuffle.&lt;/p&gt;

&lt;p&gt;Union implementation should be changed to ignore the partitioner of emptyRDDs and consider those as &lt;em&gt;partitioned in a way compatible with any partitioner&lt;/em&gt;, basically ignoring them.&lt;/p&gt;

&lt;p&gt;Present since 1.3 at least.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13147468">SPARK-23778</key>
            <summary>SparkContext.emptyRDD confuses SparkContext.union</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Trivial</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mgaido">Marco Gaido</assignee>
                                    <reporter username="ragazzojp">Stefano Pettini</reporter>
                        <labels>
                    </labels>
                <created>Fri, 23 Mar 2018 13:18:18 +0000</created>
                <updated>Wed, 20 Jun 2018 05:29:44 +0000</updated>
                            <resolved>Wed, 20 Jun 2018 05:29:27 +0000</resolved>
                                    <version>1.3.0</version>
                    <version>2.3.0</version>
                                    <fixVersion>2.4.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16475934" author="apachespark" created="Tue, 15 May 2018 14:47:06 +0000"  >&lt;p&gt;User &apos;mgaido91&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/21333&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/21333&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16517813" author="cloud_fan" created="Wed, 20 Jun 2018 05:29:28 +0000"  >&lt;p&gt;Issue resolved by pull request 21333&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/21333&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/21333&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12915899" name="as_it_should_be.png" size="202242" author="ragazzojp" created="Fri, 23 Mar 2018 13:19:05 +0000"/>
                            <attachment id="12915898" name="partitioner_lost_and_unneeded_extra_stage.png" size="167729" author="ragazzojp" created="Fri, 23 Mar 2018 13:18:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 21 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3rpbj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>