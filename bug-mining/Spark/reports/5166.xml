<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:55:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-21985] PySpark PairDeserializer is broken for double-zipped RDDs</title>
                <link>https://issues.apache.org/jira/browse/SPARK-21985</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;PySpark fails to deserialize double-zipped RDDs.  For example, the following example used to work in Spark 2.0.2:&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;gt;&amp;gt;&amp;gt; a = sc.parallelize(&lt;span class=&quot;code-quote&quot;&gt;&apos;aaa&apos;&lt;/span&gt;)
&amp;gt;&amp;gt;&amp;gt; b = sc.parallelize(&lt;span class=&quot;code-quote&quot;&gt;&apos;bbb&apos;&lt;/span&gt;)
&amp;gt;&amp;gt;&amp;gt; c = sc.parallelize(&lt;span class=&quot;code-quote&quot;&gt;&apos;ccc&apos;&lt;/span&gt;)
&amp;gt;&amp;gt;&amp;gt; a_bc = a.zip( b.zip(c) )
&amp;gt;&amp;gt;&amp;gt; a_bc.collect()
[(&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;, (&lt;span class=&quot;code-quote&quot;&gt;&apos;b&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;c&apos;&lt;/span&gt;)), (&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;, (&lt;span class=&quot;code-quote&quot;&gt;&apos;b&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;c&apos;&lt;/span&gt;)), (&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;, (&lt;span class=&quot;code-quote&quot;&gt;&apos;b&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;c&apos;&lt;/span&gt;))]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But in Spark &amp;gt;=2.1.0, it fails (regardless of Python 2 vs 3):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;gt;&amp;gt;&amp;gt; a_bc.collect()
Traceback (most recent call last):
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;stdin&amp;gt;&quot;&lt;/span&gt;, line 1, in &amp;lt;module&amp;gt;
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/workspace/spark-2.2.0-bin-hadoop2.7/python/pyspark/rdd.py&quot;&lt;/span&gt;, line 810, in collect
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; list(_load_from_socket(port, self._jrdd_deserializer))
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/workspace/spark-2.2.0-bin-hadoop2.7/python/pyspark/serializers.py&quot;&lt;/span&gt;, line 329, in _load_stream_without_unbatching
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; len(key_batch) != len(val_batch):
TypeError: object of type &lt;span class=&quot;code-quote&quot;&gt;&apos;itertools.izip&apos;&lt;/span&gt; has no len()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As you can see, the error seems to be caused by &lt;a href=&quot;https://github.com/apache/spark/blob/d03aebbe6508ba441dc87f9546f27aeb27553d77/python/pyspark/serializers.py#L346-L348&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;a check in the PairDeserializer class&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; len(key_batch) != len(val_batch):
    raise ValueError(&lt;span class=&quot;code-quote&quot;&gt;&quot;Can not deserialize PairRDD with different number of items&quot;&lt;/span&gt;
                     &lt;span class=&quot;code-quote&quot;&gt;&quot; in batches: (%d, %d)&quot;&lt;/span&gt; % (len(key_batch), len(val_batch)))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If that check is removed, then the example above works without error.  Can the check simply be removed?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13101697">SPARK-21985</key>
            <summary>PySpark PairDeserializer is broken for double-zipped RDDs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="a1ray">Andrew Ray</assignee>
                                    <reporter username="stuarteberg">Stuart Berg</reporter>
                        <labels>
                            <label>bug</label>
                    </labels>
                <created>Tue, 12 Sep 2017 16:05:15 +0000</created>
                <updated>Mon, 12 Dec 2022 18:11:08 +0000</updated>
                            <resolved>Sun, 17 Sep 2017 17:47:45 +0000</resolved>
                                    <version>2.1.0</version>
                    <version>2.1.1</version>
                    <version>2.2.0</version>
                                    <fixVersion>2.1.2</fixVersion>
                    <fixVersion>2.2.1</fixVersion>
                    <fixVersion>2.3.0</fixVersion>
                                    <component>PySpark</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16165408" author="holdenk" created="Wed, 13 Sep 2017 22:40:49 +0000"  >&lt;p&gt;CC &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=a1ray&quot; class=&quot;user-hover&quot; rel=&quot;a1ray&quot;&gt;a1ray&lt;/a&gt; moving the discussion back here from github, I&apos;m looking to try and cut 2.1.2 RC1 today/tonight if it&apos;s a simple enough fix (and it sounds like we could skip this check) would be nice to have this in release. Let me know if that sounds reasonable.&lt;/p&gt;</comment>
                            <comment id="16165600" author="apachespark" created="Thu, 14 Sep 2017 01:34:04 +0000"  >&lt;p&gt;User &apos;aray&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/19226&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/19226&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16165671" author="apachespark" created="Thu, 14 Sep 2017 03:34:03 +0000"  >&lt;p&gt;User &apos;HyukjinKwon&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/19228&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/19228&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16165672" author="gurwls223" created="Thu, 14 Sep 2017 03:35:56 +0000"  >&lt;p&gt;Oh, I am sorry, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=holdenk&quot; class=&quot;user-hover&quot; rel=&quot;holdenk&quot;&gt;holdenk&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=a1ray&quot; class=&quot;user-hover&quot; rel=&quot;a1ray&quot;&gt;a1ray&lt;/a&gt;. I just submitted a PR and I did not notice the comment here (I made this PR yesterday in my local and submitted now without seeing the comments here ..). Could you guys please review my approach please?&lt;/p&gt;</comment>
                            <comment id="16165676" author="gurwls223" created="Thu, 14 Sep 2017 03:37:43 +0000"  >&lt;p&gt;Doh, sorry, the PR comment &lt;tt&gt;User &apos;aray&apos; has created a pull request for this issue:&lt;/tt&gt; didn&apos;t show up my browser when I write comment ! &lt;/p&gt;</comment>
                            <comment id="16169367" author="gurwls223" created="Sun, 17 Sep 2017 17:47:45 +0000"  >&lt;p&gt;Issue resolved by pull request 19226&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/19226&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/19226&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 9 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3jz47:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12340295">2.1.2</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>