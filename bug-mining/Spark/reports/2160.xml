<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:29:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-5523] TaskMetrics and TaskInfo have innumerable copies of the hostname string</title>
                <link>https://issues.apache.org/jira/browse/SPARK-5523</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt; TaskMetrics and TaskInfo objects have the hostname associated with the task. As these are created (directly or through deserialization of RPC messages), each of them have a separate String object for the hostname even though most of them have the same string data in them. This results in thousands of string objects, increasing memory requirement of the driver. &lt;br/&gt;
This can be easily deduped when deserializing a TaskMetrics object, or when creating a TaskInfo object.&lt;/p&gt;

&lt;p&gt;This affects streaming particularly bad due to the rate of job/stage/task generation. &lt;/p&gt;

&lt;p&gt;For solution, see how this dedup is done for StorageLevel. &lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/storage/StorageLevel.scala#L226&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/storage/StorageLevel.scala#L226&lt;/a&gt; &lt;/p&gt;</description>
                <environment></environment>
        <key id="12771659">SPARK-5523</key>
            <summary>TaskMetrics and TaskInfo have innumerable copies of the hostname string</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jerryshao">Saisai Shao</assignee>
                                    <reporter username="tdas">Tathagata Das</reporter>
                        <labels>
                    </labels>
                <created>Mon, 2 Feb 2015 06:18:40 +0000</created>
                <updated>Wed, 15 Jul 2015 02:54:27 +0000</updated>
                            <resolved>Wed, 15 Jul 2015 02:54:27 +0000</resolved>
                                                    <fixVersion>1.5.0</fixVersion>
                                    <component>DStreams</component>
                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14301073" author="srowen" created="Mon, 2 Feb 2015 09:40:36 +0000"  >&lt;p&gt;How about `String.intern()` here, as a native implementation the flyweight pattern? you pay some extra overhead of consulting the interned string pool every time, but potentially save memory.&lt;/p&gt;</comment>
                            <comment id="14301089" author="tdas" created="Mon, 2 Feb 2015 09:52:41 +0000"  >&lt;p&gt;That is a little risky. In Java 6 internalized strings go to Perm gen&lt;br/&gt;
space, which is already oversubscribed thanks to he huge set of&lt;br/&gt;
dependencies of Spark - Hadoop, Hive, etc etc etc. It might be better to do&lt;br/&gt;
a very specific solution that we can bound the performance penalty of&lt;br/&gt;
(bounded HashMap for hostname cache).&lt;/p&gt;
</comment>
                            <comment id="14353847" author="tdas" created="Mon, 9 Mar 2015 23:14:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryshao&quot; class=&quot;user-hover&quot; rel=&quot;jerryshao&quot;&gt;jerryshao&lt;/a&gt; You can take a crack at this if you want. &lt;/p&gt;
</comment>
                            <comment id="14354078" author="jerryshao" created="Tue, 10 Mar 2015 01:40:38 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tdas&quot; class=&quot;user-hover&quot; rel=&quot;tdas&quot;&gt;tdas&lt;/a&gt;, I will take a look at this issue and try to find a solution, looks like a basic solution is to use HashMap to cache the data like &lt;tt&gt;StorageLevel&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="14362681" author="jerryshao" created="Mon, 16 Mar 2015 03:04:16 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tdas&quot; class=&quot;user-hover&quot; rel=&quot;tdas&quot;&gt;tdas&lt;/a&gt;, will this large number of string brings heavy overhead to GC or something others? Assuming these objects are out-of-date very soon, they will be in the young gen and GCed fastly, I&apos;m not sure how large overhead will this bring in?&lt;/p&gt;</comment>
                            <comment id="14362867" author="jerryshao" created="Mon, 16 Mar 2015 07:33:09 +0000"  >&lt;p&gt;After investigating a little on the implementation details of host in &lt;tt&gt;TaskMetrics&lt;/tt&gt; and &lt;tt&gt;TaskInfo&lt;/tt&gt;. &lt;/p&gt;

&lt;p&gt;I think for &lt;tt&gt;TaskInfo&lt;/tt&gt;, Spark already uses &lt;tt&gt;hostPortParseResults&lt;/tt&gt; in Utils.scala to cache the host name, so we don&apos;t need to do this again. Also &lt;tt&gt;TaskInfo&lt;/tt&gt; will only reside in driver, so RPC related object recreation is not existed.&lt;/p&gt;

&lt;p&gt;For &lt;tt&gt;TaskMetrics&lt;/tt&gt;, the problem lies in deserialization, mainly we could rewrite &lt;tt&gt;readObject()&lt;/tt&gt; function to use a cached host name like this way:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt;(classOf[IOException])
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; def readObject(in: ObjectInputStream): Unit = Utils.tryOrIOException {
    in.defaultReadObject()
    _hostname = getHostFromPool(_hostname)
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The question is that we still create a &lt;tt&gt;_hostname&lt;/tt&gt; String object, though very short-life. I&apos;m not sure is there a way we could reuse the cached hostname without even creating a very short-life one. Any suggestions? Thanks a lot.&lt;/p&gt;</comment>
                            <comment id="14364279" author="tdas" created="Tue, 17 Mar 2015 00:23:40 +0000"  >&lt;p&gt;As long as the hostname object is short-lived its cool. That&apos;s the same&lt;br/&gt;
strategy used for StorageLevel. So it is fine.&lt;/p&gt;

&lt;p&gt;On Mon, Mar 16, 2015 at 12:36 AM, Saisai Shao (JIRA) &amp;lt;jira@apache.org&amp;gt;&lt;/p&gt;
</comment>
                            <comment id="14364712" author="apachespark" created="Tue, 17 Mar 2015 07:34:53 +0000"  >&lt;p&gt;User &apos;jerryshao&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/5064&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/5064&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 36 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i252b3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>