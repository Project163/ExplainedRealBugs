<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:04:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-27019] Spark UI&apos;s SQL tab shows inconsistent values</title>
                <link>https://issues.apache.org/jira/browse/SPARK-27019</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Since 2.4.0, I am frequently seeing broken outputs in the SQL tab of the Spark UI, where submitted/duration make no sense, description has the ID instead of the actual description.&lt;/p&gt;

&lt;p&gt;Clicking on the link to open a query, the SQL plan is missing as well.&lt;/p&gt;

&lt;p&gt;I have tried to increase `spark.scheduler.listenerbus.eventqueue.capacity` to very large values like 30k out of paranoia that we may have too many events, but to no avail. I have not identified anything particular that leads to that: it doesn&apos;t occur in all my jobs, but it does occur in a lot of them still.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13218863">SPARK-27019</key>
            <summary>Spark UI&apos;s SQL tab shows inconsistent values</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shahid">shahid</assignee>
                                    <reporter username="peay">peay</reporter>
                        <labels>
                    </labels>
                <created>Fri, 1 Mar 2019 11:08:40 +0000</created>
                <updated>Sat, 25 Apr 2020 11:57:36 +0000</updated>
                            <resolved>Wed, 6 Mar 2019 22:09:24 +0000</resolved>
                                    <version>2.4.0</version>
                                    <fixVersion>2.4.1</fixVersion>
                    <fixVersion>3.0.0</fixVersion>
                                    <component>SQL</component>
                    <component>Web UI</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16781581" author="peay" created="Fri, 1 Mar 2019 11:09:34 +0000"  >&lt;p&gt;Seems like the screenshots did not embed, attaching them instead.&lt;/p&gt;</comment>
                            <comment id="16781583" author="peay" created="Fri, 1 Mar 2019 11:19:34 +0000"  >&lt;p&gt;Also seeing this both for the Spark UI for live jobs, and when accessing past jobs through the Spark History Server.&lt;/p&gt;</comment>
                            <comment id="16781588" author="shahid" created="Fri, 1 Mar 2019 11:30:24 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=peay&quot; class=&quot;user-hover&quot; rel=&quot;peay&quot;&gt;peay&lt;/a&gt; Could you please add test to reproduce it?&lt;/p&gt;</comment>
                            <comment id="16781595" author="peay" created="Fri, 1 Mar 2019 11:39:58 +0000"  >&lt;p&gt;I don&apos;t really have a minimal example - this uses a bunch of python jobs and/or interactive work in notebooks. Is there a way I could collect debug information to help troubleshooting this?&lt;/p&gt;</comment>
                            <comment id="16781604" author="peay" created="Fri, 1 Mar 2019 11:59:13 +0000"  >&lt;p&gt;OK, I can actually reproduce it pretty easily with pyspark:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
df_test = spark.range(1024 * 1024 * 1024 * 10).toPandas()&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This makes the tasks fail because my executors don&apos;t have enough memory, which seems to be key to hitting the issue. Using only 1000 elements, the job succeeds and it does not trigger the issue.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12960769/12960769_query-1-list.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12960770/12960770_query-1-details.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12960771/12960771_query-job-1.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="16781638" author="kabhwan" created="Fri, 1 Mar 2019 12:52:14 +0000"  >&lt;p&gt;Submitted date feels me as &quot;-1&quot;, as UNIX epoch 0 represents &quot;1970/01/01 00:00:00&quot;.&lt;/p&gt;</comment>
                            <comment id="16781651" author="peay" created="Fri, 1 Mar 2019 13:06:00 +0000"  >&lt;p&gt;Sure does.&lt;/p&gt;

&lt;p&gt;I&apos;ve done one more test, using no executors and running the same command:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
spark.range(1024 * 1024 * 1024 * 10).toPandas()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt; The SQL tab directly shows the wrong output, even though no task has started - i.e., my assumption above that this was because of failing tasks appears wrong. This actually seems consistent with the &apos;submitted date&apos; somehow being wrong.&lt;/p&gt;</comment>
                            <comment id="16781670" author="shahid" created="Fri, 1 Mar 2019 13:29:17 +0000"  >&lt;p&gt;seems event reordering has happened. Job start event came after sql execution end event, when the query failed. Could you please share spark eventLog for the application, if possible.&lt;/p&gt;</comment>
                            <comment id="16781718" author="peay" created="Fri, 1 Mar 2019 14:33:07 +0000"  >&lt;p&gt;Attached:&#160;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12960789/12960789_application_1550040445209_4748&quot; title=&quot;application_1550040445209_4748 attached to SPARK-27019&quot;&gt;application_1550040445209_4748&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="16781826" author="shahid" created="Fri, 1 Mar 2019 16:04:19 +0000"  >&lt;p&gt;Yes. The issue happened because of the event reordering when the query failed. JobStart event came after the SQLExecutioEnd event, so the UI displayed weirdly. I will analyze the issue and send a patch.&lt;/p&gt;

&lt;p&gt; &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12960797/12960797_Screenshot+from+2019-03-01+21-31-48.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/p&gt;</comment>
                            <comment id="16784172" author="peay" created="Tue, 5 Mar 2019 07:15:46 +0000"  >&lt;p&gt;Great! &lt;/p&gt;

&lt;p&gt;&lt;del&gt;Is that compatible with my second observation above? (I tested without any executors, and even without any task starting, the SQL tab had the wrong output). I can try to get an event log for that as well if that&apos;s helpful.&lt;/del&gt; edit: I tried to reproduce that to export the event log, and could not. Seems like your patch should address the issue.&lt;/p&gt;</comment>
                            <comment id="16784179" author="shahid" created="Tue, 5 Mar 2019 07:26:40 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=peay&quot; class=&quot;user-hover&quot; rel=&quot;peay&quot;&gt;peay&lt;/a&gt; could you please share the event log for that too, if possible&#160;&lt;/p&gt;</comment>
                            <comment id="16784194" author="shahid" created="Tue, 5 Mar 2019 07:56:58 +0000"  >&lt;p&gt;Please upload the screenshot of the sql page of the second scenario. I don&apos;t think in that case it will display like that. The issue happens only when the new live execution data is overwritten by the existing one&lt;/p&gt;</comment>
                            <comment id="16784260" author="peay" created="Tue, 5 Mar 2019 09:42:53 +0000"  >&lt;p&gt;Yes, I had edited my message above shortly after posting - cannot reproduce&#160;in the second scenario. Thanks!&lt;/p&gt;</comment>
                            <comment id="16786173" author="vanzin" created="Wed, 6 Mar 2019 22:09:24 +0000"  >&lt;p&gt;Issue resolved by pull request 23939&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/23939&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/23939&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13300957">SPARK-31564</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12960797" name="Screenshot from 2019-03-01 21-31-48.png" size="158609" author="shahid" created="Fri, 1 Mar 2019 16:04:04 +0000"/>
                            <attachment id="12960789" name="application_1550040445209_4748" size="81628" author="peay" created="Fri, 1 Mar 2019 14:33:00 +0000"/>
                            <attachment id="12960770" name="query-1-details.png" size="26961" author="peay" created="Fri, 1 Mar 2019 11:58:02 +0000"/>
                            <attachment id="12960769" name="query-1-list.png" size="29954" author="peay" created="Fri, 1 Mar 2019 11:58:02 +0000"/>
                            <attachment id="12960771" name="query-job-1.png" size="61877" author="peay" created="Fri, 1 Mar 2019 11:58:02 +0000"/>
                            <attachment id="12960764" name="screenshot-spark-ui-details.png" size="26692" author="peay" created="Fri, 1 Mar 2019 11:09:18 +0000"/>
                            <attachment id="12960765" name="screenshot-spark-ui-list.png" size="234558" author="peay" created="Fri, 1 Mar 2019 11:09:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 36 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z00874:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>