<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:44:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-50661] Scala Streaming foreachBatch doesn&apos;t work for input type Dataset[T] due to missing encoder for T.</title>
                <link>https://issues.apache.org/jira/browse/SPARK-50661</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Currently, spark connect implementation of Scala streaming does not take the encoder for T when the input is Dataset&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt;. This will lead to a runtime exception when the function passed is `(Dataset&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt;, Long) =&amp;gt; Unit`, while it is executed as `(Dataframe, Long) =&amp;gt; Unit`.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;We can reproduce the failure with the following test:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;import org.apache.spark.sql._&lt;br/&gt;
import org.apache.spark.sql.streaming._&lt;/p&gt;

&lt;p&gt;val inputPath = &quot;/tmp/input&quot;&lt;br/&gt;
case class C(id: Int, name: String, age: Int)&lt;br/&gt;
val data = Seq((1, &quot;Alice&quot;, 29), (2, &quot;Bob&quot;, 35), (3, &quot;Cathy&quot;, 26), (4, &quot;David&quot;, 40), (5, &quot;Eve&quot;, 30)).toDF(&quot;id&quot;, &quot;name&quot;, &quot;age&quot;)&lt;br/&gt;
data.write.format(&quot;csv&quot;).mode(&quot;overwrite&quot;).save(inputPath)&lt;br/&gt;
val df = spark.readStream.format(&quot;csv&quot;).schema(&quot;id INT, name String, age INT&quot;).load(&quot;/tmp/input&quot;)&lt;br/&gt;
val query = df.writeStream.foreachBatch { (batchDF: DataFrame, batchId: Long) =&amp;gt; &lt;/p&gt;
{ print(batchDF.collectAsList()) }
&lt;p&gt; }.trigger(Trigger.ProcessingTime(&quot;1 seconds&quot;)).start()&lt;br/&gt;
Thread.sleep(2000)&lt;br/&gt;
query.stop()&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The fix should address this by passing the encoder for T together with the function definition (as other Scala UDFs), and then restore the encoder in SparkConnectPlanner.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13603123">SPARK-50661</key>
            <summary>Scala Streaming foreachBatch doesn&apos;t work for input type Dataset[T] due to missing encoder for T.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="haiyang.sun">Haiyang Sun</assignee>
                                    <reporter username="haiyang.sun">Haiyang Sun</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 24 Dec 2024 13:13:05 +0000</created>
                <updated>Sat, 28 Dec 2024 07:21:07 +0000</updated>
                            <resolved>Sat, 28 Dec 2024 07:21:07 +0000</resolved>
                                    <version>3.5.4</version>
                    <version>4.0.0</version>
                                    <fixVersion>4.0.0</fixVersion>
                                    <component>Connect</component>
                    <component>Structured Streaming</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17908566" author="gurwls223" created="Sat, 28 Dec 2024 07:21:07 +0000"  >&lt;p&gt;Issue resolved by pull request 49323&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/49323&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/49323&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            45 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1tap4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>