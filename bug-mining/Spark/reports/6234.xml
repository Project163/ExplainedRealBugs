<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:03:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-26323] check input types of ScalaUDF even if some inputs are of Any type</title>
                <link>https://issues.apache.org/jira/browse/SPARK-26323</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description></description>
                <environment></environment>
        <key id="13203440">SPARK-26323</key>
            <summary>check input types of ScalaUDF even if some inputs are of Any type</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cloud_fan">Wenchen Fan</assignee>
                                    <reporter username="cloud_fan">Wenchen Fan</reporter>
                        <labels>
                    </labels>
                <created>Mon, 10 Dec 2018 14:14:44 +0000</created>
                <updated>Mon, 12 Dec 2022 18:10:53 +0000</updated>
                            <resolved>Tue, 8 Jan 2019 14:45:21 +0000</resolved>
                                    <version>2.4.0</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16714789" author="apachespark" created="Mon, 10 Dec 2018 14:32:10 +0000"  >&lt;p&gt;User &apos;cloud-fan&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/23275&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/23275&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16714790" author="apachespark" created="Mon, 10 Dec 2018 14:32:32 +0000"  >&lt;p&gt;User &apos;cloud-fan&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/23275&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/23275&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16714906" author="githubbot" created="Mon, 10 Dec 2018 15:20:56 +0000"  >&lt;p&gt;mgaido91 commented on a change in pull request #23275: &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-26323&quot; title=&quot;check input types of ScalaUDF even if some inputs are of Any type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-26323&quot;&gt;&lt;del&gt;SPARK-26323&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;SQL&amp;#93;&lt;/span&gt; Scala UDF should still check input types even if some inputs are of type Any&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/spark/pull/23275#discussion_r240250904&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/23275#discussion_r240250904&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: sql/core/src/main/scala/org/apache/spark/sql/expressions/UserDefinedFunction.scala&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -88,68 +88,49 @@ sealed trait UserDefinedFunction {&lt;br/&gt;
 private&lt;span class=&quot;error&quot;&gt;&amp;#91;sql&amp;#93;&lt;/span&gt; case class SparkUserDefinedFunction(&lt;br/&gt;
     f: AnyRef,&lt;br/&gt;
     dataType: DataType,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;inputTypes: Option[Seq&lt;span class=&quot;error&quot;&gt;&amp;#91;DataType&amp;#93;&lt;/span&gt;],&lt;/li&gt;
	&lt;li&gt;nullableTypes: Option[Seq&lt;span class=&quot;error&quot;&gt;&amp;#91;Boolean&amp;#93;&lt;/span&gt;],&lt;br/&gt;
+    inputSchemas: Seq[Option&lt;span class=&quot;error&quot;&gt;&amp;#91;ScalaReflection.Schema&amp;#93;&lt;/span&gt;],&lt;br/&gt;
     name: Option&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt; = None,&lt;br/&gt;
     nullable: Boolean = true,&lt;br/&gt;
     deterministic: Boolean = true) extends UserDefinedFunction {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   @scala.annotation.varargs&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;override def apply(exprs: Column*): Column = {&lt;/li&gt;
	&lt;li&gt;// TODO: make sure this class is only instantiated through `SparkUserDefinedFunction.create()`&lt;/li&gt;
	&lt;li&gt;// and `nullableTypes` is always set.&lt;/li&gt;
	&lt;li&gt;if (inputTypes.isDefined) 
{
-      assert(inputTypes.get.length == nullableTypes.get.length)
-    }
&lt;p&gt;-&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;val inputsNullSafe = nullableTypes.getOrElse 
{
-      ScalaReflection.getParameterTypeNullability(f)
-    }
&lt;p&gt;+  override def apply(cols: Column*): Column = &lt;/p&gt;
{
+    Column(createScalaUDF(cols.map(_.expr)))
+  }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Column(ScalaUDF(&lt;br/&gt;
+  private&lt;span class=&quot;error&quot;&gt;&amp;#91;sql&amp;#93;&lt;/span&gt; def createScalaUDF(exprs: Seq&lt;span class=&quot;error&quot;&gt;&amp;#91;Expression&amp;#93;&lt;/span&gt;): ScalaUDF = {&lt;br/&gt;
+    // It&apos;s possible that some of the inputs don&apos;t have a specific type(e.g. `Any`),  skip type&lt;br/&gt;
+    // check and null check for them.&lt;br/&gt;
+    val inputTypes = inputSchemas.map(&lt;em&gt;.map(&lt;/em&gt;.dataType).getOrElse(AnyDataType))&lt;br/&gt;
+    val inputsNullSafe = inputSchemas.map(&lt;em&gt;.map(&lt;/em&gt;.nullable).getOrElse(true))&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   nit: forall?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16715003" author="githubbot" created="Mon, 10 Dec 2018 16:12:00 +0000"  >&lt;p&gt;srowen commented on a change in pull request #23275: &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-26323&quot; title=&quot;check input types of ScalaUDF even if some inputs are of Any type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-26323&quot;&gt;&lt;del&gt;SPARK-26323&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;SQL&amp;#93;&lt;/span&gt; Scala UDF should still check input types even if some inputs are of type Any&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/spark/pull/23275#discussion_r240275041&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/23275#discussion_r240275041&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: sql/core/src/main/scala/org/apache/spark/sql/expressions/UserDefinedFunction.scala&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -88,68 +88,49 @@ sealed trait UserDefinedFunction {&lt;br/&gt;
 private&lt;span class=&quot;error&quot;&gt;&amp;#91;sql&amp;#93;&lt;/span&gt; case class SparkUserDefinedFunction(&lt;br/&gt;
     f: AnyRef,&lt;br/&gt;
     dataType: DataType,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;inputTypes: Option[Seq&lt;span class=&quot;error&quot;&gt;&amp;#91;DataType&amp;#93;&lt;/span&gt;],&lt;/li&gt;
	&lt;li&gt;nullableTypes: Option[Seq&lt;span class=&quot;error&quot;&gt;&amp;#91;Boolean&amp;#93;&lt;/span&gt;],&lt;br/&gt;
+    inputSchemas: Seq[Option&lt;span class=&quot;error&quot;&gt;&amp;#91;ScalaReflection.Schema&amp;#93;&lt;/span&gt;],&lt;br/&gt;
     name: Option&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt; = None,&lt;br/&gt;
     nullable: Boolean = true,&lt;br/&gt;
     deterministic: Boolean = true) extends UserDefinedFunction {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   @scala.annotation.varargs&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;override def apply(exprs: Column*): Column = {&lt;/li&gt;
	&lt;li&gt;// TODO: make sure this class is only instantiated through `SparkUserDefinedFunction.create()`&lt;/li&gt;
	&lt;li&gt;// and `nullableTypes` is always set.&lt;/li&gt;
	&lt;li&gt;if (inputTypes.isDefined) 
{
-      assert(inputTypes.get.length == nullableTypes.get.length)
-    }
&lt;p&gt;-&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;val inputsNullSafe = nullableTypes.getOrElse 
{
-      ScalaReflection.getParameterTypeNullability(f)
-    }
&lt;p&gt;+  override def apply(cols: Column*): Column = &lt;/p&gt;
{
+    Column(createScalaUDF(cols.map(_.expr)))
+  }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Column(ScalaUDF(&lt;br/&gt;
+  private&lt;span class=&quot;error&quot;&gt;&amp;#91;sql&amp;#93;&lt;/span&gt; def createScalaUDF(exprs: Seq&lt;span class=&quot;error&quot;&gt;&amp;#91;Expression&amp;#93;&lt;/span&gt;): ScalaUDF = {&lt;br/&gt;
+    // It&apos;s possible that some of the inputs don&apos;t have a specific type(e.g. `Any`),  skip type&lt;br/&gt;
+    // check and null check for them.&lt;br/&gt;
+    val inputTypes = inputSchemas.map(&lt;em&gt;.map(&lt;/em&gt;.dataType).getOrElse(AnyDataType))&lt;br/&gt;
+    val inputsNullSafe = inputSchemas.map(&lt;em&gt;.map(&lt;/em&gt;.nullable).getOrElse(true))&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   I&apos;m missing it, how could you write this more simply with `forall` to get from `Option&lt;span class=&quot;error&quot;&gt;&amp;#91;Schema&amp;#93;&lt;/span&gt;` to `Boolean`?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16715013" author="githubbot" created="Mon, 10 Dec 2018 16:18:58 +0000"  >&lt;p&gt;mgaido91 commented on a change in pull request #23275: &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-26323&quot; title=&quot;check input types of ScalaUDF even if some inputs are of Any type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-26323&quot;&gt;&lt;del&gt;SPARK-26323&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;SQL&amp;#93;&lt;/span&gt; Scala UDF should still check input types even if some inputs are of type Any&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/spark/pull/23275#discussion_r240278143&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/23275#discussion_r240278143&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: sql/core/src/main/scala/org/apache/spark/sql/expressions/UserDefinedFunction.scala&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -88,68 +88,49 @@ sealed trait UserDefinedFunction {&lt;br/&gt;
 private&lt;span class=&quot;error&quot;&gt;&amp;#91;sql&amp;#93;&lt;/span&gt; case class SparkUserDefinedFunction(&lt;br/&gt;
     f: AnyRef,&lt;br/&gt;
     dataType: DataType,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;inputTypes: Option[Seq&lt;span class=&quot;error&quot;&gt;&amp;#91;DataType&amp;#93;&lt;/span&gt;],&lt;/li&gt;
	&lt;li&gt;nullableTypes: Option[Seq&lt;span class=&quot;error&quot;&gt;&amp;#91;Boolean&amp;#93;&lt;/span&gt;],&lt;br/&gt;
+    inputSchemas: Seq[Option&lt;span class=&quot;error&quot;&gt;&amp;#91;ScalaReflection.Schema&amp;#93;&lt;/span&gt;],&lt;br/&gt;
     name: Option&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt; = None,&lt;br/&gt;
     nullable: Boolean = true,&lt;br/&gt;
     deterministic: Boolean = true) extends UserDefinedFunction {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   @scala.annotation.varargs&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;override def apply(exprs: Column*): Column = {&lt;/li&gt;
	&lt;li&gt;// TODO: make sure this class is only instantiated through `SparkUserDefinedFunction.create()`&lt;/li&gt;
	&lt;li&gt;// and `nullableTypes` is always set.&lt;/li&gt;
	&lt;li&gt;if (inputTypes.isDefined) 
{
-      assert(inputTypes.get.length == nullableTypes.get.length)
-    }
&lt;p&gt;-&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;val inputsNullSafe = nullableTypes.getOrElse 
{
-      ScalaReflection.getParameterTypeNullability(f)
-    }
&lt;p&gt;+  override def apply(cols: Column*): Column = &lt;/p&gt;
{
+    Column(createScalaUDF(cols.map(_.expr)))
+  }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Column(ScalaUDF(&lt;br/&gt;
+  private&lt;span class=&quot;error&quot;&gt;&amp;#91;sql&amp;#93;&lt;/span&gt; def createScalaUDF(exprs: Seq&lt;span class=&quot;error&quot;&gt;&amp;#91;Expression&amp;#93;&lt;/span&gt;): ScalaUDF = {&lt;br/&gt;
+    // It&apos;s possible that some of the inputs don&apos;t have a specific type(e.g. `Any`),  skip type&lt;br/&gt;
+    // check and null check for them.&lt;br/&gt;
+    val inputTypes = inputSchemas.map(&lt;em&gt;.map(&lt;/em&gt;.dataType).getOrElse(AnyDataType))&lt;br/&gt;
+    val inputsNullSafe = inputSchemas.map(&lt;em&gt;.map(&lt;/em&gt;.nullable).getOrElse(true))&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   I mean `inputSchemas.map(&lt;em&gt;.forall(&lt;/em&gt;.nullable))`&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16715022" author="githubbot" created="Mon, 10 Dec 2018 16:29:07 +0000"  >&lt;p&gt;SparkQA commented on issue #23275: &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-26323&quot; title=&quot;check input types of ScalaUDF even if some inputs are of Any type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-26323&quot;&gt;&lt;del&gt;SPARK-26323&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;SQL&amp;#93;&lt;/span&gt; Scala UDF should still check input types even if some inputs are of type Any&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/spark/pull/23275#issuecomment-445878673&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/23275#issuecomment-445878673&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   **&lt;a href=&quot;#99919 has finished&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Test build #99919 has finished&lt;/a&gt;(&lt;a href=&quot;https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/99919/testReport)**&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/99919/testReport)**&lt;/a&gt; for PR 23275 at commit &lt;span class=&quot;error&quot;&gt;&amp;#91;`8582607`&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://github.com/apache/spark/commit/8582607195f12a4c133fb28b59e8a7fce7a97fbb&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/commit/8582607195f12a4c133fb28b59e8a7fce7a97fbb&lt;/a&gt;).&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;This patch *&lt;b&gt;fails Spark unit tests&lt;/b&gt;*.&lt;/li&gt;
	&lt;li&gt;This patch merges cleanly.&lt;/li&gt;
	&lt;li&gt;This patch adds no public classes.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16715023" author="githubbot" created="Mon, 10 Dec 2018 16:29:48 +0000"  >&lt;p&gt;AmplabJenkins commented on issue #23275: &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-26323&quot; title=&quot;check input types of ScalaUDF even if some inputs are of Any type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-26323&quot;&gt;&lt;del&gt;SPARK-26323&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;SQL&amp;#93;&lt;/span&gt; Scala UDF should still check input types even if some inputs are of type Any&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/spark/pull/23275#issuecomment-445878926&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/23275#issuecomment-445878926&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Merged build finished. Test FAILed.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16715024" author="githubbot" created="Mon, 10 Dec 2018 16:29:49 +0000"  >&lt;p&gt;AmplabJenkins commented on issue #23275: &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-26323&quot; title=&quot;check input types of ScalaUDF even if some inputs are of Any type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-26323&quot;&gt;&lt;del&gt;SPARK-26323&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;SQL&amp;#93;&lt;/span&gt; Scala UDF should still check input types even if some inputs are of type Any&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/spark/pull/23275#issuecomment-445878940&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/23275#issuecomment-445878940&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Test FAILed.&lt;br/&gt;
   Refer to this link for build results (access rights to CI server needed): &lt;br/&gt;
   &lt;a href=&quot;https://amplab.cs.berkeley.edu/jenkins//job/SparkPullRequestBuilder/99919/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://amplab.cs.berkeley.edu/jenkins//job/SparkPullRequestBuilder/99919/&lt;/a&gt;&lt;br/&gt;
   Test FAILed.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16715025" author="githubbot" created="Mon, 10 Dec 2018 16:30:10 +0000"  >&lt;p&gt;SparkQA removed a comment on issue #23275: &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-26323&quot; title=&quot;check input types of ScalaUDF even if some inputs are of Any type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-26323&quot;&gt;&lt;del&gt;SPARK-26323&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;SQL&amp;#93;&lt;/span&gt; Scala UDF should still check input types even if some inputs are of type Any&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/spark/pull/23275#issuecomment-445836177&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/23275#issuecomment-445836177&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   **&lt;a href=&quot;#99919 has started&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Test build #99919 has started&lt;/a&gt;(&lt;a href=&quot;https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/99919/testReport)**&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/99919/testReport)**&lt;/a&gt; for PR 23275 at commit &lt;span class=&quot;error&quot;&gt;&amp;#91;`8582607`&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://github.com/apache/spark/commit/8582607195f12a4c133fb28b59e8a7fce7a97fbb&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/commit/8582607195f12a4c133fb28b59e8a7fce7a97fbb&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16715026" author="githubbot" created="Mon, 10 Dec 2018 16:30:14 +0000"  >&lt;p&gt;AmplabJenkins removed a comment on issue #23275: &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-26323&quot; title=&quot;check input types of ScalaUDF even if some inputs are of Any type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-26323&quot;&gt;&lt;del&gt;SPARK-26323&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;SQL&amp;#93;&lt;/span&gt; Scala UDF should still check input types even if some inputs are of type Any&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/spark/pull/23275#issuecomment-445878926&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/23275#issuecomment-445878926&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Merged build finished. Test FAILed.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16715028" author="githubbot" created="Mon, 10 Dec 2018 16:31:08 +0000"  >&lt;p&gt;AmplabJenkins removed a comment on issue #23275: &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-26323&quot; title=&quot;check input types of ScalaUDF even if some inputs are of Any type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-26323&quot;&gt;&lt;del&gt;SPARK-26323&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;SQL&amp;#93;&lt;/span&gt; Scala UDF should still check input types even if some inputs are of type Any&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/spark/pull/23275#issuecomment-445878940&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/23275#issuecomment-445878940&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Test FAILed.&lt;br/&gt;
   Refer to this link for build results (access rights to CI server needed): &lt;br/&gt;
   &lt;a href=&quot;https://amplab.cs.berkeley.edu/jenkins//job/SparkPullRequestBuilder/99919/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://amplab.cs.berkeley.edu/jenkins//job/SparkPullRequestBuilder/99919/&lt;/a&gt;&lt;br/&gt;
   Test FAILed.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16715041" author="githubbot" created="Mon, 10 Dec 2018 16:38:46 +0000"  >&lt;p&gt;SparkQA commented on issue #23275: &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-26323&quot; title=&quot;check input types of ScalaUDF even if some inputs are of Any type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-26323&quot;&gt;&lt;del&gt;SPARK-26323&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;SQL&amp;#93;&lt;/span&gt; Scala UDF should still check input types even if some inputs are of type Any&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/spark/pull/23275#issuecomment-445882225&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/23275#issuecomment-445882225&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   **&lt;a href=&quot;#99920 has finished&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Test build #99920 has finished&lt;/a&gt;(&lt;a href=&quot;https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/99920/testReport)**&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/99920/testReport)**&lt;/a&gt; for PR 23275 at commit &lt;span class=&quot;error&quot;&gt;&amp;#91;`92466d4`&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://github.com/apache/spark/commit/92466d486734f3904be31e45b85e49654eb39255&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/commit/92466d486734f3904be31e45b85e49654eb39255&lt;/a&gt;).&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;This patch *&lt;b&gt;fails Spark unit tests&lt;/b&gt;*.&lt;/li&gt;
	&lt;li&gt;This patch merges cleanly.&lt;/li&gt;
	&lt;li&gt;This patch adds no public classes.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16715043" author="githubbot" created="Mon, 10 Dec 2018 16:39:09 +0000"  >&lt;p&gt;SparkQA removed a comment on issue #23275: &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-26323&quot; title=&quot;check input types of ScalaUDF even if some inputs are of Any type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-26323&quot;&gt;&lt;del&gt;SPARK-26323&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;SQL&amp;#93;&lt;/span&gt; Scala UDF should still check input types even if some inputs are of type Any&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/spark/pull/23275#issuecomment-445840083&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/23275#issuecomment-445840083&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   **&lt;a href=&quot;#99920 has started&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Test build #99920 has started&lt;/a&gt;(&lt;a href=&quot;https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/99920/testReport)**&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://amplab.cs.berkeley.edu/jenkins/job/SparkPullRequestBuilder/99920/testReport)**&lt;/a&gt; for PR 23275 at commit &lt;span class=&quot;error&quot;&gt;&amp;#91;`92466d4`&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://github.com/apache/spark/commit/92466d486734f3904be31e45b85e49654eb39255&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/commit/92466d486734f3904be31e45b85e49654eb39255&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16715045" author="githubbot" created="Mon, 10 Dec 2018 16:39:46 +0000"  >&lt;p&gt;AmplabJenkins commented on issue #23275: &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-26323&quot; title=&quot;check input types of ScalaUDF even if some inputs are of Any type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-26323&quot;&gt;&lt;del&gt;SPARK-26323&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;SQL&amp;#93;&lt;/span&gt; Scala UDF should still check input types even if some inputs are of type Any&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/spark/pull/23275#issuecomment-445882594&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/23275#issuecomment-445882594&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Merged build finished. Test FAILed.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16715046" author="githubbot" created="Mon, 10 Dec 2018 16:39:47 +0000"  >&lt;p&gt;AmplabJenkins commented on issue #23275: &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-26323&quot; title=&quot;check input types of ScalaUDF even if some inputs are of Any type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-26323&quot;&gt;&lt;del&gt;SPARK-26323&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;SQL&amp;#93;&lt;/span&gt; Scala UDF should still check input types even if some inputs are of type Any&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/spark/pull/23275#issuecomment-445882601&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/23275#issuecomment-445882601&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Test FAILed.&lt;br/&gt;
   Refer to this link for build results (access rights to CI server needed): &lt;br/&gt;
   &lt;a href=&quot;https://amplab.cs.berkeley.edu/jenkins//job/SparkPullRequestBuilder/99920/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://amplab.cs.berkeley.edu/jenkins//job/SparkPullRequestBuilder/99920/&lt;/a&gt;&lt;br/&gt;
   Test FAILed.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16715048" author="githubbot" created="Mon, 10 Dec 2018 16:40:10 +0000"  >&lt;p&gt;AmplabJenkins removed a comment on issue #23275: &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-26323&quot; title=&quot;check input types of ScalaUDF even if some inputs are of Any type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-26323&quot;&gt;&lt;del&gt;SPARK-26323&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;SQL&amp;#93;&lt;/span&gt; Scala UDF should still check input types even if some inputs are of type Any&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/spark/pull/23275#issuecomment-445882594&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/23275#issuecomment-445882594&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Merged build finished. Test FAILed.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16715051" author="githubbot" created="Mon, 10 Dec 2018 16:41:08 +0000"  >&lt;p&gt;AmplabJenkins removed a comment on issue #23275: &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-26323&quot; title=&quot;check input types of ScalaUDF even if some inputs are of Any type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-26323&quot;&gt;&lt;del&gt;SPARK-26323&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;SQL&amp;#93;&lt;/span&gt; Scala UDF should still check input types even if some inputs are of type Any&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/spark/pull/23275#issuecomment-445882601&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/23275#issuecomment-445882601&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Test FAILed.&lt;br/&gt;
   Refer to this link for build results (access rights to CI server needed): &lt;br/&gt;
   &lt;a href=&quot;https://amplab.cs.berkeley.edu/jenkins//job/SparkPullRequestBuilder/99920/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://amplab.cs.berkeley.edu/jenkins//job/SparkPullRequestBuilder/99920/&lt;/a&gt;&lt;br/&gt;
   Test FAILed.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16715114" author="githubbot" created="Mon, 10 Dec 2018 17:08:54 +0000"  >&lt;p&gt;srowen commented on a change in pull request #23275: &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-26323&quot; title=&quot;check input types of ScalaUDF even if some inputs are of Any type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-26323&quot;&gt;&lt;del&gt;SPARK-26323&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;SQL&amp;#93;&lt;/span&gt; Scala UDF should still check input types even if some inputs are of type Any&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/spark/pull/23275#discussion_r240298939&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/23275#discussion_r240298939&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: sql/core/src/main/scala/org/apache/spark/sql/expressions/UserDefinedFunction.scala&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -88,68 +88,49 @@ sealed trait UserDefinedFunction {&lt;br/&gt;
 private&lt;span class=&quot;error&quot;&gt;&amp;#91;sql&amp;#93;&lt;/span&gt; case class SparkUserDefinedFunction(&lt;br/&gt;
     f: AnyRef,&lt;br/&gt;
     dataType: DataType,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;inputTypes: Option[Seq&lt;span class=&quot;error&quot;&gt;&amp;#91;DataType&amp;#93;&lt;/span&gt;],&lt;/li&gt;
	&lt;li&gt;nullableTypes: Option[Seq&lt;span class=&quot;error&quot;&gt;&amp;#91;Boolean&amp;#93;&lt;/span&gt;],&lt;br/&gt;
+    inputSchemas: Seq[Option&lt;span class=&quot;error&quot;&gt;&amp;#91;ScalaReflection.Schema&amp;#93;&lt;/span&gt;],&lt;br/&gt;
     name: Option&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt; = None,&lt;br/&gt;
     nullable: Boolean = true,&lt;br/&gt;
     deterministic: Boolean = true) extends UserDefinedFunction {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   @scala.annotation.varargs&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;override def apply(exprs: Column*): Column = {&lt;/li&gt;
	&lt;li&gt;// TODO: make sure this class is only instantiated through `SparkUserDefinedFunction.create()`&lt;/li&gt;
	&lt;li&gt;// and `nullableTypes` is always set.&lt;/li&gt;
	&lt;li&gt;if (inputTypes.isDefined) 
{
-      assert(inputTypes.get.length == nullableTypes.get.length)
-    }
&lt;p&gt;-&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;val inputsNullSafe = nullableTypes.getOrElse 
{
-      ScalaReflection.getParameterTypeNullability(f)
-    }
&lt;p&gt;+  override def apply(cols: Column*): Column = &lt;/p&gt;
{
+    Column(createScalaUDF(cols.map(_.expr)))
+  }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Column(ScalaUDF(&lt;br/&gt;
+  private&lt;span class=&quot;error&quot;&gt;&amp;#91;sql&amp;#93;&lt;/span&gt; def createScalaUDF(exprs: Seq&lt;span class=&quot;error&quot;&gt;&amp;#91;Expression&amp;#93;&lt;/span&gt;): ScalaUDF = {&lt;br/&gt;
+    // It&apos;s possible that some of the inputs don&apos;t have a specific type(e.g. `Any`),  skip type&lt;br/&gt;
+    // check and null check for them.&lt;br/&gt;
+    val inputTypes = inputSchemas.map(&lt;em&gt;.map(&lt;/em&gt;.dataType).getOrElse(AnyDataType))&lt;br/&gt;
+    val inputsNullSafe = inputSchemas.map(&lt;em&gt;.map(&lt;/em&gt;.nullable).getOrElse(true))&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   Ah right. I&apos;m neutral on whether it&apos;s clearer than getOrElse; I think we end up using the latter in the code more. I know IJ suggests forall though.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16715966" author="githubbot" created="Tue, 11 Dec 2018 01:58:59 +0000"  >&lt;p&gt;cloud-fan commented on a change in pull request #23275: &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-26323&quot; title=&quot;check input types of ScalaUDF even if some inputs are of Any type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-26323&quot;&gt;&lt;del&gt;SPARK-26323&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;SQL&amp;#93;&lt;/span&gt; Scala UDF should still check input types even if some inputs are of type Any&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/spark/pull/23275#discussion_r240449840&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/23275#discussion_r240449840&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/expressions/ScalaUDF.scala&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -47,25 +47,13 @@ case class ScalaUDF(&lt;br/&gt;
     function: AnyRef,&lt;br/&gt;
     dataType: DataType,&lt;br/&gt;
     children: Seq&lt;span class=&quot;error&quot;&gt;&amp;#91;Expression&amp;#93;&lt;/span&gt;,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;inputsNullSafe: Seq&lt;span class=&quot;error&quot;&gt;&amp;#91;Boolean&amp;#93;&lt;/span&gt;,&lt;/li&gt;
	&lt;li&gt;inputTypes: Seq&lt;span class=&quot;error&quot;&gt;&amp;#91;DataType&amp;#93;&lt;/span&gt; = Nil,&lt;br/&gt;
+    @transient inputsNullSafe: Seq&lt;span class=&quot;error&quot;&gt;&amp;#91;Boolean&amp;#93;&lt;/span&gt;,&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   expressions are usually serialized to executor side. Previously it&apos;s fine, as all data types are case class, which is serializable. But `AnyDataType` is normal scala object, which is not serializable.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16715979" author="githubbot" created="Tue, 11 Dec 2018 02:13:09 +0000"  >&lt;p&gt;cloud-fan commented on a change in pull request #23275: &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-26323&quot; title=&quot;check input types of ScalaUDF even if some inputs are of Any type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-26323&quot;&gt;&lt;del&gt;SPARK-26323&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;SQL&amp;#93;&lt;/span&gt; Scala UDF should still check input types even if some inputs are of type Any&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/spark/pull/23275#discussion_r240451835&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/23275#discussion_r240451835&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: sql/core/src/main/scala/org/apache/spark/sql/expressions/UserDefinedFunction.scala&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -88,68 +88,49 @@ sealed trait UserDefinedFunction {&lt;br/&gt;
 private&lt;span class=&quot;error&quot;&gt;&amp;#91;sql&amp;#93;&lt;/span&gt; case class SparkUserDefinedFunction(&lt;br/&gt;
     f: AnyRef,&lt;br/&gt;
     dataType: DataType,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;inputTypes: Option[Seq&lt;span class=&quot;error&quot;&gt;&amp;#91;DataType&amp;#93;&lt;/span&gt;],&lt;/li&gt;
	&lt;li&gt;nullableTypes: Option[Seq&lt;span class=&quot;error&quot;&gt;&amp;#91;Boolean&amp;#93;&lt;/span&gt;],&lt;br/&gt;
+    inputSchemas: Seq[Option&lt;span class=&quot;error&quot;&gt;&amp;#91;ScalaReflection.Schema&amp;#93;&lt;/span&gt;],&lt;br/&gt;
     name: Option&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt; = None,&lt;br/&gt;
     nullable: Boolean = true,&lt;br/&gt;
     deterministic: Boolean = true) extends UserDefinedFunction {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   @scala.annotation.varargs&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;override def apply(exprs: Column*): Column = {&lt;/li&gt;
	&lt;li&gt;// TODO: make sure this class is only instantiated through `SparkUserDefinedFunction.create()`&lt;/li&gt;
	&lt;li&gt;// and `nullableTypes` is always set.&lt;/li&gt;
	&lt;li&gt;if (inputTypes.isDefined) 
{
-      assert(inputTypes.get.length == nullableTypes.get.length)
-    }
&lt;p&gt;-&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;val inputsNullSafe = nullableTypes.getOrElse 
{
-      ScalaReflection.getParameterTypeNullability(f)
-    }
&lt;p&gt;+  override def apply(cols: Column*): Column = &lt;/p&gt;
{
+    Column(createScalaUDF(cols.map(_.expr)))
+  }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Column(ScalaUDF(&lt;br/&gt;
+  private&lt;span class=&quot;error&quot;&gt;&amp;#91;sql&amp;#93;&lt;/span&gt; def createScalaUDF(exprs: Seq&lt;span class=&quot;error&quot;&gt;&amp;#91;Expression&amp;#93;&lt;/span&gt;): ScalaUDF = {&lt;br/&gt;
+    // It&apos;s possible that some of the inputs don&apos;t have a specific type(e.g. `Any`),  skip type&lt;br/&gt;
+    // check and null check for them.&lt;br/&gt;
+    val inputTypes = inputSchemas.map(&lt;em&gt;.map(&lt;/em&gt;.dataType).getOrElse(AnyDataType))&lt;br/&gt;
+    val inputsNullSafe = inputSchemas.map(&lt;em&gt;.map(&lt;/em&gt;.nullable).getOrElse(true))&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   Here `getOrElse` maybe better, as it matches the previous line.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16737186" author="gurwls223" created="Tue, 8 Jan 2019 14:45:21 +0000"  >&lt;p&gt;Issue resolved by pull request 23275&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/23275&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/23275&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 45 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|s01cmo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>