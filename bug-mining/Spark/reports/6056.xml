<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:02:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-25591] PySpark Accumulators with multiple PythonUDFs</title>
                <link>https://issues.apache.org/jira/browse/SPARK-25591</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;When having multiple Python UDFs - the last Python UDF&apos;s accumulator is the only accumulator that gets updated.&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-python&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; pyspark
&lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; pyspark.sql &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; SparkSession, Row
&lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; pyspark.sql &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; functions &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; F
&lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; pyspark.sql &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; types &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; T

&lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; pyspark &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; AccumulatorParam

spark = SparkSession.builder.getOrCreate()
spark.sparkContext.setLogLevel(&lt;span class=&quot;code-quote&quot;&gt;&quot;ERROR&quot;&lt;/span&gt;)
test_accum = spark.sparkContext.accumulator(0.0)

SHUFFLE = &lt;span class=&quot;code-keyword&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;False&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; main(data):
    &lt;span class=&quot;code-object&quot;&gt;print&lt;/span&gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;gt;&amp;gt;&amp;gt; Check0&quot;&lt;/span&gt;, test_accum.value)
    &lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; test(x):
        &lt;span class=&quot;code-keyword&quot;&gt;global&lt;/span&gt; test_accum
        test_accum += 1.0
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; x

    &lt;span class=&quot;code-object&quot;&gt;print&lt;/span&gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;gt;&amp;gt;&amp;gt; Check1&quot;&lt;/span&gt;, test_accum.value)

    &lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; test2(x):
        &lt;span class=&quot;code-keyword&quot;&gt;global&lt;/span&gt; test_accum
        test_accum += 100.0
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; x

    &lt;span class=&quot;code-object&quot;&gt;print&lt;/span&gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;gt;&amp;gt;&amp;gt; Check2&quot;&lt;/span&gt;, test_accum.value)
    func_udf = F.udf(test, T.DoubleType())
    &lt;span class=&quot;code-object&quot;&gt;print&lt;/span&gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;gt;&amp;gt;&amp;gt; Check3&quot;&lt;/span&gt;, test_accum.value)
    func_udf2 = F.udf(test2, T.DoubleType())
    &lt;span class=&quot;code-object&quot;&gt;print&lt;/span&gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;gt;&amp;gt;&amp;gt; Check4&quot;&lt;/span&gt;, test_accum.value)

    data = data.withColumn(&lt;span class=&quot;code-quote&quot;&gt;&quot;out1&quot;&lt;/span&gt;, func_udf(data[&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;]))
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; SHUFFLE:
        data = data.repartition(2)
    &lt;span class=&quot;code-object&quot;&gt;print&lt;/span&gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;gt;&amp;gt;&amp;gt; Check5&quot;&lt;/span&gt;, test_accum.value)
    data = data.withColumn(&lt;span class=&quot;code-quote&quot;&gt;&quot;out2&quot;&lt;/span&gt;, func_udf2(data[&lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;]))
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; SHUFFLE:
        data = data.repartition(2)
    &lt;span class=&quot;code-object&quot;&gt;print&lt;/span&gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;gt;&amp;gt;&amp;gt; Check6&quot;&lt;/span&gt;, test_accum.value)

    data.show()  &lt;span class=&quot;code-comment&quot;&gt;# ACTION
&lt;/span&gt;    &lt;span class=&quot;code-object&quot;&gt;print&lt;/span&gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;gt;&amp;gt;&amp;gt; Check7&quot;&lt;/span&gt;, test_accum.value)
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; data


df = spark.createDataFrame([
    [1.0, 2.0]
], schema=T.StructType([T.StructField(field_name, T.DoubleType(), &lt;span class=&quot;code-keyword&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;True&lt;/span&gt;&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; field_name &lt;span class=&quot;code-keyword&quot;&gt;in&lt;/span&gt; [&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;]]))

df2 = main(df)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-python&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;######## Output 1 - &lt;span class=&quot;code-keyword&quot;&gt;with&lt;/span&gt; SHUFFLE=&lt;span class=&quot;code-keyword&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;False&lt;/span&gt;&lt;/span&gt;
&lt;/span&gt;...
&lt;span class=&quot;code-comment&quot;&gt;# &amp;gt;&amp;gt;&amp;gt; Check7 100.0
&lt;/span&gt;

&lt;span class=&quot;code-comment&quot;&gt;######## Output 2 - &lt;span class=&quot;code-keyword&quot;&gt;with&lt;/span&gt; SHUFFLE=&lt;span class=&quot;code-keyword&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;True&lt;/span&gt;&lt;/span&gt;
&lt;/span&gt;...
&lt;span class=&quot;code-comment&quot;&gt;# &amp;gt;&amp;gt;&amp;gt; Check7 101.0&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Basically looks like:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Accumulator works only for last UDF before a shuffle-like operation&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="13188754">SPARK-25591</key>
            <summary>PySpark Accumulators with multiple PythonUDFs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="viirya">L. C. Hsieh</assignee>
                                    <reporter username="AbdealiJK">Abdeali Kothari</reporter>
                        <labels>
                            <label>correctness</label>
                    </labels>
                <created>Tue, 2 Oct 2018 04:46:39 +0000</created>
                <updated>Mon, 12 Dec 2022 18:10:59 +0000</updated>
                            <resolved>Mon, 8 Oct 2018 07:39:57 +0000</resolved>
                                    <version>2.1.3</version>
                    <version>2.2.2</version>
                    <version>2.3.2</version>
                                    <fixVersion>2.2.3</fixVersion>
                    <fixVersion>2.3.3</fixVersion>
                    <fixVersion>2.4.0</fixVersion>
                                    <component>PySpark</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16639059" author="apachespark" created="Thu, 4 Oct 2018 23:50:18 +0000"  >&lt;p&gt;User &apos;viirya&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22635&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22635&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16639061" author="apachespark" created="Thu, 4 Oct 2018 23:51:32 +0000"  >&lt;p&gt;User &apos;viirya&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22635&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22635&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16641471" author="gurwls223" created="Mon, 8 Oct 2018 07:39:57 +0000"  >&lt;p&gt;Fixed in &lt;a href=&quot;https://github.com/apache/spark/pull/22635&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22635&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16642506" author="smilegator" created="Mon, 8 Oct 2018 21:25:26 +0000"  >&lt;p&gt;RC3 is not out yet. Thus, RC3 will include the fix.&lt;/p&gt;</comment>
                            <comment id="16732556" author="dongjoon" created="Thu, 3 Jan 2019 01:01:02 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=viirya&quot; class=&quot;user-hover&quot; rel=&quot;viirya&quot;&gt;viirya&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hyukjin.kwon&quot; class=&quot;user-hover&quot; rel=&quot;hyukjin.kwon&quot;&gt;hyukjin.kwon&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;This is only in branch-2.4. Can we backport this to older branches like branch-2.3 and branch-2.2?&lt;/p&gt;

&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=AbdealiJK&quot; class=&quot;user-hover&quot; rel=&quot;AbdealiJK&quot;&gt;AbdealiJK&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16732567" author="viirya" created="Thu, 3 Jan 2019 01:28:50 +0000"  >&lt;p&gt;This is bug fixing, so I think it makes sense to backport this to branch-2.3 and 2.2 if needed.&lt;/p&gt;</comment>
                            <comment id="16732569" author="viirya" created="Thu, 3 Jan 2019 01:29:23 +0000"  >&lt;p&gt;I can make backport PRs if you need. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dongjoon&quot; class=&quot;user-hover&quot; rel=&quot;dongjoon&quot;&gt;dongjoon&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16732573" author="dongjoon" created="Thu, 3 Jan 2019 01:33:10 +0000"  >&lt;p&gt;Thank you for confirming, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=viirya&quot; class=&quot;user-hover&quot; rel=&quot;viirya&quot;&gt;viirya&lt;/a&gt;. Yes. Please make two PRs for them.&lt;/p&gt;</comment>
                            <comment id="16732574" author="gurwls223" created="Thu, 3 Jan 2019 01:35:23 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 45 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3yps7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12343560">2.2.3</customfieldvalue>
    <customfieldvalue id="12343759">2.3.3</customfieldvalue>
    <customfieldvalue id="12342385">2.4.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>