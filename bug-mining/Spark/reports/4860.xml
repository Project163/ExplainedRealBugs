<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:53:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-20687] mllib.Matrices.fromBreeze may crash when converting from Breeze sparse matrix</title>
                <link>https://issues.apache.org/jira/browse/SPARK-20687</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Conversion of Breeze sparse matrices to Matrix is broken when matrices are product of certain operations. This problem I think is caused by the update method in Breeze CSCMatrix when they add provisional zeros to the data for efficiency.&lt;/p&gt;

&lt;p&gt;This bug is serious and may affect at least BlockMatrix addition and substraction&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://stackoverflow.com/questions/33528555/error-thrown-when-using-blockmatrix-add/43883458#43883458&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/33528555/error-thrown-when-using-blockmatrix-add/43883458#43883458&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The following code, reproduces the bug (Check test(&quot;breeze conversion bug&quot;))&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/ghoto/spark/blob/test-bug/CSCMatrixBreeze/mllib/src/test/scala/org/apache/spark/mllib/linalg/MatricesSuite.scala&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ghoto/spark/blob/test-bug/CSCMatrixBreeze/mllib/src/test/scala/org/apache/spark/mllib/linalg/MatricesSuite.scala&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;MatricesSuite.scala&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  test(&lt;span class=&quot;code-quote&quot;&gt;&quot;breeze conversion bug&quot;&lt;/span&gt;) {
    &lt;span class=&quot;code-comment&quot;&gt;// (2, 0, 0)
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// (2, 0, 0)
&lt;/span&gt;    val mat1Brz = Matrices.sparse(2, 3, Array(0, 2, 2, 2), Array(0, 1), Array(2, 2)).asBreeze
    &lt;span class=&quot;code-comment&quot;&gt;// (2, 1E-15, 1E-15)
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// (2, 1E-15, 1E-15
&lt;/span&gt;    val mat2Brz = Matrices.sparse(2, 3, Array(0, 2, 4, 6), Array(0, 0, 0, 1, 1, 1), Array(2, 1E-15, 1E-15, 2, 1E-15, 1E-15)).asBreeze
    &lt;span class=&quot;code-comment&quot;&gt;// The following shouldn&apos;t &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;
&lt;/span&gt;    val t01 = mat1Brz - mat1Brz
    val t02 = mat2Brz - mat2Brz
    val t02Brz = Matrices.fromBreeze(t02)
    val t01Brz = Matrices.fromBreeze(t01)

    val t1Brz = mat1Brz - mat2Brz
    val t2Brz = mat2Brz - mat1Brz
    &lt;span class=&quot;code-comment&quot;&gt;// The following ones should &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;
&lt;/span&gt;    val t1 = Matrices.fromBreeze(t1Brz)
    val t2 = Matrices.fromBreeze(t2Brz)

  }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13070680">SPARK-20687</key>
            <summary>mllib.Matrices.fromBreeze may crash when converting from Breeze sparse matrix</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="elghoto">Ignacio Bermudez Corrales</assignee>
                                    <reporter username="elghoto">Ignacio Bermudez Corrales</reporter>
                        <labels>
                    </labels>
                <created>Wed, 10 May 2017 04:24:17 +0000</created>
                <updated>Mon, 22 May 2017 09:29:05 +0000</updated>
                            <resolved>Mon, 22 May 2017 09:28:03 +0000</resolved>
                                    <version>2.1.1</version>
                                    <fixVersion>2.1.2</fixVersion>
                    <fixVersion>2.2.0</fixVersion>
                                    <component>MLlib</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16004038" author="elghoto" created="Wed, 10 May 2017 04:28:46 +0000"  >&lt;p&gt;The bug on &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-11507&quot; title=&quot;Error thrown when using BlockMatrix.add&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-11507&quot;&gt;&lt;del&gt;SPARK-11507&lt;/del&gt;&lt;/a&gt; is caused by this conversion, and therefore the problem wasn&apos;t patched correctly.&lt;/p&gt;</comment>
                            <comment id="16004372" author="srowen" created="Wed, 10 May 2017 09:24:55 +0000"  >&lt;p&gt;This doesn&apos;t say what the problem is. What goes wrong?&lt;/p&gt;</comment>
                            <comment id="16004975" author="elghoto" created="Wed, 10 May 2017 16:34:14 +0000"  >&lt;p&gt;When you try to do operations like addition or subtraction between 2 mllib.distributed.BlockMatrices that store in blocks sparse matrices, these are operated using breeze and then converted back to Matrices again. Sometimes this conversion back produces crashes, even though the resulting matrix is valid, because this method in Matrices.fromBreeze doesn&apos;t extract correctly the data hold in CSC breeze matrix.&lt;/p&gt;

&lt;p&gt;Unfortunately, I&apos;m not able to show some code with block matrices, but I can show you some backtrace. I manually debugged the crashes, and found the culprit, so that&apos;s why I posted in the description a quite more simplified snippet that reproduces the error.&lt;/p&gt;

&lt;p&gt;The snippet that causes the crash in BlockMatrix lines 374-379&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unable to find source-code formatter for language: title:blockmatrix.scala:blockmap.&lt;/span&gt; Available languages are: actionscript, ada, applescript, bash, c, c#, c++, cpp, css, erlang, go, groovy, haskell, html, java, javascript, js, json, lua, none, nyan, objc, perl, php, python, r, rainbow, ruby, scala, sh, sql, swift, visualbasic, xml, yaml&lt;/div&gt;&lt;pre&gt;          } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (b.isEmpty) {
            &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MatrixBlock((blockRowIndex, blockColIndex), a.head)
          } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
            val result = binMap(a.head.asBreeze, b.head.asBreeze)
            &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MatrixBlock((blockRowIndex, blockColIndex), Matrices.fromBreeze(result)) &lt;span class=&quot;code-comment&quot;&gt;// &amp;lt;--not able to get results
&lt;/span&gt;          }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;The trace after the operation between 2 spark block matrices:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unable to find source-code formatter for language: text.&lt;/span&gt; Available languages are: actionscript, ada, applescript, bash, c, c#, c++, cpp, css, erlang, go, groovy, haskell, html, java, javascript, js, json, lua, none, nyan, objc, perl, php, python, r, rainbow, ruby, scala, sh, sql, swift, visualbasic, xml, yaml&lt;/div&gt;&lt;pre&gt;Job aborted due to stage failure: Task 0 in stage 31.0 failed 1 times, most recent failure: Lost task 0.0 in stage 31.0 (TID 34, localhost, executor driver): java.lang.IllegalArgumentException: requirement failed: The last value of colPtrs must equal the number of elements. values.length: 28, colPtrs.last: 15
	at scala.Predef$.require(Predef.scala:224)
	at org.apache.spark.mllib.linalg.SparseMatrix.&amp;lt;init&amp;gt;(Matrices.scala:590)
	at org.apache.spark.mllib.linalg.SparseMatrix.&amp;lt;init&amp;gt;(Matrices.scala:618)
	at org.apache.spark.mllib.linalg.Matrices$.fromBreeze(Matrices.scala:995)
	at org.apache.spark.mllib.linalg.distributed.BlockMatrix$$anonfun$10.apply(BlockMatrix.scala:378)
	at org.apache.spark.mllib.linalg.distributed.BlockMatrix$$anonfun$10.apply(BlockMatrix.scala:365)
	at scala.collection.Iterator$$anon$11.next(Iterator.scala:409)
	at scala.collection.Iterator$$anon$11.next(Iterator.scala:409)
	at scala.collection.Iterator$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;foreach(Iterator.scala:893)
	at scala.collection.AbstractIterator.foreach(Iterator.scala:1336)
	at scala.collection.TraversableOnce$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;foldLeft(TraversableOnce.scala:157)
	at scala.collection.AbstractIterator.foldLeft(Iterator.scala:1336)
	at scala.collection.TraversableOnce$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;fold(TraversableOnce.scala:212)
	at scala.collection.AbstractIterator.fold(Iterator.scala:1336)
	at org.apache.spark.rdd.RDD$$anonfun$fold$1$$anonfun$20.apply(RDD.scala:1087)
	at org.apache.spark.rdd.RDD$$anonfun$fold$1$$anonfun$20.apply(RDD.scala:1087)
	at org.apache.spark.SparkContext$$anonfun$33.apply(SparkContext.scala:2119)
	at org.apache.spark.SparkContext$$anonfun$33.apply(SparkContext.scala:2119)
	at org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:87)
	at org.apache.spark.scheduler.Task.run(Task.scala:108)
	at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:335)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16005179" author="elghoto" created="Wed, 10 May 2017 18:30:58 +0000"  >&lt;p&gt;Proposing a patch in PR &lt;a href=&quot;https://github.com/apache/spark/pull/17940&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/17940&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16006804" author="apachespark" created="Thu, 11 May 2017 17:21:04 +0000"  >&lt;p&gt;User &apos;ghoto&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/17940&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/17940&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16019360" author="srowen" created="Mon, 22 May 2017 09:28:03 +0000"  >&lt;p&gt;Issue resolved by pull request 17940&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/17940&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/17940&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310060">
                    <name>Container</name>
                                                                <inwardlinks description="Is contained by">
                                        <issuelink>
            <issuekey id="12910474">SPARK-11507</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 26 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3er33:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>