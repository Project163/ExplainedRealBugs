<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:19:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-3948] Sort-based shuffle can lead to assorted stream-corruption exceptions</title>
                <link>https://issues.apache.org/jira/browse/SPARK-3948</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Several exceptions occurred when running TPC-DS queries against latest master branch with sort-based shuffle enable, like PARSING_ERROR(2) in snappy, deserializing error in Kryo and offset out-range in FileManagedBuffer, all these exceptions are gone when we changed to hash-based shuffle.&lt;/p&gt;

&lt;p&gt;With deep investigation, we found that some shuffle output file is unexpectedly smaller than the others, as the log shows:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;14/10/14 18:25:06 INFO shuffle.IndexShuffleBlockManager: Block id: shuffle_6_9_11, offset: 3055635, length: 236708, file length: 47274167
14/10/14 18:25:06 INFO shuffle.IndexShuffleBlockManager: Block id: shuffle_6_10_11, offset: 2986484, length: 222755, file length: 47174539
14/10/14 18:25:06 INFO shuffle.IndexShuffleBlockManager: Block id: shuffle_6_11_11, offset: 2995341, length: 259871, file length: 383405
14/10/14 18:25:06 INFO shuffle.IndexShuffleBlockManager: Block id: shuffle_6_12_11, offset: 2991030, length: 268191, file length: 47478892
14/10/14 18:25:06 INFO shuffle.IndexShuffleBlockManager: Block id: shuffle_6_13_11, offset: 3016292, length: 230694, file length: 47420826
14/10/14 18:25:06 INFO shuffle.IndexShuffleBlockManager: Block id: shuffle_6_14_11, offset: 3061400, length: 241136, file length: 47395509
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As you can see the total file length of shuffle_6_11_11 is much smaller than other same stage map output results.&lt;/p&gt;

&lt;p&gt;And we also dump the map outputs in map side to see if this small size output is correct or not, below is the log:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; In bypass merge sort, file name: /mnt/DP_disk1/animal/spark/spark-local-
20141014182142-8345/22/shuffle_6_11_0.data, file length: 383405length:
 274722 262597 291290 272902 264941 270358 291005 295285 252482 
287142 232617 259871 233734 241439 228897 234282 253834 235619 
233803 255532 270739 253825 262087 266404 234273 250120 262983 
257024 255947 254971 258908 247862 221613 258566 245399 251684 
274843 226150 264278 245279 225656 235084 239466 212851 242245 
218781 222191 215500 211548 234256 208601 204113 191923 217895 
227020 215331 212313 223725 250876 256875 239276 266777 235520 
237462 234063 242270 246825 255888 235937 236956 233099 264508 
260303 233294 239061 254856 257475 230105 246553 260412 210355 
211201 219572 206636 226866 209937 226618 218208 206255 248069 
221717 222112 215734 248088 239207 246125 239056 241133 253091 
246738 233128 242794 231606 255737 221123 252115 247286 229688 
251087 250047 237579 263079 256251 238214 208641 201120 204009 
200825 211965 200600 194492 226471 194887 226975 215072 206008 
233288 222132 208860 219064 218162 237126 220465 201343 225711 
232178 233786 212767 211462 213671 215853 227822 233782 214727 
247001 228968 247413 222674 214241 184122 215643 207665 219079 
215185 207718 212723 201613 216600 212591 208174 204195 208099 
229079 230274 223373 214999 256626 228895 231821 383405 229646 
220212 245495 245960 227556 213266 237203 203805 240509 239306 
242365 218416 238487 219397 240026 251011 258369 255365 259811 
283313 248450 264286 264562 257485 279459 249187 257609 274964 
292369 273826
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here I dump the file name, length and each partition&apos;s length, obviously the sum of all partition lengths is not equal to file length. So I think there may be a situation paritionWriter in ExternalSorter not always append to the end of previous written file, the file&apos;s content is overwritten in some parts, and this lead to the exceptions I mentioned before.&lt;/p&gt;

&lt;p&gt;Also I changed the code of copyStream by disable transferTo, use the previous one, all the issues are gone. So I think there maybe some flushing problems in transferTo when processed data is large.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12748040">SPARK-3948</key>
            <summary>Sort-based shuffle can lead to assorted stream-corruption exceptions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jerryshao">Saisai Shao</assignee>
                                    <reporter username="jerryshao">Saisai Shao</reporter>
                        <labels>
                    </labels>
                <created>Tue, 14 Oct 2014 14:18:33 +0000</created>
                <updated>Sun, 17 May 2020 18:30:46 +0000</updated>
                            <resolved>Mon, 20 Oct 2014 17:22:48 +0000</resolved>
                                    <version>1.2.0</version>
                                    <fixVersion>1.1.1</fixVersion>
                    <fixVersion>1.2.0</fixVersion>
                                    <component>Shuffle</component>
                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>11</watches>
                                                                                                                <comments>
                            <comment id="14170990" author="jerryshao" created="Tue, 14 Oct 2014 14:22:05 +0000"  >&lt;p&gt;I think the issue of &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-3630&quot; title=&quot;Identify cause of Kryo+Snappy PARSING_ERROR&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-3630&quot;&gt;&lt;del&gt;SPARK-3630&lt;/del&gt;&lt;/a&gt; is related to this one&lt;/p&gt;</comment>
                            <comment id="14171295" author="joshrosen" created="Tue, 14 Oct 2014 18:13:43 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryshao&quot; class=&quot;user-hover&quot; rel=&quot;jerryshao&quot;&gt;jerryshao&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Could you share the changes that you made to copyStream (maybe by attaching a &lt;tt&gt;git diff&lt;/tt&gt; to this ticket)?  I want to play around with your fix to see whether I can spot the problem.&lt;/p&gt;</comment>
                            <comment id="14171834" author="jerryshao" created="Wed, 15 Oct 2014 01:14:06 +0000"  >&lt;p&gt;Hi Josh, according to my observation, this bug is occurred in this branch of writePartitionedFile (ExternalSorter), but I cannot reproduce this in my local mode with small data size,&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (bypassMergeSort &amp;amp;&amp;amp; partitionWriters != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      &lt;span class=&quot;code-comment&quot;&gt;// We decided to write separate files &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; each partition, so just concatenate them. To keep
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; simple we spill out the current in-memory collection so that everything is in files.
&lt;/span&gt;      spillToPartitionFiles(&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (aggregator.isDefined) map &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; buffer)
      partitionWriters.foreach(_.commitAndClose())
      &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; out: FileOutputStream = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; in: FileInputStream = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        out = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileOutputStream(outputFile)
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (i &amp;lt;- 0 until numPartitions) {
          in = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileInputStream(partitionWriters(i).fileSegment().file)
          val size = org.apache.spark.util.Utils.copyStream(in, out, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
          in.close()
          in = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
          lengths(i) = size
        }
      } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (out != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
          out.close()
        }
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (in != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
          in.close()
        }
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Currently I just revert this commit (&lt;a href=&quot;https://github.com/apache/spark/commit/246cb3f158686348a698d1c0da3001c314727129&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/commit/246cb3f158686348a698d1c0da3001c314727129&lt;/a&gt;) in copyStream to workaround this issue. I still need to investigate why transferTo will get wrong result.&lt;/p&gt;

&lt;p&gt;Besides, would you mind assign this JIRA to me, thanks a lot.&lt;/p&gt;</comment>
                            <comment id="14171859" author="joshrosen" created="Wed, 15 Oct 2014 01:40:27 +0000"  >&lt;p&gt;Thanks for narrowing the problem down to a single commit; this is extremely helpful.  I&apos;ve assigned this JIRA to you, but I&apos;ll help investigate, too.&lt;/p&gt;</comment>
                            <comment id="14171861" author="jerryshao" created="Wed, 15 Oct 2014 01:42:39 +0000"  >&lt;p&gt;Thanks for your help &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="14171920" author="pwendell" created="Wed, 15 Oct 2014 02:54:33 +0000"  >&lt;p&gt;Great thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryshao&quot; class=&quot;user-hover&quot; rel=&quot;jerryshao&quot;&gt;jerryshao&lt;/a&gt; - I updated the description. It sounds like this is just an issue with something in the sort-based code that can cause all kinds of random stream exceptions.&lt;/p&gt;</comment>
                            <comment id="14172024" author="joshrosen" created="Wed, 15 Oct 2014 05:42:35 +0000"  >&lt;p&gt;I&apos;ve been looking over the code in &lt;a href=&quot;https://github.com/apache/spark/pull/1884&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/1884&lt;/a&gt; and I haven&apos;t spotted anything glaringly wrong.  One hunch, though: in the &lt;tt&gt;transferTo&lt;/tt&gt; code, we read the size of the file up front and then copy that many bytes, whereas the old, non-&lt;tt&gt;transferTo&lt;/tt&gt; code keeps reading until it hits the end of the stream.  This could potentially account for different behavior if the size of the underlying file increased while the copy was taking place.&lt;/p&gt;</comment>
                            <comment id="14172055" author="jerryshao" created="Wed, 15 Oct 2014 06:19:00 +0000"  >&lt;p&gt;Hi Josh, thanks for your help. I don&apos;t think it&apos;s un-flushed input file which makes output file copy length error, since bunch of &lt;tt&gt;partitionWriters&lt;/tt&gt; are flushed and closed before copying to output file, as you can see line 704 in ExternalSorter &lt;tt&gt;partitionWriters.foreach(_.commitAndClose())&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I still doubt that current use of &lt;tt&gt;transferTo&lt;/tt&gt; may have some problems which will ruin the output file, I try to add append flag for the output file in line 708, seems the problem is gone.&lt;/p&gt;</comment>
                            <comment id="14172062" author="joshrosen" created="Wed, 15 Oct 2014 06:38:50 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryshao&quot; class=&quot;user-hover&quot; rel=&quot;jerryshao&quot;&gt;jerryshao&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;To make sure that I understand, are you saying that changing&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;out = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileOutputStream(outputFile)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;to&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;out = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileOutputStream(outputFile, append=True)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;seems to solve the issue, even while continuing to use the &lt;tt&gt;transferTo&lt;/tt&gt; code?&lt;/p&gt;</comment>
                            <comment id="14172069" author="jerryshao" created="Wed, 15 Oct 2014 06:45:27 +0000"  >&lt;p&gt;Yes, that&apos;s correct. Also please see the link (&lt;a href=&quot;http://stackoverflow.com/questions/1651832/java-filechannel-transferfrom-questions&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/1651832/java-filechannel-transferfrom-questions&lt;/a&gt;), I guess we may face the similar problem.&lt;/p&gt;</comment>
                            <comment id="14172080" author="joshrosen" created="Wed, 15 Oct 2014 07:11:11 +0000"  >&lt;p&gt;I&apos;m surprised that the lack of &lt;tt&gt;append&lt;/tt&gt; didn&apos;t cause problems prior to the &lt;tt&gt;transferTo&lt;/tt&gt; patch.  To try to reason this out:&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Old code, no append&lt;/b&gt;: We use same FileOutputStream object to write all of the partitions, copying each partition&apos;s data by calling &lt;tt&gt;FileOutputStream.write&lt;/tt&gt; on this same FileOutputStream object.  Since we&apos;re not in append mode, the first partition is written at the beginning of the file and all subsequent partitions are appended to it.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;New &lt;tt&gt;transferTo&lt;/tt&gt; code, no append:&lt;/b&gt; We call &lt;tt&gt;FileOutputStream.getChannel()&lt;/tt&gt; for each partition; which &lt;a href=&quot;http://docs.oracle.com/javase/7/docs/api/java/io/FileOutputStream.html#getChannel()&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&quot;returns the unique FileChannel object associated with this file output stream&quot;&lt;/a&gt;.  Since we&apos;re not in append mode, this channel&apos;s initial position should &quot;be equal to the number of bytes written to the file so far&quot;, which should initially be 0 since we just created a new FileOutputStream and haven&apos;t written anything using it.  According to &lt;a href=&quot;http://docs.oracle.com/javase/6/docs/api/java/nio/channels/FileChannel.html#transferTo(long, long, java.nio.channels.WritableByteChannel)&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;its docs&lt;/a&gt;, &lt;tt&gt;transferTo&lt;/tt&gt; should increment the target channel&apos;s position by the number of bytes written.  So, in this case it also seems like the first partition should be written to the beginning of the file while others are appended after it.&lt;/p&gt;

&lt;p&gt;Am I missing an obvious bug here?  Is there a reason why these two copy implementations don&apos;t behave identically when append is disabled? &lt;/p&gt;</comment>
                            <comment id="14172116" author="mridulm80" created="Wed, 15 Oct 2014 07:55:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joshrosen&quot; class=&quot;user-hover&quot; rel=&quot;joshrosen&quot;&gt;joshrosen&lt;/a&gt; Assuming there are no VM bugs being hit for inChannel.size() or some other concurrent writes to these files, I dont see any issues with the code - as you elaborated.&lt;br/&gt;
On other hand, external sort code is slightly loose w.r.t use of file api - not sure if that is causing the observed problems : example, use of skip() in SortShuffleManager.scala.&lt;br/&gt;
We will need to investigate in detail if some of these are causing the observed problems.&lt;/p&gt;</comment>
                            <comment id="14172117" author="jerryshao" created="Wed, 15 Oct 2014 07:57:57 +0000"  >&lt;p&gt;Hi Josh,&lt;/p&gt;

&lt;p&gt;I think for old code without append, the behavior is correct even without &lt;tt&gt;append&lt;/tt&gt; flag, because we never close the output stream between different partitions, so input streams for each partition will always write to the end of output stream, I think that&apos;s correct.&lt;/p&gt;

&lt;p&gt;For new &lt;tt&gt;transferTo&lt;/tt&gt; code without append, theoretically it&apos;s correct that target channel&apos;s position should increment by the bytes written, but according to my investigation through logs, I found that for the subsequent partitions, output channel&apos;s position unexpectedly pointed to 0, not the previous output file size, that&apos;s also the unexplained behavior which makes me confuse a lot.&lt;/p&gt;</comment>
                            <comment id="14172134" author="mridulm80" created="Wed, 15 Oct 2014 08:16:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryshao&quot; class=&quot;user-hover&quot; rel=&quot;jerryshao&quot;&gt;jerryshao&lt;/a&gt; Just to clarify, what exactly is the behavior you are observing ?&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Is it that getChannel is returning a channel which has position == 0 after writing bytes to the stream ? (size &amp;gt; 0)&lt;br/&gt;
If yes, what is the channel&apos;s length you are observing in that case ?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Also, how &quot;large&quot; are the file sizes ?&lt;/p&gt;

&lt;p&gt;The documentation of getChannel and transferTo are fairly unambigous ... so our code, as written, is conforment to that. Ofcourse, it is always possible we are hitting some bugs in some scenarios !&lt;br/&gt;
What is the environment you are running this on btw ? OS/jvm version ? Thanks.&lt;/p&gt;</comment>
                            <comment id="14172152" author="jerryshao" created="Wed, 15 Oct 2014 08:44:40 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mridul&quot; class=&quot;user-hover&quot; rel=&quot;mridul&quot;&gt;mridul&lt;/a&gt;, what I observed is that, after writing bytes to channel, still get the position 0 in the next calling, here is one of the log that I traced:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.AssertionError: assertion failed: outChannel before size, 272314, before position: 0. Current size: 284167, current position: 0, expected write data size: 284167
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I just print out the channel size and position &lt;b&gt;before&lt;/b&gt; and &lt;b&gt;after&lt;/b&gt; the &lt;tt&gt;transferTo&lt;/tt&gt; action. As you can see the output file size is not 0 before written, but the position is 0, not the end of channel. After written to it use &lt;tt&gt;transferTo&lt;/tt&gt;, the file size is changed, but not 272314 + 284167 as expected, and the position also not move to the end.&lt;/p&gt;

&lt;p&gt;Also I add append flag as I mentioned before, here the log changes to:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;14/10/15 13:14:12 INFO util.Utils: outChannel before size, 0, before position: 0. Current size: 294896, current position: 294896, expected write data size: 294896
14/10/15 13:14:12 INFO util.Utils: outChannel before size, 294896, before position: 294896. Current size: 551216, current position: 551216, expected write data size: 256320
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And my OS Redhat 6.2, and JVM is 1.8.0_20-ea.&lt;/p&gt;

&lt;p&gt;Appreciate your suggestions, thanks a lot.&lt;/p&gt;</comment>
                            <comment id="14172225" author="mridulm80" created="Wed, 15 Oct 2014 10:15:15 +0000"  >&lt;p&gt;That is weird, I tried a stripped down version to test just this - and it seems to be working fine.&lt;/p&gt;

&lt;p&gt;In scala interpreter, this seems to work as expected.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io._
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.nio.ByteBuffer
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.nio._
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.nio.channels._
  def copyStream(in: InputStream,
                 out: OutputStream,
                 closeStreams: &lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt; = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;): &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; =
  {
    &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; count = 0L
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (in.isInstanceOf[FileInputStream] &amp;amp;&amp;amp; out.isInstanceOf[FileOutputStream]) {
        &lt;span class=&quot;code-comment&quot;&gt;// When both streams are File stream, use transferTo to improve copy performance.
&lt;/span&gt;        val inChannel = in.asInstanceOf[FileInputStream].getChannel()
        val outChannel = out.asInstanceOf[FileOutputStream].getChannel()
println(&lt;span class=&quot;code-quote&quot;&gt;&quot;size = &quot;&lt;/span&gt; + outChannel.size)
println(&lt;span class=&quot;code-quote&quot;&gt;&quot;position = &quot;&lt;/span&gt; + outChannel.position)
        val size = inChannel.size()
        &lt;span class=&quot;code-comment&quot;&gt;// In &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; transferTo method transferred less data than we have required.
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (count &amp;lt; size) {
          count += inChannel.transferTo(count, size - count, outChannel)
        }
      } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
        val buf = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Array[&lt;span class=&quot;code-object&quot;&gt;Byte&lt;/span&gt;](8192)
        &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; n = 0
        &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (n != -1) {
          n = in.read(buf)
          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (n != -1) {
            out.write(buf, 0, n)
            count += n
          }
        }
}
      count
   } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (closeStreams) {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
          in.close()
        } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
          out.close()
        }
      }
    }
  }
val out = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileOutputStream(&lt;span class=&quot;code-quote&quot;&gt;&quot;output&quot;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (i &amp;lt;- 0 until 10) {
val in = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileInputStream(&lt;span class=&quot;code-quote&quot;&gt;&quot;t&quot;&lt;/span&gt;)
         val size = copyStream(in, out, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
println(&lt;span class=&quot;code-quote&quot;&gt;&quot;size = &quot;&lt;/span&gt; + size + &lt;span class=&quot;code-quote&quot;&gt;&quot; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; i = &quot;&lt;/span&gt; + i)
in.close()
}
out.close()

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;Scenarios tried :&lt;br/&gt;
a) No &quot;output&quot; file.&lt;br/&gt;
b) Empty &quot;output&quot; file.&lt;br/&gt;
c) Non empty &quot;output&quot; file.&lt;/p&gt;

&lt;p&gt;And it seemed to work fine (and as expected) for all the cases.&lt;br/&gt;
Can you try this at your end ? I want to eliminate any potential environment issues.&lt;br/&gt;
I tried this with 1.7.0_55 and 1.8.0_25 ...&lt;/p&gt;</comment>
                            <comment id="14172226" author="mridulm80" created="Wed, 15 Oct 2014 10:17:09 +0000"  >&lt;p&gt;Note, &quot;t&quot; is just some file with a few strings in it - simply generate something locally.&lt;/p&gt;</comment>
                            <comment id="14172371" author="jerryshao" created="Wed, 15 Oct 2014 13:51:05 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mridulm80&quot; class=&quot;user-hover&quot; rel=&quot;mridulm80&quot;&gt;mridulm80&lt;/a&gt;, thanks a lot for your suggestions, I tested with different Java version and two OS: Redhat 6.2 and Ubuntu 14.04, I think this behavior is OS or kernel related, not jvm version, you can see the output as below:&lt;/p&gt;

&lt;p&gt;First is the result under Redhat, I tried Java 1.8.0_20, 1.7.0_60 and 1.7.0_04, the result is:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;size = 0
position = 0
size = 118 for i = 0
size = 118
position = 0
size = 118 for i = 1
size = 118
position = 0
size = 118 for i = 2
size = 118
position = 0
size = 118 for i = 3
size = 118
position = 0
size = 118 for i = 4
size = 118
position = 0
size = 118 for i = 5
size = 118
position = 0
size = 118 for i = 6
size = 118
position = 0
size = 118 for i = 7
size = 118
position = 0
size = 118 for i = 8
size = 118
position = 0
size = 118 for i = 9
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Obvious the position is always 0, so the final output file size is just 118.&lt;/p&gt;

&lt;p&gt;Then changed to Ubuntu 14.04, with Java 1.7.0_04 and 1.7.0_51, the result shows as below:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;size = 0
position = 0
size = 118 for i = 0
size = 118
position = 118
size = 118 for i = 1
size = 236
position = 236
size = 118 for i = 2
size = 354
position = 354
size = 118 for i = 3
size = 472
position = 472
size = 118 for i = 4
size = 590
position = 590
size = 118 for i = 5
size = 708
position = 708
size = 118 for i = 6
size = 826
position = 826
size = 118 for i = 7
size = 944
position = 944
size = 118 for i = 8
size = 1062
position = 1062
size = 118 for i = 9
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is the result we expected, and position also seek to the right end, so the final output file size is 1180 as expected.&lt;/p&gt;

&lt;p&gt;My Ubuntu machine&apos;s kernel version is: 3.13.0-37-generic; and Redhat machine&apos;s kernel version is: 2.6.32-220.el6.x86_64.&lt;/p&gt;

&lt;p&gt;So I guess maybe the difference relies on kernel version or OS version, but still need to verify.&lt;/p&gt;

&lt;p&gt;Besides I think to keep the consistency, we can add &lt;b&gt;append=true&lt;/b&gt; flag to enforce the same output even in different platforms.&lt;/p&gt;</comment>
                            <comment id="14172389" author="jerryshao" created="Wed, 15 Oct 2014 14:07:42 +0000"  >&lt;p&gt;So probably a kernel bug in 2.6.32, as you can see &lt;a href=&quot;https://bugs.openjdk.java.net/browse/JDK-7052359?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://bugs.openjdk.java.net/browse/JDK-7052359?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="14172582" author="joshrosen" created="Wed, 15 Oct 2014 16:49:30 +0000"  >&lt;p&gt;That kernel bug seems like it could explain why the &lt;tt&gt;transferTo&lt;/tt&gt; change caused problems in sort-based shuffle.  It looks like &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-3630&quot; title=&quot;Identify cause of Kryo+Snappy PARSING_ERROR&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-3630&quot;&gt;&lt;del&gt;SPARK-3630&lt;/del&gt;&lt;/a&gt; also describes some other places where the Kryo PARSING_ERROR(2) has occurred, so I&apos;m going to try to figure out which of these other cases might also hit this &lt;tt&gt;transferTo&lt;/tt&gt; code path.&lt;/p&gt;

&lt;p&gt;In terms of a bug fix / workaround: maybe we can open the file in append mode, since that seems to solve the problem, and also add an internal configuration option to disable the transferTo code; this configuration / feature-flag would provide an &quot;escape hatch&quot; for users in case the append fix doesn&apos;t work.&lt;/p&gt;</comment>
                            <comment id="14172585" author="mridulm80" created="Wed, 15 Oct 2014 16:50:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryshao&quot; class=&quot;user-hover&quot; rel=&quot;jerryshao&quot;&gt;jerryshao&lt;/a&gt; great work !&lt;br/&gt;
I agree, append might be a workaround to consider (given the semantics of getChannel when stream is opened with append).&lt;br/&gt;
On other hand, since this piece of code might be used in general context also (the copyStreams) - what about logging a warning in case position != initialPosition + size at end of the transferTo loop ? Warning users that they should upgrade kernal ? (and explicitly modifying position as workaround)&lt;/p&gt;
</comment>
                            <comment id="14172895" author="joshrosen" created="Wed, 15 Oct 2014 20:38:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mridulm80&quot; class=&quot;user-hover&quot; rel=&quot;mridulm80&quot;&gt;mridulm80&lt;/a&gt;, that explicit position-checking and modification idea is a clever workaround.&lt;/p&gt;

&lt;p&gt;I think that this JIRA explains the cause of the stream-corruption issues that we&apos;ve seen in the sort-based shuffle code, but after some investigation I think that it doesn&apos;t explain the similar errors that we&apos;ve seen when deserializing tasks that were broadcasted with TorrentBroadcast; I&apos;ll keep investigating this.&lt;/p&gt;</comment>
                            <comment id="14173353" author="jerryshao" created="Thu, 16 Oct 2014 04:32:36 +0000"  >&lt;p&gt;Thanks for your suggestions. I think it would be better to add append flag and do some position-checking works after &lt;tt&gt;transferTo&lt;/tt&gt;. &lt;/p&gt;

&lt;p&gt;I&apos;m not sure about position modification, is that means by calling &lt;tt&gt;position(outChannel.size())&lt;/tt&gt; to seek to the end of file? If so, I think we still face the same problem as I tested before in kernel 2.6.32; unless we add &lt;b&gt;append=true&lt;/b&gt; flag, we cannot get the right file size even with explicit position modification, I just do a round of test with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mridulm80&quot; class=&quot;user-hover&quot; rel=&quot;mridulm80&quot;&gt;mridulm80&lt;/a&gt; provided code by adding &lt;tt&gt;position(outChannel.size())&lt;/tt&gt; before transferTo. But this is OK in my Ubuntu machine.&lt;/p&gt;

&lt;p&gt;So I think we can only add append flag to workaround this issue. Besides, explicit position-modification may not meet user&apos;s requirement where user want to overwrite the outputstream by calling copyStream function.&lt;/p&gt;</comment>
                            <comment id="14173413" author="mridulm80" created="Thu, 16 Oct 2014 06:09:32 +0000"  >&lt;p&gt;Not exactly, what I was suggesting was :&lt;/p&gt;

&lt;p&gt;a) At begining of the transferTo method, add&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unable to find source-code formatter for language:  java.&lt;/span&gt; Available languages are: actionscript, ada, applescript, bash, c, c#, c++, cpp, css, erlang, go, groovy, haskell, html, java, javascript, js, json, lua, none, nyan, objc, perl, php, python, r, rainbow, ruby, scala, sh, sql, swift, visualbasic, xml, yaml&lt;/div&gt;&lt;pre&gt;  val initialPos = channel.position()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;b) At bottom of the transferTo method, before returning size, add&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unable to find source-code formatter for language:  java.&lt;/span&gt; Available languages are: actionscript, ada, applescript, bash, c, c#, c++, cpp, css, erlang, go, groovy, haskell, html, java, javascript, js, json, lua, none, nyan, objc, perl, php, python, r, rainbow, ruby, scala, sh, sql, swift, visualbasic, xml, yaml&lt;/div&gt;&lt;pre&gt;  val finalPos = channel.position()
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (finalPos == initialPos) {
    logWarning(&lt;span class=&quot;code-quote&quot;&gt;&quot;Hit kernal bug, upgrade kernal. Attempting workaround&quot;&lt;/span&gt;)
    channel.position(initialPos + size)
  } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
    &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt;(finalPos == initialPos + size)
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;What I understand from the javadoc, this should alleviate the problem : ofcourse, will need verification on the setup you have where it is currently failing !&lt;br/&gt;
Note that the reason I would prefer this to append is for simple reason : the method is generic method to copy streams - and it might be used (currnetly, or in future) in scenarios where append is not true. So would be good to be defensive about the final state.&lt;/p&gt;</comment>
                            <comment id="14173427" author="jerryshao" created="Thu, 16 Oct 2014 06:30:05 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mridulm80&quot; class=&quot;user-hover&quot; rel=&quot;mridulm80&quot;&gt;mridulm80&lt;/a&gt;, thanks a lot for your suggestions, here is the snippet I changed:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;       val inChannel = in.asInstanceOf[FileInputStream].getChannel()
        val outChannel = out.asInstanceOf[FileOutputStream].getChannel()
        val initialPos = outChannel.position()
        println(&lt;span class=&quot;code-quote&quot;&gt;&quot;size = &quot;&lt;/span&gt; + outChannel.size)
        println(&lt;span class=&quot;code-quote&quot;&gt;&quot;initial position = &quot;&lt;/span&gt; + initialPos)
        val size = inChannel.size()
        &lt;span class=&quot;code-comment&quot;&gt;// In &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; transferTo method transferred less data than we have required.
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (count &amp;lt; size) {
          count += inChannel.transferTo(count, size - count, outChannel)
        }
        val finalPos = outChannel.position()
        println(&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; position = &quot;&lt;/span&gt; + finalPos)
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (initialPos == finalPos) {
          outChannel.position(initialPos + count)
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
          &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt;(finalPos == initialPos + count)
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And the result shows as below:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;size = 0
initial position = 0
final position = 0
size = 118 for i = 0
size = 118
initial position = 118
final position = 118
size = 118 for i = 1
size = 118
initial position = 236
final position = 236
size = 118 for i = 2
size = 118
initial position = 354
final position = 354
size = 118 for i = 3
size = 118
initial position = 472
final position = 472
size = 118 for i = 4
size = 118
initial position = 590
final position = 590
size = 118 for i = 5
size = 118
initial position = 708
final position = 708
size = 118 for i = 6
size = 118
initial position = 826
final position = 826
size = 118 for i = 7
size = 118
initial position = 944
final position = 944
size = 118 for i = 8
size = 118
initial position = 1062
final position = 1062
size = 118 for i = 9
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Still has problem in my 2.6.32 machine, though position is moving forward, the file size is still 118. But it is OK in my Ubuntu machine, so probably this is not feasible.&lt;/p&gt;</comment>
                            <comment id="14173434" author="jerryshao" created="Thu, 16 Oct 2014 06:38:07 +0000"  >&lt;p&gt;Besides I think we can add configuration as &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joshrosen&quot; class=&quot;user-hover&quot; rel=&quot;joshrosen&quot;&gt;joshrosen&lt;/a&gt; suggested, if the problem is met when using transferTo, we can log out the issue and warn people to disable transferTo, what&apos;s your suggestion.&lt;/p&gt;</comment>
                            <comment id="14173489" author="mridulm80" created="Thu, 16 Oct 2014 07:38:46 +0000"  >&lt;p&gt;Damn, this sucks : the transferTo is not using the position of the channel to write output to ... while it is doing so when append is true (which is effectively setting position to end of file on call to getChannel).&lt;br/&gt;
The state of the channel, based on what we see above, is the same in both cases - since we can see the position is updated - and is persisted and returned when we call getChannel in next invocation of copyStreams. Not sure if sync() will help ...&lt;br/&gt;
So there is some other set of issues at play which we might not be able to workaround from the jvm.&lt;/p&gt;


&lt;p&gt;Given this, I think we should &lt;br/&gt;
a) add a logError when initialPosition == finalPosition when inChannel.size &amp;gt; 0 asking users to upgrade to a newer linux kernal&lt;br/&gt;
b) ofcourse use append = true : to workaround immediate issues.&lt;/p&gt;

&lt;p&gt;(a) will ensure that developers and users/admins will be notified of issues in case other codepaths (currently or in future) hit the same issue.&lt;/p&gt;
</comment>
                            <comment id="14173528" author="jerryshao" created="Thu, 16 Oct 2014 08:28:07 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mridulm80&quot; class=&quot;user-hover&quot; rel=&quot;mridulm80&quot;&gt;mridulm80&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Thanks a lot for your suggestion. I think currently for other codes in Spark which use copyStream will not be affected by this issue, since they only copy one input file to the output file. But for some use cases like ExternalSorter  will indeed be affected by it. I will submit a PR according to your suggestions, thanks a lot.&lt;/p&gt;</comment>
                            <comment id="14173757" author="apachespark" created="Thu, 16 Oct 2014 13:58:14 +0000"  >&lt;p&gt;User &apos;jerryshao&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/2824&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/2824&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14177134" author="joshrosen" created="Mon, 20 Oct 2014 17:22:48 +0000"  >&lt;p&gt;Issue resolved by pull request 2824&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/2824&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/2824&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14177170" author="rxin" created="Mon, 20 Oct 2014 17:42:53 +0000"  >&lt;p&gt;How often does this bug manifest? If it is often enough, maybe we want to set the option to false by default instead of true. &lt;/p&gt;</comment>
                            <comment id="14177173" author="joshrosen" created="Mon, 20 Oct 2014 17:45:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rxin&quot; class=&quot;user-hover&quot; rel=&quot;rxin&quot;&gt;rxin&lt;/a&gt; The patch here should actually fix the issue; that option is just an &quot;escape hatch&quot; in case we were mistaken and our fix doesn&apos;t always work.  Users should not have to change any configuration options when applying this fix &lt;em&gt;unless&lt;/em&gt; the fix doesn&apos;t work for some reason.&lt;/p&gt;</comment>
                            <comment id="14177195" author="rxin" created="Mon, 20 Oct 2014 17:56:06 +0000"  >&lt;p&gt;Ok then it sounds good. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12743065">SPARK-3630</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 5 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i215m7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>