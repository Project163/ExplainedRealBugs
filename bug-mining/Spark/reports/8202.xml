<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:27:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-36867] Misleading Error Message with Invalid Column and Group By</title>
                <link>https://issues.apache.org/jira/browse/SPARK-36867</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;When you run a query with an invalid column that also does a group by on a constructed column, the error message you get back references a missing column for the group by rather than the invalid column.&lt;/p&gt;

&lt;p&gt;You can reproduce this in pyspark in 3.1.2 with the following code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-python&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; pyspark.sql &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; SparkSession
spark = SparkSession.builder.appName(&lt;span class=&quot;code-quote&quot;&gt;&quot;Group By Issue&quot;&lt;/span&gt;).getOrCreate()
data = spark.createDataFrame(
    [(&lt;span class=&quot;code-quote&quot;&gt;&quot;2021-09-15&quot;&lt;/span&gt;, 1), (&lt;span class=&quot;code-quote&quot;&gt;&quot;2021-09-16&quot;&lt;/span&gt;, 2), (&lt;span class=&quot;code-quote&quot;&gt;&quot;2021-09-17&quot;&lt;/span&gt;, 10), (&lt;span class=&quot;code-quote&quot;&gt;&quot;2021-09-18&quot;&lt;/span&gt;, 25), (&lt;span class=&quot;code-quote&quot;&gt;&quot;2021-09-19&quot;&lt;/span&gt;, 500), (&lt;span class=&quot;code-quote&quot;&gt;&quot;2021-09-20&quot;&lt;/span&gt;, 50), (&lt;span class=&quot;code-quote&quot;&gt;&quot;2021-09-21&quot;&lt;/span&gt;, 100)],
    schema=[&lt;span class=&quot;code-quote&quot;&gt;&quot;d&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;v&quot;&lt;/span&gt;]
    )
data.createOrReplaceTempView(&lt;span class=&quot;code-quote&quot;&gt;&quot;data&quot;&lt;/span&gt;)
&lt;span class=&quot;code-comment&quot;&gt;# This &lt;span class=&quot;code-keyword&quot;&gt;is&lt;/span&gt; valid
&lt;/span&gt;spark.sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;select &lt;span class=&quot;code-object&quot;&gt;sum&lt;/span&gt;(v) &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; value, date(date_trunc(&lt;span class=&quot;code-quote&quot;&gt;&apos;week&apos;&lt;/span&gt;, d)) &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; week &lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; data group by week&quot;&lt;/span&gt;).show()
&lt;span class=&quot;code-comment&quot;&gt;# This &lt;span class=&quot;code-keyword&quot;&gt;is&lt;/span&gt; invalid because val &lt;span class=&quot;code-keyword&quot;&gt;is&lt;/span&gt; the wrong variable
&lt;/span&gt;spark.sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;select &lt;span class=&quot;code-object&quot;&gt;sum&lt;/span&gt;(val) &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; value, date(date_trunc(&lt;span class=&quot;code-quote&quot;&gt;&apos;week&apos;&lt;/span&gt;, d)) &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; week &lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; data group by week&quot;&lt;/span&gt;).show()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The error message for the second spark.sql line is&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;pyspark.sql.utils.AnalysisException: cannot resolve &apos;`week`&apos; given input columns: &lt;span class=&quot;error&quot;&gt;&amp;#91;data.d, data.v&amp;#93;&lt;/span&gt;; line 1 pos 81;&lt;br/&gt;
&apos;Aggregate &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;week&amp;#93;&lt;/span&gt;, &lt;a href=&quot;#21, cast(date_trunc(week, cast(d#0 as timestamp), Some(America/New_York)) as date) AS week#22&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&apos;sum(&apos;val) AS value#21, cast(date_trunc(week, cast(d#0 as timestamp), Some(America/New_York)) as date) AS week#22&lt;/a&gt;&lt;br/&gt;
+- SubqueryAlias data&lt;br/&gt;
   +- LogicalRDD &lt;a href=&quot;#0, v#1L&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;d#0, v#1L&lt;/a&gt;, false&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;but the actual problem is that I used the wrong variable name in a different part of the query. Nothing is wrong with &lt;tt&gt;week&lt;/tt&gt; in this case.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13403658">SPARK-36867</key>
            <summary>Misleading Error Message with Invalid Column and Group By</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cloud_fan">Wenchen Fan</assignee>
                                    <reporter username="jackowaya">Alan Jackoway</reporter>
                        <labels>
                    </labels>
                <created>Mon, 27 Sep 2021 19:52:06 +0000</created>
                <updated>Tue, 12 Oct 2021 14:48:31 +0000</updated>
                            <resolved>Tue, 12 Oct 2021 14:47:52 +0000</resolved>
                                    <version>3.1.2</version>
                                    <fixVersion>3.3.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17427212" author="apachespark" created="Mon, 11 Oct 2021 15:44:53 +0000"  >&lt;p&gt;User &apos;cloud-fan&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/34244&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/34244&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17427745" author="cloud_fan" created="Tue, 12 Oct 2021 14:47:52 +0000"  >&lt;p&gt;Issue resolved by pull request 34244&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/34244&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/34244&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 5 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0vck0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>