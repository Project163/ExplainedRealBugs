<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:54:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-19451] rangeBetween method should accept Long value as boundary</title>
                <link>https://issues.apache.org/jira/browse/SPARK-19451</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Hi there,&lt;/p&gt;

&lt;p&gt;there seems to be a major limitation in spark window functions and rangeBetween method.&lt;/p&gt;

&lt;p&gt;If I have the following code :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;Exemple&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    val tw =  Window.orderBy(&lt;span class=&quot;code-quote&quot;&gt;&quot;date&quot;&lt;/span&gt;)
      .partitionBy(&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;)
      .rangeBetween( from , 0)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Everything seems ok, while &lt;b&gt;from&lt;/b&gt; value is not too large... Even if the rangeBetween() method supports Long parameters.&lt;br/&gt;
But.... If i set &lt;b&gt;-2160000000L&lt;/b&gt; value to &lt;b&gt;from&lt;/b&gt; it does not work !&lt;/p&gt;

&lt;p&gt;It is probably related to this part of code in the between() method, of the WindowSpec class, called by rangeBetween()&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;between() method&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    val boundaryStart = start match {
      &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; 0 =&amp;gt; CurrentRow
      &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;.MinValue =&amp;gt; UnboundedPreceding
      &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; x &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; x &amp;lt; 0 =&amp;gt; ValuePreceding(-start.toInt)
      &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; x &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; x &amp;gt; 0 =&amp;gt; ValueFollowing(start.toInt)
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;( look at this &lt;b&gt;.toInt&lt;/b&gt; )&lt;/p&gt;

&lt;p&gt;Does anybody know it there&apos;s a way to solve / patch this behavior ?&lt;/p&gt;

&lt;p&gt;Any help will be appreciated&lt;/p&gt;

&lt;p&gt;Thx&lt;/p&gt;</description>
                <environment></environment>
        <key id="13040178">SPARK-19451</key>
            <summary>rangeBetween method should accept Long value as boundary</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jiangxb1987">Xingbo Jiang</assignee>
                                    <reporter username="jchamp">Julien Champ</reporter>
                        <labels>
                    </labels>
                <created>Fri, 3 Feb 2017 17:29:33 +0000</created>
                <updated>Sun, 30 Jul 2017 03:37:11 +0000</updated>
                            <resolved>Sat, 29 Jul 2017 17:12:28 +0000</resolved>
                                    <version>1.6.1</version>
                    <version>2.0.2</version>
                                    <fixVersion>2.3.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15853434" author="unclegen" created="Mon, 6 Feb 2017 01:53:43 +0000"  >&lt;p&gt;Good catch! I will dig deeply into code and fix it if it is really a bug.&lt;/p&gt;</comment>
                            <comment id="15853685" author="jchamp" created="Mon, 6 Feb 2017 08:31:54 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=uncleGen&quot; class=&quot;user-hover&quot; rel=&quot;uncleGen&quot;&gt;uncleGen&lt;/a&gt; for your answer.&lt;/p&gt;

&lt;p&gt;I was tempted to try to fix it myself.. But not sure of possible side effects.&lt;br/&gt;
If I can help you in any way ( code / debug / tests ), feel free to ask.&lt;/p&gt;

&lt;p&gt;P.S. : I think this affects all version of Spark with Window functions, but I have only tested it on spark 1.6.1 and 2.0.2&lt;/p&gt;</comment>
                            <comment id="15853763" author="apachespark" created="Mon, 6 Feb 2017 09:44:05 +0000"  >&lt;p&gt;User &apos;uncleGen&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/16818&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/16818&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15853773" author="unclegen" created="Mon, 6 Feb 2017 09:58:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jchamp&quot; class=&quot;user-hover&quot; rel=&quot;jchamp&quot;&gt;jchamp&lt;/a&gt; I have taken a fast look through the code, and did not find any strong point to set the type of index as Int. In the window function, there is really a underlying integer overflow issue. I  made a pull request (&lt;a href=&quot;https://github.com/apache/spark/pull/16818&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/16818&lt;/a&gt;), and any suggestion is appreciated.&lt;/p&gt;</comment>
                            <comment id="15853782" author="hvanhovell" created="Mon, 6 Feb 2017 10:05:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jchamp&quot; class=&quot;user-hover&quot; rel=&quot;jchamp&quot;&gt;jchamp&lt;/a&gt; how may rows are in your partitions? 2 billion? So this is an oversight, but I am not sure we should even try to support more than &lt;tt&gt;1 &amp;lt;&amp;lt; 32 - 1&lt;/tt&gt; values in a partition.&lt;/p&gt;</comment>
                            <comment id="15853793" author="jchamp" created="Mon, 6 Feb 2017 10:19:23 +0000"  >&lt;p&gt;Let&apos;s imagine that this window is used on timestamp values in ms : I can ask for a window with a range between &lt;span class=&quot;error&quot;&gt;&amp;#91;-2160000000L, 0&amp;#93;&lt;/span&gt; and only have a few values inside, not necessarily 2160000000L.&lt;/p&gt;

&lt;p&gt;I can understand the limitation for the rowBetween() method but the rangeBetween() method is nice for this kind of usage.&lt;/p&gt;</comment>
                            <comment id="15853800" author="hvanhovell" created="Mon, 6 Feb 2017 10:23:26 +0000"  >&lt;p&gt;Yeah, you are right about that. We should definitely support this.&lt;/p&gt;</comment>
                            <comment id="15853936" author="jchamp" created="Mon, 6 Feb 2017 12:52:53 +0000"  >&lt;p&gt;Glad to see that I&apos;m not the only one convinced by this usage !&lt;/p&gt;

&lt;p&gt;This probably needs to use different data structures for rowBetween() and rangeBetween()&lt;/p&gt;</comment>
                            <comment id="15853963" author="hvanhovell" created="Mon, 6 Feb 2017 13:11:46 +0000"  >&lt;p&gt;At the end of the day I would like to support arbitrary literals for range frames. See: &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-9221&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-9221&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16073385" author="jchamp" created="Tue, 4 Jul 2017 09:22:47 +0000"  >&lt;p&gt;Any news on this bug / feature request ?&lt;/p&gt;

&lt;p&gt;Or any workaround ? May be using stream I can efficiently do what I want ?&lt;/p&gt;</comment>
                            <comment id="16074468" author="apachespark" created="Wed, 5 Jul 2017 09:15:05 +0000"  >&lt;p&gt;User &apos;jiangxb1987&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18540&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18540&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16081933" author="jchamp" created="Tue, 11 Jul 2017 09:12:17 +0000"  >&lt;p&gt;Nice so see that there is such a pull request for this issue !&lt;/p&gt;

&lt;p&gt;If I can help you in some way, feel free to ask.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 19 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i39l5z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>