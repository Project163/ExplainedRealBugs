<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:27:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-7568] ml.LogisticRegression doesn&apos;t output the right prediction</title>
                <link>https://issues.apache.org/jira/browse/SPARK-7568</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;`bin/spark-submit examples/src/main/python/ml/simple_text_classification_pipeline.py`&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Row(id=4, text=u&lt;span class=&quot;code-quote&quot;&gt;&apos;spark i j k&apos;&lt;/span&gt;, words=[u&lt;span class=&quot;code-quote&quot;&gt;&apos;spark&apos;&lt;/span&gt;, u&lt;span class=&quot;code-quote&quot;&gt;&apos;i&apos;&lt;/span&gt;, u&lt;span class=&quot;code-quote&quot;&gt;&apos;j&apos;&lt;/span&gt;, u&lt;span class=&quot;code-quote&quot;&gt;&apos;k&apos;&lt;/span&gt;], features=SparseVector(262144, {105: 1.0, 106: 1.0, 107: 1.0, 62173: 1.0}), rawPrediction=DenseVector([0.1629, -0.1629]), probability=DenseVector([0.5406, 0.4594]), prediction=0.0)
Row(id=5, text=u&lt;span class=&quot;code-quote&quot;&gt;&apos;l m n&apos;&lt;/span&gt;, words=[u&lt;span class=&quot;code-quote&quot;&gt;&apos;l&apos;&lt;/span&gt;, u&lt;span class=&quot;code-quote&quot;&gt;&apos;m&apos;&lt;/span&gt;, u&lt;span class=&quot;code-quote&quot;&gt;&apos;n&apos;&lt;/span&gt;], features=SparseVector(262144, {108: 1.0, 109: 1.0, 110: 1.0}), rawPrediction=DenseVector([2.6407, -2.6407]), probability=DenseVector([0.9334, 0.0666]), prediction=0.0)
Row(id=6, text=u&lt;span class=&quot;code-quote&quot;&gt;&apos;mapreduce spark&apos;&lt;/span&gt;, words=[u&lt;span class=&quot;code-quote&quot;&gt;&apos;mapreduce&apos;&lt;/span&gt;, u&lt;span class=&quot;code-quote&quot;&gt;&apos;spark&apos;&lt;/span&gt;], features=SparseVector(262144, {62173: 1.0, 140738: 1.0}), rawPrediction=DenseVector([1.2651, -1.2651]), probability=DenseVector([0.7799, 0.2201]), prediction=0.0)
Row(id=7, text=u&lt;span class=&quot;code-quote&quot;&gt;&apos;apache hadoop&apos;&lt;/span&gt;, words=[u&lt;span class=&quot;code-quote&quot;&gt;&apos;apache&apos;&lt;/span&gt;, u&lt;span class=&quot;code-quote&quot;&gt;&apos;hadoop&apos;&lt;/span&gt;], features=SparseVector(262144, {128334: 1.0, 134181: 1.0}), rawPrediction=DenseVector([3.7429, -3.7429]), probability=DenseVector([0.9769, 0.0231]), prediction=0.0)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In Scala&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ bin/run-example ml.SimpleTextClassificationPipeline

(4, spark i j k) --&amp;gt; prob=[0.5406433544851436,0.45935664551485655], prediction=0.0
(5, l m n) --&amp;gt; prob=[0.9334382627383263,0.06656173726167364], prediction=0.0
(6, mapreduce spark) --&amp;gt; prob=[0.7799076868203896,0.22009231317961045], prediction=0.0
(7, apache hadoop) --&amp;gt; prob=[0.9768636139518304,0.023136386048169616], prediction=0.0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;All predictions are 0, while some should be one based on the probability. It seems to be an issue with regularization.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12829272">SPARK-7568</key>
            <summary>ml.LogisticRegression doesn&apos;t output the right prediction</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dbtsai">DB Tsai</assignee>
                                    <reporter username="mengxr">Xiangrui Meng</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 May 2015 18:33:27 +0000</created>
                <updated>Thu, 14 May 2015 08:26:25 +0000</updated>
                            <resolved>Thu, 14 May 2015 08:26:25 +0000</resolved>
                                    <version>1.4.0</version>
                                    <fixVersion>1.4.0</fixVersion>
                                    <component>ML</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14541301" author="dbtsai" created="Wed, 13 May 2015 04:34:44 +0000"  >&lt;p&gt;This is because we regularize the intercept before which effectively regularizing less on the weights. Now, we follow the R&apos;s standard without regularizing the intercept, so we need to decrease the regularization. BTW, we need to implement efficient cross validation soon to help users to pick up lambda. &lt;/p&gt;

&lt;p&gt;with lambda = 0.001 in the current code, the result looks correct.&lt;br/&gt;
```&lt;br/&gt;
(4, spark i j k) --&amp;gt; prob=&lt;span class=&quot;error&quot;&gt;&amp;#91;0.1596407738787411,0.8403592261212589&amp;#93;&lt;/span&gt;, prediction=1.0&lt;br/&gt;
(5, l m n) --&amp;gt; prob=&lt;span class=&quot;error&quot;&gt;&amp;#91;0.8378325685476612,0.16216743145233883&amp;#93;&lt;/span&gt;, prediction=0.0&lt;br/&gt;
(6, mapreduce spark) --&amp;gt; prob=&lt;span class=&quot;error&quot;&gt;&amp;#91;0.6693126798261013,0.3306873201738986&amp;#93;&lt;/span&gt;, prediction=0.0&lt;br/&gt;
(7, apache hadoop) --&amp;gt; prob=&lt;span class=&quot;error&quot;&gt;&amp;#91;0.9821575333444208,0.01784246665557917&amp;#93;&lt;/span&gt;, prediction=0.0&lt;br/&gt;
```&lt;/p&gt;</comment>
                            <comment id="14541316" author="mengxr" created="Wed, 13 May 2015 04:49:16 +0000"  >&lt;p&gt;The 3rd example still has prediction 0.0. Maybe we should try an even smaller regParam.&lt;/p&gt;</comment>
                            <comment id="14541332" author="dbtsai" created="Wed, 13 May 2015 05:08:23 +0000"  >&lt;p&gt;Well, the third example is 0.0 in the old code.&lt;br/&gt;
```&lt;br/&gt;
(4, spark i j k) --&amp;gt; prob=&lt;span class=&quot;error&quot;&gt;&amp;#91;0.18764577263047177,0.8123542273695282&amp;#93;&lt;/span&gt;, prediction=1.0&lt;br/&gt;
(5, l m n) --&amp;gt; prob=&lt;span class=&quot;error&quot;&gt;&amp;#91;0.6508848199790638,0.3491151800209362&amp;#93;&lt;/span&gt;, prediction=0.0&lt;br/&gt;
(6, mapreduce spark) --&amp;gt; prob=&lt;span class=&quot;error&quot;&gt;&amp;#91;0.561585214970727,0.43841478502927295&amp;#93;&lt;/span&gt;, prediction=0.0&lt;br/&gt;
(7, apache hadoop) --&amp;gt; prob=&lt;span class=&quot;error&quot;&gt;&amp;#91;0.9118076920593474,0.08819230794065264&amp;#93;&lt;/span&gt;, prediction=0.0&lt;br/&gt;
```&lt;/p&gt;

&lt;p&gt;Of course, I can tune lambda such that the third example is 1.0. &lt;/p&gt;</comment>
                            <comment id="14541352" author="dbtsai" created="Wed, 13 May 2015 05:22:16 +0000"  >&lt;p&gt;Actually, with lambda = 0.001, the training accuracy is perfect.&lt;/p&gt;

&lt;p&gt;```&lt;br/&gt;
(0, a b c d e spark) --&amp;gt; prob=&lt;span class=&quot;error&quot;&gt;&amp;#91;0.0021342419881406746,0.9978657580118594&amp;#93;&lt;/span&gt;, prediction=1.0&lt;br/&gt;
(1, b d) --&amp;gt; prob=&lt;span class=&quot;error&quot;&gt;&amp;#91;0.9959176174854043,0.004082382514595685&amp;#93;&lt;/span&gt;, prediction=0.0&lt;br/&gt;
(2, spark f g h) --&amp;gt; prob=&lt;span class=&quot;error&quot;&gt;&amp;#91;0.0014541569986711233,0.9985458430013289&amp;#93;&lt;/span&gt;, prediction=1.0&lt;br/&gt;
(3, hadoop mapreduce) --&amp;gt; prob=&lt;span class=&quot;error&quot;&gt;&amp;#91;0.9982978367343561,0.0017021632656438518&amp;#93;&lt;/span&gt;, prediction=0.0&lt;br/&gt;
```&lt;/p&gt;</comment>
                            <comment id="14541358" author="apachespark" created="Wed, 13 May 2015 05:26:06 +0000"  >&lt;p&gt;User &apos;dbtsai&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/6109&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/6109&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14541363" author="mengxr" created="Wed, 13 May 2015 05:28:07 +0000"  >&lt;p&gt;Instance 6 still has prediction 0.0, which was 1.0 in Spark 1.3 (if I remember it correctly). Did you test Spark 1.3 or Spark 1.4 before elastic-net change?&lt;/p&gt;</comment>
                            <comment id="14541374" author="dbtsai" created="Wed, 13 May 2015 05:36:57 +0000"  >&lt;p&gt;In 1.3, &lt;a href=&quot;https://github.com/apache/spark/blob/branch-1.3/mllib/src/main/scala/org/apache/spark/ml/classification/LogisticRegression.scala&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/branch-1.3/mllib/src/main/scala/org/apache/spark/ml/classification/LogisticRegression.scala&lt;/a&gt;&lt;br/&gt;
the intercept is false!&lt;/p&gt;

&lt;p&gt;I just check that in 1.4 before I introduced new LOR, we changed the intercept to default of true. In this case, instance 6 will has prediction 0.0.&lt;/p&gt;

&lt;p&gt;I confirmed that if we turn off the intercept and with the same regularization, the prob is the same as 1.3. Maybe we should just turn off the intercept since it&apos;s high dim problem, and intercept is not important most of time.&lt;/p&gt;</comment>
                            <comment id="14541375" author="mengxr" created="Wed, 13 May 2015 05:39:52 +0000"  >&lt;p&gt;What is the default value in R for fitIntercept? Just checked LIBLINEAR and its default is false.&lt;/p&gt;</comment>
                            <comment id="14541385" author="dbtsai" created="Wed, 13 May 2015 05:42:44 +0000"  >&lt;p&gt;Default for R is true as you can see in the unit-test R script.&lt;/p&gt;</comment>
                            <comment id="14541416" author="dbtsai" created="Wed, 13 May 2015 06:05:10 +0000"  >&lt;p&gt;`fitIntercept = false`, or in Spark 1.3, the training likehood is lower compared with the one with `intercept`.&lt;/p&gt;

&lt;p&gt;```&lt;br/&gt;
(0, a b c d e spark) --&amp;gt; prob=&lt;span class=&quot;error&quot;&gt;&amp;#91;0.08957171964937032,0.9104282803506297&amp;#93;&lt;/span&gt;, prediction=1.0&lt;br/&gt;
(1, b d) --&amp;gt; prob=&lt;span class=&quot;error&quot;&gt;&amp;#91;0.8126200119520359,0.1873799880479641&amp;#93;&lt;/span&gt;, prediction=0.0&lt;br/&gt;
(2, spark f g h) --&amp;gt; prob=&lt;span class=&quot;error&quot;&gt;&amp;#91;0.056941677968997864,0.9430583220310021&amp;#93;&lt;/span&gt;, prediction=1.0&lt;br/&gt;
(3, hadoop mapreduce) --&amp;gt; prob=&lt;span class=&quot;error&quot;&gt;&amp;#91;0.8935982881732397,0.10640171182676032&amp;#93;&lt;/span&gt;, prediction=0.0&lt;br/&gt;
```&lt;/p&gt;
</comment>
                            <comment id="14541423" author="mengxr" created="Wed, 13 May 2015 06:11:34 +0000"  >&lt;p&gt;That is expected because intercept adds one degree of freedom and hence it is more likely to overfit. I would prefer disabling fitIntercept by default.&lt;/p&gt;</comment>
                            <comment id="14543377" author="mengxr" created="Thu, 14 May 2015 08:26:25 +0000"  >&lt;p&gt;Issue resolved by pull request 6109&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/6109&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/6109&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 27 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2emtz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12329359">1.4.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>