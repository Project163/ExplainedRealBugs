<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:34:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-11390] Query plan with/without filterPushdown indistinguishable</title>
                <link>https://issues.apache.org/jira/browse/SPARK-11390</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;The execution plan of a query remains the same regardless of whether the filterPushdown flag has been set to &quot;true&quot; or &quot;false&quot;, as can be seen below: &lt;br/&gt;
======&lt;br/&gt;
scala&amp;gt; sqlContext.setConf(&quot;spark.sql.orc.filterPushdown&quot;, &quot;false&quot;)&lt;br/&gt;
scala&amp;gt;     sqlContext.sql(&quot;SELECT name FROM people WHERE age = 15&quot;).explain()&lt;br/&gt;
== Physical Plan ==&lt;br/&gt;
Project &lt;a href=&quot;#6&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;name#6&lt;/a&gt;&lt;br/&gt;
 Filter (age#7 = 15)&lt;br/&gt;
  Scan OrcRelation&lt;span class=&quot;error&quot;&gt;&amp;#91;hdfs://localhost:9000/user/spec/people&amp;#93;&lt;/span&gt;&lt;a href=&quot;#6,age#7&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;name#6,age#7&lt;/a&gt;&lt;br/&gt;
scala&amp;gt; sqlContext.setConf(&quot;spark.sql.orc.filterPushdown&quot;, &quot;true&quot;)&lt;br/&gt;
scala&amp;gt;     sqlContext.sql(&quot;SELECT name FROM people WHERE age = 15&quot;).explain()&lt;br/&gt;
== Physical Plan ==&lt;br/&gt;
Project &lt;a href=&quot;#6&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;name#6&lt;/a&gt;&lt;br/&gt;
 Filter (age#7 = 15)&lt;br/&gt;
  Scan OrcRelation&lt;span class=&quot;error&quot;&gt;&amp;#91;hdfs://localhost:9000/user/spec/people&amp;#93;&lt;/span&gt;&lt;a href=&quot;#6,age#7&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;name#6,age#7&lt;/a&gt;&lt;br/&gt;
======&lt;br/&gt;
Ideally, when the filterPushdown flag is set to &quot;true&quot;, both the scan and the filter nodes should be merged together to make it clear that the filtering is being done by the data source itself.&lt;/p&gt;</description>
                <environment>&lt;p&gt;All&lt;/p&gt;</environment>
        <key id="12908793">SPARK-11390</key>
            <summary>Query plan with/without filterPushdown indistinguishable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zeocio">Zee Chen</assignee>
                                    <reporter username="vishesh">Vishesh Jindal</reporter>
                        <labels>
                    </labels>
                <created>Thu, 29 Oct 2015 03:57:58 +0000</created>
                <updated>Fri, 8 Jan 2016 01:16:28 +0000</updated>
                            <resolved>Mon, 16 Nov 2015 22:22:02 +0000</resolved>
                                    <version>1.5.1</version>
                                    <fixVersion>1.6.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="14988330" author="zeocio" created="Tue, 3 Nov 2015 22:41:13 +0000"  >&lt;p&gt;I will take a look at this.&lt;/p&gt;

&lt;p&gt;If I understand your proposal correctly, we only need to reformat the print out of the plan tree to indicate a filter pushed down to the data source, we don&apos;t need to alter the underlying plan tree. There is a small chance this change could break tests (or 3rd party tools) that depend on the output format of explain.&lt;/p&gt;

&lt;p&gt;What is the desired output format? How about:&lt;/p&gt;

&lt;p&gt;Old format:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;== Physical Plan ==
Project [name#18]
 ConvertToSafe
  Filter (age#17 = 15)
   Scan ParquetRelation[file:/user/hive/warehouse/people_pq][name#18,age#17]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;New format:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;== Physical Plan ==
Project [name#18]
 ConvertToSafe
  Scan ParquetRelation[file:/user/hive/warehouse/people_pq][name#18,age#17] Filter (age#17 = 15)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14991538" author="vishesh" created="Thu, 5 Nov 2015 11:09:35 +0000"  >&lt;p&gt;I was under the impression that this is just a plan tree presentation issue, and that the filter was indeed getting pushed by calling the &lt;b&gt;PrunedFilteredScan.buildScan()&lt;/b&gt; method. However now I&apos;m not sure that&apos;s the case because the internal plan structure also seems to suggest otherwise:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;== Physical Plan == 
TungstenAggregate(key=[], functions=[(count(1),mode=Final,isDistinct=false)], output=[count#3L])  
  TungstenExchange SinglePartition       
    TungstenAggregate(key=[], functions=[(count(1),mode=Partial,isDistinct=false)], output=[currentCount#6L])    
       Project     
         Filter (age#1 &amp;lt; 15)      
           Scan OrcRelation[hdfs://localhost:9000/user/spec/people][age#1]  Code Generation: true
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Am I missing something here?&lt;/p&gt;</comment>
                            <comment id="14994349" author="zeocio" created="Fri, 6 Nov 2015 20:12:57 +0000"  >&lt;p&gt;The required change to support this feature is a bit more involved. I am new to this and still grokking the spark-sql code but it looks like DataSourceStrategy.apply (which calls buildInternalScan on underlying data source) would need to be modified to propagate the list of pushed filter expressions back up to PhysicalPlan node (either filter or scan).&lt;/p&gt;</comment>
                            <comment id="14995246" author="vishesh" created="Sat, 7 Nov 2015 15:14:04 +0000"  >&lt;p&gt;So if I understand it correctly, setting of the filterPushdown flag is immaterial, since what happens under the hood remains unaffected. If that is the case then the present print of the plan tree is correct and needs no amendment. Merging the nodes would send out the wrong indication that the filter is actually getting pushed. &lt;/p&gt;</comment>
                            <comment id="15003110" author="apachespark" created="Thu, 12 Nov 2015 22:47:07 +0000"  >&lt;p&gt;User &apos;zeocio&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/9679&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/9679&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15003170" author="zeocio" created="Thu, 12 Nov 2015 23:14:30 +0000"  >&lt;p&gt;Test output:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;sqlContext.setConf(&lt;span class=&quot;code-quote&quot;&gt;&quot;spark.sql.parquet.filterPushdown&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;)
sqlContext.sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;CREATE TEMPORARY TABLE people_pq_3 (age INT, name STRING) USING parquet OPTIONS (path &lt;span class=&quot;code-quote&quot;&gt;&apos;/tmp/ppl_pq3&apos;&lt;/span&gt;)&quot;&lt;/span&gt;)
sqlContext.sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT name FROM people_pq_3 WHERE age = 15 AND name LIKE &lt;span class=&quot;code-quote&quot;&gt;&apos;xxx&apos;&lt;/span&gt;&quot;&lt;/span&gt;).explain(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;== Parsed Logical Plan ==
&lt;span class=&quot;code-quote&quot;&gt;&apos;Project [unresolvedalias(&apos;&lt;/span&gt;name)]
 &lt;span class=&quot;code-quote&quot;&gt;&apos;Filter ((&apos;&lt;/span&gt;age = 15) &amp;amp;&amp;amp; &apos;name LIKE xxx)
  &apos;UnresolvedRelation `people_pq_3`, None

== Analyzed Logical Plan ==
name: string
Project [name#1]
 Filter ((age#0 = 15) &amp;amp;&amp;amp; name#1 LIKE xxx)
  Subquery people_pq_3
   Relation[age#0,name#1] ParquetRelation[file:/tmp/ppl_pq3]

== Optimized Logical Plan ==
Project [name#1]
 Filter ((age#0 = 15) &amp;amp;&amp;amp; (name#1 = xxx))
  Relation[age#0,name#1] ParquetRelation[file:/tmp/ppl_pq3]

== Physical Plan ==
TungstenProject [name#1]
 Filter ((age#0 = 15) &amp;amp;&amp;amp; (name#1 = xxx))
  Scan ParquetRelation[file:/tmp/ppl_pq3] PushedFilter: [EqualTo(age,15),EqualTo(name,xxx)] Output: [name#1,age#0]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15007478" author="marmbrus" created="Mon, 16 Nov 2015 22:22:02 +0000"  >&lt;p&gt;Issue resolved by pull request 9679&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/9679&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/9679&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12927175">SPARK-12639</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 1 week ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2no73:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>