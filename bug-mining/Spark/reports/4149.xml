<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:48:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-17929] Deadlock when AM restart and send RemoveExecutor on reset</title>
                <link>https://issues.apache.org/jira/browse/SPARK-17929</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;We fix &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-10582&quot; title=&quot;using dynamic-executor-allocation, if AM failed. the new AM will be started. But the new AM does not allocate executors to dirver&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-10582&quot;&gt;&lt;del&gt;SPARK-10582&lt;/del&gt;&lt;/a&gt;, and add reset in CoarseGrainedSchedulerBackend.scala&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; def reset(): Unit = &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; {
    numPendingExecutors = 0
    executorsPendingToRemove.clear()

    &lt;span class=&quot;code-comment&quot;&gt;// Remove all the lingering executors that should be removed but not yet. The reason might be
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// because (1) disconnected event is not yet received; (2) executors die silently.
&lt;/span&gt;    executorDataMap.toMap.foreach { &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; (eid, _) =&amp;gt;
      driverEndpoint.askWithRetry[&lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;](
        RemoveExecutor(eid, SlaveLost(&lt;span class=&quot;code-quote&quot;&gt;&quot;Stale executor after cluster manager re-registered.&quot;&lt;/span&gt;)))
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;but on removeExecutor also need the lock &quot;CoarseGrainedSchedulerBackend.this.synchronized&quot;, this will cause deadlock, and send RPC will failed, and reset failed&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; def removeExecutor(executorId: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, reason: ExecutorLossReason): Unit = {
      logDebug(s&lt;span class=&quot;code-quote&quot;&gt;&quot;Asked to remove executor $executorId with reason $reason&quot;&lt;/span&gt;)
      executorDataMap.get(executorId) match {
        &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; Some(executorInfo) =&amp;gt;
          &lt;span class=&quot;code-comment&quot;&gt;// This must be &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; because variables mutated
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// in &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; block are read when requesting executors
&lt;/span&gt;          val killed = CoarseGrainedSchedulerBackend.&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.&lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; {
            addressToExecutorId -= executorInfo.executorAddress
            executorDataMap -= executorId
            executorsPendingLossReason -= executorId
            executorsPendingToRemove.remove(executorId).getOrElse(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
          }
     ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13012224">SPARK-17929</key>
            <summary>Deadlock when AM restart and send RemoveExecutor on reset</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="scwf">Fei Wang</assignee>
                                    <reporter username="Sephiroth-Lin">Weizhong</reporter>
                        <labels>
                    </labels>
                <created>Fri, 14 Oct 2016 02:57:02 +0000</created>
                <updated>Fri, 21 Oct 2016 21:45:18 +0000</updated>
                            <resolved>Fri, 21 Oct 2016 21:45:18 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.2</fixVersion>
                    <fixVersion>2.1.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15574801" author="apachespark" created="Fri, 14 Oct 2016 09:32:05 +0000"  >&lt;p&gt;User &apos;scwf&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/15481&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/15481&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15581446" author="xwebber" created="Mon, 17 Oct 2016 07:04:43 +0000"  >&lt;p&gt;meet the same problem, seems the deadlock is obvious in code. will thy the PR&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 5 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i34vi7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>