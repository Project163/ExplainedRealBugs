<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:27:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-7447] Large Job submission lag when using Parquet w/ Schema Merging</title>
                <link>https://issues.apache.org/jira/browse/SPARK-7447</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;I have 2.6 billion rows in parquet format and I&apos;m trying to use the new schema merging feature (I was enforcing a consistent schema manually before in 0.8-1.2 which was annoying). &lt;/p&gt;

&lt;p&gt;I have approximate 200 parquet files with key=&amp;lt;date&amp;gt;. When I load the dataframe with the sqlcontext that process is understandably slow because I assume it&apos;s reading all the meta data from the parquet files and doing the initial schema merging. So that&apos;s ok.&lt;/p&gt;

&lt;p&gt;However the problem I have is that once I have the dataframe. Doing any operation on the dataframe seems to have a 10-30 second lag before it actually starts processing the Job and shows up as an Active Job in the Spark Manager. This was an instant operation in all previous versions of Spark. Once the job actually is running the performance is fantastic, however this job submission lag is horrible.&lt;/p&gt;

&lt;p&gt;I&apos;m wondering if there is a bug with recomputing the schema merging. Running top on the master node shows some thread maxed out on 1 cpu during the lagging time which makes me think it&apos;s not net i/o but something pre-processing before job submission.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Spark 1.3.1, aws, persistent hdfs version 2 with ebs storage, pyspark, 8 x c3.8xlarge nodes. &lt;/p&gt;

&lt;p&gt;spark-conf&lt;/p&gt;

&lt;p&gt;spark.executor.memory 50g&lt;/p&gt;

&lt;p&gt;spark.driver.cores 32&lt;br/&gt;
spark.driver.memory 50g&lt;/p&gt;

&lt;p&gt;spark.default.parallelism 512&lt;br/&gt;
spark.sql.shuffle.partitions 512&lt;/p&gt;

&lt;p&gt;spark.task.maxFailures  30&lt;/p&gt;

&lt;p&gt;spark.executor.logs.rolling.maxRetainedFiles 2&lt;br/&gt;
spark.executor.logs.rolling.size.maxBytes 102400&lt;br/&gt;
spark.executor.logs.rolling.strategy size&lt;/p&gt;

&lt;p&gt;spark.shuffle.spill false&lt;/p&gt;

&lt;p&gt;spark.sql.parquet.cacheMetadata true&lt;br/&gt;
spark.sql.parquet.filterPushdown true&lt;br/&gt;
spark.sql.codegen true&lt;/p&gt;

&lt;p&gt;spark.akka.threads = 64&lt;/p&gt;</environment>
        <key id="12828095">SPARK-7447</key>
            <summary>Large Job submission lag when using Parquet w/ Schema Merging</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="viirya">L. C. Hsieh</assignee>
                                    <reporter username="brdwrd">Brad Willard</reporter>
                        <labels>
                    </labels>
                <created>Thu, 7 May 2015 19:38:44 +0000</created>
                <updated>Sun, 17 May 2015 07:43:51 +0000</updated>
                            <resolved>Sun, 17 May 2015 07:43:21 +0000</resolved>
                                    <version>1.3.0</version>
                    <version>1.3.1</version>
                                    <fixVersion>1.4.0</fixVersion>
                                    <component>PySpark</component>
                    <component>Spark Core</component>
                    <component>Spark Submit</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14535018" author="apachespark" created="Fri, 8 May 2015 17:26:43 +0000"  >&lt;p&gt;User &apos;viirya&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/6012&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/6012&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14535208" author="brdwrd" created="Fri, 8 May 2015 18:39:23 +0000"  >&lt;p&gt;Thanks, you are a hero.&lt;/p&gt;</comment>
                            <comment id="14547077" author="lian cheng" created="Sun, 17 May 2015 07:43:21 +0000"  >&lt;p&gt;Issue resolved by pull request 6012&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/6012&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/6012&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 27 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2efpb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>