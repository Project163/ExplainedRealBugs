<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:57:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-22162] Executors and the driver use inconsistent Job IDs during the new RDD commit protocol</title>
                <link>https://issues.apache.org/jira/browse/SPARK-22162</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;After &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-18191&quot; title=&quot;Port RDD API to use commit protocol&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-18191&quot;&gt;&lt;del&gt;SPARK-18191&lt;/del&gt;&lt;/a&gt; commit in pull request 15769, using the new commit protocol it is possible that driver and executors uses different jobIds during a rdd commit.&lt;br/&gt;
In the old code, the variable stageId is part of the closure used to define the task as you can see here:&lt;br/&gt;
 &lt;a href=&quot;https://github.com/apache/spark/blob/9c8deef64efee20a0ddc9b612f90e77c80aede60/core/src/main/scala/org/apache/spark/rdd/PairRDDFunctions.scala#L1098&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/9c8deef64efee20a0ddc9b612f90e77c80aede60/core/src/main/scala/org/apache/spark/rdd/PairRDDFunctions.scala#L1098&lt;/a&gt;&lt;br/&gt;
As a result, a TaskAttemptId is constructed in executors using the same &quot;stageId&quot; as the driver, since it is a value that is serialized in the driver. Also the value of stageID is actually the rdd.id which is assigned here: &lt;a href=&quot;https://github.com/apache/spark/blob/9c8deef64efee20a0ddc9b612f90e77c80aede60/core/src/main/scala/org/apache/spark/rdd/PairRDDFunctions.scala#L1084&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/9c8deef64efee20a0ddc9b612f90e77c80aede60/core/src/main/scala/org/apache/spark/rdd/PairRDDFunctions.scala#L1084&lt;/a&gt;&lt;br/&gt;
However, after the change in pull request 15769, the value is no longer part of the task closure, which gets serialized by the driver. Instead, it is pulled from the taskContext as you can see here:&lt;a href=&quot;https://github.com/apache/spark/pull/15769/files#diff-dff185cb90c666bce445e3212a21d765R103&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/15769/files#diff-dff185cb90c666bce445e3212a21d765R103&lt;/a&gt;&lt;br/&gt;
and then that value is used to construct the TaskAttemptId on the executors: &lt;a href=&quot;https://github.com/apache/spark/pull/15769/files#diff-dff185cb90c666bce445e3212a21d765R134&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/15769/files#diff-dff185cb90c666bce445e3212a21d765R134&lt;/a&gt;&lt;br/&gt;
taskContext has a stageID value which will be set in DAGScheduler. So after the change unlike the old code which a rdd.id was used, an actual stage.id is used which can be different between executors and the driver since it is no longer serialized.&lt;br/&gt;
In summary, the old code consistently used rddId, and just incorrectly named it &quot;stageId&quot;.&lt;br/&gt;
The new code uses a mix of rddId and stageId. There should be a consistent ID between executors and the drivers.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13105892">SPARK-22162</key>
            <summary>Executors and the driver use inconsistent Job IDs during the new RDD commit protocol</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rezasafi">Reza Safi</assignee>
                                    <reporter username="rezasafi">Reza Safi</reporter>
                        <labels>
                    </labels>
                <created>Thu, 28 Sep 2017 22:41:06 +0000</created>
                <updated>Tue, 5 Dec 2017 17:16:46 +0000</updated>
                            <resolved>Mon, 4 Dec 2017 17:25:21 +0000</resolved>
                                    <version>2.2.0</version>
                                    <fixVersion>2.2.2</fixVersion>
                    <fixVersion>2.3.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16185036" author="rezasafi" created="Thu, 28 Sep 2017 22:41:55 +0000"  >&lt;p&gt;I will send a pull request shortly for this issue.&lt;/p&gt;</comment>
                            <comment id="16185096" author="apachespark" created="Thu, 28 Sep 2017 23:26:04 +0000"  >&lt;p&gt;User &apos;rezasafi&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/19388&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/19388&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16271154" author="apachespark" created="Wed, 29 Nov 2017 17:21:05 +0000"  >&lt;p&gt;User &apos;rezasafi&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/19848&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/19848&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16277795" author="apachespark" created="Tue, 5 Dec 2017 00:09:03 +0000"  >&lt;p&gt;User &apos;rezasafi&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/19886&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/19886&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 50 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3kosf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>