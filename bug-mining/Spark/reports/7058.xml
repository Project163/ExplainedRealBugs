<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:15:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-31065] Empty string values cause schema_of_json() to return a schema not usable by from_json()</title>
                <link>https://issues.apache.org/jira/browse/SPARK-31065</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Here&apos;s a reproduction:&lt;br/&gt;
 &#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-python&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; pyspark.sql.functions &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; from_json, schema_of_json
json = &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;: &quot;&quot;}&apos;&lt;/span&gt;

df = spark.createDataFrame([(json,)], schema=[&lt;span class=&quot;code-quote&quot;&gt;&apos;json&apos;&lt;/span&gt;])
df.show()

&lt;span class=&quot;code-comment&quot;&gt;# chokes &lt;span class=&quot;code-keyword&quot;&gt;with&lt;/span&gt; org.apache.spark.sql.catalyst.parser.ParseException
&lt;/span&gt;json_schema = schema_of_json(json)
df.select(from_json(&lt;span class=&quot;code-quote&quot;&gt;&apos;json&apos;&lt;/span&gt;, json_schema))

&lt;span class=&quot;code-comment&quot;&gt;# works fine
&lt;/span&gt;json_schema = spark.read.json(df.rdd.&lt;span class=&quot;code-object&quot;&gt;map&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;lambda&lt;/span&gt; x: x[0])).schema
df.select(from_json(&lt;span class=&quot;code-quote&quot;&gt;&apos;json&apos;&lt;/span&gt;, json_schema))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The output:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;gt;&amp;gt;&amp;gt; from pyspark.sql.functions &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; from_json, schema_of_json
&amp;gt;&amp;gt;&amp;gt; json = &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;: &quot;&quot;}&apos;&lt;/span&gt;
&amp;gt;&amp;gt;&amp;gt; 
&amp;gt;&amp;gt;&amp;gt; df = spark.createDataFrame([(json,)], schema=[&lt;span class=&quot;code-quote&quot;&gt;&apos;json&apos;&lt;/span&gt;])
&amp;gt;&amp;gt;&amp;gt; df.show()
+---------+
|     json|
+---------+
|{&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;: &quot;&quot;}|
+---------+

&amp;gt;&amp;gt;&amp;gt; 
&amp;gt;&amp;gt;&amp;gt; # chokes with org.apache.spark.sql.catalyst.parser.ParseException
&amp;gt;&amp;gt;&amp;gt; json_schema = schema_of_json(json)
&amp;gt;&amp;gt;&amp;gt; df.select(from_json(&lt;span class=&quot;code-quote&quot;&gt;&apos;json&apos;&lt;/span&gt;, json_schema))
Traceback (most recent call last):
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;.../site-packages/pyspark/sql/utils.py&quot;&lt;/span&gt;, line 63, in deco
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; f(*a, **kw)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;.../site-packages/pyspark/python/lib/py4j-0.10.7-src.zip/py4j/protocol.py&quot;&lt;/span&gt;, line 328, in get_return_value
py4j.protocol.Py4JJavaError: An error occurred &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; calling z:org.apache.spark.sql.functions.from_json.
: org.apache.spark.sql.catalyst.parser.ParseException: 
extraneous input &lt;span class=&quot;code-quote&quot;&gt;&apos;&amp;lt;&apos;&lt;/span&gt; expecting {&lt;span class=&quot;code-quote&quot;&gt;&apos;SELECT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;FROM&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ADD&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;AS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ALL&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ANY&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;DISTINCT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;WHERE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;GROUP&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;BY&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;GROUPING&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;SETS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;CUBE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ROLLUP&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ORDER&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;HAVING&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;LIMIT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;AT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;OR&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;AND&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;IN&apos;&lt;/span&gt;, NOT, &lt;span class=&quot;code-quote&quot;&gt;&apos;NO&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;EXISTS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;BETWEEN&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;LIKE&apos;&lt;/span&gt;, RLIKE, &lt;span class=&quot;code-quote&quot;&gt;&apos;IS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;NULL&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;TRUE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;FALSE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;NULLS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ASC&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;DESC&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;FOR&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;INTERVAL&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;CASE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;WHEN&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;THEN&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ELSE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;END&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;JOIN&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;CROSS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;OUTER&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;INNER&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;LEFT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;SEMI&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;RIGHT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;FULL&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;NATURAL&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ON&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;PIVOT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;LATERAL&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;WINDOW&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;OVER&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;PARTITION&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;RANGE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ROWS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;UNBOUNDED&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;PRECEDING&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;FOLLOWING&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;CURRENT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;FIRST&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;AFTER&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;LAST&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ROW&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;WITH&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;VALUES&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;CREATE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;TABLE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;DIRECTORY&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;VIEW&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;REPLACE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;INSERT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;DELETE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;INTO&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;DESCRIBE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;EXPLAIN&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;FORMAT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;LOGICAL&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;CODEGEN&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;COST&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;CAST&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;SHOW&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;TABLES&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;COLUMNS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;COLUMN&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;USE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;PARTITIONS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;FUNCTIONS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;DROP&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;UNION&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;EXCEPT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;MINUS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;INTERSECT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;TO&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;TABLESAMPLE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;STRATIFY&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ALTER&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;RENAME&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ARRAY&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;MAP&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;STRUCT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;COMMENT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;SET&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;RESET&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;DATA&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;START&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;TRANSACTION&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;COMMIT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ROLLBACK&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;MACRO&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;IGNORE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;BOTH&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;LEADING&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;TRAILING&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;IF&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;POSITION&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;EXTRACT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;DIV&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;PERCENT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;BUCKET&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;OUT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;OF&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;SORT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;CLUSTER&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;DISTRIBUTE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;OVERWRITE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;TRANSFORM&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;REDUCE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;SERDE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;SERDEPROPERTIES&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;RECORDREADER&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;RECORDWRITER&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;DELIMITED&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;FIELDS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;TERMINATED&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;COLLECTION&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ITEMS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;KEYS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ESCAPED&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;LINES&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;SEPARATED&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;FUNCTION&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;EXTENDED&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;REFRESH&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;CLEAR&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;CACHE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;UNCACHE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;LAZY&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;FORMATTED&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;GLOBAL&apos;&lt;/span&gt;, TEMPORARY, &lt;span class=&quot;code-quote&quot;&gt;&apos;OPTIONS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;UNSET&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;TBLPROPERTIES&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;DBPROPERTIES&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;BUCKETS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;SKEWED&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;STORED&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;DIRECTORIES&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;LOCATION&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;EXCHANGE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ARCHIVE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;UNARCHIVE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;FILEFORMAT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;TOUCH&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;COMPACT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;CONCATENATE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;CHANGE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;CASCADE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;RESTRICT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;CLUSTERED&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;SORTED&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;PURGE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;INPUTFORMAT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;OUTPUTFORMAT&apos;&lt;/span&gt;, DATABASE, DATABASES, &lt;span class=&quot;code-quote&quot;&gt;&apos;DFS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;TRUNCATE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ANALYZE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;COMPUTE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;LIST&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;STATISTICS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;PARTITIONED&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;EXTERNAL&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;DEFINED&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;REVOKE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;GRANT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;LOCK&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;UNLOCK&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;MSCK&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;REPAIR&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;RECOVER&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;EXPORT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;IMPORT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;LOAD&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ROLE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ROLES&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;COMPACTIONS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;PRINCIPALS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;TRANSACTIONS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;INDEX&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;INDEXES&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;LOCKS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;OPTION&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ANTI&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;LOCAL&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;INPATH&apos;&lt;/span&gt;, IDENTIFIER, BACKQUOTED_IDENTIFIER}(line 1, pos 6)

== SQL ==
struct&amp;lt;a:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&amp;gt;
------^^^

	at org.apache.spark.sql.catalyst.parser.ParseException.withCommand(ParseDriver.scala:241)
	at org.apache.spark.sql.catalyst.parser.AbstractSqlParser.parse(ParseDriver.scala:117)
	at org.apache.spark.sql.catalyst.parser.AbstractSqlParser.parseTableSchema(ParseDriver.scala:64)
	at org.apache.spark.sql.types.DataType$.fromDDL(DataType.scala:123)
	at org.apache.spark.sql.catalyst.expressions.JsonExprUtils$.evalSchemaExpr(jsonExpressions.scala:777)
	at org.apache.spark.sql.catalyst.expressions.JsonToStructs.&amp;lt;init&amp;gt;(jsonExpressions.scala:527)
	at org.apache.spark.sql.functions$.from_json(functions.scala:3606)
	at org.apache.spark.sql.functions.from_json(functions.scala)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at py4j.reflection.MethodInvoker.invoke(MethodInvoker.java:244)
	at py4j.reflection.ReflectionEngine.invoke(ReflectionEngine.java:357)
	at py4j.Gateway.invoke(Gateway.java:282)
	at py4j.commands.AbstractCommand.invokeMethod(AbstractCommand.java:132)
	at py4j.commands.CallCommand.execute(CallCommand.java:79)
	at py4j.GatewayConnection.run(GatewayConnection.java:238)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;stdin&amp;gt;&quot;&lt;/span&gt;, line 1, in &amp;lt;module&amp;gt;
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;.../site-packages/pyspark/sql/functions.py&quot;&lt;/span&gt;, line 2284, in from_json
    jc = sc._jvm.functions.from_json(_to_java_column(col), schema, options)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;.../site-packages/pyspark/python/lib/py4j-0.10.7-src.zip/py4j/java_gateway.py&quot;&lt;/span&gt;, line 1257, in __call__
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;.../site-packages/pyspark/sql/utils.py&quot;&lt;/span&gt;, line 73, in deco
    raise ParseException(s.split(&lt;span class=&quot;code-quote&quot;&gt;&apos;: &apos;&lt;/span&gt;, 1)[1], stackTrace)
pyspark.sql.utils.ParseException: &lt;span class=&quot;code-quote&quot;&gt;&quot;\nextraneous input &lt;span class=&quot;code-quote&quot;&gt;&apos;&amp;lt;&apos;&lt;/span&gt; expecting {&lt;span class=&quot;code-quote&quot;&gt;&apos;SELECT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;FROM&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ADD&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;AS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ALL&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ANY&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;DISTINCT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;WHERE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;GROUP&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;BY&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;GROUPING&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;SETS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;CUBE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ROLLUP&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ORDER&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;HAVING&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;LIMIT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;AT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;OR&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;AND&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;IN&apos;&lt;/span&gt;, NOT, &lt;span class=&quot;code-quote&quot;&gt;&apos;NO&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;EXISTS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;BETWEEN&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;LIKE&apos;&lt;/span&gt;, RLIKE, &lt;span class=&quot;code-quote&quot;&gt;&apos;IS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;NULL&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;TRUE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;FALSE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;NULLS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ASC&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;DESC&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;FOR&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;INTERVAL&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;CASE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;WHEN&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;THEN&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ELSE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;END&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;JOIN&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;CROSS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;OUTER&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;INNER&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;LEFT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;SEMI&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;RIGHT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;FULL&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;NATURAL&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ON&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;PIVOT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;LATERAL&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;WINDOW&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;OVER&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;PARTITION&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;RANGE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ROWS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;UNBOUNDED&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;PRECEDING&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;FOLLOWING&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;CURRENT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;FIRST&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;AFTER&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;LAST&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ROW&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;WITH&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;VALUES&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;CREATE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;TABLE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;DIRECTORY&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;VIEW&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;REPLACE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;INSERT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;DELETE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;INTO&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;DESCRIBE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;EXPLAIN&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;FORMAT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;LOGICAL&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;CODEGEN&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;COST&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;CAST&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;SHOW&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;TABLES&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;COLUMNS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;COLUMN&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;USE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;PARTITIONS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;FUNCTIONS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;DROP&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;UNION&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;EXCEPT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;MINUS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;INTERSECT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;TO&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;TABLESAMPLE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;STRATIFY&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ALTER&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;RENAME&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ARRAY&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;MAP&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;STRUCT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;COMMENT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;SET&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;RESET&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;DATA&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;START&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;TRANSACTION&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;COMMIT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ROLLBACK&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;MACRO&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;IGNORE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;BOTH&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;LEADING&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;TRAILING&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;IF&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;POSITION&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;EXTRACT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;DIV&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;PERCENT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;BUCKET&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;OUT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;OF&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;SORT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;CLUSTER&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;DISTRIBUTE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;OVERWRITE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;TRANSFORM&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;REDUCE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;SERDE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;SERDEPROPERTIES&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;RECORDREADER&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;RECORDWRITER&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;DELIMITED&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;FIELDS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;TERMINATED&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;COLLECTION&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ITEMS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;KEYS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ESCAPED&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;LINES&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;SEPARATED&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;FUNCTION&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;EXTENDED&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;REFRESH&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;CLEAR&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;CACHE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;UNCACHE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;LAZY&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;FORMATTED&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;GLOBAL&apos;&lt;/span&gt;, TEMPORARY, &lt;span class=&quot;code-quote&quot;&gt;&apos;OPTIONS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;UNSET&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;TBLPROPERTIES&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;DBPROPERTIES&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;BUCKETS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;SKEWED&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;STORED&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;DIRECTORIES&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;LOCATION&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;EXCHANGE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ARCHIVE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;UNARCHIVE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;FILEFORMAT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;TOUCH&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;COMPACT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;CONCATENATE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;CHANGE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;CASCADE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;RESTRICT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;CLUSTERED&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;SORTED&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;PURGE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;INPUTFORMAT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;OUTPUTFORMAT&apos;&lt;/span&gt;, DATABASE, DATABASES, &lt;span class=&quot;code-quote&quot;&gt;&apos;DFS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;TRUNCATE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ANALYZE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;COMPUTE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;LIST&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;STATISTICS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;PARTITIONED&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;EXTERNAL&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;DEFINED&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;REVOKE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;GRANT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;LOCK&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;UNLOCK&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;MSCK&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;REPAIR&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;RECOVER&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;EXPORT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;IMPORT&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;LOAD&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ROLE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ROLES&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;COMPACTIONS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;PRINCIPALS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;TRANSACTIONS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;INDEX&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;INDEXES&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;LOCKS&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;OPTION&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ANTI&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;LOCAL&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;INPATH&apos;&lt;/span&gt;, IDENTIFIER, BACKQUOTED_IDENTIFIER}(line 1, pos 6)\n\n== SQL ==\nstruct&amp;lt;a:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&amp;gt;\n------^^^\n&quot;&lt;/span&gt;
&amp;gt;&amp;gt;&amp;gt; 
&amp;gt;&amp;gt;&amp;gt; # works fine
&amp;gt;&amp;gt;&amp;gt; json_schema = spark.read.json(df.rdd.map(lambda x: x[0])).schema
&amp;gt;&amp;gt;&amp;gt; df.select(from_json(&lt;span class=&quot;code-quote&quot;&gt;&apos;json&apos;&lt;/span&gt;, json_schema))
DataFrame[jsontostructs(json): struct&amp;lt;a:string&amp;gt;]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I assumed that &lt;tt&gt;schema_of_json()&lt;/tt&gt; would use the same code path that underlies &lt;tt&gt;spark.read.json()&lt;/tt&gt;, but I guess there is something different that trips up the parser.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13289960">SPARK-31065</key>
            <summary>Empty string values cause schema_of_json() to return a schema not usable by from_json()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gurwls223">Hyukjin Kwon</assignee>
                                    <reporter username="nchammas">Nicholas Chammas</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 Mar 2020 05:45:21 +0000</created>
                <updated>Mon, 12 Dec 2022 18:11:09 +0000</updated>
                            <resolved>Tue, 10 Mar 2020 07:42:04 +0000</resolved>
                                    <version>2.4.0</version>
                    <version>2.4.1</version>
                    <version>2.4.2</version>
                    <version>2.4.3</version>
                    <version>2.4.4</version>
                    <version>2.4.5</version>
                    <version>3.0.0</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17053052" author="nchammas" created="Fri, 6 Mar 2020 05:48:03 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hyukjin.kwon&quot; class=&quot;user-hover&quot; rel=&quot;hyukjin.kwon&quot;&gt;hyukjin.kwon&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17053079" author="nchammas" created="Fri, 6 Mar 2020 06:44:00 +0000"  >&lt;p&gt;Confirmed this issue is also present on &lt;tt&gt;branch-3.0&lt;/tt&gt; as of&#160;commit&#160;&lt;tt&gt;9b48f3358d3efb523715a5f258e5ed83e28692f6&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17054596" author="gurwls223" created="Mon, 9 Mar 2020 01:52:01 +0000"  >&lt;p&gt;There seems two issues. The first is in the JSON schema inference (&lt;a href=&quot;https://github.com/apache/spark/blob/c1986204e59f1e8cc4b611d5a578cb248cb74c28/sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/json/JsonInferSchema.scala#L115-L122&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/c1986204e59f1e8cc4b611d5a578cb248cb74c28/sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/json/JsonInferSchema.scala#L115-L122&lt;/a&gt;). Seems it treats empty strings as nulls. We might need an option to treat this as StringType.&lt;/p&gt;

&lt;p&gt;Another issue is that &lt;tt&gt;null&lt;/tt&gt; type is not properly being supported in SQL parser (which is used to parse the DDL type string from &lt;tt&gt;schema_of_json&lt;/tt&gt;). Hive supports &lt;tt&gt;null&lt;/tt&gt; type as &lt;tt&gt;void&lt;/tt&gt; keyword so we might need to support this as a proper string to parse as a &lt;tt&gt;null&lt;/tt&gt; type.&lt;/p&gt;</comment>
                            <comment id="17054674" author="nchammas" created="Mon, 9 Mar 2020 05:16:25 +0000"  >&lt;p&gt;Thanks for looking into it.&lt;/p&gt;

&lt;p&gt;I have a silly question: Why isn&apos;t &lt;tt&gt;schema_of_json()&lt;/tt&gt; simply syntactic sugar for &lt;tt&gt;spark.read.json()&lt;/tt&gt;?&lt;/p&gt;

&lt;p&gt;For example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-python&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; _schema_of_json(string):
    df = spark.read.json(spark.sparkContext.parallelize([string]))
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; df.schema&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Perhaps there are practical reasons not to do this, but conceptually speaking this kind of equivalence should hold. Yet this bug report demonstrates that they are not equivalent.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-python&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; pyspark.sql.functions &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; from_json, schema_of_json
json = &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;: &quot;&quot;}&apos;&lt;/span&gt;

df = spark.createDataFrame([(json,)], schema=[&lt;span class=&quot;code-quote&quot;&gt;&apos;json&apos;&lt;/span&gt;])
df.show()

&lt;span class=&quot;code-comment&quot;&gt;# chokes &lt;span class=&quot;code-keyword&quot;&gt;with&lt;/span&gt; org.apache.spark.sql.catalyst.parser.ParseException
&lt;/span&gt;json_schema = schema_of_json(json)
df.select(from_json(&lt;span class=&quot;code-quote&quot;&gt;&apos;json&apos;&lt;/span&gt;, json_schema))

&lt;span class=&quot;code-comment&quot;&gt;# works fine
&lt;/span&gt;json_schema = _schema_of_json(json)
df.select(from_json(&lt;span class=&quot;code-quote&quot;&gt;&apos;json&apos;&lt;/span&gt;, json_schema)) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17054683" author="gurwls223" created="Mon, 9 Mar 2020 06:05:29 +0000"  >&lt;p&gt;Oh, nice catch. Yes, &lt;tt&gt;null&lt;/tt&gt; types inferred for each field is replaced to &lt;tt&gt;string&lt;/tt&gt; type through &lt;a href=&quot;https://github.com/apache/spark/blob/master/sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/json/JsonInferSchema.scala#L380&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/master/sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/json/JsonInferSchema.scala#L380&lt;/a&gt; which isn&apos;t called in &lt;tt&gt;schema_of_json&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Let me make a quick fix.&lt;/p&gt;</comment>
                            <comment id="17055226" author="dongjoon" created="Mon, 9 Mar 2020 17:20:26 +0000"  >&lt;p&gt;Thank you, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nchammas&quot; class=&quot;user-hover&quot; rel=&quot;nchammas&quot;&gt;nchammas&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hyukjin.kwon&quot; class=&quot;user-hover&quot; rel=&quot;hyukjin.kwon&quot;&gt;hyukjin.kwon&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17055666" author="dongjoon" created="Tue, 10 Mar 2020 07:42:05 +0000"  >&lt;p&gt;Issue resolved by pull request 27854&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/27854&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/27854&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 36 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0c8a8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>