<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:12:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-1040] Collect as Map throws a casting exception when run on a JavaPairRDD object</title>
                <link>https://issues.apache.org/jira/browse/SPARK-1040</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;The error that arises&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.ClassCastException: [Ljava.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;; cannot be &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; to [Lscala.Tuple2;
	at org.apache.spark.rdd.PairRDDFunctions.collectAsMap(PairRDDFunctions.scala:427)
	at org.apache.spark.api.java.JavaPairRDD.collectAsMap(JavaPairRDD.scala:409)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The code being executed&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; ImageSummary(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; JavaPairRDD&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;,&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;[]&amp;gt; inImg) {
		&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Set&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; keyList=inImg.collectAsMap().keySet();
		&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; cVal: keyList) outString+=cVal+&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;;
		&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; outString;
	}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The line 426-427 from PairRDDFunctions.scala&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; def collectAsMap(): Map[K, V] = {
    val data = self.toArray()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12704761">SPARK-1040</key>
            <summary>Collect as Map throws a casting exception when run on a JavaPairRDD object</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="joshrosen">Josh Rosen</assignee>
                                    <reporter username="kevinmader">Kevin Mader</reporter>
                        <labels>
                    </labels>
                <created>Thu, 23 Jan 2014 02:03:47 +0000</created>
                <updated>Wed, 23 Sep 2015 14:29:16 +0000</updated>
                            <resolved>Sun, 26 Jan 2014 00:24:06 +0000</resolved>
                                    <version>0.9.0</version>
                                    <fixVersion>0.9.1</fixVersion>
                                    <component>Java API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13953573" author="joshrosen" created="Thu, 23 Jan 2014 11:02:08 +0000"  >&lt;p&gt;I wonder where that cast is being performed, since there&apos;s no explicit cast at that line.  Does the traceback have any more detail?&lt;/p&gt;

&lt;p&gt;JavaPairRDD.collectAsMap() is tested at least once in JavaAPISuite: &lt;a href=&quot;https://github.com/apache/incubator-spark/blob/master/core/src/test/scala/org/apache/spark/JavaAPISuite.java#L290&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/incubator-spark/blob/master/core/src/test/scala/org/apache/spark/JavaAPISuite.java#L290&lt;/a&gt;, so I wonder why that test works but your code fails.&lt;/p&gt;</comment>
                            <comment id="13953596" author="kevinmader" created="Sat, 25 Jan 2014 14:43:44 +0000"  >&lt;p&gt;I tried it again and it&apos;s definitely throws the same error. Could it be a type issue since I am using an array of primitives (int[]) in the JavaPairRDD, which Java doesn&apos;t always so eagerly support particularly as a generic?&lt;/p&gt;</comment>
                            <comment id="13953606" author="joshrosen" created="Sat, 25 Jan 2014 16:23:03 +0000"  >&lt;p&gt;I was able to reproduce this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Test
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void collectAsMapWithIntArrayValues() {
    &lt;span class=&quot;code-comment&quot;&gt;// Regression test &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; SPARK-1040
&lt;/span&gt;    JavaRDD&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; rdd = sc.parallelize(Arrays.asList(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;[] { 1 }));
    JavaPairRDD&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;[]&amp;gt; pairRDD = rdd.map(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PairFunction&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;[]&amp;gt;() {
      @Override
      &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;[]&amp;gt; call(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; x) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;[]&amp;gt;(x, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;[] { x });
      }
    });
    pairRDD.collect();  &lt;span class=&quot;code-comment&quot;&gt;// works fine
&lt;/span&gt;    Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;[]&amp;gt; map = pairRDD.collectAsMap();  &lt;span class=&quot;code-comment&quot;&gt;// crashed originally
&lt;/span&gt;  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I see the same traceback that you reported above.&lt;/p&gt;

&lt;p&gt;If I create a JavaPairRDD using SparkContext.parallelizePairs(), collectAsMap() works fine; the problem seems to only affect JavaPairRDDs that have been derived by transforming non-JavaPairRDDs.&lt;/p&gt;

&lt;p&gt;Also, it only seems to affect collectAsMap(); calling collect() on the same RDD works fine.  From the error, I suspect that the failing cast has to do with an implicit conversion to PairRDDFunctions.&lt;/p&gt;</comment>
                            <comment id="13953597" author="joshrosen" created="Sat, 25 Jan 2014 16:45:59 +0000"  >&lt;p&gt;I found a fix and opened a pull request here: &lt;a href=&quot;https://github.com/apache/incubator-spark/pull/511&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/incubator-spark/pull/511&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14151231" author="pulkit.bosco05@gmail.com" created="Sun, 28 Sep 2014 21:36:25 +0000"  >&lt;p&gt;The github link above is not functional anymore.&lt;/p&gt;</comment>
                            <comment id="14903541" author="glenn.strycker@gmail.com" created="Tue, 22 Sep 2015 22:08:02 +0000"  >&lt;p&gt;I am getting a similar error in Spark 1.3.0... see a new ticket I created:  &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-10762&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-10762&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14904571" author="glenn.strycker@gmail.com" created="Wed, 23 Sep 2015 14:29:16 +0000"  >&lt;p&gt;My ticket &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-10762&quot; title=&quot;GenericRowWithSchema exception in casting ArrayBuffer to HashSet in DataFrame to RDD from Hive table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-10762&quot;&gt;&lt;del&gt;SPARK-10762&lt;/del&gt;&lt;/a&gt; may have just been a user error, but was interesting none-the-less... evidently Scala or Spark is not correctly reporting the type of an ArrayBuffer as ArrayBuffer&lt;span class=&quot;error&quot;&gt;&amp;#91;Any&amp;#93;&lt;/span&gt;, but claimed it had correctly been cast to ArrayBuffer&lt;span class=&quot;error&quot;&gt;&amp;#91;(Int,String)&amp;#93;&lt;/span&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12756380">SPARK-4489</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>383188</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 8 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1u0lb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>383456</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>