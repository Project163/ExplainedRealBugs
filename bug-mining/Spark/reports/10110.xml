<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:46:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-51062] assertSchemaEqual Does Not Compare Decimal Precision and Scale</title>
                <link>https://issues.apache.org/jira/browse/SPARK-51062</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;h1&gt;&lt;a name=&quot;Summary&quot;&gt;&lt;/a&gt;Summary&lt;/h1&gt;

&lt;p&gt;The &lt;tt&gt;assertSchemaEqual&lt;/tt&gt; function in PySpark&apos;s testing utilities does not properly compare DecimalType fields, as it only checks the base type name (e.g. &quot;decimal&quot;) without comparing precision and scale parameters. This significantly reduces the utility of the function for schemas containing decimal fields.&lt;/p&gt;
&lt;h2&gt;&lt;a name=&quot;Version&quot;&gt;&lt;/a&gt;Version&lt;/h2&gt;
&lt;ul&gt;
	&lt;li&gt;Apache Spark Version: &amp;gt;=3.5.0&lt;/li&gt;
	&lt;li&gt;Component: PySpark Testing Utils&lt;/li&gt;
	&lt;li&gt;Function: &lt;tt&gt;pyspark.testing.assertSchemaEqual&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;&lt;a name=&quot;Description&quot;&gt;&lt;/a&gt;Description&lt;/h2&gt;

&lt;p&gt;When comparing two schemas containing DecimalType fields with different precision and scale parameters, &lt;tt&gt;assertSchemaEqual&lt;/tt&gt; incorrectly reports them as equal because it only compares the base type name (&quot;decimal&quot;) without considering the precision and scale parameters.&lt;/p&gt;
&lt;h3&gt;&lt;a name=&quot;CurrentBehavior&quot;&gt;&lt;/a&gt;Current Behavior&lt;/h3&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-python&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; pyspark.sql.types &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; StructType, StructField, DecimalType
&lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; pyspark.testing &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; assertSchemaEqual

s1 = StructType(
    [
        StructField(&lt;span class=&quot;code-quote&quot;&gt;&quot;price_102&quot;&lt;/span&gt;, DecimalType(10, 2), &lt;span class=&quot;code-keyword&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;True&lt;/span&gt;&lt;/span&gt;),
        StructField(&lt;span class=&quot;code-quote&quot;&gt;&quot;price_80&quot;&lt;/span&gt;, DecimalType(8, 0), &lt;span class=&quot;code-keyword&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;True&lt;/span&gt;&lt;/span&gt;),
    ]
)

s2 = StructType(
    [
        StructField(&lt;span class=&quot;code-quote&quot;&gt;&quot;price_102&quot;&lt;/span&gt;, DecimalType(10, 4), &lt;span class=&quot;code-keyword&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;True&lt;/span&gt;&lt;/span&gt;),  &lt;span class=&quot;code-comment&quot;&gt;# Different scale
&lt;/span&gt;        StructField(
            &lt;span class=&quot;code-quote&quot;&gt;&quot;price_80&quot;&lt;/span&gt;, DecimalType(10, 2), &lt;span class=&quot;code-keyword&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;True&lt;/span&gt;&lt;/span&gt;
        ),  &lt;span class=&quot;code-comment&quot;&gt;# Different precision &lt;span class=&quot;code-keyword&quot;&gt;and&lt;/span&gt; scale
&lt;/span&gt;    ]
)

&lt;span class=&quot;code-comment&quot;&gt;# This passes when it should fail
&lt;/span&gt;assertSchemaEqual(s1, s2)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;h3&gt;&lt;a name=&quot;ExpectedBehavior&quot;&gt;&lt;/a&gt;Expected Behavior&lt;/h3&gt;

&lt;p&gt;The function should compare both precision and scale parameters of DecimalType fields and raise a PySparkAssertionError when they differ, similar to how it handles other type mismatches. The error message should indicate which fields have mismatched decimal parameters.&lt;/p&gt;
&lt;h2&gt;&lt;a name=&quot;Impact&quot;&gt;&lt;/a&gt;Impact&lt;/h2&gt;

&lt;p&gt;This issue affects data quality validation and testing scenarios where precise decimal specifications are crucial, such as:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Financial data processing where decimal precision and scale are critical&lt;/li&gt;
	&lt;li&gt;ETL validation where source and target schemas must match exactly&lt;/li&gt;
&lt;/ul&gt;


&lt;h2&gt;&lt;a name=&quot;SuggestedFix&quot;&gt;&lt;/a&gt;Suggested Fix&lt;/h2&gt;

&lt;p&gt;The &lt;tt&gt;compare_datatypes_ignore_nullable&lt;/tt&gt; function in &lt;tt&gt;pyspark/testing/utils.py&lt;/tt&gt; should be enhanced to compare precision and scale parameters when dealing with decimal types:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-python&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; compare_datatypes_ignore_nullable(dt1: Any, dt2: Any):
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; dt1.typeName() == dt2.typeName():
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; dt1.typeName() == &lt;span class=&quot;code-quote&quot;&gt;&quot;decimal&quot;&lt;/span&gt;:
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; dt1.precision == dt2.precision &lt;span class=&quot;code-keyword&quot;&gt;and&lt;/span&gt; dt1.scale == dt2.scale
        &lt;span class=&quot;code-keyword&quot;&gt;elif&lt;/span&gt; dt1.typeName() == &lt;span class=&quot;code-quote&quot;&gt;&quot;array&quot;&lt;/span&gt;:
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; compare_datatypes_ignore_nullable(dt1.elementType, dt2.elementType)
        &lt;span class=&quot;code-keyword&quot;&gt;elif&lt;/span&gt; dt1.typeName() == &lt;span class=&quot;code-quote&quot;&gt;&quot;struct&quot;&lt;/span&gt;:
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; compare_schemas_ignore_nullable(dt1, dt2)
        &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;:
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;True&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;:
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;False&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13607028">SPARK-51062</key>
            <summary>assertSchemaEqual Does Not Compare Decimal Precision and Scale</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="amoghsantarkar">amoghsantarkar</assignee>
                                    <reporter username="pscheurig">pscheurig</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sun, 2 Feb 2025 11:18:54 +0000</created>
                <updated>Thu, 27 Mar 2025 23:12:22 +0000</updated>
                            <resolved>Thu, 27 Mar 2025 23:12:22 +0000</resolved>
                                    <version>3.5.0</version>
                    <version>3.5.1</version>
                    <version>3.5.2</version>
                    <version>3.5.3</version>
                    <version>3.5.4</version>
                                    <fixVersion>4.1.0</fixVersion>
                                    <component>PySpark</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17937955" author="JIRAUSER309134" created="Mon, 24 Mar 2025 17:11:11 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pscheurig&quot; class=&quot;user-hover&quot; rel=&quot;pscheurig&quot;&gt;pscheurig&lt;/a&gt;/team, I have committed code to [PR|&lt;a href=&quot;https://github.com/apache/spark/pull/50365&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/50365&lt;/a&gt;] and added unit test too for this please see when you get a chance!&#160;&lt;/p&gt;

&lt;p&gt;Thanks, &lt;br/&gt;
Amogh Antarkar&lt;/p&gt;</comment>
                            <comment id="17939089" author="gurwls223" created="Thu, 27 Mar 2025 23:12:22 +0000"  >&lt;p&gt;Issue resolved by pull request 50365&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/50365&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/50365&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            32 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1tyr4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>