<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:53:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-20364] Parquet predicate pushdown on columns with dots return empty results</title>
                <link>https://issues.apache.org/jira/browse/SPARK-20364</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Currently, if there are dots in the column name, predicate pushdown seems being failed in Parquet.&lt;/p&gt;

&lt;p&gt;*&lt;b&gt;With dots&lt;/b&gt;*&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;val path = &lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/abcde&quot;&lt;/span&gt;
Seq(Some(1), None).toDF(&lt;span class=&quot;code-quote&quot;&gt;&quot;col.dots&quot;&lt;/span&gt;).write.parquet(path)
spark.read.parquet(path).where(&lt;span class=&quot;code-quote&quot;&gt;&quot;`col.dots` IS NOT NULL&quot;&lt;/span&gt;).show()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;+--------+
|col.dots|
+--------+
+--------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;*&lt;b&gt;Without dots&lt;/b&gt;*&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;val path = &lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/abcde2&quot;&lt;/span&gt;
Seq(Some(1), None).toDF(&lt;span class=&quot;code-quote&quot;&gt;&quot;coldots&quot;&lt;/span&gt;).write.parquet(path)
spark.read.parquet(path).where(&lt;span class=&quot;code-quote&quot;&gt;&quot;`coldots` IS NOT NULL&quot;&lt;/span&gt;).show()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;+-------+
|coldots|
+-------+
|      1|
+-------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It seems dot in the column names via &lt;tt&gt;FilterApi&lt;/tt&gt; tries to separate the field name with dot (&lt;tt&gt;ColumnPath&lt;/tt&gt; with multiple column paths) whereas the actual column name is &lt;tt&gt;col.dots&lt;/tt&gt;. (See &lt;a href=&quot;https://github.com/apache/parquet-mr/blob/apache-parquet-1.8.2/parquet-column/src/main/java/org/apache/parquet/filter2/predicate/FilterApi.java#L71&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;FilterApi.java#L71 &lt;/a&gt; and it calls &lt;a href=&quot;https://github.com/apache/parquet-mr/blob/apache-parquet-1.8.2/parquet-common/src/main/java/org/apache/parquet/hadoop/metadata/ColumnPath.java#L44&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ColumnPath.java#L44&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I just tried to come up with ways to resolve it and I came up with two as below:&lt;/p&gt;

&lt;p&gt;One is simply to don&apos;t push down filters when there are dots in column names so that it reads all and filters in Spark-side.&lt;/p&gt;

&lt;p&gt;The other way creates Spark&apos;s &lt;tt&gt;FilterApi&lt;/tt&gt; for those columns (it seems final) to get always use single column path it in Spark-side (this seems hacky) as we are not pushing down nested columns currently. So, it looks we can get a field name via &lt;tt&gt;ColumnPath.get&lt;/tt&gt; not &lt;tt&gt;ColumnPath.fromDotString&lt;/tt&gt; in this way.&lt;/p&gt;

&lt;p&gt;I just made a rough version of the latter. &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt;[parquet] object ParquetColumns {
  def intColumn(columnPath: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;): Column[&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;] with SupportsLtGt = {
    &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Column[&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;] (ColumnPath.get(columnPath), classOf[&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;]) with SupportsLtGt
  }

  def longColumn(columnPath: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;): Column[java.lang.&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;] with SupportsLtGt = {
    &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Column[java.lang.&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;] (
      ColumnPath.get(columnPath), classOf[java.lang.&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;]) with SupportsLtGt
  }

  def floatColumn(columnPath: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;): Column[java.lang.&lt;span class=&quot;code-object&quot;&gt;Float&lt;/span&gt;] with SupportsLtGt = {
    &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Column[java.lang.&lt;span class=&quot;code-object&quot;&gt;Float&lt;/span&gt;] (
      ColumnPath.get(columnPath), classOf[java.lang.&lt;span class=&quot;code-object&quot;&gt;Float&lt;/span&gt;]) with SupportsLtGt
  }

  def doubleColumn(columnPath: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;): Column[java.lang.&lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;] with SupportsLtGt = {
    &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Column[java.lang.&lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;] (
      ColumnPath.get(columnPath), classOf[java.lang.&lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;]) with SupportsLtGt
  }

  def booleanColumn(columnPath: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;): Column[java.lang.&lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;] with SupportsEqNotEq = {
    &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Column[java.lang.&lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;] (
      ColumnPath.get(columnPath), classOf[java.lang.&lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;]) with SupportsEqNotEq
  }

  def binaryColumn(columnPath: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;): Column[Binary] with SupportsLtGt = {
    &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Column[Binary] (ColumnPath.get(columnPath), classOf[Binary]) with SupportsLtGt
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Both sound not the best. Please let me know if anyone has a better idea.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13064588">SPARK-20364</key>
            <summary>Parquet predicate pushdown on columns with dots return empty results</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gurwls223">Hyukjin Kwon</assignee>
                                    <reporter username="gurwls223">Hyukjin Kwon</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Apr 2017 06:05:16 +0000</created>
                <updated>Mon, 12 Dec 2022 18:11:12 +0000</updated>
                            <resolved>Thu, 18 May 2017 17:53:34 +0000</resolved>
                                    <version>2.2.0</version>
                                    <fixVersion>2.2.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="15972171" author="gurwls223" created="Tue, 18 Apr 2017 06:08:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aash&quot; class=&quot;user-hover&quot; rel=&quot;aash&quot;&gt;aash&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=robert3005&quot; class=&quot;user-hover&quot; rel=&quot;robert3005&quot;&gt;robert3005&lt;/a&gt; who found this issue in &lt;a href=&quot;https://github.com/apache/spark/pull/17667&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/17667&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lian+cheng&quot; class=&quot;user-hover&quot; rel=&quot;lian cheng&quot;&gt;lian cheng&lt;/a&gt; who might have a better idea and I think can confirm if the investigation here is correct and decide the way to resolve it.&lt;/p&gt;</comment>
                            <comment id="15972400" author="robert3005" created="Tue, 18 Apr 2017 09:36:11 +0000"  >&lt;p&gt;Looks like parquet doesn&apos;t differentiate between column named &quot;a.b&quot; and field &quot;b&quot; in column &quot;a&quot;. We could always treat them the same but that might lead to some surprises down the road. Ideally parquet would let us construct filter given exact column name or dot separated accessors. I think what &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aash&quot; class=&quot;user-hover&quot; rel=&quot;aash&quot;&gt;aash&lt;/a&gt; proposes is roughly how we should fix it with caveat that eventually this should live in parquet imho.&lt;/p&gt;</comment>
                            <comment id="15973763" author="aash" created="Tue, 18 Apr 2017 23:53:42 +0000"  >&lt;p&gt;Thanks for the investigation &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hyukjin.kwon&quot; class=&quot;user-hover&quot; rel=&quot;hyukjin.kwon&quot;&gt;hyukjin.kwon&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;The proposal you put up (sorry Rob, wasn&apos;t me) looks like a good direction.  I&apos;m not sure it will work as written though, since I&apos;d expect the IntColumn/LongColumn/etc classes from Parquet to be expected in other places, an instanceof for example.  As an alternate suggestion, I&apos;m wondering if we could call the package-protected constructors of the &lt;tt&gt;IntColumn&lt;/tt&gt; class from Spark-owned class in that package with the result from the &lt;tt&gt;ColumnPath.get()&lt;/tt&gt; method, rather than its &lt;tt&gt;.fromDotString()&lt;/tt&gt; method.  Then Spark can use its better knowledge of whether the field is a column-with-dot or a field-in-struct and assemble the ColumnPath correctly.&lt;/p&gt;

&lt;p&gt;And I do think that this should eventually live in Parquet.  Maybe there&apos;s a ticket already open there for this?&lt;/p&gt;

&lt;p&gt;Does that make sense?&lt;/p&gt;</comment>
                            <comment id="15973777" author="gurwls223" created="Wed, 19 Apr 2017 00:06:18 +0000"  >&lt;p&gt;Ah, actually, I ran some of tests already with the latter proposal (of course &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;) and took a look related code. In terms of whether it works or not, I am positive.&lt;/p&gt;

&lt;p&gt;Yes, I think that makes sense in a way but I guess that is an option too as I guess calling protected ones sounds not the best too and rather an workaround similarly. We could adds it in the JIRA as the third option.&lt;/p&gt;

&lt;p&gt;Actually, I think both this way and the way I suggested as the latter use Parquet APIs as working around. So, I guess none of both is particually better.&lt;/p&gt;

&lt;p&gt;The issue here looks to me about setting dot in the filter API. I wonder if there is no way to set this in the column path via filter API. I will investigate a bit more, try both ways and open a PR after picking up one if no one has an aswer about this for few days.&lt;/p&gt;

&lt;p&gt;I actually searched a bit ahead and I failed to find a JIRA in Parquet.&lt;/p&gt;
</comment>
                            <comment id="15974214" author="gurwls223" created="Wed, 19 Apr 2017 07:17:26 +0000"  >&lt;p&gt;Probably, let me open a PR first at least to show/check if the latter suggestion works.&lt;/p&gt;</comment>
                            <comment id="15974215" author="apachespark" created="Wed, 19 Apr 2017 07:18:04 +0000"  >&lt;p&gt;User &apos;HyukjinKwon&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/17680&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/17680&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16012422" author="apachespark" created="Tue, 16 May 2017 13:53:03 +0000"  >&lt;p&gt;User &apos;HyukjinKwon&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18000&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18000&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12908483">PARQUET-389</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 27 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3dq47:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12338275">2.2.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>