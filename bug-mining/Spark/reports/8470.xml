<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:29:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-38955] Disable lineSep option in &apos;from_csv&apos; and &apos;schema_of_csv&apos;</title>
                <link>https://issues.apache.org/jira/browse/SPARK-38955</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;I don&apos;t know how critical this is. I was doing some general testing to understand &lt;tt&gt;from_csv&lt;/tt&gt; and found that if I happen to have a &lt;tt&gt;lineSep&lt;/tt&gt; in the input data and I noticed that the next row appears to be corrupted. &lt;tt&gt;multiLine&lt;/tt&gt; does not appear to fix it. Because this is data corruption I am inclined to mark this as CRITICAL or BLOCKER, but it is an odd corner case so I m not going to set it myself.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Seq[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;](&lt;span class=&quot;code-quote&quot;&gt;&quot;1,\n2,3,4,5&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;6,7,8,9,10&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;11,12,13,14,15&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;).toDF.select(col(&lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt;), from_csv(col(&lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt;), StructType(Seq(StructField(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;, LongType), StructField(&lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;, StringType))), Map[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;,&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;]())).show()
+--------------+---------------+
|         value|from_csv(value)|
+--------------+---------------+
|   1,\n2,3,4,5|      {1, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}|
|    6,7,8,9,10|      {&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, 8}|
|11,12,13,14,15|       {11, 12}|
|          &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;|           &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;|
+--------------+---------------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Seq[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;](&lt;span class=&quot;code-quote&quot;&gt;&quot;1,:2,3,4,5&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;6,7,8,9,10&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;11,12,13,14,15&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;).toDF.select(col(&lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt;), from_csv(col(&lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt;), StructType(Seq(StructField(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;, LongType), StructField(&lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;, StringType))), Map[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;,&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;](&lt;span class=&quot;code-quote&quot;&gt;&quot;lineSep&quot;&lt;/span&gt; -&amp;gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;:&quot;&lt;/span&gt;))).show()
+--------------+---------------+
|         value|from_csv(value)|
+--------------+---------------+
|    1,:2,3,4,5|      {1, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}|
|    6,7,8,9,10|      {&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, 8}|
|11,12,13,14,15|       {11, 12}|
|          &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;|           &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;|
+--------------+---------------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Seq[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;](&lt;span class=&quot;code-quote&quot;&gt;&quot;1,\n2,3,4,5&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;6,7,8,9,10&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;11,12,13,14,15&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;).toDF.select(col(&lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt;), from_csv(col(&lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt;), StructType(Seq(StructField(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;, LongType), StructField(&lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;, StringType))), Map[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;,&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;](&lt;span class=&quot;code-quote&quot;&gt;&quot;lineSep&quot;&lt;/span&gt; -&amp;gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;:&quot;&lt;/span&gt;))).show()
+--------------+---------------+
|         value|from_csv(value)|
+--------------+---------------+
|   1,\n2,3,4,5|       {1, \n2}|
|    6,7,8,9,10|         {6, 7}|
|11,12,13,14,15|       {11, 12}|
|          &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;|           &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;|
+--------------+---------------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13440533">SPARK-38955</key>
            <summary>Disable lineSep option in &apos;from_csv&apos; and &apos;schema_of_csv&apos;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gurwls223">Hyukjin Kwon</assignee>
                                    <reporter username="revans2">Robert Joseph Evans</reporter>
                        <labels>
                            <label>correctness</label>
                    </labels>
                <created>Tue, 19 Apr 2022 21:55:47 +0000</created>
                <updated>Mon, 12 Dec 2022 18:10:59 +0000</updated>
                            <resolved>Fri, 22 Apr 2022 02:44:31 +0000</resolved>
                                    <version>3.2.0</version>
                                    <fixVersion>3.3.0</fixVersion>
                    <fixVersion>3.2.2</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17524676" author="gurwls223" created="Wed, 20 Apr 2022 02:48:48 +0000"  >&lt;p&gt;lineSep doesn&apos;t work with from_csv. We should probably ban this option within this expression.&lt;/p&gt;</comment>
                            <comment id="17524985" author="tgraves" created="Wed, 20 Apr 2022 13:14:53 +0000"  >&lt;p&gt;the from_csv docs point to the data source options which contain the lineSep so it seems like we should update documentation and then like you said don&apos;t permit it to be specified. since its a corruption seems bad, so marking as blocker to atleast get more visibility and input.&lt;/p&gt;</comment>
                            <comment id="17524990" author="gurwls223" created="Wed, 20 Apr 2022 13:22:21 +0000"  >&lt;p&gt;The main problem is that from_csv assumes each record is one record in CSV file while lineSep is whole CSV file wise option. To allow n to m relation, we should make it like a generator expression but it becomes a bit odd as other columns would have to be duplicated. For the same reason, It explicitly unsupports the option like drop-malformed mode at parseMode option.&lt;/p&gt;

&lt;p&gt;Yeah so we should throw an exception, and update the docs to explicitly note supported options. &lt;/p&gt;</comment>
                            <comment id="17524994" author="gurwls223" created="Wed, 20 Apr 2022 13:30:36 +0000"  >&lt;p&gt;For extra clarification, from_csv is an expression whereas reading CSV is a (scan) plan. So it becomes tricky when the option has an impact on the number of rows or row-wise transform.&lt;/p&gt;

&lt;p&gt;Similar stuffs were actuay already discussed with multiple committers here and there if I am not mistaken. But I&apos;m open to other suggestions.&lt;/p&gt;</comment>
                            <comment id="17525310" author="revans2" created="Wed, 20 Apr 2022 21:39:24 +0000"  >&lt;p&gt;Conceptually I am fine if we want to remove all line separators in from_csv. That is what I would expect to happen, and that is what happens with from_json.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Seq[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;](&lt;span class=&quot;code-quote&quot;&gt;&quot;{&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;: 1\n}&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;{&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;: \n3, &lt;span class=&quot;code-quote&quot;&gt;&apos;b&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;test\n3&apos;&lt;/span&gt;}&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;{&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;\n: 4}&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;).toDF.select(col(&lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt;), from_json(col(&lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt;), StructType(Seq(StructField(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;, LongType), StructField(&lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;, StringType))), Map[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;,&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;](&lt;span class=&quot;code-quote&quot;&gt;&quot;allowUnquotedControlChars&quot;&lt;/span&gt; -&amp;gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;))).show(truncate=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
+--------------------------+----------------+
|value                     |from_json(value)|
+--------------------------+----------------+
|{&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;: 1\n}                |{1, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}       |
|{&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;: \n3, &lt;span class=&quot;code-quote&quot;&gt;&apos;b&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;test\n3&apos;&lt;/span&gt;}|{3, test\n3}    |
|{&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;\n: 4}                |{4, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}       |
|&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;                      |&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;            |
+--------------------------+----------------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;But there is no way to turn off line separators in the CSV parser.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/uniVocity/univocity-parsers/blob/7e7d1b3c0a3dceaed4a8413875eb1500f2a028ec/src/main/java/com/univocity/parsers/common/Format.java#L54-L65&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/uniVocity/univocity-parsers/blob/7e7d1b3c0a3dceaed4a8413875eb1500f2a028ec/src/main/java/com/univocity/parsers/common/Format.java#L54-L65&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;So implementing the proposed fix may be difficult.  Replacing the default separator &apos;\n&apos; with another like &apos;\0&apos; might be okay, but I do know people with &apos;\0&apos; in their data so it is not truly fixing the problem.&lt;/p&gt;

&lt;p&gt;An alternative might be to clear the state of the CSV parser after each row of input. i.e. read all of the tokens out of the parser after each row.  The &apos;\n&apos; is still parsed so the output of a single row is still not ideal if it has the line separator in it, but at least it does not corrupt the output of a good row after it.&lt;/p&gt;</comment>
                            <comment id="17525395" author="gurwls223" created="Thu, 21 Apr 2022 03:08:23 +0000"  >&lt;p&gt;Oh okay, I got what you mean.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
1,\n2,3,4,5|      {1, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;will actually have to be:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
1,\n2,3,4,5|      {1, \n2}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17525399" author="gurwls223" created="Thu, 21 Apr 2022 03:16:52 +0000"  >&lt;p&gt;Yeah, I think &lt;tt&gt;lineSep&lt;/tt&gt; shouldn&apos;t respected here. Let me take a quick look.&lt;/p&gt;</comment>
                            <comment id="17525421" author="apachespark" created="Thu, 21 Apr 2022 05:16:02 +0000"  >&lt;p&gt;User &apos;HyukjinKwon&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/36294&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/36294&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17526170" author="gurwls223" created="Fri, 22 Apr 2022 02:44:31 +0000"  >&lt;p&gt;Issue resolved by pull request 36294&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/36294&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/36294&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 29 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z11lzc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>