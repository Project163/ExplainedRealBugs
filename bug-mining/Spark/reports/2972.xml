<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:36:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-12617] socket descriptor leak killing streaming app</title>
                <link>https://issues.apache.org/jira/browse/SPARK-12617</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;There is a socket descriptor leakage in a pyspark streaming app when configured with batch interval more then 30 seconds. This is due to default timeout in py4j JavaGateway which (half-)closes CallbackConnection after 30 seconds of inactivity and creates new one next time. That connection doesn&apos;t get closed on the python CallbackServer side and keep piling up until it eventually blocks new connections.&lt;/p&gt;

&lt;h2&gt;&lt;a name=&quot;Stepstoreproduce%3A&quot;&gt;&lt;/a&gt;Steps to reproduce:&lt;/h2&gt;
&lt;ul&gt;
	&lt;li&gt;Submit attached &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12780283/12780283_bug.py&quot; title=&quot;bug.py attached to SPARK-12617&quot;&gt;bug.py&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; to spark&lt;/li&gt;
	&lt;li&gt;Watch &lt;tt&gt;/tmp/bug.log&lt;/tt&gt; to see the increasing total number of py4j callback connections of which 0 will ever be closed
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[BUG] py4j callback server port: 51282
[BUG] py4j CB 0/0 closed
...
[BUG] py4j CB 0/123 closed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;You can confirm the reality by using lsof on the pyspark driver process:
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ sudo lsof -p 39770 | grep CLOSE_WAIT | grep :51282
python2.6 39770  das   94u  IPv4 138824906      0t0       TCP localhost.localdomain:51282-&amp;gt;localhost.localdomain:60419 (CLOSE_WAIT)
python2.6 39770  das   95u  IPv4 138867747      0t0       TCP localhost.localdomain:51282-&amp;gt;localhost.localdomain:60745 (CLOSE_WAIT)
python2.6 39770  das   96u  IPv4 138831829      0t0       TCP localhost.localdomain:51282-&amp;gt;localhost.localdomain:32849 (CLOSE_WAIT)
python2.6 39770  das   97u  IPv4 138890524      0t0       TCP localhost.localdomain:51282-&amp;gt;localhost.localdomain:33184 (CLOSE_WAIT)
python2.6 39770  das   98u  IPv4 138860190      0t0       TCP localhost.localdomain:51282-&amp;gt;localhost.localdomain:33512 (CLOSE_WAIT)
python2.6 39770  das   99u  IPv4 138860439      0t0       TCP localhost.localdomain:51282-&amp;gt;localhost.localdomain:33854 (CLOSE_WAIT)
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;If you leave it running for long enough the CallbackServer will eventually become unable to accept new connections from the gateway and the app will crash:
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;16/01/02 05:12:07 ERROR scheduler.JobScheduler: Error generating jobs &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; time 1451711400000 ms
py4j.Py4JException: Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; obtaining a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; communication channel
...
Caused by: java.net.ConnectException: Connection timed out
        at java.net.PlainSocketImpl.socketConnect(Native Method)
        at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:350)
        at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:206)
        at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:188)
        at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)
        at java.net.Socket.connect(Socket.java:589)
        at java.net.Socket.connect(Socket.java:538)
        at java.net.Socket.&amp;lt;init&amp;gt;(Socket.java:434)
        at java.net.Socket.&amp;lt;init&amp;gt;(Socket.java:244)
        at py4j.CallbackConnection.start(CallbackConnection.java:104)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment>&lt;p&gt;pyspark (python 2.6)&lt;/p&gt;</environment>
        <key id="12926911">SPARK-12617</key>
            <summary>socket descriptor leak killing streaming app</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zsxwing">Shixiong Zhu</assignee>
                                    <reporter username="antonymayi">Antony Mayi</reporter>
                        <labels>
                    </labels>
                <created>Mon, 4 Jan 2016 09:02:19 +0000</created>
                <updated>Wed, 6 Jan 2016 20:02:27 +0000</updated>
                            <resolved>Tue, 5 Jan 2016 21:11:33 +0000</resolved>
                                    <version>1.5.2</version>
                    <version>1.6.0</version>
                                    <fixVersion>1.5.3</fixVersion>
                    <fixVersion>1.6.1</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>DStreams</component>
                    <component>PySpark</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15081465" author="zsxwing" created="Mon, 4 Jan 2016 17:52:31 +0000"  >&lt;p&gt;Thanks for reporting it. I will take a look.&lt;/p&gt;</comment>
                            <comment id="15081594" author="zsxwing" created="Mon, 4 Jan 2016 19:05:13 +0000"  >&lt;p&gt;I created an issue in Py4J repo: &lt;a href=&quot;https://github.com/bartdag/py4j/issues/187&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/bartdag/py4j/issues/187&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;A workaround in Spark is scanning CallbackConnection every 30 seconds and closing them manually if they are in CLOSE_WAIT.&lt;/p&gt;</comment>
                            <comment id="15081625" author="zsxwing" created="Mon, 4 Jan 2016 19:21:36 +0000"  >&lt;p&gt;Submitted a PR for Py4j: &lt;a href=&quot;https://github.com/bartdag/py4j/pull/188&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/bartdag/py4j/pull/188&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;m also working a workraound in Spark side.&lt;/p&gt;</comment>
                            <comment id="15081872" author="apachespark" created="Mon, 4 Jan 2016 21:46:05 +0000"  >&lt;p&gt;User &apos;zsxwing&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/10579&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/10579&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15083798" author="davies" created="Tue, 5 Jan 2016 21:11:33 +0000"  >&lt;p&gt;Issue resolved by pull request 10579&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/10579&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/10579&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15086008" author="apachespark" created="Wed, 6 Jan 2016 18:29:03 +0000"  >&lt;p&gt;User &apos;zsxwing&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/10621&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/10621&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12927329">SPARK-12652</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12780283" name="bug.py" size="1001" author="antonymayi" created="Mon, 4 Jan 2016 09:02:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 45 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2qqrr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>