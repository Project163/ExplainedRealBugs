<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:29:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-38684] Stream-stream outer join has a possible correctness issue due to weakly read consistent on outer iterators</title>
                <link>https://issues.apache.org/jira/browse/SPARK-38684</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;We figured out stream-stream join has the same issue with &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-38320&quot; title=&quot;(flat)MapGroupsWithState can timeout groups which just received inputs in the same microbatch&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-38320&quot;&gt;&lt;del&gt;SPARK-38320&lt;/del&gt;&lt;/a&gt; on the appended iterators. Since the root cause is same as &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-38320&quot; title=&quot;(flat)MapGroupsWithState can timeout groups which just received inputs in the same microbatch&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-38320&quot;&gt;&lt;del&gt;SPARK-38320&lt;/del&gt;&lt;/a&gt;, this is only reproducible with RocksDB state store provider, but even with HDFS backed state store provider, it is not guaranteed by interface contract hence may depend on the JVM vendor, version, etc.&lt;/p&gt;

&lt;p&gt;I can easily construct the scenario of &#8220;data loss&#8221; in state store.&lt;/p&gt;

&lt;p&gt;Condition follows:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Use stream-stream time interval outer join&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;left outer join has an issue on left side, right outer join has an issue on right side, full outer join has an issue on both sides&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;At batch N, produce row(s) on the problematic side which are non-late&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;At the same batch (batch N), some row(s) on the problematic side should be evicted by watermark condition&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;When the condition is fulfilled, out of sync happens with keyToNumValues between state and the iterator in evict phase. If eviction of the row happens for the grouping key (updating keyToNumValues), the eviction phase &#8220;overwrites&#8221; keyToNumValues in the state as the value it calculates.&lt;/p&gt;

&lt;p&gt;Given that the eviction phase &#8220;do not know&#8221; about the new rows (keyToNumValues is out of sync), effectively discarding all rows from the state being added in the batch N.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13436379">SPARK-38684</key>
            <summary>Stream-stream outer join has a possible correctness issue due to weakly read consistent on outer iterators</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kabhwan">Jungtaek Lim</assignee>
                                    <reporter username="kabhwan">Jungtaek Lim</reporter>
                        <labels>
                            <label>correctness</label>
                            <label>releasenotes</label>
                    </labels>
                <created>Tue, 29 Mar 2022 09:22:48 +0000</created>
                <updated>Tue, 5 Apr 2022 06:29:41 +0000</updated>
                            <resolved>Fri, 1 Apr 2022 10:09:09 +0000</resolved>
                                    <version>3.2.1</version>
                    <version>3.3.0</version>
                                    <fixVersion>3.3.0</fixVersion>
                    <fixVersion>3.2.2</fixVersion>
                                    <component>Structured Streaming</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                                                            <comments>
                            <comment id="17513949" author="kabhwan" created="Tue, 29 Mar 2022 09:23:04 +0000"  >&lt;p&gt;Will submit a PR sooner.&lt;/p&gt;</comment>
                            <comment id="17513994" author="apachespark" created="Tue, 29 Mar 2022 10:47:49 +0000"  >&lt;p&gt;User &apos;HeartSaVioR&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/36002&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/36002&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17515845" author="kabhwan" created="Fri, 1 Apr 2022 10:09:09 +0000"  >&lt;p&gt;Issue resolved by pull request 36002&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/36002&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/36002&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                            <subtask id="13437755">SPARK-38787</subtask>
                            <subtask id="13438231">SPARK-38809</subtask>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 32 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z10x9c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>