<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:33:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-8386] DataFrame and JDBC regression</title>
                <link>https://issues.apache.org/jira/browse/SPARK-8386</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;I have an ETL app that appends to a JDBC table new results found at each run.  In 1.3.1 I did this:&lt;/p&gt;

&lt;p&gt;testResultsDF.insertIntoJDBC(CONNECTION_URL, TABLE_NAME, false);&lt;/p&gt;

&lt;p&gt;When I do this now in 1.4 it complains that the &quot;object&quot; &apos;TABLE_NAME&apos; already exists. I get this even if I switch the overwrite to true.  I also tried this now:&lt;/p&gt;

&lt;p&gt;testResultsDF.write().mode(SaveMode.Append).jdbc(CONNECTION_URL, TABLE_NAME, connectionProperties);&lt;/p&gt;

&lt;p&gt;getting the same error. It works running the first time creating the new table and adding data successfully. But, running it a second time it (the jdbc driver) will tell me that the table already exists. Even SaveMode.Overwrite will give me the same error. &lt;/p&gt;</description>
                <environment>&lt;p&gt;RHEL 7.1&lt;/p&gt;</environment>
        <key id="12838019">SPARK-8386</key>
            <summary>DataFrame and JDBC regression</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="huaxingao">Huaxin Gao</assignee>
                                    <reporter username="phaumer">Peter Haumer</reporter>
                        <labels>
                    </labels>
                <created>Tue, 16 Jun 2015 02:35:35 +0000</created>
                <updated>Wed, 14 Oct 2015 19:32:30 +0000</updated>
                            <resolved>Wed, 14 Oct 2015 19:32:30 +0000</resolved>
                                    <version>1.4.0</version>
                                    <fixVersion>1.4.2</fixVersion>
                    <fixVersion>1.5.2</fixVersion>
                    <fixVersion>1.6.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14724756" author="vishal b" created="Tue, 1 Sep 2015 04:05:07 +0000"  >&lt;p&gt;I just ran into the same issue today. This should be addressed and looks like a sever limitation for JDBC writers.&lt;/p&gt;</comment>
                            <comment id="14902042" author="rxin" created="Tue, 22 Sep 2015 06:34:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=viirya&quot; class=&quot;user-hover&quot; rel=&quot;viirya&quot;&gt;viirya&lt;/a&gt; do you have time to take a look?&lt;/p&gt;</comment>
                            <comment id="14902294" author="viirya" created="Tue, 22 Sep 2015 09:29:41 +0000"  >&lt;p&gt;OK. I will investigate this.&lt;/p&gt;</comment>
                            <comment id="14905940" author="viirya" created="Thu, 24 Sep 2015 07:27:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=phaumer&quot; class=&quot;user-hover&quot; rel=&quot;phaumer&quot;&gt;phaumer&lt;/a&gt; I can&apos;t reproduce this problem. Can you give me a code snippet that causes this problem? Thanks.&lt;/p&gt;</comment>
                            <comment id="14947736" author="huaxing" created="Wed, 7 Oct 2015 22:45:15 +0000"  >&lt;p&gt;I looked the code, it has this&lt;br/&gt;
  @deprecated(&quot;Use write.jdbc()&quot;, &quot;1.4.0&quot;)&lt;br/&gt;
  def insertIntoJDBC(url: String, table: String, overwrite: Boolean): Unit = &lt;/p&gt;
{
    val w = if (overwrite) write.mode(SaveMode.Overwrite) else write
    w.jdbc(url, table, new Properties)
  }
&lt;p&gt;if overwrite is false, it doesn&apos;t set and the default is SaveMode.ErrorIfExists.&lt;br/&gt;
It seems to me that if the overwrite is false, the mode should be set to be Append&lt;/p&gt;

&lt;p&gt;  def insertIntoJDBC(url: String, table: String, overwrite: Boolean): Unit = &lt;/p&gt;
{
    val w = if (overwrite) write.mode(SaveMode.Overwrite) else write.mode(SaveMode.Append)
    w.jdbc(url, table, new Properties)
  }
</comment>
                            <comment id="14947749" author="huaxing" created="Wed, 7 Oct 2015 22:52:35 +0000"  >&lt;p&gt;If the above fix is correct, can I have a pull request to check in the change?&lt;br/&gt;
I am new to spark and this is the very first gira I looked.  I am not so familiar with the process yet. &lt;/p&gt;

&lt;p&gt;I can only recreate the problem for testResultsDF.insertIntoJDBC(CONNECTION_URL, TABLE_NAME, false);&lt;br/&gt;
If it sets to true, it works OK for me.&lt;br/&gt;
Also, testResultsDF.write().mode(SaveMode.Append).jdbc(CONNECTION_URL, TABLE_NAME, connectionProperties);&lt;br/&gt;
works OK for me. &lt;/p&gt;</comment>
                            <comment id="14947775" author="huaxing" created="Wed, 7 Oct 2015 23:08:58 +0000"  >&lt;p&gt;Actually I can also recreate the problem in the other two cases.  The reason I didn&apos;t recreate it earlier is that I already fixed the tableExists method in my code.  In tableExists, it checks if table exists using SELECT 1 FROM $table LIMIT 1. This is not working for all databases.  For the database that doesn&apos;t support LIMIT 1, it will return false and the jdbc/insertIntoJDBC will try to create table again and will get table already exists error. I think this is what Visha got. &lt;/p&gt;

&lt;p&gt;I searched Gira, and there is already a problem opened for the LIMIT 1 in tableexists, so I will not fix this problem.  I will only fix the saveMode problem in my first comment. &lt;/p&gt;


</comment>
                            <comment id="14947815" author="phaumer" created="Wed, 7 Oct 2015 23:48:12 +0000"  >&lt;p&gt;Huaxin Gao, sorry for not replying earlier. It slipped through the cracks. &lt;/p&gt;

&lt;p&gt;I had stopped using the Spark jdbc framework completely because of this bug and implemented my own as I need to support DB2, Derby, SQL Server, as well as Oracle and ran into this issue with SQL Server and DB2. DB2&apos;s Limit is quite different: &lt;a href=&quot;http://www-01.ibm.com/support/knowledgecenter/SSEPGG_10.5.0/com.ibm.db2.luw.sql.ref.doc/doc/r0059212.html?lang=en&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www-01.ibm.com/support/knowledgecenter/SSEPGG_10.5.0/com.ibm.db2.luw.sql.ref.doc/doc/r0059212.html?lang=en&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;However, I ended up using the jdbc meta-data, which in fact does not perform too well on all DBMS, though; and it might be better to provide different queries for each DBMS here:&lt;/p&gt;

&lt;p&gt;final ResultSet resultSet = connection.getMetaData().getTables(null,schemaName, tableName, null);&lt;br/&gt;
if (resultSet.next()) {&lt;br/&gt;
     return true;&lt;br/&gt;
}&lt;/p&gt;</comment>
                            <comment id="14947871" author="huaxing" created="Thu, 8 Oct 2015 00:29:26 +0000"  >&lt;p&gt;The TableExists bug is already resolved in Jira 9078&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-9078?jql=project%20%3D%20SPARK%20AND%20text%20~%20DB2&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-9078?jql=project%20%3D%20SPARK%20AND%20text%20~%20DB2&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I will have a pull request to fix the SaveMode problem &lt;/p&gt;</comment>
                            <comment id="14949727" author="apachespark" created="Fri, 9 Oct 2015 01:29:03 +0000"  >&lt;p&gt;User &apos;huaxingao&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/9042&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/9042&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 6 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2g2u7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>