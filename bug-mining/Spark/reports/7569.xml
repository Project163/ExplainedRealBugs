<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:20:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-33259] Joining 3 streams results in incorrect output</title>
                <link>https://issues.apache.org/jira/browse/SPARK-33259</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;I encountered an issue with Structured Streaming when doing a ((A LEFT JOIN B) INNER JOIN C) operation. Below you can see example code I &lt;a href=&quot;https://stackoverflow.com/questions/64503539/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;posted on Stackoverflow&lt;/a&gt;...&lt;/p&gt;

&lt;p&gt;I created a minimal example of &quot;sessions&quot;, that have &quot;start&quot; and &quot;end&quot; events and optionally some &quot;metadata&quot;.&lt;/p&gt;

&lt;p&gt;The script generates two outputs: &lt;tt&gt;sessionStartsWithMetadata&lt;/tt&gt; result from &quot;start&quot; events that are left-joined with the &quot;metadata&quot; events, based on &lt;tt&gt;sessionId&lt;/tt&gt;. A &quot;left join&quot; is used, since we like to get an output event even when no corresponding metadata exists.&lt;/p&gt;

&lt;p&gt;Additionally a DataFrame &lt;tt&gt;endedSessionsWithMetadata&lt;/tt&gt; is created by joining &quot;end&quot; events to the previously created DataFrame. Here an &quot;inner join&quot; is used, since we only want some output when a session has ended for sure.&lt;/p&gt;

&lt;p&gt;This code can be executed in &lt;tt&gt;spark-shell&lt;/tt&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-scala&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.sql.Timestamp
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.sql.execution.streaming.{MemoryStream, StreamingQueryWrapper}
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.sql.streaming.StreamingQuery
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.sql.{DataFrame, SQLContext}
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.sql.functions.{col, expr, lit}

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; spark.implicits._
&lt;span class=&quot;code-keyword&quot;&gt;implicit&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; sqlContext: SQLContext = spark.sqlContext

&lt;span class=&quot;code-comment&quot;&gt;// Main data processing, regardless whether batch or stream processing
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; process(
    sessionStartEvents: DataFrame,
    sessionOptionalMetadataEvents: DataFrame,
    sessionEndEvents: DataFrame
): (DataFrame, DataFrame) = {
  &lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; sessionStartsWithMetadata: DataFrame = sessionStartEvents
    .join(
      sessionOptionalMetadataEvents,
      sessionStartEvents(&lt;span class=&quot;code-quote&quot;&gt;&quot;sessionId&quot;&lt;/span&gt;) === sessionOptionalMetadataEvents(&lt;span class=&quot;code-quote&quot;&gt;&quot;sessionId&quot;&lt;/span&gt;) &amp;amp;&amp;amp;
        sessionStartEvents(&lt;span class=&quot;code-quote&quot;&gt;&quot;sessionStartTimestamp&quot;&lt;/span&gt;).between(
          sessionOptionalMetadataEvents(&lt;span class=&quot;code-quote&quot;&gt;&quot;sessionOptionalMetadataTimestamp&quot;&lt;/span&gt;).minus(expr(s&lt;span class=&quot;code-quote&quot;&gt;&quot;INTERVAL 1 seconds&quot;&lt;/span&gt;)),
          sessionOptionalMetadataEvents(&lt;span class=&quot;code-quote&quot;&gt;&quot;sessionOptionalMetadataTimestamp&quot;&lt;/span&gt;).plus(expr(s&lt;span class=&quot;code-quote&quot;&gt;&quot;INTERVAL 1 seconds&quot;&lt;/span&gt;))
        ),
      &lt;span class=&quot;code-quote&quot;&gt;&quot;left&quot;&lt;/span&gt; &lt;span class=&quot;code-comment&quot;&gt;// metadata is optional
&lt;/span&gt;    )
    .select(
      sessionStartEvents(&lt;span class=&quot;code-quote&quot;&gt;&quot;sessionId&quot;&lt;/span&gt;),
      sessionStartEvents(&lt;span class=&quot;code-quote&quot;&gt;&quot;sessionStartTimestamp&quot;&lt;/span&gt;),
      sessionOptionalMetadataEvents(&lt;span class=&quot;code-quote&quot;&gt;&quot;sessionOptionalMetadataTimestamp&quot;&lt;/span&gt;)
    )

  &lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; endedSessionsWithMetadata = sessionStartsWithMetadata.join(
    sessionEndEvents,
    sessionStartsWithMetadata(&lt;span class=&quot;code-quote&quot;&gt;&quot;sessionId&quot;&lt;/span&gt;) === sessionEndEvents(&lt;span class=&quot;code-quote&quot;&gt;&quot;sessionId&quot;&lt;/span&gt;) &amp;amp;&amp;amp;
      sessionStartsWithMetadata(&lt;span class=&quot;code-quote&quot;&gt;&quot;sessionStartTimestamp&quot;&lt;/span&gt;).between(
        sessionEndEvents(&lt;span class=&quot;code-quote&quot;&gt;&quot;sessionEndTimestamp&quot;&lt;/span&gt;).minus(expr(s&lt;span class=&quot;code-quote&quot;&gt;&quot;INTERVAL 10 seconds&quot;&lt;/span&gt;)),
        sessionEndEvents(&lt;span class=&quot;code-quote&quot;&gt;&quot;sessionEndTimestamp&quot;&lt;/span&gt;)
      )
  )

  (sessionStartsWithMetadata, endedSessionsWithMetadata)
}

&lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; streamProcessing(
    sessionStartData: Seq[(Timestamp, Int)],
    sessionOptionalMetadata: Seq[(Timestamp, Int)],
    sessionEndData: Seq[(Timestamp, Int)]
): (StreamingQuery, StreamingQuery) = {

  &lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; sessionStartEventsStream: MemoryStream[(Timestamp, Int)] = MemoryStream[(Timestamp, Int)]
  sessionStartEventsStream.addData(sessionStartData)

  &lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; sessionStartEvents: DataFrame = sessionStartEventsStream
    .toDS()
    .toDF(&lt;span class=&quot;code-quote&quot;&gt;&quot;sessionStartTimestamp&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;sessionId&quot;&lt;/span&gt;)
    .withWatermark(&lt;span class=&quot;code-quote&quot;&gt;&quot;sessionStartTimestamp&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;1 second&quot;&lt;/span&gt;)

  &lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; sessionOptionalMetadataEventsStream: MemoryStream[(Timestamp, Int)] = MemoryStream[(Timestamp, Int)]
  sessionOptionalMetadataEventsStream.addData(sessionOptionalMetadata)

  &lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; sessionOptionalMetadataEvents: DataFrame = sessionOptionalMetadataEventsStream
    .toDS()
    .toDF(&lt;span class=&quot;code-quote&quot;&gt;&quot;sessionOptionalMetadataTimestamp&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;sessionId&quot;&lt;/span&gt;)
    .withWatermark(&lt;span class=&quot;code-quote&quot;&gt;&quot;sessionOptionalMetadataTimestamp&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;1 second&quot;&lt;/span&gt;)

  &lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; sessionEndEventsStream: MemoryStream[(Timestamp, Int)] = MemoryStream[(Timestamp, Int)]
  sessionEndEventsStream.addData(sessionEndData)

  &lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; sessionEndEvents: DataFrame = sessionEndEventsStream
    .toDS()
    .toDF(&lt;span class=&quot;code-quote&quot;&gt;&quot;sessionEndTimestamp&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;sessionId&quot;&lt;/span&gt;)
    .withWatermark(&lt;span class=&quot;code-quote&quot;&gt;&quot;sessionEndTimestamp&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;1 second&quot;&lt;/span&gt;)

  &lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; (sessionStartsWithMetadata, endedSessionsWithMetadata) =
    process(sessionStartEvents, sessionOptionalMetadataEvents, sessionEndEvents)

  &lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; sessionStartsWithMetadataQuery = sessionStartsWithMetadata
    .select(lit(&lt;span class=&quot;code-quote&quot;&gt;&quot;sessionStartsWithMetadata&quot;&lt;/span&gt;), col(&lt;span class=&quot;code-quote&quot;&gt;&quot;*&quot;&lt;/span&gt;)) &lt;span class=&quot;code-comment&quot;&gt;// Add label to see which query&apos;s output it is
&lt;/span&gt;    .writeStream
    .outputMode(&lt;span class=&quot;code-quote&quot;&gt;&quot;append&quot;&lt;/span&gt;)
    .format(&lt;span class=&quot;code-quote&quot;&gt;&quot;console&quot;&lt;/span&gt;)
    .option(&lt;span class=&quot;code-quote&quot;&gt;&quot;truncate&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;)
    .option(&lt;span class=&quot;code-quote&quot;&gt;&quot;numRows&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;1000&quot;&lt;/span&gt;)
    .start()

  &lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; endedSessionsWithMetadataQuery = endedSessionsWithMetadata
    .select(lit(&lt;span class=&quot;code-quote&quot;&gt;&quot;endedSessionsWithMetadata&quot;&lt;/span&gt;), col(&lt;span class=&quot;code-quote&quot;&gt;&quot;*&quot;&lt;/span&gt;)) &lt;span class=&quot;code-comment&quot;&gt;// Add label to see which query&apos;s output it is
&lt;/span&gt;    .writeStream
    .outputMode(&lt;span class=&quot;code-quote&quot;&gt;&quot;append&quot;&lt;/span&gt;)
    .format(&lt;span class=&quot;code-quote&quot;&gt;&quot;console&quot;&lt;/span&gt;)
    .option(&lt;span class=&quot;code-quote&quot;&gt;&quot;truncate&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;)
    .option(&lt;span class=&quot;code-quote&quot;&gt;&quot;numRows&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;1000&quot;&lt;/span&gt;)
    .start()

  (sessionStartsWithMetadataQuery, endedSessionsWithMetadataQuery)
}

&lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; batchProcessing(
    sessionStartData: Seq[(Timestamp, Int)],
    sessionOptionalMetadata: Seq[(Timestamp, Int)],
    sessionEndData: Seq[(Timestamp, Int)]
): Unit = {

  &lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; sessionStartEvents = spark.createDataset(sessionStartData).toDF(&lt;span class=&quot;code-quote&quot;&gt;&quot;sessionStartTimestamp&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;sessionId&quot;&lt;/span&gt;)
  &lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; sessionOptionalMetadataEvents = spark.createDataset(sessionOptionalMetadata).toDF(&lt;span class=&quot;code-quote&quot;&gt;&quot;sessionOptionalMetadataTimestamp&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;sessionId&quot;&lt;/span&gt;)
  &lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; sessionEndEvents = spark.createDataset(sessionEndData).toDF(&lt;span class=&quot;code-quote&quot;&gt;&quot;sessionEndTimestamp&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;sessionId&quot;&lt;/span&gt;)

  &lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; (sessionStartsWithMetadata, endedSessionsWithMetadata) =
    process(sessionStartEvents, sessionOptionalMetadataEvents, sessionEndEvents)

  println(&lt;span class=&quot;code-quote&quot;&gt;&quot;sessionStartsWithMetadata&quot;&lt;/span&gt;)
  sessionStartsWithMetadata.show(100, truncate = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)

  println(&lt;span class=&quot;code-quote&quot;&gt;&quot;endedSessionsWithMetadata&quot;&lt;/span&gt;)
  endedSessionsWithMetadata.show(100, truncate = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
}


&lt;span class=&quot;code-comment&quot;&gt;// Data is represented as tuples of (eventTime, sessionId)...
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; sessionStartData = Vector(
  (&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Timestamp(1), 0),
  (&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Timestamp(2000), 1),
  (&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Timestamp(2000), 2),
  (&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Timestamp(20000), 10)
)

&lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; sessionOptionalMetadata = Vector(
  (&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Timestamp(1), 0),
  &lt;span class=&quot;code-comment&quot;&gt;// session `1` has no metadata
&lt;/span&gt;  (&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Timestamp(2000), 2),
  (&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Timestamp(20000), 10)
)

&lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; sessionEndData = Vector(
  (&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Timestamp(10000), 0),
  (&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Timestamp(11000), 1),
  (&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Timestamp(12000), 2),
  (&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Timestamp(30000), 10)
)

batchProcessing(sessionStartData, sessionOptionalMetadata, sessionEndData)

&lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; (sessionStartsWithMetadataQuery, endedSessionsWithMetadataQuery) =
  streamProcessing(sessionStartData, sessionOptionalMetadata, sessionEndData)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In the example session with ID &lt;tt&gt;1&lt;/tt&gt; has no metadata, so the respective metadata column is &lt;tt&gt;null&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;The main functionality of joining the data is implemented in &lt;tt&gt;def process(&#8230;)&lt;/tt&gt;, which is called using both batch data and stream data.&lt;/p&gt;

&lt;p&gt;In the batch version the output is as expected:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;sessionStartsWithMetadata
+---------+-----------------------+--------------------------------+
|sessionId|sessionStartTimestamp  |sessionOptionalMetadataTimestamp|
+---------+-----------------------+--------------------------------+
|0        |1970-01-01 01:00:00.001|1970-01-01 01:00:00.001         |
|1        |1970-01-01 01:00:02    |null                            | &#8592; has no metadata &#10004;
|2        |1970-01-01 01:00:02    |1970-01-01 01:00:02             |
|10       |1970-01-01 01:00:20    |1970-01-01 01:00:20             |
+---------+-----------------------+--------------------------------+

endedSessionsWithMetadata
+---------+-----------------------+--------------------------------+-------------------+---------+
|sessionId|sessionStartTimestamp  |sessionOptionalMetadataTimestamp|sessionEndTimestamp|sessionId|
+---------+-----------------------+--------------------------------+-------------------+---------+
|0        |1970-01-01 01:00:00.001|1970-01-01 01:00:00.001         |1970-01-01 01:00:10|0        |
|1        |1970-01-01 01:00:02    |null                            |1970-01-01 01:00:11|1        |  &#8592; has no metadata &#10004;
|2        |1970-01-01 01:00:02    |1970-01-01 01:00:02             |1970-01-01 01:00:12|2        |
|10       |1970-01-01 01:00:20    |1970-01-01 01:00:20             |1970-01-01 01:00:30|10       |
+---------+-----------------------+--------------------------------+-------------------+---------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;But when the same processing is run as stream processing the output of &lt;tt&gt;endedSessionsWithMetadata&lt;/tt&gt; does not contain the entry of session &lt;tt&gt;1&lt;/tt&gt; that has no metadata:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;-------------------------------------------
Batch: 0 (&quot;start event&quot;)
-------------------------------------------
+-------------------------+---------+-----------------------+--------------------------------+
|sessionStartsWithMetadata|sessionId|sessionStartTimestamp  |sessionOptionalMetadataTimestamp|
+-------------------------+---------+-----------------------+--------------------------------+
|sessionStartsWithMetadata|10       |1970-01-01 01:00:20    |1970-01-01 01:00:20             |
|sessionStartsWithMetadata|2        |1970-01-01 01:00:02    |1970-01-01 01:00:02             |
|sessionStartsWithMetadata|0        |1970-01-01 01:00:00.001|1970-01-01 01:00:00.001         |
+-------------------------+---------+-----------------------+--------------------------------+

-------------------------------------------
Batch: 0 (&quot;end event&quot;)
-------------------------------------------
+-------------------------+---------+-----------------------+--------------------------------+-------------------+---------+
|endedSessionsWithMetadata|sessionId|sessionStartTimestamp  |sessionOptionalMetadataTimestamp|sessionEndTimestamp|sessionId|
+-------------------------+---------+-----------------------+--------------------------------+-------------------+---------+
|endedSessionsWithMetadata|10       |1970-01-01 01:00:20    |1970-01-01 01:00:20             |1970-01-01 01:00:30|10       |
|endedSessionsWithMetadata|2        |1970-01-01 01:00:02    |1970-01-01 01:00:02             |1970-01-01 01:00:12|2        |
|endedSessionsWithMetadata|0        |1970-01-01 01:00:00.001|1970-01-01 01:00:00.001         |1970-01-01 01:00:10|0        |
+-------------------------+---------+-----------------------+--------------------------------+-------------------+---------+

-------------------------------------------
Batch: 1 (&quot;start event&quot;)
-------------------------------------------
+-------------------------+---------+---------------------+--------------------------------+
|sessionStartsWithMetadata|sessionId|sessionStartTimestamp|sessionOptionalMetadataTimestamp|
+-------------------------+---------+---------------------+--------------------------------+
|sessionStartsWithMetadata|1        |1970-01-01 01:00:02  |null                            | &#8592; has no metadata &#10004;
+-------------------------+---------+---------------------+--------------------------------+

-------------------------------------------
Batch: 1 (&quot;end event&quot;)
-------------------------------------------
+-------------------------+---------+---------------------+--------------------------------+-------------------+---------+
|endedSessionsWithMetadata|sessionId|sessionStartTimestamp|sessionOptionalMetadataTimestamp|sessionEndTimestamp|sessionId|
+-------------------------+---------+---------------------+--------------------------------+-------------------+---------+
+-------------------------+---------+---------------------+--------------------------------+-------------------+---------+
  &#8627; &#10008; here I would have expected a line with sessionId=1, that has &quot;start&quot; and &quot;end&quot; information, but no &quot;metadata&quot; &#10008;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In a response it was suggested the issue looks related to&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kabhwan&quot; class=&quot;user-hover&quot; rel=&quot;kabhwan&quot;&gt;kabhwan&lt;/a&gt;&apos;s &lt;a href=&quot;http://apache-spark-developers-list.1001551.n3.nabble.com/correctness-issue-on-chained-streaming-streaming-join-td27358.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;mailing list post&lt;/a&gt;, but since I couldn&apos;t find a ticket here tracking the above mentioned issue, I&apos;m creating this one.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13337383">SPARK-33259</key>
            <summary>Joining 3 streams results in incorrect output</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="viirya">L. C. Hsieh</assignee>
                                    <reporter username="hiddenbit">Michael</reporter>
                        <labels>
                            <label>correctness</label>
                    </labels>
                <created>Tue, 27 Oct 2020 09:49:46 +0000</created>
                <updated>Thu, 12 Nov 2020 23:32:31 +0000</updated>
                            <resolved>Thu, 12 Nov 2020 23:32:31 +0000</resolved>
                                    <version>3.0.1</version>
                                    <fixVersion>3.1.0</fixVersion>
                                    <component>Structured Streaming</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="17221409" author="kabhwan" created="Tue, 27 Oct 2020 13:05:10 +0000"  >&lt;p&gt;As you already figured out, this is a known limitation, and at least for now we ended up with documenting such limitation to compensate.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://spark.apache.org/docs/latest/structured-streaming-programming-guide.html#limitation-of-global-watermark&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://spark.apache.org/docs/latest/structured-streaming-programming-guide.html#limitation-of-global-watermark&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This requires major change on the concept of watermark, so without huge demand on this it may be unlikely to be addressed.&lt;/p&gt;</comment>
                            <comment id="17221425" author="hiddenbit" created="Tue, 27 Oct 2020 13:21:43 +0000"  >&lt;p&gt;Oh I see, thanks for pointing to the section in the documentation!&lt;/p&gt;

&lt;p&gt;For our team&apos;s use case having this working would definitely be very useful, as we do a lot of such data joins...&lt;/p&gt;</comment>
                            <comment id="17223779" author="dongjoon" created="Fri, 30 Oct 2020 17:08:24 +0000"  >&lt;p&gt;Is there a way to block this at the analysis stage instead of giving an incorrect output?&lt;/p&gt;

&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=viirya&quot; class=&quot;user-hover&quot; rel=&quot;viirya&quot;&gt;viirya&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dbtsai&quot; class=&quot;user-hover&quot; rel=&quot;dbtsai&quot;&gt;dbtsai&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17223924" author="apachespark" created="Fri, 30 Oct 2020 21:57:09 +0000"  >&lt;p&gt;User &apos;viirya&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/30210&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/30210&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17223925" author="apachespark" created="Fri, 30 Oct 2020 21:58:30 +0000"  >&lt;p&gt;User &apos;viirya&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/30210&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/30210&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17224170" author="dongjoon" created="Sat, 31 Oct 2020 18:05:23 +0000"  >&lt;p&gt;According to the JIRA report, I added `correctness` label here, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kabhwan&quot; class=&quot;user-hover&quot; rel=&quot;kabhwan&quot;&gt;kabhwan&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=viirya&quot; class=&quot;user-hover&quot; rel=&quot;viirya&quot;&gt;viirya&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17224446" author="kabhwan" created="Mon, 2 Nov 2020 06:47:54 +0000"  >&lt;p&gt;I&apos;ll also link to the first JIRA issue which the problem was pointed out earlier.&lt;/p&gt;</comment>
                            <comment id="17231034" author="dongjoon" created="Thu, 12 Nov 2020 23:32:31 +0000"  >&lt;p&gt;Issue resolved by pull request 30210&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/30210&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/30210&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13240197">SPARK-28094</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0k1a0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>