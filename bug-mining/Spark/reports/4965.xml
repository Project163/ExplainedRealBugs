<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:54:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-19104]  CompileException with Map and Case Class in Spark 2.1.0</title>
                <link>https://issues.apache.org/jira/browse/SPARK-19104</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;The following code will run with Spark 2.0.2 but not with Spark 2.1.0:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;InnerData(name: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, value: Int)
&lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Data(id: Int, param: Map[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, InnerData])

val data = Seq.tabulate(10)(i =&amp;gt; Data(1, Map(&lt;span class=&quot;code-quote&quot;&gt;&quot;key&quot;&lt;/span&gt; -&amp;gt; InnerData(&lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;, i + 100))))
val ds   = spark.createDataset(data)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Exception:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Caused by: org.codehaus.commons.compiler.CompileException: File &lt;span class=&quot;code-quote&quot;&gt;&apos;generated.java&apos;&lt;/span&gt;, Line 63, Column 46: Expression &lt;span class=&quot;code-quote&quot;&gt;&quot;ExternalMapToCatalyst_value_isNull1&quot;&lt;/span&gt; is not an rvalue 
  at org.codehaus.janino.UnitCompiler.compileError(UnitCompiler.java:11004) 
  at org.codehaus.janino.UnitCompiler.toRvalueOrCompileException(UnitCompiler.java:6639) 
  at org.codehaus.janino.UnitCompiler.getConstantValue2(UnitCompiler.java:5001) 
  at org.codehaus.janino.UnitCompiler.access$10500(UnitCompiler.java:206) 
  at org.codehaus.janino.UnitCompiler$13.visitAmbiguousName(UnitCompiler.java:4984) 
  at org.codehaus.janino.Java$AmbiguousName.accept(Java.java:3633) 
  at org.codehaus.janino.Java$Lvalue.accept(Java.java:3563) 
  at org.codehaus.janino.UnitCompiler.getConstantValue(UnitCompiler.java:4956) 
  at org.codehaus.janino.UnitCompiler.compileGetValue(UnitCompiler.java:4925) 
  at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:3189) 
  at org.codehaus.janino.UnitCompiler.access$5100(UnitCompiler.java:206) 
  at org.codehaus.janino.UnitCompiler$9.visitAssignment(UnitCompiler.java:3143) 
  at org.codehaus.janino.UnitCompiler$9.visitAssignment(UnitCompiler.java:3139) 
  at org.codehaus.janino.Java$Assignment.accept(Java.java:3847) 
  at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:3139) 
  at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:2112) 
  at org.codehaus.janino.UnitCompiler.access$1700(UnitCompiler.java:206) 
  at org.codehaus.janino.UnitCompiler$6.visitExpressionStatement(UnitCompiler.java:1377) 
  at org.codehaus.janino.UnitCompiler$6.visitExpressionStatement(UnitCompiler.java:1370) 
  at org.codehaus.janino.Java$ExpressionStatement.accept(Java.java:2558) 
  at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:1370) 
  at org.codehaus.janino.UnitCompiler.compileStatements(UnitCompiler.java:1450) 
  at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:2811) 
  at org.codehaus.janino.UnitCompiler.compileDeclaredMethods(UnitCompiler.java:1262) 
  at org.codehaus.janino.UnitCompiler.compileDeclaredMethods(UnitCompiler.java:1234) 
  at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:538) 
  at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:890) 
  at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:894) 
  at org.codehaus.janino.UnitCompiler.access$600(UnitCompiler.java:206) 
  at org.codehaus.janino.UnitCompiler$2.visitMemberClassDeclaration(UnitCompiler.java:377) 
  at org.codehaus.janino.UnitCompiler$2.visitMemberClassDeclaration(UnitCompiler.java:369) 
  at org.codehaus.janino.Java$MemberClassDeclaration.accept(Java.java:1128) 
  at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:369) 
  at org.codehaus.janino.UnitCompiler.compileDeclaredMemberTypes(UnitCompiler.java:1209) 
  at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:564) 
  at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:420) 
  at org.codehaus.janino.UnitCompiler.access$400(UnitCompiler.java:206) 
  at org.codehaus.janino.UnitCompiler$2.visitPackageMemberClassDeclaration(UnitCompiler.java:374) 
  at org.codehaus.janino.UnitCompiler$2.visitPackageMemberClassDeclaration(UnitCompiler.java:369) 
  at org.codehaus.janino.Java$AbstractPackageMemberClassDeclaration.accept(Java.java:1309) 
  at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:369) 
  at org.codehaus.janino.UnitCompiler.compileUnit(UnitCompiler.java:345) 
  at org.codehaus.janino.SimpleCompiler.compileToClassLoader(SimpleCompiler.java:396) 
  at org.codehaus.janino.ClassBodyEvaluator.compileToClass(ClassBodyEvaluator.java:311) 
  at org.codehaus.janino.ClassBodyEvaluator.cook(ClassBodyEvaluator.java:229) 
  at org.codehaus.janino.SimpleCompiler.cook(SimpleCompiler.java:196) 
  at org.codehaus.commons.compiler.Cookable.cook(Cookable.java:91) 
  at org.apache.spark.sql.catalyst.expressions.codegen.CodeGenerator$.org$apache$spark$sql$catalyst$expressions$codegen$CodeGenerator$$doCompile(CodeGenerator.scala:935) 
  ... 77 more 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment></environment>
        <key id="13032517">SPARK-19104</key>
            <summary> CompileException with Map and Case Class in Spark 2.1.0</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="viirya">L. C. Hsieh</assignee>
                                    <reporter username="nils.grabbert">Nils Grabbert</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 Jan 2017 10:18:46 +0000</created>
                <updated>Tue, 18 Jul 2017 01:39:06 +0000</updated>
                            <resolved>Tue, 27 Jun 2017 17:00:03 +0000</resolved>
                                    <version>2.1.0</version>
                    <version>2.2.0</version>
                                    <fixVersion>2.1.2</fixVersion>
                    <fixVersion>2.2.0</fixVersion>
                                    <component>Optimizer</component>
                    <component>SQL</component>
                        <due></due>
                            <votes>6</votes>
                                    <watches>14</watches>
                                                                                                                <comments>
                            <comment id="15843809" author="maropu" created="Sat, 28 Jan 2017 03:40:54 +0000"  >&lt;p&gt;I think this issue is related to &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-18891&quot; title=&quot;Support for specific collection types&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-18891&quot;&gt;&lt;del&gt;SPARK-18891&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15994509" author="nils.grabbert" created="Wed, 3 May 2017 09:04:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maropu&quot; class=&quot;user-hover&quot; rel=&quot;maropu&quot;&gt;maropu&lt;/a&gt; I think this issue is not related to &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-18891&quot; title=&quot;Support for specific collection types&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-18891&quot;&gt;&lt;del&gt;SPARK-18891&lt;/del&gt;&lt;/a&gt;. The example is still not working on 2.2 branch.&lt;/p&gt;</comment>
                            <comment id="16006300" author="steven.aerts" created="Thu, 11 May 2017 12:03:02 +0000"  >&lt;p&gt;We bumped into this issue also in java and we reduced this to the following spark code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Value (id: Int, value: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;RowValue (c1: Map[Int, Value])
spark.createDataset(List(RowValue(Map(1 -&amp;gt; Value(2, &lt;span class=&quot;code-quote&quot;&gt;&quot;bar&quot;&lt;/span&gt;)))))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We confirm that it is still reproducible in spark 2.1.1.&lt;/p&gt;</comment>
                            <comment id="16032730" author="nathanwilliamgrand@gmail.com" created="Thu, 1 Jun 2017 10:04:13 +0000"  >&lt;p&gt;We have also just come across this (on 2.1.0). Have tested and it is still an issue in the latest 2.3 nightly build. Is there a work-around for this issue? For us, this bug is a real pain as we use such case classes extensively in our libraries.&lt;/p&gt;</comment>
                            <comment id="16034223" author="nils.grabbert" created="Fri, 2 Jun 2017 06:39:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marmbrus&quot; class=&quot;user-hover&quot; rel=&quot;marmbrus&quot;&gt;marmbrus&lt;/a&gt; Why are you moving this major bug to 2.3.0? As &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nathanwilliamgrand%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;nathanwilliamgrand@gmail.com&quot;&gt;nathanwilliamgrand@gmail.com&lt;/a&gt; has already mentioned, it is now almost impossible to work with case classes.&lt;/p&gt;</comment>
                            <comment id="16035012" author="marmbrus" created="Fri, 2 Jun 2017 16:38:17 +0000"  >&lt;p&gt;I&apos;m about to cut RC3 of 2.2 and there is no pull request to fix this.  Unfortunately that means it&apos;s not going to be fixed in 2.2.0&lt;/p&gt;</comment>
                            <comment id="16062528" author="apachespark" created="Mon, 26 Jun 2017 04:33:04 +0000"  >&lt;p&gt;User &apos;viirya&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18418&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18418&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16062529" author="viirya" created="Mon, 26 Jun 2017 04:37:00 +0000"  >&lt;p&gt;Just found this issue. I proposed a PR to fix it. There&apos;s RC5 of 2.2, so I&apos;m not sure if this can be in 2.2.0.&lt;/p&gt;</comment>
                            <comment id="16065135" author="cloud_fan" created="Tue, 27 Jun 2017 17:00:03 +0000"  >&lt;p&gt;Issue resolved by pull request 18418&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18418&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18418&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16085937" author="apachespark" created="Thu, 13 Jul 2017 16:17:05 +0000"  >&lt;p&gt;User &apos;kiszk&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18626&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18626&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16086121" author="apachespark" created="Thu, 13 Jul 2017 18:04:03 +0000"  >&lt;p&gt;User &apos;kiszk&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18627&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18627&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13028537">SPARK-18891</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13086630">SPARK-21391</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 18 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i38cl3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12339551">2.3.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>