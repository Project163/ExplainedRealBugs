<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:07:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-29682] Failure when resolving conflicting references in Join:</title>
                <link>https://issues.apache.org/jira/browse/SPARK-29682</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;When I try to self join a parentDf with multiple childDf say childDf1 ... ...&#160;&lt;/p&gt;

&lt;p&gt;where childDfs are derived after a cube or rollup and are filtered based on group bys,&lt;/p&gt;

&lt;p&gt;I get and error&#160;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;Failure when resolving conflicting references in Join:&#160;&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;This shows a long error message which is quite unreadable. On the other hand, if I replace cube or rollup with old groupBy, it works without issues.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Sample code:&lt;/b&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
val numsDF = sc.parallelize(Seq(1,2,3,4,5,6)).toDF(&lt;span class=&quot;code-quote&quot;&gt;&quot;nums&quot;&lt;/span&gt;)


val cubeDF = numsDF
    .cube(&lt;span class=&quot;code-quote&quot;&gt;&quot;nums&quot;&lt;/span&gt;)
    .agg(
        max(lit(0)).as(&lt;span class=&quot;code-quote&quot;&gt;&quot;agcol&quot;&lt;/span&gt;),
        grouping_id().as(&lt;span class=&quot;code-quote&quot;&gt;&quot;gid&quot;&lt;/span&gt;)
    )
    
val group0 = cubeDF.filter(col(&lt;span class=&quot;code-quote&quot;&gt;&quot;gid&quot;&lt;/span&gt;) &amp;lt;=&amp;gt; lit(0))
val group1 = cubeDF.filter(col(&lt;span class=&quot;code-quote&quot;&gt;&quot;gid&quot;&lt;/span&gt;) &amp;lt;=&amp;gt; lit(1))

cubeDF.printSchema
group0.printSchema
group1.printSchema


&lt;span class=&quot;code-comment&quot;&gt;//Recreating cubeDf
&lt;/span&gt;cubeDF.select(&lt;span class=&quot;code-quote&quot;&gt;&quot;nums&quot;&lt;/span&gt;).distinct
    .join(group0, Seq(&lt;span class=&quot;code-quote&quot;&gt;&quot;nums&quot;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;inner&lt;/span&gt;&quot;&lt;/span&gt;)
    .join(group1, Seq(&lt;span class=&quot;code-quote&quot;&gt;&quot;nums&quot;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;inner&lt;/span&gt;&quot;&lt;/span&gt;)
    .show
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;b&gt;Sample output:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
numsDF: org.apache.spark.sql.DataFrame = [nums: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;]
cubeDF: org.apache.spark.sql.DataFrame = [nums: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, agcol: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; ... 1 more field]
group0: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [nums: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, agcol: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; ... 1 more field]
group1: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [nums: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, agcol: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; ... 1 more field]
root
 |-- nums: integer (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- agcol: integer (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- gid: integer (nullable = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
root
 |-- nums: integer (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- agcol: integer (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- gid: integer (nullable = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
root
 |-- nums: integer (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- agcol: integer (nullable = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
 |-- gid: integer (nullable = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
org.apache.spark.sql.AnalysisException:
Failure when resolving conflicting references in Join:
&apos;Join Inner
:- Deduplicate [nums#220]
:  +- Project [nums#220]
:     +- Aggregate [nums#220, spark_grouping_id#218], [nums#220, max(0) AS agcol#216, spark_grouping_id#218 AS gid#217]
:        +- Expand [List(nums#212, nums#219, 0), List(nums#212, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, 1)], [nums#212, nums#220, spark_grouping_id#218]
:           +- Project [nums#212, nums#212 AS nums#219]
:              +- Project [value#210 AS nums#212]
:                 +- SerializeFromObject [input[0, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;] AS value#210]
:                    +- ExternalRDD [obj#209]
+- Filter (gid#217 &amp;lt;=&amp;gt; 0)
   +- Aggregate [nums#220, spark_grouping_id#218], [nums#220, max(0) AS agcol#216, spark_grouping_id#218 AS gid#217]
      +- Expand [List(nums#212, nums#219, 0), List(nums#212, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, 1)], [nums#212, nums#220, spark_grouping_id#218]
         +- Project [nums#212, nums#212 AS nums#219]
            +- Project [value#210 AS nums#212]
               +- SerializeFromObject [input[0, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;] AS value#210]
                  +- ExternalRDD [obj#209]
Conflicting attributes: nums#220
;;
&apos;Join Inner
:- Deduplicate [nums#220]
:  +- Project [nums#220]
:     +- Aggregate [nums#220, spark_grouping_id#218], [nums#220, max(0) AS agcol#216, spark_grouping_id#218 AS gid#217]
:        +- Expand [List(nums#212, nums#219, 0), List(nums#212, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, 1)], [nums#212, nums#220, spark_grouping_id#218]
:           +- Project [nums#212, nums#212 AS nums#219]
:              +- Project [value#210 AS nums#212]
:                 +- SerializeFromObject [input[0, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;] AS value#210]
:                    +- ExternalRDD [obj#209]
+- Filter (gid#217 &amp;lt;=&amp;gt; 0)
   +- Aggregate [nums#220, spark_grouping_id#218], [nums#220, max(0) AS agcol#216, spark_grouping_id#218 AS gid#217]
      +- Expand [List(nums#212, nums#219, 0), List(nums#212, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, 1)], [nums#212, nums#220, spark_grouping_id#218]
         +- Project [nums#212, nums#212 AS nums#219]
            +- Project [value#210 AS nums#212]
               +- SerializeFromObject [input[0, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;] AS value#210]
                  +- ExternalRDD [obj#209]
  at org.apache.spark.sql.catalyst.analysis.CheckAnalysis$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;failAnalysis(CheckAnalysis.scala:42)
  at org.apache.spark.sql.catalyst.analysis.Analyzer.failAnalysis(Analyzer.scala:96)
  at org.apache.spark.sql.catalyst.analysis.CheckAnalysis$$anonfun$checkAnalysis$1.apply(CheckAnalysis.scala:335)
  at org.apache.spark.sql.catalyst.analysis.CheckAnalysis$$anonfun$checkAnalysis$1.apply(CheckAnalysis.scala:85)
  at org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:125)
  at org.apache.spark.sql.catalyst.analysis.CheckAnalysis$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;checkAnalysis(CheckAnalysis.scala:85)
  at org.apache.spark.sql.catalyst.analysis.Analyzer.checkAnalysis(Analyzer.scala:96)
  at org.apache.spark.sql.catalyst.analysis.Analyzer$$anonfun$executeAndCheck$1.apply(Analyzer.scala:109)
  at org.apache.spark.sql.catalyst.analysis.Analyzer$$anonfun$executeAndCheck$1.apply(Analyzer.scala:106)
  at org.apache.spark.sql.catalyst.plans.logical.AnalysisHelper$.markInAnalyzer(AnalysisHelper.scala:202)
  at org.apache.spark.sql.catalyst.analysis.Analyzer.executeAndCheck(Analyzer.scala:106)
  at org.apache.spark.sql.execution.QueryExecution.analyzed$lzycompute(QueryExecution.scala:68)
  at org.apache.spark.sql.execution.QueryExecution.analyzed(QueryExecution.scala:66)
  at org.apache.spark.sql.Dataset.join(Dataset.scala:939)
  ... 46 elided
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13265482">SPARK-29682</key>
            <summary>Failure when resolving conflicting references in Join:</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="imback82">Terry Kim</assignee>
                                    <reporter username="sandeshyapuram">sandeshyapuram</reporter>
                        <labels>
                    </labels>
                <created>Thu, 31 Oct 2019 08:59:15 +0000</created>
                <updated>Thu, 14 Nov 2019 07:35:37 +0000</updated>
                            <resolved>Thu, 14 Nov 2019 07:00:57 +0000</resolved>
                                    <version>2.1.3</version>
                    <version>2.2.3</version>
                    <version>2.3.4</version>
                    <version>2.4.3</version>
                                    <fixVersion>2.4.5</fixVersion>
                    <fixVersion>3.0.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16963789" author="sandeshyapuram" created="Thu, 31 Oct 2019 09:07:40 +0000"  >&lt;p&gt;I have reproduced this in spark-submit as well as cubole notebooks.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure how I can provide you with a self reproducer&lt;/p&gt;</comment>
                            <comment id="16963850" author="cloud_fan" created="Thu, 31 Oct 2019 10:32:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=imback82&quot; class=&quot;user-hover&quot; rel=&quot;imback82&quot;&gt;imback82&lt;/a&gt; do you want to look into it?&lt;/p&gt;</comment>
                            <comment id="16964158" author="imback82" created="Thu, 31 Oct 2019 15:54:18 +0000"  >&lt;p&gt;Sure, I will look into this. Thanks for pinging me.&lt;/p&gt;</comment>
                            <comment id="16965216" author="sandeshyapuram" created="Sat, 2 Nov 2019 03:26:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=imback82&quot; class=&quot;user-hover&quot; rel=&quot;imback82&quot;&gt;imback82&lt;/a&gt;&#160; &amp;amp; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cloud_fan&quot; class=&quot;user-hover&quot; rel=&quot;cloud_fan&quot;&gt;cloud_fan&lt;/a&gt; Currently I&apos;ve worked my way around by renaming every column in the dataframes to perform joins and that works.&lt;/p&gt;

&lt;p&gt;Let me know if you have a better workaround to deal with it.&lt;/p&gt;</comment>
                            <comment id="16967174" author="imback82" created="Tue, 5 Nov 2019 02:50:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sandeshyapuram&quot; class=&quot;user-hover&quot; rel=&quot;sandeshyapuram&quot;&gt;sandeshyapuram&lt;/a&gt;&#160;Glad that you found the workaround. I am still looking into this. I will update this thread when I find more about it. Thanks for the patience.&lt;/p&gt;</comment>
                            <comment id="16973961" author="dongjoon" created="Thu, 14 Nov 2019 07:00:57 +0000"  >&lt;p&gt;This is resolved via &lt;a href=&quot;https://github.com/apache/spark/pull/26441&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/26441&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16973985" author="sandeshyapuram" created="Thu, 14 Nov 2019 07:35:37 +0000"  >&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z084kw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>