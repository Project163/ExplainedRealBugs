<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:43:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-13445] Selecting &quot;data&quot; with window function does not work unless aliased (using PARTITION BY)</title>
                <link>https://issues.apache.org/jira/browse/SPARK-13445</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>
&lt;p&gt;The code does not throw an exception if &quot;data&quot; is aliased.  Maybe this is a reserved word or aliases are just required when using PARTITION BY?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;sql(&quot;&quot;&quot;
  SELECT 
    data as the_data,
    row_number() over (partition BY data.type) AS foo
  FROM event_record_sample
&quot;&quot;&quot;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;However, this code throws an error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;sql(&quot;&quot;&quot;
  SELECT 
    data,
    row_number() over (partition BY data.type) AS foo
  FROM event_record_sample
&quot;&quot;&quot;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;org.apache.spark.sql.AnalysisException: resolved attribute(s) type#15246 missing from data#15107,par_cat#15112,schemaMajorVersion#15110,source#15108,recordId#15103,features#15106,eventType#15105,ts#15104L,schemaMinorVersion#15111,issues#15109 in &lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt; !Project [data#15107,type#15246];
	at org.apache.spark.sql.catalyst.analysis.CheckAnalysis$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;failAnalysis(CheckAnalysis.scala:38)
	at org.apache.spark.sql.catalyst.analysis.Analyzer.failAnalysis(Analyzer.scala:44)
	at org.apache.spark.sql.catalyst.analysis.CheckAnalysis$$anonfun$checkAnalysis$1.apply(CheckAnalysis.scala:183)
	at org.apache.spark.sql.catalyst.analysis.CheckAnalysis$$anonfun$checkAnalysis$1.apply(CheckAnalysis.scala:50)
	at org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:105)
	at org.apache.spark.sql.catalyst.trees.TreeNode$$anonfun$foreachUp$1.apply(TreeNode.scala:104)
	at org.apache.spark.sql.catalyst.trees.TreeNode$$anonfun$foreachUp$1.apply(TreeNode.scala:104)
	at scala.collection.immutable.List.foreach(List.scala:318)
	at org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:104)
	at org.apache.spark.sql.catalyst.trees.TreeNode$$anonfun$foreachUp$1.apply(TreeNode.scala:104)
	at org.apache.spark.sql.catalyst.trees.TreeNode$$anonfun$foreachUp$1.apply(TreeNode.scala:104)
	at scala.collection.immutable.List.foreach(List.scala:318)
	at org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:104)
	at org.apache.spark.sql.catalyst.trees.TreeNode$$anonfun$foreachUp$1.apply(TreeNode.scala:104)
	at org.apache.spark.sql.catalyst.trees.TreeNode$$anonfun$foreachUp$1.apply(TreeNode.scala:104)
	at scala.collection.immutable.List.foreach(List.scala:318)
	at org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:104)
	at org.apache.spark.sql.catalyst.analysis.CheckAnalysis$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;checkAnalysis(CheckAnalysis.scala:50)
	at org.apache.spark.sql.catalyst.analysis.Analyzer.checkAnalysis(Analyzer.scala:44)
	at org.apache.spark.sql.execution.QueryExecution.assertAnalyzed(QueryExecution.scala:34)
	at org.apache.spark.sql.DataFrame.&amp;lt;init&amp;gt;(DataFrame.scala:133)
	at org.apache.spark.sql.DataFrame$.apply(DataFrame.scala:52)
	at org.apache.spark.sql.SQLContext.sql(SQLContext.scala:816)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12941278">SPARK-13445</key>
            <summary>Selecting &quot;data&quot; with window function does not work unless aliased (using PARTITION BY)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="clockfly@gmail.com">Xiang Zhong</assignee>
                                    <reporter username="rxin">Reynold Xin</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Feb 2016 05:16:42 +0000</created>
                <updated>Thu, 26 May 2016 21:50:06 +0000</updated>
                            <resolved>Thu, 26 May 2016 21:50:06 +0000</resolved>
                                    <version>1.6.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="15160151" author="smilegator" created="Wed, 24 Feb 2016 04:07:39 +0000"  >&lt;p&gt;I will take a look at this. Thanks!&lt;/p&gt;</comment>
                            <comment id="15163446" author="smilegator" created="Wed, 24 Feb 2016 18:11:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rxin&quot; class=&quot;user-hover&quot; rel=&quot;rxin&quot;&gt;rxin&lt;/a&gt; This is strange. Both of your queries should not work. The ORDER BY clause determines the sequence in which the rows are assigned their unique ROW_NUMBER within a specified partition. It is required in Spark SQL.&lt;/p&gt;

&lt;p&gt;I tried to reproduce your error by using &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    sqlContext.read.json(
      sparkContext.makeRDD(&lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;&quot;{&quot;&lt;/span&gt;data&lt;span class=&quot;code-quote&quot;&gt;&quot;: {&quot;&lt;/span&gt;type&lt;span class=&quot;code-quote&quot;&gt;&quot;: 1}}&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;&quot; :: Nil)).registerTempTable(&quot;&lt;/span&gt;event_record_sample&quot;)
    sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT data, row_number() over (partition by data.type) as foo from event_record_sample&quot;&lt;/span&gt;).explain(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Below is the error message I got.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;WindowFunction rownumber() requires window to be ordered;
org.apache.spark.sql.AnalysisException: WindowFunction rownumber() requires window to be ordered;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If I added an order by clause, it works fine. For example, &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT data, row_number() over (partition by data.type order by data.type) as foo from event_record_sample&quot;&lt;/span&gt;).explain(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;What is the schema? &lt;/p&gt;</comment>
                            <comment id="15167761" author="simeons" created="Thu, 25 Feb 2016 19:56:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smilegator&quot; class=&quot;user-hover&quot; rel=&quot;smilegator&quot;&gt;smilegator&lt;/a&gt; So, the real issue you see here is that SQL analyzer not raising an error requiring &lt;tt&gt;ORDER BY&lt;/tt&gt; for the window function?&lt;/p&gt;</comment>
                            <comment id="15168501" author="smilegator" created="Fri, 26 Feb 2016 05:57:29 +0000"  >&lt;p&gt;I am unable to reproduce the error that is described in this JIRA. So far, I did not find any bug. The current behaviors are expected. Please let me know if you can reproduce it. I am glad to continue the investigation. Thanks! &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=simeons&quot; class=&quot;user-hover&quot; rel=&quot;simeons&quot;&gt;simeons&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15168527" author="simeons" created="Fri, 26 Feb 2016 06:25:46 +0000"  >&lt;p&gt;I can reproduce it consistently in our 1.6.0 Databricks environment. See &lt;a href=&quot;http://www.screencast.com/t/iDVYagvqA&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.screencast.com/t/iDVYagvqA&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15168532" author="smilegator" created="Fri, 26 Feb 2016 06:27:58 +0000"  >&lt;p&gt;Let me try it in 1.6. &lt;/p&gt;</comment>
                            <comment id="15168568" author="smilegator" created="Fri, 26 Feb 2016 07:01:24 +0000"  >&lt;p&gt;Yeah. In 1.6.0, I can reproduce it. Will try to see if it still exists in the latest 1.6 branch&lt;/p&gt;</comment>
                            <comment id="15168608" author="smilegator" created="Fri, 26 Feb 2016 07:47:09 +0000"  >&lt;p&gt;Tried it in the latest 1.6 upstream. The query can be resolved. &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;scala&amp;gt; sqlContext.read.json(sc.makeRDD(&lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;&quot;{&quot;&lt;/span&gt;data&lt;span class=&quot;code-quote&quot;&gt;&quot;: {&quot;&lt;/span&gt;type&lt;span class=&quot;code-quote&quot;&gt;&quot;: 1}}&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;&quot; :: Nil)).registerTempTable(&quot;&lt;/span&gt;event_record_sample&quot;)

scala&amp;gt; sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT data, row_number() over (partition by data.type) as foo from event_record_sample&quot;&lt;/span&gt;).explain(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)

== Parsed Logical Plan ==
&lt;span class=&quot;code-quote&quot;&gt;&apos;Project [unresolvedalias(&apos;&lt;/span&gt;data),unresolvedalias(&lt;span class=&quot;code-quote&quot;&gt;&apos;row_number() windowspecdefinition(&apos;&lt;/span&gt;data.type,UnspecifiedFrame) AS foo#17)]
+- &apos;UnresolvedRelation `event_record_sample`, None

== Analyzed Logical Plan ==
data: struct&amp;lt;type:bigint&amp;gt;, foo: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;
Project [data#5,foo#17]
+- Project [data#5,foo#17,foo#17]
   +- Window [data#5], [HiveWindowFunction#org.apache.hadoop.hive.ql.udf.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericUDAFRowNumber() windowspecdefinition(data#5.type,ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS foo#17], [data#5.type]
      +- Project [data#5]
         +- Subquery event_record_sample
            +- Relation[data#5] JSONRelation

== Optimized Logical Plan ==
Window [data#5], [HiveWindowFunction#org.apache.hadoop.hive.ql.udf.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericUDAFRowNumber() windowspecdefinition(data#5.type,ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS foo#17], [data#5.type]
+- Project [data#5]
   +- Relation[data#5] JSONRelation

== Physical Plan ==
Window [data#5], [HiveWindowFunction#org.apache.hadoop.hive.ql.udf.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericUDAFRowNumber() windowspecdefinition(data#5.type,ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) AS foo#17], [data#5.type]
+- Sort [data#5.type ASC], &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, 0
   +- TungstenExchange hashpartitioning(data#5.type,200), None
      +- Scan JSONRelation[data#5] InputPaths:
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However, I do not think the query should be accepted when row_number() is used without the order-by clause in the window specification.&lt;/p&gt;

&lt;p&gt;Tomorrow, I will try to find which PR brings the output difference between 2.0 and 1.6.1&lt;/p&gt;</comment>
                            <comment id="15169352" author="smilegator" created="Fri, 26 Feb 2016 17:20:16 +0000"  >&lt;p&gt;Since 2.0, we have a native support for the window functions: &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-8641&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-8641&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;Our new implementation enforces users to explicitly specify the order by clauses. In 1.6, we still used Hive UDAFs for window functions. Hive UDAFs row_number() does not require it. Thus, we did not see the error message.&lt;/p&gt;

&lt;p&gt;Let me know if we need to add extra logics to enforce it. Thanks! &lt;/p&gt;</comment>
                            <comment id="15267274" author="yhuai" created="Mon, 2 May 2016 19:02:24 +0000"  >&lt;p&gt;Also cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hvanhovell&quot; class=&quot;user-hover&quot; rel=&quot;hvanhovell&quot;&gt;hvanhovell&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15301161" author="yhuai" created="Wed, 25 May 2016 23:54:53 +0000"  >&lt;p&gt;So, if I understand it correctly, it is an issue with 1.6 instead of 2.0?&lt;/p&gt;</comment>
                            <comment id="15301166" author="yhuai" created="Thu, 26 May 2016 00:00:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=simeons&quot; class=&quot;user-hover&quot; rel=&quot;simeons&quot;&gt;simeons&lt;/a&gt; Can you still be able to reproduce it?&lt;/p&gt;

&lt;p&gt;I am wondering if it has been fixed in 1.6.1. &lt;/p&gt;</comment>
                            <comment id="15302702" author="apachespark" created="Thu, 26 May 2016 19:02:04 +0000"  >&lt;p&gt;User &apos;clockfly&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/13333&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/13333&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 25 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2t71r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12329449">2.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>