<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:27:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-28266] data duplication when `path` serde property is present</title>
                <link>https://issues.apache.org/jira/browse/SPARK-28266</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Spark duplicates returned datasets when `path` serde is present in a parquet table.&#160;&lt;/p&gt;

&lt;p&gt;Confirmed versions affected: Spark 2.2, Spark 2.3, Spark 2.4.&lt;/p&gt;

&lt;p&gt;Confirmed unaffected versions: Spark 2.1 and earlier (tested with Spark 1.6 at least).&lt;/p&gt;

&lt;p&gt;Reproducer:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-python&quot;&gt;
&amp;gt;&amp;gt;&amp;gt; spark.sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;create table ruslan_test.test55 &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; select 1 &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;id&lt;/span&gt;&quot;&lt;/span&gt;)
DataFrame[]

&amp;gt;&amp;gt;&amp;gt; spark.table(&lt;span class=&quot;code-quote&quot;&gt;&quot;ruslan_test.test55&quot;&lt;/span&gt;).explain()

== Physical Plan ==
HiveTableScan [&lt;span class=&quot;code-object&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;#16], HiveTableRelation `ruslan_test`.`test55`, org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe, [&lt;span class=&quot;code-object&quot;&gt;id&lt;/span&gt;#16]
&lt;/span&gt;
&amp;gt;&amp;gt;&amp;gt; spark.table(&lt;span class=&quot;code-quote&quot;&gt;&quot;ruslan_test.test55&quot;&lt;/span&gt;).count()
1

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(all is good at this point, now exist session and run in Hive for example - )&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;ALTER&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TABLE&lt;/span&gt; ruslan_test.test55 &lt;span class=&quot;code-keyword&quot;&gt;SET&lt;/span&gt; SERDEPROPERTIES ( &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;path&lt;/span&gt;&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;hdfs://epsdatalake/hivewarehouse/ruslan_test.db/test55&apos;&lt;/span&gt; )
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So LOCATION and serde `path` property would point to the same location.&lt;br/&gt;
Now see count returns two records instead of one:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-python&quot;&gt;
&amp;gt;&amp;gt;&amp;gt; spark.table(&lt;span class=&quot;code-quote&quot;&gt;&quot;ruslan_test.test55&quot;&lt;/span&gt;).count()
2

&amp;gt;&amp;gt;&amp;gt; spark.table(&lt;span class=&quot;code-quote&quot;&gt;&quot;ruslan_test.test55&quot;&lt;/span&gt;).explain()
== Physical Plan ==
*(1) FileScan parquet ruslan_test.test55[&lt;span class=&quot;code-object&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;#9] Batched: true, Format: Parquet, Location: InMemoryFileIndex[hdfs://epsdatalake/hivewarehouse/ruslan_test.db/test55, hdfs://epsdatalake/hive..., PartitionFilters: [], PushedFilters: [], ReadSchema: struct&amp;lt;&lt;span class=&quot;code-object&quot;&gt;id&lt;/span&gt;:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&amp;gt;
&lt;/span&gt;&amp;gt;&amp;gt;&amp;gt;

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Also notice that the presence of `path` serde property makes TABLE location &lt;br/&gt;
show up twice - &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;InMemoryFileIndex[hdfs://epsdatalake/hivewarehouse/ruslan_test.db/test55, hdfs://epsdatalake/hive..., &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We have some applications that create parquet tables in Hive with `path` serde property&lt;br/&gt;
and it makes data duplicate in query results. &lt;/p&gt;

&lt;p&gt;Hive, Impala etc and Spark version 2.1 and earlier read such tables fine, but not Spark 2.2 and later releases.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13243448">SPARK-28266</key>
            <summary>data duplication when `path` serde property is present</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shardulm">Shardul Mahadik</assignee>
                                    <reporter username="Tagar">Ruslan Dautkhanov</reporter>
                        <labels>
                            <label>correctness</label>
                    </labels>
                <created>Fri, 5 Jul 2019 23:29:43 +0000</created>
                <updated>Mon, 18 Oct 2021 18:10:34 +0000</updated>
                            <resolved>Wed, 21 Jul 2021 14:42:39 +0000</resolved>
                                    <version>2.2.0</version>
                    <version>2.2.1</version>
                    <version>2.2.2</version>
                                    <fixVersion>3.2.0</fixVersion>
                    <fixVersion>3.1.3</fixVersion>
                    <fixVersion>3.0.4</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="16882200" author="tagar" created="Wed, 10 Jul 2019 15:35:09 +0000"  >&lt;p&gt;Suspecting change in&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-22158&quot; title=&quot;convertMetastore should not ignore storage properties&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-22158&quot;&gt;&lt;del&gt;SPARK-22158&lt;/del&gt;&lt;/a&gt; causes this&#160;&lt;/p&gt;</comment>
                            <comment id="16882381" author="tagar" created="Wed, 10 Jul 2019 19:36:25 +0000"  >&lt;p&gt;This issue happens `spark.sql.sources.provider` table property is NOT present, and `path` serde property is present -&lt;/p&gt;

&lt;p&gt;Spark duplicates records in this case.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16883222" author="tagar" created="Thu, 11 Jul 2019 17:54:51 +0000"  >&lt;p&gt;Another interesting side Spark bug found while was trying to fix this issue.&lt;/p&gt;

&lt;p&gt;If&#160;`spark.sql.sources.provider` table property IS present and `path` serde property IS NOT present,&lt;br/&gt;
then Spark will happily always return 0 (zero) records irrespective of all the files that `LOCATION` points at.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17014041" author="dongjoon" created="Mon, 13 Jan 2020 05:56:24 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Tagar&quot; class=&quot;user-hover&quot; rel=&quot;Tagar&quot;&gt;Tagar&lt;/a&gt;. &lt;br/&gt;
For now, I cannot reproduce this in `3.0.0-preview` and `3.0.0-preview2`. How did you test this for master branch?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
spark-sql&amp;gt; select version();
3.0.0 007c873ae34f58651481ccba30e8e2ba38a692c4
Time taken: 3.309 seconds, Fetched 1 row(s)

spark-sql&amp;gt; create table t as select 1 as id;
Time taken: 1.303 seconds

spark-sql&amp;gt; select * from t;
1
Time taken: 0.247 seconds, Fetched 1 row(s)

spark-sql&amp;gt; desc formatted t;
id	&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;	NULL

# Detailed Table Information
Database	&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;
Table	t
Owner	dongjoon
Created Time	Sun Jan 12 21:50:55 PST 2020
Last Access	UNKNOWN
Created By	Spark 3.0.0-preview
Type	MANAGED
Provider	hive
Table Properties	[transient_lastDdlTime=1578894656]
Statistics	2 bytes
Location	file:/Users/dongjoon/APACHE/spark-release/spark-3.0.0-preview-bin-hadoop3.2/spark-warehouse/t
Serde Library	org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe
InputFormat	org.apache.hadoop.mapred.TextInputFormat
OutputFormat	org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat
Storage Properties	[serialization.format=1]
Partition Provider	Catalog
Time taken: 0.098 seconds, Fetched 19 row(s)

spark-sql&amp;gt; ALTER TABLE t SET SERDEPROPERTIES ( &lt;span class=&quot;code-quote&quot;&gt;&apos;path&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;file:/Users/dongjoon/APACHE/spark-release/spark-3.0.0-preview-bin-hadoop3.2/spark-warehouse/t&apos;&lt;/span&gt; );
Time taken: 0.093 seconds

spark-sql&amp;gt; select * from t;
1
Time taken: 0.092 seconds, Fetched 1 row(s)

spark-sql&amp;gt; explain select * from t;
== Physical Plan ==
Scan hive &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;.t [id#29], HiveTableRelation `&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;`.`t`, org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe, [id#29]

Time taken: 0.064 seconds, Fetched 1 row(s)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17014042" author="dongjoon" created="Mon, 13 Jan 2020 06:04:47 +0000"  >&lt;p&gt;So, the observation was that `InMemoryFileIndex` has duplicated entries?&lt;br/&gt;
And, why `spark.sql.sources.provider` property is not present there? Is it removed intentionally?&lt;br/&gt;
&amp;gt; This issue happens `spark.sql.sources.provider` table property is NOT present, and `path` serde property is present -&lt;/p&gt;</comment>
                            <comment id="17014046" author="dongjoon" created="Mon, 13 Jan 2020 06:19:17 +0000"  >&lt;p&gt;BTW, &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-22158&quot; title=&quot;convertMetastore should not ignore storage properties&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-22158&quot;&gt;&lt;del&gt;SPARK-22158&lt;/del&gt;&lt;/a&gt; is irrelevant to this one because it affects only orc and parquet table property containing `.orc` or `.parquet`.&lt;/p&gt;</comment>
                            <comment id="17014048" author="dongjoon" created="Mon, 13 Jan 2020 06:27:26 +0000"  >&lt;p&gt;In Apache Spark 2.4.4, I also cannot reproduce this issue.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
scala&amp;gt; spark.version
res0: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = 2.4.4

scala&amp;gt; sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;create table t as select 1 as id&quot;&lt;/span&gt;)
res1: org.apache.spark.sql.DataFrame = []

scala&amp;gt; sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;desc extended t&quot;&lt;/span&gt;).show(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
+----------------------------+----------------------------------------------------------+-------+
|col_name                    |data_type                                                 |comment|
+----------------------------+----------------------------------------------------------+-------+
|id                          |&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;                                                       |&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;   |
|                            |                                                          |       |
|# Detailed Table Information|                                                          |       |
|Database                    |&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;                                                   |       |
|Table                       |t                                                         |       |
|Owner                       |dongjoon                                                  |       |
|Created Time                |Sun Jan 12 22:26:18 PST 2020                              |       |
|Last Access                 |Wed Dec 31 16:00:00 PST 1969                              |       |
|Created By                  |Spark 2.4.4                                               |       |
|Type                        |MANAGED                                                   |       |
|Provider                    |hive                                                      |       |
|Table Properties            |[transient_lastDdlTime=1578896780]                        |       |
|Statistics                  |2 bytes                                                   |       |
|Location                    |file:/Users/dongjoon/spark-warehouse/t                    |       |
|Serde Library               |org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe        |       |
|InputFormat                 |org.apache.hadoop.mapred.TextInputFormat                  |       |
|OutputFormat                |org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat|       |
|Storage Properties          |[serialization.format=1]                                  |       |
|Partition Provider          |Catalog                                                   |       |
+----------------------------+----------------------------------------------------------+-------+

scala&amp;gt; sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;ALTER TABLE t SET SERDEPROPERTIES ( &lt;span class=&quot;code-quote&quot;&gt;&apos;path&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;file:/Users/dongjoon/spark-warehouse/t&apos;&lt;/span&gt; )&quot;&lt;/span&gt;)
res3: org.apache.spark.sql.DataFrame = []

scala&amp;gt; sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;select * from t&quot;&lt;/span&gt;).show
+---+
| id|
+---+
|  1|
+---+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17014053" author="dongjoon" created="Mon, 13 Jan 2020 06:35:47 +0000"  >&lt;p&gt;For 2.3.4 and 2.2.3, it&apos;s the same. I cannot reproduce this issue.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
scala&amp;gt; spark.version
res0: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; = 2.3.4

scala&amp;gt; sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;create table t as select 1 as id&quot;&lt;/span&gt;)
res1: org.apache.spark.sql.DataFrame = []

scala&amp;gt; sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;desc extended t&quot;&lt;/span&gt;).show(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
+----------------------------+-------------------------------------------------------------------------------------+-------+
|col_name                    |data_type                                                                            |comment|
+----------------------------+-------------------------------------------------------------------------------------+-------+
|id                          |&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;                                                                                  |&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;   |
|                            |                                                                                     |       |
|# Detailed Table Information|                                                                                     |       |
|Database                    |&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;                                                                              |       |
|Table                       |t                                                                                    |       |
|Owner                       |dongjoon                                                                             |       |
|Created Time                |Sun Jan 12 22:34:16 PST 2020                                                         |       |
|Last Access                 |Wed Dec 31 16:00:00 PST 1969                                                         |       |
|Created By                  |Spark 2.3.4                                                                          |       |
|Type                        |MANAGED                                                                              |       |
|Provider                    |hive                                                                                 |       |
|Table Properties            |[transient_lastDdlTime=1578897257]                                                   |       |
|Statistics                  |2 bytes                                                                              |       |
|Location                    |file:/Users/dongjoon/APACHE/spark-release/spark-2.3.4-bin-hadoop2.7/spark-warehouse/t|       |
|Serde Library               |org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe                                   |       |
|InputFormat                 |org.apache.hadoop.mapred.TextInputFormat                                             |       |
|OutputFormat                |org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat                           |       |
|Storage Properties          |[serialization.format=1]                                                             |       |
|Partition Provider          |Catalog                                                                              |       |
+----------------------------+-------------------------------------------------------------------------------------+-------+


scala&amp;gt; sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;ALTER TABLE t SET SERDEPROPERTIES ( &lt;span class=&quot;code-quote&quot;&gt;&apos;path&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;file:/Users/dongjoon/APACHE/spark-release/spark-2.3.4-bin-hadoop2.7/spark-warehouse/t&apos;&lt;/span&gt; )&quot;&lt;/span&gt;)
res3: org.apache.spark.sql.DataFrame = []

scala&amp;gt; sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;select * from t&quot;&lt;/span&gt;).show
+---+
| id|
+---+
|  1|
+---+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17014055" author="dongjoon" created="Mon, 13 Jan 2020 06:37:10 +0000"  >&lt;p&gt;Could you reopen this with more information please?&lt;/p&gt;</comment>
                            <comment id="17014467" author="tagar" created="Mon, 13 Jan 2020 16:46:26 +0000"  >&lt;p&gt;Thank you for checking &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dongjoon&quot; class=&quot;user-hover&quot; rel=&quot;dongjoon&quot;&gt;dongjoon&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;That may have been a Cloudera Distribution of Spark issue all along (I did have a support case with Cloudera last year on this and it did not go anywhere on Spark side - Cloudera were fixing that from another side, by fixing `path` correctly on tables that were replicated )&lt;/p&gt;

&lt;p&gt;I have moved on and no longer have access to a Cloudera environment.&#160;&lt;/p&gt;</comment>
                            <comment id="17014681" author="dongjoon" created="Mon, 13 Jan 2020 21:49:09 +0000"  >&lt;p&gt;Oh, I see. Thank you for reply.&lt;/p&gt;</comment>
                            <comment id="17380093" author="apachespark" created="Tue, 13 Jul 2021 18:01:00 +0000"  >&lt;p&gt;User &apos;shardulm94&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/33328&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/33328&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17380170" author="shardulm" created="Tue, 13 Jul 2021 21:11:56 +0000"  >&lt;p&gt;I would like to propose another angle to look at the issue.&lt;/p&gt;

&lt;p&gt;In this case, Spark can be reading Hive tables created by other products like Hive, Trino or any external system. In such a case, Spark should not be interpreting &lt;tt&gt;path&lt;/tt&gt; property as it can controlled by an end user in these system, it is not a restricted property and does not have a meaning in Hive itself.&lt;/p&gt;

&lt;p&gt;So here, the issue is not that &lt;tt&gt;spark.sql.sources.provider&lt;/tt&gt; is missing. It was never expected to be set since the table was not created through Spark.&lt;/p&gt;

&lt;p&gt;An easy example to demonstrate this issue is by creating an empty table with &lt;tt&gt;path&lt;/tt&gt; property through Hive, and then trying to read it through Spark.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
hive (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;)&amp;gt; CREATE TABLE test (id bigint)
              &amp;gt; ROW FORMAT SERDE &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe&apos;&lt;/span&gt;
              &amp;gt; WITH SERDEPROPERTIES (&lt;span class=&quot;code-quote&quot;&gt;&apos;path&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;someRandomValue&apos;&lt;/span&gt;)
              &amp;gt; STORED AS PARQUET;
OK
Time taken: 0.069 seconds
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
scala&amp;gt; spark.sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT * FROM test&quot;&lt;/span&gt;)
org.apache.spark.sql.AnalysisException: Path does not exist: hdfs:&lt;span class=&quot;code-comment&quot;&gt;//user/username/someRandomValue
&lt;/span&gt;  at org.apache.spark.sql.execution.datasources.DataSource$.$anonfun$checkAndGlobPathIfNecessary$4(DataSource.scala:803)
  at org.apache.spark.sql.execution.datasources.DataSource$.$anonfun$checkAndGlobPathIfNecessary$4$adapted(DataSource.scala:800)
  at org.apache.spark.util.ThreadUtils$.$anonfun$parmap$2(ThreadUtils.scala:372)
  at scala.concurrent.Future$.$anonfun$apply$1(Future.scala:659)
  at scala.util.Success.$anonfun$map$1(Try.scala:255)
  at scala.util.Success.map(Try.scala:213)
  at scala.concurrent.Future.$anonfun$map$1(Future.scala:292)
  at scala.concurrent.impl.Promise.liftedTree1$1(Promise.scala:33)
  at scala.concurrent.impl.Promise.$anonfun$transform$1(Promise.scala:33)
  at scala.concurrent.impl.CallbackRunnable.run(Promise.scala:64)
  at java.util.concurrent.ForkJoinTask$RunnableExecuteAction.exec(ForkJoinTask.java:1402)
  at java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:289)
  at java.util.concurrent.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1056)
  at java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1692)
  at java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:157)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In the case the path property points to a valid location, it may result in incorrect data&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 hive (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;)&amp;gt; CREATE TABLE test1 (id bigint)
              &amp;gt; ROW FORMAT SERDE &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe&apos;&lt;/span&gt;
              &amp;gt; WITH SERDEPROPERTIES (&lt;span class=&quot;code-quote&quot;&gt;&apos;path&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;/user/username/test1&apos;&lt;/span&gt;)
              &amp;gt; STORED AS PARQUET LOCATION &lt;span class=&quot;code-quote&quot;&gt;&apos;/user/username/test1&apos;&lt;/span&gt;;
OK
Time taken: 0.046 seconds

hive (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;)&amp;gt; INSERT INTO test1 VALUES (1);
1 Rows loaded to test1
OK
Time taken: 59.979 seconds
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
scala&amp;gt; spark.sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT * FROM test1&quot;&lt;/span&gt;).show()
+---+
| id|
+---+
|  1|
|  1|
+---+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17380172" author="xkrogen" created="Tue, 13 Jul 2021 21:18:59 +0000"  >&lt;p&gt;Re-opening this issue based on &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shardulm&quot; class=&quot;user-hover&quot; rel=&quot;shardulm&quot;&gt;shardulm&lt;/a&gt;&apos;s example above demonstrating that this is indeed a real-world issue. We have faced this issue internally on a number of occasions and have been operating a fix, on which &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shardulm&quot; class=&quot;user-hover&quot; rel=&quot;shardulm&quot;&gt;shardulm&lt;/a&gt;&apos;s PR is based, for a few years.&lt;/p&gt;</comment>
                            <comment id="17384927" author="cloud_fan" created="Wed, 21 Jul 2021 14:42:39 +0000"  >&lt;p&gt;Issue resolved by pull request 33328&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/33328&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/33328&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13406921">SPARK-37027</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13243079">HIVE-21952</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 16 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z04f3k:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>