<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:51:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-18967] Locality preferences should be used when scheduling even when delay scheduling is turned off</title>
                <link>https://issues.apache.org/jira/browse/SPARK-18967</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;If you turn delay scheduling off by setting &lt;tt&gt;spark.locality.wait=0&lt;/tt&gt;, you effectively turn off the use the of locality preferences when there is a bulk scheduling event.  &lt;tt&gt;TaskSchedulerImpl&lt;/tt&gt; will use resources based on whatever random order it decides to shuffle them, rather than taking advantage of the most local options.&lt;/p&gt;

&lt;p&gt;This happens because &lt;tt&gt;TaskSchedulerImpl&lt;/tt&gt; offers resources to a &lt;tt&gt;TaskSetManager&lt;/tt&gt; one at a time, each time subject to a maxLocality constraint.  However, that constraint doesn&apos;t move through all possible locality levels &amp;#8211; it uses &lt;a href=&quot;https://github.com/apache/spark/blob/1a64388973711b4e567f25fa33d752066a018b49/core/src/main/scala/org/apache/spark/scheduler/TaskSchedulerImpl.scala#L360&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;tsm.myLocalityLevels&lt;/tt&gt; &lt;/a&gt;.  And &lt;tt&gt;tsm.myLocalityLevels&lt;/tt&gt; &lt;a href=&quot;https://github.com/apache/spark/blob/1a64388973711b4e567f25fa33d752066a018b49/core/src/main/scala/org/apache/spark/scheduler/TaskSetManager.scala#L953&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;skips locality levels completely if the wait == 0 &lt;/a&gt;.  So with delay scheduling off, &lt;tt&gt;TaskSchedulerImpl&lt;/tt&gt; immediately jumps to giving tsms the offers with &lt;tt&gt;maxLocality = ANY&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;WORKAROUND&lt;/b&gt;: instead of setting &lt;tt&gt;spark.locality.wait=0&lt;/tt&gt;, use &lt;tt&gt;spark.locality.wait=1ms&lt;/tt&gt;.  The one downside of this is if you have tasks that actually take less than 1ms.  You could even run into &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-18886&quot; title=&quot;Delay scheduling should not delay some executors indefinitely if one task is scheduled before delay timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-18886&quot;&gt;&lt;del&gt;SPARK-18886&lt;/del&gt;&lt;/a&gt;.  But that is a relatively unlikely scenario for real workloads.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13029848">SPARK-18967</key>
            <summary>Locality preferences should be used when scheduling even when delay scheduling is turned off</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="irashid">Imran Rashid</assignee>
                                    <reporter username="irashid">Imran Rashid</reporter>
                        <labels>
                    </labels>
                <created>Wed, 21 Dec 2016 18:23:40 +0000</created>
                <updated>Sun, 17 May 2020 17:48:19 +0000</updated>
                            <resolved>Tue, 7 Feb 2017 06:38:54 +0000</resolved>
                                    <version>2.1.0</version>
                                    <fixVersion>2.2.0</fixVersion>
                                    <component>Scheduler</component>
                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15767824" author="irashid" created="Wed, 21 Dec 2016 18:47:01 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kayousterhout&quot; class=&quot;user-hover&quot; rel=&quot;kayousterhout&quot;&gt;kayousterhout&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markhamstra&quot; class=&quot;user-hover&quot; rel=&quot;markhamstra&quot;&gt;markhamstra&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mridulm80&quot; class=&quot;user-hover&quot; rel=&quot;mridulm80&quot;&gt;mridulm80&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15768269" author="apachespark" created="Wed, 21 Dec 2016 21:52:04 +0000"  >&lt;p&gt;User &apos;squito&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/16376&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/16376&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15855615" author="rxin" created="Tue, 7 Feb 2017 09:14:11 +0000"  >&lt;p&gt;Please use 2.2.0, not 2.2&lt;/p&gt;</comment>
                            <comment id="15856842" author="kayousterhout" created="Tue, 7 Feb 2017 21:41:52 +0000"  >&lt;p&gt;Oops this was me &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rxin&quot; class=&quot;user-hover&quot; rel=&quot;rxin&quot;&gt;rxin&lt;/a&gt; sorry!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 40 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i37w4v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>