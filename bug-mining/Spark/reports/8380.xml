<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:29:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-36488] &quot;Invalid usage of &apos;*&apos; in expression&quot; error due to the feature of &apos;quotedRegexColumnNames&apos; in some scenarios.</title>
                <link>https://issues.apache.org/jira/browse/SPARK-36488</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;&#160;In some cases, the error happens when the following property is set.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
spark.sql(&lt;span class=&quot;code-quote&quot;&gt;&quot;set spark.sql.parser.quotedRegexColumnNames=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;b&gt;case 1:&lt;/b&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
spark-sql&amp;gt; create table tb_test as select 1 as col_a, 2 as col_b;
spark-sql&amp;gt; select `tb_test`.`col_a`  from tb_test;
1

spark-sql&amp;gt; set spark.sql.parser.quotedRegexColumnNames=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;

spark-sql&amp;gt; select `tb_test`.`col_a`  from tb_test;
Error in query: Invalid usage of &lt;span class=&quot;code-quote&quot;&gt;&apos;*&apos;&lt;/span&gt; in expression &lt;span class=&quot;code-quote&quot;&gt;&apos;unresolvedextractvalue&apos;&lt;/span&gt;


&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;case 2:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#160; &#160; &#160; &#160; &#160;&amp;gt; select `col_a`/`col_b` as `col_c` from (select 3 as `col_a` ,&#160; 3.14 as `col_b`);
0.955414

spark-sql&amp;gt; set spark.sql.parser.quotedRegexColumnNames=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;

spark-sql&amp;gt; select `col_a`/`col_b` as `col_c` from (select 3 as `col_a` ,&#160; 3.14 as `col_b`);

Error in query: Invalid usage of &lt;span class=&quot;code-quote&quot;&gt;&apos;*&apos;&lt;/span&gt; in expression &lt;span class=&quot;code-quote&quot;&gt;&apos;divide&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This problem exists in 3.X, 2.4.X and master versions.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Related issue &#65306;&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-12139&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-12139&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#65288;As can be seen in the latest comments, some people have encountered the same problem&#65289;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Similar problems&#65306;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-28897&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-28897&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13394826">SPARK-36488</key>
            <summary>&quot;Invalid usage of &apos;*&apos; in expression&quot; error due to the feature of &apos;quotedRegexColumnNames&apos; in some scenarios.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="planga82">Pablo Langa Blanco</assignee>
                                    <reporter username="merrily01">merrily01</reporter>
                        <labels>
                    </labels>
                <created>Thu, 12 Aug 2021 06:45:52 +0000</created>
                <updated>Mon, 14 Feb 2022 08:24:42 +0000</updated>
                            <resolved>Thu, 26 Aug 2021 03:34:05 +0000</resolved>
                                    <version>2.4.8</version>
                    <version>3.1.2</version>
                                    <fixVersion>3.3.0</fixVersion>
                                    <component>Spark Core</component>
                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17401401" author="planga82" created="Wed, 18 Aug 2021 23:14:48 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=merrily01&quot; class=&quot;user-hover&quot; rel=&quot;merrily01&quot;&gt;merrily01&lt;/a&gt; ,&lt;/p&gt;

&lt;p&gt;I think these are not bugs. As you can review in the documentation (&lt;a href=&quot;https://spark.apache.org/docs/latest/sql-ref-syntax-qry-select.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://spark.apache.org/docs/latest/sql-ref-syntax-qry-select.html&lt;/a&gt;) when you set the parameter spark.sql.parser.quotedRegexColumnNames=true &#8220;quoted identifiers (using backticks) in SELECT statement are interpreted as regular expressions and SELECT statement can take regex-based column specification&#8221;.&lt;/p&gt;

&lt;p&gt;In case 1, this means that in the expression `tb_test`.`col_a`&#160; tb_test is treated as a regular expression that represents a column. And this syntaxis&#160; &#8220;column.field&#8221; is used to access structType columns. And in this case it is not allowed to use regular expressions.&lt;/p&gt;

&lt;p&gt;In case 2, a regex can retrieve more than one column, for example `col_*` is resolved to col_a, col_b, so it does not make sense that the operators of a division are a list of columns, this is not allowed.&lt;/p&gt;

&lt;p&gt;I&#8217;m going to open a PR trying to improve the error message to avoid confusion.&lt;/p&gt;</comment>
                            <comment id="17402682" author="apachespark" created="Sat, 21 Aug 2021 19:43:02 +0000"  >&lt;p&gt;User &apos;planga82&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/33802&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/33802&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17403050" author="merrily01" created="Mon, 23 Aug 2021 09:00:42 +0000"  >&lt;p&gt;Hi&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=planga82&quot; class=&quot;user-hover&quot; rel=&quot;planga82&quot;&gt;planga82&lt;/a&gt;&#160; ,&lt;/p&gt;

&lt;p&gt;&#160; Thans for your attention and sorry for late reply.&lt;/p&gt;

&lt;p&gt;&#160;&#160;It&apos;s OK to improve the error message, but I don&apos;t quite agree with you that it is not a bug.&lt;/p&gt;

&lt;p&gt;&#160;&#160;Firstly, for a very common SQL, the query results of opening and closing parameters are different, which is not easy to accept. At least it can prove that this feature is not perfect.(I always feel that the regular expression of this feature should not deal with part &apos;database&apos;. )&lt;/p&gt;

&lt;p&gt;&#160; Secondly, at&#160;the begining, this feature was compatible with and reference to hive feature.&#160;But now, the above cases can be executed normally when turn on the feature in Hive, Spak has a problem.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17403329" author="planga82" created="Mon, 23 Aug 2021 18:23:41 +0000"  >&lt;p&gt;Yes, I&apos;m with you that it&apos;s not very intuitive and it have&#160;room for improvement. I think it&apos;s interesting to take a closer look to support more expressions and to be more close to hive feature.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="17404883" author="cloud_fan" created="Thu, 26 Aug 2021 03:34:05 +0000"  >&lt;p&gt;Issue resolved by pull request 33802&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/33802&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/33802&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17491858" author="apachespark" created="Mon, 14 Feb 2022 08:23:34 +0000"  >&lt;p&gt;User &apos;LuciferYang&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/35508&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/35508&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17491859" author="apachespark" created="Mon, 14 Feb 2022 08:24:42 +0000"  >&lt;p&gt;User &apos;LuciferYang&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/35508&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/35508&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 39 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0tu2o:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>