<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:18:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-32092] CrossvalidatorModel does not save all submodels (it saves only 3)</title>
                <link>https://issues.apache.org/jira/browse/SPARK-32092</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;When saving a CrossValidatorModel with more than 3 subModels and loading again, a different amount of subModels is returned. It seems every time 3 subModels are returned.&lt;/p&gt;

&lt;p&gt;With less than two submodels (so 2 folds) writing plainly fails.&lt;/p&gt;

&lt;p&gt;Issue seems to be (but I am not so familiar with the scala/java side)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;python object is converted to scala/java&lt;/li&gt;
	&lt;li&gt;in scala we save subModels until numFolds:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
val subModelsPath = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Path(path, &lt;span class=&quot;code-quote&quot;&gt;&quot;subModels&quot;&lt;/span&gt;) 
       &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (splitIndex &amp;lt;- 0 until instance.getNumFolds) {
          val splitPath = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Path(subModelsPath, s&lt;span class=&quot;code-quote&quot;&gt;&quot;fold${splitIndex.toString}&quot;&lt;/span&gt;)
          &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (paramIndex &amp;lt;- 0 until instance.getEstimatorParamMaps.length) {
            val modelPath = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Path(splitPath, paramIndex.toString).toString
            instance.subModels(splitIndex)(paramIndex).asInstanceOf[MLWritable].save(modelPath)
          }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;ul&gt;
	&lt;li&gt;numFolds is not available on the CrossValidatorModel in pyspark&lt;/li&gt;
	&lt;li&gt;default numFolds is 3 so somehow it tries to save 3 subModels.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The first issue can be reproduced by following failing tests, where spark is a SparkSession and tmp_path is a (temporary) directory.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
from pyspark.ml.tuning &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; ParamGridBuilder, CrossValidator, CrossValidatorModel
from pyspark.ml.classification &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; LogisticRegression
from pyspark.ml.evaluation &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; BinaryClassificationEvaluator
from pyspark.ml.linalg &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; Vectors


def test_save_load_cross_validator(spark, tmp_path):
    temp_path = str(tmp_path)
    dataset = spark.createDataFrame(
        [
            (Vectors.dense([0.0]), 0.0),
            (Vectors.dense([0.4]), 1.0),
            (Vectors.dense([0.5]), 0.0),
            (Vectors.dense([0.6]), 1.0),
            (Vectors.dense([1.0]), 1.0),
        ]
        * 10,
        [&lt;span class=&quot;code-quote&quot;&gt;&quot;features&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;label&quot;&lt;/span&gt;],
    )

    lr = LogisticRegression()

    grid = ParamGridBuilder().addGrid(lr.maxIter, [0, 1]).build()

    evaluator = BinaryClassificationEvaluator()

    cv = CrossValidator(
        estimator=lr,
        estimatorParamMaps=grid,
        evaluator=evaluator,
        collectSubModels=True,
        numFolds=4,
    )

    cvModel = cv.fit(dataset)

    # test save/load of CrossValidatorModel

    cvModelPath = temp_path + &lt;span class=&quot;code-quote&quot;&gt;&quot;/cvModel&quot;&lt;/span&gt;

    cvModel.write().overwrite().save(cvModelPath)

    loadedModel = CrossValidatorModel.load(cvModelPath)
    &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; len(loadedModel.subModels) == len(cvModel.subModels)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;br/&gt;
The second as follows (will fail writing):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
from pyspark.ml.tuning &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; ParamGridBuilder, CrossValidator, CrossValidatorModel
from pyspark.ml.classification &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; LogisticRegression
from pyspark.ml.evaluation &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; BinaryClassificationEvaluator
from pyspark.ml.linalg &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; Vectors


def test_save_load_cross_validator(spark, tmp_path):
    temp_path = str(tmp_path)
    dataset = spark.createDataFrame(
        [
            (Vectors.dense([0.0]), 0.0),
            (Vectors.dense([0.4]), 1.0),
            (Vectors.dense([0.5]), 0.0),
            (Vectors.dense([0.6]), 1.0),
            (Vectors.dense([1.0]), 1.0),
        ]
        * 10,
        [&lt;span class=&quot;code-quote&quot;&gt;&quot;features&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;label&quot;&lt;/span&gt;],
    )

    lr = LogisticRegression()

    grid = ParamGridBuilder().addGrid(lr.maxIter, [0, 1]).build()

    evaluator = BinaryClassificationEvaluator()

    cv = CrossValidator(
        estimator=lr,
        estimatorParamMaps=grid,
        evaluator=evaluator,
        collectSubModels=True,
        numFolds=2,
    )

    cvModel = cv.fit(dataset)

    # test save/load of CrossValidatorModel

    cvModelPath = temp_path + &lt;span class=&quot;code-quote&quot;&gt;&quot;/cvModel&quot;&lt;/span&gt;

    cvModel.write().overwrite().save(cvModelPath)

    loadedModel = CrossValidatorModel.load(cvModelPath)
    &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; len(loadedModel.subModels) == len(cvModel.subModels)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;br/&gt;
&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;Ran on two systems:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Local pyspark installation (Windows): spark 2.4.5&lt;/li&gt;
	&lt;li&gt;Spark 2.4.0 on a cluster&lt;/li&gt;
&lt;/ul&gt;
</environment>
        <key id="13313277">SPARK-32092</key>
            <summary>CrossvalidatorModel does not save all submodels (it saves only 3)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="xzrspark">Zirui Xu</assignee>
                                    <reporter username="ADR">An De Rijdt</reporter>
                        <labels>
                    </labels>
                <created>Wed, 24 Jun 2020 15:25:07 +0000</created>
                <updated>Wed, 26 Aug 2020 23:12:55 +0000</updated>
                            <resolved>Sat, 22 Aug 2020 14:29:04 +0000</resolved>
                                    <version>2.4.0</version>
                    <version>2.4.5</version>
                                    <fixVersion>3.0.1</fixVersion>
                    <fixVersion>3.1.0</fixVersion>
                                    <component>ML</component>
                    <component>PySpark</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17178101" author="xzrspark" created="Fri, 14 Aug 2020 23:30:54 +0000"  >&lt;p&gt;I think CrossValidatorModel.copy() is affected by a similar issue of losing numFolds too. I will attempt a fix.&lt;/p&gt;</comment>
                            <comment id="17178484" author="apachespark" created="Sun, 16 Aug 2020 14:07:15 +0000"  >&lt;p&gt;User &apos;Louiszr&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/29445&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/29445&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17178485" author="apachespark" created="Sun, 16 Aug 2020 14:07:53 +0000"  >&lt;p&gt;User &apos;Louiszr&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/29445&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/29445&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17182396" author="srowen" created="Sat, 22 Aug 2020 14:29:04 +0000"  >&lt;p&gt;Issue resolved by pull request 29445&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/29445&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/29445&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17182791" author="apachespark" created="Sun, 23 Aug 2020 17:44:16 +0000"  >&lt;p&gt;User &apos;Louiszr&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/29524&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/29524&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17182792" author="apachespark" created="Sun, 23 Aug 2020 17:44:48 +0000"  >&lt;p&gt;User &apos;Louiszr&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/29524&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/29524&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17185517" author="apachespark" created="Wed, 26 Aug 2020 23:12:31 +0000"  >&lt;p&gt;User &apos;Louiszr&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/29553&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/29553&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17185518" author="apachespark" created="Wed, 26 Aug 2020 23:12:55 +0000"  >&lt;p&gt;User &apos;Louiszr&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/29553&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/29553&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 11 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0g5ww:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>