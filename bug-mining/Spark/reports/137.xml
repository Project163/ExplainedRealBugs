<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:12:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-1350] YARN ContainerLaunchContext should use cluster&apos;s JAVA_HOME</title>
                <link>https://issues.apache.org/jira/browse/SPARK-1350</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; javaCommand = &lt;span class=&quot;code-quote&quot;&gt;&quot;java&quot;&lt;/span&gt;
    val javaHome = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.getenv(&lt;span class=&quot;code-quote&quot;&gt;&quot;JAVA_HOME&quot;&lt;/span&gt;)
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ((javaHome != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; !javaHome.isEmpty()) || env.isDefinedAt(&lt;span class=&quot;code-quote&quot;&gt;&quot;JAVA_HOME&quot;&lt;/span&gt;)) {
      javaCommand = Environment.JAVA_HOME.$() + &lt;span class=&quot;code-quote&quot;&gt;&quot;/bin/java&quot;&lt;/span&gt;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Currently, if JAVA_HOME is specified on the client, it will be used instead of the value given on the cluster.  This makes it so that Java must be installed in the same place on the client as on the cluster.&lt;/p&gt;

&lt;p&gt;This is a possibly incompatible change that we should get in before 1.0.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12704628">SPARK-1350</key>
            <summary>YARN ContainerLaunchContext should use cluster&apos;s JAVA_HOME</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sandyr">Sandy Ryza</assignee>
                                    <reporter username="sandyr">Sandy Ryza</reporter>
                        <labels>
                    </labels>
                <created>Fri, 28 Mar 2014 16:22:57 +0000</created>
                <updated>Fri, 9 Jan 2015 04:19:18 +0000</updated>
                            <resolved>Fri, 4 Apr 2014 13:56:16 +0000</resolved>
                                    <version>0.9.0</version>
                                    <fixVersion>1.0.0</fixVersion>
                                    <component>YARN</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13955209" author="tgraves" created="Mon, 31 Mar 2014 14:25:57 +0000"  >&lt;p&gt;I assume you are referring to the one in ClientBase?&lt;/p&gt;

&lt;p&gt;It actually does not use the same java as specified by JAVA_HOME on the client.  If JAVA_HOME is set on the client then it just adds $JAVA_HOME/bin to the java command to launch the AM. Yarn can be configured (and is the default config) to put JAVA_HOME into the container launch script, so the launch command will use the JAVA_HOME specified by yarn.   I agree its a bit hacky and could be improved though.  On MapReduce it just always uses &quot;$JAVA_HOME/bin/java&quot;&lt;/p&gt;

&lt;p&gt;The main idea is that I want $JAVA_HOME to be included in the launch command so that its not relying on the default install of java on the system.  I want it to use the JAVA_HOME specified by yarn and I also want to allow it to be overridden so that a user could choose to run either 32 bit or 64 bit jdk.  &lt;/p&gt;

&lt;p&gt;export SPARK_YARN_USER_ENV=&quot;JAVA_HOME=/myyarinstall/jdk64/current&quot;&lt;/p&gt;

&lt;p&gt;I was told this goes against how spark is in general setup where it relies on whatever is installed on the system so this was the compromise.&lt;/p&gt;
</comment>
                            <comment id="13955422" author="sandyr" created="Mon, 31 Mar 2014 17:39:43 +0000"  >&lt;blockquote&gt;&lt;p&gt;It actually does not use the same java as specified by JAVA_HOME on the client.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Oops, you&apos;re right.  I was misunderstanding the code.  This is less of a big deal than I thought.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The main idea is that I want $JAVA_HOME to be included in the launch command so that its not relying on the default install of java on the system.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I 100% agree that this is the right thing to do.  What still seems a little weird to me is that the use of JAVA_HOME on the cluster depends on whether the client JAVA_HOME is set.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I was told this goes against how spark is in general setup where it relies on whatever is installed on the system so this was the compromise.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;So this has already been discussed and always using JAVA_HOME in the launch command (never just &quot;java&quot;) was rejected for this reason?  If all YARN apps accessed java in the same way, the way that MapReduce does, I think it would make things a lot simpler operationally.&lt;/p&gt;</comment>
                            <comment id="13955443" author="tgraves" created="Mon, 31 Mar 2014 17:52:40 +0000"  >&lt;p&gt;I agree it is weird, lets bring this back up and see if we can just always use $JAVA_HOME.  This is yarn specific code so shouldn&apos;t affect other parts of spark.  I don&apos;t know if anyone would run YARN without this being set.&lt;/p&gt;

&lt;p&gt;Patrick, Mridul,  any objections to changing this?&lt;/p&gt;</comment>
                            <comment id="13955753" author="sandyr" created="Mon, 31 Mar 2014 21:42:25 +0000"  >&lt;p&gt;+ &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pwendell&quot; class=&quot;user-hover&quot; rel=&quot;pwendell&quot;&gt;pwendell&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mridulm%40yahoo-inc.com&quot; class=&quot;user-hover&quot; rel=&quot;mridulm@yahoo-inc.com&quot;&gt;mridulm@yahoo-inc.com&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13955978" author="mridulm80" created="Tue, 1 Apr 2014 01:17:59 +0000"  >
&lt;p&gt;We will need a way to configure JAVA_HOME (like the 32bit vs 64bit case Tom mentioned about : which is used quite often)&lt;/p&gt;

&lt;p&gt;Tom, is there a way to do this within context of yarn ? Ability to override the JAVA_HOME used via some config ?&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;If yes, we should leverage that and always use $JAVA_HOME/bin/java in our code.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;If not, let us continue with what we currently have : it is the best we can currently do.&lt;/p&gt;</comment>
                            <comment id="13955982" author="sandyr" created="Tue, 1 Apr 2014 01:25:11 +0000"  >&lt;blockquote&gt;&lt;p&gt;Tom, is there a way to do this within context of yarn ? Ability to override the JAVA_HOME used via some config ?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The submitter can set a different JAVA_HOME in SPARK_YARN_USER_ENV.  Any properties placed there will override versions of these properties in the YARN NodeManager&apos;s environment.&lt;/p&gt;</comment>
                            <comment id="13955997" author="mridulm80" created="Tue, 1 Apr 2014 01:39:04 +0000"  >&lt;p&gt;You mistook my question; I meant in context of yarn - not in context of spark over yarn.&lt;/p&gt;</comment>
                            <comment id="13956066" author="sandyr" created="Tue, 1 Apr 2014 03:33:06 +0000"  >&lt;p&gt;Ah, sorry.  YARN doesn&apos;t have any configs for this.  The container environment is the environment of the NodeManager process, a few additional variables YARN adds such as the container ID and user name, and anything specified by the application in the ContainerLaunchContext.&lt;/p&gt;</comment>
                            <comment id="13959975" author="tgraves" created="Fri, 4 Apr 2014 13:56:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/spark/pull/313&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/313&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14237525" author="aniket" created="Mon, 8 Dec 2014 06:54:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sandyr&quot; class=&quot;user-hover&quot; rel=&quot;sandyr&quot;&gt;sandyr&lt;/a&gt; Using Environment.JAVA_HOME.$() causes issues while submitting spark applications from a windows box into a Yarn cluster running on Linux (with spark master set as yarn-client). This is because Environment.JAVA_HOME.$() resolves to %JAVA_HOME% which results in not a valid executable on Linux. Is this a Spark issue or a YARN issue?&lt;/p&gt;</comment>
                            <comment id="14237914" author="tgraves" created="Mon, 8 Dec 2014 14:44:29 +0000"  >&lt;p&gt; which version of hadoop are you using?  Spark is using Environment.JAVA_HOME.$() but Environment is a hadoop class and its supposed to handle windows:&lt;/p&gt;

&lt;p&gt;   public String $() {&lt;br/&gt;
      if (Shell.WINDOWS) &lt;/p&gt;
{
        return &quot;%&quot; + variable + &quot;%&quot;;
      }
&lt;p&gt; else &lt;/p&gt;
{
        return &quot;$&quot; + variable;
      }
&lt;p&gt;    }&lt;/p&gt;</comment>
                            <comment id="14239060" author="aniket" created="Tue, 9 Dec 2014 06:50:38 +0000"  >&lt;p&gt;I am using hadoop 2.5.0 (CDH). Agreed that it handles for windows. But the use case I am talking about is when SparkContext is created programmatically on a windows machine and is used to submit jobs on a yarn cluster running on Linux. As per above code, %JAVA_HOME%/bin/java will be generated as one of the commands by ClientBase and submitted to YARN cluster. This will obviously fail while YARN tries to execute the container as % is treated differently in linux.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12765939">SPARK-5164</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>382859</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 50 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1tyk7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>383127</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>