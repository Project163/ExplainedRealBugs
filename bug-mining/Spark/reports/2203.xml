<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:30:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-8881] Standalone mode scheduling fails because cores assignment is not atomic</title>
                <link>https://issues.apache.org/jira/browse/SPARK-8881</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Current scheduling algorithm (in Master.scala) has two issues:&lt;/p&gt;

&lt;p&gt;1. cores are allocated one at a time instead of spark.executor.cores at a time&lt;br/&gt;
2. when spark.cores.max/spark.executor.cores &amp;lt; num_workers, executors are not launched and the app hangs (due to 1)&lt;/p&gt;

&lt;p&gt;=== Edit by Andrew ===&lt;/p&gt;

&lt;p&gt;Here&apos;s an example from the PR. Let&apos;s say we have 4 workers with 16 cores each. We set `spark.cores.max` to 48 and `spark.executor.cores` to 16. Because in spread out mode, the existing code allocates 1 core at a time, we end up allocating 12 cores on each worker, and no executors can be launched because each one wants at least 16 cores. Instead, we should allocate 16 cores at a time.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12843356">SPARK-8881</key>
            <summary>Standalone mode scheduling fails because cores assignment is not atomic</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nravi">Nishkam Ravi</assignee>
                                    <reporter username="nravi">Nishkam Ravi</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Jul 2015 00:06:06 +0000</created>
                <updated>Sun, 26 Jul 2015 05:56:50 +0000</updated>
                            <resolved>Sun, 26 Jul 2015 05:56:50 +0000</resolved>
                                    <version>1.4.0</version>
                    <version>1.5.0</version>
                                    <fixVersion>1.4.2</fixVersion>
                    <fixVersion>1.5.0</fixVersion>
                                    <component>Deploy</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14617712" author="srowen" created="Wed, 8 Jul 2015 00:22:07 +0000"  >&lt;p&gt;I think this needs better explanation. So you are asking for 8 cores per executor and all workers have 7 cores available, and the result is that no executors are allocated, and the app is still waiting for executors. That seems like correct behavior, right?&lt;/p&gt;

&lt;p&gt;Cores aren&apos;t really allocated one at a time; in &quot;spreadOut&quot; mode the target allocation amount is spread around, but executors (only) launch with the # of cores desired. Grabbing 8 cores at that phase in each pass wouldn&apos;t help, since none have 8 cores available. &lt;/p&gt;

&lt;p&gt;What does it have to do with the number of workers?&lt;/p&gt;</comment>
                            <comment id="14617714" author="apachespark" created="Wed, 8 Jul 2015 00:23:02 +0000"  >&lt;p&gt;User &apos;nishkamravi2&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/7274&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/7274&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14617732" author="nravi" created="Wed, 8 Jul 2015 00:37:56 +0000"  >&lt;p&gt;No that&apos;s not the problem.&lt;/p&gt;

&lt;p&gt;You have 4 workers with 16 cores each. You request 3 executors (spark.cores.max = 48, spark.executor.cores = 16). App hangs. Because the following condition is never satisfied: while (coresLeft &amp;gt;= coresPerExecutor &amp;amp;&amp;amp; worker.memoryFree &amp;gt;= memoryPerExecutor). You will have to stare at the scheduling algorithm for a good 5 minutes to understand what&apos;s happening. Try to simulate the case stated above. &lt;/p&gt;</comment>
                            <comment id="14618313" author="srowen" created="Wed, 8 Jul 2015 09:56:30 +0000"  >&lt;p&gt;Yes, the punchline is that each worker is asked for 48/4 = 12 cores, but 12 is less than the 16 cores each executor needs, so for every worker, 0 executors are allocated. Grabbing cores in chunks of 16 in this case works, as does only considering 3 workers to allocate 3 executors, since the problem is that it never makes sense to try allocating N executors over M&amp;gt;N workers.&lt;/p&gt;</comment>
                            <comment id="14618362" author="nravi" created="Wed, 8 Jul 2015 10:30:33 +0000"  >&lt;p&gt;There&apos;s more to it. Consider the following: three workers with num_cores (8, 8, 2). spark.cores.maximum = 12, spark.executor.cores = 4. Core allocation would be (5, 5, 2). num_executors = num_workers and nothing gets launched! &lt;/p&gt;

&lt;p&gt;Problem isn&apos;t that num_workers &amp;gt; num_executors (that&apos;s just a place it manifests in practice). Problem is we are allocating one core at a time and ignoring spark.executor.cores during allocation.&lt;/p&gt;</comment>
                            <comment id="14618369" author="nravi" created="Wed, 8 Jul 2015 10:43:46 +0000"  >&lt;p&gt;This isn&apos;t the best example because the third worker will get screened out. Consider the following instead: three workers with num_cores (8, 8, 3). spark.cores.maximum=8, spark.executor.cores=2. Core allocation would be (3, 3, 2). 3 executors launched instead of 4. You get the drift.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 19 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2gysv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12332833">1.4.2</customfieldvalue>
    <customfieldvalue id="12332078">1.5.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>