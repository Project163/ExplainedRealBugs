<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:07:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-24666] Word2Vec generate infinity vectors when numIterations are large</title>
                <link>https://issues.apache.org/jira/browse/SPARK-24666</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;We found that Word2Vec generate&#160;large&#160;absolute value vectors when numIterations are large, and if&#160;numIterations are large enough (&amp;gt;20), the vector&apos;s value many be&#160;&lt;b&gt;infinity(or -&lt;/b&gt;&lt;b&gt;infinity)&lt;/b&gt;**, resulting in useless vectors.&lt;/p&gt;

&lt;p&gt;In normal situations, vectors values are mainly around -1.0~1.0 when numIterations = 1.&lt;/p&gt;

&lt;p&gt;The bug&#160;is shown on spark 2.0.X, 2.1.X, 2.2.X, 2.3.X, 2.4.X&lt;/p&gt;

&lt;p&gt;There are already issues report this bug: &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-5261&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-5261&lt;/a&gt;&#160;, but the bug fix works seems missing.&lt;/p&gt;

&lt;p&gt;Other people&apos;s reports:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://stackoverflow.com/questions/49741956/infinity-vectors-in-spark-mllib-word2vec&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://stackoverflow.com/questions/49741956/infinity-vectors-in-spark-mllib-word2vec&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://apache-spark-user-list.1001560.n3.nabble.com/word2vec-outputs-Infinity-Infinity-vectors-with-increasing-iterations-td29020.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://apache-spark-user-list.1001560.n3.nabble.com/word2vec-outputs-Infinity-Infinity-vectors-with-increasing-iterations-td29020.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;=======================================================&lt;/p&gt;

&lt;p&gt;Here are the code to reproduce the issue. You can download&#160;title.akas.tsv from &lt;a href=&quot;https://datasets.imdbws.com/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://datasets.imdbws.com/&lt;/a&gt;&#160;and upload to hdfs.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.sql.SparkSession
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.ml.feature.Word2Vec

&lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Sentences(name: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, words: Array[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;])

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; spark.implicits._

&lt;span class=&quot;code-comment&quot;&gt;// IMDB raw data title.akas.tsv download from https://datasets.imdbws.com/
&lt;/span&gt;val dataset = spark.read
  .option(&lt;span class=&quot;code-quote&quot;&gt;&quot;header&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;).option(&lt;span class=&quot;code-quote&quot;&gt;&quot;sep&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;\t&quot;&lt;/span&gt;)
  .option(&lt;span class=&quot;code-quote&quot;&gt;&quot;quote&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;).option(&quot;&lt;/span&gt;nullValue&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;\\N&quot;)
  .csv(&lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/word2vec/title.akas.tsv&quot;&lt;/span&gt;)
  .filter(&lt;span class=&quot;code-quote&quot;&gt;&quot;region = &lt;span class=&quot;code-quote&quot;&gt;&apos;US&apos;&lt;/span&gt; or language = &lt;span class=&quot;code-quote&quot;&gt;&apos;en&apos;&lt;/span&gt;&quot;&lt;/span&gt;)
  .select(&lt;span class=&quot;code-quote&quot;&gt;&quot;title&quot;&lt;/span&gt;)
  .as[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;]
  .map(s =&amp;gt; Sentences(s, s.split(&lt;span class=&quot;code-quote&quot;&gt;&apos; &apos;&lt;/span&gt;)))
  .persist()

println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Training model...&quot;&lt;/span&gt;)
val word2Vec = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Word2Vec()
  .setInputCol(&lt;span class=&quot;code-quote&quot;&gt;&quot;words&quot;&lt;/span&gt;)
  .setOutputCol(&lt;span class=&quot;code-quote&quot;&gt;&quot;vector&quot;&lt;/span&gt;)
  .setVectorSize(64)
  .setWindowSize(4)
  .setNumPartitions(50)
  .setMinCount(5)
  .setMaxIter(20)
val model = word2Vec.fit(dataset)

model.getVectors.show()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;When set maxIter to 30, you will get the result.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
scala&amp;gt; model.getVectors.show()
+-------------+--------------------+
|         word|              vector|
+-------------+--------------------+
|     Unspoken|[-Infinity,-Infin...|
|       Talent|[Infinity,-Infini...|
|    Hourglass|[1.09657520526310...|
|Nickelodeon&apos;s|[2.20436549446219...|
|      Priests|[-1.9625896848389...|
|    Religion:|[-3.8815759928213...|
|           Bu|[-7.9722236466752...|
|      Totoro:|[-4.1829056206528...|
|     Trouble,|[2.51985378203136...|
|       Hatter|[8.49108115961009...|
|          &apos;79|[-5.4560309784650...|
|         Vile|[-1.2059769646379...|
|         9/11|[Infinity,-Infini...|
|      Santino|[6.30405421282099...|
|      Motives|[1.96207712570869...|
|          &apos;13|[-1.7641987324084...|
|       Fierce|[-Infinity,Infini...|
|       Stover|[5.10057474120744...|
|          &apos;It|[1.08629989605664...|
|        Butts|[Infinity,Infinit...|
+-------------+--------------------+
only showing top 20 rows
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In this case, set&#160;maxIter to 20 may not generate Infinity but very large absolute values. It depends on the training data sample and other configurations.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
scala&amp;gt; model.getVectors.show(2,&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
+--------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|word    |vector                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
+--------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|Unspoken|[-8.345756381631837E26,-4.521902763541592E26,-2.3382486258889084E27,-1.0244081299466769E27,-2.0078509112460803E27,-1.6760533100889865E27,-2.582670788770659E27,-3.38100521565687E26,1.7553847873565714E27,-1.170131062449021E27,-1.6565472801835883E27,-1.5594244347657445E27,-2.5150639513558596E26,1.949539129915606E27,-7.580918216717454E26,1.2361994783015613E27,-3.152053008864166E27,-8.185652662597534E26,-5.4443628225426E25,2.245579525466733E26,-1.97655047590181E27,2.8597275293150673E26,-1.1006336920210832E27,1.6166580407985987E27,1.5272882143409825E26,-1.0115330404529906E27,-1.8895683222101184E27,2.6156506156954E27,-1.698058504881491E27,-1.5132098806248563E27,3.7327358519511804E27,1.3356636582642166E27,2.3614379909704805E26,8.96912646624494E26,1.5518857669716535E27,-3.05221863964144E27,4.399680909202177E26,-2.607914789100649E27,-1.4080384994067242E27,2.7666078487221474E27,6.946950108699123E26,-1.1122679059344192E27,-2.3621557537823886E27,9.433206702172274E26,-2.3704690372536228E27,2.5086034219659006E27,2.0173186657484236E27,-1.8448836672357273E27,-1.5081404202054957E27,2.641836064055936E26,-5.613083015733733E26,-2.1296579720982533E26,-1.6550184140347592E27,-1.9152898718506886E27,1.25699596863538E27,-2.0774912070471012E27,-1.5454685136432914E27,-2.479843324641509E27,1.5560216745669318E27,-2.2176656540799786E27,-9.628781296451031E26,1.3663974096305426E27,1.6326327735924786E27,-1.9533865304335714E27]|
|Talent  |[1.3996313289146157E31,-2.216329024373106E31,1.0729251707928603E31,-4.007120754159977E31,-7.217488429248302E30,3.579654497535965E31,2.7979270365837212E31,4.333613174196825E31,3.2947832174019738E31,-1.770444782887265E31,-1.1996572271408077E31,1.9686960444755403E31,-5.211369239778517E31,4.559579301984929E31,8.789691017490939E30,-3.3896103915518896E31,-2.842517781869879E31,3.653230690058367E31,1.6690004323711066E31,-1.1803405268246773E31,4.577673536512265E31,3.9686553942166427E31,-2.0779652882517364E31,9.553626958941078E29,-1.1967228014988571E31,2.667234660143298E31,-5.082234231802067E29,-5.053934698852727E31,2.911363689445293E31,4.57440169967406E31,2.296044625777839E31,3.4719839372636273E31,-4.753091634806606E30,-2.2139650908254315E31,5.747913246328898E31,-4.027332301367786E31,-3.3981312029599884E30,-3.235915541756495E31,-3.690297564613571E31,3.6645060993927487E31,2.32138854666024E31,-4.79833731565554E31,2.4538652976104142E31,4.91394707312416E30,2.2888500664401483E31,8.433142525511996E30,-2.3447174299865074E31,-3.9894235308718024E31,1.6571656530599892E31,3.743449438983912E31,5.619889452742693E31,2.0932366809902723E31,-2.2306515916821173E30,-4.2788883664425833E30,-8.754273117753689E30,-3.8767150140313846E30,-3.7649840346087072E31,-3.604430948638639E31,5.083292737026576E31,2.92915351645125E31,5.971055806972711E31,1.4773152095869043E31,5.12252479772471E31,3.035571146004139E31]                     |
+--------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
only showing top 2 rows

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;&#160;2.0.X, 2.1.X, 2.2.X, 2.3.X, 2.4.X&lt;/p&gt;</environment>
        <key id="13168540">SPARK-24666</key>
            <summary>Word2Vec generate infinity vectors when numIterations are large</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="viirya">L. C. Hsieh</assignee>
                                    <reporter username="zhongyu09">Yu Zhong</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Jun 2018 07:20:57 +0000</created>
                <updated>Mon, 20 Jan 2020 01:24:53 +0000</updated>
                            <resolved>Fri, 6 Dec 2019 00:33:54 +0000</resolved>
                                    <version>2.3.1</version>
                    <version>2.4.4</version>
                                    <fixVersion>2.4.5</fixVersion>
                    <fixVersion>3.1.0</fixVersion>
                                    <component>ML</component>
                    <component>MLlib</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16534574" author="zhongyu09" created="Fri, 6 Jul 2018 08:32:04 +0000"  >&lt;p&gt;Anyone else?&lt;/p&gt;</comment>
                            <comment id="16536538" author="viirya" created="Mon, 9 Jul 2018 05:10:04 +0000"  >&lt;p&gt;Is it possible you can provide an example dataset and code to reproduce this issue?&lt;/p&gt;</comment>
                            <comment id="16539865" author="zhongyu09" created="Wed, 11 Jul 2018 10:30:28 +0000"  >&lt;p&gt;It is very easy to reproduce. We have about 600,000 words and 10,000,000 dataset. Just set&#160;numIterations = 20 and you will find it.&lt;/p&gt;</comment>
                            <comment id="16885302" author="zhongyu09" created="Mon, 15 Jul 2019 14:48:22 +0000"  >&lt;p&gt;Not any update for one year?&lt;/p&gt;</comment>
                            <comment id="16908267" author="holdenk" created="Thu, 15 Aug 2019 16:34:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhongyu09&quot; class=&quot;user-hover&quot; rel=&quot;zhongyu09&quot;&gt;zhongyu09&lt;/a&gt;specific code &amp;amp; data which leads to repro can help.&lt;/p&gt;</comment>
                            <comment id="16914950" author="viirya" created="Sat, 24 Aug 2019 13:22:38 +0000"  >&lt;p&gt;I tried to run word2vec with Quora Question Pairs dataset. Set max iteration 20, but can&apos;t reproduce this.&lt;/p&gt;</comment>
                            <comment id="16957623" author="yhao2014" created="Wed, 23 Oct 2019 07:26:50 +0000"  >&lt;p&gt;I also get this question, and my spark version is 2.1.0. I used 1000w record for train and words size is about 100w. When the&#160;numIterations&amp;gt;10, the vectors generated contain&#160;&lt;b&gt;infinity&lt;/b&gt; and &lt;b&gt;NaN&lt;/b&gt;.&lt;/p&gt;</comment>
                            <comment id="16978077" author="zhongyu09" created="Wed, 20 Nov 2019 05:25:13 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=viirya&quot; class=&quot;user-hover&quot; rel=&quot;viirya&quot;&gt;viirya&lt;/a&gt;&#160;and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=holden&quot; class=&quot;user-hover&quot; rel=&quot;holden&quot;&gt;holden&lt;/a&gt;, I put data and code to reproduce this issues.&lt;/p&gt;</comment>
                            <comment id="16978080" author="viirya" created="Wed, 20 Nov 2019 05:28:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhongyu09&quot; class=&quot;user-hover&quot; rel=&quot;zhongyu09&quot;&gt;zhongyu09&lt;/a&gt; Thanks! I will look into this and see if I can reproduce it.&lt;/p&gt;</comment>
                            <comment id="16989278" author="viirya" created="Fri, 6 Dec 2019 00:33:54 +0000"  >&lt;p&gt;Issue resolved by pull request 26722&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/26722&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/26722&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 49 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3va3j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>