<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:23:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-4983] Add sleep() before tagging EC2 instances to allow instance metadata to propagate</title>
                <link>https://issues.apache.org/jira/browse/SPARK-4983</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;We launch EC2 instances in &lt;tt&gt;spark-ec2&lt;/tt&gt; and then immediately tag them in a separate boto call. Sometimes, EC2 doesn&apos;t get enough time to propagate information about the just-launched instances, so when we go to tag them we get a server that doesn&apos;t know about them yet.&lt;/p&gt;

&lt;p&gt;This yields the following type of error:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Launching instances...
Launched 1 slaves in us-east-1b, regid = r-cf780321
Launched master in us-east-1b, regid = r-da7e0534
Traceback (most recent call last):
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;./ec2/spark_ec2.py&quot;&lt;/span&gt;, line 1284, in &amp;lt;module&amp;gt;
    main()
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;./ec2/spark_ec2.py&quot;&lt;/span&gt;, line 1276, in main
    real_main()
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;./ec2/spark_ec2.py&quot;&lt;/span&gt;, line 1122, in real_main
    (master_nodes, slave_nodes) = launch_cluster(conn, opts, cluster_name)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;./ec2/spark_ec2.py&quot;&lt;/span&gt;, line 646, in launch_cluster
    value=&lt;span class=&quot;code-quote&quot;&gt;&apos;{cn}-master-{iid}&apos;&lt;/span&gt;.format(cn=cluster_name, iid=master.id))
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;.../spark/ec2/lib/boto-2.34.0/boto/ec2/ec2object.py&quot;&lt;/span&gt;, line 80, in add_tag
    self.add_tags({key: value}, dry_run)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;.../spark/ec2/lib/boto-2.34.0/boto/ec2/ec2object.py&quot;&lt;/span&gt;, line 97, in add_tags
    dry_run=dry_run
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;.../spark/ec2/lib/boto-2.34.0/boto/ec2/connection.py&quot;&lt;/span&gt;, line 4202, in create_tags
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; self.get_status(&lt;span class=&quot;code-quote&quot;&gt;&apos;CreateTags&apos;&lt;/span&gt;, params, verb=&lt;span class=&quot;code-quote&quot;&gt;&apos;POST&apos;&lt;/span&gt;)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;.../spark/ec2/lib/boto-2.34.0/boto/connection.py&quot;&lt;/span&gt;, line 1223, in get_status
    raise self.ResponseError(response.status, response.reason, body)
boto.exception.EC2ResponseError: EC2ResponseError: 400 Bad Request
&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;
&amp;lt;Response&amp;gt;&amp;lt;Errors&amp;gt;&amp;lt;Error&amp;gt;&amp;lt;Code&amp;gt;InvalidInstanceID.NotFound&amp;lt;/Code&amp;gt;&amp;lt;Message&amp;gt;The instance ID &lt;span class=&quot;code-quote&quot;&gt;&apos;i-585219a6&apos;&lt;/span&gt; does not exist&amp;lt;/Message&amp;gt;&amp;lt;/Error&amp;gt;&amp;lt;/Errors&amp;gt;&amp;lt;RequestID&amp;gt;b9f1ad6e-59b9-47fd-a693-527be1f779eb&amp;lt;/RequestID&amp;gt;&amp;lt;/Response&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The solution is to tag the instances in the same call that launches them, or less desirably, tag the instances after some short wait.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12763963">SPARK-4983</key>
            <summary>Add sleep() before tagging EC2 instances to allow instance metadata to propagate</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gen">Gen TANG</assignee>
                                    <reporter username="nchammas">Nicholas Chammas</reporter>
                        <labels>
                            <label>starter</label>
                    </labels>
                <created>Mon, 29 Dec 2014 03:46:27 +0000</created>
                <updated>Wed, 3 Jun 2015 18:35:39 +0000</updated>
                            <resolved>Fri, 6 Feb 2015 21:29:24 +0000</resolved>
                                    <version>1.2.0</version>
                                    <fixVersion>1.2.2</fixVersion>
                    <fixVersion>1.3.0</fixVersion>
                                    <component>EC2</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14259816" author="nchammas" created="Mon, 29 Dec 2014 03:47:13 +0000"  >&lt;p&gt;FYI &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shivaram&quot; class=&quot;user-hover&quot; rel=&quot;shivaram&quot;&gt;shivaram&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joshrosen&quot; class=&quot;user-hover&quot; rel=&quot;joshrosen&quot;&gt;joshrosen&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14260479" author="joshrosen" created="Mon, 29 Dec 2014 22:07:28 +0000"  >&lt;p&gt;Did the original code tag them in a separate call because our older Boto version didn&apos;t support it?  Or was this just something that we had overlooked?&lt;/p&gt;</comment>
                            <comment id="14260668" author="nchammas" created="Tue, 30 Dec 2014 02:02:38 +0000"  >&lt;p&gt;It&apos;s something we overlooked. I&apos;m not sure if Boto supports tagging in the same call (whether in our current version or the old one), but I&apos;ll look into it since I was the one who added the tagging feature in the first place.&lt;/p&gt;</comment>
                            <comment id="14270084" author="gen" created="Thu, 8 Jan 2015 21:36:55 +0000"  >&lt;p&gt;By boto, we can only tag instance after it launched, to my best knowledge. Therefore, I think that we can resolve this problem by using try except else statement. If you want, I can try to do this.&lt;/p&gt;
</comment>
                            <comment id="14270147" author="nchammas" created="Thu, 8 Jan 2015 22:32:58 +0000"  >&lt;p&gt;Yeah, I took a quick look at the boto API and it looks like they have to be separate calls.&lt;/p&gt;

&lt;p&gt;Sure, go ahead &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gen&quot; class=&quot;user-hover&quot; rel=&quot;gen&quot;&gt;gen&lt;/a&gt;.  This should be a simple problem to solve.&lt;/p&gt;</comment>
                            <comment id="14272038" author="apachespark" created="Fri, 9 Jan 2015 23:10:09 +0000"  >&lt;p&gt;User &apos;GenTang&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/3986&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/3986&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14309649" author="nchammas" created="Fri, 6 Feb 2015 19:02:16 +0000"  >&lt;p&gt;To summarize the discussion we had in &lt;a href=&quot;https://github.com/apache/spark/pull/3986&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;the PR for this issue&lt;/a&gt;, we found it was simpler to simply wait a few seconds after launching the instances for metadata to propagate, rather than insert this ugly try/except/wait/retry logic everywhere.&lt;/p&gt;</comment>
                            <comment id="14309955" author="joshrosen" created="Fri, 6 Feb 2015 21:29:24 +0000"  >&lt;p&gt;Issue resolved by pull request 3986&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/3986&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/3986&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14571467" author="nchammas" created="Wed, 3 Jun 2015 18:35:39 +0000"  >&lt;p&gt;Per the discussion on &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-7900&quot; title=&quot;Reduce number of tagging calls in spark-ec2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-7900&quot;&gt;&lt;del&gt;SPARK-7900&lt;/del&gt;&lt;/a&gt;, I think we should increase the wait time from the current 5 seconds to, say, 15 or 30 seconds.&lt;/p&gt;

&lt;p&gt;An alternative proposed on &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-7900&quot; title=&quot;Reduce number of tagging calls in spark-ec2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-7900&quot;&gt;&lt;del&gt;SPARK-7900&lt;/del&gt;&lt;/a&gt; is to make fewer tagging calls, since the extra calls seem to make it more likely the we get metadata errors from AWS (like, &quot;instance ID not found&quot; right after AWS itself has given us the instance ID).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12833087">SPARK-7900</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12738155">SPARK-3332</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 24 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i23t4v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>