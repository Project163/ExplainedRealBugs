<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:29:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-39354] The analysis exception is incorrect</title>
                <link>https://issues.apache.org/jira/browse/SPARK-39354</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;scala&amp;gt; spark.sql(&quot;create table t1(user_id int, auct_end_dt date) using parquet;&quot;)
res0: org.apache.spark.sql.DataFrame = []

scala&amp;gt; spark.sql(&quot;select * from t1 join t2 on t1.user_id = t2.user_id where t1.auct_end_dt &amp;gt;= Date_sub(&apos;2020-12-27&apos;, 90)&quot;).show
org.apache.spark.sql.AnalysisException: cannot resolve &apos;date_sub(&apos;2020-12-27&apos;, 90)&apos; due to data type mismatch: argument 1 requires date type, however, &apos;&apos;2020-12-27&apos;&apos; is of string type.; line 1 pos 76
  at org.apache.spark.sql.catalyst.analysis.package$AnalysisErrorAt.failAnalysis(package.scala:42)
  at org.apache.spark.sql.catalyst.analysis.RemoveTempResolvedColumn$.$anonfun$apply$82(Analyzer.scala:4334)
  at org.apache.spark.sql.catalyst.analysis.RemoveTempResolvedColumn$.$anonfun$apply$82$adapted(Analyzer.scala:4327)
  at org.apache.spark.sql.catalyst.trees.TreeNode.foreachUp(TreeNode.scala:365)
  at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1(TreeNode.scala:364)
  at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$foreachUp$1$adapted(TreeNode.scala:364)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The analysis exception should be:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.spark.sql.AnalysisException: Table or view not found: t2
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment></environment>
        <key id="13447926">SPARK-39354</key>
            <summary>The analysis exception is incorrect</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="LuciferYang">Yang Jie</assignee>
                                    <reporter username="yumwang">Yuming Wang</reporter>
                        <labels>
                    </labels>
                <created>Wed, 1 Jun 2022 13:03:30 +0000</created>
                <updated>Mon, 12 Dec 2022 18:11:08 +0000</updated>
                            <resolved>Thu, 2 Jun 2022 10:08:35 +0000</resolved>
                                    <version>3.3.0</version>
                                    <fixVersion>3.3.0</fixVersion>
                    <fixVersion>3.4.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17544894" author="q79969786" created="Wed, 1 Jun 2022 13:07:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maxgekk&quot; class=&quot;user-hover&quot; rel=&quot;maxgekk&quot;&gt;maxgekk&lt;/a&gt;, I think this is a blocker issue for 3.3.0 release.&lt;/p&gt;</comment>
                            <comment id="17544904" author="gurwls223" created="Wed, 1 Jun 2022 13:16:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yumwang&quot; class=&quot;user-hover&quot; rel=&quot;yumwang&quot;&gt;yumwang&lt;/a&gt; is this only exception message related?&lt;/p&gt;</comment>
                            <comment id="17544914" author="q79969786" created="Wed, 1 Jun 2022 13:45:06 +0000"  >&lt;p&gt;Yes. It is only exception message related.&lt;/p&gt;</comment>
                            <comment id="17545016" author="luciferyang" created="Wed, 1 Jun 2022 16:35:15 +0000"  >&lt;p&gt;This issue was introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-38118&quot; title=&quot;Func(wrong data type) in HAVING clause should throw data mismatch error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-38118&quot;&gt;&lt;del&gt;SPARK-38118&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/spark/blob/5a3ba9b0b301a3b0c43f8d0d88e2b6bdce57d0e6/sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/analysis/Analyzer.scala#L4353-L4372&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/5a3ba9b0b301a3b0c43f8d0d88e2b6bdce57d0e6/sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/analysis/Analyzer.scala#L4353-L4372&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#160; &#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// HAVING clause will be resolved as a Filter. When having func(column with wrong data type),
&lt;/span&gt;&#160; &#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// the column could be wrapped by a TempResolvedColumn, e.g. mean(tempresolvedcolumn(t.c)).
&lt;/span&gt;&#160; &#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// Because TempResolvedColumn can still preserve column data type, here is a chance to check
&lt;/span&gt;&#160; &#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the data type matches with the required data type of the function. We can &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; an error
&lt;/span&gt;&#160; &#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// when data types mismatches.
&lt;/span&gt;&#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt;: Filter =&amp;gt;
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt;.expressions.foreach(_.foreachUp {
&#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; e: Expression &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; e.childrenResolved &amp;amp;&amp;amp; e.checkInputDataTypes().isFailure =&amp;gt;
&#160; &#160; &#160; &#160; &#160; &#160; e.checkInputDataTypes() match {
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; TypeCheckResult.TypeCheckFailure(message) =&amp;gt;
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; e.setTagValue(DATA_TYPE_MISMATCH_ERROR, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; e.failAnalysis(
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; s&lt;span class=&quot;code-quote&quot;&gt;&quot;cannot resolve &lt;span class=&quot;code-quote&quot;&gt;&apos;${e.sql}&apos;&lt;/span&gt; due to data type mismatch: $message&quot;&lt;/span&gt; +
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; extraHintForAnsiTypeCoercionExpression(plan))
&#160; &#160; &#160; &#160; &#160; &#160; }
&#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; _ =&amp;gt;
&#160; &#160; &#160; &#160; })
&#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; _ =&amp;gt; &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;`case operator: Filter =&amp;gt;` is too broad, should add some restrictions&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17545040" author="maxgekk" created="Wed, 1 Jun 2022 17:12:31 +0000"  >&lt;p&gt;Ping &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=amaliujia&quot; class=&quot;user-hover&quot; rel=&quot;amaliujia&quot;&gt;amaliujia&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wenchen&quot; class=&quot;user-hover&quot; rel=&quot;wenchen&quot;&gt;wenchen&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dongjoon&quot; class=&quot;user-hover&quot; rel=&quot;dongjoon&quot;&gt;dongjoon&lt;/a&gt; as you reviewed the PR which probably introduced the bug.&lt;/p&gt;</comment>
                            <comment id="17545043" author="dongjoon" created="Wed, 1 Jun 2022 17:17:18 +0000"  >&lt;p&gt;Thank you for pinging me, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maxgekk&quot; class=&quot;user-hover&quot; rel=&quot;maxgekk&quot;&gt;maxgekk&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17545047" author="dongjoon" created="Wed, 1 Jun 2022 17:25:18 +0000"  >&lt;p&gt;Ah, got it. I removed my previous message. Yes, this is a regression.&lt;/p&gt;</comment>
                            <comment id="17545249" author="gurwls223" created="Thu, 2 Jun 2022 03:03:09 +0000"  >&lt;p&gt;BTW, I don&apos;t think this is a release blocker because it only changes the error messages .. right?&lt;/p&gt;</comment>
                            <comment id="17545394" author="maxgekk" created="Thu, 2 Jun 2022 10:08:36 +0000"  >&lt;p&gt;Issue resolved by pull request 36746&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/36746&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/36746&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 23 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z12vbc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>