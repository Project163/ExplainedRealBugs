<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:12:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-978] PySpark&apos;s cartesian method throws ClassCastException exception</title>
                <link>https://issues.apache.org/jira/browse/SPARK-978</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Try the following in PySpark:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;a = sc.textFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;README.md&quot;&lt;/span&gt;)
a.cartesian(a).collect()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;exception thrown&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;py4j.protocol.Py4JJavaError: An error occurred &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; calling z:org.apache.spark.api.python.PythonRDD.writeToFile.
: java.lang.ClassCastException: java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; cannot be &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; to [B
	at org.apache.spark.api.python.PythonRDD$.writeToStream(PythonRDD.scala:214)
	at org.apache.spark.api.python.PythonRDD$$anonfun$writeToFile$1.apply(PythonRDD.scala:233)
	at org.apache.spark.api.python.PythonRDD$$anonfun$writeToFile$1.apply(PythonRDD.scala:232)
	at scala.collection.Iterator$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;foreach(Iterator.scala:772)
	at scala.collection.JavaConversions$JIteratorWrapper.foreach(JavaConversions.scala:573)
	at org.apache.spark.api.python.PythonRDD$.writeToFile(PythonRDD.scala:232)
	at org.apache.spark.api.python.PythonRDD$.writeToFile(PythonRDD.scala:227)
	at org.apache.spark.api.python.PythonRDD.writeToFile(PythonRDD.scala)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at py4j.reflection.MethodInvoker.invoke(MethodInvoker.java:228)
	at py4j.reflection.ReflectionEngine.invoke(ReflectionEngine.java:379)
	at py4j.Gateway.invoke(Gateway.java:259)
	at py4j.commands.AbstractCommand.invokeMethod(AbstractCommand.java:132)
	at py4j.commands.CallCommand.execute(CallCommand.java:79)
	at py4j.GatewayConnection.run(GatewayConnection.java:207)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:695)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;But if we convert the rdd to a list of strings it would work.&lt;/p&gt;

&lt;p&gt;i.e.&lt;/p&gt;

&lt;p&gt;a = a.map(lambda line: str(line))&lt;/p&gt;</description>
                <environment></environment>
        <key id="12704787">SPARK-978</key>
            <summary>PySpark&apos;s cartesian method throws ClassCastException exception</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="joshrosen">Josh Rosen</assignee>
                                    <reporter username="rxin">Reynold Xin</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 Dec 2013 13:54:08 +0000</created>
                <updated>Thu, 23 Jan 2014 19:48:05 +0000</updated>
                            <resolved>Thu, 23 Jan 2014 19:48:05 +0000</resolved>
                                    <version>0.8.0</version>
                    <version>0.8.1</version>
                    <version>0.9.0</version>
                                    <fixVersion>0.9.0</fixVersion>
                                    <component>PySpark</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13953575" author="joshrosen" created="Thu, 23 Jan 2014 15:18:53 +0000"  >&lt;p&gt;What&apos;s happening here is cartesian() produces a JavaPairRDD&amp;lt;String, String&amp;gt; when called on untransformed RDDs that were created with sc.textFile(), but writeToStream() isn&apos;t prepared to handle this case.  This fails with a ClassCastException rather than a MatchError because the type parameters of Tuple2 are eliminated by erasure; the compiler had actually warned about this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[warn] /Users/joshrosen/Documents/spark/spark/core/src/main/scala/org/apache/spark/api/python/PythonRDD.scala:214: non-variable type argument Array[&lt;span class=&quot;code-object&quot;&gt;Byte&lt;/span&gt;] in type pattern (Array[&lt;span class=&quot;code-object&quot;&gt;Byte&lt;/span&gt;], Array[&lt;span class=&quot;code-object&quot;&gt;Byte&lt;/span&gt;]) is unchecked since it is eliminated by erasure
[warn]       &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; pair: (Array[&lt;span class=&quot;code-object&quot;&gt;Byte&lt;/span&gt;], Array[&lt;span class=&quot;code-object&quot;&gt;Byte&lt;/span&gt;]) =&amp;gt;
[warn]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Based on the underlying JavaRDD&apos;s ClassTag, we should be able to figure out which Java -&amp;gt; Python serialization method to use, rather than attempting to determine it on a per-element basis (this should be more efficient, too).  Unfortunately, this doesn&apos;t work since we need TypeTags rather than ClassTags to work around erasure of Tuple2&apos;s parameters.&lt;/p&gt;

&lt;p&gt;Rather than breaking a bunch of existing APIs by introducing TypeTags, I changed the scope of the getClass()-based pattern matching to determine types based on the first item in the iterator.&lt;/p&gt;

&lt;p&gt;I&apos;ve submitted my fix as part of this pull request: &lt;a href=&quot;https://github.com/apache/incubator-spark/pull/501&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/incubator-spark/pull/501&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>383198</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 43 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1u0nj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>383466</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>