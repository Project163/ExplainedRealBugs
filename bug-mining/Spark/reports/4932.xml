<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:54:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-19900] [Standalone] Master registers application again when driver relaunched</title>
                <link>https://issues.apache.org/jira/browse/SPARK-19900</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;I&apos;ve found some problems when node, where driver is running, has unstable network. A situation is possible when two identical applications are running on a cluster.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Steps to Reproduce:&lt;/b&gt;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;prepare 3 node. One for the spark master and two for the spark workers.&lt;/li&gt;
	&lt;li&gt;submit an application with parameter spark.driver.supervise = true&lt;/li&gt;
	&lt;li&gt;go to the node where driver is running (for example spark-worker-1) and close 7077 port
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;# iptables -A OUTPUT -p tcp --dport 7077 -j DROP
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;wait more 60 seconds&lt;/li&gt;
	&lt;li&gt;look at the spark master UI&lt;br/&gt;
There are two spark applications and one driver. The new application has WAITING state and the second application has RUNNING state. Driver has RUNNING or RELAUNCHING state (It depends on the resources available, as I understand it) and it launched on other node (for example spark-worker-2)&lt;/li&gt;
	&lt;li&gt;open the port
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;# iptables -D OUTPUT -p tcp --dport 7077 -j DROP
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;look an the spark UI again&lt;br/&gt;
There are no changes&lt;/li&gt;
&lt;/ol&gt;



&lt;p&gt;In addition, if you look at the processes on the node spark-worker-1&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;# ps ax | grep spark
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; you will see that the old driver is still working!&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Spark master logs:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;17/03/10 05:26:27 WARN Master: Removing worker-20170310052240-spark-worker-1-35039 because we got no heartbeat in 60 seconds
17/03/10 05:26:27 INFO Master: Removing worker worker-20170310052240-spark-worker-1-35039 on spark-worker-1:35039
17/03/10 05:26:27 INFO Master: Telling app of lost executor: 1
17/03/10 05:26:27 INFO Master: Telling app of lost executor: 0
17/03/10 05:26:27 INFO Master: Re-launching driver-20170310052347-0000
17/03/10 05:26:27 INFO Master: Launching driver driver-20170310052347-0000 on worker worker-20170310052411-spark-worker-2-40473
17/03/10 05:26:35 INFO Master: Registering app TestApplication
17/03/10 05:26:35 INFO Master: Registered app TestApplication with ID app-20170310052635-0001
17/03/10 05:31:07 WARN Master: Got heartbeat from unregistered worker worker-20170310052240-spark-worker-1-35039. Asking it to re-register.
17/03/10 05:31:07 WARN Master: Got heartbeat from unregistered worker worker-20170310052240-spark-worker-1-35039. Asking it to re-register.
17/03/10 05:31:07 WARN Master: Got heartbeat from unregistered worker worker-20170310052240-spark-worker-1-35039. Asking it to re-register.
17/03/10 05:31:07 WARN Master: Got heartbeat from unregistered worker worker-20170310052240-spark-worker-1-35039. Asking it to re-register.
17/03/10 05:31:07 WARN Master: Got status update &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; unknown executor app-20170310052354-0000/1
17/03/10 05:31:07 WARN Master: Got status update &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; unknown executor app-20170310052354-0000/0
17/03/10 05:31:07 WARN Master: Got heartbeat from unregistered worker worker-20170310052240-spark-worker-1-35039. Asking it to re-register.
17/03/10 05:31:07 WARN Master: Got heartbeat from unregistered worker worker-20170310052240-spark-worker-1-35039. Asking it to re-register.
17/03/10 05:31:07 WARN Master: Got heartbeat from unregistered worker worker-20170310052240-spark-worker-1-35039. Asking it to re-register.
17/03/10 05:31:07 WARN Master: Got heartbeat from unregistered worker worker-20170310052240-spark-worker-1-35039. Asking it to re-register.
17/03/10 05:31:07 WARN Master: Got heartbeat from unregistered worker worker-20170310052240-spark-worker-1-35039. Asking it to re-register.
17/03/10 05:31:07 WARN Master: Got heartbeat from unregistered worker worker-20170310052240-spark-worker-1-35039. Asking it to re-register.
17/03/10 05:31:07 WARN Master: Got heartbeat from unregistered worker worker-20170310052240-spark-worker-1-35039. Asking it to re-register.
17/03/10 05:31:07 WARN Master: Got heartbeat from unregistered worker worker-20170310052240-spark-worker-1-35039. Asking it to re-register.
17/03/10 05:31:07 WARN Master: Got heartbeat from unregistered worker worker-20170310052240-spark-worker-1-35039. Asking it to re-register.
17/03/10 05:31:07 WARN Master: Got heartbeat from unregistered worker worker-20170310052240-spark-worker-1-35039. Asking it to re-register.
17/03/10 05:31:07 WARN Master: Got heartbeat from unregistered worker worker-20170310052240-spark-worker-1-35039. Asking it to re-register.
17/03/10 05:31:07 WARN Master: Got heartbeat from unregistered worker worker-20170310052240-spark-worker-1-35039. Asking it to re-register.
17/03/10 05:31:07 WARN Master: Got heartbeat from unregistered worker worker-20170310052240-spark-worker-1-35039. Asking it to re-register.
17/03/10 05:31:07 WARN Master: Got heartbeat from unregistered worker worker-20170310052240-spark-worker-1-35039. Asking it to re-register.
17/03/10 05:31:07 WARN Master: Got heartbeat from unregistered worker worker-20170310052240-spark-worker-1-35039. Asking it to re-register.
17/03/10 05:31:07 WARN Master: Got heartbeat from unregistered worker worker-20170310052240-spark-worker-1-35039. Asking it to re-register.
17/03/10 05:31:07 WARN Master: Got heartbeat from unregistered worker worker-20170310052240-spark-worker-1-35039. Asking it to re-register.
17/03/10 05:31:07 WARN Master: Got heartbeat from unregistered worker worker-20170310052240-spark-worker-1-35039. Asking it to re-register.
17/03/10 05:31:07 INFO Master: Registering worker spark-worker-1:35039 with 8 cores, 10.8 GB RAM
17/03/10 05:31:07 INFO Master: Launching executor app-20170310052354-0000/4 on worker worker-20170310052240-spark-worker-1-35039
17/03/10 05:31:07 INFO Master: Launching executor app-20170310052354-0000/5 on worker worker-20170310052240-spark-worker-1-35039
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I expect the following behaviour:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;when the driver is relaunching it should not create a new application or the old application should be removed&lt;/li&gt;
	&lt;li&gt;the process with old driver should be killed&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Correct me please if I do not understand something or I missed some settings.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Centos 6.5, spark standalone&lt;/p&gt;</environment>
        <key id="13050028">SPARK-19900</key>
            <summary>[Standalone] Master registers application again when driver relaunched</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lyc">Li Yichao</assignee>
                                    <reporter username="Ssergey">Sergey</reporter>
                        <labels>
                            <label>Spark</label>
                            <label>network</label>
                            <label>standalone</label>
                            <label>supervise</label>
                    </labels>
                <created>Fri, 10 Mar 2017 12:38:32 +0000</created>
                <updated>Tue, 23 Jan 2018 14:39:08 +0000</updated>
                            <resolved>Thu, 15 Jun 2017 00:08:53 +0000</resolved>
                                    <version>1.6.2</version>
                                    <fixVersion>2.3.0</fixVersion>
                                    <component>Deploy</component>
                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15959052" author="ssergey" created="Thu, 6 Apr 2017 15:02:23 +0000"  >&lt;p&gt;This issue does not reproduced in spark 2.1.0 version.&lt;/p&gt;</comment>
                            <comment id="15999741" author="lyc" created="Sun, 7 May 2017 09:07:42 +0000"  >&lt;p&gt;I can successfully reproduce in spark master ( commit  63d90e7d, and spark version is 2.3.0), though the symptom is a little different.&lt;/p&gt;

&lt;p&gt;To make the application run slowly enough, I modify `examples/LogQuery.scala` to this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;dataSet.map(line =&amp;gt; (extractKey(line), extractStats(line)))
      .reduceByKey((a, b) =&amp;gt; {
        &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(20*60*1000)
        a.merge(b)
      })
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;run two worker each with 1G memory and 2 cores. submit the application with:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;bin/spark-submit --&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.spark.examples.LogQuery  --master spark:&lt;span class=&quot;code-comment&quot;&gt;//master:6066 --deploy-mode cluster --supervise --total-executor-cores 1 --num-executors 1 --executor-memory 512M --driver-memory 512M /vagrant_data/spark/examples/target/scala-2.11/jars/spark-examples_2.11-2.3.0-SNAPSHOT.jar&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and follow the steps as stated above. &lt;/p&gt;

&lt;p&gt;The outcome is that at step 5, there are not two drivers, but there are two applications, the old one is still running, the new one is waiting for resources. After step 6, the old application is finished, the new one running, and the only one driver is killed. This is problematic because the driver corresponding to the running application is killed instead of running.&lt;/p&gt;

&lt;p&gt;The problem is due to the fact that the relaunched driver uses the same driver id with the original one and when old application is killed, the driver is killed as a side effect. I have create a pull request to fix this. &lt;/p&gt;</comment>
                            <comment id="15999751" author="apachespark" created="Sun, 7 May 2017 09:36:03 +0000"  >&lt;p&gt;User &apos;liyichao&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/17888&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/17888&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16022591" author="apachespark" created="Wed, 24 May 2017 09:20:02 +0000"  >&lt;p&gt;User &apos;liyichao&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18084&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18084&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16049839" author="cloud_fan" created="Thu, 15 Jun 2017 00:08:53 +0000"  >&lt;p&gt;Issue resolved by pull request 18084&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18084&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18084&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16049842" author="cloud_fan" created="Thu, 15 Jun 2017 00:10:41 +0000"  >&lt;p&gt;liyichao can you provide your JIRA id? thanks!&lt;/p&gt;</comment>
                            <comment id="16049942" author="lyc" created="Thu, 15 Jun 2017 03:00:51 +0000"  >&lt;p&gt;My user name (and JIRA login name) is `lyc`, Full name is `Li Yichao`. It seems JIRA has a bug when my full name is the same as my user name, so I change my full name, now I can be mentioned by `@Li Yichao`&lt;/p&gt;</comment>
                            <comment id="16335848" author="neeraj20gupta" created="Tue, 23 Jan 2018 14:39:08 +0000"  >&lt;p&gt;We are facing this same issue. Can I get a nightly build to test the same in 2.3.0&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 43 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3b8pj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>