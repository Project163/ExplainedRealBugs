<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:54:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-21377] Jars specified with --jars or --packages are not added into AM&apos;s system classpath</title>
                <link>https://issues.apache.org/jira/browse/SPARK-21377</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;In this issue we have a long running Spark application with secure HBase, which requires &lt;tt&gt;HBaseCredentialProvider&lt;/tt&gt; to get tokens periodically, we specify HBase related jars with &lt;tt&gt;&amp;#45;-packages&lt;/tt&gt;, but these dependencies are not added into AM classpath, so when &lt;tt&gt;HBaseCredentialProvider&lt;/tt&gt; tries to initialize HBase connections to get tokens, it will be failed.&lt;/p&gt;

&lt;p&gt;Currently because jars specified with &lt;tt&gt;&amp;#45;-jars&lt;/tt&gt; or &lt;tt&gt;&amp;#45;-packages&lt;/tt&gt; are not added into AM classpath, the only way to extend AM classpath is to use &quot;spark.driver.extraClassPath&quot; which supposed to be used in yarn cluster mode.&lt;/p&gt;

&lt;p&gt;So here we should figure out a solution  either to put these dependencies to AM classpath or to extend AM classpath with correct configuration.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13086349">SPARK-21377</key>
            <summary>Jars specified with --jars or --packages are not added into AM&apos;s system classpath</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jerryshao">Saisai Shao</assignee>
                                    <reporter username="yeshavora">Yesha Vora</reporter>
                        <labels>
                    </labels>
                <created>Tue, 11 Jul 2017 18:48:42 +0000</created>
                <updated>Sun, 17 May 2020 18:14:19 +0000</updated>
                            <resolved>Mon, 17 Jul 2017 20:12:03 +0000</resolved>
                                    <version>2.2.0</version>
                                    <fixVersion>2.3.0</fixVersion>
                                    <component>Spark Core</component>
                    <component>YARN</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16082771" author="srowen" created="Tue, 11 Jul 2017 18:58:24 +0000"  >&lt;p&gt;Why does that suggest that it&apos;s not finding a class? I don&apos;t see how this is separate from &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-21376&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-21376&lt;/a&gt; that you just created?&lt;/p&gt;</comment>
                            <comment id="16082864" author="jerryshao" created="Tue, 11 Jul 2017 19:57:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srowen&quot; class=&quot;user-hover&quot; rel=&quot;srowen&quot;&gt;srowen&lt;/a&gt; this is a separate issue to &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-21376&quot; title=&quot;Token is not renewed in yarn client process in cluster mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-21376&quot;&gt;&lt;del&gt;SPARK-21376&lt;/del&gt;&lt;/a&gt;. In this issue we have a long running Spark application with secure HBase, which requires &lt;tt&gt;HBaseCredentialProvider&lt;/tt&gt; to get tokens periodically, we specify HBase related jars with &lt;tt&gt;&amp;#45;-packages&lt;/tt&gt;, but these dependencies are not added into AM classpath, so when &lt;tt&gt;HBaseCredentialProvider&lt;/tt&gt; tries to initialize HBase connections to get tokens, it will be failed.&lt;/p&gt;</comment>
                            <comment id="16082873" author="jerryshao" created="Tue, 11 Jul 2017 20:02:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-21376&quot; title=&quot;Token is not renewed in yarn client process in cluster mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-21376&quot;&gt;&lt;del&gt;SPARK-21376&lt;/del&gt;&lt;/a&gt; and here are both security issues, but the root cause and fix is different. So that&apos;s why we created two JIRAs.&lt;/p&gt;</comment>
                            <comment id="16082990" author="apachespark" created="Tue, 11 Jul 2017 21:10:02 +0000"  >&lt;p&gt;User &apos;jerryshao&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18602&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18602&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16083033" author="vanzin" created="Tue, 11 Jul 2017 21:35:32 +0000"  >&lt;blockquote&gt;&lt;p&gt;we specify HBase related jars with --packages, but these dependencies are not added into AM classpath&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m a little confused about how the code in the PR is supposed to solve this. Specifying &lt;tt&gt;&amp;#45;&amp;#45;packages&lt;/tt&gt; doesn&apos;t automatically make jars available to the AM. The files are just distributed to the cluster, but you still need code to make the AM&apos;s class loader see those jars. There&apos;s code to do that for the driver (&lt;tt&gt;ApplicationMaster.startUserApplication&lt;/tt&gt;) but not for the AM (&lt;tt&gt;ApplicationMaster.runExecutorLauncher&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="16083060" author="jerryshao" created="Tue, 11 Jul 2017 21:54:21 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vanzin&quot; class=&quot;user-hover&quot; rel=&quot;vanzin&quot;&gt;vanzin&lt;/a&gt; for your comment.&lt;/p&gt;

&lt;p&gt;Your comment is correct, specifying &lt;tt&gt;&amp;#45;-packages&lt;/tt&gt; will not add jars to AM, my original thought is to add main jar and secondary jars automatically into AM classpath, but this will break the usage of &quot;spark.driver.userClassPathFirst&quot;. So my proposal is to manually specify AM extra classpath with &quot;spark.yarn.am.extraClassPath&quot; manually, for example specifying HBase classpath with this configuration. This requires HBase dependencies existed in cluster, but it may not impact user application&apos;s classpath.&lt;/p&gt;</comment>
                            <comment id="16083063" author="vanzin" created="Tue, 11 Jul 2017 21:58:23 +0000"  >&lt;blockquote&gt;&lt;p&gt;my original thought is to add main jar and secondary jars automatically into AM classpath, but this will break the usage of &quot;spark.driver.userClassPathFirst&quot;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Can you expand on that? That config does not (or at least should not) apply to the client AM; and you shouldn&apos;t be adding the jars to the classpath, but to a new classloader that is set as the &quot;context class loader&quot; of the AM, just like it is in the case of the driver, in the method I referenced before.&lt;/p&gt;</comment>
                            <comment id="16083081" author="jerryshao" created="Tue, 11 Jul 2017 22:13:10 +0000"  >&lt;p&gt;My original purpose is to add jars uploaded by distributed cache to AM classpath with &quot;${PWD}/*&quot; in AM container setup both in client and cluster mode, but I guess it may affect the use of &quot;spark.driver.userClassPathFirst&quot; in cluster mode or contaminate the existing AM classpath, since now jars will also be existed in AM classpath.&lt;/p&gt;

&lt;p&gt;So your suggestion is that we use another context loader to load these jars, and specifically used for ServiceCredentialProvider, am I right?&lt;/p&gt;</comment>
                            <comment id="16083085" author="vanzin" created="Tue, 11 Jul 2017 22:17:53 +0000"  >&lt;blockquote&gt;&lt;p&gt;So your suggestion is that we use another context loader to load these jars&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes that would be my first choice. If for some reason that does not work, then you can modify the classpath like you suggest for the AM only, appending the jars (not prepending) so that they don&apos;t overwrite Spark&apos;s versions of conflicting libraries.&lt;/p&gt;</comment>
                            <comment id="16084929" author="apachespark" created="Wed, 12 Jul 2017 23:54:04 +0000"  >&lt;p&gt;User &apos;jerryshao&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18616&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18616&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 18 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3hdzb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>