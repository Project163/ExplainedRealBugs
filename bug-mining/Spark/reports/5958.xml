<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:01:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-24415] Stage page aggregated executor metrics wrong when failures </title>
                <link>https://issues.apache.org/jira/browse/SPARK-24415</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Running with spark 2.3 on yarn and having task failures and blacklisting, the aggregated metrics by executor are not correct.&#160; In my example it should have 2 failed tasks but it only shows one.&#160; &#160; Note I tested with master branch to verify its not fixed.&lt;/p&gt;

&lt;p&gt;I will attach screen shot.&lt;/p&gt;

&lt;p&gt;To reproduce:&lt;/p&gt;

&lt;p&gt;$SPARK_HOME/bin/spark-shell --master yarn --deploy-mode client --executor-memory=2G --num-executors=1 --conf &quot;spark.blacklist.enabled=true&quot; --conf &quot;spark.blacklist.stage.maxFailedTasksPerExecutor=1&quot; --conf &quot;spark.blacklist.stage.maxFailedExecutorsPerNode=1&quot;&#160; --conf &quot;spark.blacklist.application.maxFailedTasksPerExecutor=2&quot; --conf &quot;spark.blacklist.killBlacklistedExecutors=true&quot;&lt;/p&gt;

&lt;p&gt;import org.apache.spark.SparkEnv&#160;&lt;/p&gt;

&lt;p&gt;sc.parallelize(1 to 10000, 10).map { x =&amp;gt;&#160;if (SparkEnv.get.executorId.toInt &amp;gt;= 1 &amp;amp;&amp;amp; SparkEnv.get.executorId.toInt &amp;lt;= 4) throw new RuntimeException(&quot;Bad executor&quot;) else (x % 3, x)&#160;}.reduceByKey((a, b) =&amp;gt; a + b).collect()&lt;/p&gt;</description>
                <environment></environment>
        <key id="13162690">SPARK-24415</key>
            <summary>Stage page aggregated executor metrics wrong when failures </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ankur.gupta">Ankur Gupta</assignee>
                                    <reporter username="tgraves">Thomas Graves</reporter>
                        <labels>
                    </labels>
                <created>Tue, 29 May 2018 19:15:59 +0000</created>
                <updated>Thu, 27 Dec 2018 11:15:31 +0000</updated>
                            <resolved>Wed, 5 Sep 2018 16:52:40 +0000</resolved>
                                    <version>2.3.0</version>
                                    <fixVersion>2.3.2</fixVersion>
                    <fixVersion>2.4.0</fixVersion>
                                    <component>Web UI</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16495200" author="tgraves" created="Wed, 30 May 2018 14:00:14 +0000"  >&lt;p&gt;this might actually be an order of events type thing.&#160; You will note that the config I have is&#160;stage.maxFailedTasksPerExecutor=1 so it should really only have 1 failed task, but looking at the log it seems it starts the second task before totally handling the blacklist from the first failure:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;18/05/30 13:57:20 INFO TaskSetManager: Starting task 0.0 in stage 2.0 (TID 2, gsrd259n13.red.ygrid.yahoo.com, executor 2, partition 0, PROCESS_LOCAL, 7746 bytes)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;Stage 2:&amp;gt; (0 + 1) / 10&amp;#93;&lt;/span&gt;18/05/30 13:57:20 INFO BlockManagerMasterEndpoint: Registering block manager gsrd259n13.red.ygrid.yahoo.com:43203 with 912.3 MB RAM, BlockManagerId(2, gsrd259n13.red.ygrid.yahoo.com, 43203, None)&lt;br/&gt;
18/05/30 13:57:21 INFO Client: Application report for application_1526529576371_25524 (state: RUNNING)&lt;br/&gt;
18/05/30 13:57:21 INFO BlockManagerInfo: Added broadcast_1_piece0 in memory on gsrd259n13.red.ygrid.yahoo.com:43203 (size: 1941.0 B, free: 912.3 MB)&lt;br/&gt;
18/05/30 13:57:21 INFO TaskSetManager: Starting task 1.0 in stage 2.0 (TID 3, gsrd259n13.red.ygrid.yahoo.com, executor 2, partition 1, PROCESS_LOCAL, 7747 bytes)&lt;br/&gt;
18/05/30 13:57:21 WARN TaskSetManager: Lost task 0.0 in stage 2.0 (TID 2, gsrd259n13.red.ygrid.yahoo.com, executor 2): java.lang.RuntimeException: Bad executor&lt;/p&gt;

&lt;p&gt;....&lt;/p&gt;

&lt;p&gt;18/05/30 13:57:21 INFO TaskSetBlacklist: Blacklisting executor 2 for stage 2&lt;/p&gt;

&lt;p&gt;18/05/30 13:57:21 INFO YarnScheduler: Cancelling stage 2&lt;br/&gt;
18/05/30 13:57:21 INFO YarnScheduler: Stage 2 was cancelled&lt;br/&gt;
18/05/30 13:57:21 INFO DAGScheduler: ShuffleMapStage 2 (map at &amp;lt;console&amp;gt;:26) failed in 12.063 s due to Job aborted due to stage failure:&lt;/p&gt;

&lt;p&gt;18/05/30 13:57:21 INFO DAGScheduler: Job 1 failed: collect at &amp;lt;console&amp;gt;:26, took 12.069052 s&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The thing is though that the executors page shows that it had 2 task failures on that node, its just in the aggregated metrics for that stage that doesn&apos;t have it.&lt;/p&gt;</comment>
                            <comment id="16495204" author="tgraves" created="Wed, 30 May 2018 14:05:25 +0000"  >&lt;p&gt;It also looks like in the history server they show up properly in the aggregated metrics, although if you look at the Tasks (for all stages) column on the jobs page, it only lists a single task failure where it should list 2.&lt;/p&gt;</comment>
                            <comment id="16495224" author="tgraves" created="Wed, 30 May 2018 14:22:02 +0000"  >&lt;p&gt;ok so the issue here is in the AppStatusListener where its only updating the task metrics for liveStages.&#160; It gets the second taskEnd event after it cancelled stage 2 so its no longer in the live stages array.&#160;&#160;&lt;/p&gt;</comment>
                            <comment id="16511618" author="ankur.gupta" created="Wed, 13 Jun 2018 20:19:43 +0000"  >&lt;p&gt;I am planning to work on this JIRA&lt;/p&gt;</comment>
                            <comment id="16590748" author="apachespark" created="Thu, 23 Aug 2018 19:57:05 +0000"  >&lt;p&gt;User &apos;ankuriitg&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22209&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22209&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16604664" author="vanzin" created="Wed, 5 Sep 2018 16:52:41 +0000"  >&lt;p&gt;Issue resolved by pull request 22209&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/22209&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/22209&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310060">
                    <name>Container</name>
                                            <outwardlinks description="contains">
                                        <issuelink>
            <issuekey id="13182175">SPARK-25284</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13165725">SPARK-24539</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13195681">SPARK-25910</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12925620" name="Screen Shot 2018-05-29 at 2.15.38 PM.png" size="429248" author="tgraves" created="Tue, 29 May 2018 19:16:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 10 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ua07:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>