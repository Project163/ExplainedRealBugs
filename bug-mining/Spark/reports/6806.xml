<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:07:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-29691] Estimator fit method fails to copy params (in PySpark)</title>
                <link>https://issues.apache.org/jira/browse/SPARK-29691</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Estimator `fit` method is supposed to copy a dictionary of params, overwriting the estimator&apos;s previous values, before fitting the model. However, the parameter values are not updated.  This was observed in PySpark, but may be present in the Java objects, as the PySpark code appears to be functioning correctly.   (The copy method that interacts with Java is actually implemented in Params.)&lt;/p&gt;

&lt;p&gt;For example, this prints&lt;/p&gt;

&lt;p&gt;Before: 0.8&lt;br/&gt;
After: 0.8&lt;/p&gt;

&lt;p&gt;but After should be 0.75&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-python&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; pyspark.ml.classification &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; LogisticRegression

&lt;span class=&quot;code-comment&quot;&gt;# Load training data
&lt;/span&gt;training = spark \
    .read \
    .&lt;span class=&quot;code-object&quot;&gt;format&lt;/span&gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;libsvm&quot;&lt;/span&gt;) \
    .load(&lt;span class=&quot;code-quote&quot;&gt;&quot;data/mllib/sample_multiclass_classification_data.txt&quot;&lt;/span&gt;)

lr = LogisticRegression(maxIter=10, regParam=0.3, elasticNetParam=0.8)
&lt;span class=&quot;code-object&quot;&gt;print&lt;/span&gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;Before:&quot;&lt;/span&gt;, lr.getOrDefault(&lt;span class=&quot;code-quote&quot;&gt;&quot;elasticNetParam&quot;&lt;/span&gt;))

&lt;span class=&quot;code-comment&quot;&gt;# Fit the model, but &lt;span class=&quot;code-keyword&quot;&gt;with&lt;/span&gt; an updated parameter setting:
&lt;/span&gt;lrModel = lr.fit(training, params={&lt;span class=&quot;code-quote&quot;&gt;&quot;elasticNetParam&quot;&lt;/span&gt; : 0.75})

&lt;span class=&quot;code-object&quot;&gt;print&lt;/span&gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;After:&quot;&lt;/span&gt;, lr.getOrDefault(&lt;span class=&quot;code-quote&quot;&gt;&quot;elasticNetParam&quot;&lt;/span&gt;))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13265630">SPARK-29691</key>
            <summary>Estimator fit method fails to copy params (in PySpark)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="JohnHBauer">John Bauer</assignee>
                                    <reporter username="JohnHBauer">John Bauer</reporter>
                        <labels>
                    </labels>
                <created>Thu, 31 Oct 2019 20:35:39 +0000</created>
                <updated>Tue, 19 Nov 2019 22:18:58 +0000</updated>
                            <resolved>Tue, 19 Nov 2019 22:16:09 +0000</resolved>
                                    <version>2.4.4</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>PySpark</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16965128" author="huaxingao" created="Fri, 1 Nov 2019 22:31:00 +0000"  >&lt;p&gt;I checked the doc and implementation. The Estimator fits the model using the passed in optional params instead of the&#160;embedded params, but it doesn&apos;t overwrite the estimator&apos;s embedded params values. In your case, the estimator uses 0.75 to fit the model, but it still keeps 0.8 for it&apos;s own elasticNetParam. If you get the model&apos;s parameters, it should have 0.75 for elasticNetParam. This seems to work as designed.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
# Fit the model, but with an updated parameter setting:
lrModel = lr.fit(training, params= {lor.elasticNetParam : 0.75})
print(&lt;span class=&quot;code-quote&quot;&gt;&quot;After:&quot;&lt;/span&gt;, lrModel.getOrDefault(&lt;span class=&quot;code-quote&quot;&gt;&quot;elasticNetParam&quot;&lt;/span&gt;)) # print 0.75
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16966768" author="johnhbauer" created="Mon, 4 Nov 2019 15:47:38 +0000"  >&lt;p&gt;I was using this in the context of an MLflow Hyperparameter search. None of the model outputs changed whatsoever when fit(params=...) was used.  Updated example:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-python&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; pyspark.ml.classification &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; LogisticRegression

&lt;span class=&quot;code-comment&quot;&gt;# Load training data
&lt;/span&gt;training = spark \
    .read \
    .&lt;span class=&quot;code-object&quot;&gt;format&lt;/span&gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;libsvm&quot;&lt;/span&gt;) \
    .load(&lt;span class=&quot;code-quote&quot;&gt;&quot;data/mllib/sample_multiclass_classification_data.txt&quot;&lt;/span&gt;)

&lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; printStats(lrModel, title):
    trainingSummary = lrModel.summary
    &lt;span class=&quot;code-object&quot;&gt;print&lt;/span&gt;(title)
    &lt;span class=&quot;code-object&quot;&gt;print&lt;/span&gt;(lrModel.explainParam(&lt;span class=&quot;code-quote&quot;&gt;&quot;elasticNetParam&quot;&lt;/span&gt;))
    &lt;span class=&quot;code-object&quot;&gt;print&lt;/span&gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;Accuracy:&quot;&lt;/span&gt;, trainingSummary.accuracy)
    &lt;span class=&quot;code-object&quot;&gt;print&lt;/span&gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;fMeasure:&quot;&lt;/span&gt;, trainingSummary.weightedFMeasure())
    &lt;span class=&quot;code-object&quot;&gt;print&lt;/span&gt;(&quot;&quot;)

lr = LogisticRegression(maxIter=10, regParam=0.3, elasticNetParam=0.8)
lrModel = lr.fit(training)
printStats(lrModel, &lt;span class=&quot;code-quote&quot;&gt;&quot;elasticNetParam = 0.8, &lt;span class=&quot;code-object&quot;&gt;set&lt;/span&gt; through __init__&quot;&lt;/span&gt;)

lrModel1 = lr.fit(training, params={&lt;span class=&quot;code-quote&quot;&gt;&quot;elasticNetParam&quot;&lt;/span&gt;: 0.3})
printStats(lrModel1, &lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;&quot;elasticNetParam still 0.8, after trying to &lt;span class=&quot;code-object&quot;&gt;set&lt;/span&gt; through fit(..., params={&quot;&lt;/span&gt;elasticNetParam&lt;span class=&quot;code-quote&quot;&gt;&quot; : 0.3}&quot;&lt;/span&gt;&quot;&quot;)

lr03 = LogisticRegression(maxIter=10, regParam=0.3, elasticNetParam=0.3)
lrModel03 = lr03.fit(training)
printStats(lrModel03, &lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;&quot;Correct results &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; elasticNetParam = 0.3, &lt;span class=&quot;code-object&quot;&gt;set&lt;/span&gt; through __init__&quot;&lt;/span&gt;&quot;&quot;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Output:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;elasticNetParam = 0.8, set through __init__
elasticNetParam: the ElasticNet mixing parameter, in range [0, 1]. For alpha = 0, the penalty is an L2 penalty. For alpha = 1, it is an L1 penalty (default: 0.0, current: 0.8)
Accuracy: 0.82
fMeasure: 0.8007300232766211

elasticNetParam still 0.8, after trying to set through fit(..., params={&quot;elasticNetParam&quot; : 0.3}
elasticNetParam: the ElasticNet mixing parameter, in range [0, 1]. For alpha = 0, the penalty is an L2 penalty. For alpha = 1, it is an L1 penalty (default: 0.0, current: 0.8)
Accuracy: 0.82
fMeasure: 0.8007300232766211

Correct results for elasticNetParam = 0.3, set through __init__
elasticNetParam: the ElasticNet mixing parameter, in range [0, 1]. For alpha = 0, the penalty is an L2 penalty. For alpha = 1, it is an L1 penalty (default: 0.0, current: 0.3)
Accuracy: 0.8933333333333333
fMeasure: 0.8922558922558923
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16966929" author="huaxingao" created="Mon, 4 Nov 2019 19:14:20 +0000"  >&lt;p&gt;Could you please change this line&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
lrModel1 = lr.fit(training, params={&lt;span class=&quot;code-quote&quot;&gt;&quot;elasticNetParam&quot;&lt;/span&gt;: 0.3})&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;to&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
lrModel1 = lr.fit(training, params={lr.elasticNetParam : 0.3})&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and try again?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16966941" author="johnhbauer" created="Mon, 4 Nov 2019 19:27:06 +0000"  >&lt;p&gt;OK that works.  I worked with fit doing a grid search some time ago, and don&apos;t remember it working like this.  I will check some of my earlier projects to see if my memory fails me...&lt;/p&gt;</comment>
                            <comment id="16967741" author="johnhbauer" created="Tue, 5 Nov 2019 18:10:37 +0000"  >&lt;p&gt;I wonder if it would make sense to do this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-python&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; _copyValues(&lt;span class=&quot;code-keyword&quot;&gt;self&lt;/span&gt;, to, extra=&lt;span class=&quot;code-keyword&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;None&lt;/span&gt;&lt;/span&gt;):
        &quot;&quot;&quot;
        Copies param values &lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; this instance to another instance &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;
        params shared by them.

        :param to: the target instance
        :param extra: extra params to be copied
        :&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;: the target instance &lt;span class=&quot;code-keyword&quot;&gt;with&lt;/span&gt; param values copied
        &quot;&quot;&quot;
        paramMap = &lt;span class=&quot;code-keyword&quot;&gt;self&lt;/span&gt;._paramMap.copy()
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; extra &lt;span class=&quot;code-keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;None&lt;/span&gt;&lt;/span&gt;:
            paramMap.update(extra)
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; param &lt;span class=&quot;code-keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;self&lt;/span&gt;.params:
            &lt;span class=&quot;code-comment&quot;&gt;# copy default params
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; param &lt;span class=&quot;code-keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;self&lt;/span&gt;._defaultParamMap &lt;span class=&quot;code-keyword&quot;&gt;and&lt;/span&gt; to.hasParam(param.name):
                to._defaultParamMap[to.getParam(param.name)] = &lt;span class=&quot;code-keyword&quot;&gt;self&lt;/span&gt;._defaultParamMap[param]
            &lt;span class=&quot;code-comment&quot;&gt;# copy explicitly &lt;span class=&quot;code-object&quot;&gt;set&lt;/span&gt; params
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; param &lt;span class=&quot;code-keyword&quot;&gt;in&lt;/span&gt; paramMap &lt;span class=&quot;code-keyword&quot;&gt;and&lt;/span&gt; to.hasParam(param.name):
                to._set(**{param.name: paramMap[param]})
            &lt;span class=&quot;code-comment&quot;&gt;# allow extra to update parameters on &lt;span class=&quot;code-keyword&quot;&gt;self&lt;/span&gt; by name,
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;# without having to call getParam first
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;self&lt;/span&gt;.hasParam(param):
                to._set(**{param: paramMap[param]})
            &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;:
                &lt;span class=&quot;code-keyword&quot;&gt;pass&lt;/span&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; to
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This should allow:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-python&quot;&gt;
lr.fit(df, extra={&lt;span class=&quot;code-quote&quot;&gt;&quot;elasticNetParam&quot;&lt;/span&gt;: 0.3})
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;to produce the same result as:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-python&quot;&gt;
lr.fit(df, extra={lr.getParam(&lt;span class=&quot;code-quote&quot;&gt;&quot;elasticNetParam&quot;&lt;/span&gt;): 0.3})
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16967748" author="bryanc" created="Tue, 5 Nov 2019 18:20:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=JohnHBauer&quot; class=&quot;user-hover&quot; rel=&quot;JohnHBauer&quot;&gt;JohnHBauer&lt;/a&gt; I&apos;m not sure we should extend the API to accept parameter names too, but it should definitely check that values  in &lt;tt&gt;extra&lt;/tt&gt; are an instance of &lt;tt&gt;Param&lt;/tt&gt; and raise an error if not. Would that be ok with you and could you do a PR for this?&lt;/p&gt;</comment>
                            <comment id="16967773" author="johnhbauer" created="Tue, 5 Nov 2019 18:51:12 +0000"  >&lt;p&gt;Yes, I can do that. &#160;An error message suggesting a call to getParam would get people on track. &#160;(I think that extending the API to include parameter names as above could be done safely, with a check that they could be bound to self, and an additional check in Pipeline.fit to prevent them being broadcast across a pipeline.)&lt;/p&gt;</comment>
                            <comment id="16974527" author="johnhbauer" created="Thu, 14 Nov 2019 18:41:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/spark/pull/26527&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;[SPARK-29691] ensure Param objects are valid in fit, transform&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16977880" author="bryanc" created="Tue, 19 Nov 2019 22:16:09 +0000"  >&lt;p&gt;Issue resolved by pull request 26527&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/26527&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/26527&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 51 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z085hs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>