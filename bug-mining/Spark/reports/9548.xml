<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:39:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-47068] Recover -1 and 0 case for spark.sql.execution.arrow.maxRecordsPerBatch</title>
                <link>https://issues.apache.org/jira/browse/SPARK-47068</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; pandas as pd
spark.conf.set(&lt;span class=&quot;code-quote&quot;&gt;&quot;spark.sql.execution.arrow.pyspark.enabled&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;)
spark.conf.set(&lt;span class=&quot;code-quote&quot;&gt;&quot;spark.sql.execution.arrow.maxRecordsPerBatch&quot;&lt;/span&gt;, 0)
spark.conf.set(&lt;span class=&quot;code-quote&quot;&gt;&quot;spark.sql.execution.arrow.pyspark.fallback.enabled&quot;&lt;/span&gt;, False)
spark.createDataFrame(pd.DataFrame({&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;: [123]})).toPandas()

spark.conf.set(&lt;span class=&quot;code-quote&quot;&gt;&quot;spark.sql.execution.arrow.maxRecordsPerBatch&quot;&lt;/span&gt;, -1)
spark.createDataFrame(pd.DataFrame({&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;: [123]})).toPandas()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/.../spark/python/pyspark/sql/pandas/conversion.py:371: UserWarning: createDataFrame attempted Arrow optimization because &lt;span class=&quot;code-quote&quot;&gt;&apos;spark.sql.execution.arrow.pyspark.enabled&apos;&lt;/span&gt; is set to &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, but has reached the error below and will not &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt; because automatic fallback with &lt;span class=&quot;code-quote&quot;&gt;&apos;spark.sql.execution.arrow.pyspark.fallback.enabled&apos;&lt;/span&gt; has been set to &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;.
  range() arg 3 must not be zero
  warn(msg)
Traceback (most recent call last):
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;stdin&amp;gt;&quot;&lt;/span&gt;, line 1, in &amp;lt;module&amp;gt;
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/.../spark/python/pyspark/sql/session.py&quot;&lt;/span&gt;, line 1483, in createDataFrame
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;(SparkSession, self).createDataFrame(  # type: ignore[call-overload]
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/.../spark/python/pyspark/sql/pandas/conversion.py&quot;&lt;/span&gt;, line 351, in createDataFrame
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; self._create_from_pandas_with_arrow(data, schema, timezone)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/.../spark/python/pyspark/sql/pandas/conversion.py&quot;&lt;/span&gt;, line 633, in _create_from_pandas_with_arrow
    pdf_slices = (pdf.iloc[start : start + step] &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; start in range(0, len(pdf), step))
ValueError: range() arg 3 must not be zero
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Empty DataFrame
Columns: [a]
Index: []
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13568665">SPARK-47068</key>
            <summary>Recover -1 and 0 case for spark.sql.execution.arrow.maxRecordsPerBatch</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gurwls223">Hyukjin Kwon</assignee>
                                    <reporter username="gurwls223">Hyukjin Kwon</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 16 Feb 2024 01:16:20 +0000</created>
                <updated>Tue, 2 Apr 2024 03:48:55 +0000</updated>
                            <resolved>Tue, 2 Apr 2024 03:48:55 +0000</resolved>
                                    <version>3.4.1</version>
                    <version>3.5.0</version>
                    <version>4.0.0</version>
                                    <fixVersion>3.5.2</fixVersion>
                    <fixVersion>3.4.3</fixVersion>
                    <fixVersion>4.0.0</fixVersion>
                                    <component>PySpark</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17833009" author="joshrosen" created="Tue, 2 Apr 2024 03:48:55 +0000"  >&lt;p&gt;Marking this issue as fixed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 32 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1nfjk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>