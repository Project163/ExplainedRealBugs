<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:46:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-14204] [SQL] Failure to register URL-derived JDBC driver on executors in cluster mode</title>
                <link>https://issues.apache.org/jira/browse/SPARK-14204</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;DataFrameReader JDBC methods throw an IllegalStateException when:&lt;br/&gt;
  1. the JDBC driver is contained in a user-provided jar, and&lt;br/&gt;
  2. the user does not specify which driver to use, but rather allows spark to determine the driver from the JDBC URL.&lt;/p&gt;

&lt;p&gt;This broke some of our database ETL jobs at @premisedata when we upgraded from 1.6.0 to 1.6.1.&lt;/p&gt;

&lt;p&gt;I have tracked the problem down to a regression introduced in the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-12579&quot; title=&quot;User-specified JDBC driver should always take precedence&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-12579&quot;&gt;&lt;del&gt;SPARK-12579&lt;/del&gt;&lt;/a&gt;: &lt;a href=&quot;https://github.com/apache/spark/commit/7f37c1e45d52b7823d566349e2be21366d73651f#diff-391379a5ec51082e2ae1209db15c02b3R53&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/commit/7f37c1e45d52b7823d566349e2be21366d73651f#diff-391379a5ec51082e2ae1209db15c02b3R53&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The issue is that DriverRegistry.register is not called on the executors for a JDBC driver that is derived from the JDBC path.&lt;/p&gt;

&lt;p&gt;The problem can be demonstrated within spark-shell, provided you&apos;re in cluster mode and you&apos;ve deployed a JDBC driver (e.g. postgresql.Driver) via the --jars argument:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.spark.sql.execution.datasources.jdbc.JdbcUtils.createConnectionFactory
val factory = createConnectionFactory(&lt;span class=&quot;code-quote&quot;&gt;&quot;jdbc:postgresql:&lt;span class=&quot;code-comment&quot;&gt;//whatever.you.want/database?user=user&amp;amp;password=password&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; java.util.Properties)
&lt;/span&gt;sc.parallelize(1 to 100).foreach { _ =&amp;gt; factory() } &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; exception&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A sufficient fix is to apply DriverRegistry.register to the `driverClass` variable, rather than to `userSpecifiedDriverClass`, at the code link provided above.  I will submit a PR for this shortly.&lt;/p&gt;

&lt;p&gt;In the meantime, a temporary workaround is to manually specify the JDBC driver class in the Properties object passed to DataFrameReader.jdbc, or in the options used in other entry points, which will force the executors to register the class properly.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12953992">SPARK-14204</key>
            <summary>[SQL] Failure to register URL-derived JDBC driver on executors in cluster mode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mchalek">Kevin McHale</assignee>
                                    <reporter username="mchalek">Kevin McHale</reporter>
                        <labels>
                            <label>JDBC</label>
                            <label>SQL</label>
                    </labels>
                <created>Mon, 28 Mar 2016 16:17:22 +0000</created>
                <updated>Wed, 3 Aug 2016 20:15:42 +0000</updated>
                            <resolved>Thu, 2 Jun 2016 16:17:45 +0000</resolved>
                                    <version>1.6.1</version>
                                    <fixVersion>1.6.2</fixVersion>
                    <fixVersion>2.0.1</fixVersion>
                    <fixVersion>2.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>3</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15214413" author="apachespark" created="Mon, 28 Mar 2016 16:27:04 +0000"  >&lt;p&gt;User &apos;mchalek&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/12000&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/12000&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15270818" author="mchalek" created="Wed, 4 May 2016 15:18:58 +0000"  >&lt;p&gt;This is the cause of: &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-14162&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-14162&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15312564" author="srowen" created="Thu, 2 Jun 2016 16:17:45 +0000"  >&lt;p&gt;Issue resolved by pull request 12000&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/12000&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/12000&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15400668" author="apachespark" created="Sat, 30 Jul 2016 13:27:08 +0000"  >&lt;p&gt;User &apos;mchalek&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/14420&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/14420&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12953642">SPARK-14162</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 16 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2vajb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>