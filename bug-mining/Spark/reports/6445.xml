<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:05:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-27591] A bug in UnivocityParser prevents using UDT</title>
                <link>https://issues.apache.org/jira/browse/SPARK-27591</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;I am trying to define a UserDefinedType based on String but different from StringType in Spark 2.4.1 but it looks like there is a bug in Spark or I am doing smth incorrectly.&lt;/p&gt;

&lt;p&gt;I define my type as follows:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MyType &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; UserDefinedType[MyValue] {
  override def sqlType: DataType = StringType
  ...
}

@SQLUserDefinedType(udt = classOf[MyType])
&lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MyValue
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I expect it to be read and stored as String with just a custom SQL type. In fact Spark can&apos;t read the string at all:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.ClassCastException: org.apache.spark.sql.execution.datasources.csv.UnivocityParser$$anonfun$makeConverter$11 cannot be &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; to org.apache.spark.unsafe.types.UTF8String
    at org.apache.spark.sql.catalyst.expressions.BaseGenericInternalRow$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getUTF8String(rows.scala:46)
    at org.apache.spark.sql.catalyst.expressions.GenericInternalRow.getUTF8String(rows.scala:195)
    at org.apache.spark.sql.catalyst.expressions.JoinedRow.getUTF8String(JoinedRow.scala:102)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;the problem is with UnivocityParser.makeConverter that doesn&apos;t return (String =&amp;gt; Any) function but (String =&amp;gt; (String =&amp;gt; Any)) in the case of UDT, see UnivocityParser:184&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; udt: UserDefinedType[_] =&amp;gt; (datum: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;) =&amp;gt;
  makeConverter(name, udt.sqlType, nullable, options)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13230647">SPARK-27591</key>
            <summary>A bug in UnivocityParser prevents using UDT</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="drKalko">Artem Kalchenko</assignee>
                                    <reporter username="drKalko">Artem Kalchenko</reporter>
                        <labels>
                    </labels>
                <created>Mon, 29 Apr 2019 09:30:03 +0000</created>
                <updated>Mon, 12 Dec 2022 18:10:40 +0000</updated>
                            <resolved>Tue, 30 Apr 2019 23:29:02 +0000</resolved>
                                    <version>2.4.2</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16829067" author="drkalko" created="Mon, 29 Apr 2019 09:40:17 +0000"  >&lt;p&gt;I change the line UnivocityParser:184 to&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; udt: UserDefinedType[_] =&amp;gt; 
  makeConverter(name, udt.sqlType, nullable, options)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and it works as I expected&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16829336" author="viirya" created="Mon, 29 Apr 2019 15:13:40 +0000"  >&lt;p&gt;Are you returning string in &lt;tt&gt;serialize&lt;/tt&gt; in your &lt;tt&gt;UserDefinedType&lt;/tt&gt;? If so, please creating a &lt;tt&gt;UTF8String&lt;/tt&gt; based on the string.&lt;/p&gt;

&lt;p&gt;And also in &lt;tt&gt;deserialize&lt;/tt&gt;, the passed in data is &lt;tt&gt;UTF8String&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="16829354" author="drkalko" created="Mon, 29 Apr 2019 15:34:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=viirya&quot; class=&quot;user-hover&quot; rel=&quot;viirya&quot;&gt;viirya&lt;/a&gt;, yes, I&apos;m returning a string. I tried creating a UTF8String, but it didn&apos;t help. As I mentioned in the description, the method is returning String =&amp;gt; makeConverter(...) instead of just calling makeConverter on udt.sqlType&lt;/p&gt;</comment>
                            <comment id="16829370" author="viirya" created="Mon, 29 Apr 2019 15:50:45 +0000"  >&lt;p&gt;oh, you&apos;re right. I&apos;ve misread the description. Want to submit a PR with your fix?&lt;/p&gt;</comment>
                            <comment id="16829379" author="drkalko" created="Mon, 29 Apr 2019 15:59:36 +0000"  >&lt;p&gt;yes, I will later today&lt;/p&gt;</comment>
                            <comment id="16830756" author="gurwls223" created="Tue, 30 Apr 2019 23:29:02 +0000"  >&lt;p&gt;Issue resolved by pull request 24496&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/24496&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/24496&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 28 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z028b4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>