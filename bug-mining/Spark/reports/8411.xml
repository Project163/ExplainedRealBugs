<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:29:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-37491] Fix Series.asof when values of the series is not sorted</title>
                <link>https://issues.apache.org/jira/browse/SPARK-37491</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/spark/pull/34737#discussion_r758223279&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/34737#discussion_r758223279&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13414415">SPARK-37491</key>
            <summary>Fix Series.asof when values of the series is not sorted</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pralabhkumar">Pralabh Kumar</assignee>
                                    <reporter username="dchvn">dch nguyen</reporter>
                        <labels>
                    </labels>
                <created>Tue, 30 Nov 2021 01:16:49 +0000</created>
                <updated>Mon, 14 Mar 2022 17:33:54 +0000</updated>
                            <resolved>Mon, 14 Mar 2022 17:33:54 +0000</resolved>
                                    <version>3.3.0</version>
                                                    <component>PySpark</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17469471" author="pralabhkumar" created="Wed, 5 Jan 2022 18:27:07 +0000"  >&lt;p&gt;I would like to work on this . Basically the problem is in series.py . We should not find max here.&#160;&#160;&lt;/p&gt;

&lt;p&gt;cond = [&lt;br/&gt;
F.max(F.when(index_scol &amp;lt;= SF.lit(index).cast(index_type), self.spark.column))&lt;br/&gt;
for index in where&lt;br/&gt;
]&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hyukjin.kwon&quot; class=&quot;user-hover&quot; rel=&quot;hyukjin.kwon&quot;&gt;hyukjin.kwon&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=itholic&quot; class=&quot;user-hover&quot; rel=&quot;itholic&quot;&gt;itholic&lt;/a&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17469589" author="itholic" created="Wed, 5 Jan 2022 23:18:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pralabhkumar&quot; class=&quot;user-hover&quot; rel=&quot;pralabhkumar&quot;&gt;pralabhkumar&lt;/a&gt; Sure, please go ahead!&lt;/p&gt;</comment>
                            <comment id="17471314" author="pralabhkumar" created="Sun, 9 Jan 2022 09:25:48 +0000"  >&lt;p&gt;I am working on it .&lt;/p&gt;</comment>
                            <comment id="17472056" author="pralabhkumar" created="Mon, 10 Jan 2022 14:23:59 +0000"  >&lt;p&gt;Lets take example of&#160;&lt;/p&gt;

&lt;p&gt;pser = pd.Series(&lt;span class=&quot;error&quot;&gt;&amp;#91;2, 1, np.nan, 4&amp;#93;&lt;/span&gt;, index=&lt;span class=&quot;error&quot;&gt;&amp;#91;10, 20, 30, 40&amp;#93;&lt;/span&gt;, name=&quot;Koalas&quot;)&lt;/p&gt;

&lt;p&gt;pser.asof(&lt;span class=&quot;error&quot;&gt;&amp;#91;5,20&amp;#93;&lt;/span&gt;)&#160; will give output &lt;span class=&quot;error&quot;&gt;&amp;#91;Nan , 1&amp;#93;&lt;/span&gt;&#160;&lt;/p&gt;

&lt;p&gt;While&#160;&lt;/p&gt;

&lt;p&gt;ps.from_pandas(pser).asof&lt;span class=&quot;error&quot;&gt;&amp;#91;5,20&amp;#93;&lt;/span&gt; will give output &lt;span class=&quot;error&quot;&gt;&amp;#91;Nan, 2&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Explanation&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;Data frame created after applying condition.&lt;/p&gt;

&lt;p&gt;F.when(index_scol &amp;lt;= SF.lit(index).cast(index_type) &#160;Without applying max aggregation &#160;&lt;/p&gt;

&lt;p&gt;&lt;ins&gt;------------&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;------------&lt;del&gt;&lt;ins&gt;&lt;/del&gt;----------------&lt;/ins&gt;&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;col_5&#160; &#160; &#160; &#160; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;col_25&#160; &#160; &#160; &#160; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;_&lt;em&gt;index_level_0&lt;/em&gt;_&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;&lt;ins&gt;------------&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;------------&lt;del&gt;&lt;ins&gt;&lt;/del&gt;----------------&lt;/ins&gt;&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;null&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;10 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;null&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1.0&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;20 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;null&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;null&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;30 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;null&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;null&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;40 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;&lt;ins&gt;------------&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;------------&lt;del&gt;&lt;ins&gt;&lt;/del&gt;----------------&lt;/ins&gt;&lt;/p&gt;

&lt;p&gt;Since we are taking max , output is coming 2. Ideally what we need is the last non null value or each col with increasing order of _&lt;em&gt;index_level_0&lt;/em&gt;_.&lt;/p&gt;

&lt;p&gt;Now to implement the logic . What I planning to do is create a below DF from the above DF , using explode , partition and row_number&lt;/p&gt;

&lt;p&gt;_&lt;em&gt;index_level_0&lt;/em&gt;_.&#160; &#160; &#160; &#160; Identifier&#160; &#160; &#160; &#160; &#160; value&#160; &#160; row_number&lt;/p&gt;

&lt;p&gt;40&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; col_5 &#160; &#160; &#160; &#160; &#160; &#160; &#160; null.&#160; &#160; &#160; 1&lt;/p&gt;

&lt;p&gt;30&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; col_5&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; null&#160; &#160; &#160; &#160;2&lt;/p&gt;

&lt;p&gt;20&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; col_5&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; null&#160; &#160; &#160; &#160;3&lt;/p&gt;

&lt;p&gt;10&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; col_5 &#160; &#160; &#160; &#160; &#160; &#160; &#160; null&#160; &#160; &#160; &#160; &#160;4&lt;/p&gt;

&lt;p&gt;40 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; col_20 &#160; &#160; &#160; &#160; 2&#160; &#160; &#160; &#160; &#160; &#160; &#160; 1&lt;/p&gt;

&lt;p&gt;30 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; col_20&#160; &#160; &#160; &#160; 1&#160; &#160; &#160; &#160; &#160; &#160; &#160; 2&lt;/p&gt;

&lt;p&gt;20&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; col_20 &#160; &#160; &#160; &#160; null&#160; &#160; &#160; &#160; &#160;3&lt;/p&gt;

&lt;p&gt;10&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; col_20&#160; &#160; &#160; &#160; &#160; &#160; null&#160; &#160; &#160; &#160; &#160;4&#160;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Then filter on row_number=1 . There are other things to take care , but majority of the logic is this .&lt;/p&gt;

&lt;p&gt;Please let me know if its in correct direction ( This is actually passing all the asof test cases ,including the&#160; case which is described in jira. ) .&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=itholic&quot; class=&quot;user-hover&quot; rel=&quot;itholic&quot;&gt;itholic&lt;/a&gt; &#160;&lt;/p&gt;</comment>
                            <comment id="17475227" author="apachespark" created="Thu, 13 Jan 2022 09:53:51 +0000"  >&lt;p&gt;User &apos;pralabhkumar&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/35191&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/35191&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17506380" author="ueshin" created="Mon, 14 Mar 2022 17:33:54 +0000"  >&lt;p&gt;Issue resolved by pull request 35191&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/35191&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/35191&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13414240">SPARK-37482</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 35 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0x6r4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>