<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:31:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-40320] When the Executor plugin fails to initialize, the Executor shows active but does not accept tasks forever, just like being hung</title>
                <link>https://issues.apache.org/jira/browse/SPARK-40320</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;&lt;b&gt;Reproduce step:&lt;/b&gt;&lt;br/&gt;
set `spark.plugins=ErrorSparkPlugin`&lt;br/&gt;
`ErrorSparkPlugin` &amp;amp;&amp;amp; `ErrorExecutorPlugin` class as below (I abbreviate the code to make it clearer):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ErrorSparkPlugin &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; SparkPlugin {
  /**
   */
  override def driverPlugin(): DriverPlugin =  &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ErrorDriverPlugin()

  /**
   */
  override def executorPlugin(): ExecutorPlugin = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ErrorExecutorPlugin()
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ErrorExecutorPlugin &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; ExecutorPlugin {
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; val checkingInterval: &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; = 1

  override def init(_ctx: PluginContext, extraConf: util.Map[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;]): Unit = {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (checkingInterval == 1) {
      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; UnsatisfiedLinkError(&lt;span class=&quot;code-quote&quot;&gt;&quot;My Exception error&quot;&lt;/span&gt;)
    }
  }
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The Executor is active when we check in spark-ui, however it was broken and doesn&apos;t receive any task.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Root Cause:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;I check the code and I find in `org.apache.spark.rpc.netty.Inbox#safelyCall` it will throw fatal error (`UnsatisfiedLinkError` is fatal erro ) in method `dealWithFatalError` . Actually the&#160; `CoarseGrainedExecutorBackend` JVM process&#160; is active but the&#160; communication thread is no longer working ( please see&#160; `MessageLoop#receiveLoopRunnable` , `receiveLoop()` was broken, so executor doesn&apos;t receive any message)&lt;/p&gt;

&lt;p&gt;Some ideas:&lt;br/&gt;
I think it is very hard to know what happened here unless we check in the code. The Executor is active but it can&apos;t do anything. We will wonder if the driver is broken or the Executor problem.&#160; I think at least the Executor status shouldn&apos;t be active here or the Executor can exitExecutor (kill itself)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13479950">SPARK-40320</key>
            <summary>When the Executor plugin fails to initialize, the Executor shows active but does not accept tasks forever, just like being hung</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="choko111">miracle</assignee>
                                    <reporter username="miracle">Mars</reporter>
                        <labels>
                    </labels>
                <created>Sat, 3 Sep 2022 02:26:46 +0000</created>
                <updated>Wed, 26 Oct 2022 06:50:11 +0000</updated>
                            <resolved>Wed, 26 Oct 2022 06:48:46 +0000</resolved>
                                    <version>3.0.0</version>
                                    <fixVersion>3.4.0</fixVersion>
                                    <component>Scheduler</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17599763" author="apachespark" created="Sat, 3 Sep 2022 03:17:45 +0000"  >&lt;p&gt;User &apos;yabola&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/37779&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/37779&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17599764" author="apachespark" created="Sat, 3 Sep 2022 03:18:10 +0000"  >&lt;p&gt;User &apos;yabola&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/37779&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/37779&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17600777" author="ngone51" created="Tue, 6 Sep 2022 13:53:45 +0000"  >&lt;p&gt;&amp;gt; Actually the&#160; `CoarseGrainedExecutorBackend` JVM process&#160; is active but the&#160; communication thread is no longer working ( please see&#160; `MessageLoop#receiveLoopRunnable` , `receiveLoop()` was broken, so executor doesn&apos;t receive any message)&lt;/p&gt;

&lt;p&gt;Hmm, shouldn&apos;t it bring up a new `receiveLoop()` to serve RPC messages according to &lt;a href=&quot;https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/rpc/netty/MessageLoop.scala#L82-L89&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/rpc/netty/MessageLoop.scala#L82-L89&lt;/a&gt; . Why it doesn&apos;t?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Besides, why&#160;SparkUncaughtExceptionHandler doesn&apos;t catch the fatal error?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tgraves&quot; class=&quot;user-hover&quot; rel=&quot;tgraves&quot;&gt;tgraves&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mridulm80&quot; class=&quot;user-hover&quot; rel=&quot;mridulm80&quot;&gt;mridulm80&lt;/a&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17601543" author="JIRAUSER290821" created="Wed, 7 Sep 2022 22:46:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Ngone51&quot; class=&quot;user-hover&quot; rel=&quot;Ngone51&quot;&gt;Ngone51&lt;/a&gt;&#160;&lt;br/&gt;
Shouldn&apos;t it bring up a new `receiveLoop()` to serve RPC messages?&lt;/p&gt;

&lt;p&gt;Yes, my previous thinking was wrong. I remote debug on Executor and I found that it did catch the fatal error in &lt;a href=&quot;https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/rpc/netty/MessageLoop.scala#L82-L89&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/rpc/netty/MessageLoop.scala#L82-L89&lt;/a&gt; .&lt;br/&gt;
It will resubmit receiveLoop and in the second time it will block by &lt;a href=&quot;https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/rpc/netty/MessageLoop.scala#L69&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/rpc/netty/MessageLoop.scala#L69&lt;/a&gt;&lt;br/&gt;
This Executor did not initialize successfully in the first time , so it didn&apos;t send LaunchedExecutor to Driver (you can see &lt;a href=&quot;https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/executor/CoarseGrainedExecutorBackend.scala#L172&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/executor/CoarseGrainedExecutorBackend.scala#L172&lt;/a&gt; )&lt;/p&gt;

&lt;p&gt;So the Executor can&apos;t launch task, related PR &lt;a href=&quot;https://github.com/apache/spark/pull/25964&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/25964&lt;/a&gt; .&lt;/p&gt;

&lt;p&gt;Why SparkUncaughtExceptionHandler doesn&apos;t catch the fatal error?&lt;br/&gt;
See &lt;a href=&quot;https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/executor/Executor.scala#L284&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/executor/Executor.scala#L284&lt;/a&gt; plugins is private variable, so it was broken when initialize Executor at the beginning.&lt;/p&gt;</comment>
                            <comment id="17608268" author="ngone51" created="Thu, 22 Sep 2022 12:57:18 +0000"  >&lt;p&gt;I see. Thanks for the explaination.&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 7 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z18ah4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>