<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:19:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-3877] The exit code of spark-submit is still 0 when an yarn application fails</title>
                <link>https://issues.apache.org/jira/browse/SPARK-3877</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;When an yarn application fails (yarn-cluster mode), the exit code of spark-submit is still 0. It&apos;s hard for people to write some automatic scripts to run spark jobs in yarn because the failure can not be detected in these scripts.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12746990">SPARK-3877</key>
            <summary>The exit code of spark-submit is still 0 when an yarn application fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zsxwing">Shixiong Zhu</assignee>
                                    <reporter username="zsxwing">Shixiong Zhu</reporter>
                        <labels>
                            <label>yarn</label>
                    </labels>
                <created>Thu, 9 Oct 2014 10:52:34 +0000</created>
                <updated>Fri, 17 Feb 2017 23:20:46 +0000</updated>
                            <resolved>Wed, 22 Oct 2014 22:08:58 +0000</resolved>
                                    <version>1.1.0</version>
                                    <fixVersion>1.1.1</fixVersion>
                    <fixVersion>1.2.0</fixVersion>
                                    <component>YARN</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14164993" author="apachespark" created="Thu, 9 Oct 2014 11:00:33 +0000"  >&lt;p&gt;User &apos;zsxwing&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/2732&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/2732&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14165124" author="tgraves" created="Thu, 9 Oct 2014 13:36:21 +0000"  >&lt;p&gt;this looks like a dup of &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-2167&quot; title=&quot;spark-submit should return exit code based on failure/success&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-2167&quot;&gt;&lt;del&gt;SPARK-2167&lt;/del&gt;&lt;/a&gt;.  Or actually perhaps a subset of that since I think you only handle the yarn mode.   Does this cover both client and cluster mode?&lt;/p&gt;
</comment>
                            <comment id="14174507" author="vanzin" created="Fri, 17 Oct 2014 00:08:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tgraves&quot; class=&quot;user-hover&quot; rel=&quot;tgraves&quot;&gt;tgraves&lt;/a&gt; this can be seen as a subset of &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-2167&quot; title=&quot;spark-submit should return exit code based on failure/success&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-2167&quot;&gt;&lt;del&gt;SPARK-2167&lt;/del&gt;&lt;/a&gt;, but as I mentioned on that bug, I don&apos;t think it&apos;s fixable for all cases. SparkSubmit is executing user code, so it can only report errors when the user code does. &lt;/p&gt;

&lt;p&gt;e.g., a job like this would report an error today&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  val sc = ...
  &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
    &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; stuff
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (somethingBad) &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; MyJobFailedException()
  } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
    sc.stop()
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But this one wouldn&apos;t:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  val sc = ...
  &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
    &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; stuff
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (somethingBad) &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; MyJobFailedException()
  } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; {
    &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; e: Exception =&amp;gt; logError(&lt;span class=&quot;code-quote&quot;&gt;&quot;Oops, something bad happened.&quot;&lt;/span&gt;, e)
  } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
    sc.stop()
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;yarn-client mode will abruptly stop the SparkContext when the Yarn app fails. But depending on how the user&apos;s &lt;tt&gt;main()&lt;/tt&gt; deals with errors, that still may not result in a non-zero exit status.&lt;/p&gt;</comment>
                            <comment id="14174999" author="tgraves" created="Fri, 17 Oct 2014 12:29:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vanzin&quot; class=&quot;user-hover&quot; rel=&quot;vanzin&quot;&gt;vanzin&lt;/a&gt;  I agree. The user code should be exiting with non-zero or throwing on failure.  If they aren&apos;t then there is nothing we can do about it, other then tell them to change their code to properly exit if they want to see failure status. Perhaps we should better document what they should do on failure too.   Its basically the same I did for the exit codes in ApplicationMaster. It relies on user code exiting non-zero and throwing.&lt;/p&gt;

&lt;p&gt;The only other option would be for us to actually look at the details in the scheduler ourselves to try to determine what happened.  ie we see Stage X failed or Y tasks failed, etc.  I would say we do that later if its needed. &lt;/p&gt;
</comment>
                            <comment id="14180628" author="apachespark" created="Wed, 22 Oct 2014 22:08:45 +0000"  >&lt;p&gt;User &apos;zsxwing&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/2748&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/2748&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15011690" author="sams" created="Wed, 18 Nov 2015 19:00:31 +0000"  >&lt;p&gt;Is this really fixed?? I&apos;m getting this on 1.5.0 using EMR.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tgraves&quot; class=&quot;user-hover&quot; rel=&quot;tgraves&quot;&gt;tgraves&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vanzin&quot; class=&quot;user-hover&quot; rel=&quot;vanzin&quot;&gt;vanzin&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zsxwing&quot; class=&quot;user-hover&quot; rel=&quot;zsxwing&quot;&gt;zsxwing&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15014683" author="sams" created="Thu, 19 Nov 2015 23:05:55 +0000"  >&lt;p&gt;Actually ignore, as per comment in duplicate, can&apos;t seem to reproduce.&lt;/p&gt;</comment>
                            <comment id="15812752" author="j_caplan" created="Mon, 9 Jan 2017 20:24:11 +0000"  >&lt;p&gt;I think you have created a race condition with this fix which I am encountering about 50% of the time, using Spark 1.6.3.  I have configured YARN not to keep &lt;b&gt;any&lt;/b&gt; recent jobs in memory, as some of my jobs get pretty large.&lt;/p&gt;

&lt;p&gt;yarn-site	yarn.resourcemanager.max-completed-applications	0&lt;/p&gt;

&lt;p&gt;The once-per-second call to getApplicationReport may thus encounter a RUNNING application followed by a not found application, and report a false negative.&lt;/p&gt;

&lt;p&gt;(typical) Executor log:&lt;br/&gt;
17/01/09 19:31:23 INFO ApplicationMaster: Final app status: SUCCEEDED, exitCode: 0&lt;br/&gt;
17/01/09 19:31:23 INFO SparkContext: Invoking stop() from shutdown hook&lt;br/&gt;
17/01/09 19:31:24 INFO SparkUI: Stopped Spark web UI at &lt;a href=&quot;http://10.0.0.168:37046&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://10.0.0.168:37046&lt;/a&gt;&lt;br/&gt;
17/01/09 19:31:24 INFO YarnClusterSchedulerBackend: Shutting down all executors&lt;br/&gt;
17/01/09 19:31:24 INFO YarnClusterSchedulerBackend: Asking each executor to shut down&lt;br/&gt;
17/01/09 19:31:24 INFO MapOutputTrackerMasterEndpoint: MapOutputTrackerMasterEndpoint stopped!&lt;br/&gt;
17/01/09 19:31:24 INFO MemoryStore: MemoryStore cleared&lt;br/&gt;
17/01/09 19:31:24 INFO BlockManager: BlockManager stopped&lt;br/&gt;
17/01/09 19:31:24 INFO BlockManagerMaster: BlockManagerMaster stopped&lt;br/&gt;
17/01/09 19:31:24 INFO OutputCommitCoordinator$OutputCommitCoordinatorEndpoint: OutputCommitCoordinator stopped!&lt;br/&gt;
17/01/09 19:31:24 INFO SparkContext: Successfully stopped SparkContext&lt;br/&gt;
17/01/09 19:31:24 INFO ApplicationMaster: Unregistering ApplicationMaster with SUCCEEDED&lt;br/&gt;
17/01/09 19:31:24 INFO RemoteActorRefProvider$RemotingTerminator: Shutting down remote daemon.&lt;br/&gt;
17/01/09 19:31:24 INFO RemoteActorRefProvider$RemotingTerminator: Remote daemon shut down; proceeding with flushing remote transports.&lt;br/&gt;
17/01/09 19:31:24 INFO AMRMClientImpl: Waiting for application to be successfully unregistered.&lt;br/&gt;
17/01/09 19:31:24 INFO RemoteActorRefProvider$RemotingTerminator: Remoting shut down.&lt;/p&gt;

&lt;p&gt;Client log:&lt;br/&gt;
17/01/09 19:31:23 INFO Client: Application report for application_1483983939941_0056 (state: RUNNING)&lt;br/&gt;
17/01/09 19:31:24 ERROR Client: Application application_1483983939941_0056 not found.&lt;br/&gt;
Exception in thread &quot;main&quot; org.apache.spark.SparkException: Application application_1483983939941_0056 is killed&lt;br/&gt;
	at org.apache.spark.deploy.yarn.Client.run(Client.scala:1038)&lt;br/&gt;
	at org.apache.spark.deploy.yarn.Client$.main(Client.scala:1081)&lt;br/&gt;
	at org.apache.spark.deploy.yarn.Client.main(Client.scala)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:606)&lt;br/&gt;
	at org.apache.spark.deploy.SparkSubmit$.org$apache$spark$deploy$SparkSubmit$$runMain(SparkSubmit.scala:731)&lt;br/&gt;
	at org.apache.spark.deploy.SparkSubmit$.doRunMain$1(SparkSubmit.scala:181)&lt;br/&gt;
	at org.apache.spark.deploy.SparkSubmit$.submit(SparkSubmit.scala:206)&lt;br/&gt;
	at org.apache.spark.deploy.SparkSubmit$.main(SparkSubmit.scala:121)&lt;br/&gt;
	at org.apache.spark.deploy.SparkSubmit.main(SparkSubmit.scala)&lt;/p&gt;</comment>
                            <comment id="15826444" author="j_caplan" created="Tue, 17 Jan 2017 17:31:11 +0000"  >&lt;p&gt;see also &lt;a href=&quot;https://issues.apache.org/jira/browse/MAPREDUCE-6091&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/MAPREDUCE-6091&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15826517" author="vanzin" created="Tue, 17 Jan 2017 18:03:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=j_caplan&quot; class=&quot;user-hover&quot; rel=&quot;j_caplan&quot;&gt;j_caplan&lt;/a&gt; can you open a new bug for that issue?&lt;/p&gt;</comment>
                            <comment id="15872720" author="j_caplan" created="Fri, 17 Feb 2017 23:20:46 +0000"  >&lt;p&gt;Done, as &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-19649&quot; title=&quot;Spark YARN client throws exception if job succeeds and max-completed-applications=0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-19649&quot;&gt;&lt;del&gt;SPARK-19649&lt;/del&gt;&lt;/a&gt; .&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10020">
                    <name>Cloners</name>
                                                                <inwardlinks description="is cloned by">
                                        <issuelink>
            <issuekey id="12914480">SPARK-11854</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12914480">SPARK-11854</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="13044142">SPARK-19649</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 39 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i20zcv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12327368">1.1.1</customfieldvalue>
    <customfieldvalue id="12327369">1.2.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>