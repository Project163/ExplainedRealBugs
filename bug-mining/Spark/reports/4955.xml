<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:54:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-20923] TaskMetrics._updatedBlockStatuses uses a lot of memory</title>
                <link>https://issues.apache.org/jira/browse/SPARK-20923</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;The driver appears to use a ton of memory in certain cases to store the task metrics updated block status&apos;.  For instance I had a user reading data form hive and caching it.  The # of tasks to read was around 62,000, they were using 1000 executors and it ended up caching a couple TB&apos;s of data.  The driver kept running out of memory. &lt;/p&gt;

&lt;p&gt;I investigated and it looks like there was 5GB of a 10GB heap being used up by the TaskMetrics._updatedBlockStatuses because there are a lot of blocks.&lt;/p&gt;

&lt;p&gt;The updatedBlockStatuses was already removed from the task end event under &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-20084&quot; title=&quot;Remove internal.metrics.updatedBlockStatuses accumulator from history files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-20084&quot;&gt;&lt;del&gt;SPARK-20084&lt;/del&gt;&lt;/a&gt;.  I don&apos;t see anything else that seems to be using this.  Anybody know if I missed something?&lt;/p&gt;

&lt;p&gt; If its not being used we should remove it, otherwise we need to figure out a better way of doing it so it doesn&apos;t use so much memory.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13075883">SPARK-20923</key>
            <summary>TaskMetrics._updatedBlockStatuses uses a lot of memory</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tgraves">Thomas Graves</assignee>
                                    <reporter username="tgraves">Thomas Graves</reporter>
                        <labels>
                            <label>releasenotes</label>
                    </labels>
                <created>Tue, 30 May 2017 16:44:12 +0000</created>
                <updated>Fri, 23 Jun 2017 01:25:40 +0000</updated>
                            <resolved>Fri, 23 Jun 2017 01:20:10 +0000</resolved>
                                    <version>2.1.0</version>
                                    <fixVersion>2.3.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16029701" author="tgraves" created="Tue, 30 May 2017 16:44:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rdblue&quot; class=&quot;user-hover&quot; rel=&quot;rdblue&quot;&gt;rdblue&lt;/a&gt;  with &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-20084&quot; title=&quot;Remove internal.metrics.updatedBlockStatuses accumulator from history files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-20084&quot;&gt;&lt;del&gt;SPARK-20084&lt;/del&gt;&lt;/a&gt;, did you see anything using these updatedblockStatuses in TaskMetrics?&lt;/p&gt;</comment>
                            <comment id="16029847" author="rdblue" created="Tue, 30 May 2017 18:05:15 +0000"  >&lt;p&gt;I didn&apos;t look at the code path up to writing history files. I just confirmed that nothing based on the history file actually used them. Sounds like if we can stop tracking this entirely, that would be great!&lt;/p&gt;</comment>
                            <comment id="16029917" author="tgraves" created="Tue, 30 May 2017 18:52:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joshrosen&quot; class=&quot;user-hover&quot; rel=&quot;joshrosen&quot;&gt;joshrosen&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zsxwing&quot; class=&quot;user-hover&quot; rel=&quot;zsxwing&quot;&gt;zsxwing&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eseyfe&quot; class=&quot;user-hover&quot; rel=&quot;eseyfe&quot;&gt;eseyfe&lt;/a&gt; I think you have looked at this fairly recently, do you know if this is used by anything or anybody? I&apos;m not finding it used anywhere in the code or UI but maybe I&apos;m missing some obscure reference&lt;/p&gt;</comment>
                            <comment id="16029962" author="joshrosen" created="Tue, 30 May 2017 19:09:20 +0000"  >&lt;p&gt;It doesn&apos;t seem to be used, as far as I can tell from a quick skim. The best way to confirm would probably be to start removing it, deleting things which depend on this as you go (e.g. the TaskMetrics getter method for accessing the current value) and see if you run into anything which looks like a non-test use. I&apos;ll be happy to review a patch to clean this up.&lt;/p&gt;</comment>
                            <comment id="16030059" author="tgraves" created="Tue, 30 May 2017 20:22:46 +0000"  >&lt;p&gt;taking a quick look at the history of the _updatedBlockStatuses it looks like this used to be used for StorageStatusListener but it has been since changed to do this on the SparkListenerBlockUpdated event.  That BlockUpdated event is coming from the BlockManagerMaster.updateBlockInfo which is called by the executors.  So I&apos;m not seeing anything use _updatedBlockStatuses.  I&apos;ll start to rip it out and see what I hit.&lt;/p&gt;</comment>
                            <comment id="16031262" author="apachespark" created="Wed, 31 May 2017 14:47:03 +0000"  >&lt;p&gt;User &apos;tgravescs&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18162&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18162&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16060283" author="cloud_fan" created="Fri, 23 Jun 2017 01:25:40 +0000"  >&lt;p&gt;This patch changes the public behavior and we should mention it in the release notes. Basically users can track the status of updated blocks via &lt;tt&gt;SparkListenerTaskEnd&lt;/tt&gt; event, but this feature was introduced for internal usage at the beginning and I&apos;m wondering how many users are using this feature. After this patch we don&apos;t trach it anymore by default, users can still turn it on by setting &lt;tt&gt;spark.taskMetrics.trackUpdatedBlockStatuses&lt;/tt&gt; to true.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13076962">SPARK-20970</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 21 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3fn5r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>