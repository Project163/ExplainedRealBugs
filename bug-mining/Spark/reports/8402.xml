<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:29:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-36681] Fail to load Snappy codec</title>
                <link>https://issues.apache.org/jira/browse/SPARK-36681</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;snappy-java as a native library should not be relocated in Hadoop shaded client libraries. Currently we use Hadoop shaded client libraries in Spark. If trying to use SnappyCodec to write sequence file, we will encounter the following error:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[info]   Cause: java.lang.UnsatisfiedLinkError: org.apache.hadoop.shaded.org.xerial.snappy.SnappyNative.rawCompress(Ljava/nio/ByteBuffer;IILjava/nio/ByteBuffer;I)I
[info]   at org.apache.hadoop.shaded.org.xerial.snappy.SnappyNative.rawCompress(Native Method)                                                                                                 
[info]   at org.apache.hadoop.shaded.org.xerial.snappy.Snappy.compress(Snappy.java:151)                                                                                                        
[info]   at org.apache.hadoop.io.compress.snappy.SnappyCompressor.compressDirectBuf(SnappyCompressor.java:282)
[info]   at org.apache.hadoop.io.compress.snappy.SnappyCompressor.compress(SnappyCompressor.java:210)
[info]   at org.apache.hadoop.io.compress.BlockCompressorStream.compress(BlockCompressorStream.java:149)
[info]   at org.apache.hadoop.io.compress.BlockCompressorStream.finish(BlockCompressorStream.java:142)
[info]   at org.apache.hadoop.io.SequenceFile$BlockCompressWriter.writeBuffer(SequenceFile.java:1589) 
[info]   at org.apache.hadoop.io.SequenceFile$BlockCompressWriter.sync(SequenceFile.java:1605)
[info]   at org.apache.hadoop.io.SequenceFile$BlockCompressWriter.close(SequenceFile.java:1629) 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13399698">SPARK-36681</key>
            <summary>Fail to load Snappy codec</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="viirya">L. C. Hsieh</assignee>
                                    <reporter username="viirya">L. C. Hsieh</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Sep 2021 07:41:57 +0000</created>
                <updated>Fri, 23 Jun 2023 09:47:40 +0000</updated>
                            <resolved>Wed, 9 Mar 2022 17:08:03 +0000</resolved>
                                    <version>3.2.0</version>
                                    <fixVersion>3.3.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="17411707" author="gurwls223" created="Wed, 8 Sep 2021 06:12:41 +0000"  >&lt;p&gt;Is it 3.2 blocker?&lt;/p&gt;</comment>
                            <comment id="17411717" author="viirya" created="Wed, 8 Sep 2021 06:31:25 +0000"  >&lt;p&gt;yea.&lt;/p&gt;</comment>
                            <comment id="17412273" author="viirya" created="Thu, 9 Sep 2021 02:09:37 +0000"  >&lt;p&gt;After discussing with some PMC members, as this only affects sequence file (snappy codec), we will document it as known issue for 3.2 release. I will change it from blocker to normal bug.&lt;/p&gt;</comment>
                            <comment id="17412274" author="gurwls223" created="Thu, 9 Sep 2021 02:11:54 +0000"  >&lt;p&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/thumbs_up.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17414544" author="holdenk" created="Mon, 13 Sep 2021 19:39:15 +0000"  >&lt;p&gt;Is there a known work around? Can we put the workaround in the release notes?&lt;/p&gt;</comment>
                            <comment id="17414577" author="viirya" created="Mon, 13 Sep 2021 20:39:18 +0000"  >&lt;p&gt;The possible workaround is to use pure java implementation with snappy-java. So it doesn&apos;t try to load native library and we can avoid linked error.&lt;/p&gt;

&lt;p&gt;Let me try it locally to verify and put it here as release notes.&lt;/p&gt;</comment>
                            <comment id="17414792" author="viirya" created="Tue, 14 Sep 2021 08:02:42 +0000"  >&lt;p&gt;Unfortunately, I found some issues with the pure java implementation in snappy-java library. That&apos;s said even we switch to pure java mode, the Hadoop SnappyCodec still doesn&apos;t work for now.&lt;/p&gt;

&lt;p&gt;I have the fix locally for the issues, but it needs to wait for snappy-java and Hadoop new releases. &lt;/p&gt;</comment>
                            <comment id="17419557" author="smilegator" created="Fri, 24 Sep 2021 04:42:09 +0000"  >&lt;p&gt;Can you link the related Jira in&#160;Apache Hadoop?&lt;/p&gt;</comment>
                            <comment id="17430303" author="koert" created="Tue, 19 Oct 2021 04:11:51 +0000"  >&lt;p&gt;hadoop Jira issue:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-17891&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HADOOP-17891&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;i have my doubt this only impacts sequence files. i am seeing this issue with snappy compressed csv files, snappy compress json files, etc.&lt;/p&gt;</comment>
                            <comment id="17503362" author="apachespark" created="Wed, 9 Mar 2022 07:57:01 +0000"  >&lt;p&gt;User &apos;viirya&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/35784&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/35784&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17503737" author="viirya" created="Wed, 9 Mar 2022 17:08:03 +0000"  >&lt;p&gt;Issue resolved by pull request 35784&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/35784&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/35784&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17520254" author="apachespark" created="Mon, 11 Apr 2022 00:44:06 +0000"  >&lt;p&gt;User &apos;HyukjinKwon&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/36136&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/36136&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17520255" author="apachespark" created="Mon, 11 Apr 2022 00:44:28 +0000"  >&lt;p&gt;User &apos;HyukjinKwon&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/36136&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/36136&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17542453" author="apachespark" created="Thu, 26 May 2022 11:53:04 +0000"  >&lt;p&gt;User &apos;peter-toth&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/36687&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/36687&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17615087" author="JIRAUSER296323" created="Mon, 10 Oct 2022 12:38:17 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=viirya&quot; class=&quot;user-hover&quot; rel=&quot;viirya&quot;&gt;viirya&lt;/a&gt;, So this is only fixed in 3.3.0 and after?&lt;br/&gt;
Any workaround in 3.2?&lt;/p&gt;

&lt;p&gt;Many Thanks!&lt;/p&gt;</comment>
                            <comment id="17615201" author="viirya" created="Mon, 10 Oct 2022 16:31:28 +0000"  >&lt;p&gt;This is fixed in 3.3.0 and later, yes, by upgrading to Hadoop 3.3.2.&lt;br/&gt;
As discussed above, there is no workaround in 3.2 for this issue.&lt;br/&gt;
If you are stick with 3.2, the only way is to upgrade to Hadoop 3.3.2 in Spark 3.2 source.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13399415">HADOOP-17891</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13316391">HADOOP-17125</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 5 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0uo4o:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>