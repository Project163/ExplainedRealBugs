<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:55:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-21759] In.checkInputDataTypes should not wrongly report unresolved plans for IN correlated subquery</title>
                <link>https://issues.apache.org/jira/browse/SPARK-21759</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;With the check for structural integrity proposed in &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-21726&quot; title=&quot;Check for structural integrity of the plan in QO in test mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-21726&quot;&gt;&lt;del&gt;SPARK-21726&lt;/del&gt;&lt;/a&gt;, I found that an optimization rule &lt;tt&gt;PullupCorrelatedPredicates&lt;/tt&gt; can produce unresolved plans.&lt;/p&gt;

&lt;p&gt;For a correlated IN query like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Project [a#0]
+- Filter a#0 IN (list#4 [b#1])
   :  +- Project [c#2]
   :     +- Filter (&lt;span class=&quot;code-keyword&quot;&gt;outer&lt;/span&gt;(b#1) &amp;lt; d#3)
   :        +- LocalRelation &amp;lt;empty&amp;gt;, [c#2, d#3]
   +- LocalRelation &amp;lt;empty&amp;gt;, [a#0, b#1]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After &lt;tt&gt;PullupCorrelatedPredicates&lt;/tt&gt;, it produces query plan like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&apos;Project [a#0]
+- &apos;Filter a#0 IN (list#4 [(b#1 &amp;lt; d#3)])
   :  +- Project [c#2, d#3]
   :     +- LocalRelation &amp;lt;empty&amp;gt;, [c#2, d#3]
   +- LocalRelation &amp;lt;empty&amp;gt;, [a#0, b#1]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Because the correlated predicate involves another attribute &lt;tt&gt;d#3&lt;/tt&gt; in subquery, it has been pulled out and added into the &lt;tt&gt;Project&lt;/tt&gt; on the top of the subquery.&lt;/p&gt;

&lt;p&gt;When &lt;tt&gt;list&lt;/tt&gt; in &lt;tt&gt;In&lt;/tt&gt; contains just one &lt;tt&gt;ListQuery&lt;/tt&gt;, &lt;tt&gt;In.checkInputDataTypes&lt;/tt&gt; checks if the size of &lt;tt&gt;value&lt;/tt&gt; expressions matches the output size of subquery. In the above example, there is only &lt;tt&gt;value&lt;/tt&gt; expression and the subquery output has two attributes &lt;tt&gt;c#2, d#3&lt;/tt&gt;, so it fails the check and &lt;tt&gt;In.resolved&lt;/tt&gt; returns &lt;tt&gt;false&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;We should not let &lt;tt&gt;In.checkInputDataTypes&lt;/tt&gt; wrongly report unresolved plans to fail the structural integrity check.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="13095223">SPARK-21759</key>
            <summary>In.checkInputDataTypes should not wrongly report unresolved plans for IN correlated subquery</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="viirya">L. C. Hsieh</assignee>
                                    <reporter username="viirya">L. C. Hsieh</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 Aug 2017 04:09:43 +0000</created>
                <updated>Thu, 24 Aug 2017 13:47:58 +0000</updated>
                            <resolved>Thu, 24 Aug 2017 13:47:55 +0000</resolved>
                                    <version>2.2.0</version>
                                    <fixVersion>2.3.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16131493" author="viirya" created="Thu, 17 Aug 2017 23:46:44 +0000"  >&lt;p&gt;Submitted PR at &lt;a href=&quot;https://github.com/apache/spark/pull/18968&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18968&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16140045" author="cloud_fan" created="Thu, 24 Aug 2017 13:47:55 +0000"  >&lt;p&gt;Issue resolved by pull request 18968&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18968&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18968&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 12 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ivw7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>