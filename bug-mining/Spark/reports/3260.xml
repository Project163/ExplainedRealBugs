<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:40:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-13622] Issue creating level db file for YARN shuffle service if URI is used in yarn.nodemanager.local-dirs</title>
                <link>https://issues.apache.org/jira/browse/SPARK-13622</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;After activating the spark external shuffle service for YARN in order to have dynamic ressource allocation I face those level db creation issues on the nodemanager:&lt;br/&gt;
2016-03-02 03:13:59,692 ERROR org.apache.spark.network.shuffle.ExternalShuffleBlockResolver: error opening leveldb file &lt;a href=&quot;file:/data/yarn/cache/yarn/nm-local-dir/registeredExecutors.ldb&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:/data/yarn/cache/yarn/nm-local-dir/registeredExecutors.ldb&lt;/a&gt;.  Creating new file, will not be able to recover state for existing applications&lt;br/&gt;
org.fusesource.leveldbjni.internal.NativeDB$DBException: IO error: /usr/lib/hadoop-yarn/&lt;a href=&quot;file:/data/yarn/cache/yarn/nm-local-dir/registeredExecutors.ldb/LOCK:&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:/data/yarn/cache/yarn/nm-local-dir/registeredExecutors.ldb/LOCK:&lt;/a&gt; Aucun fichier ou dossier de ce type&lt;br/&gt;
        at org.fusesource.leveldbjni.internal.NativeDB.checkStatus(NativeDB.java:200)&lt;br/&gt;
        at org.fusesource.leveldbjni.internal.NativeDB.open(NativeDB.java:218)&lt;br/&gt;
        at org.fusesource.leveldbjni.JniDBFactory.open(JniDBFactory.java:168)&lt;br/&gt;
        at org.apache.spark.network.shuffle.ExternalShuffleBlockResolver.&amp;lt;init&amp;gt;(ExternalShuffleBlockResolver.java:100)&lt;br/&gt;
        at org.apache.spark.network.shuffle.ExternalShuffleBlockResolver.&amp;lt;init&amp;gt;(ExternalShuffleBlockResolver.java:81)&lt;br/&gt;
        at org.apache.spark.network.shuffle.ExternalShuffleBlockHandler.&amp;lt;init&amp;gt;(ExternalShuffleBlockHandler.java:56)&lt;br/&gt;
        at org.apache.spark.network.yarn.YarnShuffleService.serviceInit(YarnShuffleService.java:128)&lt;br/&gt;
        at org.apache.hadoop.service.AbstractService.init(AbstractService.java:163)&lt;br/&gt;
        at org.apache.hadoop.yarn.server.nodemanager.containermanager.AuxServices.serviceInit(AuxServices.java:143)&lt;br/&gt;
        at org.apache.hadoop.service.AbstractService.init(AbstractService.java:163)&lt;br/&gt;
        at org.apache.hadoop.service.CompositeService.serviceInit(CompositeService.java:107)&lt;br/&gt;
        at org.apache.hadoop.yarn.server.nodemanager.containermanager.ContainerManagerImpl.serviceInit(ContainerManagerImpl.java:236)&lt;br/&gt;
        at org.apache.hadoop.service.AbstractService.init(AbstractService.java:163)&lt;br/&gt;
        at org.apache.hadoop.service.CompositeService.serviceInit(CompositeService.java:107)&lt;br/&gt;
        at org.apache.hadoop.yarn.server.nodemanager.NodeManager.serviceInit(NodeManager.java:255)&lt;br/&gt;
        at org.apache.hadoop.service.AbstractService.init(AbstractService.java:163)&lt;br/&gt;
        at org.apache.hadoop.yarn.server.nodemanager.NodeManager.initAndStartNodeManager(NodeManager.java:474)&lt;br/&gt;
        at org.apache.hadoop.yarn.server.nodemanager.NodeManager.main(NodeManager.java:521)&lt;br/&gt;
2016-03-02 03:13:59,694 WARN org.apache.spark.network.shuffle.ExternalShuffleBlockResolver: error deleting &lt;a href=&quot;file:/data/yarn/cache/yarn/nm-local-dir/registeredExecutors.ldb&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:/data/yarn/cache/yarn/nm-local-dir/registeredExecutors.ldb&lt;/a&gt;&lt;br/&gt;
2016-03-02 03:13:59,694 ERROR org.apache.spark.network.yarn.YarnShuffleService: Failed to initialize external shuffle service&lt;br/&gt;
java.io.IOException: Unable to create state store&lt;br/&gt;
        at org.apache.spark.network.shuffle.ExternalShuffleBlockResolver.&amp;lt;init&amp;gt;(ExternalShuffleBlockResolver.java:129)&lt;br/&gt;
        at org.apache.spark.network.shuffle.ExternalShuffleBlockResolver.&amp;lt;init&amp;gt;(ExternalShuffleBlockResolver.java:81)&lt;br/&gt;
        at org.apache.spark.network.shuffle.ExternalShuffleBlockHandler.&amp;lt;init&amp;gt;(ExternalShuffleBlockHandler.java:56)&lt;br/&gt;
        at org.apache.spark.network.yarn.YarnShuffleService.serviceInit(YarnShuffleService.java:128)&lt;br/&gt;
        at org.apache.hadoop.service.AbstractService.init(AbstractService.java:163)&lt;br/&gt;
        at org.apache.hadoop.yarn.server.nodemanager.containermanager.AuxServices.serviceInit(AuxServices.java:143)&lt;br/&gt;
        at org.apache.hadoop.service.AbstractService.init(AbstractService.java:163)&lt;br/&gt;
        at org.apache.hadoop.service.CompositeService.serviceInit(CompositeService.java:107)&lt;br/&gt;
        at org.apache.hadoop.yarn.server.nodemanager.containermanager.ContainerManagerImpl.serviceInit(ContainerManagerImpl.java:236)&lt;br/&gt;
        at org.apache.hadoop.service.AbstractService.init(AbstractService.java:163)&lt;br/&gt;
        at org.apache.hadoop.service.CompositeService.serviceInit(CompositeService.java:107)&lt;br/&gt;
        at org.apache.hadoop.yarn.server.nodemanager.NodeManager.serviceInit(NodeManager.java:255)&lt;br/&gt;
        at org.apache.hadoop.service.AbstractService.init(AbstractService.java:163)&lt;br/&gt;
        at org.apache.hadoop.yarn.server.nodemanager.NodeManager.initAndStartNodeManager(NodeManager.java:474)&lt;br/&gt;
        at org.apache.hadoop.yarn.server.nodemanager.NodeManager.main(NodeManager.java:521)&lt;br/&gt;
Caused by: org.fusesource.leveldbjni.internal.NativeDB$DBException: IO error: /usr/lib/hadoop-yarn/&lt;a href=&quot;file:/data/yarn/cache/yarn/nm-local-dir/registeredExecutors.ldb/LOCK:&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:/data/yarn/cache/yarn/nm-local-dir/registeredExecutors.ldb/LOCK:&lt;/a&gt; Aucun fichier ou dossier de ce type&lt;br/&gt;
        at org.fusesource.leveldbjni.internal.NativeDB.checkStatus(NativeDB.java:200)&lt;br/&gt;
        at org.fusesource.leveldbjni.internal.NativeDB.open(NativeDB.java:218)&lt;br/&gt;
        at org.fusesource.leveldbjni.JniDBFactory.open(JniDBFactory.java:168)&lt;br/&gt;
        at org.apache.spark.network.shuffle.ExternalShuffleBlockResolver.&amp;lt;init&amp;gt;(ExternalShuffleBlockResolver.java:127)&lt;br/&gt;
        ... 14 more&lt;/p&gt;


&lt;p&gt;On the yarn-site.xml config file I used URI to set path:&lt;br/&gt;
 &amp;lt;property&amp;gt;&lt;br/&gt;
        &amp;lt;description&amp;gt;List of directories to store localized files in.&amp;lt;/description&amp;gt;&lt;br/&gt;
        &amp;lt;name&amp;gt;yarn.nodemanager.local-dirs&amp;lt;/name&amp;gt;&lt;br/&gt;
        &amp;lt;value&amp;gt;&lt;a href=&quot;file:///data/yarn/cache/$&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:///data/yarn/cache/$&lt;/a&gt;{user.name}/nm-local-dir&amp;lt;/value&amp;gt;&lt;br/&gt;
    &amp;lt;/property&amp;gt;&lt;/p&gt;

&lt;p&gt;If I removed the scheme for this config in order to have /data/yarn/cache/${user.name}/nm-local-dir the nodemanager not face this issue and the level db is well created.&lt;/p&gt;</description>
                <environment>&lt;p&gt;cdh 5.5.2&lt;/p&gt;</environment>
        <key id="12946238">SPARK-13622</key>
            <summary>Issue creating level db file for YARN shuffle service if URI is used in yarn.nodemanager.local-dirs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ashangit">Nicolas Fraison</assignee>
                                    <reporter username="ashangit">Nicolas Fraison</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Mar 2016 18:36:02 +0000</created>
                <updated>Sun, 17 May 2020 18:16:47 +0000</updated>
                            <resolved>Mon, 28 Mar 2016 21:11:57 +0000</resolved>
                                    <version>1.6.0</version>
                                    <fixVersion>1.6.2</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>Spark Core</component>
                    <component>YARN</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15176419" author="apachespark" created="Wed, 2 Mar 2016 20:35:03 +0000"  >&lt;p&gt;User &apos;ashangit&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/11475&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/11475&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 37 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2u1nj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>