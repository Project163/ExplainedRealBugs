<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:26:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-36128] CatalogFileIndex.filterPartitions should respect spark.sql.hive.metastorePartitionPruning</title>
                <link>https://issues.apache.org/jira/browse/SPARK-36128</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Currently the config &lt;tt&gt;spark.sql.hive.metastorePartitionPruning&lt;/tt&gt; is only used in &lt;tt&gt;PruneHiveTablePartitions&lt;/tt&gt; but not &lt;tt&gt;PruneFileSourcePartitions&lt;/tt&gt;. The latter calls &lt;tt&gt;CatalogFileIndex.filterPartitions&lt;/tt&gt; which calls &lt;tt&gt;listPartitionsByFilter&lt;/tt&gt; regardless of whether the above config is set or not. &lt;/p&gt;</description>
                <environment></environment>
        <key id="13389494">SPARK-36128</key>
            <summary>CatalogFileIndex.filterPartitions should respect spark.sql.hive.metastorePartitionPruning</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="csun">Chao Sun</assignee>
                                    <reporter username="csun">Chao Sun</reporter>
                        <labels>
                    </labels>
                <created>Wed, 14 Jul 2021 00:41:23 +0000</created>
                <updated>Mon, 12 Dec 2022 18:11:03 +0000</updated>
                            <resolved>Fri, 16 Jul 2021 20:33:15 +0000</resolved>
                                    <version>3.2.0</version>
                                    <fixVersion>3.2.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17380287" author="gurwls223" created="Wed, 14 Jul 2021 03:51:31 +0000"  >&lt;p&gt;hm, isn&apos;t &lt;tt&gt;spark.sql.hive.metastorePartitionPruning&lt;/tt&gt; only for Hive table scan? &lt;/p&gt;</comment>
                            <comment id="17380299" author="csun" created="Wed, 14 Jul 2021 04:24:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hyukjin.kwon&quot; class=&quot;user-hover&quot; rel=&quot;hyukjin.kwon&quot;&gt;hyukjin.kwon&lt;/a&gt; you are right - I didn&apos;t know this config is designed to be only used by Hive table scan, but this poses a few issues:&lt;br/&gt;
1. by default, data source tables also manage their partitions through HMS, via config &lt;tt&gt;spark.sql.hive.manageFilesourcePartitions&lt;/tt&gt;. This config also says &quot;When partition management is enabled, datasource tables store partition in the Hive metastore, and use the metastore to prune partitions during query planning&quot;, so it sounds like they should have the same partition pruning mechanism as Hive tables, including the flag.&lt;br/&gt;
2. there is effectively only one implementation for &lt;tt&gt;ExternalCatalog&lt;/tt&gt; which is HMS, so I&apos;m not sure why we treat Hive table scans differently than data source table scans, even though both of them are reading partition metadata from HMS.&lt;/p&gt;</comment>
                            <comment id="17380307" author="gurwls223" created="Wed, 14 Jul 2021 04:40:14 +0000"  >&lt;p&gt;That&apos;s okay. I was just thinking that we might have to have a separate config instead of reusing &lt;tt&gt;spark.sql.hive.metastorePartitionPruning&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17380326" author="csun" created="Wed, 14 Jul 2021 05:24:29 +0000"  >&lt;p&gt;Thanks, I&apos;m slightly inclined to reuse the existing config but document the new behavior (e.g., it is used for data source tables too when &lt;tt&gt;spark.sql.hive.manageFilesourcePartitions&lt;/tt&gt; is set). Let me raise a PR for this and we can discuss there.&lt;/p&gt;</comment>
                            <comment id="17380736" author="apachespark" created="Wed, 14 Jul 2021 16:47:26 +0000"  >&lt;p&gt;User &apos;sunchao&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/33348&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/33348&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17380737" author="apachespark" created="Wed, 14 Jul 2021 16:48:35 +0000"  >&lt;p&gt;User &apos;sunchao&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/33348&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/33348&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17382328" author="viirya" created="Fri, 16 Jul 2021 20:33:15 +0000"  >&lt;p&gt;Issue resolved by pull request 33348&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/33348&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/33348&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 17 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0sx7c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>