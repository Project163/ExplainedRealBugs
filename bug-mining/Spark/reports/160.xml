<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:12:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-1403] Spark on Mesos does not set Thread&apos;s context class loader</title>
                <link>https://issues.apache.org/jira/browse/SPARK-1403</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;I can run spark 0.9.0 on mesos but not spark 1.0.0. This is because the spark executor on mesos slave throws a  java.lang.ClassNotFoundException for org.apache.spark.serializer.JavaSerializer.&lt;/p&gt;

&lt;p&gt;The lengthy discussion is here: &lt;a href=&quot;http://apache-spark-user-list.1001560.n3.nabble.com/java-lang-ClassNotFoundException-spark-on-mesos-td3510.html#a3513&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://apache-spark-user-list.1001560.n3.nabble.com/java-lang-ClassNotFoundException-spark-on-mesos-td3510.html#a3513&lt;/a&gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;ubuntu 12.04 on vagrant&lt;/p&gt;</environment>
        <key id="12706352">SPARK-1403</key>
            <summary>Spark on Mesos does not set Thread&apos;s context class loader</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="manku.timma">Bharath Bhushan</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 Apr 2014 02:54:25 +0000</created>
                <updated>Tue, 14 Jul 2015 02:59:57 +0000</updated>
                            <resolved>Tue, 14 Jul 2015 02:59:49 +0000</resolved>
                                    <version>1.0.0</version>
                    <version>1.3.0</version>
                    <version>1.4.0</version>
                                    <fixVersion>1.0.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="13959088" author="manku.timma" created="Thu, 3 Apr 2014 19:00:34 +0000"  >&lt;p&gt;In 0.9.0 I see that the classLoader is org.apache.spark.repl.ExecutorClassLoader (in SparkEnv.scala)&lt;br/&gt;
In 1.0.0 I see that the classLoader is null. My guess is that this should not be null.&lt;/p&gt;</comment>
                            <comment id="13962032" author="pwendell" created="Mon, 7 Apr 2014 17:24:35 +0000"  >&lt;p&gt;The underlying issue here is that we&apos;ve made assumptions in various parts of the codebase that the context classloader is set on a thread. In general, we should relax these assumptions and just fallback to the classloader that loaded Spark. As a workaround this patch:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/spark/pull/322/files&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/322/files&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;just manually sets the classloader to the system class loader.&lt;/p&gt;</comment>
                            <comment id="14375583" author="cnstar9988" created="Mon, 23 Mar 2015 08:43:32 +0000"  >&lt;p&gt;I want to reopen this bug, because I can reproduce it at spark 1.3.0 + mesos 0.21.1 with &quot;run-example SparkPi&quot; &lt;/p&gt;</comment>
                            <comment id="14577552" author="rkannan82" created="Mon, 8 Jun 2015 17:58:58 +0000"  >&lt;p&gt;A similar problem has been reported while running Spark on Mesos using MapR distribution. The current thread&apos;s context class loader is NULL inside the executor process causing NPE in MapR code.&lt;/p&gt;

&lt;p&gt;Refer to this discussion.&lt;br/&gt;
&lt;a href=&quot;http://answers.mapr.com/questions/163353/spark-from-apache-downloads-site-for-mapr.html#answer-163484&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://answers.mapr.com/questions/163353/spark-from-apache-downloads-site-for-mapr.html#answer-163484&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14581919" author="yanakad" created="Thu, 11 Jun 2015 13:23:56 +0000"  >&lt;p&gt;Multiple users reporting this is occuring again in 1.3&lt;/p&gt;</comment>
                            <comment id="14581933" author="mandoskippy" created="Thu, 11 Jun 2015 13:43:13 +0000"  >&lt;p&gt;Per Kannan: Seeing this in Spark 1.2.2, 1.3.0, an 1.3.1.  1.2.0 does not produce the error. The case I have is a NPE caused by what appears to be this bug. &lt;/p&gt;

&lt;p&gt;Tasks fail with the stack trace below.  Per a discussion on the relavent code in the MapR Shim, ] it is trying to get a root classloader to use for loading a bunch of classes. It uses the thread&apos;s context class loader (TCCL) and keeps going up the parent chain. The Null being sent causes the NPE.  The concern here is not so much (in this case) the MapR component not handling the NPE (Althought that should be addressed too) but that Spark is switching between versions.  Happy to provide any other details. &lt;/p&gt;

&lt;p&gt;Full Error on 1.3.1 on Mesos:&lt;br/&gt;
15/05/19 09:31:26 INFO MemoryStore: MemoryStore started with capacity 1060.3 MB java.lang.NullPointerException at com.mapr.fs.ShimLoader.getRootClassLoader(ShimLoader.java:96) at com.mapr.fs.ShimLoader.injectNativeLoader(ShimLoader.java:232) at com.mapr.fs.ShimLoader.load(ShimLoader.java:194) at org.apache.hadoop.conf.CoreDefaultProperties.(CoreDefaultProperties.java:60) at java.lang.Class.forName0(Native Method) at java.lang.Class.forName(Class.java:274) at org.apache.hadoop.conf.Configuration.getClassByNameOrNull(Configuration.java:1847) at org.apache.hadoop.conf.Configuration.getProperties(Configuration.java:2062) at org.apache.hadoop.conf.Configuration.loadResource(Configuration.java:2272) at org.apache.hadoop.conf.Configuration.loadResources(Configuration.java:2224) at org.apache.hadoop.conf.Configuration.getProps(Configuration.java:2141) at org.apache.hadoop.conf.Configuration.set(Configuration.java:992) at org.apache.hadoop.conf.Configuration.set(Configuration.java:966) at org.apache.spark.deploy.SparkHadoopUtil.newConfiguration(SparkHadoopUtil.scala:98) at org.apache.spark.deploy.SparkHadoopUtil.(SparkHadoopUtil.scala:43) at org.apache.spark.deploy.SparkHadoopUtil$.(SparkHadoopUtil.scala:220) at org.apache.spark.deploy.SparkHadoopUtil$.(SparkHadoopUtil.scala) at org.apache.spark.util.Utils$.getSparkOrYarnConfig(Utils.scala:1959) at org.apache.spark.storage.BlockManager.(BlockManager.scala:104) at org.apache.spark.storage.BlockManager.(BlockManager.scala:179) at org.apache.spark.SparkEnv$.create(SparkEnv.scala:310) at org.apache.spark.SparkEnv$.createExecutorEnv(SparkEnv.scala:186) at org.apache.spark.executor.MesosExecutorBackend.registered(MesosExecutorBackend.scala:70) java.lang.RuntimeException: Failure loading MapRClient. at com.mapr.fs.ShimLoader.injectNativeLoader(ShimLoader.java:283) at com.mapr.fs.ShimLoader.load(ShimLoader.java:194) at org.apache.hadoop.conf.CoreDefaultProperties.(CoreDefaultProperties.java:60) at java.lang.Class.forName0(Native Method) at java.lang.Class.forName(Class.java:274) at org.apache.hadoop.conf.Configuration.getClassByNameOrNull(Configuration.java:1847) at org.apache.hadoop.conf.Configuration.getProperties(Configuration.java:2062) at org.apache.hadoop.conf.Configuration.loadResource(Configuration.java:2272) at org.apache.hadoop.conf.Configuration.loadResources(Configuration.java:2224) at org.apache.hadoop.conf.Configuration.getProps(Configuration.java:2141) at org.apache.hadoop.conf.Configuration.set(Configuration.java:992) at org.apache.hadoop.conf.Configuration.set(Configuration.java:966) at org.apache.spark.deploy.SparkHadoopUtil.newConfiguration(SparkHadoopUtil.scala:98) at org.apache.spark.deploy.SparkHadoopUtil.(SparkHadoopUtil.scala:43) at org.apache.spark.deploy.SparkHadoopUtil$.(SparkHadoopUtil.scala:220) at org.apache.spark.deploy.SparkHadoopUtil$.(SparkHadoopUtil.scala) at org.apache.spark.util.Utils$.getSparkOrYarnConfig(Utils.scala:1959) at org.apache.spark.storage.BlockManager.(BlockManager.scala:104) at org.apache.spark.storage.BlockManager.(BlockManager.scala:179) at org.apache.spark.SparkEnv$.create(SparkEnv.scala:310) at org.apache.spark.SparkEnv$.createExecutorEnv(SparkEnv.scala:186) at org.apache.spark.executor.MesosExecutorBackend.registered(MesosExecutorBackend.scala:70)&lt;/p&gt;</comment>
                            <comment id="14589736" author="mandoskippy" created="Wed, 17 Jun 2015 12:58:05 +0000"  >&lt;p&gt;This is occurring still in 1.4.0&lt;/p&gt;

&lt;p&gt;I&apos;ve attempted to look through the code to determine what may have changed but the Class Loading code has shifted around quite a bit, and I could not pinpoint when the change, or which update changed the code to break it again.  If there is anything I can do to help troubleshoot, please advise. &lt;/p&gt;
</comment>
                            <comment id="14593725" author="yanakad" created="Fri, 19 Jun 2015 18:11:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pwendell&quot; class=&quot;user-hover&quot; rel=&quot;pwendell&quot;&gt;pwendell&lt;/a&gt; at your convenience can you please triage this bug. It was originally opened as a blocker. I reopened but am not sure if it&apos;s a release blocker. I set the target release to 1.5 just so it shows up in triage queries since it&apos;s a reopened bug...&lt;/p&gt;</comment>
                            <comment id="14625739" author="pwendell" created="Tue, 14 Jul 2015 02:59:49 +0000"  >&lt;p&gt;Hey All,&lt;/p&gt;

&lt;p&gt;This issue should remain fixed. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mandoskippy&quot; class=&quot;user-hover&quot; rel=&quot;mandoskippy&quot;&gt;mandoskippy&lt;/a&gt; I think you are just running into a different issue that is also in some way related to classloading.&lt;/p&gt;

&lt;p&gt;Can you open a new JIRA for your issue, paste in the stack trace and give as much information as possible about the environment? Thanks!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12708117">SPARK-1480</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>384675</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 19 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1u9qn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>384942</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>