<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:16:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-31663] Grouping sets with having clause returns the wrong result</title>
                <link>https://issues.apache.org/jira/browse/SPARK-31663</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Grouping sets with having clause returns the wrong result when the condition of having contained conflicting naming. See the below example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
select sum(a) as b FROM VALUES&#160;(1, 10), (2, 20) AS T(a, b) group by GROUPING SETS ((b), (a, b)) having b &amp;gt; 10&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The `b` in `having b &amp;gt; 10` should be resolved as `T.b` not `sum(a)`, so the right result should be&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+---+
|  b|
+---+
|  2|
|  2|
+---+&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;instead of an empty result.&lt;/p&gt;

&lt;p&gt;The root cause is similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-31519&quot; title=&quot;Cast in having aggregate expressions returns the wrong result&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-31519&quot;&gt;&lt;del&gt;SPARK-31519&lt;/del&gt;&lt;/a&gt;, it&apos;s caused by we parsed HAVING as Filter(..., Agg(...)) and resolved these two parts in different rules. The CUBE and ROLLUP have the same issue.&lt;/p&gt;

&lt;p&gt;Other systems worked as expected, I checked PostgreSQL 9.6 and MS SQL Server 2017.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;For Apache Spark 2.0.2 ~ 2.3.4, the following query is tested.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
spark-sql&amp;gt; select sum(a) as b from t group by b grouping sets(b) having b &amp;gt; 10;
Time taken: 0.194 seconds

hive&amp;gt; select sum(a) as b from t group by b grouping sets(b) having b &amp;gt; 10;
2
Time taken: 1.605 seconds, Fetched: 1 row(s) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13303684">SPARK-31663</key>
            <summary>Grouping sets with having clause returns the wrong result</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="XuanYuan">Yuanjian Li</assignee>
                                    <reporter username="XuanYuan">Yuanjian Li</reporter>
                        <labels>
                            <label>correctness</label>
                    </labels>
                <created>Fri, 8 May 2020 16:24:26 +0000</created>
                <updated>Mon, 1 Jun 2020 17:32:01 +0000</updated>
                            <resolved>Sat, 16 May 2020 05:36:41 +0000</resolved>
                                    <version>2.0.2</version>
                    <version>2.1.3</version>
                    <version>2.2.3</version>
                    <version>2.3.4</version>
                    <version>2.4.5</version>
                    <version>3.0.0</version>
                                    <fixVersion>2.4.6</fixVersion>
                    <fixVersion>3.0.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="17102825" author="dongjoon" created="Fri, 8 May 2020 18:37:44 +0000"  >&lt;p&gt;I confirmed that this is a correctness issue since 2.4.0.&lt;/p&gt;</comment>
                            <comment id="17102829" author="dongjoon" created="Fri, 8 May 2020 18:42:11 +0000"  >&lt;p&gt;The issue is that `b` is interpreted differently in `group by b` and `group by grouping sets(b)`.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
spark-sql&amp;gt; select sum(a) as b from t group by grouping sets(b) having b &amp;gt; 10;
Time taken: 0.231 seconds
spark-sql&amp;gt; select sum(a) as b from t group by b having b &amp;gt; 10;
2
Time taken: 0.174 seconds, Fetched 1 row(s) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17102841" author="dongjoon" created="Fri, 8 May 2020 18:51:14 +0000"  >&lt;p&gt;Also, with a changed syntax, this is reproduced in older versions like 2.3.x, too.&lt;/p&gt;</comment>
                            <comment id="17102844" author="dongjoon" created="Fri, 8 May 2020 18:56:00 +0000"  >&lt;p&gt;Apache Spark 2.3.4 follows Hive syntaxes, but the result is also wrong while Hive is correct.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
spark-sql&amp;gt; select sum(a) as b from t group by b grouping sets(b) having b &amp;gt; 10;
Time taken: 0.194 seconds

hive&amp;gt; select sum(a) as b from t group by b grouping sets(b) having b &amp;gt; 10;
2
Time taken: 1.605 seconds, Fetched: 1 row(s)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17102850" author="dongjoon" created="Fri, 8 May 2020 19:00:46 +0000"  >&lt;p&gt;All 2.x versions are added into the affected versions. (cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=holden&quot; class=&quot;user-hover&quot; rel=&quot;holden&quot;&gt;holden&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="17104528" author="apachespark" created="Mon, 11 May 2020 14:56:01 +0000"  >&lt;p&gt;User &apos;xuanyuanking&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/28501&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/28501&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 27 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0eivc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>