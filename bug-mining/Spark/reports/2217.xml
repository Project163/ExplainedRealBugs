<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:30:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-9196] DatetimeExpressionsSuite: function current_timestamp is flaky</title>
                <link>https://issues.apache.org/jira/browse/SPARK-9196</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;- function current_timestamp *** FAILED *** (77 milliseconds)
[info]   Results &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; not match &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; query:
[info]   == Parsed Logical Plan ==
[info]   &lt;span class=&quot;code-quote&quot;&gt;&apos;Project [unresolvedalias((&apos;&lt;/span&gt;CURRENT_TIMESTAMP() = &apos;CURRENT_TIMESTAMP()))]
[info]    OneRowRelation$
[info]   
[info]   == Analyzed Logical Plan ==
[info]   _c0: &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;
[info]   Project [(currenttimestamp() = currenttimestamp()) AS _c0#11436]
[info]    OneRowRelation$
[info]   
[info]   == Optimized Logical Plan ==
[info]   Project [&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; AS _c0#11436]
[info]    OneRowRelation$
[info]   
[info]   == Physical Plan ==
[info]   Project [&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; AS _c0#11436]
[info]    PhysicalRDD ParallelCollectionRDD[650] at apply at Transformer.scala:22
[info]   
[info]   Code Generation: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
[info]   == RDD ==
[info]   == Results ==
[info]   !== Correct Answer - 1 ==   == Spark Answer - 1 ==
[info]   ![&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;]                     [&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;] (QueryTest.scala:61)
[info]   org.scalatest.exceptions.TestFailedException:
[info]   at org.scalatest.Assertions$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;newAssertionFailedException(Assertions.scala:495)
[info]   at org.scalatest.FunSuite.newAssertionFailedException(FunSuite.scala:1555)
[info]   at org.scalatest.Assertions$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;fail(Assertions.scala:1328)
[info]   at org.scalatest.FunSuite.fail(FunSuite.scala:1555)
[info]   at org.apache.spark.sql.QueryTest.checkAnswer(QueryTest.scala:61)
[info]   at org.apache.spark.sql.QueryTest.checkAnswer(QueryTest.scala:67)
[info]   at org.apache.spark.sql.DatetimeExpressionsSuite$$anonfun$2.apply$mcV$sp(DatetimeExpressionsSuite.scala:42)
[info]   at org.apache.spark.sql.DatetimeExpressionsSuite$$anonfun$2.apply(DatetimeExpressionsSuite.scala:39)
[info]   at org.apache.spark.sql.DatetimeExpressionsSuite$$anonfun$2.apply(DatetimeExpressionsSuite.scala:39)
[info]   at org.scalatest.Transformer$$anonfun$apply$1.apply$mcV$sp(Transformer.scala:22)
[info]   at org.scalatest.OutcomeOf$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;outcomeOf(OutcomeOf.scala:85)
[info]   at org.scalatest.OutcomeOf$.outcomeOf(OutcomeOf.scala:104)
[info]   at org.scalatest.Transformer.apply(Transformer.scala:22)
[info]   at org.scalatest.Transformer.apply(Transformer.scala:20)
[info]   at org.scalatest.FunSuiteLike$$anon$1.apply(FunSuiteLike.scala:166)
[info]   at org.apache.spark.SparkFunSuite.withFixture(SparkFunSuite.scala:42)
[info]   at org.scalatest.FunSuiteLike$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;invokeWithFixture$1(FunSuiteLike.scala:163)
[info]   at org.scalatest.FunSuiteLike$$anonfun$runTest$1.apply(FunSuiteLike.scala:175)
[info]   at org.scalatest.FunSuiteLike$$anonfun$runTest$1.apply(FunSuiteLike.scala:175)
[info]   at org.scalatest.SuperEngine.runTestImpl(Engine.scala:306)
[info]   at org.scalatest.FunSuiteLike$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;runTest(FunSuiteLike.scala:175)
[info]   at org.scalatest.FunSuite.runTest(FunSuite.scala:1555)
[info]   at org.scalatest.FunSuiteLike$$anonfun$runTests$1.apply(FunSuiteLike.scala:208)
[info]   at org.scalatest.FunSuiteLike$$anonfun$runTests$1.apply(FunSuiteLike.scala:208)
[info]   at org.scalatest.SuperEngine$$anonfun$traverseSubNodes$1$1.apply(Engine.scala:413)
[info]   at org.scalatest.SuperEngine$$anonfun$traverseSubNodes$1$1.apply(Engine.scala:401)
[info]   at scala.collection.immutable.List.foreach(List.scala:318)
[info]   at org.scalatest.SuperEngine.traverseSubNodes$1(Engine.scala:401)
[info]   at org.scalatest.SuperEngine.org$scalatest$SuperEngine$$runTestsInBranch(Engine.scala:396)
[info]   at org.scalatest.SuperEngine.runTestsImpl(Engine.scala:483)
[info]   at org.scalatest.FunSuiteLike$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;runTests(FunSuiteLike.scala:208)
[info]   at org.scalatest.FunSuite.runTests(FunSuite.scala:1555)
[info]   at org.scalatest.Suite$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;run(Suite.scala:1424)
[info]   at org.scalatest.FunSuite.org$scalatest$FunSuiteLike$$&lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;$run(FunSuite.scala:1555)
[info]   at org.scalatest.FunSuiteLike$$anonfun$run$1.apply(FunSuiteLike.scala:212)
[info]   at org.scalatest.FunSuiteLike$$anonfun$run$1.apply(FunSuiteLike.scala:212)
[info]   at org.scalatest.SuperEngine.runImpl(Engine.scala:545)
[info]   at org.scalatest.FunSuiteLike$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;run(FunSuiteLike.scala:212)
[info]   at org.scalatest.FunSuite.run(FunSuite.scala:1555)
[info]   at org.scalatest.tools.Framework.org$scalatest$tools$Framework$$runSuite(Framework.scala:462)
[info]   at org.scalatest.tools.Framework$ScalaTestTask.execute(Framework.scala:671)
[info]   at sbt.ForkMain$Run$2.call(ForkMain.java:294)
[info]   at sbt.ForkMain$Run$2.call(ForkMain.java:284)
[info]   at java.util.concurrent.FutureTask.run(FutureTask.java:262)
[info]   at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
[info]   at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
[info]   at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12846299">SPARK-9196</key>
            <summary>DatetimeExpressionsSuite: function current_timestamp is flaky</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rxin">Reynold Xin</assignee>
                                    <reporter username="davies">Davies Liu</reporter>
                        <labels>
                    </labels>
                <created>Mon, 20 Jul 2015 15:54:37 +0000</created>
                <updated>Tue, 17 Nov 2015 04:48:20 +0000</updated>
                            <resolved>Tue, 17 Nov 2015 04:48:20 +0000</resolved>
                                                    <fixVersion>1.6.0</fixVersion>
                                    <component>SQL</component>
                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14633733" author="adrian-wang" created="Mon, 20 Jul 2015 15:59:18 +0000"  >&lt;p&gt;Thanks, I&apos;ll fix it asap&lt;/p&gt;</comment>
                            <comment id="14633740" author="adrian-wang" created="Mon, 20 Jul 2015 16:00:58 +0000"  >&lt;p&gt;if this is very often, we can ignore this test for now, I&apos;ll fix it tomorrow.&lt;/p&gt;</comment>
                            <comment id="14634420" author="adrian-wang" created="Tue, 21 Jul 2015 02:21:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davies&quot; class=&quot;user-hover&quot; rel=&quot;davies&quot;&gt;davies&lt;/a&gt;&lt;br/&gt;
I got 2 solutions for this problem:&lt;br/&gt;
1. Let this function back by something like a lazy val, but we need to put a flag for each query indicating whether it has been evaluated.&lt;br/&gt;
2. Substitute this function with constants at analysis phrase. This would be a little different from hive, since hive get the current timestamp at the beginning of evaluation. We can also find a way to mark multiple appearance as a single object at analysis phrase.&lt;/p&gt;

&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marmbrus&quot; class=&quot;user-hover&quot; rel=&quot;marmbrus&quot;&gt;marmbrus&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14634425" author="marmbrus" created="Tue, 21 Jul 2015 02:24:53 +0000"  >&lt;p&gt;This just looks like a bad test to me.  Can we instead get the current time using another method and then make sure the result is within some reasonable bound (i.e. +/- 1 minute)?&lt;/p&gt;</comment>
                            <comment id="14634452" author="adrian-wang" created="Tue, 21 Jul 2015 02:56:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marmbrus&quot; class=&quot;user-hover&quot; rel=&quot;marmbrus&quot;&gt;marmbrus&lt;/a&gt;we have test for that case. The flaky test is to prove multi entries of the same function within one query would return the same value.&lt;br/&gt;
Actually, as this function is always foldable, at optimization phrase we will get all values, so the gap would not be too large.&lt;/p&gt;

&lt;p&gt;p.s: hive&apos;s definition for current_timestamp(): Returns the current timestamp at the start of query evaluation (as of Hive 1.2.0). All calls of current_timestamp within the same query return the same value.&lt;/p&gt;</comment>
                            <comment id="14634456" author="marmbrus" created="Tue, 21 Jul 2015 03:01:40 +0000"  >&lt;p&gt;If that&apos;s the semantic we want then I think this will have to be evaluated&lt;br/&gt;
as a new rule in the prepare for execution phase.&lt;/p&gt;
</comment>
                            <comment id="14644640" author="apachespark" created="Tue, 28 Jul 2015 16:58:04 +0000"  >&lt;p&gt;User &apos;yhuai&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/7727&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/7727&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14644663" author="yhuai" created="Tue, 28 Jul 2015 17:09:35 +0000"  >&lt;p&gt;I submitted a PR to ignore this test for now (&lt;a href=&quot;https://github.com/apache/spark/pull/7727/files&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/7727/files&lt;/a&gt;). BTW, this test has been moved to &lt;tt&gt;DateFunctionsSuite&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="14644999" author="rxin" created="Tue, 28 Jul 2015 20:32:15 +0000"  >&lt;p&gt;I talked with Michael more offline. Here&apos;s the resolution: Add a rule in analyzer to replace CurrentDate/CurrentTimestamp with a literal.&lt;/p&gt;

&lt;p&gt;The only problem I can think of with that is explain won&apos;t print as nicely (it prints a literal rather than a date).&lt;/p&gt;</comment>
                            <comment id="15007822" author="apachespark" created="Tue, 17 Nov 2015 02:00:06 +0000"  >&lt;p&gt;User &apos;rxin&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/9753&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/9753&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12849639">SPARK-9406</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 1 week ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2hgev:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>