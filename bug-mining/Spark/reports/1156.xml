<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:21:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-4694] Long-run user thread(such as HiveThriftServer2) causes the &apos;process leak&apos; in yarn-client mode</title>
                <link>https://issues.apache.org/jira/browse/SPARK-4694</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Recently when I use the Yarn HA mode to test the HiveThriftServer2 I found a problem that the driver can&apos;t exit by itself.&lt;br/&gt;
To reappear it, you can do as fellow:&lt;br/&gt;
1.use yarn HA mode and set am.maxAttemp = 1for convenience&lt;br/&gt;
2.kill the active resouce manager in cluster&lt;/p&gt;

&lt;p&gt;The expect result is just failed, because the maxAttemp was 1.&lt;/p&gt;

&lt;p&gt;But the actual result is that: all executor was ended but the driver was still there and never close.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12758884">SPARK-4694</key>
            <summary>Long-run user thread(such as HiveThriftServer2) causes the &apos;process leak&apos; in yarn-client mode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="carlmartin">Zhaowei Huang</reporter>
                        <labels>
                            <label>backport-needed</label>
                    </labels>
                <created>Tue, 2 Dec 2014 12:56:43 +0000</created>
                <updated>Mon, 29 Dec 2014 22:13:17 +0000</updated>
                            <resolved>Wed, 17 Dec 2014 20:24:23 +0000</resolved>
                                                    <fixVersion>1.3.0</fixVersion>
                                    <component>YARN</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14231440" author="carlmartin" created="Tue, 2 Dec 2014 13:07:54 +0000"  >&lt;p&gt;The reason was that Yarn had reported the status to the RM and the YarnClientSchedulerBackend would detect the status to stop sc in function &apos;asyncMonitorApplication&apos;.&lt;br/&gt;
But the HiveThriftServer2 is a long-run user thread. JVM will never exit until all the no-demo threads have ended or using System.exit().&lt;br/&gt;
It cause such problem.&lt;br/&gt;
The easiest way to reslove this problem is using System.exit(0) instead of sc.stop in funciton &apos;asyncMonitorApplication&apos; .&lt;br/&gt;
But system.exit is not recommended in &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-4584&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SPARK-4584&lt;/a&gt;&lt;br/&gt;
Do you have any ideas about this problem? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vanzin&quot; class=&quot;user-hover&quot; rel=&quot;vanzin&quot;&gt;vanzin&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14231864" author="vanzin" created="Tue, 2 Dec 2014 18:17:07 +0000"  >&lt;p&gt;I&apos;m not sure I understand the bug or the context, but there must be some code that manages both the SparkContext and the HiveThriftServer2 thread. That code is responsible for stopping the context and shutting down the HiveThriftServer2 thread; if it can&apos;t do it cleanly because of some deficiency of the API, it can use Thread.stop() or some other less kosher approach.&lt;/p&gt;

&lt;p&gt;Using &lt;tt&gt;System.exit()&lt;/tt&gt; is not recommended because there&apos;s no way for the backend to detect that without severe performance implications. Apps will always be reported as &quot;succeeded&quot; when using that approach.&lt;/p&gt;</comment>
                            <comment id="14232724" author="carlmartin" created="Wed, 3 Dec 2014 07:42:17 +0000"  >&lt;p&gt;Thanks for reply. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vanzin&quot; class=&quot;user-hover&quot; rel=&quot;vanzin&quot;&gt;vanzin&lt;/a&gt; the problem is very sure: the scheduler backend was aware of the AM had been exited so it call sc.stop to exit the driver process but there was a user thread which was still alive and cause this problem.&lt;br/&gt;
To fix this, just using System.exit(-1) instead of the sc.stop so that jvm will not wait all the user threads being down and exit clearly.&lt;br/&gt;
Can I use System.exit() in spark code?&lt;/p&gt;</comment>
                            <comment id="14232778" author="apachespark" created="Wed, 3 Dec 2014 08:40:09 +0000"  >&lt;p&gt;User &apos;SaintBacchus&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/3576&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/3576&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14233321" author="vanzin" created="Wed, 3 Dec 2014 18:45:45 +0000"  >&lt;p&gt;To answer your question, you can call System.exit() if you want. It&apos;s just recommended that it&apos;s done after you properly shutdown the SparkContext, otherwise Yarn won&apos;t report your app status correctly. But it seems your patch doesn&apos;t use System.exit(), so this is kinda moot.&lt;/p&gt;</comment>
                            <comment id="14250471" author="marmbrus" created="Wed, 17 Dec 2014 20:24:23 +0000"  >&lt;p&gt;Issue resolved by pull request 3576&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/3576&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/3576&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 48 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i22yof:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12329029">1.2.1</customfieldvalue>
    <customfieldvalue id="12327642">1.3.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>