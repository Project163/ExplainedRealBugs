<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:54:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-21271] UnsafeRow.hashCode assertion when sizeInBytes not multiple of 8</title>
                <link>https://issues.apache.org/jira/browse/SPARK-21271</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;The method is:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; hashCode() {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; Murmur3_x86_32.hashUnsafeWords(baseObject, baseOffset, sizeInBytes, 42);
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;but sizeInBytes is not always a multiple of 8 (in which case hashUnsafeWords throws assertion) - for example here: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;FixedLengthRowBasedKeyValueBatch.appendRow&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The fix could be to use hashUnsafeBytes or to use hashUnsafeWords but on a prefix that is multiple of 8.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13083887">SPARK-21271</key>
            <summary>UnsafeRow.hashCode assertion when sizeInBytes not multiple of 8</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kiszk">Kazuaki Ishizaki</assignee>
                                    <reporter username="bograd">Bogdan Raducanu</reporter>
                        <labels>
                    </labels>
                <created>Fri, 30 Jun 2017 18:35:01 +0000</created>
                <updated>Thu, 27 Jul 2017 07:28:28 +0000</updated>
                            <resolved>Thu, 27 Jul 2017 07:27:57 +0000</resolved>
                                    <version>2.2.0</version>
                                    <fixVersion>2.3.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16070933" author="kiszk" created="Sat, 1 Jul 2017 01:30:51 +0000"  >&lt;p&gt;In &lt;tt&gt;UnsafeRow&lt;/tt&gt;, the length of fixed part should be a multiple of 8. However, the length of variable part may not require this regulation.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cloud_fan&quot; class=&quot;user-hover&quot; rel=&quot;cloud_fan&quot;&gt;cloud_fan&lt;/a&gt; What do you think?&lt;/p&gt;</comment>
                            <comment id="16070944" author="cloud_fan" created="Sat, 1 Jul 2017 01:53:04 +0000"  >&lt;p&gt;We do have this regulation for var-length part in UnsafeRow, because var-length data is always word-aligned. This is also why we store the length information, otherwise we can just calculate the length by subtracting 2 adjacent offsets.&lt;/p&gt;</comment>
                            <comment id="16070961" author="kiszk" created="Sat, 1 Jul 2017 02:32:32 +0000"  >&lt;p&gt;I see. For var-length part, its regulation (or specification) is a multiple of 4. Should we use &lt;tt&gt;hashUnsafeBytes&lt;/tt&gt; instead of &lt;tt&gt;Murmur3_x86_32.hashUnsafeWords&lt;/tt&gt; for &lt;tt&gt;UnsafeRow.hashCode()&lt;/tt&gt;?&lt;/p&gt;</comment>
                            <comment id="16070963" author="cloud_fan" created="Sat, 1 Jul 2017 02:39:15 +0000"  >&lt;p&gt;For word-aligned I mean 8-bytes aligned, so the size of var-lengh data is always a multiple of 8.&lt;/p&gt;</comment>
                            <comment id="16070966" author="kiszk" created="Sat, 1 Jul 2017 02:56:14 +0000"  >&lt;p&gt;I see. This issue comes from the violation such as &lt;a href=&quot;https://github.com/apache/spark/blob/master/sql/catalyst/src/main/java/org/apache/spark/sql/catalyst/expressions/FixedLengthRowBasedKeyValueBatch.java#L65&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;a code&lt;/a&gt; (e.g. length + 4). Should we detect all of these code pieces by inserting an &lt;tt&gt;assert(length % 8 == 0)&lt;/tt&gt; at &lt;tt&gt;pointTo()&lt;/tt&gt;?&lt;/p&gt;</comment>
                            <comment id="16070969" author="cloud_fan" created="Sat, 1 Jul 2017 03:01:47 +0000"  >&lt;p&gt;yea we should. BTW the code seems wrong to be, the length of value row should be &lt;tt&gt;vlen&lt;/tt&gt; instead of &lt;tt&gt;vlen + 4&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="16070973" author="kiszk" created="Sat, 1 Jul 2017 03:17:21 +0000"  >&lt;p&gt;I see. I will work for this.&lt;br/&gt;
Thank you for letting us how to fix it. I has been thinking about &quot;+ 4&quot;. I also saw the similar code in &lt;a href=&quot;https://github.com/apache/spark/blob/master/sql/catalyst/src/main/java/org/apache/spark/sql/catalyst/expressions/VariableLengthRowBasedKeyValueBatch.java#L68&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16071551" author="apachespark" created="Sun, 2 Jul 2017 08:32:03 +0000"  >&lt;p&gt;User &apos;kiszk&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18503&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18503&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16102843" author="cloud_fan" created="Thu, 27 Jul 2017 07:27:57 +0000"  >&lt;p&gt;Issue resolved by pull request 18503&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18503&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18503&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 16 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3gyuv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>