<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:16:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-3036] Add MapType containing null value support to Parquet.</title>
                <link>https://issues.apache.org/jira/browse/SPARK-3036</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Current Parquet schema for &lt;tt&gt;MapType&lt;/tt&gt; is as follows regardless of &lt;tt&gt;valueContainsNull&lt;/tt&gt;:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;message root {
  optional group a (MAP) {
    repeated group map (MAP_KEY_VALUE) {
      required int32 key;
      required int32 value;
    }
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and if the map contains &lt;tt&gt;null&lt;/tt&gt; value, it throws runtime exception.&lt;/p&gt;

&lt;p&gt;To handle &lt;tt&gt;MapType&lt;/tt&gt; containing &lt;tt&gt;null&lt;/tt&gt; value, the schema should be as follows if &lt;tt&gt;valueContainsNull&lt;/tt&gt; is &lt;tt&gt;true&lt;/tt&gt;:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;message root {
  optional group a (MAP) {
    repeated group map (MAP_KEY_VALUE) {
      required int32 key;
      optional int32 value;
    }
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;FYI:&lt;br/&gt;
Hive&apos;s Parquet writer &lt;b&gt;always&lt;/b&gt; uses the latter schema, but reader can read from both schema.&lt;/p&gt;

&lt;p&gt;NOTICE:&lt;br/&gt;
This change will break backward compatibility when the schema is read from Parquet metadata (&lt;tt&gt;&quot;org.apache.spark.sql.parquet.row.metadata&quot;&lt;/tt&gt;).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12734020">SPARK-3036</key>
            <summary>Add MapType containing null value support to Parquet.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ueshin">Takuya Ueshin</assignee>
                                    <reporter username="ueshin">Takuya Ueshin</reporter>
                        <labels>
                    </labels>
                <created>Thu, 14 Aug 2014 10:17:40 +0000</created>
                <updated>Wed, 27 Aug 2014 01:30:22 +0000</updated>
                            <resolved>Wed, 27 Aug 2014 01:30:22 +0000</resolved>
                                                    <fixVersion>1.1.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14102033" author="apachespark" created="Tue, 19 Aug 2014 08:51:59 +0000"  >&lt;p&gt;User &apos;ueshin&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/2032&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/2032&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14104556" author="marmbrus" created="Wed, 20 Aug 2014 20:53:16 +0000"  >&lt;p&gt;Can you explain more about what you mean when you say we are breaking backwards compatibility?  It seems like newer version of Spark SQL should always be able to read data written by older version as long as we support both versions.  Choosing between them when writing based on valueContainsNull seems like the best solution.&lt;/p&gt;

&lt;p&gt;I think it is okay (though undesirable) for older versions of Spark SQL to be unable to read from data written by newer versions, as this is unavoidable as we add features.&lt;/p&gt;</comment>
                            <comment id="14105012" author="ueshin" created="Thu, 21 Aug 2014 04:10:18 +0000"  >&lt;p&gt;Ah, that&apos;s right. It was my mistake.&lt;br/&gt;
Newer version will be able to read data written by older version.&lt;/p&gt;

&lt;p&gt;We are referencing to DataType tree to build converter tree and the converter tree needs to be the same as the Parquet schema, so I thought the difference between them like older version&apos;s Parquet schema and DatType from metadata causes the incompatible, but the converter tree is the same regardless of &quot;require&quot; or &quot;optional&quot; of map value, i.e. valueContainsNull.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12730358">SPARK-2721</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>412048</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 13 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1yvwv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>412037</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12326686">1.1.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>