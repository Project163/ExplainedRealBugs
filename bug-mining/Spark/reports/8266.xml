<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:28:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-36861] Partition columns are overly eagerly parsed as dates</title>
                <link>https://issues.apache.org/jira/browse/SPARK-36861</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;I have an input directory with subdirs:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hour=2021-01-01T00&lt;/li&gt;
	&lt;li&gt;hour=2021-01-01T01&lt;/li&gt;
	&lt;li&gt;hour=2021-01-01T02&lt;/li&gt;
	&lt;li&gt;...&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;in spark 3.1 the &apos;hour&apos; column is parsed as a string type, but in 3.2 RC it is parsed as date type and the hour part is lost.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13403442">SPARK-36861</key>
            <summary>Partition columns are overly eagerly parsed as dates</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="maxgekk">Max Gekk</assignee>
                                    <reporter username="tanelk">Tanel Kiis</reporter>
                        <labels>
                    </labels>
                <created>Mon, 27 Sep 2021 07:42:54 +0000</created>
                <updated>Thu, 25 Nov 2021 07:56:15 +0000</updated>
                            <resolved>Thu, 25 Nov 2021 07:55:24 +0000</resolved>
                                    <version>3.3.0</version>
                                    <fixVersion>3.3.0</fixVersion>
                                    <component>SQL</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="17420532" author="tanelk" created="Mon, 27 Sep 2021 07:44:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Gengliang.Wang&quot; class=&quot;user-hover&quot; rel=&quot;Gengliang.Wang&quot;&gt;Gengliang.Wang&lt;/a&gt; I think, that this should be considered as a blocker for the 3.2 release&lt;/p&gt;
</comment>
                            <comment id="17420533" author="tanelk" created="Mon, 27 Sep 2021 07:47:10 +0000"  >&lt;p&gt;If this is expected behaviour, then I would expect there to be a simple way to turn this off. Currently only one I can think of is manually specifing the schema.&lt;/p&gt;</comment>
                            <comment id="17420538" author="gengliang.wang" created="Mon, 27 Sep 2021 07:54:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tanelk&quot; class=&quot;user-hover&quot; rel=&quot;tanelk&quot;&gt;tanelk&lt;/a&gt; This is a new behavior introduced from &lt;a href=&quot;https://github.com/apache/spark/pull/33709&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/33709&lt;/a&gt;&lt;br/&gt;
However, turning into date and losing the hour part seems wrong. cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maxgekk&quot; class=&quot;user-hover&quot; rel=&quot;maxgekk&quot;&gt;maxgekk&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cloud_fan&quot; class=&quot;user-hover&quot; rel=&quot;cloud_fan&quot;&gt;cloud_fan&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17420549" author="gengliang.wang" created="Mon, 27 Sep 2021 08:03:27 +0000"  >&lt;p&gt;Hmm, the PR &lt;a href=&quot;https://github.com/apache/spark/pull/33709&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/33709&lt;/a&gt; is only on master. I can&apos;t reproduce your case on 3.2.0 RC4 with:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-scala&quot;&gt;
&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; df = Seq((&lt;span class=&quot;code-quote&quot;&gt;&quot;2021-01-01T00&quot;&lt;/span&gt;, 0), (&lt;span class=&quot;code-quote&quot;&gt;&quot;2021-01-01T01&quot;&lt;/span&gt;, 1), (&lt;span class=&quot;code-quote&quot;&gt;&quot;2021-01-01T02&quot;&lt;/span&gt;, 2)).toDF(&lt;span class=&quot;code-quote&quot;&gt;&quot;hour&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;i&quot;&lt;/span&gt;)
&amp;gt; df.write.partitionBy(&lt;span class=&quot;code-quote&quot;&gt;&quot;hour&quot;&lt;/span&gt;).parquet(&lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/t1&quot;&lt;/span&gt;)
&amp;gt; spark.read.parquet(&lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/t1&quot;&lt;/span&gt;).schema
res2: org.apache.spark.sql.types.StructType = StructType(StructField(i,IntegerType,&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;), StructField(hour,StringType,&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The issue can be reproduced on Spark master though.&lt;/p&gt;</comment>
                            <comment id="17420553" author="tanelk" created="Mon, 27 Sep 2021 08:07:39 +0000"  >&lt;p&gt;Sorry, indeed I ran the test on master. Nevermind it then, does not impact the 3.2 release.&lt;/p&gt;</comment>
                            <comment id="17421328" author="senthh" created="Tue, 28 Sep 2021 11:19:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tanelk&quot; class=&quot;user-hover&quot; rel=&quot;tanelk&quot;&gt;tanelk&lt;/a&gt; This is issue not reproducable even in 3.1.2&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;root&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;#8211; i: integer (nullable = true)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;#8211; hour: string (nullable = true)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="17421334" author="tanelk" created="Tue, 28 Sep 2021 11:34:29 +0000"  >&lt;p&gt;Yes, in 3.1 it is parsed as string. In 3.3 (master) it is parsed as date.&lt;/p&gt;</comment>
                            <comment id="17422557" author="sarutak" created="Thu, 30 Sep 2021 07:03:50 +0000"  >&lt;p&gt;Hmm, if a &quot;T&quot; follows the date part but it&apos;s not a valid ISO 8601 format, casting a string to date should fail ?&lt;br/&gt;
In PostgreSQL, parsing will fail in such case.&lt;/p&gt;</comment>
                            <comment id="17423402" author="senthh" created="Fri, 1 Oct 2021 19:24:16 +0000"  >&lt;p&gt;Yes in Spark 3.3, hour column is created as &quot;DateType&quot; but I could see hour part in subdirs created&lt;/p&gt;

&lt;p&gt;===============&lt;/p&gt;

&lt;p&gt;Spark session available as &apos;spark&apos;.&lt;br/&gt;
 Welcome to&lt;br/&gt;
 ____ __&lt;br/&gt;
 / _&lt;em&gt;/&lt;/em&gt;_ ___ ____&lt;em&gt;/ /&lt;/em&gt;_&lt;br/&gt;
 &lt;em&gt;\ \/ _ \/ _ `/ __/ &apos;&lt;/em&gt;/&lt;br/&gt;
 /__&lt;em&gt;/ .&lt;/em&gt;&lt;em&gt;/&lt;/em&gt;,&lt;em&gt;/&lt;/em&gt;/ /&lt;em&gt;/&lt;/em&gt;\ version 3.3.0-SNAPSHOT&lt;br/&gt;
 /_/&lt;/p&gt;

&lt;p&gt;Using Scala version 2.12.15 (OpenJDK 64-Bit Server VM, Java 1.8.0_292)&lt;br/&gt;
 Type in expressions to have them evaluated.&lt;br/&gt;
 Type :help for more information.&lt;/p&gt;

&lt;p&gt;scala&amp;gt; val df = Seq((&quot;2021-01-01T00&quot;, 0), (&quot;2021-01-01T01&quot;, 1), (&quot;2021-01-01T02&quot;, 2)).toDF(&quot;hour&quot;, &quot;i&quot;)&lt;br/&gt;
 df: org.apache.spark.sql.DataFrame = &lt;span class=&quot;error&quot;&gt;&amp;#91;hour: string, i: int&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;scala&amp;gt; df.write.partitionBy(&quot;hour&quot;).parquet(&quot;/tmp/t1&quot;)&lt;/p&gt;

&lt;p&gt;scala&amp;gt; spark.read.parquet(&quot;/tmp/t1&quot;).schema&lt;br/&gt;
 res1: org.apache.spark.sql.types.StructType = StructType(StructField(i,IntegerType,true), StructField(hour,DateType,true))&lt;/p&gt;

&lt;p&gt;scala&amp;gt;&lt;/p&gt;

&lt;p&gt;===============&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;and subdirs created are&lt;/p&gt;

&lt;p&gt;===============&lt;/p&gt;

&lt;p&gt;ls -l&lt;br/&gt;
 total 0&lt;br/&gt;
 &lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;- 1 senthilkumar wheel 0 Oct 2 00:44 _SUCCESS&lt;br/&gt;
 drwxr-xr-x 4 senthilkumar wheel 128 Oct 2 00:44 hour=2021-01-01T00&lt;br/&gt;
 drwxr-xr-x 4 senthilkumar wheel 128 Oct 2 00:44 hour=2021-01-01T01&lt;br/&gt;
 drwxr-xr-x 4 senthilkumar wheel 128 Oct 2 00:44 hour=2021-01-01T02&lt;/p&gt;

&lt;p&gt;===============&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;It will be helpful if you share the list of sub-dirs created in your case.&lt;/p&gt;</comment>
                            <comment id="17427085" author="cloud_fan" created="Mon, 11 Oct 2021 11:55:49 +0000"  >&lt;p&gt;I think partition value parsing needs to be stricter. cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maxgekk&quot; class=&quot;user-hover&quot; rel=&quot;maxgekk&quot;&gt;maxgekk&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17448807" author="apachespark" created="Wed, 24 Nov 2021 20:45:21 +0000"  >&lt;p&gt;User &apos;MaxGekk&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/34700&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/34700&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17448808" author="apachespark" created="Wed, 24 Nov 2021 20:46:22 +0000"  >&lt;p&gt;User &apos;MaxGekk&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/34700&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/34700&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17448995" author="cloud_fan" created="Thu, 25 Nov 2021 07:55:24 +0000"  >&lt;p&gt;Issue resolved by pull request 34700&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/34700&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/34700&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 50 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0vb80:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12350369">3.3.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>