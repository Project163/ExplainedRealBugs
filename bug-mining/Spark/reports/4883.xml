<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:53:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-20843] Cannot gracefully kill drivers which take longer than 10 seconds to die</title>
                <link>https://issues.apache.org/jira/browse/SPARK-20843</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Commit &lt;a href=&quot;https://github.com/apache/spark/commit/1c9a386c6b6812a3931f3fb0004249894a01f657&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/commit/1c9a386c6b6812a3931f3fb0004249894a01f657&lt;/a&gt; changed the behavior of driver process termination. Whereas before `Process.destroyForcibly` was never called, now it is called (on Java VM&apos;s supporting that API) if the driver process does not die within 10 seconds.&lt;/p&gt;

&lt;p&gt;This prevents apps which take longer than 10 seconds to shutdown gracefully from shutting down gracefully. For example, streaming apps with a large batch duration (say, 30 seconds+) can take minutes to shutdown.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13073936">SPARK-20843</key>
            <summary>Cannot gracefully kill drivers which take longer than 10 seconds to die</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zsxwing">Shixiong Zhu</assignee>
                                    <reporter username="michael">Michael MacFadden</reporter>
                        <labels>
                            <label>regression</label>
                    </labels>
                <created>Mon, 22 May 2017 17:14:14 +0000</created>
                <updated>Sat, 27 May 2017 05:26:44 +0000</updated>
                            <resolved>Sat, 27 May 2017 05:26:44 +0000</resolved>
                                    <version>2.1.1</version>
                                    <fixVersion>2.1.2</fixVersion>
                    <fixVersion>2.2.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="16025036" author="michael" created="Thu, 25 May 2017 17:09:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rxin&quot; class=&quot;user-hover&quot; rel=&quot;rxin&quot;&gt;rxin&lt;/a&gt; I&apos;d like to bump this to &quot;Critical&quot;. This is really a disruptive, potentially dangerous change for spark streaming apps (among others). We could not tolerate this behavior in our production environment, and it caught us off guard in our prod migration to Spark 2.1.&lt;/p&gt;

&lt;p&gt;I think this timeout should be configurable per-app (as a driver config param), but I couldn&apos;t find a way to do that. In our case, we modified our source build to set the timeout to `Int.MaxValue`, effectively reverting this change. Therefore, the best PR I could offer at this point is to effectively revert this change.&lt;/p&gt;

&lt;p&gt;I have another concern that this behavior varies depending on the version of the underlying JDK. Specifically, this behavior will not manifest on Java 7 but will do so on Java 8+. IMO, users who upgrade their Java runtimes should not expect this kind of change in their Spark apps&apos; behavior.&lt;/p&gt;

&lt;p&gt;Thank you.&lt;/p&gt;</comment>
                            <comment id="16025042" author="rxin" created="Thu, 25 May 2017 17:12:34 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joshrosen&quot; class=&quot;user-hover&quot; rel=&quot;joshrosen&quot;&gt;joshrosen&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marmbrus&quot; class=&quot;user-hover&quot; rel=&quot;marmbrus&quot;&gt;marmbrus&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16026634" author="marmbrus" created="Fri, 26 May 2017 18:25:07 +0000"  >&lt;p&gt;I don&apos;t have much context here /cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zsxwing&quot; class=&quot;user-hover&quot; rel=&quot;zsxwing&quot;&gt;zsxwing&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vanzin&quot; class=&quot;user-hover&quot; rel=&quot;vanzin&quot;&gt;vanzin&lt;/a&gt;.  I does seem like this could at least be configurable.&lt;/p&gt;

&lt;p&gt;I will say that I don&apos;t think its really safe to rely on clean shutdowns for correctness and I don&apos;t think this change affects structured streaming.&lt;/p&gt;
</comment>
                            <comment id="16026643" author="vanzin" created="Fri, 26 May 2017 18:32:25 +0000"  >&lt;p&gt;I mostly followed &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zsxwing&quot; class=&quot;user-hover&quot; rel=&quot;zsxwing&quot;&gt;zsxwing&lt;/a&gt;&apos;s review since he didn&apos;t seem to have issues with it (and he filed the original bug, &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-13602&quot; title=&quot;o.a.s.deploy.worker.DriverRunner may leak the driver processes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-13602&quot;&gt;&lt;del&gt;SPARK-13602&lt;/del&gt;&lt;/a&gt;). My comments were mostly stylistic.&lt;/p&gt;

&lt;p&gt;Given that it may cause problems it might be safer to revert this in 2.2 and fix it in master. Maybe &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bryanc&quot; class=&quot;user-hover&quot; rel=&quot;bryanc&quot;&gt;bryanc&lt;/a&gt; can chime in too since he worked on the change itself.&lt;/p&gt;</comment>
                            <comment id="16026663" author="michael" created="Fri, 26 May 2017 18:47:13 +0000"  >&lt;blockquote&gt;&lt;p&gt;I will say that I don&apos;t think its really safe to rely on clean shutdowns for correctness...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I agree, but we don&apos;t want a &quot;force kill&quot; to become the norm for an app shutdown. An unclean shutdown should be an exceptional situation that will be cause for an ops alert, an investigation and a validation that no data loss or corruption occurred (i.e. our failure mechanisms held).&lt;/p&gt;

&lt;p&gt;Also, I would say that in some cases where an app integrates with other systems and cannot guarantee transactional or idempotent semantics in the event of a failure, an unclean shutdown &lt;b&gt;will&lt;/b&gt; require cross-system validation and any necessary data synchronization or recovery.&lt;/p&gt;

&lt;p&gt;Cheers.&lt;/p&gt;</comment>
                            <comment id="16026809" author="zsxwing" created="Fri, 26 May 2017 20:45:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=michael&quot; class=&quot;user-hover&quot; rel=&quot;michael&quot;&gt;michael&lt;/a&gt; Will a per-cluster config be enough for your usage? A per-app config requires more changes and it&apos;s too risky for 2.2 now.&lt;/p&gt;</comment>
                            <comment id="16026841" author="michael" created="Fri, 26 May 2017 21:05:48 +0000"  >&lt;blockquote&gt;&lt;p&gt;Will a per-cluster config be enough for your usage?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes.&lt;/p&gt;</comment>
                            <comment id="16026870" author="apachespark" created="Fri, 26 May 2017 21:23:03 +0000"  >&lt;p&gt;User &apos;zsxwing&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/18126&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/18126&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12945982">SPARK-13602</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 25 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3fb53:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>