<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:30:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-9497] Flaky test: DistributedSuite failed after the test of &quot;repeatedly failing task that crashes JVM&quot;</title>
                <link>https://issues.apache.org/jira/browse/SPARK-9497</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Seems it is pretty often to see DistributedSuite failed right after &quot;repeatedly failing task that crashes JVM&quot;.&lt;/p&gt;

&lt;p&gt;One example jenkins can be found at &lt;br/&gt;
&lt;a href=&quot;https://amplab.cs.berkeley.edu/jenkins/job/Spark-Master-SBT/3117/AMPLAB_JENKINS_BUILD_PROFILE=hadoop1.0,label=centos/testReport/junit/org.apache.spark/DistributedSuite/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://amplab.cs.berkeley.edu/jenkins/job/Spark-Master-SBT/3117/AMPLAB_JENKINS_BUILD_PROFILE=hadoop1.0,label=centos/testReport/junit/org.apache.spark/DistributedSuite/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The log of it can be found at &lt;a href=&quot;https://amplab.cs.berkeley.edu/jenkins/job/Spark-Master-SBT/3117/AMPLAB_JENKINS_BUILD_PROFILE=hadoop1.0,label=centos/artifact/core/target/unit-tests.log&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://amplab.cs.berkeley.edu/jenkins/job/Spark-Master-SBT/3117/AMPLAB_JENKINS_BUILD_PROFILE=hadoop1.0,label=centos/artifact/core/target/unit-tests.log&lt;/a&gt; (search StopAppClient).&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12850499">SPARK-9497</key>
            <summary>Flaky test: DistributedSuite failed after the test of &quot;repeatedly failing task that crashes JVM&quot;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zsxwing">Shixiong Zhu</assignee>
                                    <reporter username="yhuai">Yin Huai</reporter>
                        <labels>
                            <label>flaky-test</label>
                    </labels>
                <created>Fri, 31 Jul 2015 03:45:08 +0000</created>
                <updated>Fri, 31 Jul 2015 16:36:12 +0000</updated>
                            <resolved>Fri, 31 Jul 2015 16:36:12 +0000</resolved>
                                                    <fixVersion>1.5.0</fixVersion>
                                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14648710" author="yhuai" created="Fri, 31 Jul 2015 03:45:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kayousterhout&quot; class=&quot;user-hover&quot; rel=&quot;kayousterhout&quot;&gt;kayousterhout&lt;/a&gt; Seems you added &quot;repeatedly failing task that crashes JVM&quot;. Will you have time to take a look at this test?&lt;/p&gt;</comment>
                            <comment id="14648721" author="kayousterhout" created="Fri, 31 Jul 2015 04:11:53 +0000"  >&lt;p&gt;When did you start seeing these failures?  I added the test 1.5 years ago, so it seems likely to be related to a recent change in the code.&lt;/p&gt;

&lt;p&gt;It looks like this error is happening when we try to stop the AppClient from SparkDeploySchedulerBackend: &lt;a href=&quot;https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/scheduler/cluster/SparkDeploySchedulerBackend.scala#L96&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/scheduler/cluster/SparkDeploySchedulerBackend.scala#L96&lt;/a&gt;; is it possible this started happening after &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zsxwing&quot; class=&quot;user-hover&quot; rel=&quot;zsxwing&quot;&gt;zsxwing&lt;/a&gt;&apos;s recent change? &lt;a href=&quot;https://github.com/apache/spark/commit/3bee0f1466ddd69f26e95297b5e0d2398b6c6268&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/commit/3bee0f1466ddd69f26e95297b5e0d2398b6c6268&lt;/a&gt; (that changed the line of code in AppClient.scala that is failing: &lt;a href=&quot;https://github.com/apache/spark/blame/master/core/src/main/scala/org/apache/spark/deploy/client/AppClient.scala#L251&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blame/master/core/src/main/scala/org/apache/spark/deploy/client/AppClient.scala#L251&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="14648725" author="yhuai" created="Fri, 31 Jul 2015 04:17:57 +0000"  >&lt;p&gt;It started to fail about 2 to 3 days ago. Its history on hadoop 1.0 test can be found at &lt;a href=&quot;https://amplab.cs.berkeley.edu/jenkins/job/Spark-Master-SBT/3117/AMPLAB_JENKINS_BUILD_PROFILE=hadoop1.0,label=centos/testReport/junit/org.apache.spark/DistributedSuite/history/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://amplab.cs.berkeley.edu/jenkins/job/Spark-Master-SBT/3117/AMPLAB_JENKINS_BUILD_PROFILE=hadoop1.0,label=centos/testReport/junit/org.apache.spark/DistributedSuite/history/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I also see &lt;a href=&quot;https://amplab.cs.berkeley.edu/jenkins/job/Spark-Master-SBT/3119/AMPLAB_JENKINS_BUILD_PROFILE=hadoop2.2,label=centos/testReport/junit/org.apache.spark.scheduler/ReplayListenerSuite/End_to_end_replay_with_compression/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://amplab.cs.berkeley.edu/jenkins/job/Spark-Master-SBT/3119/AMPLAB_JENKINS_BUILD_PROFILE=hadoop2.2,label=centos/testReport/junit/org.apache.spark.scheduler/ReplayListenerSuite/End_to_end_replay_with_compression/&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zsxwing&quot; class=&quot;user-hover&quot; rel=&quot;zsxwing&quot;&gt;zsxwing&lt;/a&gt; maybe it is also related.&lt;/p&gt;</comment>
                            <comment id="14648727" author="kayousterhout" created="Fri, 31 Jul 2015 04:19:25 +0000"  >&lt;p&gt;It looks like this has failed much longer ago than that; here&apos;s one from July 4th, for example: &lt;a href=&quot;https://amplab.cs.berkeley.edu/jenkins/job/Spark-Master-SBT/AMPLAB_JENKINS_BUILD_PROFILE=hadoop1.0,label=centos/2846/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://amplab.cs.berkeley.edu/jenkins/job/Spark-Master-SBT/AMPLAB_JENKINS_BUILD_PROFILE=hadoop1.0,label=centos/2846/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;m trying to figure out when this started but the history for the builds is super slow to load...will send another update shortly&lt;/p&gt;</comment>
                            <comment id="14648737" author="kayousterhout" created="Fri, 31 Jul 2015 04:39:59 +0000"  >&lt;p&gt;A bunch of thoughts here:&lt;/p&gt;

&lt;p&gt;The oldest failure I could find was July 2nd, and it seems to have been flakey since then.  The test seems to have been getting worse recently, which I&apos;d guess is just because Jenkins is more heavily loaded right now. Maybe you already noticed this, but it looks like everything, DistributedSuite fails, and then all of the ShuffleNetty tests fail afterwards with &quot;Only one SparkContext may be running in this JVM&quot;, which probably is because the DistributedSuite failure is during stop(), so presumably the SparkContext doesn&apos;t get shut down right, and then all of the later tests end up failing.&lt;/p&gt;

&lt;p&gt;I also realized that the RpcTimeoutException isn&apos;t what causes things to fail, and the exception is caught in AppClient: &lt;a href=&quot;https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/deploy/client/AppClient.scala#L253&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/deploy/client/AppClient.scala#L253&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;So it seems like the SparkContext is somehow getting into a bad state where it can&apos;t be shutdown.&lt;/p&gt;

&lt;p&gt;One other thought is that what&apos;s different about this test (compared to the other tests in DistributedSuite) is that it causes the executor to fail.  Given that, this line in the recent change is a little suspicious: &lt;a href=&quot;https://github.com/apache/spark/commit/3bee0f1466ddd69f26e95297b5e0d2398b6c6268#diff-a240aa7b4630dc389590147f96cf3431R174&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/commit/3bee0f1466ddd69f26e95297b5e0d2398b6c6268#diff-a240aa7b4630dc389590147f96cf3431R174&lt;/a&gt; and I wonder if it could be related.&lt;/p&gt;</comment>
                            <comment id="14648970" author="zsxwing" created="Fri, 31 Jul 2015 09:24:14 +0000"  >&lt;p&gt;I found the issue. The exception type of `RpcEndpoint.askWithRetry` is not `TimeoutException`. So now it won&apos;t be caught. I will fix it.&lt;/p&gt;</comment>
                            <comment id="14648978" author="apachespark" created="Fri, 31 Jul 2015 09:36:02 +0000"  >&lt;p&gt;User &apos;zsxwing&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/7824&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/7824&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14649008" author="zsxwing" created="Fri, 31 Jul 2015 10:08:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yhuai&quot; class=&quot;user-hover&quot; rel=&quot;yhuai&quot;&gt;yhuai&lt;/a&gt; Is the second link related? The failure test is &quot;org.apache.spark.scheduler.ReplayListenerSuite.End-to-end replay with compression&quot; and I cannot find &quot;StopAppClient&quot; in unit-tests.log.&lt;/p&gt;</comment>
                            <comment id="14649371" author="yhuai" created="Fri, 31 Jul 2015 15:42:02 +0000"  >&lt;p&gt;I am not sure if it is related. Maybe now. I will keep an eye on ReplayListenerSuite and try to get more information about it.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 16 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2i5xz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>