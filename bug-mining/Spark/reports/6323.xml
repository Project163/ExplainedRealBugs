<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:04:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-24736] --py-files not functional for non local URLs. It appears to pass non-local URL&apos;s into PYTHONPATH directly.</title>
                <link>https://issues.apache.org/jira/browse/SPARK-24736</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;My spark-submit&lt;br/&gt;
bin/spark-submit \&lt;br/&gt;
&#160; &#160; &#160; &#160; --master k8s://&lt;a href=&quot;https://internal-api-test-k8s-local-7afed8-796273878.us-east-1.elb.amazonaws.com/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://internal-api-test-k8s-local-7afed8-796273878.us-east-1.elb.amazonaws.com&lt;/a&gt;&#160;\&lt;br/&gt;
&#160; &#160; &#160; &#160; --deploy-mode cluster \&lt;br/&gt;
&#160; &#160; &#160; &#160; --name pytest \&lt;br/&gt;
&#160; &#160; &#160; &#160; --conf spark.kubernetes.container.image=&lt;a href=&quot;http://412834075398.dkr.ecr.us-east-1.amazonaws.com/fids/pyspark-k8s:latest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;412834075398.dkr.ecr.us-east-1.amazonaws.com/fids/pyspark-k8s:latest&lt;/a&gt;&#160;\&lt;br/&gt;
&#160; &#160; &#160; &#160; --conf&#160;&lt;a href=&quot;http://spark.kubernetes.driver.pod.name/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;spark.kubernetes.driver.pod.name&lt;/a&gt;=spark-pi-driver \&lt;br/&gt;
&#160; &#160; &#160; &#160; --conf spark.kubernetes.authenticate.submission.caCertFile=&lt;a href=&quot;http://cluster.ca/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cluster.ca&lt;/a&gt;&#160;\&lt;br/&gt;
&#160; &#160; &#160; &#160; --conf spark.kubernetes.authenticate.submission.oauthToken=$TOK \&lt;br/&gt;
&#160; &#160; &#160; &#160; --conf spark.kubernetes.authenticate.driver.oauthToken=$TOK \&lt;br/&gt;
--py-files &quot;&lt;a href=&quot;https://s3.amazonaws.com/maxar-ids-fids/screw.zip&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://s3.amazonaws.com/maxar-ids-fids/screw.zip&lt;/a&gt;&quot; \&lt;br/&gt;
&lt;a href=&quot;https://s3.amazonaws.com/maxar-ids-fids/it.py&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://s3.amazonaws.com/maxar-ids-fids/it.py&lt;/a&gt;&lt;br/&gt;
&#160;&lt;br/&gt;
&lt;b&gt;screw.zip is successfully downloaded&#160;and placed in SparkFIles.getRootPath()&lt;/b&gt;&lt;br/&gt;
2018-07-01 07:33:43 INFO&#160; SparkContext:54 - Added file&#160;&lt;a href=&quot;https://s3.amazonaws.com/maxar-ids-fids/screw.zip&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://s3.amazonaws.com/maxar-ids-fids/screw.zip&lt;/a&gt;&#160;at&#160;&lt;a href=&quot;https://s3.amazonaws.com/maxar-ids-fids/screw.zip&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://s3.amazonaws.com/maxar-ids-fids/screw.zip&lt;/a&gt;&#160;with timestamp 1530430423297&lt;br/&gt;
2018-07-01 07:33:43 INFO&#160; Utils:54 - Fetching&#160;&lt;a href=&quot;https://s3.amazonaws.com/maxar-ids-fids/screw.zip&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://s3.amazonaws.com/maxar-ids-fids/screw.zip&lt;/a&gt;&#160;to /var/data/spark-7aba748d-2bba-4015-b388-c2ba9adba81e/spark-0ed5a100-6efa-45ca-ad4c-d1e57af76ffd/userFiles-a053206e-33d9-4245-b587-f8ac26d4c240/fetchFileTemp1549645948768432992.tmp&lt;br/&gt;
&lt;b&gt;I print out the&#160; PYTHONPATH and PYSPARK_FILES environment&#160;variables&#160;from the driver script:&lt;/b&gt;&lt;br/&gt;
&#160;&#160; &#160; PYTHONPATH /opt/spark/python/lib/pyspark.zip:/opt/spark/python/lib/py4j-0.10.7-src.zip:/opt/spark/jars/spark-core_2.11-2.4.0-SNAPSHOT.jar:/opt/spark/python/lib/pyspark.zip:/opt/spark/python/lib/py4j-&lt;b&gt;.zip:&lt;/b&gt;&lt;a href=&quot;https://s3.amazonaws.com/maxar-ids-fids/screw.zip&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://s3.amazonaws.com/maxar-ids-fids/screw.zip&lt;/a&gt;*&lt;br/&gt;
&#160; &#160; PYSPARK_FILES&#160;&lt;a href=&quot;https://s3.amazonaws.com/maxar-ids-fids/screw.zip&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://s3.amazonaws.com/maxar-ids-fids/screw.zip&lt;/a&gt;&lt;br/&gt;
&#160;&lt;br/&gt;
&lt;b&gt;I print out sys.path&lt;/b&gt;&lt;br/&gt;
&lt;a href=&quot;http://s3.amazonaws.com/maxar-ids-fids/screw.zip]&amp;#39;,*&#160;&amp;#39;/usr/lib/python27.zip&amp;#39;, &amp;#39;/usr/lib/python2.7&amp;#39;, &amp;#39;/usr/lib/python2.7/plat-linux2&amp;#39;, &amp;#39;/usr/lib/python2.7/lib-tk&amp;#39;, &amp;#39;/usr/lib/python2.7/lib-old&amp;#39;, &amp;#39;/usr/lib/python2.7/lib-dynload&amp;#39;, &amp;#39;/usr/lib/python2.7/site-packages&amp;#39;&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&apos;/tmp/spark-fec3684b-8b63-4f43-91a4-2f2fa41a1914&apos;, u&apos;/var/data/spark-7aba748d-2bba-4015-b388-c2ba9adba81e/spark-0ed5a100-6efa-45ca-ad4c-d1e57af76ffd/userFiles-a053206e-33d9-4245-b587-f8ac26d4c240&apos;, &apos;/opt/spark/python/lib/pyspark.zip&apos;, &apos;/opt/spark/python/lib/py4j-0.10.7-src.zip&apos;, &apos;/opt/spark/jars/spark-core_2.11-2.4.0-SNAPSHOT.jar&apos;, &apos;/opt/spark/python/lib/py4j-&lt;b&gt;.zip&apos;,&#160;&lt;/b&gt;&apos;/opt/spark/work-dir/https&apos;, &apos;//[s3.amazonaws.com/maxar-ids-fids/screw.zip&lt;/a&gt;&lt;br/&gt;
&#160;&lt;br/&gt;
&lt;b&gt;URL from PYTHONFILES gets placed in sys.path verbatim with obvious&#160;results.&lt;/b&gt;&lt;br/&gt;
&#160;&lt;br/&gt;
&lt;b&gt;Dump of spark config from container.&lt;/b&gt;&lt;br/&gt;
Spark config dumped:&lt;br/&gt;
[(u&apos;spark.master&apos;, u&apos;k8s://&lt;a href=&quot;https://internal-api-test-k8s-local-7afed8-796273878.us-east-1.elb.amazonaws.com/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://internal-api-test-k8s-local-7afed8-796273878.us-east-1.elb.amazonaws.com&lt;/a&gt;&apos;), (u&apos;spark.kubernetes.authenticate.submission.oauthToken&apos;, u&apos;&amp;lt;present_but_redacted&amp;gt;&apos;), (u&apos;spark.kubernetes.authenticate.driver.oauthToken&apos;, u&apos;&amp;lt;present_but_redacted&amp;gt;&apos;), (u&apos;spark.kubernetes.executor.podNamePrefix&apos;, u&apos;pytest-1530430411996&apos;), (u&apos;spark.kubernetes.memoryOverheadFactor&apos;, u&apos;0.4&apos;), (u&apos;spark.driver.blockManager.port&apos;, u&apos;7079&apos;), (u&apos;&lt;a href=&quot;http://spark.app.id/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;spark.app.id&lt;/a&gt;&apos;, u&apos;spark-application-1530430424433&apos;), (u&apos;&lt;a href=&quot;http://spark.app.name/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;spark.app.name&lt;/a&gt;&apos;, u&apos;pytest&apos;), (u&apos;&lt;a href=&quot;http://spark.executor.id/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;spark.executor.id&lt;/a&gt;&apos;, u&apos;driver&apos;), (u&apos;spark.driver.host&apos;, u&apos;pytest-1530430411996-driver-svc.default.svc&apos;), (u&apos;spark.kubernetes.container.image&apos;, u&apos;&lt;a href=&quot;http://412834075398.dkr.ecr.us-east-1.amazonaws.com/fids/pyspark-k8s:latest&amp;#39;&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;412834075398.dkr.ecr.us-east-1.amazonaws.com/fids/pyspark-k8s:latest&apos;&lt;/a&gt;), (u&apos;spark.driver.port&apos;, u&apos;7078&apos;), (u&apos;spark.kubernetes.python.mainAppResource&apos;, u&apos;&lt;a href=&quot;https://s3.amazonaws.com/maxar-ids-fids/it.py&amp;#39;&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://s3.amazonaws.com/maxar-ids-fids/it.py&apos;&lt;/a&gt;), (u&apos;spark.kubernetes.authenticate.submission.caCertFile&apos;, u&apos;&lt;a href=&quot;http://cluster.ca/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cluster.ca&lt;/a&gt;&apos;), (u&apos;spark.rdd.compress&apos;, u&apos;True&apos;), (u&apos;spark.driver.bindAddress&apos;, u&apos;100.120.0.1&apos;), (u&apos;&lt;a href=&quot;http://spark.kubernetes.driver.pod.name/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;spark.kubernetes.driver.pod.name&lt;/a&gt;&apos;, u&apos;spark-pi-driver&apos;), (u&apos;spark.serializer.objectStreamReset&apos;, u&apos;100&apos;), (u&apos;spark.files&apos;, u&apos;&lt;a href=&quot;https://s3.amazonaws.com/maxar-ids-fids/it.py,https://s3.amazonaws.com/maxar-ids-fids/screw.zip&amp;#39;&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://s3.amazonaws.com/maxar-ids-fids/it.py,https://s3.amazonaws.com/maxar-ids-fids/screw.zip&apos;&lt;/a&gt;), (u&apos;spark.kubernetes.python.pyFiles&apos;, u&apos;&lt;a href=&quot;https://s3.amazonaws.com/maxar-ids-fids/screw.zip&amp;#39;&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://s3.amazonaws.com/maxar-ids-fids/screw.zip&apos;&lt;/a&gt;), (u&apos;spark.kubernetes.authenticate.driver.mounted.oauthTokenFile&apos;, u&apos;/mnt/secrets/spark-kubernetes-credentials/oauth-token&apos;), (u&apos;spark.submit.deployMode&apos;, u&apos;client&apos;), (u&apos;spark.kubernetes.submitInDriver&apos;, u&apos;true&apos;)]&lt;br/&gt;
&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;Recent 2.4.0 from master branch, submitted on Linux to a KOPS Kubernetes cluster created on AWS.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</environment>
        <key id="13169974">SPARK-24736</key>
            <summary>--py-files not functional for non local URLs. It appears to pass non-local URL&apos;s into PYTHONPATH directly.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vanzin">Marcelo Masiero Vanzin</assignee>
                                    <reporter username="jonathan.weaver">Jonathan A Weaver</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Jul 2018 02:22:40 +0000</created>
                <updated>Sun, 17 May 2020 18:25:17 +0000</updated>
                            <resolved>Wed, 27 Feb 2019 17:49:59 +0000</resolved>
                                    <version>2.4.0</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>Kubernetes</component>
                    <component>PySpark</component>
                    <component>Spark Core</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="16578624" author="holdenk" created="Mon, 13 Aug 2018 17:10:33 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ifilonenko&quot; class=&quot;user-hover&quot; rel=&quot;ifilonenko&quot;&gt;ifilonenko&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16578882" author="ifilonenko" created="Mon, 13 Aug 2018 20:42:01 +0000"  >&lt;p&gt;The URL, until a resource-staging-server is setup will be unable to resolve the file location unless you use SparkFiles.get(file_name)` in your application. As such, using a URL in the --py-files will be unresolved. Thus, remote dependencies won&apos;t be supported by --py-files just yet, but we can support local files.&#160;&lt;/p&gt;</comment>
                            <comment id="16757663" author="ofrenkel" created="Thu, 31 Jan 2019 19:37:19 +0000"  >&lt;p&gt;Supporting local files with --py-files would be great. By &quot;local files&quot; I mean files that are coming from the original machine outside of driver pod and not files available in the driver docker container.&lt;/p&gt;</comment>
                            <comment id="16768538" author="vanzin" created="Thu, 14 Feb 2019 17:18:54 +0000"  >&lt;p&gt;This isn&apos;t about staging local files. This is about referencing remote files in &lt;tt&gt;--py-files&lt;/tt&gt;, and Spark generating a wrong &lt;tt&gt;PYTHONPATH&lt;/tt&gt; out of it. The key part in the description:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; &apos;/opt/spark/work-dir/https&apos;, &apos;//s3.amazonaws.com/maxar-ids-fids/screw.zip&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Which is what you&apos;d get when adding the &quot;https://...&quot; URL directly into &lt;tt&gt;PYTHONPATH&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="16772337" author="vanzin" created="Tue, 19 Feb 2019 21:12:18 +0000"  >&lt;p&gt;I&apos;m going to fork this issue into 2: &lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I&apos;ll leave this one for the current PR I have opened, which removes duplicated handling for dependencies rom the k8s backend&lt;/li&gt;
	&lt;li&gt;I&apos;ll open a separate one for the issue where a .zip file provided in &lt;tt&gt;--py-files&lt;/tt&gt; is not handled correctly by spark-submit; that affects more than just k8s.&lt;/li&gt;
	&lt;li&gt;There&apos;s a 3rd issue of spark-submit not handling &quot;local:&quot; URIs correctly as far as making them available to executors, which isn&apos;t exactly related to the issue reported here, but I&apos;ll file a bug anyway.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16779574" author="vanzin" created="Wed, 27 Feb 2019 17:49:59 +0000"  >&lt;p&gt;Issue resolved by pull request 23793&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/23793&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/23793&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13278987">SPARK-30496</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13216749">SPARK-26933</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13216750">SPARK-26934</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 37 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3vixr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>