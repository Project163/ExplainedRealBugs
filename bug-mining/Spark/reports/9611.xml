<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 19:42:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-47495] Primary resource jar added to spark.jars twice under k8s cluster mode</title>
                <link>https://issues.apache.org/jira/browse/SPARK-47495</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;&lt;b&gt;Context&lt;/b&gt;:&lt;br/&gt;
To submit spark jobs to Kubernetes under cluster mode, the &lt;tt&gt;spark-submit&lt;/tt&gt; will be triggered twice. &lt;br/&gt;
The first time &lt;tt&gt;SparkSubmit&lt;/tt&gt; will run under k8s cluster mode, it will append primary resource to &lt;tt&gt;spark.jars&lt;/tt&gt; and call &lt;tt&gt;KubernetesClientApplication::start&lt;/tt&gt; to create a driver pod. &lt;br/&gt;
The driver pod will run &lt;tt&gt;spark-submit&lt;/tt&gt; again with the same primary resource jar. However this time the &lt;tt&gt;SparkSubmit&lt;/tt&gt; will run under client mode with &lt;tt&gt;spark.kubernetes.submitInDriver&lt;/tt&gt; as &lt;tt&gt;true&lt;/tt&gt;, plus the updated &lt;tt&gt;spark.jars&lt;/tt&gt;. Under this mode, &lt;tt&gt;SparkSubmit&lt;/tt&gt; will download all the jars in &lt;tt&gt;spark.jars&lt;/tt&gt; to driver and those &lt;tt&gt;spark.jars&lt;/tt&gt; urls will be replaced by the driver local paths. &lt;br/&gt;
Then SparkSubmit will append the same primary resource to spark.jars again. So in this case, &lt;tt&gt;spark.jars&lt;/tt&gt; will have 2 paths of duplicate copies of primary resource, one with the original url user submit with, the other with the driver local file path. &lt;br/&gt;
Later when driver starts the SparkContext, it will copy all the &lt;tt&gt;spark.jars&lt;/tt&gt; to &lt;tt&gt;spark.app.initial.jar.urls&lt;/tt&gt;, and replace the driver local jars paths in &lt;tt&gt;spark.app.initial.jar.urls&lt;/tt&gt; with driver file service paths. &lt;br/&gt;
Now all the jars in the &lt;tt&gt;--jars&lt;/tt&gt; or `spark.jars` in the original user submission will be replaced with a driver file service url and added to  &lt;tt&gt;spark.app.initial.jar.urls&lt;/tt&gt;. And the primary resource jar in the original submission will show up in &lt;tt&gt;spark.app.initial.jar.urls&lt;/tt&gt; twice: one with the original path in the user submission, the other with a driver file service url.&lt;br/&gt;
When executors start, they will download all the jars in the &lt;tt&gt;spark.app.initial.jar.urls&lt;/tt&gt;. &lt;/p&gt;

&lt;p&gt;&lt;b&gt;Issue&lt;/b&gt;:&lt;br/&gt;
The executor will download 2 duplicate copies of primary resource, one with the original url user submit with, the other with the driver local file path, which leads to resource waste. This is also reported previously &lt;a href=&quot;https://github.com/apache/spark/pull/37417#issuecomment-1517797912&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13572749">SPARK-47495</key>
            <summary>Primary resource jar added to spark.jars twice under k8s cluster mode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Jiale">Jiale Tan</assignee>
                                    <reporter username="Jiale">Jiale Tan</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 20 Mar 2024 23:44:32 +0000</created>
                <updated>Tue, 26 Mar 2024 03:34:23 +0000</updated>
                            <resolved>Sun, 24 Mar 2024 00:09:48 +0000</resolved>
                                    <version>3.4.0</version>
                    <version>3.5.0</version>
                                    <fixVersion>4.0.0</fixVersion>
                                    <component>Deploy</component>
                    <component>Kubernetes</component>
                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17829354" author="JIRAUSER290356" created="Thu, 21 Mar 2024 02:41:51 +0000"  >&lt;p&gt;Proposing a fix in &lt;a href=&quot;https://github.com/apache/spark/pull/45607&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/45607&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17830190" author="dongjoon" created="Sun, 24 Mar 2024 00:09:48 +0000"  >&lt;p&gt;Issue resolved by pull request 45607&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/45607&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/45607&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 33 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1o49s:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311620" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Shepherd</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>dongjoon</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>