<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 18:40:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SPARK-13796] Lock release errors occur frequently in executor logs</title>
                <link>https://issues.apache.org/jira/browse/SPARK-13796</link>
                <project id="12315420" key="SPARK">Spark</project>
                    <description>&lt;p&gt;Executor logs contain a lot of these error messages (irrespective of the workload):&lt;/p&gt;

&lt;p&gt;16/03/08 17:53:07 ERROR executor.Executor: 1 block locks were not released by TID = 1119&lt;/p&gt;</description>
                <environment></environment>
        <key id="12948677">SPARK-13796</key>
            <summary>Lock release errors occur frequently in executor logs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nravi">Nishkam Ravi</assignee>
                                    <reporter username="nravi">Nishkam Ravi</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Mar 2016 06:25:49 +0000</created>
                <updated>Fri, 9 Sep 2016 21:43:22 +0000</updated>
                            <resolved>Mon, 14 Mar 2016 21:26:12 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>Spark Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15188762" author="nravi" created="Thu, 10 Mar 2016 06:30:29 +0000"  >&lt;p&gt;Running with master from March 7th (e52e597db48d069b98c1d404b221d3365f38fbb8)&lt;/p&gt;

&lt;p&gt;Error introduced by 633d63a48ad98754dc7c56f9ac150fc2aa4e42c5&lt;/p&gt;</comment>
                            <comment id="15188830" author="srowen" created="Thu, 10 Mar 2016 07:18:04 +0000"  >&lt;p&gt;Do you have more detail on how to reproduce it? It&apos;s good that you think you see what introduced the problem, but how about linking to the commit or leaving some analysis of how it was introduced? Is there any actual impact, or just log noise??&lt;/p&gt;</comment>
                            <comment id="15189197" author="srowen" created="Thu, 10 Mar 2016 12:05:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joshrosen&quot; class=&quot;user-hover&quot; rel=&quot;joshrosen&quot;&gt;joshrosen&lt;/a&gt; does that seem like a problem?&lt;/p&gt;</comment>
                            <comment id="15189389" author="bherta" created="Thu, 10 Mar 2016 14:53:46 +0000"  >&lt;p&gt;We have been seeing this as well, running with trunk as of this morning.  It doesn&apos;t appear to affect our results, so it may be just log noise, or maybe our testing isn&apos;t thorough enough to see the problem.  One easy way to reproduce it is to run the org.apache.spark.examples.mllib.LBFGSExample example program.&lt;/p&gt;</comment>
                            <comment id="15189919" author="nravi" created="Thu, 10 Mar 2016 20:52:01 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srowen&quot; class=&quot;user-hover&quot; rel=&quot;srowen&quot;&gt;srowen&lt;/a&gt; this doesn&apos;t seem to impact functionality. I checked with Josh offline and we decided to open a JIRA anyways. Can be reproduced with SparkPageRank example among others. If we conclude this isn&apos;t a real problem, the error message could be redirected to logWarning.&lt;/p&gt;</comment>
                            <comment id="15189930" author="nravi" created="Thu, 10 Mar 2016 21:00:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joshrosen&quot; class=&quot;user-hover&quot; rel=&quot;joshrosen&quot;&gt;joshrosen&lt;/a&gt; Retested with latest master. FWIW I haven&apos;t seen any error messages with &amp;gt; 1 block locks not released. &lt;/p&gt;</comment>
                            <comment id="15189939" author="joshrosen" created="Thu, 10 Mar 2016 21:07:18 +0000"  >&lt;p&gt;This is likely to be a spurious warning due to things like limit() not releasing locks early, so it&apos;s not a correctness issue per se.&lt;/p&gt;</comment>
                            <comment id="15189957" author="nravi" created="Thu, 10 Mar 2016 21:19:46 +0000"  >&lt;p&gt;Would it make sense to change the condition to check for unreleased locks &amp;gt; 1 instead of 0 or redirect the error message to logWarning?&lt;/p&gt;</comment>
                            <comment id="15194171" author="nravi" created="Mon, 14 Mar 2016 21:25:40 +0000"  >&lt;p&gt;Looks like this issue has been fixed by a recent commit which adds the missing releaseLock (among other changes):&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/commit/81d48532d954a8aea28d7e1fb3aa32a78c708b63&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/commit/81d48532d954a8aea28d7e1fb3aa32a78c708b63&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Closing the JIRA. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joshrosen&quot; class=&quot;user-hover&quot; rel=&quot;joshrosen&quot;&gt;joshrosen&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15208016" author="earne" created="Wed, 23 Mar 2016 07:39:20 +0000"  >&lt;p&gt;I find this ERROR is still exist in executor&apos;s log. This error can be reproduced by running &lt;em&gt;LiveJournalPageRank&lt;/em&gt; example.&lt;/p&gt;

&lt;p&gt;By calling BlockManager.getOrElseUpdate, as mentioned in &lt;a href=&quot;https://github.com/apache/spark/blob/f2e855fba8eb73475cf312cdf880c1297d4323bb/core/src/main/scala/org/apache/spark/storage/BlockManager.scala#L660&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/f2e855fba8eb73475cf312cdf880c1297d4323bb/core/src/main/scala/org/apache/spark/storage/BlockManager.scala#L660&lt;/a&gt; , both of &lt;em&gt;doPut&lt;/em&gt; and &lt;em&gt;getLocalValues&lt;/em&gt; acquired a read lock, but only released one at line 661.&lt;/p&gt;

&lt;p&gt;The remaining lock should be release by &lt;em&gt;CompletionIterator&lt;/em&gt; located in &lt;a href=&quot;https://github.com/apache/spark/blob/f2e855fba8eb73475cf312cdf880c1297d4323bb/core/src/main/scala/org/apache/spark/storage/BlockManager.scala#L427&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/f2e855fba8eb73475cf312cdf880c1297d4323bb/core/src/main/scala/org/apache/spark/storage/BlockManager.scala#L427&lt;/a&gt; after successfully iterates through all the elements, however, this do not always work.&lt;/p&gt;

&lt;p&gt;  At the last of task, &lt;em&gt;releaseAllLocksForTask&lt;/em&gt; is called, and blocks that still have read lock are added to this method&apos;s result. And lead to lots of this kind of error in executor. &lt;/p&gt;</comment>
                            <comment id="15208692" author="joshrosen" created="Wed, 23 Mar 2016 16:19:11 +0000"  >&lt;p&gt;We should probably downgrade the log message&apos;s severity to WARNING because there are currently some non-error cases where locks won&apos;t be released before the end of the task (such as the &lt;tt&gt;take()&lt;/tt&gt; operation&apos;s per-partition limits, which partially consume an iterator but may still leave remaining elements without performing a close() or dispose() operation).&lt;/p&gt;</comment>
                            <comment id="15217100" author="apachespark" created="Wed, 30 Mar 2016 00:06:03 +0000"  >&lt;p&gt;User &apos;nishkamravi2&apos; has created a pull request for this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/12052&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/12052&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13003820">SPARK-17469</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12953679">SPARK-14168</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12929278">SPARK-12757</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 33 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ug5r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12329449">2.0.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>